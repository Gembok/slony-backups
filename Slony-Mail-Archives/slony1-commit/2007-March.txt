From cbbrowne at lists.slony.info  Thu Mar  1 13:02:33 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Thu Mar  1 13:02:37 2007
Subject: [Slony1-commit] slony1-engine/doc/adminguide bestpractices.sgml
	testbed.sgml
Message-ID: <20070301210233.D8F37290013@main>

Update of /home/cvsd/slony1/slony1-engine/doc/adminguide
In directory main:/tmp/cvs-serv8746/doc/adminguide

Modified Files:
	bestpractices.sgml testbed.sgml 
Log Message:
Add tests to the testbed that confirm the minimal permissions required
by those Slony-I connections stored in sl_path.


Index: testbed.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/testbed.sgml,v
retrieving revision 1.10
retrieving revision 1.11
diff -C2 -d -r1.10 -r1.11
*** testbed.sgml	2 Aug 2006 18:34:59 -0000	1.10
--- testbed.sgml	1 Mar 2007 21:02:31 -0000	1.11
***************
*** 95,98 ****
--- 95,112 ----
  to be a &postgres; <quote>superuser.</quote> </para>  </glossdef> </glossentry>
  
+ <glossentry><glossterm> <envar>WEAKUSER</envar> </glossterm>
+ <glossdef><para> By default, the user <filename>postgres</filename> is
+ used; this is taken as the default user ID to use for the <xref linkend="stmtstorepath"> connections to all of the
+ databases. </para>
+ 
+ <para> There are also variables <envar>WEAKUSER1</envar> thru
+ <envar>WEAKUSER13</envar> which allow specifying a separate user name
+ for each database instance.  This user <emphasis> does not </emphasis>
+ need to be a &postgres; <quote>superuser.</quote> This user can start
+ out with no permissions; it winds up granted read permissions on the
+ tables that the test uses, plus read access throughout the &slony1;
+ schema, plus write access to one table and sequence used to manage
+ node locks. </para> </glossdef> </glossentry>
+ 
  <glossentry><glossterm> <envar>HOST</envar> </glossterm>
  <glossdef><para> By default, <filename>localhost</filename> is used.

Index: bestpractices.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/bestpractices.sgml,v
retrieving revision 1.24
retrieving revision 1.25
diff -C2 -d -r1.24 -r1.25
*** bestpractices.sgml	17 Oct 2006 18:45:15 -0000	1.24
--- bestpractices.sgml	1 Mar 2007 21:02:31 -0000	1.25
***************
*** 376,379 ****
--- 376,418 ----
  </listitem>
  
+ <listitem><para> Lowering Authority </para>
+ 
+ <para> Traditionally, it has been stated that <quote>&slony; needs to
+ use superuser connections.</quote> It turns out that this is not
+ entirely true, and and if there are particular concerns about
+ excessive use of superuser accounts, it is possible to reduce this
+ considerably. </para>
+ 
+ <para> It is true to say that each &lslon; <emphasis>must</emphasis>
+ have a superuser connection in order to manage the node that it is
+ assigned to.  It needs to be able to alter the system catalogue in
+ order to set up subscriptions and to process alterations
+ (<emphasis>e.g</emphasis> - to run <xref linkend="stmtddlscript"> and
+ other events that may alter the role of replicated tables on the local
+ node).  </para>
+ 
+ <para> However, the connections that &lslon; processes open to other
+ nodes to access events and process subcriptions do not need to have
+ nearly so much permission.  Indeed, one could set up a <quote>weak
+ user</quote> assigned to all <xref linkend="stmtstorepath"> requests.
+ The minimal permissions that this user, let's call it
+ <command>weakuser</command>, requires are as follows:</para>
+ 
+ <itemizedlist>
+ <listitem><para> It must have read access to the &slony1;-specific namespace </para> </listitem>
+ <listitem><para> It must have read access to all tables and sequences in that namespace</para> </listitem>
+ <listitem><para> It must have write access to the &slony1; table <envar>sl_nodelock</envar> and sequence <envar>sl_nodelock_nl_conncnt_seq</envar> </para> </listitem>
+ <listitem><para> At subscribe time, it must have read access to all of the replicated tables. </para> 
+ <para> Outside of subscription time, there is no need for access to access to the replicated tables. </para> </listitem>
+ <listitem><para> There is some need for read access to tables in pg_catalog; it has not been verified how little access would be suitable. </para> </listitem>
+ </itemizedlist>
+ 
+ <para> In version 1.3, the tests in the <xref linkend="testbed">
+ support using a <envar>WEAKUSER</envar> so that testing can regularly
+ confirm the minimal set of permissions needed to support
+ replication.</para>
+ 
+ </listitem>
+ 
  <listitem><para> The section on <link linkend="listenpaths"> listen
  paths </link> discusses the issues surrounding the table <xref

From cbbrowne at lists.slony.info  Thu Mar  1 13:02:33 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Thu Mar  1 13:02:37 2007
Subject: [Slony1-commit] slony1-engine/tests/test1 gen_weak_user.sh
Message-ID: <20070301210233.DB84B290045@main>

Update of /home/cvsd/slony1/slony1-engine/tests/test1
In directory main:/tmp/cvs-serv8746/tests/test1

Added Files:
	gen_weak_user.sh 
Log Message:
Add tests to the testbed that confirm the minimal permissions required
by those Slony-I connections stored in sl_path.


--- NEW FILE: gen_weak_user.sh ---
weakuser=$1;

for i in 1 2 3 4 5; do
   echo "grant select on table public.table${i} to ${weakuser};"
   echo "grant select on table public.table${i}_id_seq to ${weakuser};"
done
From cbbrowne at lists.slony.info  Thu Mar  1 13:02:33 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Thu Mar  1 13:02:37 2007
Subject: [Slony1-commit] slony1-engine/tests/test2 gen_weak_user.sh
Message-ID: <20070301210233.E4515290329@main>

Update of /home/cvsd/slony1/slony1-engine/tests/test2
In directory main:/tmp/cvs-serv8746/tests/test2

Added Files:
	gen_weak_user.sh 
Log Message:
Add tests to the testbed that confirm the minimal permissions required
by those Slony-I connections stored in sl_path.


--- NEW FILE: gen_weak_user.sh ---
weakuser=$1;

for i in 1 2 3; do
   echo "grant select on table public.table${i} to ${weakuser};"
   echo "grant select on table public.table${i}_id_seq to ${weakuser};"
done
From cbbrowne at lists.slony.info  Thu Mar  1 13:02:33 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Thu Mar  1 13:02:37 2007
Subject: [Slony1-commit] slony1-engine/tests/testdatestyles gen_weak_user.sh
Message-ID: <20070301210233.F1ADE2903B4@main>

Update of /home/cvsd/slony1/slony1-engine/tests/testdatestyles
In directory main:/tmp/cvs-serv8746/tests/testdatestyles

Added Files:
	gen_weak_user.sh 
Log Message:
Add tests to the testbed that confirm the minimal permissions required
by those Slony-I connections stored in sl_path.


--- NEW FILE: gen_weak_user.sh ---
weakuser=$1;

for i in 1; do
   echo "grant select on table public.table${i} to ${weakuser};"
   echo "grant select on table public.table${i}_id_seq to ${weakuser};"
done
From cbbrowne at lists.slony.info  Thu Mar  1 13:02:34 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Thu Mar  1 13:02:38 2007
Subject: [Slony1-commit] slony1-engine/tests/testddl gen_weak_user.sh
Message-ID: <20070301210234.13F822903B8@main>

Update of /home/cvsd/slony1/slony1-engine/tests/testddl
In directory main:/tmp/cvs-serv8746/tests/testddl

Added Files:
	gen_weak_user.sh 
Log Message:
Add tests to the testbed that confirm the minimal permissions required
by those Slony-I connections stored in sl_path.


--- NEW FILE: gen_weak_user.sh ---
weakuser=$1;

for i in 1 2 3 4; do
   echo "grant select on table public.table${i} to ${weakuser};"
   echo "grant select on table public.table${i}_id_seq to ${weakuser};"
done

echo "grant select on table public.billing_discount to ${weakuser};"
echo "grant select on table public.billing_discount_seq to ${weakuser};"

From cbbrowne at lists.slony.info  Thu Mar  1 13:02:34 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Thu Mar  1 13:02:38 2007
Subject: [Slony1-commit] slony1-engine/tests/testinherit gen_weak_user.sh
Message-ID: <20070301210234.1B2072903BA@main>

Update of /home/cvsd/slony1/slony1-engine/tests/testinherit
In directory main:/tmp/cvs-serv8746/tests/testinherit

Added Files:
	gen_weak_user.sh 
Log Message:
Add tests to the testbed that confirm the minimal permissions required
by those Slony-I connections stored in sl_path.


--- NEW FILE: gen_weak_user.sh ---
weakuser=$1;

for tbl in master sub1 sub2 sub3 regions products sales_data us_east us_west canada; do
   echo "grant select on table public.${tbl} to ${weakuser};"
done


for tbl in master products sales_data; do
  echo "grant select on table public.${tbl}_id_seq to ${weakuser};"
done
From cbbrowne at lists.slony.info  Thu Mar  1 13:02:34 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Thu Mar  1 13:02:38 2007
Subject: [Slony1-commit] slony1-engine/tests/testlargetuples gen_weak_user.sh
Message-ID: <20070301210234.27E822903C8@main>

Update of /home/cvsd/slony1/slony1-engine/tests/testlargetuples
In directory main:/tmp/cvs-serv8746/tests/testlargetuples

Added Files:
	gen_weak_user.sh 
Log Message:
Add tests to the testbed that confirm the minimal permissions required
by those Slony-I connections stored in sl_path.


--- NEW FILE: gen_weak_user.sh ---
weakuser=$1;

for i in 1; do
   echo "grant select on table public.table${i} to ${weakuser};"
   echo "grant select on table public.table${i}_id_seq to ${weakuser};"
done
From cbbrowne at lists.slony.info  Thu Mar  1 13:02:34 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Thu Mar  1 13:02:38 2007
Subject: [Slony1-commit] slony1-engine/tests/testmultiplemoves
	gen_weak_user.sh
Message-ID: <20070301210234.3306D2903C9@main>

Update of /home/cvsd/slony1/slony1-engine/tests/testmultiplemoves
In directory main:/tmp/cvs-serv8746/tests/testmultiplemoves

Added Files:
	gen_weak_user.sh 
Log Message:
Add tests to the testbed that confirm the minimal permissions required
by those Slony-I connections stored in sl_path.


--- NEW FILE: gen_weak_user.sh ---
weakuser=$1;

for i in 1 2 1a 2a; do
   echo "grant select on table public.table${i} to ${weakuser};"
   echo "grant select on table public.table${i}_id_seq to ${weakuser};"
done
From cbbrowne at lists.slony.info  Thu Mar  1 13:02:34 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Thu Mar  1 13:02:38 2007
Subject: [Slony1-commit] slony1-engine/tests/testschemanames gen_weak_user.sh
Message-ID: <20070301210234.443352903DF@main>

Update of /home/cvsd/slony1/slony1-engine/tests/testschemanames
In directory main:/tmp/cvs-serv8746/tests/testschemanames

Added Files:
	gen_weak_user.sh 
Log Message:
Add tests to the testbed that confirm the minimal permissions required
by those Slony-I connections stored in sl_path.


--- NEW FILE: gen_weak_user.sh ---
weakuser=$1;

for i in 1 2 3; do
   echo "grant select on table public.table${i} to ${weakuser};"
   echo "grant select on table public.table${i}_id_seq to ${weakuser};"
done

echo "grant usage on schema \"Schema.name\" to ${weakuser};"
echo "grant usage on schema \"Studly Spacey Schema\" to ${weakuser};"
echo "grant select on table \"Schema.name\".\"user\" to ${weakuser};"
echo "grant select on table \"Schema.name\".\"Capital Idea\" to ${weakuser};"
echo "grant select on table \"Studly Spacey Schema\".\"user\" to ${weakuser};"
echo "grant select on table \"Studly Spacey Schema\".\"a.periodic.sequence\" to ${weakuser};"

From cbbrowne at lists.slony.info  Thu Mar  1 13:02:33 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Thu Mar  1 13:02:39 2007
Subject: [Slony1-commit] slony1-engine/tests README run_test.sh settings.ik
Message-ID: <20070301210234.4A54F2903E0@main>

Update of /home/cvsd/slony1/slony1-engine/tests
In directory main:/tmp/cvs-serv8746/tests

Modified Files:
	README run_test.sh settings.ik 
Log Message:
Add tests to the testbed that confirm the minimal permissions required
by those Slony-I connections stored in sl_path.


Index: settings.ik
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tests/settings.ik,v
retrieving revision 1.4
retrieving revision 1.5
diff -C2 -d -r1.4 -r1.5
*** settings.ik	13 Dec 2005 21:45:55 -0000	1.4
--- settings.ik	1 Mar 2007 21:02:31 -0000	1.5
***************
*** 13,16 ****
--- 13,17 ----
  HOST1=${HOST1:-"localhost"}
  USER1=${USER1:-${PGUSER:-"postgres"}}
+ WEAKUSER1=${WEAKUSER1:-${WEAKUSER:-${PGUSER:-"weakuser"}}}
  PORT1=${PORT1:-${PGPORT:-"5432"}}
  PGBINDIR1=${PGBINDIR1:-${PGBINDIR:-"/usr/local/pgsql/bin"}}
***************
*** 19,22 ****
--- 20,24 ----
  HOST2=${HOST2:-"localhost"}
  USER2=${USER2:-${PGUSER:-"postgres"}}
+ WEAKUSER2=${WEAKUSER2:-${WEAKUSER:-${PGUSER:-"weakuser"}}}
  PORT2=${PORT2:-${PGPORT:-"5432"}}
  PGBINDIR2=${PGBINDIR2:-${PGBINDIR:-"/usr/local/pgsql/bin"}}
***************
*** 25,28 ****
--- 27,31 ----
  HOST3=${HOST3:-"localhost"}
  USER3=${USER3:-${PGUSER:-"postgres"}}
+ WEAKUSER3=${WEAKUSER3:-${WEAKUSER:-${PGUSER:-"weakuser"}}}
  PORT3=${PORT3:-${PGPORT:-"5432"}}
  PGBINDIR3=${PGBINDIR3:-${PGBINDIR:-"/usr/local/pgsql/bin"}}
***************
*** 31,34 ****
--- 34,38 ----
  HOST4=${HOST4:-"localhost"}
  USER4=${USER4:-${PGUSER:-"postgres"}}
+ WEAKUSER4=${WEAKUSER4:-${WEAKUSER:-${PGUSER:-"weakuser"}}}
  PORT4=${PORT4:-${PGPORT:-"5432"}}
  PGBINDIR4=${PGBINDIR4:-${PGBINDIR:-"/usr/local/pgsql/bin"}}
***************
*** 37,40 ****
--- 41,45 ----
  HOST5=${HOST5:-"localhost"}
  USER5=${USER5:-${PGUSER:-"postgres"}}
+ WEAKUSER5=${WEAKUSER5:-${WEAKUSER:-${PGUSER:-"weakuser"}}}
  PORT5=${PORT5:-${PGPORT:-"5432"}}
  PGBINDIR5=${PGBINDIR5:-${PGBINDIR:-"/usr/local/pgsql/bin"}}
***************
*** 43,46 ****
--- 48,52 ----
  HOST6=${HOST6:-"localhost"}
  USER6=${USER6:-${PGUSER:-"postgres"}}
+ WEAKUSER6=${WEAKUSER6:-${WEAKUSER:-${PGUSER:-"weakuser"}}}
  PORT6=${PORT6:-${PGPORT:-"5432"}}
  PGBINDIR6=${PGBINDIR6:-${PGBINDIR:-"/usr/local/pgsql/bin"}}
***************
*** 49,52 ****
--- 55,59 ----
  HOST7=${HOST7:-"localhost"}
  USER7=${USER7:-${PGUSER:-"postgres"}}
+ WEAKUSER7=${WEAKUSER7:-${WEAKUSER:-${PGUSER:-"weakuser"}}}
  PORT7=${PORT7:-${PGPORT:-"5432"}}
  PGBINDIR7=${PGBINDIR7:-${PGBINDIR:-"/usr/local/pgsql/bin"}}
***************
*** 55,58 ****
--- 62,66 ----
  HOST8=${HOST8:-"localhost"}
  USER8=${USER8:-${PGUSER:-"postgres"}}
+ WEAKUSER8=${WEAKUSER8:-${WEAKUSER:-${PGUSER:-"weakuser"}}}
  PORT8=${PORT8:-${PGPORT:-"5432"}}
  PGBINDIR8=${PGBINDIR8:-${PGBINDIR:-"/usr/local/pgsql/bin"}}
***************
*** 61,64 ****
--- 69,73 ----
  HOST9=${HOST9:-"localhost"}
  USER9=${USER9:-${PGUSER:-"postgres"}}
+ WEAKUSER9=${WEAKUSER9:-${WEAKUSER:-${PGUSER:-"weakuser"}}}
  PORT9=${PORT9:-${PGPORT:-"5432"}}
  PGBINDIR9=${PGBINDIR9:-${PGBINDIR:-"/usr/local/pgsql/bin"}}
***************
*** 67,70 ****
--- 76,80 ----
  HOST10=${HOST10:-"localhost"}
  USER10=${USER10:-${PGUSER:-"postgres"}}
+ WEAKUSER10=${WEAKUSER01:-${WEAKUSER:-${PGUSER:-"weakuser"}}}
  PORT10=${PORT10:-${PGPORT:-"5432"}}
  PGBINDIR10=${PGBINDIR10:-${PGBINDIR:-"/usr/local/pgsql/bin"}}
***************
*** 73,76 ****
--- 83,87 ----
  HOST11=${HOST11:-"localhost"}
  USER11=${USER11:-${PGUSER:-"postgres"}}
+ WEAKUSER11=${WEAKUSER11:-${WEAKUSER:-${PGUSER:-"weakuser"}}}
  PORT11=${PORT11:-${PGPORT:-"5432"}}
  PGBINDIR11=${PGBINDIR11:-${PGBINDIR:-"/usr/local/pgsql/bin"}}
***************
*** 79,82 ****
--- 90,94 ----
  HOST12=${HOST12:-"localhost"}
  USER12=${USER12:-${PGUSER:-"postgres"}}
+ WEAKUSER12=${WEAKUSER12:-${WEAKUSER:-${PGUSER:-"weakuser"}}}
  PORT12=${PORT12:-${PGPORT:-"5432"}}
  PGBINDIR12=${PGBINDIR12:-${PGBINDIR:-"/usr/local/pgsql/bin"}}
***************
*** 85,88 ****
--- 97,101 ----
  HOST13=${HOST13:-"localhost"}
  USER13=${USER13:-${PGUSER:-"postgres"}}
+ WEAKUSER13=${WEAKUSER13:-${WEAKUSER:-${PGUSER:-"weakuser"}}}
  PORT13=${PORT13:-${PGPORT:-"5432"}}
  PGBINDIR13=${PGBINDIR13:-${PGBINDIR:-"/usr/local/pgsql/bin"}}

Index: README
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tests/README,v
retrieving revision 1.3
retrieving revision 1.4
diff -C2 -d -r1.3 -r1.4
*** README	17 Mar 2006 19:11:47 -0000	1.3
--- README	1 Mar 2007 21:02:31 -0000	1.4
***************
*** 36,43 ****
    PGUSER
        By default, the user postgres is used; this is taken as the default user
!       ID to use for all of the databases.
        There are also variables USER1 thru USER13 which allow specifying a
        separate user name for each database instance.  As always, with Slony-I,
        this needs to be a PostgreSQL "superuser."
    HOST
        By default, localhost is used.
--- 36,47 ----
    PGUSER
        By default, the user postgres is used; this is taken as the default user
!       ID to use for all of the databases as the 'generic' user and as the user
!       that a slon connects to its node as.
        There are also variables USER1 thru USER13 which allow specifying a
        separate user name for each database instance.  As always, with Slony-I,
        this needs to be a PostgreSQL "superuser."
+   WEAKUSER
+       By default, this user is 'weakuser'.  It is set up to have read-only 
+       permissions on the Slony-I schema and on the replicated tables.
    HOST
        By default, localhost is used.

Index: run_test.sh
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tests/run_test.sh,v
retrieving revision 1.11
retrieving revision 1.12
diff -C2 -d -r1.11 -r1.12
*** run_test.sh	9 Jun 2006 17:12:20 -0000	1.11
--- run_test.sh	1 Mar 2007 21:02:31 -0000	1.12
***************
*** 210,217 ****
            eval bdb=\$DB${j}
            eval bhost=\$HOST${j}
!           eval buser=\$USER${j}
            eval bport=\$PORT${j}
            if [ -n "${bdb}" -a "${bhost}" -a "${buser}" -a "${bport}" ]; then
! 	    echo "STORE PATH (SERVER=${i}, CLIENT=${j}, CONNINFO='dbname=${db} host=${host} user=${user} port=${port}');" >> $mktmp/slonik.script
            else
              err 3 "No conninfo"
--- 210,217 ----
            eval bdb=\$DB${j}
            eval bhost=\$HOST${j}
!           eval buser=\$WEAKUSER${j}
            eval bport=\$PORT${j}
            if [ -n "${bdb}" -a "${bhost}" -a "${buser}" -a "${bport}" ]; then
! 	    echo "STORE PATH (SERVER=${i}, CLIENT=${j}, CONNINFO='dbname=${db} host=${host} user=${buser} port=${port}');" >> $mktmp/slonik.script
            else
              err 3 "No conninfo"
***************
*** 241,244 ****
--- 241,245 ----
          eval host=\$HOST${originnode}
          eval user=\$USER${originnode}
+         eval weakuser=\$WEAKUSER${originnode}
  	eval pgbindir=\$PGBINDIR${originnode}
  	eval port=\$PORT${originnode}
***************
*** 257,260 ****
--- 258,264 ----
  	status "loading origin DB with $testname/init_schema.sql"
  	$pgbindir/psql -h $host -p $port $db $user < $testname/init_schema.sql 1> ${mktmp}/init_schema.sql.${originnode} 2>${mktmp}/init_schema.sql.${originnode}
+ 	status "setting up user ${weakuser} to have weak access to data"
+ 	. ${testname}/gen_weak_user.sh ${weakuser} > ${mktmp}/grant_weak_access.sql
+                  $pgbindir/psql -h $host -p $port -d $db -U $user < ${mktmp}/grant_weak_access.sql > ${mktmp}/genweakuser.sql.${originnode} 2> ${mktmp}/genweakuser.sql.${originnode}
  	status "done"
  }
***************
*** 266,269 ****
--- 270,274 ----
          eval ohost=\$HOST${originnode}
          eval ouser=\$USER${originnode}
+         eval oweakuser=\$WEAKUSER${originnode}
  	eval opgbindir=\$PGBINDIR${originnode}
  	eval oport=\$PORT${originnode}
***************
*** 275,278 ****
--- 280,284 ----
              eval host=\$HOST${alias}
              eval user=\$USER${alias}
+             eval weakuser=\$WEAKUSER${alias}
  	    eval pgbindir=\$PGBINDIR${alias}
  	    eval port=\$PORT${alias}
***************
*** 303,306 ****
--- 309,349 ----
  }
  
+ generate_weak_slony_grants ()
+ {
+   alias=1
+ 
+   ROTBLS="sl_action_seq sl_config_lock sl_confirm sl_event
+   sl_event_seq sl_listen sl_local_node_id sl_log_1 sl_log_2
+   sl_log_status sl_node  sl_path sl_registry
+   sl_rowid_seq sl_seqlastvalue sl_seqlog sl_sequence sl_set sl_setsync
+   sl_status sl_subscribe sl_table sl_trigger"
+ 
+   RWTBLS="sl_nodelock sl_nodelock_nl_conncnt_seq"
+ 
+   while : ; do
+     eval db=\$DB${alias}
+     eval host=\$HOST${alias}
+     eval user=\$USER${alias}
+     eval weakuser=\$WEAKUSER${alias}
+     eval pgbindir=\$PGBINDIR${alias}
+     eval port=\$PORT${alias}
+ 
+     if [ -n "${db}" -a "${host}" -a "${user}" -a "${port}" ]; then
+       $pgbindir/psql -h $host -p $port -U $user -d $db -c "grant usage on schema \"_${CLUSTER1}\" to ${weakuser};" > /dev/null 2> /dev/null
+       for table in `echo $ROTBLS`; do
+         $pgbindir/psql -h $host -p $port -U $user -d $db -c "grant select on \"_${CLUSTER1}\".${table} to ${weakuser};" > /dev/null 2> /dev/null
+       done
+       for table in `echo $RWTBLS`; do
+         $pgbindir/psql -h $host -p $port -U $user -d $db -c "grant all on \"_${CLUSTER1}\".${table} to ${weakuser};" > /dev/null 2> /dev/null
+       done
+     fi
+     if [ ${alias} -ge ${NUMNODES} ]; then
+        break;
+     else
+        alias=$((${alias} + 1))
+     fi   
+   done    
+ }
+ 
  drop_databases()
  {
***************
*** 523,527 ****
          break;
        else
!         alias=expr ${alias} + 1
        fi
      else
--- 566,570 ----
          break;
        else
!         alias=`expr ${alias} + 1`
        fi
      else
***************
*** 663,666 ****
--- 706,713 ----
  status "done"
  
+ status "Granting weak access on Slony-I schema"
+ generate_weak_slony_grants
+ status "done"
+ 
  status "storing paths"
  init_preamble

From cbbrowne at lists.slony.info  Thu Mar  1 13:02:34 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Thu Mar  1 13:02:39 2007
Subject: [Slony1-commit] slony1-engine/tests/testtabnames gen_weak_user.sh
Message-ID: <20070301210234.66A2B2903E3@main>

Update of /home/cvsd/slony1/slony1-engine/tests/testtabnames
In directory main:/tmp/cvs-serv8746/tests/testtabnames

Added Files:
	gen_weak_user.sh 
Log Message:
Add tests to the testbed that confirm the minimal permissions required
by those Slony-I connections stored in sl_path.


--- NEW FILE: gen_weak_user.sh ---
weakuser=$1;

for i in 1 2 3; do
   echo "grant select on table public.table${i} to ${weakuser};"
   echo "grant select on table public.table${i}_id_seq to ${weakuser};"
done

echo "grant usage on schema \"Schema.name\" to ${weakuser};"
echo "grant usage on schema \"Studly Spacey Schema\" to ${weakuser};"
echo "grant select on table \"Schema.name\".\"user\" to ${weakuser};"
echo "grant select on table \"Schema.name\".\"Capital Idea\" to ${weakuser};"
echo "grant select on table public.evil_index_table to ${weakuser};"


From cbbrowne at lists.slony.info  Thu Mar  1 13:02:34 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Thu Mar  1 13:02:39 2007
Subject: [Slony1-commit] slony1-engine/tests/testseqnames gen_weak_user.sh
Message-ID: <20070301210234.5D5412903E1@main>

Update of /home/cvsd/slony1/slony1-engine/tests/testseqnames
In directory main:/tmp/cvs-serv8746/tests/testseqnames

Added Files:
	gen_weak_user.sh 
Log Message:
Add tests to the testbed that confirm the minimal permissions required
by those Slony-I connections stored in sl_path.


--- NEW FILE: gen_weak_user.sh ---
weakuser=$1;

for i in 1 2 3; do
   echo "grant select on table public.table${i} to ${weakuser};"
   echo "grant select on table public.table${i}_id_seq to ${weakuser};"
done

echo "grant usage on schema \"Schema.name\" to ${weakuser};"
echo "grant usage on schema \"Studly Spacey Schema\" to ${weakuser};"
echo "grant select on table \"Schema.name\".\"user\" to ${weakuser};"
echo "grant select on table \"Schema.name\".\"Capital Idea\" to ${weakuser};"
echo "grant select on table \"Studly Spacey Schema\".\"user\" to ${weakuser};"
echo "grant select on table \"Studly Spacey Schema\".\"a.periodic.sequence\" to ${weakuser};"

From cbbrowne at lists.slony.info  Thu Mar  1 13:02:34 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Thu Mar  1 13:02:39 2007
Subject: [Slony1-commit] slony1-engine/tests/testutf8 gen_weak_user.sh
Message-ID: <20070301210234.7ADA92903E4@main>

Update of /home/cvsd/slony1/slony1-engine/tests/testutf8
In directory main:/tmp/cvs-serv8746/tests/testutf8

Added Files:
	gen_weak_user.sh 
Log Message:
Add tests to the testbed that confirm the minimal permissions required
by those Slony-I connections stored in sl_path.


--- NEW FILE: gen_weak_user.sh ---
weakuser=$1;

for i in table1 table2 table3 table4 utf8table; do
   echo "grant select on table public.${i} to ${weakuser};"
   echo "grant select on table public.table${i}_id_seq to ${weakuser};"
done

From cbbrowne at lists.slony.info  Fri Mar  2 07:47:27 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Fri Mar  2 07:47:29 2007
Subject: [Slony1-commit] slony1-www admin.html
Message-ID: <20070302154727.6006A2902A3@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv12931

Modified Files:
	admin.html 
Log Message:
Update admin+cvs overviews, put in announcement of availability of
new site...


Index: admin.html
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/admin.html,v
retrieving revision 1.6
retrieving revision 1.7
diff -C2 -d -r1.6 -r1.7
*** admin.html	31 Jan 2007 17:56:57 -0000	1.6
--- admin.html	2 Mar 2007 15:47:25 -0000	1.7
***************
*** 218,223 ****
            <p>Niels Breet has set things up where there is a pair of
            central PHP scripts, <tt>index.php</tt>, and
!           <tt>layout.php</tt>, which control rendering of the
!           site.</p>
  
            <p>Web site <i>content</i> resides in the
--- 218,225 ----
            <p>Niels Breet has set things up where there is a pair of
            central PHP scripts, <tt>index.php</tt>, and
!           <tt>layout.php</tt>, which control rendering of the site.
!           By doing things this way, each page on the site can have a
!           common layout complete with common
!           header/footer/graphics.</p>
  
            <p>Web site <i>content</i> resides in the
***************
*** 262,267 ****
            </address><!-- Created: Thu Jan 25 11:38:58 EST 2007 -->
            <!-- hhmts start -->
!           Last modified: Wed Jan 31 12:41:19 EST 2007 
!           <!-- hhmts end -->
          </td>
        </tr>
--- 264,269 ----
            </address><!-- Created: Thu Jan 25 11:38:58 EST 2007 -->
            <!-- hhmts start -->
! Last modified: Wed Jan 31 12:42:48 EST 2007
! <!-- hhmts end -->
          </td>
        </tr>

From cbbrowne at lists.slony.info  Fri Mar  2 07:47:27 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Fri Mar  2 07:47:29 2007
Subject: [Slony1-commit] slony1-www/content cvs.txt news.txt
Message-ID: <20070302154727.6DBA72902B3@main>

Update of /home/cvsd/slony1/slony1-www/content
In directory main:/tmp/cvs-serv12931/content

Modified Files:
	cvs.txt news.txt 
Log Message:
Update admin+cvs overviews, put in announcement of availability of
new site...


Index: news.txt
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/content/news.txt,v
retrieving revision 1.4
retrieving revision 1.5
diff -C2 -d -r1.4 -r1.5
*** news.txt	28 Feb 2007 21:22:51 -0000	1.4
--- news.txt	2 Mar 2007 15:47:25 -0000	1.5
***************
*** 1,3 ****
--- 1,9 ----
  ---
+ Slony-I New Web Site!
+ http://main.slony.info
+ 2007-03-02
+ Chris Browne
+ We are pleased to announce the release of the new Slony-I web site at <tt>main.slony.info</tt>.
+ ---
  Slony-I Quick downloads
  http://main.slony.info/downloads
***************
*** 9,18 ****
  Slony-1 1.1.6 <a href="http://main.slony.info/downloads/1.1/slony1-1.1.6-tar.bz2">engine</a>
  ---
- Slony-I New Web Site!
- http://main.slony.info
- 2007-01-XX
- Chris Browne
- We are pleased to announce the release of the new Slony-I web site at <tt>main.slony.info</tt>.
- ---
  Slony-I New CVS Site!
  http://main.slony.info/cvs.html
--- 15,18 ----

Index: cvs.txt
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/content/cvs.txt,v
retrieving revision 1.4
retrieving revision 1.5
diff -C2 -d -r1.4 -r1.5
*** cvs.txt	1 Feb 2007 17:33:13 -0000	1.4
--- cvs.txt	2 Mar 2007 15:47:25 -0000	1.5
***************
*** 5,11 ****
            <p>You may access Slony-I sources via anonymous CVS using
            the following command:</p>
!           <pre>
  CVSROOT=":pserver:anonymous@main.slony.info:/slony1" cvs login
  (when it prompts for a password, you may press [enter])
  CVSROOT=":pserver:anonymous@main.slony.info:/slony1" cvs co slony1-engine
  </pre>
--- 5,13 ----
            <p>You may access Slony-I sources via anonymous CVS using
            the following command:</p>
! <pre>
  CVSROOT=":pserver:anonymous@main.slony.info:/slony1" cvs login
+ </pre>
  (when it prompts for a password, you may press [enter])
+ <pre>
  CVSROOT=":pserver:anonymous@main.slony.info:/slony1" cvs co slony1-engine
  </pre>
***************
*** 16,21 ****
            ssh key added in on a suitable account, you can access as
            a specific user with update privileges:</p>
!           <pre>
! 
  MYSLONYNAME=cbbrowne CVS_RSH=ssh CVSROOT=":ext:${MYSLONYNAME}@main.slony.info:/home/cvsd/slony1" cvs co slony1-engine
  </pre>
--- 18,22 ----
            ssh key added in on a suitable account, you can access as
            a specific user with update privileges:</p>
! <pre>
  MYSLONYNAME=cbbrowne CVS_RSH=ssh CVSROOT=":ext:${MYSLONYNAME}@main.slony.info:/home/cvsd/slony1" cvs co slony1-engine
  </pre>

From xfade at lists.slony.info  Fri Mar  2 08:01:45 2007
From: xfade at lists.slony.info (Niels Breet)
Date: Fri Mar  2 08:01:46 2007
Subject: [Slony1-commit] slony1-www/content news.txt
Message-ID: <20070302160145.231662902A3@main>

Update of /home/cvsd/slony1/slony1-www/content
In directory main:/tmp/cvs-serv13050

Modified Files:
	news.txt 
Log Message:
Please keep the quickdownloads as top message

Index: news.txt
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/content/news.txt,v
retrieving revision 1.5
retrieving revision 1.6
diff -C2 -d -r1.5 -r1.6
*** news.txt	2 Mar 2007 15:47:25 -0000	1.5
--- news.txt	2 Mar 2007 16:01:43 -0000	1.6
***************
*** 1,9 ****
  ---
- Slony-I New Web Site!
- http://main.slony.info
- 2007-03-02
- Chris Browne
- We are pleased to announce the release of the new Slony-I web site at <tt>main.slony.info</tt>.
- ---
  Slony-I Quick downloads
  http://main.slony.info/downloads
--- 1,3 ----
***************
*** 15,18 ****
--- 9,18 ----
  Slony-1 1.1.6 <a href="http://main.slony.info/downloads/1.1/slony1-1.1.6-tar.bz2">engine</a>
  ---
+ Slony-I New Web Site!
+ http://main.slony.info
+ 2007-03-02
+ Chris Browne
+ We are pleased to announce the release of the new Slony-I web site at <tt>main.slony.info</tt>.
+ ---
  Slony-I New CVS Site!
  http://main.slony.info/cvs.html

From cbbrowne at lists.slony.info  Fri Mar  2 08:36:22 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Fri Mar  2 08:36:25 2007
Subject: [Slony1-commit] slony1-www/content news.txt
Message-ID: <20070302163622.D2D7A2902E8@main>

Update of /home/cvsd/slony1/slony1-www/content
In directory main:/tmp/cvs-serv13333/content

Modified Files:
	news.txt 
Log Message:
News entry got entered twice


Index: news.txt
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/content/news.txt,v
retrieving revision 1.6
retrieving revision 1.7
diff -C2 -d -r1.6 -r1.7
*** news.txt	2 Mar 2007 16:01:43 -0000	1.6
--- news.txt	2 Mar 2007 16:36:20 -0000	1.7
***************
*** 8,11 ****
--- 8,12 ----
  <br />
  Slony-1 1.1.6 <a href="http://main.slony.info/downloads/1.1/slony1-1.1.6-tar.bz2">engine</a>
+ <!-- Please keep this item at the top of the news list -->
  ---
  Slony-I New Web Site!
***************
*** 22,24 ****
  CVS repositories at gBorg.  We thank the gBorg operators for their support over the last few years, and Command Prompt for their provision of hardware, administrative, and hosting services for <tt>cvs.slony.info</tt>.
  ---
- 
--- 23,24 ----

From cbbrowne at lists.slony.info  Tue Mar  6 10:47:26 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Mar  6 10:47:27 2007
Subject: [Slony1-commit] slony1-engine/src/slon remote_worker.c
Message-ID: <20070306184726.5BF192903B2@main>

Update of /home/cvsd/slony1/slony1-engine/src/slon
In directory main:/tmp/cvs-serv12141/src/slon

Modified Files:
      Tag: REL_1_1_STABLE
	remote_worker.c 
Log Message:
Found wrong data type handling in sprintf() that was causing log shipping
to break when a new set got subscribed and new sequences were added.


Index: remote_worker.c
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/slon/remote_worker.c,v
retrieving revision 1.86.2.16
retrieving revision 1.86.2.17
diff -C2 -d -r1.86.2.16 -r1.86.2.17
*** remote_worker.c	28 Feb 2007 22:07:49 -0000	1.86.2.16
--- remote_worker.c	6 Mar 2007 18:47:24 -0000	1.86.2.17
***************
*** 3503,3507 ****
  		slon_mkquery(&query1,
  			     "insert into %s.sl_setsync_offline (ssy_setid, ssy_seqno) "
! 			     "values ('%d', '%d');",
  			     rtcfg_namespace, set_id, ssy_seqno);
  		rc = archive_append_ds(node, &query1);
--- 3503,3507 ----
  		slon_mkquery(&query1,
  			     "insert into %s.sl_setsync_offline (ssy_setid, ssy_seqno) "
! 			     "values ('%d', '%s');",
  			     rtcfg_namespace, set_id, ssy_seqno);
  		rc = archive_append_ds(node, &query1);

From cbbrowne at lists.slony.info  Tue Mar  6 10:47:27 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Mar  6 10:47:30 2007
Subject: [Slony1-commit] slony1-engine RELEASE-1.1.7
Message-ID: <20070306184727.9A13A2902B3@main>

Update of /home/cvsd/slony1/slony1-engine
In directory main:/tmp/cvs-serv12141

Modified Files:
      Tag: REL_1_1_STABLE
	RELEASE-1.1.7 
Log Message:
Found wrong data type handling in sprintf() that was causing log shipping
to break when a new set got subscribed and new sequences were added.


Index: RELEASE-1.1.7
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/Attic/RELEASE-1.1.7,v
retrieving revision 1.1.2.5
retrieving revision 1.1.2.6
diff -C2 -d -r1.1.2.5 -r1.1.2.6
*** RELEASE-1.1.7	28 Feb 2007 22:07:49 -0000	1.1.2.5
--- RELEASE-1.1.7	6 Mar 2007 18:47:23 -0000	1.1.2.6
***************
*** 42,44 ****
    will silently blow away any 'offending' sl_setsync row.
  
!   (As observed by Afilias staff...)
\ No newline at end of file
--- 42,47 ----
    will silently blow away any 'offending' sl_setsync row.
  
!   (As observed by Afilias staff...)
! 
! - Log shipping fix - storage of sl_setsync_offline call had a wrong
!   printf type; change from %d to %s
\ No newline at end of file

From cbbrowne at lists.slony.info  Tue Mar  6 10:47:47 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Mar  6 10:47:49 2007
Subject: [Slony1-commit] slony1-engine RELEASE-1.2.7
Message-ID: <20070306184747.8B6382903E1@main>

Update of /home/cvsd/slony1/slony1-engine
In directory main:/tmp/cvs-serv12172

Modified Files:
      Tag: REL_1_2_STABLE
	RELEASE-1.2.7 
Log Message:
Found wrong data type handling in sprintf() that was causing log shipping
to break when a new set got subscribed and new sequences were added.


Index: RELEASE-1.2.7
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/Attic/RELEASE-1.2.7,v
retrieving revision 1.1.2.6
retrieving revision 1.1.2.7
diff -C2 -d -r1.1.2.6 -r1.1.2.7
*** RELEASE-1.2.7	28 Feb 2007 22:08:32 -0000	1.1.2.6
--- RELEASE-1.2.7	6 Mar 2007 18:47:45 -0000	1.1.2.7
***************
*** 42,44 ****
    will silently blow away any 'offending' sl_setsync row.
  
!   (As observed by Afilias staff...)
\ No newline at end of file
--- 42,47 ----
    will silently blow away any 'offending' sl_setsync row.
  
!   (As observed by Afilias staff...)
! 
! - Log shipping fix - storage of sl_setsync_offline call had a wrong
!   printf type; change from %d to %s
\ No newline at end of file

From cbbrowne at lists.slony.info  Tue Mar  6 10:47:47 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Mar  6 10:47:49 2007
Subject: [Slony1-commit] slony1-engine/src/slon remote_worker.c
Message-ID: <20070306184747.C17AE2903F3@main>

Update of /home/cvsd/slony1/slony1-engine/src/slon
In directory main:/tmp/cvs-serv12172/src/slon

Modified Files:
      Tag: REL_1_2_STABLE
	remote_worker.c 
Log Message:
Found wrong data type handling in sprintf() that was causing log shipping
to break when a new set got subscribed and new sequences were added.


Index: remote_worker.c
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/slon/remote_worker.c,v
retrieving revision 1.124.2.11
retrieving revision 1.124.2.12
diff -C2 -d -r1.124.2.11 -r1.124.2.12
*** remote_worker.c	28 Feb 2007 22:08:32 -0000	1.124.2.11
--- remote_worker.c	6 Mar 2007 18:47:45 -0000	1.124.2.12
***************
*** 3891,3895 ****
  		slon_mkquery(&lsquery,
  			     "insert into %s.sl_setsync_offline (ssy_setid, ssy_seqno) "
! 			     "values ('%d', '%d');",
  			     rtcfg_namespace, set_id, ssy_seqno);
  		rc = archive_append_ds(node, &lsquery);
--- 3891,3895 ----
  		slon_mkquery(&lsquery,
  			     "insert into %s.sl_setsync_offline (ssy_setid, ssy_seqno) "
! 			     "values ('%d', '%s');",
  			     rtcfg_namespace, set_id, ssy_seqno);
  		rc = archive_append_ds(node, &lsquery);

From cbbrowne at lists.slony.info  Wed Mar  7 14:46:46 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Wed Mar  7 14:46:48 2007
Subject: [Slony1-commit] slony1-engine postgresql-slony1-engine.spec.in
Message-ID: <20070307224646.CA60A290012@main>

Update of /home/cvsd/slony1/slony1-engine
In directory main:/tmp/cvs-serv19697

Modified Files:
      Tag: REL_1_1_STABLE
	postgresql-slony1-engine.spec.in 
Log Message:
Add in release notes for 1.1.6 and 1.1.7


Index: postgresql-slony1-engine.spec.in
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/postgresql-slony1-engine.spec.in,v
retrieving revision 1.19.2.8
retrieving revision 1.19.2.9
diff -C2 -d -r1.19.2.8 -r1.19.2.9
*** postgresql-slony1-engine.spec.in	21 Dec 2005 14:58:52 -0000	1.19.2.8
--- postgresql-slony1-engine.spec.in	7 Mar 2007 22:46:44 -0000	1.19.2.9
***************
*** 99,103 ****
  %defattr(-,root,root,-)
  %if %docs
! %doc COPYRIGHT UPGRADING HISTORY-1.1 INSTALL SAMPLE doc/adminguide  doc/concept  doc/howto  doc/implementation  doc/support RELEASE-1.1.5 RELEASE-1.1.2 RELEASE-1.1.1
  %endif
  %{_bindir}/*
--- 99,103 ----
  %defattr(-,root,root,-)
  %if %docs
! %doc COPYRIGHT UPGRADING HISTORY-1.1 INSTALL SAMPLE doc/adminguide  doc/concept  doc/howto  doc/implementation  doc/support RELEASE-1.1.5 RELEASE-1.1.2 RELEASE-1.1.1 RELEASE-1.1.6 RELEASE-1.1.7
  %endif
  %{_bindir}/*
***************
*** 112,115 ****
--- 112,118 ----
  
  %changelog
+ * Wed Mar 06 2007 Christopher Browne <cbbrowne@ca.afilias.info> postgresql-slony1-engine
+ - Added release notes for 1.1.6 and 1.1.7
+ 
  * Wed Dec 21 2005 Devrim Gunduz <devrim@commandprompt.com> postgresql-slony1-engine
  - Added a buildrhel3 macro to fix RHEL 3 RPM builds

From cbbrowne at lists.slony.info  Wed Mar  7 15:03:51 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Wed Mar  7 15:03:52 2007
Subject: [Slony1-commit] slony1-engine postgresql-slony1-engine.spec.in
Message-ID: <20070307230351.B95DF2902E9@main>

Update of /home/cvsd/slony1/slony1-engine
In directory main:/tmp/cvs-serv19834

Modified Files:
      Tag: REL_1_2_STABLE
	postgresql-slony1-engine.spec.in 
Log Message:
Add release notes to RPM specs


Index: postgresql-slony1-engine.spec.in
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/postgresql-slony1-engine.spec.in,v
retrieving revision 1.31.2.6
retrieving revision 1.31.2.7
diff -C2 -d -r1.31.2.6 -r1.31.2.7
*** postgresql-slony1-engine.spec.in	4 Jan 2007 12:11:04 -0000	1.31.2.6
--- postgresql-slony1-engine.spec.in	7 Mar 2007 23:03:49 -0000	1.31.2.7
***************
*** 109,113 ****
  %files
  %defattr(-,root,root,-)
! %doc COPYRIGHT UPGRADING HISTORY-1.1 INSTALL SAMPLE RELEASE-1.2.1
  %{_bindir}/*
  %{_libdir}/pgsql/slony1_funcs.so
--- 109,113 ----
  %files
  %defattr(-,root,root,-)
! %doc COPYRIGHT UPGRADING HISTORY-1.1 INSTALL SAMPLE RELEASE-1.2.1 RELEASE-1.2.2 RELEASE-1.2.5 RELEASE-1.2.6 RELEASE-1.2.7
  %{_bindir}/*
  %{_libdir}/pgsql/slony1_funcs.so
***************
*** 127,130 ****
--- 127,133 ----
  
  %changelog
+ * Wed Mar 7 2007 Christopher Browne <cbbrowne@ca.afilias.info>
+ - Added more recent release notes
+ 
  * Thu Jan 4 2007 Devrim Gunduz <devrim@CommandPrompt.com>
  - Add docs package (It should be added before but...)

From cbbrowne at lists.slony.info  Wed Mar  7 15:24:14 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Wed Mar  7 15:24:15 2007
Subject: [Slony1-commit] slony1-www/content news.txt
Message-ID: <20070307232414.54E202903B4@main>

Update of /home/cvsd/slony1/slony1-www/content
In directory main:/tmp/cvs-serv20031/content

Modified Files:
	news.txt 
Log Message:
Add release of 1.1.7 and 1.2.7


Index: news.txt
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/content/news.txt,v
retrieving revision 1.7
retrieving revision 1.8
diff -C2 -d -r1.7 -r1.8
*** news.txt	2 Mar 2007 16:36:20 -0000	1.7
--- news.txt	7 Mar 2007 23:24:12 -0000	1.8
***************
*** 7,13 ****
  <a href="http://main.slony.info/downloads/1.2/slony1-1.2.6-docs.tar.bz2">documentation</a>
  <br />
! Slony-1 1.1.6 <a href="http://main.slony.info/downloads/1.1/slony1-1.1.6-tar.bz2">engine</a>
  <!-- Please keep this item at the top of the news list -->
  ---
  Slony-I New Web Site!
  http://main.slony.info
--- 7,125 ----
  <a href="http://main.slony.info/downloads/1.2/slony1-1.2.6-docs.tar.bz2">documentation</a>
  <br />
! Slony-1 1.1.7 <a href="http://main.slony.info/downloads/1.1/slony1-1.1.7-tar.bz2">engine</a>
  <!-- Please keep this item at the top of the news list -->
  ---
+ Slony-I Release - 1.2.7
+ http://main.slony.info/downloads/1.2
+ 2007-03-07
+ Chris Browne
+ We are pleased to announce the release of version 1.2.7, which may be
+ found <a href="http://main.slony.info/downloads/1.2/slony1-1.2.7-tar.bz2">here</a>.  
+ There is also a <a href="http://main.slony.info/downloads/1.2/slony1-1.2.7-docs-tar.bz2">Documentation tarball </a>.
+ 
+ <P> This release fixes several problems that were found in the 1.2 stream:
+ <ul>
+ <li> Add remote_listen_timeout parameter to slon.conf
+ 
+ <p> This addresses the problem where a slon times out when accessing
+ sl_event if a node has been out of commission for a long time (several
+ days)
+ 
+ <li> Resolve bug #1623
+ 
+ <p> In this bug, big "action lists" that need to get compressed could cause
+ a logging printf to blow up.  Changed the logging level so that detail
+ is only shown at level 4, which won't bite people by default.
+ 
+ <li> UNINSTALL NODE failures now show node # in slonik error messages
+ 
+ <P> If a user ran several UNINSTALL NODE requests in a single slonik
+ script, and one of them broke, you'd have no ready way to tell which
+ node this failed on.  Added code to report the node # where it failed.
+ 
+ <li> Added test to test1 for function generate_sync_event() and make_function_strict
+ 
+ <li> Added "v81" files (for slony1_base.v81.sql, slony1_funcs.v81.sql,
+ xxid.v81.sql), necessary to support 8.1 "ALTER FUNCTION ... STRICT";
+ 
+ <li> Fixed quoting problem in generate_sync_event()
+ 
+ <li> Added functionality to UPDATE FUNCTIONS to make xxidin() function
+ STRICT; the absence of this caused postmaster to fall over when
+ processing MOVE SET event in PG v8.2
+ 
+ <li> Added documentation of an issue surrounding NULLABLE columns to the
+ log analysis chapter of the admin guide and to the UPGRADING docs.
+ 
+ <li> When you run MOVE SET, this populates sl_setsync for the moved set
+   even on nodes that are not subscribed.  If, subsequent to doing this, 
+   you attempt a SUBSCRIBE SET for a formerly-unsubscribed node, the
+   subscription will fail right at the end when the slon tries to insert a
+   new value to sl_setsync.
+ 
+ <P>   The fix: DELETE from sl_setsync immediately before the INSERT.  This
+   will silently blow away any 'offending' sl_setsync row.
+ 
+ <p>  (As observed by Afilias staff...)
+ 
+ <li> Log shipping fix - storage of sl_setsync_offline call had a wrong
+   printf type; change from %d to %s
+ </ul>
+ ---
+ Slony-I Release - 1.1.7
+ http://main.slony.info/downloads/1.1
+ 2007-03-07
+ Chris Browne
+ We are pleased to announce the release of version 1.1.7, which may be
+ found <a href="http://main.slony.info/downloads/1.1/slony1-1.1.7-tar.bz2">here</a>.  
+ It fixes several problems that were found in the 1.2 stream that were readily back-ported to 1.1:
+ <ul>
+ <li>Add remote_listen_timeout parameter to <tt>slon.conf</tt>
+ 
+ <p> This addresses the problem where a slon times out when accessing
+ sl_event if a node has been out of commission for a long time (several
+ days)
+ 
+ <li> Add node numbers to error reports in slonik
+ 
+ <p> If portions of UNINSTALL NODE break, report in the error message which node
+ it was working on.  That way the gentle user gets an indication as to 
+ which node 'broke' if the slonik script contained multiple such
+ requests.
+ 
+ <li> Applied bug fix for #1538
+ 
+ <p> If cluster has only one node, then remove all events up to the last
+ SYNC.  That allows the cleanup loop to clear out sl_log_{1/2}.
+ Otherwise, the log tables will forever bloat until you add a second
+ node...
+ 
+ <li> Added test to test1 for function generate_sync_event() and make_function_strict
+ 
+ <li> Added "v81" files (for slony1_base.v81.sql, slony1_funcs.v81.sql,
+ xxid.v81.sql), necessary to support 8.1 "ALTER FUNCTION ... STRICT";
+ 
+ <li> Fixed quoting problem in generate_sync_event()
+ 
+ <li> Added functionality to UPDATE FUNCTIONS to make xxidin() function
+ STRICT; the absence of this caused postmaster to fall over when
+ processing MOVE SET event in PG v8.2 (not to say that Slony-I 1.1 now
+ *supports* 8.2; it does not)
+ 
+ <li> When you run MOVE SET, this populates sl_setsync for the moved set
+   even on nodes that are not subscribed.  If, subsequent to doing this, 
+   you attempt a SUBSCRIBE SET for a formerly-unsubscribed node, the
+   subscription will fail right at the end when the slon tries to insert a
+   new value to sl_setsync.
+ 
+ <p>  The fix: DELETE from sl_setsync immediately before the INSERT.  This
+   will silently blow away any 'offending' sl_setsync row.
+ 
+ <P>  (As observed by Afilias staff...)
+ 
+ <li> Log shipping fix - storage of sl_setsync_offline call had a wrong
+   printf type; change from %d to %s
+ </ul>
+ ---
  Slony-I New Web Site!
  http://main.slony.info

From cbbrowne at lists.slony.info  Wed Mar  7 15:24:14 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Wed Mar  7 15:24:16 2007
Subject: [Slony1-commit] slony1-www index.html
Message-ID: <20070307232414.4BA4F2902E9@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv20031

Modified Files:
	index.html 
Log Message:
Add release of 1.1.7 and 1.2.7


Index: index.html
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/index.html,v
retrieving revision 1.5
retrieving revision 1.6
diff -C2 -d -r1.5 -r1.6
*** index.html	29 Jan 2007 19:30:14 -0000	1.5
--- index.html	7 Mar 2007 23:24:12 -0000	1.6
***************
*** 124,132 ****
            here</a>.</p>
  
!           <h1>Slony-I 1.2.6</h1>
  
!           <p>At long last, here is version 1.2.6. It has many
            enhancements as listed in the <a href=
!           "http://pgfoundry.org/frs/shownotes.php?release_id=730">Release
            Notes</a> .</p>
  
--- 124,132 ----
            here</a>.</p>
  
!           <h1>Slony-I 1.2.7</h1>
  
!           <p>Now released is version 1.2.6. It has many
            enhancements as listed in the <a href=
!           "http://main.slony.info/viewcvs/viewvc.cgi/slony1-engine/RELEASE-1.2.7?view=log">Release
            Notes</a> .</p>
  
***************
*** 135,140 ****
            Checklist</a></p>
  
!           <p>There are two tarballs available <a href=
!           "http://pgfoundry.org/frs/?group_id=1000122">here</a></p>
  
            <h1>Slony-I and PostgreSQL 8.1</h1>
--- 135,140 ----
            Checklist</a></p>
  
!           <p>There are two tarballs available in the downloads area <a
!           href="http://main.slony.info/downloads/1.2">here</a></p>
  
            <h1>Slony-I and PostgreSQL 8.1</h1>
***************
*** 217,222 ****
            </address><!-- Created: Thu Jan 25 11:13:08 EST 2007 -->
            <!-- hhmts start -->
!           Last modified: Mon Jan 29 14:29:05 EST 2007 
!           <!-- hhmts end -->
          </td>
        </tr>
--- 217,222 ----
            </address><!-- Created: Thu Jan 25 11:13:08 EST 2007 -->
            <!-- hhmts start -->
! Last modified: Wed Mar  7 18:23:12 EST 2007
! <!-- hhmts end -->
          </td>
        </tr>

From cbbrowne at lists.slony.info  Wed Mar  7 15:25:40 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Wed Mar  7 15:25:41 2007
Subject: [Slony1-commit] slony1-www index.html
Message-ID: <20070307232540.45CD72902E9@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv20073

Modified Files:
	index.html 
Log Message:
Make sure that we have correct refs to the new releases...


Index: index.html
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/index.html,v
retrieving revision 1.6
retrieving revision 1.7
diff -C2 -d -r1.6 -r1.7
*** index.html	7 Mar 2007 23:24:12 -0000	1.6
--- index.html	7 Mar 2007 23:25:38 -0000	1.7
***************
*** 126,131 ****
            <h1>Slony-I 1.2.7</h1>
  
!           <p>Now released is version 1.2.6. It has many
!           enhancements as listed in the <a href=
            "http://main.slony.info/viewcvs/viewvc.cgi/slony1-engine/RELEASE-1.2.7?view=log">Release
            Notes</a> .</p>
--- 126,131 ----
            <h1>Slony-I 1.2.7</h1>
  
!           <p>Now released is version 1.2.7. It has a number of fixes
!           and minor enhancements as listed in the <a href=
            "http://main.slony.info/viewcvs/viewvc.cgi/slony1-engine/RELEASE-1.2.7?view=log">Release
            Notes</a> .</p>
***************
*** 138,141 ****
--- 138,155 ----
            href="http://main.slony.info/downloads/1.2">here</a></p>
  
+           <h1>Slony-I 1.1.7</h1>
+ 
+           <p>Now released is version 1.1.7. It has a number of fixes and minor
+           enhancements as listed in the <a href=
+           "http://main.slony.info/viewcvs/viewvc.cgi/slony1-engine/RELEASE-1.1.7?view=log">Release
+           Notes</a> .</p>
+ 
+           <p>This has been run thru the <a href=
+           "http://linuxdatabases.info/info/releasechecklist.html">Release
+           Checklist</a></p>
+ 
+           <p>There are two tarballs available in the downloads area <a
+           href="http://main.slony.info/downloads/1.2">here</a></p>
+ 
            <h1>Slony-I and PostgreSQL 8.1</h1>
  
***************
*** 217,221 ****
            </address><!-- Created: Thu Jan 25 11:13:08 EST 2007 -->
            <!-- hhmts start -->
! Last modified: Wed Mar  7 18:23:12 EST 2007
  <!-- hhmts end -->
          </td>
--- 231,235 ----
            </address><!-- Created: Thu Jan 25 11:13:08 EST 2007 -->
            <!-- hhmts start -->
! Last modified: Wed Mar  7 18:25:06 EST 2007
  <!-- hhmts end -->
          </td>

From cbbrowne at lists.slony.info  Wed Mar  7 15:26:35 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Wed Mar  7 15:26:36 2007
Subject: [Slony1-commit] slony1-www/content news.txt
Message-ID: <20070307232635.320132903B4@main>

Update of /home/cvsd/slony1/slony1-www/content
In directory main:/tmp/cvs-serv20086/content

Modified Files:
	news.txt 
Log Message:
Latest downloads updated to 1.2.7


Index: news.txt
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/content/news.txt,v
retrieving revision 1.8
retrieving revision 1.9
diff -C2 -d -r1.8 -r1.9
*** news.txt	7 Mar 2007 23:24:12 -0000	1.8
--- news.txt	7 Mar 2007 23:26:33 -0000	1.9
***************
*** 4,9 ****
  2007-02-28
  Chris Browne
! Slony-1 1.2.6 <a href="http://main.slony.info/downloads/1.2/slony1-1.2.6.tar.bz2">engine</a>
! <a href="http://main.slony.info/downloads/1.2/slony1-1.2.6-docs.tar.bz2">documentation</a>
  <br />
  Slony-1 1.1.7 <a href="http://main.slony.info/downloads/1.1/slony1-1.1.7-tar.bz2">engine</a>
--- 4,9 ----
  2007-02-28
  Chris Browne
! Slony-1 1.2.7 <a href="http://main.slony.info/downloads/1.2/slony1-1.2.7.tar.bz2">engine</a>
! <a href="http://main.slony.info/downloads/1.2/slony1-1.2.7-docs.tar.bz2">documentation</a>
  <br />
  Slony-1 1.1.7 <a href="http://main.slony.info/downloads/1.1/slony1-1.1.7-tar.bz2">engine</a>

From cbbrowne at lists.slony.info  Wed Mar  7 15:28:34 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Wed Mar  7 15:28:35 2007
Subject: [Slony1-commit] slony1-www/content frontpage.txt
Message-ID: <20070307232834.E88402902E9@main>

Update of /home/cvsd/slony1/slony1-www/content
In directory main:/tmp/cvs-serv20116/content

Modified Files:
	frontpage.txt 
Log Message:
Put 1.2.7 and 1.1.7 on the real front page...


Index: frontpage.txt
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/content/frontpage.txt,v
retrieving revision 1.3
retrieving revision 1.4
diff -C2 -d -r1.3 -r1.4
*** frontpage.txt	2 Feb 2007 17:13:54 -0000	1.3
--- frontpage.txt	7 Mar 2007 23:28:32 -0000	1.4
***************
*** 1,17 ****
  ---
! Slony-I 1.2.6
! #
!           <p>At long last, here is version 1.2.6. It has many
!           enhancements as listed in the <a href=
!           "http://pgfoundry.org/frs/shownotes.php?release_id=730">Release
!           Notes</a> .</p>
  
!           <p>This has been run thru the <a href=
!           "http://linuxdatabases.info/info/releasechecklist.html">Release
!           Checklist</a></p>
  
!           <p>There are two tarballs available <a href=
!           "http://pgfoundry.org/frs/?group_id=1000122">here</a></p>
  
  ---
  Slony-I and PostgreSQL 8.1
--- 1,114 ----
  ---
! Slony-I Release - 1.2.7
! http://main.slony.info/downloads/1.2
! 2007-03-07
! Chris Browne
! We are pleased to announce the release of version 1.2.7, which may be
! found <a href="http://main.slony.info/downloads/1.2/slony1-1.2.7-tar.bz2">here</a>.  
! There is also a <a href="http://main.slony.info/downloads/1.2/slony1-1.2.7-docs-tar.bz2">Documentation tarball </a>.
  
! <P> This release fixes several problems that were found in the 1.2 stream:
! <ul>
! <li> Add remote_listen_timeout parameter to slon.conf
  
! <p> This addresses the problem where a slon times out when accessing
! sl_event if a node has been out of commission for a long time (several
! days)
! 
! <li> Resolve bug #1623
! 
! <p> In this bug, big "action lists" that need to get compressed could cause
! a logging printf to blow up.  Changed the logging level so that detail
! is only shown at level 4, which won't bite people by default.
  
+ <li> UNINSTALL NODE failures now show node # in slonik error messages
+ 
+ <P> If a user ran several UNINSTALL NODE requests in a single slonik
+ script, and one of them broke, you'd have no ready way to tell which
+ node this failed on.  Added code to report the node # where it failed.
+ 
+ <li> Added test to test1 for function generate_sync_event() and make_function_strict
+ 
+ <li> Added "v81" files (for slony1_base.v81.sql, slony1_funcs.v81.sql,
+ xxid.v81.sql), necessary to support 8.1 "ALTER FUNCTION ... STRICT";
+ 
+ <li> Fixed quoting problem in generate_sync_event()
+ 
+ <li> Added functionality to UPDATE FUNCTIONS to make xxidin() function
+ STRICT; the absence of this caused postmaster to fall over when
+ processing MOVE SET event in PG v8.2
+ 
+ <li> Added documentation of an issue surrounding NULLABLE columns to the
+ log analysis chapter of the admin guide and to the UPGRADING docs.
+ 
+ <li> When you run MOVE SET, this populates sl_setsync for the moved set
+   even on nodes that are not subscribed.  If, subsequent to doing this, 
+   you attempt a SUBSCRIBE SET for a formerly-unsubscribed node, the
+   subscription will fail right at the end when the slon tries to insert a
+   new value to sl_setsync.
+ 
+ <P>   The fix: DELETE from sl_setsync immediately before the INSERT.  This
+   will silently blow away any 'offending' sl_setsync row.
+ 
+ <p>  (As observed by Afilias staff...)
+ 
+ <li> Log shipping fix - storage of sl_setsync_offline call had a wrong
+   printf type; change from %d to %s
+ </ul>
+ ---
+ Slony-I Release - 1.1.7
+ http://main.slony.info/downloads/1.1
+ 2007-03-07
+ Chris Browne
+ We are pleased to announce the release of version 1.1.7, which may be
+ found <a href="http://main.slony.info/downloads/1.1/slony1-1.1.7-tar.bz2">here</a>.  
+ It fixes several problems that were found in the 1.2 stream that were readily back-ported to 1.1:
+ <ul>
+ <li>Add remote_listen_timeout parameter to <tt>slon.conf</tt>
+ 
+ <p> This addresses the problem where a slon times out when accessing
+ sl_event if a node has been out of commission for a long time (several
+ days)
+ 
+ <li> Add node numbers to error reports in slonik
+ 
+ <p> If portions of UNINSTALL NODE break, report in the error message which node
+ it was working on.  That way the gentle user gets an indication as to 
+ which node 'broke' if the slonik script contained multiple such
+ requests.
+ 
+ <li> Applied bug fix for #1538
+ 
+ <p> If cluster has only one node, then remove all events up to the last
+ SYNC.  That allows the cleanup loop to clear out sl_log_{1/2}.
+ Otherwise, the log tables will forever bloat until you add a second
+ node...
+ 
+ <li> Added test to test1 for function generate_sync_event() and make_function_strict
+ 
+ <li> Added "v81" files (for slony1_base.v81.sql, slony1_funcs.v81.sql,
+ xxid.v81.sql), necessary to support 8.1 "ALTER FUNCTION ... STRICT";
+ 
+ <li> Fixed quoting problem in generate_sync_event()
+ 
+ <li> Added functionality to UPDATE FUNCTIONS to make xxidin() function
+ STRICT; the absence of this caused postmaster to fall over when
+ processing MOVE SET event in PG v8.2 (not to say that Slony-I 1.1 now
+ *supports* 8.2; it does not)
+ 
+ <li> When you run MOVE SET, this populates sl_setsync for the moved set
+   even on nodes that are not subscribed.  If, subsequent to doing this, 
+   you attempt a SUBSCRIBE SET for a formerly-unsubscribed node, the
+   subscription will fail right at the end when the slon tries to insert a
+   new value to sl_setsync.
+ 
+ <p>  The fix: DELETE from sl_setsync immediately before the INSERT.  This
+   will silently blow away any 'offending' sl_setsync row.
+ 
+ <P>  (As observed by Afilias staff...)
+ 
+ <li> Log shipping fix - storage of sl_setsync_offline call had a wrong
+   printf type; change from %d to %s
+ </ul>
  ---
  Slony-I and PostgreSQL 8.1

From cbbrowne at lists.slony.info  Wed Mar  7 21:35:59 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Wed Mar  7 21:36:02 2007
Subject: [Slony1-commit] slony1-www/content frontpage.txt news.txt
Message-ID: <20070308053559.B11BD2903F9@main>

Update of /home/cvsd/slony1/slony1-www/content
In directory main:/tmp/cvs-serv21716

Modified Files:
	frontpage.txt news.txt 
Log Message:
Fix URLs to downloads


Index: frontpage.txt
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/content/frontpage.txt,v
retrieving revision 1.4
retrieving revision 1.5
diff -C2 -d -r1.4 -r1.5
*** frontpage.txt	7 Mar 2007 23:28:32 -0000	1.4
--- frontpage.txt	8 Mar 2007 05:35:57 -0000	1.5
***************
*** 5,10 ****
  Chris Browne
  We are pleased to announce the release of version 1.2.7, which may be
! found <a href="http://main.slony.info/downloads/1.2/slony1-1.2.7-tar.bz2">here</a>.  
! There is also a <a href="http://main.slony.info/downloads/1.2/slony1-1.2.7-docs-tar.bz2">Documentation tarball </a>.
  
  <P> This release fixes several problems that were found in the 1.2 stream:
--- 5,10 ----
  Chris Browne
  We are pleased to announce the release of version 1.2.7, which may be
! found <a href="http://main.slony.info/downloads/1.2/slony1-1.2.7.tar.bz2">here</a>.  
! There is also a <a href="http://main.slony.info/downloads/1.2/slony1-1.2.7-docs.tar.bz2">Documentation tarball </a>.
  
  <P> This release fixes several problems that were found in the 1.2 stream:
***************
*** 62,66 ****
  Chris Browne
  We are pleased to announce the release of version 1.1.7, which may be
! found <a href="http://main.slony.info/downloads/1.1/slony1-1.1.7-tar.bz2">here</a>.  
  It fixes several problems that were found in the 1.2 stream that were readily back-ported to 1.1:
  <ul>
--- 62,66 ----
  Chris Browne
  We are pleased to announce the release of version 1.1.7, which may be
! found <a href="http://main.slony.info/downloads/1.1/slony1-1.1.7.tar.bz2">here</a>.  
  It fixes several problems that were found in the 1.2 stream that were readily back-ported to 1.1:
  <ul>

Index: news.txt
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/content/news.txt,v
retrieving revision 1.9
retrieving revision 1.10
diff -C2 -d -r1.9 -r1.10
*** news.txt	7 Mar 2007 23:26:33 -0000	1.9
--- news.txt	8 Mar 2007 05:35:57 -0000	1.10
***************
*** 7,11 ****
  <a href="http://main.slony.info/downloads/1.2/slony1-1.2.7-docs.tar.bz2">documentation</a>
  <br />
! Slony-1 1.1.7 <a href="http://main.slony.info/downloads/1.1/slony1-1.1.7-tar.bz2">engine</a>
  <!-- Please keep this item at the top of the news list -->
  ---
--- 7,11 ----
  <a href="http://main.slony.info/downloads/1.2/slony1-1.2.7-docs.tar.bz2">documentation</a>
  <br />
! Slony-1 1.1.7 <a href="http://main.slony.info/downloads/1.1/slony1-1.1.7.tar.bz2">engine</a>
  <!-- Please keep this item at the top of the news list -->
  ---
***************
*** 15,20 ****
  Chris Browne
  We are pleased to announce the release of version 1.2.7, which may be
! found <a href="http://main.slony.info/downloads/1.2/slony1-1.2.7-tar.bz2">here</a>.  
! There is also a <a href="http://main.slony.info/downloads/1.2/slony1-1.2.7-docs-tar.bz2">Documentation tarball </a>.
  
  <P> This release fixes several problems that were found in the 1.2 stream:
--- 15,20 ----
  Chris Browne
  We are pleased to announce the release of version 1.2.7, which may be
! found <a href="http://main.slony.info/downloads/1.2/slony1-1.2.7.tar.bz2">here</a>.  
! There is also a <a href="http://main.slony.info/downloads/1.2/slony1-1.2.7-docs.tar.bz2">Documentation tarball </a>.
  
  <P> This release fixes several problems that were found in the 1.2 stream:
***************
*** 72,76 ****
  Chris Browne
  We are pleased to announce the release of version 1.1.7, which may be
! found <a href="http://main.slony.info/downloads/1.1/slony1-1.1.7-tar.bz2">here</a>.  
  It fixes several problems that were found in the 1.2 stream that were readily back-ported to 1.1:
  <ul>
--- 72,76 ----
  Chris Browne
  We are pleased to announce the release of version 1.1.7, which may be
! found <a href="http://main.slony.info/downloads/1.1/slony1-1.1.7.tar.bz2">here</a>.  
  It fixes several problems that were found in the 1.2 stream that were readily back-ported to 1.1:
  <ul>

From cbbrowne at lists.slony.info  Mon Mar 12 15:16:51 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Mon Mar 12 15:16:53 2007
Subject: [Slony1-commit] slony1-engine/tools/altperl slon-tools.pm
Message-ID: <20070312221651.A7F022902CE@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/tools/altperl
In directory main.slony.info:/tmp/cvs-serv21650

Modified Files:
	slon-tools.pm 
Log Message:
Change per Mark Stosberg to have altperl scripts support older versions
of apache rotatelogs


Index: slon-tools.pm
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tools/altperl/slon-tools.pm,v
retrieving revision 1.29
retrieving revision 1.30
diff -C2 -d -r1.29 -r1.30
*** slon-tools.pm	2 Jan 2007 20:16:58 -0000	1.29
--- slon-tools.pm	12 Mar 2007 22:16:49 -0000	1.30
***************
*** 136,140 ****
    my $cmd = "@@SLONBINDIR@@/slon -s $SYNC_CHECK_INTERVAL -d$DEBUGLEVEL $CLUSTER_NAME '$dsn' 2>&1 ";
    if ($APACHE_ROTATOR) {
!     $cmd .= "| $APACHE_ROTATOR \"$LOGDIR/slony1/node$nodenum/" .  $dbname . "_%Y-%m-%d_%H:%M:%S.log\" 10M &";
    } else {
      my $now=`date '+%Y-%m-%d_%H:%M:%S'`;
--- 136,140 ----
    my $cmd = "@@SLONBINDIR@@/slon -s $SYNC_CHECK_INTERVAL -d$DEBUGLEVEL $CLUSTER_NAME '$dsn' 2>&1 ";
    if ($APACHE_ROTATOR) {
!     $cmd .= "| $APACHE_ROTATOR \"$LOGDIR/slony1/node$nodenum/" .  $dbname . "_%Y-%m.log\" 86400 &";
    } else {
      my $now=`date '+%Y-%m-%d_%H:%M:%S'`;

From cbbrowne at lists.slony.info  Mon Mar 12 15:17:21 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Mon Mar 12 15:17:23 2007
Subject: [Slony1-commit] slony1-engine/tools/altperl slon-tools.pm
Message-ID: <20070312221721.D45762903DF@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/tools/altperl
In directory main.slony.info:/tmp/cvs-serv21682/tools/altperl

Modified Files:
      Tag: REL_1_2_STABLE
	slon-tools.pm 
Log Message:
Change per Mark Stosberg to have altperl scripts support older versions
of apache rotatelogs


Index: slon-tools.pm
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tools/altperl/slon-tools.pm,v
retrieving revision 1.26.2.2
retrieving revision 1.26.2.3
diff -C2 -d -r1.26.2.2 -r1.26.2.3
*** slon-tools.pm	6 Dec 2006 18:38:41 -0000	1.26.2.2
--- slon-tools.pm	12 Mar 2007 22:17:19 -0000	1.26.2.3
***************
*** 136,140 ****
    my $cmd = "@@SLONBINDIR@@/slon -s $SYNC_CHECK_INTERVAL -d2 $CLUSTER_NAME '$dsn' 2>&1 ";
    if ($APACHE_ROTATOR) {
!     $cmd .= "| $APACHE_ROTATOR \"$LOGDIR/slony1/node$nodenum/" .  $dbname . "_%Y-%m-%d_%H:%M:%S.log\" 10M &";
    } else {
      my $now=`date '+%Y-%m-%d_%H:%M:%S'`;
--- 136,140 ----
    my $cmd = "@@SLONBINDIR@@/slon -s $SYNC_CHECK_INTERVAL -d2 $CLUSTER_NAME '$dsn' 2>&1 ";
    if ($APACHE_ROTATOR) {
!     $cmd .= "| $APACHE_ROTATOR \"$LOGDIR/slony1/node$nodenum/" .  $dbname . "_%Y-%m.log\" 86400 &";
    } else {
      my $now=`date '+%Y-%m-%d_%H:%M:%S'`;

From cbbrowne at lists.slony.info  Mon Mar 12 15:17:21 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Mon Mar 12 15:17:23 2007
Subject: [Slony1-commit] slony1-engine RELEASE-1.2.8 configure
Message-ID: <20070312221722.2C9D22903FB@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine
In directory main.slony.info:/tmp/cvs-serv21682

Modified Files:
      Tag: REL_1_2_STABLE
	configure 
Added Files:
      Tag: REL_1_2_STABLE
	RELEASE-1.2.8 
Log Message:
Change per Mark Stosberg to have altperl scripts support older versions
of apache rotatelogs


Index: configure
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/configure,v
retrieving revision 1.70.2.2
retrieving revision 1.70.2.3
diff -C2 -d -r1.70.2.2 -r1.70.2.3
*** configure	31 Oct 2006 22:03:40 -0000	1.70.2.2
--- configure	12 Mar 2007 22:17:19 -0000	1.70.2.3
***************
*** 1,5 ****
  #! /bin/sh
  # Guess values for system-dependent variables and create Makefiles.
! # Generated by GNU Autoconf 2.60a for postgresql-slony1-engine 1.2.STABLE.
  #
  # Copyright (C) 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001,
--- 1,5 ----
  #! /bin/sh
  # Guess values for system-dependent variables and create Makefiles.
! # Generated by GNU Autoconf 2.61 for postgresql-slony1-engine 1.2.STABLE.
  #
[...4219 lines suppressed...]
    CONFIG_FILES    = $CONFIG_FILES
--- 11090,11094 ----
  ac_log="
  This file was extended by postgresql-slony1-engine $as_me 1.2.STABLE, which was
! generated by GNU Autoconf 2.61.  Invocation command line was
  
    CONFIG_FILES    = $CONFIG_FILES
***************
*** 12406,12410 ****
  ac_cs_version="\\
  postgresql-slony1-engine config.status 1.2.STABLE
! configured by $0, generated by GNU Autoconf 2.60a,
    with options \\"`echo "$ac_configure_args" | sed 's/^ //; s/[\\""\`\$]/\\\\&/g'`\\"
  
--- 11139,11143 ----
  ac_cs_version="\\
  postgresql-slony1-engine config.status 1.2.STABLE
! configured by $0, generated by GNU Autoconf 2.61,
    with options \\"`echo "$ac_configure_args" | sed 's/^ //; s/[\\""\`\$]/\\\\&/g'`\\"
  

--- NEW FILE: RELEASE-1.2.8 ---
$Id: RELEASE-1.2.8,v 1.1.2.1 2007-03-12 22:17:19 cbbrowne Exp $

- Change to rotatelogs configuration to support older versions of Apache
log rotator

From cbbrowne at lists.slony.info  Mon Mar 12 15:17:56 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Mon Mar 12 15:17:57 2007
Subject: [Slony1-commit] slony1-engine/tools/altperl slon-tools.pm
Message-ID: <20070312221756.EAE362903DF@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/tools/altperl
In directory main.slony.info:/tmp/cvs-serv21715/tools/altperl

Modified Files:
      Tag: REL_1_1_STABLE
	slon-tools.pm 
Log Message:
Change per Mark Stosberg to have altperl scripts support older versions
of apache rotatelogs


Index: slon-tools.pm
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tools/altperl/slon-tools.pm,v
retrieving revision 1.23.2.1
retrieving revision 1.23.2.2
diff -C2 -d -r1.23.2.1 -r1.23.2.2
*** slon-tools.pm	25 Jul 2005 21:49:38 -0000	1.23.2.1
--- slon-tools.pm	12 Mar 2007 22:17:54 -0000	1.23.2.2
***************
*** 139,143 ****
    my $cmd = "@@PGBINDIR@@/slon -s $SYNC_CHECK_INTERVAL -d2 $CLUSTER_NAME '$dsn' 2>&1 ";
    if ($APACHE_ROTATOR) {
!     $cmd .= "| $APACHE_ROTATOR \"$LOGDIR/slony1/node$nodenum/" .  $dbname . "_%Y-%m-%d_%H:%M:%S.log\" 10M &";
    } else {
      my $now=`date '+%Y-%m-%d_%H:%M:%S'`;
--- 139,143 ----
    my $cmd = "@@PGBINDIR@@/slon -s $SYNC_CHECK_INTERVAL -d2 $CLUSTER_NAME '$dsn' 2>&1 ";
    if ($APACHE_ROTATOR) {
!     $cmd .= "| $APACHE_ROTATOR \"$LOGDIR/slony1/node$nodenum/" .  $dbname . "_%Y-%m.log\" 86400 &";
    } else {
      my $now=`date '+%Y-%m-%d_%H:%M:%S'`;

From cbbrowne at lists.slony.info  Mon Mar 12 15:17:56 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Mon Mar 12 15:17:57 2007
Subject: [Slony1-commit] slony1-engine RELEASE-1.1.8
Message-ID: <20070312221756.D4DBA290016@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine
In directory main.slony.info:/tmp/cvs-serv21715

Added Files:
      Tag: REL_1_1_STABLE
	RELEASE-1.1.8 
Log Message:
Change per Mark Stosberg to have altperl scripts support older versions
of apache rotatelogs


--- NEW FILE: RELEASE-1.1.8 ---
$Id: RELEASE-1.1.8,v 1.1.2.1 2007-03-12 22:17:54 cbbrowne Exp $

- Change to rotatelogs configuration to support older versions of Apache
log rotator

From cbbrowne at lists.slony.info  Tue Mar 13 08:35:15 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Mar 13 08:35:17 2007
Subject: [Slony1-commit] slony1-engine/tools/altperl slonik_execute_script.pl
Message-ID: <20070313153515.3F887290048@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/tools/altperl
In directory main.slony.info:/tmp/cvs-serv32653/tools/altperl

Modified Files:
	slonik_execute_script.pl 
Log Message:
Fix to altperl script "slonik_execute_script.pl" to properly access the
requested file, per Bernd Helmle


Index: slonik_execute_script.pl
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tools/altperl/slonik_execute_script.pl,v
retrieving revision 1.2
retrieving revision 1.3
diff -C2 -d -r1.2 -r1.3
*** slonik_execute_script.pl	27 Oct 2006 17:52:10 -0000	1.2
--- slonik_execute_script.pl	13 Mar 2007 15:35:13 -0000	1.3
***************
*** 72,75 ****
--- 72,76 ----
  	die $USAGE;
      }
+     $filename = $file
  }
  elsif ($SCRIPT_ARG) {

From cbbrowne at lists.slony.info  Tue Mar 13 08:35:32 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Mar 13 08:35:33 2007
Subject: [Slony1-commit] slony1-engine/tools/altperl slonik_execute_script.pl
Message-ID: <20070313153532.51655290048@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/tools/altperl
In directory main.slony.info:/tmp/cvs-serv32679/tools/altperl

Modified Files:
      Tag: REL_1_2_STABLE
	slonik_execute_script.pl 
Log Message:
Fix to altperl script "slonik_execute_script.pl" to properly access the
requested file, per Bernd Helmle



Index: slonik_execute_script.pl
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tools/altperl/slonik_execute_script.pl,v
retrieving revision 1.1.4.1
retrieving revision 1.1.4.2
diff -C2 -d -r1.1.4.1 -r1.1.4.2
*** slonik_execute_script.pl	27 Oct 2006 17:54:21 -0000	1.1.4.1
--- slonik_execute_script.pl	13 Mar 2007 15:35:30 -0000	1.1.4.2
***************
*** 72,75 ****
--- 72,76 ----
  	die $USAGE;
      }
+     $filename = $file
  }
  elsif ($SCRIPT_ARG) {

From cbbrowne at lists.slony.info  Tue Mar 13 08:35:32 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Mar 13 08:35:33 2007
Subject: [Slony1-commit] slony1-engine RELEASE-1.2.8
Message-ID: <20070313153532.664F929004F@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine
In directory main.slony.info:/tmp/cvs-serv32679

Modified Files:
      Tag: REL_1_2_STABLE
	RELEASE-1.2.8 
Log Message:
Fix to altperl script "slonik_execute_script.pl" to properly access the
requested file, per Bernd Helmle



Index: RELEASE-1.2.8
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/Attic/RELEASE-1.2.8,v
retrieving revision 1.1.2.1
retrieving revision 1.1.2.2
diff -C2 -d -r1.1.2.1 -r1.1.2.2
*** RELEASE-1.2.8	12 Mar 2007 22:17:19 -0000	1.1.2.1
--- RELEASE-1.2.8	13 Mar 2007 15:35:30 -0000	1.1.2.2
***************
*** 3,4 ****
--- 3,6 ----
  - Change to rotatelogs configuration to support older versions of Apache
  log rotator
+ 
+ - Fix to altperl "execute script" script to pass the filename properly
\ No newline at end of file

From cbbrowne at lists.slony.info  Tue Mar 13 08:35:46 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Mar 13 08:35:47 2007
Subject: [Slony1-commit] slony1-engine/tools/altperl slonik_execute_script.pl
Message-ID: <20070313153546.0BB5E2903F6@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/tools/altperl
In directory main.slony.info:/tmp/cvs-serv32701/tools/altperl

Modified Files:
      Tag: REL_1_1_STABLE
	slonik_execute_script.pl 
Log Message:
Fix to altperl script "slonik_execute_script.pl" to properly access the
requested file, per Bernd Helmle



Index: slonik_execute_script.pl
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tools/altperl/slonik_execute_script.pl,v
retrieving revision 1.1
retrieving revision 1.1.2.1
diff -C2 -d -r1.1 -r1.1.2.1
*** slonik_execute_script.pl	31 May 2005 16:11:05 -0000	1.1
--- slonik_execute_script.pl	13 Mar 2007 15:35:43 -0000	1.1.2.1
***************
*** 72,75 ****
--- 72,76 ----
      $file = "/tmp/execute_script.sql.$$";
      my $fh;
+     $filename = $file
      open $fh, ">", $file;
      print $fh $SCRIPT_ARG;

From cbbrowne at lists.slony.info  Tue Mar 13 08:35:46 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Mar 13 08:35:47 2007
Subject: [Slony1-commit] slony1-engine RELEASE-1.1.8
Message-ID: <20070313153546.12699290433@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine
In directory main.slony.info:/tmp/cvs-serv32701

Modified Files:
      Tag: REL_1_1_STABLE
	RELEASE-1.1.8 
Log Message:
Fix to altperl script "slonik_execute_script.pl" to properly access the
requested file, per Bernd Helmle



Index: RELEASE-1.1.8
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/Attic/RELEASE-1.1.8,v
retrieving revision 1.1.2.1
retrieving revision 1.1.2.2
diff -C2 -d -r1.1.2.1 -r1.1.2.2
*** RELEASE-1.1.8	12 Mar 2007 22:17:54 -0000	1.1.2.1
--- RELEASE-1.1.8	13 Mar 2007 15:35:43 -0000	1.1.2.2
***************
*** 3,4 ****
--- 3,6 ----
  - Change to rotatelogs configuration to support older versions of Apache
  log rotator
+ 
+ - Fix to altperl "execute script" script to pass the filename properly
\ No newline at end of file

From cbbrowne at lists.slony.info  Tue Mar 13 08:56:24 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Mar 13 08:56:26 2007
Subject: [Slony1-commit] slony1-engine/src/xxid Makefile
Message-ID: <20070313155624.A96DD290440@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/src/xxid
In directory main.slony.info:/tmp/cvs-serv350/src/xxid

Modified Files:
      Tag: REL_1_1_STABLE
	Makefile 
Log Message:
Revert back for xxid.v73.sql to be the "master" xxid.*.sql file; this
is true for the 1.1 branch; only in 1.2 and higher is v74 the minimum
PostgreSQL version.


Index: Makefile
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/xxid/Makefile,v
retrieving revision 1.17.2.2
retrieving revision 1.17.2.3
diff -C2 -d -r1.17.2.2 -r1.17.2.3
*** Makefile	7 Feb 2007 19:18:49 -0000	1.17.2.2
--- Makefile	13 Mar 2007 15:56:22 -0000	1.17.2.3
***************
*** 18,26 ****
  NAME		= xxid
  
  SQL_NAME74	= $(NAME).v74.sql
  SQL_NAME80	= $(NAME).v80.sql
  SQL_NAME81	= $(NAME).v81.sql
  SQL_NAMES	= $(SQL_NAME74) $(SQL_NAME80) $(SQL_NAME81)
! GENSQLNAMES = $(filter-out $(SQL_NAME74), $(SQL_NAMES))
  
  SO_OBJS		= xxid.o $(WIN32RES)
--- 18,27 ----
  NAME		= xxid
  
+ SQL_NAME73	= $(NAME).v73.sql
  SQL_NAME74	= $(NAME).v74.sql
  SQL_NAME80	= $(NAME).v80.sql
  SQL_NAME81	= $(NAME).v81.sql
  SQL_NAMES	= $(SQL_NAME74) $(SQL_NAME80) $(SQL_NAME81)
! GENSQLNAMES = $(filter-out $(SQL_NAME73), $(SQL_NAMES))
  
  SO_OBJS		= xxid.o $(WIN32RES)
***************
*** 30,37 ****
  	$(SQL_NAMES)		\
  
! DISTFILES = Makefile xxid.c xxid.v74.sql
  
  all:	$(ALL)
  
  $(SQL_NAME80):	$(SQL_NAME74)
  	cp $< $@
--- 31,41 ----
  	$(SQL_NAMES)		\
  
! DISTFILES = Makefile xxid.c xxid.v73.sql
  
  all:	$(ALL)
  
+ $(SQL_NAME74):	$(SQL_NAME73)
+ 	cp $< $@
+ 
  $(SQL_NAME80):	$(SQL_NAME74)
  	cp $< $@
***************
*** 52,56 ****
  	done
  
- 
  installdirs:
  	$(mkinstalldirs) $(DESTDIR)$(pgpkglibdir)
--- 56,59 ----

From cbbrowne at lists.slony.info  Tue Mar 13 08:56:24 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Mar 13 08:56:26 2007
Subject: [Slony1-commit] slony1-engine RELEASE-1.1.8
Message-ID: <20070313155624.9749B290433@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine
In directory main.slony.info:/tmp/cvs-serv350

Modified Files:
      Tag: REL_1_1_STABLE
	RELEASE-1.1.8 
Log Message:
Revert back for xxid.v73.sql to be the "master" xxid.*.sql file; this
is true for the 1.1 branch; only in 1.2 and higher is v74 the minimum
PostgreSQL version.


Index: RELEASE-1.1.8
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/Attic/RELEASE-1.1.8,v
retrieving revision 1.1.2.2
retrieving revision 1.1.2.3
diff -C2 -d -r1.1.2.2 -r1.1.2.3
*** RELEASE-1.1.8	13 Mar 2007 15:35:43 -0000	1.1.2.2
--- RELEASE-1.1.8	13 Mar 2007 15:56:22 -0000	1.1.2.3
***************
*** 4,6 ****
  log rotator
  
! - Fix to altperl "execute script" script to pass the filename properly
\ No newline at end of file
--- 4,9 ----
  log rotator
  
! - Fix to altperl "execute script" script to pass the filename properly
! 
! - Fix to xxid Makefile: in the 1.1 branch, xxid.v73.sql is still in
! use, and should be copied to generate the other versions.

From cbbrowne at lists.slony.info  Tue Mar 13 09:04:08 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Mar 13 09:04:09 2007
Subject: [Slony1-commit] slony1-engine/doc/adminguide firstdb.sgml
Message-ID: <20070313160408.E5C3D2903EE@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/doc/adminguide
In directory main.slony.info:/tmp/cvs-serv515/doc/adminguide

Modified Files:
      Tag: REL_1_1_STABLE
	firstdb.sgml 
Log Message:
Remove STORE LISTEN requests from sample, as mentioned by Joseph
Shraibman.  The need to put these into your scripts should now indeed
be obsolete.


Index: firstdb.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/firstdb.sgml,v
retrieving revision 1.13.2.1
retrieving revision 1.13.2.2
diff -C2 -d -r1.13.2.1 -r1.13.2.2
*** firstdb.sgml	9 Dec 2005 22:21:52 -0000	1.13.2.1
--- firstdb.sgml	13 Mar 2007 16:04:06 -0000	1.13.2.2
***************
*** 200,205 ****
  	store path (server = 1, client = 2, conninfo='dbname=$MASTERDBNAME host=$MASTERHOST user=$REPLICATIONUSER');
  	store path (server = 2, client = 1, conninfo='dbname=$SLAVEDBNAME host=$SLAVEHOST user=$REPLICATIONUSER');
- 	store listen (origin=1, provider = 1, receiver =2);
- 	store listen (origin=2, provider = 2, receiver =1);
  _EOF_
  </programlisting></para>
--- 200,203 ----

From cbbrowne at lists.slony.info  Tue Mar 13 09:04:48 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Mar 13 09:04:49 2007
Subject: [Slony1-commit] slony1-engine/doc/adminguide firstdb.sgml
Message-ID: <20070313160448.8A1DE290048@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/doc/adminguide
In directory main.slony.info:/tmp/cvs-serv570/doc/adminguide

Modified Files:
      Tag: REL_1_2_STABLE
	firstdb.sgml 
Log Message:
Remove STORE LISTEN requests from sample, as mentioned by Joseph
Shraibman.  The need to put these into your scripts should now indeed
be obsolete.



Index: firstdb.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/firstdb.sgml,v
retrieving revision 1.20
retrieving revision 1.20.2.1
diff -C2 -d -r1.20 -r1.20.2.1
*** firstdb.sgml	2 Aug 2006 18:34:58 -0000	1.20
--- firstdb.sgml	13 Mar 2007 16:04:46 -0000	1.20.2.1
***************
*** 200,205 ****
  	store path (server = 1, client = 2, conninfo='dbname=$MASTERDBNAME host=$MASTERHOST user=$REPLICATIONUSER');
  	store path (server = 2, client = 1, conninfo='dbname=$SLAVEDBNAME host=$SLAVEHOST user=$REPLICATIONUSER');
- 	store listen (origin=1, provider = 1, receiver =2);
- 	store listen (origin=2, provider = 2, receiver =1);
  _EOF_
  </programlisting></para>
--- 200,203 ----

From cbbrowne at lists.slony.info  Tue Mar 13 09:06:30 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Mar 13 09:06:31 2007
Subject: [Slony1-commit] slony1-engine/doc/adminguide firstdb.sgml
Message-ID: <20070313160630.937AC2902CE@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/doc/adminguide
In directory main.slony.info:/tmp/cvs-serv610/doc/adminguide

Modified Files:
	firstdb.sgml 
Log Message:
Remove STORE LISTEN requests from sample, as mentioned by Joseph
Shraibman.  The need to put these into your scripts should now indeed
be obsolete.



Index: firstdb.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/firstdb.sgml,v
retrieving revision 1.22
retrieving revision 1.23
diff -C2 -d -r1.22 -r1.23
*** firstdb.sgml	18 Feb 2007 21:17:57 -0000	1.22
--- firstdb.sgml	13 Mar 2007 16:06:28 -0000	1.23
***************
*** 238,243 ****
  	store path (server = 1, client = 2, conninfo='dbname=$MASTERDBNAME host=$MASTERHOST user=$REPLICATIONUSER');
  	store path (server = 2, client = 1, conninfo='dbname=$SLAVEDBNAME host=$SLAVEHOST user=$REPLICATIONUSER');
- 	store listen (origin=1, provider = 1, receiver =2);
- 	store listen (origin=2, provider = 2, receiver =1);
  _EOF_
  </programlisting>
--- 238,241 ----

From cbbrowne at lists.slony.info  Tue Mar 13 12:27:22 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Mar 13 12:27:24 2007
Subject: [Slony1-commit] slony1-engine/src/backend slony1_funcs.v80.sql
Message-ID: <20070313192722.864C729045D@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/src/backend
In directory main.slony.info:/tmp/cvs-serv2039/src/backend

Modified Files:
      Tag: REL_1_2_STABLE
	slony1_funcs.v80.sql 
Log Message:
Fix typo in function name in PG v8.0 script

As observed by Joseph Shraibman


Index: slony1_funcs.v80.sql
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/backend/slony1_funcs.v80.sql,v
retrieving revision 1.2.2.3
retrieving revision 1.2.2.4
diff -C2 -d -r1.2.2.3 -r1.2.2.4
*** slony1_funcs.v80.sql	8 Feb 2007 22:57:28 -0000	1.2.2.3
--- slony1_funcs.v80.sql	13 Mar 2007 19:27:20 -0000	1.2.2.4
***************
*** 125,128 ****
  ' language plpgsql;
  
! comment on function @NAMESPACE@.make_table_strict (text, text) is
  'Equivalent to 8.1+ ALTER FUNCTION ... STRICT';
--- 125,128 ----
  ' language plpgsql;
  
! comment on function @NAMESPACE@.make_function_strict (text, text) is
  'Equivalent to 8.1+ ALTER FUNCTION ... STRICT';

From cbbrowne at lists.slony.info  Tue Mar 13 12:27:22 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Mar 13 12:27:24 2007
Subject: [Slony1-commit] slony1-engine RELEASE-1.2.8
Message-ID: <20070313192722.77AAA29045C@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine
In directory main.slony.info:/tmp/cvs-serv2039

Modified Files:
      Tag: REL_1_2_STABLE
	RELEASE-1.2.8 
Log Message:
Fix typo in function name in PG v8.0 script

As observed by Joseph Shraibman


Index: RELEASE-1.2.8
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/Attic/RELEASE-1.2.8,v
retrieving revision 1.1.2.2
retrieving revision 1.1.2.3
diff -C2 -d -r1.1.2.2 -r1.1.2.3
*** RELEASE-1.2.8	13 Mar 2007 15:35:30 -0000	1.1.2.2
--- RELEASE-1.2.8	13 Mar 2007 19:27:20 -0000	1.1.2.3
***************
*** 4,6 ****
  log rotator
  
! - Fix to altperl "execute script" script to pass the filename properly
\ No newline at end of file
--- 4,8 ----
  log rotator
  
! - Fix to altperl "execute script" script to pass the filename properly
! 
! - Fix to src/backend/slony1_funcs.v80.sql - comment on the right function in v8.0
\ No newline at end of file

From cbbrowne at lists.slony.info  Tue Mar 13 13:05:30 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Mar 13 13:05:31 2007
Subject: [Slony1-commit] slony1-engine/src/backend slony1_funcs.v80.sql
Message-ID: <20070313200530.83FB9290448@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/src/backend
In directory main.slony.info:/tmp/cvs-serv2252/src/backend

Modified Files:
      Tag: REL_1_1_STABLE
	slony1_funcs.v80.sql 
Log Message:
Fix typo in function name in PG v8.0 script

As observed by Joseph Shraibman


Index: slony1_funcs.v80.sql
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/backend/slony1_funcs.v80.sql,v
retrieving revision 1.1.2.3
retrieving revision 1.1.2.4
diff -C2 -d -r1.1.2.3 -r1.1.2.4
*** slony1_funcs.v80.sql	8 Feb 2007 22:52:40 -0000	1.1.2.3
--- slony1_funcs.v80.sql	13 Mar 2007 20:05:28 -0000	1.1.2.4
***************
*** 124,127 ****
  ' language plpgsql;
  
! comment on function @NAMESPACE@.make_table_strict (text, text) is
  'Equivalent to 8.1+ ALTER FUNCTION ... STRICT';
--- 124,127 ----
  ' language plpgsql;
  
! comment on function @NAMESPACE@.make_function_strict (text, text) is
  'Equivalent to 8.1+ ALTER FUNCTION ... STRICT';

From cbbrowne at lists.slony.info  Tue Mar 13 13:05:30 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Mar 13 13:05:32 2007
Subject: [Slony1-commit] slony1-engine RELEASE-1.1.8
Message-ID: <20070313200530.78689290432@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine
In directory main.slony.info:/tmp/cvs-serv2252

Modified Files:
      Tag: REL_1_1_STABLE
	RELEASE-1.1.8 
Log Message:
Fix typo in function name in PG v8.0 script

As observed by Joseph Shraibman


Index: RELEASE-1.1.8
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/Attic/RELEASE-1.1.8,v
retrieving revision 1.1.2.3
retrieving revision 1.1.2.4
diff -C2 -d -r1.1.2.3 -r1.1.2.4
*** RELEASE-1.1.8	13 Mar 2007 15:56:22 -0000	1.1.2.3
--- RELEASE-1.1.8	13 Mar 2007 20:05:28 -0000	1.1.2.4
***************
*** 8,9 ****
--- 8,11 ----
  - Fix to xxid Makefile: in the 1.1 branch, xxid.v73.sql is still in
  use, and should be copied to generate the other versions.
+ 
+ - Fix to src/backend/slony1_funcs.v80.sql - comment on the right function in v8.0
\ No newline at end of file

From cbbrowne at lists.slony.info  Tue Mar 13 14:00:13 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Mar 13 14:00:14 2007
Subject: [Slony1-commit] slony1-engine/doc/adminguide addthings.sgml
Message-ID: <20070313210013.2F035290432@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/doc/adminguide
In directory main.slony.info:/tmp/cvs-serv2504

Modified Files:
	addthings.sgml 
Log Message:
addthings section should make mention of altperl script that wraps
EXECUTE SCRIPT, per Mark Stosberg...


Index: addthings.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/addthings.sgml,v
retrieving revision 1.26
retrieving revision 1.27
diff -C2 -d -r1.26 -r1.27
*** addthings.sgml	7 Nov 2006 20:34:38 -0000	1.26
--- addthings.sgml	13 Mar 2007 21:00:11 -0000	1.27
***************
*** 135,138 ****
--- 135,149 ----
  linkend="stmtddlscript">.</para>
  
+ <para> Alternatively, if you have the <link linkend="altperl"> altperl
+ scripts </link> installed, you may use
+ <command>slonik_execute_script</command> for this purpose: </para>
+ 
+ <para> <command> slonik_execute_script [options] set#
+ full_path_to_sql_script_file </command></para>
+ 
+ <para> See <command>slonik_execute_script -h</command> for further
+ options; note that this uses <xref linkend="stmtddlscript">
+ underneath. </para>
+ 
  <para> There are a number of <quote>sharp edges</quote> to note...</para>
  

From cbbrowne at lists.slony.info  Wed Mar 14 08:53:19 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Wed Mar 14 08:53:20 2007
Subject: [Slony1-commit] slony1-engine/src/backend slony1_funcs.v74.sql
Message-ID: <20070314155319.111FE2902E8@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/src/backend
In directory main.slony.info:/tmp/cvs-serv8549/src/backend

Modified Files:
	slony1_funcs.v74.sql 
Log Message:
Fixes to "make functions strict" that were applied earlier to 1.1 and
1.2 branches


Index: slony1_funcs.v74.sql
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/backend/slony1_funcs.v74.sql,v
retrieving revision 1.9
retrieving revision 1.10
diff -C2 -d -r1.9 -r1.10
*** slony1_funcs.v74.sql	8 Feb 2007 18:01:15 -0000	1.9
--- slony1_funcs.v74.sql	14 Mar 2007 15:53:16 -0000	1.10
***************
*** 103,113 ****
  'Returns 1 or 0 based on whether or not the DB is running a
  version earlier than 7.4';
- 
  create or replace function @NAMESPACE@.make_function_strict (text, text) returns void as
  '
     update "pg_catalog"."pg_proc" set proisstrict = ''t'' where 
!      proname = $1 and pronamespace = (select oid from "pg_catalog"."pg_namespace" where nspname = '@NAMESPACE@') and prolang = (select oid from "pg_catalog"."pg_language" where lanname = ''c'');
  ' language sql;
  
  comment on function @NAMESPACE@.make_function_strict (text, text) is
! 'Equivalent to 8.1+ ALTER FUNCTION ... STRICT';
\ No newline at end of file
--- 103,112 ----
  'Returns 1 or 0 based on whether or not the DB is running a
  version earlier than 7.4';
  create or replace function @NAMESPACE@.make_function_strict (text, text) returns void as
  '
     update "pg_catalog"."pg_proc" set proisstrict = ''t'' where 
!            proname = $1 and pronamespace = (select oid from "pg_catalog"."pg_namespace" where nspname = ''_@CLUSTERNAME@'') and prolang = (select oid from "pg_catalog"."pg_language" where lanname = ''c'');
  ' language sql;
  
  comment on function @NAMESPACE@.make_function_strict (text, text) is
! 'Equivalent to 8.1+ ALTER FUNCTION ... STRICT';

From cbbrowne at lists.slony.info  Wed Mar 14 08:53:19 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Wed Mar 14 08:53:21 2007
Subject: [Slony1-commit] slony1-engine/tests/test1 generate_dml.sh
Message-ID: <20070314155319.1C7D32903F0@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/tests/test1
In directory main.slony.info:/tmp/cvs-serv8549/tests/test1

Modified Files:
	generate_dml.sh 
Log Message:
Fixes to "make functions strict" that were applied earlier to 1.1 and
1.2 branches


Index: generate_dml.sh
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tests/test1/generate_dml.sh,v
retrieving revision 1.12
retrieving revision 1.13
diff -C2 -d -r1.12 -r1.13
*** generate_dml.sh	8 Feb 2007 22:50:02 -0000	1.12
--- generate_dml.sh	14 Mar 2007 15:53:17 -0000	1.13
***************
*** 83,90 ****
    fi
    status "completed generate_sync_event() test"
!   $pgbindir/psql -h $host -p $port -d $db -U $user -c "select \"_${CLUSTER1}\".make_function_strict('xxidin', '(cstring)');" 1> $mktmp/gensync.log.1 2> $mktmp/gensync.log
    rc=$?
    if [ $rc -ne 0 ]; then
!       warn 3 "make_function_strict('xxidin', '(cstring)') failed - rc=${rc} see $mktmp/gensync.log* for details"
    fi
    status "completed make_function_strict() test"
--- 83,90 ----
    fi
    status "completed generate_sync_event() test"
!   $pgbindir/psql -h $host -p $port -d $db -U $user -c "select \"_${CLUSTER1}\".make_function_strict('xxidin', '(cstring)');" 1> $mktmp/mkfunstrict.log.1 2> $mktmp/mkfunstrict.log
    rc=$?
    if [ $rc -ne 0 ]; then
!       warn 3 "make_function_strict('xxidin', '(cstring)') failed - rc=${rc} see $mktmp/mkfunstrict.log for details"
    fi
    status "completed make_function_strict() test"

From cbbrowne at lists.slony.info  Wed Mar 14 08:54:09 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Wed Mar 14 08:54:11 2007
Subject: [Slony1-commit] slony1-engine/tests/testutf8 init_schema.sql
Message-ID: <20070314155409.B85352902E8@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/tests/testutf8
In directory main.slony.info:/tmp/cvs-serv8593/tests/testutf8

Modified Files:
	init_schema.sql 
Log Message:
Change UTF8 test to use a serial column rather than forcing a specially
named sequence on it.


Index: init_schema.sql
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tests/testutf8/init_schema.sql,v
retrieving revision 1.2
retrieving revision 1.3
diff -C2 -d -r1.2 -r1.3
*** init_schema.sql	8 Dec 2005 23:08:29 -0000	1.2
--- init_schema.sql	14 Mar 2007 15:54:07 -0000	1.3
***************
*** 22,28 ****
  -- Table to perform UTF8 tests (checks multibyte; should be helpful in
  -- preventing problems with Asian character sets too)
- CREATE SEQUENCE utf8_id;
  CREATE TABLE utf8table (
!     id integer not null unique default nextval('utf8_id'),
      string text,
      primary key(id)
--- 22,27 ----
  -- Table to perform UTF8 tests (checks multibyte; should be helpful in
  -- preventing problems with Asian character sets too)
  CREATE TABLE utf8table (
!     id serial,
      string text,
      primary key(id)

From cbbrowne at lists.slony.info  Wed Mar 14 08:55:08 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Wed Mar 14 08:55:09 2007
Subject: [Slony1-commit] slony1-engine/src/slon remote_worker.c
Message-ID: <20070314155508.8513D2902E8@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/src/slon
In directory main.slony.info:/tmp/cvs-serv8610/src/slon

Modified Files:
	remote_worker.c 
Log Message:
Fix log shipping bug - setting the initial offline SetSYNC value had
a %d in the printf rather than %s


Index: remote_worker.c
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/slon/remote_worker.c,v
retrieving revision 1.134
retrieving revision 1.135
diff -C2 -d -r1.134 -r1.135
*** remote_worker.c	28 Feb 2007 22:09:20 -0000	1.134
--- remote_worker.c	14 Mar 2007 15:55:06 -0000	1.135
***************
*** 3888,3892 ****
  		slon_mkquery(&lsquery,
  			     "insert into %s.sl_setsync_offline (ssy_setid, ssy_seqno) "
! 			     "values ('%d', '%d');",
  			     rtcfg_namespace, set_id, ssy_seqno);
  		rc = archive_append_ds(node, &lsquery);
--- 3888,3892 ----
  		slon_mkquery(&lsquery,
  			     "insert into %s.sl_setsync_offline (ssy_setid, ssy_seqno) "
! 			     "values ('%d', '%s');",
  			     rtcfg_namespace, set_id, ssy_seqno);
  		rc = archive_append_ds(node, &lsquery);

From cbbrowne at lists.slony.info  Wed Mar 14 08:59:34 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Wed Mar 14 08:59:37 2007
Subject: [Slony1-commit] slony1-engine/src/backend slony1_funcs.sql
Message-ID: <20070314155934.61CD12903F0@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/src/backend
In directory main.slony.info:/tmp/cvs-serv8627/src/backend

Modified Files:
	slony1_funcs.sql 
Log Message:
Reduce the quantity of spurious events generated:

1.  generate_sync_event() only needs to generate a SYNC on a node
    that is the origin for a set

2.  sync thread generates a SYNC when it starts; in later iterations,
    it will only generate a SYNC for its node if that node is the origin
    for a replication set

Per discussions with Jan Wieck on 2007-02-09; this seemed an experiment
worth trying.  I tried it, and the tests run fine, so I'm committing this.


Index: slony1_funcs.sql
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/backend/slony1_funcs.sql,v
retrieving revision 1.104
retrieving revision 1.105
diff -C2 -d -r1.104 -r1.105
*** slony1_funcs.sql	8 Feb 2007 18:01:15 -0000	1.104
--- slony1_funcs.sql	14 Mar 2007 15:59:32 -0000	1.105
***************
*** 5223,5227 ****
  	if not found then
  		-- If there has been no SYNC in the last interval, then push one
! 		perform @NAMESPACE@.createEvent(''_@CLUSTERNAME@'', ''SYNC'', NULL);
  		return 1;
  	else
--- 5223,5229 ----
  	if not found then
  		-- If there has been no SYNC in the last interval, then push one
! 		perform @NAMESPACE@.createEvent(''_@CLUSTERNAME@'', ''SYNC'', NULL) 
!                                          from @NAMESPACE@.sl_node n where no_id = @NAMESPACE@.getLocalNodeId(''_@CLUSTERNAME@'') 
! 			and exists (select 1 from @NAMESPACE@.sl_set where set_origin = no_id);
  		return 1;
  	else
***************
*** 5232,5236 ****
  
  comment on function @NAMESPACE@.generate_sync_event(interval) is
!   'Generate a sync event if there has not been one in the requested interval.';
  
  -- ----------------------------------------------------------------------
--- 5234,5238 ----
  
  comment on function @NAMESPACE@.generate_sync_event(interval) is
!   'Generate a sync event if there has not been one in the requested interval, and this is a provider node.';
  
  -- ----------------------------------------------------------------------

From cbbrowne at lists.slony.info  Wed Mar 14 08:59:34 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Wed Mar 14 08:59:37 2007
Subject: [Slony1-commit] slony1-engine/src/slon sync_thread.c
Message-ID: <20070314155934.699382903F3@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/src/slon
In directory main.slony.info:/tmp/cvs-serv8627/src/slon

Modified Files:
	sync_thread.c 
Log Message:
Reduce the quantity of spurious events generated:

1.  generate_sync_event() only needs to generate a SYNC on a node
    that is the origin for a set

2.  sync thread generates a SYNC when it starts; in later iterations,
    it will only generate a SYNC for its node if that node is the origin
    for a replication set

Per discussions with Jan Wieck on 2007-02-09; this seemed an experiment
worth trying.  I tried it, and the tests run fine, so I'm committing this.


Index: sync_thread.c
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/slon/sync_thread.c,v
retrieving revision 1.18
retrieving revision 1.19
diff -C2 -d -r1.18 -r1.19
*** sync_thread.c	27 Oct 2006 20:10:57 -0000	1.18
--- sync_thread.c	14 Mar 2007 15:59:32 -0000	1.19
***************
*** 47,53 ****
--- 47,55 ----
  	SlonDString query1;
  	SlonDString query2;
+ 	SlonDString query3;
  	PGconn	   *dbconn;
  	PGresult   *res;
  	int			timeout_count;
+ 	bool first_time = TRUE;
  
  	slon_log(SLON_DEBUG1,
***************
*** 84,89 ****
  	dstring_init(&query2);
  	slon_mkquery(&query2,
! 				 "select %s.createEvent('_%s', 'SYNC', NULL);",
! 				 rtcfg_namespace, rtcfg_cluster_name);
  
  	timeout_count = (sync_interval_timeout == 0) ? 0 :
--- 86,99 ----
  	dstring_init(&query2);
  	slon_mkquery(&query2,
! 		     "select %s.createEvent('_%s', 'SYNC', NULL)"
! 		     " from %s.sl_node where no_id = %s.getLocalNodeId('_%s') "
! 		     " and exists (select 1 from %s.sl_set where set_origin= no_id);",
! 		     rtcfg_namespace, rtcfg_cluster_name,
! 		     rtcfg_namespace, rtcfg_namespace, rtcfg_cluster_name, rtcfg_namespace);
! 
! 	dstring_init(&query3);
! 	slon_mkquery(&query3,
! 		     "select %s.createEvent('_%s', 'SYNC', NULL);",
! 		     rtcfg_namespace, rtcfg_cluster_name);
  
  	timeout_count = (sync_interval_timeout == 0) ? 0 :
***************
*** 123,140 ****
  
  			PQclear(res);
! 			res = PQexec(dbconn, dstring_data(&query2));
  			if (PQresultStatus(res) != PGRES_TUPLES_OK)
  			{
  				slon_log(SLON_FATAL,
  						 "syncThread: \"%s\" - %s",
! 						 dstring_data(&query2), PQresultErrorMessage(res));
  				PQclear(res);
  				slon_retry();
  				break;
  			}
! 			slon_log(SLON_DEBUG2,
  					 "syncThread: new sl_action_seq %s - SYNC %s\n",
  					 last_actseq_buf, PQgetvalue(res, 0, 0));
  			PQclear(res);
  
  			/*
--- 133,153 ----
  
  			PQclear(res);
! 			res = PQexec(dbconn, dstring_data(first_time? &query3:&query2));
  			if (PQresultStatus(res) != PGRES_TUPLES_OK)
  			{
  				slon_log(SLON_FATAL,
  						 "syncThread: \"%s\" - %s",
! 					 dstring_data(first_time?&query3:&query2), PQresultErrorMessage(res));
  				PQclear(res);
  				slon_retry();
  				break;
  			}
! 			if (first_time) {
! 				slon_log(SLON_DEBUG2,
  					 "syncThread: new sl_action_seq %s - SYNC %s\n",
  					 last_actseq_buf, PQgetvalue(res, 0, 0));
+ 			}
  			PQclear(res);
+ 			first_time = FALSE;
  
  			/*
***************
*** 179,182 ****
--- 192,196 ----
  	dstring_free(&query1);
  	dstring_free(&query2);
+ 	dstring_free(&query3);
  	slon_disconnectdb(conn);
  

From cbbrowne at lists.slony.info  Wed Mar 14 09:23:54 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Wed Mar 14 09:23:56 2007
Subject: [Slony1-commit] slony1-engine/src/backend slony1_funcs.sql
Message-ID: <20070314162354.5896D29044C@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/src/backend
In directory main.slony.info:/tmp/cvs-serv8790/src/backend

Modified Files:
      Tag: REL_1_1_STABLE
	slony1_funcs.sql 
Log Message:
Mark as version 1.1.8


Index: slony1_funcs.sql
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/backend/slony1_funcs.sql,v
retrieving revision 1.64.2.21
retrieving revision 1.64.2.22
diff -C2 -d -r1.64.2.21 -r1.64.2.22
*** slony1_funcs.sql	8 Feb 2007 22:52:40 -0000	1.64.2.21
--- slony1_funcs.sql	14 Mar 2007 16:23:52 -0000	1.64.2.22
***************
*** 414,418 ****
  as '
  begin
! 	return 7;
  end;
  ' language plpgsql;
--- 414,418 ----
  as '
  begin
! 	return 8;
  end;
  ' language plpgsql;

From cbbrowne at lists.slony.info  Wed Mar 14 09:23:54 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Wed Mar 14 09:23:56 2007
Subject: [Slony1-commit] slony1-engine config.h.in
Message-ID: <20070314162354.3D28E290439@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine
In directory main.slony.info:/tmp/cvs-serv8790

Modified Files:
      Tag: REL_1_1_STABLE
	config.h.in 
Log Message:
Mark as version 1.1.8


Index: config.h.in
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/config.h.in,v
retrieving revision 1.12.2.5
retrieving revision 1.12.2.6
diff -C2 -d -r1.12.2.5 -r1.12.2.6
*** config.h.in	8 Feb 2007 22:52:40 -0000	1.12.2.5
--- config.h.in	14 Mar 2007 16:23:52 -0000	1.12.2.6
***************
*** 13,17 ****
  #define SLONY_I_CONFIG_H
  
! #define SLONY_I_VERSION_STRING	"1.1.7"
  
  #undef PGSHARE
--- 13,17 ----
  #define SLONY_I_CONFIG_H
  
! #define SLONY_I_VERSION_STRING	"1.1.8"
  
  #undef PGSHARE

From cbbrowne at lists.slony.info  Wed Mar 14 09:24:32 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Wed Mar 14 09:24:33 2007
Subject: [Slony1-commit] slony1-engine config.h.in
Message-ID: <20070314162432.C4B3B2903F3@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine
In directory main.slony.info:/tmp/cvs-serv8831

Modified Files:
      Tag: REL_1_2_STABLE
	config.h.in 
Log Message:
Update version to 1.2.8


Index: config.h.in
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/config.h.in,v
retrieving revision 1.17.2.4
retrieving revision 1.17.2.5
diff -C2 -d -r1.17.2.4 -r1.17.2.5
*** config.h.in	8 Feb 2007 22:55:57 -0000	1.17.2.4
--- config.h.in	14 Mar 2007 16:24:30 -0000	1.17.2.5
***************
*** 13,18 ****
  #define SLONY_I_CONFIG_H
  
! #define SLONY_I_VERSION_STRING	"1.2.7"
! #define SLONY_I_VERSION_STRING_DEC 1,2,7
  
  #ifndef PG_VERSION_MAJOR
--- 13,18 ----
  #define SLONY_I_CONFIG_H
  
! #define SLONY_I_VERSION_STRING	"1.2.8"
! #define SLONY_I_VERSION_STRING_DEC 1,2,8
  
  #ifndef PG_VERSION_MAJOR

From cbbrowne at lists.slony.info  Wed Mar 14 09:24:32 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Wed Mar 14 09:24:34 2007
Subject: [Slony1-commit] slony1-engine/src/backend slony1_funcs.sql
Message-ID: <20070314162433.0014229044D@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/src/backend
In directory main.slony.info:/tmp/cvs-serv8831/src/backend

Modified Files:
      Tag: REL_1_2_STABLE
	slony1_funcs.sql 
Log Message:
Update version to 1.2.8


Index: slony1_funcs.sql
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/backend/slony1_funcs.sql,v
retrieving revision 1.98.2.9
retrieving revision 1.98.2.10
diff -C2 -d -r1.98.2.9 -r1.98.2.10
*** slony1_funcs.sql	8 Feb 2007 22:55:58 -0000	1.98.2.9
--- slony1_funcs.sql	14 Mar 2007 16:24:30 -0000	1.98.2.10
***************
*** 431,435 ****
  as '
  begin
! 	return 7;
  end;
  ' language plpgsql;
--- 431,435 ----
  as '
  begin
! 	return 8;
  end;
  ' language plpgsql;

From cbbrowne at lists.slony.info  Wed Mar 14 09:34:00 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Wed Mar 14 09:34:01 2007
Subject: [Slony1-commit] slony1-engine/tools/slony_bulkload - New directory
Message-ID: <20070314163400.3F307290440@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/tools/slony_bulkload
In directory main.slony.info:/tmp/cvs-serv8889/slony_bulkload

Log Message:
Directory /home/cvsd/slony1/slony1-engine/tools/slony_bulkload added to the repository


From cbbrowne at lists.slony.info  Wed Mar 14 09:35:10 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Wed Mar 14 09:35:11 2007
Subject: [Slony1-commit] slony1-engine/tools/slony_bulkload COPYRIGHT README
	bulk_load_for_slony.pl
Message-ID: <20070314163510.8BCF22903F3@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/tools/slony_bulkload
In directory main.slony.info:/tmp/cvs-serv8917

Added Files:
	COPYRIGHT README bulk_load_for_slony.pl 
Log Message:
Add in "bulk load" scripts along with making the warnings in README
more vigorous...


--- NEW FILE: README ---
The bulk_load_for_slony.pl tool will do a bulk load of a table that
is being replicated by Slony-I but that is not being actively used.
Note that this bulk load tool has features that can and will break
replication if you are the least bit unwary and if you do not understand
what it is doing.  PLEASE READ THE DOCUMENTATION.

For documentation, see the perldoc documentation included in the
enclosed file. PLEASE READ IT. Use perldoc bulk_load_for_slony.pl to
read it.

If this script breaks your replication cluster, well, we told you
it would.

--- NEW FILE: bulk_load_for_slony.pl ---
#!/usr/bin/perl -w
# $Id: bulk_load_for_slony.pl,v 1.1 2007-03-14 16:35:08 cbbrowne Exp $

# Bulk loader for slony-managed table.
# This script takes one argument: the name of a config file.
# The config file MUST include all the configuration data needed.
# If it does not, the script will bail with a suitably 
# carpy message.

# andrew@ca.afilias.info 2007-01-04

=pod 

=head1 bulk_load_for_slony.pl

=head2 Syntax

B<bulk_load_for_slony.pl> I<configfile>

=head2 DANGER WILL ROBINSON

This script performs a somewhat-dangerous bulk load of a PostgreSQL
table that is managed by Slony-I.  If your table I<is not> managed by
Slony, I<do not use this script>.  This is intended to make it
possible for people who have a very good idea of what their database
is already doing to perform bulk loads.  It does not try to ascertain
that you are sure of what you are doing; neither does it make sure
things will work as you expect.  It may commit data that breaks your
tables.  If you use it on a table that is under active use by your
application I<it will certainly break things>, and not in a way you can
roll back.  Please go away now, and use safer methods, if your data is
anything but trivially-regenerated garbage that you do not care about.

=head2 Overview

This script attempts to perform a bulk load of a specified file, which
must exist in the same location on every database node specified, into
a Slony database cluster of machines.  If something goes wrong as far
as it can tell, it complains and exits, leaving your databases in an
inconsistent state.  It is intended to be used I<only> on tables where
no application is dependent on the table, as a bootstrap mechanism.

The file to be loaded should be in the format similar to that
generated by pg_dump:

=over 4

=item -

Every field is specified, including "\N" for NULLs.

=item -

Fields are separated by one tab character

=item -

The COPY is terminated by the end-of-data character, "\."  While the
end of data character is not actually necessary because this tool
currently only works for one table, the restriction is here for later,
in case this tool is altered to support multiple tables.

=back

See the PostgreSQL manual section on COPY for more information about
this file.  In principle, you could include WITH arguments in your
COPY file, but such behaviour has not been tested or allowed for.

=head2 Configuration file

All configuration of the script is done using a configuration file.
The name of that file is a mandatory argument to the script.  The file
is set up similarly to the configuration file for the altperl Slony
tools.  This file is parsed directly by Perl.

=over 4 

=item add_node() stanzas

For each node in the cluster, you should have one add_node entry.
Each add_node entry includes several items enclosed in parentheses and
terminated with a semi-colon, like this:

   add_node (
       some_argument  => 'foo',
`      other_argument => 'bar');

The available arguments are as follows.  The add_node stanzas from
your slon_tools.conf file, if you have one, should work here, except
that the parameters parent and noforward have no effect.  Note that
this script nevertheless does not depend on the existence of
slon-tools.pm.

=Over 8

=item node

A numeric identifier of the node.  This must be unique for each node.
It need not be the same number as the node numbers that Slony uses,
although using it that way will certainly make maintenance less
confusing.  This number is not actually used by the script, in any case.

=item host

The name of the host from which the database for this node is served.
It must be specified.  Remember that 'localhost' refers to the machine
from which the script runs.  This value must be enclosed in single
quotes (').

=item dbname

The name of the database for this node.  The value must be enclosed in
single quotes.  This value is required.

=item port

This is the port the database is listening on.  If not specified, it
defaults to 5432.

=item user

This is the database user that will perform the work.  This user
should be the slony administration user.  If not specified, it
defaults to postgres.

=item password

This is the password for the user above.  The use of this field is not
recommended.  Use the .pgpass facility instead.

=back

I<NOTE WELL:> There is effectively no way to make sure that you have
specified all the actual nodes in your cluster.  The script will check
to make sure that the number of specified cluster members is
equivalent to the count() of sl_node, but that's as much as it can
do.  This script is therefore dangerous, in that it is entirely
possible to send your copy of data to a machine that does not exist.
This may not be detected until you have an unrecoverable condition
(i.e. data on one node, not yet loaded on another).  I<Check your
configuration very carefully.>

=item $CLUSTERNAME

This is the clustername for Slony.  It is the same as Slony's schema
name, minus the "_" at the beginning.

=item $FILELOC

This is the full path to the filename.  The filename must be the same
on every machine in the cluster, which is reasonable since the file
has to be the same on every machine.  The script I<does not> check to
make sure that the files are the same on every machine: you have to
make sure of that in advance yourself.  If the files are not the same,
the tables will be bulk loaded with different data.

The file (and its entire path) must be readable by the user running
the back end, in the same way that every COPY file must be.  This item
is mandatory.

=item $SCHEMANAME

This is the schema name of the table into which data is to be copied.
If it is not specified, or if it is empty, the value defaults to public.

=item $TABLENAME

This is the table into which data is to be copied.  This item is mandatory.

=item @COLUMNLIST

This is the list of the columns of the table into which the data is to
be copied.  I<These must be in the same order as your data in the
file.>  If the column list is unspecified, no column list will be used
in the COPY command sent to the back end.

=back

=head2 Operation

The script must be invoked from a machine that has access to every
PostgreSQL node listed in the configuration file.  On invocation, it
parses the configuration file.  It builds a COPY statement to load the
bulk file into the target table, and then connects to each node in
turn.  It checks to make sure that there are as many nodes listed in
sl_node as are configured in its configuration file.  It learns the
table identifier for Slony by querying the cluster's sl_table table,
then removes that table from replication by calling the
altertablerestore() function.  It then runs its COPY query.  It checks
the return value of the copy query.  If that returns OK, then it
retores the table to replication using the altertableforreplication()
function.  

The script proceeds to perform the same operations for every table
listed in the configuration file.

If any step fails, the script immediately exits.  It attempts to
detail what it was doing when it failed, but operators are advised to
perform detailed subsequent checks to ensure the report is correct and
does not conceal some other problem.

Note that the script returns the first table to replicating status
before all the other nodes have been loaded.  It is recommended that
the origin node be listed last among the cluster members, but such an
approach does not in any case ensure no data loss.

I<Note that the above description means you can break your replicas.>
The script makes no effort whatever to leave your replicas in a usable
state.  In particular, if any failure is detected, you I<MUST> check
all nodes and, possibly, recover manually.  I<TO REPEAT:> Do not use
this script on a table in which already-existing data resides if you
cannot afford to lose that data.  

=head2 Prerequisites

This script depends on the Pg Perl module, available from CPAN.

=head2 Author's address

Andrew Sullivan
Afilias
204-4141 Yonge Street
Toronto, ON
M2P 2A8
<andrew@ca.afilias.info>

=head2 BUGS

It might be argued that the three steps of removing from replication,
COPYing data, and re-adding to replication should be performed in a
single transaction, to avoid leaving a table in a broken state.  The
author considers the current approach a feature rather than a bug,
because the table replication will be broken in the event of errors,
so the operator will be unable accidentally to re-enable replication
when tables have different data.

=head2 COPYRIGHT

Copyright (c) 2007, PostgreSQL Global Development Group

Permission to use, copy, modify, and distribute this software and its
documentation for any purpose, without fee, and without a written
agreement is hereby granted, provided that the above copyright notice
and this paragraph and the following two paragraphs appear in all
copies.

THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

use vars qw ( @NODES @HOST @DBNAME @USER @PORT
            @PASSWORD @SSLMODE @DSN @connstr $CLUSTERNAME $FILELOC
            $SCHEMANAME $TABLENAME @COLUMNLIST);
use Pg;
use strict;

my $configfile = $ARGV[0] or
  die ("You must specify a configuration file.\n");

#parse the config file
require $configfile;

my $slonyschem = "_" . $CLUSTERNAME;

my $schema;
if (defined($SCHEMANAME)) {
  $schema = $SCHEMANAME;
} else {
  $schema = "public";
}

my $columns;
if (defined(@COLUMNLIST)) {
  my $i = 0;
  foreach my $column (@COLUMNLIST) {
    if ($i == 0) {
      $columns = "(" . $column;
      $i++;
    } else {
      $columns = $columns . ", " . $column;
      $i++;
    }
  }
  $columns = $columns . ")";
}

# We have enough now to build the COPY statement.

my $copystmt = "COPY " . $schema . "." . $TABLENAME;
$copystmt = $copystmt . " " . $columns if defined ($columns);
$copystmt = $copystmt . " FROM '" . $FILELOC . "';";

# now we connect to each host in turn, unhook our table from
# replication, bulk load the table, and then re-enable replication
# In the event anything indicates it didn't work, we fail.

# we want to know how many nodes we have to do
my $numnodes = @connstr;
foreach my $connopt (@connstr) {
  my $conn = Pg::connectdb($connopt);
  my $status_conn = $conn->status;

  if ($status_conn ne PGRES_CONNECTION_OK) {
    print "No connection to database.\n";
    print "Status: $status_conn\n";
    print $conn->errorMessage;
    die("Can't proceed on connection $connopt\n");
  }

  # get the table id for the table in question.

  my $qstring = "SELECT tab_id FROM " . $slonyschem;
  $qstring = $qstring . ".sl_table WHERE tab_relname = '";
  $qstring = $qstring . $TABLENAME;
  $qstring = $qstring . "' AND tab_nspname = '";
  $qstring = $qstring . $schema . "'";

  my $get_tab_id = $conn->exec($qstring);
  unless (($get_tab_id->resultStatus) eq PGRES_TUPLES_OK) {
    print "PANIC: getting table id failed: $get_tab_id->resultStatus\n";
    die "Cound not handle replication info for $connopt\n";
  }
  # check to make sure we have the right number of connections
  my $tab_id = $get_tab_id->getvalue(0,0);
  $qstring = "SELECT count(1) FROM " . $slonyschem;
  $qstring = $qstring . ".sl_node";
  my $slnodes = (($conn->exec($qstring))->getvalue(0,0));
  unless ($slnodes == $numnodes) {
    print "Your config has $numnodes nodes\n";
    print "Slony thinks it has $slnodes nodes\n";
    die "Mismatch!\n";
  }
  # now that we have the table id, disable it in replication
  $qstring = "SELECT " . $slonyschem;
  $qstring = $qstring . ".altertablerestore(" . $tab_id . ")";
  my $replic_change = $conn->exec($qstring);
  unless (($replic_change->resultStatus)  eq PGRES_TUPLES_OK) {
    print "PANIC: failed attempting to disable replication\n";
    printf ("Result is %s\n",($replic_change->resultStatus));
    die "Could not disable replication on connection $connopt\n";
  }
  # perform the bulk load
  my $bulk_load = $conn->exec($copystmt);
  my $errstat = ($bulk_load->resultStatus);
  unless ($errstat eq PGRES_COMMAND_OK) {
    print "ERROR in bulk load: $errstat\n";
    die "Could not bulk load for $connopt\n";
  }
  #restore the replication
  $qstring = "SELECT " . $slonyschem;
  $qstring = $qstring . ".altertableforreplication(" . $tab_id . ")";
  $replic_change = $conn->exec($qstring);
  unless (($replic_change->resultStatus)  eq PGRES_TUPLES_OK) {
    print "PANIC: failed attempting to enable replication\n";
    die "Could not enable replication on connection $connopt\n";
  }

  # if that all worked, we can do the next one.
}

print "All nodes processed.\n";


sub add_node {
# mostly lifted from the "altperl" tools in the slony source distribution.   
# Author: Christopher Browne
# Copyright 2004 Afilias Canada

# yes, some of this could be removed, but I don't have time to do it now.

  my %PARAMS = (host=> undef,
                dbname => 'template1',
                port => 5432,
                user => 'postgres',
                node => undef,
                password => undef,
                sslmode => undef
               );
  my $K;
  while ($K= shift) {
    $PARAMS{$K} = shift;
  }
  die ("I need a node number") unless $PARAMS{'node'};
  my $node = $PARAMS{'node'};
  push @NODES, $node;
  my $loginstr;
  my $host = $PARAMS{'host'};
  if ($host) {
    $loginstr .= "host=$host";
    $HOST[$node] = $host;
  } else {
    die("I need a host name") unless $PARAMS{'host'};
  }
  my $dbname = $PARAMS{'dbname'};
  if ($dbname) {
    $loginstr .= " dbname=$dbname";
    $DBNAME[$node] = $dbname;
  }
  my $user=$PARAMS{'user'};
  $loginstr .= " user=$user";
  $USER[$node]= $user;

  my $port = $PARAMS{'port'};
  if ($port) {
    $loginstr .= " port=$port";
    $PORT[$node] = $port;  } else {
    die ("I need a port number");
  }
  my $password = $PARAMS{'password'};
  if ($password) {
    $loginstr .= " password=$password";
    $PASSWORD[$node] = $password;
  }
  my $sslmode = $PARAMS{'sslmode'};
  if ($sslmode) {
    $loginstr .= " sslmode=$sslmode";
    $SSLMODE[$node] = $sslmode;
  }
  $DSN[$node] = $loginstr;
push @connstr, $loginstr;
}

--- NEW FILE: COPYRIGHT ---
Copyright (c) 2007, PostgreSQL Global Development Group

Permission to use, copy, modify, and distribute this software and its
documentation for any purpose, without fee, and without a written
agreement is hereby granted, provided that the above copyright notice
and this paragraph and the following two paragraphs appear in all
copies.

THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

From cbbrowne at lists.slony.info  Wed Mar 14 09:53:53 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Wed Mar 14 09:53:54 2007
Subject: [Slony1-commit] slony1-engine/doc/adminguide bestpractices.sgml
	faq.sgml slonik_ref.sgml startslons.sgml
Message-ID: <20070314165353.834712903F3@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/doc/adminguide
In directory main.slony.info:/tmp/cvs-serv9043

Modified Files:
	bestpractices.sgml faq.sgml slonik_ref.sgml startslons.sgml 
Log Message:
Mark Stosberg pointed out that the use of the term "COPY SET" was a bit
confusing as it is initiated, behind the scenes, by SUBSCRIBE SET, but
the docs are not explicit about this.  Corrected this...


Index: startslons.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/startslons.sgml,v
retrieving revision 1.19
retrieving revision 1.20
diff -C2 -d -r1.19 -r1.20
*** startslons.sgml	2 Aug 2006 18:34:59 -0000	1.19
--- startslons.sgml	14 Mar 2007 16:53:51 -0000	1.20
***************
*** 88,93 ****
  one point not preferable to run it whilst subscribing a very large
  replication set where it is expected to take many hours to do the
! initial <command>COPY SET</command>.  The problem that came up in that
! case was that it figured that since it hasn't done a
  <command>SYNC</command> in 2 hours, something was broken requiring
  restarting slon, thereby restarting the <command>COPY SET</command>
--- 88,94 ----
  one point not preferable to run it whilst subscribing a very large
  replication set where it is expected to take many hours to do the
! <command>COPY SET</command> (the main event that processes a
! <command>SUBSCRIBE SET</command> request).  The problem that came up
! in that case was that it figured that since it hasn't done a
  <command>SYNC</command> in 2 hours, something was broken requiring
  restarting slon, thereby restarting the <command>COPY SET</command>

Index: slonik_ref.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/slonik_ref.sgml,v
retrieving revision 1.66
retrieving revision 1.67
diff -C2 -d -r1.66 -r1.67
*** slonik_ref.sgml	30 Jan 2007 11:47:31 -0000	1.66
--- slonik_ref.sgml	14 Mar 2007 16:53:51 -0000	1.67
***************
*** 1934,1953 ****
      </para>
      
!     <para> If the tables on the subscriber are <emphasis>not</emphasis> empty, then
!      the <command>COPY SET</command> process winds up doing more work than should be
!      strictly necessary:</para>
       <itemizedlist>
        
!       <listitem><para> It deletes all <quote>old</quote> entries in
!       the table</para></listitem>
  
!       <listitem><para> Those old entries
! 	clutter up the table until it is next
! 	<command>VACUUM</command>ed <emphasis>after</emphasis> the
! 	subscription process is complete</para></listitem>
        
        <listitem><para> The indices for the table will contain entries
! 	for the old, deleted entries, which will slow the process of
! 	inserting new entries into the index.</para></listitem>
       </itemizedlist>
  
--- 1934,1959 ----
      </para>
      
!     <para> If the tables on the subscriber are
!     <emphasis>not</emphasis> empty, then the <command>COPY
!     SET</command> event (which is part of the subscription process)
!     may wind up doing more work than should be strictly
!     necessary:</para>
       <itemizedlist>
+ 
+       <listitem><para> It attempts to <command>TRUNCATE</command> the
+       table, which will be efficient. </para> </listitem>
        
!       <listitem><para> If that fails (a foreign key relationship might
!       prevent TRUNCATE from working), it uses
!       <command>DELETE</command> to delete all <quote>old</quote>
!       entries in the table</para></listitem>
  
!       <listitem><para> Those old entries clutter up the table until it
!       is next <command>VACUUM</command>ed <emphasis>after</emphasis>
!       the subscription process is complete</para></listitem>
        
        <listitem><para> The indices for the table will contain entries
!       for the old, deleted entries, which will slow the process of
!       inserting new entries into the index.</para></listitem>
       </itemizedlist>
  
***************
*** 1960,1971 ****
  
       <para> The <command>SUBSCRIBE SET</command> request will,
!      nonetheless, return fairly much immediately, even though the work
!      is merely <quote>in progress.</quote> If you need to set up
!      subscriptions for a set of cascading nodes, you will need to wait
!      for each subscriber to complete subscribing before submitting
!      requests for subscriptions that use that node as a provider.  If
!      you don't, it won't be a big deal: <command>slonik</command> will
!      check the node, discover that it is not yet an active provider
!      for the set, and report back:</para>
  
  <programlisting>
--- 1966,1978 ----
  
       <para> The <command>SUBSCRIBE SET</command> request will,
!      nonetheless, return fairly much immediately, even though the
!      work, being handled by the <command>COPY SET</command> event, is
!      still in progress.  If you need to set up subscriptions for a set
!      of cascading nodes, you will need to wait for each subscriber to
!      complete subscribing before submitting requests for subscriptions
!      that use that node as a provider.  If you don't, it won't be a
!      big deal: <command>slonik</command> will check the node, discover
!      that it is not yet an active provider for the set, and report
!      back:</para>
  
  <programlisting>

Index: bestpractices.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/bestpractices.sgml,v
retrieving revision 1.25
retrieving revision 1.26
diff -C2 -d -r1.25 -r1.26
*** bestpractices.sgml	1 Mar 2007 21:02:31 -0000	1.25
--- bestpractices.sgml	14 Mar 2007 16:53:51 -0000	1.26
***************
*** 378,382 ****
  <listitem><para> Lowering Authority </para>
  
! <para> Traditionally, it has been stated that <quote>&slony; needs to
  use superuser connections.</quote> It turns out that this is not
  entirely true, and and if there are particular concerns about
--- 378,382 ----
  <listitem><para> Lowering Authority </para>
  
! <para> Traditionally, it has been stated that <quote>&slony1; needs to
  use superuser connections.</quote> It turns out that this is not
  entirely true, and and if there are particular concerns about

Index: faq.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/faq.sgml,v
retrieving revision 1.68
retrieving revision 1.69
diff -C2 -d -r1.68 -r1.69
*** faq.sgml	2 Feb 2007 20:24:16 -0000	1.68
--- faq.sgml	14 Mar 2007 16:53:51 -0000	1.69
***************
*** 240,244 ****
  </screen></para></question>
  
- 
  <answer> <para> There is evidently some reasonably old outstanding
  transaction blocking &slony1; from processing the sync.  You might
--- 240,243 ----
***************
*** 1018,1022 ****
  
  <answer><para> Another would be to treat the node as having failed,
! and use the &slonik; command <xref linkend="stmtdropnode"> to drop the
  node, and recreate it.  If the database is heavily updated, it may
  well be cheaper to do this than it is to find a way to let it catch
--- 1017,1021 ----
  
  <answer><para> Another would be to treat the node as having failed,
! and use the &lslonik; command <xref linkend="stmtdropnode"> to drop the
  node, and recreate it.  If the database is heavily updated, it may
  well be cheaper to do this than it is to find a way to let it catch
***************
*** 1679,1685 ****
  index on the primary key, and leaves all indexes alone whilst using
  the &postgres; <command>COPY</command> command to load the data.
! Further hurting performane, the <command>COPY SET</command> event
! starts by deleting the contents of tables, which potentially leaves a
! lot of dead tuples
  </para>
  
--- 1678,1684 ----
  index on the primary key, and leaves all indexes alone whilst using
  the &postgres; <command>COPY</command> command to load the data.
! Further hurting performance, the <command>COPY SET</command> event (an
! event that the subscription process generates) starts by deleting the
! contents of tables, which leaves the table full of dead tuples.
  </para>
  

From cbbrowne at lists.slony.info  Thu Mar 15 11:52:04 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Thu Mar 15 11:52:05 2007
Subject: [Slony1-commit] slony1-engine RELEASE-1.2.8
Message-ID: <20070315185204.3D1AE290461@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine
In directory main.slony.info:/tmp/cvs-serv17651

Modified Files:
      Tag: REL_1_2_STABLE
	RELEASE-1.2.8 
Log Message:
Fix to src/slonik/slonik.c - it wasn't pulling in the right version of slony1_funcs.?.sql in some cases


Index: RELEASE-1.2.8
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/Attic/RELEASE-1.2.8,v
retrieving revision 1.1.2.3
retrieving revision 1.1.2.4
diff -C2 -d -r1.1.2.3 -r1.1.2.4
*** RELEASE-1.2.8	13 Mar 2007 19:27:20 -0000	1.1.2.3
--- RELEASE-1.2.8	15 Mar 2007 18:52:01 -0000	1.1.2.4
***************
*** 6,8 ****
  - Fix to altperl "execute script" script to pass the filename properly
  
! - Fix to src/backend/slony1_funcs.v80.sql - comment on the right function in v8.0
\ No newline at end of file
--- 6,10 ----
  - Fix to altperl "execute script" script to pass the filename properly
  
! - Fix to src/backend/slony1_funcs.v80.sql - comment on the right function in v8.0
! 
! - Fix to src/slonik/slonik.c - it wasn't pulling in the right version of slony1_funcs.?.sql in some cases

From cbbrowne at lists.slony.info  Thu Mar 15 11:52:04 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Thu Mar 15 11:52:06 2007
Subject: [Slony1-commit] slony1-engine/src/slonik slonik.c
Message-ID: <20070315185204.61EB929046D@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/src/slonik
In directory main.slony.info:/tmp/cvs-serv17651/src/slonik

Modified Files:
      Tag: REL_1_2_STABLE
	slonik.c 
Log Message:
Fix to src/slonik/slonik.c - it wasn't pulling in the right version of slony1_funcs.?.sql in some cases


Index: slonik.c
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/slonik/slonik.c,v
retrieving revision 1.67.2.5
retrieving revision 1.67.2.6
diff -C2 -d -r1.67.2.5 -r1.67.2.6
*** slonik.c	8 Feb 2007 22:55:58 -0000	1.67.2.5
--- slonik.c	15 Mar 2007 18:52:02 -0000	1.67.2.6
***************
*** 1983,1997 ****
                  use_minor = 4;
          }
!         else if ((adminfo->pg_version >= 70500) && adminfo->pg_version < 80200) /* 8.0 and 8.1 */
          {
                  use_major = 8;
                  use_minor = 0;
          }
!         else    /* 8.2 and above */
          {
                  use_major = 8;
!                 use_minor = 0;
                  printf("%s:%d: Possible unsupported PostgreSQL "
!                         "version %d.%d, defaulting to 8.0 support\n",
                          stmt->stmt_filename, stmt->stmt_lno,
                          (adminfo->pg_version/10000), ((adminfo->pg_version%10000)/100));
--- 1983,2002 ----
                  use_minor = 4;
          }
!         else if ((adminfo->pg_version >= 70500) && adminfo->pg_version < 80100) /* 8.0 and 8.1 */
          {
                  use_major = 8;
                  use_minor = 0;
          }
!        else if ((adminfo->pg_version >= 80100) && adminfo->pg_version < 80300)	/* 8.1 and 8.2 */
!        {
! 	       use_major = 8;
! 	       use_minor = 1;
!        }
!         else    /* 8.3 and above */
          {
                  use_major = 8;
!                 use_minor = 1;
                  printf("%s:%d: Possible unsupported PostgreSQL "
!                         "version %d.%d, defaulting to 8.1 support\n",
                          stmt->stmt_filename, stmt->stmt_lno,
                          (adminfo->pg_version/10000), ((adminfo->pg_version%10000)/100));

From cbbrowne at lists.slony.info  Thu Mar 15 11:55:36 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Thu Mar 15 11:55:38 2007
Subject: [Slony1-commit] slony1-engine RELEASE-1.1.8
Message-ID: <20070315185536.A9E1129045F@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine
In directory main.slony.info:/tmp/cvs-serv17836

Modified Files:
      Tag: REL_1_1_STABLE
	RELEASE-1.1.8 
Log Message:
Fix to src/slonik/slonik.c - it wasn't pulling in the right version of
slony1_funcs.?.sql in some cases


Index: RELEASE-1.1.8
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/Attic/RELEASE-1.1.8,v
retrieving revision 1.1.2.4
retrieving revision 1.1.2.5
diff -C2 -d -r1.1.2.4 -r1.1.2.5
*** RELEASE-1.1.8	13 Mar 2007 20:05:28 -0000	1.1.2.4
--- RELEASE-1.1.8	15 Mar 2007 18:55:34 -0000	1.1.2.5
***************
*** 9,11 ****
  use, and should be copied to generate the other versions.
  
! - Fix to src/backend/slony1_funcs.v80.sql - comment on the right function in v8.0
\ No newline at end of file
--- 9,13 ----
  use, and should be copied to generate the other versions.
  
! - Fix to src/backend/slony1_funcs.v80.sql - comment on the right function in v8.0
! 
! - Fix to src/slonik/slonik.c - it wasn't pulling in the right version of slony1_funcs.?.sql for late breaking versions of PostgreSQL

From cbbrowne at lists.slony.info  Thu Mar 15 11:55:36 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Thu Mar 15 11:55:38 2007
Subject: [Slony1-commit] slony1-engine/src/slonik slonik.c
Message-ID: <20070315185536.C8DBB290461@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/src/slonik
In directory main.slony.info:/tmp/cvs-serv17836/src/slonik

Modified Files:
      Tag: REL_1_1_STABLE
	slonik.c 
Log Message:
Fix to src/slonik/slonik.c - it wasn't pulling in the right version of
slony1_funcs.?.sql in some cases


Index: slonik.c
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/slonik/slonik.c,v
retrieving revision 1.42.2.8
retrieving revision 1.42.2.9
diff -C2 -d -r1.42.2.8 -r1.42.2.9
*** slonik.c	28 Feb 2007 22:07:49 -0000	1.42.2.8
--- slonik.c	15 Mar 2007 18:55:34 -0000	1.42.2.9
***************
*** 1867,1874 ****
  					break;
  				case 1:
! 					use_minor = 0;
  					break;
  				default:
! 					use_minor = 0;
  					printf("%s:%d: Possible unsupported PostgreSQL "
  						   "version %d.%d\n",
--- 1867,1874 ----
  					break;
  				case 1:
! 					use_minor = 1;
  					break;
  				default:
! 					use_minor = 1;
  					printf("%s:%d: Possible unsupported PostgreSQL "
  						   "version %d.%d\n",
***************
*** 1970,1974 ****
  					break;
  				default:
! 					use_minor = 0;
  					printf("%s:%d: Possible unsupported PostgreSQL "
  						"version %d.%d\n",
--- 1970,1974 ----
  					break;
  				default:
! 					use_minor = 1;
  					printf("%s:%d: Possible unsupported PostgreSQL "
  						"version %d.%d\n",

From cbbrowne at lists.slony.info  Fri Mar 16 07:43:02 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Fri Mar 16 07:43:04 2007
Subject: [Slony1-commit] slony1-engine/src/backend slony1_funcs.sql
Message-ID: <20070316144302.5B213290431@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/src/backend
In directory main.slony.info:/tmp/cvs-serv26581/src/backend

Modified Files:
      Tag: REL_1_2_STABLE
	slony1_funcs.sql 
Log Message:
Add recognition of versions 1.1.7, 1.1.8 in the 1.1 branch to the
"upgradeSchema()" function


Index: slony1_funcs.sql
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/backend/slony1_funcs.sql,v
retrieving revision 1.98.2.10
retrieving revision 1.98.2.11
diff -C2 -d -r1.98.2.10 -r1.98.2.11
*** slony1_funcs.sql	14 Mar 2007 16:24:30 -0000	1.98.2.10
--- slony1_funcs.sql	16 Mar 2007 14:43:00 -0000	1.98.2.11
***************
*** 5807,5811 ****
  	-- Changes for 1.2
  	-- ----
! 	if p_old IN (''1.0.2'', ''1.0.5'', ''1.0.6'', ''1.1.0'', ''1.1.1'', ''1.1.2'', ''1.1.3'',''1.1.5'', ''1.1.6'') then
  		-- Add new table sl_registry
  		execute ''create table @NAMESPACE@.sl_registry (
--- 5807,5811 ----
  	-- Changes for 1.2
  	-- ----
! 	if p_old IN (''1.0.2'', ''1.0.5'', ''1.0.6'', ''1.1.0'', ''1.1.1'', ''1.1.2'', ''1.1.3'',''1.1.5'', ''1.1.6'', "1.1.7", "1.1.8") then
  		-- Add new table sl_registry
  		execute ''create table @NAMESPACE@.sl_registry (

From cbbrowne at lists.slony.info  Fri Mar 16 07:43:31 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Fri Mar 16 07:43:33 2007
Subject: [Slony1-commit] slony1-engine/src/backend slony1_funcs.sql
Message-ID: <20070316144331.97151290440@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/src/backend
In directory main.slony.info:/tmp/cvs-serv26625/src/backend

Modified Files:
	slony1_funcs.sql 
Log Message:
Add recognition of versions 1.1.7, 1.1.8 in the 1.1 branch to the
"upgradeSchema()" function


Index: slony1_funcs.sql
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/backend/slony1_funcs.sql,v
retrieving revision 1.105
retrieving revision 1.106
diff -C2 -d -r1.105 -r1.106
*** slony1_funcs.sql	14 Mar 2007 15:59:32 -0000	1.105
--- slony1_funcs.sql	16 Mar 2007 14:43:29 -0000	1.106
***************
*** 5809,5813 ****
  	-- Changes for 1.2
  	-- ----
! 	if p_old IN (''1.0.2'', ''1.0.5'', ''1.0.6'', ''1.1.0'', ''1.1.1'', ''1.1.2'', ''1.1.3'', ''1.1.5'', ''1.1.6'') then
  		-- Add new table sl_registry
  		execute ''create table @NAMESPACE@.sl_registry (
--- 5809,5813 ----
  	-- Changes for 1.2
  	-- ----
! 	if p_old IN (''1.0.2'', ''1.0.5'', ''1.0.6'', ''1.1.0'', ''1.1.1'', ''1.1.2'', ''1.1.3'', ''1.1.5'', ''1.1.6'', "1.1.7", "1.1.8") then
  		-- Add new table sl_registry
  		execute ''create table @NAMESPACE@.sl_registry (

From cbbrowne at lists.slony.info  Fri Mar 16 10:22:55 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Fri Mar 16 10:22:57 2007
Subject: [Slony1-commit] slony1-engine/doc/adminguide releasechecklist.sgml
Message-ID: <20070316172255.EEACD290438@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/doc/adminguide
In directory main.slony.info:/tmp/cvs-serv27735

Modified Files:
	releasechecklist.sgml 
Log Message:
Add in notes on common changes that take place when we have new versions
or new support for versions of PostgreSQL.  This affects slonik.c,
possibly in 2 places, and slony1_funcs.sql...


Index: releasechecklist.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/releasechecklist.sgml,v
retrieving revision 1.8
retrieving revision 1.9
diff -C2 -d -r1.8 -r1.9
*** releasechecklist.sgml	5 Jan 2007 19:32:29 -0000	1.8
--- releasechecklist.sgml	16 Mar 2007 17:22:53 -0000	1.9
***************
*** 7,42 ****
  <itemizedlist>
  
!   <listitem><para>Positive build reports for each supported platform -
!   although it is arguably less necessary for a comprehensive list if
!   we are releasing a minor upgrade </para></listitem> 
  
  <listitem><para>Some kind of Standard Test Plan</para></listitem> 
  <listitem><para>Binary RPM packages</para></listitem> 
  
! <listitem>
!  <para>If the release is a <quote>.0</quote> one, we need to
  open a new STABLE branch</para>
  
!  <para> <command> cvs tag -b REL_1_2_STABLE</command></para>
! </listitem>
! <listitem>
!  <para>Tag the with the release ID. For version 1.1.2, this
! would be <envar>REL_1_1_2 </envar></para>
  
!  <para> <command> cvs tag REL_1_1_2 </command></para>
! </listitem> 
  
! <listitem><para>Check out a copy via <command>cvs export -rREL_1_1_2 </command>
  
!   </para></listitem> 
  
  <listitem><para>Run <application>autoconf</application> so as to
  regenerate <filename>configure</filename> from
! <filename>configure.ac</filename>
  
-   </para></listitem> 
  <listitem><para>Purge directory <filename>autom4te.cache</filename> so it is not included in the build  </para></listitem> 
- <listitem><para>Purge out .cvsignore files; this can be done with the command <command> find . -name .cvsignore | xargs rm </command>  </para></listitem> 
  
  <listitem><para> Run <filename>tools/release_checklist.sh</filename> </para>
  
--- 7,59 ----
  <itemizedlist>
  
! <listitem><para>Positive build reports for each supported platform -
! although it is arguably less necessary for a comprehensive list if we
! are releasing a minor upgrade </para></listitem>
  
  <listitem><para>Some kind of Standard Test Plan</para></listitem> 
+ 
+ <listitem><para> If the release modified the set of version-specific
+ SQL files in <filename>src/backend</filename>
+ (<emphasis>e.g.</emphasis> - it added a new
+ <filename>slony1_base.v83.sql</filename> or
+ <filename>slony1_funcs.v83.sql</filename>), or if we have other
+ changes to the shape of &postgres; version support, the function
+ <function>load_slony_functions() </function> in
+ <filename>src/slonik/slonik.c</filename> needs to be revised to
+ reflect the new shape of things.</para> </listitem>
+ 
+ <listitem><para> The new release needs to be added to function
+ <function>upgradeSchema(text)</function> in
+ <filename>src/backend/slony1_funcs.sql</filename>. </para>
+ 
+ <para> This takes place in a <quote>cross-branch</quote> fashion; if
+ we add version 1.1.9, in the 1.1 branch, then version 1.1.9 needs to
+ be added to the 1.2 branch as well as to later branches
+ (<emphasis>e.g.</emphasis> - 1.3, 1.4, HEAD).  Earlier branches will
+ normally not need to be made aware of versions added to later
+ branches... </para> </listitem>
+ 
  <listitem><para>Binary RPM packages</para></listitem> 
  
! <listitem> <para>If the release is a <quote>.0</quote> one, we need to
  open a new STABLE branch</para>
  
! <para> <command> cvs tag -b REL_1_2_STABLE</command></para> </listitem>
  
! <listitem> <para>Tag the with the release ID. For version 1.1.2, this
! would be <envar>REL_1_1_2 </envar></para>
  
! <para> <command> cvs tag REL_1_1_2 </command></para> </listitem>
  
! <listitem><para>Check out a copy via <command>cvs export -rREL_1_1_2
! </command> </para></listitem>
  
  <listitem><para>Run <application>autoconf</application> so as to
  regenerate <filename>configure</filename> from
! <filename>configure.ac</filename></para></listitem> 
  
  <listitem><para>Purge directory <filename>autom4te.cache</filename> so it is not included in the build  </para></listitem> 
  
+ <listitem><para>Purge out .cvsignore files; this can be done with the command <command> find . -name .cvsignore | xargs rm </command>  </para></listitem> 
  <listitem><para> Run <filename>tools/release_checklist.sh</filename> </para>
  

From cbbrowne at lists.slony.info  Fri Mar 16 12:01:28 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Fri Mar 16 12:01:31 2007
Subject: [Slony1-commit] slony1-engine/doc/adminguide addthings.sgml
	adminscripts.sgml bestpractices.sgml defineset.sgml faq.sgml
	firstdb.sgml help.sgml installation.sgml intro.sgml
	monitoring.sgml releasechecklist.sgml slon.sgml slonconf.sgml
	slonik_ref.sgml slonyupgrade.sgml startslons.sgml testbed.sgml
Message-ID: <20070316190129.97857290431@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/doc/adminguide
In directory main.slony.info:/tmp/cvs-serv29453

Modified Files:
      Tag: REL_1_2_STABLE
	addthings.sgml adminscripts.sgml bestpractices.sgml 
	defineset.sgml faq.sgml firstdb.sgml help.sgml 
	installation.sgml intro.sgml monitoring.sgml 
	releasechecklist.sgml slon.sgml slonconf.sgml slonik_ref.sgml 
	slonyupgrade.sgml startslons.sgml testbed.sgml 
Log Message:
Check numerous revisions made to admin guide in HEAD into 1.2 branch


Index: testbed.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/testbed.sgml,v
retrieving revision 1.10
retrieving revision 1.10.2.1
diff -C2 -d -r1.10 -r1.10.2.1
*** testbed.sgml	2 Aug 2006 18:34:59 -0000	1.10
--- testbed.sgml	16 Mar 2007 19:01:26 -0000	1.10.2.1
***************
*** 95,98 ****
--- 95,112 ----
  to be a &postgres; <quote>superuser.</quote> </para>  </glossdef> </glossentry>
  
+ <glossentry><glossterm> <envar>WEAKUSER</envar> </glossterm>
+ <glossdef><para> By default, the user <filename>postgres</filename> is
+ used; this is taken as the default user ID to use for the <xref linkend="stmtstorepath"> connections to all of the
+ databases. </para>
+ 
+ <para> There are also variables <envar>WEAKUSER1</envar> thru
+ <envar>WEAKUSER13</envar> which allow specifying a separate user name
+ for each database instance.  This user <emphasis> does not </emphasis>
+ need to be a &postgres; <quote>superuser.</quote> This user can start
+ out with no permissions; it winds up granted read permissions on the
+ tables that the test uses, plus read access throughout the &slony1;
+ schema, plus write access to one table and sequence used to manage
+ node locks. </para> </glossdef> </glossentry>
+ 
  <glossentry><glossterm> <envar>HOST</envar> </glossterm>
  <glossdef><para> By default, <filename>localhost</filename> is used.

Index: intro.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/intro.sgml,v
retrieving revision 1.25
retrieving revision 1.25.2.1
diff -C2 -d -r1.25 -r1.25.2.1
*** intro.sgml	2 Aug 2006 18:34:58 -0000	1.25
--- intro.sgml	16 Mar 2007 19:01:26 -0000	1.25.2.1
***************
*** 142,148 ****
  collects updates using triggers, and neither schema changes, large
  object operations, nor <command>TRUNCATE</command> requests are able
! to triggers suitable to inform &slony1; when those sorts of changes
! take place.  As a result, the only database objects where &slony1; can
! replicate updates are tables and sequences.  </para>
  
  <para> Note that with the <emphasis>use</emphasis> of triggers comes
--- 142,148 ----
  collects updates using triggers, and neither schema changes, large
  object operations, nor <command>TRUNCATE</command> requests are able
! to have triggers suitable to inform &slony1; when those sorts of
! changes take place.  As a result, the only database objects where
! &slony1; can replicate updates are tables and sequences.  </para>
  
  <para> Note that with the <emphasis>use</emphasis> of triggers comes
***************
*** 167,171 ****
  scripts via the <application>slonik</application> <xref
  linkend="stmtddlscript"> operation.  That is not handled
! <quote>automaticly;</quote> you, as a database administrator, will
  have to construct an SQL DDL script and submit it, via <xref
  linkend="stmtddlscript"> and there are a number of further <link
--- 167,171 ----
  scripts via the <application>slonik</application> <xref
  linkend="stmtddlscript"> operation.  That is not handled
! <quote>automatically;</quote> you, as a database administrator, will
  have to construct an SQL DDL script and submit it, via <xref
  linkend="stmtddlscript"> and there are a number of further <link

Index: slonyupgrade.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/slonyupgrade.sgml,v
retrieving revision 1.3.2.1
retrieving revision 1.3.2.2
diff -C2 -d -r1.3.2.1 -r1.3.2.2
*** slonyupgrade.sgml	15 Nov 2006 22:10:45 -0000	1.3.2.1
--- slonyupgrade.sgml	16 Mar 2007 19:01:26 -0000	1.3.2.2
***************
*** 20,24 ****
  <listitem><para> Execute a &lslonik; script containing the
  command <command>update functions (id = [whatever]);</command> for
! each node in the cluster.</para></listitem>
  <listitem><para> Start all slons.  </para> </listitem>
  </itemizedlist>
--- 20,27 ----
  <listitem><para> Execute a &lslonik; script containing the
  command <command>update functions (id = [whatever]);</command> for
! each node in the cluster.</para>
! <note><para>Remember that your slonik upgrade script like all other 
! slonik scripts must contain the proper preamble commands to function.
! </para></note></listitem>
  <listitem><para> Start all slons.  </para> </listitem>
  </itemizedlist>

Index: monitoring.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/monitoring.sgml,v
retrieving revision 1.29.2.5
retrieving revision 1.29.2.6
diff -C2 -d -r1.29.2.5 -r1.29.2.6
*** monitoring.sgml	5 Dec 2006 23:24:27 -0000	1.29.2.5
--- monitoring.sgml	16 Mar 2007 19:01:26 -0000	1.29.2.6
***************
*** 171,175 ****
  a given path (<envar>LOGHOME</envar>), based both on the naming
  conventions used by the <xref linkend="launchclusters"> and <xref
! linkend="slonwatchdog"> systems used for launching &lslon; processes.</para>
  
  <para> Errors, if found, are listed, by log file, and emailed to the
--- 171,176 ----
  a given path (<envar>LOGHOME</envar>), based both on the naming
  conventions used by the <xref linkend="launchclusters"> and <xref
! linkend="slonwatchdog"> systems used for launching &lslon; 
! processes.</para>
  
  <para> Errors, if found, are listed, by log file, and emailed to the
***************
*** 183,186 ****
--- 184,212 ----
  for replication problems. </para>
  </sect2>
+ 
+ <sect2 id="wikigen"> <title> Building MediaWiki Cluster Summary </title>
+ 
+ <para> The script <filename>mkmediawiki.pl </filename>, in
+ <filename>tools</filename>, may be used to generate a cluster summary
+ compatible with the popular <ulink url="http://www.mediawiki.org/">
+ MediaWiki </ulink> software. </para>
+ 
+ <para> The gentle user might use the script as follows: </para>
+ 
+ <screen>
+ ~/logtail.en>         mvs login -d mywiki.example.info -u "Chris Browne" -p `cat ~/.wikipass` -w wiki/index.php                     
+ Doing login with host: logtail and lang: en
+ ~/logtail.en> perl $SLONYHOME/tools/mkmediawiki.pl --host localhost --database slonyregress1 --cluster slony_regress1  > Slony_replication.wiki
+ ~/logtail.en> mvs commit -m "More sophisticated generated Slony-I cluster docs" Slony_replication.wiki
+ Doing commit Slony_replication.wiki with host: logtail and lang: en
+ </screen>
+ 
+ <para> Note that <command>mvs</command> is a client written in Perl;
+ on <ulink url="http://www.debian.org/"> Debian GNU/Linux</ulink>, the
+ relevant package is called
+ <application>libwww-mediawiki-client-perl</application>; other systems
+ may have a packaged version of this under some similar name. </para>
+ 
+ </sect2>
  </sect1>
  <!-- Keep this comment at the end of the file

Index: firstdb.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/firstdb.sgml,v
retrieving revision 1.20.2.1
retrieving revision 1.20.2.2
diff -C2 -d -r1.20.2.1 -r1.20.2.2
*** firstdb.sgml	13 Mar 2007 16:04:46 -0000	1.20.2.1
--- firstdb.sgml	16 Mar 2007 19:01:26 -0000	1.20.2.2
***************
*** 140,146 ****
  and configuration is all done through the <xref linkend="slonik">
  tool. It is a specialized scripting aid that mostly calls stored
! procedures in the master/slave (node) databases.  The script to create
  the initial configuration for the simple master-slave setup of our
! <application>pgbench</application> database looks like this:
  
  <programlisting>
--- 140,184 ----
  and configuration is all done through the <xref linkend="slonik">
  tool. It is a specialized scripting aid that mostly calls stored
! procedures in the master/slave (node) databases. </para>
! 
! <sect3><title>Using the altperl scripts</title>
! 
! <para>
! Using the <xref linkend="altperl"> scripts is an easy way to get started.  The
! <command>slonik_build_env</command> script will generate output providing
! details you need to  omplete building a <filename>slon_tools.conf</filename>. 
! An example <filename>slon_tools.conf</filename> is provided in the distribution
! to get you started.  The altperl scripts will all reference
! this central configuration file in the future to ease administration. Once 
! slon_tools.conf has been created, you can proceed as follows:
! </para>
! 
! <programlisting>
! # Initialize cluster:
! $ slonik_init_cluster  | slonik 
! 
! # Start slon  (here 1 and 2 are node numbers)
! $ slon_start 1    
! $ slon_start 2
! 
! # Create Sets (here 1 is a set number)
! $ slonik_create_set 1             
! 
! # subscribe set to second node (1= set ID, 2= node ID)
! $ slonik_subscribe_set  2 | slonik
! </programlisting>
! 
! <para> You have now replicated your first database.  You can skip the following section
! of documentation if you'd like, which documents more of a <quote>bare-metal</quote> approach.</para>
! </sect3>
! 
! <sect3><title>Using slonik command directly</title>
! <para>The traditional approach to administering slony is to craft slonik
! commands directly. An example of this given here. </para>
! 
! 
! <para> The script to create
  the initial configuration for the simple master-slave setup of our
! <application>pgbench</application> database looks like this:</para>
  
  <programlisting>
***************
*** 201,205 ****
  	store path (server = 2, client = 1, conninfo='dbname=$SLAVEDBNAME host=$SLAVEHOST user=$REPLICATIONUSER');
  _EOF_
! </programlisting></para>
  
  <para>Is the <application>pgbench</application> still running?  If
--- 239,243 ----
  	store path (server = 2, client = 1, conninfo='dbname=$SLAVEDBNAME host=$SLAVEHOST user=$REPLICATIONUSER');
  _EOF_
! </programlisting>
  
  <para>Is the <application>pgbench</application> still running?  If
***************
*** 281,285 ****
  <application>pgbench</application> has completed, so that there are no
  new updates hitting the origin node, and that your slon sessions have
! caught up.
  
  <programlisting>
--- 319,323 ----
  <application>pgbench</application> has completed, so that there are no
  new updates hitting the origin node, and that your slon sessions have
! caught up.</para>
  
  <programlisting>
***************
*** 317,321 ****
  fi
  </programlisting>
- </para>
  
  <para>Note that there is somewhat more sophisticated documentation of
--- 355,358 ----
***************
*** 325,332 ****
  <para>If this script returns <command>FAILED</command> please contact the
  developers at <ulink url="http://slony.info/">
! http://slony.info/</ulink></para></sect2>
! 
  </sect1>
- 
  <!-- Keep this comment at the end of the file
  Local variables:
--- 362,368 ----
  <para>If this script returns <command>FAILED</command> please contact the
  developers at <ulink url="http://slony.info/">
! http://slony.info/</ulink></para></sect3>
! </sect2>
  </sect1>
  <!-- Keep this comment at the end of the file
  Local variables:

Index: bestpractices.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/bestpractices.sgml,v
retrieving revision 1.24
retrieving revision 1.24.2.1
diff -C2 -d -r1.24 -r1.24.2.1
*** bestpractices.sgml	17 Oct 2006 18:45:15 -0000	1.24
--- bestpractices.sgml	16 Mar 2007 19:01:26 -0000	1.24.2.1
***************
*** 376,379 ****
--- 376,418 ----
  </listitem>
  
+ <listitem><para> Lowering Authority </para>
+ 
+ <para> Traditionally, it has been stated that <quote>&slony1; needs to
+ use superuser connections.</quote> It turns out that this is not
+ entirely true, and and if there are particular concerns about
+ excessive use of superuser accounts, it is possible to reduce this
+ considerably. </para>
+ 
+ <para> It is true to say that each &lslon; <emphasis>must</emphasis>
+ have a superuser connection in order to manage the node that it is
+ assigned to.  It needs to be able to alter the system catalogue in
+ order to set up subscriptions and to process alterations
+ (<emphasis>e.g</emphasis> - to run <xref linkend="stmtddlscript"> and
+ other events that may alter the role of replicated tables on the local
+ node).  </para>
+ 
+ <para> However, the connections that &lslon; processes open to other
+ nodes to access events and process subcriptions do not need to have
+ nearly so much permission.  Indeed, one could set up a <quote>weak
+ user</quote> assigned to all <xref linkend="stmtstorepath"> requests.
+ The minimal permissions that this user, let's call it
+ <command>weakuser</command>, requires are as follows:</para>
+ 
+ <itemizedlist>
+ <listitem><para> It must have read access to the &slony1;-specific namespace </para> </listitem>
+ <listitem><para> It must have read access to all tables and sequences in that namespace</para> </listitem>
+ <listitem><para> It must have write access to the &slony1; table <envar>sl_nodelock</envar> and sequence <envar>sl_nodelock_nl_conncnt_seq</envar> </para> </listitem>
+ <listitem><para> At subscribe time, it must have read access to all of the replicated tables. </para> 
+ <para> Outside of subscription time, there is no need for access to access to the replicated tables. </para> </listitem>
+ <listitem><para> There is some need for read access to tables in pg_catalog; it has not been verified how little access would be suitable. </para> </listitem>
+ </itemizedlist>
+ 
+ <para> In version 1.3, the tests in the <xref linkend="testbed">
+ support using a <envar>WEAKUSER</envar> so that testing can regularly
+ confirm the minimal set of permissions needed to support
+ replication.</para>
+ 
+ </listitem>
+ 
  <listitem><para> The section on <link linkend="listenpaths"> listen
  paths </link> discusses the issues surrounding the table <xref

Index: installation.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/installation.sgml,v
retrieving revision 1.28
retrieving revision 1.28.2.1
diff -C2 -d -r1.28 -r1.28.2.1
*** installation.sgml	17 Oct 2006 18:33:18 -0000	1.28
--- installation.sgml	16 Mar 2007 19:01:26 -0000	1.28.2.1
***************
*** 182,193 ****
  <listitem><para><filename> $datadir/slony1_base.v73.sql</filename></para></listitem>
  <listitem><para><filename> $datadir/slony1_base.v74.sql</filename></para></listitem>
  <listitem><para><filename> $datadir/slony1_funcs.sql</filename></para></listitem>
  <listitem><para><filename> $datadir/slony1_funcs.v73.sql</filename></para></listitem>
  <listitem><para><filename> $datadir/slony1_funcs.v74.sql</filename></para></listitem>
! <listitem><para><filename> $datadir/xxid.v73.sql </filename></para></listitem>
  </itemizedlist>
  
  <para>The <filename>.sql</filename> files are not fully substituted
! yet.  And yes, both the 7.3 and the 7.4 files get installed on every
  system, irrespective of its version.  The <xref linkend="slonik">
  admin utility does namespace/cluster substitutions within these files,
--- 182,194 ----
  <listitem><para><filename> $datadir/slony1_base.v73.sql</filename></para></listitem>
  <listitem><para><filename> $datadir/slony1_base.v74.sql</filename></para></listitem>
+ <listitem><para><filename> $datadir/slony1_base.v80.sql</filename></para></listitem>
  <listitem><para><filename> $datadir/slony1_funcs.sql</filename></para></listitem>
  <listitem><para><filename> $datadir/slony1_funcs.v73.sql</filename></para></listitem>
  <listitem><para><filename> $datadir/slony1_funcs.v74.sql</filename></para></listitem>
! <listitem><para><filename> $datadir/slony1_funcs.v80.sql</filename></para></listitem>
  </itemizedlist>
  
  <para>The <filename>.sql</filename> files are not fully substituted
! yet.  And yes, both the 7.3, 7.4 and the 8.0 files get installed on every
  system, irrespective of its version.  The <xref linkend="slonik">
  admin utility does namespace/cluster substitutions within these files,
***************
*** 308,311 ****
--- 309,327 ----
  &lt;service name&gt; &lt;config file&gt;</command>.</para> 
  
+ <para> For further information about the &windows; port, you may want
+ to see the following URLs: </para>
+ 
+ <itemizedlist>
+ 
+ <listitem><para> <ulink
+ url="http://developer.pgadmin.org/~hiroshi/Slony-I/"> Slony-I Windows
+ installer sample </ulink> </para> </listitem>
+ 
+ <listitem><para> <ulink url=
+ "http://people.planetpostgresql.org/xzilla/index.php?/archives/200-Alpha-testing-Slony-on-win32-Crib-Notes.html">
+ xzilla's Alpha testing Slony on win32 Crib Notes </ulink> </para> </listitem>
+ 
+ </itemizedlist>
+ 
  </sect2>
  

Index: help.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/help.sgml,v
retrieving revision 1.18.2.1
retrieving revision 1.18.2.2
diff -C2 -d -r1.18.2.1 -r1.18.2.2
*** help.sgml	27 Oct 2006 15:35:32 -0000	1.18.2.1
--- help.sgml	16 Mar 2007 19:01:26 -0000	1.18.2.2
***************
*** 76,82 ****
  Freshmeat on &slony1; </ulink></para></listitem>
  
- <listitem> <para><ulink url="http://www.slony2.org/wiki/index.php"> 
- Slony-II Wiki</ulink> </para> </listitem> 
- 
  </itemizedlist>
  </sect2>
--- 76,79 ----

Index: startslons.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/startslons.sgml,v
retrieving revision 1.19
retrieving revision 1.19.2.1
diff -C2 -d -r1.19 -r1.19.2.1
*** startslons.sgml	2 Aug 2006 18:34:59 -0000	1.19
--- startslons.sgml	16 Mar 2007 19:01:26 -0000	1.19.2.1
***************
*** 88,93 ****
  one point not preferable to run it whilst subscribing a very large
  replication set where it is expected to take many hours to do the
! initial <command>COPY SET</command>.  The problem that came up in that
! case was that it figured that since it hasn't done a
  <command>SYNC</command> in 2 hours, something was broken requiring
  restarting slon, thereby restarting the <command>COPY SET</command>
--- 88,94 ----
  one point not preferable to run it whilst subscribing a very large
  replication set where it is expected to take many hours to do the
! <command>COPY SET</command> (the main event that processes a
! <command>SUBSCRIBE SET</command> request).  The problem that came up
! in that case was that it figured that since it hasn't done a
  <command>SYNC</command> in 2 hours, something was broken requiring
  restarting slon, thereby restarting the <command>COPY SET</command>

Index: slonik_ref.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/slonik_ref.sgml,v
retrieving revision 1.61.2.4
retrieving revision 1.61.2.5
diff -C2 -d -r1.61.2.4 -r1.61.2.5
*** slonik_ref.sgml	31 Oct 2006 22:03:40 -0000	1.61.2.4
--- slonik_ref.sgml	16 Mar 2007 19:01:26 -0000	1.61.2.5
***************
*** 1265,1269 ****
       WAIT FOR EVENT (ORIGIN = 3, CONFIRMED = 1);
       SYNC (ID=1);
!      MERGE SET ( ID = 2, ADD ID = 9999, ORIGIN = 1 );
      </programlisting>
     </refsect1>
--- 1265,1269 ----
       WAIT FOR EVENT (ORIGIN = 3, CONFIRMED = 1);
       SYNC (ID=1);
!      MERGE SET ( ID = 1, ADD ID = 9999, ORIGIN = 1 );
      </programlisting>
     </refsect1>
***************
*** 1934,1953 ****
      </para>
      
!     <para> If the tables on the subscriber are <emphasis>not</emphasis> empty, then
!      the <command>COPY SET</command> process winds up doing more work than should be
!      strictly necessary:</para>
       <itemizedlist>
        
!       <listitem><para> It deletes all <quote>old</quote> entries in
!       the table</para></listitem>
  
!       <listitem><para> Those old entries
! 	clutter up the table until it is next
! 	<command>VACUUM</command>ed <emphasis>after</emphasis> the
! 	subscription process is complete</para></listitem>
        
        <listitem><para> The indices for the table will contain entries
! 	for the old, deleted entries, which will slow the process of
! 	inserting new entries into the index.</para></listitem>
       </itemizedlist>
  
--- 1934,1959 ----
      </para>
      
!     <para> If the tables on the subscriber are
!     <emphasis>not</emphasis> empty, then the <command>COPY
!     SET</command> event (which is part of the subscription process)
!     may wind up doing more work than should be strictly
!     necessary:</para>
       <itemizedlist>
+ 
+       <listitem><para> It attempts to <command>TRUNCATE</command> the
+       table, which will be efficient. </para> </listitem>
        
!       <listitem><para> If that fails (a foreign key relationship might
!       prevent TRUNCATE from working), it uses
!       <command>DELETE</command> to delete all <quote>old</quote>
!       entries in the table</para></listitem>
  
!       <listitem><para> Those old entries clutter up the table until it
!       is next <command>VACUUM</command>ed <emphasis>after</emphasis>
!       the subscription process is complete</para></listitem>
        
        <listitem><para> The indices for the table will contain entries
!       for the old, deleted entries, which will slow the process of
!       inserting new entries into the index.</para></listitem>
       </itemizedlist>
  
***************
*** 1960,1971 ****
  
       <para> The <command>SUBSCRIBE SET</command> request will,
!      nonetheless, return fairly much immediately, even though the work
!      is merely <quote>in progress.</quote> If you need to set up
!      subscriptions for a set of cascading nodes, you will need to wait
!      for each subscriber to complete subscribing before submitting
!      requests for subscriptions that use that node as a provider.  If
!      you don't, it won't be a big deal: <command>slonik</command> will
!      check the node, discover that it is not yet an active provider
!      for the set, and report back:</para>
  
  <programlisting>
--- 1966,1978 ----
  
       <para> The <command>SUBSCRIBE SET</command> request will,
!      nonetheless, return fairly much immediately, even though the
!      work, being handled by the <command>COPY SET</command> event, is
!      still in progress.  If you need to set up subscriptions for a set
!      of cascading nodes, you will need to wait for each subscriber to
!      complete subscribing before submitting requests for subscriptions
!      that use that node as a provider.  If you don't, it won't be a
!      big deal: <command>slonik</command> will check the node, discover
!      that it is not yet an active provider for the set, and report
!      back:</para>
  
  <programlisting>

Index: faq.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/faq.sgml,v
retrieving revision 1.66.2.3
retrieving revision 1.66.2.4
diff -C2 -d -r1.66.2.3 -r1.66.2.4
*** faq.sgml	2 Feb 2007 20:23:46 -0000	1.66.2.3
--- faq.sgml	16 Mar 2007 19:01:26 -0000	1.66.2.4
***************
*** 240,244 ****
  </screen></para></question>
  
- 
  <answer> <para> There is evidently some reasonably old outstanding
  transaction blocking &slony1; from processing the sync.  You might
--- 240,243 ----
***************
*** 1018,1022 ****
  
  <answer><para> Another would be to treat the node as having failed,
! and use the &slonik; command <xref linkend="stmtdropnode"> to drop the
  node, and recreate it.  If the database is heavily updated, it may
  well be cheaper to do this than it is to find a way to let it catch
--- 1017,1021 ----
  
  <answer><para> Another would be to treat the node as having failed,
! and use the &lslonik; command <xref linkend="stmtdropnode"> to drop the
  node, and recreate it.  If the database is heavily updated, it may
  well be cheaper to do this than it is to find a way to let it catch
***************
*** 1679,1685 ****
  index on the primary key, and leaves all indexes alone whilst using
  the &postgres; <command>COPY</command> command to load the data.
! Further hurting performane, the <command>COPY SET</command> event
! starts by deleting the contents of tables, which potentially leaves a
! lot of dead tuples
  </para>
  
--- 1678,1684 ----
  index on the primary key, and leaves all indexes alone whilst using
  the &postgres; <command>COPY</command> command to load the data.
! Further hurting performance, the <command>COPY SET</command> event (an
! event that the subscription process generates) starts by deleting the
! contents of tables, which leaves the table full of dead tuples.
  </para>
  

Index: releasechecklist.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/releasechecklist.sgml,v
retrieving revision 1.3.2.4
retrieving revision 1.3.2.5
diff -C2 -d -r1.3.2.4 -r1.3.2.5
*** releasechecklist.sgml	8 Nov 2006 19:49:25 -0000	1.3.2.4
--- releasechecklist.sgml	16 Mar 2007 19:01:26 -0000	1.3.2.5
***************
*** 7,42 ****
  <itemizedlist>
  
!   <listitem><para>Positive build reports for each supported platform -
!   although it is arguably less necessary for a comprehensive list if
!   we are releasing a minor upgrade </para></listitem> 
  
  <listitem><para>Some kind of Standard Test Plan</para></listitem> 
  <listitem><para>Binary RPM packages</para></listitem> 
  
! <listitem>
!  <para>If the release is a <quote>.0</quote> one, we need to
  open a new STABLE branch</para>
  
!  <para> <command> cvs tag -b REL_1_2_STABLE</command></para>
! </listitem>
! <listitem>
!  <para>Tag the with the release ID. For version 1.1.2, this
! would be <envar>REL_1_1_2 </envar></para>
  
!  <para> <command> cvs tag REL_1_1_2 </command></para>
! </listitem> 
  
! <listitem><para>Check out a copy via <command>cvs export -rREL_1_1_2 </command>
  
!   </para></listitem> 
  
  <listitem><para>Run <application>autoconf</application> so as to
  regenerate <filename>configure</filename> from
! <filename>configure.ac</filename>
  
-   </para></listitem> 
  <listitem><para>Purge directory <filename>autom4te.cache</filename> so it is not included in the build  </para></listitem> 
- <listitem><para>Purge out .cvsignore files; this can be done with the command <command> find . -name .cvsignore | xargs rm </command>  </para></listitem> 
  
  <listitem><para> Run <filename>tools/release_checklist.sh</filename> </para>
  
--- 7,59 ----
  <itemizedlist>
  
! <listitem><para>Positive build reports for each supported platform -
! although it is arguably less necessary for a comprehensive list if we
! are releasing a minor upgrade </para></listitem>
  
  <listitem><para>Some kind of Standard Test Plan</para></listitem> 
+ 
+ <listitem><para> If the release modified the set of version-specific
+ SQL files in <filename>src/backend</filename>
+ (<emphasis>e.g.</emphasis> - it added a new
+ <filename>slony1_base.v83.sql</filename> or
+ <filename>slony1_funcs.v83.sql</filename>), or if we have other
+ changes to the shape of &postgres; version support, the function
+ <function>load_slony_functions() </function> in
+ <filename>src/slonik/slonik.c</filename> needs to be revised to
+ reflect the new shape of things.</para> </listitem>
+ 
+ <listitem><para> The new release needs to be added to function
+ <function>upgradeSchema(text)</function> in
+ <filename>src/backend/slony1_funcs.sql</filename>. </para>
+ 
+ <para> This takes place in a <quote>cross-branch</quote> fashion; if
+ we add version 1.1.9, in the 1.1 branch, then version 1.1.9 needs to
+ be added to the 1.2 branch as well as to later branches
+ (<emphasis>e.g.</emphasis> - 1.3, 1.4, HEAD).  Earlier branches will
+ normally not need to be made aware of versions added to later
+ branches... </para> </listitem>
+ 
  <listitem><para>Binary RPM packages</para></listitem> 
  
! <listitem> <para>If the release is a <quote>.0</quote> one, we need to
  open a new STABLE branch</para>
  
! <para> <command> cvs tag -b REL_1_2_STABLE</command></para> </listitem>
  
! <listitem> <para>Tag the with the release ID. For version 1.1.2, this
! would be <envar>REL_1_1_2 </envar></para>
  
! <para> <command> cvs tag REL_1_1_2 </command></para> </listitem>
  
! <listitem><para>Check out a copy via <command>cvs export -rREL_1_1_2
! </command> </para></listitem>
  
  <listitem><para>Run <application>autoconf</application> so as to
  regenerate <filename>configure</filename> from
! <filename>configure.ac</filename></para></listitem> 
  
  <listitem><para>Purge directory <filename>autom4te.cache</filename> so it is not included in the build  </para></listitem> 
  
+ <listitem><para>Purge out .cvsignore files; this can be done with the command <command> find . -name .cvsignore | xargs rm </command>  </para></listitem> 
  <listitem><para> Run <filename>tools/release_checklist.sh</filename> </para>
  

Index: defineset.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/defineset.sgml,v
retrieving revision 1.25
retrieving revision 1.25.2.1
diff -C2 -d -r1.25 -r1.25.2.1
*** defineset.sgml	2 Aug 2006 18:34:57 -0000	1.25
--- defineset.sgml	16 Mar 2007 19:01:26 -0000	1.25.2.1
***************
*** 43,47 ****
  <emphasis>candidate</emphasis> primary key, that is, some index on a
  combination of fields that is both UNIQUE and NOT NULL, then you can
! specify the key, as in</para>
  
  <programlisting>
--- 43,47 ----
  <emphasis>candidate</emphasis> primary key, that is, some index on a
  combination of fields that is both UNIQUE and NOT NULL, then you can
! specify that key, as shown in the following example. </para>
  
  <programlisting>
***************
*** 52,55 ****
--- 52,69 ----
  </programlisting>
  
+ <para> However, once you have come this far, there is little reason not
+ to just declare some suitable index to be a primary key, which requires
+ that the columns involved are NOT NULL, and which will establish a unique
+ index. Here is an example of this: </para>
+ 
+ <programlisting>
+ DROP INDEX my_table_name_col1_col2_uniq_idx;
+ ALTER TABLE my_table_name ADD PRIMARY KEY (col1, col2);
+ </programlisting>
+ 
+ <para>If your application is not somehow referencing the index by name,
+ the this should not lose you anything, and it gives you the clear design
+ benefit that a primary key has been declared for the table. </para>
+ 
  <para> Notice that while you need to specify the namespace for the
  table, you must <emphasis>not</emphasis> specify the namespace for the
***************
*** 68,78 ****
  <para> It is not terribly important whether you pick a
  <quote>true</quote> primary key or a mere <quote>candidate primary
! key;</quote> it is, however, recommended that you have one of those
! instead of having &slony1; populate the PK column for you.  If you
! don't have a suitable primary key, that means that the table hasn't
! got any mechanism from your application's standpoint for keeping
! values unique.  &slony1; may therefore introduce a new failure mode
! for your application, and this also implies that you had a way to
! enter confusing data into the database.</para>
  </sect2>
  
--- 82,92 ----
  <para> It is not terribly important whether you pick a
  <quote>true</quote> primary key or a mere <quote>candidate primary
! key;</quote> it is, however, strongly recommended that you have one of
! those instead of having &slony1; populate the PK column for you. If you
! don't have a suitable primary key, that means that the table hasn't got
! any mechanism, from your application's standpoint, for keeping values
! unique. &slony1; may, therefore, introduce a new failure mode for your
! application, and this also implies that you had a way to enter confusing
! data into the database.</para>
  </sect2>
  

Index: slonconf.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/slonconf.sgml,v
retrieving revision 1.14.2.1
retrieving revision 1.14.2.2
diff -C2 -d -r1.14.2.1 -r1.14.2.2
*** slonconf.sgml	2 Feb 2007 20:23:46 -0000	1.14.2.1
--- slonconf.sgml	16 Mar 2007 19:01:26 -0000	1.14.2.2
***************
*** 87,91 ****
        </indexterm>
        <listitem>
!         <para>Debug log level (higher value ==> more output).  Range: [0,4], default 4</para>
        </listitem>
      </varlistentry>
--- 87,97 ----
        </indexterm>
        <listitem>
!         <para>Debug log level (higher value ==> more output).  Range: [0,4], default 2</para>
! 
! 	<para> There are <link linkend="nineloglevels">nine log
! 	message types</link>; using this option, some or all of
! 	the <quote>debugging</quote> levels may be left out of the
! 	slon logs. </para>
! 
        </listitem>
      </varlistentry>

Index: adminscripts.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/adminscripts.sgml,v
retrieving revision 1.40.2.7
retrieving revision 1.40.2.8
diff -C2 -d -r1.40.2.7 -r1.40.2.8
*** adminscripts.sgml	5 Jan 2007 19:28:48 -0000	1.40.2.7
--- adminscripts.sgml	16 Mar 2007 19:01:26 -0000	1.40.2.8
***************
*** 14,41 ****
  <indexterm><primary>altperl scripts for &slony1;</primary></indexterm>
  
! <para>In the <filename>altperl</filename> directory in the
! <application>CVS</application> tree, there is a sizable set of
! <application>Perl</application> scripts that may be used to administer
! a set of &slony1; instances, which support having arbitrary numbers of
! nodes.</para>
  
! <para>Most of them generate Slonik scripts that are then to be passed
! on to the <xref linkend="slonik"> utility to be submitted to all of
! the &slony1; nodes in a particular cluster.  At one time, this
! embedded running <xref linkend="slonik"> on the slonik scripts.
  Unfortunately, this turned out to be a pretty large calibre
  <quote>foot gun</quote>, as minor typos on the command line led, on a
! couple of occasions, to pretty calamitous actions, so the behavior has
! been changed so that the scripts simply submit output to standard
! output.  The savvy administrator should review the script
! <emphasis>before</emphasis> submitting it to <xref
! linkend="slonik">.</para>
  
! <sect3><title>Node/Cluster Configuration - cluster.nodes</title>
! <indexterm><primary>cluster.nodes - node/cluster configuration for Perl tools</primary></indexterm>
  
  <para>The UNIX environment variable <envar>SLONYNODES</envar> is used
  to determine what Perl configuration file will be used to control the
! shape of the nodes in a &slony1; cluster.</para>
  
  <para>What variables are set up.
--- 14,49 ----
  <indexterm><primary>altperl scripts for &slony1;</primary></indexterm>
  
! <para>There is a set of scripts to simplify administeration
! of set of &slony1; instances. The scripts support having arbitrary numbers of
! nodes. They may be installed as part of the installation process:</para>
  
! <para><command>
!  ./configure --with-perltools
! </command></para>
! 
! <para>This will produce a number of scripts with the prefix
! <command>slonik_</command>.  They eliminate tedium by always referring
! to a central configuration file for the details of your site
! configuration. A documented sample of this file is provided in
! <filename>altperl/slon_tools.conf-sample</filename>. Most also include
! some command line help with the "--help" option, making them easier to
! learn and use.
! </para>
! 
! <para>Most generate Slonik scripts that are printed to STDOUT. 
! At one time, the commands were passed directly to <xref linkend="slonik"> for execution. 
  Unfortunately, this turned out to be a pretty large calibre
  <quote>foot gun</quote>, as minor typos on the command line led, on a
! couple of occasions, to pretty calamitous actions. The savvy administrator should review the script
! <emphasis>before</emphasis> piping it to <xref linkend="slonik">.</para>
  
! <sect3><title>Support for Multiple Clusters</title>
! <indexterm><primary>Multiple Cluster support for the altperl tools</primary></indexterm>
  
  <para>The UNIX environment variable <envar>SLONYNODES</envar> is used
  to determine what Perl configuration file will be used to control the
! shape of the nodes in a &slony1; cluster. If it is not provided, a
! default <filename>slon_tools.conf</filename> location will be
! referenced. </para>
  
  <para>What variables are set up.
***************
*** 85,88 ****
--- 93,97 ----
  </programlisting>
  </sect3>
+ 
  <sect3><title>Set configuration - cluster.set1, cluster.set2</title>
  <indexterm><primary>cluster.set1 - replication set configuration for Perl tools</primary></indexterm>
***************
*** 98,130 ****
  control what tables will be in a particular replication set.</para>
  
- <para>What variables are set up.</para>
- <itemizedlist>
- <listitem><para>$TABLE_ID = 44;</para>
- <para> Each table must be identified by a unique number; this variable controls where numbering starts</para>
- </listitem>
- <listitem><para>$SEQUENCE_ID = 17;</para>
- <para> Each sequence must be identified by a unique number; this variable controls where numbering starts</para>
- </listitem>
- <listitem><para>@PKEYEDTABLES</para>
- 
- <para> An array of names of tables to be replicated that have a
- defined primary key so that &slony1; can automatically select its key</para>
- </listitem>
- <listitem><para>%KEYEDTABLES</para>
- <para> A hash table of tables to be replicated, where the hash index
- is the table name, and the hash value is the name of a unique not null
- index suitable as a "candidate primary key."</para>
- </listitem>
- <listitem><para>@SERIALTABLES</para>
- 
- <para> An array of names of tables to be replicated that have no
- candidate for primary key.  &slony1; will add a key field based on a
- sequence that &slony1; generates</para>
- </listitem>
- <listitem><para>@SEQUENCES</para>
- 
- <para> An array of names of sequences that are to be replicated</para>
- </listitem>
- </itemizedlist>
  </sect3>
  <sect3><title>slonik_build_env</title>
--- 107,110 ----
***************
*** 536,539 ****
--- 516,520 ----
  use...</para>
  </sect3>
+ 
  <sect3><title>Node-Specific Values</title>
  
***************
*** 649,652 ****
--- 630,643 ----
  </sect3>
  </sect2>
+ 
+ <sect2 id="bsd-ports-profile"> <title> <filename> slon.in-profiles </filename> </title>
+ <subtitle> Apache-Style profiles for FreeBSD <filename>ports/databases/slony/*</filename> </subtitle>
+ 
+ <para> In the tools area, <filename>slon.in-profiles</filename> is a
+ script that might be used to start up &lslon; instances at the time of
+ system startup.  It is designed to interact with the FreeBSD Ports
+ system.</para>
+ 
+ </sect2>
  </sect1>
  <!-- Keep this comment at the end of the file

Index: slon.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/slon.sgml,v
retrieving revision 1.29
retrieving revision 1.29.2.1
diff -C2 -d -r1.29 -r1.29.2.1
*** slon.sgml	2 Aug 2006 18:34:59 -0000	1.29
--- slon.sgml	16 Mar 2007 19:01:26 -0000	1.29.2.1
***************
*** 41,54 ****
    <variablelist>
     <varlistentry>
!     <term><option>-d</option><replaceable class="parameter"> debuglevel</replaceable></term>
      <listitem>
       <para>
!       The <envar>log_level</envar> specifies which Debug levels
        <application>slon</application> should display when logging its
        activity.
       </para>
!      <para>
!       The eight levels of logging are:
        <itemizedlist>
         <listitem><para>Error</para></listitem>
         <listitem><para>Warn</para></listitem>
--- 41,55 ----
    <variablelist>
     <varlistentry>
!     <term><option>-d</option><replaceable class="parameter"> log_level</replaceable></term>
      <listitem>
       <para>
!       The <envar>log_level</envar> specifies which levels of debugging messages
        <application>slon</application> should display when logging its
        activity.
       </para>
!      <para id="nineloglevels">
!       The nine levels of logging are:
        <itemizedlist>
+        <listitem><para>Fatal</para></listitem>
         <listitem><para>Error</para></listitem>
         <listitem><para>Warn</para></listitem>
***************
*** 61,69 ****
        </itemizedlist>
       </para>
!      <para> Thus, <emphasis>all</emphasis> the non-debugging log
!      levels are always displayed in the logs.  If
!      <envar>log_level</envar> is set to 2 (a routine, and, seemingly
       preferable choice), then output at debugging levels 1 and 2 will
       also be displayed.</para>
      </listitem>
     </varlistentry>
--- 62,72 ----
        </itemizedlist>
       </para>
! 
!      <para> The first five non-debugging log levels (from Fatal to
!      Info) are <emphasis>always</emphasis> displayed in the logs.  If
!      <envar>log_level</envar> is set to 2 (a routine, and, seemingly,
       preferable choice), then output at debugging levels 1 and 2 will
       also be displayed.</para>
+ 
      </listitem>
     </varlistentry>

Index: addthings.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/addthings.sgml,v
retrieving revision 1.23.2.3
retrieving revision 1.23.2.4
diff -C2 -d -r1.23.2.3 -r1.23.2.4
*** addthings.sgml	7 Nov 2006 20:34:17 -0000	1.23.2.3
--- addthings.sgml	16 Mar 2007 19:01:26 -0000	1.23.2.4
***************
*** 135,138 ****
--- 135,149 ----
  linkend="stmtddlscript">.</para>
  
+ <para> Alternatively, if you have the <link linkend="altperl"> altperl
+ scripts </link> installed, you may use
+ <command>slonik_execute_script</command> for this purpose: </para>
+ 
+ <para> <command> slonik_execute_script [options] set#
+ full_path_to_sql_script_file </command></para>
+ 
+ <para> See <command>slonik_execute_script -h</command> for further
+ options; note that this uses <xref linkend="stmtddlscript">
+ underneath. </para>
+ 
  <para> There are a number of <quote>sharp edges</quote> to note...</para>
  

From cbbrowne at lists.slony.info  Fri Mar 16 15:34:49 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Fri Mar 16 15:34:51 2007
Subject: [Slony1-commit] slony1-engine RELEASE-1.2.8
Message-ID: <20070316223449.159F4290453@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine
In directory main.slony.info:/tmp/cvs-serv30452

Modified Files:
      Tag: REL_1_2_STABLE
	RELEASE-1.2.8 
Log Message:
Also added documentation to release candidate section so that hopefully
we can avoid the version mismatch problems in slonik.c in future.


Index: RELEASE-1.2.8
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/Attic/RELEASE-1.2.8,v
retrieving revision 1.1.2.4
retrieving revision 1.1.2.5
diff -C2 -d -r1.1.2.4 -r1.1.2.5
*** RELEASE-1.2.8	15 Mar 2007 18:52:01 -0000	1.1.2.4
--- RELEASE-1.2.8	16 Mar 2007 22:34:46 -0000	1.1.2.5
***************
*** 9,10 ****
--- 9,12 ----
  
  - Fix to src/slonik/slonik.c - it wasn't pulling in the right version of slony1_funcs.?.sql in some cases
+ 
+ - Updated docs on creating releases to describe the version mismatch problem found above in slonik.c
\ No newline at end of file

From cbbrowne at lists.slony.info  Fri Mar 16 15:38:03 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Fri Mar 16 15:38:04 2007
Subject: [Slony1-commit] slony1-engine/src/slonik slonik.c
Message-ID: <20070316223803.B7041290432@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/src/slonik
In directory main.slony.info:/tmp/cvs-serv30497/src/slonik

Modified Files:
	slonik.c 
Log Message:
Fix up handling of PG version numbers in slonik.c as done in 1.1 and 1.2 branches


Index: slonik.c
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/slonik/slonik.c,v
retrieving revision 1.73
retrieving revision 1.74
diff -C2 -d -r1.73 -r1.74
*** slonik.c	8 Feb 2007 18:01:15 -0000	1.73
--- slonik.c	16 Mar 2007 22:38:01 -0000	1.74
***************
*** 1874,1878 ****
  	{
  		printf("%s:%d: unsupported PostgreSQL "
! 			"version %d.%d (try Slony-I 1.1.5)\n",
  			stmt->stmt_filename, stmt->stmt_lno,
  			(adminfo->pg_version/10000), ((adminfo->pg_version%10000)/100));
--- 1874,1878 ----
  	{
  		printf("%s:%d: unsupported PostgreSQL "
! 			"version %d.%d (try Slony-I 1.1.8)\n",
  			stmt->stmt_filename, stmt->stmt_lno,
  			(adminfo->pg_version/10000), ((adminfo->pg_version%10000)/100));
***************
*** 1983,1997 ****
                  use_minor = 4;
          }
!         else if ((adminfo->pg_version >= 70500) && adminfo->pg_version < 80300) /* 8.0, 8.1 and 8.2 */
          {
                  use_major = 8;
                  use_minor = 0;
          }
          else    /* 8.3 and above */
          {
                  use_major = 8;
!                 use_minor = 0;
                  printf("%s:%d: Possible unsupported PostgreSQL "
!                         "version %d.%d, defaulting to 8.0 support\n",
                          stmt->stmt_filename, stmt->stmt_lno,
                          (adminfo->pg_version/10000), ((adminfo->pg_version%10000)/100));
--- 1983,2002 ----
                  use_minor = 4;
          }
!         else if ((adminfo->pg_version >= 70500) && adminfo->pg_version < 80100) /* 8.0 */
          {
                  use_major = 8;
                  use_minor = 0;
          }
+         else if ((adminfo->pg_version >= 80100) && adminfo->pg_version < 80300) /* 8.1, 8.2 */
+         {
+                 use_major = 8;
+                 use_minor = 1;
+         }
          else    /* 8.3 and above */
          {
                  use_major = 8;
!                 use_minor = 1;
                  printf("%s:%d: Possible unsupported PostgreSQL "
!                         "version %d.%d, defaulting to 8.1 support\n",
                          stmt->stmt_filename, stmt->stmt_lno,
                          (adminfo->pg_version/10000), ((adminfo->pg_version%10000)/100));

From cbbrowne at lists.slony.info  Fri Mar 16 16:01:46 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Fri Mar 16 16:01:47 2007
Subject: [Slony1-commit] slony1-www/content frontpage.txt news.txt
Message-ID: <20070316230146.2F8D7290438@main.slony.info>

Update of /home/cvsd/slony1/slony1-www/content
In directory main.slony.info:/tmp/cvs-serv30793

Modified Files:
	frontpage.txt news.txt 
Log Message:
Record versions 1.1.8, 1.2.8


Index: frontpage.txt
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/content/frontpage.txt,v
retrieving revision 1.5
retrieving revision 1.6
diff -C2 -d -r1.5 -r1.6
*** frontpage.txt	8 Mar 2007 05:35:57 -0000	1.5
--- frontpage.txt	16 Mar 2007 23:01:44 -0000	1.6
***************
*** 1,3 ****
--- 1,48 ----
  ---
+ Slony-I Release - 1.2.8
+ http://main.slony.info/downloads/1.2
+ 2007-03-16
+ Chris Browne
+ We are pleased to announce the release of version 1.2.8, which may be
+ found <a href="http://main.slony.info/downloads/1.2/slony1-1.2.8.tar.bz2">here</a>.  
+ There is also a <a href="http://main.slony.info/downloads/1.2/slony1-1.2.8-docs.tar.bz2">Documentation tarball </a>.
+ 
+ <P> This release fixes several problems that were found in the 1.2 stream:
+ <ul>
+ <li> Change to rotatelogs configuration to support older versions of Apache
+ log rotator
+ 
+ <li> Fix to altperl "execute script" script to pass the filename properly
+ 
+ <li> Fix to <tt>src/backend/slony1_funcs.v80.sql</tt> - comment on the right function in v8.0
+ 
+ <li> Fix to <tt>src/slonik/slonik.c</tt> - it wasn't pulling in the right version of slony1_funcs.?.sql in some cases (notably with versions 8.1 and 8.2)
+ 
+ <li> Updated docs on creating releases to describe the version mismatch problem found above in <tt>slonik.c</tt>
+ </ul>
+ ---
+ Slony-I Release - 1.1.8
+ http://main.slony.info/downloads/1.1
+ 2007-03-16
+ Chris Browne
+ We are pleased to announce the release of version 1.1.8, which may be
+ found <a href="http://main.slony.info/downloads/1.1/slony1-1.1.8.tar.bz2">here</a>.  
+ 
+ <P> This release fixes several problems that were found in the 1.1 stream:
+ <ul>
+ <li> Change to rotatelogs configuration to support older versions of Apache
+ log rotator
+ 
+ <li> Fix to altperl "execute script" script to pass the filename properly
+ 
+ <li> Fix to xxid Makefile: in the 1.1 branch, xxid.v73.sql is still in
+ use, and should be copied to generate the other versions.
+ 
+ <li> Fix to <tt>src/backend/slony1_funcs.v80.sql</tt> - comment on the right function in v8.0
+ 
+ <li> Fix to <tt>src/slonik/slonik.c</tt> - it wasn't pulling in the right version of slony1_funcs.?.sql in some cases (notably with versions 8.1 and 8.2)
+ 
+ </ul>
+ ---
  Slony-I Release - 1.2.7
  http://main.slony.info/downloads/1.2

Index: news.txt
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/content/news.txt,v
retrieving revision 1.10
retrieving revision 1.11
diff -C2 -d -r1.10 -r1.11
*** news.txt	8 Mar 2007 05:35:57 -0000	1.10
--- news.txt	16 Mar 2007 23:01:44 -0000	1.11
***************
*** 4,13 ****
  2007-02-28
  Chris Browne
! Slony-1 1.2.7 <a href="http://main.slony.info/downloads/1.2/slony1-1.2.7.tar.bz2">engine</a>
! <a href="http://main.slony.info/downloads/1.2/slony1-1.2.7-docs.tar.bz2">documentation</a>
  <br />
! Slony-1 1.1.7 <a href="http://main.slony.info/downloads/1.1/slony1-1.1.7.tar.bz2">engine</a>
  <!-- Please keep this item at the top of the news list -->
  ---
  Slony-I Release - 1.2.7
  http://main.slony.info/downloads/1.2
--- 4,58 ----
  2007-02-28
  Chris Browne
! Slony-1 1.2.8 <a href="http://main.slony.info/downloads/1.2/slony1-1.2.8.tar.bz2">engine</a>
! <a href="http://main.slony.info/downloads/1.2/slony1-1.2.8-docs.tar.bz2">documentation</a>
  <br />
! Slony-1 1.1.8 <a href="http://main.slony.info/downloads/1.1/slony1-1.1.8.tar.bz2">engine</a>
  <!-- Please keep this item at the top of the news list -->
  ---
+ Slony-I Release - 1.2.8
+ http://main.slony.info/downloads/1.2
+ 2007-03-16
+ Chris Browne
+ We are pleased to announce the release of version 1.2.8, which may be
+ found <a href="http://main.slony.info/downloads/1.2/slony1-1.2.8.tar.bz2">here</a>.  
+ There is also a <a href="http://main.slony.info/downloads/1.2/slony1-1.2.8-docs.tar.bz2">Documentation tarball </a>.
+ 
+ <P> This release fixes several problems that were found in the 1.2 stream:
+ <ul>
+ <li> Change to rotatelogs configuration to support older versions of Apache
+ log rotator
+ 
+ <li> Fix to altperl "execute script" script to pass the filename properly
+ 
+ <li> Fix to <tt>src/backend/slony1_funcs.v80.sql</tt> - comment on the right function in v8.0
+ 
+ <li> Fix to <tt>src/slonik/slonik.c</tt> - it wasn't pulling in the right version of slony1_funcs.?.sql in some cases (notably with versions 8.1 and 8.2)
+ 
+ <li> Updated docs on creating releases to describe the version mismatch problem found above in <tt>slonik.c</tt>
+ </ul>
+ ---
+ Slony-I Release - 1.1.8
+ http://main.slony.info/downloads/1.1
+ 2007-03-16
+ Chris Browne
+ We are pleased to announce the release of version 1.1.8, which may be
+ found <a href="http://main.slony.info/downloads/1.1/slony1-1.1.8.tar.bz2">here</a>.  
+ 
+ <P> This release fixes several problems that were found in the 1.1 stream:
+ <ul>
+ <li> Change to rotatelogs configuration to support older versions of Apache
+ log rotator
+ 
+ <li> Fix to altperl "execute script" script to pass the filename properly
+ 
+ <li> Fix to xxid Makefile: in the 1.1 branch, xxid.v73.sql is still in
+ use, and should be copied to generate the other versions.
+ 
+ <li> Fix to <tt>src/backend/slony1_funcs.v80.sql</tt> - comment on the right function in v8.0
+ 
+ <li> Fix to <tt>src/slonik/slonik.c</tt> - it wasn't pulling in the right version of slony1_funcs.?.sql in some cases (notably with versions 8.1 and 8.2)
+ 
+ </ul>
+ ---
  Slony-I Release - 1.2.7
  http://main.slony.info/downloads/1.2

From xfade at lists.slony.info  Tue Mar 20 09:20:20 2007
From: xfade at lists.slony.info (Niels Breet)
Date: Tue Mar 20 09:20:22 2007
Subject: [Slony1-commit] slony1-engine/src/backend slony1_funcs.sql
Message-ID: <20070320162020.7FBD12903FB@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/src/backend
In directory main.slony.info:/tmp/cvs-serv5536

Modified Files:
      Tag: REL_1_2_STABLE
	slony1_funcs.sql 
Log Message:
Fix typo in slony1_funcs.sql which caused UPDATE FUNCTIONS to fail. Reported by Khovrine Mikhael de.

Index: slony1_funcs.sql
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/backend/slony1_funcs.sql,v
retrieving revision 1.98.2.11
retrieving revision 1.98.2.12
diff -C2 -d -r1.98.2.11 -r1.98.2.12
*** slony1_funcs.sql	16 Mar 2007 14:43:00 -0000	1.98.2.11
--- slony1_funcs.sql	20 Mar 2007 16:20:18 -0000	1.98.2.12
***************
*** 5807,5811 ****
  	-- Changes for 1.2
  	-- ----
! 	if p_old IN (''1.0.2'', ''1.0.5'', ''1.0.6'', ''1.1.0'', ''1.1.1'', ''1.1.2'', ''1.1.3'',''1.1.5'', ''1.1.6'', "1.1.7", "1.1.8") then
  		-- Add new table sl_registry
  		execute ''create table @NAMESPACE@.sl_registry (
--- 5807,5811 ----
  	-- Changes for 1.2
  	-- ----
! 	if p_old IN (''1.0.2'', ''1.0.5'', ''1.0.6'', ''1.1.0'', ''1.1.1'', ''1.1.2'', ''1.1.3'',''1.1.5'', ''1.1.6'', ''1.1.7'', ''1.1.8'') then
  		-- Add new table sl_registry
  		execute ''create table @NAMESPACE@.sl_registry (

From cbbrowne at lists.slony.info  Tue Mar 20 11:16:50 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Mar 20 11:16:52 2007
Subject: [Slony1-commit] slony1-engine/src/backend slony1_base.v81.sql
	slony1_funcs.v81.sql
Message-ID: <20070320181650.DD498290062@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/src/backend
In directory main.slony.info:/tmp/cvs-serv6438

Added Files:
      Tag: REL_1_1_STABLE
	slony1_base.v81.sql slony1_funcs.v81.sql 
Log Message:
Add in base/funcs files for PG v8.1


--- NEW FILE: slony1_base.v81.sql ---
-- ----------------------------------------------------------------------
-- slony1_base.v81.sql
--
--    Version 8.1 specific parts of the basic replication schema.
--
--	Copyright (c) 2003-2006, PostgreSQL Global Development Group
--	Author: Jan Wieck, Afilias USA INC.
--
-- $Id: slony1_base.v81.sql,v 1.1.4.1 2007-03-20 18:16:48 cbbrowne Exp $
-- ----------------------------------------------------------------------



--- NEW FILE: slony1_funcs.v81.sql ---
-- ----------------------------------------------------------------------
-- slony1_funcs.v81.sql
--
--    Version 8.1 specific part of the replication support functions.
--
--	Copyright (c) 2003-2004, PostgreSQL Global Development Group
--	Author: Jan Wieck, Afilias USA INC.
--
-- $Id: slony1_funcs.v81.sql,v 1.1.4.1 2007-03-20 18:16:48 cbbrowne Exp $
-- ----------------------------------------------------------------------

-- ----------------------------------------------------------------------
-- FUNCTION prepareTableForCopy(tab_id)
--
--	Remove all content from a table before the subscription
--	content is loaded via COPY and disable index maintenance.
-- ----------------------------------------------------------------------
create or replace function @NAMESPACE@.prepareTableForCopy(int4)
returns int4
as '
declare
	p_tab_id		alias for $1;
	v_tab_oid		oid;
	v_tab_fqname	text;
begin
	-- ----
	-- Get the OID and fully qualified name for the table
	-- ---
	select	PGC.oid,
			@NAMESPACE@.slon_quote_brute(PGN.nspname) || ''.'' ||
			@NAMESPACE@.slon_quote_brute(PGC.relname) as tab_fqname
		into v_tab_oid, v_tab_fqname
			from @NAMESPACE@.sl_table T,   
				"pg_catalog".pg_class PGC, "pg_catalog".pg_namespace PGN
				where T.tab_id = p_tab_id
				and T.tab_reloid = PGC.oid
				and PGC.relnamespace = PGN.oid;
	if not found then
		raise exception ''Table with ID % not found in sl_table'', p_tab_id;
	end if;

	-- ----
	-- Setting pg_class.relhasindex to false will cause copy not to
	-- maintain any indexes. At the end of the copy we will reenable
	-- them and reindex the table. This bulk creating of indexes is
	-- faster.
	-- ----
	update pg_class set relhasindex = ''f'' where oid = v_tab_oid;

	-- ----
	-- Try using truncate to empty the table and fallback to
	-- delete on error.
	-- ----
	execute ''truncate '' || @NAMESPACE@.slon_quote_input(v_tab_fqname);
	raise notice ''truncate of % succeeded'', v_tab_fqname;
	return 1;
	exception when others then
		raise notice ''truncate of % failed - doing delete'', v_tab_fqname;
		update pg_class set relhasindex = ''f'' where oid = v_tab_oid;
		execute ''delete from only '' || @NAMESPACE@.slon_quote_input(v_tab_fqname);
		return 0;
end;
' language plpgsql;

comment on function @NAMESPACE@.prepareTableForCopy(int4) is
'Delete all data and suppress index maintenance';

-- ----------------------------------------------------------------------
-- FUNCTION finishTableAfterCopy(tab_id)
--
--	Reenable index maintenance and reindex the table after COPY.
-- ----------------------------------------------------------------------
create or replace function @NAMESPACE@.finishTableAfterCopy(int4)
returns int4
as '
declare
	p_tab_id		alias for $1;
	v_tab_oid		oid;
	v_tab_fqname	text;
begin
	-- ----
	-- Get the tables OID and fully qualified name
	-- ---
	select	PGC.oid,
			@NAMESPACE@.slon_quote_brute(PGN.nspname) || ''.'' ||
			@NAMESPACE@.slon_quote_brute(PGC.relname) as tab_fqname
		into v_tab_oid, v_tab_fqname
			from @NAMESPACE@.sl_table T,   
				"pg_catalog".pg_class PGC, "pg_catalog".pg_namespace PGN
				where T.tab_id = p_tab_id
				and T.tab_reloid = PGC.oid
				and PGC.relnamespace = PGN.oid;
	if not found then
		raise exception ''Table with ID % not found in sl_table'', p_tab_id;
	end if;

	-- ----
	-- Reenable indexes and reindex the table.
	-- ----
	update pg_class set relhasindex = ''t'' where oid = v_tab_oid;
	execute ''reindex table '' || @NAMESPACE@.slon_quote_input(v_tab_fqname);

	return 1;
end;
' language plpgsql;

comment on function @NAMESPACE@.finishTableAfterCopy(int4) is
'Reenable index maintenance and reindex the table';

create or replace function @NAMESPACE@.pre74()
returns integer
as 'select 0' language sql;

comment on function @NAMESPACE@.pre74() is 
'Returns 1/0 based on whether or not the DB is running a
version earlier than 7.4';

create or replace function @NAMESPACE@.make_function_strict (text, text) returns void as
'
declare
   fun alias for $1;
   parms alias for $2;
   stmt text;
begin
   stmt := ''ALTER FUNCTION "_@CLUSTERNAME@".'' || fun || '' '' || parms || '' STRICT;'';
   execute stmt;
   return;
end
' language plpgsql;

comment on function @NAMESPACE@.make_function_strict (text, text) is
'Equivalent to 8.1+ ALTER FUNCTION ... STRICT';

From cbbrowne at lists.slony.info  Wed Mar 21 08:11:14 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Wed Mar 21 08:11:16 2007
Subject: [Slony1-commit] slony1-engine/tools/altperl
	old-apache-rotatelogs.patch slon-tools.pm
Message-ID: <20070321151114.8A46F290048@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/tools/altperl
In directory main.slony.info:/tmp/cvs-serv12526

Modified Files:
	slon-tools.pm 
Added Files:
	old-apache-rotatelogs.patch 
Log Message:
Revert support for old apache rotatelogs; add in a patch that allows
those that need it to add it...


--- NEW FILE: old-apache-rotatelogs.patch ---
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tools/altperl/slon-tools.pm,v
retrieving revision 1.23.2.1
retrieving revision 1.23.2.2
diff -C2 -d -r1.23.2.1 -r1.23.2.2
*** slon-tools.pm	25 Jul 2005 21:49:38 -0000	1.23.2.1
--- slon-tools.pm	12 Mar 2007 22:17:54 -0000	1.23.2.2
***************
*** 139,143 ****
    my $cmd = "@@PGBINDIR@@/slon -s $SYNC_CHECK_INTERVAL -d2 $CLUSTER_NAME '$dsn' 2>&1 ";
    if ($APACHE_ROTATOR) {
!     $cmd .= "| $APACHE_ROTATOR \"$LOGDIR/slony1/node$nodenum/" .  $dbname . "_%Y-%m-%d_%H:%M:%S.log\" 10M &";
    } else {
      my $now=`date '+%Y-%m-%d_%H:%M:%S'`;
--- 139,143 ----
    my $cmd = "@@PGBINDIR@@/slon -s $SYNC_CHECK_INTERVAL -d2 $CLUSTER_NAME '$dsn' 2>&1 ";
    if ($APACHE_ROTATOR) {
!     $cmd .= "| $APACHE_ROTATOR \"$LOGDIR/slony1/node$nodenum/" .  $dbname . "_%Y-%m.log\" 86400 &";
    } else {
      my $now=`date '+%Y-%m-%d_%H:%M:%S'`;

Index: slon-tools.pm
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tools/altperl/slon-tools.pm,v
retrieving revision 1.30
retrieving revision 1.31
diff -C2 -d -r1.30 -r1.31
*** slon-tools.pm	12 Mar 2007 22:16:49 -0000	1.30
--- slon-tools.pm	21 Mar 2007 15:11:12 -0000	1.31
***************
*** 136,140 ****
    my $cmd = "@@SLONBINDIR@@/slon -s $SYNC_CHECK_INTERVAL -d$DEBUGLEVEL $CLUSTER_NAME '$dsn' 2>&1 ";
    if ($APACHE_ROTATOR) {
!     $cmd .= "| $APACHE_ROTATOR \"$LOGDIR/slony1/node$nodenum/" .  $dbname . "_%Y-%m.log\" 86400 &";
    } else {
      my $now=`date '+%Y-%m-%d_%H:%M:%S'`;
--- 136,140 ----
    my $cmd = "@@SLONBINDIR@@/slon -s $SYNC_CHECK_INTERVAL -d$DEBUGLEVEL $CLUSTER_NAME '$dsn' 2>&1 ";
    if ($APACHE_ROTATOR) {
!     $cmd .= "| $APACHE_ROTATOR \"$LOGDIR/slony1/node$nodenum/" .  $dbname . "_%Y-%m-%d_%H:%M:%S.log\" 10M &";
    } else {
      my $now=`date '+%Y-%m-%d_%H:%M:%S'`;

From cbbrowne at lists.slony.info  Wed Mar 21 08:11:36 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Wed Mar 21 08:11:37 2007
Subject: [Slony1-commit] slony1-engine/tools/altperl
	old-apache-rotatelogs.patch slon-tools.pm
Message-ID: <20070321151136.295652903F0@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/tools/altperl
In directory main.slony.info:/tmp/cvs-serv12596

Modified Files:
      Tag: REL_1_2_STABLE
	slon-tools.pm 
Added Files:
      Tag: REL_1_2_STABLE
	old-apache-rotatelogs.patch 
Log Message:
Revert support for old apache rotatelogs; add in a patch that allows
those that need it to add it...


--- NEW FILE: old-apache-rotatelogs.patch ---
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tools/altperl/slon-tools.pm,v
retrieving revision 1.23.2.1
retrieving revision 1.23.2.2
diff -C2 -d -r1.23.2.1 -r1.23.2.2
*** slon-tools.pm	25 Jul 2005 21:49:38 -0000	1.23.2.1
--- slon-tools.pm	12 Mar 2007 22:17:54 -0000	1.23.2.2
***************
*** 139,143 ****
    my $cmd = "@@PGBINDIR@@/slon -s $SYNC_CHECK_INTERVAL -d2 $CLUSTER_NAME '$dsn' 2>&1 ";
    if ($APACHE_ROTATOR) {
!     $cmd .= "| $APACHE_ROTATOR \"$LOGDIR/slony1/node$nodenum/" .  $dbname . "_%Y-%m-%d_%H:%M:%S.log\" 10M &";
    } else {
      my $now=`date '+%Y-%m-%d_%H:%M:%S'`;
--- 139,143 ----
    my $cmd = "@@PGBINDIR@@/slon -s $SYNC_CHECK_INTERVAL -d2 $CLUSTER_NAME '$dsn' 2>&1 ";
    if ($APACHE_ROTATOR) {
!     $cmd .= "| $APACHE_ROTATOR \"$LOGDIR/slony1/node$nodenum/" .  $dbname . "_%Y-%m.log\" 86400 &";
    } else {
      my $now=`date '+%Y-%m-%d_%H:%M:%S'`;

Index: slon-tools.pm
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tools/altperl/slon-tools.pm,v
retrieving revision 1.26.2.3
retrieving revision 1.26.2.4
diff -C2 -d -r1.26.2.3 -r1.26.2.4
*** slon-tools.pm	12 Mar 2007 22:17:19 -0000	1.26.2.3
--- slon-tools.pm	21 Mar 2007 15:11:34 -0000	1.26.2.4
***************
*** 136,140 ****
    my $cmd = "@@SLONBINDIR@@/slon -s $SYNC_CHECK_INTERVAL -d2 $CLUSTER_NAME '$dsn' 2>&1 ";
    if ($APACHE_ROTATOR) {
!     $cmd .= "| $APACHE_ROTATOR \"$LOGDIR/slony1/node$nodenum/" .  $dbname . "_%Y-%m.log\" 86400 &";
    } else {
      my $now=`date '+%Y-%m-%d_%H:%M:%S'`;
--- 136,140 ----
    my $cmd = "@@SLONBINDIR@@/slon -s $SYNC_CHECK_INTERVAL -d2 $CLUSTER_NAME '$dsn' 2>&1 ";
    if ($APACHE_ROTATOR) {
!     $cmd .= "| $APACHE_ROTATOR \"$LOGDIR/slony1/node$nodenum/" .  $dbname . "_%Y-%m-%d_%H:%M:%S.log\" 10M &";
    } else {
      my $now=`date '+%Y-%m-%d_%H:%M:%S'`;

From cbbrowne at lists.slony.info  Wed Mar 21 08:11:54 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Wed Mar 21 08:11:55 2007
Subject: [Slony1-commit] slony1-engine/tools/altperl
	old-apache-rotatelogs.patch slon-tools.pm
Message-ID: <20070321151154.505492902D0@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/tools/altperl
In directory main.slony.info:/tmp/cvs-serv12614

Modified Files:
      Tag: REL_1_1_STABLE
	slon-tools.pm 
Added Files:
      Tag: REL_1_1_STABLE
	old-apache-rotatelogs.patch 
Log Message:
Revert support for old apache rotatelogs; add in a patch that allows
those that need it to add it...


--- NEW FILE: old-apache-rotatelogs.patch ---
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tools/altperl/slon-tools.pm,v
retrieving revision 1.23.2.1
retrieving revision 1.23.2.2
diff -C2 -d -r1.23.2.1 -r1.23.2.2
*** slon-tools.pm	25 Jul 2005 21:49:38 -0000	1.23.2.1
--- slon-tools.pm	12 Mar 2007 22:17:54 -0000	1.23.2.2
***************
*** 139,143 ****
    my $cmd = "@@PGBINDIR@@/slon -s $SYNC_CHECK_INTERVAL -d2 $CLUSTER_NAME '$dsn' 2>&1 ";
    if ($APACHE_ROTATOR) {
!     $cmd .= "| $APACHE_ROTATOR \"$LOGDIR/slony1/node$nodenum/" .  $dbname . "_%Y-%m-%d_%H:%M:%S.log\" 10M &";
    } else {
      my $now=`date '+%Y-%m-%d_%H:%M:%S'`;
--- 139,143 ----
    my $cmd = "@@PGBINDIR@@/slon -s $SYNC_CHECK_INTERVAL -d2 $CLUSTER_NAME '$dsn' 2>&1 ";
    if ($APACHE_ROTATOR) {
!     $cmd .= "| $APACHE_ROTATOR \"$LOGDIR/slony1/node$nodenum/" .  $dbname . "_%Y-%m.log\" 86400 &";
    } else {
      my $now=`date '+%Y-%m-%d_%H:%M:%S'`;

Index: slon-tools.pm
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tools/altperl/slon-tools.pm,v
retrieving revision 1.23.2.2
retrieving revision 1.23.2.3
diff -C2 -d -r1.23.2.2 -r1.23.2.3
*** slon-tools.pm	12 Mar 2007 22:17:54 -0000	1.23.2.2
--- slon-tools.pm	21 Mar 2007 15:11:52 -0000	1.23.2.3
***************
*** 139,143 ****
    my $cmd = "@@PGBINDIR@@/slon -s $SYNC_CHECK_INTERVAL -d2 $CLUSTER_NAME '$dsn' 2>&1 ";
    if ($APACHE_ROTATOR) {
!     $cmd .= "| $APACHE_ROTATOR \"$LOGDIR/slony1/node$nodenum/" .  $dbname . "_%Y-%m.log\" 86400 &";
    } else {
      my $now=`date '+%Y-%m-%d_%H:%M:%S'`;
--- 139,143 ----
    my $cmd = "@@PGBINDIR@@/slon -s $SYNC_CHECK_INTERVAL -d2 $CLUSTER_NAME '$dsn' 2>&1 ";
    if ($APACHE_ROTATOR) {
!     $cmd .= "| $APACHE_ROTATOR \"$LOGDIR/slony1/node$nodenum/" .  $dbname . "_%Y-%m-%d_%H:%M:%S.log\" 10M &";
    } else {
      my $now=`date '+%Y-%m-%d_%H:%M:%S'`;

From cbbrowne at lists.slony.info  Thu Mar 22 13:41:30 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Thu Mar 22 13:41:32 2007
Subject: [Slony1-commit] slony1-engine/src/backend slony1_funcs.sql
Message-ID: <20070322204130.3F22A290441@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/src/backend
In directory main.slony.info:/tmp/cvs-serv24016/src/backend

Modified Files:
      Tag: REL_1_2_STABLE
	slony1_funcs.sql 
Log Message:
1.  Update to 1.2.9
2.  Add 1.1.9 to set of versions for UPDATE FUNCTIONS
3.  Add latest release notes to RPM spec file


Index: slony1_funcs.sql
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/backend/slony1_funcs.sql,v
retrieving revision 1.98.2.12
retrieving revision 1.98.2.13
diff -C2 -d -r1.98.2.12 -r1.98.2.13
*** slony1_funcs.sql	20 Mar 2007 16:20:18 -0000	1.98.2.12
--- slony1_funcs.sql	22 Mar 2007 20:41:27 -0000	1.98.2.13
***************
*** 431,435 ****
  as '
  begin
! 	return 8;
  end;
  ' language plpgsql;
--- 431,435 ----
  as '
  begin
! 	return 9;
  end;
  ' language plpgsql;
***************
*** 5807,5811 ****
  	-- Changes for 1.2
  	-- ----
! 	if p_old IN (''1.0.2'', ''1.0.5'', ''1.0.6'', ''1.1.0'', ''1.1.1'', ''1.1.2'', ''1.1.3'',''1.1.5'', ''1.1.6'', ''1.1.7'', ''1.1.8'') then
  		-- Add new table sl_registry
  		execute ''create table @NAMESPACE@.sl_registry (
--- 5807,5811 ----
  	-- Changes for 1.2
  	-- ----
! 	if p_old IN (''1.0.2'', ''1.0.5'', ''1.0.6'', ''1.1.0'', ''1.1.1'', ''1.1.2'', ''1.1.3'',''1.1.5'', ''1.1.6'', ''1.1.7'', ''1.1.8'', ''1.1.9'') then
  		-- Add new table sl_registry
  		execute ''create table @NAMESPACE@.sl_registry (

From cbbrowne at lists.slony.info  Thu Mar 22 13:41:29 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Thu Mar 22 13:41:32 2007
Subject: [Slony1-commit] slony1-engine config.h.in RELEASE-1.2.9
	postgresql-slony1-engine.spec.in
Message-ID: <20070322204130.0964E29040E@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine
In directory main.slony.info:/tmp/cvs-serv24016

Modified Files:
      Tag: REL_1_2_STABLE
	config.h.in postgresql-slony1-engine.spec.in 
Added Files:
      Tag: REL_1_2_STABLE
	RELEASE-1.2.9 
Log Message:
1.  Update to 1.2.9
2.  Add 1.1.9 to set of versions for UPDATE FUNCTIONS
3.  Add latest release notes to RPM spec file


Index: postgresql-slony1-engine.spec.in
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/postgresql-slony1-engine.spec.in,v
retrieving revision 1.31.2.7
retrieving revision 1.31.2.8
diff -C2 -d -r1.31.2.7 -r1.31.2.8
*** postgresql-slony1-engine.spec.in	7 Mar 2007 23:03:49 -0000	1.31.2.7
--- postgresql-slony1-engine.spec.in	22 Mar 2007 20:41:27 -0000	1.31.2.8
***************
*** 109,113 ****
  %files
  %defattr(-,root,root,-)
! %doc COPYRIGHT UPGRADING HISTORY-1.1 INSTALL SAMPLE RELEASE-1.2.1 RELEASE-1.2.2 RELEASE-1.2.5 RELEASE-1.2.6 RELEASE-1.2.7
  %{_bindir}/*
  %{_libdir}/pgsql/slony1_funcs.so
--- 109,113 ----
  %files
  %defattr(-,root,root,-)
! %doc COPYRIGHT UPGRADING HISTORY-1.1 INSTALL SAMPLE RELEASE-1.2.1 RELEASE-1.2.2 RELEASE-1.2.5 RELEASE-1.2.6 RELEASE-1.2.7 RELEASE-1.2.8 RELEASE-1.2.9
  %{_bindir}/*
  %{_libdir}/pgsql/slony1_funcs.so
***************
*** 127,130 ****
--- 127,133 ----
  
  %changelog
+ * Wed Mar 22 2007 Christopher Browne <cbbrowne@ca.afilias.info>
+ - Added more recent release notes
+ 
  * Wed Mar 7 2007 Christopher Browne <cbbrowne@ca.afilias.info>
  - Added more recent release notes

Index: config.h.in
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/config.h.in,v
retrieving revision 1.17.2.5
retrieving revision 1.17.2.6
diff -C2 -d -r1.17.2.5 -r1.17.2.6
*** config.h.in	14 Mar 2007 16:24:30 -0000	1.17.2.5
--- config.h.in	22 Mar 2007 20:41:27 -0000	1.17.2.6
***************
*** 13,18 ****
  #define SLONY_I_CONFIG_H
  
! #define SLONY_I_VERSION_STRING	"1.2.8"
! #define SLONY_I_VERSION_STRING_DEC 1,2,8
  
  #ifndef PG_VERSION_MAJOR
--- 13,18 ----
  #define SLONY_I_CONFIG_H
  
! #define SLONY_I_VERSION_STRING	"1.2.9"
! #define SLONY_I_VERSION_STRING_DEC 1,2,9
  
  #ifndef PG_VERSION_MAJOR

--- NEW FILE: RELEASE-1.2.9 ---
$Id: RELEASE-1.2.9,v 1.1.2.1 2007-03-22 20:41:27 cbbrowne Exp $

- Reverted change that tried to support elderly apache rotatelogs

- Added a patch file to apply if you need to support elderly apache rotatelogs (tools/altperl/old-apache-rotatelogs.patch)

- Bug in UPDATE FUNCTIONS - wrong quoting in plpgsql function

- Add a regression test that runs UPDATE FUNCTIONS to ensure that it at least has no syntax errors

From cbbrowne at lists.slony.info  Thu Mar 22 13:44:15 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Thu Mar 22 13:44:17 2007
Subject: [Slony1-commit] slony1-engine/tests/test1 README init_cluster.ik
Message-ID: <20070322204415.98E3C29043E@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/tests/test1
In directory main.slony.info:/tmp/cvs-serv24084

Modified Files:
	README init_cluster.ik 
Log Message:
Add to test1 an invokation of slonik UPDATE FUNCTIONS to do a syntax
check on the stored proc


Index: README
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tests/test1/README,v
retrieving revision 1.7
retrieving revision 1.8
diff -C2 -d -r1.7 -r1.8
*** README	7 Feb 2007 19:13:17 -0000	1.7
--- README	22 Mar 2007 20:44:13 -0000	1.8
***************
*** 30,31 ****
--- 30,34 ----
  7.  It does a test of make_function_strict(), a function used in
  'UPDATE FUNCTIONS' to change the xxidin() function to be STRICT.
+ 
+ 8.  It does a run of UPDATE FUNCTIONS against node 1.  This verifies
+ that there are at least no syntax errors in the stored function.

Index: init_cluster.ik
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tests/test1/init_cluster.ik,v
retrieving revision 1.2
retrieving revision 1.3
diff -C2 -d -r1.2 -r1.3
*** init_cluster.ik	14 Jul 2006 21:29:01 -0000	1.2
--- init_cluster.ik	22 Mar 2007 20:44:13 -0000	1.3
***************
*** 1 ****
--- 1,3 ----
  init cluster (id=1, comment = 'Regress test node');
+ echo 'update functions on node 1 after initializing it';
+ update functions (id=1);

From cbbrowne at lists.slony.info  Thu Mar 22 13:44:58 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Thu Mar 22 13:44:59 2007
Subject: [Slony1-commit] slony1-engine/tests/testddl generate_dml.sh
Message-ID: <20070322204458.0ACD029043E@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/tests/testddl
In directory main.slony.info:/tmp/cvs-serv24113/testddl

Modified Files:
	generate_dml.sh 
Log Message:
Add in wait_for_catchup to 3 of the tests where we do additional
processing as they were tending to terminate before the test was complete


Index: generate_dml.sh
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tests/testddl/generate_dml.sh,v
retrieving revision 1.5
retrieving revision 1.6
diff -C2 -d -r1.5 -r1.6
*** generate_dml.sh	8 Nov 2006 21:55:59 -0000	1.5
--- generate_dml.sh	22 Mar 2007 20:44:55 -0000	1.6
***************
*** 86,90 ****
    status "loading extra data to node $db"
    $pgbindir/psql -h $host -p $port -U $user -d $db < $mktmp/generate.data 1> $LOG 2> $LOG
! 
    status "done"
  }
--- 86,90 ----
    status "loading extra data to node $db"
    $pgbindir/psql -h $host -p $port -U $user -d $db < $mktmp/generate.data 1> $LOG 2> $LOG
!   wait_for_catchup
    status "done"
  }

From cbbrowne at lists.slony.info  Thu Mar 22 13:44:58 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Thu Mar 22 13:45:01 2007
Subject: [Slony1-commit] slony1-engine/tests/testinherit generate_dml.sh
Message-ID: <20070322204458.231FC290441@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/tests/testinherit
In directory main.slony.info:/tmp/cvs-serv24113/testinherit

Modified Files:
	generate_dml.sh 
Log Message:
Add in wait_for_catchup to 3 of the tests where we do additional
processing as they were tending to terminate before the test was complete


Index: generate_dml.sh
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tests/testinherit/generate_dml.sh,v
retrieving revision 1.3
retrieving revision 1.4
diff -C2 -d -r1.3 -r1.4
*** generate_dml.sh	27 Oct 2006 14:45:51 -0000	1.3
--- generate_dml.sh	22 Mar 2007 20:44:56 -0000	1.4
***************
*** 79,82 ****
--- 79,83 ----
      warn 3 "do_initdata failed, see $mktmp/initdata.log for details"
    fi 
+   wait_for_catchup
    status "done"
  }

From cbbrowne at lists.slony.info  Thu Mar 22 13:44:58 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Thu Mar 22 13:45:01 2007
Subject: [Slony1-commit] slony1-engine/tests/testlargetuples generate_dml.sh
Message-ID: <20070322204458.2D6B1290459@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/tests/testlargetuples
In directory main.slony.info:/tmp/cvs-serv24113/testlargetuples

Modified Files:
	generate_dml.sh 
Log Message:
Add in wait_for_catchup to 3 of the tests where we do additional
processing as they were tending to terminate before the test was complete


Index: generate_dml.sh
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tests/testlargetuples/generate_dml.sh,v
retrieving revision 1.2
retrieving revision 1.3
diff -C2 -d -r1.2 -r1.3
*** generate_dml.sh	27 Oct 2006 14:45:51 -0000	1.2
--- generate_dml.sh	22 Mar 2007 20:44:56 -0000	1.3
***************
*** 79,81 ****
--- 79,82 ----
    $pgbindir/psql -h $host -p $port -d $db -U $user < $mktmp/generate.data 1> $mktmp/loadmoredata.log 2> $mktmp/loadmoredata.log
    status "done"
+   sleep 20   # Give it a little while for replication to catch up
  }

From cbbrowne at lists.slony.info  Thu Mar 22 13:45:56 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Thu Mar 22 13:45:58 2007
Subject: [Slony1-commit] slony1-engine/tests/test1 README init_cluster.ik
Message-ID: <20070322204556.AE455290441@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/tests/test1
In directory main.slony.info:/tmp/cvs-serv24155

Modified Files:
      Tag: REL_1_2_STABLE
	README init_cluster.ik 
Log Message:
Run UPDATE FUNCTIONS on the first node in order to do a syntax check
on the stored proc


Index: README
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tests/test1/README,v
retrieving revision 1.5.2.1
retrieving revision 1.5.2.2
diff -C2 -d -r1.5.2.1 -r1.5.2.2
*** README	7 Feb 2007 19:13:53 -0000	1.5.2.1
--- README	22 Mar 2007 20:45:54 -0000	1.5.2.2
***************
*** 30,31 ****
--- 30,34 ----
  7.  It does a test of make_function_strict(), a function used in
  'UPDATE FUNCTIONS' to change the xxidin() function to be STRICT.
+ 
+ 8.  It does a run of UPDATE FUNCTIONS against node 1.  This verifies
+ that there are at least no syntax errors in the stored function.

Index: init_cluster.ik
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tests/test1/init_cluster.ik,v
retrieving revision 1.2
retrieving revision 1.2.2.1
diff -C2 -d -r1.2 -r1.2.2.1
*** init_cluster.ik	14 Jul 2006 21:29:01 -0000	1.2
--- init_cluster.ik	22 Mar 2007 20:45:54 -0000	1.2.2.1
***************
*** 1 ****
--- 1,3 ----
  init cluster (id=1, comment = 'Regress test node');
+ echo 'update functions on node 1 after initializing it';
+ update functions (id=1);

From cbbrowne at lists.slony.info  Thu Mar 22 13:46:14 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Thu Mar 22 13:46:16 2007
Subject: [Slony1-commit] slony1-engine/tests/testlargetuples generate_dml.sh
Message-ID: <20070322204614.71477290458@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/tests/testlargetuples
In directory main.slony.info:/tmp/cvs-serv24173/testlargetuples

Modified Files:
      Tag: REL_1_2_STABLE
	generate_dml.sh 
Log Message:
Add in wait_for_catchup to 3 of the tests where we do additional
processing as they were tending to terminate before the test was complete


Index: generate_dml.sh
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tests/testlargetuples/generate_dml.sh,v
retrieving revision 1.1.2.2
retrieving revision 1.1.2.3
diff -C2 -d -r1.1.2.2 -r1.1.2.3
*** generate_dml.sh	27 Oct 2006 14:40:21 -0000	1.1.2.2
--- generate_dml.sh	22 Mar 2007 20:46:12 -0000	1.1.2.3
***************
*** 79,81 ****
--- 79,82 ----
    $pgbindir/psql -h $host -p $port -d $db -U $user < $mktmp/generate.data 1> $mktmp/loadmoredata.log 2> $mktmp/loadmoredata.log
    status "done"
+   sleep 20   # Give it a little while for replication to catch up
  }

From cbbrowne at lists.slony.info  Thu Mar 22 13:46:14 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Thu Mar 22 13:46:16 2007
Subject: [Slony1-commit] slony1-engine/tests/testddl generate_dml.sh
Message-ID: <20070322204614.53A93290441@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/tests/testddl
In directory main.slony.info:/tmp/cvs-serv24173/testddl

Modified Files:
      Tag: REL_1_2_STABLE
	generate_dml.sh 
Log Message:
Add in wait_for_catchup to 3 of the tests where we do additional
processing as they were tending to terminate before the test was complete


Index: generate_dml.sh
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tests/testddl/generate_dml.sh,v
retrieving revision 1.3.2.2
retrieving revision 1.3.2.3
diff -C2 -d -r1.3.2.2 -r1.3.2.3
*** generate_dml.sh	8 Nov 2006 21:56:27 -0000	1.3.2.2
--- generate_dml.sh	22 Mar 2007 20:46:12 -0000	1.3.2.3
***************
*** 86,90 ****
    status "loading extra data to node $db"
    $pgbindir/psql -h $host -p $port -U $user -d $db < $mktmp/generate.data 1> $LOG 2> $LOG
! 
    status "done"
  }
--- 86,90 ----
    status "loading extra data to node $db"
    $pgbindir/psql -h $host -p $port -U $user -d $db < $mktmp/generate.data 1> $LOG 2> $LOG
!   wait_for_catchup
    status "done"
  }

From cbbrowne at lists.slony.info  Thu Mar 22 13:46:15 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Thu Mar 22 13:46:16 2007
Subject: [Slony1-commit] slony1-engine/tests/testinherit generate_dml.sh
Message-ID: <20070322204615.45039290441@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/tests/testinherit
In directory main.slony.info:/tmp/cvs-serv24173/testinherit

Modified Files:
      Tag: REL_1_2_STABLE
	generate_dml.sh 
Log Message:
Add in wait_for_catchup to 3 of the tests where we do additional
processing as they were tending to terminate before the test was complete


Index: generate_dml.sh
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tests/testinherit/generate_dml.sh,v
retrieving revision 1.2.2.1
retrieving revision 1.2.2.2
diff -C2 -d -r1.2.2.1 -r1.2.2.2
*** generate_dml.sh	27 Oct 2006 14:40:21 -0000	1.2.2.1
--- generate_dml.sh	22 Mar 2007 20:46:12 -0000	1.2.2.2
***************
*** 79,82 ****
--- 79,83 ----
      warn 3 "do_initdata failed, see $mktmp/initdata.log for details"
    fi 
+   wait_for_catchup
    status "done"
  }

From cbbrowne at lists.slony.info  Thu Mar 22 13:49:05 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Thu Mar 22 13:49:07 2007
Subject: [Slony1-commit] slony1-engine config.h.in
	postgresql-slony1-engine.spec.in
Message-ID: <20070322204905.DEAB4290441@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine
In directory main.slony.info:/tmp/cvs-serv24221

Modified Files:
      Tag: REL_1_1_STABLE
	config.h.in postgresql-slony1-engine.spec.in 
Log Message:
Update version to 1.1.9


Index: postgresql-slony1-engine.spec.in
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/postgresql-slony1-engine.spec.in,v
retrieving revision 1.19.2.9
retrieving revision 1.19.2.10
diff -C2 -d -r1.19.2.9 -r1.19.2.10
*** postgresql-slony1-engine.spec.in	7 Mar 2007 22:46:44 -0000	1.19.2.9
--- postgresql-slony1-engine.spec.in	22 Mar 2007 20:49:03 -0000	1.19.2.10
***************
*** 99,103 ****
  %defattr(-,root,root,-)
  %if %docs
! %doc COPYRIGHT UPGRADING HISTORY-1.1 INSTALL SAMPLE doc/adminguide  doc/concept  doc/howto  doc/implementation  doc/support RELEASE-1.1.5 RELEASE-1.1.2 RELEASE-1.1.1 RELEASE-1.1.6 RELEASE-1.1.7
  %endif
  %{_bindir}/*
--- 99,103 ----
  %defattr(-,root,root,-)
  %if %docs
! %doc COPYRIGHT UPGRADING HISTORY-1.1 INSTALL SAMPLE doc/adminguide  doc/concept  doc/howto  doc/implementation  doc/support RELEASE-1.1.5 RELEASE-1.1.2 RELEASE-1.1.1 RELEASE-1.1.6 RELEASE-1.1.7 RELEASE-1.1.8 RELEASE-1.1.9
  %endif
  %{_bindir}/*
***************
*** 112,115 ****
--- 112,118 ----
  
  %changelog
+ * Wed Mar 21 2007 Christopher Browne <cbbrowne@ca.afilias.info> postgresql-slony1-engine
+ - Added release notes for 1.1.8, 1.1.9
+ 
  * Wed Mar 06 2007 Christopher Browne <cbbrowne@ca.afilias.info> postgresql-slony1-engine
  - Added release notes for 1.1.6 and 1.1.7

Index: config.h.in
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/config.h.in,v
retrieving revision 1.12.2.6
retrieving revision 1.12.2.7
diff -C2 -d -r1.12.2.6 -r1.12.2.7
*** config.h.in	14 Mar 2007 16:23:52 -0000	1.12.2.6
--- config.h.in	22 Mar 2007 20:49:03 -0000	1.12.2.7
***************
*** 13,17 ****
  #define SLONY_I_CONFIG_H
  
! #define SLONY_I_VERSION_STRING	"1.1.8"
  
  #undef PGSHARE
--- 13,17 ----
  #define SLONY_I_CONFIG_H
  
! #define SLONY_I_VERSION_STRING	"1.1.9"
  
  #undef PGSHARE

From cbbrowne at lists.slony.info  Thu Mar 22 13:49:06 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Thu Mar 22 13:49:07 2007
Subject: [Slony1-commit] slony1-engine/src/backend slony1_funcs.sql
Message-ID: <20070322204906.10BDE290459@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/src/backend
In directory main.slony.info:/tmp/cvs-serv24221/src/backend

Modified Files:
      Tag: REL_1_1_STABLE
	slony1_funcs.sql 
Log Message:
Update version to 1.1.9


Index: slony1_funcs.sql
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/backend/slony1_funcs.sql,v
retrieving revision 1.64.2.22
retrieving revision 1.64.2.23
diff -C2 -d -r1.64.2.22 -r1.64.2.23
*** slony1_funcs.sql	14 Mar 2007 16:23:52 -0000	1.64.2.22
--- slony1_funcs.sql	22 Mar 2007 20:49:03 -0000	1.64.2.23
***************
*** 414,418 ****
  as '
  begin
! 	return 8;
  end;
  ' language plpgsql;
--- 414,418 ----
  as '
  begin
! 	return 9;
  end;
  ' language plpgsql;

From cbbrowne at lists.slony.info  Thu Mar 22 13:49:58 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Thu Mar 22 13:49:59 2007
Subject: [Slony1-commit] slony1-engine RELEASE-1.1.9
Message-ID: <20070322204958.6118A29040E@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine
In directory main.slony.info:/tmp/cvs-serv24268

Added Files:
      Tag: REL_1_1_STABLE
	RELEASE-1.1.9 
Log Message:
Add 1.1.9 release notes


--- NEW FILE: RELEASE-1.1.9 ---
$Id: RELEASE-1.1.9,v 1.1.2.1 2007-03-22 20:49:56 cbbrowne Exp $

- Missed adding v81 SQL base files to CVS

- Reverted change that tried to support elderly apache rotatelogs

- Added a patch file to apply if you need to support elderly apache rotatelogs (tools/altperl/old-apache-rotatelogs.patch)
From cbbrowne at lists.slony.info  Thu Mar 22 15:29:34 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Thu Mar 22 15:29:35 2007
Subject: [Slony1-commit] slony1-www/content news.txt
Message-ID: <20070322222934.66E8229046E@main.slony.info>

Update of /home/cvsd/slony1/slony1-www/content
In directory main.slony.info:/tmp/cvs-serv24868/content

Modified Files:
	news.txt 
Log Message:
Add 1.2.9, 1.1.9...


Index: news.txt
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/content/news.txt,v
retrieving revision 1.11
retrieving revision 1.12
diff -C2 -d -r1.11 -r1.12
*** news.txt	16 Mar 2007 23:01:44 -0000	1.11
--- news.txt	22 Mar 2007 22:29:32 -0000	1.12
***************
*** 4,11 ****
  2007-02-28
  Chris Browne
! Slony-1 1.2.8 <a href="http://main.slony.info/downloads/1.2/slony1-1.2.8.tar.bz2">engine</a>
! <a href="http://main.slony.info/downloads/1.2/slony1-1.2.8-docs.tar.bz2">documentation</a>
  <br />
! Slony-1 1.1.8 <a href="http://main.slony.info/downloads/1.1/slony1-1.1.8.tar.bz2">engine</a>
  <!-- Please keep this item at the top of the news list -->
  ---
--- 4,11 ----
  2007-02-28
  Chris Browne
! Slony-1 1.2.9 <a href="http://main.slony.info/downloads/1.2/slony1-1.2.9.tar.bz2">engine</a>
! <a href="http://main.slony.info/downloads/1.2/slony1-1.2.9-docs.tar.bz2">documentation</a>
  <br />
! Slony-1 1.1.9 <a href="http://main.slony.info/downloads/1.1/slony1-1.1.9.tar.bz2">engine</a>
  <!-- Please keep this item at the top of the news list -->
  ---
***************
*** 55,58 ****
--- 55,93 ----
  </ul>
  ---
+ Slony-I Release - 1.2.9
+ http://main.slony.info/downloads/1.2
+ 2007-03-22
+ Chris Browne
+ We are pleased to announce the release of version 1.2.9, which may be
+ found <a href="http://main.slony.info/downloads/1.2/slony1-1.2.9.tar.bz2">here</a>.  
+ There is also a <a href="http://main.slony.info/downloads/1.2/slony1-1.2.9-docs.tar.bz2">Documentation tarball </a>.
+ 
+ <P> This release fixes several problems that were found in the 1.2 stream:
+ <ul>
+ <li> Reverted change that tried to support elderly apache rotatelogs
+ 
+ <li> Added a patch file to apply if you need to support elderly apache rotatelogs (tools/altperl/old-apache-rotatelogs.patch)
+ 
+ <li> Bug in UPDATE FUNCTIONS - wrong quoting in plpgsql function
+ 
+ <li> Add a regression test that runs UPDATE FUNCTIONS to ensure that it at least has no syntax errors
+ </ul>
+ ---
+ Slony-I Release - 1.1.9
+ http://main.slony.info/downloads/1.1
+ 2007-03-22
+ Chris Browne
+ We are pleased to announce the release of version 1.1.9, which may be
+ found <a href="http://main.slony.info/downloads/1.1/slony1-1.1.9.tar.bz2">here</a>.  
+ 
+ <P> This release fixes several problems that were found in the 1.1 stream:
+ <ul>
+ <li> Missed adding v81 SQL base files to CVS
+ 
+ <li> Reverted change that tried to support elderly apache rotatelogs
+ 
+ <li> Added a patch file to apply if you need to support elderly apache rotatelogs (tools/altperl/old-apache-rotatelogs.patch)
+ </ul>
+ ---
  Slony-I Release - 1.2.7
  http://main.slony.info/downloads/1.2

From cbbrowne at lists.slony.info  Thu Mar 22 15:30:51 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Thu Mar 22 15:30:51 2007
Subject: [Slony1-commit] slony1-www/content frontpage.txt
Message-ID: <20070322223051.2FC9529043E@main.slony.info>

Update of /home/cvsd/slony1/slony1-www/content
In directory main.slony.info:/tmp/cvs-serv24918/content

Modified Files:
	frontpage.txt 
Log Message:
Add 1.1.9,1.2.9 to front page


Index: frontpage.txt
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/content/frontpage.txt,v
retrieving revision 1.6
retrieving revision 1.7
diff -C2 -d -r1.6 -r1.7
*** frontpage.txt	16 Mar 2007 23:01:44 -0000	1.6
--- frontpage.txt	22 Mar 2007 22:30:49 -0000	1.7
***************
*** 1,3 ****
--- 1,38 ----
  ---
+ Slony-I Release - 1.2.9
+ http://main.slony.info/downloads/1.2
+ 2007-03-22
+ Chris Browne
+ We are pleased to announce the release of version 1.2.9, which may be
+ found <a href="http://main.slony.info/downloads/1.2/slony1-1.2.9.tar.bz2">here</a>.  
+ There is also a <a href="http://main.slony.info/downloads/1.2/slony1-1.2.9-docs.tar.bz2">Documentation tarball </a>.
+ 
+ <P> This release fixes several problems that were found in the 1.2 stream:
+ <ul>
+ <li> Reverted change that tried to support elderly apache rotatelogs
+ 
+ <li> Added a patch file to apply if you need to support elderly apache rotatelogs (tools/altperl/old-apache-rotatelogs.patch)
+ 
+ <li> Bug in UPDATE FUNCTIONS - wrong quoting in plpgsql function
+ 
+ <li> Add a regression test that runs UPDATE FUNCTIONS to ensure that it at least has no syntax errors
+ </ul>
+ ---
+ Slony-I Release - 1.1.9
+ http://main.slony.info/downloads/1.1
+ 2007-03-22
+ Chris Browne
+ We are pleased to announce the release of version 1.1.9, which may be
+ found <a href="http://main.slony.info/downloads/1.1/slony1-1.1.9.tar.bz2">here</a>.  
+ 
+ <P> This release fixes several problems that were found in the 1.1 stream:
+ <ul>
+ <li> Missed adding v81 SQL base files to CVS
+ 
+ <li> Reverted change that tried to support elderly apache rotatelogs
+ 
+ <li> Added a patch file to apply if you need to support elderly apache rotatelogs (tools/altperl/old-apache-rotatelogs.patch)
+ </ul>
+ ---
  Slony-I Release - 1.2.8
  http://main.slony.info/downloads/1.2

From cbbrowne at lists.slony.info  Thu Mar 22 15:32:09 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Thu Mar 22 15:32:11 2007
Subject: [Slony1-commit] slony1-www/content news.txt
Message-ID: <20070322223209.DA407290459@main.slony.info>

Update of /home/cvsd/slony1/slony1-www/content
In directory main.slony.info:/tmp/cvs-serv24941/content

Modified Files:
	news.txt 
Log Message:
Add 1.1.9,1.2.9 into news.html


Index: news.txt
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/content/news.txt,v
retrieving revision 1.12
retrieving revision 1.13
diff -C2 -d -r1.12 -r1.13
*** news.txt	22 Mar 2007 22:29:32 -0000	1.12
--- news.txt	22 Mar 2007 22:32:07 -0000	1.13
***************
*** 10,13 ****
--- 10,48 ----
  <!-- Please keep this item at the top of the news list -->
  ---
+ Slony-I Release - 1.2.9
+ http://main.slony.info/downloads/1.2
+ 2007-03-22
+ Chris Browne
+ We are pleased to announce the release of version 1.2.9, which may be
+ found <a href="http://main.slony.info/downloads/1.2/slony1-1.2.9.tar.bz2">here</a>.  
+ There is also a <a href="http://main.slony.info/downloads/1.2/slony1-1.2.9-docs.tar.bz2">Documentation tarball </a>.
+ 
+ <P> This release fixes several problems that were found in the 1.2 stream:
+ <ul>
+ <li> Reverted change that tried to support elderly apache rotatelogs
+ 
+ <li> Added a patch file to apply if you need to support elderly apache rotatelogs (tools/altperl/old-apache-rotatelogs.patch)
+ 
+ <li> Bug in UPDATE FUNCTIONS - wrong quoting in plpgsql function
+ 
+ <li> Add a regression test that runs UPDATE FUNCTIONS to ensure that it at least has no syntax errors
+ </ul>
+ ---
+ Slony-I Release - 1.1.9
+ http://main.slony.info/downloads/1.1
+ 2007-03-22
+ Chris Browne
+ We are pleased to announce the release of version 1.1.9, which may be
+ found <a href="http://main.slony.info/downloads/1.1/slony1-1.1.9.tar.bz2">here</a>.  
+ 
+ <P> This release fixes several problems that were found in the 1.1 stream:
+ <ul>
+ <li> Missed adding v81 SQL base files to CVS
+ 
+ <li> Reverted change that tried to support elderly apache rotatelogs
+ 
+ <li> Added a patch file to apply if you need to support elderly apache rotatelogs (tools/altperl/old-apache-rotatelogs.patch)
+ </ul>
+ ---
  Slony-I Release - 1.2.8
  http://main.slony.info/downloads/1.2

From cbbrowne at lists.slony.info  Thu Mar 22 15:35:21 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Thu Mar 22 15:35:22 2007
Subject: [Slony1-commit] slony1-www/content news.txt
Message-ID: <20070322223521.A3B8729043E@main.slony.info>

Update of /home/cvsd/slony1/slony1-www/content
In directory main.slony.info:/tmp/cvs-serv24977/content

Modified Files:
	news.txt 
Log Message:
news contained the 1.[12].9 release info twice


Index: news.txt
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/content/news.txt,v
retrieving revision 1.13
retrieving revision 1.14
diff -C2 -d -r1.13 -r1.14
*** news.txt	22 Mar 2007 22:32:07 -0000	1.13
--- news.txt	22 Mar 2007 22:35:19 -0000	1.14
***************
*** 90,128 ****
  </ul>
  ---
- Slony-I Release - 1.2.9
- http://main.slony.info/downloads/1.2
- 2007-03-22
- Chris Browne
- We are pleased to announce the release of version 1.2.9, which may be
- found <a href="http://main.slony.info/downloads/1.2/slony1-1.2.9.tar.bz2">here</a>.  
- There is also a <a href="http://main.slony.info/downloads/1.2/slony1-1.2.9-docs.tar.bz2">Documentation tarball </a>.
- 
- <P> This release fixes several problems that were found in the 1.2 stream:
- <ul>
- <li> Reverted change that tried to support elderly apache rotatelogs
- 
- <li> Added a patch file to apply if you need to support elderly apache rotatelogs (tools/altperl/old-apache-rotatelogs.patch)
- 
- <li> Bug in UPDATE FUNCTIONS - wrong quoting in plpgsql function
- 
- <li> Add a regression test that runs UPDATE FUNCTIONS to ensure that it at least has no syntax errors
- </ul>
- ---
- Slony-I Release - 1.1.9
- http://main.slony.info/downloads/1.1
- 2007-03-22
- Chris Browne
- We are pleased to announce the release of version 1.1.9, which may be
- found <a href="http://main.slony.info/downloads/1.1/slony1-1.1.9.tar.bz2">here</a>.  
- 
- <P> This release fixes several problems that were found in the 1.1 stream:
- <ul>
- <li> Missed adding v81 SQL base files to CVS
- 
- <li> Reverted change that tried to support elderly apache rotatelogs
- 
- <li> Added a patch file to apply if you need to support elderly apache rotatelogs (tools/altperl/old-apache-rotatelogs.patch)
- </ul>
- ---
  Slony-I Release - 1.2.7
  http://main.slony.info/downloads/1.2
--- 90,93 ----

From xfade at lists.slony.info  Tue Mar 27 05:13:28 2007
From: xfade at lists.slony.info (Niels Breet)
Date: Tue Mar 27 05:13:30 2007
Subject: [Slony1-commit] slony1-www index.php
Message-ID: <20070327121328.B61D4290062@main.slony.info>

Update of /home/cvsd/slony1/slony1-www
In directory main.slony.info:/tmp/cvs-serv27148

Modified Files:
	index.php 
Log Message:
Add slony win32 files to download area. Restructured the download dir while I was at it. Source, rpm and win32 now have separate dirs.

Index: index.php
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/index.php,v
retrieving revision 1.8
retrieving revision 1.9
diff -C2 -d -r1.8 -r1.9
*** index.php	28 Feb 2007 21:13:48 -0000	1.8
--- index.php	27 Mar 2007 12:13:26 -0000	1.9
***************
*** 23,30 ****
         if ($_GET["version"] == "1.1") $version = "1.1";
         if ($_GET["version"] == "1.2") $version = "1.2";
         if ($version == ""){
                 $path = './downloads/';
         } else {
!                $path = './downloads/'.$version.'/';
                 $sums = @file_get_contents($path.'MD5SUMS');
         }
--- 23,39 ----
         if ($_GET["version"] == "1.1") $version = "1.1";
         if ($_GET["version"] == "1.2") $version = "1.2";
+        $platform = "";
+        if ($_GET["platform"]=="source") $platform = "source";
+        if ($_GET["platform"]=="win32") $platform = "win32";
+        if ($_GET["platform"]=="rpm") $platform = "rpm";
+ 
         if ($version == ""){
                 $path = './downloads/';
         } else {
! 	       if (platform != "") {
!                	  $path = './downloads/'.$version.'/'.$platform.'/';
! 	       } else {
!                	  $path = './downloads/'.$version.'/';
! 	       }
                 $sums = @file_get_contents($path.'MD5SUMS');
         }
***************
*** 34,41 ****
                 $mysums = array();
                         while (($file = readdir($dh)) !== false) {
!                        if (($version == "") && ($file != ".") && ($file != "..")){
                                 array_push($files, $file);
                         } else  if ((substr($file, strlen($file) - 4) == '.bz2') ||
!                                        (substr($file, strlen($file) - 4) == '.rpm')) {
                                         array_push($files, $file);
                                 $pos = 0;
--- 43,52 ----
                 $mysums = array();
                         while (($file = readdir($dh)) !== false) {
!                        if ((($version == "") || ($platform == ""))&& ($file != ".") && ($file != "..")){
                                 array_push($files, $file);
                         } else  if ((substr($file, strlen($file) - 4) == '.bz2') ||
!                                        (substr($file, strlen($file) - 4) == '.rpm') ||
!                                        (substr($file, strlen($file) - 4) == '.zip')
! 					) {
                                         array_push($files, $file);
                                 $pos = 0;
***************
*** 56,75 ****
                  $text .= "<table>\n";
         } else {
                 $text .= "<h1>Slony $version files</h1>";
                 $text .= "<table>\n<tr><td>File</td><td>Type</td><td>MD5SUM</td></tr>\n";
         }
         $c = 0;
         foreach ($files as $file) {
!                        $title = $file;
                 $type = "";
                 if (strpos($file,'tar.bz2')>0) $type="Slony tarball";
                 if ((strpos($file,'doc')>0) && ((strpos($file,'tar.bz2')>0))) $type="Documentation";
!                if (strpos($file,'.rpm')>0) $type="Slony RPM";
  
!                        $text .= "<tr><td><a href=\"$file\" title=\"$title\">$title</a></td><td>$type</td><td>$mysums[$c]</td></tr>\n";
                 $c++;
         }
         $text .= "</table>\n";
!        echo layout_defaultblock('Slony downloads',"/downloads/",$text);
  
         break;
--- 67,109 ----
                  $text .= "<table>\n";
         } else {
+ 	   if ($platform == ""){
+                 $text .= "<h1>Please select your preferred packaging</h1>";
+                 $text .= "<table>\n";
+ 	   } else {
                 $text .= "<h1>Slony $version files</h1>";
                 $text .= "<table>\n<tr><td>File</td><td>Type</td><td>MD5SUM</td></tr>\n";
+ 	   }
         }
         $c = 0;
         foreach ($files as $file) {
!                $title = $file;
                 $type = "";
                 if (strpos($file,'tar.bz2')>0) $type="Slony tarball";
+                if (strpos($file,'.zip')>0) $type="Slony for windows msi installer";
                 if ((strpos($file,'doc')>0) && ((strpos($file,'tar.bz2')>0))) $type="Documentation";
!                if (strpos($file,'source') !== false){
! 		   $type="Slony source files and documentation";
! 		   $file .= "/";
! 	       }
!                if (strpos($file,'win32') !== false){
! 		   $type="Slony for Windows";
! 		   $file .= "/";
! 	       }
!                if (strpos($file,'rpm') !== false) {
! 		   $type="Slony RPM files";
! 		   $file .= "/";
! 	       }
  
!                $text .= "<tr><td><a href=\"$file\" title=\"$title\">$title</a></td><td>$type</td><td>$mysums[$c]</td></tr>\n";
                 $c++;
         }
         $text .= "</table>\n";
!        $url = "/downloads/";
!        $title = "Slony downloads";
!        if ($platform != "") {
!            $url .= $version."/";
!            $title .= " / ".$version." /";
!        }
!        echo layout_defaultblock($title,$url,$text);
  
         break;

From xfade at lists.slony.info  Tue Mar 27 05:22:47 2007
From: xfade at lists.slony.info (Niels Breet)
Date: Tue Mar 27 05:22:48 2007
Subject: [Slony1-commit] slony1-www index.php
Message-ID: <20070327122247.3435A29028B@main.slony.info>

Update of /home/cvsd/slony1/slony1-www
In directory main.slony.info:/tmp/cvs-serv27300

Modified Files:
	index.php 
Log Message:
Add trailing slashes to dirs.

Index: index.php
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/index.php,v
retrieving revision 1.9
retrieving revision 1.10
diff -C2 -d -r1.9 -r1.10
*** index.php	27 Mar 2007 12:13:26 -0000	1.9
--- index.php	27 Mar 2007 12:22:45 -0000	1.10
***************
*** 82,97 ****
                 if (strpos($file,'.zip')>0) $type="Slony for windows msi installer";
                 if ((strpos($file,'doc')>0) && ((strpos($file,'tar.bz2')>0))) $type="Documentation";
!                if (strpos($file,'source') !== false){
! 		   $type="Slony source files and documentation";
! 		   $file .= "/";
! 	       }
!                if (strpos($file,'win32') !== false){
! 		   $type="Slony for Windows";
! 		   $file .= "/";
! 	       }
!                if (strpos($file,'rpm') !== false) {
! 		   $type="Slony RPM files";
! 		   $file .= "/";
! 	       }
  
                 $text .= "<tr><td><a href=\"$file\" title=\"$title\">$title</a></td><td>$type</td><td>$mysums[$c]</td></tr>\n";
--- 82,89 ----
                 if (strpos($file,'.zip')>0) $type="Slony for windows msi installer";
                 if ((strpos($file,'doc')>0) && ((strpos($file,'tar.bz2')>0))) $type="Documentation";
!                if (strpos($file,'source') !== false) $type="Slony source files and documentation";
!                if (strpos($file,'win32') !== false) $type="Slony for Windows";
! 	       if (strpos($file,'rpm') !== false)  $type="Slony RPM files";
! 	       if (($version == "") || ($platform =="")) $file .= "/";
  
                 $text .= "<tr><td><a href=\"$file\" title=\"$title\">$title</a></td><td>$type</td><td>$mysums[$c]</td></tr>\n";

From xfade at lists.slony.info  Tue Mar 27 05:26:01 2007
From: xfade at lists.slony.info (Niels Breet)
Date: Tue Mar 27 05:26:02 2007
Subject: [Slony1-commit] slony1-www/content frontpage.txt news.txt
Message-ID: <20070327122601.5784629028B@main.slony.info>

Update of /home/cvsd/slony1/slony1-www/content
In directory main.slony.info:/tmp/cvs-serv27339

Modified Files:
	frontpage.txt news.txt 
Log Message:
Update news to reflect download path changes.

Index: frontpage.txt
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/content/frontpage.txt,v
retrieving revision 1.7
retrieving revision 1.8
diff -C2 -d -r1.7 -r1.8
*** frontpage.txt	22 Mar 2007 22:30:49 -0000	1.7
--- frontpage.txt	27 Mar 2007 12:25:59 -0000	1.8
***************
*** 5,10 ****
  Chris Browne
  We are pleased to announce the release of version 1.2.9, which may be
! found <a href="http://main.slony.info/downloads/1.2/slony1-1.2.9.tar.bz2">here</a>.  
! There is also a <a href="http://main.slony.info/downloads/1.2/slony1-1.2.9-docs.tar.bz2">Documentation tarball </a>.
  
  <P> This release fixes several problems that were found in the 1.2 stream:
--- 5,10 ----
  Chris Browne
  We are pleased to announce the release of version 1.2.9, which may be
! found <a href="http://main.slony.info/downloads/1.2/source/slony1-1.2.9.tar.bz2">here</a>.  
! There is also a <a href="http://main.slony.info/downloads/1.2/source/slony1-1.2.9-docs.tar.bz2">Documentation tarball </a>.
  
  <P> This release fixes several problems that were found in the 1.2 stream:
***************
*** 24,28 ****
  Chris Browne
  We are pleased to announce the release of version 1.1.9, which may be
! found <a href="http://main.slony.info/downloads/1.1/slony1-1.1.9.tar.bz2">here</a>.  
  
  <P> This release fixes several problems that were found in the 1.1 stream:
--- 24,28 ----
  Chris Browne
  We are pleased to announce the release of version 1.1.9, which may be
! found <a href="http://main.slony.info/downloads/1.1/source/slony1-1.1.9.tar.bz2">here</a>.  
  
  <P> This release fixes several problems that were found in the 1.1 stream:
***************
*** 40,45 ****
  Chris Browne
  We are pleased to announce the release of version 1.2.8, which may be
! found <a href="http://main.slony.info/downloads/1.2/slony1-1.2.8.tar.bz2">here</a>.  
! There is also a <a href="http://main.slony.info/downloads/1.2/slony1-1.2.8-docs.tar.bz2">Documentation tarball </a>.
  
  <P> This release fixes several problems that were found in the 1.2 stream:
--- 40,45 ----
  Chris Browne
  We are pleased to announce the release of version 1.2.8, which may be
! found <a href="http://main.slony.info/downloads/1.2/source/slony1-1.2.8.tar.bz2">here</a>.  
! There is also a <a href="http://main.slony.info/downloads/1.2/source/slony1-1.2.8-docs.tar.bz2">Documentation tarball </a>.
  
  <P> This release fixes several problems that were found in the 1.2 stream:
***************
*** 62,66 ****
  Chris Browne
  We are pleased to announce the release of version 1.1.8, which may be
! found <a href="http://main.slony.info/downloads/1.1/slony1-1.1.8.tar.bz2">here</a>.  
  
  <P> This release fixes several problems that were found in the 1.1 stream:
--- 62,66 ----
  Chris Browne
  We are pleased to announce the release of version 1.1.8, which may be
! found <a href="http://main.slony.info/downloads/1.1/source/slony1-1.1.8.tar.bz2">here</a>.  
  
  <P> This release fixes several problems that were found in the 1.1 stream:
***************
*** 85,90 ****
  Chris Browne
  We are pleased to announce the release of version 1.2.7, which may be
! found <a href="http://main.slony.info/downloads/1.2/slony1-1.2.7.tar.bz2">here</a>.  
! There is also a <a href="http://main.slony.info/downloads/1.2/slony1-1.2.7-docs.tar.bz2">Documentation tarball </a>.
  
  <P> This release fixes several problems that were found in the 1.2 stream:
--- 85,90 ----
  Chris Browne
  We are pleased to announce the release of version 1.2.7, which may be
! found <a href="http://main.slony.info/downloads/1.2/source/slony1-1.2.7.tar.bz2">here</a>.  
! There is also a <a href="http://main.slony.info/downloads/1.2/source/slony1-1.2.7-docs.tar.bz2">Documentation tarball </a>.
  
  <P> This release fixes several problems that were found in the 1.2 stream:
***************
*** 142,146 ****
  Chris Browne
  We are pleased to announce the release of version 1.1.7, which may be
! found <a href="http://main.slony.info/downloads/1.1/slony1-1.1.7.tar.bz2">here</a>.  
  It fixes several problems that were found in the 1.2 stream that were readily back-ported to 1.1:
  <ul>
--- 142,146 ----
  Chris Browne
  We are pleased to announce the release of version 1.1.7, which may be
! found <a href="http://main.slony.info/downloads/1.1/source/slony1-1.1.7.tar.bz2">here</a>.  
  It fixes several problems that were found in the 1.2 stream that were readily back-ported to 1.1:
  <ul>

Index: news.txt
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/content/news.txt,v
retrieving revision 1.14
retrieving revision 1.15
diff -C2 -d -r1.14 -r1.15
*** news.txt	22 Mar 2007 22:35:19 -0000	1.14
--- news.txt	27 Mar 2007 12:25:59 -0000	1.15
***************
*** 4,11 ****
  2007-02-28
  Chris Browne
! Slony-1 1.2.9 <a href="http://main.slony.info/downloads/1.2/slony1-1.2.9.tar.bz2">engine</a>
! <a href="http://main.slony.info/downloads/1.2/slony1-1.2.9-docs.tar.bz2">documentation</a>
  <br />
! Slony-1 1.1.9 <a href="http://main.slony.info/downloads/1.1/slony1-1.1.9.tar.bz2">engine</a>
  <!-- Please keep this item at the top of the news list -->
  ---
--- 4,11 ----
  2007-02-28
  Chris Browne
! Slony-1 1.2.9 <a href="http://main.slony.info/downloads/1.2/source/slony1-1.2.9.tar.bz2">engine</a>
! <a href="http://main.slony.info/downloads/1.2/source/slony1-1.2.9-docs.tar.bz2">documentation</a>
  <br />
! Slony-1 1.1.9 <a href="http://main.slony.info/downloads/1.1/source/slony1-1.1.9.tar.bz2">engine</a>
  <!-- Please keep this item at the top of the news list -->
  ---
***************
*** 15,20 ****
  Chris Browne
  We are pleased to announce the release of version 1.2.9, which may be
! found <a href="http://main.slony.info/downloads/1.2/slony1-1.2.9.tar.bz2">here</a>.  
! There is also a <a href="http://main.slony.info/downloads/1.2/slony1-1.2.9-docs.tar.bz2">Documentation tarball </a>.
  
  <P> This release fixes several problems that were found in the 1.2 stream:
--- 15,20 ----
  Chris Browne
  We are pleased to announce the release of version 1.2.9, which may be
! found <a href="http://main.slony.info/downloads/1.2/source/slony1-1.2.9.tar.bz2">here</a>.  
! There is also a <a href="http://main.slony.info/downloads/1.2/source/slony1-1.2.9-docs.tar.bz2">Documentation tarball </a>.
  
  <P> This release fixes several problems that were found in the 1.2 stream:
***************
*** 34,38 ****
  Chris Browne
  We are pleased to announce the release of version 1.1.9, which may be
! found <a href="http://main.slony.info/downloads/1.1/slony1-1.1.9.tar.bz2">here</a>.  
  
  <P> This release fixes several problems that were found in the 1.1 stream:
--- 34,38 ----
  Chris Browne
  We are pleased to announce the release of version 1.1.9, which may be
! found <a href="http://main.slony.info/downloads/1.1/source/slony1-1.1.9.tar.bz2">here</a>.  
  
  <P> This release fixes several problems that were found in the 1.1 stream:
***************
*** 50,55 ****
  Chris Browne
  We are pleased to announce the release of version 1.2.8, which may be
! found <a href="http://main.slony.info/downloads/1.2/slony1-1.2.8.tar.bz2">here</a>.  
! There is also a <a href="http://main.slony.info/downloads/1.2/slony1-1.2.8-docs.tar.bz2">Documentation tarball </a>.
  
  <P> This release fixes several problems that were found in the 1.2 stream:
--- 50,55 ----
  Chris Browne
  We are pleased to announce the release of version 1.2.8, which may be
! found <a href="http://main.slony.info/downloads/1.2/source/slony1-1.2.8.tar.bz2">here</a>.  
! There is also a <a href="http://main.slony.info/downloads/1.2/source/slony1-1.2.8-docs.tar.bz2">Documentation tarball </a>.
  
  <P> This release fixes several problems that were found in the 1.2 stream:
***************
*** 72,76 ****
  Chris Browne
  We are pleased to announce the release of version 1.1.8, which may be
! found <a href="http://main.slony.info/downloads/1.1/slony1-1.1.8.tar.bz2">here</a>.  
  
  <P> This release fixes several problems that were found in the 1.1 stream:
--- 72,76 ----
  Chris Browne
  We are pleased to announce the release of version 1.1.8, which may be
! found <a href="http://main.slony.info/downloads/1.1/source/slony1-1.1.8.tar.bz2">here</a>.  
  
  <P> This release fixes several problems that were found in the 1.1 stream:
***************
*** 95,100 ****
  Chris Browne
  We are pleased to announce the release of version 1.2.7, which may be
! found <a href="http://main.slony.info/downloads/1.2/slony1-1.2.7.tar.bz2">here</a>.  
! There is also a <a href="http://main.slony.info/downloads/1.2/slony1-1.2.7-docs.tar.bz2">Documentation tarball </a>.
  
  <P> This release fixes several problems that were found in the 1.2 stream:
--- 95,100 ----
  Chris Browne
  We are pleased to announce the release of version 1.2.7, which may be
! found <a href="http://main.slony.info/downloads/1.2/source/slony1-1.2.7.tar.bz2">here</a>.  
! There is also a <a href="http://main.slony.info/downloads/1.2/source/slony1-1.2.7-docs.tar.bz2">Documentation tarball </a>.
  
  <P> This release fixes several problems that were found in the 1.2 stream:
***************
*** 152,156 ****
  Chris Browne
  We are pleased to announce the release of version 1.1.7, which may be
! found <a href="http://main.slony.info/downloads/1.1/slony1-1.1.7.tar.bz2">here</a>.  
  It fixes several problems that were found in the 1.2 stream that were readily back-ported to 1.1:
  <ul>
--- 152,156 ----
  Chris Browne
  We are pleased to announce the release of version 1.1.7, which may be
! found <a href="http://main.slony.info/downloads/1.1/source/slony1-1.1.7.tar.bz2">here</a>.  
  It fixes several problems that were found in the 1.2 stream that were readily back-ported to 1.1:
  <ul>

From cbbrowne at lists.slony.info  Fri Mar 30 07:49:12 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Fri Mar 30 07:49:14 2007
Subject: [Slony1-commit] slony1-engine/tools/mkservice  - New directory
Message-ID: <20070330144912.47EC729046C@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/tools/mkservice
In directory main.slony.info:/tmp/cvs-serv24011/mkservice

Log Message:
Directory /home/cvsd/slony1/slony1-engine/tools/mkservice added to the repository


From cbbrowne at lists.slony.info  Fri Mar 30 07:49:48 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Fri Mar 30 07:49:50 2007
Subject: [Slony1-commit] slony1-engine/tools/mkservice README
	logrep-mkservice.sh slon-mkservice.sh
Message-ID: <20070330144948.F252229028B@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/tools/mkservice
In directory main.slony.info:/tmp/cvs-serv24038

Added Files:
	README logrep-mkservice.sh slon-mkservice.sh 
Log Message:
BSD-oriented "mkservice" scripts contributed by Andrew Hammond


--- NEW FILE: README ---
$Id: README,v 1.1 2007-03-30 14:49:46 cbbrowne Exp $

contributed by Andrew Hammond <andrew.george.hammond@gmail.com>

slon-mkservice.sh
-------------------
Create a slon service directory for use with svscan from daemontools.
This uses multilog in a pretty basic way. See logrep for cleverness.
Currently very limited error handling. This probably needs to be
fixed...

It asks for configuration information interactively, if run
interactively.

For non-interactive use, set the following environment variables.
BASEDIR SYSUSR PASSFILE DBUSER HOST PORT DATABASE CLUSTER SLON_BINARY

logrep-mkservice.sh
--------------------

This uses "tail -F" to pull data from Slony-I log files to allow
creating special purpose log files to report specially desired
information.

--- NEW FILE: slon-mkservice.sh ---
#!/bin/sh
#
# $Id: slon-mkservice.sh,v 1.1 2007-03-30 14:49:46 cbbrowne Exp $
#
# contributed by Andrew Hammond <andrew.george.hammond@gmail.com>
#
# Create a slon service directory for use with svscan from deamontools.
# This uses multilog in a pretty basic way. See logrep for cleverness.
# Currently very limited error handling. This probably needs to be fixed...
#
# For non-interactive use, set the following environment variables.
# BASEDIR SYSUSR PASSFILE DBUSER HOST PORT DATABASE CLUSTER SLON_BINARY

DEFAULT_SLON_BINARY=`which slon`                # silly, wild-ass guess
DEFAULT_BASEDIR='/usr/local/etc'
DEFAULT_SYSUSR='pgsql'                          # FreeBSD-centric. Oh well.
DEFAULT_DBUSR='slony'                           # Best Practice...
DEFAULT_SLON_DEBUG_LEVEL=2                      # default to "debug2" level
DEFAULT_HOST='localhost'                        # maybe the unix socket would be better?
DEFAULT_PORT=5432

if [ -z "$BASEDIR" ]; then
    echo -n "Where do you want the service dir created? Don't want to created this in /service or /var/service. Once it's created, either link or move it to the service directory (since linking is an atomic filesystem action). If your service directory is on a small, relatively static partition, you will almost certainly want to put this on a partition that can handle some log files and then link.
[$DEFAULT_BASEDIR]: "
    read BASEDIR
    if [ -z "$BASEDIR" ]; then
        BASEDIR="$DEFAULT_BASEDIR"
    fi
fi
echo "BASEDIR=$BASEDIR"

if [ -z "$SYSUSR" ]; then
    echo -n "System user name for slon to run under [$DEFAULT_SYSUSR]: "
    read SYSUSR
    if [ -z "$SYSUSR" ]; then
        SYSUSR="$DEFAULT_SYSUSR"
    fi
fi
echo "SYSUSR=$SYSUSR"

if [ -z "$PASSFILE" ]; then
    DEFAULT_PASSFILE=`eval echo "~$SYSUSR/.pgpass"`
    echo -n "And $SYSUSR's .pgpass file? [$DEFAULT_PASSFILE]: "
    read PASSFILE
    if [ -z "$PASSFILE" ]; then
        PASSFILE="$DEFAULT_PASSFILE"
    fi
fi
echo "PASSFILE=$PASSFILE"

if [ -z "$DBUSER" ]; then
    echo -n "Database user for slon to connect as [$DEFAULT_DBUSR]: "
    read DBUSER
    if [ -z "$DBUSER" ]; then
        DBUSER="$DEFAULT_DBUSR"
    fi
fi
echo "DBUSER=$DBUSER"

if [ -z "$HOST" ]; then
    echo -n "Host to connect to [$DEFAULT_HOST]: "
    read HOST
    if [ -z "$HOST" ]; then
        HOST="$DEFAULT_HOST"
    fi
fi
echo "HOST=$HOST"
if echo "$HOST" | grep / > /dev/null; then
    echo "Using / in your host name will make things break. Aborting."
    exit -1
fi

if [ -z "$PORT" ]; then
    echo -n "Port [$DEFAULT_PORT]: "
    read PORT
    if [ -z "$PORT" ]; then
        PORT="$DEFAULT_PORT"
    fi
fi
echo "PORT=$PORT"

if [ -z "$DATABASE" ]; then
    echo -n "Database [$DBUSER]: "
    read DATABASE
    if [ -z "$DATABASE" ]; then
        DATABASE="$DBUSER"
    fi
fi
echo "DATABASE=$DATABASE"
if echo "$DATABASE" | grep / > /dev/null; then
    echo "Using / in your database name will make things break. Aborting."
    exit -1
fi

if [ -z "$CLUSTER" ]; then
    echo -n "Cluster name: [$DATABASE]: "
    read CLUSTER
    if [ -z "$CLUSTER" ]; then
        CLUSTER="$DATABASE"
    fi
fi
echo "CLUSTER=$CLUSTER"
if echo "$CLUSTER" | grep / > /dev/null; then
    echo "Using / in your cluster name will make things break. Aborting."
    exit -1
fi

if [ -z "$SLON_BINARY" ]; then
    echo -n "Where is the slon binary? [$DEFAULT_SLON_BINARY]: "
    read SLON_BINARY
    if [ -z "$SLON_BINARY" ]; then
        SLON_BINARY=$DEFAULT_SLON_BINARY
    fi
fi
echo "SLON_BINARY=$SLON_BINARY"

DIR="$BASEDIR/slon_${CLUSTER}_${HOST}_${PORT}_$DATABASE"
CONFIGFILE="$DIR/slon.conf"
echo "CONFIGFILE=$CONFIGFILE"

echo "Service dir will be created under $DIR"

mkdir -p "$DIR/env" "$DIR/supervise" "$DIR/log/supervise" "$DIR/log/main" || exit -1
# Make sure the log file initially exists. This allows others to tail -F it
# before it starts getting populated. go go logrep!
touch "$DIR/log/main/current" || exit -1

# Set up the slon.conf file
cat > "$CONFIGFILE" <<EOF
# $CONFIGFILE
##############################################################################
# Connection settings

# Set the cluster name that this instance of slon is running against.
# The default is to read it off the command line.
cluster_name "$CLUSTER"

# Set slon's connection info; default is to read it off the command line.
conn_info "host=$HOST port=$PORT dbname=$DATABASE user=$DBUSER"

# Execute this SQL on each node at slon connect time. Useful to set logging
# levels, or to tune the planner/memory settings. You can specify multiple
# statements by separating them with a ; 
#sql_on_connection 

##############################################################################
# Logging

# If you want to use syslog then redir output from the slon to /dev/null and
# remove the log dir.

# Sets up logging to syslog. If this parameter is 1, messages go both to
# syslog and the standard output. A value of 2 sends output only to syslog
# (some messages will still go to the standard output/error). 
# Default is 0, which means syslog is off.
#syslog 0

# Sets the syslog "facility" to be used when syslog enabled. Valid values
# are LOCAL0, LOCAL1, LOCAL2, LOCAL3, LOCAL4, LOCAL5, LOCAL6, LOCAL7. 
# Default is LOCAL0.
#syslog_facility LOCAL0

# Sets the program name used to identify slon messages in syslog.
# The default is slon.
#syslog_ident slon

# Debug log level (higher value ==> more output).
# Range: [0,4], default 4
log_level $DEFAULT_SLON_DEBUG_LEVEL     # 3 and up is generally too high for production

# Determins, if you would like the pid of the (parent) slon process to appear
# in each log line entry.
# Default 0
log_pid 1           # good to know

# Determines if you would like the timestamp of the event being logged to
# appear in each log line entry.
log_timestamp  0    # multilog will insert a tai64n timestamp

# A strftime()-conformant format string for use if log_timestamp is enabled.
# The default is "%Y-%m-%d %H:%M:%S %Z"
#log_timestamp_format = "%Y-%m-%d %H:%M:%S %Z"

# Location and filename you would like for a file containing the Process ID
# of the slon process.
# The default is not defined in which case no file is written.
#pid_file       # daemontools renders this unnecessary, even undesireable
                # use instead the svc interface to signal the slon.

##############################################################################
# Archive Logging

# This indicates in what directory sync archive files should be stored.
#archive_dir

# This indicates a Unix command to be submitted each time an archive log
# is successfully generated.
#command_on_logarchive

##############################################################################
# Event Tuning

# Check for updates at least this often in milliseconds.
# Range: [10-60000], default 100
#sync_interval 100 

# Maximum amount of time in milliseconds before issuing a SYNC event, 
# This prevents a possible race condition in which the action sequence is
# bumped by the trigger while inserting the log row, which makes this bump
# is immediately visible to the sync thread, but the resulting log rows are
# not visible yet. If the SYNC is picked up by the subscriber, processed
# and finished before the transaction commits, this transaction's changes
# will not be replicated until the next SYNC. But if all application
# activity suddenly stops, there will be no more sequence bumps, so the
# high frequent -s check won't detect that. Thus, the need for
# sync_interval_timeout.
# Range: [0-120000], default 1000
#sync_interval_timeout 1000 

# Maximum number of SYNC events to group together when/if a subscriber falls
# behind. SYNCs are batched only if there are that many available and if they
# are contiguous. Every other event type in between leads to a smaller batch.
# And if there is only one SYNC available, even -g60 will apply just that one.
# As soon as a subscriber catches up, it will apply every single SYNC by itself.
# Range: [0,10000], default: 6
#sync_group_maxsize 6

# Sets how many cleanup cycles to run before a vacuum is done. 0 disables the
# builtin vacuum, intended to be used with the pg_autovacuum daemon.
# Range: [0,100], default: 3
#vac_frequency 3

# Maximum time planned for grouped SYNCs. If replication is behind, slon will
# try to increase numbers of syncs done targetting that they should take this
# quantity of time to process. If the value is set to 0, this logic will be
# ignored. 
# Range [10000,600000] ms, default 60000.
#desired_sync_time 60000 

# This must be used in conjunction with quit_sync_finalsync, and indicates
# which provider node's worker thread should be watched to see if the slon
# should terminate due to reaching some desired "final" event number.
#quit_sync_provider 0

# Final event number to process. This must be used in conjunction with
# quit_sync_finalsync, and allows the slon to terminate itself once it
# reaches a certain event for the specified provider. If the value is set
# to 0, this logic will be ignored. 
#quit_sync_finalsync 0

# Indicates an interval by which this node should lag its providers. If set,
# this is used in the event processing loop to modify what events are to be
# considered for queueing; those events newer than
# now() - lag_interval::interval are left out, to be processed later.
# If the value is left empty, this logic will be ignored. 
#lag_interval

# Size above which an sl_log_? row's log_cmddata is considered large. Up to
# 500 rows of this size are allowed in memory at once. Rows larger than that
# count into the sync_max_largemem space allocated and free()'ed on demand.
# The default value is 8192, meaning that your expected memory consumption
# (for the LOG cursor) should not exceed 8MB.
#sync_max_rowsize 8192

# Maximum memory allocated for large rows, where log_cmddata are larger than
# sync_max_rowsize. Note that the algorithm reads rows until after this value
# is exceeded. Otherwise, a tuple larger than this value would stall
# replication. As a result, don't assume that memory consumption will remain
# smaller than this value.  The default value is 5242880.
#sync_max_largemem 5242880

# How long should the remote listener wait before treating the event selection
# criteria as having timed out?
# Range: [30-30000], default 300 
#remote_listen_timeout 300

EOF

# Set up the envdir contents. Generously.
echo "$SLON_BINARY"                 > $DIR/env/SLON_BINARY
echo "$CONFIGFILE"                  > $DIR/env/CONFIGFILE
echo "$CLUSTER"                     > $DIR/env/CLUSTER
echo "$HOST"                        > $DIR/env/PGHOST
echo "$PORT"                        > $DIR/env/PGPORT
echo "$DATABASE"                    > $DIR/env/PGDATABASE
# The absence of PGPASSWORD is not an oversight. Use .pgpass
# Configure the location of .pgpass file here...
# I'd like a better solution than this for expanding the homedir.
echo "$PASSFILE"                    > $DIR/env/PGPASSFILE 
echo "$DBUSER"                      > $DIR/env/PGUSER
# Change these if you're stupid or unfortunate enough to have to.
echo 'ISO'                          > $DIR/env/PGDATESTYLE
echo 'UTC'                          > $DIR/env/PGTZ

# create the run script for the slon
cat > "$DIR/run" <<EOF
#!/bin/sh
# Note that the slon binary is a variable, so you can edit your envdir
# settings to upgrade slons then restart them.
exec 2>&1
exec envdir ./env sh -c 'exec setuidgid ${SYSUSR} "\${SLON_BINARY}" -f "\${CONFIGFILE}"'
EOF
chmod a+x "$DIR/run"
echo "$DIR/run created"

# create the run file for the multilog
cat > "$DIR/log/run" <<EOF
#!/bin/sh
# This puts everything in the main log. Unfortunately multilog only allows
# you to select which log you want to write to as opposed to writing each
# line to every log which matches the criteria.
#
# Note that size (in bytes) of the log files (before they get rotated) is 
# controlled by the s parameter. You might want to increase this. It goes
# up to a maximum of 16777215 (15MB) and defaults to 99999 (97kB).
# I'm using 10485760 (10MB)
# The n paramter decides how many old log files to keep around. Defaults
# to 10. 
exec setuidgid $SYSUSR multilog t s10485760 n99 ./main
EOF
chmod a+x "$DIR/log/run"
echo "$DIR/log/run created"

# create and fix permissions for .pgpass appropriately
touch "$PASSFILE"
chmod 600 "$PASSSFILE"
if [ ! -s "$PASSFILE" ]; then
    echo "Populating $PASSFILE"
    cat > "$PASSFILE" <<EOF
#hostname:port:database:username:password
#$HOST:$PORT:*:$DBUSER:secret
EOF
fi

# fix permissions and ownership
chown -R "$SYSUSR" "$DIR"
chmod a+rX "$DIR"

cat <<EOF
When you're ready to start the slon, simply link the newly created dir, 
$DIR
under your current supervisor's directory. On FreeBSD this is /var/service
by default. So the command would be:

sudo ln -s $DIR /var/service

The slon should be started within 5 seconds.

You can further configure the slon by modifying stuff in the 
$DIR/env
directory. Specifically, make sure that the SLON variable points to the right
slon binary. You may also want to edit
$CONFIGFILE

Finally, you need to make sure that $PASSFILE 
is correctly in place. If you didn't have one before (or it was empty), it
has been created and populated with some sample data.

You may also want to set up a logrep to filter out the more intresting
log lines. See logrep-mkservice.sh.
EOF

--- NEW FILE: logrep-mkservice.sh ---
#!/bin/sh
#
# $Id: logrep-mkservice.sh,v 1.1 2007-03-30 14:49:46 cbbrowne Exp $
#
# contributed by Andrew Hammond <andrew.george.hammond@gmail.com>
#
# logrep: use tail -F to pull from another log file for filtering to create
# special purpose log files. Some example filters follow.
#
# For non-interactive use, set the following environment variables.
# BASEDIR SYSUSR SOURCE EXTENSION CRITERIA 
#
# Slony subscribe specific information
# '-*' '+* * ERROR*' '+* * WARN*' '+* * CONFIG enableSubscription*' '+* * DEBUG2 remoteWorkerThread_* prepare to copy table*' '+* * DEBUG2 remoteWorkerThread_* all tables for set * found on subscriber*' '+* * DEBUG2 remoteWorkerThread_* copy*' '+* * DEBUG2 remoteWorkerThread_* Begin COPY of table*' '+* * DEBUG2 remoteWorkerThread_* * bytes copied for table*' '+* * DEBUG2 remoteWorkerThread_* * seconds to*' '+* * DEBUG2 remoteWorkerThread_* set last_value of sequence*' '+* * DEBUG2 remoteWorkerThread_* copy_set*'
#
# Errors to trigger nagios
# '-*' '+* * ERROR*'

DEFAULT_BASEDIR='/usr/local/etc'
DEFAULT_SYSUSR='pgsql'                          # FreeBSD-centric. Oh well.
DEFAULT_SOURCE='slon_123'
DEFAULT_EXTENSION='_NODEBUG'
DEFAULT_CRITERIA="'-* [*] DEBUG*'"

if [ -z "$BASEDIR" ]; then
    echo -n "Where do you want the service dir created? Don't want to created this in /service or /var/service. Once it's created, either link or move it to the service directory (since linking is an atomic filesystem action). If your service directory is on a small, relatively static partition, you will almost certainly want to put this on a partition that can handle some log files and then link.
[$DEFAULT_BASEDIR]: "
    read BASEDIR
    if [ -z "$BASEDIR" ]; then
        BASEDIR="$DEFAULT_BASEDIR"
    fi
fi
echo "BASEDIR=$BASEDIR"

if [ -z "$SYSUSR" ]; then
    echo -n "System user name for followgrep to run under [$DEFAULT_SYSUSR]: "
    read SYSUSR
    if [ -z "$SYSUSR" ]; then
        SYSUSR="$DEFAULT_SYSUSR"
    fi
fi
echo "SYSUSR=$SYSUSR"

if [ -z "$SOURCE" ]; then
    echo -n "Service to follow [$DEFAULT_SOURCE]: "
    read SOURCE
    if [ -z "$SOURCE" ]; then
        DATABASE="$DEFAULT_SOURCE"
    fi
fi
echo "SOURCE=$SOURCE"

if [ -z "$EXTENSION" ]; then
    echo -n "Name extension [$DEFAULT_EXTENSION]: "
    read EXTENSION
    if [ -z "$EXTENSION" ]; then
        EXTENSION="$DEFAULT_EXTENSION"
    fi
fi
echo "EXTENSION=$EXTENSION"

if [ -z "$CRITERIA" ]; then
    echo -n "Criteria [$DEFAULT_CRITERIA]: "
    read CRITERIA
    if [ -z "$CRITERIA" ]; then
        CRITERIA="$DEFAULT_CRITERIA"
    fi
fi
echo "CRITERIA=$CRITERIA"

DIR="$BASEDIR/logrep_$SOURCE$EXTENSION"
echo "Service dir will be created under $DIR"

mkdir -p "$DIR/supervise" "$DIR/log/supervise" "$DIR/log/main" || exit -1
# Make sure the log file initially exists. This allows others to tail -F it
# before it starts getting populated.
touch "$DIR/log/main/current" || exit -1

# create the run script
cat > "$DIR/run" <<EOF
#!/bin/sh
exec 2>&1
exec setuidgid $SYSUSR tail -F "$BASEDIR/$SOURCE/log/main/current"
EOF
chmod a+x "$DIR/run"
echo "$DIR/run created"

# create the run file for the multilog
cat > "$DIR/log/run" <<EOF
#!/bin/sh
# DO NOT add another timestamp using the t parameter to multilog. Unless
# of course you like being confused.
# Note that size (in bytes) of the log files (before they get rotated) is 
# controlled by the s parameter. You might want to increase this. It goes
# up to a maximum of 16777215 (15MB) and defaults to 99999 (97kB).
# I'm using 10485760 (10MB)
# The n paramter decides how many old log files to keep around. Defaults
# to 10. 
exec setuidgid $SYSUSR multilog s10485760 n99 $CRITERIA ./main
EOF
chmod a+x "$DIR/log/run"
echo "$DIR/log/run created"

# fix permissions and ownership
chown -R "$SYSUSR" "$DIR"
chmod a+rX "$DIR"

cat <<EOF
When you're ready to start logrep, simply link the newly created dir, 
$DIR
under your current supervisor's directory. On FreeBSD this is /var/service
by default. So the command would be:

sudo ln -s $DIR /var/service

The service should be started within 5 seconds.
EOF

From cbbrowne at lists.slony.info  Fri Mar 30 15:43:06 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Fri Mar 30 15:43:08 2007
Subject: [Slony1-commit] slony1-engine/tests/testddl README
	ddl_update_part2.sql generate_dml.sh individual_ddl.sh
	init_subscribe_set.ik settings.ik
Message-ID: <20070330224306.70D652903B3@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/tests/testddl
In directory main.slony.info:/tmp/cvs-serv26559

Modified Files:
      Tag: REL_1_2_STABLE
	README generate_dml.sh init_subscribe_set.ik settings.ik 
Added Files:
      Tag: REL_1_2_STABLE
	ddl_update_part2.sql individual_ddl.sh 
Log Message:
Augment DDL test with an "EXECUTE ONLY ON" case.


Index: settings.ik
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tests/testddl/settings.ik,v
retrieving revision 1.1
retrieving revision 1.1.4.1
diff -C2 -d -r1.1 -r1.1.4.1
*** settings.ik	18 Nov 2005 17:15:21 -0000	1.1
--- settings.ik	30 Mar 2007 22:43:04 -0000	1.1.4.1
***************
*** 1,4 ****
  NUMCLUSTERS=${NUMCLUSTERS:-"1"}
! NUMNODES=${NUMNODES:-"2"}
  ORIGINNODE=1
  WORKERS=${WORKERS:-"1"}
--- 1,4 ----
  NUMCLUSTERS=${NUMCLUSTERS:-"1"}
! NUMNODES=${NUMNODES:-"3"}
  ORIGINNODE=1
  WORKERS=${WORKERS:-"1"}

--- NEW FILE: ddl_update_part2.sql ---
create sequence t1seq;
alter table table1 add column seqed integer;
alter table table1 alter column seqed set default nextval('t1seq');
update table1 set seqed = nextval('t1seq');
alter table table1 add constraint seqed_unique UNIQUE(seqed);

Index: generate_dml.sh
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tests/testddl/generate_dml.sh,v
retrieving revision 1.3.2.3
retrieving revision 1.3.2.4
diff -C2 -d -r1.3.2.3 -r1.3.2.4
*** generate_dml.sh	22 Mar 2007 20:46:12 -0000	1.3.2.3
--- generate_dml.sh	30 Mar 2007 22:43:04 -0000	1.3.2.4
***************
*** 31,34 ****
--- 31,36 ----
    percent=`expr $j \* 5`
    status "$percent %"
+   GENDATA="$mktmp/generate.data"
+   echo "" > ${GENDATA}
    while : ; do
      txtalen=$(random_number 1 100)
***************
*** 38,42 ****
      txtb=$(random_string ${txtblen})
      txtb=`echo ${txtb} | sed -e "s/\\\\\\\/\\\\\\\\\\\\\\/g" -e "s/'/''/g"`
-     GENDATA="$mktmp/generate.data"
      echo "INSERT INTO table1(data) VALUES ('${txta}');" >> $GENDATA
      echo "INSERT INTO table2(table1_id,data) SELECT id, '${txtb}' FROM table1 WHERE data='${txta}';" >> $GENDATA
--- 40,43 ----
***************
*** 87,90 ****
--- 88,107 ----
    $pgbindir/psql -h $host -p $port -U $user -d $db < $mktmp/generate.data 1> $LOG 2> $LOG
    wait_for_catchup
+ 
+   status "Execute a script on each node, one by one"
+   for node in 1 2 3; do
+       init_preamble
+       sh ${testname}/individual_ddl.sh ${testname} ${node} >> ${SCRIPT}
+       status "execute DDL script only on node ${node}"
+       do_ik
+   done
+ 
+   status "Generate still more data"
+   generate_initdata
+   eval db=\$DB${originnode}
+   status "loading extra data to node $db"
+   $pgbindir/psql -h $host -p $port -U $user -d $db < $mktmp/generate.data 1> $LOG 2> $LOG
+   wait_for_catchup
+ 
    status "done"
  }

--- NEW FILE: individual_ddl.sh ---
testname=$1
node=$2
echo "
  EXECUTE SCRIPT (
       SET ID = 1,
       FILENAME = '${testname}/ddl_update_part2.sql',
       EVENT NODE = 1
       EXECUTE ONLY ON = ${node}
    );
"

Index: README
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tests/testddl/README,v
retrieving revision 1.1
retrieving revision 1.1.4.1
diff -C2 -d -r1.1 -r1.1.4.1
*** README	18 Nov 2005 17:15:21 -0000	1.1
--- README	30 Mar 2007 22:43:04 -0000	1.1.4.1
***************
*** 10,11 ****
--- 10,14 ----
  4.  Inserting new data as part of the script
  5.  Updating data as part of the script
+ 
+ 2007-03-31 - Add in a third node, and add in a series of "EXECUTE ONLY
+ ON" clauses.

Index: init_subscribe_set.ik
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tests/testddl/init_subscribe_set.ik,v
retrieving revision 1.1
retrieving revision 1.1.4.1
diff -C2 -d -r1.1 -r1.1.4.1
*** init_subscribe_set.ik	18 Nov 2005 17:15:21 -0000	1.1
--- init_subscribe_set.ik	30 Mar 2007 22:43:04 -0000	1.1.4.1
***************
*** 1 ****
--- 1,6 ----
  subscribe set ( id = 1, provider = 1, receiver = 2, forward = no);
+ sync(id=1);
+ wait for event (origin=1, confirmed=2);
+ echo 'sleep a couple seconds';
+ sleep (seconds = 2);
+ subscribe set ( id = 1, provider = 1, receiver = 3, forward = no);

From cbbrowne at lists.slony.info  Fri Mar 30 15:44:07 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Fri Mar 30 15:44:08 2007
Subject: [Slony1-commit] slony1-engine/tests/testddl ddl_update_part2.sql
	generate_dml.sh individual_ddl.sh init_subscribe_set.ik settings.ik
Message-ID: <20070330224407.3632E29045C@main.slony.info>

Update of /home/cvsd/slony1/slony1-engine/tests/testddl
In directory main.slony.info:/tmp/cvs-serv26592

Modified Files:
	generate_dml.sh init_subscribe_set.ik settings.ik 
Added Files:
	ddl_update_part2.sql individual_ddl.sh 
Log Message:
Add into DDL SCRIPT test a case that uses an EXECUTE ONLY ON clause


Index: settings.ik
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tests/testddl/settings.ik,v
retrieving revision 1.1
retrieving revision 1.2
diff -C2 -d -r1.1 -r1.2
*** settings.ik	18 Nov 2005 17:15:21 -0000	1.1
--- settings.ik	30 Mar 2007 22:44:05 -0000	1.2
***************
*** 1,4 ****
  NUMCLUSTERS=${NUMCLUSTERS:-"1"}
! NUMNODES=${NUMNODES:-"2"}
  ORIGINNODE=1
  WORKERS=${WORKERS:-"1"}
--- 1,4 ----
  NUMCLUSTERS=${NUMCLUSTERS:-"1"}
! NUMNODES=${NUMNODES:-"3"}
  ORIGINNODE=1
  WORKERS=${WORKERS:-"1"}

--- NEW FILE: ddl_update_part2.sql ---
create sequence t1seq;
alter table table1 add column seqed integer;
alter table table1 alter column seqed set default nextval('t1seq');
update table1 set seqed = nextval('t1seq');
alter table table1 add constraint seqed_unique UNIQUE(seqed);

Index: generate_dml.sh
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tests/testddl/generate_dml.sh,v
retrieving revision 1.6
retrieving revision 1.7
diff -C2 -d -r1.6 -r1.7
*** generate_dml.sh	22 Mar 2007 20:44:55 -0000	1.6
--- generate_dml.sh	30 Mar 2007 22:44:05 -0000	1.7
***************
*** 31,34 ****
--- 31,36 ----
    percent=`expr $j \* 5`
    status "$percent %"
+   GENDATA="$mktmp/generate.data"
+   echo "" > ${GENDATA}
    while : ; do
      txtalen=$(random_number 1 100)
***************
*** 38,42 ****
      txtb=$(random_string ${txtblen})
      txtb=`echo ${txtb} | sed -e "s/\\\\\\\/\\\\\\\\\\\\\\/g" -e "s/'/''/g"`
-     GENDATA="$mktmp/generate.data"
      echo "INSERT INTO table1(data) VALUES ('${txta}');" >> $GENDATA
      echo "INSERT INTO table2(table1_id,data) SELECT id, '${txtb}' FROM table1 WHERE data='${txta}';" >> $GENDATA
--- 40,43 ----
***************
*** 87,90 ****
--- 88,107 ----
    $pgbindir/psql -h $host -p $port -U $user -d $db < $mktmp/generate.data 1> $LOG 2> $LOG
    wait_for_catchup
+ 
+   status "Execute a script on each node, one by one"
+   for node in 1 2 3; do
+       init_preamble
+       sh ${testname}/individual_ddl.sh ${testname} ${node} >> ${SCRIPT}
+       status "execute DDL script only on node ${node}"
+       do_ik
+   done
+ 
+   status "Generate still more data"
+   generate_initdata
+   eval db=\$DB${originnode}
+   status "loading extra data to node $db"
+   $pgbindir/psql -h $host -p $port -U $user -d $db < $mktmp/generate.data 1> $LOG 2> $LOG
+   wait_for_catchup
+ 
    status "done"
  }

--- NEW FILE: individual_ddl.sh ---
testname=$1
node=$2
echo "
  EXECUTE SCRIPT (
       SET ID = 1,
       FILENAME = '${testname}/ddl_update_part2.sql',
       EVENT NODE = 1
       EXECUTE ONLY ON = ${node}
    );
"

Index: init_subscribe_set.ik
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tests/testddl/init_subscribe_set.ik,v
retrieving revision 1.1
retrieving revision 1.2
diff -C2 -d -r1.1 -r1.2
*** init_subscribe_set.ik	18 Nov 2005 17:15:21 -0000	1.1
--- init_subscribe_set.ik	30 Mar 2007 22:44:05 -0000	1.2
***************
*** 1 ****
--- 1,6 ----
  subscribe set ( id = 1, provider = 1, receiver = 2, forward = no);
+ sync(id=1);
+ wait for event (origin=1, confirmed=2);
+ echo 'sleep a couple seconds';
+ sleep (seconds = 2);
+ subscribe set ( id = 1, provider = 1, receiver = 3, forward = no);

