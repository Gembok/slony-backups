From root  Tue Feb 13 08:51:08 2007
From: root (root)
Date: Tue Feb 13 08:58:45 2007
Subject: [Slony1-commit] commitinfo
Message-ID: <20070119233249.7561D290052@main>

l

From root  Tue Feb 13 08:51:08 2007
From: root (root)
Date: Tue Feb 13 08:58:45 2007
Subject: [Slony1-commit] commitinfo
Message-ID: <20070119233945.CBA692902EA@main>

j

From root  Tue Feb 13 08:51:08 2007
From: root (root)
Date: Tue Feb 13 08:58:45 2007
Subject: [Slony1-commit] commitinfo
Message-ID: <20070119234115.8952729036A@main>

[A

From root  Tue Feb 13 08:51:08 2007
From: root (root)
Date: Tue Feb 13 08:58:45 2007
Subject: [Slony1-commit] commitinfo
Message-ID: <20070119235045.7818929030C@main>

c

From root  Tue Feb 13 08:51:08 2007
From: root (root)
Date: Tue Feb 13 08:58:45 2007
Subject: [Slony1-commit] CVSROOT
Message-ID: <20070120005413.3F11329036A@main>

t

From darcyb  Tue Feb 13 08:51:08 2007
From: darcyb (,,,)
Date: Tue Feb 13 08:58:45 2007
Subject: [Slony1-commit] /home/cvsd/slony1/slony1-engine COPYRIGHT
Message-ID: <20070123131131.8B0D72902E4@main>



From darcyb  Tue Feb 13 08:51:08 2007
From: darcyb (,,,)
Date: Tue Feb 13 08:58:45 2007
Subject: [Slony1-commit] /home/cvsd/slony1/slony1-engine
Message-ID: <20070123131438.E17ED2902E4@main>



From darcyb  Tue Feb 13 08:51:08 2007
From: darcyb (,,,)
Date: Tue Feb 13 08:58:45 2007
Subject: [Slony1-commit] COPYRIGHT 1.22 1.23
Message-ID: <20070123132111.2E042290370@main>

Update of /home/cvsd/slony1/slony1-engine
In directory main:/tmp/cvs-serv16463

Modified Files:
	COPYRIGHT 
Log Message:
Test Committ


Index: COPYRIGHT
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/COPYRIGHT,v
retrieving revision 1.22
retrieving revision 1.23
diff -C2 -d -r1.22 -r1.23
*** COPYRIGHT	23 Jan 2007 13:14:36 -0000	1.22
--- COPYRIGHT	23 Jan 2007 13:21:09 -0000	1.23
***************
*** 1,3 ****
! Slony-I - A replication system for the PostgreSQL Database Management System
  
  Copyright (c) 2003-2007, PostgreSQL Global Development Group
--- 1,3 ----
! Slony-I - A killer replication system for the PostgreSQL Database Management System
  
  Copyright (c) 2003-2007, PostgreSQL Global Development Group


From darcyb  Tue Feb 13 08:51:08 2007
From: darcyb (,,,)
Date: Tue Feb 13 08:58:45 2007
Subject: [Slony1-commit] COPYRIGHT
Message-ID: <20070123132516.9D058290387@main>

Update of /home/cvsd/slony1/slony1-engine
In directory main:/tmp/cvs-serv16480

Modified Files:
	COPYRIGHT 
Log Message:
Commit test


Index: COPYRIGHT
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/COPYRIGHT,v
retrieving revision 1.23
retrieving revision 1.24
diff -C2 -d -r1.23 -r1.24
*** COPYRIGHT	23 Jan 2007 13:21:09 -0000	1.23
--- COPYRIGHT	23 Jan 2007 13:25:14 -0000	1.24
***************
*** 1,3 ****
! Slony-I - A killer replication system for the PostgreSQL Database Management System
  
  Copyright (c) 2003-2007, PostgreSQL Global Development Group
--- 1,3 ----
! Slony-I - A replication system for the PostgreSQL Database Management System
  
  Copyright (c) 2003-2007, PostgreSQL Global Development Group


From darcyb  Tue Feb 13 08:51:08 2007
From: darcyb (,,,)
Date: Tue Feb 13 08:58:45 2007
Subject: [Slony1-commit] COPYRIGHT
Message-ID: <20070123133350.75947290388@main>

Update of /home/cvsd/slony1/slony1-engine
In directory main:/tmp/cvs-serv16511

Modified Files:
	COPYRIGHT 
Log Message:
Update the description of slony-I


Index: COPYRIGHT
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/COPYRIGHT,v
retrieving revision 1.24
retrieving revision 1.25
diff -C2 -d -r1.24 -r1.25
*** COPYRIGHT	23 Jan 2007 13:25:14 -0000	1.24
--- COPYRIGHT	23 Jan 2007 13:33:48 -0000	1.25
***************
*** 1,3 ****
! Slony-I - A replication system for the PostgreSQL Database Management System
  
  Copyright (c) 2003-2007, PostgreSQL Global Development Group
--- 1,3 ----
! Slony-I - An asynchronous replication system for the PostgreSQL Database Management System
  
  Copyright (c) 2003-2007, PostgreSQL Global Development Group


From darcyb  Tue Feb 13 08:51:08 2007
From: darcyb (,,,)
Date: Tue Feb 13 08:58:45 2007
Subject: [Slony1-commit] slony1-engine COPYRIGHT
Message-ID: <20070125162819.C4438290391@main>

Update of /home/cvsd/slony1/slony1-engine
In directory main:/tmp/cvs-serv17766

Modified Files:
	COPYRIGHT 
Log Message:
Update to include 2007


Index: COPYRIGHT
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/COPYRIGHT,v
retrieving revision 1.3
retrieving revision 1.4
diff -C2 -d -r1.3 -r1.4
*** COPYRIGHT	14 Apr 2005 16:44:51 -0000	1.3
--- COPYRIGHT	25 Jan 2007 16:28:17 -0000	1.4
***************
*** 1,5 ****
  Slony-I - A replication system for the PostgreSQL Database Management System
  
! Copyright (c) 2003-2005, PostgreSQL Global Development Group
  
  Permission to use, copy, modify, and distribute this software and its
--- 1,5 ----
  Slony-I - A replication system for the PostgreSQL Database Management System
  
! Copyright (c) 2003-2007, PostgreSQL Global Development Group
  
  Permission to use, copy, modify, and distribute this software and its


From cbbrowne  Tue Feb 13 08:51:08 2007
From: cbbrowne (Chris Browne,,,)
Date: Tue Feb 13 08:58:45 2007
Subject: [Slony1-commit] slony1-engine/doc/website index.html
Message-ID: <20070125171624.DDE69290389@main>

Update of /home/cvsd/slony1/slony1-engine/doc/website
In directory main:/tmp/cvs-serv18131

Modified Files:
	index.html 
Log Message:
Add more commentary about the migration from gBorg


Index: index.html
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/website/index.html,v
retrieving revision 1.5
retrieving revision 1.6
diff -C2 -d -r1.5 -r1.6
*** index.html	25 Jan 2007 17:02:24 -0000	1.5
--- index.html	25 Jan 2007 17:16:22 -0000	1.6
***************
*** 91,98 ****
            <p>It will soon be able to be actively used for Slony-I
            CVS, downloads, and mailing lists; it's not <i>quite</i>
!           ready yet, so for now, you likely want to look to the
            <a href=
            "http://gborg.postgresql.org/project/slony1/projdisplay.php">
!           gBorg Slony-I project</a></p>
  
            <h1>Slony-I</h1>
--- 91,101 ----
            <p>It will soon be able to be actively used for Slony-I
            CVS, downloads, and mailing lists; it's not <i>quite</i>
!           ready yet, so for now, you likely still want to look to the
            <a href=
            "http://gborg.postgresql.org/project/slony1/projdisplay.php">
!           gBorg Slony-I project</a> for the time being.</p>
! 
!           <p> There will be announcements on the gBorg-based mailing
!           lists indicating the migration when all is ready... </p>
  
            <h1>Slony-I</h1>


From cbbrowne  Tue Feb 13 08:51:08 2007
From: cbbrowne (Chris Browne,,,)
Date: Tue Feb 13 08:58:45 2007
Subject: [Slony1-commit] slony1-www/downloads slony1-1.2.6-docs.tar.bz2
Message-ID: <20070125193017.E92D12902D3@main>

Update of /home/cvsd/slony1/slony1-www/downloads
In directory main:/tmp/cvs-serv18407

Removed Files:
	slony1-1.2.6-docs.tar.bz2 
Log Message:
Remove docs file accidentally added to CVS


--- slony1-1.2.6-docs.tar.bz2 DELETED ---


From cbbrowne  Tue Feb 13 08:51:08 2007
From: cbbrowne (Chris Browne,,,)
Date: Tue Feb 13 08:58:45 2007
Subject: [Slony1-commit] slony1-www cvs.html
Message-ID: <20070125194258.468502903A4@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv18429

Modified Files:
	cvs.html 
Log Message:
Add CVS access configuration


Index: cvs.html
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/cvs.html,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -C2 -d -r1.1.1.1 -r1.2
*** cvs.html	25 Jan 2007 19:26:19 -0000	1.1.1.1
--- cvs.html	25 Jan 2007 19:42:56 -0000	1.2
***************
*** 89,92 ****
--- 89,121 ----
            <p>This will eventually discuss how to get at Slony-I
            CVS...</p>
+ 
+           <h1>Anonymous CVS Access</h1>
+ 
+           <p>You may access Slony-I sources via anonymous CVS using
+           the following command:</p>
+           <pre>
+ CVSROOT=":pserver:anonymous@main.slony.info:/slony1" cvs login
+ (when it prompts for a password, you may press [enter])
+ CVSROOT=":pserver:anonymous@main.slony.info:/slony1" cvs co slony1-engine
+ </pre>
+ 
+           <h1>Developer CVS Access</h1>
+ 
+           <p>If you are one of the developers, and have had your
+           ssh key added in on a suitable account, you can access as
+           a specific user with update privileges:</p>
+           <pre>
+ MYSLONYNAME=cbbrowne CVS_RSH=ssh CVSROOT=":ext:${MYSLONYNAME}@main.slony.info:/home/cvsd/slony1" cvs co slony1-engine
+ </pre>
+ 
+           <h1>Modules Available</h1>
+ 
+           <ul>
+             <li><tt>slony1-engine</tt> - the replication engine
+             project</li>
+ 
+             <li><tt>slony1-www</tt> - web site material for
+             main.slony.info</li>
+           </ul>
            <hr>
  
***************
*** 96,100 ****
            </address><!-- Created: Thu Jan 25 11:44:43 EST 2007 -->
            <!-- hhmts start -->
!           Last modified: Thu Jan 25 11:46:45 EST 2007 
            <!-- hhmts end -->
          </td>
--- 125,129 ----
            </address><!-- Created: Thu Jan 25 11:44:43 EST 2007 -->
            <!-- hhmts start -->
!           Last modified: Thu Jan 25 14:42:23 EST 2007 
            <!-- hhmts end -->
          </td>


From cbbrowne  Tue Feb 13 08:51:08 2007
From: cbbrowne (Chris Browne,,,)
Date: Tue Feb 13 08:58:45 2007
Subject: [Slony1-commit] slony1-www admin.html
Message-ID: <20070125200100.3161229028B@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv18546

Modified Files:
	admin.html 
Log Message:
Describe where web pages live on main.cvs.info


Index: admin.html
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/admin.html,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -C2 -d -r1.1.1.1 -r1.2
*** admin.html	25 Jan 2007 19:26:19 -0000	1.1.1.1
--- admin.html	25 Jan 2007 20:00:58 -0000	1.2
***************
*** 84,89 ****
            </table>
  
!           <h1><font face="lucida,arial,helvetica" size="2">Project
!           Admin Area</font></h1>Heh. Doesn't exist yet...
            <hr>
  
--- 84,105 ----
            </table>
  
!           <h1>Project Admin Area</h1>
! 
!           <p>Heh. Doesn't much exist yet...</p>
! 
!           <h1>Web Site and CVS</h1>
! 
!           <p>The Slony-I web site physically resides at path
!           <tt>/home/community/slony/htdocs</tt> , and is an
!           anonymous checkout of the <tt>slony1-www</tt> <a href=
!           "cvs.html">CVS repository.</a></p>
! 
!           <p>As a result, if you make changes directly, you'll want
!           to do a <tt>cvs diff</tt> to extract those changes, and
!           apply them to some not-so-anonymous copy of CVS that you
!           have access to. Then please commit such changes to CVS
!           and see about doing a <tt>cvs update</tt> in the
!           <tt>htdocs</tt> directory to deploy those changes "to
!           production."</p>
            <hr>
  
***************
*** 93,97 ****
            </address><!-- Created: Thu Jan 25 11:38:58 EST 2007 -->
            <!-- hhmts start -->
!           Last modified: Thu Jan 25 11:46:42 EST 2007 
            <!-- hhmts end -->
          </td>
--- 109,113 ----
            </address><!-- Created: Thu Jan 25 11:38:58 EST 2007 -->
            <!-- hhmts start -->
!           Last modified: Thu Jan 25 15:00:09 EST 2007 
            <!-- hhmts end -->
          </td>


From xfade  Tue Feb 13 08:51:09 2007
From: xfade (,,,)
Date: Tue Feb 13 08:58:45 2007
Subject: [Slony1-commit] slony1-www index.html
Message-ID: <20070126172920.6AB6A290320@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv18807

Modified Files:
	index.html 
Log Message:
Testing

Index: index.html
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/index.html,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -C2 -d -r1.1.1.1 -r1.2
*** index.html	25 Jan 2007 19:26:19 -0000	1.1.1.1
--- index.html	26 Jan 2007 17:29:18 -0000	1.2
***************
*** 6,10 ****
    "HTML Tidy for Linux/x86 (vers 1 September 2005), see www.w3.org">
  
!   <title>Slony-I</title>
  <style type="text/css">
  a:link{
--- 6,10 ----
    "HTML Tidy for Linux/x86 (vers 1 September 2005), see www.w3.org">
  
!   <title>Slony-I - "master to multiple slaves" replication system with cascading and failover</title>
  <style type="text/css">
  a:link{


From xfade  Tue Feb 13 08:51:09 2007
From: xfade (,,,)
Date: Tue Feb 13 08:58:45 2007
Subject: [Slony1-commit] slony1-www index.html
Message-ID: <20070126185030.D4B2C290320@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv18899

Modified Files:
	index.html 
Log Message:
testing again

Index: index.html
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/index.html,v
retrieving revision 1.2
retrieving revision 1.3
diff -C2 -d -r1.2 -r1.3
*** index.html	26 Jan 2007 17:29:18 -0000	1.2
--- index.html	26 Jan 2007 18:50:28 -0000	1.3
***************
*** 1,4 ****
  <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
- 
  <html>
  <head>
--- 1,3 ----


From xfade  Tue Feb 13 08:51:09 2007
From: xfade (,,,)
Date: Tue Feb 13 08:58:45 2007
Subject: [Slony1-commit] slony1-www index.html
Message-ID: <20070126185204.4A79129039C@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv18987

Modified Files:
	index.html 
Log Message:
testing again..

Index: index.html
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/index.html,v
retrieving revision 1.3
retrieving revision 1.4
diff -C2 -d -r1.3 -r1.4
*** index.html	26 Jan 2007 18:50:28 -0000	1.3
--- index.html	26 Jan 2007 18:52:02 -0000	1.4
***************
*** 4,8 ****
    <meta name="generator" content=
    "HTML Tidy for Linux/x86 (vers 1 September 2005), see www.w3.org">
- 
    <title>Slony-I - "master to multiple slaves" replication system with cascading and failover</title>
  <style type="text/css">
--- 4,7 ----


From xfade  Tue Feb 13 08:51:09 2007
From: xfade (Niels Breet)
Date: Tue Feb 13 08:58:45 2007
Subject: [Slony1-commit] slony1-www/images header-background.png
	header-left.png header-right.png intro-header-bg.png
	intro-header-left.png intro-header-right.png
Message-ID: <20070129122010.B1E292903AD@main>

Update of /home/cvsd/slony1/slony1-www/images
In directory main:/tmp/cvs-serv19877/images

Added Files:
	header-background.png header-left.png header-right.png 
	intro-header-bg.png intro-header-left.png 
	intro-header-right.png 
Log Message:
Add first part of new website layout.

--- NEW FILE: intro-header-left.png ---
(This appears to be a binary file; contents omitted.)

--- NEW FILE: header-background.png ---
(This appears to be a binary file; contents omitted.)

--- NEW FILE: header-right.png ---
(This appears to be a binary file; contents omitted.)

--- NEW FILE: intro-header-bg.png ---
(This appears to be a binary file; contents omitted.)

--- NEW FILE: intro-header-right.png ---
(This appears to be a binary file; contents omitted.)

--- NEW FILE: header-left.png ---
(This appears to be a binary file; contents omitted.)


From xfade  Tue Feb 13 08:51:09 2007
From: xfade (Niels Breet)
Date: Tue Feb 13 08:58:45 2007
Subject: [Slony1-commit] slony1-www test.html
Message-ID: <20070129122010.A1D352903A6@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv19877

Added Files:
	test.html 
Log Message:
Add first part of new website layout.

--- NEW FILE: test.html ---
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en">
<head>
<title>Slony-I</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="style.css" type="text/css" />
<!-- Design Copyright 2007 Niels Breet -->
</head>

<body>
<div class="header">
  <div class="left">
  <div class="menu">
    <a href="">Link1</a> 
    <a href="">Link2</a> 
    <a href="">Link3</a> 
    <a href="">Link4</a> 
  </div>
  </div>
  <div class="right">
  </div>
</div>

<div class="content">
  <div class="col1">
    <div class="intro-header">
      <div class="left"></div>
      <div class="right"><a href="">Title here</a></div>
    </div>
  </div>
  <div class="col2">
    <div class="intro-header">
      <div class="left"></div>
      <div class="right"><a href="">Title here</a></div>
    </div>
  </div>
</div>
</body>
</html>


From xfade  Tue Feb 13 08:51:09 2007
From: xfade (Niels Breet)
Date: Tue Feb 13 08:58:45 2007
Subject: [Slony1-commit] slony1-www style.css
Message-ID: <20070129122337.B380E2903AE@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv19937

Added Files:
	style.css 
Log Message:
Add the stylesheet too.

--- NEW FILE: style.css ---
body{
  font-family: sans serif;
  font-size: 10pt;
  margin: 8px;
}

.header{
  min-width: 782px;
  margin: 0;
  height: 108px;
  background: url('images/header-background.png') top left repeat-x;
  overflow: hidden;
}

.header .left{
  margin-left: 0;
  float: left;
  background: url('images/header-left.png') top left;
  width: 575px;
  height: 108px;
  overflow: hidden;
}

.header .right{
  float: right;
  background: url('images/header-right.png') top right;
  width: 206px;
  height: 108px;
  overflow: hidden;
}

.header .menu{
  position: relative;
  left: 330px;
  top: 82px;
  margin: 0;
  padding: 0;
  height: 20px;
}

.header .menu a{
  color: #ffffff;
  text-decoration: none;
  font-size: 14pt;
  font-weight: bold;
}

.header .menu a:hover{
  color: #cccccc;
}

.content{
  width: 100%;
}

.col1{
  float: left;
  width: 59%;
}

.col2{
  float: left;
  margin-left: 1%;
  width: 40%;
}

.intro-header{
  width: 100%;
  height: 28px;
  background: url('images/intro-header-bg.png') top left repeat-x;
  overflow: hidden;
}

.intro-header .left{
  background: url('images/intro-header-left.png') top left no-repeat;
  width: 4%;
  height: 28px;
  float: left;
}

.intro-header .right{
  width: 96%;
  height: 26px;
  float: left;
  background: url('images/intro-header-right.png') top right no-repeat;
  overflow: hidden;
  padding-top: 2px;
}

.intro-header .right a{
  color: #cccccc;
  text-decoration: none;
  font-size: 14pt;
  font-weight: bold;
}

.intro-header .right a:hover{
  color: #aaaacc;
  text-decoration: none;
  font-size: 14pt;
  font-weight: bold;
}


From cbbrowne  Tue Feb 13 08:51:09 2007
From: cbbrowne (Chris Browne)
Date: Tue Feb 13 08:58:45 2007
Subject: [Slony1-commit] slony1-www index.html
Message-ID: <20070129193016.32C1E290323@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv20439

Modified Files:
	index.html 
Log Message:
1.  Add in missing </ol> tag

2.  Add link to admin guide on upgrading Slony-I



Index: index.html
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/index.html,v
retrieving revision 1.4
retrieving revision 1.5
diff -C2 -d -r1.4 -r1.5
*** index.html	26 Jan 2007 18:52:02 -0000	1.4
--- index.html	29 Jan 2007 19:30:14 -0000	1.5
***************
*** 1,8 ****
  <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
  <html>
  <head>
    <meta name="generator" content=
    "HTML Tidy for Linux/x86 (vers 1 September 2005), see www.w3.org">
!   <title>Slony-I - "master to multiple slaves" replication system with cascading and failover</title>
  <style type="text/css">
  a:link{
--- 1,11 ----
  <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
+ 
  <html>
  <head>
    <meta name="generator" content=
    "HTML Tidy for Linux/x86 (vers 1 September 2005), see www.w3.org">
! 
!   <title>Slony-I - "master to multiple slaves" replication system
!   with cascading and failover</title>
  <style type="text/css">
  a:link{
***************
*** 89,99 ****
            <p>It will soon be able to be actively used for Slony-I
            CVS, downloads, and mailing lists; it's not <i>quite</i>
!           ready yet, so for now, you likely still want to look to the
!           <a href=
            "http://gborg.postgresql.org/project/slony1/projdisplay.php">
            gBorg Slony-I project</a> for the time being.</p>
  
!           <p> There will be announcements on the gBorg-based mailing
!           lists indicating the migration when all is ready... </p>
  
            <h1>Slony-I</h1>
--- 92,102 ----
            <p>It will soon be able to be actively used for Slony-I
            CVS, downloads, and mailing lists; it's not <i>quite</i>
!           ready yet, so for now, you likely still want to look to
!           the <a href=
            "http://gborg.postgresql.org/project/slony1/projdisplay.php">
            gBorg Slony-I project</a> for the time being.</p>
  
!           <p>There will be announcements on the gBorg-based mailing
!           lists indicating the migration when all is ready...</p>
  
            <h1>Slony-I</h1>
***************
*** 175,208 ****
              </li>
  
!             <li>Start all slon replication engines.
  
!               <h1>Libpq requirements</h1>
  
!               <p>The multithreaded replication engine requires the
!               libpq client library to be compiled with
!               --enable-thread-safety on certain operating systems.
!               Known are thus far Solaris and AIX. Other operating
!               systems are known to not require this (Linux-X86,
!               FreeBSD-X86, FreeBSD-Alpha, OpenBSD-Sparc64 and OSX).
!               The configuration script is broken with respect to
!               the --enable-thread-safety switch for Solaris. Please
!               apply this patch, configure and recompile libpq:
!               <a href=
!               "http://developer.postgresql.org/%7Ewieck/slony1/download/threadsafe-libpq-742.diff.gz">
!               threadsafe-libpq-742.diff.gz.</a></p>
  
!               <h1>RPMs</h1>
  
!               <p>RPM files for some versions of Red Hat Linux are
!               available <a href=
!               "http://pgfoundry.org/projects/slony1">here</a> ,
!               including SRPM (Source RPM) files that may be helpful
!               if you wish to generate RPM files for distributions
!               not yet supported.</p>
  
!               <p>This project is released under the Berkeley/BSD
!               license.</p>
!             </li>
!           </ol>
            <hr>
  
--- 178,213 ----
              </li>
  
!             <li>Start all slon replication engines.</li>
!           </ol>
  
!           <p>For more details, see also <a href=
!           "./adminguide/slony1-1.2.6/doc/adminguide/slonyupgrade.html">
!           Upgrading Slony-I</a> .</p>
  
!           <h1>Libpq requirements</h1>
  
!           <p>The multithreaded replication engine requires the
!           libpq client library to be compiled with
!           --enable-thread-safety on certain operating systems.
!           Known are thus far Solaris and AIX. Other operating
!           systems are known to not require this (Linux-X86,
!           FreeBSD-X86, FreeBSD-Alpha, OpenBSD-Sparc64 and OSX). The
!           configuration script is broken with respect to the
!           --enable-thread-safety switch for Solaris. Please apply
!           this patch, configure and recompile libpq: <a href=
!           "http://developer.postgresql.org/%7Ewieck/slony1/download/threadsafe-libpq-742.diff.gz">
!           threadsafe-libpq-742.diff.gz.</a></p>
  
!           <h1>RPMs</h1>
  
!           <p>RPM files for some versions of Red Hat Linux are
!           available <a href=
!           "http://pgfoundry.org/projects/slony1">here</a> ,
!           including SRPM (Source RPM) files that may be helpful if
!           you wish to generate RPM files for distributions not yet
!           supported.</p>
! 
!           <p>This project is released under the Berkeley/BSD
!           license.</p>
            <hr>
  
***************
*** 212,216 ****
            </address><!-- Created: Thu Jan 25 11:13:08 EST 2007 -->
            <!-- hhmts start -->
!           Last modified: Thu Jan 25 12:01:53 EST 2007 
            <!-- hhmts end -->
          </td>
--- 217,221 ----
            </address><!-- Created: Thu Jan 25 11:13:08 EST 2007 -->
            <!-- hhmts start -->
!           Last modified: Mon Jan 29 14:29:05 EST 2007 
            <!-- hhmts end -->
          </td>


From cbbrowne  Tue Feb 13 08:51:09 2007
From: cbbrowne (Chris Browne)
Date: Tue Feb 13 08:58:45 2007
Subject: [Slony1-commit] slony1-www admin.html
Message-ID: <20070129195308.303B829038E@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv20479

Modified Files:
	admin.html 
Log Message:
Add in some documentation of things that need to get backed up, and how
to do so using Unison...


Index: admin.html
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/admin.html,v
retrieving revision 1.2
retrieving revision 1.3
diff -C2 -d -r1.2 -r1.3
*** admin.html	25 Jan 2007 20:00:58 -0000	1.2
--- admin.html	29 Jan 2007 19:53:06 -0000	1.3
***************
*** 104,107 ****
--- 104,203 ----
            <hr>
  
+           <h1>Backups</h1>
+ 
+           <p>Both <tt>rsync</tt> and <tt>unison</tt> are installed;
+           either may be used to backup important parts of the web
+           site.</p>
+ 
+           <p>Here are the contents of a set of Unison <tt>.prf</tt>
+           files suitable for backing up CVS, mailing lists, and the
+           local web site contents.</p>
+ 
+           <ol>
+             <li>Unison configuration - <tt>cmdcvs.prf</tt>
+               <pre>
+ root = /home/cbbrowne/Slony-I/CMD/cvsbackup
+ root = ssh://cvs.slony.info//home/cvsd/slony1
+ </pre>
+             </li>
+ 
+             <li>Unison configuration -
+             <tt>cmdmailman-admin.prf</tt>
+               <pre>
+ root = /home/cbbrowne/Slony-I/CMD/mailman-backup/admin
+ root = ssh://cvs.slony.info//var/lib/mailman/archives/private/slony-admin
+ 
+ </pre>
+             </li>
+ 
+             <li>Unison configuration - <tt>cmdmailman-bugs.prf</tt>
+               <pre>
+ root = /home/cbbrowne/Slony-I/CMD/mailman-backup/bugs
+ root = ssh://cvs.slony.info//var/lib/mailman/archives/private/slony-bugs
+ 
+ </pre>
+             </li>
+ 
+             <li>Unison configuration -
+             <tt>cmdmailman-commit.prf</tt>
+               <pre>
+ root = /home/cbbrowne/Slony-I/CMD/mailman-backup/commit
+ root = ssh://cvs.slony.info//var/lib/mailman/archives/private/slony-commit
+ 
+ </pre>
+             </li>
+ 
+             <li>Unison configuration -
+             <tt>cmdmailman-general.prf</tt>
+               <pre>
+ root = /home/cbbrowne/Slony-I/CMD/mailman-backup/general
+ root = ssh://cvs.slony.info//var/lib/mailman/archives/private/slony-general
+ 
+ </pre>
+             </li>
+ 
+             <li>Unison configuration -
+             <tt>cmdmailman-hackers.prf</tt>
+               <pre>
+ root = /home/cbbrowne/Slony-I/CMD/mailman-backup/hackers
+ root = ssh://cvs.slony.info//var/lib/mailman/archives/private/slony-hackers
+ 
+ </pre>
+             </li>
+ 
+             <li>Unison configuration -
+             <tt>cmdmailman-patches.prf</tt>
+               <pre>
+ root = /home/cbbrowne/Slony-I/CMD/mailman-backup/patches
+ root = ssh://cvs.slony.info//var/lib/mailman/archives/private/slony-patches
+ 
+ </pre>
+             </li>
+ 
+             <li>Unison configuration - <tt>cmdweb.prf</tt>
+               <pre>
+ root = /home/cbbrowne/Slony-I/CMD/webbackup
+ root = ssh://cvs.slony.info//home/community/slony
+ </pre>
+             </li>
+           </ol>
+ 
+           <h2>Usage</h2>
+ 
+           <p>If you are using Unison, you might write the above
+           files into your local <tt>${HOME}/.unison</tt> directory,
+           and then use them as follows:</p>
+           <pre>
+ cd ${HOME}.unison
+ for target in `ls cmd*prf | cut -d "." -f 1`; do
+    unison ${target}
+ done
+ </pre>
+ 
+           <p>By default, this will request user intervention to
+           indicate the direction in which to propagate updates; if
+           you know what you're doing, you can tell
+           <tt>unison</tt>to "just do it."</p>
+ 
            <address>
              <a href="mailto:cbbrowne@ca.afilias.info">Christopher
***************
*** 109,113 ****
            </address><!-- Created: Thu Jan 25 11:38:58 EST 2007 -->
            <!-- hhmts start -->
!           Last modified: Thu Jan 25 15:00:09 EST 2007 
            <!-- hhmts end -->
          </td>
--- 205,209 ----
            </address><!-- Created: Thu Jan 25 11:38:58 EST 2007 -->
            <!-- hhmts start -->
!           Last modified: Mon Jan 29 14:52:13 EST 2007 
            <!-- hhmts end -->
          </td>


From xfade  Tue Feb 13 08:51:09 2007
From: xfade (Niels Breet)
Date: Tue Feb 13 08:58:46 2007
Subject: [Slony1-commit] slony1-www/images slon-slonik.png
Message-ID: <20070130100751.5E0EE2902CA@main>

Update of /home/cvsd/slony1/slony1-www/images
In directory main:/tmp/cvs-serv20574/images

Added Files:
	slon-slonik.png 
Log Message:
Add image of elephants. Original image by Christophe EYQUEM. Downloaded from: http://www.freemages.fr/browse/show.php?id=295 . Removed background, so it fits in our website.

--- NEW FILE: slon-slonik.png ---
(This appears to be a binary file; contents omitted.)


From xfade  Tue Feb 13 08:51:09 2007
From: xfade (Niels Breet)
Date: Tue Feb 13 08:58:46 2007
Subject: [Slony1-commit] slony1-www/images intro-body-bottom-left.png
	intro-body-bottom-mid.png intro-body-bottom-right.png
	intro-body-top-left.png intro-body-top-mid.png
	intro-body-top-right.png
Message-ID: <20070130101114.7565F2903B1@main>

Update of /home/cvsd/slony1/slony1-www/images
In directory main:/tmp/cvs-serv20597

Added Files:
	intro-body-bottom-left.png intro-body-bottom-mid.png 
	intro-body-bottom-right.png intro-body-top-left.png 
	intro-body-top-mid.png intro-body-top-right.png 
Log Message:
Add images for text blocks

--- NEW FILE: intro-body-top-mid.png ---
(This appears to be a binary file; contents omitted.)

--- NEW FILE: intro-body-bottom-left.png ---
(This appears to be a binary file; contents omitted.)

--- NEW FILE: intro-body-bottom-right.png ---
(This appears to be a binary file; contents omitted.)

--- NEW FILE: intro-body-top-left.png ---
(This appears to be a binary file; contents omitted.)

--- NEW FILE: intro-body-bottom-mid.png ---
(This appears to be a binary file; contents omitted.)

--- NEW FILE: intro-body-top-right.png ---
(This appears to be a binary file; contents omitted.)


From xfade  Tue Feb 13 08:51:09 2007
From: xfade (Niels Breet)
Date: Tue Feb 13 08:58:46 2007
Subject: [Slony1-commit] slony1-www/images slon-slonik.png
Message-ID: <20070130101727.8D13D2903A7@main>

Update of /home/cvsd/slony1/slony1-www/images
In directory main:/tmp/cvs-serv20617

Modified Files:
	slon-slonik.png 
Log Message:
Add fake drop shadow.

Index: slon-slonik.png
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/images/slon-slonik.png,v
retrieving revision 1.1
retrieving revision 1.2
diff -C2 -d -r1.1 -r1.2
Binary files /tmp/cvs4srNcF and /tmp/cvs9ADHOx differ


From xfade  Tue Feb 13 08:51:09 2007
From: xfade (Niels Breet)
Date: Tue Feb 13 08:58:46 2007
Subject: [Slony1-commit] slony1-www style.css test.html
Message-ID: <20070130104211.E875B2903B2@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv20635

Modified Files:
	style.css test.html 
Log Message:
Updates to style and test page. Basic layout should now be complete.

Index: test.html
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/test.html,v
retrieving revision 1.1
retrieving revision 1.2
diff -C2 -d -r1.1 -r1.2
*** test.html	29 Jan 2007 12:20:08 -0000	1.1
--- test.html	30 Jan 2007 10:42:09 -0000	1.2
***************
*** 16,20 ****
      <a href="">Link2</a> 
      <a href="">Link3</a> 
!     <a href="">Link4</a> 
    </div>
    </div>
--- 16,20 ----
      <a href="">Link2</a> 
      <a href="">Link3</a> 
!     <a href="">Link4gp</a> 
    </div>
    </div>
***************
*** 25,33 ****
--- 25,101 ----
  <div class="content">
    <div class="col1">
+   
+     <div class="intro-header">
+       <div class="left"></div>
+       <div class="right"><a href="#">Slony-I - introduction</a></div>
+     </div>
+     <div class="intro-body">
+       <div class="top">
+         <div class="top-left"></div>
+         <div class="top-right"></div>
+       </div>
+       <div class="text-intro">
+ 	<p><b>Slony-I</b> is a "master to multiple slaves"
+           replication system with cascading and failover.</p>
+ 
+           <p>The <i>big picture</i> for the development of Slony-I
+           is a master-slave system that includes all features and
+           capabilities needed to replicate large databases to a
+           reasonably limited number of slave systems.</p>
+ 
+           <p>Slony-I is a system for data centers and backup sites,
+           where the normal mode of operation is that all nodes are
+           available.</p>
+ 
+           <p>A fairly extensive "admin guide" comprising material
+           in the CVS tree may be found <a href=
+           "http://linuxdatabases.info/info/slony.html">here</a>
+           There is also a local copy <a href=
+           "adminguide/slony1-1.2.6/doc/adminguide/index.html">here</a></p>
+ 
+           <p>The original design document is available <a href=
+           "http://developer.postgresql.org/%7Ewieck/slony1/Slony-I-concept.pdf">
+ 
+           here</a>.</p>
+       </div>
+       <div class="bottom">
+         <div class="bottom-left"></div>
+         <div class="bottom-right"></div>
+       </div>
+     </div>
+ 
+ 
      <div class="intro-header">
        <div class="left"></div>
        <div class="right"><a href="">Title here</a></div>
      </div>
+     <div class="intro-body">
+       <div class="top">
+         <div class="top-left"></div>
+         <div class="top-right"></div>
+       </div>
+       <div class="text"> bla bla bla <br />
+       lalala lalalalgga appllaa <br />
+       lalala lalalalgga appllaa <br />
+       lalala lalalalgga appllaa <br />
+       lalala lalalalgga appllaa <br />
+       lalala lalalalgga appllaa <br />
+       lalala lalalalgga appllaa <br />
+       lalala lalalalgga appllaa <br />
+       lalala lalalalgga appllaa <br />
+       lalala lalalalgga appllaa <br />
+       lalala lalalalgga appllaa <br />
+       lalala lalalalgga appllaa <br />
+       asldl;<a href="">adjfggafd</a> dfjskldfs d
+       </div>
+       <div class="bottom">
+         <div class="bottom-left"></div>
+         <div class="bottom-right"></div>
+       </div>
+     </div>
+ 
+   
    </div>
+   
    <div class="col2">
      <div class="intro-header">
***************
*** 35,40 ****
--- 103,132 ----
        <div class="right"><a href="">Title here</a></div>
      </div>
+     <div class="intro-body">
+       <div class="top">
+         <div class="top-left"></div>
+         <div class="top-right"></div>
+       </div>
+       <div class="text"><p> bla bla bla</p>
+       <p>lalala lalalalgga appllaa</p>
+       <p>asldl;<a href="">adjfggafd</a> dfjskldfs d</p>
+       </div>
+       <div class="bottom">
+         <div class="bottom-left"></div>
+         <div class="bottom-right"></div>
+       </div>
+     </div>
+ 
+   </div>
+   
+   <br clear="all">
+   <div class="footer">
+     <div class="intro-header">
+       <div class="left"></div>
+       <div class="right"><div class="copyright">Content &copy; 2007 Slony Development Group</div></div>
+     </div>
    </div>
  </div>
+ 
  </body>
  </html>

Index: style.css
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/style.css,v
retrieving revision 1.1
retrieving revision 1.2
diff -C2 -d -r1.1 -r1.2
*** style.css	29 Jan 2007 12:23:35 -0000	1.1
--- style.css	30 Jan 2007 10:42:09 -0000	1.2
***************
*** 1,5 ****
  body{
    font-family: sans serif;
!   font-size: 10pt;
    margin: 8px;
  }
--- 1,6 ----
  body{
    font-family: sans serif;
!   font-size: 12pt;
!   line-height: 100%;
    margin: 8px;
  }
***************
*** 33,37 ****
    position: relative;
    left: 330px;
!   top: 82px;
    margin: 0;
    padding: 0;
--- 34,38 ----
    position: relative;
    left: 330px;
!   top: 86px;
    margin: 0;
    padding: 0;
***************
*** 60,65 ****
  
  .col2{
!   float: left;
!   margin-left: 1%;
    width: 40%;
  }
--- 61,65 ----
  
  .col2{
!   float: right;
    width: 40%;
  }
***************
*** 70,73 ****
--- 70,74 ----
    background: url('images/intro-header-bg.png') top left repeat-x;
    overflow: hidden;
+   margin-top: 10px;
  }
  
***************
*** 81,89 ****
  .intro-header .right{
    width: 96%;
!   height: 26px;
    float: left;
    background: url('images/intro-header-right.png') top right no-repeat;
    overflow: hidden;
!   padding-top: 2px;
  }
  
--- 82,90 ----
  .intro-header .right{
    width: 96%;
!   height: 21px;
    float: left;
    background: url('images/intro-header-right.png') top right no-repeat;
    overflow: hidden;
!   padding-top: 7px;
  }
  
***************
*** 101,102 ****
--- 102,189 ----
    font-weight: bold;
  }
+ 
+ .intro-body{
+   margin: 2px;
+   background-color: #f6f6f6;
+   margin-right: 4px;
+ }
+ 
+ .intro-body .top{
+   background: url('images/intro-body-top-mid.png') top left repeat-x;
+   height: 11px;
+   width: 100%;
+   overflow: hidden;
+ }
+ 
+ .intro-body .top-left, .intro-body .bottom-left{
+   height: 11px;
+   width: 10px;
+   float: left;
+ }
+ 
+ .intro-body .top-right, .intro-body .bottom-right{
+   height: 11px;
+   width: 10px;
+   float: right;
+ }
+ 
+ .intro-body .top-left{
+   background: url('images/intro-body-top-left.png') top left no-repeat;
+ }
+ .intro-body .top-right{
+   background: url('images/intro-body-top-right.png') top right no-repeat;
+ }
+ 
+ .intro-body .bottom{
+   background: url('images/intro-body-bottom-mid.png') top left repeat-x;
+   height: 11px;
+   width: 100%;
+   overflow: hidden;
+ }
+ 
+ .intro-body .bottom-left{
+   background: url('images/intro-body-bottom-left.png') top left no-repeat;
+ }
+ .intro-body .bottom-right{
+   background: url('images/intro-body-bottom-right.png') top right no-repeat;
+ }
+ 
+ .intro-body .text,.intro-body .text-intro{
+   padding-left: 10px;
+   padding-right: 10px;
+   padding-bottom: 4px;
+   border-left: 1px solid black;
+   border-right: 1px solid black;
+ }
+ 
+ .text-intro p, .text p{
+   margin-top: 0;
+   padding-top: 5px;
+   margin-bottom: 0;
+   padding-bottom: 5px;
+ }
+ 
+ .intro-body .text-intro{
+   background: url('images/slon-slonik.png') bottom right no-repeat;
+   min-height: 200px;
+   padding-right: 205px;
+ }
+ 
+ .intro-body .text a, .intro-body .text-intro a{
+   color: #0D1DDF;
+   text-decoration: none;
+ }
+ 
+ .intro-body .text a:hover, .intro-body .text-intro a:hover{
+   color: #183074;
+   text-decoration: underline;
+ }
+ 
+ .copyright{
+   width: 98%;
+   height: 18px;
+   color: #ffffff;
+   text-align: center;
+   overflow: hidden;
+   margin-right: 2%;
+ }
\ No newline at end of file


From xfade  Tue Feb 13 08:51:09 2007
From: xfade (Niels Breet)
Date: Tue Feb 13 08:58:46 2007
Subject: [Slony1-commit] slony1-engine/doc/adminguide slonik_ref.sgml
Message-ID: <20070130114734.035852903B7@main>

Update of /home/cvsd/slony1/slony1-engine/doc/adminguide
In directory main:/tmp/cvs-serv20671

Modified Files:
	slonik_ref.sgml 
Log Message:
Change ID = 2 to ID = 1 as the example talks about set 1 not 2.

Index: slonik_ref.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/slonik_ref.sgml,v
retrieving revision 1.65
retrieving revision 1.66
diff -C2 -d -r1.65 -r1.66
*** slonik_ref.sgml	31 Oct 2006 22:09:39 -0000	1.65
--- slonik_ref.sgml	30 Jan 2007 11:47:31 -0000	1.66
***************
*** 1265,1269 ****
       WAIT FOR EVENT (ORIGIN = 3, CONFIRMED = 1);
       SYNC (ID=1);
!      MERGE SET ( ID = 2, ADD ID = 9999, ORIGIN = 1 );
      </programlisting>
     </refsect1>
--- 1265,1269 ----
       WAIT FOR EVENT (ORIGIN = 3, CONFIRMED = 1);
       SYNC (ID=1);
!      MERGE SET ( ID = 1, ADD ID = 9999, ORIGIN = 1 );
      </programlisting>
     </refsect1>


From xfade  Tue Feb 13 08:51:09 2007
From: xfade (Niels Breet)
Date: Tue Feb 13 08:58:46 2007
Subject: [Slony1-commit] slony1-www index.php layout.php
Message-ID: <20070130160541.82448290292@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv22129

Added Files:
	index.php layout.php 
Log Message:
Very simple cms for slony. Part one

--- NEW FILE: layout.php ---
<?PHP

function layout_header($active=""){
$output = '<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en">
<head>
<title>Slony-I</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="/style.css" type="text/css" />
<!-- Design Copyright 2007 Niels Breet -->
</head>

<body>
<div class="header">
  <div class="left">
  <div class="menu">
    <a href="/">Home</a> 
    <a href="">CVS</a> 
    <a href="http://lists.slony.info/mailman/listinfo" title="Slony mailinglists">Mailinglists</a> 
  </div>
  </div>
  <div class="right">
  </div>
</div>

<div class="content">
  </div>
';
return $output;
}

function layout_footer(){
$output ='  
  <br clear="all">
  <div class="footer">
    <div class="intro-header">
      <div class="left"></div>
      <div class="right"><div class="copyright">Content &copy; 2007 Slony Development Group</div></div>
    </div>
  </div>
</div>

</body>
</html>
';
return $output;
}


function layout_leftcol_start(){
$output = '
  <div class="col1">
';
return $output;
}

function layout_leftcol_stop(){
$output = '
  </div>
';
return $output;
}

function layout_rightcol_start(){
$output = '
  <div class="col2">
';
return $output;
}

function layout_rightcol_stop(){
$output = '
  </div>
';
return $output;
}


function layout_introblock($title="",$link="",$text=""){
$output ='
    <div class="intro-header">
      <div class="left"></div>
      <div class="right"><a href="'.$link.'">'.$title.'</a></div>

    </div>
    <div class="intro-body">
      <div class="top">
        <div class="top-left"></div>
        <div class="top-right"></div>
      </div>
      <div class="text-intro">
	'.$text.'
      </div>
      <div class="bottom">
        <div class="bottom-left"></div>
        <div class="bottom-right"></div>

      </div>
    </div>
';
return $output;
}

function layout_defaultblock($title="",$link="",$text=""){
$output = '
    <div class="intro-header">
      <div class="left"></div>
      <div class="right"><a href="'.$link.'">'.$title.'</a></div>
    </div>
    <div class="intro-body">

      <div class="top">
        <div class="top-left"></div>
        <div class="top-right"></div>
      </div>
      <div class="text"> 
	'.$text.'
      </div>
      <div class="bottom">

        <div class="bottom-left"></div>
        <div class="bottom-right"></div>
      </div>
    </div>

';
return $output;
}

?>

--- NEW FILE: index.php ---
<?PHP
require_once("layout.php");

$target=$_GET["target"];
//var_dump($target); //debug

switch($target){
  case '404':
	header("HTTP/1.0 404 Not Found");
	echo layout_header();
	echo layout_defaultblock('404, NOT FOUND','',file_get_contents('./content/404.txt'));
	break;
  case 'cvs':
	echo layout_header();
	echo 'cvs';
	break;
  default:
	echo layout_header();
	echo layout_leftcol_start();
	$fp = fopen('./content/intro.txt','r');
	if ($fp){
		$title=fgets($fp,256);
		$link=fgets($fp,256);
		$text="";
		while (!feof($fp)) $text.=fgets($fp,256);
		fclose($fp);
	}
	echo layout_introblock($title,$link,$text);
	echo layout_leftcol_stop();
	echo layout_rightcol_start();

        $fp = fopen('./content/news.txt','r');
        if ($fp){
                $text="";
                while (!feof($fp)){
			 $buf=fgets($fp,256);
			 if (strpos($buf,'---')!==false){
				if ($text != "") echo layout_defaultblock($title,$link,$text);
				$text = "";
				$title = @fgets($fp,256);
				$link = @fgets($fp,256);
			 } else {
				$text .= $buf;
			 }
		}
                fclose($fp);
        }

	echo layout_rightcol_stop();
}


echo layout_footer();

?>


From xfade  Tue Feb 13 08:51:09 2007
From: xfade (Niels Breet)
Date: Tue Feb 13 08:58:46 2007
Subject: [Slony1-commit] slony1-www/content  - New directory
Message-ID: <20070130160600.32FD52903E1@main>

Update of /home/cvsd/slony1/slony1-www/content
In directory main:/tmp/cvs-serv22148/content

Log Message:
Directory /home/cvsd/slony1/slony1-www/content added to the repository



From xfade  Tue Feb 13 08:51:09 2007
From: xfade (Niels Breet)
Date: Tue Feb 13 08:58:46 2007
Subject: [Slony1-commit] slony1-www/content 404.txt intro.txt news.txt
Message-ID: <20070130160644.996282903BA@main>

Update of /home/cvsd/slony1/slony1-www/content
In directory main:/tmp/cvs-serv22161/content

Added Files:
	404.txt intro.txt news.txt 
Log Message:
Content for cms

--- NEW FILE: news.txt ---
---
title1
http://
html content here can be multiline
---
title2
url2
second news item
---


--- NEW FILE: intro.txt ---
Slony-I - introduction
#
	<p><b>Slony-I</b> is a "master to multiple slaves"
          replication system with cascading and failover.</p>

          <p>The <i>big picture</i> for the development of Slony-I
          is a master-slave system that includes all features and
          capabilities needed to replicate large databases to a
          reasonably limited number of slave systems.</p>

          <p>Slony-I is a system for data centers and backup sites,
          where the normal mode of operation is that all nodes are
          available.</p>

          <p>A fairly extensive "admin guide" comprising material
          in the CVS tree may be found <a href=
          "http://linuxdatabases.info/info/slony.html">here</a>
          There is also a local copy <a href=
          "adminguide/slony1-1.2.6/doc/adminguide/index.html">here</a></p>

          <p>The original design document is available <a href=
          "http://developer.postgresql.org/%7Ewieck/slony1/Slony-I-concept.pdf">

          here</a>.</p>

--- NEW FILE: 404.txt ---
Oops. 404? Hmm something must be wrong....


From cbbrowne  Tue Feb 13 08:51:09 2007
From: cbbrowne (Chris Browne)
Date: Tue Feb 13 08:58:46 2007
Subject: [Slony1-commit] slony1-www/content intro.txt news.txt
Message-ID: <20070130170804.5D74C2903A2@main>

Update of /home/cvsd/slony1/slony1-www/content
In directory main:/tmp/cvs-serv22286

Modified Files:
	intro.txt news.txt 
Log Message:
Updated intro file; put in some realistic news items


Index: news.txt
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/content/news.txt,v
retrieving revision 1.1
retrieving revision 1.2
diff -C2 -d -r1.1 -r1.2
*** news.txt	30 Jan 2007 16:06:42 -0000	1.1
--- news.txt	30 Jan 2007 17:08:02 -0000	1.2
***************
*** 1,10 ****
  ---
! title1
! http://
! html content here can be multiline
  ---
! title2
! url2
! second news item
  ---
  
--- 1,11 ----
  ---
! Slony-I New Web Site!
! http://main.slony.info
! Dateline: 2009-01-01 - We are pleased to announce the release of the new Slony-I web site at <tt>main.slony.info</tt>.
  ---
! Slony-I New CVS Site!
! http://main.slony.info/cvs.html
! 2007-01-20 The Slony-I project is now making active use of CVS repositories at <tt>cvs.slony.info</tt>; this replaces the former
! CVS repositories at gBorg.  We thank the gBorg operators for their support over the last few years, and Command Prompt for their provision of hardware, administrative, and hosting services for <tt>cvs.slony.info</tt>.
  ---
  

Index: intro.txt
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/content/intro.txt,v
retrieving revision 1.1
retrieving revision 1.2
diff -C2 -d -r1.1 -r1.2
*** intro.txt	30 Jan 2007 16:06:42 -0000	1.1
--- intro.txt	30 Jan 2007 17:08:02 -0000	1.2
***************
*** 2,24 ****
  #
  	<p><b>Slony-I</b> is a "master to multiple slaves"
!           replication system with cascading and failover.</p>
  
!           <p>The <i>big picture</i> for the development of Slony-I
!           is a master-slave system that includes all features and
!           capabilities needed to replicate large databases to a
!           reasonably limited number of slave systems.</p>
  
!           <p>Slony-I is a system for data centers and backup sites,
!           where the normal mode of operation is that all nodes are
!           available.</p>
  
!           <p>A fairly extensive "admin guide" comprising material
!           in the CVS tree may be found <a href=
!           "http://linuxdatabases.info/info/slony.html">here</a>
!           There is also a local copy <a href=
            "adminguide/slony1-1.2.6/doc/adminguide/index.html">here</a></p>
  
            <p>The original design document is available <a href=
            "http://developer.postgresql.org/%7Ewieck/slony1/Slony-I-concept.pdf">
- 
            here</a>.</p>
--- 2,24 ----
  #
  	<p><b>Slony-I</b> is a "master to multiple slaves"
!           replication system supporting cascading (<em>e.g.</em> - a node can feed another node which feeds another node...)  and failover.</p>
  
!           <p>The <i>big picture</i> for the development of Slony-I is
!           that it is a master-slave replication system that includes
!           all features and capabilities needed to replicate large
!           databases to a reasonably limited number of slave
!           systems.</p>
  
!           <p>Slony-I is a system designed for use at data centers and
!           backup sites, where the normal mode of operation is that all
!           nodes are available.</p>
  
!           <p>A fairly extensive "admin guide" comprising material in
!           the CVS tree may be found <a href=
!           "http://linuxdatabases.info/info/slony.html">here</a> There
!           is also a local copy <a href=
            "adminguide/slony1-1.2.6/doc/adminguide/index.html">here</a></p>
  
            <p>The original design document is available <a href=
            "http://developer.postgresql.org/%7Ewieck/slony1/Slony-I-concept.pdf">
            here</a>.</p>


From cbbrowne  Tue Feb 13 08:51:09 2007
From: cbbrowne (Chris Browne)
Date: Tue Feb 13 08:58:46 2007
Subject: [Slony1-commit] slony1-www layout.php
Message-ID: <20070130171133.DDA8429039F@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv22367

Modified Files:
	layout.php 
Log Message:
Update to cvs...


Index: layout.php
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/layout.php,v
retrieving revision 1.1
retrieving revision 1.2
diff -C2 -d -r1.1 -r1.2
*** layout.php	30 Jan 2007 16:05:39 -0000	1.1
--- layout.php	30 Jan 2007 17:11:31 -0000	1.2
***************
*** 17,21 ****
    <div class="menu">
      <a href="/">Home</a> 
!     <a href="">CVS</a> 
      <a href="http://lists.slony.info/mailman/listinfo" title="Slony mailinglists">Mailinglists</a> 
    </div>
--- 17,21 ----
    <div class="menu">
      <a href="/">Home</a> 
!     <a href="/cvs.html">CVS</a> 
      <a href="http://lists.slony.info/mailman/listinfo" title="Slony mailinglists">Mailinglists</a> 
    </div>


From cbbrowne  Tue Feb 13 08:51:09 2007
From: cbbrowne (Chris Browne)
Date: Tue Feb 13 08:58:46 2007
Subject: [Slony1-commit] slony1-engine/src/slonik slonik.c
Message-ID: <20070130173021.F1F1E2903E5@main>

Update of /home/cvsd/slony1/slony1-engine/src/slonik
In directory main:/tmp/cvs-serv22432

Modified Files:
	slonik.c 
Log Message:
Per Mark Stosberg - if uninstallNode() errors out, we should report the node number

Index: slonik.c
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/slonik/slonik.c,v
retrieving revision 1.71
retrieving revision 1.72
diff -C2 -d -r1.71 -r1.72
*** slonik.c	12 Dec 2006 14:54:48 -0000	1.71
--- slonik.c	30 Jan 2007 17:30:19 -0000	1.72
***************
*** 3035,3038 ****
--- 3035,3039 ----
  	if (db_exec_command((SlonikStmt *) stmt, adminfo1, &query) < 0)
  	{
+ 		printf("Failed to exec uninstallNode() for node %d\n", stmt->no_id);
  		dstring_free(&query);
  		return -1;
***************
*** 3040,3043 ****
--- 3041,3045 ----
  	if (db_commit_xact((SlonikStmt *) stmt, adminfo1) < 0)
  	{
+ 		printf("Failed to commit uninstallNode() for node %d\n", stmt->no_id);
  		dstring_free(&query);
  		return -1;
***************
*** 3049,3052 ****
--- 3051,3055 ----
  	if (db_exec_command((SlonikStmt *) stmt, adminfo1, &query) < 0)
  	{
+ 		printf("Failed to drop schema for node %d\n", stmt->no_id);
  		dstring_free(&query);
  		return -1;
***************
*** 3054,3057 ****
--- 3057,3061 ----
  	if (db_commit_xact((SlonikStmt *) stmt, adminfo1) < 0)
  	{
+ 		printf("Failed to commit drop schema for node %d\n", stmt->no_id);
  		dstring_free(&query);
  		return -1;


From xfade  Tue Feb 13 08:51:09 2007
From: xfade (Niels Breet)
Date: Tue Feb 13 08:58:46 2007
Subject: [Slony1-commit] slony1-www/content cvs.txt
Message-ID: <20070130191838.496132903E2@main>

Update of /home/cvsd/slony1/slony1-www/content
In directory main:/tmp/cvs-serv22820

Added Files:
	cvs.txt 
Log Message:
Text for cvs page.

--- NEW FILE: cvs.txt ---
       <h1>Anonymous CVS Access</h1>

          <p>You may access Slony-I sources via anonymous CVS using
          the following command:</p>
          <pre>
CVSROOT=":pserver:anonymous@main.slony.info:/slony1" cvs login
(when it prompts for a password, you may press [enter])
CVSROOT=":pserver:anonymous@main.slony.info:/slony1" cvs co slony1-engine
</pre>

          <h1>Developer CVS Access</h1>

          <p>If you are one of the developers, and have had your
          ssh key added in on a suitable account, you can access as
          a specific user with update privileges:</p>
          <pre>

MYSLONYNAME=cbbrowne CVS_RSH=ssh CVSROOT=":ext:${MYSLONYNAME}@main.slony.info:/home/cvsd/slony1" cvs co slony1-engine
</pre>

          <h1>Modules Available</h1>

          <ul>
            <li><tt>slony1-engine</tt> - the replication engine
            project</li>

            <li><tt>slony1-www</tt> - web site material for
            main.slony.info</li>

          </ul>


From xfade  Tue Feb 13 08:51:09 2007
From: xfade (Niels Breet)
Date: Tue Feb 13 08:58:46 2007
Subject: [Slony1-commit] slony1-www/content cvs.txt
Message-ID: <20070130192154.9370B2903E5@main>

Update of /home/cvsd/slony1/slony1-www/content
In directory main:/tmp/cvs-serv22842

Modified Files:
	cvs.txt 
Log Message:
Forgot about the title and url

Index: cvs.txt
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/content/cvs.txt,v
retrieving revision 1.1
retrieving revision 1.2
diff -C2 -d -r1.1 -r1.2
*** cvs.txt	30 Jan 2007 19:18:36 -0000	1.1
--- cvs.txt	30 Jan 2007 19:21:52 -0000	1.2
***************
*** 1,2 ****
--- 1,4 ----
+ Slony-I cvs
+ #
         <h1>Anonymous CVS Access</h1>
  


From xfade  Tue Feb 13 08:51:09 2007
From: xfade (Niels Breet)
Date: Tue Feb 13 08:58:46 2007
Subject: [Slony1-commit] slony1-www index.php
Message-ID: <20070130192320.83B0A2903E7@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv22865

Modified Files:
	index.php 
Log Message:
Add cvs page

Index: index.php
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/index.php,v
retrieving revision 1.1
retrieving revision 1.2
diff -C2 -d -r1.1 -r1.2
*** index.php	30 Jan 2007 16:05:39 -0000	1.1
--- index.php	30 Jan 2007 19:23:18 -0000	1.2
***************
*** 13,17 ****
    case 'cvs':
  	echo layout_header();
! 	echo 'cvs';
  	break;
    default:
--- 13,25 ----
    case 'cvs':
  	echo layout_header();
! 	$fp = fopen('./content/cvs.txt','r');
! 	if ($fp){
! 		$title=fgets($fp,256);
! 		$link=fgets($fp,256);
! 		$text="";
! 		while (!feof($fp)) $text.=fgets($fp,256);
! 		fclose($fp);
! 	}
! 	echo layout_defaultblock($title,$link,$text);	
  	break;
    default:


From cbbrowne  Tue Feb 13 08:51:09 2007
From: cbbrowne (Chris Browne)
Date: Tue Feb 13 08:58:46 2007
Subject: [Slony1-commit] slony1-engine/doc/adminguide adminscripts.sgml
	firstdb.sgml monitoring.sgml
Message-ID: <20070130192321.71D412903F0@main>

Update of /home/cvsd/slony1/slony1-engine/doc/adminguide
In directory main:/tmp/cvs-serv22861

Modified Files:
	adminscripts.sgml firstdb.sgml monitoring.sgml 
Log Message:
mark@summersault.com
  * provide examples of using the altperl scripts for initial replication set up.

cbbrowne fixed some tagging


Index: monitoring.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/monitoring.sgml,v
retrieving revision 1.34
retrieving revision 1.35
diff -C2 -d -r1.34 -r1.35
*** monitoring.sgml	24 Jan 2007 15:42:14 -0000	1.34
--- monitoring.sgml	30 Jan 2007 19:23:19 -0000	1.35
***************
*** 201,205 ****
  Doing commit Slony_replication.wiki with host: logtail and lang: en
  </screen>
- </sect2>
  
  <para> Note that <command>mvs</command> is a client written in Perl;
--- 201,204 ----
***************
*** 209,212 ****
--- 208,212 ----
  may have a packaged version of this under some similar name. </para>
  
+ </sect2>
  </sect1>
  <!-- Keep this comment at the end of the file

Index: adminscripts.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/adminscripts.sgml,v
retrieving revision 1.45
retrieving revision 1.46
diff -C2 -d -r1.45 -r1.46
*** adminscripts.sgml	5 Jan 2007 19:32:29 -0000	1.45
--- adminscripts.sgml	30 Jan 2007 19:23:19 -0000	1.46
***************
*** 14,34 ****
  <indexterm><primary>altperl scripts for &slony1;</primary></indexterm>
  
! <para>In the <filename>altperl</filename> directory in the
! <application>CVS</application> tree, there is a sizable set of
! <application>Perl</application> scripts that may be used to administer
! a set of &slony1; instances, which support having arbitrary numbers of
! nodes.</para>
  
! <para>Most of them generate Slonik scripts that are then to be passed
! on to the <xref linkend="slonik"> utility to be submitted to all of
! the &slony1; nodes in a particular cluster.  At one time, this
! embedded running <xref linkend="slonik"> on the slonik scripts.
  Unfortunately, this turned out to be a pretty large calibre
  <quote>foot gun</quote>, as minor typos on the command line led, on a
! couple of occasions, to pretty calamitous actions, so the behavior has
! been changed so that the scripts simply submit output to standard
! output.  The savvy administrator should review the script
! <emphasis>before</emphasis> submitting it to <xref
! linkend="slonik">.</para>
  
  <sect3><title>Node/Cluster Configuration - cluster.nodes</title>
--- 14,37 ----
  <indexterm><primary>altperl scripts for &slony1;</primary></indexterm>
  
! <para>There is a set of scripts to simplify administeration
! of set of &slony1; instances. The scripts support having arbitrary numbers of
! nodes. They may be installed as part of the installation process:</para>
  
! <para><command>
!  ./configure --with-perltools
! </command></para>
! 
! <para>This will produce a number of scripts with the prefix <command>slonik_</command>.
! They eliminate tedium by always referring to a central configuration file
! for the details of your site configuration. Most also include some command 
! line help with the "-h" option, making them easier to learn and use.
! </para>
! 
! <para>Most generate Slonik scripts that are printed to STDOUT. 
! At one time, the commands were passed directly to <xref linkend="slonik"> for execution. 
  Unfortunately, this turned out to be a pretty large calibre
  <quote>foot gun</quote>, as minor typos on the command line led, on a
! couple of occasions, to pretty calamitous actions. The savvy administrator should review the script
! <emphasis>before</emphasis> piping it to <xref linkend="slonik">.</para>
  
  <sect3><title>Node/Cluster Configuration - cluster.nodes</title>

Index: firstdb.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/firstdb.sgml,v
retrieving revision 1.20
retrieving revision 1.21
diff -C2 -d -r1.20 -r1.21
*** firstdb.sgml	2 Aug 2006 18:34:58 -0000	1.20
--- firstdb.sgml	30 Jan 2007 19:23:19 -0000	1.21
***************
*** 140,146 ****
  and configuration is all done through the <xref linkend="slonik">
  tool. It is a specialized scripting aid that mostly calls stored
! procedures in the master/slave (node) databases.  The script to create
  the initial configuration for the simple master-slave setup of our
! <application>pgbench</application> database looks like this:
  
  <programlisting>
--- 140,184 ----
  and configuration is all done through the <xref linkend="slonik">
  tool. It is a specialized scripting aid that mostly calls stored
! procedures in the master/slave (node) databases. </para>
! 
! <sect3><title>Using the altperl scripts</title>
! 
! <para>
! Using the <xref linkend="altperl"> scripts is an easy way to get started.  The
! <command>slonik_build_env</command> script will generate output providing
! details you need to  omplete building a <filename>slon_tools.conf</filename>. 
! An example <filename>slon_tools.conf</filename> is provided in the distribution
! to get you started.  The altperl scripts will all reference
! this central configuration file in the future to ease administration. Once 
! slon_tools.conf has been created, you can proceed as follows:
! </para>
! 
! <programlisting>
! # Initialize cluster:
! $ slonik_init_cluster  | slonik 
! 
! # Start slon  (here 1 and 2 are node numbers)
! $ slon_start 1    
! $ slon_start 2
! 
! # Create Sets (here 1 is a set number)
! $ slonik_create_set 1             
! 
! # subscribe set to second node (1= set ID, 2= node ID)
! $ slonik_subscribe_set  2 | slonik
! </programlisting>
! 
! <para> You have now replicated your first database.  You can skip the following section
! of documentation if you'd like, which documents more of a <quote>bare-metal</quote> approach.</para>
! </sect3>
! 
! <sect3><title>Using slonik command directly</title>
! <para>The traditional approach to administering slony is to craft slonik
! commands directly. An example of this given here. </para>
! 
! 
! <para> The script to create
  the initial configuration for the simple master-slave setup of our
! <application>pgbench</application> database looks like this:</para>
  
  <programlisting>
***************
*** 203,207 ****
  	store listen (origin=2, provider = 2, receiver =1);
  _EOF_
! </programlisting></para>
  
  <para>Is the <application>pgbench</application> still running?  If
--- 241,245 ----
  	store listen (origin=2, provider = 2, receiver =1);
  _EOF_
! </programlisting>
  
  <para>Is the <application>pgbench</application> still running?  If
***************
*** 283,287 ****
  <application>pgbench</application> has completed, so that there are no
  new updates hitting the origin node, and that your slon sessions have
! caught up.
  
  <programlisting>
--- 321,325 ----
  <application>pgbench</application> has completed, so that there are no
  new updates hitting the origin node, and that your slon sessions have
! caught up.</para>
  
  <programlisting>
***************
*** 319,323 ****
  fi
  </programlisting>
- </para>
  
  <para>Note that there is somewhat more sophisticated documentation of
--- 357,360 ----


From xfade  Tue Feb 13 08:51:09 2007
From: xfade (Niels Breet)
Date: Tue Feb 13 08:58:46 2007
Subject: [Slony1-commit] slony1-www style.css
Message-ID: <20070130193240.EB0F12903F0@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv23007

Modified Files:
	style.css 
Log Message:
style.css update for h1

Index: style.css
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/style.css,v
retrieving revision 1.2
retrieving revision 1.3
diff -C2 -d -r1.2 -r1.3
*** style.css	30 Jan 2007 10:42:09 -0000	1.2
--- style.css	30 Jan 2007 19:32:38 -0000	1.3
***************
*** 6,9 ****
--- 6,15 ----
  }
  
+ h1{
+   margin: 0;
+   font-size: 18pt;
+   padding-bottom: 10px;
+ }
+ 
  .header{
    min-width: 782px;


From xfade  Tue Feb 13 08:51:09 2007
From: xfade (Niels Breet)
Date: Tue Feb 13 08:58:46 2007
Subject: [Slony1-commit] slony1-www layout.php
Message-ID: <20070130193735.410262903EF@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv23057

Modified Files:
	layout.php 
Log Message:
Add cvs page to menu.

Index: layout.php
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/layout.php,v
retrieving revision 1.2
retrieving revision 1.3
diff -C2 -d -r1.2 -r1.3
*** layout.php	30 Jan 2007 17:11:31 -0000	1.2
--- layout.php	30 Jan 2007 19:37:33 -0000	1.3
***************
*** 17,21 ****
    <div class="menu">
      <a href="/">Home</a> 
!     <a href="/cvs.html">CVS</a> 
      <a href="http://lists.slony.info/mailman/listinfo" title="Slony mailinglists">Mailinglists</a> 
    </div>
--- 17,21 ----
    <div class="menu">
      <a href="/">Home</a> 
!     <a href="/scm/">CVS</a> 
      <a href="http://lists.slony.info/mailman/listinfo" title="Slony mailinglists">Mailinglists</a> 
    </div>


From cbbrowne  Tue Feb 13 08:51:09 2007
From: cbbrowne (Chris Browne)
Date: Tue Feb 13 08:58:46 2007
Subject: [Slony1-commit] slony1-www admin.html
Message-ID: <20070130193757.080982903F1@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv23080

Modified Files:
	admin.html 
Log Message:
Add note about umask setting


Index: admin.html
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/admin.html,v
retrieving revision 1.3
retrieving revision 1.4
diff -C2 -d -r1.3 -r1.4
*** admin.html	29 Jan 2007 19:53:06 -0000	1.3
--- admin.html	30 Jan 2007 19:37:54 -0000	1.4
***************
*** 200,203 ****
--- 200,217 ----
            <tt>unison</tt>to "just do it."</p>
  
+           <h2>Other Environmental Stuff</h2>
+ 
+           <p>Those with login access, please add the entry:</p>
+           <pre>
+ umask 0002
+ </pre>
+ 
+           <p>to your <tt>.profile</tt> / <tt>.bashrc</tt> file.
+           That way, <i>group write</i> is permitted, by default.
+           It's very annoying, particularly in the web site area, if
+           one person checks out CVS with <tt>umask 0022</tt>,
+           thereby forbidding anyone else from updating any files
+           that they newly add.</p>
+ 
            <address>
              <a href="mailto:cbbrowne@ca.afilias.info">Christopher
***************
*** 205,209 ****
            </address><!-- Created: Thu Jan 25 11:38:58 EST 2007 -->
            <!-- hhmts start -->
!           Last modified: Mon Jan 29 14:52:13 EST 2007 
            <!-- hhmts end -->
          </td>
--- 219,223 ----
            </address><!-- Created: Thu Jan 25 11:38:58 EST 2007 -->
            <!-- hhmts start -->
!           Last modified: Tue Jan 30 14:37:16 EST 2007 
            <!-- hhmts end -->
          </td>


From cbbrowne  Tue Feb 13 08:51:09 2007
From: cbbrowne (Chris Browne)
Date: Tue Feb 13 08:58:46 2007
Subject: [Slony1-commit] slony1-engine/doc/adminguide defineset.sgml
Message-ID: <20070130194838.0305A2903F2@main>

Update of /home/cvsd/slony1/slony1-engine/doc/adminguide
In directory main:/tmp/cvs-serv23126

Modified Files:
	defineset.sgml 
Log Message:
Mark Stosberg suggested some additional wording about defining tables.
It more explicitly recommends using a primary key, and provides an
example syntax to convert a unique/not null index to a primary key.
cbbrowne did some further wording changes.


Index: defineset.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/defineset.sgml,v
retrieving revision 1.25
retrieving revision 1.26
diff -C2 -d -r1.25 -r1.26
*** defineset.sgml	2 Aug 2006 18:34:57 -0000	1.25
--- defineset.sgml	30 Jan 2007 19:48:35 -0000	1.26
***************
*** 43,47 ****
  <emphasis>candidate</emphasis> primary key, that is, some index on a
  combination of fields that is both UNIQUE and NOT NULL, then you can
! specify the key, as in</para>
  
  <programlisting>
--- 43,47 ----
  <emphasis>candidate</emphasis> primary key, that is, some index on a
  combination of fields that is both UNIQUE and NOT NULL, then you can
! specify that key, as shown in the following example. </para>
  
  <programlisting>
***************
*** 52,55 ****
--- 52,69 ----
  </programlisting>
  
+ <para> However, once you have come this far, there is little reason not
+ to just declare some suitable index to be a primary key, which requires
+ that the columns involved are NOT NULL, and which will establish a unique
+ index. Here is an example of this: </para>
+ 
+ <programlisting>
+ DROP INDEX my_table_name_col1_col2_uniq_idx;
+ ALTER TABLE my_table_name ADD PRIMARY KEY (col1, col2);
+ </programlisting>
+ 
+ <para>If your application is not somehow referencing the index by name,
+ the this should not lose you anything, and it gives you the clear design
+ benefit that a primary key has been declared for the table. </para>
+ 
  <para> Notice that while you need to specify the namespace for the
  table, you must <emphasis>not</emphasis> specify the namespace for the
***************
*** 68,78 ****
  <para> It is not terribly important whether you pick a
  <quote>true</quote> primary key or a mere <quote>candidate primary
! key;</quote> it is, however, recommended that you have one of those
! instead of having &slony1; populate the PK column for you.  If you
! don't have a suitable primary key, that means that the table hasn't
! got any mechanism from your application's standpoint for keeping
! values unique.  &slony1; may therefore introduce a new failure mode
! for your application, and this also implies that you had a way to
! enter confusing data into the database.</para>
  </sect2>
  
--- 82,92 ----
  <para> It is not terribly important whether you pick a
  <quote>true</quote> primary key or a mere <quote>candidate primary
! key;</quote> it is, however, strongly recommended that you have one of
! those instead of having &slony1; populate the PK column for you. If you
! don't have a suitable primary key, that means that the table hasn't got
! any mechanism, from your application's standpoint, for keeping values
! unique. &slony1; may, therefore, introduce a new failure mode for your
! application, and this also implies that you had a way to enter confusing
! data into the database.</para>
  </sect2>
  


From cbbrowne  Tue Feb 13 08:51:09 2007
From: cbbrowne (Chris Browne)
Date: Tue Feb 13 08:58:46 2007
Subject: [Slony1-commit] slony1-engine/doc/adminguide adminscripts.sgml
Message-ID: <20070130195713.D842E2903F3@main>

Update of /home/cvsd/slony1/slony1-engine/doc/adminguide
In directory main:/tmp/cvs-serv23162/doc/adminguide

Modified Files:
	adminscripts.sgml 
Log Message:
Per Brian A. Seklecki, added to the tools directory a script for managing
slon startup in conjunction with FreeBSD Ports.

Also added some (brief) documentation to the adminscripts section of the
admin guide.


Index: adminscripts.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/adminscripts.sgml,v
retrieving revision 1.46
retrieving revision 1.47
diff -C2 -d -r1.46 -r1.47
*** adminscripts.sgml	30 Jan 2007 19:23:19 -0000	1.46
--- adminscripts.sgml	30 Jan 2007 19:57:11 -0000	1.47
***************
*** 653,656 ****
--- 653,666 ----
  </sect3>
  </sect2>
+ 
+ <sect2 id="bsd-ports-profile"> <title> <filename> slon.in-profiles </filename> </title>
+ <subtitle> Apache-Style profiles for FreeBSD <filename>ports/databases/slony/*</filename> </subtitle>
+ 
+ <para> In the tools area, <filename>slon.in-profiles</filename> is a
+ script that might be used to start up &lslon; instances at the time of
+ system startup.  It is designed to interact with the FreeBSD Ports
+ system.</para>
+ 
+ </sect2>
  </sect1>
  <!-- Keep this comment at the end of the file


From cbbrowne  Tue Feb 13 08:51:09 2007
From: cbbrowne (Chris Browne)
Date: Tue Feb 13 08:58:46 2007
Subject: [Slony1-commit] slony1-engine/tools slon.in-profiles
Message-ID: <20070130195713.BC3AB2903F2@main>

Update of /home/cvsd/slony1/slony1-engine/tools
In directory main:/tmp/cvs-serv23162/tools

Added Files:
	slon.in-profiles 
Log Message:
Per Brian A. Seklecki, added to the tools directory a script for managing
slon startup in conjunction with FreeBSD Ports.

Also added some (brief) documentation to the adminscripts section of the
admin guide.


--- NEW FILE: slon.in-profiles ---
#!/bin/sh
#
# $FreeBSD$
# Modified by Brian A. Seklecki <bseklecki@collaborativefusion.com>
#                               <lavalamp@spiritual-machines.org>
# $Id: slon.in-profiles,v 1.1 2007-01-30 19:57:11 cbbrowne Exp $ 
#

# sed -e 's/%%PREFIX%%/\/usr\/local/g' < slon.in > slon

# PROVIDE: slon
# REQUIRE: postgresql
# KEYWORD: shutdown

. "/etc/rc.subr"

name="slon"
rcvar=`set_rcvar`

load_rc_config "$name"
_pidprefix="/var/run/${name}"
pidfile="${_pidprefix}.pid" # Used as fall-through in event of no profiles

# From global rc.conf(5); if unset, set them here
[ -z "$slon_enable" ]       && slon_enable="NO"
[ -z "$slon_profiles" ]     && slon_profiles=""

configfile_path="/usr/local/etc/${name}.conf"
command_args="-f ${configfile_path} -p ${pidfile} &"
required_files="${configfile_path}"

# Example: User has to define the following
# $slon_enable=true
# $slon_profiles="sex drugs unix"
# $slon_unix_configfile="/path/to.conf"
# $slon_sex_flags="-hawtte"

command="/usr/local/bin/slon"

isProfile() {
        match=0;
        for curMember in $slon_profiles; do
                if [ "$curMember" = "$1" ]; then
                        echo "Match"
                        match=1
                fi
        done
        return $match;
}



if [ -n "$2" ]; then
	profile="$2" # A profile argument has been given (presumably)
	if [ "x${slon_profiles}" != "x" ]; then # This checks that profiles are indeed defined
		# Now let's check to make sure that both the profile, the profile's config path variable, config file exists
		pidfile="${_pidprefix}-${profile}.pid"
		configfile_varname="\$${name}_${profile}_configfile" # Basic string substitution gets variable name
		eval configfile_path="${configfile_varname}"
		isProfile $profile
		searchForProfile=$?
		# testing for true
		if [ -z "$configfile_varname" -o ! -r "$configfile_path" -o $searchForProfile -lt 1 ]; then
			echo "$0: no such profile defined, profile config file defined, or cant read profile config file!";
			exit 1;
		fi
		required_files=${configfile_path}
		eval command_args="\$${name}_${profile}_flags"
	else
		echo "$0: extra profile argument ignored, no profiles defined"
	fi
	

else
	# We get to here if $2 is not defined at command line, but we do have profiles
	# This block uses recursion to call ourself with each-profile defined as $2
	if [ "x${slon_profiles}" != "x" -a "x$1" != "x" ]; then
		if [ "x$1" != "xrestart" ]; then
			for profile in ${slon_profiles}; do
				echo "===> ${name} profile: ${profile}"
				/usr/local/etc/rc.d/${name} $1 ${profile}
				retcode="$?"
				if [ "0${retcode}" -ne 0 ]; then
					failed="${profile} (${retcode}) ${failed:-}"
				else
					success="${profile} ${success:-}"
				fi
			done
			exit 0
		else
			restart_precmd=""
		fi
	fi
# else = no profile argument given
fi

run_rc_command "$1"


From xfade  Tue Feb 13 08:51:09 2007
From: xfade (Niels Breet)
Date: Tue Feb 13 08:58:46 2007
Subject: [Slony1-commit] slony1-www/content frontpage.txt
Message-ID: <20070130195729.E20A72903F5@main>

Update of /home/cvsd/slony1/slony1-www/content
In directory main:/tmp/cvs-serv23196

Added Files:
	frontpage.txt 
Log Message:
Extra info for frontpage.

--- NEW FILE: frontpage.txt ---
Slony-I 1.2.6
#
          <p>At long last, here is version 1.2.6. It has many
          enhancements as listed in the <a href=
          "http://pgfoundry.org/frs/shownotes.php?release_id=730">Release
          Notes</a> .</p>

          <p>This has been run thru the <a href=
          "http://linuxdatabases.info/info/releasechecklist.html">Release
          Checklist</a></p>

          <p>There are two tarballs available <a href=
          "http://pgfoundry.org/frs/?group_id=1000122">here</a></p>

---
Slony-I and PostgreSQL 8.1
#
          <p>There is a known incompatibility of versions earlier
          than 1.1.5 with version 8.1; you can expect to see the
          following error message when compiling:</p>
          <pre>
slony1_funcs.c:1081: error: too many arguments to function
`Async_Unlisten' 
</pre>

          <p>A patch for both version 1.1 "STABLE" and CVS HEAD has
          been committed to CVS; look at both CVS HEAD as well as
          <tt>REL_1_1_STABLE</tt>. It is in the 1.1.5 release
          candidate described above.</p>
---
Upgrading Slony-I
#
          <p>Beginning with version 1.0.5 the slon replication
          engine refuses to work against any database that does not
          have the stored procedures for the same version loaded or
          where the shared object containing the C language support
          functions and the log trigger does not match the version
          number.</p>

          <p>This means that the Slony installation on all nodes in
          a cluster must be upgraded at once.</p>

          <p>The proper upgrade procedure is this:</p>

          <ol>
            <li>Stop the slon replication engine on all nodes.</li>

            <li>Install the new Slony version on all nodes.</li>

            <li>Execute a slonik script containing the command
              <pre>

    update functions (id = );
</pre>for every node in the cluster.
            </li>

            <li>Start all slon replication engines.</li>
          </ol>

          <p>For more details, see also <a href=
          "./adminguide/slony1-1.2.6/doc/adminguide/slonyupgrade.html">
          Upgrading Slony-I</a> .</p>

---
Libpq requirements
#
          <p>The multithreaded replication engine requires the
          libpq client library to be compiled with
          --enable-thread-safety on certain operating systems.
          Known are thus far Solaris and AIX. Other operating
          systems are known to not require this (Linux-X86,
          FreeBSD-X86, FreeBSD-Alpha, OpenBSD-Sparc64 and OSX). The
          configuration script is broken with respect to the
          --enable-thread-safety switch for Solaris. Please apply
          this patch, configure and recompile libpq: <a href=
          "http://developer.postgresql.org/%7Ewieck/slony1/download/threadsafe-libpq-742.diff.gz">
          threadsafe-libpq-742.diff.gz.</a></p>

---
RPMs
http://pgfoundry.org/projects/slony1
          <p>RPM files for some versions of Red Hat Linux are
          available <a href=
          "http://pgfoundry.org/projects/slony1">here</a> ,
          including SRPM (Source RPM) files that may be helpful if
          you wish to generate RPM files for distributions not yet
          supported.</p>

          <p>This project is released under the Berkeley/BSD
          license.</p>


From xfade  Tue Feb 13 08:51:09 2007
From: xfade (Niels Breet)
Date: Tue Feb 13 08:58:46 2007
Subject: [Slony1-commit] slony1-www index.php
Message-ID: <20070130195857.96CA22903F7@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv23204

Modified Files:
	index.php 
Log Message:
Extra info for frontpage

Index: index.php
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/index.php,v
retrieving revision 1.2
retrieving revision 1.3
diff -C2 -d -r1.2 -r1.3
*** index.php	30 Jan 2007 19:23:18 -0000	1.2
--- index.php	30 Jan 2007 19:58:55 -0000	1.3
***************
*** 35,38 ****
--- 35,56 ----
  	}
  	echo layout_introblock($title,$link,$text);
+ 
+         $fp = fopen('./content/frontpage.txt','r');
+         if ($fp){
+                 $text="";
+                 while (!feof($fp)){
+ 			 $buf=fgets($fp,256);
+ 			 if (strpos($buf,'---')!==false){
+ 				if ($text != "") echo layout_defaultblock($title,$link,$text);
+ 				$text = "";
+ 				$title = @fgets($fp,256);
+ 				$link = @fgets($fp,256);
+ 			 } else {
+ 				$text .= $buf;
+ 			 }
+ 		}
+                 fclose($fp);
+         }
+ 
  	echo layout_leftcol_stop();
  	echo layout_rightcol_start();


From xfade  Tue Feb 13 08:51:09 2007
From: xfade (Niels Breet)
Date: Tue Feb 13 08:58:46 2007
Subject: [Slony1-commit] slony1-www/content frontpage.txt
Message-ID: <20070130200158.50DCF2902DE@main>

Update of /home/cvsd/slony1/slony1-www/content
In directory main:/tmp/cvs-serv23237

Modified Files:
	frontpage.txt 
Log Message:
Fix frontpage

Index: frontpage.txt
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/content/frontpage.txt,v
retrieving revision 1.1
retrieving revision 1.2
diff -C2 -d -r1.1 -r1.2
*** frontpage.txt	30 Jan 2007 19:57:27 -0000	1.1
--- frontpage.txt	30 Jan 2007 20:01:56 -0000	1.2
***************
*** 1,2 ****
--- 1,3 ----
+ ---
  Slony-I 1.2.6
  #


From cbbrowne  Tue Feb 13 08:51:09 2007
From: cbbrowne (Chris Browne)
Date: Tue Feb 13 08:58:46 2007
Subject: [Slony1-commit] slony1-www admin.html
Message-ID: <20070131174203.B9565290386@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv23925

Modified Files:
	admin.html 
Log Message:
Added some notes on how the web site is set up.


Index: admin.html
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/admin.html,v
retrieving revision 1.4
retrieving revision 1.5
diff -C2 -d -r1.4 -r1.5
*** admin.html	30 Jan 2007 19:37:54 -0000	1.4
--- admin.html	31 Jan 2007 17:42:01 -0000	1.5
***************
*** 214,217 ****
--- 214,260 ----
            that they newly add.</p>
  
+           <h1>Editing the Web Site</h1>
+ 
+           <p>Niels Breet has set things up where there is a pair of
+           central PHP scripts, <tt>index.php</tt>, and
+           <tt>layout.php</tt>, which control rendering of the
+           site.</p>
+ 
+           <p>Web site <i>content</i> resides in the
+           <tt>content</tt> directory as a set of <tt>.txt</tt>
+           files.</p>
+ 
+           <p>These pages consist of some lightly formatted
+           material:</p>
+ 
+           <ul>
+             <li>There is a "title" on the first line;</li>
+ 
+             <li>There is a line consisting of "#", marking a
+             barrier between title and other material;</li>
+ 
+             <li>Following that barrier is a set of HTML text that
+             will be rendered as the body of the web page</li>
+           </ul>
+ 
+           <p>There are also some pages that consist of
+           lightly-formatted news material, such as
+           <tt>news.txt</tt>. This file consists of a set of news
+           items, formatted thus:</p>
+ 
+           <ul>
+             <li>A line consisting of "---"</li>
+ 
+             <li>A title for the item</li>
+ 
+             <li>A URL for that title to point at (<i>e.g.</i> - if
+             you click on the title, you head to the URL)</li>
+ 
+             <li>A possibly-multi-line chunk of HTML to describe the
+             piece of news.</li>
+ 
+             <li>A line consisting of "---"</li>
+           </ul>
+ 
            <address>
              <a href="mailto:cbbrowne@ca.afilias.info">Christopher
***************
*** 219,223 ****
            </address><!-- Created: Thu Jan 25 11:38:58 EST 2007 -->
            <!-- hhmts start -->
!           Last modified: Tue Jan 30 14:37:16 EST 2007 
            <!-- hhmts end -->
          </td>
--- 262,266 ----
            </address><!-- Created: Thu Jan 25 11:38:58 EST 2007 -->
            <!-- hhmts start -->
!           Last modified: Wed Jan 31 12:41:19 EST 2007 
            <!-- hhmts end -->
          </td>


From xfade  Tue Feb 13 08:51:09 2007
From: xfade (Niels Breet)
Date: Tue Feb 13 08:58:46 2007
Subject: [Slony1-commit] slony1-www admin.html
Message-ID: <20070131175700.0256F2903B4@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv23951

Modified Files:
	admin.html 
Log Message:
Clarify the second line in a content file

Index: admin.html
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/admin.html,v
retrieving revision 1.5
retrieving revision 1.6
diff -C2 -d -r1.5 -r1.6
*** admin.html	31 Jan 2007 17:42:01 -0000	1.5
--- admin.html	31 Jan 2007 17:56:57 -0000	1.6
***************
*** 231,238 ****
              <li>There is a "title" on the first line;</li>
  
!             <li>There is a line consisting of "#", marking a
!             barrier between title and other material;</li>
  
!             <li>Following that barrier is a set of HTML text that
              will be rendered as the body of the web page</li>
            </ul>
--- 231,238 ----
              <li>There is a "title" on the first line;</li>
  
!             <li>There is a URL for that title on the second line;
! 	    </li>
  
!             <li>Following that is a set of HTML text that
              will be rendered as the body of the web page</li>
            </ul>


From xfade  Tue Feb 13 08:51:09 2007
From: xfade (Niels Breet)
Date: Tue Feb 13 08:58:46 2007
Subject: [Slony1-commit] slony1-www index.php layout.php style.css
Message-ID: <20070131180642.317DA2903F8@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv23970

Modified Files:
	index.php layout.php style.css 
Log Message:
Alter news display some more.

Index: layout.php
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/layout.php,v
retrieving revision 1.3
retrieving revision 1.4
diff -C2 -d -r1.3 -r1.4
*** layout.php	30 Jan 2007 19:37:33 -0000	1.3
--- layout.php	31 Jan 2007 18:06:39 -0000	1.4
***************
*** 103,107 ****
  }
  
! function layout_defaultblock($title="",$link="",$text=""){
  $output = '
      <div class="intro-header">
--- 103,107 ----
  }
  
! function layout_defaultblock($title="",$link="",$text="",$stamp="",$poster=""){
  $output = '
      <div class="intro-header">
***************
*** 115,120 ****
          <div class="top-right"></div>
        </div>
!       <div class="text"> 
  	'.$text.'
        </div>
        <div class="bottom">
--- 115,125 ----
          <div class="top-right"></div>
        </div>
!       <div class="text">
  	'.$text.'
+ 	';
+ if ($stamp != ""){
+     $output .= '<div class="news-stamp">'.$poster.' <i>'.$stamp.'</i></div>
+ }
+     $output .='
        </div>
        <div class="bottom">

Index: style.css
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/style.css,v
retrieving revision 1.3
retrieving revision 1.4
diff -C2 -d -r1.3 -r1.4
*** style.css	30 Jan 2007 19:32:38 -0000	1.3
--- style.css	31 Jan 2007 18:06:39 -0000	1.4
***************
*** 193,195 ****
    overflow: hidden;
    margin-right: 2%;
! }
\ No newline at end of file
--- 193,201 ----
    overflow: hidden;
    margin-right: 2%;
! }
! 
! .news-stamp{
!   width: 100%;
!   text-align: right;
!   float: right;
! }

Index: index.php
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/index.php,v
retrieving revision 1.3
retrieving revision 1.4
diff -C2 -d -r1.3 -r1.4
*** index.php	30 Jan 2007 19:58:55 -0000	1.3
--- index.php	31 Jan 2007 18:06:39 -0000	1.4
***************
*** 62,69 ****
  			 $buf=fgets($fp,256);
  			 if (strpos($buf,'---')!==false){
! 				if ($text != "") echo layout_defaultblock($title,$link,$text);
  				$text = "";
  				$title = @fgets($fp,256);
  				$link = @fgets($fp,256);
  			 } else {
  				$text .= $buf;
--- 62,71 ----
  			 $buf=fgets($fp,256);
  			 if (strpos($buf,'---')!==false){
! 				if ($text != "") echo layout_defaultblock($title,$link,$text,$stamp,$poster);
  				$text = "";
  				$title = @fgets($fp,256);
  				$link = @fgets($fp,256);
+ 				$stamp = @fgets($fp,256);
+ 				$poster = @fgets($fp,256);
  			 } else {
  				$text .= $buf;


From xfade  Tue Feb 13 08:51:09 2007
From: xfade (Niels Breet)
Date: Tue Feb 13 08:58:46 2007
Subject: [Slony1-commit] slony1-www/content news.txt
Message-ID: <20070131180642.2470A2903A5@main>

Update of /home/cvsd/slony1/slony1-www/content
In directory main:/tmp/cvs-serv23970/content

Modified Files:
	news.txt 
Log Message:
Alter news display some more.

Index: news.txt
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/content/news.txt,v
retrieving revision 1.2
retrieving revision 1.3
diff -C2 -d -r1.2 -r1.3
*** news.txt	30 Jan 2007 17:08:02 -0000	1.2
--- news.txt	31 Jan 2007 18:06:40 -0000	1.3
***************
*** 2,10 ****
  Slony-I New Web Site!
  http://main.slony.info
! Dateline: 2009-01-01 - We are pleased to announce the release of the new Slony-I web site at <tt>main.slony.info</tt>.
  ---
  Slony-I New CVS Site!
  http://main.slony.info/cvs.html
! 2007-01-20 The Slony-I project is now making active use of CVS repositories at <tt>cvs.slony.info</tt>; this replaces the former
  CVS repositories at gBorg.  We thank the gBorg operators for their support over the last few years, and Command Prompt for their provision of hardware, administrative, and hosting services for <tt>cvs.slony.info</tt>.
  ---
--- 2,14 ----
  Slony-I New Web Site!
  http://main.slony.info
! 2007-01-XX
! Chris Browne
! We are pleased to announce the release of the new Slony-I web site at <tt>main.slony.info</tt>.
  ---
  Slony-I New CVS Site!
  http://main.slony.info/cvs.html
! 2007-01-20
! <a href="mailto:cbbrowne@acm.org">Chris Browne</a>
! The Slony-I project is now making active use of CVS repositories at <tt>cvs.slony.info</tt>; this replaces the former
  CVS repositories at gBorg.  We thank the gBorg operators for their support over the last few years, and Command Prompt for their provision of hardware, administrative, and hosting services for <tt>cvs.slony.info</tt>.
  ---


From xfade  Tue Feb 13 08:51:09 2007
From: xfade (Niels Breet)
Date: Tue Feb 13 08:58:46 2007
Subject: [Slony1-commit] slony1-www layout.php
Message-ID: <20070131180801.04F272903F8@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv24003

Modified Files:
	layout.php 
Log Message:
Oops

Index: layout.php
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/layout.php,v
retrieving revision 1.4
retrieving revision 1.5
diff -C2 -d -r1.4 -r1.5
*** layout.php	31 Jan 2007 18:06:39 -0000	1.4
--- layout.php	31 Jan 2007 18:07:58 -0000	1.5
***************
*** 119,123 ****
  	';
  if ($stamp != ""){
!     $output .= '<div class="news-stamp">'.$poster.' <i>'.$stamp.'</i></div>
  }
      $output .='
--- 119,123 ----
  	';
  if ($stamp != ""){
!     $output .= '<div class="news-stamp">'.$poster.' <i>'.$stamp.'</i></div>';
  }
      $output .='


From xfade  Tue Feb 13 08:51:09 2007
From: xfade (Niels Breet)
Date: Tue Feb 13 08:58:46 2007
Subject: [Slony1-commit] slony1-www style.css
Message-ID: <20070131181603.9D0C42903FD@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv24065

Modified Files:
	style.css 
Log Message:
Style fix

Index: style.css
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/style.css,v
retrieving revision 1.4
retrieving revision 1.5
diff -C2 -d -r1.4 -r1.5
*** style.css	31 Jan 2007 18:06:39 -0000	1.4
--- style.css	31 Jan 2007 18:16:01 -0000	1.5
***************
*** 196,201 ****
  
  .news-stamp{
-   width: 100%;
    text-align: right;
!   float: right;
  }
--- 196,201 ----
  
  .news-stamp{
    text-align: right;
!   height: 20px;
!   font-size: 80%;
  }


From cbbrowne at lists.slony.info  Thu Feb  1 09:19:10 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-www/content admin.txt
Message-ID: <20070201171910.4D70E290214@main>

Update of /home/cvsd/slony1/slony1-www/content
In directory main:/tmp/cvs-serv25542

Added Files:
	admin.txt 
Log Message:
Add an "admin" page, replacing admin.html


--- NEW FILE: admin.txt ---
Slony-I Admin Area
#
          <h1>Web Site and CVS</h1>

          <p>The Slony-I web site physically resides at path
          <tt>/home/community/slony/htdocs</tt> , and is an
          anonymous checkout of the <tt>slony1-www</tt> <a href=
          "cvs.html">CVS repository.</a></p>

          <p>As a result, if you make changes directly, you'll want
          to do a <tt>cvs diff</tt> to extract those changes, and
          apply them to some not-so-anonymous copy of CVS that you
          have access to. Then please commit such changes to CVS
          and see about doing a <tt>cvs update</tt> in the
          <tt>htdocs</tt> directory to deploy those changes "to
          production."</p>
          <hr>

          <h1>Backups</h1>

          <p>Both <tt>rsync</tt> and <tt>unison</tt> are installed;
          either may be used to backup important parts of the web
          site.</p>

          <p>Here are the contents of a set of Unison <tt>.prf</tt>
          files suitable for backing up CVS, mailing lists, and the
          local web site contents.</p>

          <ol>
            <li>Unison configuration - <tt>cmdcvs.prf</tt>
              <pre>
root = /home/cbbrowne/Slony-I/CMD/cvsbackup
root = ssh://cvs.slony.info//home/cvsd/slony1
</pre>
            </li>

            <li>Unison configuration -
            <tt>cmdmailman-admin.prf</tt>
              <pre>
root = /home/cbbrowne/Slony-I/CMD/mailman-backup/admin
root = ssh://cvs.slony.info//var/lib/mailman/archives/private/slony-admin

</pre>
            </li>

            <li>Unison configuration - <tt>cmdmailman-bugs.prf</tt>
              <pre>
root = /home/cbbrowne/Slony-I/CMD/mailman-backup/bugs
root = ssh://cvs.slony.info//var/lib/mailman/archives/private/slony-bugs

</pre>
            </li>

            <li>Unison configuration -
            <tt>cmdmailman-commit.prf</tt>
              <pre>
root = /home/cbbrowne/Slony-I/CMD/mailman-backup/commit
root = ssh://cvs.slony.info//var/lib/mailman/archives/private/slony-commit

</pre>
            </li>

            <li>Unison configuration -
            <tt>cmdmailman-general.prf</tt>
              <pre>
root = /home/cbbrowne/Slony-I/CMD/mailman-backup/general
root = ssh://cvs.slony.info//var/lib/mailman/archives/private/slony-general

</pre>
            </li>

            <li>Unison configuration -
            <tt>cmdmailman-hackers.prf</tt>
              <pre>
root = /home/cbbrowne/Slony-I/CMD/mailman-backup/hackers
root = ssh://cvs.slony.info//var/lib/mailman/archives/private/slony-hackers

</pre>
            </li>

            <li>Unison configuration -
            <tt>cmdmailman-patches.prf</tt>
              <pre>
root = /home/cbbrowne/Slony-I/CMD/mailman-backup/patches
root = ssh://cvs.slony.info//var/lib/mailman/archives/private/slony-patches

</pre>
            </li>

            <li>Unison configuration - <tt>cmdweb.prf</tt>
              <pre>
root = /home/cbbrowne/Slony-I/CMD/webbackup
root = ssh://cvs.slony.info//home/community/slony
</pre>
            </li>
          </ol>

          <h2>Usage</h2>

          <p>If you are using Unison, you might write the above
          files into your local <tt>${HOME}/.unison</tt> directory,
          and then use them as follows:</p>
          <pre>
cd ${HOME}.unison
for target in `ls cmd*prf | cut -d "." -f 1`; do
   unison ${target}
done
</pre>

          <p>By default, this will request user intervention to
          indicate the direction in which to propagate updates; if
          you know what you're doing, you can tell
          <tt>unison</tt>to "just do it."</p>

          <h2>Other Environmental Stuff</h2>

          <p>Those with login access, please add the entry:</p>
          <pre>
umask 0002
</pre>

          <p>to your <tt>.profile</tt> / <tt>.bashrc</tt> file.
          That way, <i>group write</i> is permitted, by default.
          It's very annoying, particularly in the web site area, if
          one person checks out CVS with <tt>umask 0022</tt>,
          thereby forbidding anyone else from updating any files
          that they newly add.</p>

          <h1>Editing the Web Site</h1>

          <p>Niels Breet has set things up where there is a pair of
          central PHP scripts, <tt>index.php</tt>, and
          <tt>layout.php</tt>, which control rendering of the site.
          By doing things this way, each page on the site can have a
          common layout complete with common
          header/footer/graphics.</p>

          <p>Web site <i>content</i> resides in the
          <tt>content</tt> directory as a set of <tt>.txt</tt>
          files.</p>

          <p>These pages consist of some lightly formatted
          material:</p>

          <ul>
            <li>There is a "title" on the first line;</li>

            <li>There is a URL for that title on the second line;
	    </li>

            <li>Following that is a set of HTML text that
            will be rendered as the body of the web page</li>
          </ul>

          <p>There are also some pages that consist of
          lightly-formatted news material, such as
          <tt>news.txt</tt>. This file consists of a set of news
          items, formatted thus:</p>

          <ul>
            <li>A line consisting of "---"</li>

            <li>A title for the item</li>

            <li>A URL for that title to point at (<i>e.g.</i> - if
            you click on the title, you head to the URL)</li>

            <li>A possibly-multi-line chunk of HTML to describe the
            piece of news.</li>

            <li>A line consisting of "---"</li>
          </ul>


From cbbrowne at lists.slony.info  Thu Feb  1 09:30:17 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-www/content cvs.txt
Message-ID: <20070201173017.B085F2903AE@main>

Update of /home/cvsd/slony1/slony1-www/content
In directory main:/tmp/cvs-serv25849/content

Modified Files:
	cvs.txt 
Log Message:
Add links to webCVS


Index: cvs.txt
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/content/cvs.txt,v
retrieving revision 1.2
retrieving revision 1.3
diff -C2 -d -r1.2 -r1.3
*** cvs.txt	30 Jan 2007 19:21:52 -0000	1.2
--- cvs.txt	1 Feb 2007 17:30:15 -0000	1.3
***************
*** 24,31 ****
  
            <ul>
!             <li><tt>slony1-engine</tt> - the replication engine
              project</li>
  
!             <li><tt>slony1-www</tt> - web site material for
              main.slony.info</li>
  
--- 24,31 ----
  
            <ul>
!             <li><a href="http://main.slony.info/viewcvs/viewvc.cgi/slony1-engine/"> slony1-engine</a> - the replication engine
              project</li>
  
!             <li><a href=http://main.slony.info/viewcvs/viewvc.cgi/slony1-www/">slony1-www</a> - web site material for
              main.slony.info</li>
  


From cbbrowne at lists.slony.info  Thu Feb  1 09:33:15 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-www/content cvs.txt
Message-ID: <20070201173315.410B7290430@main>

Update of /home/cvsd/slony1/slony1-www/content
In directory main:/tmp/cvs-serv25958/content

Modified Files:
	cvs.txt 
Log Message:
Stupid missing quote mark...


Index: cvs.txt
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/content/cvs.txt,v
retrieving revision 1.3
retrieving revision 1.4
diff -C2 -d -r1.3 -r1.4
*** cvs.txt	1 Feb 2007 17:30:15 -0000	1.3
--- cvs.txt	1 Feb 2007 17:33:13 -0000	1.4
***************
*** 27,31 ****
              project</li>
  
!             <li><a href=http://main.slony.info/viewcvs/viewvc.cgi/slony1-www/">slony1-www</a> - web site material for
              main.slony.info</li>
  
--- 27,31 ----
              project</li>
  
!             <li><a href="http://main.slony.info/viewcvs/viewvc.cgi/slony1-www/">slony1-www</a> - web site material for
              main.slony.info</li>
  


From cbbrowne at lists.slony.info  Thu Feb  1 11:09:10 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine/doc/adminguide adminscripts.sgml
Message-ID: <20070201190910.545912903FF@main>

Update of /home/cvsd/slony1/slony1-engine/doc/adminguide
In directory main:/tmp/cvs-serv26115

Modified Files:
	adminscripts.sgml 
Log Message:
Several improvements to documentation, per patches from Mark Stosberg.


Index: adminscripts.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/adminscripts.sgml,v
retrieving revision 1.47
retrieving revision 1.48
diff -C2 -d -r1.47 -r1.48
*** adminscripts.sgml	30 Jan 2007 19:57:11 -0000	1.47
--- adminscripts.sgml	1 Feb 2007 19:09:08 -0000	1.48
***************
*** 22,29 ****
  </command></para>
  
! <para>This will produce a number of scripts with the prefix <command>slonik_</command>.
! They eliminate tedium by always referring to a central configuration file
! for the details of your site configuration. Most also include some command 
! line help with the "-h" option, making them easier to learn and use.
  </para>
  
--- 22,32 ----
  </command></para>
  
! <para>This will produce a number of scripts with the prefix
! <command>slonik_</command>.  They eliminate tedium by always referring
! to a central configuration file for the details of your site
! configuration. A documented sample of this file is provided in
! <filename>altperl/slon_tools.conf-sample</filename>. Most also include
! some command line help with the "--help" option, making them easier to
! learn and use.
  </para>
  
***************
*** 35,44 ****
  <emphasis>before</emphasis> piping it to <xref linkend="slonik">.</para>
  
! <sect3><title>Node/Cluster Configuration - cluster.nodes</title>
! <indexterm><primary>cluster.nodes - node/cluster configuration for Perl tools</primary></indexterm>
  
  <para>The UNIX environment variable <envar>SLONYNODES</envar> is used
  to determine what Perl configuration file will be used to control the
! shape of the nodes in a &slony1; cluster.</para>
  
  <para>What variables are set up.
--- 38,49 ----
  <emphasis>before</emphasis> piping it to <xref linkend="slonik">.</para>
  
! <sect3><title>Support for Multiple Clusters</title>
! <indexterm><primary>Multiple Cluster support for the altperl tools</primary></indexterm>
  
  <para>The UNIX environment variable <envar>SLONYNODES</envar> is used
  to determine what Perl configuration file will be used to control the
! shape of the nodes in a &slony1; cluster. If it is not provided, a
! default <filename>slon_tools.conf</filename> location will be
! referenced. </para>
  
  <para>What variables are set up.
***************
*** 88,91 ****
--- 93,97 ----
  </programlisting>
  </sect3>
+ 
  <sect3><title>Set configuration - cluster.set1, cluster.set2</title>
  <indexterm><primary>cluster.set1 - replication set configuration for Perl tools</primary></indexterm>
***************
*** 101,133 ****
  control what tables will be in a particular replication set.</para>
  
- <para>What variables are set up.</para>
- <itemizedlist>
- <listitem><para>$TABLE_ID = 44;</para>
- <para> Each table must be identified by a unique number; this variable controls where numbering starts</para>
- </listitem>
- <listitem><para>$SEQUENCE_ID = 17;</para>
- <para> Each sequence must be identified by a unique number; this variable controls where numbering starts</para>
- </listitem>
- <listitem><para>@PKEYEDTABLES</para>
- 
- <para> An array of names of tables to be replicated that have a
- defined primary key so that &slony1; can automatically select its key</para>
- </listitem>
- <listitem><para>%KEYEDTABLES</para>
- <para> A hash table of tables to be replicated, where the hash index
- is the table name, and the hash value is the name of a unique not null
- index suitable as a "candidate primary key."</para>
- </listitem>
- <listitem><para>@SERIALTABLES</para>
- 
- <para> An array of names of tables to be replicated that have no
- candidate for primary key.  &slony1; will add a key field based on a
- sequence that &slony1; generates</para>
- </listitem>
- <listitem><para>@SEQUENCES</para>
- 
- <para> An array of names of sequences that are to be replicated</para>
- </listitem>
- </itemizedlist>
  </sect3>
  <sect3><title>slonik_build_env</title>
--- 107,110 ----


From xfade at lists.slony.info  Fri Feb  2 08:52:26 2007
From: xfade at lists.slony.info (Niels Breet)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-www layout.php
Message-ID: <20070202165226.900632902D0@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv27852

Modified Files:
	layout.php 
Log Message:
What was that div doing there ;)

Index: layout.php
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/layout.php,v
retrieving revision 1.5
retrieving revision 1.6
diff -C2 -d -r1.5 -r1.6
*** layout.php	31 Jan 2007 18:07:58 -0000	1.5
--- layout.php	2 Feb 2007 16:52:24 -0000	1.6
***************
*** 26,30 ****
  
  <div class="content">
-   </div>
  ';
  return $output;
--- 26,29 ----


From xfade at lists.slony.info  Fri Feb  2 09:12:20 2007
From: xfade at lists.slony.info (Niels Breet)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-www style.css
Message-ID: <20070202171220.69D172903E3@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv27919

Modified Files:
	style.css 
Log Message:
Fix IE and Konqueror glitches.

Index: style.css
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/style.css,v
retrieving revision 1.5
retrieving revision 1.6
diff -C2 -d -r1.5 -r1.6
*** style.css	31 Jan 2007 18:16:01 -0000	1.5
--- style.css	2 Feb 2007 17:12:18 -0000	1.6
***************
*** 9,12 ****
--- 9,13 ----
    margin: 0;
    font-size: 18pt;
+   padding-top:4px;
    padding-bottom: 10px;
  }
***************
*** 68,72 ****
  .col2{
    float: right;
!   width: 40%;
  }
  
--- 69,73 ----
  .col2{
    float: right;
!   width: 39%;
  }
  
***************
*** 77,80 ****
--- 78,82 ----
    overflow: hidden;
    margin-top: 10px;
+   float: right;
  }
  
***************
*** 88,93 ****
  .intro-header .right{
    width: 96%;
!   height: 21px;
!   float: left;
    background: url('images/intro-header-right.png') top right no-repeat;
    overflow: hidden;
--- 90,95 ----
  .intro-header .right{
    width: 96%;
!   height: 28px;
!   float: right;
    background: url('images/intro-header-right.png') top right no-repeat;
    overflow: hidden;
***************
*** 113,116 ****
--- 115,119 ----
    background-color: #f6f6f6;
    margin-right: 4px;
+   float: right;
  }
  
***************
*** 120,123 ****
--- 123,127 ----
    width: 100%;
    overflow: hidden;
+   float: right;
  }
  
***************
*** 146,149 ****
--- 150,154 ----
    width: 100%;
    overflow: hidden;
+   float: right;
  }
  
***************
*** 188,192 ****
  .copyright{
    width: 98%;
!   height: 18px;
    color: #ffffff;
    text-align: center;
--- 193,197 ----
  .copyright{
    width: 98%;
!   height: 40px;
    color: #ffffff;
    text-align: center;


From xfade at lists.slony.info  Fri Feb  2 09:13:56 2007
From: xfade at lists.slony.info (Niels Breet)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-www/content frontpage.txt
Message-ID: <20070202171356.43BFE2903E1@main>

Update of /home/cvsd/slony1/slony1-www/content
In directory main:/tmp/cvs-serv27946

Modified Files:
	frontpage.txt 
Log Message:
Looked messy

Index: frontpage.txt
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/content/frontpage.txt,v
retrieving revision 1.2
retrieving revision 1.3
diff -C2 -d -r1.2 -r1.3
*** frontpage.txt	30 Jan 2007 20:01:56 -0000	1.2
--- frontpage.txt	2 Feb 2007 17:13:54 -0000	1.3
***************
*** 20,27 ****
            than 1.1.5 with version 8.1; you can expect to see the
            following error message when compiling:</p>
!           <pre>
  slony1_funcs.c:1081: error: too many arguments to function
  `Async_Unlisten' 
! </pre>
  
            <p>A patch for both version 1.1 "STABLE" and CVS HEAD has
--- 20,27 ----
            than 1.1.5 with version 8.1; you can expect to see the
            following error message when compiling:</p>
!           <em>
  slony1_funcs.c:1081: error: too many arguments to function
  `Async_Unlisten' 
! </em>
  
            <p>A patch for both version 1.1 "STABLE" and CVS HEAD has


From xfade at lists.slony.info  Fri Feb  2 09:18:20 2007
From: xfade at lists.slony.info (Niels Breet)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-www index.php
Message-ID: <20070202171820.804D62903F9@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv27961

Modified Files:
	index.php 
Log Message:
Trim trailing \n etc.

Index: index.php
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/index.php,v
retrieving revision 1.4
retrieving revision 1.5
diff -C2 -d -r1.4 -r1.5
*** index.php	31 Jan 2007 18:06:39 -0000	1.4
--- index.php	2 Feb 2007 17:18:18 -0000	1.5
***************
*** 15,20 ****
  	$fp = fopen('./content/cvs.txt','r');
  	if ($fp){
! 		$title=fgets($fp,256);
! 		$link=fgets($fp,256);
  		$text="";
  		while (!feof($fp)) $text.=fgets($fp,256);
--- 15,20 ----
  	$fp = fopen('./content/cvs.txt','r');
  	if ($fp){
! 		$title=trim(fgets($fp,256));
! 		$link=trim(fgets($fp,256));
  		$text="";
  		while (!feof($fp)) $text.=fgets($fp,256);
***************
*** 28,33 ****
  	$fp = fopen('./content/intro.txt','r');
  	if ($fp){
! 		$title=fgets($fp,256);
! 		$link=fgets($fp,256);
  		$text="";
  		while (!feof($fp)) $text.=fgets($fp,256);
--- 28,33 ----
  	$fp = fopen('./content/intro.txt','r');
  	if ($fp){
! 		$title=trim(fgets($fp,256));
! 		$link=trim(fgets($fp,256));
  		$text="";
  		while (!feof($fp)) $text.=fgets($fp,256);
***************
*** 44,49 ****
  				if ($text != "") echo layout_defaultblock($title,$link,$text);
  				$text = "";
! 				$title = @fgets($fp,256);
! 				$link = @fgets($fp,256);
  			 } else {
  				$text .= $buf;
--- 44,49 ----
  				if ($text != "") echo layout_defaultblock($title,$link,$text);
  				$text = "";
! 				$title = trim(@fgets($fp,256));
! 				$link = trim(@fgets($fp,256));
  			 } else {
  				$text .= $buf;
***************
*** 64,69 ****
  				if ($text != "") echo layout_defaultblock($title,$link,$text,$stamp,$poster);
  				$text = "";
! 				$title = @fgets($fp,256);
! 				$link = @fgets($fp,256);
  				$stamp = @fgets($fp,256);
  				$poster = @fgets($fp,256);
--- 64,69 ----
  				if ($text != "") echo layout_defaultblock($title,$link,$text,$stamp,$poster);
  				$text = "";
! 				$title = trim(@fgets($fp,256));
! 				$link = trim(@fgets($fp,256));
  				$stamp = @fgets($fp,256);
  				$poster = @fgets($fp,256);


From xfade at lists.slony.info  Fri Feb  2 10:24:37 2007
From: xfade at lists.slony.info (Niels Breet)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-www style.css
Message-ID: <20070202182437.5EE22290440@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv28827

Modified Files:
	style.css 
Log Message:
Header inputs styling

Index: style.css
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/style.css,v
retrieving revision 1.6
retrieving revision 1.7
diff -C2 -d -r1.6 -r1.7
*** style.css	2 Feb 2007 17:12:18 -0000	1.6
--- style.css	2 Feb 2007 18:24:35 -0000	1.7
***************
*** 111,114 ****
--- 111,121 ----
  }
  
+ intro-header input{
+   border: 1px solid #ffffff;
+   color: #ffffff;
+   background-color: #182F73;
+   margin-right: 12px;
+ }
+ 
  .intro-body{
    margin: 2px;


From xfade at lists.slony.info  Fri Feb  2 10:28:52 2007
From: xfade at lists.slony.info (Niels Breet)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-www style.css
Message-ID: <20070202182852.451E3290441@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv29100

Modified Files:
	style.css 
Log Message:
Header styling fix

Index: style.css
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/style.css,v
retrieving revision 1.7
retrieving revision 1.8
diff -C2 -d -r1.7 -r1.8
*** style.css	2 Feb 2007 18:24:35 -0000	1.7
--- style.css	2 Feb 2007 18:28:50 -0000	1.8
***************
*** 111,115 ****
  }
  
! intro-header input{
    border: 1px solid #ffffff;
    color: #ffffff;
--- 111,115 ----
  }
  
! .intro-header input{
    border: 1px solid #ffffff;
    color: #ffffff;
***************
*** 118,121 ****
--- 118,125 ----
  }
  
+ .intro-header select{
+   margin-top: -1px;
+ }
+ 
  .intro-body{
    margin: 2px;


From xfade at lists.slony.info  Fri Feb  2 10:43:32 2007
From: xfade at lists.slony.info (Niels Breet)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-www style.css
Message-ID: <20070202184332.64F20290442@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv29257

Modified Files:
	style.css 
Log Message:
Menu items

Index: style.css
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/style.css,v
retrieving revision 1.8
retrieving revision 1.9
diff -C2 -d -r1.8 -r1.9
*** style.css	2 Feb 2007 18:28:50 -0000	1.8
--- style.css	2 Feb 2007 18:43:30 -0000	1.9
***************
*** 52,55 ****
--- 52,56 ----
    font-size: 14pt;
    font-weight: bold;
+   padding-right: 10px;
  }
  


From xfade at lists.slony.info  Fri Feb  2 10:49:24 2007
From: xfade at lists.slony.info (Niels Breet)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-www style.css
Message-ID: <20070202184924.CD132290443@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv29348

Modified Files:
	style.css 
Log Message:
Make Darcys background white.

Index: style.css
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/style.css,v
retrieving revision 1.9
retrieving revision 1.10
diff -C2 -d -r1.9 -r1.10
*** style.css	2 Feb 2007 18:43:30 -0000	1.9
--- style.css	2 Feb 2007 18:49:22 -0000	1.10
***************
*** 4,7 ****
--- 4,8 ----
    line-height: 100%;
    margin: 8px;
+   background-color: #ffffff;
  }
  


From cbbrowne at lists.slony.info  Fri Feb  2 12:23:01 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine RELEASE-1.1.7
Message-ID: <20070202202301.543832902D0@main>

Update of /home/cvsd/slony1/slony1-engine
In directory main:/tmp/cvs-serv30382

Added Files:
      Tag: REL_1_1_STABLE
	RELEASE-1.1.7 
Log Message:
Added a new conf file option for slon - remote_listen_timeout

This helps if you have a slon down for a Very Long Time so that sl_event
bloats and causes the query on it to time out.



--- NEW FILE: RELEASE-1.1.7 ---
$Id: RELEASE-1.1.7,v 1.1.2.1 2007-02-02 20:22:59 cbbrowne Exp $

- Add remote_listen_timeout parameter to slon.conf

This addresses the problem where a slon times out when accessing
sl_event if a node has been out of commission for a long time (several
days)


From cbbrowne at lists.slony.info  Fri Feb  2 12:23:01 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine/doc/adminguide slonconf.sgml
Message-ID: <20070202202301.61E3B2903F6@main>

Update of /home/cvsd/slony1/slony1-engine/doc/adminguide
In directory main:/tmp/cvs-serv30382/doc/adminguide

Modified Files:
      Tag: REL_1_1_STABLE
	slonconf.sgml 
Log Message:
Added a new conf file option for slon - remote_listen_timeout

This helps if you have a slon down for a Very Long Time so that sl_event
bloats and causes the query on it to time out.



Index: slonconf.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/slonconf.sgml,v
retrieving revision 1.8.2.1
retrieving revision 1.8.2.2
diff -C2 -d -r1.8.2.1 -r1.8.2.2
*** slonconf.sgml	9 Dec 2005 22:22:00 -0000	1.8.2.1
--- slonconf.sgml	2 Feb 2007 20:22:59 -0000	1.8.2.2
***************
*** 143,146 ****
--- 143,157 ----
        </listitem>
      </varlistentry>
+     <varlistentry id="slon-config-remote-listen-timeout" xreflabel="slon_conf_remote_listen_timeout">
+       <term><varname>remote_listen_timeout</varname> (<type>integer</type>)</term>
+       <indexterm>
+         <primary><varname>remote_listen_timeout</varname> configuration parameter</primary>
+       </indexterm>
+       <listitem>
+         <para>How long should the remote listener wait before treating the event selection criteria as having timed out?
+           Range: [30-30000], default 300
+         </para>
+       </listitem>
+     </varlistentry>
    </variablelist>
  </sect1>


From cbbrowne at lists.slony.info  Fri Feb  2 12:23:01 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine/src/slon confoptions.h remote_listen.c
Message-ID: <20070202202301.8F3E6290445@main>

Update of /home/cvsd/slony1/slony1-engine/src/slon
In directory main:/tmp/cvs-serv30382/src/slon

Modified Files:
      Tag: REL_1_1_STABLE
	confoptions.h remote_listen.c 
Log Message:
Added a new conf file option for slon - remote_listen_timeout

This helps if you have a slon down for a Very Long Time so that sl_event
bloats and causes the query on it to time out.



Index: remote_listen.c
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/slon/remote_listen.c,v
retrieving revision 1.21.2.2
retrieving revision 1.21.2.3
diff -C2 -d -r1.21.2.2 -r1.21.2.3
*** remote_listen.c	6 Jan 2006 17:07:47 -0000	1.21.2.2
--- remote_listen.c	2 Feb 2007 20:22:59 -0000	1.21.2.3
***************
*** 58,61 ****
--- 58,62 ----
  							SlonConn * conn, struct listat *listat);
  
+ int remote_listen_timeout;
  
  
***************
*** 655,659 ****
  	}
  	time(&timeout);
! 	timeout += 300;
  	while (PQisBusy(conn->dbconn) != 0)
  	{
--- 656,660 ----
  	}
  	time(&timeout);
! 	timeout += remote_listen_timeout;
  	while (PQisBusy(conn->dbconn) != 0)
  	{
***************
*** 662,667 ****
  		{
  			slon_log(SLON_ERROR,
! 				 "remoteListenThread_%d: timeout for event selection\n",
! 				 node->no_id);
  			dstring_free(&query);
  			return -1;
--- 663,668 ----
  		{
  			slon_log(SLON_ERROR,
! 				 "remoteListenThread_%d: timeout (%d s) for event selection\n",
! 				 node->no_id, remote_listen_timeout);
  			dstring_free(&query);
  			return -1;

Index: confoptions.h
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/slon/confoptions.h,v
retrieving revision 1.23.2.1
retrieving revision 1.23.2.2
diff -C2 -d -r1.23.2.1 -r1.23.2.2
*** confoptions.h	30 Jun 2005 17:11:52 -0000	1.23.2.1
--- confoptions.h	2 Feb 2007 20:22:59 -0000	1.23.2.2
***************
*** 189,192 ****
--- 189,204 ----
  	},
  #endif
+ 	{
+ 		{
+ 			(const char *)"remote_listen_timeout",		/* conf name */
+ 			gettext_noop("How long to wait, in seconds, before timeout when querying for remote events"),		/* short desc */
+ 			gettext_noop("How long to wait, in seconds, before timeout when querying for remote events"),		/* long desc */
+ 			SLON_C_INT			/* config type */
+ 		},
+ 		&remote_listen_timeout,			/* var name */
+ 		300,					/* default val */
+ 		30,					/* min val */
+ 		30000					/* max val */
+ 	},
      {0}
  };


From cbbrowne at lists.slony.info  Fri Feb  2 12:23:48 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine RELEASE-1.2.7
Message-ID: <20070202202348.BB9D6290447@main>

Update of /home/cvsd/slony1/slony1-engine
In directory main:/tmp/cvs-serv30435

Added Files:
      Tag: REL_1_2_STABLE
	RELEASE-1.2.7 
Log Message:
Added a new conf file option for slon - remote_listen_timeout

This helps if you have a slon down for a Very Long Time so that sl_event
bloats and causes the query on it to time out.



--- NEW FILE: RELEASE-1.2.7 ---
$Id: RELEASE-1.2.7,v 1.1.2.1 2007-02-02 20:23:46 cbbrowne Exp $

- Add remote_listen_timeout parameter to slon.conf

This addresses the problem where a slon times out when accessing
sl_event if a node has been out of commission for a long time (several
days)


From cbbrowne at lists.slony.info  Fri Feb  2 12:23:48 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine/src/slon confoptions.c remote_listen.c
Message-ID: <20070202202349.031D8290447@main>

Update of /home/cvsd/slony1/slony1-engine/src/slon
In directory main:/tmp/cvs-serv30435/src/slon

Modified Files:
      Tag: REL_1_2_STABLE
	confoptions.c remote_listen.c 
Log Message:
Added a new conf file option for slon - remote_listen_timeout

This helps if you have a slon down for a Very Long Time so that sl_event
bloats and causes the query on it to time out.



Index: remote_listen.c
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/slon/remote_listen.c,v
retrieving revision 1.31.2.2
retrieving revision 1.31.2.3
diff -C2 -d -r1.31.2.2 -r1.31.2.3
*** remote_listen.c	27 Oct 2006 20:09:56 -0000	1.31.2.2
--- remote_listen.c	2 Feb 2007 20:23:46 -0000	1.31.2.3
***************
*** 67,70 ****
--- 67,71 ----
  
  extern char *lag_interval;
+ int remote_listen_timeout;
  
  /* ----------
***************
*** 734,738 ****
  	}
  	time(&timeout);
! 	timeout += 300;
  	while (PQisBusy(conn->dbconn) != 0)
  	{
--- 735,739 ----
  	}
  	time(&timeout);
! 	timeout += remote_listen_timeout;
  	while (PQisBusy(conn->dbconn) != 0)
  	{
***************
*** 741,746 ****
  		{
  			slon_log(SLON_ERROR,
! 					 "remoteListenThread_%d: timeout for event selection\n",
! 					 node->no_id);
  			dstring_free(&query);
  			return -1;
--- 742,747 ----
  		{
  			slon_log(SLON_ERROR,
! 				 "remoteListenThread_%d: timeout (%d s) for event selection\n",
! 				 node->no_id, remote_listen_timeout);
  			dstring_free(&query);
  			return -1;

Index: confoptions.c
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/slon/confoptions.c,v
retrieving revision 1.17.2.3
retrieving revision 1.17.2.4
diff -C2 -d -r1.17.2.3 -r1.17.2.4
*** confoptions.c	27 Oct 2006 20:09:56 -0000	1.17.2.3
--- confoptions.c	2 Feb 2007 20:23:46 -0000	1.17.2.4
***************
*** 681,684 ****
--- 681,699 ----
  		1073741824					/* max val */
  	},
+ 
+ 	{
+ 		{
+ 			(const char *)"remote_listen_timeout",		/* conf name */
+ 			gettext_noop("How long to wait, in seconds, before timeout when querying for remote events"),		/* short desc */
+ 			gettext_noop("How long to wait, in seconds, before timeout when querying for remote events"),		/* long desc */
+ 			SLON_C_INT			/* config type */
+ 		},
+ 		&remote_listen_timeout,			/* var name */
+ 		300,					/* default val */
+ 		30,					/* min val */
+ 		30000					/* max val */
+ 	},
+ 
+ 
  	{{0}}
  };


From cbbrowne at lists.slony.info  Fri Feb  2 12:23:48 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine/doc/adminguide faq.sgml
	loganalysis.sgml slonconf.sgml
Message-ID: <20070202202349.10660290449@main>

Update of /home/cvsd/slony1/slony1-engine/doc/adminguide
In directory main:/tmp/cvs-serv30435/doc/adminguide

Modified Files:
      Tag: REL_1_2_STABLE
	faq.sgml loganalysis.sgml slonconf.sgml 
Log Message:
Added a new conf file option for slon - remote_listen_timeout

This helps if you have a slon down for a Very Long Time so that sl_event
bloats and causes the query on it to time out.



Index: slonconf.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/slonconf.sgml,v
retrieving revision 1.14
retrieving revision 1.14.2.1
diff -C2 -d -r1.14 -r1.14.2.1
*** slonconf.sgml	2 Aug 2006 18:34:59 -0000	1.14
--- slonconf.sgml	2 Feb 2007 20:23:46 -0000	1.14.2.1
***************
*** 431,434 ****
--- 431,445 ----
        </listitem>
      </varlistentry>
+     <varlistentry id="slon-config-remote-listen-timeout" xreflabel="slon_conf_remote_listen_timeout">
+       <term><varname>remote_listen_timeout</varname> (<type>integer</type>)</term>
+       <indexterm>
+         <primary><varname>remote_listen_timeout</varname> configuration parameter</primary>
+       </indexterm>
+       <listitem>
+         <para>How long should the remote listener wait before treating the event selection criteria as having timed out?
+           Range: [30-30000], default 300
+         </para>
+       </listitem>
+     </varlistentry>
    </variablelist>
  </sect1>

Index: faq.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/faq.sgml,v
retrieving revision 1.66.2.2
retrieving revision 1.66.2.3
diff -C2 -d -r1.66.2.2 -r1.66.2.3
*** faq.sgml	27 Oct 2006 15:35:32 -0000	1.66.2.2
--- faq.sgml	2 Feb 2007 20:23:46 -0000	1.66.2.3
***************
*** 999,1002 ****
--- 999,1035 ----
  </qandaentry>
  
+ <qandaentry>
+ <question><para> One of my nodes fell over (&lslon; / postmaster was
+ down) and nobody noticed for several days.  Now, when the &lslon; for
+ that node starts up, it runs for about five minutes, then terminates,
+ with the error message: <command>ERROR: remoteListenThread_%d: timeout
+ for event selection</command> What's wrong, and what do I do? </para> 
+ </question>
+ 
+ <answer><para> The problem is that the listener thread (in
+ <filename>src/slon/remote_listener.c</filename>) timed out when trying
+ to determine what events were outstanding for that node.  By default,
+ the query will run for five minutes; if there were many days worth of
+ outstanding events, this might take too long.
+  </para> </answer>
+ 
+ <answer><para> On  versions of &slony1; before 1.1.7, 1.2.7, and 1.3, one answer would be to increase the timeout in 
+ <filename>src/slon/remote_listener.c</filename>, recompile &lslon;, and retry.  </para> </answer>
+ 
+ <answer><para> Another would be to treat the node as having failed,
+ and use the &slonik; command <xref linkend="stmtdropnode"> to drop the
+ node, and recreate it.  If the database is heavily updated, it may
+ well be cheaper to do this than it is to find a way to let it catch
+ up.  </para> </answer>
+ 
+ <answer><para> In newer versions of &slony1;, there is a new
+ configuration parameter called <xref
+ linkend="slon-config-remote-listen-timeout">; you'd alter the config
+ file to increase the timeout, and try again.  Of course, as mentioned
+ above, it could be faster to drop the node and recreate it than to let
+ it catch up across a week's worth of updates...  </para> </answer>
+ 
+ </qandaentry>
+ 
  </qandadiv>
  <qandadiv id="faqperformance"> <title> &slony1; FAQ: Performance Issues </title>

Index: loganalysis.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/loganalysis.sgml,v
retrieving revision 1.4.2.1
retrieving revision 1.4.2.2
diff -C2 -d -r1.4.2.1 -r1.4.2.2
*** loganalysis.sgml	30 Oct 2006 16:29:27 -0000	1.4.2.1
--- loganalysis.sgml	2 Feb 2007 20:23:46 -0000	1.4.2.2
***************
*** 610,613 ****
--- 610,634 ----
  normally...</para></listitem>
  
+ <listitem><para><command>ERROR: remoteListenThread_%d: timeout for event selection</command></para>
+ 
+ <para> This means that the listener thread
+ (<filename>src/slon/remote_listener.c</filename>) timed out when
+ trying to determine what events were outstanding for it.</para>
+ 
+ <para> This could occur because network connections broke, in which case restarting the &lslon; might help. </para>
+ 
+ <para> Alternatively, this might occur because the &lslon; for this
+ node has been broken for a long time, and there are an enormous number
+ of entries in <envar>sl_event</envar> on this or other nodes for the
+ node to work through, and it is taking more than <xref
+ linkend="slon-config-remote-listen-timeout"> seconds to run the query.
+ In older versions of &slony1;, that configuration parameter did not
+ exist; the timeout was fixed at 300 seconds.  In newer versions, you
+ might increase that timeout in the &lslon; config file to a larger
+ value so that it can continue to completion.  And then investigate why
+ nobody was monitoring things such that replication broke for such a
+ long time... </para>
+ </listitem>
+ 
  <listitem><para><command>ERROR: remoteWorkerThread_%d: cannot connect to data provider %d on 'dsn'</command></para>
  


From cbbrowne at lists.slony.info  Fri Feb  2 12:24:18 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine/doc/adminguide faq.sgml
	loganalysis.sgml slonconf.sgml
Message-ID: <20070202202418.9C82E290449@main>

Update of /home/cvsd/slony1/slony1-engine/doc/adminguide
In directory main:/tmp/cvs-serv30460/doc/adminguide

Modified Files:
	faq.sgml loganalysis.sgml slonconf.sgml 
Log Message:
Added a new conf file option for slon - remote_listen_timeout

This helps if you have a slon down for a Very Long Time so that sl_event
bloats and causes the query on it to time out.



Index: slonconf.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/slonconf.sgml,v
retrieving revision 1.15
retrieving revision 1.16
diff -C2 -d -r1.15 -r1.16
*** slonconf.sgml	2 Jan 2007 20:16:58 -0000	1.15
--- slonconf.sgml	2 Feb 2007 20:24:16 -0000	1.16
***************
*** 437,440 ****
--- 437,451 ----
        </listitem>
      </varlistentry>
+     <varlistentry id="slon-config-remote-listen-timeout" xreflabel="slon_conf_remote_listen_timeout">
+       <term><varname>remote_listen_timeout</varname> (<type>integer</type>)</term>
+       <indexterm>
+         <primary><varname>remote_listen_timeout</varname> configuration parameter</primary>
+       </indexterm>
+       <listitem>
+         <para>How long should the remote listener wait before treating the event selection criteria as having timed out?
+           Range: [30-30000], default 300
+         </para>
+       </listitem>
+     </varlistentry>
    </variablelist>
  </sect1>

Index: faq.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/faq.sgml,v
retrieving revision 1.67
retrieving revision 1.68
diff -C2 -d -r1.67 -r1.68
*** faq.sgml	24 Oct 2006 14:47:43 -0000	1.67
--- faq.sgml	2 Feb 2007 20:24:16 -0000	1.68
***************
*** 999,1002 ****
--- 999,1035 ----
  </qandaentry>
  
+ <qandaentry>
+ <question><para> One of my nodes fell over (&lslon; / postmaster was
+ down) and nobody noticed for several days.  Now, when the &lslon; for
+ that node starts up, it runs for about five minutes, then terminates,
+ with the error message: <command>ERROR: remoteListenThread_%d: timeout
+ for event selection</command> What's wrong, and what do I do? </para> 
+ </question>
+ 
+ <answer><para> The problem is that the listener thread (in
+ <filename>src/slon/remote_listener.c</filename>) timed out when trying
+ to determine what events were outstanding for that node.  By default,
+ the query will run for five minutes; if there were many days worth of
+ outstanding events, this might take too long.
+  </para> </answer>
+ 
+ <answer><para> On  versions of &slony1; before 1.1.7, 1.2.7, and 1.3, one answer would be to increase the timeout in 
+ <filename>src/slon/remote_listener.c</filename>, recompile &lslon;, and retry.  </para> </answer>
+ 
+ <answer><para> Another would be to treat the node as having failed,
+ and use the &slonik; command <xref linkend="stmtdropnode"> to drop the
+ node, and recreate it.  If the database is heavily updated, it may
+ well be cheaper to do this than it is to find a way to let it catch
+ up.  </para> </answer>
+ 
+ <answer><para> In newer versions of &slony1;, there is a new
+ configuration parameter called <xref
+ linkend="slon-config-remote-listen-timeout">; you'd alter the config
+ file to increase the timeout, and try again.  Of course, as mentioned
+ above, it could be faster to drop the node and recreate it than to let
+ it catch up across a week's worth of updates...  </para> </answer>
+ 
+ </qandaentry>
+ 
  </qandadiv>
  <qandadiv id="faqperformance"> <title> &slony1; FAQ: Performance Issues </title>

Index: loganalysis.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/loganalysis.sgml,v
retrieving revision 1.6
retrieving revision 1.7
diff -C2 -d -r1.6 -r1.7
*** loganalysis.sgml	2 Jan 2007 20:16:58 -0000	1.6
--- loganalysis.sgml	2 Feb 2007 20:24:16 -0000	1.7
***************
*** 616,619 ****
--- 616,640 ----
  normally...</para></listitem>
  
+ <listitem><para><command>ERROR: remoteListenThread_%d: timeout for event selection</command></para>
+ 
+ <para> This means that the listener thread
+ (<filename>src/slon/remote_listener.c</filename>) timed out when
+ trying to determine what events were outstanding for it.</para>
+ 
+ <para> This could occur because network connections broke, in which case restarting the &lslon; might help. </para>
+ 
+ <para> Alternatively, this might occur because the &lslon; for this
+ node has been broken for a long time, and there are an enormous number
+ of entries in <envar>sl_event</envar> on this or other nodes for the
+ node to work through, and it is taking more than <xref
+ linkend="slon-config-remote-listen-timeout"> seconds to run the query.
+ In older versions of &slony1;, that configuration parameter did not
+ exist; the timeout was fixed at 300 seconds.  In newer versions, you
+ might increase that timeout in the &lslon; config file to a larger
+ value so that it can continue to completion.  And then investigate why
+ nobody was monitoring things such that replication broke for such a
+ long time... </para>
+ </listitem>
+ 
  <listitem><para><command>ERROR: remoteWorkerThread_%d: cannot connect to data provider %d on 'dsn'</command></para>
  


From cbbrowne at lists.slony.info  Fri Feb  2 12:24:18 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine/src/slon confoptions.c remote_listen.c
Message-ID: <20070202202418.A627E29044B@main>

Update of /home/cvsd/slony1/slony1-engine/src/slon
In directory main:/tmp/cvs-serv30460/src/slon

Modified Files:
	confoptions.c remote_listen.c 
Log Message:
Added a new conf file option for slon - remote_listen_timeout

This helps if you have a slon down for a Very Long Time so that sl_event
bloats and causes the query on it to time out.



Index: remote_listen.c
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/slon/remote_listen.c,v
retrieving revision 1.32
retrieving revision 1.33
diff -C2 -d -r1.32 -r1.33
*** remote_listen.c	27 Oct 2006 20:10:57 -0000	1.32
--- remote_listen.c	2 Feb 2007 20:24:16 -0000	1.33
***************
*** 64,67 ****
--- 64,68 ----
  
  extern char *lag_interval;
+ int remote_listen_timeout;
  
  /* ----------
***************
*** 731,735 ****
  	}
  	time(&timeout);
! 	timeout += 300;
  	while (PQisBusy(conn->dbconn) != 0)
  	{
--- 732,736 ----
  	}
  	time(&timeout);
! 	timeout += remote_listen_timeout;
  	while (PQisBusy(conn->dbconn) != 0)
  	{
***************
*** 738,743 ****
  		{
  			slon_log(SLON_ERROR,
! 					 "remoteListenThread_%d: timeout for event selection\n",
! 					 node->no_id);
  			dstring_free(&query);
  			return -1;
--- 739,744 ----
  		{
  			slon_log(SLON_ERROR,
! 				 "remoteListenThread_%d: timeout (%d s) for event selection\n",
! 				 node->no_id, remote_listen_timeout);
  			dstring_free(&query);
  			return -1;

Index: confoptions.c
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/slon/confoptions.c,v
retrieving revision 1.20
retrieving revision 1.21
diff -C2 -d -r1.20 -r1.21
*** confoptions.c	2 Jan 2007 20:16:58 -0000	1.20
--- confoptions.c	2 Feb 2007 20:24:16 -0000	1.21
***************
*** 678,681 ****
--- 678,696 ----
  		1073741824					/* max val */
  	},
+ 
+ 	{
+ 		{
+ 			(const char *)"remote_listen_timeout",		/* conf name */
+ 			gettext_noop("How long to wait, in seconds, before timeout when querying for remote events"),		/* short desc */
+ 			gettext_noop("How long to wait, in seconds, before timeout when querying for remote events"),		/* long desc */
+ 			SLON_C_INT			/* config type */
+ 		},
+ 		&remote_listen_timeout,			/* var name */
+ 		300,					/* default val */
+ 		30,					/* min val */
+ 		30000					/* max val */
+ 	},
+ 
+ 
  	{{0}}
  };


From cbbrowne at lists.slony.info  Fri Feb  2 14:21:21 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine/src/slon remote_worker.c
Message-ID: <20070202222121.275E129044A@main>

Update of /home/cvsd/slony1/slony1-engine/src/slon
In directory main:/tmp/cvs-serv30523

Modified Files:
      Tag: REL_1_2_STABLE
	remote_worker.c 
Log Message:
Bug #1623 - slon crashes if action list is Very Large because the 
huge, verbose action list blows up vsnprintf().

Changed debugging log levels for the "action list compression"-related
logging statements so that by default the gory detail is listed only
at levels 4/5.  Thus, you have to want to shoot yourself in the foot
in order to do so...


Index: remote_worker.c
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/slon/remote_worker.c,v
retrieving revision 1.124.2.8
retrieving revision 1.124.2.9
diff -C2 -d -r1.124.2.8 -r1.124.2.9
*** remote_worker.c	12 Dec 2006 20:13:19 -0000	1.124.2.8
--- remote_worker.c	2 Feb 2007 22:21:18 -0000	1.124.2.9
***************
*** 4349,4355 ****
  								 ssy_maxxid);
  			actionlist_len = strlen(ssy_action_list);
! 			slon_log(SLON_DEBUG2, " ssy_action_list value: %s length: %d\n",
! 					 ssy_action_list, actionlist_len);
! 
  			if (actionlist_len == 0)
  			{
--- 4349,4356 ----
  								 ssy_maxxid);
  			actionlist_len = strlen(ssy_action_list);
! 			slon_log(SLON_DEBUG4, " ssy_action_list value: %s\n",
! 					 ssy_action_list);
! 			slon_log(SLON_DEBUG2, " ssy_action_list length: %d\n",
! 					 actionlist_len);
  			if (actionlist_len == 0)
  			{
***************
*** 5858,5862 ****
  	slon_mkquery(action_subquery, " ");
  
! 	slon_log(SLON_DEBUG3, "compress_actionseq(list,subquery) Action list: %s\n", ssy_actionlist);
  	while (state != DONE)
  	{
--- 5859,5863 ----
  	slon_mkquery(action_subquery, " ");
  
! 	slon_log(SLON_DEBUG4, "compress_actionseq(list,subquery) Action list: %s\n", ssy_actionlist);
  	while (state != DONE)
  	{
***************
*** 5992,5996 ****
  				{
  					/* Finished another number... Fold it into the ranges... */
! 					slon_log(SLON_DEBUG4, "Finished number: %d\n", curr_number);
  
  					/*
--- 5993,5997 ----
  				{
  					/* Finished another number... Fold it into the ranges... */
! 					slon_log(SLON_DEBUG5, "Finished number: %d\n", curr_number);
  
  					/*
***************
*** 6043,6047 ****
  						if (curr_max == curr_min)
  						{
! 							slon_log(SLON_DEBUG4, "simple entry - %d\n", curr_max);
  							slon_appendquery(action_subquery,
  										" log_actionseq <> '%d' ", curr_max);
--- 6044,6048 ----
  						if (curr_max == curr_min)
  						{
! 							slon_log(SLON_DEBUG5, "simple entry - %d\n", curr_max);
  							slon_appendquery(action_subquery,
  										" log_actionseq <> '%d' ", curr_max);
***************
*** 6049,6053 ****
  						else
  						{
! 							slon_log(SLON_DEBUG4, "between entry - %d %d\n",
  									 curr_min, curr_max);
  							slon_appendquery(action_subquery,
--- 6050,6054 ----
  						else
  						{
! 							slon_log(SLON_DEBUG5, "between entry - %d %d\n",
  									 curr_min, curr_max);
  							slon_appendquery(action_subquery,
***************
*** 6078,6082 ****
  		if (curr_max == curr_min)
  		{
! 			slon_log(SLON_DEBUG4, "simple entry - %d\n", curr_max);
  			slon_appendquery(action_subquery,
  							 " log_actionseq <> '%d' ", curr_max);
--- 6079,6083 ----
  		if (curr_max == curr_min)
  		{
! 			slon_log(SLON_DEBUG5, "simple entry - %d\n", curr_max);
  			slon_appendquery(action_subquery,
  							 " log_actionseq <> '%d' ", curr_max);
***************
*** 6084,6088 ****
  		else
  		{
! 			slon_log(SLON_DEBUG4, "between entry - %d %d\n",
  					 curr_min, curr_max);
  			slon_appendquery(action_subquery,
--- 6085,6089 ----
  		else
  		{
! 			slon_log(SLON_DEBUG5, "between entry - %d %d\n",
  					 curr_min, curr_max);
  			slon_appendquery(action_subquery,
***************
*** 6093,6096 ****
  
  	}
! 	slon_log(SLON_DEBUG3, " compressed actionseq subquery... %s\n", dstring_data(action_subquery));
  }
--- 6094,6097 ----
  
  	}
! 	slon_log(SLON_DEBUG4, " compressed actionseq subquery... %s\n", dstring_data(action_subquery));
  }


From cbbrowne at lists.slony.info  Fri Feb  2 14:21:38 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine/src/slon remote_worker.c
Message-ID: <20070202222138.9138029044E@main>

Update of /home/cvsd/slony1/slony1-engine/src/slon
In directory main:/tmp/cvs-serv30541

Modified Files:
	remote_worker.c 
Log Message:
Bug #1623 - slon crashes if action list is Very Large because the
huge, verbose action list blows up vsnprintf().

Changed debugging log levels for the "action list compression"-related
logging statements so that by default the gory detail is listed only
at levels 4/5.  Thus, you have to want to shoot yourself in the foot
in order to do so...


Index: remote_worker.c
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/slon/remote_worker.c,v
retrieving revision 1.131
retrieving revision 1.132
diff -C2 -d -r1.131 -r1.132
*** remote_worker.c	12 Dec 2006 20:13:01 -0000	1.131
--- remote_worker.c	2 Feb 2007 22:21:36 -0000	1.132
***************
*** 4346,4352 ****
  								 ssy_maxxid);
  			actionlist_len = strlen(ssy_action_list);
! 			slon_log(SLON_DEBUG2, " ssy_action_list value: %s length: %d\n",
! 					 ssy_action_list, actionlist_len);
! 
  			if (actionlist_len == 0)
  			{
--- 4346,4353 ----
  								 ssy_maxxid);
  			actionlist_len = strlen(ssy_action_list);
! 			slon_log(SLON_DEBUG4, " ssy_action_list value: %s\n",
! 					 ssy_action_list);
! 			slon_log(SLON_DEBUG2, " ssy_action_list length: %d\n",
! 					 actionlist_len);
  			if (actionlist_len == 0)
  			{
***************
*** 5855,5859 ****
  	slon_mkquery(action_subquery, " ");
  
! 	slon_log(SLON_DEBUG3, "compress_actionseq(list,subquery) Action list: %s\n", ssy_actionlist);
  	while (state != DONE)
  	{
--- 5856,5860 ----
  	slon_mkquery(action_subquery, " ");
  
! 	slon_log(SLON_DEBUG4, "compress_actionseq(list,subquery) Action list: %s\n", ssy_actionlist);
  	while (state != DONE)
  	{
***************
*** 5989,5993 ****
  				{
  					/* Finished another number... Fold it into the ranges... */
! 					slon_log(SLON_DEBUG4, "Finished number: %d\n", curr_number);
  
  					/*
--- 5990,5994 ----
  				{
  					/* Finished another number... Fold it into the ranges... */
! 					slon_log(SLON_DEBUG5, "Finished number: %d\n", curr_number);
  
  					/*
***************
*** 6040,6044 ****
  						if (curr_max == curr_min)
  						{
! 							slon_log(SLON_DEBUG4, "simple entry - %d\n", curr_max);
  							slon_appendquery(action_subquery,
  										" log_actionseq <> '%d' ", curr_max);
--- 6041,6045 ----
  						if (curr_max == curr_min)
  						{
! 							slon_log(SLON_DEBUG5, "simple entry - %d\n", curr_max);
  							slon_appendquery(action_subquery,
  										" log_actionseq <> '%d' ", curr_max);
***************
*** 6046,6050 ****
  						else
  						{
! 							slon_log(SLON_DEBUG4, "between entry - %d %d\n",
  									 curr_min, curr_max);
  							slon_appendquery(action_subquery,
--- 6047,6051 ----
  						else
  						{
! 							slon_log(SLON_DEBUG5, "between entry - %d %d\n",
  									 curr_min, curr_max);
  							slon_appendquery(action_subquery,
***************
*** 6075,6079 ****
  		if (curr_max == curr_min)
  		{
! 			slon_log(SLON_DEBUG4, "simple entry - %d\n", curr_max);
  			slon_appendquery(action_subquery,
  							 " log_actionseq <> '%d' ", curr_max);
--- 6076,6080 ----
  		if (curr_max == curr_min)
  		{
! 			slon_log(SLON_DEBUG5, "simple entry - %d\n", curr_max);
  			slon_appendquery(action_subquery,
  							 " log_actionseq <> '%d' ", curr_max);
***************
*** 6081,6085 ****
  		else
  		{
! 			slon_log(SLON_DEBUG4, "between entry - %d %d\n",
  					 curr_min, curr_max);
  			slon_appendquery(action_subquery,
--- 6082,6086 ----
  		else
  		{
! 			slon_log(SLON_DEBUG5, "between entry - %d %d\n",
  					 curr_min, curr_max);
  			slon_appendquery(action_subquery,
***************
*** 6090,6093 ****
  
  	}
! 	slon_log(SLON_DEBUG3, " compressed actionseq subquery... %s\n", dstring_data(action_subquery));
  }
--- 6091,6094 ----
  
  	}
! 	slon_log(SLON_DEBUG4, " compressed actionseq subquery... %s\n", dstring_data(action_subquery));
  }


From cbbrowne at lists.slony.info  Fri Feb  2 14:23:18 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine RELEASE-1.2.7
Message-ID: <20070202222318.1B4E729044D@main>

Update of /home/cvsd/slony1/slony1-engine
In directory main:/tmp/cvs-serv30550

Modified Files:
      Tag: REL_1_2_STABLE
	RELEASE-1.2.7 
Log Message:
Bug #1623 in release notes


Index: RELEASE-1.2.7
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/Attic/RELEASE-1.2.7,v
retrieving revision 1.1.2.1
retrieving revision 1.1.2.2
diff -C2 -d -r1.1.2.1 -r1.1.2.2
*** RELEASE-1.2.7	2 Feb 2007 20:23:46 -0000	1.1.2.1
--- RELEASE-1.2.7	2 Feb 2007 22:23:16 -0000	1.1.2.2
***************
*** 6,7 ****
--- 6,13 ----
  sl_event if a node has been out of commission for a long time (several
  days)
+ 
+ - Resolve bug #1623
+ 
+ In this bug, big "action lists" that need to get compressed could cause
+ a logging printf to blow up.  Changed the logging level so that detail
+ is only shown at levels 4/5, which won't bite people by default.


From cbbrowne at lists.slony.info  Mon Feb  5 14:03:32 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine/src/slonik slonik.c
Message-ID: <20070205220333.0840D290458@main>

Update of /home/cvsd/slony1/slony1-engine/src/slonik
In directory main:/tmp/cvs-serv3290/src/slonik

Modified Files:
      Tag: REL_1_1_STABLE
	slonik.c 
Log Message:
Per change committed to HEAD on Jan 30th, this applies to the 1.1 branch
This addresses the problem where a slonik requests UNINSTALL NODE
breaks. 

Report in the error message which node it was working on. That way the
gentle user gets an indication as to which node 'broke' if the slonik
script contained multiple such requests.


Index: slonik.c
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/slonik/slonik.c,v
retrieving revision 1.42.2.6
retrieving revision 1.42.2.7
diff -C2 -d -r1.42.2.6 -r1.42.2.7
*** slonik.c	31 Oct 2006 22:17:25 -0000	1.42.2.6
--- slonik.c	5 Feb 2007 22:03:30 -0000	1.42.2.7
***************
*** 3029,3032 ****
--- 3029,3033 ----
  	if (db_exec_command((SlonikStmt *) stmt, adminfo1, &query) < 0)
  	{
+ 		printf("Failed to exec uninstallNode() for node %d\n", stmt->no_id);
  		dstring_free(&query);
  		return -1;
***************
*** 3034,3037 ****
--- 3035,3039 ----
  	if (db_commit_xact((SlonikStmt *) stmt, adminfo1) < 0)
  	{
+ 		printf("Failed to commit uninstallNode() for node %d\n", stmt->no_id);
  		dstring_free(&query);
  		return -1;
***************
*** 3043,3046 ****
--- 3045,3049 ----
  	if (db_exec_command((SlonikStmt *) stmt, adminfo1, &query) < 0)
  	{
+ 		printf("Failed to drop schema for node %d\n", stmt->no_id);
  		dstring_free(&query);
  		return -1;
***************
*** 3048,3051 ****
--- 3051,3055 ----
  	if (db_commit_xact((SlonikStmt *) stmt, adminfo1) < 0)
  	{
+ 		printf("Failed to commit drop schema for node %d\n", stmt->no_id);
  		dstring_free(&query);
  		return -1;


From cbbrowne at lists.slony.info  Mon Feb  5 14:03:32 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine RELEASE-1.1.7
Message-ID: <20070205220332.DE4132903A1@main>

Update of /home/cvsd/slony1/slony1-engine
In directory main:/tmp/cvs-serv3290

Modified Files:
      Tag: REL_1_1_STABLE
	RELEASE-1.1.7 
Log Message:
Per change committed to HEAD on Jan 30th, this applies to the 1.1 branch
This addresses the problem where a slonik requests UNINSTALL NODE
breaks. 

Report in the error message which node it was working on. That way the
gentle user gets an indication as to which node 'broke' if the slonik
script contained multiple such requests.


Index: RELEASE-1.1.7
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/Attic/RELEASE-1.1.7,v
retrieving revision 1.1.2.1
retrieving revision 1.1.2.2
diff -C2 -d -r1.1.2.1 -r1.1.2.2
*** RELEASE-1.1.7	2 Feb 2007 20:22:59 -0000	1.1.2.1
--- RELEASE-1.1.7	5 Feb 2007 22:03:30 -0000	1.1.2.2
***************
*** 6,7 ****
--- 6,14 ----
  sl_event if a node has been out of commission for a long time (several
  days)
+ 
+ - Add node numbers to error reports in slonik
+ 
+ If portions of UNINSTALL NODE break, report in the error message which node
+ it was working on.  That way the gentle user gets an indication as to 
+ which node 'broke' if the slonik script contained multiple such
+ requests.


From cbbrowne at lists.slony.info  Mon Feb  5 14:06:55 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine RELEASE-1.2.7
Message-ID: <20070205220655.0F4EB290444@main>

Update of /home/cvsd/slony1/slony1-engine
In directory main:/tmp/cvs-serv3327

Modified Files:
      Tag: REL_1_2_STABLE
	RELEASE-1.2.7 
Log Message:
Per change committed to HEAD on Jan 30th, this applies to the 1.2 branch

This addresses the problem where a slonik requests UNINSTALL NODE
and this breaks. 

Report in the error message which node it was working on. That way the
gentle user gets an indication as to which node 'broke' if the slonik
script contained multiple such UNINSTALL NODE requests.



Index: RELEASE-1.2.7
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/Attic/RELEASE-1.2.7,v
retrieving revision 1.1.2.2
retrieving revision 1.1.2.3
diff -C2 -d -r1.1.2.2 -r1.1.2.3
*** RELEASE-1.2.7	2 Feb 2007 22:23:16 -0000	1.1.2.2
--- RELEASE-1.2.7	5 Feb 2007 22:06:52 -0000	1.1.2.3
***************
*** 12,13 ****
--- 12,19 ----
  a logging printf to blow up.  Changed the logging level so that detail
  is only shown at levels 4/5, which won't bite people by default.
+ 
+ - UNINSTALL NODE failures now show node # in slonik error messages
+ 
+ If a user ran several UNINSTALL NODE requests in a single slonik
+ script, and one of them broke, you'd have no ready way to tell which
+ node this failed on.  Added code to report the node # where it failed.


From cbbrowne at lists.slony.info  Mon Feb  5 14:06:55 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine/src/slonik slonik.c
Message-ID: <20070205220655.321D3290458@main>

Update of /home/cvsd/slony1/slony1-engine/src/slonik
In directory main:/tmp/cvs-serv3327/src/slonik

Modified Files:
      Tag: REL_1_2_STABLE
	slonik.c 
Log Message:
Per change committed to HEAD on Jan 30th, this applies to the 1.2 branch

This addresses the problem where a slonik requests UNINSTALL NODE
and this breaks. 

Report in the error message which node it was working on. That way the
gentle user gets an indication as to which node 'broke' if the slonik
script contained multiple such UNINSTALL NODE requests.



Index: slonik.c
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/slonik/slonik.c,v
retrieving revision 1.67.2.3
retrieving revision 1.67.2.4
diff -C2 -d -r1.67.2.3 -r1.67.2.4
*** slonik.c	12 Dec 2006 14:52:59 -0000	1.67.2.3
--- slonik.c	5 Feb 2007 22:06:53 -0000	1.67.2.4
***************
*** 3035,3038 ****
--- 3035,3039 ----
  	if (db_exec_command((SlonikStmt *) stmt, adminfo1, &query) < 0)
  	{
+ 		printf("Failed to exec uninstallNode() for node %d\n", stmt->no_id);
  		dstring_free(&query);
  		return -1;
***************
*** 3040,3043 ****
--- 3041,3045 ----
  	if (db_commit_xact((SlonikStmt *) stmt, adminfo1) < 0)
  	{
+ 		printf("Failed to commit uninstallNode() for node %d\n", stmt->no_id);
  		dstring_free(&query);
  		return -1;
***************
*** 3049,3052 ****
--- 3051,3055 ----
  	if (db_exec_command((SlonikStmt *) stmt, adminfo1, &query) < 0)
  	{
+ 		printf("Failed to drop schema for node %d\n", stmt->no_id);
  		dstring_free(&query);
  		return -1;
***************
*** 3054,3057 ****
--- 3057,3061 ----
  	if (db_commit_xact((SlonikStmt *) stmt, adminfo1) < 0)
  	{
+ 		printf("Failed to commit drop schema for node %d\n", stmt->no_id);
  		dstring_free(&query);
  		return -1;


From cbbrowne at lists.slony.info  Mon Feb  5 14:18:08 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine/src/backend slony1_funcs.sql
Message-ID: <20070205221808.9A38529045B@main>

Update of /home/cvsd/slony1/slony1-engine/src/backend
In directory main:/tmp/cvs-serv3368/src/backend

Modified Files:
      Tag: REL_1_1_STABLE
	slony1_funcs.sql 
Log Message:
Apply bug fix for #1538 to 1.1 branch (already in place in 1.2, HEAD).

This is for the case where a cluster only has one node; in that case,
the cleanup loop wouldn't clear out old events and would never clear
sl_log_[12] until you added a node back in.


Index: slony1_funcs.sql
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/backend/slony1_funcs.sql,v
retrieving revision 1.64.2.19
retrieving revision 1.64.2.20
diff -C2 -d -r1.64.2.19 -r1.64.2.20
*** slony1_funcs.sql	1 Nov 2006 22:13:05 -0000	1.64.2.19
--- slony1_funcs.sql	5 Feb 2007 22:18:06 -0000	1.64.2.20
***************
*** 4285,4288 ****
--- 4285,4307 ----
  
  	-- ----
+ 	-- If cluster has only one node, then remove all events up to
+ 	-- the last SYNC - Bug #1538
+ 	-- http://gborg.postgresql.org/project/slony1/bugs/bugupdate.php?1538
+ 	-- ----
+ 
+ 	select * into v_min_row from @NAMESPACE@.sl_node where
+ 			no_id <> @NAMESPACE@.getLocalNodeId(''_@CLUSTERNAME@'') limit 1;
+ 	if not found then
+ 		select ev_origin, ev_seqno into v_min_row from @NAMESPACE@.sl_event
+ 		where ev_origin = @NAMESPACE@.getLocalNodeId(''_@CLUSTERNAME@'')
+ 		order by ev_origin desc, ev_seqno desc limit 1;
+ 		raise notice ''Slony-I: cleanupEvent(): Single node - deleting events < %'', v_min_row.ev_seqno;
+ 			delete from @NAMESPACE@.sl_event
+ 			where
+ 				ev_origin = v_min_row.ev_origin and
+ 				ev_seqno < v_min_row.ev_seqno;
+ 
+ 	end if;
+ 	-- ----
  	-- Also remove stale entries from the nodelock table.
  	-- ----


From cbbrowne at lists.slony.info  Mon Feb  5 14:18:08 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine RELEASE-1.1.7
Message-ID: <20070205221808.7A50D29045A@main>

Update of /home/cvsd/slony1/slony1-engine
In directory main:/tmp/cvs-serv3368

Modified Files:
      Tag: REL_1_1_STABLE
	RELEASE-1.1.7 
Log Message:
Apply bug fix for #1538 to 1.1 branch (already in place in 1.2, HEAD).

This is for the case where a cluster only has one node; in that case,
the cleanup loop wouldn't clear out old events and would never clear
sl_log_[12] until you added a node back in.


Index: RELEASE-1.1.7
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/Attic/RELEASE-1.1.7,v
retrieving revision 1.1.2.2
retrieving revision 1.1.2.3
diff -C2 -d -r1.1.2.2 -r1.1.2.3
*** RELEASE-1.1.7	5 Feb 2007 22:03:30 -0000	1.1.2.2
--- RELEASE-1.1.7	5 Feb 2007 22:18:06 -0000	1.1.2.3
***************
*** 13,14 ****
--- 13,21 ----
  which node 'broke' if the slonik script contained multiple such
  requests.
+ 
+ - Applied bug fix for #1538
+ 
+ If cluster has only one node, then remove all events up to the last
+ SYNC.  That allows the cleanup loop to clear out sl_log_{1/2}.
+ Otherwise, the log tables will forever bloat until you add a second
+ node...


From cbbrowne at lists.slony.info  Tue Feb  6 08:00:43 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine/tests/test1 generate_dml.sh
Message-ID: <20070206160043.4482829038D@main>

Update of /home/cvsd/slony1/slony1-engine/tests/test1
In directory main:/tmp/cvs-serv3897/test1

Modified Files:
      Tag: REL_1_1_STABLE
	generate_dml.sh 
Log Message:
Add a test for "generate_sync_event()" function to test1


Index: generate_dml.sh
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tests/test1/generate_dml.sh,v
retrieving revision 1.4.2.3
retrieving revision 1.4.2.4
diff -C2 -d -r1.4.2.3 -r1.4.2.4
*** generate_dml.sh	27 Oct 2006 14:41:25 -0000	1.4.2.3
--- generate_dml.sh	6 Feb 2007 16:00:41 -0000	1.4.2.4
***************
*** 71,74 ****
--- 71,81 ----
      warn 3 "do_initdata failed, see $mktmp/initdata.log for details"
    fi 
+   status "data load complete"
+ 
+   $pgbindir/psql -h $host -p $port -d $db -U $user -c "select \"_${CLUSTER1}\".generate_sync_event('1 second'::interval);" 1> $mktmp/gensync.log.1 2> $mktmp/gensync.log
+   rc=$?
+   if [ $rc -ne 0 ]; then
+       warn 3 "generate_sync_event() failed - rc=${rc} see $mktmp/gensync.log* for details"
+   fi
    status "done"
  }


From cbbrowne at lists.slony.info  Tue Feb  6 08:01:23 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine/tests/test1 generate_dml.sh
Message-ID: <20070206160123.CC10329045C@main>

Update of /home/cvsd/slony1/slony1-engine/tests/test1
In directory main:/tmp/cvs-serv3921/test1

Modified Files:
      Tag: REL_1_2_STABLE
	generate_dml.sh 
Log Message:
Add test for generate_sync_event() function to test1


Index: generate_dml.sh
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tests/test1/generate_dml.sh,v
retrieving revision 1.8.2.1
retrieving revision 1.8.2.2
diff -C2 -d -r1.8.2.1 -r1.8.2.2
*** generate_dml.sh	27 Oct 2006 14:40:20 -0000	1.8.2.1
--- generate_dml.sh	6 Feb 2007 16:01:21 -0000	1.8.2.2
***************
*** 75,78 ****
--- 75,85 ----
      warn 3 "do_initdata failed, see $mktmp/initdata.log for details"
    fi 
+   status "data load complete"
+ 
+   $pgbindir/psql -h $host -p $port -d $db -U $user -c "select \"_${CLUSTER1}\".generate_sync_event('1 second'::interval);" 1> $mktmp/gensync.log.1 2> $mktmp/gensync.log
+   rc=$?
+   if [ $rc -ne 0 ]; then
+       warn 3 "generate_sync_event() failed - rc=${rc} see $mktmp/gensync.log* for details"
+   fi
    status "done"
  }


From cbbrowne at lists.slony.info  Tue Feb  6 08:01:40 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine/tests/test1 generate_dml.sh
Message-ID: <20070206160140.DF75729045A@main>

Update of /home/cvsd/slony1/slony1-engine/tests/test1
In directory main:/tmp/cvs-serv3931/test1

Modified Files:
	generate_dml.sh 
Log Message:
Add test for generate_sync_event() function to test1


Index: generate_dml.sh
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tests/test1/generate_dml.sh,v
retrieving revision 1.9
retrieving revision 1.10
diff -C2 -d -r1.9 -r1.10
*** generate_dml.sh	27 Oct 2006 14:45:51 -0000	1.9
--- generate_dml.sh	6 Feb 2007 16:01:38 -0000	1.10
***************
*** 75,78 ****
--- 75,85 ----
      warn 3 "do_initdata failed, see $mktmp/initdata.log for details"
    fi 
+   status "data load complete"
+ 
+   $pgbindir/psql -h $host -p $port -d $db -U $user -c "select \"_${CLUSTER1}\".generate_sync_event('1 second'::interval);" 1> $mktmp/gensync.log.1 2> $mktmp/gensync.log
+   rc=$?
+   if [ $rc -ne 0 ]; then
+       warn 3 "generate_sync_event() failed - rc=${rc} see $mktmp/gensync.log* for details"
+   fi
    status "done"
  }


From cbbrowne at lists.slony.info  Tue Feb  6 13:03:13 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine/src/slon remote_worker.c
Message-ID: <20070206210313.82703290318@main>

Update of /home/cvsd/slony1/slony1-engine/src/slon
In directory main:/tmp/cvs-serv6778

Modified Files:
	remote_worker.c 
Log Message:
Changed some SLON_DEBUG5 (not valid) to SLON_DEBUG4


Index: remote_worker.c
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/slon/remote_worker.c,v
retrieving revision 1.132
retrieving revision 1.133
diff -C2 -d -r1.132 -r1.133
*** remote_worker.c	2 Feb 2007 22:21:36 -0000	1.132
--- remote_worker.c	6 Feb 2007 21:03:11 -0000	1.133
***************
*** 5990,5994 ****
  				{
  					/* Finished another number... Fold it into the ranges... */
! 					slon_log(SLON_DEBUG5, "Finished number: %d\n", curr_number);
  
  					/*
--- 5990,5994 ----
  				{
  					/* Finished another number... Fold it into the ranges... */
! 					slon_log(SLON_DEBUG4, "Finished number: %d\n", curr_number);
  
  					/*
***************
*** 6041,6045 ****
  						if (curr_max == curr_min)
  						{
! 							slon_log(SLON_DEBUG5, "simple entry - %d\n", curr_max);
  							slon_appendquery(action_subquery,
  										" log_actionseq <> '%d' ", curr_max);
--- 6041,6045 ----
  						if (curr_max == curr_min)
  						{
! 							slon_log(SLON_DEBUG4, "simple entry - %d\n", curr_max);
  							slon_appendquery(action_subquery,
  										" log_actionseq <> '%d' ", curr_max);
***************
*** 6047,6051 ****
  						else
  						{
! 							slon_log(SLON_DEBUG5, "between entry - %d %d\n",
  									 curr_min, curr_max);
  							slon_appendquery(action_subquery,
--- 6047,6051 ----
  						else
  						{
! 							slon_log(SLON_DEBUG4, "between entry - %d %d\n",
  									 curr_min, curr_max);
  							slon_appendquery(action_subquery,
***************
*** 6076,6080 ****
  		if (curr_max == curr_min)
  		{
! 			slon_log(SLON_DEBUG5, "simple entry - %d\n", curr_max);
  			slon_appendquery(action_subquery,
  							 " log_actionseq <> '%d' ", curr_max);
--- 6076,6080 ----
  		if (curr_max == curr_min)
  		{
! 			slon_log(SLON_DEBUG4, "simple entry - %d\n", curr_max);
  			slon_appendquery(action_subquery,
  							 " log_actionseq <> '%d' ", curr_max);
***************
*** 6082,6086 ****
  		else
  		{
! 			slon_log(SLON_DEBUG5, "between entry - %d %d\n",
  					 curr_min, curr_max);
  			slon_appendquery(action_subquery,
--- 6082,6086 ----
  		else
  		{
! 			slon_log(SLON_DEBUG4, "between entry - %d %d\n",
  					 curr_min, curr_max);
  			slon_appendquery(action_subquery,


From cbbrowne at lists.slony.info  Tue Feb  6 13:04:29 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine/src/slon confoptions.h
Message-ID: <20070206210429.48CD5290450@main>

Update of /home/cvsd/slony1/slony1-engine/src/slon
In directory main:/tmp/cvs-serv6803

Modified Files:
	confoptions.h 
Log Message:
Needed to add external reference for new timeout parameter
extern int remote_listen_timeout;


Index: confoptions.h
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/slon/confoptions.h,v
retrieving revision 1.32
retrieving revision 1.33
diff -C2 -d -r1.32 -r1.33
*** confoptions.h	27 Oct 2006 20:10:57 -0000	1.32
--- confoptions.h	6 Feb 2007 21:04:27 -0000	1.33
***************
*** 21,24 ****
--- 21,25 ----
  extern int	sync_max_rowsize;
  extern int	sync_max_largemem;
+ extern int remote_listen_timeout;
  
  extern int	sync_group_maxsize;


From cbbrowne at lists.slony.info  Wed Feb  7 11:13:19 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine/tests/test1 README generate_dml.sh
Message-ID: <20070207191319.E1EB22903E0@main>

Update of /home/cvsd/slony1/slony1-engine/tests/test1
In directory main:/tmp/cvs-serv8122

Modified Files:
	README generate_dml.sh 
Log Message:
Add tests of functions generate_sync_event() and make_function_strict()


Index: README
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tests/test1/README,v
retrieving revision 1.6
retrieving revision 1.7
diff -C2 -d -r1.6 -r1.7
*** README	27 Oct 2006 14:45:51 -0000	1.6
--- README	7 Feb 2007 19:13:17 -0000	1.7
***************
*** 24,25 ****
--- 24,31 ----
  exercise that points, paths, bitmaps, mac addresses, and inet types
  replicate properly.
+ 
+ 6.  It does a test of the function generate_sync_event() to make sure
+ that it works as expected
+ 
+ 7.  It does a test of make_function_strict(), a function used in
+ 'UPDATE FUNCTIONS' to change the xxidin() function to be STRICT.

Index: generate_dml.sh
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tests/test1/generate_dml.sh,v
retrieving revision 1.10
retrieving revision 1.11
diff -C2 -d -r1.10 -r1.11
*** generate_dml.sh	6 Feb 2007 16:01:38 -0000	1.10
--- generate_dml.sh	7 Feb 2007 19:13:17 -0000	1.11
***************
*** 82,85 ****
--- 82,90 ----
        warn 3 "generate_sync_event() failed - rc=${rc} see $mktmp/gensync.log* for details"
    fi
+   $pgbindir/psql -h $host -p $port -d $db -U $user -c "select \"_${CLUSTER1}\".make_function_strict('xxidin', '(cstring)');" 1> $mktmp/gensync.log.1 2> $mktmp/gensync.log
+   rc=$?
+   if [ $rc -ne 0 ]; then
+       warn 3 "make_function_strict('xxidin', '(cstring)') failed - rc=${rc} see $mktmp/gensync.log* for details"
+   fi
    status "done"
  }


From cbbrowne at lists.slony.info  Wed Feb  7 11:13:55 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine/tests/test1 README generate_dml.sh
Message-ID: <20070207191355.37ADE290286@main>

Update of /home/cvsd/slony1/slony1-engine/tests/test1
In directory main:/tmp/cvs-serv8149/test1

Modified Files:
      Tag: REL_1_2_STABLE
	README generate_dml.sh 
Log Message:
Add tests of functions generate_sync_event() and make_function_strict()


Index: README
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tests/test1/README,v
retrieving revision 1.5
retrieving revision 1.5.2.1
diff -C2 -d -r1.5 -r1.5.2.1
*** README	4 Aug 2006 20:06:24 -0000	1.5
--- README	7 Feb 2007 19:13:53 -0000	1.5.2.1
***************
*** 3,9 ****
  test1 is a basic test that replication generally functions.  
    
! It doesn't try to do anything too terribly fancy: It creates three
! simple tables as one replication set, and replicates them from one
! database to another.
    
  The three tables are of the three interesting types:
--- 3,8 ----
  test1 is a basic test that replication generally functions.  
    
! It creates three simple tables as one replication set, and replicates
! them from one database to another.
    
  The three tables are of the three interesting types:
***************
*** 25,26 ****
--- 24,31 ----
  exercise that points, paths, bitmaps, mac addresses, and inet types
  replicate properly.
+ 
+ 6.  It does a test of the function generate_sync_event() to make sure
+ that it works as expected
+ 
+ 7.  It does a test of make_function_strict(), a function used in
+ 'UPDATE FUNCTIONS' to change the xxidin() function to be STRICT.

Index: generate_dml.sh
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tests/test1/generate_dml.sh,v
retrieving revision 1.8.2.2
retrieving revision 1.8.2.3
diff -C2 -d -r1.8.2.2 -r1.8.2.3
*** generate_dml.sh	6 Feb 2007 16:01:21 -0000	1.8.2.2
--- generate_dml.sh	7 Feb 2007 19:13:53 -0000	1.8.2.3
***************
*** 82,85 ****
--- 82,90 ----
        warn 3 "generate_sync_event() failed - rc=${rc} see $mktmp/gensync.log* for details"
    fi
+   $pgbindir/psql -h $host -p $port -d $db -U $user -c "select \"_${CLUSTER1}\".make_function_strict('xxidin', '(cstring)');" 1> $mktmp/gensync.log.1 2> $mktmp/gensync.log
+   rc=$?
+   if [ $rc -ne 0 ]; then
+       warn 3 "make_function_strict('xxidin', '(cstring)') failed - rc=${rc} see $mktmp/gensync.log* for details"
+   fi
    status "done"
  }


From cbbrowne at lists.slony.info  Wed Feb  7 11:16:05 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine/tests/test1 README generate_dml.sh
Message-ID: <20070207191605.104FA2903FB@main>

Update of /home/cvsd/slony1/slony1-engine/tests/test1
In directory main:/tmp/cvs-serv8189

Modified Files:
      Tag: REL_1_1_STABLE
	README generate_dml.sh 
Log Message:
Add tests of functions generate_sync_event() and make_function_strict()


Index: README
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tests/test1/README,v
retrieving revision 1.1.2.1
retrieving revision 1.1.2.2
diff -C2 -d -r1.1.2.1 -r1.1.2.2
*** README	30 Nov 2005 17:35:23 -0000	1.1.2.1
--- README	7 Feb 2007 19:16:02 -0000	1.1.2.2
***************
*** 1,5 ****
  $Id$
! 
! test1 is a basic test that replication generally functions.  It
! creates three simple tables as one replication set, and replicates
  them from one database to another.
--- 1,31 ----
  $Id$
!   
! test1 is a basic test that replication generally functions.  
!   
! It creates three simple tables as one replication set, and replicates
  them from one database to another.
+   
+ The three tables are of the three interesting types:
+   
+ 1.  table1 has a formal primary key
+ 
+ 2.  table2 lacks a formal primary key, but has a candidate primary key
+ 
+ 3.  table3 has no candidate primary key; Slony-I is expected to
+     generate one on its own.
+ 
+ It actually tries replicating a fourth table, which has an invalid
+ candidate primary key (columns not defined NOT NULL), which should
+ cause it to be rejected.  That is done in a slonik TRY {} block.
+ 
+ It also creates...
+ 
+ 5.  table5 which has columns of all sorts of vaguely esoteric types to
+ exercise that points, paths, bitmaps, mac addresses, and inet types
+ replicate properly.
+ 
+ 6.  It does a test of the function generate_sync_event() to make sure
+ that it works as expected
+ 
+ 7.  It does a test of make_function_strict(), a function used in
+ 'UPDATE FUNCTIONS' to change the xxidin() function to be STRICT.

Index: generate_dml.sh
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tests/test1/generate_dml.sh,v
retrieving revision 1.4.2.4
retrieving revision 1.4.2.5
diff -C2 -d -r1.4.2.4 -r1.4.2.5
*** generate_dml.sh	6 Feb 2007 16:00:41 -0000	1.4.2.4
--- generate_dml.sh	7 Feb 2007 19:16:02 -0000	1.4.2.5
***************
*** 31,34 ****
--- 31,35 ----
    percent=`expr $j \* 5`
    status "$percent %"
+   GENDATA="$mktmp/generate.data"
    while : ; do
      txtalen=$(random_number 1 100)
***************
*** 38,45 ****
      txtb=$(random_string ${txtblen})
      txtb=`echo ${txtb} | sed -e "s/\\\\\\\/\\\\\\\\\\\\\\/g" -e "s/'/''/g"`
!     GENDATA="$mktmp/generate.data"
      echo "INSERT INTO table1(data) VALUES ('${txta}');" >> $GENDATA
      echo "INSERT INTO table2(table1_id,data) SELECT id, '${txtb}' FROM table1 WHERE data='${txta}';" >> $GENDATA
      echo "INSERT INTO table3(table2_id) SELECT id FROM table2 WHERE data ='${txtb}';" >> $GENDATA
      if [ ${i} -ge ${numrows} ]; then
        break;
--- 39,49 ----
      txtb=$(random_string ${txtblen})
      txtb=`echo ${txtb} | sed -e "s/\\\\\\\/\\\\\\\\\\\\\\/g" -e "s/'/''/g"`
!     ra=$(random_number 1 9)
!     rb=$(random_number 1 9)
!     rc=$(random_number 1 9)
      echo "INSERT INTO table1(data) VALUES ('${txta}');" >> $GENDATA
      echo "INSERT INTO table2(table1_id,data) SELECT id, '${txtb}' FROM table1 WHERE data='${txta}';" >> $GENDATA
      echo "INSERT INTO table3(table2_id) SELECT id FROM table2 WHERE data ='${txtb}';" >> $GENDATA
+     echo "INSERT INTO table5(numcol,realcol,ptcol,pathcol,polycol,circcol,ipcol,maccol,bitcol) values ('${ra}${rb}.${rc}','${ra}.${rb}${rc}','(${ra},${rb})','((${ra},${ra}),(${rb},${rb}),(${rc},${rc}),(${ra},${rc}))','((${ra},${rb}),(${rc},${ra}),(${rb},${rc}),(${rc},${rb}))','<(${ra},${rb}),${rc}>','192.168.${ra}.${rb}${rc}','08:00:2d:0${ra}:0${rb}:0${rc}',X'${ra}${rb}${rc}');" >> $GENDATA
      if [ ${i} -ge ${numrows} ]; then
        break;
***************
*** 59,65 ****
  do_initdata()
  {
!    originnode=${ORIGINNODE:-"1"}
    eval db=\$DB${originnode}
!    eval host=\$HOST${originnode}
    eval user=\$USER${originnode}
    eval port=\$PORT${originnode}
--- 63,69 ----
  do_initdata()
  {
!   originnode=${ORIGINNODE:-"1"}
    eval db=\$DB${originnode}
!   eval host=\$HOST${originnode}
    eval user=\$USER${originnode}
    eval port=\$PORT${originnode}
***************
*** 78,81 ****
--- 82,90 ----
        warn 3 "generate_sync_event() failed - rc=${rc} see $mktmp/gensync.log* for details"
    fi
+   $pgbindir/psql -h $host -p $port -d $db -U $user -c "select \"_${CLUSTER1}\".make_function_strict('xxidin', '(cstring)');" 1> $mktmp/gensync.log.1 2> $mktmp/gensync.log
+   rc=$?
+   if [ $rc -ne 0 ]; then
+       warn 3 "make_function_strict('xxidin', '(cstring)') failed - rc=${rc} see $mktmp/gensync.log* for details"
+   fi
    status "done"
  }


From cbbrowne at lists.slony.info  Wed Feb  7 11:17:52 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine/src/xxid Makefile
Message-ID: <20070207191752.983342903FE@main>

Update of /home/cvsd/slony1/slony1-engine/src/xxid
In directory main:/tmp/cvs-serv8214

Modified Files:
	Makefile 
Log Message:
xxid now needs to have a PG version 8.1 SQL script


Index: Makefile
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/xxid/Makefile,v
retrieving revision 1.26
retrieving revision 1.27
diff -C2 -d -r1.26 -r1.27
*** Makefile	24 Jan 2007 15:59:45 -0000	1.26
--- Makefile	7 Feb 2007 19:17:50 -0000	1.27
***************
*** 20,24 ****
  SQL_NAME74	= $(NAME).v74.sql
  SQL_NAME80	= $(NAME).v80.sql
! SQL_NAMES	= $(SQL_NAME74) $(SQL_NAME80)
  GENSQLNAMES = $(filter-out $(SQL_NAME74), $(SQL_NAMES))
  
--- 20,25 ----
  SQL_NAME74	= $(NAME).v74.sql
  SQL_NAME80	= $(NAME).v80.sql
! SQL_NAME81	= $(NAME).v81.sql
! SQL_NAMES	= $(SQL_NAME74) $(SQL_NAME80) $(SQL_NAME81)
  GENSQLNAMES = $(filter-out $(SQL_NAME74), $(SQL_NAMES))
  
***************
*** 36,39 ****
--- 37,43 ----
  	cp $< $@
  
+ $(SQL_NAME81):	$(SQL_NAME80)
+ 	cp $< $@
+ 
  $(SO_NAME):     $(SO_OBJS) $(POSTGRES_IMP)
  


From cbbrowne at lists.slony.info  Wed Feb  7 11:18:22 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine/src/xxid Makefile
Message-ID: <20070207191822.C150329040E@main>

Update of /home/cvsd/slony1/slony1-engine/src/xxid
In directory main:/tmp/cvs-serv8231

Modified Files:
      Tag: REL_1_2_STABLE
	Makefile 
Log Message:
xxid now needs to have a PG version 8.1 SQL script

Index: Makefile
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/xxid/Makefile,v
retrieving revision 1.20.2.3
retrieving revision 1.20.2.4
diff -C2 -d -r1.20.2.3 -r1.20.2.4
*** Makefile	14 Dec 2006 15:42:56 -0000	1.20.2.3
--- Makefile	7 Feb 2007 19:18:20 -0000	1.20.2.4
***************
*** 20,24 ****
  SQL_NAME74	= $(NAME).v74.sql
  SQL_NAME80	= $(NAME).v80.sql
! SQL_NAMES	= $(SQL_NAME80)
  
  SO_OBJS		= xxid.o $(WIN32RES)
--- 20,26 ----
  SQL_NAME74	= $(NAME).v74.sql
  SQL_NAME80	= $(NAME).v80.sql
! SQL_NAME81	= $(NAME).v81.sql
! SQL_NAMES	= $(SQL_NAME74) $(SQL_NAME80) $(SQL_NAME81)
! GENSQLNAMES = $(filter-out $(SQL_NAME74), $(SQL_NAMES))
  
  SO_OBJS		= xxid.o $(WIN32RES)
***************
*** 35,43 ****
  	cp $< $@
  
  $(SO_NAME):     $(SO_OBJS) $(POSTGRES_IMP)
  
  clean distclean maintainer-clean:
  	rm -f $(SO_NAME) $(SO_OBJS)
! 	rm -f $(SQL_NAMES)
  
  install: all installdirs
--- 37,48 ----
  	cp $< $@
  
+ $(SQL_NAME81):	$(SQL_NAME80)
+ 	cp $< $@
+ 
  $(SO_NAME):     $(SO_OBJS) $(POSTGRES_IMP)
  
  clean distclean maintainer-clean:
  	rm -f $(SO_NAME) $(SO_OBJS)
! 	rm -f $(GENSQLNAMES)
  
  install: all installdirs
***************
*** 64,65 ****
--- 69,73 ----
  	$(MKLDEXPORT) $(pgbindir)/postgres > $@
  endif
+ 
+ splint:
+ 	splint -I $(pgincludedir) -I $(pgincludeserverdir) +unixlib -preproc +skip-sys-headers xxid.c


From cbbrowne at lists.slony.info  Wed Feb  7 11:18:51 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine/src/xxid Makefile
Message-ID: <20070207191851.1167A29045E@main>

Update of /home/cvsd/slony1/slony1-engine/src/xxid
In directory main:/tmp/cvs-serv8240

Modified Files:
      Tag: REL_1_1_STABLE
	Makefile 
Log Message:
xxid now needs to have a PG version 8.1 SQL script

Index: Makefile
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/xxid/Makefile,v
retrieving revision 1.17.2.1
retrieving revision 1.17.2.2
diff -C2 -d -r1.17.2.1 -r1.17.2.2
*** Makefile	10 Nov 2005 23:39:36 -0000	1.17.2.1
--- Makefile	7 Feb 2007 19:18:49 -0000	1.17.2.2
***************
*** 10,13 ****
--- 10,15 ----
  slony_subdir = src/xxid
  slony_top_builddir = ../..
+ SLFILEDESC = "Slony xxid datatype"
+ SO_NAME		= $(NAME)$(DLSUFFIX)
  include $(slony_top_builddir)/Makefile.global
  override CFLAGS += $(CFLAGS_SL)
***************
*** 16,26 ****
  NAME		= xxid
  
- SO_NAME		= $(NAME)$(DLSUFFIX)
- SQL_NAME73	= $(NAME).v73.sql
  SQL_NAME74	= $(NAME).v74.sql
  SQL_NAME80	= $(NAME).v80.sql
! SQL_NAMES	= $(SQL_NAME73) $(SQL_NAME74) $(SQL_NAME80)
  
! SO_OBJS		= xxid.o
  
  ALL =					\
--- 18,28 ----
  NAME		= xxid
  
  SQL_NAME74	= $(NAME).v74.sql
  SQL_NAME80	= $(NAME).v80.sql
! SQL_NAME81	= $(NAME).v81.sql
! SQL_NAMES	= $(SQL_NAME74) $(SQL_NAME80) $(SQL_NAME81)
! GENSQLNAMES = $(filter-out $(SQL_NAME74), $(SQL_NAMES))
  
! SO_OBJS		= xxid.o $(WIN32RES)
  
  ALL =					\
***************
*** 28,39 ****
  	$(SQL_NAMES)		\
  
! DISTFILES = Makefile xxid.c xxid.v73.sql
  
  all:	$(ALL)
  
! $(SQL_NAME74):	$(SQL_NAME73)
  	cp $< $@
  
! $(SQL_NAME80):	$(SQL_NAME73)
  	cp $< $@
  
--- 30,41 ----
  	$(SQL_NAMES)		\
  
! DISTFILES = Makefile xxid.c xxid.v74.sql
  
  all:	$(ALL)
  
! $(SQL_NAME80):	$(SQL_NAME74)
  	cp $< $@
  
! $(SQL_NAME81):	$(SQL_NAME80)
  	cp $< $@
  
***************
*** 42,46 ****
  clean distclean maintainer-clean:
  	rm -f $(SO_NAME) $(SO_OBJS)
! 	rm -f $(SQL_NAME74) $(SQL_NAME80)
  
  install: all installdirs
--- 44,48 ----
  clean distclean maintainer-clean:
  	rm -f $(SO_NAME) $(SO_OBJS)
! 	rm -f $(GENSQLNAMES)
  
  install: all installdirs
***************
*** 60,64 ****
  	-chmod 777 $(distdir)/$(subdir)
  	for file in $(DISTFILES) ; do \
!       cp $$file $(distdir)/$(subdir)/$$file ; \
      done
  
--- 62,66 ----
  	-chmod 777 $(distdir)/$(subdir)
  	for file in $(DISTFILES) ; do \
!       cp $$file $(distdir)/$(subdir)/$$file || exit; \
      done
  
***************
*** 67,68 ****
--- 69,73 ----
  	$(MKLDEXPORT) $(pgbindir)/postgres > $@
  endif
+ 
+ splint:
+ 	splint -I $(pgincludedir) -I $(pgincludeserverdir) +unixlib -preproc +skip-sys-headers xxid.c


From cbbrowne at lists.slony.info  Thu Feb  8 10:01:17 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine/src/backend Makefile
	slony1_base.v81.sql slony1_funcs.sql slony1_funcs.v74.sql
	slony1_funcs.v80.sql slony1_funcs.v81.sql
Message-ID: <20070208180117.95C5D290453@main>

Update of /home/cvsd/slony1/slony1-engine/src/backend
In directory main:/tmp/cvs-serv9746/src/backend

Modified Files:
	Makefile slony1_funcs.sql slony1_funcs.v74.sql 
	slony1_funcs.v80.sql 
Added Files:
	slony1_base.v81.sql slony1_funcs.v81.sql 
Log Message:
- Makefiles and slonik.c now support '.v81.sql' files

- Fix to generate_sync_event(); quoting was wrong

- Add in function to UPDATE FUNCTIONS that makes xxidin() function
  become STRICT, as needed in PostgreSQL 8.2


Index: slony1_funcs.sql
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/backend/slony1_funcs.sql,v
retrieving revision 1.103
retrieving revision 1.104
diff -C2 -d -r1.103 -r1.104
*** slony1_funcs.sql	15 Dec 2006 05:34:18 -0000	1.103
--- slony1_funcs.sql	8 Feb 2007 18:01:15 -0000	1.104
***************
*** 5219,5227 ****
  BEGIN
  	select 1 into v_node_row from @NAMESPACE@.sl_event 
!        	  where ev_type = ''SYNC'' and ev_origin = @NAMESPACE@.getLocalNodeId(''@NAMESPACE@'')
            and ev_timestamp > now() - p_interval limit 1;
  	if not found then
  		-- If there has been no SYNC in the last interval, then push one
! 		perform @NAMESPACE@.createEvent(''@NAMESPACE@'', ''SYNC'', NULL);
  		return 1;
  	else
--- 5219,5227 ----
  BEGIN
  	select 1 into v_node_row from @NAMESPACE@.sl_event 
!        	  where ev_type = ''SYNC'' and ev_origin = @NAMESPACE@.getLocalNodeId(''_@CLUSTERNAME@'')
            and ev_timestamp > now() - p_interval limit 1;
  	if not found then
  		-- If there has been no SYNC in the last interval, then push one
! 		perform @NAMESPACE@.createEvent(''_@CLUSTERNAME@'', ''SYNC'', NULL);
  		return 1;
  	else
***************
*** 5830,5833 ****
--- 5830,5835 ----
  	end if;
  
+ 	-- In any version, make sure that the xxidin() functions are defined as STRICT
+ 	perform @NAMESPACE@.make_function_strict (''xxidin'', ''(cstring)'');
  	return p_old;
  end;

Index: Makefile
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/backend/Makefile,v
retrieving revision 1.22
retrieving revision 1.23
diff -C2 -d -r1.22 -r1.23
*** Makefile	2 Aug 2006 15:32:02 -0000	1.22
--- Makefile	8 Feb 2007 18:01:15 -0000	1.23
***************
*** 31,34 ****
--- 31,37 ----
  FUNCS_80		= slony1_funcs.v80.sql
  
+ BASE_81			= slony1_base.v81.sql
+ FUNCS_81		= slony1_funcs.v81.sql
+ 
  SQL_NAMES =				\
  	$(BASE_COMMON)		\
***************
*** 39,43 ****
  	$(FUNCS_74)			\
  	$(BASE_80)			\
! 	$(FUNCS_80)
  
  DISTFILES = Makefile README README.events $(wildcard *.sql) $(wildcard *.in) $(wildcard *.c)
--- 42,48 ----
  	$(FUNCS_74)			\
  	$(BASE_80)			\
! 	$(FUNCS_80)			\
! 	$(BASE_81)			\
! 	$(FUNCS_81)
  
  DISTFILES = Makefile README README.events $(wildcard *.sql) $(wildcard *.in) $(wildcard *.c)

Index: slony1_funcs.v80.sql
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/backend/slony1_funcs.v80.sql,v
retrieving revision 1.3
retrieving revision 1.4
diff -C2 -d -r1.3 -r1.4
*** slony1_funcs.v80.sql	5 Dec 2006 18:07:24 -0000	1.3
--- slony1_funcs.v80.sql	8 Feb 2007 18:01:15 -0000	1.4
***************
*** 115,116 ****
--- 115,125 ----
  'Returns 1/0 based on whether or not the DB is running a
  version earlier than 7.4';
+ 
+ create or replace function @NAMESPACE@.make_function_strict (text, text) returns void as
+ '
+    update "pg_catalog"."pg_proc" set proisstrict = ''t'' where 
+      proname = $1 and pronamespace = (select oid from "pg_catalog"."pg_namespace" where nspname = '@NAMESPACE@') and prolang = (select oid from "pg_catalog"."pg_language" where lanname = ''c'');
+ ' language sql;
+ 
+ comment on function @NAMESPACE@.make_function_strict (text, text) is
+ 'Equivalent to 8.1+ ALTER FUNCTION ... STRICT';
\ No newline at end of file

Index: slony1_funcs.v74.sql
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/backend/slony1_funcs.v74.sql,v
retrieving revision 1.8
retrieving revision 1.9
diff -C2 -d -r1.8 -r1.9
*** slony1_funcs.v74.sql	11 Nov 2005 13:53:24 -0000	1.8
--- slony1_funcs.v74.sql	8 Feb 2007 18:01:15 -0000	1.9
***************
*** 103,104 ****
--- 103,113 ----
  'Returns 1 or 0 based on whether or not the DB is running a
  version earlier than 7.4';
+ 
+ create or replace function @NAMESPACE@.make_function_strict (text, text) returns void as
+ '
+    update "pg_catalog"."pg_proc" set proisstrict = ''t'' where 
+      proname = $1 and pronamespace = (select oid from "pg_catalog"."pg_namespace" where nspname = '@NAMESPACE@') and prolang = (select oid from "pg_catalog"."pg_language" where lanname = ''c'');
+ ' language sql;
+ 
+ comment on function @NAMESPACE@.make_function_strict (text, text) is
+ 'Equivalent to 8.1+ ALTER FUNCTION ... STRICT';
\ No newline at end of file

--- NEW FILE: slony1_base.v81.sql ---
-- ----------------------------------------------------------------------
-- slony1_base.v81.sql
--
--    Version 8.1 specific parts of the basic replication schema.
--
--	Copyright (c) 2003-2004, PostgreSQL Global Development Group
--	Author: Jan Wieck, Afilias USA INC.
--
-- $Id: slony1_base.v81.sql,v 1.1 2007-02-08 18:01:15 cbbrowne Exp $
-- ----------------------------------------------------------------------



--- NEW FILE: slony1_funcs.v81.sql ---
-- ----------------------------------------------------------------------
-- slony1_funcs.v81.sql
--
--    Version 8.1 specific part of the replication support functions.
--
--	Copyright (c) 2003-2004, PostgreSQL Global Development Group
--	Author: Jan Wieck, Afilias USA INC.
--
-- $Id: slony1_funcs.v81.sql,v 1.1 2007-02-08 18:01:15 cbbrowne Exp $
-- ----------------------------------------------------------------------

-- ----------------------------------------------------------------------
-- FUNCTION prepareTableForCopy(tab_id)
--
--	Remove all content from a table before the subscription
--	content is loaded via COPY and disable index maintenance.
-- ----------------------------------------------------------------------
create or replace function @NAMESPACE@.prepareTableForCopy(int4)
returns int4
as '
declare
	p_tab_id		alias for $1;
	v_tab_oid		oid;
	v_tab_fqname	text;
begin
	-- ----
	-- Get the OID and fully qualified name for the table
	-- ---
	select	PGC.oid,
			@NAMESPACE@.slon_quote_brute(PGN.nspname) || ''.'' ||
			@NAMESPACE@.slon_quote_brute(PGC.relname) as tab_fqname
		into v_tab_oid, v_tab_fqname
			from @NAMESPACE@.sl_table T,   
				"pg_catalog".pg_class PGC, "pg_catalog".pg_namespace PGN
				where T.tab_id = p_tab_id
				and T.tab_reloid = PGC.oid
				and PGC.relnamespace = PGN.oid;
	if not found then
		raise exception ''Table with ID % not found in sl_table'', p_tab_id;
	end if;

	-- ----
	-- Setting pg_class.relhasindex to false will cause copy not to
	-- maintain any indexes. At the end of the copy we will reenable
	-- them and reindex the table. This bulk creating of indexes is
	-- faster.
	-- ----
	update pg_class set relhasindex = ''f'' where oid = v_tab_oid;

	-- ----
	-- Try using truncate to empty the table and fallback to
	-- delete on error.
	-- ----
	execute ''truncate '' || @NAMESPACE@.slon_quote_input(v_tab_fqname);
	raise notice ''truncate of % succeeded'', v_tab_fqname;
	return 1;
	exception when others then
		raise notice ''truncate of % failed - doing delete'', v_tab_fqname;
		update pg_class set relhasindex = ''f'' where oid = v_tab_oid;
		execute ''delete from only '' || @NAMESPACE@.slon_quote_input(v_tab_fqname);
		return 0;
end;
' language plpgsql;

comment on function @NAMESPACE@.prepareTableForCopy(int4) is
'Delete all data and suppress index maintenance';

-- ----------------------------------------------------------------------
-- FUNCTION finishTableAfterCopy(tab_id)
--
--	Reenable index maintenance and reindex the table after COPY.
-- ----------------------------------------------------------------------
create or replace function @NAMESPACE@.finishTableAfterCopy(int4)
returns int4
as '
declare
	p_tab_id		alias for $1;
	v_tab_oid		oid;
	v_tab_fqname	text;
begin
	-- ----
	-- Get the tables OID and fully qualified name
	-- ---
	select	PGC.oid,
			@NAMESPACE@.slon_quote_brute(PGN.nspname) || ''.'' ||
			@NAMESPACE@.slon_quote_brute(PGC.relname) as tab_fqname
		into v_tab_oid, v_tab_fqname
			from @NAMESPACE@.sl_table T,   
				"pg_catalog".pg_class PGC, "pg_catalog".pg_namespace PGN
				where T.tab_id = p_tab_id
				and T.tab_reloid = PGC.oid
				and PGC.relnamespace = PGN.oid;
	if not found then
		raise exception ''Table with ID % not found in sl_table'', p_tab_id;
	end if;

	-- ----
	-- Reenable indexes and reindex the table.
	-- ----
	update pg_class set relhasindex = ''t'' where oid = v_tab_oid;
	execute ''reindex table '' || @NAMESPACE@.slon_quote_input(v_tab_fqname);

	return 1;
end;
' language plpgsql;

comment on function @NAMESPACE@.finishTableAfterCopy(int4) is
'Reenable index maintenance and reindex the table';

create or replace function @NAMESPACE@.pre74()
returns integer
as 'select 0' language sql;

comment on function @NAMESPACE@.pre74() is 
'Returns 1/0 based on whether or not the DB is running a
version earlier than 7.4';

create or replace function @NAMESPACE@.make_function_strict (text, text) returns void as
'
declare
   fun alias for $1;
   parms alias for $2;
   stmt text;
begin
   stmt := ''ALTER FUNCTION "_@CLUSTERNAME@".'' || fun || '' '' || parms || '' STRICT;'';
   execute stmt;
   return;
end
' language plpgsql;

comment on function @NAMESPACE@.make_function_strict (text, text) is
'Equivalent to 8.1+ ALTER FUNCTION ... STRICT';


From cbbrowne at lists.slony.info  Thu Feb  8 10:01:17 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine/src/slonik slonik.c
Message-ID: <20070208180117.8B7C82903DF@main>

Update of /home/cvsd/slony1/slony1-engine/src/slonik
In directory main:/tmp/cvs-serv9746/src/slonik

Modified Files:
	slonik.c 
Log Message:
- Makefiles and slonik.c now support '.v81.sql' files

- Fix to generate_sync_event(); quoting was wrong

- Add in function to UPDATE FUNCTIONS that makes xxidin() function
  become STRICT, as needed in PostgreSQL 8.2


Index: slonik.c
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/slonik/slonik.c,v
retrieving revision 1.72
retrieving revision 1.73
diff -C2 -d -r1.72 -r1.73
*** slonik.c	30 Jan 2007 17:30:19 -0000	1.72
--- slonik.c	8 Feb 2007 18:01:15 -0000	1.73
***************
*** 1883,1897 ****
  		use_minor = 4;
  	}
! 	else if ((adminfo->pg_version >= 70500) && adminfo->pg_version < 80200)	/* 8.0 and 8.1 */ 
  	{
  		use_major = 8;
  		use_minor = 0;
  	}
! 	else	/* 8.2 and above */
  	{
  		use_major = 8;
! 		use_minor = 0;
  		printf("%s:%d: Possible unsupported PostgreSQL "
! 			"version (%d) %d.%d, defaulting to 8.0 support\n",
                          stmt->stmt_filename, stmt->stmt_lno, adminfo->pg_version,
  			(adminfo->pg_version/10000), ((adminfo->pg_version%10000)/100));
--- 1883,1902 ----
  		use_minor = 4;
  	}
! 	else if ((adminfo->pg_version >= 70500) && adminfo->pg_version < 80100)	/* 8.0 */ 
  	{
  		use_major = 8;
  		use_minor = 0;
  	}
! 	else if ((adminfo->pg_version >= 80100) && adminfo->pg_version < 80300)	/* 8.1 and 8.2 */ 
  	{
  		use_major = 8;
! 		use_minor = 1;
! 	}
! 	else	/* 8.3 and above */
! 	{
! 		use_major = 8;
! 		use_minor = 1;
  		printf("%s:%d: Possible unsupported PostgreSQL "
! 			"version (%d) %d.%d, defaulting to 8.1 support\n",
                          stmt->stmt_filename, stmt->stmt_lno, adminfo->pg_version,
  			(adminfo->pg_version/10000), ((adminfo->pg_version%10000)/100));


From cbbrowne at lists.slony.info  Thu Feb  8 10:42:40 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine/src/slon remote_worker.c
Message-ID: <20070208184240.836FD29046B@main>

Update of /home/cvsd/slony1/slony1-engine/src/slon
In directory main:/tmp/cvs-serv9818/src/slon

Modified Files:
      Tag: REL_1_2_STABLE
	remote_worker.c 
Log Message:
Fix debug level in v1.2 - DEBUG4 is supported, but not DEBUG5

Index: remote_worker.c
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/slon/remote_worker.c,v
retrieving revision 1.124.2.9
retrieving revision 1.124.2.10
diff -C2 -d -r1.124.2.9 -r1.124.2.10
*** remote_worker.c	2 Feb 2007 22:21:18 -0000	1.124.2.9
--- remote_worker.c	8 Feb 2007 18:42:38 -0000	1.124.2.10
***************
*** 5993,5997 ****
  				{
  					/* Finished another number... Fold it into the ranges... */
! 					slon_log(SLON_DEBUG5, "Finished number: %d\n", curr_number);
  
  					/*
--- 5993,5997 ----
  				{
  					/* Finished another number... Fold it into the ranges... */
! 					slon_log(SLON_DEBUG4, "Finished number: %d\n", curr_number);
  
  					/*
***************
*** 6044,6048 ****
  						if (curr_max == curr_min)
  						{
! 							slon_log(SLON_DEBUG5, "simple entry - %d\n", curr_max);
  							slon_appendquery(action_subquery,
  										" log_actionseq <> '%d' ", curr_max);
--- 6044,6048 ----
  						if (curr_max == curr_min)
  						{
! 							slon_log(SLON_DEBUG4, "simple entry - %d\n", curr_max);
  							slon_appendquery(action_subquery,
  										" log_actionseq <> '%d' ", curr_max);
***************
*** 6050,6054 ****
  						else
  						{
! 							slon_log(SLON_DEBUG5, "between entry - %d %d\n",
  									 curr_min, curr_max);
  							slon_appendquery(action_subquery,
--- 6050,6054 ----
  						else
  						{
! 							slon_log(SLON_DEBUG4, "between entry - %d %d\n",
  									 curr_min, curr_max);
  							slon_appendquery(action_subquery,
***************
*** 6079,6083 ****
  		if (curr_max == curr_min)
  		{
! 			slon_log(SLON_DEBUG5, "simple entry - %d\n", curr_max);
  			slon_appendquery(action_subquery,
  							 " log_actionseq <> '%d' ", curr_max);
--- 6079,6083 ----
  		if (curr_max == curr_min)
  		{
! 			slon_log(SLON_DEBUG4, "simple entry - %d\n", curr_max);
  			slon_appendquery(action_subquery,
  							 " log_actionseq <> '%d' ", curr_max);
***************
*** 6085,6089 ****
  		else
  		{
! 			slon_log(SLON_DEBUG5, "between entry - %d %d\n",
  					 curr_min, curr_max);
  			slon_appendquery(action_subquery,
--- 6085,6089 ----
  		else
  		{
! 			slon_log(SLON_DEBUG4, "between entry - %d %d\n",
  					 curr_min, curr_max);
  			slon_appendquery(action_subquery,


From cbbrowne at lists.slony.info  Thu Feb  8 14:50:04 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine/tests/test1 generate_dml.sh
Message-ID: <20070208225004.273AA2903DF@main>

Update of /home/cvsd/slony1/slony1-engine/tests/test1
In directory main:/tmp/cvs-serv10556/tests/test1

Modified Files:
	generate_dml.sh 
Log Message:
Add status reporting on the two new tests (on generate_sync_event() and
make_function_strict()).


Index: generate_dml.sh
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tests/test1/generate_dml.sh,v
retrieving revision 1.11
retrieving revision 1.12
diff -C2 -d -r1.11 -r1.12
*** generate_dml.sh	7 Feb 2007 19:13:17 -0000	1.11
--- generate_dml.sh	8 Feb 2007 22:50:02 -0000	1.12
***************
*** 82,85 ****
--- 82,86 ----
        warn 3 "generate_sync_event() failed - rc=${rc} see $mktmp/gensync.log* for details"
    fi
+   status "completed generate_sync_event() test"
    $pgbindir/psql -h $host -p $port -d $db -U $user -c "select \"_${CLUSTER1}\".make_function_strict('xxidin', '(cstring)');" 1> $mktmp/gensync.log.1 2> $mktmp/gensync.log
    rc=$?
***************
*** 87,90 ****
--- 88,92 ----
        warn 3 "make_function_strict('xxidin', '(cstring)') failed - rc=${rc} see $mktmp/gensync.log* for details"
    fi
+   status "completed make_function_strict() test"
    status "done"
  }


From cbbrowne at lists.slony.info  Thu Feb  8 14:52:42 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine RELEASE-1.1.7 config.h.in
Message-ID: <20070208225242.D5A5229046B@main>

Update of /home/cvsd/slony1/slony1-engine
In directory main:/tmp/cvs-serv10578

Modified Files:
      Tag: REL_1_1_STABLE
	RELEASE-1.1.7 config.h.in 
Log Message:
For 1_1_STABLE:

- Add notes to release notes
- Change version to 1.1.7 (the next version)
- Need to have v81.sql files
- Fix typo in generate_sync_event()
- Add to upgrade the make_function_strict() request on xxidin function
- Add variable - remote_listen_timeout


Index: config.h.in
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/config.h.in,v
retrieving revision 1.12.2.4
retrieving revision 1.12.2.5
diff -C2 -d -r1.12.2.4 -r1.12.2.5
*** config.h.in	31 Oct 2006 22:17:24 -0000	1.12.2.4
--- config.h.in	8 Feb 2007 22:52:40 -0000	1.12.2.5
***************
*** 13,17 ****
  #define SLONY_I_CONFIG_H
  
! #define SLONY_I_VERSION_STRING	"1.1.6"
  
  #undef PGSHARE
--- 13,17 ----
  #define SLONY_I_CONFIG_H
  
! #define SLONY_I_VERSION_STRING	"1.1.7"
  
  #undef PGSHARE

Index: RELEASE-1.1.7
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/Attic/RELEASE-1.1.7,v
retrieving revision 1.1.2.3
retrieving revision 1.1.2.4
diff -C2 -d -r1.1.2.3 -r1.1.2.4
*** RELEASE-1.1.7	5 Feb 2007 22:18:06 -0000	1.1.2.3
--- RELEASE-1.1.7	8 Feb 2007 22:52:40 -0000	1.1.2.4
***************
*** 20,21 ****
--- 20,33 ----
  Otherwise, the log tables will forever bloat until you add a second
  node...
+ 
+ - Added test to test1 for function generate_sync_event() and make_function_strict
+ 
+ - Added "v81" files (for slony1_base.v81.sql, slony1_funcs.v81.sql,
+ xxid.v81.sql), necessary to support 8.1 "ALTER FUNCTION ... STRICT";
+ 
+ - Fixed quoting problem in generate_sync_event()
+ 
+ - Added functionality to UPDATE FUNCTIONS to make xxidin() function
+ STRICT; the absence of this caused postmaster to fall over when
+ processing MOVE SET event in PG v8.2 (not to say that Slony-I 1.1 now
+ *supports* 8.2; it does not)


From cbbrowne at lists.slony.info  Thu Feb  8 14:52:43 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine/src/slon confoptions.h
Message-ID: <20070208225243.0859E29046C@main>

Update of /home/cvsd/slony1/slony1-engine/src/slon
In directory main:/tmp/cvs-serv10578/src/slon

Modified Files:
      Tag: REL_1_1_STABLE
	confoptions.h 
Log Message:
For 1_1_STABLE:

- Add notes to release notes
- Change version to 1.1.7 (the next version)
- Need to have v81.sql files
- Fix typo in generate_sync_event()
- Add to upgrade the make_function_strict() request on xxidin function
- Add variable - remote_listen_timeout


Index: confoptions.h
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/slon/confoptions.h,v
retrieving revision 1.23.2.2
retrieving revision 1.23.2.3
diff -C2 -d -r1.23.2.2 -r1.23.2.3
*** confoptions.h	2 Feb 2007 20:22:59 -0000	1.23.2.2
--- confoptions.h	8 Feb 2007 22:52:40 -0000	1.23.2.3
***************
*** 25,28 ****
--- 25,29 ----
  extern int	sync_group_maxsize;
  extern int	desired_sync_time;
+ extern int remote_listen_timeout;
  
  char	   	*Syslog_ident;


From cbbrowne at lists.slony.info  Thu Feb  8 14:52:43 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine/tests/test1 generate_dml.sh
Message-ID: <20070208225243.1D2F829046F@main>

Update of /home/cvsd/slony1/slony1-engine/tests/test1
In directory main:/tmp/cvs-serv10578/tests/test1

Modified Files:
      Tag: REL_1_1_STABLE
	generate_dml.sh 
Log Message:
For 1_1_STABLE:

- Add notes to release notes
- Change version to 1.1.7 (the next version)
- Need to have v81.sql files
- Fix typo in generate_sync_event()
- Add to upgrade the make_function_strict() request on xxidin function
- Add variable - remote_listen_timeout


Index: generate_dml.sh
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tests/test1/generate_dml.sh,v
retrieving revision 1.4.2.5
retrieving revision 1.4.2.6
diff -C2 -d -r1.4.2.5 -r1.4.2.6
*** generate_dml.sh	7 Feb 2007 19:16:02 -0000	1.4.2.5
--- generate_dml.sh	8 Feb 2007 22:52:41 -0000	1.4.2.6
***************
*** 82,85 ****
--- 82,86 ----
        warn 3 "generate_sync_event() failed - rc=${rc} see $mktmp/gensync.log* for details"
    fi
+   status "completed generate_sync_event() test"
    $pgbindir/psql -h $host -p $port -d $db -U $user -c "select \"_${CLUSTER1}\".make_function_strict('xxidin', '(cstring)');" 1> $mktmp/gensync.log.1 2> $mktmp/gensync.log
    rc=$?
***************
*** 87,90 ****
--- 88,92 ----
        warn 3 "make_function_strict('xxidin', '(cstring)') failed - rc=${rc} see $mktmp/gensync.log* for details"
    fi
+   status "completed make_function_strict() test"
    status "done"
  }


From cbbrowne at lists.slony.info  Thu Feb  8 14:52:42 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine/src/backend Makefile slony1_funcs.sql
	slony1_funcs.v73.sql slony1_funcs.v74.sql slony1_funcs.v80.sql
Message-ID: <20070208225243.A95C029046C@main>

Update of /home/cvsd/slony1/slony1-engine/src/backend
In directory main:/tmp/cvs-serv10578/src/backend

Modified Files:
      Tag: REL_1_1_STABLE
	Makefile slony1_funcs.sql slony1_funcs.v73.sql 
	slony1_funcs.v74.sql slony1_funcs.v80.sql 
Log Message:
For 1_1_STABLE:

- Add notes to release notes
- Change version to 1.1.7 (the next version)
- Need to have v81.sql files
- Fix typo in generate_sync_event()
- Add to upgrade the make_function_strict() request on xxidin function
- Add variable - remote_listen_timeout


Index: Makefile
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/backend/Makefile,v
retrieving revision 1.19.2.1
retrieving revision 1.19.2.2
diff -C2 -d -r1.19.2.1 -r1.19.2.2
*** Makefile	10 Nov 2005 23:39:32 -0000	1.19.2.1
--- Makefile	8 Feb 2007 22:52:40 -0000	1.19.2.2
***************
*** 30,33 ****
--- 30,36 ----
  FUNCS_80		= slony1_funcs.v80.sql
  
+ BASE_81			= slony1_base.v81.sql
+ FUNCS_81		= slony1_funcs.v81.sql
+ 
  SQL_NAMES =				\
  	$(BASE_COMMON)		\
***************
*** 38,42 ****
  	$(FUNCS_74)			\
  	$(BASE_80)			\
! 	$(FUNCS_80)
  
  DISTFILES = Makefile README README.events $(wildcard *.sql) $(wildcard *.in) $(wildcard *.c)
--- 41,47 ----
  	$(FUNCS_74)			\
  	$(BASE_80)			\
! 	$(FUNCS_80)			\
! 	$(BASE_81)			\
! 	$(FUNCS_81)
  
  DISTFILES = Makefile README README.events $(wildcard *.sql) $(wildcard *.in) $(wildcard *.c)

Index: slony1_funcs.v73.sql
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/backend/slony1_funcs.v73.sql,v
retrieving revision 1.7.2.3
retrieving revision 1.7.2.4
diff -C2 -d -r1.7.2.3 -r1.7.2.4
*** slony1_funcs.v73.sql	6 Jan 2006 17:07:46 -0000	1.7.2.3
--- slony1_funcs.v73.sql	8 Feb 2007 22:52:40 -0000	1.7.2.4
***************
*** 103,104 ****
--- 103,114 ----
  'Returns 1/0 based on whether or not the DB is running a
  version earlier than 7.4';
+ 
+ create or replace function @NAMESPACE@.make_function_strict (text, text) returns void as
+ '
+    update "pg_catalog"."pg_proc" set proisstrict = ''t'' where 
+         proname = $1 and pronamespace = (select oid from "pg_catalog"."pg_namespace" where nspname = '_@CLUSTERNAME@') and prolang = (select oid from "pg_catalog"."pg_language" where lanname = ''c'');
+ ' language sql;
+ 
+ comment on function @NAMESPACE@.make_function_strict (text, text) is
+ 'Equivalent to 8.1+ ALTER FUNCTION ... STRICT';
+ 

Index: slony1_funcs.sql
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/backend/slony1_funcs.sql,v
retrieving revision 1.64.2.20
retrieving revision 1.64.2.21
diff -C2 -d -r1.64.2.20 -r1.64.2.21
*** slony1_funcs.sql	5 Feb 2007 22:18:06 -0000	1.64.2.20
--- slony1_funcs.sql	8 Feb 2007 22:52:40 -0000	1.64.2.21
***************
*** 414,418 ****
  as '
  begin
! 	return 6;
  end;
  ' language plpgsql;
--- 414,418 ----
  as '
  begin
! 	return 7;
  end;
  ' language plpgsql;
***************
*** 4301,4305 ****
  				ev_origin = v_min_row.ev_origin and
  				ev_seqno < v_min_row.ev_seqno;
- 
  	end if;
  	-- ----
--- 4301,4304 ----
***************
*** 4916,4924 ****
  BEGIN
  	select 1 into v_node_row from @NAMESPACE@.sl_event 
!        	  where ev_type = ''SYNC'' and ev_origin = @NAMESPACE@.getLocalNodeId(''@NAMESPACE@'')
            and ev_timestamp > now() - p_interval limit 1;
  	if not found then
  		-- If there has been no SYNC in the last interval, then push one
! 		perform @NAMESPACE@.createEvent(''@NAMESPACE@'', ''SYNC'', NULL);
  		return 1;
  	else
--- 4915,4923 ----
  BEGIN
  	select 1 into v_node_row from @NAMESPACE@.sl_event 
!        	  where ev_type = ''SYNC'' and ev_origin = @NAMESPACE@.getLocalNodeId(''_@CLUSTERNAME@'')
            and ev_timestamp > now() - p_interval limit 1;
  	if not found then
  		-- If there has been no SYNC in the last interval, then push one
! 		perform @NAMESPACE@.createEvent(''_@CLUSTERNAME@'', ''SYNC'', NULL);
  		return 1;
  	else
***************
*** 5206,5209 ****
--- 5205,5210 ----
  	end if;
  
+ 	-- In any version, make sure that the xxidin() functions are defined STRICT
+ 	perform @NAMESPACE@.make_function_strict (''xxidin'', ''(cstring)'');
  	return p_old;
  end;
***************
*** 5279,5280 ****
--- 5280,5282 ----
  
  In PG versions > 7.3, this looks like (field1,field2,...fieldn)';
+ 

Index: slony1_funcs.v80.sql
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/backend/slony1_funcs.v80.sql,v
retrieving revision 1.1.2.2
retrieving revision 1.1.2.3
diff -C2 -d -r1.1.2.2 -r1.1.2.3
*** slony1_funcs.v80.sql	6 Jan 2006 17:07:46 -0000	1.1.2.2
--- slony1_funcs.v80.sql	8 Feb 2007 22:52:40 -0000	1.1.2.3
***************
*** 114,115 ****
--- 114,127 ----
  'Returns 1/0 based on whether or not the DB is running a
  version earlier than 7.4';
+ 
+ create or replace function @NAMESPACE@.make_function_strict (text, text) returns integer as
+ '
+ begin
+    update "pg_catalog"."pg_proc" set proisstrict = ''t'' where 
+      proname = $1 and pronamespace = (select oid from "pg_catalog"."pg_namespace" where nspname = ''_@CLUSTERNAME@'') and prolang = (select oid from "pg_catalog"."pg_language" where lanname = ''c'');
+    return 1 ;
+ end
+ ' language plpgsql;
+ 
+ comment on function @NAMESPACE@.make_table_strict (text, text) is
+ 'Equivalent to 8.1+ ALTER FUNCTION ... STRICT';

Index: slony1_funcs.v74.sql
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/backend/slony1_funcs.v74.sql,v
retrieving revision 1.6.2.3
retrieving revision 1.6.2.4
diff -C2 -d -r1.6.2.3 -r1.6.2.4
*** slony1_funcs.v74.sql	6 Jan 2006 17:07:46 -0000	1.6.2.3
--- slony1_funcs.v74.sql	8 Feb 2007 22:52:40 -0000	1.6.2.4
***************
*** 101,104 ****
  
  comment on function @NAMESPACE@.pre74() is 
! 'Returns 1/0 based on whether or not the DB is running a
! version earlier than 7.4';
--- 101,115 ----
  
  comment on function @NAMESPACE@.pre74() is 
! 'Returns 1/0 based on whether or not the DB is running a version earlier than 7.4';
! 
! create or replace function @NAMESPACE@.make_function_strict (text, text) returns void as
! '
! begin
!    update "pg_catalog"."pg_proc" set proisstrict = ''t'' where 
!      proname = $1 and pronamespace = (select oid from "pg_catalog"."pg_namespace" where nspname = ''_@CLUSTERNAME@'') and prolang = (select oid from "pg_catalog"."pg_language" where lanname = ''c'');
!    return 1 ;
! end
! ' language plpgsql;
! 
! comment on function @NAMESPACE@.make_function_strict (text, text) is
! 'Equivalent to 8.1+ ALTER FUNCTION ... STRICT';


From cbbrowne at lists.slony.info  Thu Feb  8 14:56:00 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine RELEASE-1.2.7 config.h.in
Message-ID: <20070208225600.13A8429046F@main>

Update of /home/cvsd/slony1/slony1-engine
In directory main:/tmp/cvs-serv10636

Modified Files:
      Tag: REL_1_2_STABLE
	RELEASE-1.2.7 config.h.in 
Log Message:
1_2_STABLE updates:

- Release notes
- Change version to 1.2.7
- Need to install v81.sql files
- Fix expansion of cluster name in generate_sync_event()
- update functions now includes a call to make_function_strict() for xxidin()


Index: RELEASE-1.2.7
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/Attic/RELEASE-1.2.7,v
retrieving revision 1.1.2.3
retrieving revision 1.1.2.4
diff -C2 -d -r1.1.2.3 -r1.1.2.4
*** RELEASE-1.2.7	5 Feb 2007 22:06:52 -0000	1.1.2.3
--- RELEASE-1.2.7	8 Feb 2007 22:55:57 -0000	1.1.2.4
***************
*** 11,15 ****
  In this bug, big "action lists" that need to get compressed could cause
  a logging printf to blow up.  Changed the logging level so that detail
! is only shown at levels 4/5, which won't bite people by default.
  
  - UNINSTALL NODE failures now show node # in slonik error messages
--- 11,15 ----
  In this bug, big "action lists" that need to get compressed could cause
  a logging printf to blow up.  Changed the logging level so that detail
! is only shown at level 4, which won't bite people by default.
  
  - UNINSTALL NODE failures now show node # in slonik error messages
***************
*** 18,19 ****
--- 18,30 ----
  script, and one of them broke, you'd have no ready way to tell which
  node this failed on.  Added code to report the node # where it failed.
+ 
+ - Added test to test1 for function generate_sync_event() and make_function_strict
+ 
+ - Added "v81" files (for slony1_base.v81.sql, slony1_funcs.v81.sql,
+ xxid.v81.sql), necessary to support 8.1 "ALTER FUNCTION ... STRICT";
+ 
+ - Fixed quoting problem in generate_sync_event()
+ 
+ - Added functionality to UPDATE FUNCTIONS to make xxidin() function
+ STRICT; the absence of this caused postmaster to fall over when
+ processing MOVE SET event in PG v8.2

Index: config.h.in
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/config.h.in,v
retrieving revision 1.17.2.3
retrieving revision 1.17.2.4
diff -C2 -d -r1.17.2.3 -r1.17.2.4
*** config.h.in	8 Jan 2007 17:31:40 -0000	1.17.2.3
--- config.h.in	8 Feb 2007 22:55:57 -0000	1.17.2.4
***************
*** 13,18 ****
  #define SLONY_I_CONFIG_H
  
! #define SLONY_I_VERSION_STRING	"1.2.6"
! #define SLONY_I_VERSION_STRING_DEC 1,2,6
  
  #ifndef PG_VERSION_MAJOR
--- 13,18 ----
  #define SLONY_I_CONFIG_H
  
! #define SLONY_I_VERSION_STRING	"1.2.7"
! #define SLONY_I_VERSION_STRING_DEC 1,2,7
  
  #ifndef PG_VERSION_MAJOR


From cbbrowne at lists.slony.info  Thu Feb  8 14:56:00 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine/src/slonik slonik.c
Message-ID: <20070208225600.54331290473@main>

Update of /home/cvsd/slony1/slony1-engine/src/slonik
In directory main:/tmp/cvs-serv10636/src/slonik

Modified Files:
      Tag: REL_1_2_STABLE
	slonik.c 
Log Message:
1_2_STABLE updates:

- Release notes
- Change version to 1.2.7
- Need to install v81.sql files
- Fix expansion of cluster name in generate_sync_event()
- update functions now includes a call to make_function_strict() for xxidin()


Index: slonik.c
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/slonik/slonik.c,v
retrieving revision 1.67.2.4
retrieving revision 1.67.2.5
diff -C2 -d -r1.67.2.4 -r1.67.2.5
*** slonik.c	5 Feb 2007 22:06:53 -0000	1.67.2.4
--- slonik.c	8 Feb 2007 22:55:58 -0000	1.67.2.5
***************
*** 1883,1897 ****
  		use_minor = 4;
  	}
! 	else if ((adminfo->pg_version >= 70500) && adminfo->pg_version < 80300)	/* 8.0, 8.1 and 8.2 */ 
  	{
  		use_major = 8;
  		use_minor = 0;
  	}
! 	else	/* 8.3 and above */
  	{
  		use_major = 8;
! 		use_minor = 0;
  		printf("%s:%d: Possible unsupported PostgreSQL "
! 			"version (%d) %d.%d, defaulting to 8.0 support\n",
                          stmt->stmt_filename, stmt->stmt_lno, adminfo->pg_version,
  			(adminfo->pg_version/10000), ((adminfo->pg_version%10000)/100));
--- 1883,1902 ----
  		use_minor = 4;
  	}
! 	else if ((adminfo->pg_version >= 70500) && adminfo->pg_version < 80100)	/* 8.0 */
  	{
  		use_major = 8;
  		use_minor = 0;
  	}
! 	else if ((adminfo->pg_version >= 80100) && adminfo->pg_version < 80300)	/* 8.1 and 8.2 */
  	{
  		use_major = 8;
! 		use_minor = 1;
! 	}
! 	else	/* 8.3+ */
! 	{
! 		use_major = 8;
! 		use_minor = 1;
  		printf("%s:%d: Possible unsupported PostgreSQL "
! 			"version (%d) %d.%d, defaulting to 8.1 support\n",
                          stmt->stmt_filename, stmt->stmt_lno, adminfo->pg_version,
  			(adminfo->pg_version/10000), ((adminfo->pg_version%10000)/100));


From cbbrowne at lists.slony.info  Thu Feb  8 14:56:00 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine/src/slon confoptions.h
Message-ID: <20070208225600.356CD290472@main>

Update of /home/cvsd/slony1/slony1-engine/src/slon
In directory main:/tmp/cvs-serv10636/src/slon

Modified Files:
      Tag: REL_1_2_STABLE
	confoptions.h 
Log Message:
1_2_STABLE updates:

- Release notes
- Change version to 1.2.7
- Need to install v81.sql files
- Fix expansion of cluster name in generate_sync_event()
- update functions now includes a call to make_function_strict() for xxidin()


Index: confoptions.h
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/slon/confoptions.h,v
retrieving revision 1.31.2.2
retrieving revision 1.31.2.3
diff -C2 -d -r1.31.2.2 -r1.31.2.3
*** confoptions.h	27 Oct 2006 20:09:56 -0000	1.31.2.2
--- confoptions.h	8 Feb 2007 22:55:58 -0000	1.31.2.3
***************
*** 23,26 ****
--- 23,27 ----
  extern int	sync_max_rowsize;
  extern int	sync_max_largemem;
+ extern int  remote_listen_timeout;
  
  extern int	sync_group_maxsize;


From cbbrowne at lists.slony.info  Thu Feb  8 14:56:00 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:25 2007
Subject: [Slony1-commit] slony1-engine/tests/test1 generate_dml.sh
Message-ID: <20070208225600.6C489290474@main>

Update of /home/cvsd/slony1/slony1-engine/tests/test1
In directory main:/tmp/cvs-serv10636/tests/test1

Modified Files:
      Tag: REL_1_2_STABLE
	generate_dml.sh 
Log Message:
1_2_STABLE updates:

- Release notes
- Change version to 1.2.7
- Need to install v81.sql files
- Fix expansion of cluster name in generate_sync_event()
- update functions now includes a call to make_function_strict() for xxidin()


Index: generate_dml.sh
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tests/test1/generate_dml.sh,v
retrieving revision 1.8.2.3
retrieving revision 1.8.2.4
diff -C2 -d -r1.8.2.3 -r1.8.2.4
*** generate_dml.sh	7 Feb 2007 19:13:53 -0000	1.8.2.3
--- generate_dml.sh	8 Feb 2007 22:55:58 -0000	1.8.2.4
***************
*** 82,85 ****
--- 82,86 ----
        warn 3 "generate_sync_event() failed - rc=${rc} see $mktmp/gensync.log* for details"
    fi
+   status "completed generate_sync_event() test"
    $pgbindir/psql -h $host -p $port -d $db -U $user -c "select \"_${CLUSTER1}\".make_function_strict('xxidin', '(cstring)');" 1> $mktmp/gensync.log.1 2> $mktmp/gensync.log
    rc=$?
***************
*** 87,90 ****
--- 88,92 ----
        warn 3 "make_function_strict('xxidin', '(cstring)') failed - rc=${rc} see $mktmp/gensync.log* for details"
    fi
+   status "completed make_function_strict() test"
    status "done"
  }


From cbbrowne at lists.slony.info  Thu Feb  8 14:56:00 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:26 2007
Subject: [Slony1-commit] slony1-engine/src/backend Makefile
	slony1_base.v81.sql slony1_funcs.sql slony1_funcs.v73.sql
	slony1_funcs.v74.sql slony1_funcs.v80.sql slony1_funcs.v81.sql
Message-ID: <20070208225600.E3C03290473@main>

Update of /home/cvsd/slony1/slony1-engine/src/backend
In directory main:/tmp/cvs-serv10636/src/backend

Modified Files:
      Tag: REL_1_2_STABLE
	Makefile slony1_funcs.sql slony1_funcs.v73.sql 
	slony1_funcs.v74.sql slony1_funcs.v80.sql 
Added Files:
      Tag: REL_1_2_STABLE
	slony1_base.v81.sql slony1_funcs.v81.sql 
Log Message:
1_2_STABLE updates:

- Release notes
- Change version to 1.2.7
- Need to install v81.sql files
- Fix expansion of cluster name in generate_sync_event()
- update functions now includes a call to make_function_strict() for xxidin()


Index: slony1_funcs.v73.sql
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/backend/slony1_funcs.v73.sql,v
retrieving revision 1.9
retrieving revision 1.9.2.1
diff -C2 -d -r1.9 -r1.9.2.1
*** slony1_funcs.v73.sql	11 Nov 2005 13:53:24 -0000	1.9
--- slony1_funcs.v73.sql	8 Feb 2007 22:55:58 -0000	1.9.2.1
***************
*** 103,104 ****
--- 103,113 ----
  'Returns 1 or 0 based on whether or not the DB is running a
  version earlier than 7.4';
+ 
+ create or replace function @NAMESPACE@.make_function_strict (text, text) returns void as
+ '
+    update "pg_catalog"."pg_proc" set proisstrict = ''t'' where 
+            proname = $1 and pronamespace = (select oid from "pg_catalog"."pg_namespace" where nspname = '_@CLUSTERNAME@') and prolang = (select oid from "pg_catalog"."pg_language" where lanname = ''c'');
+ ' language sql;
+ 
+ comment on function @NAMESPACE@.make_function_strict (text, text) is
+ 'Equivalent to 8.1+ ALTER FUNCTION ... STRICT';

Index: slony1_funcs.sql
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/backend/slony1_funcs.sql,v
retrieving revision 1.98.2.8
retrieving revision 1.98.2.9
diff -C2 -d -r1.98.2.8 -r1.98.2.9
*** slony1_funcs.sql	8 Jan 2007 17:31:40 -0000	1.98.2.8
--- slony1_funcs.sql	8 Feb 2007 22:55:58 -0000	1.98.2.9
***************
*** 431,435 ****
  as '
  begin
! 	return 6;
  end;
  ' language plpgsql;
--- 431,435 ----
  as '
  begin
! 	return 7;
  end;
  ' language plpgsql;
***************
*** 5219,5227 ****
  BEGIN
  	select 1 into v_node_row from @NAMESPACE@.sl_event 
!        	  where ev_type = ''SYNC'' and ev_origin = @NAMESPACE@.getLocalNodeId(''@NAMESPACE@'')
            and ev_timestamp > now() - p_interval limit 1;
  	if not found then
  		-- If there has been no SYNC in the last interval, then push one
! 		perform @NAMESPACE@.createEvent(''@NAMESPACE@'', ''SYNC'', NULL);
  		return 1;
  	else
--- 5219,5227 ----
  BEGIN
  	select 1 into v_node_row from @NAMESPACE@.sl_event 
!        	  where ev_type = ''SYNC'' and ev_origin = @NAMESPACE@.getLocalNodeId(''_@CLUSTERNAME@'')
            and ev_timestamp > now() - p_interval limit 1;
  	if not found then
  		-- If there has been no SYNC in the last interval, then push one
! 		perform @NAMESPACE@.createEvent(''_@CLUSTERNAME@'', ''SYNC'', NULL);
  		return 1;
  	else
***************
*** 5830,5833 ****
--- 5830,5835 ----
  	end if;
  
+ 	-- In any version, make sure that the xxidin() functions are defined STRICT
+ 	perform @NAMESPACE@.make_function_strict (''xxidin'', ''(cstring)'');
  	return p_old;
  end;
***************
*** 5903,5904 ****
--- 5905,5907 ----
  
  In PG versions > 7.3, this looks like (field1,field2,...fieldn)';
+ 

Index: Makefile
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/backend/Makefile,v
retrieving revision 1.22.2.1
retrieving revision 1.22.2.2
diff -C2 -d -r1.22.2.1 -r1.22.2.2
*** Makefile	14 Dec 2006 22:30:25 -0000	1.22.2.1
--- Makefile	8 Feb 2007 22:55:58 -0000	1.22.2.2
***************
*** 29,32 ****
--- 29,35 ----
  FUNCS_80		= slony1_funcs.v80.sql
  
+ BASE_81			= slony1_base.v81.sql
+ FUNCS_81		= slony1_funcs.v81.sql
+ 
  SQL_NAMES =				\
  	$(BASE_COMMON)		\
***************
*** 35,39 ****
  	$(FUNCS_74)			\
  	$(BASE_80)			\
! 	$(FUNCS_80)
  
  DISTFILES = Makefile README README.events $(wildcard *.sql) $(wildcard *.in) $(wildcard *.c)
--- 38,44 ----
  	$(FUNCS_74)			\
  	$(BASE_80)			\
! 	$(FUNCS_80)			\
! 	$(BASE_81)			\
! 	$(FUNCS_81)
  
  DISTFILES = Makefile README README.events $(wildcard *.sql) $(wildcard *.in) $(wildcard *.c)

Index: slony1_funcs.v80.sql
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/backend/slony1_funcs.v80.sql,v
retrieving revision 1.2.2.1
retrieving revision 1.2.2.2
diff -C2 -d -r1.2.2.1 -r1.2.2.2
*** slony1_funcs.v80.sql	5 Dec 2006 18:04:46 -0000	1.2.2.1
--- slony1_funcs.v80.sql	8 Feb 2007 22:55:58 -0000	1.2.2.2
***************
*** 4,8 ****
  --    Version 8.0 specific part of the replication support functions.
  --
! --	Copyright (c) 2003-2004, PostgreSQL Global Development Group
  --	Author: Jan Wieck, Afilias USA INC.
  --
--- 4,8 ----
  --    Version 8.0 specific part of the replication support functions.
  --
! --	Copyright (c) 2003-2006, PostgreSQL Global Development Group
  --	Author: Jan Wieck, Afilias USA INC.
  --
***************
*** 25,29 ****
  begin
  	-- ----
! 	-- Get the OID and fully qualified name for the table
  	-- ---
  	select	PGC.oid,
--- 25,29 ----
  begin
  	-- ----
! 	-- Get the tables OID and fully qualified name
  	-- ---
  	select	PGC.oid,
***************
*** 57,61 ****
  	exception when others then
  		raise notice ''truncate of % failed - doing delete'', v_tab_fqname;
- 		update pg_class set relhasindex = ''f'' where oid = v_tab_oid;
  		execute ''delete from only '' || @NAMESPACE@.slon_quote_input(v_tab_fqname);
  		return 0;
--- 57,60 ----
***************
*** 115,116 ****
--- 114,127 ----
  'Returns 1/0 based on whether or not the DB is running a
  version earlier than 7.4';
+ 
+ create or replace function @NAMESPACE@.make_function_strict (text, text) returns integer as
+ '
+ begin
+    update "pg_catalog"."pg_proc" set proisstrict = ''t'' where 
+      proname = $1 and pronamespace = (select oid from "pg_catalog"."pg_namespace" where nspname = ''_@CLUSTERNAME@'') and prolang = (select oid from "pg_catalog"."pg_language" where lanname = ''c'');
+    return 1 ;
+ end
+ ' language plpgsql;
+ 
+ comment on function @NAMESPACE@.make_table_strict (text, text) is
+ 'Equivalent to 8.1+ ALTER FUNCTION ... STRICT';

Index: slony1_funcs.v74.sql
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/backend/slony1_funcs.v74.sql,v
retrieving revision 1.8
retrieving revision 1.8.2.1
diff -C2 -d -r1.8 -r1.8.2.1
*** slony1_funcs.v74.sql	11 Nov 2005 13:53:24 -0000	1.8
--- slony1_funcs.v74.sql	8 Feb 2007 22:55:58 -0000	1.8.2.1
***************
*** 4,8 ****
  --    Version 7.4 specific part of the replication support functions.
  --
! --	Copyright (c) 2003-2004, PostgreSQL Global Development Group
  --	Author: Jan Wieck, Afilias USA INC.
  --
--- 4,8 ----
  --    Version 7.4 specific part of the replication support functions.
  --
! --	Copyright (c) 2003-2006, PostgreSQL Global Development Group
  --	Author: Jan Wieck, Afilias USA INC.
  --
***************
*** 98,104 ****
  create or replace function @NAMESPACE@.pre74()
  returns integer
! as 'select 0;' language sql;
  
  comment on function @NAMESPACE@.pre74() is 
! 'Returns 1 or 0 based on whether or not the DB is running a
! version earlier than 7.4';
--- 98,115 ----
  create or replace function @NAMESPACE@.pre74()
  returns integer
! as 'select 0' language sql;
  
  comment on function @NAMESPACE@.pre74() is 
! 'Returns 1/0 based on whether or not the DB is running a version earlier than 7.4';
! 
! create or replace function @NAMESPACE@.make_function_strict (text, text) returns void as
! '
! begin
!    update "pg_catalog"."pg_proc" set proisstrict = ''t'' where 
!      proname = $1 and pronamespace = (select oid from "pg_catalog"."pg_namespace" where nspname = ''_@CLUSTERNAME@'') and prolang = (select oid from "pg_catalog"."pg_language" where lanname = ''c'');
!    return 1 ;
! end
! ' language plpgsql;
! 
! comment on function @NAMESPACE@.make_function_strict (text, text) is
! 'Equivalent to 8.1+ ALTER FUNCTION ... STRICT';

--- NEW FILE: slony1_base.v81.sql ---
-- ----------------------------------------------------------------------
-- slony1_base.v81.sql
--
--    Version 8.1 specific parts of the basic replication schema.
--
--	Copyright (c) 2003-2004, PostgreSQL Global Development Group
--	Author: Jan Wieck, Afilias USA INC.
--
-- $Id: slony1_base.v81.sql,v 1.1.2.1 2007-02-08 22:55:58 cbbrowne Exp $
-- ----------------------------------------------------------------------



--- NEW FILE: slony1_funcs.v81.sql ---
-- ----------------------------------------------------------------------
-- slony1_funcs.v81.sql
--
--    Version 8.1 specific part of the replication support functions.
--
--	Copyright (c) 2003-2004, PostgreSQL Global Development Group
--	Author: Jan Wieck, Afilias USA INC.
--
-- $Id: slony1_funcs.v81.sql,v 1.1.2.1 2007-02-08 22:55:58 cbbrowne Exp $
-- ----------------------------------------------------------------------

-- ----------------------------------------------------------------------
-- FUNCTION prepareTableForCopy(tab_id)
--
--	Remove all content from a table before the subscription
--	content is loaded via COPY and disable index maintenance.
-- ----------------------------------------------------------------------
create or replace function @NAMESPACE@.prepareTableForCopy(int4)
returns int4
as '
declare
	p_tab_id		alias for $1;
	v_tab_oid		oid;
	v_tab_fqname	text;
begin
	-- ----
	-- Get the OID and fully qualified name for the table
	-- ---
	select	PGC.oid,
			@NAMESPACE@.slon_quote_brute(PGN.nspname) || ''.'' ||
			@NAMESPACE@.slon_quote_brute(PGC.relname) as tab_fqname
		into v_tab_oid, v_tab_fqname
			from @NAMESPACE@.sl_table T,   
				"pg_catalog".pg_class PGC, "pg_catalog".pg_namespace PGN
				where T.tab_id = p_tab_id
				and T.tab_reloid = PGC.oid
				and PGC.relnamespace = PGN.oid;
	if not found then
		raise exception ''Table with ID % not found in sl_table'', p_tab_id;
	end if;

	-- ----
	-- Setting pg_class.relhasindex to false will cause copy not to
	-- maintain any indexes. At the end of the copy we will reenable
	-- them and reindex the table. This bulk creating of indexes is
	-- faster.
	-- ----
	update pg_class set relhasindex = ''f'' where oid = v_tab_oid;

	-- ----
	-- Try using truncate to empty the table and fallback to
	-- delete on error.
	-- ----
	execute ''truncate '' || @NAMESPACE@.slon_quote_input(v_tab_fqname);
	raise notice ''truncate of % succeeded'', v_tab_fqname;
	return 1;
	exception when others then
		raise notice ''truncate of % failed - doing delete'', v_tab_fqname;
		update pg_class set relhasindex = ''f'' where oid = v_tab_oid;
		execute ''delete from only '' || @NAMESPACE@.slon_quote_input(v_tab_fqname);
		return 0;
end;
' language plpgsql;

comment on function @NAMESPACE@.prepareTableForCopy(int4) is
'Delete all data and suppress index maintenance';

-- ----------------------------------------------------------------------
-- FUNCTION finishTableAfterCopy(tab_id)
--
--	Reenable index maintenance and reindex the table after COPY.
-- ----------------------------------------------------------------------
create or replace function @NAMESPACE@.finishTableAfterCopy(int4)
returns int4
as '
declare
	p_tab_id		alias for $1;
	v_tab_oid		oid;
	v_tab_fqname	text;
begin
	-- ----
	-- Get the tables OID and fully qualified name
	-- ---
	select	PGC.oid,
			@NAMESPACE@.slon_quote_brute(PGN.nspname) || ''.'' ||
			@NAMESPACE@.slon_quote_brute(PGC.relname) as tab_fqname
		into v_tab_oid, v_tab_fqname
			from @NAMESPACE@.sl_table T,   
				"pg_catalog".pg_class PGC, "pg_catalog".pg_namespace PGN
				where T.tab_id = p_tab_id
				and T.tab_reloid = PGC.oid
				and PGC.relnamespace = PGN.oid;
	if not found then
		raise exception ''Table with ID % not found in sl_table'', p_tab_id;
	end if;

	-- ----
	-- Reenable indexes and reindex the table.
	-- ----
	update pg_class set relhasindex = ''t'' where oid = v_tab_oid;
	execute ''reindex table '' || @NAMESPACE@.slon_quote_input(v_tab_fqname);

	return 1;
end;
' language plpgsql;

comment on function @NAMESPACE@.finishTableAfterCopy(int4) is
'Reenable index maintenance and reindex the table';

create or replace function @NAMESPACE@.pre74()
returns integer
as 'select 0' language sql;

comment on function @NAMESPACE@.pre74() is 
'Returns 1/0 based on whether or not the DB is running a
version earlier than 7.4';

create or replace function @NAMESPACE@.make_function_strict (text, text) returns void as
'
declare
   fun alias for $1;
   parms alias for $2;
   stmt text;
begin
   stmt := ''ALTER FUNCTION "_@CLUSTERNAME@".'' || fun || '' '' || parms || '' STRICT;'';
   execute stmt;
   return;
end
' language plpgsql;

comment on function @NAMESPACE@.make_function_strict (text, text) is
'Equivalent to 8.1+ ALTER FUNCTION ... STRICT';


From cbbrowne at lists.slony.info  Thu Feb  8 14:57:30 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Tue Feb 13 08:59:26 2007
Subject: [Slony1-commit] slony1-engine/src/backend slony1_funcs.v80.sql
Message-ID: <20070208225730.15552290471@main>

Update of /home/cvsd/slony1/slony1-engine/src/backend
In directory main:/tmp/cvs-serv10697/src/backend

Modified Files:
      Tag: REL_1_2_STABLE
	slony1_funcs.v80.sql 
Log Message:
Make sure that in 8.0, we deactivate indices if we fall back to DELETE
rather than TRUNCATE at time of COPY SET


Index: slony1_funcs.v80.sql
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/backend/slony1_funcs.v80.sql,v
retrieving revision 1.2.2.2
retrieving revision 1.2.2.3
diff -C2 -d -r1.2.2.2 -r1.2.2.3
*** slony1_funcs.v80.sql	8 Feb 2007 22:55:58 -0000	1.2.2.2
--- slony1_funcs.v80.sql	8 Feb 2007 22:57:28 -0000	1.2.2.3
***************
*** 57,60 ****
--- 57,61 ----
  	exception when others then
  		raise notice ''truncate of % failed - doing delete'', v_tab_fqname;
+ 	update pg_class set relhasindex = ''f'' where oid = v_tab_oid;
  		execute ''delete from only '' || @NAMESPACE@.slon_quote_input(v_tab_fqname);
  		return 0;


From xfade at lists.slony.info  Mon Feb 12 11:04:48 2007
From: xfade at lists.slony.info (Niels Breet)
Date: Tue Feb 13 08:59:26 2007
Subject: [Slony1-commit] slony1-www style.css layout.php
Message-ID: <20070212190448.48D4C290460@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv18483

Modified Files:
	style.css layout.php 
Log Message:
Add more menu items

Index: layout.php
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/layout.php,v
retrieving revision 1.7
retrieving revision 1.8
diff -C2 -d -r1.7 -r1.8
*** layout.php	9 Feb 2007 21:17:28 -0000	1.7
--- layout.php	12 Feb 2007 19:04:46 -0000	1.8
***************
*** 16,22 ****
    <div class="left">
    <div class="menu">
!     <a href="/">Home</a> 
!     <a href="/scm/">CVS</a> 
!     <a href="http://lists.slony.info/mailman/listinfo" title="Slony mailinglists">Mailinglists</a> 
    </div>
    </div>
--- 16,24 ----
    <div class="left">
    <div class="menu">
!     <a href="/" title="Go to the Slony homepage">Home</a>
!     <a href="/scm/" title="Go to Slony CVS information">CVS</a>
!     <a href="http://lists.slony.info/mailman/listinfo" title="Slony mailinglists">Mailinglists</a>
!     <a href="/documentation/" title="Go to the documentation section.">Documentation</a>
!     <a href="/downloads/" title="Get Slony!">Download</a>
    </div>
    </div>

Index: style.css
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/style.css,v
retrieving revision 1.11
retrieving revision 1.12
diff -C2 -d -r1.11 -r1.12
*** style.css	9 Feb 2007 21:22:12 -0000	1.11
--- style.css	12 Feb 2007 19:04:46 -0000	1.12
***************
*** 28,32 ****
    width: 575px;
    height: 108px;
-   overflow: hidden;
  }
  
--- 28,31 ----


From xfade at lists.slony.info  Tue Feb 13 08:31:42 2007
From: xfade at lists.slony.info (Niels Breet)
Date: Tue Feb 13 08:59:26 2007
Subject: [Slony1-commit] slony1-www style.css
Message-ID: <20070213163142.60AE9290BCC@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv20803

Modified Files:
	style.css 
Log Message:
Beat that horrible PRE tag into submission

Index: style.css
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/style.css,v
retrieving revision 1.12
retrieving revision 1.13
diff -C2 -d -r1.12 -r1.13
*** style.css	12 Feb 2007 19:04:46 -0000	1.12
--- style.css	13 Feb 2007 16:31:40 -0000	1.13
***************
*** 203,206 ****
--- 203,215 ----
  }
  
+ .text pre{
+   font-size:80%;
+   white-space: pre-wrap;       /* css-3 */
+   white-space: -moz-pre-wrap;  /* Mozilla, since 1999 */
+   white-space: -pre-wrap;      /* Opera 4-6 */
+   white-space: -o-pre-wrap;    /* Opera 7 */
+   word-wrap: break-word;       /* Internet Explorer 5.5+ */
+ }
+ 
  .copyright{
    width: 98%;


From cbbrowne at lists.slony.info  Fri Feb 16 15:35:15 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Fri Feb 16 15:35:17 2007
Subject: [Slony1-commit] slony1-engine UPGRADING
Message-ID: <20070216233515.5FF012902F6@main>

Update of /home/cvsd/slony1/slony1-engine
In directory main:/tmp/cvs-serv15962

Modified Files:
	UPGRADING 
Log Message:
Add in notes about the "NULLable column" issue.

We had a fix in 1.2 that refuses to replicate if the PK candidate has
columns that are NULLable.

There may be 1.1 replicas that have this condition; needed to document
how to find the problem, and deal with it, if need be...


Index: UPGRADING
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/UPGRADING,v
retrieving revision 1.2
retrieving revision 1.3
diff -C2 -d -r1.2 -r1.3
*** UPGRADING	2 Jan 2007 17:03:28 -0000	1.2
--- UPGRADING	16 Feb 2007 23:35:13 -0000	1.3
***************
*** 1,3 ****
! Upgrading from an earlier version of Slony-I to 1.3
  -----------------------------------------------------
  $Id$
--- 1,3 ----
! Upgrading from an earlier version of Slony-I to 1.2
  -----------------------------------------------------
  $Id$
***************
*** 29,30 ****
--- 29,65 ----
  The section is entitled "Slony-I Upgrade", distributed as
  doc/adminguide/slonyupgrade.html in the documentation package.
+ 
+ Nullable Column issue in version 1.2
+ ===================================
+ 
+ In version 1.2, a check has been added to reject subscriptions to
+ tables where the candidate primary key has columns that are "Nullable"
+ (e.g. - that are not defined in the schema as NOT NULL).
+ 
+ This was not checked in earlier versions, and people may have set up
+ constraints (e.g. - via triggers) to enforce NOT NULL as opposed to
+ using the NOT NULL column constraint.  As a result, a replica running
+ on version 1.1 may have violations of this check.
+ 
+ You may search for these violations via the following query:
+ 
+ select c.relname as table_name, ic.relname as index_name, att.attname, att2.attnotnull
+ from _cluster.sl_table t, pg_catalog.pg_class c, pg_index i, pg_catalog.pg_class ic, pg_catalog.pg_attribute att, pg_catalog.pg_attribute att2
+ where t.tab_reloid = c.oid 
+     and t.tab_idxname = ic.relname 
+     and  ic.oid = i.indexrelid
+     and att.attrelid = i.indexrelid
+     and att2.attname = att.attname
+     and att2.attrelid = c.oid
+     and att2.attnotnull = 'f';
+ 
+ The problem may be rectified by submitting, for each entry found, a
+ query of the form:
+    alter table mytable alter column nullablecol set not null;
+ 
+ It would minimally suffice to apply this to the schema of new
+ subscribers; such queries will run rapidly against empty tables.
+ 
+ It will take longer to apply this change to a table that already
+ contains a great deal of data, as the alteration will scan the table
+ to verify that there are no tuples where the column is NULL.

From cbbrowne at lists.slony.info  Fri Feb 16 15:35:15 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Fri Feb 16 15:35:17 2007
Subject: [Slony1-commit] slony1-engine/doc/adminguide loganalysis.sgml
Message-ID: <20070216233515.70D602903A5@main>

Update of /home/cvsd/slony1/slony1-engine/doc/adminguide
In directory main:/tmp/cvs-serv15962/doc/adminguide

Modified Files:
	loganalysis.sgml 
Log Message:
Add in notes about the "NULLable column" issue.

We had a fix in 1.2 that refuses to replicate if the PK candidate has
columns that are NULLable.

There may be 1.1 replicas that have this condition; needed to document
how to find the problem, and deal with it, if need be...


Index: loganalysis.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/loganalysis.sgml,v
retrieving revision 1.7
retrieving revision 1.8
diff -C2 -d -r1.7 -r1.8
*** loganalysis.sgml	2 Feb 2007 20:24:16 -0000	1.7
--- loganalysis.sgml	16 Feb 2007 23:35:13 -0000	1.8
***************
*** 746,754 ****
  <listitem><para><command>NOTICE: Slony-I setAddTable_int(): table % PK column % nullable</command></para> 
  
! <para> You tried to replicate a table where one of the columns in the would-be primary key is allowed to be null.  All PK columns must be <command>NOT NULL.</command> This request is about to fail. </para></listitem>
  <listitem><para><command>ERROR: Slony-I setAddTable_int(): table % not replicable!</command></para> 
  
! <para> 
! This happens because of the NULLable PK column. </para></listitem>
  <listitem><para><command>ERROR: Slony-I setAddTable_int(): table id % has already been assigned!</command></para> 
  
--- 746,785 ----
  <listitem><para><command>NOTICE: Slony-I setAddTable_int(): table % PK column % nullable</command></para> 
  
! <para> You tried to replicate a table where one of the columns in the would-be primary key is allowed to be null.  All PK columns must be <command>NOT NULL.</command> This request is about to fail. </para>
! 
! <para> A check for this condition was introduced in &slony1; version
! 1.2.  If you have a 1.1 replica, it will continue to function after
! upgrading to 1.2, but you will experience this complaint when you try
! to add new subscribers. </para>
! 
! <para> You can look for table/index combinations on an existing
! node that have NULLABLE columns in the primary key via the
! following query:
! <screen>
! select c.relname as table_name, ic.relname as index_name, att.attname, att2.attnotnull
! from _cluster.sl_table t, pg_catalog.pg_class c, pg_index i, pg_catalog.pg_class ic, pg_catalog.pg_attribute att, pg_catalog.pg_attribute att2
! where t.tab_reloid = c.oid 
!     and t.tab_idxname = ic.relname 
!     and  ic.oid = i.indexrelid
!     and att.attrelid = i.indexrelid
!     and att2.attname = att.attname
!     and att2.attrelid = c.oid
!     and att2.attnotnull = 'f';
! </screen> </para>
! 
! <para> These may be rectified via submitting, for each one, a query of
! the form: <command> alter table mytable alter column nullablecol set
! not null; </command> Running this against a subscriber where the table
! is empty will complete very quickly. It will take longer to apply this
! change to a table that already contains a great deal of data, as the
! alteration will scan the table to verify that there are no tuples
! where the column is NULL.
! </para>
! 
! </listitem>
! 
  <listitem><para><command>ERROR: Slony-I setAddTable_int(): table % not replicable!</command></para> 
  
! <para> This happens because of the NULLable PK column. </para></listitem>
  <listitem><para><command>ERROR: Slony-I setAddTable_int(): table id % has already been assigned!</command></para> 
  

From cbbrowne at lists.slony.info  Fri Feb 16 15:36:20 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Fri Feb 16 15:36:22 2007
Subject: [Slony1-commit] slony1-engine UPGRADING RELEASE-1.2.7
Message-ID: <20070216233620.7E3FD29004F@main>

Update of /home/cvsd/slony1/slony1-engine
In directory main:/tmp/cvs-serv16011

Modified Files:
      Tag: REL_1_2_STABLE
	UPGRADING RELEASE-1.2.7 
Log Message:
Add in notes about the "NULLable column" issue.

We had a fix in 1.2 that refuses to replicate if the PK candidate has 
columns that are NULLable.

There may be 1.1 replicas that have this condition; needed to document
how to find the problem, and deal with it, if need be...


Index: RELEASE-1.2.7
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/Attic/RELEASE-1.2.7,v
retrieving revision 1.1.2.4
retrieving revision 1.1.2.5
diff -C2 -d -r1.1.2.4 -r1.1.2.5
*** RELEASE-1.2.7	8 Feb 2007 22:55:57 -0000	1.1.2.4
--- RELEASE-1.2.7	16 Feb 2007 23:36:18 -0000	1.1.2.5
***************
*** 29,30 ****
--- 29,33 ----
  STRICT; the absence of this caused postmaster to fall over when
  processing MOVE SET event in PG v8.2
+ 
+ - Added documentation of an issue surrounding NULLABLE columns to the
+ log analysis chapter of the admin guide and to the UPGRADING docs.

Index: UPGRADING
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/UPGRADING,v
retrieving revision 1.1.4.1
retrieving revision 1.1.4.2
diff -C2 -d -r1.1.4.1 -r1.1.4.2
*** UPGRADING	2 Jan 2007 17:04:09 -0000	1.1.4.1
--- UPGRADING	16 Feb 2007 23:36:18 -0000	1.1.4.2
***************
*** 29,30 ****
--- 29,65 ----
  The section is entitled "Slony-I Upgrade", distributed as
  doc/adminguide/slonyupgrade.html in the documentation package.
+ 
+ Nullable Column issue in version 1.2
+ ===================================
+ 
+ In version 1.2, a check has been added to reject subscriptions to
+ tables where the candidate primary key has columns that are "Nullable"
+ (e.g. - that are not defined in the schema as NOT NULL).
+ 
+ This was not checked in earlier versions, and people may have set up
+ constraints (e.g. - via triggers) to enforce NOT NULL as opposed to
+ using the NOT NULL column constraint.  As a result, a replica running
+ on version 1.1 may have violations of this check.
+ 
+ You may search for these violations via the following query:
+ 
+ select c.relname as table_name, ic.relname as index_name, att.attname, att2.attnotnull
+ from _cluster.sl_table t, pg_catalog.pg_class c, pg_index i, pg_catalog.pg_class ic, pg_catalog.pg_attribute att, pg_catalog.pg_attribute att2
+ where t.tab_reloid = c.oid 
+     and t.tab_idxname = ic.relname 
+     and  ic.oid = i.indexrelid
+     and att.attrelid = i.indexrelid
+     and att2.attname = att.attname
+     and att2.attrelid = c.oid
+     and att2.attnotnull = 'f';
+ 
+ The problem may be rectified by submitting, for each entry found, a
+ query of the form:
+    alter table mytable alter column nullablecol set not null;
+ 
+ It would minimally suffice to apply this to the schema of new
+ subscribers; such queries will run rapidly against empty tables.
+ 
+ It will take longer to apply this change to a table that already
+ contains a great deal of data, as the alteration will scan the table
+ to verify that there are no tuples where the column is NULL.

From cbbrowne at lists.slony.info  Fri Feb 16 15:36:20 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Fri Feb 16 15:36:22 2007
Subject: [Slony1-commit] slony1-engine/doc/adminguide loganalysis.sgml
Message-ID: <20070216233620.954D72902D0@main>

Update of /home/cvsd/slony1/slony1-engine/doc/adminguide
In directory main:/tmp/cvs-serv16011/doc/adminguide

Modified Files:
      Tag: REL_1_2_STABLE
	loganalysis.sgml 
Log Message:
Add in notes about the "NULLable column" issue.

We had a fix in 1.2 that refuses to replicate if the PK candidate has 
columns that are NULLable.

There may be 1.1 replicas that have this condition; needed to document
how to find the problem, and deal with it, if need be...


Index: loganalysis.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/loganalysis.sgml,v
retrieving revision 1.4.2.2
retrieving revision 1.4.2.3
diff -C2 -d -r1.4.2.2 -r1.4.2.3
*** loganalysis.sgml	2 Feb 2007 20:23:46 -0000	1.4.2.2
--- loganalysis.sgml	16 Feb 2007 23:36:18 -0000	1.4.2.3
***************
*** 59,62 ****
--- 59,68 ----
  </variablelist>
  </para>
+ 
+ <para> How much information they display is controlled by
+ the <envar>log_level</envar> &lslon; parameter;
+ ERROR/WARN/CONFIG/INFO messages will always be displayed, while
+ choosing increasing values from 1 to 4 will lead to additional DEBUG
+ level messages being displayed. </para>
  </sect2>
  
***************
*** 740,748 ****
  <listitem><para><command>NOTICE: Slony-I setAddTable_int(): table % PK column % nullable</command></para> 
  
! <para> You tried to replicate a table where one of the columns in the would-be primary key is allowed to be null.  All PK columns must be <command>NOT NULL.</command> This request is about to fail. </para></listitem>
  <listitem><para><command>ERROR: Slony-I setAddTable_int(): table % not replicable!</command></para> 
  
! <para> 
! This happens because of the NULLable PK column. </para></listitem>
  <listitem><para><command>ERROR: Slony-I setAddTable_int(): table id % has already been assigned!</command></para> 
  
--- 746,785 ----
  <listitem><para><command>NOTICE: Slony-I setAddTable_int(): table % PK column % nullable</command></para> 
  
! <para> You tried to replicate a table where one of the columns in the would-be primary key is allowed to be null.  All PK columns must be <command>NOT NULL.</command> This request is about to fail. </para>
! 
! <para> A check for this condition was introduced in &slony1; version
! 1.2.  If you have a 1.1 replica, it will continue to function after
! upgrading to 1.2, but you will experience this complaint when you try
! to add new subscribers. </para>
! 
! <para> You can look for table/index combinations on an existing
! node that have NULLABLE columns in the primary key via the
! following query:
! <screen>
! select c.relname as table_name, ic.relname as index_name, att.attname, att2.attnotnull
! from _cluster.sl_table t, pg_catalog.pg_class c, pg_index i, pg_catalog.pg_class ic, pg_catalog.pg_attribute att, pg_catalog.pg_attribute att2
! where t.tab_reloid = c.oid 
!     and t.tab_idxname = ic.relname 
!     and  ic.oid = i.indexrelid
!     and att.attrelid = i.indexrelid
!     and att2.attname = att.attname
!     and att2.attrelid = c.oid
!     and att2.attnotnull = 'f';
! </screen> </para>
! 
! <para> These may be rectified via submitting, for each one, a query of
! the form: <command> alter table mytable alter column nullablecol set
! not null; </command> Running this against a subscriber where the table
! is empty will complete very quickly. It will take longer to apply this
! change to a table that already contains a great deal of data, as the
! alteration will scan the table to verify that there are no tuples
! where the column is NULL.
! </para>
! 
! </listitem>
! 
  <listitem><para><command>ERROR: Slony-I setAddTable_int(): table % not replicable!</command></para> 
  
! <para> This happens because of the NULLable PK column. </para></listitem>
  <listitem><para><command>ERROR: Slony-I setAddTable_int(): table id % has already been assigned!</command></para> 
  

From devrim at lists.slony.info  Sun Feb 18 13:17:59 2007
From: devrim at lists.slony.info (Devrim)
Date: Mon Feb 19 09:24:05 2007
Subject: [Slony1-commit] slony1-engine/doc/adminguide firstdb.sgml
Message-ID: <20070218211759.73FF22902D6@main>

Update of /home/cvsd/slony1/slony1-engine/doc/adminguide
In directory main:/tmp/cvs-serv3609

Modified Files:
	firstdb.sgml 
Log Message:
Fix sgml error


Index: firstdb.sgml
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/doc/adminguide/firstdb.sgml,v
retrieving revision 1.21
retrieving revision 1.22
diff -C2 -d -r1.21 -r1.22
*** firstdb.sgml	30 Jan 2007 19:23:19 -0000	1.21
--- firstdb.sgml	18 Feb 2007 21:17:57 -0000	1.22
***************
*** 364,371 ****
  <para>If this script returns <command>FAILED</command> please contact the
  developers at <ulink url="http://slony.info/">
! http://slony.info/</ulink></para></sect2>
! 
  </sect1>
- 
  <!-- Keep this comment at the end of the file
  Local variables:
--- 364,370 ----
  <para>If this script returns <command>FAILED</command> please contact the
  developers at <ulink url="http://slony.info/">
! http://slony.info/</ulink></para></sect3>
! </sect2>
  </sect1>
  <!-- Keep this comment at the end of the file
  Local variables:

From xfade at lists.slony.info  Tue Feb 20 03:20:46 2007
From: xfade at lists.slony.info (Niels Breet)
Date: Tue Feb 20 03:20:48 2007
Subject: [Slony1-commit] slony1-engine configure.ac
Message-ID: <20070220112046.B0E68290292@main>

Update of /home/cvsd/slony1/slony1-engine
In directory main:/tmp/cvs-serv31739

Modified Files:
	configure.ac 
Log Message:
Add an option to skip building the engine sources. This is used for building docs only. --disable-engine skips all slony1-engine tests. Default behaviour does not change.

Index: configure.ac
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/configure.ac,v
retrieving revision 1.59
retrieving revision 1.60
diff -C2 -d -r1.59 -r1.60
*** configure.ac	1 Nov 2006 15:43:07 -0000	1.59
--- configure.ac	20 Feb 2007 11:20:44 -0000	1.60
***************
*** 142,145 ****
--- 142,151 ----
  AC_ARG_WITH(mandir,		[  --with-mandir=<dir>              Location to install the manpages. Default is $PREFIX/man.])
  
+ 
+ SLON_AC_ARG_BOOL(enable, engine, yes,
+               [  --disable-engine	  Don't build slony1-engine source. (Used when building documentation only)])
+ 
+ AC_SUBST(enable_engine)
+ 
  #Our current path
  SLONYPATH=`pwd`
***************
*** 148,151 ****
--- 154,162 ----
  # PostgreSQL checks
  # ----
+ AC_MSG_CHECKING(if you have requested slony1-engine building)
+ AC_MSG_RESULT($enable_engine)
+ 
+ if test "$enable_engine" = "yes"; then
+ 
  ACX_LIBPQ()
  ACX_LIBSNMP()
***************
*** 174,177 ****
--- 185,190 ----
  AC_SUBST(SLONBINDIR,$SLONBINDIR)
  
+ fi
+ 
  # ----
  # Documentation checks

From xfade at lists.slony.info  Tue Feb 20 03:29:41 2007
From: xfade at lists.slony.info (Niels Breet)
Date: Tue Feb 20 03:29:43 2007
Subject: [Slony1-commit] slony1-engine configure.ac
Message-ID: <20070220112941.1E0822902D3@main>

Update of /home/cvsd/slony1/slony1-engine
In directory main:/tmp/cvs-serv31841

Modified Files:
      Tag: REL_1_2_STABLE
	configure.ac 
Log Message:
Add an option to skip building the engine sources. This is used for building docs only. --disable-engine skips all slony1-engine tests. Default behaviour does not change.

Index: configure.ac
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/configure.ac,v
retrieving revision 1.57.2.1
retrieving revision 1.57.2.2
diff -C2 -d -r1.57.2.1 -r1.57.2.2
*** configure.ac	26 Oct 2006 18:55:05 -0000	1.57.2.1
--- configure.ac	20 Feb 2007 11:29:39 -0000	1.57.2.2
***************
*** 142,145 ****
--- 142,151 ----
  AC_ARG_WITH(mandir,		[  --with-mandir=<dir>              Location to install the manpages. Default is $PREFIX/man.])
  
+ 
+ SLON_AC_ARG_BOOL(enable, engine, yes,
+               [  --disable-engine          Don't build slony1-engine source. (Used when building documentation only)])
+ 
+ AC_SUBST(enable_engine)
+ 
  #Our current path
  SLONYPATH=`pwd`
***************
*** 148,151 ****
--- 154,162 ----
  # PostgreSQL checks
  # ----
+ AC_MSG_CHECKING(if you have requested slony1-engine building)
+ AC_MSG_RESULT($enable_engine)
+ 
+ if test "$enable_engine" = "yes"; then
+ 
  ACX_LIBPQ()
  ACX_LIBSNMP()
***************
*** 174,177 ****
--- 185,190 ----
  AC_SUBST(SLONBINDIR,$SLONBINDIR)
  
+ fi
+ 
  # ----
  # Documentation checks

From xfade at lists.slony.info  Tue Feb 20 04:39:00 2007
From: xfade at lists.slony.info (Niels Breet)
Date: Tue Feb 20 04:39:02 2007
Subject: [Slony1-commit] slony1-www index.php
Message-ID: <20070220123900.840F12902D3@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv1921

Modified Files:
	index.php 
Log Message:
Template documentation with php. This is a quick hack until we have a real docbook template ;)

Index: index.php
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/index.php,v
retrieving revision 1.5
retrieving revision 1.6
diff -C2 -d -r1.5 -r1.6
*** index.php	2 Feb 2007 17:18:18 -0000	1.5
--- index.php	20 Feb 2007 12:38:58 -0000	1.6
***************
*** 11,14 ****
--- 11,21 ----
  	echo layout_defaultblock('404, NOT FOUND','',file_get_contents('./content/404.txt'));
  	break;
+   case 'docs':
+         $file = str_replace(array("/",".."),"",$_GET["file"]);
+         if ($file == "") $file="index.html";
+         echo layout_header();
+         $text=file_get_contents('./adminguide/current/doc/adminguide/'.$file);
+         echo layout_defaultblock($title,$link,$text);
+         break;
    case 'cvs':
  	echo layout_header();

From xfade at lists.slony.info  Tue Feb 20 04:40:08 2007
From: xfade at lists.slony.info (Niels Breet)
Date: Tue Feb 20 04:40:09 2007
Subject: [Slony1-commit] slony1-www style.css
Message-ID: <20070220124008.9B4EC2902D3@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv1955

Modified Files:
	style.css 
Log Message:
Visited links in menu

Index: style.css
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/style.css,v
retrieving revision 1.13
retrieving revision 1.14
diff -C2 -d -r1.13 -r1.14
*** style.css	13 Feb 2007 16:31:40 -0000	1.13
--- style.css	20 Feb 2007 12:40:06 -0000	1.14
***************
*** 59,62 ****
--- 59,66 ----
  }
  
+ .header .menu a:visited{
+   color: #ffffff;
+ }
+ 
  .content{
    width: 100%;

From xfade at lists.slony.info  Tue Feb 20 04:44:48 2007
From: xfade at lists.slony.info (Niels Breet)
Date: Tue Feb 20 04:44:50 2007
Subject: [Slony1-commit] slony1-www style.css
Message-ID: <20070220124448.F02492902D3@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv1987

Modified Files:
	style.css 
Log Message:
Visited links in titlebar

Index: style.css
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/style.css,v
retrieving revision 1.14
retrieving revision 1.15
diff -C2 -d -r1.14 -r1.15
*** style.css	20 Feb 2007 12:40:06 -0000	1.14
--- style.css	20 Feb 2007 12:44:46 -0000	1.15
***************
*** 116,119 ****
--- 116,123 ----
  }
  
+ .intro-header .right a:hover{
+   color: #ffffff;
+ }
+ 
  .intro-header input{
    border: 1px solid #ffffff;

From xfade at lists.slony.info  Tue Feb 20 04:45:54 2007
From: xfade at lists.slony.info (Niels Breet)
Date: Tue Feb 20 04:45:55 2007
Subject: [Slony1-commit] slony1-www index.php
Message-ID: <20070220124554.6FC5B2902D3@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv2010

Modified Files:
	index.php 
Log Message:
Add title to titlebar

Index: index.php
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/index.php,v
retrieving revision 1.6
retrieving revision 1.7
diff -C2 -d -r1.6 -r1.7
*** index.php	20 Feb 2007 12:38:58 -0000	1.6
--- index.php	20 Feb 2007 12:45:52 -0000	1.7
***************
*** 16,19 ****
--- 16,20 ----
          echo layout_header();
          $text=file_get_contents('./adminguide/current/doc/adminguide/'.$file);
+ 	$title=between("TITLE\n>","</TITLE",$text);
          echo layout_defaultblock($title,$link,$text);
          break;

From xfade at lists.slony.info  Tue Feb 20 04:48:40 2007
From: xfade at lists.slony.info (Niels Breet)
Date: Tue Feb 20 04:48:42 2007
Subject: [Slony1-commit] slony1-www style.css
Message-ID: <20070220124840.C70402902D3@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv2042

Modified Files:
	style.css 
Log Message:
Even more visited links

Index: style.css
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/style.css,v
retrieving revision 1.15
retrieving revision 1.16
diff -C2 -d -r1.15 -r1.16
*** style.css	20 Feb 2007 12:44:46 -0000	1.15
--- style.css	20 Feb 2007 12:48:38 -0000	1.16
***************
*** 116,121 ****
  }
  
! .intro-header .right a:hover{
!   color: #ffffff;
  }
  
--- 116,121 ----
  }
  
! .intro-header .right a:visited{
!   color: #cccccc;
  }
  
***************
*** 211,214 ****
--- 211,219 ----
  }
  
+ .intro-body .text a:visited, .intro-body .text-intro a:visited{
+   color: #0D1DDF;
+   text-decoration: none;
+ }
+ 
  .text pre{
    font-size:80%;
***************
*** 234,237 ****
--- 239,247 ----
    font-weight: normal;
  }
+ 
+ .copyright a:visited{
+   color: #ffffff;
+ }
+ 
  .news-stamp{
    text-align: right;

From xfade at lists.slony.info  Wed Feb 28 13:13:50 2007
From: xfade at lists.slony.info (Niels Breet)
Date: Wed Feb 28 13:13:52 2007
Subject: [Slony1-commit] slony1-www index.php
Message-ID: <20070228211350.87306290045@main>

Update of /home/cvsd/slony1/slony1-www
In directory main:/tmp/cvs-serv3404

Modified Files:
	index.php 
Log Message:
Add download area. My birthday present to Slony ;)

Index: index.php
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/index.php,v
retrieving revision 1.7
retrieving revision 1.8
diff -C2 -d -r1.7 -r1.8
*** index.php	20 Feb 2007 12:45:52 -0000	1.7
--- index.php	28 Feb 2007 21:13:48 -0000	1.8
***************
*** 3,7 ****
  
  $target=$_GET["target"];
- //var_dump($target); //debug
  
  switch($target){
--- 3,6 ----
***************
*** 19,22 ****
--- 18,77 ----
          echo layout_defaultblock($title,$link,$text);
          break;
+   case 'download':
+        $version = "";
+        if ($_GET["version"] == "1.0") $version = "1.0";
+        if ($_GET["version"] == "1.1") $version = "1.1";
+        if ($_GET["version"] == "1.2") $version = "1.2";
+        if ($version == ""){
+                $path = './downloads/';
+        } else {
+                $path = './downloads/'.$version.'/';
+                $sums = @file_get_contents($path.'MD5SUMS');
+        }
+ 
+        if ($dh = opendir($path)) {
+                        $files = array();
+                $mysums = array();
+                        while (($file = readdir($dh)) !== false) {
+                        if (($version == "") && ($file != ".") && ($file != "..")){
+                                array_push($files, $file);
+                        } else  if ((substr($file, strlen($file) - 4) == '.bz2') ||
+                                        (substr($file, strlen($file) - 4) == '.rpm')) {
+                                        array_push($files, $file);
+                                $pos = 0;
+                                $pos = strpos($sums,$file);
+                                if ($pos > 0)
+                                        array_push($mysums,substr($sums,$pos-34,32));
+                        }
+                        }
+        closedir($dh);
+        }
+ 
+        // Sort the files and display
+        //sort($files);
+        echo layout_header();
+        $text = "";
+        if ($version == "") {
+                 $text .= "<h1>Please select a Slony version</h1>";
+                 $text .= "<table>\n";
+        } else {
+                $text .= "<h1>Slony $version files</h1>";
+                $text .= "<table>\n<tr><td>File</td><td>Type</td><td>MD5SUM</td></tr>\n";
+        }
+        $c = 0;
+        foreach ($files as $file) {
+                        $title = $file;
+                $type = "";
+                if (strpos($file,'tar.bz2')>0) $type="Slony tarball";
+                if ((strpos($file,'doc')>0) && ((strpos($file,'tar.bz2')>0))) $type="Documentation";
+                if (strpos($file,'.rpm')>0) $type="Slony RPM";
+ 
+                        $text .= "<tr><td><a href=\"$file\" title=\"$title\">$title</a></td><td>$type</td><td>$mysums[$c]</td></tr>\n";
+                $c++;
+        }
+        $text .= "</table>\n";
+        echo layout_defaultblock('Slony downloads',"/downloads/",$text);
+ 
+        break;
    case 'cvs':
  	echo layout_header();

From xfade at lists.slony.info  Wed Feb 28 13:22:53 2007
From: xfade at lists.slony.info (Niels Breet)
Date: Wed Feb 28 13:22:55 2007
Subject: [Slony1-commit] slony1-www/content news.txt
Message-ID: <20070228212253.6612D290014@main>

Update of /home/cvsd/slony1/slony1-www/content
In directory main:/tmp/cvs-serv3523

Modified Files:
	news.txt 
Log Message:
Add quick downloads to frontpage

Index: news.txt
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/content/news.txt,v
retrieving revision 1.3
retrieving revision 1.4
diff -C2 -d -r1.3 -r1.4
*** news.txt	31 Jan 2007 18:06:40 -0000	1.3
--- news.txt	28 Feb 2007 21:22:51 -0000	1.4
***************
*** 1,3 ****
--- 1,12 ----
  ---
+ Slony-I Quick downloads
+ http://main.slony.info/downloads
+ 2007-02-28
+ Chris Browne
+ Slony-1 1.2.6 <a href="http://main.slony.info/downloads/1.2/slony1-1.2.6.tar.bz2">engine</a>
+ <a href="http://main.slony.info/downloads/1.2/slony1-1.2.6-docs.tar.bz2">documentation</a>
+ <br />
+ Slony-1 1.1.6 <a href="http://main.slony.info/downloads/1.1/slony1-1.1.6-tar.bz2">engine</a>
+ ---
  Slony-I New Web Site!
  http://main.slony.info

From xfade at lists.slony.info  Wed Feb 28 13:30:37 2007
From: xfade at lists.slony.info (Niels Breet)
Date: Wed Feb 28 13:30:38 2007
Subject: [Slony1-commit] slony1-www/content intro.txt
Message-ID: <20070228213037.7BE41290014@main>

Update of /home/cvsd/slony1/slony1-www/content
In directory main:/tmp/cvs-serv3586

Modified Files:
	intro.txt 
Log Message:
Update documentation link in intro.

Index: intro.txt
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/content/intro.txt,v
retrieving revision 1.2
retrieving revision 1.3
diff -C2 -d -r1.2 -r1.3
*** intro.txt	30 Jan 2007 17:08:02 -0000	1.2
--- intro.txt	28 Feb 2007 21:30:35 -0000	1.3
***************
*** 17,22 ****
            the CVS tree may be found <a href=
            "http://linuxdatabases.info/info/slony.html">here</a> There
!           is also a local copy <a href=
!           "adminguide/slony1-1.2.6/doc/adminguide/index.html">here</a></p>
  
            <p>The original design document is available <a href=
--- 17,21 ----
            the CVS tree may be found <a href=
            "http://linuxdatabases.info/info/slony.html">here</a> There
!           is also a <a href="/documentation/">local copy</a></p>
  
            <p>The original design document is available <a href=

From xfade at lists.slony.info  Wed Feb 28 13:34:03 2007
From: xfade at lists.slony.info (Niels Breet)
Date: Wed Feb 28 13:34:04 2007
Subject: [Slony1-commit] slony1-www/content intro.txt
Message-ID: <20070228213403.6262E290014@main>

Update of /home/cvsd/slony1/slony1-www/content
In directory main:/tmp/cvs-serv3622

Modified Files:
	intro.txt 
Log Message:
Nitpicking.

Index: intro.txt
===================================================================
RCS file: /home/cvsd/slony1/slony1-www/content/intro.txt,v
retrieving revision 1.3
retrieving revision 1.4
diff -C2 -d -r1.3 -r1.4
*** intro.txt	28 Feb 2007 21:30:35 -0000	1.3
--- intro.txt	28 Feb 2007 21:34:01 -0000	1.4
***************
*** 16,21 ****
            <p>A fairly extensive "admin guide" comprising material in
            the CVS tree may be found <a href=
!           "http://linuxdatabases.info/info/slony.html">here</a> There
!           is also a <a href="/documentation/">local copy</a></p>
  
            <p>The original design document is available <a href=
--- 16,21 ----
            <p>A fairly extensive "admin guide" comprising material in
            the CVS tree may be found <a href=
!           "http://linuxdatabases.info/info/slony.html">here</a>. There
!           is also a <a href="/documentation/">local copy</a>.</p>
  
            <p>The original design document is available <a href=

From cbbrowne at lists.slony.info  Wed Feb 28 14:07:51 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Wed Feb 28 14:07:53 2007
Subject: [Slony1-commit] slony1-engine/src/slon remote_worker.c
Message-ID: <20070228220751.5098D2903B1@main>

Update of /home/cvsd/slony1/slony1-engine/src/slon
In directory main:/tmp/cvs-serv3776/src/slon

Modified Files:
      Tag: REL_1_1_STABLE
	remote_worker.c 
Log Message:
- When you run MOVE SET, this populates sl_setsync for the moved set
  even on nodes that are not subscribed.  If, subsequent to doing this, 
  you attempt a SUBSCRIBE SET for a formerly-unsubscribed node, the
  subscription will fail right at the end when the slon tries to insert a
  new value to sl_setsync.

  The fix: DELETE from sl_setsync immediately before the INSERT.  This
  will silently blow away any 'offending' sl_setsync row.

As observed by Afilias staff...


Index: remote_worker.c
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/slon/remote_worker.c,v
retrieving revision 1.86.2.15
retrieving revision 1.86.2.16
diff -C2 -d -r1.86.2.15 -r1.86.2.16
*** remote_worker.c	25 Oct 2006 12:57:07 -0000	1.86.2.15
--- remote_worker.c	28 Feb 2007 22:07:49 -0000	1.86.2.16
***************
*** 3479,3486 ****
--- 3479,3488 ----
  	 */
  	slon_mkquery(&query1,
+ 		     "delete from %s.sl_setsync where ssy_setid = %d;"
  		     "insert into %s.sl_setsync "
  		     "    (ssy_setid, ssy_origin, ssy_seqno, "
  		     "     ssy_minxid, ssy_maxxid, ssy_xip, ssy_action_list) "
  		     "    values ('%d', '%d', '%s', '%s', '%s', '%q', '%q'); ",
+ 		     rtcfg_namespace, set_id,
  		     rtcfg_namespace,
  		     set_id, node->no_id, ssy_seqno, ssy_minxid, ssy_maxxid, ssy_xip,

From cbbrowne at lists.slony.info  Wed Feb 28 14:07:51 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Wed Feb 28 14:07:53 2007
Subject: [Slony1-commit] slony1-engine RELEASE-1.1.7
Message-ID: <20070228220751.26D85290251@main>

Update of /home/cvsd/slony1/slony1-engine
In directory main:/tmp/cvs-serv3776

Modified Files:
      Tag: REL_1_1_STABLE
	RELEASE-1.1.7 
Log Message:
- When you run MOVE SET, this populates sl_setsync for the moved set
  even on nodes that are not subscribed.  If, subsequent to doing this, 
  you attempt a SUBSCRIBE SET for a formerly-unsubscribed node, the
  subscription will fail right at the end when the slon tries to insert a
  new value to sl_setsync.

  The fix: DELETE from sl_setsync immediately before the INSERT.  This
  will silently blow away any 'offending' sl_setsync row.

As observed by Afilias staff...


Index: RELEASE-1.1.7
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/Attic/RELEASE-1.1.7,v
retrieving revision 1.1.2.4
retrieving revision 1.1.2.5
diff -C2 -d -r1.1.2.4 -r1.1.2.5
*** RELEASE-1.1.7	8 Feb 2007 22:52:40 -0000	1.1.2.4
--- RELEASE-1.1.7	28 Feb 2007 22:07:49 -0000	1.1.2.5
***************
*** 32,33 ****
--- 32,44 ----
  processing MOVE SET event in PG v8.2 (not to say that Slony-I 1.1 now
  *supports* 8.2; it does not)
+ 
+ - When you run MOVE SET, this populates sl_setsync for the moved set
+   even on nodes that are not subscribed.  If, subsequent to doing this, 
+   you attempt a SUBSCRIBE SET for a formerly-unsubscribed node, the
+   subscription will fail right at the end when the slon tries to insert a
+   new value to sl_setsync.
+ 
+   The fix: DELETE from sl_setsync immediately before the INSERT.  This
+   will silently blow away any 'offending' sl_setsync row.
+ 
+   (As observed by Afilias staff...)
\ No newline at end of file

From cbbrowne at lists.slony.info  Wed Feb 28 14:07:51 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Wed Feb 28 14:07:53 2007
Subject: [Slony1-commit] slony1-engine/src/slonik slonik.c
Message-ID: <20070228220751.600952903B3@main>

Update of /home/cvsd/slony1/slony1-engine/src/slonik
In directory main:/tmp/cvs-serv3776/src/slonik

Modified Files:
      Tag: REL_1_1_STABLE
	slonik.c 
Log Message:
- When you run MOVE SET, this populates sl_setsync for the moved set
  even on nodes that are not subscribed.  If, subsequent to doing this, 
  you attempt a SUBSCRIBE SET for a formerly-unsubscribed node, the
  subscription will fail right at the end when the slon tries to insert a
  new value to sl_setsync.

  The fix: DELETE from sl_setsync immediately before the INSERT.  This
  will silently blow away any 'offending' sl_setsync row.

As observed by Afilias staff...


Index: slonik.c
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/slonik/slonik.c,v
retrieving revision 1.42.2.7
retrieving revision 1.42.2.8
diff -C2 -d -r1.42.2.7 -r1.42.2.8
*** slonik.c	5 Feb 2007 22:03:30 -0000	1.42.2.7
--- slonik.c	28 Feb 2007 22:07:49 -0000	1.42.2.8
***************
*** 2747,2751 ****
  
  	/*
! 	 * Wait until all slon replication engines that where running have
  	 * restarted.
  	 */
--- 2747,2751 ----
  
  	/*
! 	 * Wait until all slon replication engines that were running have
  	 * restarted.
  	 */

From cbbrowne at lists.slony.info  Wed Feb 28 14:08:34 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Wed Feb 28 14:08:36 2007
Subject: [Slony1-commit] slony1-engine RELEASE-1.2.7
Message-ID: <20070228220834.89B2E290014@main>

Update of /home/cvsd/slony1/slony1-engine
In directory main:/tmp/cvs-serv3829

Modified Files:
      Tag: REL_1_2_STABLE
	RELEASE-1.2.7 
Log Message:
- When you run MOVE SET, this populates sl_setsync for the moved set
  even on nodes that are not subscribed.  If, subsequent to doing this, 
  you attempt a SUBSCRIBE SET for a formerly-unsubscribed node, the
  subscription will fail right at the end when the slon tries to insert a
  new value to sl_setsync.

  The fix: DELETE from sl_setsync immediately before the INSERT.  This
  will silently blow away any 'offending' sl_setsync row.

As observed by Afilias staff...


Index: RELEASE-1.2.7
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/Attic/RELEASE-1.2.7,v
retrieving revision 1.1.2.5
retrieving revision 1.1.2.6
diff -C2 -d -r1.1.2.5 -r1.1.2.6
*** RELEASE-1.2.7	16 Feb 2007 23:36:18 -0000	1.1.2.5
--- RELEASE-1.2.7	28 Feb 2007 22:08:32 -0000	1.1.2.6
***************
*** 32,33 ****
--- 32,44 ----
  - Added documentation of an issue surrounding NULLABLE columns to the
  log analysis chapter of the admin guide and to the UPGRADING docs.
+ 
+ - When you run MOVE SET, this populates sl_setsync for the moved set
+   even on nodes that are not subscribed.  If, subsequent to doing this, 
+   you attempt a SUBSCRIBE SET for a formerly-unsubscribed node, the
+   subscription will fail right at the end when the slon tries to insert a
+   new value to sl_setsync.
+ 
+   The fix: DELETE from sl_setsync immediately before the INSERT.  This
+   will silently blow away any 'offending' sl_setsync row.
+ 
+   (As observed by Afilias staff...)
\ No newline at end of file

From cbbrowne at lists.slony.info  Wed Feb 28 14:08:34 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Wed Feb 28 14:08:36 2007
Subject: [Slony1-commit] slony1-engine/src/slon remote_worker.c
Message-ID: <20070228220834.BC2E22903B0@main>

Update of /home/cvsd/slony1/slony1-engine/src/slon
In directory main:/tmp/cvs-serv3829/src/slon

Modified Files:
      Tag: REL_1_2_STABLE
	remote_worker.c 
Log Message:
- When you run MOVE SET, this populates sl_setsync for the moved set
  even on nodes that are not subscribed.  If, subsequent to doing this, 
  you attempt a SUBSCRIBE SET for a formerly-unsubscribed node, the
  subscription will fail right at the end when the slon tries to insert a
  new value to sl_setsync.

  The fix: DELETE from sl_setsync immediately before the INSERT.  This
  will silently blow away any 'offending' sl_setsync row.

As observed by Afilias staff...


Index: remote_worker.c
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/slon/remote_worker.c,v
retrieving revision 1.124.2.10
retrieving revision 1.124.2.11
diff -C2 -d -r1.124.2.10 -r1.124.2.11
*** remote_worker.c	8 Feb 2007 18:42:38 -0000	1.124.2.10
--- remote_worker.c	28 Feb 2007 22:08:32 -0000	1.124.2.11
***************
*** 3865,3875 ****
  	 */
  	slon_mkquery(&query1,
! 				 "insert into %s.sl_setsync "
! 				 "    (ssy_setid, ssy_origin, ssy_seqno, "
! 				 "     ssy_minxid, ssy_maxxid, ssy_xip, ssy_action_list) "
  				 "    values ('%d', '%d', '%s', '%s', '%s', '%q', '%q'); ",
! 				 rtcfg_namespace,
! 			 set_id, node->no_id, ssy_seqno, ssy_minxid, ssy_maxxid, ssy_xip,
! 				 dstring_data(&ssy_action_list));
  	PQclear(res1);
  	dstring_free(&ssy_action_list);
--- 3865,3877 ----
  	 */
  	slon_mkquery(&query1,
! 		     "delete from %s.sl_setsync where ssy_setid = %d;"
! 		     "insert into %s.sl_setsync "
! 		     "    (ssy_setid, ssy_origin, ssy_seqno, "
! 		     "     ssy_minxid, ssy_maxxid, ssy_xip, ssy_action_list) "
  				 "    values ('%d', '%d', '%s', '%s', '%s', '%q', '%q'); ",
! 		     rtcfg_namespace, set_id,
! 		     rtcfg_namespace,
! 		     set_id, node->no_id, ssy_seqno, ssy_minxid, ssy_maxxid, ssy_xip,
! 		     dstring_data(&ssy_action_list));
  	PQclear(res1);
  	dstring_free(&ssy_action_list);

From cbbrowne at lists.slony.info  Wed Feb 28 14:09:22 2007
From: cbbrowne at lists.slony.info (Chris Browne)
Date: Wed Feb 28 14:09:23 2007
Subject: [Slony1-commit] slony1-engine/src/slon remote_worker.c
Message-ID: <20070228220922.DA31F2903B0@main>

Update of /home/cvsd/slony1/slony1-engine/src/slon
In directory main:/tmp/cvs-serv3863/src/slon

Modified Files:
	remote_worker.c 
Log Message:
- When you run MOVE SET, this populates sl_setsync for the moved set
  even on nodes that are not subscribed.  If, subsequent to doing this, 
  you attempt a SUBSCRIBE SET for a formerly-unsubscribed node, the
  subscription will fail right at the end when the slon tries to insert a
  new value to sl_setsync.

  The fix: DELETE from sl_setsync immediately before the INSERT.  This
  will silently blow away any 'offending' sl_setsync row.

As observed by Afilias staff...


Index: remote_worker.c
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/slon/remote_worker.c,v
retrieving revision 1.133
retrieving revision 1.134
diff -C2 -d -r1.133 -r1.134
*** remote_worker.c	6 Feb 2007 21:03:11 -0000	1.133
--- remote_worker.c	28 Feb 2007 22:09:20 -0000	1.134
***************
*** 3862,3872 ****
  	 */
  	slon_mkquery(&query1,
! 				 "insert into %s.sl_setsync "
! 				 "    (ssy_setid, ssy_origin, ssy_seqno, "
! 				 "     ssy_minxid, ssy_maxxid, ssy_xip, ssy_action_list) "
! 				 "    values ('%d', '%d', '%s', '%s', '%s', '%q', '%q'); ",
! 				 rtcfg_namespace,
! 			 set_id, node->no_id, ssy_seqno, ssy_minxid, ssy_maxxid, ssy_xip,
! 				 dstring_data(&ssy_action_list));
  	PQclear(res1);
  	dstring_free(&ssy_action_list);
--- 3862,3874 ----
  	 */
  	slon_mkquery(&query1,
! 		     "delete from %s.sl_setsync where ssy_setid = %d;"
! 		     "insert into %s.sl_setsync "
! 		     "    (ssy_setid, ssy_origin, ssy_seqno, "
! 		     "     ssy_minxid, ssy_maxxid, ssy_xip, ssy_action_list) "
! 		     "    values ('%d', '%d', '%s', '%s', '%s', '%q', '%q'); ",
! 		     rtcfg_namespace, set_id,
! 		     rtcfg_namespace,
! 		     set_id, node->no_id, ssy_seqno, ssy_minxid, ssy_maxxid, ssy_xip,
! 		     dstring_data(&ssy_action_list));
  	PQclear(res1);
  	dstring_free(&ssy_action_list);

