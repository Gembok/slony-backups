From stephane.schildknecht at postgresqlfr.org  Mon Aug  3 06:03:57 2009
From: stephane.schildknecht at postgresqlfr.org (=?ISO-8859-15?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Mon Aug  3 06:04:09 2009
Subject: [Slony1-general] new scripts for slony1-ctl?
In-Reply-To: <200907282223.50927.guillaume@lelarge.info>
References: <7B0C8A37-D52C-4470-8D6C-BBB7C096A064@richyen.com>	<200907282152.38348.guillaume@lelarge.info>	<33905A78-90A5-43FF-A549-F4FC74CCED1B@richyen.com>
	<200907282223.50927.guillaume@lelarge.info>
Message-ID: <4A76E03D.5010308@postgresqlfr.org>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Guillaume Lelarge a ?crit :
> Le mardi 28 juillet 2009 ? 21:58:42, Richard Yen a ?crit :
>> ok, that's the first thing I did, but haven't heard any
>> acknowledgement from him in a week.  Guess he might be busy or
>> something.
>>
> 
> He was on holiday.
> 
> 

Hi,

True, I was on holiday. Once back, I had to deal with an impressiv amount of
unread messages.

That may explain I did not see this one until today...

So, yes, I'm interested.

BTW, one could alse use 92_exec_fail.sh to drop a node. Indeed, this script has
been written to drop the failed node if this one is not master for a replication.

You just have to omit the "backup node" paramater in script call.

Best regards,
- --
St?phane Schildknecht
PostgreSQLFr - http://www.postgresql.fr
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFKduA9A+REPKWGI0ERAvJVAKCjqECa+v5ORPGm7HDSuXXPZhV0pQCgp0rG
i2/uZPKm0624/07vGK9ZlEc=
=RTuZ
-----END PGP SIGNATURE-----
From DSasikumar at intelligent-addressing.co.uk  Mon Aug  3 07:05:02 2009
From: DSasikumar at intelligent-addressing.co.uk (Don Sasikumar)
Date: Mon Aug  3 07:05:11 2009
Subject: [Slony1-general] Replication not happening on Windows VISTA
In-Reply-To: <4A76E03D.5010308@postgresqlfr.org>
References: <7B0C8A37-D52C-4470-8D6C-BBB7C096A064@richyen.com>	<200907282152.38348.guillaume@lelarge.info>	<33905A78-90A5-43FF-A549-F4FC74CCED1B@richyen.com><200907282223.50927.guillaume@lelarge.info>
	<4A76E03D.5010308@postgresqlfr.org>
Message-ID: <274BA771880F684D9CC7E88C5C29E9D901016895@hermod.intelligent-addressing.co.uk>

Hi All,

I have following the procedures mentioned in the example

http://www.pgadmin.org/docs/1.8/slony-example.html

to create a Master and 2 slave dbs with one master cluster called
M_Cluster.
After setting the path and replication set, when i start the service
using 
the command...

net start Slony-I

the replication does not happen. BY replication, what I mean is that the
data
updates in my master table is not shown in the corresponding tables
created in
the slaveDBs.

Only the tables in the master db contains data. I had created the slave
DBs with the same schema
Name and table name with no data in them.

I expected the data to be replicated along with the other updates made
to the master db.

All I could find is a new schema created in 2 slaves as well as in the
masterdb with the name of the cluster (M_Cluster)
With some tables in it. The replication is not happening. Please advise
what needs to be done.

I am using Postgres 8.3.7, Slony-I 1.2.16 and pgAdmin 3. Screenshot
attached..

Regards,
Don




Intelligent Addressing Ltd. Registered Office: 1 Adam Street, London WC2N 6DD Reg. in England No.3863861 VAT No.GB 802258946

This message has been scanned for viruses by BlackSpider MailControl - www.blackspider.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Slony.jpg
Type: image/jpeg
Size: 27807 bytes
Desc: Slony.jpg
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20090803/6bf2e0f7/Slony-0001.jpg
From DSasikumar at intelligent-addressing.co.uk  Mon Aug  3 09:14:30 2009
From: DSasikumar at intelligent-addressing.co.uk (Don Sasikumar)
Date: Mon Aug  3 09:14:53 2009
Subject: [Slony1-general] Windows Event Log Error
Message-ID: <274BA771880F684D9CC7E88C5C29E9D901016916@hermod.intelligent-addressing.co.uk>

When I start my replication service on Windows VISTA, I get the
following error in the window console.

 

"

The description for Event ID 0 from source Slony cannot be found. Either
the component that raises this event is not installed on your local
computer or the installation is corrupted. You can install or repair the
component on the local computer.

 

If the event originated on another computer, the display information had
to be saved with the event.

 

The following information was included with the event: 

 

ERROR  remoteWorkerThread_1: "select "_M_Cluster".setAddTable_int(1, 1,
'"nlpg_schema"."authority"', 'authority_pkey', ''); " PGRES_FATAL_ERROR
ERROR:  Slony-I: setAddTable_int: table id 1 has already been assigned!

 

"

Could anyone please throw some light on this? The replication does not
seems to happen.

 

 

Thanks,

Don Sasikumar

Web Systems Developer

 



Intelligent Addressing Ltd. Registered Office: 1 Adam Street, London WC2N 6DD Reg. in England No.3863861 VAT No.GB 802258946

This message has been scanned for viruses by BlackSpider MailControl - www.blackspider.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090803/a569597e/attachment.htm
From pavanveeradba at gmail.com  Mon Aug  3 02:06:24 2009
From: pavanveeradba at gmail.com (pavankumarveera)
Date: Mon Aug  3 13:02:42 2009
Subject: [Slony1-general] Issue with configuring Slony-I on Windows
In-Reply-To: <20090618072705.20547.qmail@f5mail-237-219.rediffmail.com>
References: <20090618072705.20547.qmail@f5mail-237-219.rediffmail.com>
Message-ID: <24787465.post@talk.nabble.com>


Hi Nishkarsh,

can you find this solution? i am also gating same error. 
please give me solution.

"Slony-I creation scripts not available; only joining possible"

Thank you 


Nishkarsh wrote:
> 
> Hello every one,
> I am using Postgres 8.3.7, on Windows XP / Vista.
> I was following the Slony-I example in the help for pgAdmin III (it is
> exactly same as one in the link you sent). I am able to perform the
> steps from 1-7. Step 8 : create Slony-I cluster i am getting a msg in
> the interface
>        "Slony-I creation script no available; only join possible"
> On doing some research i found some scripts to be copied (I was not
> able to find very clear instruction) and give slony-I path. i tried all
> that but was not able to move ahead.
> Can u plz guide me through 
> Regards
> Nishkarsh 
> 
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
> 
> 

-- 
View this message in context: http://www.nabble.com/Issue-with-configuring-Slony-I-on-Windows-tp24093522p24787465.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.

From nettreeinc at gmail.com  Tue Aug  4 01:46:32 2009
From: nettreeinc at gmail.com (roctaiwan)
Date: Tue Aug  4 01:47:06 2009
Subject: [Slony1-general] Cluster setup bash script for multi-slave envrionment
Message-ID: <24804524.post@talk.nabble.com>


I have included my cluster setup script and subscribe script . the picture
attached is the envrionment I would like to configure my cluster to. is this
correct way to setup? 
I am currently running slon V.1.2.15. is it true that I don't have to define
the "store listen" for V. 1.2 + ?


http://www.nabble.com/file/p24804524/PIC-Slony-MultiSlave.jpg 
http://www.nabble.com/file/p24804524/cluster_setup_multi_slaves.sh
cluster_setup_multi_slaves.sh 
http://www.nabble.com/file/p24804524/subscribe_multi_slave.sh
subscribe_multi_slave.sh 
-- 
View this message in context: http://www.nabble.com/Cluster-setup-bash-script-for-multi-slave-envrionment-tp24804524p24804524.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.

From peter.geoghegan86 at gmail.com  Tue Aug  4 01:52:06 2009
From: peter.geoghegan86 at gmail.com (Peter Geoghegan)
Date: Tue Aug  4 01:52:39 2009
Subject: [Slony1-general] Windows Event Log Error
In-Reply-To: <274BA771880F684D9CC7E88C5C29E9D901016916@hermod.intelligent-addressing.co.uk>
References: <274BA771880F684D9CC7E88C5C29E9D901016916@hermod.intelligent-addressing.co.uk>
Message-ID: <db471ace0908040152s16d355f8wc673f82f68b024c3@mail.gmail.com>

You've already assigned a table as table 1 of your set. Each set's
table must have a unique id.

If you would actually include relevant details like the events leading
up to you getting this error message ( are you using PgAdminIII or
writing a slonik script? What does your slonik script consist of?) we
might be able to help you.

Regards,
Peter Geoghegan
From DSasikumar at intelligent-addressing.co.uk  Tue Aug  4 02:00:32 2009
From: DSasikumar at intelligent-addressing.co.uk (Don Sasikumar)
Date: Tue Aug  4 02:04:18 2009
Subject: [Slony1-general] Windows Event Log Error
In-Reply-To: <db471ace0908040152s16d355f8wc673f82f68b024c3@mail.gmail.com>
References: <274BA771880F684D9CC7E88C5C29E9D901016916@hermod.intelligent-addressing.co.uk>
	<db471ace0908040152s16d355f8wc673f82f68b024c3@mail.gmail.com>
Message-ID: <274BA771880F684D9CC7E88C5C29E9D90101696C@hermod.intelligent-addressing.co.uk>

Hi Peter,


Thanks for replying. I am not using any Slonik script.
I am using pgAdminIII.

When I add tables to one replication set, all the tables get the same ID
as the replication set.
Does that mean if you need to replicate 8 tables, we need to create 8
replication sets to make sure that each table has a unique id?

Regards,
Don

-----Original Message-----
From: Peter Geoghegan [mailto:peter.geoghegan86@gmail.com] 
Sent: 04 August 2009 09:52
To: Don Sasikumar; slony1-general@lists.slony.info
Subject: Re: [Slony1-general] Windows Event Log Error

You've already assigned a table as table 1 of your set. Each set's
table must have a unique id.

If you would actually include relevant details like the events leading
up to you getting this error message ( are you using PgAdminIII or
writing a slonik script? What does your slonik script consist of?) we
might be able to help you.

Regards,
Peter Geoghegan


Intelligent Addressing Ltd. Registered Office: 1 Adam Street, London WC2N 6DD Reg. in England No.3863861 VAT No.GB 802258946

This message has been scanned for viruses by BlackSpider MailControl - www.blackspider.com
From peter.geoghegan86 at gmail.com  Tue Aug  4 02:23:38 2009
From: peter.geoghegan86 at gmail.com (Peter Geoghegan)
Date: Tue Aug  4 02:24:11 2009
Subject: [Slony1-general] Windows Event Log Error
In-Reply-To: <274BA771880F684D9CC7E88C5C29E9D90101696C@hermod.intelligent-addressing.co.uk>
References: <274BA771880F684D9CC7E88C5C29E9D901016916@hermod.intelligent-addressing.co.uk>
	<db471ace0908040152s16d355f8wc673f82f68b024c3@mail.gmail.com>
	<274BA771880F684D9CC7E88C5C29E9D90101696C@hermod.intelligent-addressing.co.uk>
Message-ID: <db471ace0908040223r6b9b89f3xd0b670c6cbe1b1c3@mail.gmail.com>

> When I add tables to one replication set, all the tables get the same ID
> as the replication set.
> Does that mean if you need to replicate 8 tables, we need to create 8
> replication sets to make sure that each table has a unique id?
>
> Regards,
> Don
>

No.

Each set has an ID. Each table of that set has its own id, unique to
that set. I doubt you'll need more than one set. I seem to recall that
if you don't specify the table id in PgAdminIII when adding a table to
a set, it will just give you the next available one.

Regards,
Peter Geoghegan
From sweta.mulgavker at gmail.com  Tue Aug  4 02:33:57 2009
From: sweta.mulgavker at gmail.com (Sweta Mulgavker)
Date: Tue Aug  4 02:34:34 2009
Subject: [Slony1-general] Stop Slon
Message-ID: <4077e7710908040233pb860ab2m8714931cf6e80e45@mail.gmail.com>

Hello ,

Can anyone tell me how to stop slony....

I tried slon_kill but it says

bash-3.2$ /usr/bin/slon_kill
slon_kill.pl...   Killing all slon and slon_watchdog instances for the
cluster replication
1.  Kill slon watchdogs
No watchdogs found

2. Kill slon processes
No slon processes found


i have started the replication daemons on master & slave by using following
command

On master run
/usr/local/pgsql/bin/slon $CLUSTERNAME "dbname=3D$MASTERDBNAME user=3D$MAST=
ERDBA
host=3D$MASTERHOST port=3D$MASTERPORT" > slon.log &

On slave run
/usr/local/pgsql/bin/slon $CLUSTERNAME "dbname=3D$SLAVEDBNAME user=3D$SLAVE=
DBA
host=3D$SLAVEHOST port=3D$SLAVEPORT" > slon.log &




Now I dont know how to stop it ...

Regards ,
Sweta.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090804/=
d8d2bca6/attachment.htm
From DSasikumar at intelligent-addressing.co.uk  Tue Aug  4 02:56:54 2009
From: DSasikumar at intelligent-addressing.co.uk (Don Sasikumar)
Date: Tue Aug  4 02:58:13 2009
Subject: [Slony1-general] Windows Event Log Error
In-Reply-To: <db471ace0908040152s16d355f8wc673f82f68b024c3@mail.gmail.com>
References: <274BA771880F684D9CC7E88C5C29E9D901016916@hermod.intelligent-addressing.co.uk>
	<db471ace0908040152s16d355f8wc673f82f68b024c3@mail.gmail.com>
Message-ID: <274BA771880F684D9CC7E88C5C29E9D901016994@hermod.intelligent-addressing.co.uk>

Hi,

I have cross checked the table ids in my replication set.
Each of the 8 tables in my replication set has unique ids.
But still I am getting the same error when I start the cluster.



2009-08-04 10:45:53 GMT Daylight Time DEBUG1 copy_set 1
2009-08-04 10:45:53 GMT Daylight Time DEBUG4 version for "host=vali
port=5432 dbname=nlp user=postgres password= " is 80307
2009-08-04 10:45:53 GMT Daylight Time DEBUG1 remoteWorkerThread_1:
connected to provider DB
2009-08-04 10:45:53 GMT Daylight Time DEBUG2 remoteWorkerThread_1:
prepare to copy table "nlp_schema"."authority"
2009-08-04 10:45:53 GMT Daylight Time DEBUG3 remoteWorkerThread_1: table
"nlp_schema"."authority" does not require Slony-I serial key
2009-08-04 10:45:53 GMT Daylight Time DEBUG2 remoteWorkerThread_1:
prepare to copy table "nlp_schema"."blpu"
2009-08-04 10:45:53 GMT Daylight Time DEBUG3 remoteWorkerThread_1: table
"nlp_schema"."blpu" does not require Slony-I serial key
2009-08-04 10:45:53 GMT Daylight Time DEBUG2 remoteWorkerThread_1:
prepare to copy table "nlp_schema"."change_log"
2009-08-04 10:45:53 GMT Daylight Time DEBUG3 remoteWorkerThread_1: table
"nlp_schema"."change_log" does not require Slony-I serial key
2009-08-04 10:45:53 GMT Daylight Time DEBUG2 remoteWorkerThread_1:
prepare to copy table "nlp_schema"."lpi"
2009-08-04 10:45:53 GMT Daylight Time DEBUG3 remoteWorkerThread_1: table
"nlp_schema"."lpi" does not require Slony-I serial key
2009-08-04 10:45:53 GMT Daylight Time DEBUG2 remoteWorkerThread_1:
prepare to copy table "nlp_schema"."street"
2009-08-04 10:45:53 GMT Daylight Time DEBUG3 remoteWorkerThread_1: table
"nlp_schema"."street" does not require Slony-I serial key
2009-08-04 10:45:53 GMT Daylight Time DEBUG2 remoteWorkerThread_1:
prepare to copy table "nlp_schema"."xml_property"
2009-08-04 10:45:53 GMT Daylight Time DEBUG3 remoteWorkerThread_1: table
"nlp_schema"."xml_property" does not require Slony-I serial key
2009-08-04 10:45:53 GMT Daylight Time DEBUG2 remoteWorkerThread_1:
prepare to copy table "nlp_schema"."xml_street"
2009-08-04 10:45:53 GMT Daylight Time DEBUG3 remoteWorkerThread_1: table
"nlp_schema"."xml_street" does not require Slony-I serial key
2009-08-04 10:45:53 GMT Daylight Time DEBUG2 remoteWorkerThread_1:
prepare to copy table "nlp_schema"."xref"
2009-08-04 10:45:53 GMT Daylight Time DEBUG3 remoteWorkerThread_1: table
"nlp_schema"."xref" does not require Slony-I serial key
2009-08-04 10:45:53 GMT Daylight Time DEBUG2 remoteWorkerThread_1: all
tables for set 1 found on subscriber
2009-08-04 10:45:53 GMT Daylight Time DEBUG2 remoteWorkerThread_1: copy
table "nlp_schema"."authority"
2009-08-04 10:45:53 GMT Daylight Time DEBUG3 remoteWorkerThread_1: table
"nlp_schema"."authority" does not require Slony-I serial key
2009-08-04 10:45:53 GMT Daylight Time ERROR  remoteWorkerThread_1:
"select "_M_Cluster".setAddTable_int(1, 1, '"nlp_schema"."authority"',
'authority_pkey', ''); " PGRES_FATAL_ERROR ERROR: 
Slony-I: setAddTable_int: table id 1 has already been assigned!



The procedure I followed is --

[Postgres 8.3.7 , Slony - 1.2.16, pgAdminIII, Windows VISTA.]

1) Created  master and slave db with the same schema and same tables in
each.
   Only the master tables were loaded with data.

2) Created the master.conf and slave.conf. Registered Slony-I service
and added the 2 engines to it.

3) Created M_Cluster in master db and joined it in the slave.

4) Set the path in master and slave clusters.

5) Created one replication set in master db and added 8 tables to it
with 8 unique ids for each table.

6) Started the Slony-I service or Started the slon cluster with the
command 

slon M_Cluster "host=XXX port=5432 dbname=nlp_slave1 user=postgres
password=xxx"



Regards,
Don


-----Original Message-----
From: Peter Geoghegan [mailto:peter.geoghegan86@gmail.com] 
Sent: 04 August 2009 09:52
To: Don Sasikumar; slony1-general@lists.slony.info
Subject: Re: [Slony1-general] Windows Event Log Error

You've already assigned a table as table 1 of your set. Each set's
table must have a unique id.

If you would actually include relevant details like the events leading
up to you getting this error message ( are you using PgAdminIII or
writing a slonik script? What does your slonik script consist of?) we
might be able to help you.

Regards,
Peter Geoghegan


Intelligent Addressing Ltd. Registered Office: 1 Adam Street, London WC2N 6DD Reg. in England No.3863861 VAT No.GB 802258946

This message has been scanned for viruses by BlackSpider MailControl - www.blackspider.com
From sweta.mulgavker at gmail.com  Tue Aug  4 05:23:09 2009
From: sweta.mulgavker at gmail.com (Sweta Mulgavker)
Date: Tue Aug  4 05:23:12 2009
Subject: [Slony1-general] Primary Key Problem
Message-ID: <4077e7710908040523td9a2dc1xe72b5d943a4c0eaa@mail.gmail.com>

Hello all,

I am using slony1 1.2.16-1 on CentOS 5 and my postgres version is 8.1.11 .

Few tables in my database do not have a PRIMARY KEY.

 PGRES_FATAL_ERROR select
"_replcluster".determineIdxnameUnique('public.t_history', NULL);  - ERROR:
Slony-I: table "public"."t_history" has no primary key


Also few tables in the db have FOREIGN KEY.

PGRES_FATAL_ERROR select
"_replcluster".determineIdxnameUnique('public.t_r_off_hol_cash', NULL);  -
ERROR:  Slony-I: table "public"."t_r_off_hol_cash" has no primary key


Another problem is that few tables have combination of keys as PRIMARY KEY.

 PGRES_FATAL_ERROR select "_replcluster".setAddTable(2, 2,
'public.t_emp_leave', 'emp_leave_pk', 'parent table');  - ERROR:  Slony-I:
setAddTable(): set 2 not found


Is there any way in which slony can still replicate .. I mean without
primary keys???

If not then is there any other way???   (I cannot change the db structure ).

Thankyou in advance.

Regards,
 Sweta.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090804/=
cf929264/attachment-0001.htm
From ajs at crankycanuck.ca  Tue Aug  4 05:26:15 2009
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Tue Aug  4 05:26:27 2009
Subject: [Slony1-general] Primary Key Problem
In-Reply-To: <4077e7710908040523td9a2dc1xe72b5d943a4c0eaa@mail.gmail.com>
References: <4077e7710908040523td9a2dc1xe72b5d943a4c0eaa@mail.gmail.com>
Message-ID: <20090804122614.GA5669@shinkuro.com>

On Tue, Aug 04, 2009 at 05:53:09PM +0530, Sweta Mulgavker wrote:
> Is there any way in which slony can still replicate .. I mean without
> primary keys???

No.
 
> If not then is there any other way???   (I cannot change the db structure ).

Then you're out of luck, sorry.

A

-- 
Andrew Sullivan
ajs@crankycanuck.ca
From wmoran at potentialtech.com  Tue Aug  4 05:27:40 2009
From: wmoran at potentialtech.com (Bill Moran)
Date: Tue Aug  4 05:27:44 2009
Subject: [Slony1-general] Primary Key Problem
In-Reply-To: <4077e7710908040523td9a2dc1xe72b5d943a4c0eaa@mail.gmail.com>
References: <4077e7710908040523td9a2dc1xe72b5d943a4c0eaa@mail.gmail.com>
Message-ID: <20090804082740.924e91e7.wmoran@potentialtech.com>

In response to Sweta Mulgavker <sweta.mulgavker@gmail.com>:

> Hello all,
> 
> I am using slony1 1.2.16-1 on CentOS 5 and my postgres version is 8.1.11 .
> 
> Few tables in my database do not have a PRIMARY KEY.
> 
>  PGRES_FATAL_ERROR select
> "_replcluster".determineIdxnameUnique('public.t_history', NULL);  - ERROR:
> Slony-I: table "public"."t_history" has no primary key

Slony can not replicate without a primary key.

> Also few tables in the db have FOREIGN KEY.
> 
> PGRES_FATAL_ERROR select
> "_replcluster".determineIdxnameUnique('public.t_r_off_hol_cash', NULL);  -
> ERROR:  Slony-I: table "public"."t_r_off_hol_cash" has no primary key

This error has nothing to do with foreign keys.  It's another example of
a lack of a primary key.  Foreign keys have never hampered Slony replication
in my experience.

> Another problem is that few tables have combination of keys as PRIMARY KEY.
> 
>  PGRES_FATAL_ERROR select "_replcluster".setAddTable(2, 2,
> 'public.t_emp_leave', 'emp_leave_pk', 'parent table');  - ERROR:  Slony-I:
> setAddTable(): set 2 not found

This has nothing to do with a combination of fields making up a primary
key.  Primary keys made up of multiple fields works fine.  The error
suggests that you're skipping steps in your configuration (specifically,
you skipped the step of defining a set).

> Is there any way in which slony can still replicate .. I mean without
> primary keys???

Not that I'm aware of.

> If not then is there any other way???   (I cannot change the db structure ).

You can look at alternatives, such as pgpool or PostgreSQL native wal log
shipping.  Neither of those function quite the same as Slony, so you may
have other problems.

-- 
Bill Moran
http://www.potentialtech.com
http://people.collaborativefusion.com/~wmoran/
From devrim at gunduz.org  Tue Aug  4 05:32:57 2009
From: devrim at gunduz.org (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Tue Aug  4 05:33:54 2009
Subject: [Slony1-general] Primary Key Problem
In-Reply-To: <4077e7710908040523td9a2dc1xe72b5d943a4c0eaa@mail.gmail.com>
References: <4077e7710908040523td9a2dc1xe72b5d943a4c0eaa@mail.gmail.com>
Message-ID: <1249389177.12242.18.camel@hp-laptop2.gunduz.org>

T24gVHVlLCAyMDA5LTA4LTA0IGF0IDE3OjUzICswNTMwLCBTd2V0YSBNdWxnYXZrZXIgd3JvdGU6
Cj4gSXMgdGhlcmUgYW55IHdheSBpbiB3aGljaCBzbG9ueSBjYW4gc3RpbGwgcmVwbGljYXRlIC4u
IEkgbWVhbiB3aXRob3V0Cj4gcHJpbWFyeSBrZXlzPz8/CgpOby4gVGhpcyBpcyBob3cgU2xvbnkt
SSB3b3JrcyAtLSBpdCBuZWVkcyBhIFBLIG9uIGVhY2ggdGFibGUgdG8gYmUKcmVwbGljYXRlZC4K
LS0gCkRldnJpbSBHw5xORMOcWiwgUkhDRQpDb21tYW5kIFByb21wdCAtIGh0dHA6Ly93d3cuQ29t
bWFuZFByb21wdC5jb20gCmRldnJpbX5ndW5kdXoub3JnLCBkZXZyaW1+UG9zdGdyZVNRTC5vcmcs
IGRldnJpbS5ndW5kdXp+bGludXgub3JnLnRyCiAgICAgICAgICAgICAgICAgICBodHRwOi8vd3d3
Lmd1bmR1ei5vcmcKLS0tLS0tLS0tLS0tLS0gbmV4dCBwYXJ0IC0tLS0tLS0tLS0tLS0tCkEgbm9u
LXRleHQgYXR0YWNobWVudCB3YXMgc2NydWJiZWQuLi4KTmFtZTogbm90IGF2YWlsYWJsZQpUeXBl
OiBhcHBsaWNhdGlvbi9wZ3Atc2lnbmF0dXJlClNpemU6IDE5NyBieXRlcwpEZXNjOiBUaGlzIGlz
IGEgZGlnaXRhbGx5IHNpZ25lZCBtZXNzYWdlIHBhcnQKVXJsIDogaHR0cDovL2xpc3RzLnNsb255
LmluZm8vcGlwZXJtYWlsL3Nsb255MS1nZW5lcmFsL2F0dGFjaG1lbnRzLzIwMDkwODA0LzU1ZjVl
Y2Q2L2F0dGFjaG1lbnQucGdwCg==
From greg at endpoint.com  Tue Aug  4 07:51:53 2009
From: greg at endpoint.com (Greg Sabino Mullane)
Date: Tue Aug  4 07:52:01 2009
Subject: [Slony1-general] Primary Key Problem
In-Reply-To: <20090804082740.924e91e7.wmoran@potentialtech.com>
References: <4077e7710908040523td9a2dc1xe72b5d943a4c0eaa@mail.gmail.com>
	<20090804082740.924e91e7.wmoran@potentialtech.com>
Message-ID: <4A784B09.5040606@endpoint.com>

>> If not then is there any other way???   (I cannot change the db structur=
e ).
> =

> You can look at alternatives, such as pgpool or PostgreSQL native wal log
> shipping.  Neither of those function quite the same as Slony, so you may
> have other problems.

For the record, Bucardo requires primary keys (or their equivalent) as
well for normal replication mode, but also has a mode to do non-pk
tables. However, this mode copies the *entire* table, *every* time!
Which points out the reason for both Slony and Bucardo requiring primary
keys - knowing which row has changed is the only way to safely replicate
part of the table at a time.

So your choices are to use Slony and change the db structure (quick and
painless), don't replicate those tables at all (a pontentially bad
business decision), or add a lot of complexity and overhead, and losing
some Slony specific functionality, by going to another replication solution.

-- =

Greg Sabino Mullane greg@endpoint.com
End Point Corporation
PGP Key: 0x14964AC8

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 226 bytes
Desc: OpenPGP digital signature
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20090804=
/fb741a4e/signature.pgp
From cbbrowne at ca.afilias.info  Tue Aug  4 09:45:57 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Tue Aug  4 09:46:08 2009
Subject: [Slony1-general] Primary Key Problem
In-Reply-To: <4077e7710908040523td9a2dc1xe72b5d943a4c0eaa@mail.gmail.com>
	(Sweta Mulgavker's message of "Tue, 4 Aug 2009 17:53:09 +0530")
References: <4077e7710908040523td9a2dc1xe72b5d943a4c0eaa@mail.gmail.com>
Message-ID: <873a87il2y.fsf@dba2.int.libertyrms.com>

Sweta Mulgavker <sweta.mulgavker@gmail.com> writes:
> If not then is there any other way??? ? (I cannot change the db structure ).

If you do not even have a candidate primary key (e.g. - some set of
columns defined as NOT NULL UNIQUE), then Slony-I will not be able to
replicate the data.

If you have an ill-defined database that does not have primary keys,
and are not permitted to rectify this lack, then you have a mighty bad
problem indeed.
-- 
"cbbrowne","@","ca.afilias.info"
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"
From martins.listz at gmail.com  Tue Aug  4 16:40:34 2009
From: martins.listz at gmail.com (Martin Spinassi)
Date: Tue Aug  4 16:35:10 2009
Subject: [Slony1-general] Child terminated after queue events
Message-ID: <1249429234.15094.20.camel@kr0sty.livra.local>

Hi list!

I've been testing slony in the few past days, with some successful.

I'm using slony1-1.2.16 and two postgres databases (8.3 and 8.2),
replicating two databases. Both of them are on the same machine, but one
listens on 127.0.0.1 and the other at 127.0.0.2, and using different
ports for each one (5432 and 5433).

One database is really big (about 40G), and the other one is just a
hundred of megabytes.


I run an instance of slony for each database, and for each cluster to
replicate. A total of 4 instances of slony. Here is an example of a pair
of them:

# slon -d 1000 big_cluster dbname=big1 user=postgres host=127.0.0.1
port=5432

# slon -d 1000 big_cluster dbname=big1 user=postgres host=127.0.0.2
port=5433


The problem I see, is that at the smaller database, viewing the logs of
the connection to the database at 127.0.0.1 is this:

2009-08-04 18:30:02 CDT DEBUG2 remoteWorkerThread_1: current local
log_status is 0
2009-08-04 18:30:02 CDT DEBUG3 remoteWorkerThread_1: activate helper 1
2009-08-04 18:30:02 CDT DEBUG4 remoteWorkerThread_1: waiting for log
data
2009-08-04 18:30:02 CDT DEBUG4 remoteHelperThread_1_1: got work to do
2009-08-04 18:30:02 CDT DEBUG2 remoteWorkerThread_1_1: current remote
log_status = 0
2009-08-04 18:30:02 CDT DEBUG4 remoteHelperThread_1_1: allocate line
buffers
2009-08-04 18:30:02 CDT DEBUG4 remoteHelperThread_1_1: fetch from cursor
2009-08-04 18:30:02 CDT DEBUG2 remoteHelperThread_1_1: 0.001 seconds
delay for first row
2009-08-04 18:30:02 CDT DEBUG4 remoteHelperThread_1_1: fetched 0 log
rows
2009-08-04 18:30:02 CDT DEBUG4 remoteHelperThread_1_1: return 10 unused
line buffers
2009-08-04 18:30:02 CDT DEBUG2 remoteHelperThread_1_1: 0.001 seconds
until close cursor
2009-08-04 18:30:02 CDT DEBUG2 remoteHelperThread_1_1: inserts=0
updates=0 deletes=0
2009-08-04 18:30:02 CDT DEBUG4 remoteHelperThread_1_1: change helper
thread status
2009-08-04 18:30:02 CDT DEBUG4 remoteHelperThread_1_1: send DONE/ERROR
line to worker
2009-08-04 18:30:02 CDT DEBUG3 remoteHelperThread_1_1: waiting for
workgroup to finish
2009-08-04 18:30:02 CDT DEBUG3 remoteWorkerThread_1: helper 1 finished
2009-08-04 18:30:02 CDT DEBUG4 remoteWorkerThread_1: returning lines to
pool
2009-08-04 18:30:02 CDT DEBUG3 remoteWorkerThread_1: all helpers done.
2009-08-04 18:30:02 CDT DEBUG4 remoteWorkerThread_1: changing helper 1
to IDLE
2009-08-04 18:30:02 CDT DEBUG4 remoteWorkerThread_1: cleanup
2009-08-04 18:30:02 CDT DEBUG4 remoteHelperThread_1_1: waiting for work
2009-08-04 18:30:02 CDT DEBUG2 remoteWorkerThread_1: new sl_rowid_seq
value: 1000000000000000


Which means that it's already replicated and no more work to do has
arrived.

But when I see the output of slon replicating the big database at
127.0.0.1, this is the result:

2009-08-04 18:32:21 CDT DEBUG2 remoteListenThread_1: queue event 1,3330
SYNC
2009-08-04 18:32:21 CDT DEBUG2 remoteListenThread_1: queue event 1,3331
SYNC
2009-08-04 18:32:21 CDT DEBUG2 remoteListenThread_1: queue event 1,3332
SYNC
2009-08-04 18:32:21 CDT DEBUG2 remoteListenThread_1: queue event 1,3333
SYNC
2009-08-04 18:32:21 CDT DEBUG2 remoteWorkerThread_1: syncing set 1 with
1 table(s) from provider 1
2009-08-04 18:32:21 CDT DEBUG2 slon: child terminated status: 11; pid:
24351, current worker pid: 24351
2009-08-04 18:32:21 CDT DEBUG1 slon: restart of worker in 10 seconds



The queue event is always the last seen at the same cluster connection
to 127.0.0.2, so it never 'cuts' on the same event, it's last_event+1.



Can you give me same clue or light to this error? is it common?


Thanks!


Cheers


Martin

From sweta.mulgavker at gmail.com  Tue Aug  4 22:11:32 2009
From: sweta.mulgavker at gmail.com (Sweta Mulgavker)
Date: Tue Aug  4 22:12:00 2009
Subject: [Slony1-general] Primary Key Problem
In-Reply-To: <OF153F603C.169F78B3-ON65257608.0043FA88-65257608.00443AED@ibsplc.com>
References: <4077e7710908040523td9a2dc1xe72b5d943a4c0eaa@mail.gmail.com>
	<OF153F603C.169F78B3-ON65257608.0043FA88-65257608.00443AED@ibsplc.com>
Message-ID: <4077e7710908042211r44202246l4336bf61acb37c7f@mail.gmail.com>

On 8/4/09, Jayadevan M <Jayadevan.Maymala@ibsplc.com> wrote:
> This is how you can add tables without primary keys...
> set add table (set id=1, origin=1, id=4, fully qualified name =
> 'public.history', comment='history table', key = serial);
>
>

We are getting the following error:
PGRES_FATAL_ERROR select
"_replcluster".determineIdxnameSerial('public.t_history'),
"_replcluster".determineAttKindSerial('public.t_history');  - ERROR:
Slony-I: table "public"."t_history" does not have the serial key




Regards,
Sweta Mulgavker .
From DSasikumar at intelligent-addressing.co.uk  Wed Aug  5 01:08:45 2009
From: DSasikumar at intelligent-addressing.co.uk (Don Sasikumar)
Date: Wed Aug  5 01:09:52 2009
Subject: [Slony1-general] Error - table id 1 has already been assigned
References: <274BA771880F684D9CC7E88C5C29E9D901016916@hermod.intelligent-addressing.co.uk>
	<db471ace0908040152s16d355f8wc673f82f68b024c3@mail.gmail.com> 
Message-ID: <274BA771880F684D9CC7E88C5C29E9D901016A69@hermod.intelligent-addressing.co.uk>

Hi All,


I am trying to replicate DB in Windows VISTA using PgadminIII, Postgres
8.3.7 and Slony 1.2.16. I am not using Slonik scripts.
Although the tables in my replication set have unique ids,
when i start the service for replication, slony-I tries to execute the
command - 

select "_M_Cluster".setAddTable_int(1, 1, '"nlp_schema"."authority"',
'authority_pkey', ''); 

in the console and return with this error given below. 

2009-08-04 10:45:53 GMT Daylight Time ERROR
remoteWorkerThread_1:"select "_M_Cluster".setAddTable_int(1, 1,
'"nlp_schema"."authority"',
'authority_pkey', ''); " PGRES_FATAL_ERROR ERROR:Slony-I:
setAddTable_int: table id 1 has already been assigned!


I tried searching for the same error in slony-I documentation which says
that this error can
Occur if the primary key are not been defined as NOT NULL which I have. 
Please let me know how to resolve this issue.


Regards,
Don


Intelligent Addressing Ltd. Registered Office: 1 Adam Street, London WC2N 6DD Reg. in England No.3863861 VAT No.GB 802258946

This message has been scanned for viruses by BlackSpider MailControl - www.blackspider.com
From peter.geoghegan86 at gmail.com  Wed Aug  5 01:24:14 2009
From: peter.geoghegan86 at gmail.com (Peter Geoghegan)
Date: Wed Aug  5 01:24:48 2009
Subject: [Slony1-general] Problem with Slony-I 2.0.2, sl_status persists
Message-ID: <db471ace0908050124v3277b5e8u4ec2ecd2e8b6f4db@mail.gmail.com>

Sorry to repost the same thing, but my earlier message of July 30th
wasn't answered, and was most likely overlooked as it was part of what
was thought to be a finished thread.

It seems I was wrong when I said that the problem was
fixed. I assumed that since the event lag returned to zero when new
paths where stored per Chris Brown's direction, the problem was
corrected. However, the problem persists.

When I restart a slave database (in the following example node 2),
replication works fine (at least as far as can be immediately
observed), but sl_status shows:

1;3;38689;"2009-07-30 12:11:51.796";38688;"2009-07-30
12:12:02.428316";"2009-07-30 12:11:41.859";1;"00:00:14.015"
1;2;38689;"2009-07-30 12:11:51.796";38605;"2009-07-30
11:52:35.119048";"2009-07-30 11:58:05.734";84;"00:13:50.14"

Node 2's event lag grows and grows (until the slon service is
restarted, at which time it returns to zero, just as before).

When I run test_slony_state-dbi.pl while the event lag continues to
grow, it outputs the following:

peter@peter-development-machine:~/slony1-2.0.2/tools>
./test_slony_state-dbi.pl --host=10.0.0.80 --database=lustre
--cluster=lustre_cluster --user=postgres --password=my_password
DSN: dbi:Pg:dbname=lustre;host=10.0.0.80;user=postgres;password=my_password;
===========================
Rummage for DSNs
=============================
Query:

  select p.pa_server, p.pa_conninfo
  from "_lustre_cluster".sl_path p
--   where exists (select * from "_lustre_cluster".sl_subscribe s where
--                          (s.sub_provider = p.pa_server or
s.sub_receiver = p.pa_server) and
--                          sub_active = 't')
  group by pa_server, pa_conninfo;


Tests for node 1 - DSN = dbi:Pg:dbname=lustre host=10.0.0.80
user=postgres password=my_password
========================================
pg_listener info:
Pages: 0
Tuples: 0

Size Tests
================================================
      sl_log_1         0  0.000000
      sl_log_2         0  0.000000
     sl_seqlog         0  0.000000

Listen Path Analysis
===================================================
No problems found with sl_listen

--------------------------------------------------------------------------------
Summary of event info
 Origin  Min SYNC  Max SYNC Min SYNC Age Max SYNC Age
================================================================================
     1     38605     38699     00:00:00     00:15:00    0
     2        20        20     01:08:00     01:08:00    1
     3        30        30     01:02:00     01:02:00    1


---------------------------------------------------------------------------------
Summary of sl_confirm aging
  Origin   Receiver   Min SYNC   Max SYNC  Age of latest SYNC  Age of
eldest SYNC
=================================================================================
       1          2      38605      38605      00:20:00      00:20:00    0
       1          3      38627      38698      00:00:00      00:11:00    0
       2          1         20         20      01:03:00      01:03:00    1
       2          3         20         20      01:02:00      01:02:00    1
       3          1         30         30      01:02:00      01:02:00    1
       3          2         30         30      01:08:00      01:08:00    1


------------------------------------------------------------------------------

Listing of old open connections on node 1
      Database             PID            User    Query Age
    Query
================================================================================


Tests for node 3 - DSN = dbi:Pg:dbname=lustre_slave host=10.0.0.82
user=postgres password=my_password
========================================
pg_listener info:
Pages: 0
Tuples: 0

Size Tests
================================================
      sl_log_1         0  0.000000
      sl_log_2         0  0.000000
     sl_seqlog         0  0.000000

Listen Path Analysis
===================================================
No problems found with sl_listen

--------------------------------------------------------------------------------
Summary of event info
 Origin  Min SYNC  Max SYNC Min SYNC Age Max SYNC Age
================================================================================
     1     38605     38699     00:00:00     00:15:00    0
     2        20        20     01:08:00     01:08:00    1
     3        30        30     01:02:00     01:02:00    1


---------------------------------------------------------------------------------
Summary of sl_confirm aging
  Origin   Receiver   Min SYNC   Max SYNC  Age of latest SYNC  Age of
eldest SYNC
=================================================================================
       1          2      38605      38605      00:21:00      00:21:00    0
       1          3      38629      38699      00:00:00      00:11:00    0
       2          1         20         20      01:03:00      01:03:00    1
       2          3         20         20      01:03:00      01:03:00    1
       3          1         30         30      01:03:00      01:03:00    1
       3          2         30         30      01:08:00      01:08:00    1


------------------------------------------------------------------------------

Listing of old open connections on node 3
      Database             PID            User    Query Age
    Query
================================================================================


Tests for node 2 - DSN = dbi:Pg:dbname=lustre_slave host=10.0.0.81
user=postgres password=my_password
========================================
pg_listener info:
Pages: 0
Tuples: 0

Size Tests
================================================
      sl_log_1         0  0.000000
      sl_log_2         0  0.000000
     sl_seqlog         0  0.000000

Listen Path Analysis
===================================================
No problems found with sl_listen

--------------------------------------------------------------------------------
Summary of event info
 Origin  Min SYNC  Max SYNC Min SYNC Age Max SYNC Age
================================================================================
     1     38573     38699    -00:05:00     00:15:00    0
     2        20        21     00:15:00     01:03:00    0
     3        30        30     00:57:00     00:57:00    1


---------------------------------------------------------------------------------
Summary of sl_confirm aging
  Origin   Receiver   Min SYNC   Max SYNC  Age of latest SYNC  Age of
eldest SYNC
=================================================================================
       1          2      38607      38699      00:00:00      00:15:00    0
       1          3      38573      38698     -00:05:00      00:15:00    0
       2          1         20         20      00:57:00      00:57:00    1
       2          3         20         20      00:57:00      00:57:00    1
       3          1         30         30      00:57:00      00:57:00    1
       3          2         30         30      01:02:00      01:02:00    1


------------------------------------------------------------------------------

Listing of old open connections on node 2
      Database             PID            User    Query Age
    Query
================================================================================

peter@peter-development-machine:~/slony1-2.0.2/tools>

Any further help you could offer is greatly appreciated,

Regards,
Peter Geoghegan
From stephane.schildknecht at postgresqlfr.org  Wed Aug  5 02:20:12 2009
From: stephane.schildknecht at postgresqlfr.org (=?ISO-8859-15?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Wed Aug  5 02:20:50 2009
Subject: [Slony1-general] Cluster setup bash script for multi-slave
	envrionment
In-Reply-To: <24804524.post@talk.nabble.com>
References: <24804524.post@talk.nabble.com>
Message-ID: <4A794ECC.30607@postgresqlfr.org>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi,

roctaiwan a ?crit :
> I have included my cluster setup script and subscribe script . the picture
> attached is the envrionment I would like to configure my cluster to. is this
> correct way to setup? 
> I am currently running slon V.1.2.15. is it true that I don't have to define
> the "store listen" for V. 1.2 + ?

No, You don't have to.

But, you should store path between node 4 and node 3 (i.e. two ways). Node 4
needs to know where node 3 is, same for node 3 about node 4.

BTW, you should use slony1.2.16, if you don't have any slon 1.2.15 replication
enabled yet.

Regards,
- --
St?phane Schildknecht
PostgreSQLFr - http://www.postgresql.fr
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFKeU7MA+REPKWGI0ERArQlAJ9CaDOHOKVlQLoLVt3hbPbLW9cE8QCggFX4
iqNjKC95E7VLQqCT/10bLTw=
=Qs2J
-----END PGP SIGNATURE-----
From stephane.schildknecht at postgresqlfr.org  Wed Aug  5 02:25:41 2009
From: stephane.schildknecht at postgresqlfr.org (=?ISO-8859-15?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Wed Aug  5 02:26:16 2009
Subject: [Slony1-general] Primary Key Problem
In-Reply-To: <4077e7710908040523td9a2dc1xe72b5d943a4c0eaa@mail.gmail.com>
References: <4077e7710908040523td9a2dc1xe72b5d943a4c0eaa@mail.gmail.com>
Message-ID: <4A795015.90105@postgresqlfr.org>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi,

Sweta Mulgavker a ?crit :
> Hello all,
> 
> I am using slony1 1.2.16-1 on CentOS 5 and my postgres version is 8.1.11 .
> 
> Few tables in my database do not have a PRIMARY KEY.
> 
(...)
> If not then is there any other way???   (I cannot change the db structure ).

Maybe you could use surrogate key ? By adding an new column, designed as a
serial, which would be automatically incremented?

That does imply that all of your queries are correctly written, and that you
don't have duplicate rows in tables without primary key.

Regards,
- --
St?phane Schildknecht
PostgreSQLFr - http://www.postgresql.fr
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFKeVAVA+REPKWGI0ERAkI9AJ9m/p8KHDOv482pO168q1cTMe6RHgCg08vq
ZzxEYn3EklE6Gj9DwpS1lkI=
=P4XX
-----END PGP SIGNATURE-----
From sweta.mulgavker at gmail.com  Wed Aug  5 03:58:19 2009
From: sweta.mulgavker at gmail.com (Sweta Mulgavker)
Date: Wed Aug  5 03:58:56 2009
Subject: [Slony1-general] Primary Key Problem
In-Reply-To: <4A795015.90105@postgresqlfr.org>
References: <4077e7710908040523td9a2dc1xe72b5d943a4c0eaa@mail.gmail.com>
	<4A795015.90105@postgresqlfr.org>
Message-ID: <4077e7710908050358y18a2fd49k8941e66c75a574c3@mail.gmail.com>

hello all,

I have added a new columns  "SERIAL"  which auto increment  to the tables
which do not have a primary key... Also new sequence tables have got created
automatically....

Now the problem is only few tables are getting replicated ... And the
database is not in sync...

At first I had added only one table to the set for replication which still
gets replicated but other tables which I have added after adding the serial
key are not getting replicated...

I cannot figure out why :(
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090805/=
f8aa5c8b/attachment-0001.htm
From stephane.schildknecht at postgresqlfr.org  Wed Aug  5 08:03:06 2009
From: stephane.schildknecht at postgresqlfr.org (=?ISO-8859-15?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Wed Aug  5 08:03:14 2009
Subject: [Slony1-general] Primary Key Problem
In-Reply-To: <4077e7710908050358y18a2fd49k8941e66c75a574c3@mail.gmail.com>
References: <4077e7710908040523td9a2dc1xe72b5d943a4c0eaa@mail.gmail.com>	
	<4A795015.90105@postgresqlfr.org>
	<4077e7710908050358y18a2fd49k8941e66c75a574c3@mail.gmail.com>
Message-ID: <4A799F2A.5030503@postgresqlfr.org>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Sweta Mulgavker a ?crit :
> hello all,
> 
> I have added a new columns  "SERIAL"  which auto increment  to the
> tables which do not have a primary key... Also new sequence tables have
> got created automatically....
> 
> Now the problem is only few tables are getting replicated ... And the
> database is not in sync...
> 
> At first I had added only one table to the set for replication which
> still gets replicated but other tables which I have added after adding
> the serial key are not getting replicated...
> 
> I cannot figure out why :(
> 
> 

Could you give us any clue ?
Any message in log files ?

- --
St?phane Schildknecht
PostgreSQLFr - http://www.postgresql.fr
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFKeZ8qA+REPKWGI0ERAnTSAJwOl67cbWj8qNVaiornmQjvWb98nACgxwaT
I1TpiBAe1oITyTVN28Qmia8=
=INgU
-----END PGP SIGNATURE-----
From nettreeinc at gmail.com  Wed Aug  5 23:58:53 2009
From: nettreeinc at gmail.com (roctaiwan)
Date: Wed Aug  5 23:59:30 2009
Subject: [Slony1-general] Cluster setup bash script for multi-slave
	envrionment
In-Reply-To: <4A794ECC.30607@postgresqlfr.org>
References: <24804524.post@talk.nabble.com> <4A794ECC.30607@postgresqlfr.org>
Message-ID: <24840619.post@talk.nabble.com>


after I run my cluster setup script and subscribe script it shown:

-bash-3.2$ ./subscribe_multi_slave.sh
<stdin>:31: PGRES_FATAL_ERROR select "_contactdb_cluster".subscribeSet(1, 3,
4, 't');  - ERROR:  Slony-I: subscribeSet(): provider 3 is not an active
forwarding node for replication set 1


what's wrong? is this error caused by my cluster setup script or subscript
script?

I have question on this line in my subscribe.sh: subscribe set (id = 1,
provider = 1, receiver = 4, forward = yes);

should I set forward= yes or no? also if I want to get datas from Master
then I set provider=1 if I want my Node 4 receive datas from Node3 then I
set provider=3 receiver=4 is that correct? 



&quot;St?phane A. Schildknecht&quot; wrote:
> 
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> Hi,
> 
> roctaiwan a ?crit :
>> I have included my cluster setup script and subscribe script . the
>> picture
>> attached is the envrionment I would like to configure my cluster to. is
>> this
>> correct way to setup? 
>> I am currently running slon V.1.2.15. is it true that I don't have to
>> define
>> the "store listen" for V. 1.2 + ?
> 
> No, You don't have to.
> 
> But, you should store path between node 4 and node 3 (i.e. two ways). Node
> 4
> needs to know where node 3 is, same for node 3 about node 4.
> 
> BTW, you should use slony1.2.16, if you don't have any slon 1.2.15
> replication
> enabled yet.
> 
> Regards,
> - --
> St?phane Schildknecht
> PostgreSQLFr - http://www.postgresql.fr
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.6 (GNU/Linux)
> Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org
> 
> iD8DBQFKeU7MA+REPKWGI0ERArQlAJ9CaDOHOKVlQLoLVt3hbPbLW9cE8QCggFX4
> iqNjKC95E7VLQqCT/10bLTw=
> =Qs2J
> -----END PGP SIGNATURE-----
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
> 
> 

-- 
View this message in context: http://www.nabble.com/Cluster-setup-bash-script-for-multi-slave-envrionment-tp24804524p24840619.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.

From nettreeinc at gmail.com  Thu Aug  6 00:10:21 2009
From: nettreeinc at gmail.com (roctaiwan)
Date: Thu Aug  6 00:10:57 2009
Subject: [Slony1-general] Stop Slon
In-Reply-To: <4077e7710908040233pb860ab2m8714931cf6e80e45@mail.gmail.com>
References: <4077e7710908040233pb860ab2m8714931cf6e80e45@mail.gmail.com>
Message-ID: <24840623.post@talk.nabble.com>


for me, I find the slon PID first and kill it by it's PID #. 

To find out your PID, su postgres first then type: ps -ef | grep slon

u may have 3 PID#'s but I usually choose the number shown in between. Find
the PID# then do: kill (pid#) until it got killed off.



Sweta Mulgavker wrote:
> 
> Hello ,
> 
> Can anyone tell me how to stop slony....
> 
> I tried slon_kill but it says
> 
> bash-3.2$ /usr/bin/slon_kill
> slon_kill.pl...   Killing all slon and slon_watchdog instances for the
> cluster replication
> 1.  Kill slon watchdogs
> No watchdogs found
> 
> 2. Kill slon processes
> No slon processes found
> 
> 
> i have started the replication daemons on master & slave by using
> following
> command
> 
> On master run
> /usr/local/pgsql/bin/slon $CLUSTERNAME "dbname=$MASTERDBNAME
> user=$MASTERDBA
> host=$MASTERHOST port=$MASTERPORT" > slon.log &
> 
> On slave run
> /usr/local/pgsql/bin/slon $CLUSTERNAME "dbname=$SLAVEDBNAME user=$SLAVEDBA
> host=$SLAVEHOST port=$SLAVEPORT" > slon.log &
> 
> 
> 
> 
> Now I dont know how to stop it ...
> 
> Regards ,
> Sweta.
> 
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
> 
> 

-- 
View this message in context: http://www.nabble.com/Stop-Slon-tp24805270p24840623.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.

From stephane.schildknecht at postgresqlfr.org  Thu Aug  6 00:25:27 2009
From: stephane.schildknecht at postgresqlfr.org (=?ISO-8859-15?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Thu Aug  6 00:26:02 2009
Subject: [Slony1-general] Cluster setup bash script for
	multi-slave	envrionment
In-Reply-To: <24840619.post@talk.nabble.com>
References: <24804524.post@talk.nabble.com> <4A794ECC.30607@postgresqlfr.org>
	<24840619.post@talk.nabble.com>
Message-ID: <4A7A8567.4010801@postgresqlfr.org>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi,

roctaiwan a ?crit :
> after I run my cluster setup script and subscribe script it shown:
> 
> -bash-3.2$ ./subscribe_multi_slave.sh
> <stdin>:31: PGRES_FATAL_ERROR select "_contactdb_cluster".subscribeSet(1, 3,
> 4, 't');  - ERROR:  Slony-I: subscribeSet(): provider 3 is not an active
> forwarding node for replication set 1
> 
> 
> what's wrong? is this error caused by my cluster setup script or subscript
> script?

It may be that Node 3 has not finished subscribing when you subscribe Node4 on it.

> 
> I have question on this line in my subscribe.sh: subscribe set (id = 1,
> provider = 1, receiver = 4, forward = yes);
> 
> should I set forward= yes or no? also if I want to get datas from Master
> then I set provider=1 if I want my Node 4 receive datas from Node3 then I
> set provider=3 receiver=4 is that correct? 
> 

The forward option lets you use that node as a provider for another one.

IIRC, Node4 is at the end, so you don't need the forward option on it. Node1
and 3 surely need it.

Regards,
- --
St?phane Schildknecht
PostgreSQLFr - http://www.postgresql.fr
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFKeoVnA+REPKWGI0ERAorhAKCK//KlLiv/qS+uYTyyWklkm7ZoZQCg0OXa
LhQ5dvlYusGOs0zBujDFF6A=
=ZnlD
-----END PGP SIGNATURE-----
From sweta.mulgavker at gmail.com  Fri Aug  7 02:22:24 2009
From: sweta.mulgavker at gmail.com (Sweta Mulgavker)
Date: Fri Aug  7 02:23:03 2009
Subject: [Slony1-general] Alter table commands not replicating
Message-ID: <4077e7710908070222n1ffe565dm7bfd2014f1531378@mail.gmail.com>

Hello all,

In my slony setup... I am replicating one master slave pair.
Data is replicating fine... but if I try to alter one table while slony is
running the updated table is not replicated in slave db....

My question is ...

If while running slony we alter any table structure in the master db then do
these changes get replicated on the slave too? I was trying to add new
cloumn  to one of the table.

Or do we have to take a manual dump and restore the schema again on slave?

Regards,
Sweta
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090807/=
43d954e4/attachment.htm
From glynastill at yahoo.co.uk  Fri Aug  7 02:29:23 2009
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Fri Aug  7 02:30:02 2009
Subject: [Slony1-general] Alter table commands not replicating
In-Reply-To: <4077e7710908070222n1ffe565dm7bfd2014f1531378@mail.gmail.com>
References: <4077e7710908070222n1ffe565dm7bfd2014f1531378@mail.gmail.com>
Message-ID: <146670.19804.qm@web23603.mail.ird.yahoo.com>

SGkgU3dldGEsCgpZb3Ugc2hvdWxkIHJ1biB5b3VyIGNoYW5nZXMgdGhyb3VnaCBzbG9uaWsKCmh0
dHA6Ly93d3cuc2xvbnkuaW5mby9kb2N1bWVudGF0aW9uL3N0bXRkZGxzY3JpcHQuaHRtbAoKR2x5
bgoKCgo+Cj5Gcm9tOiBTd2V0YSBNdWxnYXZrZXIgPHN3ZXRhLm11bGdhdmtlckBnbWFpbC5jb20+
Cj5Ubzogc2xvbnkxLWdlbmVyYWwgPHNsb255MS1nZW5lcmFsQGxpc3RzLnNsb255LmluZm8+Cj5T
ZW50OiBGcmlkYXksIDcgQXVndXN0LCAyMDA5IDEwOjIyOjI0Cj5TdWJqZWN0OiBbU2xvbnkxLWdl
bmVyYWxdIEFsdGVyIHRhYmxlIGNvbW1hbmRzIG5vdCByZXBsaWNhdGluZwo+Cj5IZWxsbyBhbGws
Cj4KPkluIG15IHNsb255IHNldHVwLi4uIEkgYW0gcmVwbGljYXRpbmcgb25lIG1hc3RlciBzbGF2
ZSBwYWlyLgo+RGF0YSBpcyByZXBsaWNhdGluZyBmaW5lLi4uIGJ1dCBpZiBJIHRyeSB0byBhbHRl
ciBvbmUgdGFibGUgd2hpbGUgc2xvbnkgaXMgcnVubmluZyB0aGUgdXBkYXRlZCB0YWJsZSBpcyBu
b3QgcmVwbGljYXRlZCBpbiBzbGF2ZSBkYi4uLi4KPgo+Pk15IHF1ZXN0aW9uIGlzIC4uLgo+Cj5J
ZiB3aGlsZSBydW5uaW5nIHNsb255IHdlIGFsdGVyIGFueSB0YWJsZSBzdHJ1Y3R1cmUgaW4gdGhl
IG1hc3RlciBkYiB0aGVuIGRvIHRoZXNlIGNoYW5nZXMgZ2V0IHJlcGxpY2F0ZWQgb24gdGhlIHNs
YXZlIHRvbz8gSSB3YXMgdHJ5aW5nIHRvIGFkZCBuZXcgY2xvdW1uICB0byBvbmUgb2YgdGhlIHRh
YmxlLgo+Cj5PciBkbyB3ZSBoYXZlIHRvIHRha2UgYSBtYW51YWwgZHVtcCBhbmQgcmVzdG9yZSB0
aGUgc2NoZW1hIGFnYWluIG9uIHNsYXZlPwo+Cj5SZWdhcmRzLCAKPlN3ZXRhCj4KCgogICAgICAK
LS0tLS0tLS0tLS0tLS0gbmV4dCBwYXJ0IC0tLS0tLS0tLS0tLS0tCkFuIEhUTUwgYXR0YWNobWVu
dCB3YXMgc2NydWJiZWQuLi4KVVJMOiBodHRwOi8vbGlzdHMuc2xvbnkuaW5mby9waXBlcm1haWwv
c2xvbnkxLWdlbmVyYWwvYXR0YWNobWVudHMvMjAwOTA4MDcvMGJkNzAwNDAvYXR0YWNobWVudC5o
dG0K
From cbbrowne at ca.afilias.info  Fri Aug  7 15:18:16 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri Aug  7 15:18:35 2009
Subject: [Slony1-general] Alter table commands not replicating
In-Reply-To: <4077e7710908070222n1ffe565dm7bfd2014f1531378@mail.gmail.com>
	(Sweta Mulgavker's message of "Fri, 7 Aug 2009 14:52:24 +0530")
References: <4077e7710908070222n1ffe565dm7bfd2014f1531378@mail.gmail.com>
Message-ID: <87d477fetz.fsf@dba2.int.libertyrms.com>

Sweta Mulgavker <sweta.mulgavker@gmail.com> writes:
> Hello all,
> In my slony setup... I am replicating one master slave pair.
> Data is replicating fine... but if I try to alter one table while slony is running the updated table is not replicated in slave db....
> My question is ...
> If while running slony we alter any table structure in the master db then do these changes get replicated on the slave too? I was trying to
> add new cloumn? to one of the table.
> Or do we have to take a manual dump and restore the schema again on slave?

DDL is not automatically propagated; it must be managed quite
carefully.  There is a whole section in the documentation on use of
"EXECUTE SCRIPT".

http://main.slony.info/documentation/ddlchanges.html
-- 
(format nil "~S@~S" "cbbrowne" "ca.afilias.info")
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"
From lawrencew00 at hotmail.com  Fri Aug  7 22:40:39 2009
From: lawrencew00 at hotmail.com (Lawrence Wong)
Date: Fri Aug  7 22:41:11 2009
Subject: [Slony1-general] Set Add Sequence Error
Message-ID: <SNT101-W11D12F8277AC95C23B9031BD080@phx.gbl>


Hi,

I have 2 computers and 2 databases in my replication set up.  Simple 1 mast=
er 1 slave set up, 2 sequences and 23 tables replicated id's from 1 - 25.  =
I am using Windows 2003 Server for both machines and Postgres 8.3.3.  I wro=
te a program between the two machines so that if the master restarts the pr=
evious slave will become the new master.  So it would drop his slony table =
and wait for the other computer to come back, drop his as well, then run th=
e slonik script to become the new master.  =


I have been testing this set up at my office and everything seemed to be ok=
.  I then put the programs on my live system which has the 2 computers seve=
ral kilometers apart.  I started to get this error:

ERROR -- Slony-I: setAddSequence_int(): sequence ID 1 has already been assi=
gned
STATEMENT -- select "_slony_db".setAddSequence_int(1, 1, "TABLENAME"."seq_i=
d1",")
NOTICE -- there is no transaction in progress

I think this means there is an entry in my sl_table or sl_seq table with an=
 id of 1?  I'm not sure how this happens.  Could it happen if one side is t=
rying to drop its slony table while the other is running the slonik script?=
  Anyways, let's say that is causing the error.  Fine.  What I don't unders=
tand is this.  To fix this, I tried dropping the slony table in replication=
 on both sides to drop all my slony tables.  Then reran my slonik script.  =
I got the same error.  I restarted slony-i in my services.  I got the same =
error.  I dropped my slony tables, restarted postgres as a service.  Reran =
my slonik script and *STILL* I got the same error.  The only thing that see=
med to work was dropping my entire database and restoring it from the ident=
ical one on the other server.  I also tried to delete the entry in my sl_se=
q table but it then said my seq was missing an id.  And then I couldn't dro=
p my slony-i replication entry in Replication.  I was then forced to drop m=
y database again.  =


What is also weird is that I then moved the boxes I had at the office to my=
 live system thinking it might be latency on the network because the machin=
es were so far apart.  I could not reproduce the problem.  Then I thought i=
t might be the database I was using was corruted so I backed it up and rest=
ored it on the boxes from the office, no problems again.  I'm puzzled.

So I guess my questions are:

1. What could be causing this problem?

2. How can I solve this without dropping my entire database which seems to =
be dangerous as one day I might corrupt both by accident and be well . . . =
screwed.  =


LW . . . Lawrence

_________________________________________________________________
More storage. Better anti-spam and antivirus protection. Hotmail makes it s=
imple.
http://go.microsoft.com/?linkid=3D9671357
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090808/=
3cd9c443/attachment.htm
From sweta.mulgavker at gmail.com  Fri Aug  7 23:32:02 2009
From: sweta.mulgavker at gmail.com (Sweta Mulgavker)
Date: Fri Aug  7 23:32:30 2009
Subject: [Slony1-general] Sequences not getting added
Message-ID: <4077e7710908072332h8004e75o76b7a52f6cc4c752@mail.gmail.com>

Hello All,

Here is another problem with my replication system .... (I have already had
plenty of them :'( )

I have arround 38 tables and 17 sequences which i am trying to replicate.
The tables addition was smooth but the sequences are not getting added.  >:P

I am getting the following error ....

 PGRES_FATAL_ERROR select "_replcluster".setAddSequence(8, 57,
't_history_serial_seq', 't_history_serial_seq  sequence');  - ERROR:
Slony-I: setAddSequence_int(): sequence t_history_serial_seq not found
CONTEXT:  SQL statement "SELECT  "_replcluster".setAddSequence_int( $1 ,  $2
,  $3 ,  $4 )"
PL/pgSQL function "setaddsequence" line 36 at perform


These sequences are auto created  by postgres  which are used by the auto
increment column. I have dumped the schema on my slave. But when I run my
config file

/usr/bin/slonik replcluster.conf

I get the above mentioned error....


So my questions is.....

 1)Do I have to add these sequences in the config file...
    I mean using  "set add sequence "?

Or will they get replicated without mentioning about them in the config
file???

Thanks and Regards,
Sweta.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090808/=
9709b024/attachment.htm
From shoaibmir at gmail.com  Sat Aug  8 00:46:30 2009
From: shoaibmir at gmail.com (Shoaib Mir)
Date: Sat Aug  8 00:47:01 2009
Subject: [Slony1-general] Sequences not getting added
In-Reply-To: <4077e7710908072332h8004e75o76b7a52f6cc4c752@mail.gmail.com>
References: <4077e7710908072332h8004e75o76b7a52f6cc4c752@mail.gmail.com>
Message-ID: <bf54be870908080046q32353193sfd5a12041511740a@mail.gmail.com>

On Sat, Aug 8, 2009 at 4:32 PM, Sweta Mulgavker
<sweta.mulgavker@gmail.com>wrote:

> Hello All,
>
> Here is another problem with my replication system .... (I have already h=
ad
> plenty of them :'( )
>
> I have arround 38 tables and 17 sequences which i am trying to replicate.
> The tables addition was smooth but the sequences are not getting added.  =
>:P
>
> I am getting the following error ....
>
>  PGRES_FATAL_ERROR select "_replcluster".setAddSequence(8, 57,
> 't_history_serial_seq', 't_history_serial_seq  sequence');  - ERROR:
> Slony-I: setAddSequence_int(): sequence t_history_serial_seq not found
> CONTEXT:  SQL statement "SELECT  "_replcluster".setAddSequence_int( $1 ,
> $2 ,  $3 ,  $4 )"
> PL/pgSQL function "setaddsequence" line 36 at perform
>
>
Make sure the sequence does exist in the database...

Do something like:

select currval(t_history_serial_seq);

Is the sequence in schema other then public?

-- =

Shoaib Mir
http://shoaibmir.wordpress.com/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090808/=
90438b96/attachment.htm
From sweta.mulgavker at gmail.com  Sat Aug  8 00:55:33 2009
From: sweta.mulgavker at gmail.com (Sweta Mulgavker)
Date: Sat Aug  8 00:56:04 2009
Subject: [Slony1-general] Sequences not getting added
In-Reply-To: <bf54be870908080046q32353193sfd5a12041511740a@mail.gmail.com>
References: <4077e7710908072332h8004e75o76b7a52f6cc4c752@mail.gmail.com>
	<bf54be870908080046q32353193sfd5a12041511740a@mail.gmail.com>
Message-ID: <4077e7710908080055x2efd0d52ob8783a019a2589e2@mail.gmail.com>

>
>
> Make sure the sequence does exist in the database...
>

 Yes the sequences are there in the db...

>
>
> Do something like:
>
> select currval(t_history_serial_seq);
>

 Dint get you ...

>
>
> Is the sequence in schema other then public?
>

no they are in public only



>
>
> --
> Shoaib Mir
> http://shoaibmir.wordpress.com/
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090808/=
dc1f1909/attachment.htm
From shoaibmir at gmail.com  Sat Aug  8 01:10:15 2009
From: shoaibmir at gmail.com (Shoaib Mir)
Date: Sat Aug  8 01:10:46 2009
Subject: [Slony1-general] Sequences not getting added
In-Reply-To: <4077e7710908080055x2efd0d52ob8783a019a2589e2@mail.gmail.com>
References: <4077e7710908072332h8004e75o76b7a52f6cc4c752@mail.gmail.com>
	<bf54be870908080046q32353193sfd5a12041511740a@mail.gmail.com>
	<4077e7710908080055x2efd0d52ob8783a019a2589e2@mail.gmail.com>
Message-ID: <bf54be870908080110s783fd331ve75939e4054c8e40@mail.gmail.com>

On Sat, Aug 8, 2009 at 5:55 PM, Sweta Mulgavker
<sweta.mulgavker@gmail.com>wrote:

>
>> Make sure the sequence does exist in the database...
>>
>
>  Yes the sequences are there in the db...
>
>>
>>
>> Do something like:
>>
>> select currval(t_history_serial_seq);
>>
>
>  Dint get you ...
>
>>

This function gives the current value for the sequence so I just wanted to
make sure if it did exist! Read the manual for more details...

If you got tables with serial datatype (which creates an implicit sequence)
then you might not need to add sequences explicitly in Slony cluster as that
automatically will get updated... when Slony master sends the updates to
Slave nodes.

-- =

Shoaib Mir
http://shoaibmir.wordpress.com/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090808/=
64d2044c/attachment-0001.htm
From stephane.schildknecht at postgresqlfr.org  Sat Aug  8 02:22:16 2009
From: stephane.schildknecht at postgresqlfr.org (=?ISO-8859-15?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Sat Aug  8 02:22:51 2009
Subject: [Slony1-general] Sequences not getting added
In-Reply-To: <4077e7710908072332h8004e75o76b7a52f6cc4c752@mail.gmail.com>
References: <4077e7710908072332h8004e75o76b7a52f6cc4c752@mail.gmail.com>
Message-ID: <4A7D43C8.8020401@postgresqlfr.org>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi,


Sweta Mulgavker a ?crit :
(...)

>  PGRES_FATAL_ERROR select "_replcluster".setAddSequence(8, 57,
> 't_history_serial_seq', 't_history_serial_seq  sequence');  - ERROR: 
> Slony-I: setAddSequence_int(): sequence t_history_serial_seq not found
> CONTEXT:  SQL statement "SELECT  "_replcluster".setAddSequence_int( $1
> ,  $2 ,  $3 ,  $4 )"
> PL/pgSQL function "setaddsequence" line 36 at perform

Be careful, you have to qualify the sequence with its schema, i.e. if the
sequence is in the public schema, you have to write sthg like

select "_replcluster".setAddSequence(8, 57, 'public.t_history_serial_seq',
't_history_serial_seq  sequence');

Notice the *public.* in sequence name.
(...)

> 
> So my questions is.....
> 
>  1)Do I have to add these sequences in the config file...
>     I mean using  "set add sequence "?

Yes, you have to.

> 
> Or will they get replicated without mentioning about them in the config
> file???

No, they won't.


Regards,
- --
St?phane Schildknecht
PostgreSQLFr - http://www.postgresql.fr
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFKfUPIA+REPKWGI0ERApZKAJ46oqUJXO2iX61wIwuTgcFfo0US0wCeLMoo
SIR6mqhq2qWNCG1i8t86m38=
=xvH3
-----END PGP SIGNATURE-----
From vivek at khera.org  Sat Aug  8 06:30:35 2009
From: vivek at khera.org (Vick Khera)
Date: Sat Aug  8 06:30:40 2009
Subject: [Slony1-general] Sequences not getting added
In-Reply-To: <bf54be870908080110s783fd331ve75939e4054c8e40@mail.gmail.com>
References: <4077e7710908072332h8004e75o76b7a52f6cc4c752@mail.gmail.com>
	<bf54be870908080046q32353193sfd5a12041511740a@mail.gmail.com>
	<4077e7710908080055x2efd0d52ob8783a019a2589e2@mail.gmail.com>
	<bf54be870908080110s783fd331ve75939e4054c8e40@mail.gmail.com>
Message-ID: <2968dfd60908080630q37ff5480o3a546aba8de2acf3@mail.gmail.com>

On Sat, Aug 8, 2009 at 4:10 AM, Shoaib Mir<shoaibmir@gmail.com> wrote:
> If you got tables with serial datatype (which creates an implicit sequence)
> then you might not need to add sequences explicitly in Slony cluster as that
> automatically will get updated... when Slony master sends the updates to
> Slave nodes.

This is an incorrect statement.  You must add you sequences explicitly.  Always.
From shoaibmir at gmail.com  Sat Aug  8 06:36:23 2009
From: shoaibmir at gmail.com (Shoaib Mir)
Date: Sat Aug  8 06:36:28 2009
Subject: [Slony1-general] Sequences not getting added
In-Reply-To: <2968dfd60908080630q37ff5480o3a546aba8de2acf3@mail.gmail.com>
References: <4077e7710908072332h8004e75o76b7a52f6cc4c752@mail.gmail.com>
	<bf54be870908080046q32353193sfd5a12041511740a@mail.gmail.com>
	<4077e7710908080055x2efd0d52ob8783a019a2589e2@mail.gmail.com>
	<bf54be870908080110s783fd331ve75939e4054c8e40@mail.gmail.com>
	<2968dfd60908080630q37ff5480o3a546aba8de2acf3@mail.gmail.com>
Message-ID: <bf54be870908080636y47bfcaffm5b571273a51c20@mail.gmail.com>

On Sat, Aug 8, 2009 at 11:30 PM, Vick Khera <vivek@khera.org> wrote:

> On Sat, Aug 8, 2009 at 4:10 AM, Shoaib Mir<shoaibmir@gmail.com> wrote:
> > If you got tables with serial datatype (which creates an implicit
> sequence)
> > then you might not need to add sequences explicitly in Slony cluster as
> that
> > automatically will get updated... when Slony master sends the updates to
> > Slave nodes.
>
> This is an incorrect statement.  You must add you sequences explicitly.
>  Always.


This is why I said it *might* be the case... just on a separate note did you
try that? and what kind of problems you faced? as I just got a reply back
from poster privately where he/she didnt have to add them explicitly! so
just curious...

-- =

Shoaib Mir
http://shoaibmir.wordpress.com/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090808/=
a00ebdbc/attachment.htm
From vivek at khera.org  Sat Aug  8 06:44:21 2009
From: vivek at khera.org (Vick Khera)
Date: Sat Aug  8 06:44:26 2009
Subject: [Slony1-general] Sequences not getting added
In-Reply-To: <bf54be870908080636y47bfcaffm5b571273a51c20@mail.gmail.com>
References: <4077e7710908072332h8004e75o76b7a52f6cc4c752@mail.gmail.com>
	<bf54be870908080046q32353193sfd5a12041511740a@mail.gmail.com>
	<4077e7710908080055x2efd0d52ob8783a019a2589e2@mail.gmail.com>
	<bf54be870908080110s783fd331ve75939e4054c8e40@mail.gmail.com>
	<2968dfd60908080630q37ff5480o3a546aba8de2acf3@mail.gmail.com>
	<bf54be870908080636y47bfcaffm5b571273a51c20@mail.gmail.com>
Message-ID: <2968dfd60908080644m19fd4dfeg7abe382c61df28da@mail.gmail.com>

On Sat, Aug 8, 2009 at 9:36 AM, Shoaib Mir<shoaibmir@gmail.com> wrote:
> This is why I said it *might* be the case... just on a separate note did you
> try that? and what kind of problems you faced? as I just got a reply back
> from poster privately where he/she didnt have to add them explicitly! so
> just curious...

You always need to add the sequences explicitly.  No if, and, or but.
From shoaibmir at gmail.com  Sat Aug  8 07:15:22 2009
From: shoaibmir at gmail.com (Shoaib Mir)
Date: Sat Aug  8 07:15:28 2009
Subject: [Slony1-general] Sequences not getting added
In-Reply-To: <2968dfd60908080644m19fd4dfeg7abe382c61df28da@mail.gmail.com>
References: <4077e7710908072332h8004e75o76b7a52f6cc4c752@mail.gmail.com>
	<bf54be870908080046q32353193sfd5a12041511740a@mail.gmail.com>
	<4077e7710908080055x2efd0d52ob8783a019a2589e2@mail.gmail.com>
	<bf54be870908080110s783fd331ve75939e4054c8e40@mail.gmail.com>
	<2968dfd60908080630q37ff5480o3a546aba8de2acf3@mail.gmail.com>
	<bf54be870908080636y47bfcaffm5b571273a51c20@mail.gmail.com>
	<2968dfd60908080644m19fd4dfeg7abe382c61df28da@mail.gmail.com>
Message-ID: <bf54be870908080715m5f366277na91e32457a727d3a@mail.gmail.com>

On Sat, Aug 8, 2009 at 11:44 PM, Vick Khera <vivek@khera.org> wrote:

> On Sat, Aug 8, 2009 at 9:36 AM, Shoaib Mir<shoaibmir@gmail.com> wrote:
> > This is why I said it *might* be the case... just on a separate note did
> you
> > try that? and what kind of problems you faced? as I just got a reply ba=
ck
> > from poster privately where he/she didnt have to add them explicitly! so
> > just curious...
>
> You always need to add the sequences explicitly.  No if, and, or but.
>

Hmmm if that is the case ....

then why don't I see the implicit sequence for "history" table (added after
we used the serial datatype) been getting added to the set for the sample of
Slony setup at

http://main.slony.info/viewcvs/viewvc.cgi/slony1-engine/SAMPLE?view=3Dco

Does the sample needs a fix here?

-- =

Shoaib Mir
http://shoaibmir.wordpress.com/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090809/=
c521a827/attachment.htm
From nettreeinc at gmail.com  Sun Aug  9 06:52:06 2009
From: nettreeinc at gmail.com (roctaiwan)
Date: Sun Aug  9 06:52:16 2009
Subject: [Slony1-general] Cluster setup bash script for multi-slave
	envrionment
In-Reply-To: <4A7A8567.4010801@postgresqlfr.org>
References: <24804524.post@talk.nabble.com> <4A794ECC.30607@postgresqlfr.org>
	<24840619.post@talk.nabble.com> <4A7A8567.4010801@postgresqlfr.org>
Message-ID: <24887345.post@talk.nabble.com>


Node 3 has not done subscribing so Node 4 can't subscribe? But it's not under
my control to prioritize which node should subscribing first, it's all on
one script, I run it and it suppose to do its job isn't it?

How can I fix this issue then?


&quot;St?phane A. Schildknecht&quot; wrote:
> 
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> Hi,
> 
> roctaiwan a ?crit :
>> after I run my cluster setup script and subscribe script it shown:
>> 
>> -bash-3.2$ ./subscribe_multi_slave.sh
>> <stdin>:31: PGRES_FATAL_ERROR select "_contactdb_cluster".subscribeSet(1,
>> 3,
>> 4, 't');  - ERROR:  Slony-I: subscribeSet(): provider 3 is not an active
>> forwarding node for replication set 1
>> 
>> 
>> what's wrong? is this error caused by my cluster setup script or
>> subscript
>> script?
> 
> It may be that Node 3 has not finished subscribing when you subscribe
> Node4 on it.
> 
> 
-- 
View this message in context: http://www.nabble.com/Cluster-setup-bash-script-for-multi-slave-envrionment-tp24804524p24887345.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.

From nettreeinc at gmail.com  Sun Aug  9 07:39:45 2009
From: nettreeinc at gmail.com (roctaiwan)
Date: Sun Aug  9 07:39:52 2009
Subject: [Slony1-general] Slony scripts
In-Reply-To: <db471ace0907300702m57396f3bh8b0cd16feeea008e@mail.gmail.com>
References: <BLU119-W27816F55859D39D8DCE783CD130@phx.gbl>
	<db471ace0907300451h72e2a75aj8b6feef39dde13b1@mail.gmail.com>
	<db471ace0907300702m57396f3bh8b0cd16feeea008e@mail.gmail.com>
Message-ID: <24887726.post@talk.nabble.com>


In general where are good places to get Slony Scripts?


Peter Geoghegan wrote:
> 
> What operating system? Windows? What PostgreSQL version? What Slony-I
> version? These are the sorts of details you ought to have included in
> your first e-mail to have any hope of getting a useful response.
> 
> Regards,
> Peter Geoghegan
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
> 
> 

-- 
View this message in context: http://www.nabble.com/Slony-scripts-tp24733874p24887726.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.

From shoaibmir at gmail.com  Sun Aug  9 16:31:51 2009
From: shoaibmir at gmail.com (Shoaib Mir)
Date: Sun Aug  9 16:32:09 2009
Subject: [Slony1-general] Slony scripts
In-Reply-To: <24887726.post@talk.nabble.com>
References: <BLU119-W27816F55859D39D8DCE783CD130@phx.gbl>
	<db471ace0907300451h72e2a75aj8b6feef39dde13b1@mail.gmail.com>
	<db471ace0907300702m57396f3bh8b0cd16feeea008e@mail.gmail.com>
	<24887726.post@talk.nabble.com>
Message-ID: <bf54be870908091631n19b08b6el52fd2eb4753b524d@mail.gmail.com>

On Mon, Aug 10, 2009 at 12:39 AM, roctaiwan <nettreeinc@gmail.com> wrote:

>
> In general where are good places to get Slony Scripts?
>

Use the following:

http://main.slony.info/documentation/adminscripts.html

This will give you a good start.

-- =

Shoaib Mir
http://shoaibmir.wordpress.com/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090810/=
a6f5ff76/attachment.htm
From sweta.mulgavker at gmail.com  Sun Aug  9 22:56:07 2009
From: sweta.mulgavker at gmail.com (Sweta Mulgavker)
Date: Sun Aug  9 22:56:32 2009
Subject: [Slony1-general] duplicate key violates unique constraint
In-Reply-To: <1374.10.0.2.84.1249883596.squirrel@mail.ho.opspl.com>
References: <1374.10.0.2.84.1249883596.squirrel@mail.ho.opspl.com>
Message-ID: <4077e7710908092256h76dde51ft8d2c48b5347a5a1f@mail.gmail.com>

 Hello all,

I have a table named "t_i_shift_shadow"  with following spec


    Column      |         Type          |
Modifiers
-----------------+-----------------------+---------------------------------=
----------------------------------
 cid             | character varying(20) | not null
 shift_rev_id    | character varying(20) | not null
 start_time      | bigint                | not null
 end_time        | bigint                | not null
 lunch_from_time | bigint                | default -1
 lunch_to_time   | bigint                | default -1
 shift_date      | date                  | not null
 is_cyclic       | integer               | not null
 serial          | integer               | not null default
nextval('t_i_shift_shadow_serial_seq'::regclass)
Indexes:
   "t_i_shift_shadow_pkey" PRIMARY KEY, btree (serial)
Triggers:
   _replcluster_logtrigger_4 AFTER INSERT OR DELETE OR UPDATE ON
t_i_shift_shadow FOR EACH ROW EXECUTE PROCEDURE
_replcluster.logtrigger('_replcluster', '4', 'vvvvvvvvk')


I am trying to replicate this table using slony.

But I get the following error...

ERROR -->

  replconfig.cnf:85: PGRES_FATAL_ERROR select "_replcluster".setAddTable(8,
36, 'public.t_i_shift_shadow', 't_i_shift_shadow_pkey', 'shift shadow
table');  - ERROR:  duplicate key violates unique constraint
"sl_table_tab_reloid_key"

CONTEXT:  SQL statement "insert into "_replcluster".sl_table (tab_id,
tab_reloid, tab_relname, tab_nspname, tab_set, tab_idxname, tab_altered,
tab_comment) values ( $1 ,  $2 ,  $3 ,  $4 ,  $5 ,  $6 , false,  $7 )"

PL/pgSQL function "setaddtable_int" line 103 at SQL statement
SQL statement "SELECT  "_replcluster".setAddTable_int( $1 ,  $2 ,  $3 ,  $4
,  $5 )"
PL/pgSQL function "setaddtable" line 37 at perform


Can somebody please help me out :(

Thanks and Regards,
Sweta.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090810/=
a82a015d/attachment.htm
From dba at richyen.com  Sun Aug  9 23:40:20 2009
From: dba at richyen.com (Richard Yen)
Date: Sun Aug  9 23:40:50 2009
Subject: [Slony1-general] duplicate key violates unique constraint
In-Reply-To: <4077e7710908092256h76dde51ft8d2c48b5347a5a1f@mail.gmail.com>
References: <1374.10.0.2.84.1249883596.squirrel@mail.ho.opspl.com>
	<4077e7710908092256h76dde51ft8d2c48b5347a5a1f@mail.gmail.com>
Message-ID: <F953C17A-3072-46EC-972D-73B02B44A90B@richyen.com>

Is it possible that you have the table defined twice in your build  
script?

Or if you are trying to add this table to an existing replication set,  
perhaps it is already added?  Run the following query to find out:  
"select * from _repcluster.sl_table where relname = 't_i_shift_shadow';"

--Richard


On Aug 9, 2009, at 10:56 PM, Sweta Mulgavker wrote:

> Hello all,
>
> I have a table named "t_i_shift_shadow"  with following spec
>
>
>     Column      |         Type          |
> Modifiers
> -----------------+----------------------- 
> +-------------------------------------------------------------------
>  cid             | character varying(20) | not null
>  shift_rev_id    | character varying(20) | not null
>  start_time      | bigint                | not null
>  end_time        | bigint                | not null
>  lunch_from_time | bigint                | default -1
>  lunch_to_time   | bigint                | default -1
>  shift_date      | date                  | not null
>  is_cyclic       | integer               | not null
>  serial          | integer               | not null default
> nextval('t_i_shift_shadow_serial_seq'::regclass)
> Indexes:
>    "t_i_shift_shadow_pkey" PRIMARY KEY, btree (serial)
> Triggers:
>    _replcluster_logtrigger_4 AFTER INSERT OR DELETE OR UPDATE ON
> t_i_shift_shadow FOR EACH ROW EXECUTE PROCEDURE
> _replcluster.logtrigger('_replcluster', '4', 'vvvvvvvvk')
>
>
> I am trying to replicate this table using slony.
>
> But I get the following error...
>
> ERROR -->
>
>   replconfig.cnf:85: PGRES_FATAL_ERROR select  
> "_replcluster".setAddTable(8, 36, 'public.t_i_shift_shadow',  
> 't_i_shift_shadow_pkey', 'shift shadow table');  - ERROR:  duplicate  
> key violates unique constraint "sl_table_tab_reloid_key"
>
> CONTEXT:  SQL statement "insert into "_replcluster".sl_table  
> (tab_id, tab_reloid, tab_relname, tab_nspname, tab_set, tab_idxname,  
> tab_altered, tab_comment) values ( $1 ,  $2 ,  $3 ,  $4 ,  $5 ,   
> $6 , false,  $7 )"
>
> PL/pgSQL function "setaddtable_int" line 103 at SQL statement
> SQL statement "SELECT  "_replcluster".setAddTable_int( $1 ,  $2 ,   
> $3 ,  $4 ,  $5 )"
> PL/pgSQL function "setaddtable" line 37 at perform
>
>
> Can somebody please help me out :(
>
> Thanks and Regards,
> Sweta.
>
>
>
>
>
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general

From shoaibmir at gmail.com  Sun Aug  9 23:41:08 2009
From: shoaibmir at gmail.com (Shoaib Mir)
Date: Sun Aug  9 23:41:35 2009
Subject: [Slony1-general] duplicate key violates unique constraint
In-Reply-To: <4077e7710908092256h76dde51ft8d2c48b5347a5a1f@mail.gmail.com>
References: <1374.10.0.2.84.1249883596.squirrel@mail.ho.opspl.com>
	<4077e7710908092256h76dde51ft8d2c48b5347a5a1f@mail.gmail.com>
Message-ID: <bf54be870908092341y105f643fn283a3747e885c943@mail.gmail.com>

On Mon, Aug 10, 2009 at 3:56 PM, Sweta Mulgavker
<sweta.mulgavker@gmail.com>wrote:

>
>
> ERROR -->
>
>   replconfig.cnf:85: PGRES_FATAL_ERROR select "_replcluster".setAddTable(=
8,
> 36, 'public.t_i_shift_shadow', 't_i_shift_shadow_pkey', 'shift shadow
> table');  - ERROR:  duplicate key violates unique constraint
> "sl_table_tab_reloid_key"
>
> CONTEXT:  SQL statement "insert into "_replcluster".sl_table (tab_id,
> tab_reloid, tab_relname, tab_nspname, tab_set, tab_idxname, tab_altered,
> tab_comment) values ( $1 ,  $2 ,  $3 ,  $4 ,  $5 ,  $6 , false,  $7 )"
>
> PL/pgSQL function "setaddtable_int" line 103 at SQL statement
> SQL statement "SELECT  "_replcluster".setAddTable_int( $1 ,  $2 ,  $3 ,  =
$4
> ,  $5 )"
> PL/pgSQL function "setaddtable" line 37 at perform
>


Can you please show the output for:

select * from _repcluster.sl_table where tab_reloid =3D (select oid from
pg_class where relname =3D 't_i_shift_shadow')


-- =

Shoaib Mir
http://shoaibmir.wordpress.com/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090810/=
bd6bc28b/attachment.htm
From sweta.mulgavker at gmail.com  Sun Aug  9 23:46:23 2009
From: sweta.mulgavker at gmail.com (Sweta Mulgavker)
Date: Sun Aug  9 23:46:49 2009
Subject: [Slony1-general] Sequences not getting added
In-Reply-To: <bf54be870908080715m5f366277na91e32457a727d3a@mail.gmail.com>
References: <4077e7710908072332h8004e75o76b7a52f6cc4c752@mail.gmail.com>
	<bf54be870908080046q32353193sfd5a12041511740a@mail.gmail.com>
	<4077e7710908080055x2efd0d52ob8783a019a2589e2@mail.gmail.com>
	<bf54be870908080110s783fd331ve75939e4054c8e40@mail.gmail.com>
	<2968dfd60908080630q37ff5480o3a546aba8de2acf3@mail.gmail.com>
	<bf54be870908080636y47bfcaffm5b571273a51c20@mail.gmail.com>
	<2968dfd60908080644m19fd4dfeg7abe382c61df28da@mail.gmail.com>
	<bf54be870908080715m5f366277na91e32457a727d3a@mail.gmail.com>
Message-ID: <4077e7710908092346g7645a62as6482a56193ca86ce@mail.gmail.com>

Hello all,



>
>>
>> >> You always need to add the sequences explicitly.  No if, and, or but.
>>
>
I have a table leave_type for which I have given a primary key 'serial'
which is an auto increment column.  The sequence for this table was created
by postgres when the column was created (I had altered the table as it did
not have any primary key ).  I have only added  the table name in my conf
file. But the schema of my db , both on master and slave is same. (same
number of tables and sequences). I have not added any sequence in the conf
file. I tried replicating the table and it works fine :) . But because of
not adding the sequence  in my conf file the  sequence on my slave is not
getting  replicated / updated .

My conclusion is that -->

If we want to replicate only tables in the db we dont need to add the name
of the sequence.
But in case if the master fails and we have to take a dump from the slave n
restore on master then the sequences will not have the correct values ...
Hence it is a safer option to replicate sequences too.

But if one does not wish to replicate the sequence they can leave it as data
in the tables is  getting replicated anyway :)


P.S - Correct me if I am wrong. :)

 Regards,
Sweta.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090810/=
593357fa/attachment.htm
From sweta.mulgavker at gmail.com  Mon Aug 10 00:08:15 2009
From: sweta.mulgavker at gmail.com (Sweta Mulgavker)
Date: Mon Aug 10 00:08:43 2009
Subject: [Slony1-general] duplicate key violates unique constraint
In-Reply-To: <bf54be870908092341y105f643fn283a3747e885c943@mail.gmail.com>
References: <1374.10.0.2.84.1249883596.squirrel@mail.ho.opspl.com>
	<4077e7710908092256h76dde51ft8d2c48b5347a5a1f@mail.gmail.com>
	<bf54be870908092341y105f643fn283a3747e885c943@mail.gmail.com>
Message-ID: <4077e7710908100008w69e212fayf1d28c68e1bc09e8@mail.gmail.com>

cars=3D# select * from _replcluster.sl_table where tab_reloid =3D (select o=
id
from pg_class where relname =3D 't_i_shift_shadow');


 tab_id | tab_reloid |   tab_relname    | tab_nspname | tab_set |
tab_idxname      | tab_altered |    tab_comment
--------+------------+------------------+-------------+---------+----------=
-------------+-------------+--------------------
      4 |      67006 | t_i_shift_shadow | public      |       1 |
t_i_shift_shadow_pkey | t           | shift shadow table
(1 row)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090810/=
25af5ca3/attachment-0001.htm
From nettreeinc at gmail.com  Mon Aug 10 01:35:11 2009
From: nettreeinc at gmail.com (roctaiwan)
Date: Mon Aug 10 01:35:42 2009
Subject: [Slony1-general] install altperl scripts
Message-ID: <24896126.post@talk.nabble.com>


The following contents is copied from Slony.info documentation Chapter 21.1



> 21.1. altperl Scripts
> 
> There is a set of scripts to simplify administeration of set of Slony-I
> instances. The scripts support having arbitrary numbers of nodes. They may
> be installed as part of the installation process:
> 
> ./configure --with-perltools
> 
> This will produce a number of scripts with the prefix slonik_. They
> eliminate tedium by always referring to a central configuration file for
> the details of your site configuration. A documented sample of this file
> is provided in altperl/slon_tools.conf-sample. Most also include some
> command line help with the "--help" option, making them easier to learn
> and use.
> 

If I am running Enterprise DB standard environment that Slony is part of the
installation included with it. I do not have altperl. In this case, can I
still installing the "perltools" individually? How?
-- 
View this message in context: http://www.nabble.com/install-altperl-scripts-tp24896126p24896126.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.

From shoaibmir at gmail.com  Mon Aug 10 01:54:07 2009
From: shoaibmir at gmail.com (Shoaib Mir)
Date: Mon Aug 10 01:54:37 2009
Subject: [Slony1-general] duplicate key violates unique constraint
In-Reply-To: <4077e7710908100008w69e212fayf1d28c68e1bc09e8@mail.gmail.com>
References: <1374.10.0.2.84.1249883596.squirrel@mail.ho.opspl.com>
	<4077e7710908092256h76dde51ft8d2c48b5347a5a1f@mail.gmail.com>
	<bf54be870908092341y105f643fn283a3747e885c943@mail.gmail.com>
	<4077e7710908100008w69e212fayf1d28c68e1bc09e8@mail.gmail.com>
Message-ID: <bf54be870908100154g6d4a2cf6t7999e54d0d624338@mail.gmail.com>

On Mon, Aug 10, 2009 at 5:08 PM, Sweta Mulgavker
<sweta.mulgavker@gmail.com>wrote:

>
>
>
> cars=3D# select * from _replcluster.sl_table where tab_reloid =3D (select=
 oid
> from pg_class where relname =3D 't_i_shift_shadow');
>
>
>  tab_id | tab_reloid |   tab_relname    | tab_nspname | tab_set |
> tab_idxname      | tab_altered |    tab_comment
>
> --------+------------+------------------+-------------+---------+--------=
---------------+-------------+--------------------
>       4 |      67006 | t_i_shift_shadow | public      |       1 |
> t_i_shift_shadow_pkey | t           | shift shadow table
> (1 row)
>


This means the table is already added to the Slony cluster, you need to
first drop it out of the cluster and then re-add it again.

-- =

Shoaib Mir
http://shoaibmir.wordpress.com/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090810/=
61659d63/attachment.htm
From sweta.mulgavker at gmail.com  Mon Aug 10 02:54:39 2009
From: sweta.mulgavker at gmail.com (Sweta Mulgavker)
Date: Mon Aug 10 02:55:11 2009
Subject: [Slony1-general] duplicate key violates unique constraint
In-Reply-To: <bf54be870908100229r590e141byf694db2b0652467c@mail.gmail.com>
References: <1374.10.0.2.84.1249883596.squirrel@mail.ho.opspl.com>
	<4077e7710908092256h76dde51ft8d2c48b5347a5a1f@mail.gmail.com>
	<bf54be870908092341y105f643fn283a3747e885c943@mail.gmail.com>
	<4077e7710908100008w69e212fayf1d28c68e1bc09e8@mail.gmail.com>
	<bf54be870908100154g6d4a2cf6t7999e54d0d624338@mail.gmail.com>
	<4077e7710908100157l6048f707n769683c58e4a06b@mail.gmail.com>
	<bf54be870908100229r590e141byf694db2b0652467c@mail.gmail.com>
Message-ID: <4077e7710908100254n1460f44cv2080630d0f157d3d@mail.gmail.com>

Hello,



> >Why do you do that?



I do this because  every time  I pass the conf file to slonik the cluster is
getting created (the config file does that). And then it give "cluster
already exist" error... Hence I drop the cluster using

DROP SCHEMA  _replcluster CASCADE ;



> >Did you do it just on the master and all the slave nodes as well?



yes , I do it on both master and slave.

Regards,
Sweta
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090810/=
a580f5ae/attachment.htm
From nagaraj.shindagi at gmail.com  Mon Aug 10 03:11:58 2009
From: nagaraj.shindagi at gmail.com (nagaraj shindagi)
Date: Mon Aug 10 03:12:29 2009
Subject: [Slony1-general] how to make installer slony-I 2.0.2 in windows
Message-ID: <9fa914ca0908100311l324cc77sd6ca24896712eea5@mail.gmail.com>

hi friends

i am using postgresql 8.3 along with slony -i , just i am downloaded new
version slony -I 2.0.2, can any one help me how to make installer, i am not
able to understand that readme properly
i am using windows xp
this is readme
---------------------------------------------------------------------------=
--------------------------------------------
This directory contains the Slony-I installer for Windows. To build the
installer, you will need a copy of WiX installed somewhere in your system
path. The installer has been tested with WiX version 2.0.2419 only at the
time writing. WiX may be downloaded from:

  http://sourceforge.net/projects/wix/.

In order to build the installer, first ensure that a suitable binary is in
the $SRC\Release directory, then, from the $SRC\Installer directory run:

C:\Slony-I\Installer> make 1.2.7

The version number will default to a value set in the Make.bat batch file if
not specified on the command line. 2 files will be built:

Slony1.msm - A merge module for use in other projects.
Slony1.msi - A Windows Installer package for standalone use.
---------------------------------------------------------------------------=
-----------------------------

please help me

regards
nagaraj
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090810/=
bf739298/attachment.htm
From stephane.schildknecht at postgresqlfr.org  Mon Aug 10 03:26:08 2009
From: stephane.schildknecht at postgresqlfr.org (=?ISO-8859-15?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Mon Aug 10 03:26:50 2009
Subject: [Slony1-general] Cluster setup bash script for
	multi-slave	envrionment
In-Reply-To: <24887345.post@talk.nabble.com>
References: <24804524.post@talk.nabble.com>
	<4A794ECC.30607@postgresqlfr.org>	<24840619.post@talk.nabble.com>
	<4A7A8567.4010801@postgresqlfr.org> <24887345.post@talk.nabble.com>
Message-ID: <4A7FF5C0.7050409@postgresqlfr.org>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

roctaiwan a ?crit :
> Node 3 has not done subscribing so Node 4 can't subscribe? But it's not under
> my control to prioritize which node should subscribing first, it's all on
> one script, I run it and it suppose to do its job isn't it?
> 
> How can I fix this issue then?

You could wait before you issue the subscribe for Node 4.

You could also check in sl_subscribe to see if node 3 is active before using it
as a provider for node 4.

Maybe sthg in your setup script :

select sub_active from _$INSTANCE.sl_subscribe where sub_receiver=${NODE[$slv]}
and sub_set=$SETID

If sub_active is true, go on, and subscribe 4 to 3.

Regards,
- --
St?phane Schildknecht
PostgreSQLFr - http://www.postgresql.fr
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFKf/W0A+REPKWGI0ERAn7+AJ95/5r0UFwKOhBVdUXRkc7YZgPDBQCgyAz0
IY3c7GTLpnUayRkVSERI84E=
=udET
-----END PGP SIGNATURE-----
From nagaraj.shindagi at gmail.com  Mon Aug 10 03:29:16 2009
From: nagaraj.shindagi at gmail.com (nagaraj shindagi)
Date: Mon Aug 10 03:29:48 2009
Subject: [Slony1-general] Fwd: how to make installer slony-I 2.0.2 in windows
In-Reply-To: <9fa914ca0908100311l324cc77sd6ca24896712eea5@mail.gmail.com>
References: <9fa914ca0908100311l324cc77sd6ca24896712eea5@mail.gmail.com>
Message-ID: <9fa914ca0908100329k14b9ed03mf2ddf5e4ee1c6cfa@mail.gmail.com>

---------- Forwarded message ----------
From: nagaraj shindagi <nagaraj.shindagi@gmail.com>
Date: Mon, Aug 10, 2009 at 3:41 PM
Subject: how to make installer slony-I 2.0.2 in windows
To: slony1-general@lists.slony.info


hi friends

i am using postgresql 8.3 along with slony -i , just i am downloaded new
version slony -I 2.0.2, can any one help me how to make installer, i am not
able to understand that readme properly
i am using windows xp
this is readme
---------------------------------------------------------------------------=
--------------------------------------------
This directory contains the Slony-I installer for Windows. To build the
installer, you will need a copy of WiX installed somewhere in your system
path. The installer has been tested with WiX version 2.0.2419 only at the
time writing. WiX may be downloaded from:

  http://sourceforge.net/projects/wix/.

In order to build the installer, first ensure that a suitable binary is in
the $SRC\Release directory, then, from the $SRC\Installer directory run:

C:\Slony-I\Installer> make 1.2.7

The version number will default to a value set in the Make.bat batch file if
not specified on the command line. 2 files will be built:

Slony1.msm - A merge module for use in other projects.
Slony1.msi - A Windows Installer package for standalone use.
---------------------------------------------------------------------------=
-----------------------------

please help me

regards
nagaraj
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090810/=
4ce79201/attachment.htm
From JanWieck at Yahoo.com  Sun Aug  9 22:16:30 2009
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Mon Aug 10 06:18:05 2009
Subject: [Slony1-general] duplicate key violates unique constraint
In-Reply-To: <4077e7710908100254n1460f44cv2080630d0f157d3d@mail.gmail.com>
References: <1374.10.0.2.84.1249883596.squirrel@mail.ho.opspl.com>	<4077e7710908092256h76dde51ft8d2c48b5347a5a1f@mail.gmail.com>	<bf54be870908092341y105f643fn283a3747e885c943@mail.gmail.com>	<4077e7710908100008w69e212fayf1d28c68e1bc09e8@mail.gmail.com>	<bf54be870908100154g6d4a2cf6t7999e54d0d624338@mail.gmail.com>	<4077e7710908100157l6048f707n769683c58e4a06b@mail.gmail.com>	<bf54be870908100229r590e141byf694db2b0652467c@mail.gmail.com>
	<4077e7710908100254n1460f44cv2080630d0f157d3d@mail.gmail.com>
Message-ID: <4A7FAD2E.4010400@Yahoo.com>

On 8/10/2009 5:54 AM, Sweta Mulgavker wrote:
> 
> 
> Hello,
> 
>  
> 
>      >Why do you do that? 
> 
> 
> 
> I do this because  every time  I pass the conf file to slonik the 
> cluster is getting created (the config file does that). And then it give 
> "cluster already exist" error... Hence I drop the cluster using
> 
> DROP SCHEMA  _replcluster CASCADE ;

Which only works in 2.0. In 1.x this is a good way to corrupt your 
system catalog.

Use a slonik script with

UNINSTALL NODE ...

instead.


Jan

-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin

From mark.hagger at mxdata.co.uk  Mon Aug 10 07:07:06 2009
From: mark.hagger at mxdata.co.uk (Mark Hagger)
Date: Mon Aug 10 07:07:15 2009
Subject: [Slony1-general] Upgrade to 2.0 proposal: Subscribe set OMIT
	COPY option
In-Reply-To: <87tz2lchf7.fsf@dba2.int.libertyrms.com>
References: <87zlcdchwa.fsf@dba2.int.libertyrms.com>
	<87tz2lchf7.fsf@dba2.int.libertyrms.com>
Message-ID: <1249913226.3122.8.camel@giga.cambridge.mxdata.co.uk>

U2tpcHBlZCBjb250ZW50IG9mIHR5cGUgbXVsdGlwYXJ0L2FsdGVybmF0aXZlLS0tLS0tLS0tLS0t
LS0gbmV4dCBwYXJ0IC0tLS0tLS0tLS0tLS0tCkEgbm9uLXRleHQgYXR0YWNobWVudCB3YXMgc2Ny
dWJiZWQuLi4KTmFtZTogbXhkYXRhLmpwZwpUeXBlOiBpbWFnZS9qcGVnClNpemU6IDUwNTUgYnl0
ZXMKRGVzYzogbm90IGF2YWlsYWJsZQpVcmwgOiBodHRwOi8vbGlzdHMuc2xvbnkuaW5mby9waXBl
cm1haWwvc2xvbnkxLWdlbmVyYWwvYXR0YWNobWVudHMvMjAwOTA4MTAvMTFhNDZiNzcvbXhkYXRh
LmpwZwo=
From stephane.schildknecht at postgresqlfr.org  Mon Aug 10 07:58:45 2009
From: stephane.schildknecht at postgresqlfr.org (=?ISO-8859-15?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Mon Aug 10 07:58:57 2009
Subject: [Slony1-general] Cluster setup bash script for multi-slave
	envrionment
In-Reply-To: <bd9689740908100602o1c597debn87a713394ce7b811@mail.gmail.com>
References: <24804524.post@talk.nabble.com> <4A794ECC.30607@postgresqlfr.org>	
	<24840619.post@talk.nabble.com>
	<4A7A8567.4010801@postgresqlfr.org>	
	<24887345.post@talk.nabble.com> <4A7FF5B4.4000509@postgresqlfr.org>
	<bd9689740908100602o1c597debn87a713394ce7b811@mail.gmail.com>
Message-ID: <4A8035A5.1040007@postgresqlfr.org>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Net Tree Inc. a ?crit :
> Thanks Stephane.
> 
> But in your answer you reminded me another quick question. sl_subscribe
> is a pre-written script within 'tools" that come along with slony-I is
> that correct? I am running Enterprise DB which come with slony also but
> it does not come with these pre-written admin scripts. Do you know if I
> want to have it, how can I install it on top of my pre-existing slony?
> 

I was referring to the table stored under the slony specific schema.

You don't need any specific script to access sl_subscribe.

Regards,
- --
St?phane Schildknecht
PostgreSQLFr - http://www.postgresql.fr
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFKgDWlA+REPKWGI0ERAt9tAJ4qmEs918dAe4urczBAfMmw8gV//wCfRx9Z
CKiOM+kJ1Tx5pO4Tml6tpDY=
=y4yH
-----END PGP SIGNATURE-----
From cbbrowne at ca.afilias.info  Mon Aug 10 08:13:38 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Mon Aug 10 08:13:56 2009
Subject: [Slony1-general] Sequences not getting added
In-Reply-To: <bf54be870908080715m5f366277na91e32457a727d3a@mail.gmail.com>
	(Shoaib Mir's message of "Sun, 9 Aug 2009 00:15:22 +1000")
References: <4077e7710908072332h8004e75o76b7a52f6cc4c752@mail.gmail.com>
	<bf54be870908080046q32353193sfd5a12041511740a@mail.gmail.com>
	<4077e7710908080055x2efd0d52ob8783a019a2589e2@mail.gmail.com>
	<bf54be870908080110s783fd331ve75939e4054c8e40@mail.gmail.com>
	<2968dfd60908080630q37ff5480o3a546aba8de2acf3@mail.gmail.com>
	<bf54be870908080636y47bfcaffm5b571273a51c20@mail.gmail.com>
	<2968dfd60908080644m19fd4dfeg7abe382c61df28da@mail.gmail.com>
	<bf54be870908080715m5f366277na91e32457a727d3a@mail.gmail.com>
Message-ID: <877hxbg0rh.fsf@dba2.int.libertyrms.com>

Shoaib Mir <shoaibmir@gmail.com> writes:
> http://main.slony.info/viewcvs/viewvc.cgi/slony1-engine/SAMPLE?view=co

The example happens not to replicate the sequence; this isn't a
notably good/wise thing, as it means that if one were to switch
origins, the new origin wouldn't have sequences set to appropriate
values, which would cause problems.

For that example, the point was to get table data to replicate, and
the handling of sequences wasn't very much considered.

You'll generally need to replicate those sequences that you use, and
you need to do that explicitly.  It doesn't happen implicitly.
-- 
let name="cbbrowne" and tld="ca.afilias.info" in name ^ "@" ^ tld;;
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"
From cbbrowne at ca.afilias.info  Mon Aug 10 08:39:19 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Mon Aug 10 08:39:28 2009
Subject: [Slony1-general] Upgrade to 2.0 proposal: Subscribe set OMIT COPY
	option
In-Reply-To: <1249913226.3122.8.camel@giga.cambridge.mxdata.co.uk> (Mark
	Hagger's message of "Mon, 10 Aug 2009 15:07:06 +0100")
References: <87zlcdchwa.fsf@dba2.int.libertyrms.com>
	<87tz2lchf7.fsf@dba2.int.libertyrms.com>
	<1249913226.3122.8.camel@giga.cambridge.mxdata.co.uk>
Message-ID: <87y6prel08.fsf@dba2.int.libertyrms.com>

Mark Hagger <mark.hagger@mxdata.co.uk> writes:
> Just to clarify, your plan would mean that I would be able to:<BR>
> <BR>
> 1) run a script that dumps enough information to re-create the cluster from its current state<BR>
> 2) do the various unsubscribes/uninstalls of slony 1.x bits<BR>
> 3) Install new slony 2.x code<BR>
> 4) run this dumped script (more or less) to bring my cluster back to life<BR>
> <BR>
> For me the key bit is (1), since my cluster configurations (I have several created over a long period of time) means that my heart sinks at the idea of<BR>
> having to re-create all the clusters from scratch, plus the OMIT COPY bit looks like a huge win.<BR>
> <BR>

That sounds about right!

Here's the script to "dump enough information"...

<http://main.slony.info/viewcvs/viewvc.cgi/slony1-engine/tools/slonikconfdump.sh?revision=1.1.2.4&view=markup&sortby=date>

You should be able to run that script against your existing cluster;
I'd urge that you try it out, to see what output you get, and to
validate that it agrees with what you'd expect.
-- 
let name="cbbrowne" and tld="ca.afilias.info" in name ^ "@" ^ tld;;
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"
From mark.hagger at mxdata.co.uk  Mon Aug 10 09:03:26 2009
From: mark.hagger at mxdata.co.uk (Mark Hagger)
Date: Mon Aug 10 09:03:39 2009
Subject: [Slony1-general] Upgrade to 2.0 proposal: Subscribe set OMIT
	COPY option
In-Reply-To: <87y6prel08.fsf@dba2.int.libertyrms.com>
References: <87zlcdchwa.fsf@dba2.int.libertyrms.com>
	<87tz2lchf7.fsf@dba2.int.libertyrms.com>
	<1249913226.3122.8.camel@giga.cambridge.mxdata.co.uk>
	<87y6prel08.fsf@dba2.int.libertyrms.com>
Message-ID: <1249920206.3122.22.camel@giga.cambridge.mxdata.co.uk>

U2tpcHBlZCBjb250ZW50IG9mIHR5cGUgbXVsdGlwYXJ0L2FsdGVybmF0aXZlLS0tLS0tLS0tLS0t
LS0gbmV4dCBwYXJ0IC0tLS0tLS0tLS0tLS0tCkEgbm9uLXRleHQgYXR0YWNobWVudCB3YXMgc2Ny
dWJiZWQuLi4KTmFtZTogbXhkYXRhLmpwZwpUeXBlOiBpbWFnZS9qcGVnClNpemU6IDUwNTUgYnl0
ZXMKRGVzYzogbm90IGF2YWlsYWJsZQpVcmwgOiBodHRwOi8vbGlzdHMuc2xvbnkuaW5mby9waXBl
cm1haWwvc2xvbnkxLWdlbmVyYWwvYXR0YWNobWVudHMvMjAwOTA4MTAvNjhmMWFiNGYvbXhkYXRh
LTAwMDEuanBnCg==
From plk.zuber at gmail.com  Mon Aug 10 09:23:11 2009
From: plk.zuber at gmail.com (=?UTF-8?Q?Filip_Rembia=C5=82kowski?=)
Date: Mon Aug 10 09:23:21 2009
Subject: [Slony1-general] replicating 8.2 to 8.4
Message-ID: <92869e660908100923p186999bdj735ebce3bc3ef1c9@mail.gmail.com>

SGkgQWxsLgoKSXMgc2xvbnkgYWJsZSB0byByZXBsaWNhdGUgcG9zdGdyZXMgOC4yIHRvIDguND8K
CkV2ZW4gaWYgaXQncyBub3QgIm9mZmljaWFsbHkiIHN1cHBvcnRlZCwgd2hhdCBhcmUgdGhlIGNo
YW5jZXMgdG8gZ2V0IGl0Cndvcmtpbmc/IFdlJ3JlIGtpbmQgb2Ygc3R1Y2sgaGVyZSwgYW5kIHdl
IG5lZWQgc29tZSBhZHZpY2UuCgpUaGFua3MgaW4gYWR2YW5jZSwKRmlsaXAKLS0tLS0tLS0tLS0t
LS0gbmV4dCBwYXJ0IC0tLS0tLS0tLS0tLS0tCkFuIEhUTUwgYXR0YWNobWVudCB3YXMgc2NydWJi
ZWQuLi4KVVJMOiBodHRwOi8vbGlzdHMuc2xvbnkuaW5mby9waXBlcm1haWwvc2xvbnkxLWdlbmVy
YWwvYXR0YWNobWVudHMvMjAwOTA4MTAvM2QzMWIxZTYvYXR0YWNobWVudC5odG0K
From cscetbon.ext at orange-ftgroup.com  Mon Aug 10 09:40:45 2009
From: cscetbon.ext at orange-ftgroup.com (Cyril Scetbon)
Date: Mon Aug 10 09:40:52 2009
Subject: [Slony1-general] Replacing PostgreSQL 8.2 by Pg 8.3 does not work
Message-ID: <4A804D8D.3030604@orange-ftgroup.com>

Hi,

We're trying to upgrade one of our server from postgreSQL 8.2 to 8.3 
without re-subscribing the node. Here is the method we followed :

- stop slony
- load structure from pg8.2 to pg8.3
- disable triggers
- load data in pg8.3 from pg8.2
- enable triggers
- stop pg 8.2
- modify pg8.3 configuration file to bind on pg8.2 port
- restart pg8.3
- start slony

However, when slony is started with pg 8.3 it does not see new events 
from his provider (still in pg8.3).
If we restart our pg 8.2 with slony it works !

Do you know what we are missing ?

thx
-- 
Cyril SCETBON
From ahodgson at simkin.ca  Mon Aug 10 09:51:09 2009
From: ahodgson at simkin.ca (Alan Hodgson)
Date: Mon Aug 10 09:51:21 2009
Subject: [Slony1-general] Replacing PostgreSQL 8.2 by Pg 8.3 does not work
In-Reply-To: <4A804D8D.3030604@orange-ftgroup.com>
References: <4A804D8D.3030604@orange-ftgroup.com>
Message-ID: <200908100951.09842@hal.medialogik.com>

On Monday 10 August 2009, Cyril Scetbon <cscetbon.ext@orange-ftgroup.com> 
wrote:
> However, when slony is started with pg 8.3 it does not see new events
> from his provider (still in pg8.3).
> If we restart our pg 8.2 with slony it works !
>
> Do you know what we are missing ?
>
> thx

You need to modify all the table and sequence OIDs stored in the slony 
configuration tables to reflect the new table and sequence OIDs.

You need to update the slony functions through the appropriate slon 
commands.

There may also be other problems; it's not really a supported operation, as 
I understand it, and it's been a while since I've personally done it.

-- 
"... a serious depression seems improbable; [we expect] recovery of business
next spring, with further improvement in the fall." Harvard Economic
Society, November 10, 1929
From bnichols at ca.afilias.info  Mon Aug 10 10:07:19 2009
From: bnichols at ca.afilias.info (Brad Nicholson)
Date: Mon Aug 10 10:07:30 2009
Subject: [Slony1-general] replicating 8.2 to 8.4
In-Reply-To: <92869e660908100923p186999bdj735ebce3bc3ef1c9@mail.gmail.com>
References: <92869e660908100923p186999bdj735ebce3bc3ef1c9@mail.gmail.com>
Message-ID: <1249924039.18347.2.camel@bnicholson-desktop>

On Mon, 2009-08-10 at 18:23 +0200, Filip Rembia?kowski wrote:
> Hi All.
> 
> Is slony able to replicate postgres 8.2 to 8.4? 

Not currently.

The Slony 1.2.x does not work with 8.4, and 2.0 will not work with
versions prior to 8.3

> Even if it's not "officially" supported, what are the chances to get
> it working? We're kind of stuck here, and we need some advice.

You'd have port 1.2.x to 8.4.  There was some talk from the community
about getting 1.2.x running with 8.4, but I'm not sure where that
stands.

-- 
Brad Nicholson  416-673-4106
Database Administrator, Afilias Canada Corp.


From vivek at khera.org  Mon Aug 10 10:37:28 2009
From: vivek at khera.org (Vick Khera)
Date: Mon Aug 10 10:37:40 2009
Subject: [Slony1-general] install altperl scripts
In-Reply-To: <24896126.post@talk.nabble.com>
References: <24896126.post@talk.nabble.com>
Message-ID: <2968dfd60908101037r4dc2f168y312774cb81800807@mail.gmail.com>

On Mon, Aug 10, 2009 at 4:35 AM, roctaiwan<nettreeinc@gmail.com> wrote:
> If I am running Enterprise DB standard environment that Slony is part of the
> installation included with it. I do not have altperl. In this case, can I
> still installing the "perltools" individually? How?

Seems to me you should ask EnterpriseDB for support on their product
integration.  I suspect there would some way to just install those
bits of the original sources.  I'm sure inspecting the makefiles in
there will help figure that out.
From vivek at khera.org  Mon Aug 10 10:42:00 2009
From: vivek at khera.org (Vick Khera)
Date: Mon Aug 10 10:42:12 2009
Subject: [Slony1-general] replicating 8.2 to 8.4
In-Reply-To: <1249924039.18347.2.camel@bnicholson-desktop>
References: <92869e660908100923p186999bdj735ebce3bc3ef1c9@mail.gmail.com>
	<1249924039.18347.2.camel@bnicholson-desktop>
Message-ID: <2968dfd60908101042y3dc07b4dt21b6d1bd51355b13@mail.gmail.com>

2009/8/10 Brad Nicholson <bnichols@ca.afilias.info>:
> You'd have port 1.2.x to 8.4. ?There was some talk from the community
> about getting 1.2.x running with 8.4, but I'm not sure where that
> stands.

1.2.17 will support it.  See the web site for the RC snapshot.
From cbbrowne at ca.afilias.info  Mon Aug 10 11:59:32 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Mon Aug 10 11:59:51 2009
Subject: [Slony1-general] Upgrade to 2.0 proposal: Subscribe set OMIT COPY
	option
In-Reply-To: <1249920206.3122.22.camel@giga.cambridge.mxdata.co.uk> (Mark
	Hagger's message of "Mon, 10 Aug 2009 17:03:26 +0100")
References: <87zlcdchwa.fsf@dba2.int.libertyrms.com>
	<87tz2lchf7.fsf@dba2.int.libertyrms.com>
	<1249913226.3122.8.camel@giga.cambridge.mxdata.co.uk>
	<87y6prel08.fsf@dba2.int.libertyrms.com>
	<1249920206.3122.22.camel@giga.cambridge.mxdata.co.uk>
Message-ID: <87r5vjebqj.fsf@dba2.int.libertyrms.com>

Mark Hagger <mark.hagger@mxdata.co.uk> writes:
> That script works fine for me and the output looks good, although unless I missed something I had to modify it slightly to allow setting of the postgres host,user,port and database name for the varioous psql commands, ie making them things like:<BR>
> <BR>
> &nbsp;&nbsp;&nbsp; RESULTSET=`psql $pgargs -qtA -F &quot;:&quot; -R &quot; &quot; -c &quot;${QUERY}&quot; $pgdb`<BR>
> <BR>
> where pgargs=&quot;-h hostname -U username -p port&quot;<BR>
> and&nbsp; pgdb=&quot;dbname&quot;<BR>

Ah.  

The script assumes the use of the standard libpq environment variables
to control things:
 - PGPORT
 - PGHOST
 - PGDATABASE
 - PGUSER

That way, you can connect however you like without there ever being
any need to touch the script.
-- 
let name="cbbrowne" and tld="ca.afilias.info" in String.concat "@" [name;tld];;
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"
From cbbrowne at ca.afilias.info  Mon Aug 10 12:01:23 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Mon Aug 10 12:01:36 2009
Subject: [Slony1-general] replicating 8.2 to 8.4
In-Reply-To: <1249924039.18347.2.camel@bnicholson-desktop> (Brad Nicholson's
	message of "Mon, 10 Aug 2009 13:07:19 -0400")
References: <92869e660908100923p186999bdj735ebce3bc3ef1c9@mail.gmail.com>
	<1249924039.18347.2.camel@bnicholson-desktop>
Message-ID: <87my67ebng.fsf@dba2.int.libertyrms.com>

Brad Nicholson <bnichols@ca.afilias.info> writes:
> On Mon, 2009-08-10 at 18:23 +0200, Filip Rembia??kowski wrote:
>> Hi All.
>> 
>> Is slony able to replicate postgres 8.2 to 8.4? 
>
> Not currently.
>
> The Slony 1.2.x does not work with 8.4, and 2.0 will not work with
> versions prior to 8.3
>
>> Even if it's not "officially" supported, what are the chances to get
>> it working? We're kind of stuck here, and we need some advice.
>
> You'd have port 1.2.x to 8.4.  There was some talk from the community
> about getting 1.2.x running with 8.4, but I'm not sure where that
> stands.

The changes needed for 1.2.x to work with 8.4 have been committed;
1.2.17 will be the release that first handles this.

Devrim and I have been making a number of changes to 1.2-STABLE lately
to address issues we've been noticing; it's getting pretty close.
-- 
let name="cbbrowne" and tld="ca.afilias.info" in String.concat "@" [name;tld];;
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"
From cscetbon.ext at orange-ftgroup.com  Mon Aug 10 14:11:20 2009
From: cscetbon.ext at orange-ftgroup.com (Cyril Scetbon)
Date: Mon Aug 10 14:11:38 2009
Subject: [Slony1-general] Replacing PostgreSQL 8.2 by Pg 8.3 does not work
In-Reply-To: <200908100951.09842@hal.medialogik.com>
References: <4A804D8D.3030604@orange-ftgroup.com>
	<200908100951.09842@hal.medialogik.com>
Message-ID: <4A808CF8.2020503@orange-ftgroup.com>



Alan Hodgson a ?crit :
> On Monday 10 August 2009, Cyril Scetbon <cscetbon.ext@orange-ftgroup.com> 
> wrote:
>   
>> However, when slony is started with pg 8.3 it does not see new events
>> from his provider (still in pg8.3).
>> If we restart our pg 8.2 with slony it works !
>>
>> Do you know what we are missing ?
>>
>> thx
>>     
>
> You need to modify all the table and sequence OIDs stored in the slony 
> configuration tables to reflect the new table and sequence OIDs.
>   
I don't think oids are used and table id were not modified
> You need to update the slony functions through the appropriate slon 
> commands.
>   
really ?
> There may also be other problems; it's not really a supported operation, as 
> I understand it, and it's been a while since I've personally done it.
>   
thanks for this answer.

Anyone else ?

-- 
Cyril SCETBON 


From ahodgson at simkin.ca  Mon Aug 10 14:33:41 2009
From: ahodgson at simkin.ca (Alan Hodgson)
Date: Mon Aug 10 14:33:58 2009
Subject: [Slony1-general] Replacing PostgreSQL 8.2 by Pg 8.3 does not work
In-Reply-To: <4A808CF8.2020503@orange-ftgroup.com>
References: <4A804D8D.3030604@orange-ftgroup.com>
	<200908100951.09842@hal.medialogik.com>
	<4A808CF8.2020503@orange-ftgroup.com>
Message-ID: <200908101433.41504@hal.medialogik.com>

On Monday 10 August 2009, Cyril Scetbon <cscetbon.ext@orange-ftgroup.com> 
wrote:
> > You need to modify all the table and sequence OIDs stored in the slony
> > configuration tables to reflect the new table and sequence OIDs.
>
> I don't think oids are used and table id were not modified
>

Slony stores the OIDs of the actual tables themselves (at least in the 1.2 
line, dunno about 2.0). Those are different in your new schema and need to 
be updated.


-- 
"... a serious depression seems improbable; [we expect] recovery of business
next spring, with further improvement in the fall." Harvard Economic
Society, November 10, 1929
From chris at ca.afilias.info  Mon Aug 10 15:00:58 2009
From: chris at ca.afilias.info (chris)
Date: Mon Aug 10 15:15:27 2009
Subject: [Slony1-general] Replacing PostgreSQL 8.2 by Pg 8.3 does not work
In-Reply-To: <4A808CF8.2020503@orange-ftgroup.com> (Cyril Scetbon's message of
	"Mon, 10 Aug 2009 23:11:20 +0200")
References: <4A804D8D.3030604@orange-ftgroup.com>
	<200908100951.09842@hal.medialogik.com>
	<4A808CF8.2020503@orange-ftgroup.com>
Message-ID: <874osftjl1.fsf@dba2.int.libertyrms.com>

Cyril Scetbon <cscetbon.ext@orange-ftgroup.com> writes:
> Alan Hodgson a ?crit :
>> On Monday 10 August 2009, Cyril Scetbon
>> <cscetbon.ext@orange-ftgroup.com> wrote:
>>   
>>> However, when slony is started with pg 8.3 it does not see new events
>>> from his provider (still in pg8.3).
>>> If we restart our pg 8.2 with slony it works !
>>>
>>> Do you know what we are missing ?
>>>
>>> thx
>>>     
>>
>> You need to modify all the table and sequence OIDs stored in the
>> slony configuration tables to reflect the new table and sequence
>> OIDs.
>>   
> I don't think oids are used and table id were not modified

No, Alan's quite right.

If you look at sl_table and sl_sequence, you'll find "reloid" columns,
which are indeed relevant.

>> You need to update the slony functions through the appropriate slon
>> commands.
>>   
> really ?

The slonik "repair config" command should be useful.

<http://main.slony.info/documentation/stmtrepairconfig.html>

"Resets the name-to-oid mapping of tables in a replication set, useful
for restoring a node after a pg_dump."
-- 
output = ("cbbrowne" "@" "ca.afilias.info")
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"
From shoaibmir at gmail.com  Mon Aug 10 16:37:26 2009
From: shoaibmir at gmail.com (Shoaib Mir)
Date: Mon Aug 10 16:37:45 2009
Subject: [Slony1-general] Sequences not getting added
In-Reply-To: <877hxbg0rh.fsf@dba2.int.libertyrms.com>
References: <4077e7710908072332h8004e75o76b7a52f6cc4c752@mail.gmail.com>
	<bf54be870908080046q32353193sfd5a12041511740a@mail.gmail.com>
	<4077e7710908080055x2efd0d52ob8783a019a2589e2@mail.gmail.com>
	<bf54be870908080110s783fd331ve75939e4054c8e40@mail.gmail.com>
	<2968dfd60908080630q37ff5480o3a546aba8de2acf3@mail.gmail.com>
	<bf54be870908080636y47bfcaffm5b571273a51c20@mail.gmail.com>
	<2968dfd60908080644m19fd4dfeg7abe382c61df28da@mail.gmail.com>
	<bf54be870908080715m5f366277na91e32457a727d3a@mail.gmail.com>
	<877hxbg0rh.fsf@dba2.int.libertyrms.com>
Message-ID: <bf54be870908101637t1342e58cv3b79b0ba40dff120@mail.gmail.com>

On Tue, Aug 11, 2009 at 1:13 AM, Christopher Browne <
cbbrowne@ca.afilias.info> wrote:

> Shoaib Mir <shoaibmir@gmail.com> writes:
> > http://main.slony.info/viewcvs/viewvc.cgi/slony1-engine/SAMPLE?view=3Dco
>
> The example happens not to replicate the sequence; this isn't a
> notably good/wise thing, as it means that if one were to switch
> origins, the new origin wouldn't have sequences set to appropriate
> values, which would cause problems.
>
> For that example, the point was to get table data to replicate, and
> the handling of sequences wasn't very much considered.
>
> You'll generally need to replicate those sequences that you use, and
> you need to do that explicitly.  It doesn't happen implicitly.


Thanks Chris for an explanation on this.

-- =

Shoaib Mir
http://shoaibmir.wordpress.com/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090811/=
faa51709/attachment.htm
From nagaraj.shindagi at gmail.com  Mon Aug 10 21:22:26 2009
From: nagaraj.shindagi at gmail.com (nagaraj shindagi)
Date: Mon Aug 10 21:22:52 2009
Subject: [Slony1-general] how to make installer form source
Message-ID: <9fa914ca0908102122w36856607wb6e0fd3d51f134bb@mail.gmail.com>

hi friends,

i am using PG 8.3 for windows, and slony 1.2.5, now i want upgrade to
slony-I 2.0.2. so i downloaded source from Slony.info, *win32 binary is
slony-I-2.0.2R-pg83.zip<http://developer.pgadmin.org/%7Ehiroshi/Slony-I/slo=
ny-I-2.0.2R-pg83.zip>and
**installer script source is
slony_installer.zip<http://developer.pgadmin.org/%7Ehiroshi/Slony-I/slony_i=
nstaller.zip>from
http://developer.pgadmin.org/~hiroshi/Slony-I/*. Destination of download
file to Desktop. i extracted all these files in desktop only.

now i followed the instrcution which is given in win32 binary folder.
this is the readme file
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
This is Slony Version 2.0.2
Only a binary is offered by the reason no margin of time is.

1. Install
C:\Progrem Files\PostgreSQL\8.3 <=3D=3D=3D this path is fixation.

make date: 2009.05.13

Hiroshi Saito
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D

i copied the these files to C:\Progrem Files\PostgreSQL\8.3

after that i opened Installer folder
there i get readme file which contains
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
This directory contains the Slony-I installer for Windows. To build the
installer, you will need a copy of WiX installed somewhere in your system
path. The installer has been tested with WiX version 2.0.2419 only at the
time writing. WiX may be downloaded from:

  http://sourceforge.net/projects/wix/.

In order to build the installer, first ensure that a suitable binary is in
the $SRC\Release directory, then, from the $SRC\Installer directory run:

C:\Slony-I\Installer> make 1.2.7

The version number will default to a value set in the Make.bat batch file if
not specified on the command line. 2 files will be built:

Slony1.msm - A merge module for use in other projects.
Slony1.msi - A Windows Installer package for standalone use.
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D

I am not able to understand can anyone help me its urgent

regards
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090811/=
fe76d913/attachment.htm
From cscetbon.ext at orange-ftgroup.com  Tue Aug 11 02:29:06 2009
From: cscetbon.ext at orange-ftgroup.com (Cyril Scetbon)
Date: Tue Aug 11 02:30:21 2009
Subject: [Slony1-general] Replacing PostgreSQL 8.2 by Pg 8.3 does not work
In-Reply-To: <874osftjl1.fsf@dba2.int.libertyrms.com>
References: <4A804D8D.3030604@orange-ftgroup.com>	<200908100951.09842@hal.medialogik.com>	<4A808CF8.2020503@orange-ftgroup.com>
	<874osftjl1.fsf@dba2.int.libertyrms.com>
Message-ID: <4A8139E2.1030304@orange-ftgroup.com>

you are right !

mydb=# select oid,relname from pg_class where relname = 't_512';
  oid  | relname
-------+---------
 69187 | t_512
(1 row)

mydb=# select * from _pns_slony_voila_preprod_1.sl_table where 
tab_relname='t_512';
 tab_id | tab_reloid | tab_relname | tab_nspname | tab_set | tab_idxname 
| tab_altered |             tab_comment            
--------+------------+-------------+-------------+---------+-------------+-------------+-------------------------------------
    512 |      24638 | t_512       | public      |       1 | t_512_pkey  
| t           | Table public.t_512 with primary key
(1 row)

But, repair does not work correctly, and I can't debug it (tried by 
looking in the postgresql query log, but found nothing)

I'll try by dumping/reloading with oid. Any idea why the repair command 
does not work correctly ? I don't see updates on the node I want to be 
repaired. I used the following script :

echo > /var/tmp/repair.sql
slonik_print_preamble --config /etc/slony1/slon_tools_mydb.conf >> 
/var/tmp/repair.sql
for set in `seq 1 31`
do
  echo "REPAIR CONFIG (SET ID = $set, EVENT NODE = 101, EXECUTE ONLY ON 
=103);" >> /var/tmp/repair.sql
done
slonik < /var/tmp/repair.sql

I got no error but nothing seems to be done

thx

chris a ?crit :
> Cyril Scetbon <cscetbon.ext@orange-ftgroup.com> writes:
>   
>> Alan Hodgson a ?crit :
>>     
>>> On Monday 10 August 2009, Cyril Scetbon
>>> <cscetbon.ext@orange-ftgroup.com> wrote:
>>>   
>>>       
>>>> However, when slony is started with pg 8.3 it does not see new events
>>>> from his provider (still in pg8.3).
>>>> If we restart our pg 8.2 with slony it works !
>>>>
>>>> Do you know what we are missing ?
>>>>
>>>> thx
>>>>     
>>>>         
>>> You need to modify all the table and sequence OIDs stored in the
>>> slony configuration tables to reflect the new table and sequence
>>> OIDs.
>>>   
>>>       
>> I don't think oids are used and table id were not modified
>>     
>
> No, Alan's quite right.
>
> If you look at sl_table and sl_sequence, you'll find "reloid" columns,
> which are indeed relevant.
>
>   
>>> You need to update the slony functions through the appropriate slon
>>> commands.
>>>   
>>>       
>> really ?
>>     
>
> The slonik "repair config" command should be useful.
>
> <http://main.slony.info/documentation/stmtrepairconfig.html>
>
> "Resets the name-to-oid mapping of tables in a replication set, useful
> for restoring a node after a pg_dump."
>   

-- 
Cyril SCETBON
From cscetbon.ext at orange-ftgroup.com  Tue Aug 11 02:48:18 2009
From: cscetbon.ext at orange-ftgroup.com (Cyril Scetbon)
Date: Tue Aug 11 02:48:58 2009
Subject: [Slony1-general] Replacing PostgreSQL 8.2 by Pg 8.3 does not work
In-Reply-To: <4A8139E2.1030304@orange-ftgroup.com>
References: <4A804D8D.3030604@orange-ftgroup.com>	<200908100951.09842@hal.medialogik.com>	<4A808CF8.2020503@orange-ftgroup.com>	<874osftjl1.fsf@dba2.int.libertyrms.com>
	<4A8139E2.1030304@orange-ftgroup.com>
Message-ID: <4A813E62.8090104@orange-ftgroup.com>

Outch I can't dump the table oid (misunderstand between table oids and 
column oids). I'll look at the slonik code for the repair command.

Cyril Scetbon a ?crit :
> you are right !
>
> mydb=# select oid,relname from pg_class where relname = 't_512';
>  oid  | relname
> -------+---------
> 69187 | t_512
> (1 row)
>
> mydb=# select * from _pns_slony_voila_preprod_1.sl_table where 
> tab_relname='t_512';
> tab_id | tab_reloid | tab_relname | tab_nspname | tab_set | 
> tab_idxname | tab_altered |             tab_comment            
> --------+------------+-------------+-------------+---------+-------------+-------------+------------------------------------- 
>
>    512 |      24638 | t_512       | public      |       1 | 
> t_512_pkey  | t           | Table public.t_512 with primary key
> (1 row)
>
> But, repair does not work correctly, and I can't debug it (tried by 
> looking in the postgresql query log, but found nothing)
>
> I'll try by dumping/reloading with oid. Any idea why the repair 
> command does not work correctly ? I don't see updates on the node I 
> want to be repaired. I used the following script :
>
> echo > /var/tmp/repair.sql
> slonik_print_preamble --config /etc/slony1/slon_tools_mydb.conf >> 
> /var/tmp/repair.sql
> for set in `seq 1 31`
> do
>  echo "REPAIR CONFIG (SET ID = $set, EVENT NODE = 101, EXECUTE ONLY ON 
> =103);" >> /var/tmp/repair.sql
> done
> slonik < /var/tmp/repair.sql
>
> I got no error but nothing seems to be done
>
> thx
>
> chris a ?crit :
>> Cyril Scetbon <cscetbon.ext@orange-ftgroup.com> writes:
>>  
>>> Alan Hodgson a ?crit :
>>>    
>>>> On Monday 10 August 2009, Cyril Scetbon
>>>> <cscetbon.ext@orange-ftgroup.com> wrote:
>>>>        
>>>>> However, when slony is started with pg 8.3 it does not see new events
>>>>> from his provider (still in pg8.3).
>>>>> If we restart our pg 8.2 with slony it works !
>>>>>
>>>>> Do you know what we are missing ?
>>>>>
>>>>> thx
>>>>>             
>>>> You need to modify all the table and sequence OIDs stored in the
>>>> slony configuration tables to reflect the new table and sequence
>>>> OIDs.
>>>>         
>>> I don't think oids are used and table id were not modified
>>>     
>>
>> No, Alan's quite right.
>>
>> If you look at sl_table and sl_sequence, you'll find "reloid" columns,
>> which are indeed relevant.
>>
>>  
>>>> You need to update the slony functions through the appropriate slon
>>>> commands.
>>>>         
>>> really ?
>>>     
>>
>> The slonik "repair config" command should be useful.
>>
>> <http://main.slony.info/documentation/stmtrepairconfig.html>
>>
>> "Resets the name-to-oid mapping of tables in a replication set, useful
>> for restoring a node after a pg_dump."
>>   
>

-- 
Cyril SCETBON
From glynastill at yahoo.co.uk  Tue Aug 11 02:54:42 2009
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Tue Aug 11 02:55:18 2009
Subject: [Slony1-general] Replacing PostgreSQL 8.2 by Pg 8.3 does not work
In-Reply-To: <4A813E62.8090104@orange-ftgroup.com>
References: <4A804D8D.3030604@orange-ftgroup.com>
	<200908100951.09842@hal.medialogik.com>
	<4A808CF8.2020503@orange-ftgroup.com>
	<874osftjl1.fsf@dba2.int.libertyrms.com>
	<4A8139E2.1030304@orange-ftgroup.com>
	<4A813E62.8090104@orange-ftgroup.com>
Message-ID: <149605.38790.qm@web23606.mail.ird.yahoo.com>


I'm not sure why repair config isn't working for you, however if you're looking for the baremetal function it is updatereloid(set, node).





----- Original Message ----
> From: Cyril Scetbon <cscetbon.ext@orange-ftgroup.com>
> To: chris <chris@ca.afilias.info>; slony1-general@lists.slony.info
> Sent: Tuesday, 11 August, 2009 10:48:18
> Subject: Re: [Slony1-general] Replacing PostgreSQL 8.2 by Pg 8.3 does not work
> 
> Outch I can't dump the table oid (misunderstand between table oids and column 
> oids). I'll look at the slonik code for the repair command.
> 
> Cyril Scetbon a ?crit :
> > you are right !
> > 
> > mydb=# select oid,relname from pg_class where relname = 't_512';
> >  oid  | relname
> > -------+---------
> > 69187 | t_512
> > (1 row)
> > 
> > mydb=# select * from _pns_slony_voila_preprod_1.sl_table where 
> tab_relname='t_512';
> > tab_id | tab_reloid | tab_relname | tab_nspname | tab_set | tab_idxname | 
> tab_altered |             tab_comment            
> --------+------------+-------------+-------------+---------+-------------+-------------+------------------------------------- 
> 
> >    512 |      24638 | t_512       | public      |       1 | t_512_pkey  | t    
>        | Table public.t_512 with primary key
> > (1 row)
> > 
> > But, repair does not work correctly, and I can't debug it (tried by looking in 
> the postgresql query log, but found nothing)
> > 
> > I'll try by dumping/reloading with oid. Any idea why the repair command does 
> not work correctly ? I don't see updates on the node I want to be repaired. I 
> used the following script :
> > 
> > echo > /var/tmp/repair.sql
> > slonik_print_preamble --config /etc/slony1/slon_tools_mydb.conf >> 
> /var/tmp/repair.sql
> > for set in `seq 1 31`
> > do
> >  echo "REPAIR CONFIG (SET ID = $set, EVENT NODE = 101, EXECUTE ONLY ON =103);" 
> >> /var/tmp/repair.sql
> > done
> > slonik < /var/tmp/repair.sql
> > 
> > I got no error but nothing seems to be done
> > 
> > thx
> > 
> > chris a ?crit :
> >> Cyril Scetbon writes:
> >>  
> >>> Alan Hodgson a ?crit :
> >>>    
> >>>> On Monday 10 August 2009, Cyril Scetbon
> >>>> wrote:
> >>>>        
> >>>>> However, when slony is started with pg 8.3 it does not see new events
> >>>>> from his provider (still in pg8.3).
> >>>>> If we restart our pg 8.2 with slony it works !
> >>>>> 
> >>>>> Do you know what we are missing ?
> >>>>> 
> >>>>> thx
> >>>>>            
> >>>> You need to modify all the table and sequence OIDs stored in the
> >>>> slony configuration tables to reflect the new table and sequence
> >>>> OIDs.
> >>>>        
> >>> I don't think oids are used and table id were not modified
> >>>    
> >> 
> >> No, Alan's quite right.
> >> 
> >> If you look at sl_table and sl_sequence, you'll find "reloid" columns,
> >> which are indeed relevant.
> >> 
> >>  
> >>>> You need to update the slony functions through the appropriate slon
> >>>> commands.
> >>>>        
> >>> really ?
> >>>    
> >> 
> >> The slonik "repair config" command should be useful.
> >> 
> >> 
> >> 
> >> "Resets the name-to-oid mapping of tables in a replication set, useful
> >> for restoring a node after a pg_dump."
> >>  
> > 
> 
> -- Cyril SCETBON
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general



      
From cscetbon.ext at orange-ftgroup.com  Tue Aug 11 05:28:37 2009
From: cscetbon.ext at orange-ftgroup.com (Cyril Scetbon)
Date: Tue Aug 11 05:28:44 2009
Subject: [Slony1-general] Replacing PostgreSQL 8.2 by Pg 8.3 does not work
In-Reply-To: <149605.38790.qm@web23606.mail.ird.yahoo.com>
References: <4A804D8D.3030604@orange-ftgroup.com>
	<200908100951.09842@hal.medialogik.com>
	<4A808CF8.2020503@orange-ftgroup.com>
	<874osftjl1.fsf@dba2.int.libertyrms.com>
	<4A8139E2.1030304@orange-ftgroup.com>
	<4A813E62.8090104@orange-ftgroup.com>
	<149605.38790.qm@web23606.mail.ird.yahoo.com>
Message-ID: <4A8163F5.8000507@orange-ftgroup.com>

I had to submit it to the same node it was applied on. Still getting 
some error and investiguating...

Glyn Astill a ?crit :
> I'm not sure why repair config isn't working for you, however if you're looking for the baremetal function it is updatereloid(set, node).
>
>
>
>
>
> ----- Original Message ----
>   
>> From: Cyril Scetbon <cscetbon.ext@orange-ftgroup.com>
>> To: chris <chris@ca.afilias.info>; slony1-general@lists.slony.info
>> Sent: Tuesday, 11 August, 2009 10:48:18
>> Subject: Re: [Slony1-general] Replacing PostgreSQL 8.2 by Pg 8.3 does not work
>>
>> Outch I can't dump the table oid (misunderstand between table oids and column 
>> oids). I'll look at the slonik code for the repair command.
>>
>> Cyril Scetbon a ?crit :
>>     
>>> you are right !
>>>
>>> mydb=# select oid,relname from pg_class where relname = 't_512';
>>>  oid  | relname
>>> -------+---------
>>> 69187 | t_512
>>> (1 row)
>>>
>>> mydb=# select * from _pns_slony_voila_preprod_1.sl_table where 
>>>       
>> tab_relname='t_512';
>>     
>>> tab_id | tab_reloid | tab_relname | tab_nspname | tab_set | tab_idxname | 
>>>       
>> tab_altered |             tab_comment            
>> --------+------------+-------------+-------------+---------+-------------+-------------+------------------------------------- 
>>
>>     
>>>    512 |      24638 | t_512       | public      |       1 | t_512_pkey  | t    
>>>       
>>        | Table public.t_512 with primary key
>>     
>>> (1 row)
>>>
>>> But, repair does not work correctly, and I can't debug it (tried by looking in 
>>>       
>> the postgresql query log, but found nothing)
>>     
>>> I'll try by dumping/reloading with oid. Any idea why the repair command does 
>>>       
>> not work correctly ? I don't see updates on the node I want to be repaired. I 
>> used the following script :
>>     
>>> echo > /var/tmp/repair.sql
>>> slonik_print_preamble --config /etc/slony1/slon_tools_mydb.conf >> 
>>>       
>> /var/tmp/repair.sql
>>     
>>> for set in `seq 1 31`
>>> do
>>>  echo "REPAIR CONFIG (SET ID = $set, EVENT NODE = 101, EXECUTE ONLY ON =103);" 
>>>       
>>>> /var/tmp/repair.sql
>>>>         
>>> done
>>> slonik < /var/tmp/repair.sql
>>>
>>> I got no error but nothing seems to be done
>>>
>>> thx
>>>
>>> chris a ?crit :
>>>       
>>>> Cyril Scetbon writes:
>>>>  
>>>>         
>>>>> Alan Hodgson a ?crit :
>>>>>    
>>>>>           
>>>>>> On Monday 10 August 2009, Cyril Scetbon
>>>>>> wrote:
>>>>>>        
>>>>>>             
>>>>>>> However, when slony is started with pg 8.3 it does not see new events
>>>>>>> from his provider (still in pg8.3).
>>>>>>> If we restart our pg 8.2 with slony it works !
>>>>>>>
>>>>>>> Do you know what we are missing ?
>>>>>>>
>>>>>>> thx
>>>>>>>            
>>>>>>>               
>>>>>> You need to modify all the table and sequence OIDs stored in the
>>>>>> slony configuration tables to reflect the new table and sequence
>>>>>> OIDs.
>>>>>>        
>>>>>>             
>>>>> I don't think oids are used and table id were not modified
>>>>>    
>>>>>           
>>>> No, Alan's quite right.
>>>>
>>>> If you look at sl_table and sl_sequence, you'll find "reloid" columns,
>>>> which are indeed relevant.
>>>>
>>>>  
>>>>         
>>>>>> You need to update the slony functions through the appropriate slon
>>>>>> commands.
>>>>>>        
>>>>>>             
>>>>> really ?
>>>>>    
>>>>>           
>>>> The slonik "repair config" command should be useful.
>>>>
>>>>
>>>>
>>>> "Resets the name-to-oid mapping of tables in a replication set, useful
>>>> for restoring a node after a pg_dump."
>>>>  
>>>>         
>> -- Cyril SCETBON
>> _______________________________________________
>> Slony1-general mailing list
>> Slony1-general@lists.slony.info
>> http://lists.slony.info/mailman/listinfo/slony1-general
>>     
>
>
>
>       
>   

-- 
Cyril SCETBON - Ing?nieur bases de donn?es
Cellule bases de donn?es
AUSY pour France T?l?com - OPF/PORTAILS/DOP/HEBEX

T?l : +33 (0)4 97 12 87 60
Jabber : cscetbon@jabber.org
France Telecom - Orange
790 Avenue du Docteur Maurice Donat 
B?timent Marco Polo C1 - Bureau 202
06250 Mougins
France

***********************************
Ce message et toutes les pieces jointes (ci-apres le 'message') sont
confidentiels et etablis a l'intention exclusive de ses destinataires.
Toute utilisation ou diffusion non autorisee est interdite.
Tout message electronique est susceptible d'alteration. Le Groupe France
Telecom decline toute responsabilite au titre de ce message s'il a ete
altere, deforme ou falsifie.
Si vous n'etes pas destinataire de ce message, merci de le detruire
immediatement et d'avertir l'expediteur.
***********************************
This message and any attachments (the 'message') are confidential and
intended solely for the addressees.
Any unauthorised use or dissemination is prohibited.
Messages are susceptible to alteration. France Telecom Group shall not be
liable for the message if altered, changed or falsified.
If you are not recipient of this message, please cancel it immediately and
inform the sender.
************************************

From cscetbon.ext at orange-ftgroup.com  Tue Aug 11 07:56:26 2009
From: cscetbon.ext at orange-ftgroup.com (Cyril Scetbon)
Date: Tue Aug 11 07:56:39 2009
Subject: [Slony1-general] Replacing PostgreSQL 8.2 by Pg 8.3 does not work
In-Reply-To: <4A8163F5.8000507@orange-ftgroup.com>
References: <4A804D8D.3030604@orange-ftgroup.com>	<200908100951.09842@hal.medialogik.com>	<4A808CF8.2020503@orange-ftgroup.com>	<874osftjl1.fsf@dba2.int.libertyrms.com>	<4A8139E2.1030304@orange-ftgroup.com>	<4A813E62.8090104@orange-ftgroup.com>	<149605.38790.qm@web23606.mail.ird.yahoo.com>
	<4A8163F5.8000507@orange-ftgroup.com>
Message-ID: <4A81869A.6040307@orange-ftgroup.com>

FYI,

I did the pg_dump/load another time and used repair config on this node. 
Now the provider is stuck on RESET CONFIG :

2009-08-11 16:54:01 CEST DEBUG1 main: running scheduler mainloop
2009-08-11 16:54:01 CEST DEBUG1 remoteListenThread_104: connected to 
'host=slave-db02.profiles.qualif.pns.b3.p.fti.net 
dbname=pns_voila_preprod user=pns_slon
y_voila_preprod port=5432 password=pns_v0!la_sl0ny_pr3pr0d'
2009-08-11 16:54:01 CEST DEBUG1 remoteListenThread_103: connected to 
'host=master-db02.profiles.qualif.pns.b3.p.fti.net 
dbname=pns_voila_preprod user=pns_slo
ny_voila_preprod port=5432 password=pns_v0!la_sl0ny_pr3pr0d'
2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_103: queue event 
103,477 SYNC
2009-08-11 16:54:01 CEST DEBUG2 remoteWorkerThread_103: Received event 
103,477 SYNC
2009-08-11 16:54:01 CEST DEBUG2 remoteWorkerThread_103: SYNC 477 processing
2009-08-11 16:54:01 CEST DEBUG2 remoteWorkerThread_103: no sets need 
syncing for this event
2009-08-11 16:54:01 CEST DEBUG2 remoteWorkerThread_103: forward confirm 
101,113409 received by 104
2009-08-11 16:54:01 CEST DEBUG2 remoteWorkerThread_103: forward confirm 
101,112143 received by 102
2009-08-11 16:54:01 CEST DEBUG2 remoteWorkerThread_103: forward confirm 
101,114448 received by 103
2009-08-11 16:54:01 CEST DEBUG2 remoteWorkerThread_103: forward confirm 
103,207 received by 104
2009-08-11 16:54:01 CEST DEBUG2 remoteWorkerThread_103: forward confirm 
104,58 received by 103
2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
103,477 SYNC
2009-08-11 16:54:01 CEST DEBUG2 remoteWorker_event: event 103,477 
ignored - duplicate
2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
104,59 RESET_CONFIG
2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
104,60 RESET_CONFIG
2009-08-11 16:54:01 CEST DEBUG2 remoteWorkerThread_104: Received event 
104,59 RESET_CONFIG
2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
104,61 RESET_CONFIG
2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
104,62 RESET_CONFIG
2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
104,63 RESET_CONFIG
2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
104,64 RESET_CONFIG
2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
104,65 RESET_CONFIG
2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
104,66 RESET_CONFIG
2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
104,67 RESET_CONFIG
2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
104,68 RESET_CONFIG
2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
104,69 RESET_CONFIG
2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
104,70 RESET_CONFIG
2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
104,71 RESET_CONFIG
2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
104,72 RESET_CONFIG
2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
104,73 RESET_CONFIG
2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
104,74 RESET_CONFIG
2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
104,75 RESET_CONFIG
2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
104,76 RESET_CONFIG
2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
104,77 RESET_CONFIG
2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
104,78 RESET_CONFIG
2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
104,79 RESET_CONFIG
2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
104,80 RESET_CONFIG
2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
104,81 RESET_CONFIG
2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
104,82 RESET_CONFIG
2009-08-11 16:54:01 CEST DEBUG2 slon: child terminated status: 11; pid: 
24444, current worker pid: 24444
2009-08-11 16:54:01 CEST DEBUG1 slon: restart of worker in 10 seconds

and I really don't know what's happening ! other nodes are waiting for 
sync of set (that are updated) :

2009-08-11 16:54:49 CEST DEBUG2 calc sync size - last time: 1 last 
length: 6217 ideal: 3 proposed size: 3
2009-08-11 16:54:49 CEST DEBUG2 remoteWorkerThread_103: SYNC 482 processing
2009-08-11 16:54:49 CEST DEBUG2 remoteWorkerThread_103: no sets need 
syncing for this event
2009-08-11 16:54:49 CEST DEBUG2 syncThread: new sl_action_seq 1 - SYNC 223
2009-08-11 16:54:51 CEST DEBUG2 localListenThread: Received event 
104,223 SYNC
2009-08-11 16:54:54 CEST DEBUG2 remoteListenThread_101: LISTEN
2009-08-11 16:54:54 CEST DEBUG2 remoteWorkerThread_101: forward confirm 
103,482 received by 101
2009-08-11 16:54:59 CEST DEBUG2 syncThread: new sl_action_seq 1 - SYNC 224
2009-08-11 16:55:00 CEST DEBUG2 remoteListenThread_103: queue event 
103,483 SYNC
2009-08-11 16:55:00 CEST DEBUG2 remoteListenThread_103: UNLISTEN
2009-08-11 16:55:00 CEST DEBUG2 remoteWorkerThread_103: Received event 
103,483 SYNC
2009-08-11 16:55:00 CEST DEBUG2 calc sync size - last time: 1 last 
length: 11011 ideal: 1 proposed size: 1
2009-08-11 16:55:00 CEST DEBUG2 remoteWorkerThread_103: SYNC 483 processing
2009-08-11 16:55:00 CEST DEBUG2 remoteWorkerThread_103: no sets need 
syncing for this event
2009-08-11 16:55:01 CEST DEBUG2 localListenThread: Received event 
104,224 SYNC
2009-08-11 16:55:03 CEST DEBUG2 remoteWorkerThread_101: forward confirm 
103,483 received by 101
2009-08-11 16:55:04 CEST DEBUG2 remoteListenThread_103: LISTEN
2009-08-11 16:55:09 CEST DEBUG2 remoteListenThread_103: queue event 
103,484 SYNC
2009-08-11 16:55:09 CEST DEBUG2 remoteListenThread_103: UNLISTEN
2009-08-11 16:55:09 CEST DEBUG2 remoteWorkerThread_103: Received event 
103,484 SYNC
2009-08-11 16:55:09 CEST DEBUG2 calc sync size - last time: 1 last 
length: 8989 ideal: 2 proposed size: 2
2009-08-11 16:55:09 CEST DEBUG2 remoteWorkerThread_103: SYNC 484 processing
2009-08-11 16:55:09 CEST DEBUG2 remoteWorkerThread_103: no sets need 
syncing for this event
2009-08-11 16:55:09 CEST DEBUG2 syncThread: new sl_action_seq 1 - SYNC 225
2009-08-11 16:55:11 CEST DEBUG2 localListenThread: Received event 
104,225 SYNC
2009-08-11 16:55:13 CEST DEBUG2 remoteListenThread_103: LISTEN
2009-08-11 16:55:13 CEST DEBUG2 remoteWorkerThread_101: forward confirm 
103,484 received by 101
2009-08-11 16:55:19 CEST DEBUG2 remoteListenThread_103: queue event 
103,485 SYNC
2009-08-11 16:55:19 CEST DEBUG2 remoteListenThread_103: UNLISTEN
2009-08-11 16:55:19 CEST DEBUG2 remoteWorkerThread_103: Received event 
103,485 SYNC
2009-08-11 16:55:19 CEST DEBUG2 calc sync size - last time: 1 last 
length: 10003 ideal: 1 proposed size: 1
2009-08-11 16:55:19 CEST DEBUG2 remoteWorkerThread_103: SYNC 485 processing
2009-08-11 16:55:19 CEST DEBUG2 remoteWorkerThread_103: no sets need 
syncing for this event
2009-08-11 16:55:19 CEST DEBUG2 syncThread: new sl_action_seq 1 - SYNC 226
2009-08-11 16:55:21 CEST DEBUG2 localListenThread: Received event 
104,226 SYNC
2009-08-11 16:55:23 CEST DEBUG2 remoteListenThread_101: LISTEN
2009-08-11 16:55:24 CEST DEBUG2 remoteWorkerThread_101: forward confirm 
103,485 received by 101

any help ?

Should I really use update function on the node upgraded ? on every node ?

Cyril Scetbon a ?crit :
> I had to submit it to the same node it was applied on. Still getting 
> some error and investiguating...
>
> Glyn Astill a ?crit :
>> I'm not sure why repair config isn't working for you, however if 
>> you're looking for the baremetal function it is updatereloid(set, node).
>>
>>
>>
>>
>>
>> ----- Original Message ----
>>  
>>> From: Cyril Scetbon <cscetbon.ext@orange-ftgroup.com>
>>> To: chris <chris@ca.afilias.info>; slony1-general@lists.slony.info
>>> Sent: Tuesday, 11 August, 2009 10:48:18
>>> Subject: Re: [Slony1-general] Replacing PostgreSQL 8.2 by Pg 8.3 
>>> does not work
>>>
>>> Outch I can't dump the table oid (misunderstand between table oids 
>>> and column oids). I'll look at the slonik code for the repair command.
>>>
>>> Cyril Scetbon a ?crit :
>>>    
>>>> you are right !
>>>>
>>>> mydb=# select oid,relname from pg_class where relname = 't_512';
>>>>  oid  | relname
>>>> -------+---------
>>>> 69187 | t_512
>>>> (1 row)
>>>>
>>>> mydb=# select * from _pns_slony_voila_preprod_1.sl_table where       
>>> tab_relname='t_512';
>>>    
>>>> tab_id | tab_reloid | tab_relname | tab_nspname | tab_set | 
>>>> tab_idxname |       
>>> tab_altered |             tab_comment            
>>> --------+------------+-------------+-------------+---------+-------------+-------------+------------------------------------- 
>>>
>>>    
>>>>    512 |      24638 | t_512       | public      |       1 | 
>>>> t_512_pkey  | t          
>>>        | Table public.t_512 with primary key
>>>    
>>>> (1 row)
>>>>
>>>> But, repair does not work correctly, and I can't debug it (tried by 
>>>> looking in       
>>> the postgresql query log, but found nothing)
>>>    
>>>> I'll try by dumping/reloading with oid. Any idea why the repair 
>>>> command does       
>>> not work correctly ? I don't see updates on the node I want to be 
>>> repaired. I used the following script :
>>>    
>>>> echo > /var/tmp/repair.sql
>>>> slonik_print_preamble --config /etc/slony1/slon_tools_mydb.conf >> 
>>>>       
>>> /var/tmp/repair.sql
>>>    
>>>> for set in `seq 1 31`
>>>> do
>>>>  echo "REPAIR CONFIG (SET ID = $set, EVENT NODE = 101, EXECUTE ONLY 
>>>> ON =103);"      
>>>>> /var/tmp/repair.sql
>>>>>         
>>>> done
>>>> slonik < /var/tmp/repair.sql
>>>>
>>>> I got no error but nothing seems to be done
>>>>
>>>> thx
>>>>
>>>> chris a ?crit :
>>>>      
>>>>> Cyril Scetbon writes:
>>>>>  
>>>>>        
>>>>>> Alan Hodgson a ?crit :
>>>>>>             
>>>>>>> On Monday 10 August 2009, Cyril Scetbon
>>>>>>> wrote:
>>>>>>>                   
>>>>>>>> However, when slony is started with pg 8.3 it does not see new 
>>>>>>>> events
>>>>>>>> from his provider (still in pg8.3).
>>>>>>>> If we restart our pg 8.2 with slony it works !
>>>>>>>>
>>>>>>>> Do you know what we are missing ?
>>>>>>>>
>>>>>>>> thx
>>>>>>>>                          
>>>>>>> You need to modify all the table and sequence OIDs stored in the
>>>>>>> slony configuration tables to reflect the new table and sequence
>>>>>>> OIDs.
>>>>>>>                    
>>>>>> I don't think oids are used and table id were not modified
>>>>>>              
>>>>> No, Alan's quite right.
>>>>>
>>>>> If you look at sl_table and sl_sequence, you'll find "reloid" 
>>>>> columns,
>>>>> which are indeed relevant.
>>>>>
>>>>>  
>>>>>        
>>>>>>> You need to update the slony functions through the appropriate slon
>>>>>>> commands.
>>>>>>>                    
>>>>>> really ?
>>>>>>              
>>>>> The slonik "repair config" command should be useful.
>>>>>
>>>>>
>>>>>
>>>>> "Resets the name-to-oid mapping of tables in a replication set, 
>>>>> useful
>>>>> for restoring a node after a pg_dump."
>>>>>  
>>>>>         
>>> -- Cyril SCETBON
>>> _______________________________________________
>>> Slony1-general mailing list
>>> Slony1-general@lists.slony.info
>>> http://lists.slony.info/mailman/listinfo/slony1-general
>>>     
>>
>>
>>
>>         
>

-- 
Cyril SCETBON - Ing?nieur bases de donn?es
Cellule bases de donn?es
AUSY pour France T?l?com - OPF/PORTAILS/DOP/HEBEX

T?l : +33 (0)4 97 12 87 60
Jabber : cscetbon@jabber.org
France Telecom - Orange
790 Avenue du Docteur Maurice Donat 
B?timent Marco Polo C1 - Bureau 202
06250 Mougins
France

***********************************
Ce message et toutes les pieces jointes (ci-apres le 'message') sont
confidentiels et etablis a l'intention exclusive de ses destinataires.
Toute utilisation ou diffusion non autorisee est interdite.
Tout message electronique est susceptible d'alteration. Le Groupe France
Telecom decline toute responsabilite au titre de ce message s'il a ete
altere, deforme ou falsifie.
Si vous n'etes pas destinataire de ce message, merci de le detruire
immediatement et d'avertir l'expediteur.
***********************************
This message and any attachments (the 'message') are confidential and
intended solely for the addressees.
Any unauthorised use or dissemination is prohibited.
Messages are susceptible to alteration. France Telecom Group shall not be
liable for the message if altered, changed or falsified.
If you are not recipient of this message, please cancel it immediately and
inform the sender.
************************************

From cscetbon.ext at orange-ftgroup.com  Tue Aug 11 08:04:03 2009
From: cscetbon.ext at orange-ftgroup.com (Cyril Scetbon)
Date: Tue Aug 11 08:04:14 2009
Subject: [Slony1-general] Replacing PostgreSQL 8.2 by Pg 8.3 does not work
In-Reply-To: <4A81869A.6040307@orange-ftgroup.com>
References: <4A804D8D.3030604@orange-ftgroup.com>	<200908100951.09842@hal.medialogik.com>	<4A808CF8.2020503@orange-ftgroup.com>	<874osftjl1.fsf@dba2.int.libertyrms.com>	<4A8139E2.1030304@orange-ftgroup.com>	<4A813E62.8090104@orange-ftgroup.com>	<149605.38790.qm@web23606.mail.ird.yahoo.com>	<4A8163F5.8000507@orange-ftgroup.com>
	<4A81869A.6040307@orange-ftgroup.com>
Message-ID: <4A818863.4000401@orange-ftgroup.com>

Another important information : we are using Slony 1.2.15 (it says that 
Slony is compatible with PostgreSQL 8.3 since version 1.2.13)

Cyril Scetbon a ?crit :
> FYI,
>
> I did the pg_dump/load another time and used repair config on this 
> node. Now the provider is stuck on RESET CONFIG :
>
> 2009-08-11 16:54:01 CEST DEBUG1 main: running scheduler mainloop
> 2009-08-11 16:54:01 CEST DEBUG1 remoteListenThread_104: connected to 
> 'host=slave-db02.profiles.qualif.pns.b3.p.fti.net 
> dbname=pns_voila_preprod user=pns_slon
> y_voila_preprod port=5432 password=pns_v0!la_sl0ny_pr3pr0d'
> 2009-08-11 16:54:01 CEST DEBUG1 remoteListenThread_103: connected to 
> 'host=master-db02.profiles.qualif.pns.b3.p.fti.net 
> dbname=pns_voila_preprod user=pns_slo
> ny_voila_preprod port=5432 password=pns_v0!la_sl0ny_pr3pr0d'
> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_103: queue event 
> 103,477 SYNC
> 2009-08-11 16:54:01 CEST DEBUG2 remoteWorkerThread_103: Received event 
> 103,477 SYNC
> 2009-08-11 16:54:01 CEST DEBUG2 remoteWorkerThread_103: SYNC 477 
> processing
> 2009-08-11 16:54:01 CEST DEBUG2 remoteWorkerThread_103: no sets need 
> syncing for this event
> 2009-08-11 16:54:01 CEST DEBUG2 remoteWorkerThread_103: forward 
> confirm 101,113409 received by 104
> 2009-08-11 16:54:01 CEST DEBUG2 remoteWorkerThread_103: forward 
> confirm 101,112143 received by 102
> 2009-08-11 16:54:01 CEST DEBUG2 remoteWorkerThread_103: forward 
> confirm 101,114448 received by 103
> 2009-08-11 16:54:01 CEST DEBUG2 remoteWorkerThread_103: forward 
> confirm 103,207 received by 104
> 2009-08-11 16:54:01 CEST DEBUG2 remoteWorkerThread_103: forward 
> confirm 104,58 received by 103
> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
> 103,477 SYNC
> 2009-08-11 16:54:01 CEST DEBUG2 remoteWorker_event: event 103,477 
> ignored - duplicate
> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
> 104,59 RESET_CONFIG
> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
> 104,60 RESET_CONFIG
> 2009-08-11 16:54:01 CEST DEBUG2 remoteWorkerThread_104: Received event 
> 104,59 RESET_CONFIG
> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
> 104,61 RESET_CONFIG
> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
> 104,62 RESET_CONFIG
> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
> 104,63 RESET_CONFIG
> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
> 104,64 RESET_CONFIG
> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
> 104,65 RESET_CONFIG
> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
> 104,66 RESET_CONFIG
> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
> 104,67 RESET_CONFIG
> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
> 104,68 RESET_CONFIG
> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
> 104,69 RESET_CONFIG
> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
> 104,70 RESET_CONFIG
> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
> 104,71 RESET_CONFIG
> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
> 104,72 RESET_CONFIG
> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
> 104,73 RESET_CONFIG
> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
> 104,74 RESET_CONFIG
> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
> 104,75 RESET_CONFIG
> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
> 104,76 RESET_CONFIG
> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
> 104,77 RESET_CONFIG
> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
> 104,78 RESET_CONFIG
> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
> 104,79 RESET_CONFIG
> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
> 104,80 RESET_CONFIG
> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
> 104,81 RESET_CONFIG
> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
> 104,82 RESET_CONFIG
> 2009-08-11 16:54:01 CEST DEBUG2 slon: child terminated status: 11; 
> pid: 24444, current worker pid: 24444
> 2009-08-11 16:54:01 CEST DEBUG1 slon: restart of worker in 10 seconds
>
> and I really don't know what's happening ! other nodes are waiting for 
> sync of set (that are updated) :
>
> 2009-08-11 16:54:49 CEST DEBUG2 calc sync size - last time: 1 last 
> length: 6217 ideal: 3 proposed size: 3
> 2009-08-11 16:54:49 CEST DEBUG2 remoteWorkerThread_103: SYNC 482 
> processing
> 2009-08-11 16:54:49 CEST DEBUG2 remoteWorkerThread_103: no sets need 
> syncing for this event
> 2009-08-11 16:54:49 CEST DEBUG2 syncThread: new sl_action_seq 1 - SYNC 
> 223
> 2009-08-11 16:54:51 CEST DEBUG2 localListenThread: Received event 
> 104,223 SYNC
> 2009-08-11 16:54:54 CEST DEBUG2 remoteListenThread_101: LISTEN
> 2009-08-11 16:54:54 CEST DEBUG2 remoteWorkerThread_101: forward 
> confirm 103,482 received by 101
> 2009-08-11 16:54:59 CEST DEBUG2 syncThread: new sl_action_seq 1 - SYNC 
> 224
> 2009-08-11 16:55:00 CEST DEBUG2 remoteListenThread_103: queue event 
> 103,483 SYNC
> 2009-08-11 16:55:00 CEST DEBUG2 remoteListenThread_103: UNLISTEN
> 2009-08-11 16:55:00 CEST DEBUG2 remoteWorkerThread_103: Received event 
> 103,483 SYNC
> 2009-08-11 16:55:00 CEST DEBUG2 calc sync size - last time: 1 last 
> length: 11011 ideal: 1 proposed size: 1
> 2009-08-11 16:55:00 CEST DEBUG2 remoteWorkerThread_103: SYNC 483 
> processing
> 2009-08-11 16:55:00 CEST DEBUG2 remoteWorkerThread_103: no sets need 
> syncing for this event
> 2009-08-11 16:55:01 CEST DEBUG2 localListenThread: Received event 
> 104,224 SYNC
> 2009-08-11 16:55:03 CEST DEBUG2 remoteWorkerThread_101: forward 
> confirm 103,483 received by 101
> 2009-08-11 16:55:04 CEST DEBUG2 remoteListenThread_103: LISTEN
> 2009-08-11 16:55:09 CEST DEBUG2 remoteListenThread_103: queue event 
> 103,484 SYNC
> 2009-08-11 16:55:09 CEST DEBUG2 remoteListenThread_103: UNLISTEN
> 2009-08-11 16:55:09 CEST DEBUG2 remoteWorkerThread_103: Received event 
> 103,484 SYNC
> 2009-08-11 16:55:09 CEST DEBUG2 calc sync size - last time: 1 last 
> length: 8989 ideal: 2 proposed size: 2
> 2009-08-11 16:55:09 CEST DEBUG2 remoteWorkerThread_103: SYNC 484 
> processing
> 2009-08-11 16:55:09 CEST DEBUG2 remoteWorkerThread_103: no sets need 
> syncing for this event
> 2009-08-11 16:55:09 CEST DEBUG2 syncThread: new sl_action_seq 1 - SYNC 
> 225
> 2009-08-11 16:55:11 CEST DEBUG2 localListenThread: Received event 
> 104,225 SYNC
> 2009-08-11 16:55:13 CEST DEBUG2 remoteListenThread_103: LISTEN
> 2009-08-11 16:55:13 CEST DEBUG2 remoteWorkerThread_101: forward 
> confirm 103,484 received by 101
> 2009-08-11 16:55:19 CEST DEBUG2 remoteListenThread_103: queue event 
> 103,485 SYNC
> 2009-08-11 16:55:19 CEST DEBUG2 remoteListenThread_103: UNLISTEN
> 2009-08-11 16:55:19 CEST DEBUG2 remoteWorkerThread_103: Received event 
> 103,485 SYNC
> 2009-08-11 16:55:19 CEST DEBUG2 calc sync size - last time: 1 last 
> length: 10003 ideal: 1 proposed size: 1
> 2009-08-11 16:55:19 CEST DEBUG2 remoteWorkerThread_103: SYNC 485 
> processing
> 2009-08-11 16:55:19 CEST DEBUG2 remoteWorkerThread_103: no sets need 
> syncing for this event
> 2009-08-11 16:55:19 CEST DEBUG2 syncThread: new sl_action_seq 1 - SYNC 
> 226
> 2009-08-11 16:55:21 CEST DEBUG2 localListenThread: Received event 
> 104,226 SYNC
> 2009-08-11 16:55:23 CEST DEBUG2 remoteListenThread_101: LISTEN
> 2009-08-11 16:55:24 CEST DEBUG2 remoteWorkerThread_101: forward 
> confirm 103,485 received by 101
>
> any help ?
>
> Should I really use update function on the node upgraded ? on every 
> node ?
>
> Cyril Scetbon a ?crit :
>> I had to submit it to the same node it was applied on. Still getting 
>> some error and investiguating...
>>
>> Glyn Astill a ?crit :
>>> I'm not sure why repair config isn't working for you, however if 
>>> you're looking for the baremetal function it is updatereloid(set, 
>>> node).
>>>
>>>
>>>
>>>
>>>
>>> ----- Original Message ----
>>>  
>>>> From: Cyril Scetbon <cscetbon.ext@orange-ftgroup.com>
>>>> To: chris <chris@ca.afilias.info>; slony1-general@lists.slony.info
>>>> Sent: Tuesday, 11 August, 2009 10:48:18
>>>> Subject: Re: [Slony1-general] Replacing PostgreSQL 8.2 by Pg 8.3 
>>>> does not work
>>>>
>>>> Outch I can't dump the table oid (misunderstand between table oids 
>>>> and column oids). I'll look at the slonik code for the repair command.
>>>>
>>>> Cyril Scetbon a ?crit :
>>>>   
>>>>> you are right !
>>>>>
>>>>> mydb=# select oid,relname from pg_class where relname = 't_512';
>>>>>  oid  | relname
>>>>> -------+---------
>>>>> 69187 | t_512
>>>>> (1 row)
>>>>>
>>>>> mydb=# select * from _pns_slony_voila_preprod_1.sl_table where       
>>>> tab_relname='t_512';
>>>>   
>>>>> tab_id | tab_reloid | tab_relname | tab_nspname | tab_set | 
>>>>> tab_idxname |       
>>>> tab_altered |             tab_comment            
>>>> --------+------------+-------------+-------------+---------+-------------+-------------+------------------------------------- 
>>>>
>>>>   
>>>>>    512 |      24638 | t_512       | public      |       1 | 
>>>>> t_512_pkey  | t          
>>>>        | Table public.t_512 with primary key
>>>>   
>>>>> (1 row)
>>>>>
>>>>> But, repair does not work correctly, and I can't debug it (tried 
>>>>> by looking in       
>>>> the postgresql query log, but found nothing)
>>>>   
>>>>> I'll try by dumping/reloading with oid. Any idea why the repair 
>>>>> command does       
>>>> not work correctly ? I don't see updates on the node I want to be 
>>>> repaired. I used the following script :
>>>>   
>>>>> echo > /var/tmp/repair.sql
>>>>> slonik_print_preamble --config /etc/slony1/slon_tools_mydb.conf >> 
>>>>>       
>>>> /var/tmp/repair.sql
>>>>   
>>>>> for set in `seq 1 31`
>>>>> do
>>>>>  echo "REPAIR CONFIG (SET ID = $set, EVENT NODE = 101, EXECUTE 
>>>>> ONLY ON =103);"     
>>>>>> /var/tmp/repair.sql
>>>>>>         
>>>>> done
>>>>> slonik < /var/tmp/repair.sql
>>>>>
>>>>> I got no error but nothing seems to be done
>>>>>
>>>>> thx
>>>>>
>>>>> chris a ?crit :
>>>>>     
>>>>>> Cyril Scetbon writes:
>>>>>>  
>>>>>>       
>>>>>>> Alan Hodgson a ?crit :
>>>>>>>            
>>>>>>>> On Monday 10 August 2009, Cyril Scetbon
>>>>>>>> wrote:
>>>>>>>>                  
>>>>>>>>> However, when slony is started with pg 8.3 it does not see new 
>>>>>>>>> events
>>>>>>>>> from his provider (still in pg8.3).
>>>>>>>>> If we restart our pg 8.2 with slony it works !
>>>>>>>>>
>>>>>>>>> Do you know what we are missing ?
>>>>>>>>>
>>>>>>>>> thx
>>>>>>>>>                          
>>>>>>>> You need to modify all the table and sequence OIDs stored in the
>>>>>>>> slony configuration tables to reflect the new table and sequence
>>>>>>>> OIDs.
>>>>>>>>                    
>>>>>>> I don't think oids are used and table id were not modified
>>>>>>>              
>>>>>> No, Alan's quite right.
>>>>>>
>>>>>> If you look at sl_table and sl_sequence, you'll find "reloid" 
>>>>>> columns,
>>>>>> which are indeed relevant.
>>>>>>
>>>>>>  
>>>>>>       
>>>>>>>> You need to update the slony functions through the appropriate 
>>>>>>>> slon
>>>>>>>> commands.
>>>>>>>>                    
>>>>>>> really ?
>>>>>>>              
>>>>>> The slonik "repair config" command should be useful.
>>>>>>
>>>>>>
>>>>>>
>>>>>> "Resets the name-to-oid mapping of tables in a replication set, 
>>>>>> useful
>>>>>> for restoring a node after a pg_dump."
>>>>>>  
>>>>>>         
>>>> -- Cyril SCETBON
>>>> _______________________________________________
>>>> Slony1-general mailing list
>>>> Slony1-general@lists.slony.info
>>>> http://lists.slony.info/mailman/listinfo/slony1-general
>>>>     
>>>
>>>
>>>
>>>         
>>
>

-- 
Cyril SCETBON
From devrim at gunduz.org  Tue Aug 11 10:52:49 2009
From: devrim at gunduz.org (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Tue Aug 11 10:53:17 2009
Subject: [Slony1-general] how to make installer form source
In-Reply-To: <9fa914ca0908102122w36856607wb6e0fd3d51f134bb@mail.gmail.com>
References: <9fa914ca0908102122w36856607wb6e0fd3d51f134bb@mail.gmail.com>
Message-ID: <1250013169.13988.29.camel@hp-laptop2.gunduz.org>

T24gVHVlLCAyMDA5LTA4LTExIGF0IDA5OjUyICswNTMwLCBuYWdhcmFqIHNoaW5kYWdpIHdyb3Rl
Ogo+IGkgYW0gdXNpbmcgUEcgOC4zIGZvciB3aW5kb3dzLCBhbmQgc2xvbnkgMS4yLjUsIG5vdyBp
IHdhbnQgdXBncmFkZSB0bwo+IHNsb255LUkgMi4wLjIuCgpodHRwOi8vcGdzbmFrZS5ibG9nc3Bv
dC5jb20vMjAwOS8wOC9zdGFja2J1aWxkZXItYXBwbGljYXRpb24tdXBkYXRlcy5odG1sCgpTdGFj
a2J1aWxkZXIgaGFzIFNsb255LUkgMi4wLjIuIFlvdSBtYXkgd2FudCB0byB1c2UgdGhhdCBvbmUu
Ci0tIApEZXZyaW0gR8OcTkTDnFosIFJIQ0UKQ29tbWFuZCBQcm9tcHQgLSBodHRwOi8vd3d3LkNv
bW1hbmRQcm9tcHQuY29tIApkZXZyaW1+Z3VuZHV6Lm9yZywgZGV2cmltflBvc3RncmVTUUwub3Jn
LCBkZXZyaW0uZ3VuZHV6fmxpbnV4Lm9yZy50cgogICAgICAgICAgICAgICAgICAgaHR0cDovL3d3
dy5ndW5kdXoub3JnCi0tLS0tLS0tLS0tLS0tIG5leHQgcGFydCAtLS0tLS0tLS0tLS0tLQpBIG5v
bi10ZXh0IGF0dGFjaG1lbnQgd2FzIHNjcnViYmVkLi4uCk5hbWU6IG5vdCBhdmFpbGFibGUKVHlw
ZTogYXBwbGljYXRpb24vcGdwLXNpZ25hdHVyZQpTaXplOiAxOTcgYnl0ZXMKRGVzYzogVGhpcyBp
cyBhIGRpZ2l0YWxseSBzaWduZWQgbWVzc2FnZSBwYXJ0ClVybCA6IGh0dHA6Ly9saXN0cy5zbG9u
eS5pbmZvL3BpcGVybWFpbC9zbG9ueTEtZ2VuZXJhbC9hdHRhY2htZW50cy8yMDA5MDgxMS8wYzE0
ZTNjMC9hdHRhY2htZW50LnBncAo=
From stuart at stuartbishop.net  Wed Aug 12 11:48:41 2009
From: stuart at stuartbishop.net (Stuart Bishop)
Date: Wed Aug 12 11:48:56 2009
Subject: [Slony1-general] replicating 8.2 to 8.4
In-Reply-To: <87my67ebng.fsf@dba2.int.libertyrms.com>
References: <92869e660908100923p186999bdj735ebce3bc3ef1c9@mail.gmail.com>
	<1249924039.18347.2.camel@bnicholson-desktop>
	<87my67ebng.fsf@dba2.int.libertyrms.com>
Message-ID: <6bc73d4c0908121148t6a801d43gc4b91acdb156b785@mail.gmail.com>

On Mon, Aug 10, 2009 at 3:01 PM, Christopher
Browne<cbbrowne@ca.afilias.info> wrote:

> The changes needed for 1.2.x to work with 8.4 have been committed;
> 1.2.17 will be the release that first handles this.
>
> Devrim and I have been making a number of changes to 1.2-STABLE lately
> to address issues we've been noticing; it's getting pretty close.

This is great news.

With luck, it will be done in time to get the packages into Ubuntu
9.10 (feature freeze on Aug 27th - after that it becomes a hassle to
get the Debian packages synced in).


-- 
Stuart Bishop <stuart@stuartbishop.net>
http://www.stuartbishop.net/
From cscetbon.ext at orange-ftgroup.com  Fri Aug 14 01:17:07 2009
From: cscetbon.ext at orange-ftgroup.com (Cyril Scetbon)
Date: Fri Aug 14 01:17:49 2009
Subject: [Slony1-general] Replacing PostgreSQL 8.2 by Pg 8.3 does not work
In-Reply-To: <4A818863.4000401@orange-ftgroup.com>
References: <4A804D8D.3030604@orange-ftgroup.com>	<200908100951.09842@hal.medialogik.com>	<4A808CF8.2020503@orange-ftgroup.com>	<874osftjl1.fsf@dba2.int.libertyrms.com>	<4A8139E2.1030304@orange-ftgroup.com>	<4A813E62.8090104@orange-ftgroup.com>	<149605.38790.qm@web23606.mail.ird.yahoo.com>	<4A8163F5.8000507@orange-ftgroup.com>	<4A81869A.6040307@orange-ftgroup.com>
	<4A818863.4000401@orange-ftgroup.com>
Message-ID: <4A851D83.7080301@orange-ftgroup.com>

With no more information I gave up this method and now we're using drop 
node + store node + subscribe method.

Cyril Scetbon a ?crit :
> Another important information : we are using Slony 1.2.15 (it says 
> that Slony is compatible with PostgreSQL 8.3 since version 1.2.13)
>
> Cyril Scetbon a ?crit :
>> FYI,
>>
>> I did the pg_dump/load another time and used repair config on this 
>> node. Now the provider is stuck on RESET CONFIG :
>>
>> 2009-08-11 16:54:01 CEST DEBUG1 main: running scheduler mainloop
>> 2009-08-11 16:54:01 CEST DEBUG1 remoteListenThread_104: connected to 
>> 'host=slave-db02.profiles.qualif.pns.b3.p.fti.net 
>> dbname=pns_voila_preprod user=pns_slon
>> y_voila_preprod port=5432 password=pns_v0!la_sl0ny_pr3pr0d'
>> 2009-08-11 16:54:01 CEST DEBUG1 remoteListenThread_103: connected to 
>> 'host=master-db02.profiles.qualif.pns.b3.p.fti.net 
>> dbname=pns_voila_preprod user=pns_slo
>> ny_voila_preprod port=5432 password=pns_v0!la_sl0ny_pr3pr0d'
>> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_103: queue event 
>> 103,477 SYNC
>> 2009-08-11 16:54:01 CEST DEBUG2 remoteWorkerThread_103: Received 
>> event 103,477 SYNC
>> 2009-08-11 16:54:01 CEST DEBUG2 remoteWorkerThread_103: SYNC 477 
>> processing
>> 2009-08-11 16:54:01 CEST DEBUG2 remoteWorkerThread_103: no sets need 
>> syncing for this event
>> 2009-08-11 16:54:01 CEST DEBUG2 remoteWorkerThread_103: forward 
>> confirm 101,113409 received by 104
>> 2009-08-11 16:54:01 CEST DEBUG2 remoteWorkerThread_103: forward 
>> confirm 101,112143 received by 102
>> 2009-08-11 16:54:01 CEST DEBUG2 remoteWorkerThread_103: forward 
>> confirm 101,114448 received by 103
>> 2009-08-11 16:54:01 CEST DEBUG2 remoteWorkerThread_103: forward 
>> confirm 103,207 received by 104
>> 2009-08-11 16:54:01 CEST DEBUG2 remoteWorkerThread_103: forward 
>> confirm 104,58 received by 103
>> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
>> 103,477 SYNC
>> 2009-08-11 16:54:01 CEST DEBUG2 remoteWorker_event: event 103,477 
>> ignored - duplicate
>> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
>> 104,59 RESET_CONFIG
>> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
>> 104,60 RESET_CONFIG
>> 2009-08-11 16:54:01 CEST DEBUG2 remoteWorkerThread_104: Received 
>> event 104,59 RESET_CONFIG
>> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
>> 104,61 RESET_CONFIG
>> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
>> 104,62 RESET_CONFIG
>> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
>> 104,63 RESET_CONFIG
>> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
>> 104,64 RESET_CONFIG
>> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
>> 104,65 RESET_CONFIG
>> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
>> 104,66 RESET_CONFIG
>> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
>> 104,67 RESET_CONFIG
>> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
>> 104,68 RESET_CONFIG
>> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
>> 104,69 RESET_CONFIG
>> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
>> 104,70 RESET_CONFIG
>> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
>> 104,71 RESET_CONFIG
>> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
>> 104,72 RESET_CONFIG
>> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
>> 104,73 RESET_CONFIG
>> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
>> 104,74 RESET_CONFIG
>> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
>> 104,75 RESET_CONFIG
>> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
>> 104,76 RESET_CONFIG
>> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
>> 104,77 RESET_CONFIG
>> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
>> 104,78 RESET_CONFIG
>> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
>> 104,79 RESET_CONFIG
>> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
>> 104,80 RESET_CONFIG
>> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
>> 104,81 RESET_CONFIG
>> 2009-08-11 16:54:01 CEST DEBUG2 remoteListenThread_104: queue event 
>> 104,82 RESET_CONFIG
>> 2009-08-11 16:54:01 CEST DEBUG2 slon: child terminated status: 11; 
>> pid: 24444, current worker pid: 24444
>> 2009-08-11 16:54:01 CEST DEBUG1 slon: restart of worker in 10 seconds
>>
>> and I really don't know what's happening ! other nodes are waiting 
>> for sync of set (that are updated) :
>>
>> 2009-08-11 16:54:49 CEST DEBUG2 calc sync size - last time: 1 last 
>> length: 6217 ideal: 3 proposed size: 3
>> 2009-08-11 16:54:49 CEST DEBUG2 remoteWorkerThread_103: SYNC 482 
>> processing
>> 2009-08-11 16:54:49 CEST DEBUG2 remoteWorkerThread_103: no sets need 
>> syncing for this event
>> 2009-08-11 16:54:49 CEST DEBUG2 syncThread: new sl_action_seq 1 - 
>> SYNC 223
>> 2009-08-11 16:54:51 CEST DEBUG2 localListenThread: Received event 
>> 104,223 SYNC
>> 2009-08-11 16:54:54 CEST DEBUG2 remoteListenThread_101: LISTEN
>> 2009-08-11 16:54:54 CEST DEBUG2 remoteWorkerThread_101: forward 
>> confirm 103,482 received by 101
>> 2009-08-11 16:54:59 CEST DEBUG2 syncThread: new sl_action_seq 1 - 
>> SYNC 224
>> 2009-08-11 16:55:00 CEST DEBUG2 remoteListenThread_103: queue event 
>> 103,483 SYNC
>> 2009-08-11 16:55:00 CEST DEBUG2 remoteListenThread_103: UNLISTEN
>> 2009-08-11 16:55:00 CEST DEBUG2 remoteWorkerThread_103: Received 
>> event 103,483 SYNC
>> 2009-08-11 16:55:00 CEST DEBUG2 calc sync size - last time: 1 last 
>> length: 11011 ideal: 1 proposed size: 1
>> 2009-08-11 16:55:00 CEST DEBUG2 remoteWorkerThread_103: SYNC 483 
>> processing
>> 2009-08-11 16:55:00 CEST DEBUG2 remoteWorkerThread_103: no sets need 
>> syncing for this event
>> 2009-08-11 16:55:01 CEST DEBUG2 localListenThread: Received event 
>> 104,224 SYNC
>> 2009-08-11 16:55:03 CEST DEBUG2 remoteWorkerThread_101: forward 
>> confirm 103,483 received by 101
>> 2009-08-11 16:55:04 CEST DEBUG2 remoteListenThread_103: LISTEN
>> 2009-08-11 16:55:09 CEST DEBUG2 remoteListenThread_103: queue event 
>> 103,484 SYNC
>> 2009-08-11 16:55:09 CEST DEBUG2 remoteListenThread_103: UNLISTEN
>> 2009-08-11 16:55:09 CEST DEBUG2 remoteWorkerThread_103: Received 
>> event 103,484 SYNC
>> 2009-08-11 16:55:09 CEST DEBUG2 calc sync size - last time: 1 last 
>> length: 8989 ideal: 2 proposed size: 2
>> 2009-08-11 16:55:09 CEST DEBUG2 remoteWorkerThread_103: SYNC 484 
>> processing
>> 2009-08-11 16:55:09 CEST DEBUG2 remoteWorkerThread_103: no sets need 
>> syncing for this event
>> 2009-08-11 16:55:09 CEST DEBUG2 syncThread: new sl_action_seq 1 - 
>> SYNC 225
>> 2009-08-11 16:55:11 CEST DEBUG2 localListenThread: Received event 
>> 104,225 SYNC
>> 2009-08-11 16:55:13 CEST DEBUG2 remoteListenThread_103: LISTEN
>> 2009-08-11 16:55:13 CEST DEBUG2 remoteWorkerThread_101: forward 
>> confirm 103,484 received by 101
>> 2009-08-11 16:55:19 CEST DEBUG2 remoteListenThread_103: queue event 
>> 103,485 SYNC
>> 2009-08-11 16:55:19 CEST DEBUG2 remoteListenThread_103: UNLISTEN
>> 2009-08-11 16:55:19 CEST DEBUG2 remoteWorkerThread_103: Received 
>> event 103,485 SYNC
>> 2009-08-11 16:55:19 CEST DEBUG2 calc sync size - last time: 1 last 
>> length: 10003 ideal: 1 proposed size: 1
>> 2009-08-11 16:55:19 CEST DEBUG2 remoteWorkerThread_103: SYNC 485 
>> processing
>> 2009-08-11 16:55:19 CEST DEBUG2 remoteWorkerThread_103: no sets need 
>> syncing for this event
>> 2009-08-11 16:55:19 CEST DEBUG2 syncThread: new sl_action_seq 1 - 
>> SYNC 226
>> 2009-08-11 16:55:21 CEST DEBUG2 localListenThread: Received event 
>> 104,226 SYNC
>> 2009-08-11 16:55:23 CEST DEBUG2 remoteListenThread_101: LISTEN
>> 2009-08-11 16:55:24 CEST DEBUG2 remoteWorkerThread_101: forward 
>> confirm 103,485 received by 101
>>
>> any help ?
>>
>> Should I really use update function on the node upgraded ? on every 
>> node ?
>>
>> Cyril Scetbon a ?crit :
>>> I had to submit it to the same node it was applied on. Still getting 
>>> some error and investiguating...
>>>
>>> Glyn Astill a ?crit :
>>>> I'm not sure why repair config isn't working for you, however if 
>>>> you're looking for the baremetal function it is updatereloid(set, 
>>>> node).
>>>>
>>>>
>>>>
>>>>
>>>>
>>>> ----- Original Message ----
>>>>  
>>>>> From: Cyril Scetbon <cscetbon.ext@orange-ftgroup.com>
>>>>> To: chris <chris@ca.afilias.info>; slony1-general@lists.slony.info
>>>>> Sent: Tuesday, 11 August, 2009 10:48:18
>>>>> Subject: Re: [Slony1-general] Replacing PostgreSQL 8.2 by Pg 8.3 
>>>>> does not work
>>>>>
>>>>> Outch I can't dump the table oid (misunderstand between table oids 
>>>>> and column oids). I'll look at the slonik code for the repair 
>>>>> command.
>>>>>
>>>>> Cyril Scetbon a ?crit :
>>>>>  
>>>>>> you are right !
>>>>>>
>>>>>> mydb=# select oid,relname from pg_class where relname = 't_512';
>>>>>>  oid  | relname
>>>>>> -------+---------
>>>>>> 69187 | t_512
>>>>>> (1 row)
>>>>>>
>>>>>> mydb=# select * from _pns_slony_voila_preprod_1.sl_table where       
>>>>> tab_relname='t_512';
>>>>>  
>>>>>> tab_id | tab_reloid | tab_relname | tab_nspname | tab_set | 
>>>>>> tab_idxname |       
>>>>> tab_altered |             tab_comment            
>>>>> --------+------------+-------------+-------------+---------+-------------+-------------+------------------------------------- 
>>>>>
>>>>>  
>>>>>>    512 |      24638 | t_512       | public      |       1 | 
>>>>>> t_512_pkey  | t          
>>>>>        | Table public.t_512 with primary key
>>>>>  
>>>>>> (1 row)
>>>>>>
>>>>>> But, repair does not work correctly, and I can't debug it (tried 
>>>>>> by looking in       
>>>>> the postgresql query log, but found nothing)
>>>>>  
>>>>>> I'll try by dumping/reloading with oid. Any idea why the repair 
>>>>>> command does       
>>>>> not work correctly ? I don't see updates on the node I want to be 
>>>>> repaired. I used the following script :
>>>>>  
>>>>>> echo > /var/tmp/repair.sql
>>>>>> slonik_print_preamble --config /etc/slony1/slon_tools_mydb.conf 
>>>>>> >>       
>>>>> /var/tmp/repair.sql
>>>>>  
>>>>>> for set in `seq 1 31`
>>>>>> do
>>>>>>  echo "REPAIR CONFIG (SET ID = $set, EVENT NODE = 101, EXECUTE 
>>>>>> ONLY ON =103);"    
>>>>>>> /var/tmp/repair.sql
>>>>>>>         
>>>>>> done
>>>>>> slonik < /var/tmp/repair.sql
>>>>>>
>>>>>> I got no error but nothing seems to be done
>>>>>>
>>>>>> thx
>>>>>>
>>>>>> chris a ?crit :
>>>>>>    
>>>>>>> Cyril Scetbon writes:
>>>>>>>  
>>>>>>>      
>>>>>>>> Alan Hodgson a ?crit :
>>>>>>>>           
>>>>>>>>> On Monday 10 August 2009, Cyril Scetbon
>>>>>>>>> wrote:
>>>>>>>>>                 
>>>>>>>>>> However, when slony is started with pg 8.3 it does not see 
>>>>>>>>>> new events
>>>>>>>>>> from his provider (still in pg8.3).
>>>>>>>>>> If we restart our pg 8.2 with slony it works !
>>>>>>>>>>
>>>>>>>>>> Do you know what we are missing ?
>>>>>>>>>>
>>>>>>>>>> thx
>>>>>>>>>>                          
>>>>>>>>> You need to modify all the table and sequence OIDs stored in the
>>>>>>>>> slony configuration tables to reflect the new table and sequence
>>>>>>>>> OIDs.
>>>>>>>>>                    
>>>>>>>> I don't think oids are used and table id were not modified
>>>>>>>>              
>>>>>>> No, Alan's quite right.
>>>>>>>
>>>>>>> If you look at sl_table and sl_sequence, you'll find "reloid" 
>>>>>>> columns,
>>>>>>> which are indeed relevant.
>>>>>>>
>>>>>>>  
>>>>>>>      
>>>>>>>>> You need to update the slony functions through the appropriate 
>>>>>>>>> slon
>>>>>>>>> commands.
>>>>>>>>>                    
>>>>>>>> really ?
>>>>>>>>              
>>>>>>> The slonik "repair config" command should be useful.
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> "Resets the name-to-oid mapping of tables in a replication set, 
>>>>>>> useful
>>>>>>> for restoring a node after a pg_dump."
>>>>>>>  
>>>>>>>         
>>>>> -- Cyril SCETBON
>>>>> _______________________________________________
>>>>> Slony1-general mailing list
>>>>> Slony1-general@lists.slony.info
>>>>> http://lists.slony.info/mailman/listinfo/slony1-general
>>>>>     
>>>>
>>>>
>>>>
>>>>         
>>>
>>
>

-- 
Cyril SCETBON
From nagaraj.shindagi at gmail.com  Sun Aug 16 07:42:33 2009
From: nagaraj.shindagi at gmail.com (nagaraj shindagi)
Date: Sun Aug 16 07:42:41 2009
Subject: [Slony1-general] xxid file missing after installation of slony-I
	2.0.2
Message-ID: <9fa914ca0908160742l26dba54ew9f3745acd5abce5@mail.gmail.com>

hi

i am downloaded pg8.4 from enterprisedb.com for windows. after installation
of PG 8.4, from the stackbuilder i downloaded slony-i 2.01, after
installation there is xxid file missing.

can anyone help me now how to do replication

i stucked over here. so please help me to resolve this issue.

thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090816/=
ab04e721/attachment.htm
From mnagaraja at alcatel-lucent.com  Mon Aug 17 05:22:27 2009
From: mnagaraja at alcatel-lucent.com (Nagaraja, Madhukar (Madhukar))
Date: Mon Aug 17 05:22:36 2009
Subject: [Slony1-general] Core file.
Message-ID: <E9F099885B445541A55D830FC62E175A0B66FF37FB@INBANSXCHMBSA3.in.alcatel-lucent.com>

Hello,

I had sent it a while back, but got no replies. So resending it again.

We have automated the starting stopping of slon and also other slony configuaration. But we observed nowadays that the slon daemons generating core files mainly I guess when we do reinit of our system. At that time we kill slon and restart. We actually restart slon whenever our processes restart as the postgresql would also restart. This is also observed when a switchover is initiated.

Have any observed this ? Bcos we observed we left it for a week or so there was some 100MB of core. But this is in our test environment.

Thanks.
From jcasanov at systemguards.com.ec  Mon Aug 17 08:35:01 2009
From: jcasanov at systemguards.com.ec (Jaime Casanova)
Date: Mon Aug 17 08:35:31 2009
Subject: [slony1-general] switch from sl_log_1 to sl_log_2 never ends
Message-ID: <3073cc9b0908170835w6c4ebcb8pf6b280f77b0958c0@mail.gmail.com>

Hi,

For some reason the switch from sl_log_1 to sl_log_2 never ends, if i
execute logswitch_finish() i get this "NOTICE:  Slony-I: log switch to
sl_log_1 still in progress - sl_log_2 not truncated" and it returns -1
and if i execute logswitch_start() it says "ERROR:  Previous logswitch
still in progress"

right now the sl_log_* tables have grown a lot
 relname  | n_live_tup
-------------+--------------------
 sl_log_1 |  392275506
 sl_log_2 |   59708331

this is a situation that has been like that for several days now. this
is slony 1.2.15...

-- 
Atentamente,
Jaime Casanova
Soporte y capacitaci?n de PostgreSQL
Asesor?a y desarrollo de sistemas
Guayaquil - Ecuador
Cel. +59387171157
From glynastill at yahoo.co.uk  Mon Aug 17 09:36:51 2009
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Mon Aug 17 09:37:05 2009
Subject: [slony1-general] switch from sl_log_1 to sl_log_2 never ends
In-Reply-To: <3073cc9b0908170835w6c4ebcb8pf6b280f77b0958c0@mail.gmail.com>
References: <3073cc9b0908170835w6c4ebcb8pf6b280f77b0958c0@mail.gmail.com>
Message-ID: <983209.87564.qm@web23602.mail.ird.yahoo.com>

----- Original Message ----

> From: Jaime Casanova <jcasanov@systemguards.com.ec>
> To: slony1-general@lists.slony.info
> Sent: Monday, 17 August, 2009 16:35:01
> Subject: [slony1-general] switch from sl_log_1 to sl_log_2 never ends
> 
> Hi,
> 
> For some reason the switch from sl_log_1 to sl_log_2 never ends, if i
> execute logswitch_finish() i get this "NOTICE:  Slony-I: log switch to
> sl_log_1 still in progress - sl_log_2 not truncated" and it returns -1
> and if i execute logswitch_start() it says "ERROR:  Previous logswitch
> still in progress"
> 
> right now the sl_log_* tables have grown a lot
> relname  | n_live_tup
> -------------+--------------------
> sl_log_1 |  392275506
> sl_log_2 |   59708331
> 
> this is a situation that has been like that for several days now. this
> is slony 1.2.15...
> 


Sorry to state the obvious, but have you checked for any open transactions that it might be waiting on?



      
From jcasanov at systemguards.com.ec  Mon Aug 17 09:59:55 2009
From: jcasanov at systemguards.com.ec (Jaime Casanova)
Date: Mon Aug 17 10:00:25 2009
Subject: [slony1-general] switch from sl_log_1 to sl_log_2 never ends
In-Reply-To: <983209.87564.qm@web23602.mail.ird.yahoo.com>
References: <3073cc9b0908170835w6c4ebcb8pf6b280f77b0958c0@mail.gmail.com> 
	<983209.87564.qm@web23602.mail.ird.yahoo.com>
Message-ID: <3073cc9b0908170959q6da386cag645d22009d71a968@mail.gmail.com>

On Mon, Aug 17, 2009 at 11:36 AM, Glyn Astill<glynastill@yahoo.co.uk> wrote:
> ----- Original Message ----
>
>> From: Jaime Casanova <jcasanov@systemguards.com.ec>
>> To: slony1-general@lists.slony.info
>> Sent: Monday, 17 August, 2009 16:35:01
>> Subject: [slony1-general] switch from sl_log_1 to sl_log_2 never ends
>>
>> Hi,
>>
>> For some reason the switch from sl_log_1 to sl_log_2 never ends, if i
>> execute logswitch_finish() i get this "NOTICE: ?Slony-I: log switch to
>> sl_log_1 still in progress - sl_log_2 not truncated" and it returns -1
>> and if i execute logswitch_start() it says "ERROR: ?Previous logswitch
>> still in progress"
>>
>> right now the sl_log_* tables have grown a lot
>> relname ?| n_live_tup
>> -------------+--------------------
>> sl_log_1 | ?392275506
>> sl_log_2 | ? 59708331
>>
>> this is a situation that has been like that for several days now. this
>> is slony 1.2.15...
>>
>
>
> Sorry to state the obvious, but have you checked for any open transactions that it might be waiting on?
>

i forgot to mention it no rows in "select * from pg_stat_activity
where waiting;"

and this query shows (as expected) different results every time i
execute it, but one of those results just a minute ago was 0 rows, so
there is nothing stronger than AccessShareLock hanging in there...
"""
 SELECT client_addr as "ip cliente",
       pg_stat_activity.datname as "base datos",
       case pg_class.relkind when 'r' then 'Tabla' when 'i' then
'Indice' when 'S' then 'Secuencia' end as "tipo relacion",
       pg_class.relname as relacion,
       pg_locks.mode as "modo bloqueo",
       pg_locks.granted as "bloqueo concedido",
       pg_stat_activity.usename as usuario,
       pg_stat_activity.current_query as "consulta origen",
       to_char(pg_stat_activity.query_start,'HH24:MI:SS') as "inicio
consulta",
       to_char(age(now(), pg_stat_activity.query_start),'HH24:MI:SS')
as "edad consulta",
       pg_stat_activity.procpid as "id proceso"
  FROM pg_stat_activity,pg_locks LEFT OUTER JOIN pg_class ON
(pg_locks.relation = pg_class.oid)
 WHERE pg_locks.pid=pg_stat_activity.procpid and
pg_stat_activity.procpid <> pg_backend_pid()
   and pg_locks.mode <> 'AccessShareLock'
 ORDER BY 5, 10 desc;
"""

ideas?

-- 
Atentamente,
Jaime Casanova
Soporte y capacitaci?n de PostgreSQL
Asesor?a y desarrollo de sistemas
Guayaquil - Ecuador
Cel. +59387171157
From cbbrowne at ca.afilias.info  Mon Aug 17 10:08:28 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Mon Aug 17 10:08:44 2009
Subject: [Slony1-general] xxid file missing after installation of slony-I
	2.0.2
In-Reply-To: <9fa914ca0908160742l26dba54ew9f3745acd5abce5@mail.gmail.com>
	(nagaraj shindagi's message of "Sun, 16 Aug 2009 20:12:33 +0530")
References: <9fa914ca0908160742l26dba54ew9f3745acd5abce5@mail.gmail.com>
Message-ID: <873a7qpdv7.fsf@dba2.int.libertyrms.com>

nagaraj shindagi <nagaraj.shindagi@gmail.com> writes:
> i am downloaded pg8.4 from enterprisedb.com for windows. after installation of
> PG 8.4, from the stackbuilder i downloaded slony-i 2.01, after installation
> there is xxid file missing.
>
> can anyone help me now how to do replication
>
> i stucked over here. so please help me to resolve this issue.

Ah, I see the problem.

The xxid functions were removed in version 2.0.

As noted in the release notes: (RELEASE-2.0)
--------------------------------------------------------------------------
- Elimination of custom "xxid" functions

  PostgreSQL 8.3 introduces a set of "txid" functions and a
  "txid_snapshot" type, which eliminates the need for Slony-I to have
  its own C functions for doing XID comparisons.

  Note that this affects the structure of sl_event, and leads to some
  changes in the coding of the regression tests.

  This eliminates the src/xxid directory and contents
--------------------------------------------------------------------------
-- 
"cbbrowne","@","ca.afilias.info"
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"
From jason at merchantcircle.com  Mon Aug 17 10:27:59 2009
From: jason at merchantcircle.com (Jason Culverhouse)
Date: Mon Aug 17 10:28:14 2009
Subject: [slony1-general] switch from sl_log_1 to sl_log_2 never ends
In-Reply-To: <3073cc9b0908170959q6da386cag645d22009d71a968@mail.gmail.com>
References: <3073cc9b0908170835w6c4ebcb8pf6b280f77b0958c0@mail.gmail.com>
	<983209.87564.qm@web23602.mail.ird.yahoo.com>
	<3073cc9b0908170959q6da386cag645d22009d71a968@mail.gmail.com>
Message-ID: <E30EBE55-AD3B-432E-8A4F-BFB4B6A1A59B@merchantcircle.com>

I had this problem a few weeks ago on 1.2.15.

It looked like  the failure was related to a COPY INTO command on a  
non replicated table that was hung.
I terminated this postgress backend but the log switch still didn't  
happen.

I restarted all the slony on each of the nodes and when I restarted  
the master the log switched correctly

Jason

On Aug 17, 2009, at 9:59 AM, Jaime Casanova wrote:

> On Mon, Aug 17, 2009 at 11:36 AM, Glyn  
> Astill<glynastill@yahoo.co.uk> wrote:
>> ----- Original Message ----
>>
>>> From: Jaime Casanova <jcasanov@systemguards.com.ec>
>>> To: slony1-general@lists.slony.info
>>> Sent: Monday, 17 August, 2009 16:35:01
>>> Subject: [slony1-general] switch from sl_log_1 to sl_log_2 never  
>>> ends
>>>
>>> Hi,
>>>
>>> For some reason the switch from sl_log_1 to sl_log_2 never ends,  
>>> if i
>>> execute logswitch_finish() i get this "NOTICE:  Slony-I: log  
>>> switch to
>>> sl_log_1 still in progress - sl_log_2 not truncated" and it  
>>> returns -1
>>> and if i execute logswitch_start() it says "ERROR:  Previous  
>>> logswitch
>>> still in progress"
>>>
>>> right now the sl_log_* tables have grown a lot
>>> relname  | n_live_tup
>>> -------------+--------------------
>>> sl_log_1 |  392275506
>>> sl_log_2 |   59708331
>>>
>>> this is a situation that has been like that for several days now.  
>>> this
>>> is slony 1.2.15...
>>>
>>
>>
>> Sorry to state the obvious, but have you checked for any open  
>> transactions that it might be waiting on?
>>
>
> i forgot to mention it no rows in "select * from pg_stat_activity
> where waiting;"
>
> and this query shows (as expected) different results every time i
> execute it, but one of those results just a minute ago was 0 rows, so
> there is nothing stronger than AccessShareLock hanging in there...
> """
> SELECT client_addr as "ip cliente",
>       pg_stat_activity.datname as "base datos",
>       case pg_class.relkind when 'r' then 'Tabla' when 'i' then
> 'Indice' when 'S' then 'Secuencia' end as "tipo relacion",
>       pg_class.relname as relacion,
>       pg_locks.mode as "modo bloqueo",
>       pg_locks.granted as "bloqueo concedido",
>       pg_stat_activity.usename as usuario,
>       pg_stat_activity.current_query as "consulta origen",
>       to_char(pg_stat_activity.query_start,'HH24:MI:SS') as "inicio
> consulta",
>       to_char(age(now(), pg_stat_activity.query_start),'HH24:MI:SS')
> as "edad consulta",
>       pg_stat_activity.procpid as "id proceso"
>  FROM pg_stat_activity,pg_locks LEFT OUTER JOIN pg_class ON
> (pg_locks.relation = pg_class.oid)
> WHERE pg_locks.pid=pg_stat_activity.procpid and
> pg_stat_activity.procpid <> pg_backend_pid()
>   and pg_locks.mode <> 'AccessShareLock'
> ORDER BY 5, 10 desc;
> """
>
> ideas?
>
> -- 
> Atentamente,
> Jaime Casanova
> Soporte y capacitaci?n de PostgreSQL
> Asesor?a y desarrollo de sistemas
> Guayaquil - Ecuador
> Cel. +59387171157
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general

From ishii at postgresql.org  Mon Aug 17 18:20:17 2009
From: ishii at postgresql.org (Tatsuo Ishii)
Date: Mon Aug 17 18:20:56 2009
Subject: [Slony1-general] Questions regarding Slony-I
Message-ID: <20090818.102017.39169973.t-ishii@sraoss.co.jp>

Hi,

I'm fairly new to this list and forgive me if this has been already
answered:

1) Slony-I on Windows is stable? We have a plan to test it. But before
   that I would like to hear from those who have been already using
   it.

2) Slony-I master on Windows can be replicated to slave on Linux/UNIX
   host?

3) Is it possible to replicate a database "A" on master node to slave
   as database "B"?

4) If 2) is yes, then is it possible to replicate mutiple master nodes
   to single PostgreSQL database cluster? For example, 

   on host foo master database A is replicated to database A-foo on
   host SLAVE

   on host bar master database A is replicated to database A-bar on
   host SLAVE

thanks in advance,
--
Tatsuo Ishii
SRA OSS, Inc. Japan
From melvin6925 at yahoo.com  Mon Aug 17 19:41:17 2009
From: melvin6925 at yahoo.com (Melvin Davidson)
Date: Mon Aug 17 19:41:54 2009
Subject: [Slony1-general] Questions regarding Slony-I
In-Reply-To: <20090818.102017.39169973.t-ishii@sraoss.co.jp>
References: <20090818.102017.39169973.t-ishii@sraoss.co.jp>
Message-ID: <996887.2951.qm@web53005.mail.re2.yahoo.com>

Tatsuo,

In answer to your questions.

Q1) Slony-I on Windows is stable? 
A1) Yes. I have been using Slony-I v1.2.16, and I assure you it is stable on all platforms.

Q2) Slony-I master on Windows can be replicated to slave on Linux/UNIX
   host?
A2) Yes. The platform/O/S is not important for replication. It is important that the versions of Slony-I 
        be identical.

Q3) Is it possible to replicate a database "A" on master node to slave
   as database "B"?
A3) Yes. Slony requires you specify the master and slave database names, but the names may be 
    different. What is critical is that the same schemas and tables exist on both.

Q4) If 2) is yes, then is it possible to replicate mutiple master nodes
        to single PostgreSQL database cluster? For example, 
A4) Yes, but you will need a separate slony schema and slon process for each database replicated.



Melvin Davidson 

Folk Alley - All Folk - 24 Hours a day 
www.folkalley.com


      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090817/0cc7b7c6/attachment.htm
From ishii at postgresql.org  Mon Aug 17 20:18:36 2009
From: ishii at postgresql.org (Tatsuo Ishii)
Date: Mon Aug 17 20:19:18 2009
Subject: [Slony1-general] Questions regarding Slony-I
In-Reply-To: <996887.2951.qm@web53005.mail.re2.yahoo.com>
References: <20090818.102017.39169973.t-ishii@sraoss.co.jp>
	<996887.2951.qm@web53005.mail.re2.yahoo.com>
Message-ID: <20090818.121836.102564391.t-ishii@sraoss.co.jp>

> Q1) Slony-I on Windows is stable? 
> A1) Yes. I have been using Slony-I v1.2.16, and I assure you it is stable on all platforms.
> 
> Q2) Slony-I master on Windows can be replicated to slave on Linux/UNIX
>    host?
> A2) Yes. The platform/O/S is not important for replication. It is important that the versions of Slony-I 
>         be identical.
> 
> Q3) Is it possible to replicate a database "A" on master node to slave
>    as database "B"?
> A3) Yes. Slony requires you specify the master and slave database names, but the names may be 
>     different. What is critical is that the same schemas and tables exist on both.
> 
> Q4) If 2) is yes, then is it possible to replicate mutiple master nodes
>         to single PostgreSQL database cluster? For example, 
> A4) Yes, but you will need a separate slony schema and slon process for each database replicated.

Thanks Melvin! Your answer is greatly helpful.
--
Tatsuo Ishii
SRA OSS, Inc. Japan
From voodoonet38 at free.fr  Tue Aug 18 02:59:58 2009
From: voodoonet38 at free.fr (VooDooNet)
Date: Tue Aug 18 08:06:02 2009
Subject: [Slony1-general] A problem in Windows Server
In-Reply-To: <17987870.post@talk.nabble.com>
References: <424442.96294.qm@web56712.mail.re3.yahoo.com>
	<17987870.post@talk.nabble.com>
Message-ID: <25021809.post@talk.nabble.com>


This fix does not work also.
I am trying to install Slony 2.02 for PgSQL8.4
I have register the dll correctly, but get this 1057 error when trying to
register the service on a 2003 server.

Does anyone has a fix for this?
Is this the correct way to proceed???

Thanks
Voodooo

Thomas Stegemann wrote:
> 
> 
> Hi,
> 
> we had the same problem on a german Windows.
> try (with the correct path):
> sc create Slony-I binPath= "c:\Programme (x86)\PostgreSQL\8.2\bin\slon.exe
> -service" depend= "RPCSS"
> 
> instead of:
> slon -regservice Slony-I
> 
> I think slon uses the wrong - not standard - user name for CreateService.
> 
> 
> 
> Roberto Mariano wrote:
>> 
>> 
>> &nbsp;Hi,
>> &nbsp;
>> I have configured a Slony-I (a master and a slave) between 2 Windows 2003
>> Servers wich are running Postgres 8.3. 
>> 
>> It works fine running the SLON.exe programs from the command line. But
>> when I want to create the Windows service:
>> &nbsp;
>> &gt;&nbsp;slon -regservice Slony-I
>> &nbsp;
>> An error occurs:
>> &nbsp;
>> Failed to create service: 1057
>> &nbsp;
>> I was logged as "Administrator" which has all permission.&nbsp;
>> &nbsp;
>> Somebody can help me? 
>> &nbsp;
>> Thank you very much.
>> &nbsp;
>> Roberto Crucianelli.
>> &nbsp;
>> 
>> __________________________________________________
>> Correo Yahoo!
>> Espacio para todos tus mensajes, antivirus y antispam ?gratis! 
>> ?Abr? tu cuenta ya! - http://correo.yahoo.com.ar
>> _______________________________________________
>> Slony1-general mailing list
>> Slony1-general@lists.slony.info
>> http://lists.slony.info/mailman/listinfo/slony1-general
>> 
>> 
> 
> -- 
> View this message in context:
> http://www.nabble.com/A-problem-in-Windows-Server-tp17612398p17987870.html
> Sent from the Slony-I -- General mailing list archive at Nabble.com.
> 
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
> 
> 

-- 
View this message in context: http://www.nabble.com/A-problem-in-Windows-Server-tp17612398p25021809.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.

From jcasanov at systemguards.com.ec  Tue Aug 18 09:17:36 2009
From: jcasanov at systemguards.com.ec (Jaime Casanova)
Date: Tue Aug 18 09:18:03 2009
Subject: [slony1-general] switch from sl_log_1 to sl_log_2 never ends
In-Reply-To: <E30EBE55-AD3B-432E-8A4F-BFB4B6A1A59B@merchantcircle.com>
References: <3073cc9b0908170835w6c4ebcb8pf6b280f77b0958c0@mail.gmail.com> 
	<983209.87564.qm@web23602.mail.ird.yahoo.com>
	<3073cc9b0908170959q6da386cag645d22009d71a968@mail.gmail.com> 
	<E30EBE55-AD3B-432E-8A4F-BFB4B6A1A59B@merchantcircle.com>
Message-ID: <3073cc9b0908180917v37d0fb53h4fc86e677723b9e0@mail.gmail.com>

On Mon, Aug 17, 2009 at 12:27 PM, Jason
Culverhouse<jason@merchantcircle.com> wrote:
>
> I restarted all the slony on each of the nodes and when I restarted the
> master the log switched correctly
>

ok, the real problem here was that the slon daemon were down...
probably the first thing i should check, it seems like the slon daemon
were down for 11 days (don't look at me that way, i have just arrived
yesterday here ;)...

when i restart the daemon it tried to sync but instead of freed space
it start to take a lot more (almost 30Gb in a few hours), the server
almost run out of space so i shut down the slon daemon again.

i think i will drop the replication and start again with slony 2.0.2,
i have to make the change to slony-I 2 to migrate to pg 8.4 anyway

-- 
Atentamente,
Jaime Casanova
Soporte y capacitaci?n de PostgreSQL
Asesor?a y desarrollo de sistemas
Guayaquil - Ecuador
Cel. +59387171157
From jcasanov at systemguards.com.ec  Tue Aug 18 09:23:06 2009
From: jcasanov at systemguards.com.ec (Jaime Casanova)
Date: Tue Aug 18 09:23:32 2009
Subject: [slony1-general] uninstalling slony-I 1.2.15 was:(Re: 
	[slony1-general] switch from sl_log_1 to sl_log_2 never ends)
Message-ID: <3073cc9b0908180923v228ced97rb03620454b93de48@mail.gmail.com>

On Tue, Aug 18, 2009 at 11:17 AM, Jaime
Casanova<jcasanov@systemguards.com.ec> wrote:
>
> i think i will drop the replication and start again with slony 2.0.2,
> i have to make the change to slony-I 2 to migrate to pg 8.4 anyway
>

so what is involved in dropping out replication? i guess what i need to do is:

- drop set
- drop node
- drop schema _cluster in database

anything else i should be aware of? something wrong in my list?

-- 
Atentamente,
Jaime Casanova
Soporte y capacitaci?n de PostgreSQL
Asesor?a y desarrollo de sistemas
Guayaquil - Ecuador
Cel. +59387171157
From cbbrowne at ca.afilias.info  Tue Aug 18 09:40:13 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Tue Aug 18 09:40:25 2009
Subject: [slony1-general] uninstalling slony-I 1.2.15 was:(Re:
	[slony1-general] switch from sl_log_1 to sl_log_2 never ends)
In-Reply-To: <3073cc9b0908180923v228ced97rb03620454b93de48@mail.gmail.com>
	(Jaime Casanova's message of "Tue, 18 Aug 2009 11:23:06 -0500")
References: <3073cc9b0908180923v228ced97rb03620454b93de48@mail.gmail.com>
Message-ID: <87eir9nkia.fsf@dba2.int.libertyrms.com>

Jaime Casanova <jcasanov@systemguards.com.ec> writes:
> On Tue, Aug 18, 2009 at 11:17 AM, Jaime
> Casanova<jcasanov@systemguards.com.ec> wrote:
>>
>> i think i will drop the replication and start again with slony 2.0.2,
>> i have to make the change to slony-I 2 to migrate to pg 8.4 anyway
>>
>
> so what is involved in dropping out replication? i guess what i need to do is:
>
> - drop set
> - drop node
> - drop schema _cluster in database
>
> anything else i should be aware of? something wrong in my list?

There is a slonik command, "uninstall node" which should be a cleaner
way to handle that last step.
-- 
(format nil "~S@~S" "cbbrowne" "ca.afilias.info")
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"
From ktm at rice.edu  Tue Aug 18 10:47:18 2009
From: ktm at rice.edu (Kenneth Marshall)
Date: Tue Aug 18 10:47:34 2009
Subject: [Slony1-general] version 1.2.17 release?
Message-ID: <20090818174718.GQ3776@it.is.rice.edu>

Dear Slony Developers,

I am currently in the middle of upgrading our database
backends from PostgreSQL 8.3 to 8.4. I would like to
use Slony1 to keep the service outage to a minimum and
have been waiting for the release of 1.2.17. Do you
have an update on its release? Is the 1.2.17-rc stable
enough to use for this purpose? I would appreciate any
information that you have to share.

Regards,
Ken
From bmurphy1976 at gmail.com  Tue Aug 18 14:47:06 2009
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Tue Aug 18 14:47:28 2009
Subject: [Slony1-general] Post-Replication Triggers
Message-ID: <7fd310d10908181447p7490358wdecb5ab4ce4481cd@mail.gmail.com>

Is it possible to run triggers on secondary (slave) nodes that can be used
to create de-normalized lookup data that does not exist in the master
database? If slony can't do this, is there another replication platform that
can?
Thanks,
Bryan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090818/=
5109be2f/attachment.htm
From sweta.mulgavker at gmail.com  Tue Aug 18 23:31:52 2009
From: sweta.mulgavker at gmail.com (Sweta Mulgavker)
Date: Tue Aug 18 23:32:29 2009
Subject: [Slony1-general] How to unistall a subscriber
Message-ID: <4077e7710908182331o3caff24q8657f61e39628da1@mail.gmail.com>

Hello all,

How do I uninstall a suscriber node??

I tried this  -->

*-bash-3.1$ /usr/bin/slonik_uninstall_nodes id =3D 2*

The result was -->
cluster name =3D replication;
 node 1 admin conninfo=3D'host=3Dserver1 dbname=3Ddatabase user=3Dpostgres
port=3D5432';
 node 2 admin conninfo=3D'host=3Dserver2 dbname=3Ddatabase user=3Dpostgres
port=3D5432';
 node 3 admin conninfo=3D'host=3Dserver3 dbname=3Ddatabase user=3Dpostgres
port=3D5432';
 node 4 admin conninfo=3D'host=3Dserver4 dbname=3Ddatabase user=3Dpostgres
port=3D5432';
  uninstall node (id=3D2);
  uninstall node (id=3D3);
  uninstall node (id=3D4);
  uninstall node (id=3D1);


But my cluster name is *replcluster *

What is the correct way of running these slony scripts???

Please Help.

thanks in advance

Regards,
Sweta.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090819/=
8e0f88ba/attachment.htm
From sweta.mulgavker at gmail.com  Tue Aug 18 23:35:38 2009
From: sweta.mulgavker at gmail.com (Sweta Mulgavker)
Date: Tue Aug 18 23:36:16 2009
Subject: [Slony1-general] Error while Inserting into table
Message-ID: <4077e7710908182335k32dc66b1r37cd42aa8518d76f@mail.gmail.com>

Hello all,

When I try to insert values in a table... slony is givng me the following
error

cars=3D# INSERT INTO t_emp_leave VALUES ('12-09-2009',1908,'presonal','f');
ERROR:  relation with OID 536225 does not exist
CONTEXT:  SQL statement "SELECT last_value::int4 FROM
_replcluster.sl_log_status"


What is this error....????

What should I do to avoid such errors?

Thanks in advance,

Regards,
Sweta.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090819/=
c327ec34/attachment.htm
From devrim at gunduz.org  Wed Aug 19 00:15:48 2009
From: devrim at gunduz.org (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Wed Aug 19 00:16:57 2009
Subject: [Slony1-general] How to unistall a subscriber
In-Reply-To: <4077e7710908182331o3caff24q8657f61e39628da1@mail.gmail.com>
References: <4077e7710908182331o3caff24q8657f61e39628da1@mail.gmail.com>
Message-ID: <1250666148.3773.1.camel@hp-laptop2.gunduz.org>

T24gV2VkLCAyMDA5LTA4LTE5IGF0IDEyOjAxICswNTMwLCBTd2V0YSBNdWxnYXZrZXIgd3JvdGU6
Cj4gQnV0IG15IGNsdXN0ZXIgbmFtZSBpcyAqcmVwbGNsdXN0ZXIgKgoKYWx0cGVybCBzY3JpcHRz
IHVzZSBzbG9uX3Rvb2xzLmNvbmYuIEVpdGhlciBmaXggdGhhdCBjb25mIGZpbGUsIG9yIHdyaXRl
CnlvdXIgb3duIHNsb25payBzY3JpcHQuIEknZCBmaXggc2xvbl90b29scy5jb25mLgoKLS0gCkRl
dnJpbSBHw5xORMOcWiwgUkhDRQpDb21tYW5kIFByb21wdCAtIGh0dHA6Ly93d3cuQ29tbWFuZFBy
b21wdC5jb20gCmRldnJpbX5ndW5kdXoub3JnLCBkZXZyaW1+UG9zdGdyZVNRTC5vcmcsIGRldnJp
bS5ndW5kdXp+bGludXgub3JnLnRyCiAgICAgICAgICAgICAgICAgICBodHRwOi8vd3d3Lmd1bmR1
ei5vcmcKLS0tLS0tLS0tLS0tLS0gbmV4dCBwYXJ0IC0tLS0tLS0tLS0tLS0tCkEgbm9uLXRleHQg
YXR0YWNobWVudCB3YXMgc2NydWJiZWQuLi4KTmFtZTogbm90IGF2YWlsYWJsZQpUeXBlOiBhcHBs
aWNhdGlvbi9wZ3Atc2lnbmF0dXJlClNpemU6IDE5NyBieXRlcwpEZXNjOiBUaGlzIGlzIGEgZGln
aXRhbGx5IHNpZ25lZCBtZXNzYWdlIHBhcnQKVXJsIDogaHR0cDovL2xpc3RzLnNsb255LmluZm8v
cGlwZXJtYWlsL3Nsb255MS1nZW5lcmFsL2F0dGFjaG1lbnRzLzIwMDkwODE5LzVhZTJiOGY0L2F0
dGFjaG1lbnQucGdwCg==
From VooDooNet38 at free.fr  Wed Aug 19 00:42:36 2009
From: VooDooNet38 at free.fr (VooDoo)
Date: Wed Aug 19 00:43:22 2009
Subject: [Slony1-general] 1057 error when installing Slony service
References: <mailman.0.1250665268.6264.slony1-general@lists.slony.info>
Message-ID: <001701ca20a0$9f02fdb0$1f0aa8c0@stepaneurope.com>

Hello All,
I am new to slony, and I am trying to install Slony 2.02 for PgSQL8.4
I have register the dll correctly, but get this 1057 error when trying to 
register the service on a 2003 server.

Does anyone has a fix for this?
Is this the correct way to proceed???

Thanks
Voodooo

From glynastill at yahoo.co.uk  Wed Aug 19 05:16:53 2009
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Wed Aug 19 05:16:56 2009
Subject: [Slony1-general] version 1.2.17 release?
In-Reply-To: <20090818174718.GQ3776@it.is.rice.edu>
Message-ID: <516681.99844.qm@web23601.mail.ird.yahoo.com>

--- On Tue, 18/8/09, Kenneth Marshall <ktm@rice.edu> wrote:

> I am currently in the middle of upgrading our database
> backends from PostgreSQL 8.3 to 8.4. I would like to
> use Slony1 to keep the service outage to a minimum and
> have been waiting for the release of 1.2.17. Do you
> have an update on its release? Is the 1.2.17-rc stable
> enough to use for this purpose? I would appreciate any
> information that you have to share.
> 

I'm guessing they're just leaving a little time for people to test and give feedback about '17-rc

Just yesterday I replicated a test instance of our environment from 8.3 to 8.4, I've yet to do any more real day to day operation tests. 

If you're using it purely for upgrade, I think it's pretty safe to say you'll be ok.



      
From gordo169 at gmail.com  Wed Aug 19 07:31:48 2009
From: gordo169 at gmail.com (Gordon Shannon)
Date: Wed Aug 19 07:31:59 2009
Subject: [Slony1-general] Error while Inserting into table
In-Reply-To: <4077e7710908182335k32dc66b1r37cd42aa8518d76f@mail.gmail.com>
References: <4077e7710908182335k32dc66b1r37cd42aa8518d76f@mail.gmail.com>
Message-ID: <25045264.post@talk.nabble.com>



Sweta Mulgavker wrote:
> 
> Hello all,
> 
> When I try to insert values in a table... slony is givng me the following
> error
> 
> cars=# INSERT INTO t_emp_leave VALUES ('12-09-2009',1908,'presonal','f');
> ERROR:  relation with OID 536225 does not exist
> CONTEXT:  SQL statement "SELECT last_value::int4 FROM
> _replcluster.sl_log_status"
> 
> What is this error....????
> 

I've had this happen when I dropped and recreated the table on the slave,
thinking that was ok to do. The problem is that Slony stores the Postgres
OID, and uses that to find the table.  If you drop and recreate a table, it
will have a new OID, and the value Slony has will no longer exist -- hence
the error.

To see if this is the case, do this on the slave node:

select * from _repcluster.sl_table where tab_relname='t_emp_leave';

Look at the tab_reloid value.

select oid from pg_class where relname='t_emp_leave';

Do the values match?  If not, that's the problem.

I don't know what the official way to fix this is.  I actually fixed it by
updating sl_table manually, but proceed at your own risk :-)  I can't swear
to it, but I'm pretty sure I just did this.  I figured it couldn't make
things worse.

  update _repcluster.sl_table set tab_reloid=<real_oid> where
tab_relname='t_emp_leave';

The way to prevent is never drop and recreate replicated tables without
first removing them from the set.

Hope this helps.
-- 
View this message in context: http://www.nabble.com/Error-while-Inserting-into-table-tp25038554p25045264.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.

From cbbrowne at ca.afilias.info  Wed Aug 19 08:03:27 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed Aug 19 08:03:37 2009
Subject: [Slony1-general] version 1.2.17 release?
In-Reply-To: <516681.99844.qm@web23601.mail.ird.yahoo.com> (Glyn Astill's
	message of "Wed, 19 Aug 2009 12:16:53 +0000 (GMT)")
References: <516681.99844.qm@web23601.mail.ird.yahoo.com>
Message-ID: <8763cjongg.fsf@dba2.int.libertyrms.com>

Glyn Astill <glynastill@yahoo.co.uk> writes:
> I'm guessing they're just leaving a little time for people to test and
> give feedback about '17-rc

Indeed.  Rushing versions out tends to turn out badly.

I think it's coming time to release both 1.2.17 and 2.0.3, as there
haven't been any negative reports.
-- 
(reverse (concatenate 'string "ofni.sailifa.ac" "@" "enworbbc"))
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"
From cbbrowne at ca.afilias.info  Wed Aug 19 09:34:24 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed Aug 19 09:34:35 2009
Subject: [Slony1-general] Error while Inserting into table
In-Reply-To: <25045264.post@talk.nabble.com> (Gordon Shannon's message of
	"Wed, 19 Aug 2009 07:31:48 -0700 (PDT)")
References: <4077e7710908182335k32dc66b1r37cd42aa8518d76f@mail.gmail.com>
	<25045264.post@talk.nabble.com>
Message-ID: <87ws4zn4of.fsf@dba2.int.libertyrms.com>

Gordon Shannon <gordo169@gmail.com> writes:
> I don't know what the official way to fix this is.  I actually fixed it by
> updating sl_table manually, but proceed at your own risk :-)  I can't swear
> to it, but I'm pretty sure I just did this.  I figured it couldn't make
> things worse.

There's a Slonik command for this...

http://www.slony.info/documentation/stmtrepairconfig.html
-- 
(format nil "~S@~S" "cbbrowne" "ca.afilias.info")
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"
From karl at denninger.net  Wed Aug 19 21:28:43 2009
From: karl at denninger.net (Karl Denninger)
Date: Wed Aug 19 21:30:20 2009
Subject: [Slony1-general] Slony Compatable with Postgresql 8.4?
Message-ID: <4A8CD0FB.6010604@denninger.net>

I am attempting to migrate over to 8.4 using Slony, and am getting some
odd errors relating to locking problems.

Is Slony (2.0.2) supposed to work with Postgresql 8.4 or am I ahead of
the Slony developers? :)

Thanks in advance!

-- Karl
-------------- next part --------------
A non-text attachment was scrubbed...
Name: karl.vcf
Type: text/x-vcard
Size: 265 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20090819=
/f7ec954f/karl.vcf
From nettreeinc at gmail.com  Wed Aug 19 23:12:26 2009
From: nettreeinc at gmail.com (roctaiwan)
Date: Wed Aug 19 23:12:59 2009
Subject: [Slony1-general] How does it work if has different sets on
	different nodes?
Message-ID: <25056529.post@talk.nabble.com>


I have a scenarior that wants to get straight. 

My node 1 (master) has all the sets from 1-5. node 2 has subscribe to set 1
and 2, node 3 subscribe 3, 4, node 4 subscribe to set 5. All nodes subscribe
and listen from the master node, any tables within the sets will replicating
to their corresponding slave node. 

If I do switchover from node 1 to node 2, if I am correct, node 1 will
forward all the sets to node 2, node 2 then will SYNC with all other nodes
(or all from Master) to collect all datas that it does not have, preparing
itself to become same "status" as the original Master(node1) and now node 1
the original master has become the subscriber to node 2. 

Now, if I switch back from Node 2 to node 1 what is exact happening? My node
1 had all the original sets and they got forward to node2, if I do switch
over again then node 1 has collect all the sets on itself and node 2 will
have sets that originally assigned to it (which are set 1 and 2)? or both
node will have all sets information?

Other then talking about sets, whats the data relationship within them? node
1 has had all the up-to-dated datas(lets say it has 1mb of data from all 5
sets), and after switch over node2 catching up and data is still growing
(lets say it's now 2mb from all 5 sets). If I do switchover back from node 2
to node 1, then node 2 still has 2mb of datas and newly collected data will
all forward to node 1, so node one will also has 2mb of data in it? so right
after the switchover data within node 1 and 2 are SYNCed (all has fully
updated data from all 5 sets? or node 2 will only holds data of sets it got
assign to collect (set 1 and 2)?




-- 
View this message in context: http://www.nabble.com/How-does-it-work-if-has-different-sets-on-different-nodes--tp25056529p25056529.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.

From peter.geoghegan86 at gmail.com  Thu Aug 20 08:34:30 2009
From: peter.geoghegan86 at gmail.com (Peter Geoghegan)
Date: Thu Aug 20 08:34:40 2009
Subject: [Slony1-general] Slony Compatable with Postgresql 8.4?
In-Reply-To: <4A8CD0FB.6010604@denninger.net>
References: <4A8CD0FB.6010604@denninger.net>
Message-ID: <db471ace0908200834k7a460227gc88746a7194f5686@mail.gmail.com>

Yes, it works, even though Slony 2.0.2 warns of an unknown PostgreSQL
version (or words to that effect). This warning has been fixed as of
2.0.3RC (it says of 2.0.3RC "PostgreSQL 8.4 has been released; slonik
needs to explicitly recognize it" on slony.info, by which I guess it
is meant that this warning is removed).

Regards,
Peter Geoghegan

2009/8/20 Karl Denninger <karl@denninger.net>:
> I am attempting to migrate over to 8.4 using Slony, and am getting some
> odd errors relating to locking problems.
>
> Is Slony (2.0.2) supposed to work with Postgresql 8.4 or am I ahead of
> the Slony developers? :)
>
> Thanks in advance!
>
> -- Karl
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>
>
From gordo169 at gmail.com  Thu Aug 20 08:50:17 2009
From: gordo169 at gmail.com (Gordon Shannon)
Date: Thu Aug 20 08:50:28 2009
Subject: [Slony1-general] Slony Compatable with Postgresql 8.4?
In-Reply-To: <4A8CD0FB.6010604@denninger.net>
References: <4A8CD0FB.6010604@denninger.net>
Message-ID: <25064746.post@talk.nabble.com>


We are running 2.0.2 with 2 8.4 nodes and 1 8.3 node.  We had to apply
patches for 2 issues which reportedly have been fixed in 2.0.3.  The issues
were not related to locking.  One was about vacuuming -- a slony function
was trying to query pg_autovacuum, which is gone in 8.4.  The other was a
bug in the C code, see 
http://www.nabble.com/How-to-downgrade-from-2.0.2-to-2.0.1-tc24540512.html
this thread , and that bug was also in 2.0.1.  

We've been live now for about a month with no further problems.

-Gordon


Karl Denninger wrote:
> 
> I am attempting to migrate over to 8.4 using Slony, and am getting some
> odd errors relating to locking problems.
> 
> Is Slony (2.0.2) supposed to work with Postgresql 8.4 or am I ahead of
> the Slony developers? :)
> 

-- 
View this message in context: http://www.nabble.com/Slony-Compatable-with-Postgresql-8.4--tp25055873p25064746.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.

From ajs at crankycanuck.ca  Thu Aug 20 09:29:18 2009
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Thu Aug 20 09:29:31 2009
Subject: [Slony1-general] How does it work if has different sets on
	different nodes?
In-Reply-To: <25056529.post@talk.nabble.com>
References: <25056529.post@talk.nabble.com>
Message-ID: <20090820162918.GN6466@shinkuro.com>

On Wed, Aug 19, 2009 at 11:12:26PM -0700, roctaiwan wrote:

> My node 1 (master) has all the sets from 1-5. node 2 has subscribe to set 1
> and 2, node 3 subscribe 3, 4, 
 
> If I do switchover from node 1 to node 2, if I am correct, node 1 will
> forward all the sets to node 2, node 2 then will SYNC with all other nodes
> (or all from Master) to collect all datas that it does not have, preparing
> itself to become same "status" as the original Master(node1) and now node 1
> the original master has become the subscriber to node 2. 

No, I don't believe this is right, assuming I understand you.
Switchover works on sets, so you will effectively make node 2 the
origin for sets 1 and 2, but sets 3-5 will remain origined on node 1.

The key thing here to get is that Slony has no real notion of "all
nodes" involved in replication from one node to another.  It's just
not interested in that.  At the basic level, it is set-oriented.  So
the sets are nodes involved in replicating that set.  You can (could?)
conveniently work on supersets using external tools, but Slony doesn't
itself care about that.

You raise an interesting point about the documentation, however, which
is that it doesn't make clear that the new origin (in the case of MOVE
SET) has to be actually subscribed before moving to it.  This is
similarly unclear in the FAILOVER command, although I suppose in that
case it ought to be obvious that if you're not already subscribed,
failing over to such a node is doomed.

A
-- 
Andrew Sullivan
ajs@crankycanuck.ca
From VooDooNet38 at free.fr  Thu Aug 20 23:39:04 2009
From: VooDooNet38 at free.fr (VooDoo)
Date: Thu Aug 20 23:39:43 2009
Subject: [Slony1-general] How To Install on w2k3 servers
References: <25056529.post@talk.nabble.com>
	<20090820162918.GN6466@shinkuro.com>
Message-ID: <001001ca222a$13d69040$1f0aa8c0@stepaneurope.com>

Hello,
Does someones has a guideline on how to install Slony on a windows 2003 
servers running PgSQL 8.4?
On had any experience on this?

Thanks
VooDoo

From nettreeinc at gmail.com  Thu Aug 20 23:47:24 2009
From: nettreeinc at gmail.com (roctaiwan)
Date: Thu Aug 20 23:48:00 2009
Subject: [Slony1-general] How do you rejoin a dropped nodes?
Message-ID: <25074942.post@talk.nabble.com>


DROP NODE command will also do "UNINSTALL NODE" command. The UNINSTALL NODE
from slony docunment explained:

"Restores all tables to the unlocked state, with all original user triggers,
constraints and rules, eventually added Slony-I specific serial key columns
dropped and the Slony-I schema dropped. The node becomes a standalone
database. The data is left untouched."

Explanation for DROP NODE on docunment:

"Drop a node. This command removes the specified node entirely from the
replication systems configuration. If the replication daemon is still
running on that node (and processing events), it will attempt to uninstall
the replication system and terminate itself. "

If after node dropped, docunment said if wants to rejoin the node back, it
will required to start from scratch. 

But what exacetly is from scratch? Do I have to do store node and store path
again? What should I do with initiate the cluster and creating sets, do I
have to do that? or it should still have the same configuarion information
as before it got dropped?

I have tried many way to rejoin back my node, but unsuccessful. Error
message sounds like tells me the node was exist and don't let me rejoin.
What's wrong?

Here is the error message:
<stdin>:21: Error: ev_origin for store_node cannot be the new node
<stdin>:21: database specified in <stdin>:5 reports no_id 2

and here is the script I tried to run:

#!/bin/sh

############################################
# Define Cluster Name, Database Name, Host #
# IP for Nodes and Database User Name.     #
############################################
CLUSTER=contact_cluster
DB=contactDB
Node1=172.22.4.224
Node2=172.22.4.221
Node3=172.22.4.222
Node4=172.22.4.223
U=postgres
slonik <<_EOF_
cluster name = $CLUSTER;

node 1 admin conninfo = 'dbname=$DB host=$Node1 user=$U';
node 2 admin conninfo = 'dbname=$DB host=$Node2 user=$U';
node 3 admin conninfo = 'dbname=$DB host=$Node3 user=$U';
node 4 admin conninfo = 'dbname=$DB host=$Node4 user=$U';

store node (id = 2, comment = 'Slave 1');

# Bi-directional replication to be established between Node 1 and Node 2.
store path (server = 1, client = 2, conninfo = 'dbname=$DB host=$Node1
user=$U');
store path (server = 2, client = 1, conninfo = 'dbname=$DB host=$Node2
user=$U');

_EOF_
-- 
View this message in context: http://www.nabble.com/How-do-you-rejoin-a-dropped-nodes--tp25074942p25074942.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.

From nettreeinc at gmail.com  Fri Aug 21 01:46:53 2009
From: nettreeinc at gmail.com (roctaiwan)
Date: Fri Aug 21 01:47:34 2009
Subject: [Slony1-general] How do you rejoin a dropped nodes?
In-Reply-To: <25074942.post@talk.nabble.com>
References: <25074942.post@talk.nabble.com>
Message-ID: <25075915.post@talk.nabble.com>


Ok I had tried another way to do rejoin my node to group from "scratch" as
instructed from docunment. 
I drop the whole table and rebuild it, then dump everything from current
master and restore it back to my dropped node. Now my dropped node has the
same status as the master now. 
I then trying to do add_cluster on master, but it gave me this message:

<stdin>:21: Error: ev_origin for store_node cannot be the new node
<stdin>:21: PGRES_FATAL_ERROR select
"_sql_cluster".getLocalNodeId('_sql_cluster'); - ERROR:  schema
"_sql_cluster" does not exist
<stdin>:21: database specified in <stdin>:5 reports no_id -1

WHY??? what's wrong with it? I already inform all the node that I had
dropped the Node1, why it said "Error: ev_origin for store_node cannot be
the new node" ????
-- 
View this message in context: http://www.nabble.com/How-do-you-rejoin-a-dropped-nodes--tp25074942p25075915.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.

From vasyvasilie at yandex.ru  Fri Aug 21 08:09:59 2009
From: vasyvasilie at yandex.ru (vasiliev vasya)
Date: Fri Aug 21 08:10:09 2009
Subject: [Slony1-general] Master/slave replication priority on slony1/2
Message-ID: <260821250867399@webmail12.yandex.ru>

Hi, all.

We have good working replication scheme with one master and several slave servers, created and worked now no slony1-1* version and planned to migrate on slony1-2* version. Now we have some problems with big changes on master database, and that's why our replicas late from master for considerable time. I started to tune some slony settings, but unfortuanally, i didn't found configuration of slony that's works well in this case (possible, i should tune postgresql with slony, but how?). I'm interested in two ways:
1. The configuration when the replication system have max priority and master/slaves servers preffered works firstefull to sync data, not to responce to sql queries from our programs.
2. The configuration when responce of queries sould be preffered than replication, replication can late some.

Is it possible to tune slony (any vesion) and postgresql (last version) for theese two ways?

~vasya
From seklecki at noc.cfi.pgh.pa.us  Fri Aug 21 11:08:32 2009
From: seklecki at noc.cfi.pgh.pa.us (Brian A. Seklecki)
Date: Fri Aug 21 11:27:01 2009
Subject: [Slony1-general] Core file.
In-Reply-To: <E9F099885B445541A55D830FC62E175A0B66FF37FB@INBANSXCHMBSA3.in.alcatel-lucent.com>
References: <E9F099885B445541A55D830FC62E175A0B66FF37FB@INBANSXCHMBSA3.in.alcatel-lucent.com>
Message-ID: <1250878112.25573.1165.camel@soundwave.ws.pitbpa0.priv.collaborativefusion.com>

On Mon, 2009-08-17 at 17:52 +0530, Nagaraja, Madhukar (Madhukar) wrote:
> le back, but got no replies. So resending it again.

Missed your original msg (URL?)

Did you re-compile your binary with debugging symbols( COPTS+=-g, CFLAGS
+=-g, etc.).

If so, you can run it through GDB and get a backtrace, then file a bug
report on the web site.



~BAS


From seklecki at noc.cfi.pgh.pa.us  Fri Aug 21 11:17:04 2009
From: seklecki at noc.cfi.pgh.pa.us (Brian A. Seklecki)
Date: Fri Aug 21 11:27:02 2009
Subject: [Slony1-general] fork() and debug stdout/stderror -- time to clean
	it up?
Message-ID: <1250878624.25573.1174.camel@soundwave.ws.pitbpa0.priv.collaborativefusion.com>

All:

So Slony has been around in one form or another since 2004, but to this
day it continues to send stdout/stderr to the PTY/TTY from which it was
spawned, even after fork()'s the daemon.

Even if init(8) spawned it on console, which data center terminal
servers just love.

Can I get a show of hands who else would like this adjusted?

Its just not compliant with POSIX system standard, or generally accepted
industry practices.

 ~BAS


From cbbrowne at ca.afilias.info  Fri Aug 21 14:35:37 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri Aug 21 14:36:00 2009
Subject: [Slony1-general] Master/slave replication priority on slony1/2
In-Reply-To: <260821250867399@webmail12.yandex.ru> (vasiliev vasya's message
	of "Fri, 21 Aug 2009 19:09:59 +0400")
References: <260821250867399@webmail12.yandex.ru>
Message-ID: <87skfkluja.fsf@dba2.int.libertyrms.com>

vasiliev vasya <vasyvasilie@yandex.ru> writes:
> We have good working replication scheme with one master and several slave servers, created and worked now no slony1-1* version and planned to migrate on slony1-2* version. Now we have some problems with big changes on master database, and that's why our replicas late from master for considerable time. I started to tune some slony settings, but unfortuanally, i didn't found configuration of slony that's works well in this case (possible, i should tune postgresql with slony, but how?). I'm interested in two ways:
> 1. The configuration when the replication system have max priority and master/slaves servers preffered works firstefull to sync data, not to responce to sql queries from our programs.
> 2. The configuration when responce of queries sould be preffered than replication, replication can late some.
>
> Is it possible to tune slony (any vesion) and postgresql (last version) for theese two ways?

Not really, no.

There's not a mechanism in PostgreSQL to control priority of workload,
so we don't have a particular way to tune things in this fashion.

The amount of time taken between processing SYNCs is a *loose* sort of
control for this (see the -s and -t options to slon) , but more in the
"you can make Slony-I back off somewhat" fashion.  And unfortunately, if
your system's overloaded, that will cease to have much effect pretty
quickly.

I'll bounce this over to the hackers list, as it could be an interesting
idea.  But there's a pretty decent chance of it getting pooh-poohed.
-- 
let name="cbbrowne" and tld="ca.afilias.info" in String.concat "@" [name;tld];;
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"
From cbbrowne at ca.afilias.info  Fri Aug 21 14:41:38 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri Aug 21 14:42:01 2009
Subject: [Slony1-general] fork() and debug stdout/stderror -- time to
	clean it up?
In-Reply-To: <1250878624.25573.1174.camel@soundwave.ws.pitbpa0.priv.collaborativefusion.com>
	(Brian A. Seklecki's message of "Fri, 21 Aug 2009 14:17:04 -0400")
References: <1250878624.25573.1174.camel@soundwave.ws.pitbpa0.priv.collaborativefusion.com>
Message-ID: <87my5slu99.fsf@dba2.int.libertyrms.com>

"Brian A. Seklecki" <seklecki@noc.cfi.pgh.pa.us> writes:
> So Slony has been around in one form or another since 2004, but to this
> day it continues to send stdout/stderr to the PTY/TTY from which it was
> spawned, even after fork()'s the daemon.
>
> Even if init(8) spawned it on console, which data center terminal
> servers just love.
>
> Can I get a show of hands who else would like this adjusted?
>
> Its just not compliant with POSIX system standard, or generally accepted
> industry practices.

I wouldn't object to seeing a patch to improve this matter...

If it takes some work, but doesn't look heinous, I'd join in on the
remediation...
-- 
output = reverse("ofni.sailifa.ac" "@" "enworbbc")
Christopher Browne
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"
From karl at denninger.net  Fri Aug 21 20:58:00 2009
From: karl at denninger.net (Karl Denninger)
Date: Fri Aug 21 20:59:52 2009
Subject: [Slony1-general] More on 8.4 .vs. Slony 2.0.2
Message-ID: <4A8F6CC8.1040500@denninger.net>

I had posted a compatibility question related to Slony 2.0.2 and
Postgres 8.4 previous, and got back that there were some warnings at
issue, but no other particular problems.

The current configuration has 1 master (node 2) and two slaves (1 and
3); I attempted to add a node #4 with 8.4.0 running on the same machine
as the master.

The server is in its own directory, on its own port (55432) and all the
tables are present.

I've got the following config:

In <slonik.preamble>
CLUSTER NAME =3D tickerforum;
node 1 admin conninfo=3D'dbname=3Dticker host=3Dgenesis.denninger.net
user=3Dslony port=3D55432 password=3Dxxxx';
node 2 admin conninfo=3D'dbname=3Dticker host=3Dcolo1.denninger.net user=3D=
slony
password=3Dxxxx port=3D5432';
node 3 admin conninfo=3D'dbname=3Dticker host=3Dgenesis.denninger.net
user=3Dslony password=3Dxxxx port=3D5432';
node 4 admin conninfo=3D'dbname=3Dticker host=3Dcolo1.denninger.net user=3D=
slony
password=3Dxxxx port=3D55432';


Then I use (which has worked to set up the other two)


include <slonik.preamble>;
store node (id=3D4, comment=3D'Client #1, Node #4', event node=3D2);


followed by:

include <slonik.preamble>;
store path (server=3D4, client=3D2, conninfo=3D'dbname=3Dticker
host=3Dcolo1.denninger.net user=3Dslony port=3D55432 password=3Dxxxx');
store path (server=3D2, client=3D4, conninfo=3D'dbname=3Dticker
host=3Dcolo1.denninger.net user=3Dslony port=3D5432 password=3Dxxxx');

To store the client and server paths

Then to start replication:

include <slonik.preamble>;
subscribe set (id=3D1, provider=3D2, receiver=3D4, forward=3Dfalse);

The logfile, however, shows this:
Aug 21 23:50:24 tickerforum slon[61661]: [400-1] INFO   about to
monitor_subscriber_query - pulling big actionid list 17933184
Aug 21 23:50:26 tickerforum slon[61661]: [401-1] INFO   about to
monitor_subscriber_query - pulling big actionid list 17933184
Aug 21 23:50:28 tickerforum slon[61661]: [402-1] INFO   about to
monitor_subscriber_query - pulling big actionid list 17933184
Aug 21 23:50:30 tickerforum slon[61661]: [403-1] INFO   about to
monitor_subscriber_query - pulling big actionid list 17933184
Aug 21 23:50:32 tickerforum slon[61661]: [404-1] INFO   about to
monitor_subscriber_query - pulling big actionid list 17933184

Aug 21 23:50:34 tickerforum slon[61661]: [405-1] INFO   about to
monitor_subscriber_query - pulling big actionid list 17933184
Aug 21 23:50:36 tickerforum slon[61661]: [406-1] INFO  =

cleanupThread:    0.036 seconds for cleanupEvent()
Aug 21 23:50:36 tickerforum slon[61661]: [407-1] INFO   about to
monitor_subscriber_query - pulling big actionid list 17933184
Aug 21 23:50:38 tickerforum slon[61661]: [408-1] INFO   about to
monitor_subscriber_query - pulling big actionid list 17933184
Aug 21 23:50:40 tickerforum slon[61661]: [409-1] INFO   about to
monitor_subscriber_query - pulling big actionid list 17933184
Aug 21 23:50:42 tickerforum slon[61661]: [410-1] INFO   about to
monitor_subscriber_query - pulling big actionid list 17933184

Over and over again - but the COPY is never run so it never goes into
normal monitoring mode.

The other two clients are running normally - no problems.

Any ideas why this is looping on that particular message and never
actually cranks up?

An attempt to upgrade to 2.0.3-rc2 failed with a complaint during the
function upgrade about incompatible typing - since I do not want to kill
replication and rebuild it from scratch, I stopped there and backed out
back to 2.0.2.

A run of the Perl "monitoring" script elucidates the following:

$ perl /usr/local/pgsql/bin/test_slony_state-dbi.pl --database=3Dticker
--cluster=3Dtickerforum
DSN: dbi:Pg:dbname=3Dticker;
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D
Rummage for DSNs
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D
Query:

   select p.pa_server, p.pa_conninfo
   from "_tickerforum".sl_path p
--   where exists (select * from "_tickerforum".sl_subscribe s where
--                          (s.sub_provider =3D p.pa_server or
s.sub_receiver =3D p.pa_server) and
--                          sub_active =3D 't')
   group by pa_server, pa_conninfo;


Tests for node 1 - DSN =3D dbi:Pg:dbname=3Dticker host=3Dgenesis.denninger.=
net
user=3Dslony port=3D55432 password=3Dorishaoku
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
pg_listener info:
Pages: 1
Tuples: 1

Size Tests
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
       sl_log_1         0  0.000000
       sl_log_2         0  0.000000
      sl_seqlog         5 743.000000

Listen Path Analysis
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D
No problems found with sl_listen


---------------------------------------------------------------------------=
-----
Summary of event info
 Origin  Min SYNC  Max SYNC Min SYNC Age Max SYNC Age
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D
      2   6274244   6274967    -00:59:00    -00:19:00    0
      4         1         2    -00:46:00    -00:45:00    0
      1        25        27     00:29:00 1 day 23:18:00    0
      3        25        26     00:21:00 1 day 23:18:00    0


---------------------------------------------------------------------------=
------
Summary of sl_confirm aging
   Origin   Receiver   Min SYNC   Max SYNC  Age of latest SYNC  Age of
eldest SYNC
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D
        1          2         25         27     -00:35:00  1 day
22:18:00    0
        1          3         27         27      00:21:00      00:21:00    0
        1          4          0         27     -00:45:00      00:14:00    0
        2          1    6274455    6274967      00:00:00      00:17:00    0
        2          3    6274455    6274965      00:00:00      00:17:00    0
        2          4          0    6274963     -00:59:00      00:14:00    0
        3          1         26         26      00:21:00      00:21:00    0
        3          2         25         26     -00:38:00  1 day
22:18:00    0
        3          4          0         26     -00:45:00      00:14:00    0
        4          1          0          2      00:13:00      00:14:00    0
        4          2          0          2     -00:46:00      00:14:00    0
        4          3          0          2     -00:45:00      00:14:00    0


---------------------------------------------------------------------------=
---

Listing of old open connections on node 1
       Database             PID            User    Query
Age                Query
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D


Tests for node 4 - DSN =3D dbi:Pg:dbname=3Dticker host=3Dcolo1.denninger.net
user=3Dslony port=3D55432 password=3Dorishaoku
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
pg_listener info:
Pages: 0
Tuples: 0

Size Tests
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
       sl_log_1         0  0.000000
       sl_log_2         0  0.000000
      sl_seqlog         0  0.000000

Listen Path Analysis
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D
No problems found with sl_listen

---------------------------------------------------------------------------=
-----
Summary of event info
 Origin  Min SYNC  Max SYNC Min SYNC Age Max SYNC Age
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D
      4         2         2     00:13:00     00:13:00    0
      2   6274595   6274967     00:00:00     00:13:00    0


---------------------------------------------------------------------------=
------
Summary of sl_confirm aging
   Origin   Receiver   Min SYNC   Max SYNC  Age of latest SYNC  Age of
eldest SYNC
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D
        1          2         27         27      00:24:00      00:24:00    0
        1          3         27         27      01:21:00      01:21:00    1
        1          4         27         27      00:14:00      00:14:00    0
        2          1    6274868    6274964      01:00:00      01:03:00    1
        2          3    6274870    6274965      01:00:00      01:03:00    1
        2          4    6274595    6274967      00:00:00      00:13:00    0
        3          1         26         26      01:21:00      01:21:00    1
        3          2         26         26      00:21:00      00:21:00    0
        3          4         26         26      00:14:00      00:14:00    0
        4          1          2          2      00:14:00      00:14:00    0
        4          2          2          2      00:13:00      00:13:00    0
        4          3          2          2      00:14:00      00:14:00    0


---------------------------------------------------------------------------=
---

Listing of old open connections on node 4
       Database             PID            User    Query
Age                Query
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D


Tests for node 3 - DSN =3D dbi:Pg:dbname=3Dticker host=3Dgenesis.denninger.=
net
user=3Dslony port=3D5432 password=3Dorishaoku
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
pg_listener info:
Pages: 1
Tuples: 1

Size Tests
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
       sl_log_1         0  0.000000
       sl_log_2         0  0.000000
      sl_seqlog         8 1113.000000

Listen Path Analysis
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D
No problems found with sl_listen

---------------------------------------------------------------------------=
-----
Summary of event info
 Origin  Min SYNC  Max SYNC Min SYNC Age Max SYNC Age
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D
      2   6273791   6274967    -00:59:00    -00:03:00    0
      1        25        27     00:29:00 1 day 23:18:00    0
      4         1         2    -00:46:00    -00:45:00    0
      3        25        26     00:21:00 1 day 23:18:00    0


---------------------------------------------------------------------------=
------
Summary of sl_confirm aging
   Origin   Receiver   Min SYNC   Max SYNC  Age of latest SYNC  Age of
eldest SYNC
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D
        1          2         25         27     -00:35:00  1 day
22:18:00    0
        1          3         27         27      00:21:00      00:21:00    0
        1          4          0         27     -00:45:00      00:14:00    0
        2          1    6274662    6274964      00:00:00      00:10:00    0
        2          3    6274665    6274967      00:00:00      00:10:00    0
        2          4          0    6274963     -00:59:00      00:14:00    0
        3          1         26         26      00:21:00      00:21:00    0
        3          2         25         26     -00:38:00  1 day
22:18:00    0
        3          4          0         26     -00:45:00      00:14:00    0
        4          1          0          2     -00:45:00      00:14:00    0
        4          2          0          2     -00:46:00      00:14:00    0
        4          3          2          2      00:13:00      00:13:00    0


---------------------------------------------------------------------------=
---

Listing of old open connections on node 3
       Database             PID            User    Query
Age                Query
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D


Tests for node 2 - DSN =3D dbi:Pg:dbname=3Dticker host=3Dcolo1.denninger.net
user=3Dslony port=3D5432 password=3Dorishaoku
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
pg_listener info:
Pages: 1
Tuples: 1

Size Tests
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
       sl_log_1       334 9884.000000
       sl_log_2         0  0.000000
      sl_seqlog         4 173.000000

Listen Path Analysis
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D
No problems found with sl_listen

---------------------------------------------------------------------------=
-----
Summary of event info
 Origin  Min SYNC  Max SYNC Min SYNC Age Max SYNC Age
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D
      2   6274650   6274968     00:00:00     00:10:00    0
      4         2         2     00:13:00     00:13:00    0
      1        27        27     01:29:00     01:29:00    1
      3        26        26     01:21:00     01:21:00    1


---------------------------------------------------------------------------=
------
Summary of sl_confirm aging
   Origin   Receiver   Min SYNC   Max SYNC  Age of latest SYNC  Age of
eldest SYNC
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D
        1          2         27         27      00:24:00      00:24:00    0
        1          3         27         27      01:21:00      01:21:00    1
        1          4         27         27      00:14:00      00:14:00    0
        2          1    6274948    6274964      01:00:00      01:00:00    1
        2          3    6274945    6274965      01:00:00      01:00:00    1
        2          4    6274650    6274963      00:00:00      00:10:00    0
        3          1         26         26      01:21:00      01:21:00    1
        3          2         26         26      00:21:00      00:21:00    0
        3          4         26         26      00:14:00      00:14:00    0
        4          1          2          2      01:13:00      01:13:00    1
        4          2          2          2      00:13:00      00:13:00    0
        4          3          2          2      01:13:00      01:13:00    1


---------------------------------------------------------------------------=
---

Listing of old open connections on node 2
       Database             PID            User    Query
Age                Query
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D


This looks ok - nothing that appears hung, but no replication starts.....

What am I doing wrong here?  This same set of setup files (with the
appropriate names) worked to add the third node...

-- Karl


-------------- next part --------------
A non-text attachment was scrubbed...
Name: karl.vcf
Type: text/x-vcard
Size: 265 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20090821=
/101f1d44/karl.vcf
From karl at denninger.net  Fri Aug 21 21:06:37 2009
From: karl at denninger.net (Karl Denninger)
Date: Fri Aug 21 21:08:28 2009
Subject: [Slony1-general] More on 8.4 .vs. Slony 2.0.2
In-Reply-To: <4A8F6CC8.1040500@denninger.net>
References: <4A8F6CC8.1040500@denninger.net>
Message-ID: <4A8F6ECD.60206@denninger.net>



Karl Denninger wrote:
> I had posted a compatibility question related to Slony 2.0.2 and
> Postgres 8.4 previous, and got back that there were some warnings at
> issue, but no other particular problems.
>
> The current configuration has 1 master (node 2) and two slaves (1 and
> 3); I attempted to add a node #4 with 8.4.0 running on the same machine
> as the master.
>
> The server is in its own directory, on its own port (55432) and all the
> tables are present.
>
> I've got the following config:
>
> In <slonik.preamble>
> CLUSTER NAME =3D tickerforum;
> node 1 admin conninfo=3D'dbname=3Dticker host=3Dgenesis.denninger.net
> user=3Dslony port=3D55432 password=3Dxxxx';
> node 2 admin conninfo=3D'dbname=3Dticker host=3Dcolo1.denninger.net user=
=3Dslony
> password=3Dxxxx port=3D5432';
> node 3 admin conninfo=3D'dbname=3Dticker host=3Dgenesis.denninger.net
> user=3Dslony password=3Dxxxx port=3D5432';
> node 4 admin conninfo=3D'dbname=3Dticker host=3Dcolo1.denninger.net user=
=3Dslony
> password=3Dxxxx port=3D55432';
>
>
> Then I use (which has worked to set up the other two)
>
>
> include <slonik.preamble>;
> store node (id=3D4, comment=3D'Client #1, Node #4', event node=3D2);
>
>
> followed by:
>
> include <slonik.preamble>;
> store path (server=3D4, client=3D2, conninfo=3D'dbname=3Dticker
> host=3Dcolo1.denninger.net user=3Dslony port=3D55432 password=3Dxxxx');
> store path (server=3D2, client=3D4, conninfo=3D'dbname=3Dticker
> host=3Dcolo1.denninger.net user=3Dslony port=3D5432 password=3Dxxxx');
>
> To store the client and server paths
>
> Then to start replication:
>
> include <slonik.preamble>;
> subscribe set (id=3D1, provider=3D2, receiver=3D4, forward=3Dfalse);
>
> The logfile, however, shows this:
> Aug 21 23:50:24 tickerforum slon[61661]: [400-1] INFO   about to
> monitor_subscriber_query - pulling big actionid list 17933184
> Aug 21 23:50:26 tickerforum slon[61661]: [401-1] INFO   about to
> monitor_subscriber_query - pulling big actionid list 17933184
> Aug 21 23:50:28 tickerforum slon[61661]: [402-1] INFO   about to
> monitor_subscriber_query - pulling big actionid list 17933184
> Aug 21 23:50:30 tickerforum slon[61661]: [403-1] INFO   about to
> monitor_subscriber_query - pulling big actionid list 17933184
> Aug 21 23:50:32 tickerforum slon[61661]: [404-1] INFO   about to
> monitor_subscriber_query - pulling big actionid list 17933184
>
> Aug 21 23:50:34 tickerforum slon[61661]: [405-1] INFO   about to
> monitor_subscriber_query - pulling big actionid list 17933184
> Aug 21 23:50:36 tickerforum slon[61661]: [406-1] INFO  =

> cleanupThread:    0.036 seconds for cleanupEvent()
> Aug 21 23:50:36 tickerforum slon[61661]: [407-1] INFO   about to
> monitor_subscriber_query - pulling big actionid list 17933184
> Aug 21 23:50:38 tickerforum slon[61661]: [408-1] INFO   about to
> monitor_subscriber_query - pulling big actionid list 17933184
> Aug 21 23:50:40 tickerforum slon[61661]: [409-1] INFO   about to
> monitor_subscriber_query - pulling big actionid list 17933184
> Aug 21 23:50:42 tickerforum slon[61661]: [410-1] INFO   about to
> monitor_subscriber_query - pulling big actionid list 17933184
>
> Over and over again - but the COPY is never run so it never goes into
> normal monitoring mode.
>
> The other two clients are running normally - no problems.
>
> Any ideas why this is looping on that particular message and never
> actually cranks up?
>
> An attempt to upgrade to 2.0.3-rc2 failed with a complaint during the
> function upgrade about incompatible typing - since I do not want to kill
> replication and rebuild it from scratch, I stopped there and backed out
> back to 2.0.2.
>
> A run of the Perl "monitoring" script elucidates the following:
>
> $ perl /usr/local/pgsql/bin/test_slony_state-dbi.pl --database=3Dticker
> --cluster=3Dtickerforum
> DSN: dbi:Pg:dbname=3Dticker;
> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
> Rummage for DSNs
> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D
> Query:
>
>    select p.pa_server, p.pa_conninfo
>    from "_tickerforum".sl_path p
> --   where exists (select * from "_tickerforum".sl_subscribe s where
> --                          (s.sub_provider =3D p.pa_server or
> s.sub_receiver =3D p.pa_server) and
> --                          sub_active =3D 't')
>    group by pa_server, pa_conninfo;
>
>
> Tests for node 1 - DSN =3D dbi:Pg:dbname=3Dticker host=3Dgenesis.denninge=
r.net
> user=3Dslony port=3D55432 password=3Dorishaoku
> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
> pg_listener info:
> Pages: 1
> Tuples: 1
>
> Size Tests
> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
>        sl_log_1         0  0.000000
>        sl_log_2         0  0.000000
>       sl_seqlog         5 743.000000
>
> Listen Path Analysis
> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D
> No problems found with sl_listen
>
>
> -------------------------------------------------------------------------=
-------
> Summary of event info
>  Origin  Min SYNC  Max SYNC Min SYNC Age Max SYNC Age
> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D
>       2   6274244   6274967    -00:59:00    -00:19:00    0
>       4         1         2    -00:46:00    -00:45:00    0
>       1        25        27     00:29:00 1 day 23:18:00    0
>       3        25        26     00:21:00 1 day 23:18:00    0
>
>
> -------------------------------------------------------------------------=
--------
> Summary of sl_confirm aging
>    Origin   Receiver   Min SYNC   Max SYNC  Age of latest SYNC  Age of
> eldest SYNC
> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D
>         1          2         25         27     -00:35:00  1 day
> 22:18:00    0
>         1          3         27         27      00:21:00      00:21:00   =
 0
>         1          4          0         27     -00:45:00      00:14:00   =
 0
>         2          1    6274455    6274967      00:00:00      00:17:00   =
 0
>         2          3    6274455    6274965      00:00:00      00:17:00   =
 0
>         2          4          0    6274963     -00:59:00      00:14:00   =
 0
>         3          1         26         26      00:21:00      00:21:00   =
 0
>         3          2         25         26     -00:38:00  1 day
> 22:18:00    0
>         3          4          0         26     -00:45:00      00:14:00   =
 0
>         4          1          0          2      00:13:00      00:14:00   =
 0
>         4          2          0          2     -00:46:00      00:14:00   =
 0
>         4          3          0          2     -00:45:00      00:14:00   =
 0
>
>
> -------------------------------------------------------------------------=
-----
>
> Listing of old open connections on node 1
>        Database             PID            User    Query
> Age                Query
> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D
>
>
> Tests for node 4 - DSN =3D dbi:Pg:dbname=3Dticker host=3Dcolo1.denninger.=
net
> user=3Dslony port=3D55432 password=3Dorishaoku
> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
> pg_listener info:
> Pages: 0
> Tuples: 0
>
> Size Tests
> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
>        sl_log_1         0  0.000000
>        sl_log_2         0  0.000000
>       sl_seqlog         0  0.000000
>
> Listen Path Analysis
> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D
> No problems found with sl_listen
>
> -------------------------------------------------------------------------=
-------
> Summary of event info
>  Origin  Min SYNC  Max SYNC Min SYNC Age Max SYNC Age
> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D
>       4         2         2     00:13:00     00:13:00    0
>       2   6274595   6274967     00:00:00     00:13:00    0
>
>
> -------------------------------------------------------------------------=
--------
> Summary of sl_confirm aging
>    Origin   Receiver   Min SYNC   Max SYNC  Age of latest SYNC  Age of
> eldest SYNC
> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D
>         1          2         27         27      00:24:00      00:24:00   =
 0
>         1          3         27         27      01:21:00      01:21:00   =
 1
>         1          4         27         27      00:14:00      00:14:00   =
 0
>         2          1    6274868    6274964      01:00:00      01:03:00   =
 1
>         2          3    6274870    6274965      01:00:00      01:03:00   =
 1
>         2          4    6274595    6274967      00:00:00      00:13:00   =
 0
>         3          1         26         26      01:21:00      01:21:00   =
 1
>         3          2         26         26      00:21:00      00:21:00   =
 0
>         3          4         26         26      00:14:00      00:14:00   =
 0
>         4          1          2          2      00:14:00      00:14:00   =
 0
>         4          2          2          2      00:13:00      00:13:00   =
 0
>         4          3          2          2      00:14:00      00:14:00   =
 0
>
>
> -------------------------------------------------------------------------=
-----
>
> Listing of old open connections on node 4
>        Database             PID            User    Query
> Age                Query
> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D
>
>
> Tests for node 3 - DSN =3D dbi:Pg:dbname=3Dticker host=3Dgenesis.denninge=
r.net
> user=3Dslony port=3D5432 password=3Dorishaoku
> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
> pg_listener info:
> Pages: 1
> Tuples: 1
>
> Size Tests
> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
>        sl_log_1         0  0.000000
>        sl_log_2         0  0.000000
>       sl_seqlog         8 1113.000000
>
> Listen Path Analysis
> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D
> No problems found with sl_listen
>
> -------------------------------------------------------------------------=
-------
> Summary of event info
>  Origin  Min SYNC  Max SYNC Min SYNC Age Max SYNC Age
> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D
>       2   6273791   6274967    -00:59:00    -00:03:00    0
>       1        25        27     00:29:00 1 day 23:18:00    0
>       4         1         2    -00:46:00    -00:45:00    0
>       3        25        26     00:21:00 1 day 23:18:00    0
>
>
> -------------------------------------------------------------------------=
--------
> Summary of sl_confirm aging
>    Origin   Receiver   Min SYNC   Max SYNC  Age of latest SYNC  Age of
> eldest SYNC
> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D
>         1          2         25         27     -00:35:00  1 day
> 22:18:00    0
>         1          3         27         27      00:21:00      00:21:00   =
 0
>         1          4          0         27     -00:45:00      00:14:00   =
 0
>         2          1    6274662    6274964      00:00:00      00:10:00   =
 0
>         2          3    6274665    6274967      00:00:00      00:10:00   =
 0
>         2          4          0    6274963     -00:59:00      00:14:00   =
 0
>         3          1         26         26      00:21:00      00:21:00   =
 0
>         3          2         25         26     -00:38:00  1 day
> 22:18:00    0
>         3          4          0         26     -00:45:00      00:14:00   =
 0
>         4          1          0          2     -00:45:00      00:14:00   =
 0
>         4          2          0          2     -00:46:00      00:14:00   =
 0
>         4          3          2          2      00:13:00      00:13:00   =
 0
>
>
> -------------------------------------------------------------------------=
-----
>
> Listing of old open connections on node 3
>        Database             PID            User    Query
> Age                Query
> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D
>
>
> Tests for node 2 - DSN =3D dbi:Pg:dbname=3Dticker host=3Dcolo1.denninger.=
net
> user=3Dslony port=3D5432 password=3Dorishaoku
> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
> pg_listener info:
> Pages: 1
> Tuples: 1
>
> Size Tests
> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
>        sl_log_1       334 9884.000000
>        sl_log_2         0  0.000000
>       sl_seqlog         4 173.000000
>
> Listen Path Analysis
> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D
> No problems found with sl_listen
>
> -------------------------------------------------------------------------=
-------
> Summary of event info
>  Origin  Min SYNC  Max SYNC Min SYNC Age Max SYNC Age
> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D
>       2   6274650   6274968     00:00:00     00:10:00    0
>       4         2         2     00:13:00     00:13:00    0
>       1        27        27     01:29:00     01:29:00    1
>       3        26        26     01:21:00     01:21:00    1
>
>
> -------------------------------------------------------------------------=
--------
> Summary of sl_confirm aging
>    Origin   Receiver   Min SYNC   Max SYNC  Age of latest SYNC  Age of
> eldest SYNC
> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D
>         1          2         27         27      00:24:00      00:24:00   =
 0
>         1          3         27         27      01:21:00      01:21:00   =
 1
>         1          4         27         27      00:14:00      00:14:00   =
 0
>         2          1    6274948    6274964      01:00:00      01:00:00   =
 1
>         2          3    6274945    6274965      01:00:00      01:00:00   =
 1
>         2          4    6274650    6274963      00:00:00      00:10:00   =
 0
>         3          1         26         26      01:21:00      01:21:00   =
 1
>         3          2         26         26      00:21:00      00:21:00   =
 0
>         3          4         26         26      00:14:00      00:14:00   =
 0
>         4          1          2          2      01:13:00      01:13:00   =
 1
>         4          2          2          2      00:13:00      00:13:00   =
 0
>         4          3          2          2      01:13:00      01:13:00   =
 1
>
>
> -------------------------------------------------------------------------=
-----
>
> Listing of old open connections on node 2
>        Database             PID            User    Query
> Age                Query
> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D
>
>
> This looks ok - nothing that appears hung, but no replication starts.....
>
> What am I doing wrong here?  This same set of setup files (with the
> appropriate names) worked to add the third node...
>
> -- Karl
>
>
>   =

> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>   =

Following up on this, I did a "DROP NODE" with the slons running, then
re-ran the config scripts.  Now I'm getting this - the same thing I was
getting last night:

Aug 22 00:04:11 tickerforum slon[66032]: [129-1] INFO   copy_set 1
Aug 22 00:04:11 tickerforum slon[66032]: [130-1] CONFIG version for
"dbname=3Dticker host=3Dcolo1.denninger.net user=3Dslony port=3D5432
password=3Dxxxxx" is 80306
Aug 22 00:04:11 tickerforum slon[66032]: [131-1] CONFIG
remoteWorkerThread_2: connected to provider DB
Aug 22 00:04:11 tickerforum slon[66032]: [132-1] CONFIG
remoteWorkerThread_2: prepare to copy table "public"."banned_ip"
Aug 22 00:04:11 tickerforum slon[66032]: [133-1] ERROR =

remoteWorkerThread_2: Could not lock table "public"."banned_ip" on
subscriber
Aug 22 00:04:11 tickerforum slon[66032]: [134-1] WARN  =

remoteWorkerThread_2: data copy for set 1 failed - sleep 60 seconds

And then this repeats every 60 seconds.

This is the lock error I was seeing before; I don't get it.....

-- Karl
-------------- next part --------------
A non-text attachment was scrubbed...
Name: karl.vcf
Type: text/x-vcard
Size: 265 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20090821=
/a7d6a01c/karl-0001.vcf
From jeff at pgexperts.com  Fri Aug 21 22:15:05 2009
From: jeff at pgexperts.com (Jeff Frost)
Date: Fri Aug 21 22:15:57 2009
Subject: [Slony1-general] More on 8.4 .vs. Slony 2.0.2
In-Reply-To: <4A8F6ECD.60206@denninger.net>
References: <4A8F6CC8.1040500@denninger.net> <4A8F6ECD.60206@denninger.net>
Message-ID: <4A8F7ED9.2050908@pgexperts.com>

Karl Denninger wrote:
> Karl Denninger wrote:
>   =

>> I had posted a compatibility question related to Slony 2.0.2 and
>> Postgres 8.4 previous, and got back that there were some warnings at
>> issue, but no other particular problems.
>>
>> The current configuration has 1 master (node 2) and two slaves (1 and
>> 3); I attempted to add a node #4 with 8.4.0 running on the same machine
>> as the master.
>>
>> The server is in its own directory, on its own port (55432) and all the
>> tables are present.
>>
>> I've got the following config:
>>
>> In <slonik.preamble>
>> CLUSTER NAME =3D tickerforum;
>> node 1 admin conninfo=3D'dbname=3Dticker host=3Dgenesis.denninger.net
>> user=3Dslony port=3D55432 password=3Dxxxx';
>> node 2 admin conninfo=3D'dbname=3Dticker host=3Dcolo1.denninger.net user=
=3Dslony
>> password=3Dxxxx port=3D5432';
>> node 3 admin conninfo=3D'dbname=3Dticker host=3Dgenesis.denninger.net
>> user=3Dslony password=3Dxxxx port=3D5432';
>> node 4 admin conninfo=3D'dbname=3Dticker host=3Dcolo1.denninger.net user=
=3Dslony
>> password=3Dxxxx port=3D55432';
>>
>>
>> Then I use (which has worked to set up the other two)
>>
>>
>> include <slonik.preamble>;
>> store node (id=3D4, comment=3D'Client #1, Node #4', event node=3D2);
>>
>>
>> followed by:
>>
>> include <slonik.preamble>;
>> store path (server=3D4, client=3D2, conninfo=3D'dbname=3Dticker
>> host=3Dcolo1.denninger.net user=3Dslony port=3D55432 password=3Dxxxx');
>> store path (server=3D2, client=3D4, conninfo=3D'dbname=3Dticker
>> host=3Dcolo1.denninger.net user=3Dslony port=3D5432 password=3Dxxxx');
>>
>> To store the client and server paths
>>
>> Then to start replication:
>>
>> include <slonik.preamble>;
>> subscribe set (id=3D1, provider=3D2, receiver=3D4, forward=3Dfalse);
>>
>> The logfile, however, shows this:
>> Aug 21 23:50:24 tickerforum slon[61661]: [400-1] INFO   about to
>> monitor_subscriber_query - pulling big actionid list 17933184
>> Aug 21 23:50:26 tickerforum slon[61661]: [401-1] INFO   about to
>> monitor_subscriber_query - pulling big actionid list 17933184
>> Aug 21 23:50:28 tickerforum slon[61661]: [402-1] INFO   about to
>> monitor_subscriber_query - pulling big actionid list 17933184
>> Aug 21 23:50:30 tickerforum slon[61661]: [403-1] INFO   about to
>> monitor_subscriber_query - pulling big actionid list 17933184
>> Aug 21 23:50:32 tickerforum slon[61661]: [404-1] INFO   about to
>> monitor_subscriber_query - pulling big actionid list 17933184
>>
>> Aug 21 23:50:34 tickerforum slon[61661]: [405-1] INFO   about to
>> monitor_subscriber_query - pulling big actionid list 17933184
>> Aug 21 23:50:36 tickerforum slon[61661]: [406-1] INFO  =

>> cleanupThread:    0.036 seconds for cleanupEvent()
>> Aug 21 23:50:36 tickerforum slon[61661]: [407-1] INFO   about to
>> monitor_subscriber_query - pulling big actionid list 17933184
>> Aug 21 23:50:38 tickerforum slon[61661]: [408-1] INFO   about to
>> monitor_subscriber_query - pulling big actionid list 17933184
>> Aug 21 23:50:40 tickerforum slon[61661]: [409-1] INFO   about to
>> monitor_subscriber_query - pulling big actionid list 17933184
>> Aug 21 23:50:42 tickerforum slon[61661]: [410-1] INFO   about to
>> monitor_subscriber_query - pulling big actionid list 17933184
>>
>> Over and over again - but the COPY is never run so it never goes into
>> normal monitoring mode.
>>
>> The other two clients are running normally - no problems.
>>
>> Any ideas why this is looping on that particular message and never
>> actually cranks up?
>>
>> An attempt to upgrade to 2.0.3-rc2 failed with a complaint during the
>> function upgrade about incompatible typing - since I do not want to kill
>> replication and rebuild it from scratch, I stopped there and backed out
>> back to 2.0.2.
>>
>> A run of the Perl "monitoring" script elucidates the following:
>>
>> $ perl /usr/local/pgsql/bin/test_slony_state-dbi.pl --database=3Dticker
>> --cluster=3Dtickerforum
>> DSN: dbi:Pg:dbname=3Dticker;
>> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
>> Rummage for DSNs
>> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D
>> Query:
>>
>>    select p.pa_server, p.pa_conninfo
>>    from "_tickerforum".sl_path p
>> --   where exists (select * from "_tickerforum".sl_subscribe s where
>> --                          (s.sub_provider =3D p.pa_server or
>> s.sub_receiver =3D p.pa_server) and
>> --                          sub_active =3D 't')
>>    group by pa_server, pa_conninfo;
>>
>>
>> Tests for node 1 - DSN =3D dbi:Pg:dbname=3Dticker host=3Dgenesis.denning=
er.net
>> user=3Dslony port=3D55432 password=3Dorishaoku
>> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
>> pg_listener info:
>> Pages: 1
>> Tuples: 1
>>
>> Size Tests
>> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
>>        sl_log_1         0  0.000000
>>        sl_log_2         0  0.000000
>>       sl_seqlog         5 743.000000
>>
>> Listen Path Analysis
>> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D
>> No problems found with sl_listen
>>
>>
>> ------------------------------------------------------------------------=
--------
>> Summary of event info
>>  Origin  Min SYNC  Max SYNC Min SYNC Age Max SYNC Age
>> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D
>>       2   6274244   6274967    -00:59:00    -00:19:00    0
>>       4         1         2    -00:46:00    -00:45:00    0
>>       1        25        27     00:29:00 1 day 23:18:00    0
>>       3        25        26     00:21:00 1 day 23:18:00    0
>>
>>
>> ------------------------------------------------------------------------=
---------
>> Summary of sl_confirm aging
>>    Origin   Receiver   Min SYNC   Max SYNC  Age of latest SYNC  Age of
>> eldest SYNC
>> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D
>>         1          2         25         27     -00:35:00  1 day
>> 22:18:00    0
>>         1          3         27         27      00:21:00      00:21:00  =
  0
>>         1          4          0         27     -00:45:00      00:14:00  =
  0
>>         2          1    6274455    6274967      00:00:00      00:17:00  =
  0
>>         2          3    6274455    6274965      00:00:00      00:17:00  =
  0
>>         2          4          0    6274963     -00:59:00      00:14:00  =
  0
>>         3          1         26         26      00:21:00      00:21:00  =
  0
>>         3          2         25         26     -00:38:00  1 day
>> 22:18:00    0
>>         3          4          0         26     -00:45:00      00:14:00  =
  0
>>         4          1          0          2      00:13:00      00:14:00  =
  0
>>         4          2          0          2     -00:46:00      00:14:00  =
  0
>>         4          3          0          2     -00:45:00      00:14:00  =
  0
>>
>>
>> ------------------------------------------------------------------------=
------
>>
>> Listing of old open connections on node 1
>>        Database             PID            User    Query
>> Age                Query
>> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D
>>
>>
>> Tests for node 4 - DSN =3D dbi:Pg:dbname=3Dticker host=3Dcolo1.denninger=
.net
>> user=3Dslony port=3D55432 password=3Dorishaoku
>> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
>> pg_listener info:
>> Pages: 0
>> Tuples: 0
>>
>> Size Tests
>> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
>>        sl_log_1         0  0.000000
>>        sl_log_2         0  0.000000
>>       sl_seqlog         0  0.000000
>>
>> Listen Path Analysis
>> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D
>> No problems found with sl_listen
>>
>> ------------------------------------------------------------------------=
--------
>> Summary of event info
>>  Origin  Min SYNC  Max SYNC Min SYNC Age Max SYNC Age
>> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D
>>       4         2         2     00:13:00     00:13:00    0
>>       2   6274595   6274967     00:00:00     00:13:00    0
>>
>>
>> ------------------------------------------------------------------------=
---------
>> Summary of sl_confirm aging
>>    Origin   Receiver   Min SYNC   Max SYNC  Age of latest SYNC  Age of
>> eldest SYNC
>> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D
>>         1          2         27         27      00:24:00      00:24:00  =
  0
>>         1          3         27         27      01:21:00      01:21:00  =
  1
>>         1          4         27         27      00:14:00      00:14:00  =
  0
>>         2          1    6274868    6274964      01:00:00      01:03:00  =
  1
>>         2          3    6274870    6274965      01:00:00      01:03:00  =
  1
>>         2          4    6274595    6274967      00:00:00      00:13:00  =
  0
>>         3          1         26         26      01:21:00      01:21:00  =
  1
>>         3          2         26         26      00:21:00      00:21:00  =
  0
>>         3          4         26         26      00:14:00      00:14:00  =
  0
>>         4          1          2          2      00:14:00      00:14:00  =
  0
>>         4          2          2          2      00:13:00      00:13:00  =
  0
>>         4          3          2          2      00:14:00      00:14:00  =
  0
>>
>>
>> ------------------------------------------------------------------------=
------
>>
>> Listing of old open connections on node 4
>>        Database             PID            User    Query
>> Age                Query
>> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D
>>
>>
>> Tests for node 3 - DSN =3D dbi:Pg:dbname=3Dticker host=3Dgenesis.denning=
er.net
>> user=3Dslony port=3D5432 password=3Dorishaoku
>> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
>> pg_listener info:
>> Pages: 1
>> Tuples: 1
>>
>> Size Tests
>> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
>>        sl_log_1         0  0.000000
>>        sl_log_2         0  0.000000
>>       sl_seqlog         8 1113.000000
>>
>> Listen Path Analysis
>> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D
>> No problems found with sl_listen
>>
>> ------------------------------------------------------------------------=
--------
>> Summary of event info
>>  Origin  Min SYNC  Max SYNC Min SYNC Age Max SYNC Age
>> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D
>>       2   6273791   6274967    -00:59:00    -00:03:00    0
>>       1        25        27     00:29:00 1 day 23:18:00    0
>>       4         1         2    -00:46:00    -00:45:00    0
>>       3        25        26     00:21:00 1 day 23:18:00    0
>>
>>
>> ------------------------------------------------------------------------=
---------
>> Summary of sl_confirm aging
>>    Origin   Receiver   Min SYNC   Max SYNC  Age of latest SYNC  Age of
>> eldest SYNC
>> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D
>>         1          2         25         27     -00:35:00  1 day
>> 22:18:00    0
>>         1          3         27         27      00:21:00      00:21:00  =
  0
>>         1          4          0         27     -00:45:00      00:14:00  =
  0
>>         2          1    6274662    6274964      00:00:00      00:10:00  =
  0
>>         2          3    6274665    6274967      00:00:00      00:10:00  =
  0
>>         2          4          0    6274963     -00:59:00      00:14:00  =
  0
>>         3          1         26         26      00:21:00      00:21:00  =
  0
>>         3          2         25         26     -00:38:00  1 day
>> 22:18:00    0
>>         3          4          0         26     -00:45:00      00:14:00  =
  0
>>         4          1          0          2     -00:45:00      00:14:00  =
  0
>>         4          2          0          2     -00:46:00      00:14:00  =
  0
>>         4          3          2          2      00:13:00      00:13:00  =
  0
>>
>>
>> ------------------------------------------------------------------------=
------
>>
>> Listing of old open connections on node 3
>>        Database             PID            User    Query
>> Age                Query
>> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D
>>
>>
>> Tests for node 2 - DSN =3D dbi:Pg:dbname=3Dticker host=3Dcolo1.denninger=
.net
>> user=3Dslony port=3D5432 password=3Dorishaoku
>> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
>> pg_listener info:
>> Pages: 1
>> Tuples: 1
>>
>> Size Tests
>> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
>>        sl_log_1       334 9884.000000
>>        sl_log_2         0  0.000000
>>       sl_seqlog         4 173.000000
>>
>> Listen Path Analysis
>> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D
>> No problems found with sl_listen
>>
>> ------------------------------------------------------------------------=
--------
>> Summary of event info
>>  Origin  Min SYNC  Max SYNC Min SYNC Age Max SYNC Age
>> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D
>>       2   6274650   6274968     00:00:00     00:10:00    0
>>       4         2         2     00:13:00     00:13:00    0
>>       1        27        27     01:29:00     01:29:00    1
>>       3        26        26     01:21:00     01:21:00    1
>>
>>
>> ------------------------------------------------------------------------=
---------
>> Summary of sl_confirm aging
>>    Origin   Receiver   Min SYNC   Max SYNC  Age of latest SYNC  Age of
>> eldest SYNC
>> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D
>>         1          2         27         27      00:24:00      00:24:00  =
  0
>>         1          3         27         27      01:21:00      01:21:00  =
  1
>>         1          4         27         27      00:14:00      00:14:00  =
  0
>>         2          1    6274948    6274964      01:00:00      01:00:00  =
  1
>>         2          3    6274945    6274965      01:00:00      01:00:00  =
  1
>>         2          4    6274650    6274963      00:00:00      00:10:00  =
  0
>>         3          1         26         26      01:21:00      01:21:00  =
  1
>>         3          2         26         26      00:21:00      00:21:00  =
  0
>>         3          4         26         26      00:14:00      00:14:00  =
  0
>>         4          1          2          2      01:13:00      01:13:00  =
  1
>>         4          2          2          2      00:13:00      00:13:00  =
  0
>>         4          3          2          2      01:13:00      01:13:00  =
  1
>>
>>
>> ------------------------------------------------------------------------=
------
>>
>> Listing of old open connections on node 2
>>        Database             PID            User    Query
>> Age                Query
>> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D
>>
>>
>> This looks ok - nothing that appears hung, but no replication starts.....
>>
>> What am I doing wrong here?  This same set of setup files (with the
>> appropriate names) worked to add the third node...
>>
>> -- Karl
>>
>>
>>   =

>> _______________________________________________
>> Slony1-general mailing list
>> Slony1-general@lists.slony.info
>> http://lists.slony.info/mailman/listinfo/slony1-general
>>   =

>>     =

> Following up on this, I did a "DROP NODE" with the slons running, then
> re-ran the config scripts.  Now I'm getting this - the same thing I was
> getting last night:
>
> Aug 22 00:04:11 tickerforum slon[66032]: [129-1] INFO   copy_set 1
> Aug 22 00:04:11 tickerforum slon[66032]: [130-1] CONFIG version for
> "dbname=3Dticker host=3Dcolo1.denninger.net user=3Dslony port=3D5432
> password=3Dxxxxx" is 80306
> Aug 22 00:04:11 tickerforum slon[66032]: [131-1] CONFIG
> remoteWorkerThread_2: connected to provider DB
> Aug 22 00:04:11 tickerforum slon[66032]: [132-1] CONFIG
> remoteWorkerThread_2: prepare to copy table "public"."banned_ip"
> Aug 22 00:04:11 tickerforum slon[66032]: [133-1] ERROR =

> remoteWorkerThread_2: Could not lock table "public"."banned_ip" on
> subscriber
> Aug 22 00:04:11 tickerforum slon[66032]: [134-1] WARN  =

> remoteWorkerThread_2: data copy for set 1 failed - sleep 60 seconds
>
> And then this repeats every 60 seconds.
>
> This is the lock error I was seeing before; I don't get it.....
>
>   =

Karl, when you dropped the node did you drop the slony schema as well on
node 4?  DROP NODE doesn't do an UNINSTALL NODE.  What does psql show
for '\d banned_ip' in the node 4 DB?


-- =

Jeff Frost <jeff@pgexperts.com>
COO, PostgreSQL Experts, Inc.
Phone: 1-888-PG-EXPRT x506
http://www.pgexperts.com/ =


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090821/=
0f54e270/attachment-0001.htm
From damien at dalibo.info  Sat Aug 22 00:43:58 2009
From: damien at dalibo.info (damien clochard)
Date: Sat Aug 22 00:44:42 2009
Subject: [Slony1-general] Still can't checkout Slony1-www repository
In-Reply-To: <49ABA21E.5040404@dalibo.info>
References: <49ABA21E.5040404@dalibo.info>
Message-ID: <4A8FA1BE.2050803@dalibo.info>

Hi !

As i said 6 months ago, it is impossible to checkout the slony's website
CVS :

$ export CVSROOT=":pserver:anonymous@main.slony.info:/slony1"
$ cvs co slony1-www/
cvs checkout: Updating slony1-www
cvs checkout: failed to create lock directory for `/slony1/slony1-www'
(/slony1/slony1-www/#cvs.lock): Permission denied
cvs checkout: failed to obtain dir lock in repository `/slony1/slony1-www'
cvs [checkout aborted]: read lock failed - giving up


Am i doing something wrong ? Is there a reason for not giving public
access to this repository ? Maybe the CVS is not used anymore ? If this
is a problem, what can i do to help ?


Anyway we're currently preparing to release the french translation of
the slony documentation. We want to publish this on a specific website (
www.slony.fr ). From our perspective the best thing to do is to
translate the current website. Maintaining a translation without CVS
access is long and painful. That's why we'd like to have the ability to
check-out slony1-www repository.



-- 
damien
From jeff at pgexperts.com  Sat Aug 22 08:59:41 2009
From: jeff at pgexperts.com (Jeff Frost)
Date: Sat Aug 22 09:00:00 2009
Subject: [Slony1-general] Still can't checkout Slony1-www repository
In-Reply-To: <4A8FA1BE.2050803@dalibo.info>
References: <49ABA21E.5040404@dalibo.info> <4A8FA1BE.2050803@dalibo.info>
Message-ID: <4A9015ED.50302@pgexperts.com>

damien clochard wrote:
> Hi !
>
> As i said 6 months ago, it is impossible to checkout the slony's website
> CVS :
>
> $ export CVSROOT=":pserver:anonymous@main.slony.info:/slony1"
> $ cvs co slony1-www/
> cvs checkout: Updating slony1-www
> cvs checkout: failed to create lock directory for `/slony1/slony1-www'
> (/slony1/slony1-www/#cvs.lock): Permission denied
> cvs checkout: failed to obtain dir lock in repository `/slony1/slony1-www'
> cvs [checkout aborted]: read lock failed - giving up
>
>
> Am i doing something wrong ? Is there a reason for not giving public
> access to this repository ? Maybe the CVS is not used anymore ? If this
> is a problem, what can i do to help ?
>   
Looks like you forgot to "cvs login".  Just do it like so:

CVSROOT=":pserver:anonymous@main.slony.info:/slony1" cvs login
CVSROOT=":pserver:anonymous@main.slony.info:/slony1" cvs co slony1-engine




-- 
Jeff Frost <jeff@pgexperts.com>
COO, PostgreSQL Experts, Inc.
Phone: 1-888-PG-EXPRT x506
http://www.pgexperts.com/ 

From karl at denninger.net  Sat Aug 22 10:02:50 2009
From: karl at denninger.net (Karl Denninger)
Date: Sat Aug 22 10:04:19 2009
Subject: [Slony1-general] More on 8.4 .vs. Slony 2.0.2
In-Reply-To: <4A8F7ED9.2050908@pgexperts.com>
References: <4A8F6CC8.1040500@denninger.net> <4A8F6ECD.60206@denninger.net>
	<4A8F7ED9.2050908@pgexperts.com>
Message-ID: <4A9024BA.6070200@denninger.net>

Skipped content of type multipart/alternative-------------- next part -----=
---------
A non-text attachment was scrubbed...
Name: karl.vcf
Type: text/x-vcard
Size: 265 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20090822=
/bce20ec1/karl.vcf
From damien at dalibo.info  Sat Aug 22 10:29:31 2009
From: damien at dalibo.info (damien clochard)
Date: Sat Aug 22 10:29:58 2009
Subject: [Slony1-general] Still can't checkout Slony1-www repository
In-Reply-To: <4A9015ED.50302@pgexperts.com>
References: <49ABA21E.5040404@dalibo.info> <4A8FA1BE.2050803@dalibo.info>
	<4A9015ED.50302@pgexperts.com>
Message-ID: <4A902AFB.3040406@dalibo.info>

Jeff Frost a ?crit :
> damien clochard wrote:
>> Hi !
>>
>> As i said 6 months ago, it is impossible to checkout the slony's website
>> CVS :
>>
>> $ export CVSROOT=":pserver:anonymous@main.slony.info:/slony1"
>> $ cvs co slony1-www/
>> cvs checkout: Updating slony1-www
>> cvs checkout: failed to create lock directory for `/slony1/slony1-www'
>> (/slony1/slony1-www/#cvs.lock): Permission denied
>> cvs checkout: failed to obtain dir lock in repository `/slony1/slony1-www'
>> cvs [checkout aborted]: read lock failed - giving up
>>
>>
>> Am i doing something wrong ? Is there a reason for not giving public
>> access to this repository ? Maybe the CVS is not used anymore ? If this
>> is a problem, what can i do to help ?
>>   
> Looks like you forgot to "cvs login".  Just do it like so:
> 
> CVSROOT=":pserver:anonymous@main.slony.info:/slony1" cvs login
> CVSROOT=":pserver:anonymous@main.slony.info:/slony1" cvs co slony1-engine
> 

I did the cvs login and pressed [Enter] when i was prompted for password.

It works fine for the slony1-engine repository but it fails for the
slony1-www repository.

From jeff at pgexperts.com  Sat Aug 22 10:44:22 2009
From: jeff at pgexperts.com (Jeff Frost)
Date: Sat Aug 22 10:44:44 2009
Subject: [Slony1-general] Still can't checkout Slony1-www repository
In-Reply-To: <4A902AFB.3040406@dalibo.info>
References: <49ABA21E.5040404@dalibo.info> <4A8FA1BE.2050803@dalibo.info>
	<4A9015ED.50302@pgexperts.com> <4A902AFB.3040406@dalibo.info>
Message-ID: <4A902E76.10303@pgexperts.com>

damien clochard wrote:
> Jeff Frost a =E9crit :
>   =

>> damien clochard wrote:
>>     =

>>> Hi !
>>>
>>> As i said 6 months ago, it is impossible to checkout the slony's website
>>> CVS :
>>>
>>> $ export CVSROOT=3D":pserver:anonymous@main.slony.info:/slony1"
>>> $ cvs co slony1-www/
>>> cvs checkout: Updating slony1-www
>>> cvs checkout: failed to create lock directory for `/slony1/slony1-www'
>>> (/slony1/slony1-www/#cvs.lock): Permission denied
>>> cvs checkout: failed to obtain dir lock in repository `/slony1/slony1-w=
ww'
>>> cvs [checkout aborted]: read lock failed - giving up
>>>
>>>
>>> Am i doing something wrong ? Is there a reason for not giving public
>>> access to this repository ? Maybe the CVS is not used anymore ? If this
>>> is a problem, what can i do to help ?
>>>   =

>>>       =

>> Looks like you forgot to "cvs login".  Just do it like so:
>>
>> CVSROOT=3D":pserver:anonymous@main.slony.info:/slony1" cvs login
>> CVSROOT=3D":pserver:anonymous@main.slony.info:/slony1" cvs co slony1-eng=
ine
>>
>>     =

>
> I did the cvs login and pressed [Enter] when i was prompted for password.
>
> It works fine for the slony1-engine repository but it fails for the
> slony1-www repository.
>
>   =

Ah!  I'm sorry, I misread your original post that indicated slony1-www.
:-(  The slony1-www fails for me in the same way.  I'm going to guess
that the anonymous user doesn't have write access to that directory and
not too many people check out the slony1-www repo as anonymous so it
hasn't been noticed until now.  Hopefully one of the admins can fix that.


-- =

Jeff Frost <jeff@pgexperts.com>
COO, PostgreSQL Experts, Inc.
Phone: 1-888-PG-EXPRT x506
http://www.pgexperts.com/ =


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090822/=
cc59f0e8/attachment.htm
From karl at denninger.net  Sat Aug 22 21:53:51 2009
From: karl at denninger.net (Karl Denninger)
Date: Sat Aug 22 21:55:45 2009
Subject: [Slony1-general] Ugh - New Issue with using Slony to upgrade
	Postgresql
Message-ID: <4A90CB5F.8060100@denninger.net>

Here's what I attempted:

1. Set up new version of Postgresql (in this case, 8.4) against a
running 8.3 release.

2. Add the new database engine as a client of the old on a different
port (in this case, 55432.)  This worked, and the databases replicated.

3. Shut down the client software and wait for the syncs to propagate.

4. Move the origin node from 2 (the old master) to 4 (the new master)
with a "lock set (id=3D1 ....)" and then a "move set (id=3D1, old origin=3D=
2,
new origin =3D 4);.  This executed properly; a quick check showed that
Node 2 no longer had write access, but node 4 did.

5. Shut down both the old and new Postgres copies, rename the
directories, and restart node 4 as the master and 2 as the slave (swap
their ports in the postgresql.conf file)

Ok, so now we're good to go.  Well, kinda.

Node 4 came up fine as athe master.

But on the other clients slony instantly pitches a fit and claims that
the ID of the master is incorrect (which is, by the way, correct - the
connection now points to node 4 instead of node 2.)  I thought I could
get around this with a pair of "store path" statements to change the
node Ids for each client doing this:

include <slonik.preamble>;
store path (server=3D1, client=3D4, conninfo=3D'dbname=3Dticker
host=3Dgenesis.denninger.net user=3Dslony port=3D55432 password=3Dxxxxx');
store path (server=3D 4, client=3D1, conninfo=3D'dbname=3Dticker
host=3Dcolo1.denninger.net user=3Dslony port=3D5432 password=3Dxxxxx');

That logs a bunch of messages for provider configuration updates in the
syslog as expected when it is executed.  The slonik.preamble contains:

CLUSTER NAME =3D tickerforum;
node 4 admin conninfo=3D'dbname=3Dticker host=3Dcolo1.denninger.net user=3D=
slony
password=3Dxxxx port=3D5432';
node 1 admin conninfo=3D'dbname=3Dticker host=3Dlocalhost user=3Dslony port=
=3D5432
password=3Dxxxx';

(The divergence between the path stored into the dbms and the admin info
is due to the fact that the OTHER nodes "See" this machine - node 1 -
through a firewall that redirects ports, but to connect locally on this
machine I can't "bounce" off from the inside.  This is "good" and has
worked to set it up and replicate....)

No dice; I get lots of these:

Aug 22 23:40:08 dbms slon[25559]: [1830-1] CONFIG version for
"dbname=3Dticker host=3Dcolo1.denninger.net user=3Dslony port=3D5432
password=3Dxxxx" is 80400
Aug 22 23:40:08 dbms slon[25559]: [1831-1] ERROR  remoteListenThread_2:
db_getLocalNodeId() returned 4 - wrong database?
Aug 22 23:40:19 dbms slon[25559]: [1832-1] CONFIG version for
"dbname=3Dticker host=3Dcolo1.denninger.net user=3Dslony port=3D5432
password=3Dxxxx" is 80400
Aug 22 23:40:19 dbms slon[25559]: [1833-1] ERROR  remoteListenThread_2:
db_getLocalNodeId() returned 4 - wrong database?

Over and over again....

It looks like the path statement was ignored and attempting to update it
does nothing.

The only way I was able to get replication going again was to drop the
node.  That, however, while it executed, did not clear the schema (!)
nor did it stop the slon process from trying to connect; I had to go in
and drop the slony schema from each database, then re-add the node to
the replication set.  This worked, BUT it also forced a copy of the
entire freaking database!

I'm wondering what happened here.  It is almost as if the "move set"
never executed on the other subscribers - an impossibility, no?  They
WERE all replicating and current just before the shutdown - I checked
them all.  How does that happen under these circumstances?

Is there a better way for the future?  I'm back up now, but the entire
point of this exercise was to AVOID having to copy the entire database
over - while I avoided any material downtime for my users, I was left
EXPOSED to a failure for the copy period, which was kinda nasty.

Thoughts appreciated.

-- Karl
-------------- next part --------------
A non-text attachment was scrubbed...
Name: karl.vcf
Type: text/x-vcard
Size: 265 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20090822=
/7d76fc15/karl.vcf
From jeff at pgexperts.com  Sat Aug 22 23:00:53 2009
From: jeff at pgexperts.com (Jeff Frost)
Date: Sat Aug 22 23:01:36 2009
Subject: [Slony1-general] Ugh - New Issue with using Slony to upgrade
	Postgresql
In-Reply-To: <4A90CB5F.8060100@denninger.net>
References: <4A90CB5F.8060100@denninger.net>
Message-ID: <4A90DB15.3050602@pgexperts.com>

Karl Denninger wrote:
> But on the other clients slony instantly pitches a fit and claims that
> the ID of the master is incorrect (which is, by the way, correct - the
> connection now points to node 4 instead of node 2.)  I thought I could
> get around this with a pair of "store path" statements to change the
> node Ids for each client doing this:
>
>   
That's because they're still connecting with the previous conninfo but
you figured that out later.
> include <slonik.preamble>;
> store path (server=1, client=4, conninfo='dbname=ticker
> host=genesis.denninger.net user=slony port=55432 password=xxxxx');
> store path (server= 4, client=1, conninfo='dbname=ticker
> host=colo1.denninger.net user=slony port=5432 password=xxxxx');
>
> That logs a bunch of messages for provider configuration updates in the
> syslog as expected when it is executed.  The slonik.preamble contains:
>
> CLUSTER NAME = tickerforum;
> node 4 admin conninfo='dbname=ticker host=colo1.denninger.net user=slony
> password=xxxx port=5432';
> node 1 admin conninfo='dbname=ticker host=localhost user=slony port=5432
> password=xxxx';
>
> (The divergence between the path stored into the dbms and the admin info
> is due to the fact that the OTHER nodes "See" this machine - node 1 -
> through a firewall that redirects ports, but to connect locally on this
> machine I can't "bounce" off from the inside.  This is "good" and has
> worked to set it up and replicate....)
>
> No dice; I get lots of these:
>
> Aug 22 23:40:08 dbms slon[25559]: [1830-1] CONFIG version for
> "dbname=ticker host=colo1.denninger.net user=slony port=5432
> password=xxxx" is 80400
> Aug 22 23:40:08 dbms slon[25559]: [1831-1] ERROR  remoteListenThread_2:
> db_getLocalNodeId() returned 4 - wrong database?
> Aug 22 23:40:19 dbms slon[25559]: [1832-1] CONFIG version for
> "dbname=ticker host=colo1.denninger.net user=slony port=5432
> password=xxxx" is 80400
> Aug 22 23:40:19 dbms slon[25559]: [1833-1] ERROR  remoteListenThread_2:
> db_getLocalNodeId() returned 4 - wrong database?
>
> Over and over again....
>
> It looks like the path statement was ignored and attempting to update it
> does nothing.
>   
That's because they aren't talking to the master anymore, so they never
get the command.
> The only way I was able to get replication going again was to drop the
> node.  That, however, while it executed, did not clear the schema (!)
> nor did it stop the slon process from trying to connect; I had to go in
> and drop the slony schema from each database, then re-add the node to
> the replication set.  This worked, BUT it also forced a copy of the
> entire freaking database!
>   
drop node doesn't uninstall the slony schema - it only removes it from
the slony schema on the master node.  The 'uninstall node' command
actually connects to the node and removes the slony schema.  Also, after
the node has been dropped, slony doesn't save any information about the
dropped node so when you add it again, it forces a full sync. 
> I'm wondering what happened here.  It is almost as if the "move set"
> never executed on the other subscribers - an impossibility, no?  They
> WERE all replicating and current just before the shutdown - I checked
> them all.  How does that happen under these circumstances?
>
> Is there a better way for the future?  I'm back up now, but the entire
> point of this exercise was to AVOID having to copy the entire database
> over - while I avoided any material downtime for my users, I was left
> EXPOSED to a failure for the copy period, which was kinda nasty.
>
> Thoughts appreciated.
>
>   

Probably the way to avoid it would have been to issue the store path
changes before switching the ports.  But, if you forget to do it in the
future, you can fix it afterwards by going bare metal and updating the
paths in the _tickerform.sl_path table on the nodes that don't have the
correct information.

-- 
Jeff Frost <jeff@pgexperts.com>
COO, PostgreSQL Experts, Inc.
Phone: 1-888-PG-EXPRT x506
http://www.pgexperts.com/ 

From karl at denninger.net  Sun Aug 23 14:59:01 2009
From: karl at denninger.net (Karl Denninger)
Date: Sun Aug 23 15:00:52 2009
Subject: [Slony1-general] Ugh - New Issue with using Slony to upgrade
	Postgresql
In-Reply-To: <4A90DB15.3050602@pgexperts.com>
References: <4A90CB5F.8060100@denninger.net> <4A90DB15.3050602@pgexperts.com>
Message-ID: <4A91BBA5.1000001@denninger.net>

Skipped content of type multipart/alternative-------------- next part -----=
---------
A non-text attachment was scrubbed...
Name: karl.vcf
Type: text/x-vcard
Size: 265 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20090823=
/6eae644e/karl.vcf
From nettreeinc at gmail.com  Sun Aug 23 22:59:13 2009
From: nettreeinc at gmail.com (roctaiwan)
Date: Sun Aug 23 22:59:59 2009
Subject: [Slony1-general] How does it work if has different sets on
	different nodes?
In-Reply-To: <20090820162918.GN6466@shinkuro.com>
References: <25056529.post@talk.nabble.com>
	<20090820162918.GN6466@shinkuro.com>
Message-ID: <25110900.post@talk.nabble.com>


Hi Andrew,

If I understand the slony replication correct, is that after I do switchover
or failover what it can do is promote another node to replace its origin
node. If lets say failover, after origin node failed and another node
replaced it, all other slave nodes in group will seek for sets from new
master, basically failover script will change the "provider" from subscribe
set command to the new master node. Therefore, new master should first sync
with old master with all the data and having all sets isn't it? 

Let's say Old master(node 1) has five tables (table 1,2,3,4,5) and new
master (node 2) has only (table 1 and 2). After switch over or failover to
the new master (node 2), will node 2 sync with old master and has all 5
tables? 

What if I do switch back to Node 1 from Node 2, now will both node 1 and 2
has all 5 tables on itself? 

This really needs to get clear first. Has someone tested this and know how
it works?


Andrew Sullivan-8 wrote:
> 
> No, I don't believe this is right, assuming I understand you.
> Switchover works on sets, so you will effectively make node 2 the
> origin for sets 1 and 2, but sets 3-5 will remain origined on node 1.
> 
> The key thing here to get is that Slony has no real notion of "all
> nodes" involved in replication from one node to another.  It's just
> not interested in that.  At the basic level, it is set-oriented.  So
> the sets are nodes involved in replicating that set.  You can (could?)
> conveniently work on supersets using external tools, but Slony doesn't
> itself care about that.
> 
> You raise an interesting point about the documentation, however, which
> is that it doesn't make clear that the new origin (in the case of MOVE
> SET) has to be actually subscribed before moving to it.  This is
> similarly unclear in the FAILOVER command, although I suppose in that
> case it ought to be obvious that if you're not already subscribed,
> failing over to such a node is doomed.
> 
> A
> -- 
> Andrew Sullivan
> ajs@crankycanuck.ca
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
> 
> 

-- 
View this message in context: http://www.nabble.com/How-exactly-replication-works-for-different-sets-on-different-nodes--tp25056529p25110900.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.

From VooDooNet38 at free.fr  Sun Aug 23 23:50:11 2009
From: VooDooNet38 at free.fr (VooDoo)
Date: Sun Aug 23 23:51:02 2009
Subject: [Slony1-general] How To Install on w2k3 servers
Message-ID: <002301ca2487$20a8d1c0$1f0aa8c0@stepaneurope.com>

Hello,
Does someones has a guideline on how to install Slony on a windows 2003 
 servers running PgSQL 8.4?
 On had any experience on this?
 
Thanks
 VooDoo

From VooDooNet38 at free.fr  Sun Aug 23 23:51:07 2009
From: VooDooNet38 at free.fr (VooDoo)
Date: Sun Aug 23 23:51:55 2009
Subject: [Slony1-general] Install on w2k3 servers
References: <002301ca2487$20a8d1c0$1f0aa8c0@stepaneurope.com>
Message-ID: <003401ca2487$41f91bf0$1f0aa8c0@stepaneurope.com>

Hello All,
I am new to slony, and I am trying to install Slony 2.02 for PgSQL8.4
I have register the dll correctly, but get this 1057 error when trying to 
register the service on a 2003 server.

Does anyone has a fix for this?
Is this the correct way to proceed???

Thanks
Voodooo
From lawrencew00 at hotmail.com  Mon Aug 24 00:11:40 2009
From: lawrencew00 at hotmail.com (Lawrence Wong)
Date: Mon Aug 24 00:12:29 2009
Subject: [Slony1-general] Install on w2k3 servers
In-Reply-To: <003401ca2487$41f91bf0$1f0aa8c0@stepaneurope.com>
References: <002301ca2487$20a8d1c0$1f0aa8c0@stepaneurope.com>
	<003401ca2487$41f91bf0$1f0aa8c0@stepaneurope.com>
Message-ID: <SNT101-W245DD9B832DE94025A3D4CBDF90@phx.gbl>


Hi,
You can try opening a command prompt and typing:
'sc
create Slony-I binPath=3D =93C:\Program Files\PostgreSQL\8.4\bin\slon.exe =
=96service=94
depend=3D =93RPCSS=94'
Note: the binpath to whatever the path to
slon.exe is

Note: Make sure there is a space between the
equals signs and the double quotes.Note: There is a space between =91slon.e=
xe=92 and
=91-service=92

Note: After you have registered the service you
will probably need to restart the server.  Note: obviously do this command =
without the single quotes
If you want to delete the service it is:
'sc delete Slony-I'.  =

Try that out and let me know how it goes.  =

LW . . . Lawrence
> From: VooDooNet38@free.fr
> To: slony1-general@lists.slony.info
> Subject: [Slony1-general] Install on w2k3 servers
> Date: Mon, 24 Aug 2009 08:51:07 +0200
> =

> Hello All,
> I am new to slony, and I am trying to install Slony 2.02 for PgSQL8.4
> I have register the dll correctly, but get this 1057 error when trying to =

> register the service on a 2003 server.
> =

> Does anyone has a fix for this?
> Is this the correct way to proceed???
> =

> Thanks
> Voodooo
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general

_________________________________________________________________
Attention all humans. We are your photos. Free us.
http://go.microsoft.com/?linkid=3D9666047
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090824/=
63153f2b/attachment.htm
From nettreeinc at gmail.com  Mon Aug 24 00:53:18 2009
From: nettreeinc at gmail.com (roctaiwan)
Date: Mon Aug 24 00:54:09 2009
Subject: [Slony1-general] Why my postgresql.conf doesn't contain......
Message-ID: <25111938.post@talk.nabble.com>


>From Postgres docunment chapter 24 Monitoring Database Activity, the ch
24.2.1. Statistics Collection Configuration talks about few configuration
setting that I can enable it to monitoring(shown below):

"The parameter stats_start_collector must be set to true for the statistics
collector to be launched at all. This is the default and recommended
setting, but it may be turned off if you have no interest in statistics and
want to squeeze out every last drop of overhead. (The savings is likely to
be small, however.) Note that this option cannot be changed while the server
is running. 

The parameters stats_command_string, stats_block_level, and stats_row_level
control how much information is actually sent to the collector and thus
determine how much run-time overhead occurs."


But why I don't have any of these configurable parameters in my config
file?? I have attached my config file within. 
http://www.nabble.com/file/p25111938/postgresql.conf postgresql.conf 
-- 
View this message in context: http://www.nabble.com/Why-my-postgresql.conf-doesn%27t-contain......-tp25111938p25111938.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.

From devrim at gunduz.org  Mon Aug 24 02:21:33 2009
From: devrim at gunduz.org (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Mon Aug 24 02:23:05 2009
Subject: [Slony1-general] Why my postgresql.conf doesn't contain......
In-Reply-To: <25111938.post@talk.nabble.com>
References: <25111938.post@talk.nabble.com>
Message-ID: <1251105693.10597.3.camel@hp-laptop2.gunduz.org>

T24gTW9uLCAyMDA5LTA4LTI0IGF0IDAwOjUzIC0wNzAwLCByb2N0YWl3YW4gd3JvdGU6Cj4gQnV0
IHdoeSBJIGRvbid0IGhhdmUgYW55IG9mIHRoZXNlIGNvbmZpZ3VyYWJsZSBwYXJhbWV0ZXJzIGlu
IG15IGNvbmZpZwo+IGZpbGU/CgpXaGljaCBQb3N0Z3JlU1FMIHZlcnNpb24gYXJlIHlvdSB1c2lu
Zz8gOykKCi0tIApEZXZyaW0gR8OcTkTDnFosIFJIQ0UKQ29tbWFuZCBQcm9tcHQgLSBodHRwOi8v
d3d3LkNvbW1hbmRQcm9tcHQuY29tIApkZXZyaW1+Z3VuZHV6Lm9yZywgZGV2cmltflBvc3RncmVT
UUwub3JnLCBkZXZyaW0uZ3VuZHV6fmxpbnV4Lm9yZy50cgogICAgICAgICAgICAgICAgICAgaHR0
cDovL3d3dy5ndW5kdXoub3JnCi0tLS0tLS0tLS0tLS0tIG5leHQgcGFydCAtLS0tLS0tLS0tLS0t
LQpBIG5vbi10ZXh0IGF0dGFjaG1lbnQgd2FzIHNjcnViYmVkLi4uCk5hbWU6IG5vdCBhdmFpbGFi
bGUKVHlwZTogYXBwbGljYXRpb24vcGdwLXNpZ25hdHVyZQpTaXplOiAxOTcgYnl0ZXMKRGVzYzog
VGhpcyBpcyBhIGRpZ2l0YWxseSBzaWduZWQgbWVzc2FnZSBwYXJ0ClVybCA6IGh0dHA6Ly9saXN0
cy5zbG9ueS5pbmZvL3BpcGVybWFpbC9zbG9ueTEtZ2VuZXJhbC9hdHRhY2htZW50cy8yMDA5MDgy
NC84NzcwYzg4YS9hdHRhY2htZW50LnBncAo=
From VooDooNet38 at free.fr  Mon Aug 24 02:36:24 2009
From: VooDooNet38 at free.fr (VooDoo)
Date: Mon Aug 24 02:37:20 2009
Subject: [Slony1-general] Install on w2k3 servers
References: <002301ca2487$20a8d1c0$1f0aa8c0@stepaneurope.com>
	<003401ca2487$41f91bf0$1f0aa8c0@stepaneurope.com>
	<SNT101-W245DD9B832DE94025A3D4CBDF90@phx.gbl>
Message-ID: <004001ca249e$5890ae70$1f0aa8c0@stepaneurope.com>

Thanks Lawrence, this worked!
but when I try to create a cluster with the GUI, its says that creation scr=
ipts are not available, only attachment is available...
Services have been restarted, and both are running correctly...
  ----- Original Message ----- =

  From: Lawrence Wong =

  To: voodoonet38@free.fr ; slony1-general@lists.slony.info =

  Sent: Monday, August 24, 2009 9:11 AM
  Subject: RE: [Slony1-general] Install on w2k3 servers


  Hi,


  You can try opening a command prompt and typing:


  'sc create Slony-I binPath=3D =93C:\Program Files\PostgreSQL\8.4\bin\slon=
.exe =96service=94 depend=3D =93RPCSS=94'


  Note: the binpath to whatever the path to slon.exe is

  Note: Make sure there is a space between the equals signs and the double =
quotes.

  Note: There is a space between =91slon.exe=92 and =91-service=92

  Note: After you have registered the service you will probably need to res=
tart the server.  =


  Note: obviously do this command without the single quotes




  If you want to delete the service it is:




  'sc delete Slony-I'.  =





  Try that out and let me know how it goes.  =





  LW . . . Lawrence


  > From: VooDooNet38@free.fr
  > To: slony1-general@lists.slony.info
  > Subject: [Slony1-general] Install on w2k3 servers
  > Date: Mon, 24 Aug 2009 08:51:07 +0200
  > =

  > Hello All,
  > I am new to slony, and I am trying to install Slony 2.02 for PgSQL8.4
  > I have register the dll correctly, but get this 1057 error when trying =
to =

  > register the service on a 2003 server.
  > =

  > Does anyone has a fix for this?
  > Is this the correct way to proceed???
  > =

  > Thanks
  > Voodooo
  > _______________________________________________
  > Slony1-general mailing list
  > Slony1-general@lists.slony.info
  > http://lists.slony.info/mailman/listinfo/slony1-general



---------------------------------------------------------------------------=
---
  Attention all humans. We are your photos. Free us. =

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090824/=
275700e9/attachment.htm
From lawrencew00 at hotmail.com  Mon Aug 24 06:04:21 2009
From: lawrencew00 at hotmail.com (Lawrence Wong)
Date: Mon Aug 24 06:04:28 2009
Subject: [Slony1-general] Install on w2k3 servers
In-Reply-To: <004001ca249e$5890ae70$1f0aa8c0@stepaneurope.com>
References: <002301ca2487$20a8d1c0$1f0aa8c0@stepaneurope.com>
	<003401ca2487$41f91bf0$1f0aa8c0@stepaneurope.com>
	<SNT101-W245DD9B832DE94025A3D4CBDF90@phx.gbl>
	<004001ca249e$5890ae70$1f0aa8c0@stepaneurope.com>
Message-ID: <SNT101-W62409B4E88578873EDEDE5BDF90@phx.gbl>


hmmmm.  Can't really help you there.  I used slonik scripts.  It's not that=
 hard, there are many tutorials online for that.  There trickier part was o=
f course installing slony as a service on win2k3.  =

From: VooDooNet38@free.fr
To: lawrencew00@hotmail.com; slony1-general@lists.slony.info
Subject: Re: [Slony1-general] Install on w2k3 servers
Date: Mon, 24 Aug 2009 11:36:24 +0200










Thanks Lawrence, this worked!
but when I try to create a cluster with the GUI, its says =

that creation scripts are not available, only attachment is =

available...
Services have been restarted, and both are running =

correctly...

  ----- Original Message ----- =

  From: =

  Lawrence Wong =

  To: voodoonet38@free.fr ; slony1-general@lists.slony.info =

  =

  Sent: Monday, August 24, 2009 9:11 =

  AM
  Subject: RE: [Slony1-general] Install on =

  w2k3 servers
  =

Hi,
  =


  You can try opening a command prompt and typing:
  =


  'sc =

  create Slony-I binPath=3D =93C:\Program Files\PostgreSQL\8.4\bin\slon.exe =

  =96service=94 depend=3D =93RPCSS=94'
  =


  =

  Note: =

  the binpath to whatever the path to slon.exe is
  Note: =

  Make sure there is a space between the equals signs and the double quotes.
  Note: =

  There is a space between =91slon.exe=92 and =91-service=92
  Note: =

  After you have registered the service you will probably need to restart t=
he =

  server.  =

  Note: =

  obviously do this command without the single quotes
  =


  If =

  you want to delete the service it is:
  =


  'sc =

  delete Slony-I'.  =

  =


  Try =

  that out and let me know how it goes.  =

  =


  LW =

  . . . Lawrence
  =

> From: VooDooNet38@free.fr
> To: =

  slony1-general@lists.slony.info
> Subject: [Slony1-general] Install on =

  w2k3 servers
> Date: Mon, 24 Aug 2009 08:51:07 +0200
> =

> =

  Hello All,
> I am new to slony, and I am trying to install Slony 2.02 =

  for PgSQL8.4
> I have register the dll correctly, but get this 1057 =

  error when trying to =

> register the service on a 2003 server.
> =

  =

> Does anyone has a fix for this?
> Is this the correct way to =

  proceed???
> =

> Thanks
> Voodooo
> =

  _______________________________________________
> Slony1-general mailing =

  list
> Slony1-general@lists.slony.info
> =

  http://lists.slony.info/mailman/listinfo/slony1-general


  =

  Attention all humans. We are your photos. Free us. =


_________________________________________________________________
Attention all humans. We are your photos. Free us.
http://go.microsoft.com/?linkid=3D9666047
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090824/=
cbad8639/attachment.htm
From jeff at pgexperts.com  Mon Aug 24 06:49:37 2009
From: jeff at pgexperts.com (Jeff Frost)
Date: Mon Aug 24 06:49:53 2009
Subject: [Slony1-general] Ugh - New Issue with using Slony to upgrade
	Postgresql
In-Reply-To: <4A91BBA5.1000001@denninger.net>
References: <4A90CB5F.8060100@denninger.net> <4A90DB15.3050602@pgexperts.com>
	<4A91BBA5.1000001@denninger.net>
Message-ID: <4A929A71.9050208@pgexperts.com>

Karl Denninger wrote:
>>   =

> But they should have switched the master to Node #4 when the move set
> command was executed.  When they reconnect they should be doing so to
> Node #2, not Node #2 - IF they saw the "move set" command (and it
> appears they did.)
>
> Further, I ran the change in the paths on that node - that is, locally
> to that machine.  No difference.
When you indicate that you ran the store path on that node, can you be
specific about what you did?


>>> I'm wondering what happened here.  It is almost as if the "move set"
>>> never executed on the other subscribers - an impossibility, no?  They
>>> WERE all replicating and current just before the shutdown - I checked
>>> them all.  How does that happen under these circumstances?
>>>
>>> Is there a better way for the future?  I'm back up now, but the entire
>>> point of this exercise was to AVOID having to copy the entire database
>>> over - while I avoided any material downtime for my users, I was left
>>> EXPOSED to a failure for the copy period, which was kinda nasty.
>>>
>>> Thoughts appreciated.
>>>
>>>     =

>>
>> Probably the way to avoid it would have been to issue the store path
>> changes before switching the ports.  But, if you forget to do it in the
>> future, you can fix it afterwards by going bare metal and updating the
>> paths in the _tickerform.sl_path table on the nodes that don't have the
>> correct information.
>>
>>   =

> I still don't understand why the node change wasn't picked up by these
> slaves when the move set executed; I would have expected that this
> would be the case (that is, it would be expecting Node #4 to be the
> master) and although it showed up on the "wrong" ip address a store
> path should have fixed that.
>
> It APPEARS that it was looking for the old master on Node #2....
> implying (I think) that it never saw the move set.
>
> Or am I misunderstanding how the internals work here?
>

I don't think the problem is that it didn't see the move set, I think
the problem is that it didn't get the store path commands because it
didn't connect to the 'new' master after you changed the ports out from
under it.  I don't think slony is well designed for having the paths
changed out from under it and you'll likely have to fix them by hand
when you do this.

I'm pretty sure what happened (and hopefully someone will correct me if
I'm wrong) is even though you ran the slonik store path command on the
broken node, slonik connected to the new master, updated the master's DB
with the store path info and put this event in the log to propagate out
to the slaves.  Unfortunately, because the broken slave still had the
old path in the sl_path table, it didn't know how to connect to the new
master and therefore never received the new path information. =


-- =

Jeff Frost <jeff@pgexperts.com>
COO, PostgreSQL Experts, Inc.
Phone: 1-888-PG-EXPRT x506
http://www.pgexperts.com/ =


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090824/=
cdd24713/attachment-0001.htm
From karl at denninger.net  Mon Aug 24 06:59:51 2009
From: karl at denninger.net (Karl Denninger)
Date: Mon Aug 24 07:01:24 2009
Subject: [Slony1-general] Ugh - New Issue with using Slony to upgrade
	Postgresql
In-Reply-To: <4A929A71.9050208@pgexperts.com>
References: <4A90CB5F.8060100@denninger.net> <4A90DB15.3050602@pgexperts.com>
	<4A91BBA5.1000001@denninger.net> <4A929A71.9050208@pgexperts.com>
Message-ID: <4A929CD7.4040608@denninger.net>

Skipped content of type multipart/alternative-------------- next part -----=
---------
A non-text attachment was scrubbed...
Name: karl.vcf
Type: text/x-vcard
Size: 265 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20090824=
/c4bc8b8d/karl.vcf
From jeff at pgexperts.com  Mon Aug 24 07:27:39 2009
From: jeff at pgexperts.com (Jeff Frost)
Date: Mon Aug 24 07:27:56 2009
Subject: [Slony1-general] Ugh - New Issue with using Slony to upgrade
	Postgresql
In-Reply-To: <4A929CD7.4040608@denninger.net>
References: <4A90CB5F.8060100@denninger.net> <4A90DB15.3050602@pgexperts.com>
	<4A91BBA5.1000001@denninger.net> <4A929A71.9050208@pgexperts.com>
	<4A929CD7.4040608@denninger.net>
Message-ID: <4A92A35B.7040304@pgexperts.com>

Karl Denninger wrote:
>
>
> Jeff Frost wrote:
>> Karl Denninger wrote:
>>>>   =

>>> But they should have switched the master to Node #4 when the move
>>> set command was executed.  When they reconnect they should be doing
>>> so to Node #2, not Node #2 - IF they saw the "move set" command (and
>>> it appears they did.)
>>>
>>> Further, I ran the change in the paths on that node - that is,
>>> locally to that machine.  No difference.
>> When you indicate that you ran the store path on that node, can you
>> be specific about what you did?
>>
>>
>>>>> I'm wondering what happened here.  It is almost as if the "move set"
>>>>> never executed on the other subscribers - an impossibility, no?  They
>>>>> WERE all replicating and current just before the shutdown - I checked
>>>>> them all.  How does that happen under these circumstances?
>>>>>
>>>>> Is there a better way for the future?  I'm back up now, but the entire
>>>>> point of this exercise was to AVOID having to copy the entire database
>>>>> over - while I avoided any material downtime for my users, I was left
>>>>> EXPOSED to a failure for the copy period, which was kinda nasty.
>>>>>
>>>>> Thoughts appreciated.
>>>>>
>>>>>     =

>>>>
>>>> Probably the way to avoid it would have been to issue the store path
>>>> changes before switching the ports.  But, if you forget to do it in the
>>>> future, you can fix it afterwards by going bare metal and updating the
>>>> paths in the _tickerform.sl_path table on the nodes that don't have the
>>>> correct information.
>>>>
>>>>   =

>>> I still don't understand why the node change wasn't picked up by
>>> these slaves when the move set executed; I would have expected that
>>> this would be the case (that is, it would be expecting Node #4 to be
>>> the master) and although it showed up on the "wrong" ip address a
>>> store path should have fixed that.
>>>
>>> It APPEARS that it was looking for the old master on Node #2....
>>> implying (I think) that it never saw the move set.
>>>
>>> Or am I misunderstanding how the internals work here?
>>>
>>
>> I don't think the problem is that it didn't see the move set, I think
>> the problem is that it didn't get the store path commands because it
>> didn't connect to the 'new' master after you changed the ports out
>> from under it.  I don't think slony is well designed for having the
>> paths changed out from under it and you'll likely have to fix them by
>> hand when you do this.
>>
>> I'm pretty sure what happened (and hopefully someone will correct me
>> if I'm wrong) is even though you ran the slonik store path command on
>> the broken node, slonik connected to the new master, updated the
>> master's DB with the store path info and put this event in the log to
>> propagate out to the slaves.  Unfortunately, because the broken slave
>> still had the old path in the sl_path table, it didn't know how to
>> connect to the new master and therefore never received the new path
>> information. =

>>
> But the log says it DID receive the new path information - when I
> executed the "store paths" on the client the log file for slon on that
> client immediately reflected that the path configuration had been
> changed.  So clearly, it saw it on the local host.
>
Do you still have the logs sitting around?  Can you post them?
> I have since dropped the old database (which was running as a "safety"
> overnight using "drop node" and of note that DID drop the schema as
> the replication was torn down......
>
Ah! You're right!  From the docs: " If the replication daemon is still
running on that node (and processing events), it will attempt to
uninstall the replication system and terminate itself."  Interestingly,
I've never seen it do that. I actually went and checked in the docs all
the way back to 1.2.10 and it says the same thing. I suppose I've almost
always dropped a broken node, so it probably wouldn't have processed the
event. =

> Its pretty clear to me that something went wrong during the move set -
> but exactly what and why I can't reproduce at the present time.
>
> I'll have to see if I can set up a "sandbox" and try this in an
> isolated environment to see if I can figure out why it happened and
> hopefully prevent myself from getting bit like this again.
>
>
Always an excellent idea.  Report back with your results and how to
reproduce any strange behavior you find.


-- =

Jeff Frost <jeff@pgexperts.com>
COO, PostgreSQL Experts, Inc.
Phone: 1-888-PG-EXPRT x506
http://www.pgexperts.com/ =


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090824/=
11f0bc37/attachment.htm
From cbbrowne at ca.afilias.info  Mon Aug 24 09:40:44 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Mon Aug 24 09:40:58 2009
Subject: [Slony1-general] Still can't checkout Slony1-www repository
In-Reply-To: <4A902E76.10303@pgexperts.com>
References: <49ABA21E.5040404@dalibo.info>
	<4A8FA1BE.2050803@dalibo.info>	<4A9015ED.50302@pgexperts.com>
	<4A902AFB.3040406@dalibo.info> <4A902E76.10303@pgexperts.com>
Message-ID: <4A92C28C.1070603@ca.afilias.info>

Jeff Frost wrote:
> damien clochard wrote:
>> Jeff Frost a ?crit :
>>   
>>> damien clochard wrote:
>>>     
>>>> Hi !
>>>>
>>>> As i said 6 months ago, it is impossible to checkout the slony's website
>>>> CVS :
>>>>
>>>> $ export CVSROOT=":pserver:anonymous@main.slony.info:/slony1"
>>>> $ cvs co slony1-www/
>>>> cvs checkout: Updating slony1-www
>>>> cvs checkout: failed to create lock directory for `/slony1/slony1-www'
>>>> (/slony1/slony1-www/#cvs.lock): Permission denied
>>>> cvs checkout: failed to obtain dir lock in repository `/slony1/slony1-www'
>>>> cvs [checkout aborted]: read lock failed - giving up
>>>>
>>>>
>>>> Am i doing something wrong ? Is there a reason for not giving public
>>>> access to this repository ? Maybe the CVS is not used anymore ? If this
>>>> is a problem, what can i do to help ?
>>>>   
>>>>       
>>> Looks like you forgot to "cvs login".  Just do it like so:
>>>
>>> CVSROOT=":pserver:anonymous@main.slony.info:/slony1" cvs login
>>> CVSROOT=":pserver:anonymous@main.slony.info:/slony1" cvs co slony1-engine
>>>
>>>     
>>
>> I did the cvs login and pressed [Enter] when i was prompted for password.
>>
>> It works fine for the slony1-engine repository but it fails for the
>> slony1-www repository.
>>
>>   
> Ah!  I'm sorry, I misread your original post that indicated 
> slony1-www. :-(  The slony1-www fails for me in the same way.  I'm 
> going to guess that the anonymous user doesn't have write access to 
> that directory and not too many people check out the slony1-www repo 
> as anonymous so it hasn't been noticed until now.  Hopefully one of 
> the admins can fix that.
> cbbrowne@main:/home/cvsd$ ls -l /home/cvsd/fixperms.sh
> -rwsr-sr-x 1 root root 131 Apr 24  2007 /home/cvsd/fixperms.sh
> cbbrowne@main:/home/cvsd$ cat /home/cvsd/fixperms.sh
> #!/bin/sh
> chown -R cvsd /home/cvsd/slony1/slony1-engine
> chmod -R og+s /home/cvsd/slony1/slony1-engine /home/cvsd/slony1/slony1-www
>
I'm not quite sure what's wrong here...

There are a few places that document a common group permissions issue 
that looks as though it might cause this; characteristic is...  
http://www.mooreds.com/wordpress/archives/000234

In poking around, the permissions *appear* appropriate in /home/cvsd and 
children.

There's a script there that looks like it might rectify things; I don't 
have permission to run it...  Devrim?

cbbrowne@main:/home/cvsd$ ls -l /home/cvsd/fixperms.sh
-rwsr-sr-x 1 root root 131 Apr 24  2007 /home/cvsd/fixperms.sh
cbbrowne@main:/home/cvsd$ cat /home/cvsd/fixperms.sh
#!/bin/sh
chown -R cvsd /home/cvsd/slony1/slony1-engine
chmod -R og+s /home/cvsd/slony1/slony1-engine /home/cvsd/slony1/slony1-www


From devrim at gunduz.org  Mon Aug 24 09:47:35 2009
From: devrim at gunduz.org (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Mon Aug 24 09:48:26 2009
Subject: [Slony1-general] Still can't checkout Slony1-www repository
In-Reply-To: <4A92C28C.1070603@ca.afilias.info>
References: <49ABA21E.5040404@dalibo.info> <4A8FA1BE.2050803@dalibo.info>
	<4A9015ED.50302@pgexperts.com> <4A902AFB.3040406@dalibo.info>
	<4A902E76.10303@pgexperts.com>  <4A92C28C.1070603@ca.afilias.info>
Message-ID: <1251132455.18790.4.camel@hp-laptop2.gunduz.org>

T24gTW9uLCAyMDA5LTA4LTI0IGF0IDEyOjQwIC0wNDAwLCBDaHJpc3RvcGhlciBCcm93bmUgd3Jv
dGU6Cj4gVGhlcmUncyBhIHNjcmlwdCB0aGVyZSB0aGF0IGxvb2tzIGxpa2UgaXQgbWlnaHQgcmVj
dGlmeSB0aGluZ3M7IEkKPiBkb24ndCBoYXZlIHBlcm1pc3Npb24gdG8gcnVuIGl0Li4uICBEZXZy
aW0/CgpJIHJhbiB0aGF0IHNjcmlwdCBub3cuCi0tIApEZXZyaW0gR8OcTkTDnFosIFJIQ0UKQ29t
bWFuZCBQcm9tcHQgLSBodHRwOi8vd3d3LkNvbW1hbmRQcm9tcHQuY29tIApkZXZyaW1+Z3VuZHV6
Lm9yZywgZGV2cmltflBvc3RncmVTUUwub3JnLCBkZXZyaW0uZ3VuZHV6fmxpbnV4Lm9yZy50cgog
ICAgICAgICAgICAgICAgICAgaHR0cDovL3d3dy5ndW5kdXoub3JnCi0tLS0tLS0tLS0tLS0tIG5l
eHQgcGFydCAtLS0tLS0tLS0tLS0tLQpBIG5vbi10ZXh0IGF0dGFjaG1lbnQgd2FzIHNjcnViYmVk
Li4uCk5hbWU6IG5vdCBhdmFpbGFibGUKVHlwZTogYXBwbGljYXRpb24vcGdwLXNpZ25hdHVyZQpT
aXplOiAxOTcgYnl0ZXMKRGVzYzogVGhpcyBpcyBhIGRpZ2l0YWxseSBzaWduZWQgbWVzc2FnZSBw
YXJ0ClVybCA6IGh0dHA6Ly9saXN0cy5zbG9ueS5pbmZvL3BpcGVybWFpbC9zbG9ueTEtZ2VuZXJh
bC9hdHRhY2htZW50cy8yMDA5MDgyNC82MDhhYzdlOC9hdHRhY2htZW50LnBncAo=
From cbbrowne at ca.afilias.info  Mon Aug 24 09:56:19 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Mon Aug 24 09:56:41 2009
Subject: [Slony1-general] Still can't checkout Slony1-www repository
In-Reply-To: <1251132455.18790.4.camel@hp-laptop2.gunduz.org> ("Devrim
	=?utf-8?B?R8OcTkTDnFoiJ3M=?= message of "Mon,
	24 Aug 2009 19:47:35 +0300")
References: <49ABA21E.5040404@dalibo.info> <4A8FA1BE.2050803@dalibo.info>
	<4A9015ED.50302@pgexperts.com> <4A902AFB.3040406@dalibo.info>
	<4A902E76.10303@pgexperts.com> <4A92C28C.1070603@ca.afilias.info>
	<1251132455.18790.4.camel@hp-laptop2.gunduz.org>
Message-ID: <874orxkv64.fsf@dba2.int.libertyrms.com>

Devrim G?ND?Z <devrim@gunduz.org> writes:
> On Mon, 2009-08-24 at 12:40 -0400, Christopher Browne wrote:
>> There's a script there that looks like it might rectify things; I
>> don't have permission to run it...  Devrim?
>
> I ran that script now.

Alas, that doesn't change the behaviour:

cbbrowne@wolfe:/tmp> cvs co slony1-www
cvs checkout: Updating slony1-www
cvs checkout: failed to create lock directory for `/slony1/slony1-www' (/slony1/slony1-www/#cvs.lock): Permission denied
cvs checkout: failed to obtain dir lock in repository `/slony1/slony1-www'
cvs [checkout aborted]: read lock failed - giving up

I'm not quite sure what to suggest next.
-- 
(reverse (concatenate 'string "ofni.sailifa.ac" "@" "enworbbc"))
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"
From devrim at gunduz.org  Mon Aug 24 10:00:29 2009
From: devrim at gunduz.org (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Mon Aug 24 10:01:21 2009
Subject: [Slony1-general] Still can't checkout Slony1-www repository
In-Reply-To: <874orxkv64.fsf@dba2.int.libertyrms.com>
References: <49ABA21E.5040404@dalibo.info> <4A8FA1BE.2050803@dalibo.info>
	<4A9015ED.50302@pgexperts.com> <4A902AFB.3040406@dalibo.info>
	<4A902E76.10303@pgexperts.com> <4A92C28C.1070603@ca.afilias.info>
	<1251132455.18790.4.camel@hp-laptop2.gunduz.org>
	<874orxkv64.fsf@dba2.int.libertyrms.com>
Message-ID: <1251133229.18790.5.camel@hp-laptop2.gunduz.org>

T24gTW9uLCAyMDA5LTA4LTI0IGF0IDEyOjU2IC0wNDAwLCBDaHJpc3RvcGhlciBCcm93bmUgd3Jv
dGU6Cj4gSSdtIG5vdCBxdWl0ZSBzdXJlIHdoYXQgdG8gc3VnZ2VzdCBuZXh0LgoKSSdsbCB0YWtl
IGEgbG9vayBhdCBpdCB0b2RheS4KLS0gCkRldnJpbSBHw5xORMOcWiwgUkhDRQpDb21tYW5kIFBy
b21wdCAtIGh0dHA6Ly93d3cuQ29tbWFuZFByb21wdC5jb20gCmRldnJpbX5ndW5kdXoub3JnLCBk
ZXZyaW1+UG9zdGdyZVNRTC5vcmcsIGRldnJpbS5ndW5kdXp+bGludXgub3JnLnRyCiAgICAgICAg
ICAgICAgICAgICBodHRwOi8vd3d3Lmd1bmR1ei5vcmcKLS0tLS0tLS0tLS0tLS0gbmV4dCBwYXJ0
IC0tLS0tLS0tLS0tLS0tCkEgbm9uLXRleHQgYXR0YWNobWVudCB3YXMgc2NydWJiZWQuLi4KTmFt
ZTogbm90IGF2YWlsYWJsZQpUeXBlOiBhcHBsaWNhdGlvbi9wZ3Atc2lnbmF0dXJlClNpemU6IDE5
NyBieXRlcwpEZXNjOiBUaGlzIGlzIGEgZGlnaXRhbGx5IHNpZ25lZCBtZXNzYWdlIHBhcnQKVXJs
IDogaHR0cDovL2xpc3RzLnNsb255LmluZm8vcGlwZXJtYWlsL3Nsb255MS1nZW5lcmFsL2F0dGFj
aG1lbnRzLzIwMDkwODI0LzgxMzcxNmUyL2F0dGFjaG1lbnQucGdwCg==
From jeff at pgexperts.com  Mon Aug 24 10:01:43 2009
From: jeff at pgexperts.com (Jeff Frost)
Date: Mon Aug 24 10:02:06 2009
Subject: [Slony1-general] Still can't checkout Slony1-www repository
In-Reply-To: <874orxkv64.fsf@dba2.int.libertyrms.com>
References: <49ABA21E.5040404@dalibo.info>
	<4A8FA1BE.2050803@dalibo.info>	<4A9015ED.50302@pgexperts.com>
	<4A902AFB.3040406@dalibo.info>	<4A902E76.10303@pgexperts.com>
	<4A92C28C.1070603@ca.afilias.info>	<1251132455.18790.4.camel@hp-laptop2.gunduz.org>
	<874orxkv64.fsf@dba2.int.libertyrms.com>
Message-ID: <4A92C777.3070701@pgexperts.com>

Q2hyaXN0b3BoZXIgQnJvd25lIHdyb3RlOgo+IERldnJpbSBHw5xORMOcWiA8ZGV2cmltQGd1bmR1
ei5vcmc+IHdyaXRlczoKPiAgIAo+PiBPbiBNb24sIDIwMDktMDgtMjQgYXQgMTI6NDAgLTA0MDAs
IENocmlzdG9waGVyIEJyb3duZSB3cm90ZToKPj4gICAgIAo+Pj4gVGhlcmUncyBhIHNjcmlwdCB0
aGVyZSB0aGF0IGxvb2tzIGxpa2UgaXQgbWlnaHQgcmVjdGlmeSB0aGluZ3M7IEkKPj4+IGRvbid0
IGhhdmUgcGVybWlzc2lvbiB0byBydW4gaXQuLi4gIERldnJpbT8KPj4+ICAgICAgIAo+PiBJIHJh
biB0aGF0IHNjcmlwdCBub3cuCj4+ICAgICAKPgo+IEFsYXMsIHRoYXQgZG9lc24ndCBjaGFuZ2Ug
dGhlIGJlaGF2aW91cjoKPgo+IGNiYnJvd25lQHdvbGZlOi90bXA+IGN2cyBjbyBzbG9ueTEtd3d3
Cj4gY3ZzIGNoZWNrb3V0OiBVcGRhdGluZyBzbG9ueTEtd3d3Cj4gY3ZzIGNoZWNrb3V0OiBmYWls
ZWQgdG8gY3JlYXRlIGxvY2sgZGlyZWN0b3J5IGZvciBgL3Nsb255MS9zbG9ueTEtd3d3JyAoL3Ns
b255MS9zbG9ueTEtd3d3LyNjdnMubG9jayk6IFBlcm1pc3Npb24gZGVuaWVkCj4gY3ZzIGNoZWNr
b3V0OiBmYWlsZWQgdG8gb2J0YWluIGRpciBsb2NrIGluIHJlcG9zaXRvcnkgYC9zbG9ueTEvc2xv
bnkxLXd3dycKPiBjdnMgW2NoZWNrb3V0IGFib3J0ZWRdOiByZWFkIGxvY2sgZmFpbGVkIC0gZ2l2
aW5nIHVwCj4KPiBJJ20gbm90IHF1aXRlIHN1cmUgd2hhdCB0byBzdWdnZXN0IG5leHQuCj4gICAK
RG9lcyB0aGUgbG9jayBkaXJlY3RvcnkgZXhpc3QgYWxyZWFkeT8gIE1heWJlIHRpbWUgdG8gYnJl
YWsgb3V0IHN0cmFjZQotZSB0cmFjZT1maWxlIHRvIHNlZSB3aGF0J3MgaGFwcGVuaW5nPwoKLS0g
CkplZmYgRnJvc3QgPGplZmZAcGdleHBlcnRzLmNvbT4KQ09PLCBQb3N0Z3JlU1FMIEV4cGVydHMs
IEluYy4KUGhvbmU6IDEtODg4LVBHLUVYUFJUIHg1MDYKaHR0cDovL3d3dy5wZ2V4cGVydHMuY29t
LyAKCi0tLS0tLS0tLS0tLS0tIG5leHQgcGFydCAtLS0tLS0tLS0tLS0tLQpBbiBIVE1MIGF0dGFj
aG1lbnQgd2FzIHNjcnViYmVkLi4uClVSTDogaHR0cDovL2xpc3RzLnNsb255LmluZm8vcGlwZXJt
YWlsL3Nsb255MS1nZW5lcmFsL2F0dGFjaG1lbnRzLzIwMDkwODI0Lzk2NDJmOWRhL2F0dGFjaG1l
bnQuaHRtCg==
From ajs at crankycanuck.ca  Mon Aug 24 10:16:58 2009
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Mon Aug 24 10:17:13 2009
Subject: [Slony1-general] How does it work if has different sets on
	different nodes?
In-Reply-To: <25110900.post@talk.nabble.com>
References: <25056529.post@talk.nabble.com>
	<20090820162918.GN6466@shinkuro.com>
	<25110900.post@talk.nabble.com>
Message-ID: <20090824171657.GG2063@shinkuro.com>

On Sun, Aug 23, 2009 at 10:59:13PM -0700, roctaiwan wrote:
> 
> Hi Andrew,
> 
> If I understand the slony replication correct, is that after I do switchover
> or failover what it can do is promote another node to replace its origin
> node. 

Hold on: switchover and failover are completely different.  Failover
abandons the former origin.  Switchover does not.  Switchover is
intelligent about this, but failover just takes over at the new node
at whatever stage that node is in.  This works on a _set_, and not on
the node as such.

> If lets say failover, after origin node failed and another node
> replaced it, all other slave nodes in group will seek for sets from new
> master, basically failover script will change the "provider" from subscribe
> set command to the new master node. Therefore, new master should first sync
> with old master with all the data and having all sets isn't it? 

Not for failover, no.  Switchover does this in a controlled manner,
and therefore moves the set at a logical point in time for that set.
 
> Let's say Old master(node 1) has five tables (table 1,2,3,4,5) and new
> master (node 2) has only (table 1 and 2). After switch over or failover to
> the new master (node 2), will node 2 sync with old master and has all 5
> tables? 

I don't think so, no.

A

-- 
Andrew Sullivan
ajs@crankycanuck.ca
From nettreeinc at gmail.com  Mon Aug 24 20:01:40 2009
From: nettreeinc at gmail.com (roctaiwan)
Date: Mon Aug 24 20:02:36 2009
Subject: [Slony1-general] How does it work if has different sets on
	different nodes?
In-Reply-To: <20090824171657.GG2063@shinkuro.com>
References: <25056529.post@talk.nabble.com>
	<20090820162918.GN6466@shinkuro.com>
	<25110900.post@talk.nabble.com>
	<20090824171657.GG2063@shinkuro.com>
Message-ID: <25127095.post@talk.nabble.com>


Andrew,

Then from what you said. Data within the tables between old master and new
master will be different? then original master has all the data but now
after failover Node 1 (original master ) got dropped and Node 2 is the new
master. if node 2 don't have all the up-to-date data for ALL tables (from
#12345 tables) then where does slaves getting data from?? This is the part
where I want to get straight with. 

Also, Node 2 the new master but originally the slave 1 has table set for 1
and 2. After failover which slave is the provider for table set 1 and 2 ???


Regard, 

Huang


Andrew Sullivan-8 wrote:
> 
> On Sun, Aug 23, 2009 at 10:59:13PM -0700, roctaiwan wrote:
>> 
>> Hi Andrew,
>> 
>> If I understand the slony replication correct, is that after I do
>> switchover
>> or failover what it can do is promote another node to replace its origin
>> node. 
> 
> Hold on: switchover and failover are completely different.  Failover
> abandons the former origin.  Switchover does not.  Switchover is
> intelligent about this, but failover just takes over at the new node
> at whatever stage that node is in.  This works on a _set_, and not on
> the node as such.
> 
>> If lets say failover, after origin node failed and another node
>> replaced it, all other slave nodes in group will seek for sets from new
>> master, basically failover script will change the "provider" from
>> subscribe
>> set command to the new master node. Therefore, new master should first
>> sync
>> with old master with all the data and having all sets isn't it? 
> 
> Not for failover, no.  Switchover does this in a controlled manner,
> and therefore moves the set at a logical point in time for that set.
>  
>> Let's say Old master(node 1) has five tables (table 1,2,3,4,5) and new
>> master (node 2) has only (table 1 and 2). After switch over or failover
>> to
>> the new master (node 2), will node 2 sync with old master and has all 5
>> tables? 
> 
> I don't think so, no.
> 
> A
> 
> -- 
> Andrew Sullivan
> ajs@crankycanuck.ca
> 
> 

-- 
View this message in context: http://www.nabble.com/How-exactly-replication-works-for-different-sets-on-different-nodes--tp25056529p25127095.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.

From nettreeinc at gmail.com  Mon Aug 24 20:08:06 2009
From: nettreeinc at gmail.com (roctaiwan)
Date: Mon Aug 24 20:09:01 2009
Subject: [Slony1-general] Why my postgresql.conf doesn't contain......
In-Reply-To: <1251105693.10597.3.camel@hp-laptop2.gunduz.org>
References: <25111938.post@talk.nabble.com>
	<1251105693.10597.3.camel@hp-laptop2.gunduz.org>
Message-ID: <25127318.post@talk.nabble.com>


I have version 8.3.7 version. from enterpriseDB



Devrim G?ND?Z wrote:
> 
> On Mon, 2009-08-24 at 00:53 -0700, roctaiwan wrote:
>> But why I don't have any of these configurable parameters in my config
>> file?
> 
> Which PostgreSQL version are you using? ;)
> 
> -- 
> Devrim G?ND?Z, RHCE
> Command Prompt - http://www.CommandPrompt.com 
> devrim~gunduz.org, devrim~PostgreSQL.org, devrim.gunduz~linux.org.tr
>                    http://www.gunduz.org
> 
>  
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
> 
> 

-- 
View this message in context: http://www.nabble.com/Why-my-postgresql.conf-doesn%27t-contain-these-configuration-parameters--tp25111938p25127318.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.

From nettreeinc at gmail.com  Mon Aug 24 20:54:22 2009
From: nettreeinc at gmail.com (roctaiwan)
Date: Mon Aug 24 20:55:19 2009
Subject: [Slony1-general] How do you rejoin a dropped nodes?
In-Reply-To: <25075915.post@talk.nabble.com>
References: <25074942.post@talk.nabble.com> <25075915.post@talk.nabble.com>
Message-ID: <25127810.post@talk.nabble.com>


Please, anyone ? I just need basic instructions on how to rejoin the dropped
node that was part of the replication group. I keep getting <stdin>:21:
Error: ev_origin for store_node cannot be the new node




roctaiwan wrote:
> 
> Ok I had tried another way to do rejoin my node to group from "scratch" as
> instructed from docunment. 
> I drop the whole table and rebuild it, then dump everything from current
> master and restore it back to my dropped node. Now my dropped node has the
> same status as the master now. 
> I then trying to do add_cluster on master, but it gave me this message:
> 
> <stdin>:21: Error: ev_origin for store_node cannot be the new node
> <stdin>:21: PGRES_FATAL_ERROR select
> "_sql_cluster".getLocalNodeId('_sql_cluster'); - ERROR:  schema
> "_sql_cluster" does not exist
> <stdin>:21: database specified in <stdin>:5 reports no_id -1
> 
> WHY??? what's wrong with it? I already inform all the node that I had
> dropped the Node1, why it said "Error: ev_origin for store_node cannot be
> the new node" ????
> 

-- 
View this message in context: http://www.nabble.com/How-do-you-rejoin-a-dropped-nodes--tp25074942p25127810.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.

From nettreeinc at gmail.com  Mon Aug 24 21:00:33 2009
From: nettreeinc at gmail.com (roctaiwan)
Date: Mon Aug 24 21:01:33 2009
Subject: [Slony1-general] Error: ev_origin for store_node cannot be the new
	node
Message-ID: <25127910.post@talk.nabble.com>


Anyone know What this error message mean? 

scenario was, I try to rejoin a dropped node that was part of the
replication group. All I did was reconfig the store node and store path,
that's all. But error keeps shown up...

store node (id = 2, comment = 'Slave 1');
store path (server = 1, client = 2, conninfo = 'dbname=$DB host=$Node1
user=$U');
store path (server = 2, client = 1, conninfo = 'dbname=$DB host=$Node2
user=$U');
-- 
View this message in context: http://www.nabble.com/Error%3A-ev_origin-for-store_node-cannot-be-the-new-node-tp25127910p25127910.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.

From jeff at pgexperts.com  Tue Aug 25 06:42:59 2009
From: jeff at pgexperts.com (Jeff Frost)
Date: Tue Aug 25 06:43:14 2009
Subject: [Slony1-general] How do you rejoin a dropped nodes?
In-Reply-To: <25127810.post@talk.nabble.com>
References: <25074942.post@talk.nabble.com> <25075915.post@talk.nabble.com>
	<25127810.post@talk.nabble.com>
Message-ID: <4A93EA63.40001@pgexperts.com>

roctaiwan wrote:
> Please, anyone ? I just need basic instructions on how to rejoin the drop=
ped
> node that was part of the replication group. I keep getting <stdin>:21:
> Error: ev_origin for store_node cannot be the new node
>
>
>
>   =

You must resubscribe it as if it were a new node.
> roctaiwan wrote:
>   =

>> Ok I had tried another way to do rejoin my node to group from "scratch" =
as
>> instructed from docunment. =

>> I drop the whole table and rebuild it, then dump everything from current
>> master and restore it back to my dropped node. Now my dropped node has t=
he
>> same status as the master now. =

>> I then trying to do add_cluster on master, but it gave me this message:
>>
>> <stdin>:21: Error: ev_origin for store_node cannot be the new node
>> <stdin>:21: PGRES_FATAL_ERROR select
>> "_sql_cluster".getLocalNodeId('_sql_cluster'); - ERROR:  schema
>> "_sql_cluster" does not exist
>> <stdin>:21: database specified in <stdin>:5 reports no_id -1
>>
>> WHY??? what's wrong with it? I already inform all the node that I had
>> dropped the Node1, why it said "Error: ev_origin for store_node cannot be
>> the new node" ????
>>
>>     =

>
>   =



-- =

Jeff Frost <jeff@pgexperts.com>
COO, PostgreSQL Experts, Inc.
Phone: 1-888-PG-EXPRT x506
http://www.pgexperts.com/ =


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090825/=
a13bdf84/attachment.htm
From nettreeinc at gmail.com  Tue Aug 25 07:50:34 2009
From: nettreeinc at gmail.com (roctaiwan)
Date: Tue Aug 25 07:50:43 2009
Subject: [Slony1-general] How do you rejoin a dropped nodes?
In-Reply-To: <4A93EA63.40001@pgexperts.com>
References: <25074942.post@talk.nabble.com> <25075915.post@talk.nabble.com>
	<25127810.post@talk.nabble.com> <4A93EA63.40001@pgexperts.com>
Message-ID: <25135905.post@talk.nabble.com>


I did tried. but ev_origin error keeps happening. But I wouldn't find the
answer from anywhere. I guess people who know how to do this don't bother to
answer. 



Jeff Frost-2 wrote:
> 
> roctaiwan wrote:
>> Please, anyone ? I just need basic instructions on how to rejoin the
>> dropped
>> node that was part of the replication group. I keep getting <stdin>:21:
>> Error: ev_origin for store_node cannot be the new node
>>
>>
>>
>>   
> You must resubscribe it as if it were a new node.
>> roctaiwan wrote:
>>   
>>> Ok I had tried another way to do rejoin my node to group from "scratch"
>>> as
>>> instructed from docunment. 
>>> I drop the whole table and rebuild it, then dump everything from current
>>> master and restore it back to my dropped node. Now my dropped node has
>>> the
>>> same status as the master now. 
>>> I then trying to do add_cluster on master, but it gave me this message:
>>>
>>> <stdin>:21: Error: ev_origin for store_node cannot be the new node
>>> <stdin>:21: PGRES_FATAL_ERROR select
>>> "_sql_cluster".getLocalNodeId('_sql_cluster'); - ERROR:  schema
>>> "_sql_cluster" does not exist
>>> <stdin>:21: database specified in <stdin>:5 reports no_id -1
>>>
>>> WHY??? what's wrong with it? I already inform all the node that I had
>>> dropped the Node1, why it said "Error: ev_origin for store_node cannot
>>> be
>>> the new node" ????
>>>
>>>     
>>
>>   
> 
> 
> -- 
> Jeff Frost <jeff@pgexperts.com>
> COO, PostgreSQL Experts, Inc.
> Phone: 1-888-PG-EXPRT x506
> http://www.pgexperts.com/ 
> 
> 
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
> 
> 

-- 
View this message in context: http://www.nabble.com/How-do-you-rejoin-a-dropped-nodes--tp25074942p25135905.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.

From devrim at gunduz.org  Tue Aug 25 09:23:17 2009
From: devrim at gunduz.org (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Tue Aug 25 09:24:18 2009
Subject: [Slony1-general] Still can't checkout Slony1-www repository
In-Reply-To: <874orxkv64.fsf@dba2.int.libertyrms.com>
References: <49ABA21E.5040404@dalibo.info> <4A8FA1BE.2050803@dalibo.info>
	<4A9015ED.50302@pgexperts.com> <4A902AFB.3040406@dalibo.info>
	<4A902E76.10303@pgexperts.com> <4A92C28C.1070603@ca.afilias.info>
	<1251132455.18790.4.camel@hp-laptop2.gunduz.org>
	<874orxkv64.fsf@dba2.int.libertyrms.com>
Message-ID: <1251217397.6307.8.camel@hp-laptop2.gunduz.org>

T24gTW9uLCAyMDA5LTA4LTI0IGF0IDEyOjU2IC0wNDAwLCBDaHJpc3RvcGhlciBCcm93bmUgd3Jv
dGU6Cj4gY3ZzIGNoZWNrb3V0OiBmYWlsZWQgdG8gb2J0YWluIGRpciBsb2NrIGluIHJlcG9zaXRv
cnkKPiBgL3Nsb255MS9zbG9ueTEtd3d3Jwo+IGN2cyBbY2hlY2tvdXQgYWJvcnRlZF06IHJlYWQg
bG9jayBmYWlsZWQgLSBnaXZpbmcgdXAKCkZpeGVkLgoKUmVnYXJkcywKLS0gCkRldnJpbSBHw5xO
RMOcWiwgUkhDRQpDb21tYW5kIFByb21wdCAtIGh0dHA6Ly93d3cuQ29tbWFuZFByb21wdC5jb20g
CmRldnJpbX5ndW5kdXoub3JnLCBkZXZyaW1+UG9zdGdyZVNRTC5vcmcsIGRldnJpbS5ndW5kdXp+
bGludXgub3JnLnRyCiAgICAgICAgICAgICAgICAgICBodHRwOi8vd3d3Lmd1bmR1ei5vcmcKLS0t
LS0tLS0tLS0tLS0gbmV4dCBwYXJ0IC0tLS0tLS0tLS0tLS0tCkEgbm9uLXRleHQgYXR0YWNobWVu
dCB3YXMgc2NydWJiZWQuLi4KTmFtZTogbm90IGF2YWlsYWJsZQpUeXBlOiBhcHBsaWNhdGlvbi9w
Z3Atc2lnbmF0dXJlClNpemU6IDE5NyBieXRlcwpEZXNjOiBUaGlzIGlzIGEgZGlnaXRhbGx5IHNp
Z25lZCBtZXNzYWdlIHBhcnQKVXJsIDogaHR0cDovL2xpc3RzLnNsb255LmluZm8vcGlwZXJtYWls
L3Nsb255MS1nZW5lcmFsL2F0dGFjaG1lbnRzLzIwMDkwODI1LzY3ZmIwNWVmL2F0dGFjaG1lbnQu
cGdwCg==
From karl at denninger.net  Tue Aug 25 09:39:21 2009
From: karl at denninger.net (Karl Denninger)
Date: Tue Aug 25 09:41:01 2009
Subject: [Slony1-general] How do you rejoin a dropped nodes?
In-Reply-To: <25135905.post@talk.nabble.com>
References: <25074942.post@talk.nabble.com>
	<25075915.post@talk.nabble.com>	<25127810.post@talk.nabble.com>
	<4A93EA63.40001@pgexperts.com> <25135905.post@talk.nabble.com>
Message-ID: <4A9413B9.5070606@denninger.net>

roctaiwan wrote:
> I did tried. but ev_origin error keeps happening. But I wouldn't find the
> answer from anywhere. I guess people who know how to do this don't bother=
 to
> answer. =

>
>   =

You have an old schema in there that's prohibiting this.  Go into the
database on the CLIENT that is dysfunctional/broken (DO NOT DO THIS ON
THE MASTER - YOU HAVE BEEN WARNED!) and execute:

$ drop schema _clustername cascade

Note that "clustername" is the name of the cluster (usually the same as
the database name but it doesn't have to be.)

This will drop the old Slony schema AND all the triggers that got added
to the tables.  If you forget the "cascade" you have a hell of a mess to
clean up by hand, so don't.

Once you have a CLEAN database (can have old data in it, it will be
automatically copied over) that has the IDENTICAL schema to the master,
here's how you add a new node, assuming you have ONE node running now
(Node #1) with no clients (you're going to add Node #2)

Have a file called "slonik.preamble" containing:

CLUSTER NAME =3D your-cluster
node 1 admin conninfo=3D'dbname=3Dyour-db host=3Dexisting-host user=3Dslony
port=3D5432 password=3Dwhatever';
node 2 admin conninfo=3D'dbname=3Dyour-db host=3Dnew-host user=3Dslony port=
=3D5432
password=3Dwhatever';

This assumes "existing-host" is running the master, and "new-host" is
where you want the new replication to be set up.

Start the SLON on the new host.  It will complain about not being
configured in the logfile every 10 seconds or so.  That's fine.

Then you run the following three files with "slonik filename"

step1:
include <slonik.preamble>;
store node (id=3D2, comment=3D'Client #1, Node #2', event node=3D1);

(Sets up the base definitions and schema for the database and tells it
what this node is along with the node to deliver events to - the master
node.)

step2:
include <slonik.preamble>;
store path (server=3D1, client=3D2, conninfo=3D'dbname=3Dyour-db
host=3Dexisting-host user=3Dslony port=3D5432 password=3Dwhatever');
store path (server=3D2, client=3D1, conninfo=3D'dbname=3Dyour-db host=3Dnew=
-host
user=3Dslony port=3D5432 password=3Dwhatever');

(Tell Slony how to find both the master and your new slave hosts as a
pair of reciprocal paths)

step3:
include <slonik.preamble>;
subscribe set (id=3D1, provider=3D1, receiver=3D2, forward=3Dfalse);

(Subscribe the set)

You can put all of this into one file (only one "include" of course),
but I prefer not to because with each step I want to look at the logfile
and see that slon has picked up the changes, and this also reduces the
risk of a disaster (slon is pretty well protected against it, but....)
if I make a mistake.  I also like to have "Step2" separate because if I
move a database (hostname address, etc) I can run JUST THAT ONE even on
a running cluster without trashing things - that SHOULD (when things are
working properly) propagate to all the affected nodes.

Note that this will cause a COPY to be done of the entire subscriber
set.  Once you drop the node (either with a failover or controlled drop
with a "drop node") if the drop succeeds and notification is delivered
the schema containing the necessary sync information is removed and thus
you cannot recover via only the changed transactions, as the baseline
checkpoint is lost.

Within a few seconds of when you give the last "step3" command you
should see COPY commands being logged into the SLON logfile as the
system pulls over the data from the master.

This all assumes a "standard" (not log-shipping or other complex)
configuration.

-- Karl
-------------- next part --------------
A non-text attachment was scrubbed...
Name: karl.vcf
Type: text/x-vcard
Size: 265 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20090825=
/6606ea2e/karl-0001.vcf
From cbbrowne at ca.afilias.info  Tue Aug 25 10:11:07 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Tue Aug 25 10:11:28 2009
Subject: [Slony1-general] Still can't checkout Slony1-www repository
In-Reply-To: <1251217397.6307.8.camel@hp-laptop2.gunduz.org> ("Devrim
	=?utf-8?B?R8OcTkTDnFoiJ3M=?= message of "Tue,
	25 Aug 2009 19:23:17 +0300")
References: <49ABA21E.5040404@dalibo.info> <4A8FA1BE.2050803@dalibo.info>
	<4A9015ED.50302@pgexperts.com> <4A902AFB.3040406@dalibo.info>
	<4A902E76.10303@pgexperts.com> <4A92C28C.1070603@ca.afilias.info>
	<1251132455.18790.4.camel@hp-laptop2.gunduz.org>
	<874orxkv64.fsf@dba2.int.libertyrms.com>
	<1251217397.6307.8.camel@hp-laptop2.gunduz.org>
Message-ID: <87ab1nkedw.fsf@dba2.int.libertyrms.com>

Devrim G?ND?Z <devrim@gunduz.org> writes:
> On Mon, 2009-08-24 at 12:56 -0400, Christopher Browne wrote:
>> cvs checkout: failed to obtain dir lock in repository
>> `/slony1/slony1-www'
>> cvs [checkout aborted]: read lock failed - giving up
>
> Fixed.
>
> Regards,

Hurrah!  It might be worth mentioning what needed fixing, as when I went
looking for answers, I evidently did not find right answers.
-- 
output = ("cbbrowne" "@" "ca.afilias.info")
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"
From cbbrowne at ca.afilias.info  Tue Aug 25 10:18:45 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Tue Aug 25 10:18:57 2009
Subject: [Slony1-general] How do you rejoin a dropped nodes?
In-Reply-To: <25127810.post@talk.nabble.com> (roctaiwan's message of "Mon, 24
	Aug 2009 20:54:22 -0700 (PDT)")
References: <25074942.post@talk.nabble.com> <25075915.post@talk.nabble.com>
	<25127810.post@talk.nabble.com>
Message-ID: <8763cbke16.fsf@dba2.int.libertyrms.com>

roctaiwan <nettreeinc@gmail.com> writes:
> Please, anyone ? I just need basic instructions on how to rejoin the dropped
> node that was part of the replication group. I keep getting <stdin>:21:
> Error: ev_origin for store_node cannot be the new node

When you add the new node to the cluster, you need to indicate an "event
node" to inform the rest of the cluster about this addition.

You can't use the newly added node as the "event node" - you need to
pick another one, otherwise you're telling the node that it exists, but
not the rest of the cluster.

Change the node ID you pass for EVENT NODE.
-- 
(reverse (concatenate 'string "ofni.sailifa.ac" "@" "enworbbc"))
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"
From devrim at gunduz.org  Tue Aug 25 10:28:16 2009
From: devrim at gunduz.org (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Tue Aug 25 10:29:22 2009
Subject: [Slony1-general] Still can't checkout Slony1-www repository
In-Reply-To: <87ab1nkedw.fsf@dba2.int.libertyrms.com>
References: <49ABA21E.5040404@dalibo.info> <4A8FA1BE.2050803@dalibo.info>
	<4A9015ED.50302@pgexperts.com> <4A902AFB.3040406@dalibo.info>
	<4A902E76.10303@pgexperts.com> <4A92C28C.1070603@ca.afilias.info>
	<1251132455.18790.4.camel@hp-laptop2.gunduz.org>
	<874orxkv64.fsf@dba2.int.libertyrms.com>
	<1251217397.6307.8.camel@hp-laptop2.gunduz.org>
	<87ab1nkedw.fsf@dba2.int.libertyrms.com>
Message-ID: <1251221296.10573.0.camel@hp-laptop2.gunduz.org>

T24gVHVlLCAyMDA5LTA4LTI1IGF0IDEzOjExIC0wNDAwLCBDaHJpc3RvcGhlciBCcm93bmUgd3Jv
dGU6Cj4gSXQgbWlnaHQgYmUgd29ydGggbWVudGlvbmluZyB3aGF0IG5lZWRlZCBmaXhpbmcsIGFz
IHdoZW4gSSB3ZW50Cj4gbG9va2luZyBmb3IgYW5zd2VycywgSSBldmlkZW50bHkgZGlkIG5vdCBm
aW5kIHJpZ2h0IGFuc3dlcnMuCgpjaG93biAtUiBjdnNkOnNsb255IC9ob21lL2N2c2Qvc2xvbnkx
L3Nsb255MS13d3cKCkFsc28gYWRkZWQgdG8gZml4cGVybXMuc2ggZm9yIGZ1dHVyZSByZWZlcmVu
Y2UuCgpSZWdhcmRzLAoKLS0gCkRldnJpbSBHw5xORMOcWiwgUkhDRQpDb21tYW5kIFByb21wdCAt
IGh0dHA6Ly93d3cuQ29tbWFuZFByb21wdC5jb20gCmRldnJpbX5ndW5kdXoub3JnLCBkZXZyaW1+
UG9zdGdyZVNRTC5vcmcsIGRldnJpbS5ndW5kdXp+bGludXgub3JnLnRyCiAgICAgICAgICAgICAg
ICAgICBodHRwOi8vd3d3Lmd1bmR1ei5vcmcKLS0tLS0tLS0tLS0tLS0gbmV4dCBwYXJ0IC0tLS0t
LS0tLS0tLS0tCkEgbm9uLXRleHQgYXR0YWNobWVudCB3YXMgc2NydWJiZWQuLi4KTmFtZTogbm90
IGF2YWlsYWJsZQpUeXBlOiBhcHBsaWNhdGlvbi9wZ3Atc2lnbmF0dXJlClNpemU6IDE5NyBieXRl
cwpEZXNjOiBUaGlzIGlzIGEgZGlnaXRhbGx5IHNpZ25lZCBtZXNzYWdlIHBhcnQKVXJsIDogaHR0
cDovL2xpc3RzLnNsb255LmluZm8vcGlwZXJtYWlsL3Nsb255MS1nZW5lcmFsL2F0dGFjaG1lbnRz
LzIwMDkwODI1LzkxOWEyY2E2L2F0dGFjaG1lbnQucGdwCg==
From mark.kirkwood at catalyst.net.nz  Tue Aug 25 15:47:07 2009
From: mark.kirkwood at catalyst.net.nz (Mark Kirkwood)
Date: Tue Aug 25 15:47:40 2009
Subject: [Slony1-general] Why my postgresql.conf doesn't contain......
In-Reply-To: <25127318.post@talk.nabble.com>
References: <25111938.post@talk.nabble.com>	<1251105693.10597.3.camel@hp-laptop2.gunduz.org>
	<25127318.post@talk.nabble.com>
Message-ID: <4A9469EB.4010708@catalyst.net.nz>

roctaiwan wrote:
> I have version 8.3.7 version. from enterpriseDB
>
>
>
> Devrim G?ND?Z wrote:
>   
>> On Mon, 2009-08-24 at 00:53 -0700, roctaiwan wrote:
>>     
>>> But why I don't have any of these configurable parameters in my config
>>> file?
>>>       
>> Which PostgreSQL version are you using? ;)
>>
>>     

I think you were reading documentation for an older version of postgres -
for your version the stats collector stuff is controlled by (cut from 
your file) :

#track_activities = on
#track_counts = on
#track_functions = none			# none, pl, all
#track_activity_query_size = 1024
#update_process_title = on
#stats_temp_directory = 'pg_stat_tmp'



From jeff at pgexperts.com  Tue Aug 25 20:08:39 2009
From: jeff at pgexperts.com (Jeff Frost)
Date: Tue Aug 25 20:09:24 2009
Subject: [Slony1-general] Still can't checkout Slony1-www repository
In-Reply-To: <1251221296.10573.0.camel@hp-laptop2.gunduz.org>
References: <49ABA21E.5040404@dalibo.info>
	<4A8FA1BE.2050803@dalibo.info>	<4A9015ED.50302@pgexperts.com>
	<4A902AFB.3040406@dalibo.info>	<4A902E76.10303@pgexperts.com>
	<4A92C28C.1070603@ca.afilias.info>	<1251132455.18790.4.camel@hp-laptop2.gunduz.org>	<874orxkv64.fsf@dba2.int.libertyrms.com>	<1251217397.6307.8.camel@hp-laptop2.gunduz.org>	<87ab1nkedw.fsf@dba2.int.libertyrms.com>
	<1251221296.10573.0.camel@hp-laptop2.gunduz.org>
Message-ID: <4A94A737.1090103@pgexperts.com>

RGV2cmltIEfDnE5Ew5xaIHdyb3RlOgo+IE9uIFR1ZSwgMjAwOS0wOC0yNSBhdCAxMzoxMSAtMDQw
MCwgQ2hyaXN0b3BoZXIgQnJvd25lIHdyb3RlOgo+ICAgCj4+IEl0IG1pZ2h0IGJlIHdvcnRoIG1l
bnRpb25pbmcgd2hhdCBuZWVkZWQgZml4aW5nLCBhcyB3aGVuIEkgd2VudAo+PiBsb29raW5nIGZv
ciBhbnN3ZXJzLCBJIGV2aWRlbnRseSBkaWQgbm90IGZpbmQgcmlnaHQgYW5zd2Vycy4KPj4gICAg
IAo+Cj4gY2hvd24gLVIgY3ZzZDpzbG9ueSAvaG9tZS9jdnNkL3Nsb255MS9zbG9ueTEtd3d3Cj4K
PiBBbHNvIGFkZGVkIHRvIGZpeHBlcm1zLnNoIGZvciBmdXR1cmUgcmVmZXJlbmNlLgo+Cj4gICAK
ClZlcmlmaWVkIHRoYXQgaXQgd29ya3MgZm9yIG1lLiAgVGhhbmtzIERldnJpbS4KCi0tIApKZWZm
IEZyb3N0IDxqZWZmQHBnZXhwZXJ0cy5jb20+CkNPTywgUG9zdGdyZVNRTCBFeHBlcnRzLCBJbmMu
ClBob25lOiAxLTg4OC1QRy1FWFBSVCB4NTA2Cmh0dHA6Ly93d3cucGdleHBlcnRzLmNvbS8gCgot
LS0tLS0tLS0tLS0tLSBuZXh0IHBhcnQgLS0tLS0tLS0tLS0tLS0KQW4gSFRNTCBhdHRhY2htZW50
IHdhcyBzY3J1YmJlZC4uLgpVUkw6IGh0dHA6Ly9saXN0cy5zbG9ueS5pbmZvL3BpcGVybWFpbC9z
bG9ueTEtZ2VuZXJhbC9hdHRhY2htZW50cy8yMDA5MDgyNS8wYmM0OTliYy9hdHRhY2htZW50Lmh0
bQo=
From hansfly at gmail.com  Wed Aug 26 02:53:55 2009
From: hansfly at gmail.com (Han He)
Date: Wed Aug 26 02:54:44 2009
Subject: [Slony1-general] is there any way to keep transaction replication
	atomic
Message-ID: <b0a602e60908260253o3c041b8an76720a9a586e96de@mail.gmail.com>

Hi Guys,



I encounter a problem when using slony. I had a transaction that updated
both table A and table B. This is atomic transaction. While slony is doing
the replication, on parent, the transaction is done, on slave node, there
might exists error which cause the transaction error. That=92s to say, on
slave node, table A is updated while table B is not updated. This will cause
problem to our application. Is there any way in slony to keep the
transaction atomic?



Thanks a lot

Han He
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090826/=
8a405468/attachment.htm
From damien at dalibo.info  Wed Aug 26 02:55:23 2009
From: damien at dalibo.info (damien@dalibo.info)
Date: Wed Aug 26 02:56:13 2009
Subject: [Slony1-general] Still can't checkout Slony1-www repository
In-Reply-To: <1251221296.10573.0.camel@hp-laptop2.gunduz.org>
References: <49ABA21E.5040404@dalibo.info>
	<4A8FA1BE.2050803@dalibo.info>	<4A9015ED.50302@pgexperts.com>
	<4A902AFB.3040406@dalibo.info>	<4A902E76.10303@pgexperts.com>
	<4A92C28C.1070603@ca.afilias.info>	<1251132455.18790.4.camel@hp-laptop2.gunduz.org>	<874orxkv64.fsf@dba2.int.libertyrms.com>	<1251217397.6307.8.camel@hp-laptop2.gunduz.org>	<87ab1nkedw.fsf@dba2.int.libertyrms.com>
	<1251221296.10573.0.camel@hp-laptop2.gunduz.org>
Message-ID: <4A95068B.70501@dalibo.info>

Devrim G?ND?Z a ?crit :
> On Tue, 2009-08-25 at 13:11 -0400, Christopher Browne wrote:
>> It might be worth mentioning what needed fixing, as when I went
>> looking for answers, I evidently did not find right answers.
> 
> chown -R cvsd:slony /home/cvsd/slony1/slony1-www
> 
> Also added to fixperms.sh for future reference.
> 
> Regards,
> 

it works !

Thanks a lot


-- 
damien clochard
http://dalibo.org | http://dalibo.com
From ajs at crankycanuck.ca  Wed Aug 26 05:17:52 2009
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Wed Aug 26 05:17:58 2009
Subject: [Slony1-general] is there any way to keep transaction
	replication atomic
In-Reply-To: <b0a602e60908260253o3c041b8an76720a9a586e96de@mail.gmail.com>
References: <b0a602e60908260253o3c041b8an76720a9a586e96de@mail.gmail.com>
Message-ID: <20090826121752.GB6533@shinkuro.com>

On Wed, Aug 26, 2009 at 05:53:55PM +0800, Han He wrote:
> I encounter a problem when using slony. I had a transaction that updated
> both table A and table B. This is atomic transaction. While slony is doing
> the replication, on parent, the transaction is done, on slave node, there
> might exists error which cause the transaction error. That?s to say, on
> slave node, table A is updated while table B is not updated. This will cause
> problem to our application. Is there any way in slony to keep the
> transaction atomic?

Apart from an actual hardware failure or something like that on the
replica, how would it be possible that the transaction would fail on
the replica but succeed on the origin?  If all the tables are
replicated from the origin to the replica, then the transaction ought
to succeed on the replica exactly as it does on the origin.  No?

A

-- 
Andrew Sullivan
ajs@crankycanuck.ca
From stuart at stuartbishop.net  Wed Aug 26 06:07:30 2009
From: stuart at stuartbishop.net (Stuart Bishop)
Date: Wed Aug 26 06:07:33 2009
Subject: [Slony1-general] is there any way to keep transaction replication
	atomic
In-Reply-To: <b0a602e60908260253o3c041b8an76720a9a586e96de@mail.gmail.com>
References: <b0a602e60908260253o3c041b8an76720a9a586e96de@mail.gmail.com>
Message-ID: <6bc73d4c0908260607t19337329of579a62d7de8d20e@mail.gmail.com>

2009/8/26 Han He <hansfly@gmail.com>:

> I encounter a problem when using slony. I had a transaction that updated
> both table A and table B. This is atomic transaction. While slony is doing
> the replication, on parent, the transaction is done, on slave node, there
> might exists error which cause the transaction error. That?s to say, on
> slave node, table A is updated while table B is not updated. This will cause
> problem to our application. Is there any way in slony to keep the
> transaction atomic?

If table A and table B are in the same replication set, the update is
atomic on the slave node too.

Of course, if this situation does happen (lack of disk space for
instance), replication stops and your slave lags until you fix the
problem.



-- 
Stuart Bishop <stuart@stuartbishop.net>
http://www.stuartbishop.net/
From hansfly at gmail.com  Wed Aug 26 07:07:08 2009
From: hansfly at gmail.com (Han He)
Date: Wed Aug 26 07:07:16 2009
Subject: [Slony1-general] is there any way to keep transaction replication
	atomic
In-Reply-To: <20090826121752.GB6533@shinkuro.com>
References: <b0a602e60908260253o3c041b8an76720a9a586e96de@mail.gmail.com>
	<20090826121752.GB6533@shinkuro.com>
Message-ID: <b0a602e60908260707n77c671ecs2ff6f79f4fde1fe1@mail.gmail.com>

Thanks for your response. I also believe that this situation seldom happen.
However if it does happen, the incomplete data in database might cause our
application not work or crash. This is unacceptable.

On Wed, Aug 26, 2009 at 8:17 PM, Andrew Sullivan <ajs@crankycanuck.ca>wrote:

> On Wed, Aug 26, 2009 at 05:53:55PM +0800, Han He wrote:
> > I encounter a problem when using slony. I had a transaction that updated
> > both table A and table B. This is atomic transaction. While slony is
> doing
> > the replication, on parent, the transaction is done, on slave node, the=
re
> > might exists error which cause the transaction error. That=92s to say, =
on
> > slave node, table A is updated while table B is not updated. This will
> cause
> > problem to our application. Is there any way in slony to keep the
> > transaction atomic?
>
> Apart from an actual hardware failure or something like that on the
> replica, how would it be possible that the transaction would fail on
> the replica but succeed on the origin?  If all the tables are
> replicated from the origin to the replica, then the transaction ought
> to succeed on the replica exactly as it does on the origin.  No?
>
> A
>
> --
> Andrew Sullivan
> ajs@crankycanuck.ca
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090826/=
df9621b8/attachment.htm
From hansfly at gmail.com  Wed Aug 26 07:14:58 2009
From: hansfly at gmail.com (Han He)
Date: Wed Aug 26 07:15:08 2009
Subject: [Slony1-general] is there any way to keep transaction replication
	atomic
In-Reply-To: <6bc73d4c0908260607t19337329of579a62d7de8d20e@mail.gmail.com>
References: <b0a602e60908260253o3c041b8an76720a9a586e96de@mail.gmail.com>
	<6bc73d4c0908260607t19337329of579a62d7de8d20e@mail.gmail.com>
Message-ID: <b0a602e60908260714k7d3c901cra4281cd66f0c4506@mail.gmail.com>

Thanks for your kind reply.
Actually what I mean 'atomic' is that, for example, if on parent, update
table A and table B, then slony trigger replication on slave node, update
table A succeed, however update table B fail, can slony rollback the table
A?

On Wed, Aug 26, 2009 at 9:07 PM, Stuart Bishop <stuart@stuartbishop.net>wro=
te:

> 2009/8/26 Han He <hansfly@gmail.com>:
>
> > I encounter a problem when using slony. I had a transaction that updated
> > both table A and table B. This is atomic transaction. While slony is
> doing
> > the replication, on parent, the transaction is done, on slave node, the=
re
> > might exists error which cause the transaction error. That=92s to say, =
on
> > slave node, table A is updated while table B is not updated. This will
> cause
> > problem to our application. Is there any way in slony to keep the
> > transaction atomic?
>
> If table A and table B are in the same replication set, the update is
> atomic on the slave node too.
>
> Of course, if this situation does happen (lack of disk space for
> instance), replication stops and your slave lags until you fix the
> problem.
>
>
>
> --
> Stuart Bishop <stuart@stuartbishop.net>
> http://www.stuartbishop.net/
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090826/=
4ceda48b/attachment-0001.htm
From stuart at stuartbishop.net  Wed Aug 26 07:29:04 2009
From: stuart at stuartbishop.net (Stuart Bishop)
Date: Wed Aug 26 07:29:13 2009
Subject: [Slony1-general] is there any way to keep transaction replication
	atomic
In-Reply-To: <b0a602e60908260714k7d3c901cra4281cd66f0c4506@mail.gmail.com>
References: <b0a602e60908260253o3c041b8an76720a9a586e96de@mail.gmail.com>
	<6bc73d4c0908260607t19337329of579a62d7de8d20e@mail.gmail.com>
	<b0a602e60908260714k7d3c901cra4281cd66f0c4506@mail.gmail.com>
Message-ID: <6bc73d4c0908260729u1bac664ftfc618ed5cb4d63cc@mail.gmail.com>

On Wed, Aug 26, 2009 at 9:14 PM, Han He<hansfly@gmail.com> wrote:
> Thanks for your kind reply.
> Actually what I mean 'atomic' is that, for example, if on parent, update
> table A and table B, then slony trigger replication on slave node, update
> table A succeed, however update table B fail, can slony rollback the table
> A?

rollback table A on the master or the slave?

With Slony, the following sequence happens when table A and table B
are in the same replication set:

On master:
  begin;
  update A set ....;
  update B set ...;
  commit;

[time passes]

On slave:
  begin;
  update A set ...;
  update B set ...;
  commit;

The updates on the slave do not start until after the transaction on
the master has committed.

So if you want the updates on the master be rolled back if the updates
on the slave fail, you cannot do that with an asynchronous replication
system like Slony. You need a synchronous replication system like
pgpool.

If you mean will the table A update on the slave be rolled back, that
is what happens. If you do not see this behavior, then either the
tables are in separate replication sets, or the updates on the master
were not atomic (perhaps the client was in auto commit mode?).


-- 
Stuart Bishop <stuart@stuartbishop.net>
http://www.stuartbishop.net/
From karl at denninger.net  Wed Aug 26 07:36:07 2009
From: karl at denninger.net (Karl Denninger)
Date: Wed Aug 26 07:37:59 2009
Subject: [Slony1-general] is there any way to keep transaction replication
	atomic
In-Reply-To: <b0a602e60908260714k7d3c901cra4281cd66f0c4506@mail.gmail.com>
References: <b0a602e60908260253o3c041b8an76720a9a586e96de@mail.gmail.com>	<6bc73d4c0908260607t19337329of579a62d7de8d20e@mail.gmail.com>
	<b0a602e60908260714k7d3c901cra4281cd66f0c4506@mail.gmail.com>
Message-ID: <4A954857.1000909@denninger.net>

Skipped content of type multipart/alternative-------------- next part -----=
---------
A non-text attachment was scrubbed...
Name: karl.vcf
Type: text/x-vcard
Size: 265 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20090826=
/6fc87059/karl.vcf
From hansfly at gmail.com  Wed Aug 26 07:47:06 2009
From: hansfly at gmail.com (Han He)
Date: Wed Aug 26 07:47:16 2009
Subject: [Slony1-general] is there any way to keep transaction replication
	atomic
In-Reply-To: <6bc73d4c0908260729u1bac664ftfc618ed5cb4d63cc@mail.gmail.com>
References: <b0a602e60908260253o3c041b8an76720a9a586e96de@mail.gmail.com>
	<6bc73d4c0908260607t19337329of579a62d7de8d20e@mail.gmail.com>
	<b0a602e60908260714k7d3c901cra4281cd66f0c4506@mail.gmail.com>
	<6bc73d4c0908260729u1bac664ftfc618ed5cb4d63cc@mail.gmail.com>
Message-ID: <b0a602e60908260747y163d9777t42768c4c67eff499@mail.gmail.com>

I meant rollback table A on the slave. Your answer is very useful. The
transaction will be atomic if table A and table B in the same replication
set. That's what I want. Thanks a lot.

On Wed, Aug 26, 2009 at 10:29 PM, Stuart Bishop <stuart@stuartbishop.net>wr=
ote:

> On Wed, Aug 26, 2009 at 9:14 PM, Han He<hansfly@gmail.com> wrote:
> > Thanks for your kind reply.
> > Actually what I mean 'atomic' is that, for example, if on parent, update
> > table A and table B, then slony trigger replication on slave node, upda=
te
> > table A succeed, however update table B fail, can slony rollback the
> table
> > A?
>
> rollback table A on the master or the slave?
>
> With Slony, the following sequence happens when table A and table B
> are in the same replication set:
>
> On master:
>  begin;
>  update A set ....;
>  update B set ...;
>  commit;
>
> [time passes]
>
> On slave:
>  begin;
>  update A set ...;
>  update B set ...;
>  commit;
>
> The updates on the slave do not start until after the transaction on
> the master has committed.
>
> So if you want the updates on the master be rolled back if the updates
> on the slave fail, you cannot do that with an asynchronous replication
> system like Slony. You need a synchronous replication system like
> pgpool.
>
> If you mean will the table A update on the slave be rolled back, that
> is what happens. If you do not see this behavior, then either the
> tables are in separate replication sets, or the updates on the master
> were not atomic (perhaps the client was in auto commit mode?).
>
>
> --
> Stuart Bishop <stuart@stuartbishop.net>
> http://www.stuartbishop.net/
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090826/=
638f754e/attachment.htm
From karl at denninger.net  Wed Aug 26 07:57:10 2009
From: karl at denninger.net (Karl Denninger)
Date: Wed Aug 26 07:58:52 2009
Subject: [Slony1-general] is there any way to keep transaction replication
	atomic
In-Reply-To: <b0a602e60908260747y163d9777t42768c4c67eff499@mail.gmail.com>
References: <b0a602e60908260253o3c041b8an76720a9a586e96de@mail.gmail.com>	<6bc73d4c0908260607t19337329of579a62d7de8d20e@mail.gmail.com>	<b0a602e60908260714k7d3c901cra4281cd66f0c4506@mail.gmail.com>	<6bc73d4c0908260729u1bac664ftfc618ed5cb4d63cc@mail.gmail.com>
	<b0a602e60908260747y163d9777t42768c4c67eff499@mail.gmail.com>
Message-ID: <4A954D46.3060706@denninger.net>

Han He wrote:
> I meant rollback table A on the slave. Your answer is very useful. The
> transaction will be atomic if table A and table B in the same
> replication set. That's what I want. Thanks a lot.
Yes and no Han.

Yes, the transaction does not go over the wire until the COMMIT happens
on the master.

No, if one or more of the updates fail on the slave the master will not
be rolled back (since there is no lock held on the master until the
slave(s) update to force that to happen - consider that the master could
have processed hundreds of ADDITIONAL transactions before the first one
gets to all the slaves and finishes.)  If that occurs then the slave
will effectively stop accepting further updates, so it will be "as the
master was at the time the first attempt failed" until the condition
that causes the failure (e.g. disk full) is cleared.

SLONY sends over a block of updates/changes as a transaction, with the
count of "how many" are in a block being determined by when the
transaction snapshots are taken (I and others use a timed job that
forces segregation to prevent an outage creating one monster transaction
that might never get across the wire, or might not for long enough as to
be effectively never.)

You can count on Slony guaranteeing ordering of changes on the slaves,
but not whether there is or is not a lag of some variable amount of time
between master and slave.

For my applications this is ok (if I look at a slave and see "as it was
2 minutes ago" that's not a problem) but it might be for your application.

You have to be very careful in an updating application to be sure that
you don't post conflicting updates from two sources at once (or before
the first one can propagate) with an inconsistent view between what's on
the slave and what's on the master - this CAN happen if you don't pay
close attention to what you're doing.


-------------- next part --------------
A non-text attachment was scrubbed...
Name: karl.vcf
Type: text/x-vcard
Size: 265 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20090826=
/5c853c65/karl.vcf
From hansfly at gmail.com  Wed Aug 26 08:44:19 2009
From: hansfly at gmail.com (Han He)
Date: Wed Aug 26 08:44:34 2009
Subject: [Slony1-general] is there any way to keep transaction replication
	atomic
In-Reply-To: <4A954D46.3060706@denninger.net>
References: <b0a602e60908260253o3c041b8an76720a9a586e96de@mail.gmail.com>
	<6bc73d4c0908260607t19337329of579a62d7de8d20e@mail.gmail.com>
	<b0a602e60908260714k7d3c901cra4281cd66f0c4506@mail.gmail.com>
	<6bc73d4c0908260729u1bac664ftfc618ed5cb4d63cc@mail.gmail.com>
	<b0a602e60908260747y163d9777t42768c4c67eff499@mail.gmail.com>
	<4A954D46.3060706@denninger.net>
Message-ID: <b0a602e60908260844n7ac72ca1le477f85737666fd0@mail.gmail.com>

Hi, Karl

Thanks a lot for your patient and helpful explanation. I do not quite
understand the mechanism of slony. I am a newbie on slony. From the previous
replies of you and others, I have the following conclusion. Am I right?

SLONY sends over a block of updates/changes as a transaction. In one
transaction, "a block of update/changes" is committed as a whole. The
scenario that one update/change succeed and others fail never happen.

Then I have another question.

Once there exists a block of updates/changes that application take them as a
whole. However if SLONY split them into two or more transactions. On the
slave node, one transaction succeed, while another might fail because of
network problem.

It seems this problem turns out to be that whether SLONY can define a
transaction clearly. Or how frequent does SLONY construct a transaction?

>From your last reply, you mean "I and others use a timed job that forces
segregation to prevent an outage creating one monster transaction that might
never get across the wire, or might not for long enough as to be effectively
never.".
How could I define a timed job for SLONY?


Thanks&Regards
Han He

On Wed, Aug 26, 2009 at 10:57 PM, Karl Denninger <karl@denninger.net> wrote:

> Han He wrote:
> > I meant rollback table A on the slave. Your answer is very useful. The
> > transaction will be atomic if table A and table B in the same
> > replication set. That's what I want. Thanks a lot.
> Yes and no Han.
>
> Yes, the transaction does not go over the wire until the COMMIT happens
> on the master.
>
> No, if one or more of the updates fail on the slave the master will not
> be rolled back (since there is no lock held on the master until the
> slave(s) update to force that to happen - consider that the master could
> have processed hundreds of ADDITIONAL transactions before the first one
> gets to all the slaves and finishes.)  If that occurs then the slave
> will effectively stop accepting further updates, so it will be "as the
> master was at the time the first attempt failed" until the condition
> that causes the failure (e.g. disk full) is cleared.
>
> SLONY sends over a block of updates/changes as a transaction, with the
> count of "how many" are in a block being determined by when the
> transaction snapshots are taken (I and others use a timed job that
> forces segregation to prevent an outage creating one monster transaction
> that might never get across the wire, or might not for long enough as to
> be effectively never.)
>
> You can count on Slony guaranteeing ordering of changes on the slaves,
> but not whether there is or is not a lag of some variable amount of time
> between master and slave.
>
> For my applications this is ok (if I look at a slave and see "as it was
> 2 minutes ago" that's not a problem) but it might be for your application.
>
> You have to be very careful in an updating application to be sure that
> you don't post conflicting updates from two sources at once (or before
> the first one can propagate) with an inconsistent view between what's on
> the slave and what's on the master - this CAN happen if you don't pay
> close attention to what you're doing.
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090826/=
9cd08d4d/attachment-0001.htm
From karl at denninger.net  Wed Aug 26 09:14:29 2009
From: karl at denninger.net (Karl Denninger)
Date: Wed Aug 26 09:16:17 2009
Subject: [Slony1-general] is there any way to keep transaction replication
	atomic
In-Reply-To: <b0a602e60908260844n7ac72ca1le477f85737666fd0@mail.gmail.com>
References: <b0a602e60908260253o3c041b8an76720a9a586e96de@mail.gmail.com>	
	<6bc73d4c0908260607t19337329of579a62d7de8d20e@mail.gmail.com>	
	<b0a602e60908260714k7d3c901cra4281cd66f0c4506@mail.gmail.com>	
	<6bc73d4c0908260729u1bac664ftfc618ed5cb4d63cc@mail.gmail.com>	
	<b0a602e60908260747y163d9777t42768c4c67eff499@mail.gmail.com>	
	<4A954D46.3060706@denninger.net>
	<b0a602e60908260844n7ac72ca1le477f85737666fd0@mail.gmail.com>
Message-ID: <4A955F65.40103@denninger.net>

Han He wrote:
> Hi, Karl
>
> Thanks a lot for your patient and helpful explanation. I do not quite
> understand the mechanism of slony. I am a newbie on slony. From the
> previous replies of you and others, I have the following conclusion.
> Am I right?
>
> SLONY sends over a block of updates/changes as a transaction. In one
> transaction, "a block of update/changes" is committed as a whole. The
> scenario that one update/change succeed and others fail never happen.
Correct, BUT Slony doesn't "know" when your application transactions are
committed.  In other words Slony's view of a "transaction" may contain
one or more application transactions.  You can control when Slony
considers a transaction for its purposes complete, but if you don't it
decides on its own.
> Then I have another question.
>
> Once there exists a block of updates/changes that application take
> them as a whole. However if SLONY split them into two or more
> transactions. On the slave node, one transaction succeed, while
> another might fail because of network problem.
>
> It seems this problem turns out to be that whether SLONY can define a
> transaction clearly. Or how frequent does SLONY construct a transaction?
On its own, unless you tell it otherwise, based on communication between
the clients and server.
>  =

> From your last reply, you mean "I and others use a timed job that
> forces segregation to prevent an outage creating one monster
> transaction that might never get across the wire, or might not for
> long enough as to be effectively never.".
> How could I define a timed job for SLONY?
>
I execute this on the master on a timed basis out of the cron:

/usr/local/pgsql/bin/generate_syncs.sh cluster-name localhost 5432
database-name

The script contains:

#!/bin/sh

# $Id: generate_syncs.sh,v 1.1 2004-11-25 21:57:18 cbbrowne Exp $

# Christopher Browne
# Afilias Canada
# 2004-11-15
# For the Slony-I project

# This script may be run every few minutes to force in syncs on a
# particular node.

# Supposing you have some possibly-flakey slon daemon that might not
# run all the time, you might return from a weekend away only to
# discover the following situation...

# On Friday night, something went "bump" and while the database came
# back up, none of the slon daemons survived.  Your online application
# then saw nearly three days worth of heavy transactions.

# When you restart slon on Monday, it hasn't done a SYNC on the master
# since Friday, so that the next "SYNC set" comprises all of the
# updates between Friday and Monday.  Yuck.

# If you run generate_syncs.sh as a cron job every 20 minutes, it will
# force in a periodic SYNC on the "master" server, which means that
# between Friday and Monday, the numerous updates are split into more
# than 100 syncs, which can be applied incrementally, making the
# cleanup a lot less unpleasant.

# Note that if SYNCs _are_ running regularly, this script won't bother
# doing anything.

export NAMESPACE=3D"_${1}"
export PGHOST=3D$2
export PGPORT=3D$3
export DATABASE=3D$4
INTERVAL=3D"10 minutes"   # Don't bother generating a SYNC if there has been
                        # one in the last $INTERVAL
PSQL=3D`which psql`    # Replace this with your favorite command to run psql

echo "select \"$NAMESPACE\".generate_sync_event('$INTERVAL');" | \
   ${PSQL} -h $PGHOST -p $PGPORT -d $DATABASE

------

The purpose behind this is as described in the comments; if there has
been a "sync event" generated in the last 10 minutes it does nothing,
otherwise, it generates a sync when run.  I run this out of the CRON
every 20 minutes so as to prevent the "day-long" transaction block if
fomr some reason (a long weekend, etc) I am not being particularly
attentive to the reporting that usually goes on.  (This shouldn't happen
as I also have a "surveillance" job that runs every couple hours and
emails me if it finds any SLONs down or a material backlog of
transactions, but you know Murphy and how he has a habit of showing up
at a bad time!) =


Since my replication systems are on the other end of a WAN it is
entirely possible for an extremely-long transaction, in an unstable
comms environment where a disruption may happen every few hours, to
never complete.  That would suck and this is what the script is intended
to avoid.

The general way to think of how SLONY deals with replication is that a
"Sync Set" comprises a transaction for SLONY.  Effectively, a "Sync Set"
has a "BEGIN/COMMIT" wrapped around it; if you look in your SLON logfile
you'll see each "block" of updates has a number of inserts, updates and
deletes reported on the detail line, one per update.

You could have the application execute the above SQL statement from the
script (with a "zero" interval - that should work although I haven't
attempted it) after each COMMIT in your application if you wanted to in
order to generate a SYNC SET for each committed transaction, but doing
so on a system with a lot of UPDATEs or INSERTs would generate an
obscene number of SYNC SET events.  I expect that it would also
dramatically reduce the latency between master and slave.  Be warned
that this may or may not have a nasty (and unacceptable) impact on
SLONYs performance - you'd have to benchmark it to see whether it does.

-- Karl

-------------- next part --------------
A non-text attachment was scrubbed...
Name: karl.vcf
Type: text/x-vcard
Size: 265 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20090826=
/1d830a37/karl.vcf
From kleptog at gmail.com  Thu Aug 27 06:57:14 2009
From: kleptog at gmail.com (Martijn van Oosterhout)
Date: Thu Aug 27 06:57:23 2009
Subject: [Slony1-general] Post-Replication Triggers
In-Reply-To: <7fd310d10908181447p7490358wdecb5ab4ce4481cd@mail.gmail.com>
References: <7fd310d10908181447p7490358wdecb5ab4ce4481cd@mail.gmail.com>
Message-ID: <2fc2c5f10908270657o5bda58chda44b95733ea5628@mail.gmail.com>

A bit late, but you can configure triggers so they are run on the
replica, the origin or both.

See ALTER TABLE ... ENABLE ... TRIGGER

Have a nice day,

On Tue, Aug 18, 2009 at 11:47 PM, Bryan Murphy<bmurphy1976@gmail.com> wrote:
> Is it possible to run triggers on secondary (slave) nodes that can be used
> to create de-normalized lookup data that does not exist in the master
> database? If slony can't do this, is there another replication platform that
> can?
> Thanks,
> Bryan
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>
>



-- 
Martijn van Oosterhout <kleptog@gmail.com> http://svana.org/kleptog/
From cbbrowne at ca.afilias.info  Thu Aug 27 07:54:32 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Thu Aug 27 07:54:45 2009
Subject: [Slony1-general] is there any way to keep transaction replication
	atomic
In-Reply-To: <b0a602e60908260714k7d3c901cra4281cd66f0c4506@mail.gmail.com>
References: <b0a602e60908260253o3c041b8an76720a9a586e96de@mail.gmail.com>	<6bc73d4c0908260607t19337329of579a62d7de8d20e@mail.gmail.com>
	<b0a602e60908260714k7d3c901cra4281cd66f0c4506@mail.gmail.com>
Message-ID: <4A969E28.4050904@ca.afilias.info>

Han He wrote:
> Thanks for your kind reply.
> Actually what I mean 'atomic' is that, for example, if on parent, 
> update table A and table B, then slony trigger replication on slave 
> node, update table A succeed, however update table B fail, can slony 
> rollback the table A?  
Actually, there's a stronger condition than that...

If the update to table B fails on the subscriber, Slony-I will roll the 
whole set of changes back, and is unable to NOT rollback the update to 
table A.
From korvus at comcast.net  Thu Aug 27 13:23:44 2009
From: korvus at comcast.net (Steve Polyack)
Date: Thu Aug 27 13:24:09 2009
Subject: [Slony1-general] Switchovers with Slony1-2.0.2
Message-ID: <4A96EB50.4030500@comcast.net>

Hi
I've recently been testing Slony-1 2.0.2 with PostgreSQL 8.3.7.  
Replication works great, but I can't seem to get it to perform a 
switchover.  Our typical switchover command set from Slony1-1.2 does not 
work:
node 1 admin conninfo=*
node 2 admin conninfo=*
node 3 admin conninfo=*
lock set (id=1, origin=1);
wait for event (origin=1, confirmed=2);
move set (id=1, old origin=1, new origin=2);
wait for event (origin=1, confirmed=2);

Executing the above produces:
<stdin>:3: Error: No admin conninfo provided for node -1
<stdin>:5: Error: No admin conninfo provided for node -1

Now, looking this up has led me to find that we now need to specify a 
'wait on=' option for the WAIT FOR EVENT commands.  However, after 
adding these (wait on = 1), I get another error after issuing the script:
$ slonik switch.slonik
switch.slonik:6: Error: script did not generate any event on node 1

The set is however locked on all nodes, so I'm unsure as to how this did 
not generate any events on Node 1.  Any ideas?

Thanks,
Steve Polyack

From f980215 at 163.com  Sun Aug 30 18:17:31 2009
From: f980215 at 163.com (f980215)
Date: Sun Aug 30 18:18:02 2009
Subject: [Slony1-general] Function slonyvacuumtable(name,
	name) does not exist
Message-ID: <32510981.41091251681451045.JavaMail.coremail@bj163app43.163.com>

SEksQUxMCgpJIGluc3RhbGwgc2xvbnlJLTIuMC4zLVJDMiAgb24gQ0VOVE9TIFY1LjIuIGFuZCBj
b25maWcgb25lIE1hc3RlciBhbmQgb25lIENsaWVudC4gV2hlbiAuL3Nsb25fc3RhcnQgMSAsIGZv
dW5kIHRoaXMgRVJST1IgCiAKMjAwOS0wOC0zMCAyMjozMjowNSBDU1QgSU5GTyAgIGNsZWFudXBU
aHJlYWQ6ICAgIDIuNTc1IHNlY29uZHMgZm9yIGNsZWFudXBFdmVudCgpCjIwMDktMDgtMzAgMjI6
MzI6MDUgQ1NUIERFQlVHMSBjbGVhbnVwVGhyZWFkOiBtaW54aWQ6IDM5NTMxCjIwMDktMDgtMzAg
MjI6MzI6MDYgQ1NUIEVSUk9SICBjbGVhbnVwVGhyZWFkOiAic2VsZWN0IG5zcG5hbWUsIHJlbG5h
bWUgZnJvbSAiX1JFUExfUzEiLlRhYmxlc1RvVmFjdXVtKCk7IiAtIEVSUk9SOiAgZnVuY3Rpb24g
X1JFUExfUzEuc2hvdWxkc2xvbnl2YWN1dW10YWJsZShuYW1lLCBuYW1lKSBkb2VzIG5vdCBleGlz
dApMSU5FIDE6IFNFTEVDVCAgIl9SRVBMX1MxIi5TaG91bGRTbG9ueVZhY3V1bVRhYmxlKCAkMSAs
ICAkMiApCiAgICAgICAgICAgICAgICBeCkhJTlQ6ICBObyBmdW5jdGlvbiBtYXRjaGVzIHRoZSBn
aXZlbiBuYW1lIGFuZCBhcmd1bWVudCB0eXBlcy4gWW91IG1pZ2h0IG5lZWQgdG8gYWRkIGV4cGxp
Y2l0IHR5cGUgY2FzdHMuClFVRVJZOiAgU0VMRUNUICAiX1JFUExfUzEiLlNob3VsZFNsb255VmFj
dXVtVGFibGUoICQxICwgICQyICkKQ09OVEVYVDogIFBML3BnU1FMIGZ1bmN0aW9uICJ0YWJsZXN0
b3ZhY3V1bSIgbGluZSA2IGF0IElGCjIwMDktMDgtMzAgMjI6MzI6MDYgQ1NUIERFQlVHMSBjbGVh
bnVwVGhyZWFkOiBudW1iZXIgb2YgdGFibGVzIHRvIGNsZWFuOiAwCjIwMDktMDgtMzAgMjI6MzI6
MDYgQ1NUIElORk8gICBjbGVhbnVwVGhyZWFkOiAgICAwLjkzNCBzZWNvbmRzIGZvciB2YWN1dW1p
bmcKClRoYW5rcyBmb3IgYW55IGhlbHAhCiBCL0cKZjk4MDIxNQotLS0tLS0tLS0tLS0tLSBuZXh0
IHBhcnQgLS0tLS0tLS0tLS0tLS0KQW4gSFRNTCBhdHRhY2htZW50IHdhcyBzY3J1YmJlZC4uLgpV
Ukw6IGh0dHA6Ly9saXN0cy5zbG9ueS5pbmZvL3BpcGVybWFpbC9zbG9ueTEtZ2VuZXJhbC9hdHRh
Y2htZW50cy8yMDA5MDgzMS9iODIxZTZhNC9hdHRhY2htZW50Lmh0bQo=
From f980215 at 163.com  Sun Aug 30 18:37:07 2009
From: f980215 at 163.com (f980215)
Date: Sun Aug 30 18:37:48 2009
Subject: [Slony1-general] Function slonyvacuumtable(name,
	name) does not exist
Message-ID: <23268538.53131251682627496.JavaMail.coremail@app197.163.com>

SEksQUxMCgpJIGluc3RhbGwgc2xvbnlJLTIuMC4zLVJDMiAgb24gQ0VOVE9TIFY1LjIuIGFuZCBj
b25maWcgb25lIE1hc3RlciBhbmQgb25lIENsaWVudC4gCgpXaGVuIC4vc2xvbl9zdGFydCAxICwg
Zm91bmQgdGhpcyBFUlJPUiAKIAoyMDA5LTA4LTMwIDIyOjMyOjA1IENTVCBJTkZPICAgY2xlYW51
cFRocmVhZDogICAgMi41NzUgc2Vjb25kcyBmb3IgY2xlYW51cEV2ZW50KCkKMjAwOS0wOC0zMCAy
MjozMjowNSBDU1QgREVCVUcxIGNsZWFudXBUaHJlYWQ6IG1pbnhpZDogMzk1MzEKMjAwOS0wOC0z
MCAyMjozMjowNiBDU1QgRVJST1IgIGNsZWFudXBUaHJlYWQ6ICJzZWxlY3QgbnNwbmFtZSwgcmVs
bmFtZSBmcm9tICJfUkVQTF9TMSIuVGFibGVzVG9WYWN1dW0oKTsiIC0gRVJST1I6ICBmdW5jdGlv
biBfUkVQTF9TMS5zaG91bGRzbG9ueXZhY3V1bXRhYmxlKG5hbWUsIG5hbWUpIGRvZXMgbm90IGV4
aXN0CkxJTkUgMTogU0VMRUNUICAiX1JFUExfUzEiLlNob3VsZFNsb255VmFjdXVtVGFibGUoICQx
ICwgICQyICkKICAgICAgICAgICAgICAgIF4KSElOVDogIE5vIGZ1bmN0aW9uIG1hdGNoZXMgdGhl
IGdpdmVuIG5hbWUgYW5kIGFyZ3VtZW50IHR5cGVzLiBZb3UgbWlnaHQgbmVlZCB0byBhZGQgZXhw
bGljaXQgdHlwZSBjYXN0cy4KUVVFUlk6ICBTRUxFQ1QgICJfUkVQTF9TMSIuU2hvdWxkU2xvbnlW
YWN1dW1UYWJsZSggJDEgLCAgJDIgKQpDT05URVhUOiAgUEwvcGdTUUwgZnVuY3Rpb24gInRhYmxl
c3RvdmFjdXVtIiBsaW5lIDYgYXQgSUYKMjAwOS0wOC0zMCAyMjozMjowNiBDU1QgREVCVUcxIGNs
ZWFudXBUaHJlYWQ6IG51bWJlciBvZiB0YWJsZXMgdG8gY2xlYW46IDAKMjAwOS0wOC0zMCAyMjoz
MjowNiBDU1QgSU5GTyAgIGNsZWFudXBUaHJlYWQ6ICAgIDAuOTM0IHNlY29uZHMgZm9yIHZhY3V1
bWluZwoKVGhhbmtzIGZvciBhbnkgaGVscCEKIEIvRwpmOTgwMjE1CgoKCsO709C547jmtcTW1cnt
w+K30dPKz+Qsd3d3LnllYWgubmV0Ci0tLS0tLS0tLS0tLS0tIG5leHQgcGFydCAtLS0tLS0tLS0t
LS0tLQpBbiBIVE1MIGF0dGFjaG1lbnQgd2FzIHNjcnViYmVkLi4uClVSTDogaHR0cDovL2xpc3Rz
LnNsb255LmluZm8vcGlwZXJtYWlsL3Nsb255MS1nZW5lcmFsL2F0dGFjaG1lbnRzLzIwMDkwODMx
LzEzOThiNTEyL2F0dGFjaG1lbnQuaHRtCg==
From f980215 at 163.com  Sun Aug 30 18:55:44 2009
From: f980215 at 163.com (f980215)
Date: Sun Aug 30 18:56:26 2009
Subject: [Slony1-general] slonyI-2.0.3 : Function slonyvacuumtable(name,
	name) does not exist
Message-ID: <000a01ca29de$29fd11d0$bf12a8c0@zm>

HI,ALL

I install slonyI-2.0.3-RC2  on CENTOS V5.2. and config one Master and one Client. When ./slon_start 1 , found this ERROR 
 
2009-08-30 22:32:05 CST INFO   cleanupThread:    2.575 seconds for cleanupEvent()
2009-08-30 22:32:05 CST DEBUG1 cleanupThread: minxid: 39531
2009-08-30 22:32:06 CST ERROR  cleanupThread: "select nspname, relname from "_REPL_S1".TablesToVacuum();" - ERROR:  function _REPL_S1.shouldslonyvacuumtable(name, name) does not exist
LINE 1: SELECT  "_REPL_S1".ShouldSlonyVacuumTable( $1 ,  $2 )
                ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
QUERY:  SELECT  "_REPL_S1".ShouldSlonyVacuumTable( $1 ,  $2 )
CONTEXT:  PL/pgSQL function "tablestovacuum" line 6 at IF
2009-08-30 22:32:06 CST DEBUG1 cleanupThread: number of tables to clean: 0
2009-08-30 22:32:06 CST INFO   cleanupThread:    0.934 seconds for vacuuming

Thanks for any help!
 B/G
f980215
From cbbrowne at ca.afilias.info  Mon Aug 31 08:17:51 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Mon Aug 31 08:18:15 2009
Subject: [Slony1-general] slonyI-2.0.3 : Function slonyvacuumtable(name,
	name) does not exist
In-Reply-To: <000a01ca29de$29fd11d0$bf12a8c0@zm>
References: <000a01ca29de$29fd11d0$bf12a8c0@zm>
Message-ID: <4A9BE99F.2060302@ca.afilias.info>

f980215 wrote:
> HI,ALL
>
> I install slonyI-2.0.3-RC2  on CENTOS V5.2. and config one Master and one Client. When ./slon_start 1 , found this ERROR 
>  
> 2009-08-30 22:32:05 CST INFO   cleanupThread:    2.575 seconds for cleanupEvent()
> 2009-08-30 22:32:05 CST DEBUG1 cleanupThread: minxid: 39531
> 2009-08-30 22:32:06 CST ERROR  cleanupThread: "select nspname, relname from "_REPL_S1".TablesToVacuum();" - ERROR:  function _REPL_S1.shouldslonyvacuumtable(name, name) does not exist
> LINE 1: SELECT  "_REPL_S1".ShouldSlonyVacuumTable( $1 ,  $2 )
>                 ^
> HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
> QUERY:  SELECT  "_REPL_S1".ShouldSlonyVacuumTable( $1 ,  $2 )
> CONTEXT:  PL/pgSQL function "tablestovacuum" line 6 at IF
> 2009-08-30 22:32:06 CST DEBUG1 cleanupThread: number of tables to clean: 0
> 2009-08-30 22:32:06 CST INFO   cleanupThread:    0.934 seconds for vacuuming
>
> Thanks for any help!
>  B/G
> f980215
Fix for this just committed.
http://lists.slony.info/pipermail/slony1-commit/2009-August/002711.html
From korvus at comcast.net  Mon Aug 31 13:35:50 2009
From: korvus at comcast.net (Steve Polyack)
Date: Mon Aug 31 13:36:13 2009
Subject: [Slony1-general] Re: Switchovers with Slony1-2.0.2
In-Reply-To: <4A96EB50.4030500@comcast.net>
References: <4A96EB50.4030500@comcast.net>
Message-ID: <4A9C3426.5010202@comcast.net>

Steve Polyack wrote:
> Hi
> I've recently been testing Slony-1 2.0.2 with PostgreSQL 8.3.7.  
> Replication works great, but I can't seem to get it to perform a 
> switchover.  Our typical switchover command set from Slony1-1.2 does 
> not work:
> node 1 admin conninfo=*
> node 2 admin conninfo=*
> node 3 admin conninfo=*
> lock set (id=1, origin=1);
> wait for event (origin=1, confirmed=2);
> move set (id=1, old origin=1, new origin=2);
> wait for event (origin=1, confirmed=2);
>
> Executing the above produces:
> <stdin>:3: Error: No admin conninfo provided for node -1
> <stdin>:5: Error: No admin conninfo provided for node -1
>
> Now, looking this up has led me to find that we now need to specify a 
> 'wait on=' option for the WAIT FOR EVENT commands.  However, after 
> adding these (wait on = 1), I get another error after issuing the script:
> $ slonik switch.slonik
> switch.slonik:6: Error: script did not generate any event on node 1
>
> The set is however locked on all nodes, so I'm unsure as to how this 
> did not generate any events on Node 1.  Any ideas?
>
> Thanks,
> Steve Polyack
>
If anyone cares, I was able to fix this by getting rid of the first 
"wait for event" command.  My switchover script now looks like this and 
works as expected:
 node 1 admin conninfo=* 
 node 2 admin conninfo=*
 node 3 admin conninfo=*
 lock set (id=1, origin=1);
 move set (id=1, old origin=1, new origin=2);
 wait for event (origin=1, confirmed=2, wait on=1);

Perhaps locking the set is no longer considered an event.  Regardless, 
the switchover documentation for Slony 2.0.2 
(http://slony.info/documentation/failover.html) lists neither of these 
two caveats.



