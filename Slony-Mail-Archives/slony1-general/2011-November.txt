From ssinger at ca.afilias.info  Wed Nov  2 07:30:21 2011
From: ssinger at ca.afilias.info (Steve Singer)
Date: Wed, 02 Nov 2011 10:30:21 -0400
Subject: [Slony1-general] Trouble installing Slony on Solaris
In-Reply-To: <1320056223.11405.YahooMailNeo@web121218.mail.ne1.yahoo.com>
References: <1320056223.11405.YahooMailNeo@web121218.mail.ne1.yahoo.com>
Message-ID: <4EB153FD.7020306@ca.afilias.info>

On 11-10-31 06:17 AM, Venkat Nag wrote:
> Hello Everyone,
>
> This is my first post to the Slony Community.
>
> Can someone please help me get a Slony build for Sun Solaris ?
>

What issues are you encountering?

I think I was successfully  able to build recent slony 2.0.7 versions on 
Solaris with both gcc and the sun compiler.



> Thanks
> VBN
>
>
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


From wernergiam at yahoo.com  Wed Nov  2 15:59:07 2011
From: wernergiam at yahoo.com (chern wei giam)
Date: Wed, 2 Nov 2011 15:59:07 -0700 (PDT)
Subject: [Slony1-general] (no subject)
Message-ID: <1320274747.69887.yint-ygo-j2me@web110501.mail.gq1.yahoo.com>

http://ahlussunnah.cl/group/protect/markehjf.htm

From vitaliy.se at gmail.com  Mon Nov  7 13:54:45 2011
From: vitaliy.se at gmail.com (Vitaliy Semochkin)
Date: Tue, 8 Nov 2011 00:54:45 +0300
Subject: [Slony1-general] continue replication in after connection problem
	with slony
Message-ID: <CAHyKpfNs3bx524=GQE=fRq3qcSQrhyr6feiL60Fjs4DH=DCMCA@mail.gmail.com>

Hello,

I have 2 postgresql servers, ONE is used for read and write
operations, while the OTHER is used for read only operations.

I want all updates for several tables on  ONE to be transferred to the OTHER.
In case the ONE or the OTHER goes off line or there is a connection
problems, I want those updates to be transferred as soon as server
goes on line.

Is it possible to perform such replication using Slony?
If it is so, where to dig? ;-)

Thanks in Advance,
Vitaliy S

From vitaliy.se at gmail.com  Mon Nov  7 13:57:10 2011
From: vitaliy.se at gmail.com (Vitaliy Semochkin)
Date: Tue, 8 Nov 2011 00:57:10 +0300
Subject: [Slony1-general] continue replication in after connection problem
 with slony (sorry, if I duplicated the question)
Message-ID: <CAHyKpfNntvfm9PVeeTu9f1h1LNqyD1y7_R9eXT5SsFPHSs87LQ@mail.gmail.com>

Hello,

I have 2 postgresql servers, ONE is used for read and write
operations, while the OTHER is used for read only operations.

I want all updates for several tables on  ONE to be transferred to the OTHER.
In case the ONE or the OTHER goes off line or there is a connection
problems, I want those updates to be transferred as soon as server
goes on line.

Is it possible to perform such replication using Slony?
If it is so, where to dig? ;-)

Thanks in Advance,
Vitaliy S

From cbbrowne at afilias.info  Mon Nov  7 14:24:37 2011
From: cbbrowne at afilias.info (Christopher Browne)
Date: Mon, 7 Nov 2011 17:24:37 -0500
Subject: [Slony1-general] continue replication in after connection
 problem with slony (sorry, if I duplicated the question)
In-Reply-To: <CAHyKpfNntvfm9PVeeTu9f1h1LNqyD1y7_R9eXT5SsFPHSs87LQ@mail.gmail.com>
References: <CAHyKpfNntvfm9PVeeTu9f1h1LNqyD1y7_R9eXT5SsFPHSs87LQ@mail.gmail.com>
Message-ID: <CANfbgbb4CurPTdmtWUoYyzvmv9iXJnquD7GJXsniQpd=kVwBbw@mail.gmail.com>

On Mon, Nov 7, 2011 at 4:57 PM, Vitaliy Semochkin <vitaliy.se at gmail.com> wrote:
> Hello,
>
> I have 2 postgresql servers, ONE is used for read and write
> operations, while the OTHER is used for read only operations.
>
> I want all updates for several tables on ?ONE to be transferred to the OTHER.
> In case the ONE or the OTHER goes off line or there is a connection
> problems, I want those updates to be transferred as soon as server
> goes on line.
>
> Is it possible to perform such replication using Slony?
> If it is so, where to dig? ;-)

Well, what Slony does sounds somewhat like an interpretation of this...

Supposing there are two servers:
 - Node #1, used for read and write, which is defined as the origin
 - Node #2, used only for read access, defined as subscriber/replica

That's a very standard Slony configuration.

If node #1 goes down, then there are two choices:

a) Wait until it comes back.  (e.g. - if the problem is a minor one).

In that case, updates will be transferred from #1 (origin) to #2
(subscriber) as soon as node #1 comes back on line.  (It may be
necessary to restart a slon process too; if it has some sort of
watchdog watching it, that's easy to make happen.  There's a script
for that...)

b) Give up on node #1 (e.g. - if the problem is a major one).

In that case, you need to submit a FAILOVER script (using
slony.info/documentation/2.1/stmtfailover.html) to turn node #2 into
the origin node.

At that point, node #1 is to be treated as destroyed.

There is no c)  :-)

Slony doesn't try to provide multimaster replication; while there are
ways of having *some* traffic going in both directions between nodes,
that needs to involve mutually disjoint sets of tables.

If case a) describes what you're thinking of, then Slony does what you
want.  If you're thinking of a "case c)," then perhaps not so much.

From vbnpg at yahoo.com  Tue Nov  8 03:01:52 2011
From: vbnpg at yahoo.com (Venkat Nag)
Date: Tue, 8 Nov 2011 03:01:52 -0800 (PST)
Subject: [Slony1-general] Trouble installing Slony on Solaris
In-Reply-To: <4EB153FD.7020306@ca.afilias.info>
References: <1320056223.11405.YahooMailNeo@web121218.mail.ne1.yahoo.com>
	<4EB153FD.7020306@ca.afilias.info>
Message-ID: <1320750112.38401.YahooMailNeo@web121214.mail.ne1.yahoo.com>

Hi Steven,

Thanks for the reply !

I faced issues in installing Slony on Solaris.

I tried compiling Slony binaries with Postgres binaries and was able to install it.

Thanks
VB


________________________________
From: Steve Singer <ssinger at ca.afilias.info>
To: Venkat Nag <vbnpg at yahoo.com>
Cc: "slony1-general at lists.slony.info" <slony1-general at lists.slony.info>
Sent: Wednesday, November 2, 2011 8:00 PM
Subject: Re: [Slony1-general] Trouble installing Slony on Solaris

On 11-10-31 06:17 AM, Venkat Nag wrote:
> Hello Everyone,
>
> This is my first post to the Slony Community.
>
> Can someone please help me get a Slony build for Sun Solaris ?
>

What issues are you encountering?

I think I was successfully? able to build recent slony 2.0.7 versions on 
Solaris with both gcc and the sun compiler.



> Thanks
> VBN
>
>
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20111108/2af4c338/attachment.htm 

From vivek at khera.org  Tue Nov  8 08:05:02 2011
From: vivek at khera.org (Vick Khera)
Date: Tue, 8 Nov 2011 11:05:02 -0500
Subject: [Slony1-general] continue replication in after connection
 problem with slony
In-Reply-To: <CAHyKpfNs3bx524=GQE=fRq3qcSQrhyr6feiL60Fjs4DH=DCMCA@mail.gmail.com>
References: <CAHyKpfNs3bx524=GQE=fRq3qcSQrhyr6feiL60Fjs4DH=DCMCA@mail.gmail.com>
Message-ID: <CALd+dcd1sbad8qHqZT=yORU6TuT_DZQQeUqH31zCarNh7TEjhw@mail.gmail.com>

On Mon, Nov 7, 2011 at 4:54 PM, Vitaliy Semochkin <vitaliy.se at gmail.com> wrote:
> Is it possible to perform such replication using Slony?
> If it is so, where to dig? ;-)
>

That's how slony works out of the box.  The only issue you may have is
if there is a slow WAN link between the servers, and you have lots and
lots of updates.  If there is a significant time of disconnection
between the two, the backlog of change may be too great to apply.
Sometimes it is faster to start from scratch in those situations.

From l.rame at griensu.com  Tue Nov  8 12:21:02 2011
From: l.rame at griensu.com (Leonardo =?iso-8859-1?Q?M=2E_Ram=E9?=)
Date: Tue, 8 Nov 2011 17:21:02 -0300
Subject: [Slony1-general] New user question
Message-ID: <20111108202102.GB7215@leonardo-laptop.router31ff80.com>

Hi, we have one application connected to a local PostgreSql server and
we are facing the need to allow a remote site's users to use the
application. As a point-to-point connection is really expensive, we're
looking for other solutions, like replication.

On each site ~25 clients are connected to the server doing reads and
writes, and we would like to synchronize both servers, so, for example
if a new record is added on Site1, in about 15minutes, that record must
appear on Site2, and viceversa.

Is this possible with Slony-I?.

Thanks in advance,
-- 
Leonardo M. Ram?
Medical IT - Griensu S.A.
Av. Col?n 636 - Piso 8 Of. A
X5000EPT -- C?rdoba
Tel.: +54(351)4246924 +54(351)4247788 +54(351)4247979 int. 19
Cel.: +54(351)156629292


From cbbrowne at afilias.info  Tue Nov  8 14:18:29 2011
From: cbbrowne at afilias.info (Christopher Browne)
Date: Tue, 8 Nov 2011 17:18:29 -0500
Subject: [Slony1-general] New user question
In-Reply-To: <20111108202102.GB7215@leonardo-laptop.router31ff80.com>
References: <20111108202102.GB7215@leonardo-laptop.router31ff80.com>
Message-ID: <CANfbgbamuyfFj6gTZPM+diA1YZbuR_Y+qBJ+xgfbFF4OOvSR-A@mail.gmail.com>

On Tue, Nov 8, 2011 at 3:21 PM, Leonardo M. Ram? <l.rame at griensu.com> wrote:
> Hi, we have one application connected to a local PostgreSql server and
> we are facing the need to allow a remote site's users to use the
> application. As a point-to-point connection is really expensive, we're
> looking for other solutions, like replication.
>
> On each site ~25 clients are connected to the server doing reads and
> writes, and we would like to synchronize both servers, so, for example
> if a new record is added on Site1, in about 15minutes, that record must
> appear on Site2, and viceversa.
>
> Is this possible with Slony-I?.

Unfortunately, the "vice versa" part is not possible.

Slony-I is a *single* master to multiple subscribers replication
system; it does not try to address the multimaster problem.

What reasonably works is for site #1 to be the "master," and for that
data to appear reasonably quickly at site #2.

There are ways of approximating multimaster replication with Slony-I,
but it quickly gets pretty involved, and you need to effectively
design that into your application.

From mfwilson at gmail.com  Wed Nov  9 10:19:41 2011
From: mfwilson at gmail.com (Mike Wilson)
Date: Wed, 9 Nov 2011 10:19:41 -0800
Subject: [Slony1-general] fetch 500 from LOG
Message-ID: <5123FC12-8F82-49E7-AEC5-29BAE65C758F@gmail.com>

Seeing "fetch 500 from LOG" almost continuously in my PG logs for a new Slony 2.0.7 install.  The previous version (2.0.3?) didn't show these messages in the PG log.  Researching the issue, historically, this message was usually accompanied by a performance issue.  This isn't the case with my databases though, they appear to be running just as well as ever and the lag between replicated nodes appears to be about the same as the previous version.

I guess my question is what does this message mean in this version of Slony?  Is it an indication of sub-optimal slon parameters?
slon -g 20 $SLON_CLUSTER "host=$HOSTNAME port=$PORT dbname=$DB user=$USER"

And how can I get rid of it if it's not an issue?    

Mike 






From l.rame at griensu.com  Wed Nov  9 11:09:12 2011
From: l.rame at griensu.com (Leonardo =?iso-8859-1?Q?M=2E_Ram=E9?=)
Date: Wed, 9 Nov 2011 16:09:12 -0300
Subject: [Slony1-general] New user question
In-Reply-To: <CANfbgbamuyfFj6gTZPM+diA1YZbuR_Y+qBJ+xgfbFF4OOvSR-A@mail.gmail.com>
References: <20111108202102.GB7215@leonardo-laptop.router31ff80.com>
	<CANfbgbamuyfFj6gTZPM+diA1YZbuR_Y+qBJ+xgfbFF4OOvSR-A@mail.gmail.com>
Message-ID: <20111109190912.GA2979@leonardo-laptop>

On 2011-11-08 17:18:29 -0500, Christopher Browne wrote:
> On Tue, Nov 8, 2011 at 3:21 PM, Leonardo M. Ram? <l.rame at griensu.com> wrote:
> > Hi, we have one application connected to a local PostgreSql server and
> > we are facing the need to allow a remote site's users to use the
> > application. As a point-to-point connection is really expensive, we're
> > looking for other solutions, like replication.
> >
> > On each site ~25 clients are connected to the server doing reads and
> > writes, and we would like to synchronize both servers, so, for example
> > if a new record is added on Site1, in about 15minutes, that record must
> > appear on Site2, and viceversa.
> >
> > Is this possible with Slony-I?.
> 
> Unfortunately, the "vice versa" part is not possible.
> 
> Slony-I is a *single* master to multiple subscribers replication
> system; it does not try to address the multimaster problem.
> 
> What reasonably works is for site #1 to be the "master," and for that
> data to appear reasonably quickly at site #2.
> 
> There are ways of approximating multimaster replication with Slony-I,
> but it quickly gets pretty involved, and you need to effectively
> design that into your application.

Thanks Christopher, I didn't know the types of replication. Now I'm sure
I need multiple-master replication, knowing this I'll take a look at
Burcado.

-- 
Leonardo M. Ram?
Medical IT - Griensu S.A.
Av. Col?n 636 - Piso 8 Of. A
X5000EPT -- C?rdoba
Tel.: +54(351)4246924 +54(351)4247788 +54(351)4247979 int. 19
Cel.: +54(351)156629292


From cbbrowne at afilias.info  Wed Nov  9 15:14:25 2011
From: cbbrowne at afilias.info (Christopher Browne)
Date: Wed, 9 Nov 2011 18:14:25 -0500
Subject: [Slony1-general] Revision to DDL handling
Message-ID: <CANfbgbYTgrAq4S8GuEf=pqZdNK8phdpJB3L2T_7VDYC7L5FeMA@mail.gmail.com>

I have gotten around to poking at fairly old bug #137
<http://www.slony.info/bugzilla/show_bug.cgi?id=137>, which heads
towards a quite different implementation of DDL handling in Slony-I
version 2.2.

Where, in 2.0 and 2.1, the process of applying DDL looked like:

 - Start running a DDL event
    - Take the list of SQL statements out of the event, splitting them
into individual queries
    - For each query
      - Run the query

With some vagueness as to what happens if update activity is being
logged concurrently in sl_log_{1,2}.  (I'm not sure whether the
updates are applied *before* or *after* the DDL; neither is
necessarily the right answer!)

In 2.2, we add a new table, sl_log_script, which is used to capture
the SQL statements with exactly the same transaction and ordering
information used to control ordering of log application of log data in
sl_log_{1,2}.

This changes the semantics a bit, but, we think, in a pretty well
unambiguously better way.

It actually makes it easier to do DDL handling; we have a wrapper
function, ddlCapture(), which drops the DDL into the new table.  A
clever administrator might use exactly the same function to run their
own favorite bit of DDL and have it run exactly as it would have been
had they used slonik EXECUTE SCRIPT.

There is a change to EXECUTE SCRIPT; it becomes rather more meaningful
to use the EXECUTE ONLY ON option, and to have that be a list of
nodes, rather than just a single node.

And here's where a question opens...

The way I have initially implemented the new form of EXECUTE SCRIPT is
to request a specific list of nodes.

Thus:

EXECUTE SCRIPT (set id=1, filename='/tmp/my-ddl-script.sql', event
node=2, execute only on = '2,3,4');

My colleagues have suggested that perhaps we'd like to have the option
of a script running only on the subscribers to a single set.

I imagine this might be handled via a syntax like:
    EXECUTE SCRIPT (set id=1, filename='/tmp/my-ddl-script.sql', event
node=2, execute only on = set nodes);

But I also imagine that this may be overkill.  Creating a syntax
specifically for the case of running just on a certain set's nodes may
be adding a complication that no one really cares to use.

Does anyone feel strongly about this?  If not, then my inclination is
to have just two behaviours:
  a) Run the script on ALL nodes, as a default behaviour
  b) Run on a specified list of nodes, e.g. - EXECUTE ONLY ON='2,3,4'

If anyone badly wants an option c), I'd appreciate hearing so.

Though I'm ready to argue "but if you don't know what your set of
nodes are, I think you're in deep, deep trouble..."

From brianf at consistentstate.com  Wed Nov  9 16:49:08 2011
From: brianf at consistentstate.com (Brian Fehrle)
Date: Wed, 09 Nov 2011 17:49:08 -0700
Subject: [Slony1-general] Upgrade from 1.2 to 2.1 questions.
Message-ID: <4EBB1F84.1010904@consistentstate.com>

Hi all, I have a few questions about upgrading to a newer version of slony.

I have a group of systems that are on slony version 1.2.21, and postgres 
8.4. We'd like to upgrade to the latest slony release, 2.1.0.

First question, has slony 2.1.0 shown to be stable and work well for 
everyone? Would it be smarter to go with the latest of 2.0 series before 
jumping on 2.1, or is 2.1 less of a 'major release' type that I may be 
thinking it is?

Also, upgrading from 1.2.21 straight to 2.1, I see via this page 
(http://slony.info/documentation/2.1/slonyupgrade.html) it seems to 
suggest going the path of just dropping every node from the slony 
cluster, installing the new binaries, then setting it up again from 
scratch on the new version. Is this the best / most suggested upgrade 
path, and is upgrading from 1.2 to 2.1 such a major change that it's 
just not recommended to try to migrate an existing cluster? (it's pretty 
much answered in that page, but would like any other opinions from 
anyone who may have upgraded already).


These seem to be more of opinion based questions, what do you all think?

Thanks in advance,
- Brian F

From brianf at consistentstate.com  Wed Nov  9 17:07:09 2011
From: brianf at consistentstate.com (Brian Fehrle)
Date: Wed, 09 Nov 2011 18:07:09 -0700
Subject: [Slony1-general] Materialized view on replicated tables.
Message-ID: <4EBB23BD.1020804@consistentstate.com>

Hi all,

I've been testing the theory of having a materialized view set up to be 
on two replicated tables in slony. The purpose of the materialized view 
is to replace a standard view that is just dog slow. I got my test 
system working with a few hitches, and would like any feedback / 
thoughts / warnings to see if this is a bad idea to do in the first place.

First off, I'm currently testing in slony version 1.2.21 on postgres 
8.3, but the hope would to be eventually on slony 2.1 and postgres 8.4, 
so anything I do would hopefully be compatable with that setup also.

So in my test environment I set up two base tables, a users table and a 
services table. The users table has a column that is a foreign key 
linked to the services table. I then created a view table that retrieves 
two columns from each table, with a join on that foreign key. I then set 
up 3 separate triggers on the 'users' table that modify all data in my 
view table on any INSERTS, UPDATES, and DELETES.

I set up the DDL for these three tables, including the functions and 
triggers, on two boxes. I then set up a slony cluster on the two 
machines, designating one as the master, and one as the slave. he moment 
I start the two slon daemons, and the initial copy happens to bring the 
slave up to date to the master, the 3 triggers I created on the slave 
table are removed. These triggers are not removed on the slony master, 
but only the slave.

First question, is there a way to not let this happen. I know newer 
versions of slony have an OMIT COPY, but does that also apply to 
removing triggers too? If so, I would still need to get the slave table 
up to date with the master anyways, a whole different issue.

So after this happened, I re-applied my triggers to the slave table, and 
started inserting/updating/deleting data on the master. In this test 
that I set up, the materialized view on the slave was successfully 
updated as I would hope, so everything looks good in my test.

It was mentioned in the postgres IRC that slony handles updates 
differently than I may think. I turned log_min_duration statement to 0 
on the slave so I can catch it, but I actually couldn't find it. The 
update in my test environment worked, but the real environment that this 
may be pushed to will have dozens of triggers on 9 or more tables, so my 
test may not be very handy in confirming that this will even work.

So with his, I have two more questions:
1. My test materialized view is simple, but the real one would be 
complex (9 or more tables with 3 triggers on each possibly). Are there 
any 'gotchas' or 'warnings' that would make me even rethink attempting this?

2. If I preform a switchover from the master to the slave, would the act 
of switching over cause my triggers to disappear like they did when I 
set up the cluster (I haven't had a chance to test this yet on my test 
environment). And if I do a switchover, since the slave (now master) 
view is not technically part of replication, would there be chance of it 
becoming out of sync with the tables it's a view of? Also, when the 
master becomes the slave, the hope would be that the view continues to 
be updated then the tables are updated via slony.

thanks for any thoughts / opinions on this,
- Brian F

