From ajs at crankycanuck.ca  Wed Oct  1 07:04:43 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Wed Oct  1 07:04:51 2008
Subject: [Slony1-general] Binary COPY in slony?
In-Reply-To: <8536F69C1FCC294B859D07B179F069440FBA20FC@EXCHANGE.ad.wsicorp.com>
References: <8536F69C1FCC294B859D07B179F069440FBA20FC@EXCHANGE.ad.wsicorp.com>
Message-ID: <20081001140237.GA33117@crankycanuck.ca>

On Tue, Sep 30, 2008 at 09:40:14AM -0400, Knight, Doug wrote:
> All,
> 
> Is there a way to have slony do its COPY statements using binary mode?
> We have some very large binary tables that might benefit from the
> performance of the binary COPY.

Not today.  There's no way for a Slony node to know that the other end
of the COPY is binary-compatible.


-- 
Andrew Sullivan
ajs@commandprompt.com
+1 503 667 4564 x104
http://www.commandprompt.com/
From dknight at wsi.com  Wed Oct  1 07:10:58 2008
From: dknight at wsi.com (Knight, Doug)
Date: Wed Oct  1 07:12:14 2008
Subject: [Slony1-general] Binary COPY in slony?
In-Reply-To: <20081001140237.GA33117@crankycanuck.ca>
References: <8536F69C1FCC294B859D07B179F069440FBA20FC@EXCHANGE.ad.wsicorp.com>
	<20081001140237.GA33117@crankycanuck.ca>
Message-ID: <8536F69C1FCC294B859D07B179F069440FBA2B82@EXCHANGE.ad.wsicorp.com>

What would I have to do to tweak slony to use binary, for my specific
situation? I built from source, is there a localized area in the code
where I could modify it for my use?

Doug

-----Original Message-----
From: slony1-general-bounces@lists.slony.info
[mailto:slony1-general-bounces@lists.slony.info] On Behalf Of Andrew
Sullivan
Sent: Wednesday, October 01, 2008 10:05 AM
To: slony1-general@lists.slony.info
Subject: Re: [Slony1-general] Binary COPY in slony?

On Tue, Sep 30, 2008 at 09:40:14AM -0400, Knight, Doug wrote:
> All,
> 
> Is there a way to have slony do its COPY statements using binary mode?
> We have some very large binary tables that might benefit from the
> performance of the binary COPY.

Not today.  There's no way for a Slony node to know that the other end
of the COPY is binary-compatible.


-- 
Andrew Sullivan
ajs@commandprompt.com
+1 503 667 4564 x104
http://www.commandprompt.com/
_______________________________________________
Slony1-general mailing list
Slony1-general@lists.slony.info
http://lists.slony.info/mailman/listinfo/slony1-general

From JAmiel at istreamimaging.com  Wed Oct  1 11:08:21 2008
From: JAmiel at istreamimaging.com (Jeff Amiel)
Date: Wed Oct  1 11:08:32 2008
Subject: [Slony1-general] subscriber question
Message-ID: <C17A452040EDB84AA7A10AEA334E3E1455D20D@AD1>

I'm about to attempt to do some DR testing...and my goal was to take one
of my subscriber nodes, dump it, load it in another instance and point
my DR app server at it and watch the magic happen.

However...I got a little scared after reading this:

http://www.slony.info/documentation/faq.html#AEN6553

(specifically related to my own table triggers)

Let's assume my origin is 'gone' (destroyed in a nuclear burst)....I
have no way to 'dump' the subscriber node?  

In my case I 'may' have hand-added triggers to the subscriber node (as
well as origin) at one point without using slonik execute_script.....

That makes this harder, I assume...

Any advice?

Jeff
From plk.zuber at gmail.com  Wed Oct  1 13:31:02 2008
From: plk.zuber at gmail.com (=?UTF-8?Q?Filip_Rembia=C5=82kowski?=)
Date: Wed Oct  1 13:31:18 2008
Subject: [Slony1-general] Binary COPY in slony?
In-Reply-To: <8536F69C1FCC294B859D07B179F069440FBA2B82@EXCHANGE.ad.wsicorp.com>
References: <8536F69C1FCC294B859D07B179F069440FBA20FC@EXCHANGE.ad.wsicorp.com>
	<20081001140237.GA33117@crankycanuck.ca>
	<8536F69C1FCC294B859D07B179F069440FBA2B82@EXCHANGE.ad.wsicorp.com>
Message-ID: <92869e660810011331g1fbcdf23kd86edfcd5ab933ae@mail.gmail.com>

2008/10/1 Knight, Doug <dknight@wsi.com>:
> What would I have to do to tweak slony to use binary, for my specific
> situation? I built from source, is there a localized area in the code
> where I could modify it for my use?

in src/slon/remote_worker.c  - look for copy_set function


-- 
Filip Rembia?kowski
From JAmiel at istreamimaging.com  Wed Oct  1 13:47:30 2008
From: JAmiel at istreamimaging.com (Jeff Amiel)
Date: Wed Oct  1 13:47:44 2008
Subject: [Slony1-general] RE: subscriber question
References: <C17A452040EDB84AA7A10AEA334E3E1455D20D@AD1>
Message-ID: <C17A452040EDB84AA7A10AEA334E3E1455D212@AD1>

Follow-up question...

Base on this comment:

" The Right Way to handle such triggers is normally to use STORE
TRIGGER, which tells Slony-I that a trigger should not get deactivated."

Does this mean that I can't put a 'create trigger' statement in an sql
file passed to slonik and expect it to work properly? (on the master
node)

I now have a subscriber node that I need to add 5 triggers to (tied to 5
different tables)....they already exist in the master node.  How should
I do this?



-----Original Message-----
From: Jeff Amiel 
Sent: Wednesday, October 01, 2008 1:08 PM
To: slony1-general@lists.slony.info
Subject: subscriber question

I'm about to attempt to do some DR testing...and my goal was to take one
of my subscriber nodes, dump it, load it in another instance and point
my DR app server at it and watch the magic happen.

However...I got a little scared after reading this:

http://www.slony.info/documentation/faq.html#AEN6553

(specifically related to my own table triggers)

Let's assume my origin is 'gone' (destroyed in a nuclear burst)....I
have no way to 'dump' the subscriber node?  

In my case I 'may' have hand-added triggers to the subscriber node (as
well as origin) at one point without using slonik execute_script.....

That makes this harder, I assume...

Any advice?

Jeff
From wmoran at collaborativefusion.com  Wed Oct  1 14:54:32 2008
From: wmoran at collaborativefusion.com (Bill Moran)
Date: Wed Oct  1 14:54:46 2008
Subject: [Slony1-general] Method for discovering the origin of a set
Message-ID: <20081001175432.8c8154e7.wmoran@collaborativefusion.com>


I'm trying to do this:
SELECT set_origin FROM sl_set

which works fine _IF_ I have superuser privs, but I need normal users
to be able to query the database to see if they're talking to a master
or a slave system (I know there are other ways to do this, such as
BEGIN; DELETE FROM replicated_table; ROLLBACK, but those methods
generate tons of errors that flood our error management systems, and
then require all sorts of other complexity to manage)

Before I issue a GRANT to allow select rights on that table to anyone
who tries, my questions are:
* Is there any inherent danger in allowing SELECT on that table to
  normal users?
* Is there a better way (I looked for a store procedure, such as
  getlocalnodeid(), but if it exists, I'm not seeing it in the docs)

-- 
Bill Moran
Collaborative Fusion Inc.
http://people.collaborativefusion.com/~wmoran/

wmoran@collaborativefusion.com
Phone: 412-422-3463x4023

****************************************************************
IMPORTANT: This message contains confidential information and is
intended only for the individual named. If the reader of this
message is not an intended recipient (or the individual
responsible for the delivery of this message to an intended
recipient), please be advised that any re-use, dissemination,
distribution or copying of this message is prohibited. Please
notify the sender immediately by e-mail if you have received
this e-mail by mistake and delete this e-mail from your system.
E-mail transmission cannot be guaranteed to be secure or
error-free as information could be intercepted, corrupted, lost,
destroyed, arrive late or incomplete, or contain viruses. The
sender therefore does not accept liability for any errors or
omissions in the contents of this message, which arise as a
result of e-mail transmission.
****************************************************************
From singh.gurjeet at gmail.com  Wed Oct  1 21:19:47 2008
From: singh.gurjeet at gmail.com (Gurjeet Singh)
Date: Wed Oct  1 21:20:08 2008
Subject: [Slony1-general] Method for discovering the origin of a set
In-Reply-To: <20081001175432.8c8154e7.wmoran@collaborativefusion.com>
References: <20081001175432.8c8154e7.wmoran@collaborativefusion.com>
Message-ID: <65937bea0810012119kcadba97tbd9c042d983afea0@mail.gmail.com>

On Thu, Oct 2, 2008 at 3:24 AM, Bill Moran
<wmoran@collaborativefusion.com>wrote:

>
> I'm trying to do this:
> SELECT set_origin FROM sl_set
>
> which works fine _IF_ I have superuser privs, but I need normal users
> to be able to query the database to see if they're talking to a master
> or a slave system (I know there are other ways to do this, such as
> BEGIN; DELETE FROM replicated_table; ROLLBACK, but those methods
> generate tons of errors that flood our error management systems, and
> then require all sorts of other complexity to manage)
>
> Before I issue a GRANT to allow select rights on that table to anyone
> who tries, my questions are:
> * Is there any inherent danger in allowing SELECT on that table to
>  normal users?
> * Is there a better way (I looked for a store procedure, such as
>  getlocalnodeid(), but if it exists, I'm not seeing it in the docs)


I am no expert on security, Slony or Slony+security, but it seems harmless
to allow public SELECT on one of the tables if it solves your problem. But
take due care that none of other commands (INSERT/UPDATE/DELETE/TRUNCATE)
are executable by a normal user on this table.

Best regards,

-- =

gurjeet[.singh]@EnterpriseDB.com
singh.gurjeet@{ gmail | hotmail | indiatimes | yahoo }.com

EnterpriseDB      http://www.enterprisedb.com

Mail sent from my BlackLaptop device
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20081002/=
584b7be4/attachment.htm
From dknight at wsi.com  Thu Oct  2 05:42:29 2008
From: dknight at wsi.com (Knight, Doug)
Date: Thu Oct  2 05:42:34 2008
Subject: [Slony1-general] Binary COPY in slony?
In-Reply-To: <92869e660810011331g1fbcdf23kd86edfcd5ab933ae@mail.gmail.com>
References: <8536F69C1FCC294B859D07B179F069440FBA20FC@EXCHANGE.ad.wsicorp.com>
	<20081001140237.GA33117@crankycanuck.ca>
	<8536F69C1FCC294B859D07B179F069440FBA2B82@EXCHANGE.ad.wsicorp.com>
	<92869e660810011331g1fbcdf23kd86edfcd5ab933ae@mail.gmail.com>
Message-ID: <8536F69C1FCC294B859D07B179F069440FC2BA35@EXCHANGE.ad.wsicorp.com>

Thanks! Would I need it on both the "copy to stdout" and "copy from stdin"?

Doug

-----Original Message-----
From: Filip Rembia?kowski [mailto:plk.zuber@gmail.com] 
Sent: Wednesday, October 01, 2008 4:31 PM
To: Knight, Doug
Cc: slony1-general@lists.slony.info
Subject: Re: [Slony1-general] Binary COPY in slony?

2008/10/1 Knight, Doug <dknight@wsi.com>:
> What would I have to do to tweak slony to use binary, for my specific
> situation? I built from source, is there a localized area in the code
> where I could modify it for my use?

in src/slon/remote_worker.c  - look for copy_set function


-- 
Filip Rembia?kowski
From vivek at khera.org  Thu Oct  2 07:37:25 2008
From: vivek at khera.org (Vivek Khera)
Date: Thu Oct  2 07:37:30 2008
Subject: [Slony1-general] Method for discovering the origin of a set
In-Reply-To: <20081001175432.8c8154e7.wmoran@collaborativefusion.com>
References: <20081001175432.8c8154e7.wmoran@collaborativefusion.com>
Message-ID: <2968dfd60810020737r30d4aef2w9ca4ea1ea763bd6b@mail.gmail.com>

> Before I issue a GRANT to allow select rights on that table to anyone
> who tries, my questions are:
> * Is there any inherent danger in allowing SELECT on that table to
>  normal users?
> * Is there a better way (I looked for a store procedure, such as
>  getlocalnodeid(), but if it exists, I'm not seeing it in the docs)

Can't you define a function that does that query and returns
true/false as necessary, and is declared as SECURITY DEFINER so that
it runs with sufficient privileges?
From singh.gurjeet at gmail.com  Thu Oct  2 07:41:41 2008
From: singh.gurjeet at gmail.com (Gurjeet Singh)
Date: Thu Oct  2 07:41:45 2008
Subject: [Slony1-general] Method for discovering the origin of a set
In-Reply-To: <2968dfd60810020737r30d4aef2w9ca4ea1ea763bd6b@mail.gmail.com>
References: <20081001175432.8c8154e7.wmoran@collaborativefusion.com>
	<2968dfd60810020737r30d4aef2w9ca4ea1ea763bd6b@mail.gmail.com>
Message-ID: <65937bea0810020741u5a1774fdi859dbf06955e9c0e@mail.gmail.com>

On Thu, Oct 2, 2008 at 8:07 PM, Vivek Khera <vivek@khera.org> wrote:

> > Before I issue a GRANT to allow select rights on that table to anyone
> > who tries, my questions are:
> > * Is there any inherent danger in allowing SELECT on that table to
> >  normal users?
> > * Is there a better way (I looked for a store procedure, such as
> >  getlocalnodeid(), but if it exists, I'm not seeing it in the docs)
>
> Can't you define a function that does that query and returns
> true/false as necessary, and is declared as SECURITY DEFINER so that
> it runs with sufficient privileges?
>

That actually sounds like a plan... +1

-- =

gurjeet[.singh]@EnterpriseDB.com
singh.gurjeet@{ gmail | hotmail | indiatimes | yahoo }.com

EnterpriseDB      http://www.enterprisedb.com

Mail sent from my BlackLaptop device
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20081002/=
858f2955/attachment.htm
From cbbrowne at ca.afilias.info  Thu Oct  2 07:44:57 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Thu Oct  2 07:45:03 2008
Subject: [Slony1-general] Method for discovering the origin of a set
In-Reply-To: <20081001175432.8c8154e7.wmoran@collaborativefusion.com> (Bill
	Moran's message of "Wed, 1 Oct 2008 17:54:32 -0400")
References: <20081001175432.8c8154e7.wmoran@collaborativefusion.com>
Message-ID: <877i8rkqdy.fsf@dba2.int.libertyrms.com>

Bill Moran <wmoran@collaborativefusion.com> writes:
> I'm trying to do this:
> SELECT set_origin FROM sl_set
>
> which works fine _IF_ I have superuser privs, but I need normal users
> to be able to query the database to see if they're talking to a master
> or a slave system (I know there are other ways to do this, such as
> BEGIN; DELETE FROM replicated_table; ROLLBACK, but those methods
> generate tons of errors that flood our error management systems, and
> then require all sorts of other complexity to manage)
>
> Before I issue a GRANT to allow select rights on that table to anyone
> who tries, my questions are:
> * Is there any inherent danger in allowing SELECT on that table to
>   normal users?

I wouldn't think so; there's not much sensitivity to that data.

If you wanted to be paranoid, there, you might create a stored
function to do the determination, and define it as a SECURITY DEFINER
(e.g. - roughly equivalent to sudo).

Actually, that's not too awfully paranoid; seems like a pretty good
idea, actually.

> * Is there a better way (I looked for a store procedure, such as
>   getlocalnodeid(), but if it exists, I'm not seeing it in the docs)

There is a function, getLocalNodeId(); it's implemented in C, so it's
not totally visible :-).

-- ----------------------------------------------------------------------
-- FUNCTION getLocalNodeId (name)
--
--	
-- ----------------------------------------------------------------------
create or replace function @NAMESPACE@.getLocalNodeId (name) returns int4
    as '$libdir/slony1_funcs', '_Slony_I_getLocalNodeId'
	language C
	security definer;
grant execute on function @NAMESPACE@.getLocalNodeId (name) to public;

comment on function @NAMESPACE@.getLocalNodeId (name) is 
  'Returns the node ID of the node being serviced on the local database';
-- 
let name="cbbrowne" and tld="linuxfinances.info" in name ^ "@" ^ tld;;
http://linuxdatabases.info/info/lisp.html
A  LISP programmer  knows the  value of  everything, but  the  cost of
nothing.  -- Alan J. Perlis
From wmoran at collaborativefusion.com  Thu Oct  2 08:12:53 2008
From: wmoran at collaborativefusion.com (Bill Moran)
Date: Thu Oct  2 08:13:00 2008
Subject: [Slony1-general] Method for discovering the origin of a set
In-Reply-To: <877i8rkqdy.fsf@dba2.int.libertyrms.com>
References: <20081001175432.8c8154e7.wmoran@collaborativefusion.com>
	<877i8rkqdy.fsf@dba2.int.libertyrms.com>
Message-ID: <20081002111253.de4a42f8.wmoran@collaborativefusion.com>

In response to Christopher Browne <cbbrowne@ca.afilias.info>:

> Bill Moran <wmoran@collaborativefusion.com> writes:
> > I'm trying to do this:
> > SELECT set_origin FROM sl_set
> >
> > which works fine _IF_ I have superuser privs, but I need normal users
> > to be able to query the database to see if they're talking to a master
> > or a slave system (I know there are other ways to do this, such as
> > BEGIN; DELETE FROM replicated_table; ROLLBACK, but those methods
> > generate tons of errors that flood our error management systems, and
> > then require all sorts of other complexity to manage)
> >
> > Before I issue a GRANT to allow select rights on that table to anyone
> > who tries, my questions are:
> > * Is there any inherent danger in allowing SELECT on that table to
> >   normal users?
> 
> I wouldn't think so; there's not much sensitivity to that data.
> 
> If you wanted to be paranoid, there, you might create a stored
> function to do the determination, and define it as a SECURITY DEFINER
> (e.g. - roughly equivalent to sudo).

That was the conclusion I came to after a good night's sleep :)

It's also easier for our existing upgrade process to manage, so it's
a win all around.

> > * Is there a better way (I looked for a store procedure, such as
> >   getlocalnodeid(), but if it exists, I'm not seeing it in the docs)
> 
> There is a function, getLocalNodeId(); it's implemented in C, so it's
> not totally visible :-).

getLocalNodeId() works great, but it's only half of the equation.  What
I need is something like SELECT getLocalNodeId() = getSetOrigin([set#])
which will return true/false based on whether the current node is
the set origin or not.

That second procedure is the one that's missing, and it's the one I'm
creating now.  With security definer, it's pretty easy.

-- 
Bill Moran
Collaborative Fusion Inc.
http://people.collaborativefusion.com/~wmoran/

wmoran@collaborativefusion.com
Phone: 412-422-3463x4023
From wmoran at collaborativefusion.com  Thu Oct  2 08:18:15 2008
From: wmoran at collaborativefusion.com (Bill Moran)
Date: Thu Oct  2 08:18:21 2008
Subject: [Slony1-general] Method for discovering the origin of a set
In-Reply-To: <2968dfd60810020737r30d4aef2w9ca4ea1ea763bd6b@mail.gmail.com>
References: <20081001175432.8c8154e7.wmoran@collaborativefusion.com>
	<2968dfd60810020737r30d4aef2w9ca4ea1ea763bd6b@mail.gmail.com>
Message-ID: <20081002111815.3bc94f31.wmoran@collaborativefusion.com>

In response to "Vivek Khera" <vivek@khera.org>:

> > Before I issue a GRANT to allow select rights on that table to anyone
> > who tries, my questions are:
> > * Is there any inherent danger in allowing SELECT on that table to
> >  normal users?
> > * Is there a better way (I looked for a store procedure, such as
> >  getlocalnodeid(), but if it exists, I'm not seeing it in the docs)
> 
> Can't you define a function that does that query and returns
> true/false as necessary, and is declared as SECURITY DEFINER so that
> it runs with sufficient privileges?

That's what I'm doing ;)

What I'm wondering now is if such a function doesn't really belong in
the core of Slony's built in functions?

-- 
Bill Moran
Collaborative Fusion Inc.
http://people.collaborativefusion.com/~wmoran/

wmoran@collaborativefusion.com
Phone: 412-422-3463x4023
From bnichols at ca.afilias.info  Thu Oct  2 08:25:26 2008
From: bnichols at ca.afilias.info (Brad Nicholson)
Date: Thu Oct  2 08:25:34 2008
Subject: [Slony1-general] Method for discovering the origin of a set
In-Reply-To: <20081002111815.3bc94f31.wmoran@collaborativefusion.com>
References: <20081001175432.8c8154e7.wmoran@collaborativefusion.com>
	<2968dfd60810020737r30d4aef2w9ca4ea1ea763bd6b@mail.gmail.com>
	<20081002111815.3bc94f31.wmoran@collaborativefusion.com>
Message-ID: <1222961126.6112.24.camel@bnicholson-desktop>

On Thu, 2008-10-02 at 11:18 -0400, Bill Moran wrote:
> In response to "Vivek Khera" <vivek@khera.org>:
> 
> > > Before I issue a GRANT to allow select rights on that table to anyone
> > > who tries, my questions are:
> > > * Is there any inherent danger in allowing SELECT on that table to
> > >  normal users?
> > > * Is there a better way (I looked for a store procedure, such as
> > >  getlocalnodeid(), but if it exists, I'm not seeing it in the docs)
> > 
> > Can't you define a function that does that query and returns
> > true/false as necessary, and is declared as SECURITY DEFINER so that
> > it runs with sufficient privileges?
> 
> That's what I'm doing ;)
> 
> What I'm wondering now is if such a function doesn't really belong in
> the core of Slony's built in functions?

I vote yes for a function that says "am I the origin of set x".  

As for putting in as a SECURITY DEFINER function, I vote no.  Even
though I don't think that piece of  data is overly sensitive, Slony
shouldn't make the decision to expose it to an unprivileged user -
that's a decision for the DBA to make.

-- 
?Brad Nicholson  416-673-4106
Database Administrator, Afilias Canada Corp.

From ABhat at trustwave.com  Thu Oct  2 08:30:22 2008
From: ABhat at trustwave.com (Anoop Bhat)
Date: Thu Oct  2 08:31:25 2008
Subject: [Slony1-general] Replication between different versions of pgsql
Message-ID: <C50A533E.1EDA%abhat@trustwave.com>

Hi,

I was wondering how closely the versions of pgsql need to match in order for replication to occur successfully.

We're moving datacenters and I've setup an 8.1.11 postgresql server but my origin is a 7.4.7 server.

Will this be a problem and is there any potential danger to my origin?

Thanks

Anoop

From ajs at crankycanuck.ca  Thu Oct  2 08:34:32 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Thu Oct  2 08:34:41 2008
Subject: [Slony1-general] sanity check for all tables in a set
In-Reply-To: <48E27D8C.1050600@motorola.com>
References: <48E27D8C.1050600@motorola.com>
Message-ID: <20081002153432.GA38152@crankycanuck.ca>

On Tue, Sep 30, 2008 at 02:27:08PM -0500, Mark Keisler wrote:
> Someone deleted that table at some point and now I can't move the set
> and I can't unsubscribe the set.  It didn't seem like I could do
> anything at this point besides manually strip out the cluster schema and
> start over.  So my first question is if there are any other options at
> this point?

I don't think so.  Re-educate your users not to drop things out from
under you.  No DDL!
 
> Secondly, is there some sort of check that I can run periodically to
> make sure a set is still intact so something like this doesn't bite me
> right when I need to move a set?

You can check the _slony.sl_tables and _slony.sl_sequence tables.

A 

-- 
Andrew Sullivan
ajs@commandprompt.com
+1 503 667 4564 x104
http://www.commandprompt.com/
From singh.gurjeet at gmail.com  Thu Oct  2 08:38:08 2008
From: singh.gurjeet at gmail.com (Gurjeet Singh)
Date: Thu Oct  2 08:38:14 2008
Subject: [Slony1-general] Replication between different versions of pgsql
In-Reply-To: <C50A533E.1EDA%abhat@trustwave.com>
References: <C50A533E.1EDA%abhat@trustwave.com>
Message-ID: <65937bea0810020838w4ab0c037i7b06a855f3116fb9@mail.gmail.com>

On Thu, Oct 2, 2008 at 9:00 PM, Anoop Bhat <ABhat@trustwave.com> wrote:

> Hi,
>
> I was wondering how closely the versions of pgsql need to match in order
> for replication to occur successfully.
>
> We're moving datacenters and I've setup an 8.1.11 postgresql server but my
> origin is a 7.4.7 server.


While you at it, why not move to 8.3.4?


>
>
> Will this be a problem and is there any potential danger to my origin?
>

While I think it is completely possible, (Slony can do this), but I haven't
ever done this, so not sure what kind of roadblocks there might be.

One thing you can try is that try pg_dump + restore, that should give you a
fair idea of what to handle before you try it with Slony.

Best regards,
-- =

gurjeet[.singh]@EnterpriseDB.com
singh.gurjeet@{ gmail | hotmail | indiatimes | yahoo }.com

EnterpriseDB      http://www.enterprisedb.com

Mail sent from my BlackLaptop device
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20081002/=
ef8030b0/attachment.htm
From ABhat at trustwave.com  Thu Oct  2 08:40:22 2008
From: ABhat at trustwave.com (Anoop Bhat)
Date: Thu Oct  2 08:41:33 2008
Subject: [Slony1-general] Replication between different versions of pgsql
In-Reply-To: <65937bea0810020838w4ab0c037i7b06a855f3116fb9@mail.gmail.com>
Message-ID: <C50A5596.1EE0%abhat@trustwave.com>

Centos 5 only comes with 8.1.11 and as a company, we've decided that we'll go with whatever the distro comes with. Makes things easier for management etc.

I figured 8.1 is better than 7.4.7 :)

Thanks, I'll give the pg_dump + restore a shot.


On 10/2/08 10:38 AM, "Gurjeet Singh" <singh.gurjeet@gmail.com> wrote:

On Thu, Oct 2, 2008 at 9:00 PM, Anoop Bhat <ABhat@trustwave.com> wrote:
Hi,

I was wondering how closely the versions of pgsql need to match in order for replication to occur successfully.

We're moving datacenters and I've setup an 8.1.11 postgresql server but my origin is a 7.4.7 server.

While you at it, why not move to 8.3.4?



Will this be a problem and is there any potential danger to my origin?

While I think it is completely possible, (Slony can do this), but I haven't ever done this, so not sure what kind of roadblocks there might be.

One thing you can try is that try pg_dump + restore, that should give you a fair idea of what to handle before you try it with Slony.

Best regards,

Anoop Bhat
Systems Administrator
Trustwave
70 W. Madison
Chicago, IL, 60602
O: 312.873.7446
C: 312.925.3271


From plk.zuber at gmail.com  Thu Oct  2 09:09:25 2008
From: plk.zuber at gmail.com (=?UTF-8?Q?Filip_Rembia=C5=82kowski?=)
Date: Thu Oct  2 09:09:32 2008
Subject: [Slony1-general] Binary COPY in slony?
In-Reply-To: <8536F69C1FCC294B859D07B179F069440FC2BA35@EXCHANGE.ad.wsicorp.com>
References: <8536F69C1FCC294B859D07B179F069440FBA20FC@EXCHANGE.ad.wsicorp.com>
	<20081001140237.GA33117@crankycanuck.ca>
	<8536F69C1FCC294B859D07B179F069440FBA2B82@EXCHANGE.ad.wsicorp.com>
	<92869e660810011331g1fbcdf23kd86edfcd5ab933ae@mail.gmail.com>
	<8536F69C1FCC294B859D07B179F069440FC2BA35@EXCHANGE.ad.wsicorp.com>
Message-ID: <92869e660810020909s71f25679jc821344ae34f4ab7@mail.gmail.com>

2008/10/2 Knight, Doug <dknight@wsi.com>:
> Thanks! Would I need it on both the "copy to stdout" and "copy from stdin"?

I think all information is in the source and the docs :)
http://www.postgresql.org/docs/8.3/static/sql-copy.html
http://www.postgresql.org/docs/8.3/static/libpq-copy.html

It's possible to write a patch, but please can you tell me what
performance gain you expect?

You wrote "We have some very large binary tables that might benefit
from the performance of the binary COPY."

did you try to measure the possible speedup? can you share your results?


-- 
Filip Rembia?kowski
From Marcin.Kasperski at softax.com.pl  Thu Oct  2 09:51:49 2008
From: Marcin.Kasperski at softax.com.pl (Marcin Kasperski)
Date: Thu Oct  2 10:00:40 2008
Subject: [Slony1-general] Re: Replication between different versions of pgsql
References: <65937bea0810020838w4ab0c037i7b06a855f3116fb9@mail.gmail.com>
	<C50A5596.1EE0%abhat@trustwave.com>
Message-ID: <87vdwbvt22.fsf@softax.com.pl>

Anoop Bhat <ABhat@trustwave.com> writes:

> Centos 5 only comes with 8.1.11 and as a company, we've decided that
> we'll go with whatever the distro comes with. Makes things easier
> for management etc.

You must compile the same Slony version on both hosts, so at least
here you will be forced to lessen this rule.

I succesfully Slony-migrated from 8.1 to 8.3. Don't know about 7.4


-- 
----------------------------------------------------------------------
| Marcin Kasperski   |    You have the right to accept your
| http://mekk.waw.pl | responsibilites instead of having them
|                    |         assigned to you. (Beck)
----------------------------------------------------------------------

From dknight at wsi.com  Thu Oct  2 10:18:01 2008
From: dknight at wsi.com (Knight, Doug)
Date: Thu Oct  2 10:18:10 2008
Subject: [Slony1-general] Binary COPY in slony?
In-Reply-To: <92869e660810020909s71f25679jc821344ae34f4ab7@mail.gmail.com>
References: <8536F69C1FCC294B859D07B179F069440FBA20FC@EXCHANGE.ad.wsicorp.com>
	<20081001140237.GA33117@crankycanuck.ca>
	<8536F69C1FCC294B859D07B179F069440FBA2B82@EXCHANGE.ad.wsicorp.com>
	<92869e660810011331g1fbcdf23kd86edfcd5ab933ae@mail.gmail.com>
	<8536F69C1FCC294B859D07B179F069440FC2BA35@EXCHANGE.ad.wsicorp.com>
	<92869e660810020909s71f25679jc821344ae34f4ab7@mail.gmail.com>
Message-ID: <8536F69C1FCC294B859D07B179F069440FC2BE00@EXCHANGE.ad.wsicorp.com>

Our overall database size is roughly 100GB right now, and as we add data types could easily double or triple. Using the same dedicated 1GB Ethernet connection I use for DRBD and heartbeat between two HA-clustered servers, I can complete a full slony copy in under 3 hours on a live system. We just completed our first complete copy of a live system yesterday, and we're analyzing the results (looking for data gaps during switchover, finding ways to minimize or eliminate data gaps, performance of individual table copies, etc). Most of our binary data is in a lot of time partitioned tables, each roughly 1.7GB in size. Each table could take up to 121 seconds to copy. If I could bring that number down it would shorten the overall time to do the initial sync. As a test I could do some manual copies of these tables, and see if the binary mode helps. Its not a critical item right now, so I have to fit the testing into my current tasks. When I do, I'll post results.

DOug

-----Original Message-----
From: Filip Rembia?kowski [mailto:plk.zuber@gmail.com] 
Sent: Thursday, October 02, 2008 12:09 PM
To: Knight, Doug
Cc: slony1-general@lists.slony.info
Subject: Re: [Slony1-general] Binary COPY in slony?

2008/10/2 Knight, Doug <dknight@wsi.com>:
> Thanks! Would I need it on both the "copy to stdout" and "copy from stdin"?

I think all information is in the source and the docs :)
http://www.postgresql.org/docs/8.3/static/sql-copy.html
http://www.postgresql.org/docs/8.3/static/libpq-copy.html

It's possible to write a patch, but please can you tell me what
performance gain you expect?

You wrote "We have some very large binary tables that might benefit
from the performance of the binary COPY."

did you try to measure the possible speedup? can you share your results?


-- 
Filip Rembia?kowski
From ajs at crankycanuck.ca  Thu Oct  2 10:31:07 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Thu Oct  2 10:31:19 2008
Subject: [Slony1-general] Replication between different versions of pgsql
In-Reply-To: <C50A533E.1EDA%abhat@trustwave.com>
References: <C50A533E.1EDA%abhat@trustwave.com>
Message-ID: <20081002173107.GB38152@crankycanuck.ca>

On Thu, Oct 02, 2008 at 10:30:22AM -0500, Anoop Bhat wrote:
> Hi,
> 
> I was wondering how closely the versions of pgsql need to match in order for replication to occur successfully.

They don't.  Upgrading major releases is one of Slony's use cases.
You need the same Slony version on every node, though.

-- 
Andrew Sullivan
ajs@commandprompt.com
+1 503 667 4564 x104
http://www.commandprompt.com/
From cbbrowne at ca.afilias.info  Thu Oct  2 10:54:29 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Thu Oct  2 10:54:38 2008
Subject: [Slony1-general] Method for discovering the origin of a set
In-Reply-To: <1222961126.6112.24.camel@bnicholson-desktop> (Brad Nicholson's
	message of "Thu, 02 Oct 2008 11:25:26 -0400")
References: <20081001175432.8c8154e7.wmoran@collaborativefusion.com>
	<2968dfd60810020737r30d4aef2w9ca4ea1ea763bd6b@mail.gmail.com>
	<20081002111815.3bc94f31.wmoran@collaborativefusion.com>
	<1222961126.6112.24.camel@bnicholson-desktop>
Message-ID: <87vdwakhm2.fsf@dba2.int.libertyrms.com>

Brad Nicholson <bnichols@ca.afilias.info> writes:
> On Thu, 2008-10-02 at 11:18 -0400, Bill Moran wrote:
>> In response to "Vivek Khera" <vivek@khera.org>:
>> 
>> > > Before I issue a GRANT to allow select rights on that table to anyone
>> > > who tries, my questions are:
>> > > * Is there any inherent danger in allowing SELECT on that table to
>> > >  normal users?
>> > > * Is there a better way (I looked for a store procedure, such as
>> > >  getlocalnodeid(), but if it exists, I'm not seeing it in the docs)
>> > 
>> > Can't you define a function that does that query and returns
>> > true/false as necessary, and is declared as SECURITY DEFINER so that
>> > it runs with sufficient privileges?
>> 
>> That's what I'm doing ;)
>> 
>> What I'm wondering now is if such a function doesn't really belong in
>> the core of Slony's built in functions?
>
> I vote yes for a function that says "am I the origin of set x".  
>
> As for putting in as a SECURITY DEFINER function, I vote no.  Even
> though I don't think that piece of  data is overly sensitive, Slony
> shouldn't make the decision to expose it to an unprivileged user -
> that's a decision for the DBA to make.

Actually, I think you're in "violent agreement," and don't realize it
:-).

SECURITY DEFINER actually *is* defined a lot for Slony-I functions,
and I think it's apropos for this.

Functions where SECURITY DEFINER is already indicated include:
 - denyaccess
 - getLocalNodeId
 - getModuleVersion
 - setSessionRole
 - getSessionRole
 - logTrigger

It doesn't imply you're granting permission, just that we're
indicating what role the function runs under.

Granting access to the function is a separate thing; that always
remains a decision for the DBA to make.
-- 
output = reverse("gro.mca" "@" "enworbbc")
http://linuxdatabases.info/info/spreadsheets.html
Rules of the Evil Overlord #209. "I will not, under any circumstances,
marry a woman I know to be a faithless, conniving, back-stabbing witch
simply because I am absolutely desperate to perpetuate my family
line. Of course, we can still date." <http://www.eviloverlord.com/>
From cbbrowne at ca.afilias.info  Thu Oct  2 11:02:50 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Thu Oct  2 11:03:01 2008
Subject: [Slony1-general] Re: Replication between different versions of
	pgsql
In-Reply-To: <87vdwbvt22.fsf@softax.com.pl> (Marcin Kasperski's message of
	"Thu, 02 Oct 2008 18:51:49 +0200")
References: <65937bea0810020838w4ab0c037i7b06a855f3116fb9@mail.gmail.com>
	<C50A5596.1EE0%abhat@trustwave.com> <87vdwbvt22.fsf@softax.com.pl>
Message-ID: <87prmikh85.fsf@dba2.int.libertyrms.com>

Marcin Kasperski <Marcin.Kasperski@softax.com.pl> writes:
> Anoop Bhat <ABhat@trustwave.com> writes:
>
>> Centos 5 only comes with 8.1.11 and as a company, we've decided that
>> we'll go with whatever the distro comes with. Makes things easier
>> for management etc.
>
> You must compile the same Slony version on both hosts, so at least
> here you will be forced to lessen this rule.
>
> I succesfully Slony-migrated from 8.1 to 8.3. Don't know about 7.4

We've migrated 7.4 to 8.1; that interoperability has certainly been
one of OUR requirements :-).

In view that there will be a need to compile Slony-I in both
environments, that certainly undermines the "whatever the distro comes
with" argument, at least in part.

I can't see why someone would be keen of keeping on a release that was
obsoleted nearly two years ago (e.g. - 8.2 was released in December
2006), when there exist some quantity of data-eating bugs between 8.1
and 8.3 that will NEVER be addressed in the 8.1 release.
-- 
output = reverse("moc.enworbbc" "@" "enworbbc")
http://linuxdatabases.info/info/linuxxian.html
Rules of the  Evil Overlord #111. "I will offer  oracles the choice of
working exclusively for me or being executed."
<http://www.eviloverlord.com/>
From dknight at wsi.com  Thu Oct  2 11:06:44 2008
From: dknight at wsi.com (Knight, Doug)
Date: Thu Oct  2 11:06:55 2008
Subject: [Slony1-general] Binary COPY in slony?
In-Reply-To: <8536F69C1FCC294B859D07B179F069440FC2BE00@EXCHANGE.ad.wsicorp.com>
References: <8536F69C1FCC294B859D07B179F069440FBA20FC@EXCHANGE.ad.wsicorp.com><20081001140237.GA33117@crankycanuck.ca><8536F69C1FCC294B859D07B179F069440FBA2B82@EXCHANGE.ad.wsicorp.com><92869e660810011331g1fbcdf23kd86edfcd5ab933ae@mail.gmail.com><8536F69C1FCC294B859D07B179F069440FC2BA35@EXCHANGE.ad.wsicorp.com><92869e660810020909s71f25679jc821344ae34f4ab7@mail.gmail.com>
	<8536F69C1FCC294B859D07B179F069440FC2BE00@EXCHANGE.ad.wsicorp.com>
Message-ID: <8536F69C1FCC294B859D07B179F069440FC2BE6E@EXCHANGE.ad.wsicorp.com>

I put together a quick test, copying one of my largest tables (around 1.7GB), from my staging system back to my workstation (not over the dedicated GB connection, but through our intranet). Without the binary qualifier on the COPY command it took 11 minutes and 33 seconds. With the binary option it took 2 minutes and 52 seconds. That's a significant savings in replication time, roughly 400% if my math is right. When I next test a slony copy, I'll compare results using the dedicated link to eliminate any random latencies on our intranet.

Doug

-----Original Message-----
From: slony1-general-bounces@lists.slony.info [mailto:slony1-general-bounces@lists.slony.info] On Behalf Of Knight, Doug
Sent: Thursday, October 02, 2008 1:18 PM
To: slony1-general@lists.slony.info
Subject: RE: [Slony1-general] Binary COPY in slony?

Our overall database size is roughly 100GB right now, and as we add data types could easily double or triple. Using the same dedicated 1GB Ethernet connection I use for DRBD and heartbeat between two HA-clustered servers, I can complete a full slony copy in under 3 hours on a live system. We just completed our first complete copy of a live system yesterday, and we're analyzing the results (looking for data gaps during switchover, finding ways to minimize or eliminate data gaps, performance of individual table copies, etc). Most of our binary data is in a lot of time partitioned tables, each roughly 1.7GB in size. Each table could take up to 121 seconds to copy. If I could bring that number down it would shorten the overall time to do the initial sync. As a test I could do some manual copies of these tables, and see if the binary mode helps. Its not a critical item right now, so I have to fit the testing into my current tasks. When I do, I'll post results.

DOug

-----Original Message-----
From: Filip Rembia?kowski [mailto:plk.zuber@gmail.com] 
Sent: Thursday, October 02, 2008 12:09 PM
To: Knight, Doug
Cc: slony1-general@lists.slony.info
Subject: Re: [Slony1-general] Binary COPY in slony?

2008/10/2 Knight, Doug <dknight@wsi.com>:
> Thanks! Would I need it on both the "copy to stdout" and "copy from stdin"?

I think all information is in the source and the docs :)
http://www.postgresql.org/docs/8.3/static/sql-copy.html
http://www.postgresql.org/docs/8.3/static/libpq-copy.html

It's possible to write a patch, but please can you tell me what
performance gain you expect?

You wrote "We have some very large binary tables that might benefit
from the performance of the binary COPY."

did you try to measure the possible speedup? can you share your results?


-- 
Filip Rembia?kowski
_______________________________________________
Slony1-general mailing list
Slony1-general@lists.slony.info
http://lists.slony.info/mailman/listinfo/slony1-general

From ajs at crankycanuck.ca  Thu Oct  2 11:38:26 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Thu Oct  2 11:38:39 2008
Subject: [Slony1-general] subscriber question
In-Reply-To: <C17A452040EDB84AA7A10AEA334E3E1455D20D@AD1>
References: <C17A452040EDB84AA7A10AEA334E3E1455D20D@AD1>
Message-ID: <20081002183826.GC38152@crankycanuck.ca>

On Wed, Oct 01, 2008 at 01:08:21PM -0500, Jeff Amiel wrote:
> Let's assume my origin is 'gone' (destroyed in a nuclear burst)....I
> have no way to 'dump' the subscriber node?  

You do after you perform FAILOVER, because it becomes the origin.
But. . .
 
> In my case I 'may' have hand-added triggers to the subscriber node (as
> well as origin) at one point without using slonik execute_script.....

You 'may' have a problem, then.  If you want the trigger to be on all
nodes, and disabled on the replicas, then you need to add it via
EXECUTE SCRIPT.  If you want it just on one or more replicas, that is
the purpose of STORE TRIGGER.  I think you need to drop these triggers
and create them the right way.

A


-- 
Andrew Sullivan
ajs@commandprompt.com
+1 503 667 4564 x104
http://www.commandprompt.com/
From JAmiel at istreamimaging.com  Thu Oct  2 13:04:52 2008
From: JAmiel at istreamimaging.com (Jeff Amiel)
Date: Thu Oct  2 13:05:06 2008
Subject: [Slony1-general] subscriber question
References: <C17A452040EDB84AA7A10AEA334E3E1455D20D@AD1>
	<20081002183826.GC38152@crankycanuck.ca>
Message-ID: <C17A452040EDB84AA7A10AEA334E3E1455D228@AD1>


-----Original Message-----
From: slony1-general-bounces@lists.slony.info
[mailto:slony1-general-bounces@lists.slony.info] On Behalf Of Andrew
Sullivan
Sent: Thursday, October 02, 2008 1:38 PM
To: slony1-general@lists.slony.info
Subject: Re: [Slony1-general] subscriber question

You 'may' have a problem, then.  If you want the trigger to be on all
nodes, and disabled on the replicas, then you need to add it via
EXECUTE SCRIPT.  If you want it just on one or more replicas, that is
the purpose of STORE TRIGGER.  I think you need to drop these triggers
and create them the right way.
------

hmmm....so what is the 'right way'


" The Right Way to handle such triggers is normally to use STORE
TRIGGER, which tells Slony-I that a trigger should not get deactivated."

Does that mean putting the 'create trigger' in a SLONIK script isn't the
'right way'?
From kevin at kevinkempterllc.com  Thu Oct  2 13:09:11 2008
From: kevin at kevinkempterllc.com (kevin kempter)
Date: Thu Oct  2 13:09:25 2008
Subject: [Slony1-general] how to determine node id of current node
Message-ID: <568ADE2F-45C0-4B3D-A66E-3B7516B9BA9B@kevinkempterllc.com>

Hi List;

If I look at the slony schema tables on a node within a replication  
cluster, where do I look to determine the node_id's and respective  
server names for the nodes in the cluster ?


Thanks in advance


From ABhat at trustwave.com  Thu Oct  2 13:16:54 2008
From: ABhat at trustwave.com (Anoop Bhat)
Date: Thu Oct  2 13:18:02 2008
Subject: [Slony1-general] Replicate tables with oid attributes
Message-ID: <C50A9666.1F19%abhat@trustwave.com>

I heard and read somewhere that replicating tables with oid attributes was not possible. Is this true?

It's the biggest table we have at 140GB. I'd like to be able to replicate it for a cut over we're planning.

Thank you.

Anoop

From kevin at kevinkempterllc.com  Thu Oct  2 13:27:01 2008
From: kevin at kevinkempterllc.com (kevin kempter)
Date: Thu Oct  2 13:27:13 2008
Subject: [Slony1-general] determine current master
Message-ID: <663EDBA8-F0C6-422A-86D7-06A16E3213C0@kevinkempterllc.com>

Hi List;

if I look in the slony schema tables can I determine who is the  
current master node?

From ajs at crankycanuck.ca  Thu Oct  2 13:46:20 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Thu Oct  2 13:46:34 2008
Subject: [Slony1-general] subscriber question
In-Reply-To: <C17A452040EDB84AA7A10AEA334E3E1455D228@AD1>
References: <C17A452040EDB84AA7A10AEA334E3E1455D20D@AD1>
	<20081002183826.GC38152@crankycanuck.ca>
	<C17A452040EDB84AA7A10AEA334E3E1455D228@AD1>
Message-ID: <20081002204619.GB39784@crankycanuck.ca>

On Thu, Oct 02, 2008 at 03:04:52PM -0500, Jeff Amiel wrote:
> 
> hmmm....so what is the 'right way'
> 
> 
> " The Right Way to handle such triggers is normally to use STORE
> TRIGGER, which tells Slony-I that a trigger should not get deactivated."
> 
> Does that mean putting the 'create trigger' in a SLONIK script isn't the
> 'right way'?

No, these are two different uses.  STORE TRIGGER installs the trigger
in such a way that it _will_ fire on a replica.  CREATE TRIGGER sent
into the origin via EXECUTE SCRIPT creates the trigger on all nodes,
then disables it on replicas.

A


-- 
Andrew Sullivan
ajs@commandprompt.com
+1 503 667 4564 x104
http://www.commandprompt.com/
From JAmiel at istreamimaging.com  Thu Oct  2 13:52:08 2008
From: JAmiel at istreamimaging.com (Jeff Amiel)
Date: Thu Oct  2 13:52:58 2008
Subject: [Slony1-general] subscriber question
References: <C17A452040EDB84AA7A10AEA334E3E1455D20D@AD1>
	<20081002183826.GC38152@crankycanuck.ca>
	<C17A452040EDB84AA7A10AEA334E3E1455D228@AD1>
	<20081002204619.GB39784@crankycanuck.ca>
Message-ID: <C17A452040EDB84AA7A10AEA334E3E1455D22D@AD1>



-----Original Message-----
From: Andrew Sullivan [mailto:ajs@crankycanuck.ca] 
Sent: Thursday, October 02, 2008 3:46 PM
To: Jeff Amiel
Cc: slony1-general@lists.slony.info
Subject: Re: [Slony1-general] subscriber question

No, these are two different uses.  STORE TRIGGER installs the trigger
in such a way that it _will_ fire on a replica.  CREATE TRIGGER sent
into the origin via EXECUTE SCRIPT creates the trigger on all nodes,
then disables it on replicas.
---

Got it.  Thanks.
From cbbrowne at ca.afilias.info  Thu Oct  2 15:28:05 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Thu Oct  2 15:28:20 2008
Subject: [Slony1-general] how to determine node id of current node
In-Reply-To: <568ADE2F-45C0-4B3D-A66E-3B7516B9BA9B@kevinkempterllc.com> (kevin
	kempter's message of "Thu, 2 Oct 2008 14:09:11 -0600")
References: <568ADE2F-45C0-4B3D-A66E-3B7516B9BA9B@kevinkempterllc.com>
Message-ID: <871vyyk4y2.fsf@dba2.int.libertyrms.com>

kevin kempter <kevin@kevinkempterllc.com> writes:
> If I look at the slony schema tables on a node within a replication
> cluster, where do I look to determine the node_id's and respective
> server names for the nodes in the cluster ?

On each node, you call the stored function
GetLocalNodeID(cluster_name), passing in the name of the cluster
(e.g. - '_mycluster', or such); that identifies the node number for a
given database.

The host name is not actually stored anywhere; what *is* stored are
the paths required for particular slons to connect to particular
servers, as stored in the table sl_path.
-- 
let name="cbbrowne" and tld="cbbrowne.com" in name ^ "@" ^ tld;;
http://cbbrowne.com/info/multiplexor.html
Rules  of the  Evil Overlord  #202. "All  crones with  the  ability to
prophesy  will be  given  free facelifts,  permanents, manicures,  and
Donna  Karan   wardrobes.  That  should  pretty   well  destroy  their
credibility." <http://www.eviloverlord.com/>
From cbbrowne at ca.afilias.info  Thu Oct  2 15:33:55 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Thu Oct  2 15:34:12 2008
Subject: [Slony1-general] Replicate tables with oid attributes
In-Reply-To: <C50A9666.1F19%abhat@trustwave.com> (Anoop Bhat's message of
	"Thu, 2 Oct 2008 15:16:54 -0500")
References: <C50A9666.1F19%abhat@trustwave.com>
Message-ID: <87vdwaiq3w.fsf@dba2.int.libertyrms.com>

Anoop Bhat <ABhat@trustwave.com> writes:
> I heard and read somewhere that replicating tables with oid
> attributes was not possible. Is this true?

Yes and no.

Slony-I has no trouble replicating such tables; it will not, however,
propagate the OID value.

> It's the biggest table we have at 140GB. I'd like to be able to
> replicate it for a cut over we're planning.

You realize that oids have been deprecated since PostgreSQL 8.1,
released back in 2005, don't you?

You need to consider revising your applications to use proper primary
keys, because at some point, it's possible that OIDs on tables may get
removed altogether.
-- 
let name="cbbrowne" and tld="linuxfinances.info" in name ^ "@" ^ tld;;
http://linuxdatabases.info/info/internet.html
Rules of  the Evil Overlord #110.  "I will not  employ devious schemes
that involve the hero's party getting into my inner sanctum before the
trap is sprung." <http://www.eviloverlord.com/>
From cbbrowne at ca.afilias.info  Thu Oct  2 15:36:22 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Thu Oct  2 15:36:37 2008
Subject: [Slony1-general] determine current master
In-Reply-To: <663EDBA8-F0C6-422A-86D7-06A16E3213C0@kevinkempterllc.com> (kevin
	kempter's message of "Thu, 2 Oct 2008 14:27:01 -0600")
References: <663EDBA8-F0C6-422A-86D7-06A16E3213C0@kevinkempterllc.com>
Message-ID: <87r66yipzt.fsf@dba2.int.libertyrms.com>

kevin kempter <kevin@kevinkempterllc.com> writes:
> if I look in the slony schema tables can I determine who is the
> current master node?

Slony-I has no concept of a "master node."  Nodes do not have roles.

You can query sl_set, for a given replication set, to find which node
is the origin for the tables in that set.
-- 
"cbbrowne","@","linuxdatabases.info"
http://www3.sympatico.ca/cbbrowne/nonrdbms.html
MICROS~1 has  brought the  microcomputer OS to  the point where  it is
more bloated than even OSes from what was previously larger classes of
machines   altogether.   This  is   perhaps  Bill's   single  greatest
accomplishment.
From michaelsalomon78 at gmail.com  Fri Oct  3 02:33:06 2008
From: michaelsalomon78 at gmail.com (Michael SALOMON)
Date: Fri Oct  3 02:33:36 2008
Subject: [Slony1-general] how to determine node id of current node
In-Reply-To: <871vyyk4y2.fsf@dba2.int.libertyrms.com>
References: <568ADE2F-45C0-4B3D-A66E-3B7516B9BA9B@kevinkempterllc.com>
	<871vyyk4y2.fsf@dba2.int.libertyrms.com>
Message-ID: <9868b6a60810030233k6f1860des24703d5149170609@mail.gmail.com>

Hi !

What you can do to overtook this problem is to store the host name in the
comment field when creating your node:

store node (id=3D1, comment=3D'some_host_name');

Then you just have to query sl_node table depending what you are looking
for:

select no_id from _clustername.sl_node where no_comment=3D'some_host_name';
or
select no_comment from _clustername.sl_node where no_id =3D 1;

Trust me, it helps a lot ;) ;)

michael

On Fri, Oct 3, 2008 at 12:28 AM, Christopher Browne <
cbbrowne@ca.afilias.info> wrote:

> kevin kempter <kevin@kevinkempterllc.com> writes:
> > If I look at the slony schema tables on a node within a replication
> > cluster, where do I look to determine the node_id's and respective
> > server names for the nodes in the cluster ?
>
> On each node, you call the stored function
> GetLocalNodeID(cluster_name), passing in the name of the cluster
> (e.g. - '_mycluster', or such); that identifies the node number for a
> given database.
>
> The host name is not actually stored anywhere; what *is* stored are
> the paths required for particular slons to connect to particular
> servers, as stored in the table sl_path.
> --
> let name=3D"cbbrowne" and tld=3D"cbbrowne.com" in name ^ "@" ^ tld;;
> http://cbbrowne.com/info/multiplexor.html
> Rules  of the  Evil Overlord  #202. "All  crones with  the  ability to
> prophesy  will be  given  free facelifts,  permanents, manicures,  and
> Donna  Karan   wardrobes.  That  should  pretty   well  destroy  their
> credibility." <http://www.eviloverlord.com/>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20081003/=
8b01dcbd/attachment-0001.htm
From scetbon at echo.fr  Fri Oct  3 06:58:19 2008
From: scetbon at echo.fr (Cyril SCETBON)
Date: Fri Oct  3 06:58:25 2008
Subject: [Slony1-general] Generating $SLONY_SETS easily
Message-ID: <48E624FB.6070907@echo.fr>

Hi guys,

What's the easier way to generate this variable from a running 
configuration ?

Thanks
-- 
Cyril SCETBON
From plk.zuber at gmail.com  Fri Oct  3 08:36:40 2008
From: plk.zuber at gmail.com (=?UTF-8?Q?Filip_Rembia=C5=82kowski?=)
Date: Fri Oct  3 08:36:48 2008
Subject: [Slony1-general] Binary COPY in slony?
In-Reply-To: <8536F69C1FCC294B859D07B179F069440FC2BE6E@EXCHANGE.ad.wsicorp.com>
References: <8536F69C1FCC294B859D07B179F069440FBA20FC@EXCHANGE.ad.wsicorp.com>
	<20081001140237.GA33117@crankycanuck.ca>
	<8536F69C1FCC294B859D07B179F069440FBA2B82@EXCHANGE.ad.wsicorp.com>
	<92869e660810011331g1fbcdf23kd86edfcd5ab933ae@mail.gmail.com>
	<8536F69C1FCC294B859D07B179F069440FC2BA35@EXCHANGE.ad.wsicorp.com>
	<92869e660810020909s71f25679jc821344ae34f4ab7@mail.gmail.com>
	<8536F69C1FCC294B859D07B179F069440FC2BE00@EXCHANGE.ad.wsicorp.com>
	<8536F69C1FCC294B859D07B179F069440FC2BE6E@EXCHANGE.ad.wsicorp.com>
Message-ID: <92869e660810030836n479e91cfgc71d23000fc67fc0@mail.gmail.com>

2008/10/2 Knight, Doug <dknight@wsi.com>:
> I put together a quick test, copying one of my largest tables (around 1.7GB), from my staging system back to my workstation (not over the dedicated GB connection, but through our intranet). Without the binary qualifier on the COPY command it took 11 minutes and 33 seconds. With the binary option it took 2 minutes and 52 seconds. That's a significant savings in replication time, roughly 400% if my math is right. When I next test a slony copy, I'll compare results using the dedicated link to eliminate any random latencies on our intranet.

Wow, that's nice improvement.
the quick&dirty patch could be just to add WITH BINARY to both
copy-out and copy-in invocations in remote_worker.c
please share your success story afterwards :)


-- 
Filip Rembia?kowski
From ajs at commandprompt.com  Fri Oct  3 09:05:53 2008
From: ajs at commandprompt.com (Andrew Sullivan)
Date: Fri Oct  3 09:06:04 2008
Subject: [Slony1-general] Replicate tables with oid attributes
In-Reply-To: <87vdwaiq3w.fsf@dba2.int.libertyrms.com>
References: <C50A9666.1F19%abhat@trustwave.com>
	<87vdwaiq3w.fsf@dba2.int.libertyrms.com>
Message-ID: <20081003160553.GB40498@commandprompt.com>

On Thu, Oct 02, 2008 at 06:33:55PM -0400, Christopher Browne wrote:
> You need to consider revising your applications to use proper primary
> keys, because at some point, it's possible that OIDs on tables may get
> removed altogether.

Alternatively, if your application selects things by OID, create your
tables without OIDs and then create a column named OID.  I tested this
recently, and it appears to work fine.

A

-- 
Andrew Sullivan
ajs@commandprompt.com
+1 503 667 4564 x104
http://www.commandprompt.com/
From cbbrowne at ca.afilias.info  Fri Oct  3 09:28:04 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri Oct  3 09:28:13 2008
Subject: [Slony1-general] Binary COPY in slony?
In-Reply-To: <92869e660810030836n479e91cfgc71d23000fc67fc0@mail.gmail.com>
	(UTF's message of "Fri, 3 Oct 2008 17:36:40 +0200")
References: <8536F69C1FCC294B859D07B179F069440FBA20FC@EXCHANGE.ad.wsicorp.com>
	<20081001140237.GA33117@crankycanuck.ca>
	<8536F69C1FCC294B859D07B179F069440FBA2B82@EXCHANGE.ad.wsicorp.com>
	<92869e660810011331g1fbcdf23kd86edfcd5ab933ae@mail.gmail.com>
	<8536F69C1FCC294B859D07B179F069440FC2BA35@EXCHANGE.ad.wsicorp.com>
	<92869e660810020909s71f25679jc821344ae34f4ab7@mail.gmail.com>
	<8536F69C1FCC294B859D07B179F069440FC2BE00@EXCHANGE.ad.wsicorp.com>
	<8536F69C1FCC294B859D07B179F069440FC2BE6E@EXCHANGE.ad.wsicorp.com>
	<92869e660810030836n479e91cfgc71d23000fc67fc0@mail.gmail.com>
Message-ID: <87iqs9iqy3.fsf@dba2.int.libertyrms.com>

""=?UTF-8?Q?Filip_Rembia=C5=82kowski?="" <plk.zuber@gmail.com> writes:
> 2008/10/2 Knight, Doug <dknight@wsi.com>:
>> I put together a quick test, copying one of my largest tables
>> (around 1.7GB), from my staging system back to my workstation (not
>> over the dedicated GB connection, but through our
>> intranet). Without the binary qualifier on the COPY command it took
>> 11 minutes and 33 seconds. With the binary option it took 2 minutes
>> and 52 seconds. That's a significant savings in replication time,
>> roughly 400% if my math is right. When I next test a slony copy,
>> I'll compare results using the dedicated link to eliminate any
>> random latencies on our intranet.
>
> Wow, that's nice improvement.
> the quick&dirty patch could be just to add WITH BINARY to both
> copy-out and copy-in invocations in remote_worker.c
> please share your success story afterwards :)

It *is* a very simple change, in the simplest form of the patch:

===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/slon/remote_worker.c,v
retrieving revision 1.176
diff -c -u -r1.176 remote_worker.c
cvs diff: conflicting specifications of output style
--- src/slon/remote_worker.c    29 Aug 2008 21:06:45 -0000      1.176
+++ src/slon/remote_worker.c    3 Oct 2008 16:19:58 -0000
@@ -2886,7 +2886,7 @@

                (void) slon_mkquery(&query1,
                                                        "select %s.prepareTableForCopy(%d); "
-                                                       "copy %s %s from stdin; ",
+                                                       "copy %s %s from stdin WITH BINARY; ",
                                                        rtcfg_namespace,
                                                        tab_id, tab_fqname,
                                                        PQgetvalue(res3, 0, 0)
@@ -2912,7 +2912,7 @@
                if (archive_dir)
                {
                        (void) slon_mkquery(&query1,
-                       "delete from %s;\ncopy %s %s from stdin;", tab_fqname, tab_fqname,
+                       "delete from %s;\ncopy %s %s from stdin WITH BINARY;", tab_fqname, tab_fqname,
                                                                PQgetvalue(res3, 0, 0));
                        rc = archive_append_ds(node, &query1);
                        if (rc < 0)
@@ -2933,7 +2933,7 @@
                 * Begin a COPY to stdout for the table on the provider DB
                 */
                (void) slon_mkquery(&query1,
-                          "copy %s %s to stdout; ", tab_fqname, PQgetvalue(res3, 0, 0));
+                          "copy %s %s to stdout WITH BINARY; ", tab_fqname, PQgetvalue(res3, 0, 0));
                PQclear(res3);
                res3 = PQexec(pro_dbconn, dstring_data(&query1));
                if (PQresultStatus(res3) != PGRES_COPY_OUT)

I ran a small test, and didn't see a material difference between
having WITH BINARY and not having it.  

It is fair to say that my test wasn't at all comprehensive; I merely
stowed 32K records in a table, and set up a subscription, and and
with-versus-without was the difference between 0.45s and 0.51s.

The way I would prefer to make this change would be a little bit more
complex than the above.  The BINARY form is documented to be "less
portable," as follows:

   "The BINARY key word causes all data to be stored/read as binary
   format rather than as text. It is somewhat faster than the normal
   text mode, but a binary-format file is less portable across machine
   architectures and PostgreSQL versions."

Thus, my inclination would be to add a configuration parameter for
this, which allows changing between BINARY and "not BINARY" at
runtime, as opposed to picking one policy or the other at compile
time.

I'd certainly be interested in hearing how material this change is,
for larger table sizes.
-- 
select 'cbbrowne' || '@' || 'cbbrowne.com';
http://linuxdatabases.info/info/emacs.html
You don't *run* programs on Ultrix.
                - Mark Moraes
Right, you chase them.
                - Rayan Zachariassen
From cbbrowne at ca.afilias.info  Fri Oct  3 09:29:21 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri Oct  3 09:29:29 2008
Subject: [Slony1-general] Replicate tables with oid attributes
In-Reply-To: <20081003160553.GB40498@commandprompt.com> (Andrew Sullivan's
	message of "Fri, 3 Oct 2008 12:05:53 -0400")
References: <C50A9666.1F19%abhat@trustwave.com>
	<87vdwaiq3w.fsf@dba2.int.libertyrms.com>
	<20081003160553.GB40498@commandprompt.com>
Message-ID: <87d4ihiqvy.fsf@dba2.int.libertyrms.com>

Andrew Sullivan <ajs@commandprompt.com> writes:
> On Thu, Oct 02, 2008 at 06:33:55PM -0400, Christopher Browne wrote:
>> You need to consider revising your applications to use proper primary
>> keys, because at some point, it's possible that OIDs on tables may get
>> removed altogether.
>
> Alternatively, if your application selects things by OID, create your
> tables without OIDs and then create a column named OID.  I tested this
> recently, and it appears to work fine.

Cool, I'll note that in the FAQ.
-- 
let name="cbbrowne" and tld="acm.org" in String.concat "@" [name;tld];;
http://cbbrowne.com/info/internet.html
Let me control a planet's oxygen supply and I don't care who makes the
laws.
From dknight at wsi.com  Fri Oct  3 10:04:56 2008
From: dknight at wsi.com (Knight, Doug)
Date: Fri Oct  3 10:05:05 2008
Subject: [Slony1-general] Binary COPY in slony?
In-Reply-To: <87iqs9iqy3.fsf@dba2.int.libertyrms.com>
References: <8536F69C1FCC294B859D07B179F069440FBA20FC@EXCHANGE.ad.wsicorp.com><20081001140237.GA33117@crankycanuck.ca><8536F69C1FCC294B859D07B179F069440FBA2B82@EXCHANGE.ad.wsicorp.com><92869e660810011331g1fbcdf23kd86edfcd5ab933ae@mail.gmail.com><8536F69C1FCC294B859D07B179F069440FC2BA35@EXCHANGE.ad.wsicorp.com><92869e660810020909s71f25679jc821344ae34f4ab7@mail.gmail.com><8536F69C1FCC294B859D07B179F069440FC2BE00@EXCHANGE.ad.wsicorp.com><8536F69C1FCC294B859D07B179F069440FC2BE6E@EXCHANGE.ad.wsicorp.com><92869e660810030836n479e91cfgc71d23000fc67fc0@mail.gmail.com>
	<87iqs9iqy3.fsf@dba2.int.libertyrms.com>
Message-ID: <8536F69C1FCC294B859D07B179F069440FCB530D@EXCHANGE.ad.wsicorp.com>

I totally agree that a configurable method is preferable. To note, I
would not expect to see any performance improvement unless the table
being copied contained binary data. Our tables run upwards of 1.7GB of
binary data. It saves the conversion from binary to character,
transmission, then conversion back to binary. When I get a chance I'll
try implementing the WITH BINARY in slony, and see if I get the same or
similar results to my simple table "copy".

Doug

-----Original Message-----
From: Christopher Browne [mailto:cbbrowne@ca.afilias.info] 
Sent: Friday, October 03, 2008 12:28 PM
To: ""=?UTF-8?Q?Filip_Rembia=C5=82kowski?=""
Cc: Knight, Doug; slony1-general@lists.slony.info
Subject: Re: [Slony1-general] Binary COPY in slony?

""=?UTF-8?Q?Filip_Rembia=C5=82kowski?="" <plk.zuber@gmail.com> writes:
> 2008/10/2 Knight, Doug <dknight@wsi.com>:
>> I put together a quick test, copying one of my largest tables
>> (around 1.7GB), from my staging system back to my workstation (not
>> over the dedicated GB connection, but through our
>> intranet). Without the binary qualifier on the COPY command it took
>> 11 minutes and 33 seconds. With the binary option it took 2 minutes
>> and 52 seconds. That's a significant savings in replication time,
>> roughly 400% if my math is right. When I next test a slony copy,
>> I'll compare results using the dedicated link to eliminate any
>> random latencies on our intranet.
>
> Wow, that's nice improvement.
> the quick&dirty patch could be just to add WITH BINARY to both
> copy-out and copy-in invocations in remote_worker.c
> please share your success story afterwards :)

It *is* a very simple change, in the simplest form of the patch:

===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/slon/remote_worker.c,v
retrieving revision 1.176
diff -c -u -r1.176 remote_worker.c
cvs diff: conflicting specifications of output style
--- src/slon/remote_worker.c    29 Aug 2008 21:06:45 -0000      1.176
+++ src/slon/remote_worker.c    3 Oct 2008 16:19:58 -0000
@@ -2886,7 +2886,7 @@

                (void) slon_mkquery(&query1,
                                                        "select
%s.prepareTableForCopy(%d); "
-                                                       "copy %s %s from
stdin; ",
+                                                       "copy %s %s from
stdin WITH BINARY; ",
                                                        rtcfg_namespace,
                                                        tab_id,
tab_fqname,
                                                        PQgetvalue(res3,
0, 0)
@@ -2912,7 +2912,7 @@
                if (archive_dir)
                {
                        (void) slon_mkquery(&query1,
-                       "delete from %s;\ncopy %s %s from stdin;",
tab_fqname, tab_fqname,
+                       "delete from %s;\ncopy %s %s from stdin WITH
BINARY;", tab_fqname, tab_fqname,
 
PQgetvalue(res3, 0, 0));
                        rc = archive_append_ds(node, &query1);
                        if (rc < 0)
@@ -2933,7 +2933,7 @@
                 * Begin a COPY to stdout for the table on the provider
DB
                 */
                (void) slon_mkquery(&query1,
-                          "copy %s %s to stdout; ", tab_fqname,
PQgetvalue(res3, 0, 0));
+                          "copy %s %s to stdout WITH BINARY; ",
tab_fqname, PQgetvalue(res3, 0, 0));
                PQclear(res3);
                res3 = PQexec(pro_dbconn, dstring_data(&query1));
                if (PQresultStatus(res3) != PGRES_COPY_OUT)

I ran a small test, and didn't see a material difference between
having WITH BINARY and not having it.  

It is fair to say that my test wasn't at all comprehensive; I merely
stowed 32K records in a table, and set up a subscription, and and
with-versus-without was the difference between 0.45s and 0.51s.

The way I would prefer to make this change would be a little bit more
complex than the above.  The BINARY form is documented to be "less
portable," as follows:

   "The BINARY key word causes all data to be stored/read as binary
   format rather than as text. It is somewhat faster than the normal
   text mode, but a binary-format file is less portable across machine
   architectures and PostgreSQL versions."

Thus, my inclination would be to add a configuration parameter for
this, which allows changing between BINARY and "not BINARY" at
runtime, as opposed to picking one policy or the other at compile
time.

I'd certainly be interested in hearing how material this change is,
for larger table sizes.
-- 
select 'cbbrowne' || '@' || 'cbbrowne.com';
http://linuxdatabases.info/info/emacs.html
You don't *run* programs on Ultrix.
                - Mark Moraes
Right, you chase them.
                - Rayan Zachariassen

From ajs at commandprompt.com  Fri Oct  3 10:44:48 2008
From: ajs at commandprompt.com (Andrew Sullivan)
Date: Fri Oct  3 10:45:02 2008
Subject: [Slony1-general] Replicate tables with oid attributes
In-Reply-To: <87d4ihiqvy.fsf@dba2.int.libertyrms.com>
References: <C50A9666.1F19%abhat@trustwave.com>
	<87vdwaiq3w.fsf@dba2.int.libertyrms.com>
	<20081003160553.GB40498@commandprompt.com>
	<87d4ihiqvy.fsf@dba2.int.libertyrms.com>
Message-ID: <20081003174448.GG40498@commandprompt.com>

On Fri, Oct 03, 2008 at 12:29:21PM -0400, Christopher Browne wrote:
> 
> Cool, I'll note that in the FAQ.

I'm not sure it's a Slony FAQ.  Just a bit of gossip :)

A

-- 
Andrew Sullivan
ajs@commandprompt.com
+1 503 667 4564 x104
http://www.commandprompt.com/
From drees76 at gmail.com  Fri Oct  3 17:22:07 2008
From: drees76 at gmail.com (David Rees)
Date: Fri Oct  3 17:22:25 2008
Subject: [Slony1-general] Binary COPY in slony?
In-Reply-To: <87iqs9iqy3.fsf@dba2.int.libertyrms.com>
References: <8536F69C1FCC294B859D07B179F069440FBA20FC@EXCHANGE.ad.wsicorp.com>
	<20081001140237.GA33117@crankycanuck.ca>
	<8536F69C1FCC294B859D07B179F069440FBA2B82@EXCHANGE.ad.wsicorp.com>
	<92869e660810011331g1fbcdf23kd86edfcd5ab933ae@mail.gmail.com>
	<8536F69C1FCC294B859D07B179F069440FC2BA35@EXCHANGE.ad.wsicorp.com>
	<92869e660810020909s71f25679jc821344ae34f4ab7@mail.gmail.com>
	<8536F69C1FCC294B859D07B179F069440FC2BE00@EXCHANGE.ad.wsicorp.com>
	<8536F69C1FCC294B859D07B179F069440FC2BE6E@EXCHANGE.ad.wsicorp.com>
	<92869e660810030836n479e91cfgc71d23000fc67fc0@mail.gmail.com>
	<87iqs9iqy3.fsf@dba2.int.libertyrms.com>
Message-ID: <72dbd3150810031722q7fd4f9abgbba35a66dbd91dce@mail.gmail.com>

On Fri, Oct 3, 2008 at 9:28 AM, Christopher Browne
<cbbrowne@ca.afilias.info> wrote:
> The way I would prefer to make this change would be a little bit more
> complex than the above.  The BINARY form is documented to be "less
> portable," as follows:
>
>   "The BINARY key word causes all data to be stored/read as binary
>   format rather than as text. It is somewhat faster than the normal
>   text mode, but a binary-format file is less portable across machine
>   architectures and PostgreSQL versions."
>
> Thus, my inclination would be to add a configuration parameter for
> this, which allows changing between BINARY and "not BINARY" at
> runtime, as opposed to picking one policy or the other at compile
> time.

The best solution would be to dynamically figure out when it's OK to
use binary copy and when it's not.

Not sure how to best figure that out, though. :-)

Is there a way to determine the version of Pg and architecture the
other node is running? If the major version and architecture match
between nodes, it should be safe to use binary copy.

-Dave
From z-saito at guitar.ocn.ne.jp  Sat Oct  4 18:59:09 2008
From: z-saito at guitar.ocn.ne.jp (Hiroshi Saito)
Date: Sat Oct  4 18:59:32 2008
Subject: [Slony1-general] Version 2.0.0rc2 on windows are some problems.
Message-ID: <013101c9268d$f4fe71d0$0e01a8c0@IBMC9A0F63B40D>

Hi.

First,
patch which I submitted by RC1 seems not to apply it. :-(

$ make
make[1]: Entering directory `/home/HIROSHI/slony1-2.0.0-rc2/src'
make[2]: Entering directory `/home/HIROSHI/slony1-2.0.0-rc2/src/parsestatements'
./test-scanner < /dev/null > emptytestresult.log
cmp ./emptytestresult.log emptytestresult.expected.win32
./test-scanner < ./test_sql.sql > test_sql.log
cmp ./test_sql.log ./test_sql.expected.win32
./test_sql.log ./test_sql.expected.win32 differ: char 2038, line 62
make[2]: *** [test] Error 1
make[2]: Leaving directory `/home/HIROSHI/slony1-2.0.0-rc2/src/parsestatements'
make[1]: *** [all] Error 2
make[1]: Leaving directory `/home/HIROSHI/slony1-2.0.0-rc2/src'
make: *** [all] Error 2

and next, as for rc2,
It is necessary to adjust slon_terminate_worker which is not used by windows.

gcc -g -O2 -Wall -Wmissing-prototypes -Wmissing-declarations  -I../.. -I../../src/slon -o
slon.exe slon.o runtime_config.o local_listen.o remote_listen.o remote_worker.o
sync_thread.o cleanup_thread.o scheduler.o dbutils.o conf-file.o confoptions.o misc.o
../parsestatements/scanner.o port/pipe.o port/win32service.o
win32ver.o  -lpgport -L/usr/local/pgsql/lib -L/usr/local/pgsql/lib -lpq -lintl -lpthreadgc2
-lwsock32
remote_worker.o: In function `copy_set':
C:/MinGW/home/HIROSHI/slony1-2.0.0-rc2/src/slon/remote_worker.c:2470: undefined reference to
`_slon_terminate_worker'
collect2: ld returned 1 exit status
make[2]: *** [slon.exe] Error 1
make[2]: Leaving directory `/home/HIROSHI/slony1-2.0.0-rc2/src/slon'
make[1]: *** [all] Error 2
make[1]: Leaving directory `/home/HIROSHI/slony1-2.0.0-rc2/src'
make: *** [all] Error 2

Please take these two into consideration.
Thanks!

Regards,
Hiroshi Saito
-------------- next part --------------
A non-text attachment was scrubbed...
Name: slon_win32_patch
Type: application/octet-stream
Size: 841 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20081005/7dc38188/slon_win32_patch.obj
-------------- next part --------------
A non-text attachment was scrubbed...
Name: testsqlexpected_win32_patch
Type: application/octet-stream
Size: 1209 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20081005/7dc38188/testsqlexpected_win32_patch.obj
From scetbon at echo.fr  Mon Oct  6 08:42:59 2008
From: scetbon at echo.fr (Cyril SCETBON)
Date: Mon Oct  6 08:43:05 2008
Subject: [Slony1-general] Generating $SLONY_SETS easily
In-Reply-To: <48E624FB.6070907@echo.fr>
References: <48E624FB.6070907@echo.fr>
Message-ID: <48EA3203.6060608@echo.fr>

FYI,

I have used the following query to get the information :

select distinct tab_set as "set_id",array_to_string(array(select 
tab_relname from _mycluster.sl_table sl where 
sl.tab_set=t1.tab_set),',') as pkeyedtables,(select tab_id from 
_mycluster.sl_table sl where sl.tab_set=t1.tab_set limit 1) as table_id 
from _mycluster.sl_table t1;

This is what I used to start filling the $SLONY_SETS

Cyril SCETBON wrote:
> Hi guys,
>
> What's the easier way to generate this variable from a running 
> configuration ?
>
> Thanks

-- 
Cyril SCETBON
From JanWieck at Yahoo.com  Mon Oct  6 11:37:45 2008
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Mon Oct  6 11:38:37 2008
Subject: [Slony1-general] Binary COPY in slony?
In-Reply-To: <72dbd3150810061054u9d135e0gfc6a24e07cbac993@mail.gmail.com>
References: <8536F69C1FCC294B859D07B179F069440FBA20FC@EXCHANGE.ad.wsicorp.com>	
	<92869e660810011331g1fbcdf23kd86edfcd5ab933ae@mail.gmail.com>	
	<8536F69C1FCC294B859D07B179F069440FC2BA35@EXCHANGE.ad.wsicorp.com>	
	<92869e660810020909s71f25679jc821344ae34f4ab7@mail.gmail.com>	
	<8536F69C1FCC294B859D07B179F069440FC2BE00@EXCHANGE.ad.wsicorp.com>	
	<8536F69C1FCC294B859D07B179F069440FC2BE6E@EXCHANGE.ad.wsicorp.com>	
	<92869e660810030836n479e91cfgc71d23000fc67fc0@mail.gmail.com>	
	<87iqs9iqy3.fsf@dba2.int.libertyrms.com>	
	<72dbd3150810031722q7fd4f9abgbba35a66dbd91dce@mail.gmail.com>	
	<48EA4B2D.1020802@Yahoo.com>
	<72dbd3150810061054u9d135e0gfc6a24e07cbac993@mail.gmail.com>
Message-ID: <48EA5AF9.90301@Yahoo.com>

On 10/6/2008 1:54 PM, David Rees wrote:
> On Mon, Oct 6, 2008 at 10:30 AM, Jan Wieck <JanWieck@yahoo.com> wrote:
>> Any sort of "automagically" will usually lead to false negatives (which are
>> annoying) as well as false positives (leading to errors). So even with an
>> automatic mode, we would need an explicit override capability.
>>
>> I would suggest adding a BINARY=yes/no option to the SUBSCRIBE SET command.
>> What needs to be compatible are the architecture and PG version of the data
>> provider and the subscriber of the single SUBSCRIBE command itself, so it
>> cannot be a global config parameter anyway.
> 
> Did you mean to send this only to me, or just forgot to CC the list?
> Anyway, your solution sounds good to me. :-)

No, it was meant for general ... thanks for catching that.


Jan

-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin

From cbbrowne at ca.afilias.info  Mon Oct  6 15:05:30 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Mon Oct  6 15:05:45 2008
Subject: [Slony1-general] Binary COPY in slony?
In-Reply-To: <48EA5AF9.90301@Yahoo.com> (Jan Wieck's message of "Mon, 06 Oct
	2008 14:37:45 -0400")
References: <8536F69C1FCC294B859D07B179F069440FBA20FC@EXCHANGE.ad.wsicorp.com>
	<92869e660810011331g1fbcdf23kd86edfcd5ab933ae@mail.gmail.com>
	<8536F69C1FCC294B859D07B179F069440FC2BA35@EXCHANGE.ad.wsicorp.com>
	<92869e660810020909s71f25679jc821344ae34f4ab7@mail.gmail.com>
	<8536F69C1FCC294B859D07B179F069440FC2BE00@EXCHANGE.ad.wsicorp.com>
	<8536F69C1FCC294B859D07B179F069440FC2BE6E@EXCHANGE.ad.wsicorp.com>
	<92869e660810030836n479e91cfgc71d23000fc67fc0@mail.gmail.com>
	<87iqs9iqy3.fsf@dba2.int.libertyrms.com>
	<72dbd3150810031722q7fd4f9abgbba35a66dbd91dce@mail.gmail.com>
	<48EA4B2D.1020802@Yahoo.com>
	<72dbd3150810061054u9d135e0gfc6a24e07cbac993@mail.gmail.com>
	<48EA5AF9.90301@Yahoo.com>
Message-ID: <87ej2tgz11.fsf@dba2.int.libertyrms.com>

Jan Wieck <JanWieck@Yahoo.com> writes:
> On 10/6/2008 1:54 PM, David Rees wrote:
>> On Mon, Oct 6, 2008 at 10:30 AM, Jan Wieck <JanWieck@yahoo.com> wrote:
>>> Any sort of "automagically" will usually lead to false negatives (which are
>>> annoying) as well as false positives (leading to errors). So even with an
>>> automatic mode, we would need an explicit override capability.
>>>
>>> I would suggest adding a BINARY=yes/no option to the SUBSCRIBE SET command.
>>> What needs to be compatible are the architecture and PG version of the data
>>> provider and the subscriber of the single SUBSCRIBE command itself, so it
>>> cannot be a global config parameter anyway.
>>
>> Did you mean to send this only to me, or just forgot to CC the list?
>> Anyway, your solution sounds good to me. :-)
>
> No, it was meant for general ... thanks for catching that.

Ah, yes, and that's a good catch.  Whether BINARY is OK to use does
depends on the path.

Actually, that suggests a third place to configure it, namely as part
of STORE PATH.  I'm not sure I *like* the idea of configuring it
there, but it's certainly plausible.

There is also a fourth possibility, which is to decide, at the time of
subscription, by copying some data into some sort of "test table" in
BINARY mode, and then pick whether or not to use BINARY based on
whether the test worked.  That avoids requiring users to fiddle with
parameters altogether.
-- 
let name="cbbrowne" and tld="linuxdatabases.info" in String.concat "@" [name;tld];;
http://www3.sympatico.ca/cbbrowne/languages.html
C program run -- Run program run -- Run, C program, Run! -- (please)
From ajs at crankycanuck.ca  Tue Oct  7 06:02:22 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Tue Oct  7 06:02:27 2008
Subject: [Slony1-general] Binary COPY in slony?
In-Reply-To: <87ej2tgz11.fsf@dba2.int.libertyrms.com>
References: <92869e660810020909s71f25679jc821344ae34f4ab7@mail.gmail.com>
	<8536F69C1FCC294B859D07B179F069440FC2BE00@EXCHANGE.ad.wsicorp.com>
	<8536F69C1FCC294B859D07B179F069440FC2BE6E@EXCHANGE.ad.wsicorp.com>
	<92869e660810030836n479e91cfgc71d23000fc67fc0@mail.gmail.com>
	<87iqs9iqy3.fsf@dba2.int.libertyrms.com>
	<72dbd3150810031722q7fd4f9abgbba35a66dbd91dce@mail.gmail.com>
	<48EA4B2D.1020802@Yahoo.com>
	<72dbd3150810061054u9d135e0gfc6a24e07cbac993@mail.gmail.com>
	<48EA5AF9.90301@Yahoo.com> <87ej2tgz11.fsf@dba2.int.libertyrms.com>
Message-ID: <20081007130221.GA43325@crankycanuck.ca>

On Mon, Oct 06, 2008 at 06:05:30PM -0400, Christopher Browne wrote:
> There is also a fourth possibility, which is to decide, at the time of
> subscription, by copying some data into some sort of "test table" in
> BINARY mode, and then pick whether or not to use BINARY based on
> whether the test worked.  That avoids requiring users to fiddle with
> parameters altogether.

That sounds like a bit of a hack.  But what about storing, in a Slony
table at set-up, information about the architecture &c?  There must be
some way to get this, although it could be more or less expensive.  If
it's not available, you put "unknown" in, and provide a tool to get it
and update it later.  I'm thinking of something that reads the output
of pg_config or something of that sort.

A

-- 
Andrew Sullivan
ajs@commandprompt.com
+1 503 667 4564 x104
http://www.commandprompt.com/
From JanWieck at Yahoo.com  Tue Oct  7 08:17:28 2008
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Tue Oct  7 08:32:17 2008
Subject: [Slony1-general] Binary COPY in slony?
In-Reply-To: <20081007130221.GA43325@crankycanuck.ca>
References: <92869e660810020909s71f25679jc821344ae34f4ab7@mail.gmail.com>	<8536F69C1FCC294B859D07B179F069440FC2BE00@EXCHANGE.ad.wsicorp.com>	<8536F69C1FCC294B859D07B179F069440FC2BE6E@EXCHANGE.ad.wsicorp.com>	<92869e660810030836n479e91cfgc71d23000fc67fc0@mail.gmail.com>	<87iqs9iqy3.fsf@dba2.int.libertyrms.com>	<72dbd3150810031722q7fd4f9abgbba35a66dbd91dce@mail.gmail.com>	<48EA4B2D.1020802@Yahoo.com>	<72dbd3150810061054u9d135e0gfc6a24e07cbac993@mail.gmail.com>	<48EA5AF9.90301@Yahoo.com>
	<87ej2tgz11.fsf@dba2.int.libertyrms.com>
	<20081007130221.GA43325@crankycanuck.ca>
Message-ID: <48EB7D88.6040403@Yahoo.com>

On 10/7/2008 9:02 AM, Andrew Sullivan wrote:
> On Mon, Oct 06, 2008 at 06:05:30PM -0400, Christopher Browne wrote:
>> There is also a fourth possibility, which is to decide, at the time of
>> subscription, by copying some data into some sort of "test table" in
>> BINARY mode, and then pick whether or not to use BINARY based on
>> whether the test worked.  That avoids requiring users to fiddle with
>> parameters altogether.
> 
> That sounds like a bit of a hack.  But what about storing, in a Slony
> table at set-up, information about the architecture &c?  There must be
> some way to get this, although it could be more or less expensive.  If
> it's not available, you put "unknown" in, and provide a tool to get it
> and update it later.  I'm thinking of something that reads the output
> of pg_config or something of that sort.

The devil is usually in the details. Even though you might be running on 
the same hardware, how would you figure out automatically that some user 
defined data type stores slightly different binary datums depending on 
the version of some 3rd party toolkit?

No matter what we do, we still need the ability to override a false 
positive. So why not start with a manual switch on SUBSCRIBE SET and see 
how much performance gain that gives us?


Jan

-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin

From yi.zhao at alibaba-inc.com  Tue Oct  7 19:09:33 2008
From: yi.zhao at alibaba-inc.com (Yi Zhao)
Date: Tue Oct  7 19:09:21 2008
Subject: [Slony1-general] slony will failed sometimes
In-Reply-To: <210e1e060809050552r99bbbf0qae494ef4e192c39b@mail.gmail.com>
References: <210e1e060809050552r99bbbf0qae494ef4e192c39b@mail.gmail.com>
Message-ID: <1223431773.3158.6.camel@localhost.localdomain>

I have setup slony on master and slave and it's works at the beginning.
but some days later, slony will failed: why I do some operation on
master, the synchronism will failed to slave:((, then if I restart the
the slony process(slon_kill and slon start), it will recover,
does somebody met this problem and know the reason about it?

thanks all,
regards,

From cbbrowne at ca.afilias.info  Wed Oct  8 07:15:57 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed Oct  8 07:16:05 2008
Subject: [Slony1-general] slony will failed sometimes
In-Reply-To: <1223431773.3158.6.camel@localhost.localdomain> (Yi Zhao's
	message of "Wed, 08 Oct 2008 10:09:33 +0800")
References: <210e1e060809050552r99bbbf0qae494ef4e192c39b@mail.gmail.com>
	<1223431773.3158.6.camel@localhost.localdomain>
Message-ID: <871vyrgoki.fsf@dba2.int.libertyrms.com>

Yi Zhao <yi.zhao@alibaba-inc.com> writes:
> I have setup slony on master and slave and it's works at the beginning.
> but some days later, slony will failed: why I do some operation on
> master, the synchronism will failed to slave:((, then if I restart the
> the slony process(slon_kill and slon start), it will recover,
> does somebody met this problem and know the reason about it?

There are a number of error conditions that may be resolved by
restarting slon processes.

You would need to give quite a bit more detail in order for anyone to
attempt any diagnosis.

As a usual start, it's not much good even speculating without seeing
things like:

- The contents of the logs for the slon processes;

- The output of the tool test_slony_state (of which there are two
versions)
   http://www.slony.info/documentation/monitoring.html

- Information about what version of Slony-I you are running (and
  possibly the versions of PostgreSQL on each node, as well as OS
  versions)

-- 
output = reverse("ofni.sesabatadxunil" "@" "enworbbc")
http://linuxfinances.info/info/spreadsheets.html
<a href="http://www.netizen.com.au/">thorfinn@netizen.com.au</a>
Millihelen, adj:
        The amount of beauty required to launch one ship.
From Mark.Keisler at motorola.com  Wed Oct  8 11:54:59 2008
From: Mark.Keisler at motorola.com (Keisler Mark-QA4437)
Date: Wed Oct  8 11:55:15 2008
Subject: [Slony1-general] sanity check for all tables in a set
In-Reply-To: <20081002153432.GA38152@crankycanuck.ca>
References: <48E27D8C.1050600@motorola.com>
	<20081002153432.GA38152@crankycanuck.ca>
Message-ID: <1F1123F6CF4AE4448BFF607694C7BB00058E254E@ct11exm61.ds.mot.com>

so should _slony.sl_table.tab_reloid match
pg_catalog.pg_class.relfilenode for each table in a replication set? 

-----Original Message-----
From: slony1-general-bounces@lists.slony.info
[mailto:slony1-general-bounces@lists.slony.info] On Behalf Of Andrew
Sullivan
Sent: Thursday, October 02, 2008 10:35 AM
To: slony1-general@lists.slony.info
Subject: Re: [Slony1-general] sanity check for all tables in a set

On Tue, Sep 30, 2008 at 02:27:08PM -0500, Mark Keisler wrote:
> Someone deleted that table at some point and now I can't move the set 
> and I can't unsubscribe the set.  It didn't seem like I could do 
> anything at this point besides manually strip out the cluster schema 
> and start over.  So my first question is if there are any other 
> options at this point?

I don't think so.  Re-educate your users not to drop things out from
under you.  No DDL!
 
> Secondly, is there some sort of check that I can run periodically to 
> make sure a set is still intact so something like this doesn't bite me

> right when I need to move a set?

You can check the _slony.sl_tables and _slony.sl_sequence tables.

A 

--
Andrew Sullivan
ajs@commandprompt.com
+1 503 667 4564 x104
http://www.commandprompt.com/
_______________________________________________
Slony1-general mailing list
Slony1-general@lists.slony.info
http://lists.slony.info/mailman/listinfo/slony1-general
From ajs at crankycanuck.ca  Wed Oct  8 12:01:59 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Wed Oct  8 12:02:11 2008
Subject: [Slony1-general] sanity check for all tables in a set
In-Reply-To: <1F1123F6CF4AE4448BFF607694C7BB00058E254E@ct11exm61.ds.mot.com>
References: <48E27D8C.1050600@motorola.com>
	<20081002153432.GA38152@crankycanuck.ca>
	<1F1123F6CF4AE4448BFF607694C7BB00058E254E@ct11exm61.ds.mot.com>
Message-ID: <20081008190158.GD44999@crankycanuck.ca>

On Wed, Oct 08, 2008 at 02:54:59PM -0400, Keisler Mark-QA4437 wrote:
> so should _slony.sl_table.tab_reloid match
> pg_catalog.pg_class.relfilenode for each table in a replication set? 

pg_class.oid, I think.

> 
> -----Original Message-----
> From: slony1-general-bounces@lists.slony.info
> [mailto:slony1-general-bounces@lists.slony.info] On Behalf Of Andrew
> Sullivan
> Sent: Thursday, October 02, 2008 10:35 AM
> To: slony1-general@lists.slony.info
> Subject: Re: [Slony1-general] sanity check for all tables in a set
> 
> On Tue, Sep 30, 2008 at 02:27:08PM -0500, Mark Keisler wrote:
> > Someone deleted that table at some point and now I can't move the set 
> > and I can't unsubscribe the set.  It didn't seem like I could do 
> > anything at this point besides manually strip out the cluster schema 
> > and start over.  So my first question is if there are any other 
> > options at this point?
> 
> I don't think so.  Re-educate your users not to drop things out from
> under you.  No DDL!
>  
> > Secondly, is there some sort of check that I can run periodically to 
> > make sure a set is still intact so something like this doesn't bite me
> 
> > right when I need to move a set?
> 
> You can check the _slony.sl_tables and _slony.sl_sequence tables.
> 
> A 
> 
> --
> Andrew Sullivan
> ajs@commandprompt.com
> +1 503 667 4564 x104
> http://www.commandprompt.com/
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general

-- 
Andrew Sullivan
ajs@commandprompt.com
+1 503 667 4564 x104
http://www.commandprompt.com/
From mark.keisler at motorola.com  Wed Oct  8 12:07:36 2008
From: mark.keisler at motorola.com (Mark Keisler)
Date: Wed Oct  8 12:07:50 2008
Subject: [Slony1-general] sanity check for all tables in a set
In-Reply-To: <20081008190158.GD44999@crankycanuck.ca>
References: <48E27D8C.1050600@motorola.com>
	<20081002153432.GA38152@crankycanuck.ca>
	<1F1123F6CF4AE4448BFF607694C7BB00058E254E@ct11exm61.ds.mot.com>
	<20081008190158.GD44999@crankycanuck.ca>
Message-ID: <48ED04F8.7060700@motorola.com>

no such column :).  Here's the columns in pg_catalog.pg_class:

relname | relnamespace | reltype | relowner | relam | relfilenode |
reltablespace | relpages | reltuples | reltoastrelid | reltoastidxid |
relhasindex | relisshared | relkind | relnatts | relchecks | reltriggers
| relukeys | relfkeys | relrefs | relhasoids | relhaspkey | relhasrules
| relhassubclass | relfrozenxid |  relacl   | reloptions

the only one that seemed to really match with _slony.sl_table.tab_reloid
was relfilenode.  I have one table in my cluster that is not matching in
that way, so I am wondering if it is hard and fast.  The table seems to
be replicating ok, but dunno what slony might puke out upon a move_set
or something.

Andrew Sullivan wrote:
> On Wed, Oct 08, 2008 at 02:54:59PM -0400, Keisler Mark-QA4437 wrote:
>   
>> so should _slony.sl_table.tab_reloid match
>> pg_catalog.pg_class.relfilenode for each table in a replication set? 
>>     
>
> pg_class.oid, I think.
>
>   
>> -----Original Message-----
>> From: slony1-general-bounces@lists.slony.info
>> [mailto:slony1-general-bounces@lists.slony.info] On Behalf Of Andrew
>> Sullivan
>> Sent: Thursday, October 02, 2008 10:35 AM
>> To: slony1-general@lists.slony.info
>> Subject: Re: [Slony1-general] sanity check for all tables in a set
>>
>> On Tue, Sep 30, 2008 at 02:27:08PM -0500, Mark Keisler wrote:
>>     
>>> Someone deleted that table at some point and now I can't move the set 
>>> and I can't unsubscribe the set.  It didn't seem like I could do 
>>> anything at this point besides manually strip out the cluster schema 
>>> and start over.  So my first question is if there are any other 
>>> options at this point?
>>>       
>> I don't think so.  Re-educate your users not to drop things out from
>> under you.  No DDL!
>>  
>>     
>>> Secondly, is there some sort of check that I can run periodically to 
>>> make sure a set is still intact so something like this doesn't bite me
>>>       
>>> right when I need to move a set?
>>>       
>> You can check the _slony.sl_tables and _slony.sl_sequence tables.
>>
>> A 
>>
>> --
>> Andrew Sullivan
>> ajs@commandprompt.com
>> +1 503 667 4564 x104
>> http://www.commandprompt.com/
>> _______________________________________________
>> Slony1-general mailing list
>> Slony1-general@lists.slony.info
>> http://lists.slony.info/mailman/listinfo/slony1-general
>>     
>
>   

-- 
Mark Keisler
Principal Software Engineer
Motorola Open Source Technologies
630-329-2828

From ajs at commandprompt.com  Wed Oct  8 14:05:28 2008
From: ajs at commandprompt.com (Andrew Sullivan)
Date: Wed Oct  8 14:05:45 2008
Subject: [Slony1-general] sanity check for all tables in a set
In-Reply-To: <48ED04F8.7060700@motorola.com>
References: <48E27D8C.1050600@motorola.com>
	<20081002153432.GA38152@crankycanuck.ca>
	<1F1123F6CF4AE4448BFF607694C7BB00058E254E@ct11exm61.ds.mot.com>
	<20081008190158.GD44999@crankycanuck.ca>
	<48ED04F8.7060700@motorola.com>
Message-ID: <20081008210527.GI44963@commandprompt.com>

On Wed, Oct 08, 2008 at 02:07:36PM -0500, Mark Keisler wrote:
> no such column :).  Here's the columns in pg_catalog.pg_class:

Yes there is.  It's a hidden column.  SELECT oid,* from pg_class.

A

-- 
Andrew Sullivan
ajs@commandprompt.com
+1 503 667 4564 x104
http://www.commandprompt.com/
From mark.keisler at motorola.com  Wed Oct  8 14:14:32 2008
From: mark.keisler at motorola.com (Mark Keisler)
Date: Wed Oct  8 14:14:52 2008
Subject: [Slony1-general] sanity check for all tables in a set
In-Reply-To: <20081008210527.GI44963@commandprompt.com>
References: <48E27D8C.1050600@motorola.com>	<20081002153432.GA38152@crankycanuck.ca>	<1F1123F6CF4AE4448BFF607694C7BB00058E254E@ct11exm61.ds.mot.com>	<20081008190158.GD44999@crankycanuck.ca>	<48ED04F8.7060700@motorola.com>
	<20081008210527.GI44963@commandprompt.com>
Message-ID: <48ED22B8.1090403@motorola.com>

aha!  thanks.  I've got a perl script going now that checks consistency
between _slony.sl_table and

pg_catalog.pg_class which should help me spot if a table was dropped and/or recreated.


Andrew Sullivan wrote:
> On Wed, Oct 08, 2008 at 02:07:36PM -0500, Mark Keisler wrote:
>   
>> no such column :).  Here's the columns in pg_catalog.pg_class:
>>     
>
> Yes there is.  It's a hidden column.  SELECT oid,* from pg_class.
>
> A
>
>   

-- 
Mark Keisler
Principal Software Engineer
Motorola Open Source Technologies
630-329-2828

From jeff at frostconsultingllc.com  Thu Oct  9 09:19:44 2008
From: jeff at frostconsultingllc.com (Jeff Frost)
Date: Thu Oct  9 09:30:14 2008
Subject: [Slony1-general] postgresql 8.2 -=> 8.3 upgrade with postgis and
	tsearch2
Message-ID: <48EE2F20.9070305@frostconsultingllc.com>

I've done lots of minimized downtime postgresql upgrades with Slony, but
I now find myself with a DB that includes both tsearch2 and postgis
which needs migrating to 8.3.  I can do it with a dump/restore and using
postgis's postgis_restore.pl tool, but I'm wondering if I can do it with
Slony to minimize downtime.

Does anyone have experience with this?

Potential pitfalls I see are the pre-8.3 tsearch2 to 8.3 tsearch2 setup
and the postgis setup.

I was thinking I could mitigate this by creating the database on the 8.3
server and installing the contrib/tsearch2 functions, then using
postgis_restore.pl against a schema only dump to get the schema loaded
properly and then subscribe the new 8.3 slave. 

I'll be testing this out later today or tomorrow, but if anyone already
has experiences to share, I'd love to hear about them.

-- 
Jeff Frost, Owner 	<jeff@frostconsultingllc.com>
Frost Consulting, LLC 	http://www.frostconsultingllc.com/
Phone: 916-647-6411	FAX: 916-405-4032

From thawes at novadine.com  Thu Oct  9 14:31:00 2008
From: thawes at novadine.com (Tim Hawes)
Date: Thu Oct  9 14:31:04 2008
Subject: [Slony1-general] Slony Architecture
Message-ID: <48EE7814.6000504@novadine.com>

We currently have 6 slave nodes, 1 master. One of the slave nodes (slave 
A) is being replicated over the WAN.

On the LAN of that remote slave (slave A), are several other boxes I am 
wanting to replicate to. I want these new slaves to replicate from slave 
A, they do not need to know anything about the other 6 nodes + 1 master 
on the other side of the WAN.

I tried setting this up, and just defined the paths accordingly. 
However, I run test_slony_state.pl in a cron to keep me posted if any 
replication descrepencies occur. It always complains about the 6 nodes 
not having the needed conninfo to the slaves of slave A, even though 
they do not have paths to those instances.

Am I handling this the best way? Can I make test_slony_state.pl happy? 
Should I put the slaves of slave A in a seperate slony cluster making 
slave A the master, or do I need to do logshipping to slave A to do what 
I want?

From ABhat at trustwave.com  Thu Oct  9 16:54:25 2008
From: ABhat at trustwave.com (Anoop Bhat)
Date: Thu Oct  9 17:02:11 2008
Subject: [Slony1-general] Multiple database replication 
Message-ID: <C51403E1.21F3%abhat@trustwave.com>

Hi,

I've got a server with two databases on it. What's the best way to replicate them?

A single cluster with multiple databases (I'm not sure how I would do this, any sample scripts out there?)

Or

Two clusters replicating one database each.

I ask this question because I've setup two clusters already replicating one database each to a single slave server and I'm getting this error message

   remoteWorkerThread_1: transactions earlier than XID 3916431719 are still in progress
   remoteWorkerThread_1: data copy for set 1 failed - sleep 60 seconds

I'm wondering what the better option is.

Thanks.

Anoop

Anoop Bhat
Systems Administrator
Trustwave
70 W. Madison
Chicago, IL, 60602
O: 312.873.7446
C: 312.925.3271


From Ow.Mun.Heng at wdc.com  Thu Oct  9 21:12:59 2008
From: Ow.Mun.Heng at wdc.com (Ow Mun Heng)
Date: Thu Oct  9 21:13:24 2008
Subject: [Slony1-general] Slony daemon died on master
Message-ID: <1223611979.24152.1.camel@neuromancer.home.net>

there's 4 days of delay now.

the status says

 st_origin | st_received | st_last_event |      st_last_event_ts      |
st_last_received |    st_last_received_ts     |
st_last_received_event_ts  | st_lag_num_events |      st_lag_time
-----------+-------------+---------------+----------------------------+------------------+----------------------------+-
---------------------------+-------------------+------------------------
         1 |          10 |       2463535 | 2008-10-10 11:50:26.809136 |
2463502 | 2008-10-06 00:24:05.498648 | 2008-10-06 00:23:59.276714 |
33 | 4 days 11:27:59.004091


and the table is already filled up like a 10GB in size.There definitely
is more than 33 lag_num_events

What do I do? do I need to be concerned about that number?
From Ow.Mun.Heng at wdc.com  Fri Oct 10 00:22:37 2008
From: Ow.Mun.Heng at wdc.com (Ow Mun Heng)
Date: Fri Oct 10 00:23:09 2008
Subject: [Slony1-general] 1 BIG SYNC - 9million rows
Message-ID: <1223623357.27760.6.camel@neuromancer.home.net>

Hi,

My Slony Master daemon died and for some reason, the slave died along
with it and that was over 4 days ago.

I read back the archives and found that it really _isn't_ a problem (if
my hardware can handle it) [which I know it can't really]

select * from _hmxmms_my_cluster.sl_event order by ev_timestamp asc
limit 2;
-[ RECORD
1 ]+------------------------------------------------------------------------------------------------------------------------------------
ev_origin    | 1
ev_seqno     | 2463502
ev_timestamp | 2008-10-06 00:23:59.276714
ev_minxid    | 73888983
ev_maxxid    | 73906072
ev_xip       |
'73891993','73891292','73888983','73897065','73892567','73895703','73893260','73895669','73891049','73891575','73891928','73892147'
ev_type      | SYNC
-[ RECORD
2 ]+------------------------------------------------------------------------------------------------------------------------------------
ev_origin    | 1
ev_seqno     | 2463503
ev_timestamp | 2008-10-10 10:32:21.038801
ev_minxid    | 74959838
ev_maxxid    | 74959839
ev_xip       |
ev_type      | SYNC


So, the question now is, is there anything I can do to break up the sync
into a few more, more manageable qty? I'm not sure if it can sync up
9million rows in 1 BIG SYNC.

Is there any way I can eg: sync it manually? meaning, remove the
triggers from the slave and then copy the data over and then restart
slony?

Thanks
From stephane.schildknecht at postgresqlfr.org  Fri Oct 10 01:58:01 2008
From: stephane.schildknecht at postgresqlfr.org (=?ISO-8859-15?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Fri Oct 10 01:58:39 2008
Subject: [Slony1-general] 1 BIG SYNC - 9million rows
In-Reply-To: <1223623357.27760.6.camel@neuromancer.home.net>
References: <1223623357.27760.6.camel@neuromancer.home.net>
Message-ID: <48EF1919.5050805@postgresqlfr.org>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Ow Mun Heng a ?crit :
> Hi,
> 
> My Slony Master daemon died and for some reason, the slave died along
> with it and that was over 4 days ago.
> 
> I read back the archives and found that it really _isn't_ a problem (if
> my hardware can handle it) [which I know it can't really]
> 
> select * from _hmxmms_my_cluster.sl_event order by ev_timestamp asc
> limit 2;
> -[ RECORD
> 1 ]+------------------------------------------------------------------------------------------------------------------------------------
> ev_origin    | 1
> ev_seqno     | 2463502
> ev_timestamp | 2008-10-06 00:23:59.276714
> ev_minxid    | 73888983
> ev_maxxid    | 73906072
> ev_xip       |
> '73891993','73891292','73888983','73897065','73892567','73895703','73893260','73895669','73891049','73891575','73891928','73892147'
> ev_type      | SYNC
> -[ RECORD
> 2 ]+------------------------------------------------------------------------------------------------------------------------------------
> ev_origin    | 1
> ev_seqno     | 2463503
> ev_timestamp | 2008-10-10 10:32:21.038801
> ev_minxid    | 74959838
> ev_maxxid    | 74959839
> ev_xip       |
> ev_type      | SYNC
> 
> 
> So, the question now is, is there anything I can do to break up the sync
> into a few more, more manageable qty? I'm not sure if it can sync up
> 9million rows in 1 BIG SYNC.
> 
> Is there any way I can eg: sync it manually? meaning, remove the
> triggers from the slave and then copy the data over and then restart
> slony?
> 

33 sync events late is not really a big deal. As both replication daemons were
stopped, there may not be any Sync produced since then.

What's more annoying is that you may have add/updated 9 millions rows in one
single transaction. That could lead in a real long time synchronisation. But,
Slony can really well handle it. All you have to do is restart both daemons and
wait...

Regards,
- --
St?phane Schildknecht
PostgreSQLFr : http://www.postgresql.fr

Venez nous rencontrer le 4 octobre lors du plus important ?v?nement
PostgreSQL francophone : http://www.pgday.fr

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFI7xkZA+REPKWGI0ERAhr8AKCn2ZSD/a6WK8Cl09LU7/TRuLRO8gCeLnRA
AZQZR/XK4muQFXggF+27Its=
=KH+2
-----END PGP SIGNATURE-----
From stephane.schildknecht at postgresqlfr.org  Fri Oct 10 02:03:52 2008
From: stephane.schildknecht at postgresqlfr.org (=?ISO-8859-15?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Fri Oct 10 02:04:18 2008
Subject: [Slony1-general] Slony Architecture
In-Reply-To: <48EE7814.6000504@novadine.com>
References: <48EE7814.6000504@novadine.com>
Message-ID: <48EF1A78.6070901@postgresqlfr.org>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Tim Hawes a ?crit :
> We currently have 6 slave nodes, 1 master. One of the slave nodes (slave
> A) is being replicated over the WAN.
> 
> On the LAN of that remote slave (slave A), are several other boxes I am
> wanting to replicate to. I want these new slaves to replicate from slave
> A, they do not need to know anything about the other 6 nodes + 1 master
> on the other side of the WAN.
> 
> I tried setting this up, and just defined the paths accordingly.
> However, I run test_slony_state.pl in a cron to keep me posted if any
> replication descrepencies occur. It always complains about the 6 nodes
> not having the needed conninfo to the slaves of slave A, even though
> they do not have paths to those instances.
> 
> Am I handling this the best way? Can I make test_slony_state.pl happy?
> Should I put the slaves of slave A in a seperate slony cluster making
> slave A the master, or do I need to do logshipping to slave A to do what
> I want?

Hi,

I never used test_slony_state.pl, but I can tell that design should work.
How did you configure sl_path ?

Regards,
- --
St?phane Schildknecht
PostgreSQLFr - http://www.postgresql.fr
Dalibo - http://www.dalibo.com
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFI7xp4A+REPKWGI0ERAmztAKDLQSzHCDJBpZQ6BWtkp47CKHZ84ACg0xb8
gskqbRhnVhSgpCHSgxi9hJs=
=XR0i
-----END PGP SIGNATURE-----
From Ow.Mun.Heng at wdc.com  Fri Oct 10 03:01:44 2008
From: Ow.Mun.Heng at wdc.com (Ow Mun Heng)
Date: Fri Oct 10 03:02:24 2008
Subject: [Slony1-general] 1 BIG SYNC - 9million rows
In-Reply-To: <48EF1919.5050805@postgresqlfr.org>
References: <1223623357.27760.6.camel@neuromancer.home.net>
	<48EF1919.5050805@postgresqlfr.org>
Message-ID: <1223632904.27760.11.camel@neuromancer.home.net>

On Fri, 2008-10-10 at 10:58 +0200, "St?phane A. Schildknecht" wrote:
> > My Slony Master daemon died and for some reason, the slave died along
> > with it and that was over 4 days ago.
> > 
> > I read back the archives and found that it really _isn't_ a problem (if
> > my hardware can handle it) [which I know it can't really]
> > 

> > So, the question now is, is there anything I can do to break up the sync
> > into a few more, more manageable qty? I'm not sure if it can sync up
> > 9million rows in 1 BIG SYNC.
> > 
> > Is there any way I can eg: sync it manually? meaning, remove the
> > triggers from the slave and then copy the data over and then restart
> > slony?
> > 
> 
> 33 sync events late is not really a big deal. As both replication daemons were
> stopped, there may not be any Sync produced since then.
> 
> What's more annoying is that you may have add/updated 9 millions rows in one
> single transaction. That could lead in a real long time synchronisation. But,
> Slony can really well handle it. All you have to do is restart both daemons and
> wait...


I'm waiting now.... Not sure how long it will take for the entire
process to finish.

If not mistaken the entire SYNC is done in a transaction, that means 1
BIG lock??
From cbbrowne at ca.afilias.info  Fri Oct 10 07:48:08 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri Oct 10 07:48:18 2008
Subject: [Slony1-general] Multiple database replication
In-Reply-To: <C51403E1.21F3%abhat@trustwave.com> (Anoop Bhat's message of
	"Thu, 9 Oct 2008 18:54:25 -0500")
References: <C51403E1.21F3%abhat@trustwave.com>
Message-ID: <87prm8ecbb.fsf@dba2.int.libertyrms.com>

Anoop Bhat <ABhat@trustwave.com> writes:
> I've got a server with two databases on it. What's the best way to replicate them?
>
> A single cluster with multiple databases (I'm not sure how I would do this, any sample scripts out there?)
>
> Or
>
> Two clusters replicating one database each.
>
> I ask this question because I've setup two clusters already replicating one database each to a single slave server and I'm getting this error message
>
>    remoteWorkerThread_1: transactions earlier than XID 3916431719 are still in progress
>    remoteWorkerThread_1: data copy for set 1 failed - sleep 60 seconds
>
> I'm wondering what the better option is.

I'm not sure about "better option"; this situation has been described
in the FAQ for a long time now:

   <http://www.slony.info/documentation/faq.html#AEN5630>
-- 
output = ("cbbrowne" "@" "cbbrowne.com")
http://linuxfinances.info/info/slony.html
You know better than to trust a strange computer.
From cbbrowne at ca.afilias.info  Fri Oct 10 07:50:02 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri Oct 10 07:50:09 2008
Subject: [Slony1-general] Slony daemon died on master
In-Reply-To: <1223611979.24152.1.camel@neuromancer.home.net> (Ow Mun Heng's
	message of "Fri, 10 Oct 2008 12:12:59 +0800")
References: <1223611979.24152.1.camel@neuromancer.home.net>
Message-ID: <87ljwwec85.fsf@dba2.int.libertyrms.com>

Ow Mun Heng <Ow.Mun.Heng@wdc.com> writes:
> there's 4 days of delay now.
>
> the status says
>
>  st_origin | st_received | st_last_event |      st_last_event_ts      |
> st_last_received |    st_last_received_ts     |
> st_last_received_event_ts  | st_lag_num_events |      st_lag_time
> -----------+-------------+---------------+----------------------------+------------------+----------------------------+-
> ---------------------------+-------------------+------------------------
>          1 |          10 |       2463535 | 2008-10-10 11:50:26.809136 |
> 2463502 | 2008-10-06 00:24:05.498648 | 2008-10-06 00:23:59.276714 |
> 33 | 4 days 11:27:59.004091
>
>
> and the table is already filled up like a 10GB in size.There definitely
> is more than 33 lag_num_events
>
> What do I do? do I need to be concerned about that number?

Generally, if *any* slon daemon dies, you need to restart it.

The concerns one should have about the life and death of slon daemons
are documented here:
  <http://www.slony.info/documentation/faq.html#AEN5771>
-- 
let name="cbbrowne" and tld="linuxfinances.info" in String.concat "@" [name;tld];;
http://linuxdatabases.info/info/lsf.html
Rules of the Evil Overlord #44. "I will only employ bounty hunters who
work for money. Those who work for the pleasure of the hunt tend to do
dumb  things like  even the  odds  to give  the other  guy a  sporting
chance." <http://www.eviloverlord.com/>
From kevin at kevinkempterllc.com  Fri Oct 10 11:20:48 2008
From: kevin at kevinkempterllc.com (kevin kempter)
Date: Fri Oct 10 11:21:06 2008
Subject: [Slony1-general] Using SLONY to Upgrade Postgres Versions
Message-ID: <BEE194F6-7309-44F1-9DB7-DA96DA98B030@kevinkempterllc.com>

Hi List;

We're preparing to do an upgrade from 8.2.5 to 8.3.4 on a system where  
we loose money if it's down - thus downtime is not an option.

I plan to do this:


1) setup a new 8.3.x cluster.
2) install SLONY on the old 8.2 cluster and the new 8.3.x cluster
3) Create/setup a SLONY replication set between the  two clusters (the  
old 8.2 cluster/db as the master and the 8.3.x cluster as the slave)
4) Initialize/start replication
5) Wait for replication to complete
6) Modify / create a 'switchover' script that also moves the  
connections (via an I.P. alias)
7) execute a switchover

My question is this:

Once I get to this point we want to remove SLONY completely, while  
leaving the new 8.3.4 master in place as the only server in read/write  
mode.

Do I execute a drop node ? If so, can I execute a drop node on the  
master ?
Or is there a better approach ?

Thanks in advance..


From kgorman at hi5.com  Fri Oct 10 11:27:36 2008
From: kgorman at hi5.com (Kenny Gorman)
Date: Fri Oct 10 11:27:49 2008
Subject: [Slony1-general] Using SLONY to Upgrade Postgres Versions
In-Reply-To: <BEE194F6-7309-44F1-9DB7-DA96DA98B030@kevinkempterllc.com>
References: <BEE194F6-7309-44F1-9DB7-DA96DA98B030@kevinkempterllc.com>
Message-ID: <8040425B-AD95-4982-9ABD-53FFB8C0A64B@hi5.com>

You can just stop the slon processes, and drop the schema that holds  
the replication tables, then your all clean again.

-Kenny

On Oct 10, 2008, at 11:20 AM, kevin kempter wrote:

> Hi List;
>
> We're preparing to do an upgrade from 8.2.5 to 8.3.4 on a system  
> where we loose money if it's down - thus downtime is not an option.
>
> I plan to do this:
>
>
> 1) setup a new 8.3.x cluster.
> 2) install SLONY on the old 8.2 cluster and the new 8.3.x cluster
> 3) Create/setup a SLONY replication set between the  two clusters  
> (the old 8.2 cluster/db as the master and the 8.3.x cluster as the  
> slave)
> 4) Initialize/start replication
> 5) Wait for replication to complete
> 6) Modify / create a 'switchover' script that also moves the  
> connections (via an I.P. alias)
> 7) execute a switchover
>
> My question is this:
>
> Once I get to this point we want to remove SLONY completely, while  
> leaving the new 8.3.4 master in place as the only server in read/ 
> write mode.
>
> Do I execute a drop node ? If so, can I execute a drop node on the  
> master ?
> Or is there a better approach ?
>
> Thanks in advance..
>
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general

From cbbrowne at ca.afilias.info  Fri Oct 10 13:26:25 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri Oct 10 13:26:41 2008
Subject: [Slony1-general] Using SLONY to Upgrade Postgres Versions
In-Reply-To: <8040425B-AD95-4982-9ABD-53FFB8C0A64B@hi5.com> (Kenny Gorman's
	message of "Fri, 10 Oct 2008 11:27:36 -0700")
References: <BEE194F6-7309-44F1-9DB7-DA96DA98B030@kevinkempterllc.com>
	<8040425B-AD95-4982-9ABD-53FFB8C0A64B@hi5.com>
Message-ID: <87abdcdwni.fsf@dba2.int.libertyrms.com>

Kenny Gorman <kgorman@hi5.com> writes:
> You can just stop the slon processes, and drop the schema that holds
> the replication tables, then your all clean again.

I would prefer to cleanly uninstall Slony-I on it via the slonik command
UNINSTALL NODE.

<http://www.slony.info/documentation/stmtuninstallnode.html>

That does some things that simply dropping the schema doesn't.

Looking at the code for uninstallNode():

	-- ----
	-- Grab the central configuration lock
	-- ----
	lock table @NAMESPACE@.sl_config_lock;

	-- ----
	-- This is us ... time for suicide! Restore all tables to
	-- their original status.
	-- ----
	for v_tab_row in select * from @NAMESPACE@.sl_table loop
		perform @NAMESPACE@.alterTableRestore(v_tab_row.tab_id);
		perform @NAMESPACE@.tableDropKey(v_tab_row.tab_id);
	end loop;

	raise notice ''Slony-I: Please drop schema "_@CLUSTERNAME@"'';
	return 0;
-- 
(format nil "~S@~S" "cbbrowne" "acm.org")
http://cbbrowne.com/info/sap.html
"When the grammar checker identifies an error, it suggests a
correction and can even makes some changes for you."  
-- Microsoft Word for Windows 2.0 User's Guide, p.35:
From stuart at stuartbishop.net  Mon Oct 13 03:05:21 2008
From: stuart at stuartbishop.net (Stuart Bishop)
Date: Mon Oct 13 03:05:55 2008
Subject: [Slony1-general] Re: [GENERAL] Stripping out slony after / before
	/ during pg_restore?
In-Reply-To: <87abdwp357.fsf@dba2.int.libertyrms.com>
References: <349621.46525.qm@web25806.mail.ukl.yahoo.com>
	<48298ACA.1050002@archonet.com>
	<87abdwp357.fsf@dba2.int.libertyrms.com>
Message-ID: <6bc73d4c0810130305q7c522e40v66a765877ee359e0@mail.gmail.com>

>>> I'm setting us up a separate staging / test server and I want to read
>>> in a pg_dump of our current origin stripping out all the slony stuff.
>>>
>>> I was thinking this could serve two purposes a) test out backups
>>> restore properly and b) provide us with us with the staging / test
>>> server
>>>
>>> What's the best way to remove all the slony bits?
>>
>> Well, you can always just drop the slony schema (with a cascade) -
>> that should do it.
>
> Not quite.  There are two things that *doesn't* hit:

So what was the final recommended process for building a stand alone
database from a pg_dump of a replicated node?

pg_dump --oids --format=c --file=master.dump master_db
createdb staging_db
pg_restore -d staging_db master.dump
slonik << EOM
cluster name = sl;
node 1 admin conninfo = 'dbname=staging_db user=slony';
uninstall node (id = 1);
EOM

This process dies on the last step with:

<stdin>:3: PGRES_FATAL_ERROR select "_sl".uninstallNode();  - ERROR:
Slony-I: alterTableRestore(): Table with id 1 not found
CONTEXT:  SQL statement "SELECT  "_sl".alterTableRestore( $1 )"
PL/pgSQL function "uninstallnode" line 14 at PERFORM
Failed to exec uninstallNode() for node 1

So if I'm reading this thread correctly, the alternative is 'DROP _sl
CASCADE;', which doesn't do a full cleanup. Is there no supported
disaster recovery procedure?

-- 
Stuart Bishop <stuart@stuartbishop.net>
http://www.stuartbishop.net/
From stuart at stuartbishop.net  Mon Oct 13 03:22:56 2008
From: stuart at stuartbishop.net (Stuart Bishop)
Date: Mon Oct 13 03:23:31 2008
Subject: [Slony1-general] Feature request for next slony version: initial
	replication of large DBs
In-Reply-To: <64706.196.23.181.69.1207031605.squirrel@zenmail.co.za>
References: <64706.196.23.181.69.1207031605.squirrel@zenmail.co.za>
Message-ID: <6bc73d4c0810130322y774c7200x859a247007a01b67@mail.gmail.com>

On Tue, Apr 1, 2008 at 1:33 PM, Henry <henry@zen.co.za> wrote:
> Good morning all,
>
> I seem to recall (I think it was touched on by someone else) that this
> aspect *might* be addressed in a near-future version of slony:
>
> Given that some users of slony have large (your definition of large will
> vary, but let's say DBs in excess of 100GB) databases, and that the
> initial replication of a DB can take weeks, would it not be a great idea
> to have a more efficient initial 'copy' mode?  ie, either allow a user to
> dump/restore to all slaves, then start replication from that point
> (without truncating/copying/etc), or, build this functionality into slony
> so it does the dump/restore, but does not then truncate all tables and
> start from scratch?
>
> For smaller DBs this doesn't present a problem, but for larger DDs coupled
> with LARGE clusters, this is a major problem.

I would love this too. My use case is the daily building of a staging
database from a dump of our production database. The pg_restore takes
1.5 hours. Now we are adding replication into the equation, and this
is going to add a further 3 hours to the process. The end result is
for nearly 20% of the day the staging server is running with 1 core
tied behind its back as it rebuilds. Previously, this was a more
manageable 6-7%. Ideally, I would pg_restore both master and slave
staging databases simultaneously from the same dump and then setup the
replication sets without the redundant data copying. The proposed
CLONE commands are not suitable for this use case.

-- 
Stuart Bishop <stuart@stuartbishop.net>
http://www.stuartbishop.net/
From stuart at stuartbishop.net  Mon Oct 13 03:43:36 2008
From: stuart at stuartbishop.net (Stuart Bishop)
Date: Mon Oct 13 03:44:11 2008
Subject: [Slony1-general] Re: [GENERAL] Stripping out slony after / before
	/ during pg_restore?
In-Reply-To: <6bc73d4c0810130305q7c522e40v66a765877ee359e0@mail.gmail.com>
References: <349621.46525.qm@web25806.mail.ukl.yahoo.com>
	<48298ACA.1050002@archonet.com>
	<87abdwp357.fsf@dba2.int.libertyrms.com>
	<6bc73d4c0810130305q7c522e40v66a765877ee359e0@mail.gmail.com>
Message-ID: <6bc73d4c0810130343t2f72d59bp417926379800c48e@mail.gmail.com>

On Mon, Oct 13, 2008 at 5:05 PM, Stuart Bishop <stuart@stuartbishop.net> wrote:

> So what was the final recommended process for building a stand alone
> database from a pg_dump of a replicated node?

> So if I'm reading this thread correctly, the alternative is 'DROP _sl
> CASCADE;', which doesn't do a full cleanup. Is there no supported
> disaster recovery procedure?

So to (hopefully) answer my own question, the following seems to Do
The Right Thing?:

pg_dump --oids --format=c --file=master.dump master_db
createdb staging_db
pg_restore -d staging_db master.dump
slonik << EOM
cluster name = sl;
node 1 admin conninfo = 'dbname=staging_db user=slony';
repair config (set id = 1, event node = 1, execute only on = 1);
repair config (set id = 2, event node = 1, execute only on = 1);
uninstall node (id = 1);
EOM

Can anyone who actually knows what they are doing confirm or ridicule
this recipe?

-- 
Stuart Bishop <stuart@stuartbishop.net>
http://www.stuartbishop.net/
From stephane.schildknecht at postgresqlfr.org  Mon Oct 13 04:10:50 2008
From: stephane.schildknecht at postgresqlfr.org (=?ISO-8859-15?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Mon Oct 13 04:11:31 2008
Subject: [Slony1-general] Re: [GENERAL] Stripping out slony after / before
	/ during pg_restore?
In-Reply-To: <6bc73d4c0810130305q7c522e40v66a765877ee359e0@mail.gmail.com>
References: <349621.46525.qm@web25806.mail.ukl.yahoo.com>	
	<48298ACA.1050002@archonet.com>	
	<87abdwp357.fsf@dba2.int.libertyrms.com>
	<6bc73d4c0810130305q7c522e40v66a765877ee359e0@mail.gmail.com>
Message-ID: <48F32CBA.1080904@postgresqlfr.org>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Stuart Bishop a ?crit :
>>>> I'm setting us up a separate staging / test server and I want to read
>>>> in a pg_dump of our current origin stripping out all the slony stuff.
>>>>
>>>> I was thinking this could serve two purposes a) test out backups
>>>> restore properly and b) provide us with us with the staging / test
>>>> server
>>>>
>>>> What's the best way to remove all the slony bits?
>>> Well, you can always just drop the slony schema (with a cascade) -
>>> that should do it.
>> Not quite.  There are two things that *doesn't* hit:
> 
> So what was the final recommended process for building a stand alone
> database from a pg_dump of a replicated node?
> 
> pg_dump --oids --format=c --file=master.dump master_db
> createdb staging_db
> pg_restore -d staging_db master.dump
> slonik << EOM
> cluster name = sl;
> node 1 admin conninfo = 'dbname=staging_db user=slony';
> uninstall node (id = 1);
> EOM
> 
> This process dies on the last step with:
> 
> <stdin>:3: PGRES_FATAL_ERROR select "_sl".uninstallNode();  - ERROR:
> Slony-I: alterTableRestore(): Table with id 1 not found
> CONTEXT:  SQL statement "SELECT  "_sl".alterTableRestore( $1 )"
> PL/pgSQL function "uninstallnode" line 14 at PERFORM
> Failed to exec uninstallNode() for node 1
> 
> So if I'm reading this thread correctly, the alternative is 'DROP _sl
> CASCADE;', which doesn't do a full cleanup. Is there no supported
> disaster recovery procedure?
> 


Hi,

What you can do is call the uninstallnode() procedure.

It is located in the replication schema.

You can call it like that :
select _replication.uninstallnode();

You should recover all tables in their normal state.
Be sure your dump are done on master. Otherwise you will certainly lose
information.

Best regards,
- --
St?phane Schildknecht
PostgreSQLFr - http://www.postgresql.fr
Dalibo - http://www.dalibo.com
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFI8yy6A+REPKWGI0ERAvL6AKCC+r4V+A7h4PmiotSCg7tiDrnHdgCfTK/M
WUccjyObkxYmlROmWgNd+7U=
=9F6L
-----END PGP SIGNATURE-----
From thawes at novadine.com  Mon Oct 13 06:58:25 2008
From: thawes at novadine.com (Tim Hawes)
Date: Mon Oct 13 06:58:17 2008
Subject: [Slony1-general] Slony Architecture
In-Reply-To: <48EF1A78.6070901@postgresqlfr.org>
References: <48EE7814.6000504@novadine.com> <48EF1A78.6070901@postgresqlfr.org>
Message-ID: <48F35401.5050709@novadine.com>


Having nodes 1-7 on one side of the WAN, 1 is the master.
On the other side, I have nodes 8 -12.
The path from 1 to 8 is set up over the WAN
nodes 9-12 have paths to 8 only

St?phane A. Schildknecht wrote:
> Hi,
>
> I never used test_slony_state.pl, but I can tell that design should work.
> How did you configure sl_path ?
>
> Regards,
> - --
> St?phane Schildknecht
> PostgreSQLFr - http://www.postgresql.fr
> Dalibo - http://www.dalibo.com
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.6 (GNU/Linux)
> Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org
>
> iD8DBQFI7xp4A+REPKWGI0ERAmztAKDLQSzHCDJBpZQ6BWtkp47CKHZ84ACg0xb8
> gskqbRhnVhSgpCHSgxi9hJs=
> =XR0i
> -----END PGP SIGNATURE-----
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>   

From stephane.schildknecht at postgresqlfr.org  Mon Oct 13 07:44:41 2008
From: stephane.schildknecht at postgresqlfr.org (=?UTF-8?B?IlN0w6lwaGFuZSBBLiBTY2hpbGRrbmVjaHQi?=)
Date: Mon Oct 13 11:15:11 2008
Subject: [Slony1-general] How to configure a special case of cascaded
	subscriptions
In-Reply-To: <48BE9D14.1080300@mecon.gov.ar>
References: <48BD5602.3070503@mecon.gov.ar>	<2968dfd60809030654l44f8c15agcd831a3969d10ec1@mail.gmail.com>
	<48BE9D14.1080300@mecon.gov.ar>
Message-ID: <48F35ED9.2080502@postgresqlfr.org>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Dami?n Bakarcic a ?crit :
> Vivek Khera escribi?:
>>
>>
>> On Tue, Sep 2, 2008 at 11:04 AM, Dami?n Bakarcic
>> <dbakarcic@mecon.gov.ar <mailto:dbakarcic@mecon.gov.ar>> wrote:
>>
>>     Hi,
>>     I?m relatively new to slony and I needed help to configure it in
>>     order to satisfy the following conditions:
>>     I have four nodes, 1-4, and two replication sets, A-B. B is a
>>     subset of A. Node 1 is the master and node 2 subscribes to 1 to
>>     replicate set A. Nodes 3 and 4 both subscribe to node 2 but i
>>     don?t need them to replicate all of the tables in set A, only the
>>     ones in the subset B.
>>     Am I supposed to create set B with node 1 as origin and only
>>     subscribe nodes 3 and 4 to set B in node 2?. To do this, is it
>>     necessary to also subscribe node 2 to 1 to replicate set B when
>>     set A already includes the tables in set B?.
>>     Thanks in advance.
>>
>>
>> The tables can only be in one set.  Since B is a subset of A, your
>> node 2 should subscribe to both sets A and B, and your nodes 3 & 4
>> should subscribe to just set B.
>>  
>>
> Thanks for the help, but, you tell me that the tables can only be in one
> set, so I understand that A and B cannot have the same origin node. Is
> this correct?. If they actually can have the same origin node, would it
> cause trouble to replicate both sets, whose intersection is not empty,
> between nodes 1 & 2?.
> Is there another way to do this?, for instance, can I "only" replicate
> set A between nodes 1 & 2 and somehow replicate only part of that set
> (subset B exactly) between sets 2 & 3 and 2 & 4.
> Thanks again.
> Damian.
> 

Hi,

What you can do, here, is create 2 different sets, A and B, with union (A,B)
containing all tables that you need to replicate.
You then subscribe 2 to A and B and 3-4 to just B.

That should do the job as expected.

- --
St?phane Schildknecht
PostgreSQLFr - http://www.postgresql.fr
Dalibo - http://www.dalibo.com
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFI817ZA+REPKWGI0ERAgIaAJwJZsrSL+aHq289qxe+do8nHTIMrACfW7Ng
yBCP+9GL1rOmdeoit8MdAJs=
=uHKh
-----END PGP SIGNATURE-----

From stuart at stuartbishop.net  Wed Oct 15 00:51:19 2008
From: stuart at stuartbishop.net (Stuart Bishop)
Date: Wed Oct 15 00:51:47 2008
Subject: [Slony1-general] Re: [GENERAL] Stripping out slony after / before
	/ during pg_restore?
In-Reply-To: <48F32CBA.1080904@postgresqlfr.org>
References: <349621.46525.qm@web25806.mail.ukl.yahoo.com>
	<48298ACA.1050002@archonet.com>
	<87abdwp357.fsf@dba2.int.libertyrms.com>
	<6bc73d4c0810130305q7c522e40v66a765877ee359e0@mail.gmail.com>
	<48F32CBA.1080904@postgresqlfr.org>
Message-ID: <6bc73d4c0810150051sae471dfv383f3cd536051f98@mail.gmail.com>

On Mon, Oct 13, 2008 at 6:10 PM, "St?phane A. Schildknecht"
> What you can do is call the uninstallnode() procedure.
>
> It is located in the replication schema.
>
> You can call it like that :
> select _replication.uninstallnode();
>
> You should recover all tables in their normal state.
> Be sure your dump are done on master. Otherwise you will certainly lose
> information.

This appears to fail on a freshly restored dump because the oids are
different. The REPAIR CONFIG step seems necessary to get UNINSTALL
NODE to work.

(I'm using Slony 1.2.13 with PG 8.3 if that matters)

-- 
Stuart Bishop <stuart@stuartbishop.net>
http://www.stuartbishop.net/
From dknight at wsi.com  Wed Oct 15 08:32:24 2008
From: dknight at wsi.com (Knight, Doug)
Date: Wed Oct 15 08:32:34 2008
Subject: [Slony1-general] Example of using add_empty_table_to_replication
Message-ID: <8536F69C1FCC294B859D07B179F069440FF58A35@EXCHANGE.ad.wsicorp.com>

All,

I am working on some automation scripts to handle adding and dropping
time partitioned tables. I'm looking at Section 20.1 in the
documentation, and understand the "traditional approach". I was
wondering if anyone had an example for the method using
add_empty_table_to_replication? If I understand the steps correctly:

 

1.	Create the new empty partition table on the origin
2.	Create the new empty partition table on the target(s)
3.	Run a shell script invoking slonik with an EXECUTE SCRIPT
command, referencing an SQL script containing a call to
add_empty_table_to_replication

 

It's the third step I'm unsure about. Do I need to use EXECUTE SCRIPT,
or could I just execute the call to the function on each system (origin
then target)? An example of the shell script using EXECUTE SCRIPT for
this specific instance would help a lot.

 

Thanks,

Doug

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20081015/9b95be26/attachment.htm
From cbbrowne at ca.afilias.info  Wed Oct 15 09:29:55 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed Oct 15 09:30:05 2008
Subject: [Slony1-general] Example of using add_empty_table_to_replication
In-Reply-To: <8536F69C1FCC294B859D07B179F069440FF58A35@EXCHANGE.ad.wsicorp.com>
	(Doug Knight's message of "Wed, 15 Oct 2008 11:32:24 -0400")
References: <8536F69C1FCC294B859D07B179F069440FF58A35@EXCHANGE.ad.wsicorp.com>
Message-ID: <87k5c9ddoc.fsf@dba2.int.libertyrms.com>

"Knight, Doug" <dknight@wsi.com> writes:
> :o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns="http://www.w3.org/TR/REC-html40">
>
> All,:p>
>
> I am working on some automation scripts to handle adding and dropping time partitioned tables. I'm looking at Section 20.1 in the documentation,
> and understand the ``traditional approach''. I was wondering if anyone had an example for the method using add_empty_table_to_replication? If I
> understand the steps correctly::p>
>
> :p>?
>
>    1.  Create the new empty partition table on the origin:p>
>    2.  Create the new empty partition table on the target(s):p>
>    3.  Run a shell script invoking slonik with an EXECUTE SCRIPT command, referencing an SQL script containing a call to
>      add_empty_table_to_replication:p>
>
> :p>?
>
> It's the third step I'm unsure about. Do I need to use EXECUTE SCRIPT, or could I just execute the call to the function on each system (origin
> then target)? An example of the shell script using EXECUTE SCRIPT for this specific instance would help a lot.:p>

The function add_empty_table_to_replication() does expect to be run
inside the context of a running EXECUTE SCRIPT request.  Note that the
final two things that it does are thus:

 - calls setAddTable_int(), which adds the table to the set, and adds
   the Slony-I triggers to the table;

 - calls alterTableRestore(), which drops those triggers.

That only works if, subsequently, alterTableForReplication() gets run,
to put the triggers back on.

There is an example of usage of this in the test, "testpartition".

tests/testpartition/gen_ddl_sql.sh is a script that generates the
(rather structured!) contents of a DDL script to be run via EXECUTE
SCRIPT.  

It uses replicate_partition() rather than
add_empty_table_to_replication(), but replicate_partition() is just a
function that calculates the parameters for
add_empty_table_to_replication() based on looking at a table created
using the PostgreSQL inheritance system.
-- 
let name="cbbrowne" and tld="cbbrowne.com" in String.concat "@" [name;tld];;
http://www3.sympatico.ca/cbbrowne/lsf.html
If you're in a vehicle going the speed of light, what happens when you
turn on the headlights?
From ABhat at trustwave.com  Thu Oct 16 12:41:58 2008
From: ABhat at trustwave.com (Anoop Bhat)
Date: Thu Oct 16 12:42:21 2008
Subject: [Slony1-general] Some columns in some tables not replicating
Message-ID: <C51D0336.23E9%abhat@trustwave.com>

I previously had replication working from a master to a backup. I recently moved it from that backup to another in a different location.

I noticed that neither of my backups had this one particular column from a particular table which stored user information.

This column happened to be the password column (sort of important)

The column definition is

 password            | character varying(256)   |


Is there any reason that this column would be blank on both backup servers. Am I missing something?

Thanks

Anoop

Anoop Bhat
Systems Administrator
Trustwave
70 W. Madison
Chicago, IL, 60602
O: 312.873.7446
C: 312.925.3271


From stephane.schildknecht at postgresqlfr.org  Fri Oct 17 10:34:23 2008
From: stephane.schildknecht at postgresqlfr.org (=?ISO-8859-15?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Fri Oct 17 10:34:43 2008
Subject: [Slony1-general] Some columns in some tables not replicating
In-Reply-To: <C51D0336.23E9%abhat@trustwave.com>
References: <C51D0336.23E9%abhat@trustwave.com>
Message-ID: <48F8CC9F.1070608@postgresqlfr.org>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Anoop Bhat a ?crit :
> I previously had replication working from a master to a backup. I recently moved it from that backup to another in a different location.
> 
> I noticed that neither of my backups had this one particular column from a particular table which stored user information.
> 
> This column happened to be the password column (sort of important)
> 
> The column definition is
> 
>  password            | character varying(256)   |
> 
> 
> Is there any reason that this column would be blank on both backup servers. Am I missing something?
> 
> Thanks
> 

Is it possible you had that column to the table once replication was installed,
but did not use "EXECUTE SCRIPT" ?

Regards,
- --
St?phane Schildknecht
PostgreSQLFr - http://www.postgresql.fr
Dalibo - http://www.dalibo.com
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFI+MyfA+REPKWGI0ERAtd0AJ485lBkPuUtJgMc70ECfI0wWjP3AgCdGyZG
K2jzJnQp7g7MjA+6hDiFCTw=
=TZ8d
-----END PGP SIGNATURE-----
From JanWieck at Yahoo.com  Fri Oct 17 11:53:55 2008
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Fri Oct 17 11:53:51 2008
Subject: [Slony1-general] Re: [GENERAL] Stripping out slony after / before
	/ during pg_restore?
In-Reply-To: <48F32CBA.1080904@postgresqlfr.org>
References: <349621.46525.qm@web25806.mail.ukl.yahoo.com>		<48298ACA.1050002@archonet.com>		<87abdwp357.fsf@dba2.int.libertyrms.com>	<6bc73d4c0810130305q7c522e40v66a765877ee359e0@mail.gmail.com>
	<48F32CBA.1080904@postgresqlfr.org>
Message-ID: <48F8DF43.9080008@Yahoo.com>

On 10/13/2008 7:10 AM, St?phane A. Schildknecht wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> Stuart Bishop a ?crit :
>>>>> I'm setting us up a separate staging / test server and I want to read
>>>>> in a pg_dump of our current origin stripping out all the slony stuff.
>>>>>
>>>>> I was thinking this could serve two purposes a) test out backups
>>>>> restore properly and b) provide us with us with the staging / test
>>>>> server
>>>>>
>>>>> What's the best way to remove all the slony bits?
>>>> Well, you can always just drop the slony schema (with a cascade) -
>>>> that should do it.
>>> Not quite.  There are two things that *doesn't* hit:
>> 
>> So what was the final recommended process for building a stand alone
>> database from a pg_dump of a replicated node?
>> 
>> pg_dump --oids --format=c --file=master.dump master_db
>> createdb staging_db
>> pg_restore -d staging_db master.dump
>> slonik << EOM
>> cluster name = sl;
>> node 1 admin conninfo = 'dbname=staging_db user=slony';
>> uninstall node (id = 1);
>> EOM
>> 
>> This process dies on the last step with:
>> 
>> <stdin>:3: PGRES_FATAL_ERROR select "_sl".uninstallNode();  - ERROR:
>> Slony-I: alterTableRestore(): Table with id 1 not found
>> CONTEXT:  SQL statement "SELECT  "_sl".alterTableRestore( $1 )"
>> PL/pgSQL function "uninstallnode" line 14 at PERFORM
>> Failed to exec uninstallNode() for node 1
>> 
>> So if I'm reading this thread correctly, the alternative is 'DROP _sl
>> CASCADE;', which doesn't do a full cleanup. Is there no supported
>> disaster recovery procedure?
>> 
> 
> 
> Hi,
> 
> What you can do is call the uninstallnode() procedure.

It is too late at this point. In Slony before version 2.0, the dump from 
the subscriber may NOT contain the full schema information. There is no 
way to "fix" that.

The recommended way is to take separate schema and data dumps. The 
schema must come from the origin, the data can come from a subscriber.

Alternatively a healthy subscriber can be turned into a standalone 
database by running UNINSTALL NODE. Or one can do a regular failover in 
order to keep other subscribers.


Jan


> 
> It is located in the replication schema.
> 
> You can call it like that :
> select _replication.uninstallnode();
> 
> You should recover all tables in their normal state.
> Be sure your dump are done on master. Otherwise you will certainly lose
> information.
> 
> Best regards,
> - --
> St?phane Schildknecht
> PostgreSQLFr - http://www.postgresql.fr
> Dalibo - http://www.dalibo.com
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.6 (GNU/Linux)
> Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org
> 
> iD8DBQFI8yy6A+REPKWGI0ERAvL6AKCC+r4V+A7h4PmiotSCg7tiDrnHdgCfTK/M
> WUccjyObkxYmlROmWgNd+7U=
> =9F6L
> -----END PGP SIGNATURE-----
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin

From cbbrowne at ca.afilias.info  Fri Oct 17 14:23:12 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri Oct 17 14:23:29 2008
Subject: [Slony1-general] Some columns in some tables not replicating
In-Reply-To: <C51D0336.23E9%abhat@trustwave.com> (Anoop Bhat's message of
	"Thu, 16 Oct 2008 14:41:58 -0500")
References: <C51D0336.23E9%abhat@trustwave.com>
Message-ID: <87ljwmc3wf.fsf@dba2.int.libertyrms.com>

Anoop Bhat <ABhat@trustwave.com> writes:
> I previously had replication working from a master to a backup. I recently moved it from that backup to another in a different location.
>
> I noticed that neither of my backups had this one particular column from a particular table which stored user information.
>
> This column happened to be the password column (sort of important)
>
> The column definition is
>
>  password            | character varying(256)   |
>
>
> Is there any reason that this column would be blank on both backup
> servers. Am I missing something?

No reason I can think of; the only reason I'd see for this would be if
you had altered the table schemas by hand to introduce the password
column, so that somehow the data escaped being captured in the first
place.

Thus, the way I could see it happening is if you added password column
to all tables *WITHOUT* using "EXECUTE SCRIPT".

In that case, then (in some versions of Slony-I), the new password
column would not have been captured in the log trigger function
information, and, as a consequence, the password, not being captured
would not be replicated to other nodes.

That explanation shouldn't be valid for the 1.2 branch.  It *may* not
be true for 1.1; not 100% certain...
-- 
select 'cbbrowne' || '@' || 'cbbrowne.com';
http://www3.sympatico.ca/cbbrowne/oses.html
Actually, typing random  strings in the Finder does  the equivalent of
filename  completion.    (Discussion  in  comp.os.linux.misc   on  the
intuitiveness of commands: file completion vs. the Mac Finder.)
From Ow.Mun.Heng at wdc.com  Sun Oct 19 22:56:59 2008
From: Ow.Mun.Heng at wdc.com (Ow Mun Heng)
Date: Sun Oct 19 22:58:42 2008
Subject: [Slony1-general] Adding Column to a Partitioned table - Question
Message-ID: <1224482219.9047.5.camel@neuromancer.home.net>

Hi All,

After realising how to get slony to do partitioned tables, I've finally
setted on this replication sets. (at that time, I thought this was the
best method)

tables
parent
-> child1
-> child2
-> child3
....
...
-> child52


where the childs are partitioned every week and I decided to put them
into Quarters such that I can easily drop the old partitions and remove
the sets from replication.

eg:
replication set 1 (Q1)
-> parent Table
-> child1
-> child2
...
-> child12

replication set 2(Q2)
->child 13
-> child14
...
...
-> child24

problem now, is that I want to add a new column into them. How do I go
about it?

Do I 

1) Do execute script on EACH replication set consequtively?
2) Do execute script on each Table? (since supposedly slony treats them
NOT as partitioned tables, but as individual tables) [somehow, I don't
think this will work]
3) remove the tables from being parent/child partitions and do execute
script on EACH table in EACH replication set?

Please help out out here. 

Thanks

From dknight at wsi.com  Tue Oct 21 06:37:25 2008
From: dknight at wsi.com (Knight, Doug)
Date: Tue Oct 21 06:37:31 2008
Subject: [Slony1-general] Best way to progamatically determine slony is
	installed and operational
Message-ID: <8536F69C1FCC294B859D07B179F06944100521A4@EXCHANGE.ad.wsicorp.com>

All,

I have a need to create a script that automatically determines if slony
is installed and replicating on a specific database. The idea is that
another script that handles time partitioned table drops/creates could
call this script to determine if it needs to do any special slony
processing instead of its direct drop/create statements (i.e. pass the
SQL via slonik EXECUTE SCRIPT). I figure I'll be looking in the
information_schema schema for the current database. Is there any
particular place I should look (maybe the existence of an sl_status
table in information_schema.tables)? Any best practices would be great.

 

Thanks,

Doug Knight

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20081021/ba2781a7/attachment.htm
From AmMarya at symcor.com  Tue Oct 21 10:20:51 2008
From: AmMarya at symcor.com (AmMarya@symcor.com)
Date: Tue Oct 21 10:24:32 2008
Subject: [Slony1-general] SLONY - I Question
Message-ID: <OFBC5EC6CC.88FDCCB6-ON852574E9.0058EF42-852574E9.005F4A51@symcor.com>

Hi,

I have set up replication between 2 PostgreSQL servers using SLONY - I. One
is a Master and the 2nd one is a Slave. I am planning to add more Slave
servers to this setup. In effect the plan is to set up a chain (i.e. Slave
1 subscribes to Master, Slave 2 subscribes to Slave 1, Slave 3 subscribes
to Slave 2 ... and so on).

I have the following questions:

1.    If one of the slave node goes down, will Slony be able to
automatically detect that it has gone down? If no, what is the best way to
receive notification    when one or more slave goes down?

2.    If one of the slave node goes down, will replication continue over to
the next Slave(s) in the chain? (ie. if Slave 2 goes down, would the
replication             automatically go from Slave 1 to Slave 3 to keep
the chain running?) If no, what needs to be done to get the chain to
continue?

3.    If a slave node goes down, what is the process after it is back
on-line to reset the chain and synchronize the data? (i.e. if Slave 2 goes
down and the            chain is then running as Master .. Slave 1 ...
Slave 3 ... and so on, when Slave 2 is ready and back on-line, how do we
insert it back in the chain so that       the chain is back to original and
synchronize the data as well)?

Thanks a lot in advance,

If you can reply to ammarya@symcor.com, it would be greatly appreciated.

Regards,

Amit

-------------- next part --------------


CONFIDENTIALITY WARNING 
This communication, including any attachments, is for the exclusive use of addressee and may contain proprietary and/or confidential information. If you are not the intended recipient, any use, copying, disclosure, dissemination or distribution is strictly prohibited. If you are not the intended recipient, please notify the sender immediately by return e-mail, delete this communication and destroy all copies.

AVERTISSEMENT RELATIF ? LA CONFIDENTIALIT? 
Ce message, ainsi que les pi?ces qui y sont jointes, est destin? ? l?usage exclusif de la personne ? laquelle il s?adresse et peut contenir de l?information personnelle ou confidentielle. Si le lecteur de ce message n?en est pas le destinataire, nous l?avisons par la pr?sente que toute diffusion, distribution, reproduction ou utilisation de son contenu est strictement interdite. Veuillez avertir sur-le-champ l?exp?diteur par retour de courrier ?lectronique et supprimez ce message ainsi que toutes les pi?ces jointes.
From quinn_jones at pobox.com  Tue Oct 21 16:42:07 2008
From: quinn_jones at pobox.com (quinn)
Date: Tue Oct 21 16:42:28 2008
Subject: [Slony1-general] SLONY - I Question
In-Reply-To: <OFBC5EC6CC.88FDCCB6-ON852574E9.0058EF42-852574E9.005F4A51@symcor.com>
References: <OFBC5EC6CC.88FDCCB6-ON852574E9.0058EF42-852574E9.005F4A51@symcor.com>
Message-ID: <48FE68CF.1080402@pobox.com>

AmMarya@symcor.com wrote:
> Hi,
>
> I have set up replication between 2 PostgreSQL servers using SLONY - I. One
> is a Master and the 2nd one is a Slave. I am planning to add more Slave
> servers to this setup. In effect the plan is to set up a chain (i.e. Slave
> 1 subscribes to Master, Slave 2 subscribes to Slave 1, Slave 3 subscribes
> to Slave 2 ... and so on).
>
> I have the following questions:
>
> 1.    If one of the slave node goes down, will Slony be able to
> automatically detect that it has gone down? If no, what is the best way to
> receive notification    when one or more slave goes down?
>   
Slony doesn't have any detection built in.  What should happen when a
slave goes down is a business decision.  What should happen when a node
goes down?  How would your users and applications know which node to
communicate with?
To quote from the manual
(http://slony.info/documentation/slonyintro.html): "... choosing what to
do based on the 'shape' of the cluster represents local business policy,
particularly in view of the fact that FAIL OVER
<http://slony.info/documentation/stmtfailover.html> requires discarding
the failed node. If Slony-I imposed failover policy on you, that might
conflict with business requirements, thereby making Slony-I an
unacceptable choice."
In my case, we use Heartbeat (http://www.linux-ha.org/) and mon together
to monitor our databases and automate failover, and Nagios
(http://www.nagios.org/) to test the state of our nodes and alert us to
non-critical problems.
> 2.    If one of the slave node goes down, will replication continue over to
> the next Slave(s) in the chain? (ie. if Slave 2 goes down, would the
> replication             automatically go from Slave 1 to Slave 3 to keep
> the chain running?) If no, what needs to be done to get the chain to
> continue?
>   
Quick answer: no, not with your proposed configuration.  Part of your
failover procedure should include re-subscribing the node farther down
the chain (SUBSCRIBE SET) to a good node farther up the chain.  See
http://slony.info/documentation/reshape.html for details.
If each slave node subscribed to the master, then there would no chain
to break.  In your case, you're intentionally configuring a chain which
could be broken.  If you're worried about losing subscriptions, you may
want to try a different cluster shape.
If you're setting up a chain because you're trying to avoid bottlenecks,
you may not need to worry.  We have several clusters that are on WANs,
replicating two or more nodes across the same connection.  Latency isn't
a problem except for initial sync, which only happens once.
> 3.    If a slave node goes down, what is the process after it is back
> on-line to reset the chain and synchronize the data? (i.e. if Slave 2 goes
> down and the            chain is then running as Master .. Slave 1 ...
> Slave 3 ... and so on, when Slave 2 is ready and back on-line, how do we
> insert it back in the chain so that       the chain is back to original and
> synchronize the data as well)?
>   
You would use SUBSCRIBE SET, similar to what was addressed in question
2.  It seems like you're doing something different, but really you're
not.  It's a different case of the same procedure.
> Thanks a lot in advance,
>
> If you can reply to ammarya@symcor.com, it would be greatly appreciated.
>
> Regards,
>
> Amit
>
>   
Hope this helps.

Quinn
From jpfletch at ca.afilias.info  Wed Oct 22 13:33:20 2008
From: jpfletch at ca.afilias.info (JP Fletcher)
Date: Wed Oct 22 13:33:32 2008
Subject: [Slony1-general] Best way to progamatically determine slony is
	installed and operational
In-Reply-To: <8536F69C1FCC294B859D07B179F06944100521A4@EXCHANGE.ad.wsicorp.com>
References: <8536F69C1FCC294B859D07B179F06944100521A4@EXCHANGE.ad.wsicorp.com>
Message-ID: <48FF8E10.7010802@ca.afilias.info>

Your query of information_schema.tables will work fine to determine if 
slony schema is installed. You can take the results of this query 
(particularly table_schema) then call:

SELECT _table_schema.getlocalnodeid('_table_schema')

With this result, you can determine if the node is a receiver or 
provider for any sets via a query of sl_subscribe.

Regards,

JP

Knight, Doug wrote:
>
> All,
>
> I have a need to create a script that automatically determines if 
> slony is installed and replicating on a specific database. The idea is 
> that another script that handles time partitioned table drops/creates 
> could call this script to determine if it needs to do any special 
> slony processing instead of its direct drop/create statements (i.e. 
> pass the SQL via slonik EXECUTE SCRIPT). I figure I?ll be looking in 
> the information_schema schema for the current database. Is there any 
> particular place I should look (maybe the existence of an sl_status 
> table in information_schema.tables)? Any best practices would be great.
>
> Thanks,
>
> Doug Knight
>
> ------------------------------------------------------------------------
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>   


-- 
JP Fletcher
Database Administrator
Afilias Canada
voice: 416.646.3304 ext. 4123
fax: 416.646.3305
mobile: 416.561.4763
jpfletch@ca.afilias.info


From mlorenz at evryx.com  Thu Oct 23 12:38:54 2008
From: mlorenz at evryx.com (Michael Lorenz)
Date: Thu Oct 23 12:39:06 2008
Subject: [Slony1-general] Set 2 not found in runtime configuration
Message-ID: <FB2CA7F7-92C8-4C3C-9A0E-6BBF98A44024@evryx.com>

Hi all,

I ran into a problem with Slony yesterday, and I'm hoping someone can  
help me resolve it.  I've checked the mailing lists, searched the web,  
etc., but I didn't find a definitive answer anywhere.  The closest set  
of messages I've found on this list can be found at:  http://www.mail-archive.com/pgadmin-support@postgresql.org/msg07704.html

What I was doing was adding a new table to the schema and trying to  
set up replication for it.  I did it twice;  once for a test table  
(which worked), then a second time with a different table (which  
didn't).  The script I used looked like this:

	CREATE SET ( ID = 2, ORIGIN = 1, COMMENT = 'set comment' );
	SET ADD TABLE ( SET ID = 2, ORIGIN = 1, ID = 39, FULLY QUALIFIED NAME  
= 'public.testtable', COMMENT = 'table comment' );
	SUBSCRIBE SET (ID = 2, PROVIDER = 1, RECEIVER = 2);
	SYNC ( ID = 1 );
	WAIT FOR EVENT (ORIGIN = 1, CONFIRMED = 2);
	MERGE SET ( ID = 1, ADD ID = 2, ORIGIN = 1 );

Now, I'm not sure if this is relevant, but I tried to add the second  
table about 20-30 minutes after the first one.  As far as I can tell,  
the MERGE SET from the first table had completed, since there was no  
set 2 in the sl_set table anymore.

Replication has stopped since that error happened, and here's what  
keeps on showing up in the log now:

	2008-10-23 13:26:47 GMT DEBUG2 localListenThread: Received event  
2,1082313 SYNC
	2008-10-23 13:26:50 GMT DEBUG2 remoteListenThread_1: LISTEN
	2008-10-23 13:26:50 GMT DEBUG1 copy_set 2
	2008-10-23 13:26:50 GMT ERROR  remoteWorkerThread_1: set 2 not found  
in runtime configuration
	2008-10-23 13:26:50 GMT WARN   remoteWorkerThread_1: data copy for  
set 2 failed - sleep 60 seconds

Short of doing a node subscribe/unsubscribe (which I don't want to try  
if this happens in production), is there some way to get this cleaned  
up and replication started again?  If it means deleting some record(s)  
from sl_event, is there a good way to identify which is/are the  
offending records to remove?  Or, since replication seems to be  
frozen, could I just blow away all records in sl_event on the slave,  
or...?

Thanks,
     Michael

From mlorenz at evryx.com  Mon Oct 27 11:04:13 2008
From: mlorenz at evryx.com (Michael Lorenz)
Date: Mon Oct 27 11:06:38 2008
Subject: [Slony1-general] Set 2 not found in runtime configuration
In-Reply-To: <FB2CA7F7-92C8-4C3C-9A0E-6BBF98A44024@evryx.com>
References: <FB2CA7F7-92C8-4C3C-9A0E-6BBF98A44024@evryx.com>
Message-ID: <69CB30F4-B218-45F1-931F-A525EF021CA5@evryx.com>

OK, so blowing away all of the records in sl_event *did* get  
replication started again.

However, as I said in the original post, this is not something I want  
to try in production.  Can anyone provide any information as to how to  
get Slony back on track when replication gets messed up as I described  
below?  Of particular use would be how to identify problem sl_event  
records (if doing that is the best way).

Thanks,
     Michael

On Oct 23, 2008, at 12:38 PM, Michael Lorenz wrote:

> Hi all,
>
> I ran into a problem with Slony yesterday, and I'm hoping someone  
> can help me resolve it.  I've checked the mailing lists, searched  
> the web, etc., but I didn't find a definitive answer anywhere.  The  
> closest set of messages I've found on this list can be found at:  http://www.mail-archive.com/pgadmin-support@postgresql.org/msg07704.html
>
> What I was doing was adding a new table to the schema and trying to  
> set up replication for it.  I did it twice;  once for a test table  
> (which worked), then a second time with a different table (which  
> didn't).  The script I used looked like this:
>
> 	CREATE SET ( ID = 2, ORIGIN = 1, COMMENT = 'set comment' );
> 	SET ADD TABLE ( SET ID = 2, ORIGIN = 1, ID = 39, FULLY QUALIFIED  
> NAME = 'public.testtable', COMMENT = 'table comment' );
> 	SUBSCRIBE SET (ID = 2, PROVIDER = 1, RECEIVER = 2);
> 	SYNC ( ID = 1 );
> 	WAIT FOR EVENT (ORIGIN = 1, CONFIRMED = 2);
> 	MERGE SET ( ID = 1, ADD ID = 2, ORIGIN = 1 );
>
> Now, I'm not sure if this is relevant, but I tried to add the second  
> table about 20-30 minutes after the first one.  As far as I can  
> tell, the MERGE SET from the first table had completed, since there  
> was no set 2 in the sl_set table anymore.
>
> Replication has stopped since that error happened, and here's what  
> keeps on showing up in the log now:
>
> 	2008-10-23 13:26:47 GMT DEBUG2 localListenThread: Received event  
> 2,1082313 SYNC
> 	2008-10-23 13:26:50 GMT DEBUG2 remoteListenThread_1: LISTEN
> 	2008-10-23 13:26:50 GMT DEBUG1 copy_set 2
> 	2008-10-23 13:26:50 GMT ERROR  remoteWorkerThread_1: set 2 not  
> found in runtime configuration
> 	2008-10-23 13:26:50 GMT WARN   remoteWorkerThread_1: data copy for  
> set 2 failed - sleep 60 seconds
>
> Short of doing a node subscribe/unsubscribe (which I don't want to  
> try if this happens in production), is there some way to get this  
> cleaned up and replication started again?  If it means deleting some  
> record(s) from sl_event, is there a good way to identify which is/ 
> are the offending records to remove?  Or, since replication seems to  
> be frozen, could I just blow away all records in sl_event on the  
> slave, or...?
>
> Thanks,
>    Michael
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>

Michael Lorenz

evryx technologies inc.
412 w. broadway, suite 201
glendale, california 91204
818.552.3568 x117            www.evryx.com



From msteben at autorevenue.com  Mon Oct 27 14:09:14 2008
From: msteben at autorevenue.com (Mark Steben)
Date: Mon Oct 27 14:09:45 2008
Subject: [Slony1-general] MIXED VERSIONS OF POSTGRES
Message-ID: <B9913A1EF02C418AB81F7A1BDFB52A7D@dei26g028534>

SEksCgpRdWljayBxdWVzdGlvbjogIG91ciBtYXN0ZXIgbm9kZSBydW5zIHBvc3RncmVzIDguMi41
IGluIE1hc3NhY2h1c2V0dHMKCk91ciBwcm9wb3NlZCBzbGF2ZSBub2RlIHJ1bnMgcG9zdGdyZXMg
OC4zLjMgaW4gVmlyZ2luaWEKCkRvIHdlIG5lZWQgdG8gdXBncmFkZSBvdXIgbWFzdGVyIHRvIDgu
MyBpbiBvcmRlciB0byBzdWNjZXNzZnVsbHkgcnVuIHNsb255PwoKSSBoYXZlIGJlZW4gdGVzdGlu
ZyBvbiBzaW1pbGFyIG5vZGVzIHdpdGggc2xvbnkgMS4yLjE0LgoKIAoKVGhhbmtzIGZvciB5b3Vy
IGhlbHAKCiAKCiAKCiAKCiAKCiAKCiA8bWFpbHRvOmF1dG9lbnRodXNpYXN0c0BhdXRvcmV2ZW51
ZS5jb20/c3ViamVjdD1GZWVkYmFjaz4gQ29tbWl0dGVkIHRvCkNyZWF0aW5nIEB1dG9FbnRodXNp
YXN0cy4gUGxlYXNlIHByb3ZpZGUgdXMgd2l0aCB5b3VyIGZlZWRiYWNrLiAKCiAgX19fX18gIAoK
TWFyayBTdGViZW6BRGF0YWJhc2UgQWRtaW5pc3RyYXRvcoEgIDxodHRwOi8vd3d3LmF1dG9yZXZl
bnVlLmNvbS8+CkB1dG9SZXZlbnVlVAo5NSBBc2hsZXkgQXZlLiBXZXN0IFNwcmluZ2ZpZWxkLCBN
QS4sIDAxMDg5IAo0MTMtMjQzLTQ4MDAgeDE1MTIgKFBob25lKSCBIDQxMy03MzItMTgyNCAoRmF4
KQoKQSBEaXZpc2lvbiBvZiBEb21pbmlvbiBFbnRlcnByaXNlcwoKIAoKIAoKIAoKLS0tLS0tLS0t
LS0tLS0gbmV4dCBwYXJ0IC0tLS0tLS0tLS0tLS0tCkFuIEhUTUwgYXR0YWNobWVudCB3YXMgc2Ny
dWJiZWQuLi4KVVJMOiBodHRwOi8vbGlzdHMuc2xvbnkuaW5mby9waXBlcm1haWwvc2xvbnkxLWdl
bmVyYWwvYXR0YWNobWVudHMvMjAwODEwMjcvY2M3MGRjYzgvYXR0YWNobWVudC5odG0K
From cbbrowne at ca.afilias.info  Mon Oct 27 14:29:13 2008
From: cbbrowne at ca.afilias.info (cbbrowne)
Date: Mon Oct 27 14:29:27 2008
Subject: [Slony1-general] MIXED VERSIONS OF POSTGRES
In-Reply-To: <B9913A1EF02C418AB81F7A1BDFB52A7D@dei26g028534>
References: <B9913A1EF02C418AB81F7A1BDFB52A7D@dei26g028534>
Message-ID: <490632A9.5050807@ca.afilias.info>

Mark Steben wrote:
>
> HI,
>
> Quick question:  our master node runs postgres 8.2.5 in Massachusetts
>
> Our proposed slave node runs postgres 8.3.3 in Virginia
>
> Do we need to upgrade our master to 8.3 in order to successfully run 
> slony?
>
> I have been testing on similar nodes with slony 1.2.14.
>
>  
>
One of the official "use cases" of Slony-I is to do upgrades, so there 
shouldn't be any notable problems with doing this.

It is possible to get "bitten" by differences between 8.2 and 8.3; 
that's inherent to having a mixed environment, and not to Slony-I itself.

Between 7.4 and 8.0 (if memory serves) there were changes in the 
handling of Unicode validation; there would be a risk, between *those* 
versions, of the 7.4 instance accepting some invalid Unicode that the 
8.0 (or newer) instance would (correctly) not accept.  That's not a 
problem you'd experience with your versions, but that's the sort of 
thing I'd be at least a little wary of.

I know that the DBAs I work with would be aghast at the thought of 
running apps against variant versions of PostgreSQL for any long term 
period of time, but again, that's not a Slony-I issue as much as a 
general issue surrounding the proliferation of varying versions of 
things in the environment.  More versions of *anything* means more 
"spinning plates" in the air.   http://en.wikipedia.org/wiki/Plate_spinning

-- 
(format nil "~S@~S" "cbbrowne" "ca.afilias.info")
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)

From ABhat at trustwave.com  Mon Oct 27 16:48:54 2008
From: ABhat at trustwave.com (Anoop Bhat)
Date: Mon Oct 27 16:49:15 2008
Subject: [Slony1-general] Removing old schemas
Message-ID: <C52BBD96.288E%abhat@trustwave.com>

Hi,

I've got a database that I was replicating manually (without the altperl scripts) for some time but now I'm using the altperl scripts for replication which obviously make things a lot easier.

Four questions from all this.


 1.  if I do a slon_kill -config, how can I restart the replication? Can I just a slon_start -config followed by a slonik_subscribe_set -config set1 node2?
 2.  I want to get rid of all the previous attempts at replication. Can I simply drop the schemas that were created previously by me on the master?
 3.  what is a good way to check the status of the replication to see how much is replicated and or what has been replicated thus far?
 4.  I setup all the replication from the slave itself using this as a rough guide http://trac.browsershots.org/wiki/DatabaseReplication. Is this appropriate/recommended or does something need to be initiated from the master? Previously, I would run a slon process on the master and a slon on the slave but this seems much easier. Almost too good to be true.

Lastly, I just wanted to say that the altperl scripts are so much easier to deal with and they do seem to make life a lot easier.

Thanks very much.

From cbbrowne at ca.afilias.info  Tue Oct 28 07:58:59 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Tue Oct 28 07:59:11 2008
Subject: [Slony1-general] Removing old schemas
In-Reply-To: <C52BBD96.288E%abhat@trustwave.com> (Anoop Bhat's message of
	"Mon, 27 Oct 2008 18:48:54 -0500")
References: <C52BBD96.288E%abhat@trustwave.com>
Message-ID: <873aig22bw.fsf@dba2.int.libertyrms.com>

Anoop Bhat <ABhat@trustwave.com> writes:
> I've got a database that I was replicating manually (without the altperl scripts) for some time but now I'm using the altperl scripts for replication which obviously make things a lot easier.
>
> Four questions from all this.
>
>
>  1.  if I do a slon_kill -config, how can I restart the replication? Can I just a slon_start -config followed by a slonik_subscribe_set -config set1 node2?

You don't need to resubscribe; you merely need to restart the slon
processes.  If there are updates outstanding, they will be carried
over to the subscribers.

There are some ways in which Slony-I is pretty fragile; it's not so
fragile that killing a slon process breaks it :-).

>  2.  I want to get rid of all the previous attempts at
>  replication. Can I simply drop the schemas that were created
>  previously by me on the master?

Slony-I messes (until v2.0) with the internal catalog, so the safe
ways to handle this would include:

 - UNSUBSCRIBE SET
   To remove one subscriber

 - DROP NODE/UNINSTALL NODE
   To clean out one node

>  3.  what is a good way to check the status of the replication to
>  see how much is replicated and or what has been replicated thus
>  far?

There is a view in the Slony-I schema called "sl_status."  Query that
on the origin node, and you'll get a good idea as to how far the
subscribers are behind.

>  4.  I setup all the replication from the slave itself using this as
>  a rough guide
>  http://trac.browsershots.org/wiki/DatabaseReplication. Is this
>  appropriate/recommended or does something need to be initiated from
>  the master? Previously, I would run a slon process on the master
>  and a slon on the slave but this seems much easier. Almost too good
>  to be true.

Where you run the slon processes and where you run configuration
scripts is your choice; in our environment, we have devoted database
servers, as well as "utility servers", and we run slon processes and
slonik configuration from the "utility servers."

There are good things about running everything from one spot, as that
means:
 - You don't have scripts (slonik and otherwise) strewn across a bunch
   of servers

 - You have a single view of all the slon processes, and can be sure
   they are all running or stopped without needing to ssh to other
   hosts

> Lastly, I just wanted to say that the altperl scripts are so much
> easier to deal with and they do seem to make life a lot easier.

If only we had someone doing more maintenance on them...
-- 
(format nil "~S@~S" "cbbrowne" "linuxfinances.info")
http://cbbrowne.com/info/internet.html
Rules of the  Evil Overlord #60. "My five-year-old  child advisor will
also  be asked to  decipher any  code I  am thinking  of using.  If he
breaks the code  in under 30 seconds, it will not  be used. Note: this
also applies to passwords." <http://www.eviloverlord.com/>
From chemuduguntar at gmail.com  Thu Oct 30 14:35:30 2008
From: chemuduguntar at gmail.com (Ravi Chemudugunta)
Date: Thu Oct 30 14:35:51 2008
Subject: [Slony1-general] excluding slony from output of pg_dump
Message-ID: <7a4208ef0810301435s61f1decdh443bcf78113b1113@mail.gmail.com>

Hi all,

I was wondering if it was possible to remove slony from the output of
pg_dump.  I am currently accomplishing something similar with
--excludeschema _cluster (where all the slony stuff is) but all of the
triggers on replicated tables are still there.

It would be good if I could do something like uninstallnode() from within a
transaction and dump the db schema from within the context ...

does anyone have any good ideas on how I can do this?

-ravi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20081031/=
cd38ae77/attachment.htm
From tmblue at gmail.com  Thu Oct 30 15:06:21 2008
From: tmblue at gmail.com (Tory M Blue)
Date: Thu Oct 30 15:06:42 2008
Subject: [Slony1-general] 1.2.14 and 1.2.15
Message-ID: <8a547c840810301506ka3d9ff2yded946a9ab1ec6f1@mail.gmail.com>

Can 1.2.14 and 1.2.15 run together, or is this not possible either?

It would be nice for minor patch releases to be compatible, just
during the upgrade process.

master db - slave db

2 query slave dbs.


Switchover from master to slave, upgrade master, start slon, comes
into sync, slave (which is still on 1.2.14) runs a switchover to
master whom is now running 1.2.15, take down slave, upgrade, start
slon on 1.2.15, master again replicating to slave.

Etc.  I'm just remembering that versions were not compatible, but am
not clear if that goes for smaller patch versions as well? And if not,
it's kind of a pain :)

Thanks
Tory
From ahodgson at simkin.ca  Thu Oct 30 15:12:04 2008
From: ahodgson at simkin.ca (Alan Hodgson)
Date: Thu Oct 30 15:12:27 2008
Subject: [Slony1-general] 1.2.14 and 1.2.15
In-Reply-To: <8a547c840810301506ka3d9ff2yded946a9ab1ec6f1@mail.gmail.com>
References: <8a547c840810301506ka3d9ff2yded946a9ab1ec6f1@mail.gmail.com>
Message-ID: <200810301512.04849@hal.medialogik.com>

On Thursday 30 October 2008, "Tory M Blue" <tmblue@gmail.com> wrote:
>  I'm just remembering that versions were not compatible, but am
> not clear if that goes for smaller patch versions as well? And if not,
> it's kind of a pain :)

They aren't, but the upgrades aren't really an issue - just take down the 
slons, replace the installed Slony, run a slon script to "update 
functions", and restart the slons. No downtime, unless I'm missing 
something ...

-- 
Alan
From tmblue at gmail.com  Thu Oct 30 16:20:15 2008
From: tmblue at gmail.com (Tory M Blue)
Date: Thu Oct 30 16:20:39 2008
Subject: [Slony1-general] 1.2.14 and 1.2.15
In-Reply-To: <200810301512.04849@hal.medialogik.com>
References: <8a547c840810301506ka3d9ff2yded946a9ab1ec6f1@mail.gmail.com>
	<200810301512.04849@hal.medialogik.com>
Message-ID: <8a547c840810301620j78d1d46bqb41ef986887b417e@mail.gmail.com>

On Thu, Oct 30, 2008 at 3:12 PM, Alan Hodgson <ahodgson@simkin.ca> wrote:
> On Thursday 30 October 2008, "Tory M Blue" <tmblue@gmail.com> wrote:
>>  I'm just remembering that versions were not compatible, but am
>> not clear if that goes for smaller patch versions as well? And if not,
>> it's kind of a pain :)
>
> They aren't, but the upgrades aren't really an issue - just take down the
> slons, replace the installed Slony, run a slon script to "update
> functions", and restart the slons. No downtime, unless I'm missing
> something ...


Oops sorry Alan, your right no downtime, except that i'm upgrading
postgres at the same time (I bundle my rpm).. So I have to stop
postgres which requires downtime.

Ya I could decouple and do it with very little downtime ..

at least you made me think :)

Thanks
Tory
From stephane.schildknecht at postgresqlfr.org  Fri Oct 31 01:58:42 2008
From: stephane.schildknecht at postgresqlfr.org (=?ISO-8859-15?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Fri Oct 31 02:00:00 2008
Subject: [Slony1-general] excluding slony from output of pg_dump
In-Reply-To: <7a4208ef0810301435s61f1decdh443bcf78113b1113@mail.gmail.com>
References: <7a4208ef0810301435s61f1decdh443bcf78113b1113@mail.gmail.com>
Message-ID: <490AC8C2.6000103@postgresqlfr.org>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Ravi Chemudugunta a ?crit :
> Hi all,
> 
> I was wondering if it was possible to remove slony from the output of
> pg_dump.  I am currently accomplishing something similar with
> --excludeschema _cluster (where all the slony stuff is) but all of the
> triggers on replicated tables are still there.
> 
> It would be good if I could do something like uninstallnode() from
> within a transaction and dump the db schema from within the context ...
> 
> does anyone have any good ideas on how I can do this?
> 
> -ravi

Hi,

First, you have to execute the dump on the master.
Second, you can use some tool like slony1_dump.sh or so.

Personnaly, I do copy the schema of my master DB in a temp DB and execute a
uninstallnode() on that temp DB, before I do a drop schema _STHG cascade.

Hope that helps.

Regards,
- --
St?phane Schildknecht
PostgreSQLFr - http://www.postgresql.fr
Dalibo - http://www.dalibo.com
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFJCsjCA+REPKWGI0ERAkjxAKCTIAdh6lbDWFNKXT5Y7vkN0eCakQCgt50K
uHkeNVTqlT9Hwx3+uXB3UNM=
=nwd/
-----END PGP SIGNATURE-----
From vivek at khera.org  Fri Oct 31 07:08:46 2008
From: vivek at khera.org (Vick Khera)
Date: Fri Oct 31 07:08:51 2008
Subject: [Slony1-general] excluding slony from output of pg_dump
In-Reply-To: <490AC8C2.6000103@postgresqlfr.org>
References: <7a4208ef0810301435s61f1decdh443bcf78113b1113@mail.gmail.com>
	<490AC8C2.6000103@postgresqlfr.org>
Message-ID: <2968dfd60810310708m515532cblc3dfaab069852661@mail.gmail.com>

On Fri, Oct 31, 2008 at 4:58 AM, "St?phane A. Schildknecht"
<stephane.schildknecht@postgresqlfr.org> wrote:
> First, you have to execute the dump on the master.
> Second, you can use some tool like slony1_dump.sh or so.
>
> Personnaly, I do copy the schema of my master DB in a temp DB and execute a
> uninstallnode() on that temp DB, before I do a drop schema _STHG cascade.

These are the steps that slony1_dump.sh does, so why not let the tool
do the manual work?  :-)
From stephane.schildknecht at postgresqlfr.org  Fri Oct 31 07:39:03 2008
From: stephane.schildknecht at postgresqlfr.org (=?ISO-8859-15?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Fri Oct 31 07:39:24 2008
Subject: [Slony1-general] excluding slony from output of pg_dump
In-Reply-To: <2968dfd60810310708m515532cblc3dfaab069852661@mail.gmail.com>
References: <7a4208ef0810301435s61f1decdh443bcf78113b1113@mail.gmail.com>	<490AC8C2.6000103@postgresqlfr.org>
	<2968dfd60810310708m515532cblc3dfaab069852661@mail.gmail.com>
Message-ID: <490B1887.4010408@postgresqlfr.org>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Vick Khera a ?crit :
> On Fri, Oct 31, 2008 at 4:58 AM, "St?phane A. Schildknecht"
> <stephane.schildknecht@postgresqlfr.org> wrote:
>> First, you have to execute the dump on the master.
>> Second, you can use some tool like slony1_dump.sh or so.
>>
>> Personnaly, I do copy the schema of my master DB in a temp DB and execute a
>> uninstallnode() on that temp DB, before I do a drop schema _STHG cascade.
> 
> These are the steps that slony1_dump.sh does, so why not let the tool
> do the manual work?  :-)

Maybe because my script was first :-)

- --
St?phane Schildknecht
PostgreSQLFr - http://www.postgresql.fr
Dalibo - http://www.dalibo.com
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFJCxiHA+REPKWGI0ERAmc4AJ9zUqOtlFkQVHIFWyY5g47stIdihACggs1v
9SibsNVBHUSS5Hw/x2MLF00=
=8ylQ
-----END PGP SIGNATURE-----
