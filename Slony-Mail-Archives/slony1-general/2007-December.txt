From devrim at CommandPrompt.com  Sun Dec  2 04:08:13 2007
From: devrim at CommandPrompt.com (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Sun Dec  2 04:09:40 2007
Subject: [Slony1-general] Version 1.2.12 released
In-Reply-To: <1d219a6f0711301338x22f552a7sda704356d9bedce8@mail.gmail.com>
References: <601wavf4kp.fsf@dba2.int.libertyrms.com>
	<1d219a6f0711301338x22f552a7sda704356d9bedce8@mail.gmail.com>
Message-ID: <1196597293.19708.16.camel@localhost.localdomain>

SGksCgpPbiBGcmksIDIwMDctMTEtMzAgYXQgMTY6MzggLTA1MDAsIENocmlzIEhvb3ZlciB3cm90
ZToKPiBBcmUgdGhlcmUgYW55IGJpbmFyeSBycG1zIHBsYW5uZWQgZm9yIHRoaXMgcmVsZWFzZT8g
IEkKCk5vLiBUaGUgcHJvYmxlbSBpcyB0aGF0IHdlIGNhbm5vdCBrbm93IHdoaWNoIFBvc3RncmVT
UUwgdmVyc2lvbiB5b3UgYXJlCnVzaW5nIGFuZCB3aGljaCBPUyB5b3UgYXJlIG9uLiBUaGF0J3Mg
d2h5IEkgc3RvcHBlZCB1cGxvYWRpbmcgYmluYXJ5CnBhY2thZ2VzLi4uCgpPVE9ILCBJIGFtICpw
bGFubmluZyogdG8gYnVpbGQgYmluYXJ5IFJQTXMgZm9yIHRoZSBsYXRlc3QgUG9zdGdyZVNRTApt
aW5vciB2ZXJzaW9ucywgYW5kIGl0IHdpbGwgcHJvYmFibHkgaGFwcGVuIHNvb24gYWZ0ZXIgd2Ug
KERhcmN5IGFuZCBJKQpmaW5pc2ggd29ya2luZyBvbiBvdXIgbmV3IGJ1aWxkIHNlcnZlci4KCkJ1
aWxkaW5nIGZyb20gU1JQTSBpcyByZWFsbHkgYSBlYXN5IGpvYiwgYW5kIHdpbGwgcHJvYmFibHkg
dGFrZSAyLTMKbWludXRlcyBmb3IgeW91LiBQbGVhc2UgbGV0IG1lIGtub3cgaWYgeW91IG5lZWQg
YSBzcGVjaWZpYyBSUE0gZm9yIGEKc3BlY2lmaWMgZGlzdHJvLCBpZiB5b3UgY2Fubm90IGJ1aWxk
IHRoZSBTUlBNIGZvciBhIHJlYXNvbi4KClJlZ2FyZHMsCgotLSAKRGV2cmltIEfDnE5Ew5xaICwg
UkhDRQpQb3N0Z3JlU1FMIFJlcGxpY2F0aW9uLCBDb25zdWx0aW5nLCBDdXN0b20gRGV2ZWxvcG1l
bnQsIDI0eDcgc3VwcG9ydApNYW5hZ2VkIFNlcnZpY2VzLCBTaGFyZWQgYW5kIERlZGljYXRlZCBI
b3N0aW5nCkNvLUF1dGhvcnM6IHBsUEhQLCBPREJDbmcgLSBodHRwOi8vd3d3LmNvbW1hbmRwcm9t
cHQuY29tLwotLS0tLS0tLS0tLS0tLSBuZXh0IHBhcnQgLS0tLS0tLS0tLS0tLS0KQSBub24tdGV4
dCBhdHRhY2htZW50IHdhcyBzY3J1YmJlZC4uLgpOYW1lOiBub3QgYXZhaWxhYmxlClR5cGU6IGFw
cGxpY2F0aW9uL3BncC1zaWduYXR1cmUKU2l6ZTogMTg5IGJ5dGVzCkRlc2M6IFRoaXMgaXMgYSBk
aWdpdGFsbHkgc2lnbmVkIG1lc3NhZ2UgcGFydApVcmwgOiBodHRwOi8vbGlzdHMuc2xvbnkuaW5m
by9waXBlcm1haWwvc2xvbnkxLWdlbmVyYWwvYXR0YWNobWVudHMvMjAwNzEyMDIvNDJlOWMzMTIv
YXR0YWNobWVudC5wZ3AK
From leon at solatis.com  Sun Dec  2 11:58:09 2007
From: leon at solatis.com (Leon Mergen)
Date: Sun Dec  2 11:58:18 2007
Subject: [Slony1-general] "node -1 not found in runtime configuration"
Message-ID: <5eaaef180712021158t36d36370nc5b9dbe82ec6b21b@mail.gmail.com>

Hello,

Today, I decided on trying out slony as a replication solution, and followed
the "Replicating Your First Database" tutorial from the site. All went well,
the slony processes
are running, and the processes seem to see that pgbench is generating
data, and try to sync. However, the data is not appearing in the slave
node -- after inspecting the log files, I see this for the log of the
slave node:

2007-12-02 20:52:46 CET DEBUG1 copy_set 1
2007-12-02 20:52:46 CET ERROR remoteWorkerThread_1: node -1 not found in
runtime configuration
2007-12-02 20:52:46 CET WARN remoteWorkerThread_1: data copy for set 1
failed - sleep 60 seconds

This seems to be the same problem as described in this post:
http://lists.slony.info/pipermail/slony1-general/2007-October/006880.html

However, no real solution was provided to this problem there, and it doesn't
seem to have anything to do with restarting any processes (i even restarted
both servers, and still have no luck). I have no idea where that node id -1
is coming from -- anyone has any idea ?

Thanks in advance!

Regards,

Leon Mergen
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071202/=
5f5c1060/attachment.htm
From WCoole at aperiogroup.com  Mon Dec  3 10:37:26 2007
From: WCoole at aperiogroup.com (Walter Coole)
Date: Mon Dec  3 10:37:43 2007
Subject: [Slony1-general] "node -1 not found in runtime configuration"
In-Reply-To: <5eaaef180712021158t36d36370nc5b9dbe82ec6b21b@mail.gmail.com>
References: <5eaaef180712021158t36d36370nc5b9dbe82ec6b21b@mail.gmail.com>
Message-ID: <4292CEA5F4927248979C701CA83500BB72164E@SERVER.aperiogroup.local>

I'd check that you're running the same version of Slony on all nodes.
When I got that error, it was resolved at about the same time that I
realized that Slony was quite specific about what version was used and
changed versions to get all of them to be the same.

 

I'm not sure of this, but I think that when Slony detects a version
mismatch, that it sets some node setting somewhere to -1 to force a
failure and this message comes from a later step that doesn't have
enough information to make a better error message.

 

Walter

 

From: slony1-general-bounces@lists.slony.info
[mailto:slony1-general-bounces@lists.slony.info] On Behalf Of Leon
Mergen
Sent: Sunday, December 02, 2007 11:58 AM
To: slony1-general@lists.slony.info
Subject: [Slony1-general] "node -1 not found in runtime configuration"

 

Hello,

Today, I decided on trying out slony as a replication solution, and
followed the "Replicating Your First Database" tutorial from the site.
All went well, the slony processes are running, and the processes seem
to see that pgbench is generating data, and try to sync. However, the
data is not appearing in the slave node -- after inspecting the log
files, I see this for the log of the slave node: 

2007-12-02 20:52:46 CET DEBUG1 copy_set 1
2007-12-02 20:52:46 CET ERROR remoteWorkerThread_1: node -1 not found in
runtime configuration
2007-12-02 20:52:46 CET WARN remoteWorkerThread_1: data copy for set 1
failed - sleep 60 seconds 

This seems to be the same problem as described in this post:
http://lists.slony.info/pipermail/slony1-general/2007-October/006880.htm
l 

However, no real solution was provided to this problem there, and it
doesn't seem to have anything to do with restarting any processes (i
even restarted both servers, and still have no luck). I have no idea
where that node id -1 is coming from -- anyone has any idea ? 

Thanks in advance!

Regards,

Leon Mergen

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071203/ad5abbb1/attachment.htm
From leon at solatis.com  Mon Dec  3 11:17:56 2007
From: leon at solatis.com (Leon Mergen)
Date: Mon Dec  3 11:18:07 2007
Subject: [Slony1-general] "node -1 not found in runtime configuration"
In-Reply-To: <4292CEA5F4927248979C701CA83500BB72164E@SERVER.aperiogroup.local>
References: <5eaaef180712021158t36d36370nc5b9dbe82ec6b21b@mail.gmail.com>
	<4292CEA5F4927248979C701CA83500BB72164E@SERVER.aperiogroup.local>
Message-ID: <5eaaef180712031117m788a0288qb1647b570c34d1b7@mail.gmail.com>

Hello Walter,

Thanks for your reply. I'm confident that all servers use the exact same
version of postgresql and slony, and this shouldn't be the problem.

I have resolved my problems by dropping and recreating the database, and
everything went fine. This morning however, when I was toying around with
slony, it happened again -- it seemed like it was triggered by unsubscribing
one of the nodes. I'm not sure what it is caused by. At that point, i simply
dropped the node and re-created it again, which seemed to do the trick.

It sounds like it comes from a bit
of bad management of the application from my side -- still, it
shouldn't happen. Or at least give a somewhat more specific error
message of what might be going on.

Regards,

Leon Mergen

On 12/3/07, Walter Coole <WCoole@aperiogroup.com> wrote:
>
> I'd check that you're running the same version of Slony on all nodes.
> When I got that error, it was resolved at about the same time that I
> realized that Slony was quite specific about what version was used and
> changed versions to get all of them to be the same.
>
>
>
> I'm not sure of this, but I think that when Slony detects a version
> mismatch, that it sets some node setting somewhere to -1 to force a failu=
re
> and this message comes from a later step that doesn't have enough
> information to make a better error message.
>
>
>
> Walter
>
>
>
> *From:* slony1-general-bounces@lists.slony.info [mailto:
> slony1-general-bounces@lists.slony.info] *On Behalf Of *Leon Mergen
> *Sent:* Sunday, December 02, 2007 11:58 AM
> *To:* slony1-general@lists.slony.info
> *Subject:* [Slony1-general] "node -1 not found in runtime configuration"
>
>
>
> Hello,
>
> Today, I decided on trying out slony as a replication solution, and
> followed the "Replicating Your First Database" tutorial from the site. All
> went well, the slony processes
> are running, and the processes seem to see that pgbench is generating dat=
a, and try to sync. However, the data is not appearing in the slave node --=
 after inspecting the log files, I see this for the log of the slave node:
>
>
> 2007-12-02 20:52:46 CET DEBUG1 copy_set 1
> 2007-12-02 20:52:46 CET ERROR remoteWorkerThread_1: node -1 not found in
> runtime configuration
> 2007-12-02 20:52:46 CET WARN remoteWorkerThread_1: data copy for set 1
> failed - sleep 60 seconds
>
> This seems to be the same problem as described in this post:
> http://lists.slony.info/pipermail/slony1-general/2007-October/006880.html
>
> However, no real solution was provided to this problem there, and it
> doesn't seem to have anything to do with restarting any processes (i even
> restarted both servers, and still have no luck). I have no idea where that
> node id -1 is coming from -- anyone has any idea ?
>
> Thanks in advance!
>
> Regards,
>
> Leon Mergen
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071203/=
f523bf51/attachment.htm
From JanWieck at Yahoo.com  Mon Dec  3 12:32:18 2007
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Mon Dec  3 12:37:26 2007
Subject: [Slony1-general] Understanding Slony Cleanup
In-Reply-To: <1196355996.4246.1343.camel@ebony.site>
References: <1195755198.4246.229.camel@ebony.site>	<60mysx80kr.fsf@dba2.int.libertyrms.com>
	<1196355996.4246.1343.camel@ebony.site>
Message-ID: <475467D2.1020207@Yahoo.com>

On 11/29/2007 12:06 PM, Simon Riggs wrote:
> Have the cleanup_thread measure the size of the log table. If it exceeds
> a specified size then we DELETE, otherwise we just wait for TRUNCATE. If
> people have enough space they can just let the table build up and let it
> be truncated when we switch log tables.

Simon is right. We could as well live without a DELETE ever.

Note that in 1.2 the TRUNCATE periodically is necessary to ensure that 
the xxid wraparound problem never corrupts indexes. Since DELETE alone 
doesn't remove heap or index tuples, it doesn't make the subscribers 
scan effort any smaller at all. So a more frequent log switch and no 
DELETE or VACUUM at all should do.


Jan

-- 
#======================================================================#
# It's easier to get forgiveness for being wrong than for being right. #
# Let's break this rule - forgive me.                                  #
#================================================== JanWieck@Yahoo.com #
From postgres at dac.e4ward.com  Tue Dec  4 11:16:23 2007
From: postgres at dac.e4ward.com (postgres@dac.e4ward.com)
Date: Tue Dec  4 11:16:38 2007
Subject: [Slony1-general] Renumbering a node and renaming a database
Message-ID: <3374230585-1883@e4ward.com>

Hi there.

I've droped our node2 from replication and would like to renumber
node3 as node2 for the sake of beauty. :-D

I'd like to rename node3 replicated database too.

Is there any procedure to do this kind of stuff aside from creating a
new node2 replication and going over all the new node replication
obvious one? That wold consume much time.

-- 
Diego Algorta Casamayou
http://www.oboxodo.com - http://diego.algorta.net
From postgres at dac.e4ward.com  Tue Dec  4 11:43:20 2007
From: postgres at dac.e4ward.com (postgres@dac.e4ward.com)
Date: Tue Dec  4 11:43:32 2007
Subject: [Slony1-general] Dropped a node and still has status
Message-ID: <3374232204-3913@e4ward.com>

Hi,

I've correctly dropped my node2 (still have node1 which is the set1
origin and node3 which is a slave) using this command:

slonik_drop_node node2 | slonik

The documentation says that this would try to kill the running slon
for that node but it didn't. Could it be because postgres is running
with user postgres and the slons are running as root?

It correctly dropped the node because it's not listed anymore on the
origins sl_node, sl_subscribe ad sl_path tables. But it's still is
listed when I ask for replication status on sl_status:

# SELECT * from _replication.sl_status ;
 st_origin | st_received | st_last_event |      st_last_event_ts
| st_last_received |    st_last_received_ts     |
st_last_received_event_ts  | st_lag_num_events |   st_lag_time
-----------+-------------+---------------+----------------------------+------------------+----------------------------+----------------------------+-------------------+-----------------
         1 |           2 |         34498 | 2007-12-04 13:36:29.145529
|            34422 | 2007-12-04 13:23:46.859689 | 2007-12-04
13:23:46.835432 |                76 | 00:12:48.167806
         1 |           3 |         34498 | 2007-12-04 13:36:29.145529
|            34497 | 2007-12-04 13:36:23.466897 | 2007-12-04
13:36:19.108237 |                 1 | 00:00:15.895001
(2 rows)

Is this going to be a problem if I create a new node and assign it
number 2? Will slony think it's the old node2 coming back again and
just try to sync those 76 unsynced events?

Thank you

-- 
Diego Algorta Casamayou
http://www.oboxodo.com - http://diego.algorta.net
From cbbrowne at ca.afilias.info  Tue Dec  4 13:02:55 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Tue Dec  4 13:03:04 2007
Subject: [Slony1-general] Renumbering a node and renaming a database
In-Reply-To: <3374230585-1883@e4ward.com> (postgres@dac.e4ward.com's message
	of "Tue, 4 Dec 2007 17:16:23 -0200")
References: <3374230585-1883@e4ward.com>
Message-ID: <60wsruxjeo.fsf@dba2.int.libertyrms.com>

<postgres@dac.e4ward.com> writes:
> Hi there.
>
> I've droped our node2 from replication and would like to renumber
> node3 as node2 for the sake of beauty. :-D
>
> I'd like to rename node3 replicated database too.
>
> Is there any procedure to do this kind of stuff aside from creating a
> new node2 replication and going over all the new node replication
> obvious one? That wold consume much time.

Unfortunately, node numbering is deeply intertwined into the
configuration of a cluster.

Indeed, it is intertwined to the point that the node number is
associated with numerous tables *across nodes.*  You won't be able to
change this consistently without a lot more trouble thatn it seems to
be worth.
-- 
output = reverse("ofni.secnanifxunil" "@" "enworbbc")
http://cbbrowne.com/info/internet.html
Rules of the Evil Overlord #82. "I will not shoot at any of my enemies
if they are standing in front  of the crucial support beam to a heavy,
dangerous, unbalanced structure. <http://www.eviloverlord.com/>
From cbbrowne at ca.afilias.info  Tue Dec  4 13:05:20 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Tue Dec  4 13:05:28 2007
Subject: [Slony1-general] Dropped a node and still has status
In-Reply-To: <3374232204-3913@e4ward.com> (postgres@dac.e4ward.com's message
	of "Tue, 4 Dec 2007 17:43:20 -0200")
References: <3374232204-3913@e4ward.com>
Message-ID: <60sl2ixjan.fsf@dba2.int.libertyrms.com>

<postgres@dac.e4ward.com> writes:
> I've correctly dropped my node2 (still have node1 which is the set1
> origin and node3 which is a slave) using this command:
>
> slonik_drop_node node2 | slonik
>
> The documentation says that this would try to kill the running slon
> for that node but it didn't. Could it be because postgres is running
> with user postgres and the slons are running as root?
>
> It correctly dropped the node because it's not listed anymore on the
> origins sl_node, sl_subscribe ad sl_path tables. But it's still is
> listed when I ask for replication status on sl_status:
>
> # SELECT * from _replication.sl_status ;
>  st_origin | st_received | st_last_event |      st_last_event_ts
> | st_last_received |    st_last_received_ts     |
> st_last_received_event_ts  | st_lag_num_events |   st_lag_time
> -----------+-------------+---------------+----------------------------+------------------+----------------------------+----------------------------+-------------------+-----------------
>          1 |           2 |         34498 | 2007-12-04 13:36:29.145529
> |            34422 | 2007-12-04 13:23:46.859689 | 2007-12-04
> 13:23:46.835432 |                76 | 00:12:48.167806
>          1 |           3 |         34498 | 2007-12-04 13:36:29.145529
> |            34497 | 2007-12-04 13:36:23.466897 | 2007-12-04
> 13:36:19.108237 |                 1 | 00:00:15.895001
> (2 rows)
>
> Is this going to be a problem if I create a new node and assign it
> number 2? Will slony think it's the old node2 coming back again and
> just try to sync those 76 unsynced events?

The dead node will go away from that view in ~10 minutes, the next
time the cleanup thread runs against the node where you ran that
query.

You will be able to create node #2 again, but I'd want to wait about
1/2h in order for traces of the "old instantiation" to get cleared out
on all the nodes.  If you recreated node 2 right away, I could see
there being a fair bit of confusion.
-- 
let name="cbbrowne" and tld="cbbrowne.com" in name ^ "@" ^ tld;;
http://cbbrowne.com/info/multiplexor.html
"Windows/NT - From the people who brought you EDLIN" 
-- Herb.Peyerl@novatel.cuc.ab.ca
From dba at richyen.com  Tue Dec  4 13:07:28 2007
From: dba at richyen.com (Richard Yen)
Date: Tue Dec  4 13:07:37 2007
Subject: [Slony1-general] postgresq freezes up on a query from slony
Message-ID: <4AF75A49-6086-47CE-9566-7F9F2C73D252@richyen.com>

Hi All,

Not sure if this is a slony issue or a postgres issue...I'm posting on  
both.

I'm running slony on a one master/two subscriber system. One of the  
subscribers seems to get stuck on a group of queries, and I can't seem  
to figure out why.

If I do a select on pg_stat_activity, I get the following:

  datid | datname | procpid | usesysid | usename | current_query |  
waiting | query_start | backend_start | client_addr | client_port
-------+---------+---------+----------+---------- 
+ 
--------------------------------------------------------------------------------------------------------------+ 
---------+------------------------------- 
+-------------------------------+--------------+-------------
16384 | tii | 12204 | 16392 | slony | update only  
"public"."m_report_stats" set date_start='2007-12-03 13:27:05.661155'  
where objectid='56917411'; | f | 2007-12-04 11:20:23.839088-08 |  
2007-12-04 11:20:23.005228-08 | | -1
: update only "public"."m_object_paper" set overwriteflag='t' where  
id='56069688';
: insert into "public"."m_search_list" (nodeid,id) values  
('0','45844662');
: insert into "public"."m_search_list" (nodeid,id) values  
('1','45844662');
: insert into "public"."m_search_list" (nodeid,id) values  
('4','45844662');
: update only "public"."m_dg_read" set delete_flag='t' where  
id='1474821';
: insert into "public"."m_search_list" (nodeid,id) values  
('5','45844662');
: insert into "public"."m_search_list" (nodeid,id) values  
('14','45844662');
: update only "public"."m_user" set duration='02:52:24.744252' where  
id='10369924';
: insert into "public"."m_search_list" (nodeid,id) values  
('32','45844662');
:

What I've done so far is do an strace on the process, and I get the  
following:
tii-db1 postgres # strace -p 12204
Process 12204 attached - interrupt to quit
select(0, NULL, NULL, NULL, {0, 1000}) = 0 (Timeout)
select(0, NULL, NULL, NULL, {0, 1000}) = 0 (Timeout)
select(0, NULL, NULL, NULL, {0, 1000}) = 0 (Timeout)
select(0, NULL, NULL, NULL, {0, 1000}) = 0 (Timeout)
select(0, NULL, NULL, NULL, {0, 1000}) = 0 (Timeout)
select(0, NULL, NULL, NULL, {0, 1000}) = 0 (Timeout)
select(0, NULL, NULL, NULL, {0, 1000}) = 0 (Timeout)
select(0, NULL, NULL, NULL, {0, 1000}) = 0 (Timeout)
select(0, NULL, NULL, NULL, {0, 1000}) = 0 (Timeout)
select(0, NULL, NULL, NULL, {0, 1000}) = 0 (Timeout)
select(0, NULL, NULL, NULL, {0, 1000}) = 0 (Timeout)
select(0, NULL, NULL, NULL, {0, 1000}) = 0 (Timeout)
select(0, NULL, NULL, NULL, {0, 1000}) = 0 (Timeout)
Process 12204 detached
tii-db1 postgres #

I've also set log_min_error_statement=debug5 on postgresql.conf, did a  
restart, and the logs show the following:
Dec 4 11:20:23 tii-db1 postgres[12204]: [1134-1] 2007-12-04  
11:20:23.846 PST [user=slony,db=tii [local] PID:12204 XID: 
129605365]DEBUG: ProcessQuery
Dec 4 11:20:23 tii-db1 postgres[12204]: [1134-2] 2007-12-04  
11:20:23.846 PST [user=slony,db=tii [local] PID:12204 XID: 
129605365]STATEMENT: update only "public"."m_report_stats"
Dec 4 11:20:23 tii-db1 postgres[12204]: [1134-3] set  
date_start='2007-12-03 13:27:05.661155' where objectid='56917411';
Dec 4 11:20:23 tii-db1 postgres[12204]: [1134-4] update only  
"public"."m_object_paper" set overwriteflag='t' where id='56069688';
Dec 4 11:20:23 tii-db1 postgres[12204]: [1134-5] insert into  
"public"."m_search_list" (nodeid,id) values ('0','45844662');
Dec 4 11:20:23 tii-db1 postgres[12204]: [1134-6] insert into  
"public"."m_search_list" (nodeid,id) values ('1','45844662');
Dec 4 11:20:23 tii-db1 postgres[12204]: [1134-7] insert into  
"public"."m_search_list" (nodeid,id) values ('4','45844662');
Dec 4 11:20:23 tii-db1 postgres[12204]: [1134-8] update only  
"public"."m_dg_read" set delete_flag='t' where id='1474821';
Dec 4 11:20:23 tii-db1 postgres[12204]: [1134-9] insert into  
"public"."m_search_list" (nodeid,id) values ('5','45844662');
Dec 4 11:20:23 tii-db1 postgres[12204]: [1134-10] insert into  
"public"."m_search_list" (nodeid,id) values ('14','45844662');
Dec 4 11:20:23 tii-db1 postgres[12204]: [1134-11] update only  
"public"."m_user" set duration='02:52:24.744252' where id='10369924';
Dec 4 11:20:23 tii-db1 postgres[12204]: [1134-12] insert into  
"public"."m_search_list" (nodeid,id) values ('32','45844662');
Dec 4 11:20:23 tii-db1 postgres[12204]: [1134-13]

For this process, the log is just stuck here and doesn't do anything  
else, as if it's perpetually waiting for something. I killed the  
process and restarted postgres numerous times (after changing logging  
settings in postgresql.conf), and every time I start the slon daemon,  
it gets stuck on this same event/query set.

The slon daemon seems to be working happily, fetching new events from  
the other nodes and adding them to the system...even after I kill the  
slon daemon, the above process is still there, waiting...

Any suggestions on what else I can do? I'm wondering if I should just  
drop the node and rebuild it...

Thanks!
--Richard
From postgres at dac.e4ward.com  Tue Dec  4 13:20:28 2007
From: postgres at dac.e4ward.com (postgres@dac.e4ward.com)
Date: Tue Dec  4 13:20:38 2007
Subject: [Slony1-general] Dropped a node and still has status
In-Reply-To: <3374237123-3066@e4ward.com>
References: <3374232204-3913@e4ward.com> <3374237123-3066@e4ward.com>
Message-ID: <3374238029-237@e4ward.com>

On Dec 4, 2007 7:05 PM,  <slony1-general@lists.slony.info> wrote:
> <postgres@dac.e4ward.com> writes:
> > I've correctly dropped my node2 (still have node1 which is the set1
> > origin and node3 which is a slave) using this command:
> >
> > slonik_drop_node node2 | slonik
> >
> > The documentation says that this would try to kill the running slon
> > for that node but it didn't. Could it be because postgres is running
> > with user postgres and the slons are running as root?
> >
> > It correctly dropped the node because it's not listed anymore on the
> > origins sl_node, sl_subscribe ad sl_path tables. But it's still is
> > listed when I ask for replication status on sl_status:
> >
> > # SELECT * from _replication.sl_status ;
> >  st_origin | st_received | st_last_event |      st_last_event_ts
> > | st_last_received |    st_last_received_ts     |
> > st_last_received_event_ts  | st_lag_num_events |   st_lag_time
> > -----------+-------------+---------------+----------------------------+------------------+----------------------------+----------------------------+-------------------+-----------------
> >          1 |           2 |         34498 | 2007-12-04 13:36:29.145529
> > |            34422 | 2007-12-04 13:23:46.859689 | 2007-12-04
> > 13:23:46.835432 |                76 | 00:12:48.167806
> >          1 |           3 |         34498 | 2007-12-04 13:36:29.145529
> > |            34497 | 2007-12-04 13:36:23.466897 | 2007-12-04
> > 13:36:19.108237 |                 1 | 00:00:15.895001
> > (2 rows)
> >
> > Is this going to be a problem if I create a new node and assign it
> > number 2? Will slony think it's the old node2 coming back again and
> > just try to sync those 76 unsynced events?
>
> The dead node will go away from that view in ~10 minutes, the next
> time the cleanup thread runs against the node where you ran that
> query.
>
> You will be able to create node #2 again, but I'd want to wait about
> 1/2h in order for traces of the "old instantiation" to get cleared out
> on all the nodes.  If you recreated node 2 right away, I could see
> there being a fair bit of confusion.

Cool answer. Indeed it disappeared automatically after a few minutes.

I recreated the node after that and all went smoothly.

Thanks.

-- 
Diego Algorta Casamayou
http://www.oboxodo.com - http://diego.algorta.net
From jpfletch at ca.afilias.info  Tue Dec  4 13:36:56 2007
From: jpfletch at ca.afilias.info (JP Fletcher)
Date: Tue Dec  4 13:39:49 2007
Subject: [Slony1-general] cleanup thread repeats work
Message-ID: <4755C878.5030704@ca.afilias.info>

Hi,

If a node is a long way behind, and the slon servicing it is 
aggressively trying to catch up, sometimes the application of group 
SYNCS can take a very long time (in my testing, sometimes more than an 
hour).  During a this the cleanup thread apparently does the same thing, 
over and over.   Here's an example:

2007-12-04 21:02:10.900 CUT [1393000] cluster1 slony 10.1.2.133 LOG:  
duration: 6300.830 ms  statement: delete from "_cluster1".sl_log_1 where 
log_origin = '8143' and log_xid < '56583147'; delete from 
"_cluster1".sl_log_2 where log_origin = '8143' and log_xid < '56583147'; 
delete from "_cluster1".sl_seqlog where seql_origin = '8143' and 
seql_ev_seqno < '301904'; select "_cluster1".logswitch_finish();

2007-12-04 21:14:22.366 CUT [1393000] cluster slony 10.1.2.133 LOG:  
duration: 2324.701 ms  statement: delete from "_cluster".sl_log_1 where 
log_origin = '8143' and log_xid < '56583147'; delete from 
"_cluster".sl_log_2 where log_origin = '8143' and log_xid < '56583147'; 
delete from "_cluster".sl_seqlog
where seql_origin = '8143' and seql_ev_seqno < '301904'; select 
"_cluster".logswitch_finish();

I don't think this is particularly problematic, but was this the 
intended design?

JP

-- 
JP Fletcher
Database Administrator
Afilias Canada
voice: 416.646.3304 ext. 4123
fax: 416.646.3305
mobile: 416.561.4763
jpfletch@ca.afilias.info


From cbbrowne at ca.afilias.info  Tue Dec  4 13:39:53 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Tue Dec  4 13:40:04 2007
Subject: [Slony1-general] postgresq freezes up on a query from slony
In-Reply-To: <4AF75A49-6086-47CE-9566-7F9F2C73D252@richyen.com> (Richard Yen's
	message of "Tue, 4 Dec 2007 13:07:28 -0800")
References: <4AF75A49-6086-47CE-9566-7F9F2C73D252@richyen.com>
Message-ID: <60odd6xhp2.fsf@dba2.int.libertyrms.com>

Richard Yen <dba@richyen.com> writes:
> Not sure if this is a slony issue or a postgres issue...I'm posting on
> both.
>
> I'm running slony on a one master/two subscriber system. One of the
> subscribers seems to get stuck on a group of queries, and I can't seem
> to figure out why.
>
> If I do a select on pg_stat_activity, I get the following:
>
>  datid | datname | procpid | usesysid | usename | current_query |
> waiting | query_start | backend_start | client_addr | client_port
> -------+---------+---------+----------+---------- 
> +
> --------------------------------------------------------------------------------------------------------------+
> ---------+------------------------------- 
> +-------------------------------+--------------+-------------
> 16384 | tii | 12204 | 16392 | slony | update only
> "public"."m_report_stats" set date_start='2007-12-03 13:27:05.661155'
> where objectid='56917411'; | f | 2007-12-04 11:20:23.839088-08 |
> 2007-12-04 11:20:23.005228-08 | | -1
> : update only "public"."m_object_paper" set overwriteflag='t' where
> id='56069688';
> : insert into "public"."m_search_list" (nodeid,id) values
> ('0','45844662');
> : insert into "public"."m_search_list" (nodeid,id) values
> ('1','45844662');
> : insert into "public"."m_search_list" (nodeid,id) values
> ('4','45844662');
> : update only "public"."m_dg_read" set delete_flag='t' where
> id='1474821';
> : insert into "public"."m_search_list" (nodeid,id) values
> ('5','45844662');
> : insert into "public"."m_search_list" (nodeid,id) values
> ('14','45844662');
> : update only "public"."m_user" set duration='02:52:24.744252' where
> id='10369924';
> : insert into "public"."m_search_list" (nodeid,id) values
> ('32','45844662');
> :

1.  Are you certain that it is in fact the same query each time?

    It could be that it's working on a rather large SYNC (or set of
    grouped SYNCs), and you're seeing a set of queries that *look*
    similar, but it's just *looking* like it's not progressing.

    I've had DBAs come to me 'asking why slon had stopped,' and what
    we discovered is that there was a frequently repeating pattern of
    queries so that it *looked* like it wasn't progressing, but
    actually was.

2.  If it is stuck, could it be because of an ungranted lock?

    I'd look for any ungranted locks requested by process 16392, and
    see if I can correlate this with something else that has already
    grabbed some object...
-- 
let name="cbbrowne" and tld="cbbrowne.com" in String.concat "@" [name;tld];;
http://cbbrowne.com/info/spiritual.html
Rules of the Evil Overlord #38. "If  an enemy I have just killed has a
younger sibling or offspring anywhere,  I will find them and have them
killed immediately, instead  of waiting for them to  grow up harboring
feelings of vengeance towards me in my old age."
<http://www.eviloverlord.com/>
From dba at richyen.com  Tue Dec  4 14:06:20 2007
From: dba at richyen.com (Richard Yen)
Date: Tue Dec  4 14:06:30 2007
Subject: [Slony1-general] postgresq freezes up on a query from slony
In-Reply-To: <60odd6xhp2.fsf@dba2.int.libertyrms.com>
References: <4AF75A49-6086-47CE-9566-7F9F2C73D252@richyen.com>
	<60odd6xhp2.fsf@dba2.int.libertyrms.com>
Message-ID: <7797CEAE-39F7-405F-92D1-49C995CB9D4D@richyen.com>


On Dec 4, 2007, at 1:39 PM, Christopher Browne wrote:

> Richard Yen <dba@richyen.com> writes:
>> Not sure if this is a slony issue or a postgres issue...I'm posting  
>> on
>> both.
>>
>> I'm running slony on a one master/two subscriber system. One of the
>> subscribers seems to get stuck on a group of queries, and I can't  
>> seem
>> to figure out why.
>>
>> If I do a select on pg_stat_activity, I get the following:
>>
>> datid | datname | procpid | usesysid | usename | current_query |
>> waiting | query_start | backend_start | client_addr | client_port
>> -------+---------+---------+----------+----------
>> +
>> --------------------------------------------------------------------------------------------------------------+
>> ---------+-------------------------------
>> +-------------------------------+--------------+-------------
>> 16384 | tii | 12204 | 16392 | slony | update only
>> "public"."m_report_stats" set date_start='2007-12-03 13:27:05.661155'
>> where objectid='56917411'; | f | 2007-12-04 11:20:23.839088-08 |
>> 2007-12-04 11:20:23.005228-08 | | -1
>> : update only "public"."m_object_paper" set overwriteflag='t' where
>> id='56069688';
>> : insert into "public"."m_search_list" (nodeid,id) values
>> ('0','45844662');
>> : insert into "public"."m_search_list" (nodeid,id) values
>> ('1','45844662');
>> : insert into "public"."m_search_list" (nodeid,id) values
>> ('4','45844662');
>> : update only "public"."m_dg_read" set delete_flag='t' where
>> id='1474821';
>> : insert into "public"."m_search_list" (nodeid,id) values
>> ('5','45844662');
>> : insert into "public"."m_search_list" (nodeid,id) values
>> ('14','45844662');
>> : update only "public"."m_user" set duration='02:52:24.744252' where
>> id='10369924';
>> : insert into "public"."m_search_list" (nodeid,id) values
>> ('32','45844662');
>> :
>
> 1.  Are you certain that it is in fact the same query each time?
>
>    It could be that it's working on a rather large SYNC (or set of
>    grouped SYNCs), and you're seeing a set of queries that *look*
>    similar, but it's just *looking* like it's not progressing.
>
Yes, I'm certain it's the same query every time.  When I first  
noticed, the query_start in pg_stat_activity was approx. 4 hours  
before.  The current attempt is about 3 hours old.

>  I've had DBAs come to me 'asking why slon had stopped,' and what
>    we discovered is that there was a frequently repeating pattern of
>    queries so that it *looked* like it wasn't progressing, but
>    actually was.
>
> 2.  If it is stuck, could it be because of an ungranted lock?
>
No, it's not from an ungranted lock.  The query below:
tii=# select * from pg_locks where not granted;
  locktype | database | relation | page | tuple | transactionid |  
classid | objid | objsubid | transaction | pid | mode | granted
----------+----------+----------+------+-------+--------------- 
+---------+-------+----------+-------------+-----+------+---------
(0 rows)

tii=#


>    I'd look for any ungranted locks requested by process 16392, and
>    see if I can correlate this with something else that has already
>    grabbed some object...

You mean process 12204?  Just making sure...

Also, this process is taking up 100% of CPU, if that gives any clue.   
The frustrating part is that it takes up 100% CPU, but there's no  
activity in the postgres log or under strace... :/

Thanks!
--Richard
From cbbrowne at ca.afilias.info  Tue Dec  4 21:35:32 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Tue Dec  4 21:35:47 2007
Subject: [Slony1-general] postgresq freezes up on a query from slony
In-Reply-To: <7797CEAE-39F7-405F-92D1-49C995CB9D4D@richyen.com> (Richard Yen's
	message of "Tue, 4 Dec 2007 14:06:20 -0800")
References: <4AF75A49-6086-47CE-9566-7F9F2C73D252@richyen.com>
	<60odd6xhp2.fsf@dba2.int.libertyrms.com>
	<7797CEAE-39F7-405F-92D1-49C995CB9D4D@richyen.com>
Message-ID: <607ijt900r.fsf@dba2.int.libertyrms.com>

Richard Yen <dba@richyen.com> writes:
> On Dec 4, 2007, at 1:39 PM, Christopher Browne wrote:
>
>> Richard Yen <dba@richyen.com> writes:
>>> Not sure if this is a slony issue or a postgres issue...I'm posting
>>> on
>>> both.
>>>
>>> I'm running slony on a one master/two subscriber system. One of the
>>> subscribers seems to get stuck on a group of queries, and I can't
>>> seem
>>> to figure out why.
>>>
>>> If I do a select on pg_stat_activity, I get the following:
>>>
>>> datid | datname | procpid | usesysid | usename | current_query |
>>> waiting | query_start | backend_start | client_addr | client_port
>>> -------+---------+---------+----------+----------
>>> +
>>> --------------------------------------------------------------------------------------------------------------+
>>> ---------+-------------------------------
>>> +-------------------------------+--------------+-------------
>>> 16384 | tii | 12204 | 16392 | slony | update only
>>> "public"."m_report_stats" set date_start='2007-12-03 13:27:05.661155'
>>> where objectid='56917411'; | f | 2007-12-04 11:20:23.839088-08 |
>>> 2007-12-04 11:20:23.005228-08 | | -1
>>> : update only "public"."m_object_paper" set overwriteflag='t' where
>>> id='56069688';
>>> : insert into "public"."m_search_list" (nodeid,id) values
>>> ('0','45844662');
>>> : insert into "public"."m_search_list" (nodeid,id) values
>>> ('1','45844662');
>>> : insert into "public"."m_search_list" (nodeid,id) values
>>> ('4','45844662');
>>> : update only "public"."m_dg_read" set delete_flag='t' where
>>> id='1474821';
>>> : insert into "public"."m_search_list" (nodeid,id) values
>>> ('5','45844662');
>>> : insert into "public"."m_search_list" (nodeid,id) values
>>> ('14','45844662');
>>> : update only "public"."m_user" set duration='02:52:24.744252' where
>>> id='10369924';
>>> : insert into "public"."m_search_list" (nodeid,id) values
>>> ('32','45844662');
>>> :
>>
>> 1.  Are you certain that it is in fact the same query each time?
>>
>>    It could be that it's working on a rather large SYNC (or set of
>>    grouped SYNCs), and you're seeing a set of queries that *look*
>>    similar, but it's just *looking* like it's not progressing.
>>
> Yes, I'm certain it's the same query every time.  When I first
> noticed, the query_start in pg_stat_activity was approx. 4 hours
> before.  The current attempt is about 3 hours old.

OK, I imagined you'd likely have a clue on this, but if a dumb
question helps, that's a good use of a dumb question ;-).

>>  I've had DBAs come to me 'asking why slon had stopped,' and what
>>    we discovered is that there was a frequently repeating pattern of
>>    queries so that it *looked* like it wasn't progressing, but
>>    actually was.
>>
>> 2.  If it is stuck, could it be because of an ungranted lock?
>>
> No, it's not from an ungranted lock.  The query below:
> tii=# select * from pg_locks where not granted;
>  locktype | database | relation | page | tuple | transactionid |
> classid | objid | objsubid | transaction | pid | mode | granted
> ----------+----------+----------+------+-------+--------------- 
> +---------+-------+----------+-------------+-----+------+---------
> (0 rows)
>
> tii=#
>
>
>>    I'd look for any ungranted locks requested by process 16392, and
>>    see if I can correlate this with something else that has already
>>    grabbed some object...
>
> You mean process 12204?  Just making sure...

My bad - yes, that was 12204.

If you have no ungranted locks at all, that certainly answers what I
was wondering.

> Also, this process is taking up 100% of CPU, if that gives any clue.
> The frustrating part is that it takes up 100% CPU, but there's no
> activity in the postgres log or under strace... :/

OK, well, you've answered all of what came initially to my mind.
Definitely bona fide mysterious, and yes, strace-worthy.

That it's getting horde of identical select() requests timing out
seems suspicious, but I'm not sure of quite what.  Smells like a
pgsql-hackers question.  It's not unimaginable that something
Slony-I-related might be inducing it, but I think asking on the PG
side is the right move here.
-- 
(format nil "~S@~S" "cbbrowne" "ca.afilias.info")
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
From david at fetter.org  Wed Dec  5 09:33:34 2007
From: david at fetter.org (David Fetter)
Date: Wed Dec  5 09:33:38 2007
Subject: [Slony1-general] Working on a Rails plugin to easy slony usage
In-Reply-To: <3373389076-265@e4ward.com>
References: <3373262511-3382@e4ward.com> <3373366559-428@e4ward.com>
	<3373389076-265@e4ward.com>
Message-ID: <20071205173334.GE27030@fetter.org>

On Sat, Nov 24, 2007 at 11:31:15PM -0200, postgres@dac.e4ward.com wrote:
> On Nov 24, 2007 5:15 PM,  <slony1-general@lists.slony.info> wrote:
> > On Fri, Nov 23, 2007 at 12:21:48PM -0200, postgres@dac.e4ward.com wrote:
> > > Hi all.
> > >
> > > I want to know if anyone here has any experience using slony based
> > > replication on Ruby on Rails applications.
> >
> > Dump Rails.  It's a piece of crap.
> >
> > Cheers,
> > David (no, that is not a joke)
> 
> Well... I know it has some things to improve and such... like any
> piece of software. But maybe I and other's using it deserve the right
> to know why you're saying that without explaining your reasons.
> Specially when you use such a "superiority" tone.

Rails is designed with several truly idiotic principles, to wit:

* The current application owns the data store.

    In fact, useful data stores by definition are shared, and the
    application can no more touch them with DDL than a networking
    application can make design decisions about TCP, and for the same
    reasons.

* Initial construction of the software is important.

    In reality, over 99% of the work done on a useful piece of
    software is maintenance.  RoR makes maintenance increasingly
    difficult.

* By failing to provide useful modules, RoR gets you into "monkey patching." 

     This is equivalent to--and about as smart as--editing binary
    executables with a hex editor.

> Anyway... suppose I don't have the choice (which I have) and have to
> work with rails + slony.  Could you provide an opinion other than
> drop rails?

You *always* have options, including about where you work.

Cheers,
David.
-- 
David Fetter <david@fetter.org> http://fetter.org/
Phone: +1 415 235 3778  AIM: dfetter666  Yahoo!: dfetter
Skype: davidfetter      XMPP: david.fetter@gmail.com

Remember to vote!
Consider donating to Postgres: http://www.postgresql.org/about/donate
From ajs at crankycanuck.ca  Wed Dec  5 10:31:10 2007
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Wed Dec  5 10:31:41 2007
Subject: [Slony1-general] Working on a Rails plugin to easy slony usage
In-Reply-To: <20071205173334.GE27030@fetter.org>
References: <3373262511-3382@e4ward.com> <3373366559-428@e4ward.com>
	<3373389076-265@e4ward.com> <20071205173334.GE27030@fetter.org>
Message-ID: <20071205183110.GC32701@crankycanuck.ca>

On Wed, Dec 05, 2007 at 09:33:34AM -0800, David Fetter wrote:
> On Sat, Nov 24, 2007 at 11:31:15PM -0200, postgres@dac.e4ward.com wrote:
> 
> > Anyway... suppose I don't have the choice (which I have) and have to
> > work with rails + slony.  Could you provide an opinion other than
> > drop rails?
> 
> You *always* have options, including about where you work.

Fights about the value of things like Rails aside (and I'm afraid I have to
agree with important parts of what David said -- especially the bit about
the preposterous nature of the application "owning" the data store), one of
the _explicit_ limitations of Slony is that it does not support DDL
performed by the client.  Jan has frequently argued that clients who change
their database schema are engaging in self-modifying code.  If Rails wants
to do that sort of thing, bully for them, but Slony's approach may make it a
bad fit for your use case.  

A
From vivek at khera.org  Wed Dec  5 13:16:24 2007
From: vivek at khera.org (Vivek Khera)
Date: Wed Dec  5 13:16:32 2007
Subject: [Slony1-general] Working on a Rails plugin to easy slony usage
In-Reply-To: <20071205183110.GC32701@crankycanuck.ca>
References: <3373262511-3382@e4ward.com> <3373366559-428@e4ward.com>
	<3373389076-265@e4ward.com> <20071205173334.GE27030@fetter.org>
	<20071205183110.GC32701@crankycanuck.ca>
Message-ID: <773846C6-0084-43F5-96F1-92CD8B846BFB@khera.org>


On Dec 5, 2007, at 1:31 PM, Andrew Sullivan wrote:

> performed by the client.  Jan has frequently argued that clients who  
> change
> their database schema are engaging in self-modifying code.  If Rails  
> wants
> to do that sort of thing, bully for them, but Slony's approach may  
> make it a

It is exactly this issue which is causing us problems with a Drupal- 
based web site.  We can't safely replicate it, nor can we safely test  
and deploy things with source control management.

From ajs at crankycanuck.ca  Wed Dec  5 17:06:47 2007
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Wed Dec  5 17:07:02 2007
Subject: [Slony1-general] Working on a Rails plugin to easy slony usage
In-Reply-To: <773846C6-0084-43F5-96F1-92CD8B846BFB@khera.org>
References: <3373262511-3382@e4ward.com> <3373366559-428@e4ward.com>
	<3373389076-265@e4ward.com> <20071205173334.GE27030@fetter.org>
	<20071205183110.GC32701@crankycanuck.ca>
	<773846C6-0084-43F5-96F1-92CD8B846BFB@khera.org>
Message-ID: <20071206010647.GI1696@crankycanuck.ca>

On Wed, Dec 05, 2007 at 04:16:24PM -0500, Vivek Khera wrote:
> 
> It is exactly this issue which is causing us problems with a Drupal- 
> based web site.  We can't safely replicate it, nor can we safely test  
> and deploy things with source control management.

I'm not sure I understand whether this is a criticism of Drupal, of Slony,
or not a criticism at all.

A
From smith.not.western at gmail.com  Wed Dec  5 19:09:29 2007
From: smith.not.western at gmail.com (Mike C)
Date: Wed Dec  5 19:09:39 2007
Subject: [Slony1-general] Compile problem with 1.2.12 and postgres 8.3beta3
Message-ID: <bd0eabd0712051909l7bcfa69dgce3d98279d414544@mail.gmail.com>

Hi,

When I try compile slonly 1.2.12 (Postgres 8.3beta3, SUSE 10 linux
x86), I get the following problem:

make
.....
gcc -g -O2 -Wall -Wmissing-prototypes -Wmissing-declarations -I../..
-fpic -I/usr/local/pgsql/include/ -I/usr/local/pgsql/include/server/
-c -o slony1_funcs.o slony1_funcs.c
slony1_funcs.c: In function 'slon_quote_literal':
slony1_funcs.c:1106: warning: pointer targets in passing argument 1 of
'pg_mblen' differ in signedness
slony1_funcs.c: In function 'getClusterStatus':
slony1_funcs.c:1357: warning: passing argument 1 of 'typenameTypeId'
from incompatible pointer type
slony1_funcs.c:1357: error: too few arguments to function 'typenameTypeId'
slony1_funcs.c:1440: warning: passing argument 1 of 'typenameTypeId'
from incompatible pointer type
slony1_funcs.c:1440: error: too few arguments to function 'typenameTypeId'
make[2]: *** [slony1_funcs.o] Error 1
make[2]: Leaving directory `/home/postgres/slony1-1.2.12/src/backend'
make[1]: *** [all] Error 2
make[1]: Leaving directory `/home/postgres/slony1-1.2.12/src'
make: *** [all] Error 2

My configure script is:

./configure --with-docs --with-pgconfigdir=/usr/local/pgsql/bin/

Ideas?

Thanks,

Mike
From cbbrowne at ca.afilias.info  Wed Dec  5 19:16:13 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed Dec  5 19:16:24 2007
Subject: [Slony1-general] Compile problem with 1.2.12 and postgres 8.3beta3
In-Reply-To: <bd0eabd0712051909l7bcfa69dgce3d98279d414544@mail.gmail.com>
	(Mike C.'s message of "Thu, 6 Dec 2007 16:09:29 +1300")
References: <bd0eabd0712051909l7bcfa69dgce3d98279d414544@mail.gmail.com>
Message-ID: <60fxyga4xu.fsf@dba2.int.libertyrms.com>

"Mike C" <smith.not.western@gmail.com> writes:
> When I try compile slonly 1.2.12 (Postgres 8.3beta3, SUSE 10 linux
> x86), I get the following problem:

This is an issue of a change made in Beta3, already fixed in a
subsequent CVS commit; take a look on the "slony1-commits" list for
November...  The change was to one of the M4 scripts in the "config"
directory; note that if you apply this, you'll need to regenerate the
./configure script using autoconf before re-running ./configure.
-- 
output = reverse("moc.enworbbc" "@" "enworbbc")
http://www3.sympatico.ca/cbbrowne/multiplexor.html
Functions delay binding; data structures induce binding.

"Moral: Structure data late in the programming process."
-- Alan J. Perlis
From jpfletch at ca.afilias.info  Thu Dec  6 07:37:26 2007
From: jpfletch at ca.afilias.info (JP Fletcher)
Date: Thu Dec  6 07:40:19 2007
Subject: [Slony1-general] compile 1.2.12 --with-docs
Message-ID: <47581736.6090505@ca.afilias.info>

Hi

I'm trying to compile 1.2.12 on Ubuntu Linux --with-docs

make[1]: Entering directory `/opt/slony1-1.2.12/doc'
make[2]: Entering directory `/opt/slony1-1.2.12/doc/concept'
unable to create Slon.eps from Slon_900x720.jpg
groff -U -t -p -ms -mpspic Slony-I-concept.nr >Slony-I-concept.ps 
2>/dev/null
make[2]: [Slony-I-concept.ps] Error 1 (ignored)
groff -U -t -p -ms -mpspic Slony-I-concept.nr >Slony-I-concept.ps
troff: fatal error: can't find macro file s
make[2]: *** [Slony-I-concept.ps] Error 1
make[2]: Leaving directory `/opt/slony1-1.2.12/doc/concept'
make[1]: *** [all] Error 2
make[1]: Leaving directory `/opt/slony1-1.2.12/doc'
make: *** [all] Error 2


It compiles just fine without --with-docs.

-- 
JP Fletcher
Database Administrator
Afilias Canada
voice: 416.646.3304 ext. 4123
fax: 416.646.3305
mobile: 416.561.4763
jpfletch@ca.afilias.info


From vivek at khera.org  Thu Dec  6 11:17:23 2007
From: vivek at khera.org (Vivek Khera)
Date: Thu Dec  6 11:17:30 2007
Subject: [Slony1-general] Working on a Rails plugin to easy slony usage
In-Reply-To: <20071206010647.GI1696@crankycanuck.ca>
References: <3373262511-3382@e4ward.com> <3373366559-428@e4ward.com>
	<3373389076-265@e4ward.com> <20071205173334.GE27030@fetter.org>
	<20071205183110.GC32701@crankycanuck.ca>
	<773846C6-0084-43F5-96F1-92CD8B846BFB@khera.org>
	<20071206010647.GI1696@crankycanuck.ca>
Message-ID: <980B5612-5E32-46E1-ACF2-8509A6FE5CBB@khera.org>


On Dec 5, 2007, at 8:06 PM, Andrew Sullivan wrote:

> On Wed, Dec 05, 2007 at 04:16:24PM -0500, Vivek Khera wrote:
>>
>> It is exactly this issue which is causing us problems with a Drupal-
>> based web site.  We can't safely replicate it, nor can we safely test
>> and deploy things with source control management.
>
> I'm not sure I understand whether this is a criticism of Drupal, of  
> Slony,
> or not a criticism at all.

It is a criticism of self-modifying code getting in the way of doing  
software (release) engineering the right way[tm].  In this particular  
case, drupal.

From threshar at torgo.978.org  Thu Dec  6 12:48:27 2007
From: threshar at torgo.978.org (Jeff Trout)
Date: Thu Dec  6 12:48:39 2007
Subject: [Slony1-general] Replicated Tables & On Delete Cascade
Message-ID: <E9AEFDF3-54B9-4015-A037-EF5059DDBACA@torgo.978.org>

I'm running slony 1.2.8 (Yes, I realize there are newer releases,  
just haven't upgraded yet, and glancing over notes, it seems this  
wouldn't be a bug.)

So we've got a "master" db which feeds some common general  
information to some other systems, which in turn work with and off of  
the data. (these guys need their own copy of the data.. and slony  
seemed the most logical way to keep that all in sync). The data in  
this case is company info (cik, ticker, mcap, etc).

In one case we have a table that as a foreign key w/ondelete cascade  
into the replicated table. This works fine - inserting a row into the  
table fails if the key isn't there.  The problem is if data is  
deleted from the replicated table, it seems the ON DELETE CASCADE  
part is never done, and I'm left with orphaned nodes in my other tables.

cik is a PK in the companyinfo table, if_portfolio_ciks has a FK to  
it (on delete cascade).

PRODUCTION > insert into if_portfolio_ciks (portfolio_id, cik,  
dateposted, num_shares) values (20013, 103973, now(), 100);
ERROR:  insert or update on table "if_portfolio_ciks" violates  
foreign key constraint "if_portfolio_ciks_cik_fkey"
DETAIL:  Key (cik)=(103973) is not present in table "companyinfo".

so the FK part is fine.
On the master I inserted a record with cik 1000010266

back on the other box;

PRODUCTION > insert into if_portfolio_ciks (portfolio_id, cik,  
dateposted, num_shares) values (20013, 1000010266, now(), 100);
INSERT 0 1

[ I delete the companyinfo record on the master ]

PRODUCTION > select * from if_portfolio_ciks where portfolio_id = 20013;
  portfolio_id |    cik     |         dateposted         | num_shares
--------------+------------+----------------------------+------------
         20013 | 1000010266 | 2007-12-06 15:36:44.598798 |        100

PRODUCTION > select * from companyinfo where cik = 1000010266;
cik | ticker | name | mcap | ....
-----+--------+------+------+--------+-----------+------------- 
+----------+----------+----------+-----------+----------- 
+-------------+----------+----------+-----------+------------------- 
+----------+---------------
(0 rows)


Is this just the nature of the beast. I realize this may not be  
entirely under Slonys unbrella of how it is to be used, but I needed  
a way to distribute & sync data from a table to a number of other  
places. Which slony does do a good job of.

So, anything I can do?

--
Jeff Trout <jeff@jefftrout.com>
http://www.dellsmartexitin.com/
http://www.stuarthamm.net/



From smith.not.western at gmail.com  Thu Dec  6 14:09:25 2007
From: smith.not.western at gmail.com (Mike C)
Date: Thu Dec  6 14:09:34 2007
Subject: [Slony1-general] Compile problem with 1.2.12 and postgres 8.3beta3
In-Reply-To: <60fxyga4xu.fsf@dba2.int.libertyrms.com>
References: <bd0eabd0712051909l7bcfa69dgce3d98279d414544@mail.gmail.com>
	<60fxyga4xu.fsf@dba2.int.libertyrms.com>
Message-ID: <bd0eabd0712061409j4d0b3369w6622d97f97df6183@mail.gmail.com>

That works great, thank you.

Cheers,

Mike

On Dec 6, 2007 4:16 PM, Christopher Browne <cbbrowne@ca.afilias.info> wrote:
> "Mike C" <smith.not.western@gmail.com> writes:
> > When I try compile slonly 1.2.12 (Postgres 8.3beta3, SUSE 10 linux
> > x86), I get the following problem:
>
> This is an issue of a change made in Beta3, already fixed in a
> subsequent CVS commit; take a look on the "slony1-commits" list for
> November...  The change was to one of the M4 scripts in the "config"
> directory; note that if you apply this, you'll need to regenerate the
> ./configure script using autoconf before re-running ./configure.
> --
> output = reverse("moc.enworbbc" "@" "enworbbc")
> http://www3.sympatico.ca/cbbrowne/multiplexor.html
> Functions delay binding; data structures induce binding.
>
> "Moral: Structure data late in the programming process."
> -- Alan J. Perlis
>
From glynastill at yahoo.co.uk  Fri Dec  7 06:52:05 2007
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Fri Dec  7 06:52:10 2007
Subject: [Slony1-general] Slony replication monitoring
Message-ID: <72136.77509.qm@web25802.mail.ukl.yahoo.com>

Hi All,

Is there a way we can monitor Slony to ensure it is in sync and that
it is still working?

Also is there any way to validate our data?

Reporting tools or shell script ideas would be ace


Glyn Astill



      __________________________________________________________
Sent from Yahoo! Mail - a smarter inbox http://uk.mail.yahoo.com


From darcyb at commandprompt.com  Fri Dec  7 06:55:25 2007
From: darcyb at commandprompt.com (Darcy Buskermolen)
Date: Fri Dec  7 06:54:44 2007
Subject: [Slony1-general] Slony replication monitoring
In-Reply-To: <72136.77509.qm@web25802.mail.ukl.yahoo.com>
References: <72136.77509.qm@web25802.mail.ukl.yahoo.com>
Message-ID: <200712070655.25479.darcyb@commandprompt.com>

On Friday 07 December 2007 06:52:05 Glyn Astill wrote:
> Hi All,
>
> Is there a way we can monitor Slony to ensure it is in sync and that
> it is still working?
>
> Also is there any way to validate our data?
>
> Reporting tools or shell script ideas would be ace

on the origin server:

select * from _CLUSTERNAME.sl_status;



>
>
> Glyn Astill
>
>
>
>       __________________________________________________________
> Sent from Yahoo! Mail - a smarter inbox http://uk.mail.yahoo.com
>
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general



-- 
Darcy Buskermolen
Command Prompt, Inc.
+1.503.667.4564 X 102
http://www.commandprompt.com/
PostgreSQL solutions since 1997
From jwdawso at mac.com  Fri Dec  7 07:48:25 2007
From: jwdawso at mac.com (jwdawso)
Date: Fri Dec  7 08:01:57 2007
Subject: [Slony1-general] Newbie - Licensing?
Message-ID: <14214723.post@talk.nabble.com>


Hi all! I'm a complete novice as far as Slony-I. Is there a license required
to use Slony-I? If I'm developing a system and selling it that uses Slony-I,
do I need to acknowledge using Slony-I? I'm not trying to get out of
something, I just want to make sure I do the correct thing.
-- 
View this message in context: http://www.nabble.com/Newbie---Licensing--tf4962741.html#a14214723
Sent from the Slony-I -- General mailing list archive at Nabble.com.

From JanWieck at Yahoo.com  Fri Dec  7 08:30:20 2007
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Fri Dec  7 08:30:30 2007
Subject: [Slony1-general] Newbie - Licensing?
In-Reply-To: <14214723.post@talk.nabble.com>
References: <14214723.post@talk.nabble.com>
Message-ID: <4759751C.2010401@Yahoo.com>

On 12/7/2007 10:48 AM, jwdawso wrote:
> Hi all! I'm a complete novice as far as Slony-I. Is there a license required
> to use Slony-I? If I'm developing a system and selling it that uses Slony-I,
> do I need to acknowledge using Slony-I? I'm not trying to get out of
> something, I just want to make sure I do the correct thing.

Like Postgres, Slony is distributed under the non-advertising BSD 
license. Under those terms you are absolutely allowed to include it in 
your own, commercial products without acknowledgment.

I am not a lawyer, but as far as I know there is a downside to including 
BSD licensed software into a commercial bundle. The software you sell is 
subject to liability and therefore, you will be liable for the included 
software. Since you got the software under the BSD license, there is 
nobody you can hold liable in turn, so if Slony eats a customers data, 
the problem is yours. As said, I am not a lawyer. You might want to get 
some professional legal counsel on that matter.


Jan

-- 
#======================================================================#
# It's easier to get forgiveness for being wrong than for being right. #
# Let's break this rule - forgive me.                                  #
#================================================== JanWieck@Yahoo.com #
From peter.geoghegan86 at gmail.com  Sat Dec  8 09:52:16 2007
From: peter.geoghegan86 at gmail.com (Peter Geoghegan)
Date: Sat Dec  8 09:52:20 2007
Subject: [Slony1-general] Delayed replication: Explicitly creating a slony-I
	backlog,
	and then telling the slon daemon to replicate changes all at once.
Message-ID: <db471ace0712080952w757f9e70q9cc5de49d3789ee9@mail.gmail.com>

Hello,

I'm using slony to power a point-of-sale system - changes in the back-office
are replicated amongst tills (subscribers). For business logic reasons, I'd
like to be able to create a backlog of changes, and then have the slon
daemon replicate all such changes upon being explicitly told to do so,
rather then having the daemon automatically replicate all changes to the
replication set.

Is this possible? How so?

Thanks in advance,

Peter
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071208/=
a570e637/attachment.html
From david at fetter.org  Sun Dec  9 13:21:57 2007
From: david at fetter.org (David Fetter)
Date: Sun Dec  9 13:22:05 2007
Subject: [Slony1-general] Delayed replication: Explicitly creating a
	slony-I backlog, and then telling the slon daemon to replicate
	changes all at once.
In-Reply-To: <db471ace0712080952w757f9e70q9cc5de49d3789ee9@mail.gmail.com>
References: <db471ace0712080952w757f9e70q9cc5de49d3789ee9@mail.gmail.com>
Message-ID: <20071209212157.GA31614@fetter.org>

On Sat, Dec 08, 2007 at 05:52:16PM +0000, Peter Geoghegan wrote:
> Hello,
> 
> I'm using slony to power a point-of-sale system - changes in the
> back-office are replicated amongst tills (subscribers).  For
> business logic reasons, I'd like to be able to create a backlog of
> changes, and then have the slon daemon replicate all such changes
> upon being explicitly told to do so, rather then having the daemon
> automatically replicate all changes to the replication set.
> 
> Is this possible? How so?

If it's possible for you to box all those changes into a single
transaction, Slony will just Do The Right Thing(TM).

If not, I suppose you could kill all the slons before doing the change
set, then restart them afterwards, but that seems horrifically
kludgey.

Cheers,
David.
-- 
David Fetter <david@fetter.org> http://fetter.org/
Phone: +1 415 235 3778  AIM: dfetter666  Yahoo!: dfetter
Skype: davidfetter      XMPP: david.fetter@gmail.com

Remember to vote!
Consider donating to Postgres: http://www.postgresql.org/about/donate
From peter.geoghegan86 at gmail.com  Sun Dec  9 15:09:13 2007
From: peter.geoghegan86 at gmail.com (Peter Geoghegan)
Date: Sun Dec  9 15:09:23 2007
Subject: [Slony1-general] Delayed replication: Explicitly creating a
	slony-I backlog,
	and then telling the slon daemon to replicate changes all at once.
In-Reply-To: <20071209212157.GA31614@fetter.org>
References: <db471ace0712080952w757f9e70q9cc5de49d3789ee9@mail.gmail.com>
	<20071209212157.GA31614@fetter.org>
Message-ID: <db471ace0712091509g7294bcc1x61b0791f171586@mail.gmail.com>

David,

Unfortunately, changes to the database may be quite varied. We aren't
talking about massive amounts of data though - in the order a few dozen rows
per update per slave. Confining that to a single transaction isn't
realistic, though.

How would I go about applying this horrifically kludgy solution? Would the
following be do-able ? :

1. Make changes to the database with no Slon daemons running, through my C++
front end.

2. Start the Slon daemon for the first subscriber using my application .
Have the slon daemon update changes made to the db to its subscriber as
necessary, in a reasonable space of time.

3. Shutdown the Slon daemon when it was finished. I'd need some mechanism to
tell my application that it was finished, so that it'd know when to do this.
I'm using the libpqxx API ( a C++ wrapper of libpq).

4. Repeat the process for some or all other subscribers, as the user may or
may not require changes to be immediately replicated to all subscribers.

This is clearly a bit of a hack - another option would be to use log
shipping, and to transfer the log to my application (over ftp or something)
as necessary.

It would be once again necessary (or at least desirable) to run the Slon
daemon only when doing the update - anything more would be superfluous. So
I'd still have to be able to monitor the Slon daemon's progress.

Could I monitor the slon daemon's progress from my MS Windows MFC C++
application, preferably without spawning DOS boxes?

You may very well not be up on windows (I'm not really a windows guy
myself), in which case I'd appreciate it if you could offer an equivalent
solution for Linux - I'll probably be able to apply the same logic in
windows,

Thanks a lot,
Peter
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071209/=
e5707194/attachment.htm
From marc2112 at yahoo.com  Sun Dec  9 17:31:23 2007
From: marc2112 at yahoo.com (marc2112)
Date: Sun Dec  9 17:31:33 2007
Subject: [Slony1-general] ddl mistake
Message-ID: <855619.11434.qm@web36913.mail.mud.yahoo.com>

So I messed up and I was wondering if you could help bail me out...

I dropped a bunch of foreign key constraints from tables in the master database without using the EXECUTE SCRIPT command.  I didn't realize that that kind of DDL change which didn't change the shape of the tables couldn't be done on each node independently.  After reading the documentation more carefully, I see that I made a mistake.

At this point, what are my options for recovering the state of the cluster?  If I try to delete the foreign keys in the slave db, I get errors like ERROR:  "users_pkey" is an index.

Any suggestions?  Thanks in advance for whatever help you can offer.

---Marc




      ____________________________________________________________________________________
Be a better friend, newshound, and 
know-it-all with Yahoo! Mobile.  Try it now.  http://mobile.yahoo.com/;_ylt=Ahu06i62sR8HDtDypao8Wcj9tAcJ 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071209/174b5494/attachment.htm
From cedric.villemain at dalibo.com  Mon Dec 10 03:07:28 2007
From: cedric.villemain at dalibo.com (=?ISO-8859-1?Q?C=E9dric_Villemain?=)
Date: Mon Dec 10 03:07:49 2007
Subject: [Slony1-general] Slony replication monitoring
In-Reply-To: <200712070655.25479.darcyb@commandprompt.com>
References: <72136.77509.qm@web25802.mail.ukl.yahoo.com>
	<200712070655.25479.darcyb@commandprompt.com>
Message-ID: <475D1DF0.8040707@dalibo.com>

Darcy Buskermolen a ?crit :
> On Friday 07 December 2007 06:52:05 Glyn Astill wrote:
>   
>> Hi All,
>>
>> Is there a way we can monitor Slony to ensure it is in sync and that
>> it is still working?
>>
>> Also is there any way to validate our data?
>>
>> Reporting tools or shell script ideas would be ace
>>     
>
> on the origin server:
>
> select * from _CLUSTERNAME.sl_status;
>
>
>
>   
I used to add a table 'last_update_X' to setX, updated every second, and 
then check the result accross the cluster and graph the diff
>> Glyn Astill
>>
>>
>>
>>       __________________________________________________________
>> Sent from Yahoo! Mail - a smarter inbox http://uk.mail.yahoo.com
>>
>>
>> _______________________________________________
>> Slony1-general mailing list
>> Slony1-general@lists.slony.info
>> http://lists.slony.info/mailman/listinfo/slony1-general
>>     
>
>
>
>   

From david at fetter.org  Mon Dec 10 04:27:50 2007
From: david at fetter.org (David Fetter)
Date: Mon Dec 10 04:28:07 2007
Subject: [Slony1-general] Delayed replication: Explicitly creating a
	slony-I backlog, and then telling the slon daemon to replicate
	changes all at once.
In-Reply-To: <db471ace0712091509g7294bcc1x61b0791f171586@mail.gmail.com>
References: <db471ace0712080952w757f9e70q9cc5de49d3789ee9@mail.gmail.com>
	<20071209212157.GA31614@fetter.org>
	<db471ace0712091509g7294bcc1x61b0791f171586@mail.gmail.com>
Message-ID: <20071210122750.GA1877@fetter.org>

On Sun, Dec 09, 2007 at 11:09:13PM +0000, Peter Geoghegan wrote:
> David,
> 
> Unfortunately, changes to the database may be quite varied.  We
> aren't talking about massive amounts of data though - in the order a
> few dozen rows per update per slave. Confining that to a single
> transaction isn't realistic, though.

I don't know how to put this to you gently, but it doesn't seem to me
that your design goals are terribly well thought-out.

Could you explain in short simple words what's wrong with having Slony
simply do its job, which is to ship out row changes at the transaction
boundary?

Cheers,
David.
-- 
David Fetter <david@fetter.org> http://fetter.org/
Phone: +1 415 235 3778  AIM: dfetter666  Yahoo!: dfetter
Skype: davidfetter      XMPP: david.fetter@gmail.com

Remember to vote!
Consider donating to Postgres: http://www.postgresql.org/about/donate
From joshques at gmail.com  Mon Dec 10 09:54:29 2007
From: joshques at gmail.com (Josh Harrison)
Date: Mon Dec 10 09:54:34 2007
Subject: [Slony1-general] postgres version upgrade question
Message-ID: <8d89ea1d0712100954i7b136356hd639e05ba2ac3709@mail.gmail.com>

Hi,
Does slony support postgres major version upgrade ? ie., will it
 replicate between different major versions?
Thanks
josh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071210/=
2312fa36/attachment.htm
From drees76 at gmail.com  Mon Dec 10 10:26:17 2007
From: drees76 at gmail.com (David Rees)
Date: Mon Dec 10 10:26:22 2007
Subject: [Slony1-general] postgres version upgrade question
In-Reply-To: <8d89ea1d0712100954i7b136356hd639e05ba2ac3709@mail.gmail.com>
References: <8d89ea1d0712100954i7b136356hd639e05ba2ac3709@mail.gmail.com>
Message-ID: <72dbd3150712101026v25653108lf4361c00a9e52191@mail.gmail.com>

On Dec 10, 2007 9:54 AM, Josh Harrison <joshques@gmail.com> wrote:
> Does slony support postgres major version upgrade ? ie., will it
>  replicate between different major versions?

Yes, it will replicate just fine between any supported version of Postgres.

-Dave
From tgoodair at ca.afilias.info  Mon Dec 10 10:25:51 2007
From: tgoodair at ca.afilias.info (Tim Goodaire)
Date: Mon Dec 10 10:26:49 2007
Subject: [Slony1-general] postgres version upgrade question
In-Reply-To: <8d89ea1d0712100954i7b136356hd639e05ba2ac3709@mail.gmail.com>
References: <8d89ea1d0712100954i7b136356hd639e05ba2ac3709@mail.gmail.com>
Message-ID: <20071210182551.GN8002@dba6>

Yes it does.

On Mon, Dec 10, 2007 at 12:54:29PM -0500, Josh Harrison wrote:
> Hi,
> Does slony support postgres major version upgrade ? ie., will it
>  replicate between different major versions?
> Thanks
> josh

> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


-- 
Tim Goodaire    416-673-4126    tgoodair@ca.afilias.info
Database Team Lead, Afilias Canada Corp.
From joshques at gmail.com  Mon Dec 10 10:53:48 2007
From: joshques at gmail.com (Josh Harrison)
Date: Mon Dec 10 10:53:54 2007
Subject: [Slony1-general] postgres version upgrade question
In-Reply-To: <20071210182551.GN8002@dba6>
References: <8d89ea1d0712100954i7b136356hd639e05ba2ac3709@mail.gmail.com>
	<20071210182551.GN8002@dba6>
Message-ID: <8d89ea1d0712101053g683bf7e8hb717f3e16a2063c9@mail.gmail.com>

Thanks guys

On Dec 10, 2007 1:25 PM, Tim Goodaire <tgoodair@ca.afilias.info> wrote:

> Yes it does.
>
> On Mon, Dec 10, 2007 at 12:54:29PM -0500, Josh Harrison wrote:
> > Hi,
> > Does slony support postgres major version upgrade ? ie., will it
> >  replicate between different major versions?
> > Thanks
> > josh
>
> > _______________________________________________
> > Slony1-general mailing list
> > Slony1-general@lists.slony.info
> > http://lists.slony.info/mailman/listinfo/slony1-general
>
>
> --
> Tim Goodaire    416-673-4126    tgoodair@ca.afilias.info
> Database Team Lead, Afilias Canada Corp.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071210/=
d1c42294/attachment-0001.htm
From vivek at khera.org  Mon Dec 10 11:31:28 2007
From: vivek at khera.org (Vivek Khera)
Date: Mon Dec 10 11:31:35 2007
Subject: [Slony1-general] Replicated Tables & On Delete Cascade
In-Reply-To: <E9AEFDF3-54B9-4015-A037-EF5059DDBACA@torgo.978.org>
References: <E9AEFDF3-54B9-4015-A037-EF5059DDBACA@torgo.978.org>
Message-ID: <6CC58A77-6039-466F-8F23-B323F2C6BE00@khera.org>


On Dec 6, 2007, at 3:48 PM, Jeff Trout wrote:

> In one case we have a table that as a foreign key w/ondelete cascade  
> into the replicated table. This works fine - inserting a row into  
> the table fails if the key isn't there.  The problem is if data is  
> deleted from the replicated table, it seems the ON DELETE CASCADE  
> part is never done, and I'm left with orphaned nodes in my other  
> tables.

If all of your tables are replicated by slony, it will take care of  
performing the individual deletes on the cascaded tables for you on  
the replicated nodes.

There must be some other problem you have because slony will do the  
right thing here.

Looking at your examples, you must have it such that one of your  
tables is not replicated by slony because you are inserting into it on  
the replica.  This won't work because you're expecting the DB to do  
consistency, but you've told slony it owns the table, so it disables  
the DB from doing consistency checks which are redundant.

Your use case doesn't work with slony.

From vivek at khera.org  Mon Dec 10 11:37:20 2007
From: vivek at khera.org (Vivek Khera)
Date: Mon Dec 10 11:37:27 2007
Subject: [Slony1-general] Delayed replication: Explicitly creating a
	slony-I backlog,
	and then telling the slon daemon to replicate changes all at once.
In-Reply-To: <db471ace0712091509g7294bcc1x61b0791f171586@mail.gmail.com>
References: <db471ace0712080952w757f9e70q9cc5de49d3789ee9@mail.gmail.com>
	<20071209212157.GA31614@fetter.org>
	<db471ace0712091509g7294bcc1x61b0791f171586@mail.gmail.com>
Message-ID: <A4BD2D00-0F94-4F38-B19D-99F64C2E351F@khera.org>


On Dec 9, 2007, at 6:09 PM, Peter Geoghegan wrote:

>
> 1. Make changes to the database with no Slon daemons running,  
> through my C++ front end.

Change this to leaving the slon on the origin server running, or at  
least use the script that generates sync events on the master while  
slon is down.

but your basic outline would work.  the trick is figuroing out how to  
start and when to stop the slons for each replica.  at least you can  
run them all on the same host -- no need to remote execute jobs.

One possibility would be to check the sl_status data for your remote  
node.  Note the st_last_event value, and monitor for when  
st_last_received exceeds that number. Then you know you're as up to  
date as of the time you started the slon, and can kill it off.  That  
assumes all the updates you're interested in have been done by the  
time you start slon for that node.

From JanWieck at Yahoo.com  Mon Dec 10 12:19:14 2007
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Mon Dec 10 12:19:28 2007
Subject: [Slony1-general] Delayed replication: Explicitly creating a
	slony-I backlog,
	and then telling the slon daemon to replicate changes all at once.
In-Reply-To: <db471ace0712080952w757f9e70q9cc5de49d3789ee9@mail.gmail.com>
References: <db471ace0712080952w757f9e70q9cc5de49d3789ee9@mail.gmail.com>
Message-ID: <475D9F42.4040704@Yahoo.com>

On 12/8/2007 12:52 PM, Peter Geoghegan wrote:
> Hello,
> 
> I'm using slony to power a point-of-sale system - changes in the 
> back-office are replicated amongst tills (subscribers). For business 
> logic reasons, I'd like to be able to create a backlog of changes, and 
> then have the slon daemon replicate all such changes upon being 
> explicitly told to do so, rather then having the daemon automatically 
> replicate all changes to the replication set.
> 
> Is this possible? How so?

Artificially delaying the replication process for purposes of point in 
time recovery was considered in the original design of the Slony-I 
system, but the mechanism was actually never implemented. The idea was 
not quite how you describe it above, where slon would wait until some 
sort of command kicks off the catch up process, but rather that slon 
would ignore events unless they are at least X minutes old. This could 
relatively simple be implemented in the query that looks for new events 
in the remote_listen thread, by adding a qualification that suppresses 
those "too new" events.

I will see if we can easily add the feature to the upcoming 2.0 release 
of Slony-I.


Jan


> 
> Thanks in advance,
> 
> Peter
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


-- 
#======================================================================#
# It's easier to get forgiveness for being wrong than for being right. #
# Let's break this rule - forgive me.                                  #
#================================================== JanWieck@Yahoo.com #
From cbbrowne at ca.afilias.info  Mon Dec 10 12:23:26 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Mon Dec 10 12:23:33 2007
Subject: [Slony1-general] Delayed replication: Explicitly creating a
	slony-I backlog,
	and then telling the slon daemon to replicate changes all at once.
In-Reply-To: <475D9F42.4040704@Yahoo.com> (Jan Wieck's message of "Mon,
	10 Dec 2007 15:19:14 -0500")
References: <db471ace0712080952w757f9e70q9cc5de49d3789ee9@mail.gmail.com>
	<475D9F42.4040704@Yahoo.com>
Message-ID: <60aboicn9d.fsf@dba2.int.libertyrms.com>

Jan Wieck <JanWieck@Yahoo.com> writes:
> On 12/8/2007 12:52 PM, Peter Geoghegan wrote:
>> Hello,
>> I'm using slony to power a point-of-sale system - changes in the
>> back-office are replicated amongst tills (subscribers). For business
>> logic reasons, I'd like to be able to create a backlog of changes,
>> and then have the slon daemon replicate all such changes upon being
>> explicitly told to do so, rather then having the daemon
>> automatically replicate all changes to the replication set.
>> Is this possible? How so?
>
> Artificially delaying the replication process for purposes of point in
> time recovery was considered in the original design of the Slony-I
> system, but the mechanism was actually never implemented. The idea was
> not quite how you describe it above, where slon would wait until some
> sort of command kicks off the catch up process, but rather that slon
> would ignore events unless they are at least X minutes old. This could
> relatively simple be implemented in the query that looks for new
> events in the remote_listen thread, by adding a qualification that
> suppresses those "too new" events.
>
> I will see if we can easily add the feature to the upcoming 2.0
> release of Slony-I.

Actually, a form of this feature is already in 1.2.

Run "slon -h", and look at the "-l" flag, aka "lag_interval".
-- 
let name="cbbrowne" and tld="cbbrowne.com" in String.concat "@" [name;tld];;
http://cbbrowne.com/info/spreadsheets.html
Rules  of the  Evil Overlord  #227.  "I will  never bait  a trap  with
genuine bait." <http://www.eviloverlord.com/>
From marcus.gustafsson at visionten.net  Tue Dec 11 02:50:56 2007
From: marcus.gustafsson at visionten.net (Marcus Gustafsson)
Date: Tue Dec 11 02:51:18 2007
Subject: [Slony1-general] More debugging?
Message-ID: <475E6B90.3010200@visionten.net>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi guys!

We are running a cluster of 2 (soon to be three) servers using
slony1-1.1.5-1 with PostgreSQL 8.1.9.
I have run in to a problem when trying to add the third node though.
To create the new node I did:

* Extracted the database schema using slony1_extract_schema.sh (on the
  master)
* Created the database and all users involved on the new node
* Installed the schema extracted in the first step
* Ran slonik manually to initialize the node (store
  node(id=3,comment='Second slave')
* Started a local slon process checking the logs that it attached
* Ran slonik manually to add the new storage paths (a bunch of
  store path (...)
* Noticed that syncs started to appear in the slon log (although not
  acted upon as I yet had to subscribe the node)
* Ran slonik manually to subscribe the new node (subscribe set
  (id=1,provider=1,receiver=3,forward=yes))

After this I noticed that slon started to copy data (as intended) for
each of the tables, but it never actually managed to start as it breaks
on the first table:

<snip>a lot of prepare to copy and successfull copying of sequences</snip>

2007-12-11 04:23:12 CST DEBUG2 remoteWorkerThread_1: copy table
"public"."fb_fy_account_history"
2007-12-11 04:23:12 CST DEBUG3 remoteWorkerThread_1: table
"public"."fb_fy_account_history" does not require Slony-I serial key
2007-12-11 04:23:12 CST DEBUG2 remoteWorkerThread_1: Begin COPY of table
"public"."fb_fy_account_history"
NOTICE:  truncate of "public"."fb_fy_account_history" succeeded
2007-12-11 04:23:12 CST DEBUG1 slon: done
2007-12-11 04:23:12 CST DEBUG2 slon: remove pid file
2007-12-11 04:23:12 CST DEBUG2 slon: exit(0)


This is with debug level set to 4.
- From searching on the web it seems that something breaks when slon tries
to insert the data in the new tables, but how can I figure out where it
breaks? Are there any higher debug levels or any smart tricks to figure
out why and where the copying breaks?

Regards,
 Marcus
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.5 (MingW32)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFHXmuQzYC0ZmFVS9sRAmAkAJ90mdQc2iTRZ44xKjuM683U7hpS/QCfaodZ
pA8loP4ynY1xIGf7qbKuId4=
=5CIC
-----END PGP SIGNATURE-----
From joshques at gmail.com  Tue Dec 11 06:58:06 2007
From: joshques at gmail.com (Josh Harrison)
Date: Tue Dec 11 06:58:10 2007
Subject: [Slony1-general] postgres version upgrade question
In-Reply-To: <8d89ea1d0712101053g683bf7e8hb717f3e16a2063c9@mail.gmail.com>
References: <8d89ea1d0712100954i7b136356hd639e05ba2ac3709@mail.gmail.com>
	<20071210182551.GN8002@dba6>
	<8d89ea1d0712101053g683bf7e8hb717f3e16a2063c9@mail.gmail.com>
Message-ID: <8d89ea1d0712110658u18fe2496s80b4dd8595b44c5f@mail.gmail.com>

Im testing slony1-1.2.12 in postgres 8.3beta3 version. I tried to configure
slony but I keep getting this error.

 ./configure --with-pgconfigdir=3D/export/home/sjothirajah/postgres8.3/bin
--with-enable-thread-safety
or
./configure --with-pgconfigdir=3D/export/home/sjothirajah/postgres8.3/bin
--enable-thread-safety

........
........
checking for correct version of PostgreSQL... 8.3
pg_config says pg_sharedir is /usr4/postgres8.3/share/postgresql/
checking PostgreSQL for enable-thread-safety as required on solaris2.10...
no
configure: error: PostgreSQL needs to be compiled with
--enable-thread-safety on solaris2.10

Can you help
Thanks
josh


On Dec 10, 2007 1:53 PM, Josh Harrison <joshques@gmail.com> wrote:

> Thanks guys
>
>
> On Dec 10, 2007 1:25 PM, Tim Goodaire <tgoodair@ca.afilias.info> wrote:
>
> > Yes it does.
> >
> > On Mon, Dec 10, 2007 at 12:54:29PM -0500, Josh Harrison wrote:
> > > Hi,
> > > Does slony support postgres major version upgrade ? ie., will it
> > >  replicate between different major versions?
> > > Thanks
> > > josh
> >
> > > _______________________________________________
> > > Slony1-general mailing list
> > > Slony1-general@lists.slony.info
> > > http://lists.slony.info/mailman/listinfo/slony1-general
> >
> >
> > --
> > Tim Goodaire    416-673-4126     tgoodair@ca.afilias.info
> > Database Team Lead, Afilias Canada Corp.
> >
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071211/=
77b85136/attachment.htm
From peter.geoghegan86 at gmail.com  Tue Dec 11 06:59:51 2007
From: peter.geoghegan86 at gmail.com (Peter Geoghegan)
Date: Tue Dec 11 06:59:55 2007
Subject: [Slony1-general] Delayed replication: Explicitly creating a
	slony-I backlog,
	and then telling the slon daemon to replicate changes all at once.
In-Reply-To: <475D9F42.4040704@Yahoo.com>
References: <db471ace0712080952w757f9e70q9cc5de49d3789ee9@mail.gmail.com>
	<475D9F42.4040704@Yahoo.com>
Message-ID: <db471ace0712110659o7cdedf29k4cbff31e08be35b9@mail.gmail.com>

Jan,

>> Artificially delaying the replication process for purposes of point in
>> time recovery was considered in the original design of the Slony-I
>> system, but the mechanism was actually never implemented. The idea was
>> not quite how you describe it above, where slon would wait until some
>> sort of command kicks off the catch up process, but rather that slon
>> would ignore events unless they are at least X minutes old. This could
>> relatively simple be implemented in the query that looks for new events
>> in the remote_listen thread, by adding a qualification that suppresses
>> those "too new" events.

>> I will see if we can easily add the feature to the upcoming 2.0 release
>> of Slony-I.

Is it your intention to implement (or investigate the possibility of
implementing) delayed replication as I've described it, or to implement the
"ignore unless x minutes old" model, or both?

Thanks in advance,
Peter

>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071211/=
af1bd689/attachment.htm
From cbbrowne at ca.afilias.info  Tue Dec 11 07:45:52 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Tue Dec 11 07:45:56 2007
Subject: [Slony1-general] postgres version upgrade question
In-Reply-To: <8d89ea1d0712110658u18fe2496s80b4dd8595b44c5f@mail.gmail.com>
	(Josh Harrison's message of "Tue, 11 Dec 2007 09:58:06 -0500")
References: <8d89ea1d0712100954i7b136356hd639e05ba2ac3709@mail.gmail.com>
	<20071210182551.GN8002@dba6>
	<8d89ea1d0712101053g683bf7e8hb717f3e16a2063c9@mail.gmail.com>
	<8d89ea1d0712110658u18fe2496s80b4dd8595b44c5f@mail.gmail.com>
Message-ID: <60wsrlb5fz.fsf@dba2.int.libertyrms.com>

"Josh Harrison" <joshques@gmail.com> writes:
> Im testing slony1-1.2.12 in postgres 8.3beta3 version. I tried to configure slony but I keep getting this error.
> ?./configure --with-pgconfigdir=/export
>
> /home/sjothirajah/postgres8.3/bin --with-enable-thread-safety
> or
> ./configure --with-pgconfigdir=/export/home/sjothirajah/postgres8.3/bin --enable-thread-safety
> ........
> ........
> checking for correct version of PostgreSQL... 8.3
> pg_config says pg_sharedir is /usr4/postgres8.3/share/postgresql/
> checking PostgreSQL for enable-thread-safety as required on solaris2.10... no
> configure: error: PostgreSQL needs to be compiled with --enable-thread-safety on solaris2.10
> Can you help

This isn't a problem with Slony-I - it's a problem with your
PostgreSQL build.

On Solaris, PostgreSQL needs to be compiled with
"--enable-thread-safety" in order for Slony-I to work properly.

Evidently your PostgreSQL build was not compiled with
"--enable-thread-safety".

You will need to see about getting a properly-built PostgreSQL build.
No amount of fiddling with Slony-I will resolve this...
-- 
output = reverse("ofni.sesabatadxunil" "@" "enworbbc")
http://linuxfinances.info/info/wp.html
"Parentheses?  What  parentheses? I  haven't  noticed any  parentheses
since my  first month of Lisp  programming.  I like to  ask people who
complain about  parentheses in  Lisp if they  are bothered by  all the
spaces between words in a newspaper..."
-- Kenny Tilton <tilt@liii.com>
From ajs at crankycanuck.ca  Tue Dec 11 07:46:13 2007
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Tue Dec 11 07:46:26 2007
Subject: [Slony1-general] postgres version upgrade question
In-Reply-To: <8d89ea1d0712110658u18fe2496s80b4dd8595b44c5f@mail.gmail.com>
References: <8d89ea1d0712100954i7b136356hd639e05ba2ac3709@mail.gmail.com>
	<20071210182551.GN8002@dba6>
	<8d89ea1d0712101053g683bf7e8hb717f3e16a2063c9@mail.gmail.com>
	<8d89ea1d0712110658u18fe2496s80b4dd8595b44c5f@mail.gmail.com>
Message-ID: <20071211154613.GA27409@crankycanuck.ca>

On Tue, Dec 11, 2007 at 09:58:06AM -0500, Josh Harrison wrote:
> Im testing slony1-1.2.12 in postgres 8.3beta3 version. I tried to configure
> slony but I keep getting this error.

You need the tip of the stable branch to work with the later 8.3 betas. 
There was an incompatibility that's just recently been fixed.

A

From joshques at gmail.com  Tue Dec 11 08:02:49 2007
From: joshques at gmail.com (Josh Harrison)
Date: Tue Dec 11 08:02:53 2007
Subject: [Slony1-general] postgres version upgrade question
In-Reply-To: <20071211154613.GA27409@crankycanuck.ca>
References: <8d89ea1d0712100954i7b136356hd639e05ba2ac3709@mail.gmail.com>
	<20071210182551.GN8002@dba6>
	<8d89ea1d0712101053g683bf7e8hb717f3e16a2063c9@mail.gmail.com>
	<8d89ea1d0712110658u18fe2496s80b4dd8595b44c5f@mail.gmail.com>
	<20071211154613.GA27409@crankycanuck.ca>
Message-ID: <8d89ea1d0712110802r7b86c47am977363b02ef3107e@mail.gmail.com>

>
>
>
> You need the tip of the stable branch to work with the later 8.3 betas.
> There was an incompatibility that's just recently been fixed.
>
> A
>

Is this a problem with postgres8.3 version or with Solaris? I see this patch
in the slony website http://slony.info/

The multithreaded replication engine requires the libpq client library to be
compiled with --enable-thread-safety on certain operating systems. Known are
thus far Solaris and AIX. Other operating systems are known to not require
this (Linux-X86, FreeBSD-X86, FreeBSD-Alpha, OpenBSD-Sparc64 and OSX). The
configuration script is broken with respect to the --enable-thread-safety
switch for Solaris. Please apply this patch, configure and recompile
libpq: threadsafe-libpq-742.diff.gz.
<http://developer.postgresql.org/%7Ewieck/slony1/download/threadsafe-libpq-=
742.diff.gz>


My platform information
uname -a
SunOS machine1 5.10 Generic_118844-26 i86pc i386 i86pc

So the problem is with version8.3 or with solaris?
Thanks
josh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071211/=
45a85c0d/attachment.htm
From ajs at crankycanuck.ca  Tue Dec 11 08:05:34 2007
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Tue Dec 11 08:05:43 2007
Subject: [Slony1-general] postgres version upgrade question
In-Reply-To: <8d89ea1d0712110802r7b86c47am977363b02ef3107e@mail.gmail.com>
References: <8d89ea1d0712100954i7b136356hd639e05ba2ac3709@mail.gmail.com>
	<20071210182551.GN8002@dba6>
	<8d89ea1d0712101053g683bf7e8hb717f3e16a2063c9@mail.gmail.com>
	<8d89ea1d0712110658u18fe2496s80b4dd8595b44c5f@mail.gmail.com>
	<20071211154613.GA27409@crankycanuck.ca>
	<8d89ea1d0712110802r7b86c47am977363b02ef3107e@mail.gmail.com>
Message-ID: <20071211160534.GB27409@crankycanuck.ca>

On Tue, Dec 11, 2007 at 11:02:49AM -0500, Josh Harrison wrote:
> 
> Is this a problem with postgres8.3 version or with Solaris? I see this patch

I think the answer is "yes".  You have to compile Postgres on Solaris with
--enable-thread-safety.  You _also_ need the very latest stable Slony branch
to work against 8.3, AIUI.

A

From joshques at gmail.com  Tue Dec 11 08:24:36 2007
From: joshques at gmail.com (Josh Harrison)
Date: Tue Dec 11 08:24:41 2007
Subject: [Slony1-general] postgres version upgrade question
In-Reply-To: <20071211160534.GB27409@crankycanuck.ca>
References: <8d89ea1d0712100954i7b136356hd639e05ba2ac3709@mail.gmail.com>
	<20071210182551.GN8002@dba6>
	<8d89ea1d0712101053g683bf7e8hb717f3e16a2063c9@mail.gmail.com>
	<8d89ea1d0712110658u18fe2496s80b4dd8595b44c5f@mail.gmail.com>
	<20071211154613.GA27409@crankycanuck.ca>
	<8d89ea1d0712110802r7b86c47am977363b02ef3107e@mail.gmail.com>
	<20071211160534.GB27409@crankycanuck.ca>
Message-ID: <8d89ea1d0712110824h51c22272je34127d4f743527d@mail.gmail.com>

>
>
> I think the answer is "yes".  You have to compile Postgres on Solaris with
> --enable-thread-safety.


 I compiled postgres8.3 with --enable-thread-safety option and tried to
cconfigure slony.I still get the same error
configure: error: PostgreSQL needs to be compiled with
--enable-thread-safety on solaris2.10

 You _also_ need the very latest stable Slony branch
> to work against 8.3, AIUI.
>

I dont understand this.Can you explain this a bit? Also where do I get the
latest Slony branch?
Do you think I have to install the patch for solaris and reconfigure
postgresql again. I havent applied patches before. If I have to do that
where shd I save this patch(what is it substituting for?? sorry if my
question is dumb)
configure postgresql again?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071211/=
5ce6b98f/attachment.htm
From ajs at crankycanuck.ca  Tue Dec 11 08:35:17 2007
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Tue Dec 11 08:35:28 2007
Subject: [Slony1-general] postgres version upgrade question
In-Reply-To: <8d89ea1d0712110824h51c22272je34127d4f743527d@mail.gmail.com>
References: <8d89ea1d0712100954i7b136356hd639e05ba2ac3709@mail.gmail.com>
	<20071210182551.GN8002@dba6>
	<8d89ea1d0712101053g683bf7e8hb717f3e16a2063c9@mail.gmail.com>
	<8d89ea1d0712110658u18fe2496s80b4dd8595b44c5f@mail.gmail.com>
	<20071211154613.GA27409@crankycanuck.ca>
	<8d89ea1d0712110802r7b86c47am977363b02ef3107e@mail.gmail.com>
	<20071211160534.GB27409@crankycanuck.ca>
	<8d89ea1d0712110824h51c22272je34127d4f743527d@mail.gmail.com>
Message-ID: <20071211163517.GF27409@crankycanuck.ca>

On Tue, Dec 11, 2007 at 11:24:36AM -0500, Josh Harrison wrote:
> 
> I dont understand this.Can you explain this a bit? Also where do I get the
> latest Slony branch?

Follow the instructions here:

http://slony.info/scm/

except that after the 'cvs' in the command line when you are checking out,
you have to specify -r REL_1_2_STABLE.

> Do you think I have to install the patch for solaris and reconfigure
> postgresql again. I havent applied patches before. If I have to do that

I don't know.  I thought this was fixed in the main Postgres tree.

A
From joshques at gmail.com  Tue Dec 11 11:11:13 2007
From: joshques at gmail.com (Josh Harrison)
Date: Tue Dec 11 11:11:20 2007
Subject: [Slony1-general] postgres version upgrade question
In-Reply-To: <20071211163517.GF27409@crankycanuck.ca>
References: <8d89ea1d0712100954i7b136356hd639e05ba2ac3709@mail.gmail.com>
	<20071210182551.GN8002@dba6>
	<8d89ea1d0712101053g683bf7e8hb717f3e16a2063c9@mail.gmail.com>
	<8d89ea1d0712110658u18fe2496s80b4dd8595b44c5f@mail.gmail.com>
	<20071211154613.GA27409@crankycanuck.ca>
	<8d89ea1d0712110802r7b86c47am977363b02ef3107e@mail.gmail.com>
	<20071211160534.GB27409@crankycanuck.ca>
	<8d89ea1d0712110824h51c22272je34127d4f743527d@mail.gmail.com>
	<20071211163517.GF27409@crankycanuck.ca>
Message-ID: <8d89ea1d0712111111r17c66cadod16dfdebf3efedda@mail.gmail.com>

Thanks

>
> >
> > I dont understand this.Can you explain this a bit? Also where do I get
> the
> > latest Slony branch?
>
> Follow the instructions here:
>
> http://slony.info/scm/
>
> except that after the 'cvs' in the command line when you are checking out,
>
> you have to specify -r REL_1_2_STABLE.


 I tried the stable release from this website...configured it with
enable-thread-safety and configured postgres with enable-thread-safety. But
still get the same error. Is there ay other reasons that migt cause this
problem?

Also Is there a way to see if this enable-thread-safety option is enabled?

>
> > Do you think I have to install the patch for solaris and reconfigure
> > postgresql again. I havent applied patches before. If I have to do that
>
> I don't know.  I thought this was fixed in the main Postgres tree.
>
> A


josh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071211/=
d3e9df80/attachment.htm
From cichy1 at gmail.com  Tue Dec 11 11:28:55 2007
From: cichy1 at gmail.com (cichy)
Date: Tue Dec 11 11:29:04 2007
Subject: [Slony1-general] selective data replication question
Message-ID: <305b0d940712111128o536d0c46weefaf2dcecf28ea4@mail.gmail.com>

Hi All,
i'm slony newbie, and i have a question about slony. In my company we are
planning to use slony to replicate one schema from one database to another
DB. These two databases are used for different purposes - on the first DB
there are many insertions, some updates and deletes on records, while on the
2nd DB data is read. Weekly, from first DB, we want to delete records, which
are older than a week, but in such way that they are not deleted from the
second DB. Is it possible with slony? Maybe records with certain values in
some columns can be ommited from deletion in slave DB?

Thanks in advance for any help,
PR
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071211/=
ab7aa589/attachment.htm
From ajs at crankycanuck.ca  Tue Dec 11 11:37:01 2007
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Tue Dec 11 11:37:12 2007
Subject: [Slony1-general] postgres version upgrade question
In-Reply-To: <8d89ea1d0712111111r17c66cadod16dfdebf3efedda@mail.gmail.com>
References: <8d89ea1d0712100954i7b136356hd639e05ba2ac3709@mail.gmail.com>
	<20071210182551.GN8002@dba6>
	<8d89ea1d0712101053g683bf7e8hb717f3e16a2063c9@mail.gmail.com>
	<8d89ea1d0712110658u18fe2496s80b4dd8595b44c5f@mail.gmail.com>
	<20071211154613.GA27409@crankycanuck.ca>
	<8d89ea1d0712110802r7b86c47am977363b02ef3107e@mail.gmail.com>
	<20071211160534.GB27409@crankycanuck.ca>
	<8d89ea1d0712110824h51c22272je34127d4f743527d@mail.gmail.com>
	<20071211163517.GF27409@crankycanuck.ca>
	<8d89ea1d0712111111r17c66cadod16dfdebf3efedda@mail.gmail.com>
Message-ID: <20071211193701.GP27409@crankycanuck.ca>

On Tue, Dec 11, 2007 at 02:11:13PM -0500, Josh Harrison wrote:
> 
>  I tried the stable release from this website...configured it with

No, that's exactly what I've been trying to make clear.  I think the stable
tarball needs something that's been added in the CVS stable tree in order to
work properly with 8.3.  The RELEASE file in CVS says this:

RELEASE 1.2.13
- Fixed problem with compatibility with PostgreSQL 8.3; function
  typenameTypeId() has 3 arguments as of 8.3.
  
But since I don't see .13 available tarballed up on the site, I'm assuming
you're getting .12.  I presume we'll need a release of Slony for 8.3
compatibility shortly after 8.3 is released (or just before); but since it's
in beta, we're relying on people getting the code from CVS.  

The following should work:

CVSROOT=":pserver:anonymous@main.slony.info:/slony1" cvs login
CVSROOT=":pserver:anonymous@main.slony.info:/slony1" cvs co -r REL_1_2_STABLE slony1-engine

Whether this will solve your problem, I don't know, but AFAIK you won't be
able to get the .12 version to work with 8.3 betas.

A

From ajs at crankycanuck.ca  Tue Dec 11 11:38:21 2007
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Tue Dec 11 11:38:33 2007
Subject: [Slony1-general] selective data replication question
In-Reply-To: <305b0d940712111128o536d0c46weefaf2dcecf28ea4@mail.gmail.com>
References: <305b0d940712111128o536d0c46weefaf2dcecf28ea4@mail.gmail.com>
Message-ID: <20071211193821.GQ27409@crankycanuck.ca>

On Tue, Dec 11, 2007 at 08:28:55PM +0100, cichy wrote:
> are older than a week, but in such way that they are not deleted from the
> second DB. Is it possible with slony? Maybe records with certain values in
> some columns can be ommited from deletion in slave DB?

You can STORE TRIGGER on the second system, that saves those records
somewhere else.  The obvious way to do this is to use a trigger on the
replica that INSTEAD copies the records into a _different_, but that doesn't
fire on DELETE.

A

From postgres at dac.e4ward.com  Tue Dec 11 13:07:56 2007
From: postgres at dac.e4ward.com (postgres@dac.e4ward.com)
Date: Tue Dec 11 13:08:06 2007
Subject: [Slony1-general] replicated tables ownerships and permissions
Message-ID: <3374842078-2331@e4ward.com>

Hi there.

I have a master node with a database and tables owned by user1 (not
superuser). Our apps use that same user to connect to the database.

Following slony's documentation I created a new "slony" superuser so
slons connect to the nodes as that user. I've done schema migrations
using the slonik execute script without specifying ownerships. So all
my replicated tables on the slave are owned by the slony user.

When I want to do a switch/failover the apps can't use the replicated
tables because of permission issues.

I'd like to know if you can suggest me some "best practice" regarding
this simple case. If I can avoid having to include special ownership
changes on the execute scripts, much better.

Thanks

-- 
Diego Algorta Casamayou
http://www.oboxodo.com - http://diego.algorta.net
From cbbrowne at ca.afilias.info  Tue Dec 11 13:41:07 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Tue Dec 11 13:41:18 2007
Subject: [Slony1-general] Discussion re bug #8 SLON_DATA_FETCH_SIZE set too
	low
Message-ID: <60sl28c3kc.fsf@dba2.int.libertyrms.com>

http://www.slony.info/bugzilla/show_bug.cgi?id=8

In this bug, it is indicated that the number of tuples processed "per
line" or "per submission" seems to be too low in some high-update
scenarios.

http://lists.slony.info/pipermail/slony1-general/2007-November/006931.html

As per Simon Riggs' comments, I'd like to try to solicit discussion as
to how to improve this, pointing particularly towards improving the
default value.

It seems to me that if we set the value somewhat higher, that ought to
be helpful, and I don't see any particular reason NOT to apply this
more or less univerally.

This optimization seems to me to be similar to the way that it is
useful to group multiple updates into one transaction.  In particular,
the BIG improvement, with transaction processing comes from scaling up
from 'tiny transactions' to "somewhat larger."

That is, moving from 1 update per txn to 2 updates per txn leads to a
50% reduction in the number of transactions, and you always get
diminishing returns after that.

If that analogy holds, then I'd expect jumping from 10 statements per
request to 100 would provide ~90% of the improvement possible, and
only have nominal costs in terms of increased memory usage.

Other thoughts???
-- 
(reverse (concatenate 'string "moc.enworbbc" "@" "enworbbc"))
http://linuxdatabases.info/info/x.html
Rules   of the Evil   Overlord  #101. "I  will   not order my  trusted
lieutenant to kill the infant who is  destined to overthrow me -- I'll
do it myself." <http://www.eviloverlord.com/>
From joshques at gmail.com  Tue Dec 11 13:52:34 2007
From: joshques at gmail.com (Josh Harrison)
Date: Tue Dec 11 13:52:43 2007
Subject: [Slony1-general] slonik cluster creation question
Message-ID: <8d89ea1d0712111352s192edb29r198a1b513507118@mail.gmail.com>

Hi
Im a newbie to slony.
I installed slony and im trying tis example given in this website.
http://www.linuxjournal.com/article/7834

I created the databases as mentioned and the website says...
"  Once the databases are created, we are ready to create our database
cluster containing a master and a single slave. Create the Slonik
cluster_setup.sh script and execute it. "

My question is
Where should I create this Slonik cluster_setup.sh script and how to execute
it?

Thanks
josh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071211/=
9c729605/attachment.htm
From cbbrowne at ca.afilias.info  Tue Dec 11 13:55:50 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Tue Dec 11 13:55:59 2007
Subject: [Slony1-general] replicated tables ownerships and permissions
In-Reply-To: <3374842078-2331@e4ward.com> (postgres@dac.e4ward.com's message
	of "Tue, 11 Dec 2007 19:07:56 -0200")
References: <3374842078-2331@e4ward.com>
Message-ID: <60odcwc2vt.fsf@dba2.int.libertyrms.com>

<postgres@dac.e4ward.com> writes:
> I have a master node with a database and tables owned by user1 (not
> superuser). Our apps use that same user to connect to the database.
>
> Following slony's documentation I created a new "slony" superuser so
> slons connect to the nodes as that user. I've done schema migrations
> using the slonik execute script without specifying ownerships. So all
> my replicated tables on the slave are owned by the slony user.
>
> When I want to do a switch/failover the apps can't use the replicated
> tables because of permission issues.
>
> I'd like to know if you can suggest me some "best practice" regarding
> this simple case. If I can avoid having to include special ownership
> changes on the execute scripts, much better.

We've normally handled creation of new tables via submitting them via
psql to each node.

When those tables are new, and are not connected to replication yet,
there's not forcibly a need to go through the whole rigorous locking
process that EXECUTE SCRIPT goes to in order to get them into place.
-- 
(reverse (concatenate 'string "moc.enworbbc" "@" "enworbbc"))
http://linuxdatabases.info/info/x.html
Rules   of the Evil   Overlord  #101. "I  will   not order my  trusted
lieutenant to kill the infant who is  destined to overthrow me -- I'll
do it myself." <http://www.eviloverlord.com/>
From cbbrowne at ca.afilias.info  Tue Dec 11 14:03:08 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Tue Dec 11 14:03:16 2007
Subject: [Slony1-general] slonik cluster creation question
In-Reply-To: <8d89ea1d0712111352s192edb29r198a1b513507118@mail.gmail.com>
	(Josh Harrison's message of "Tue, 11 Dec 2007 16:52:34 -0500")
References: <8d89ea1d0712111352s192edb29r198a1b513507118@mail.gmail.com>
Message-ID: <60k5nkc2jn.fsf@dba2.int.libertyrms.com>

"Josh Harrison" <joshques@gmail.com> writes:
> Hi
> Im a newbie to slony.
> I installed slony and im trying tis example given in this website.
> http://www.linuxjournal.com/article/7834
> I created the databases as mentioned and the website says...
> "? Once the databases are created, we are ready to create our database cluster containing a master and a single slave. Create the Slonik cluster_setup.sh script
> and execute it. "
> My question is
> Where should I create this Slonik cluster_setup.sh script and how to execute it?

As long as you have PATH defined to have psql/slon/slonik in it, it
doesn't much matter where you create the script.

In practice, we have found it a useful thing to create a directory
structure somewhere on our systems to organize the scripts used for
various system maintenances, so that we might have:

mkdir -p $HOME/slony/2007-10-03-create-cluster-foo
mkdir -p $HOME/slony/2007-10-06-create-cluster-bar
mkdir -p $HOME/slony/2007-11-15-upgrade-cluster-bar
mkdir -p $HOME/slony/2007-12-10-failover-cluster-foo

where each of those directories has scripts relevant to the activity
in it.

In our environment, we often use the RT/3 ticketing system to manage
these procedures, so the directory name might contain a ticket number
to make it easy to crossreference between files and tickets.

It's really a matter of organizing work activity; Slony-I doesn't
force you into any of this.
-- 
(format nil "~S@~S" "cbbrowne" "cbbrowne.com")
http://www3.sympatico.ca/cbbrowne/linuxxian.html
"If all you can see is  vast masses of end-users chewing their cud and
running Win95  on Gateways, then what good  is platform independence?"
-- David LeBlanc (dleblanc@mindspring.com)
From joshques at gmail.com  Tue Dec 11 14:07:59 2007
From: joshques at gmail.com (Josh Harrison)
Date: Tue Dec 11 14:08:08 2007
Subject: [Slony1-general] slonik cluster creation question
In-Reply-To: <60k5nkc2jn.fsf@dba2.int.libertyrms.com>
References: <8d89ea1d0712111352s192edb29r198a1b513507118@mail.gmail.com>
	<60k5nkc2jn.fsf@dba2.int.libertyrms.com>
Message-ID: <8d89ea1d0712111407s2bf6b3a7ub5f144db25aea077@mail.gmail.com>

Thanks


> > Hi
> > Im a newbie to slony.
> > I installed slony and im trying tis example given in this website.
> > http://www.linuxjournal.com/article/7834
> > I created the databases as mentioned and the website says...
> > " Once the databases are created, we are ready to create our database
> cluster containing a master and a single slave. Create the Slonik
> cluster_setup.sh script
> > and execute it. "
> > My question is
> > Where should I create this Slonik cluster_setup.sh script and how to
> execute it?
>
> As long as you have PATH defined to have psql/slon/slonik in it, it
> doesn't much matter where you create the script.
>
> In practice, we have found it a useful thing to create a directory
> structure somewhere on our systems to organize the scripts used for
> various system maintenances, so that we might have:
>
> mkdir -p $HOME/slony/2007-10-03-create-cluster-foo
> mkdir -p $HOME/slony/2007-10-06-create-cluster-bar
> mkdir -p $HOME/slony/2007-11-15-upgrade-cluster-bar
> mkdir -p $HOME/slony/2007-12-10-failover-cluster-foo
>
> where each of those directories has scripts relevant to the activity
> in it.
>
> In our environment, we often use the RT/3 ticketing system to manage
> these procedures, so the directory name might contain a ticket number
> to make it easy to crossreference between files and tickets.
>
> It's really a matter of organizing work activity; Slony-I doesn't
> force you into any of this.
> -

How do you execute these scripts? Does slony automatically takes these
scripts when you run the slon?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071211/=
018b6207/attachment.htm
From joshques at gmail.com  Tue Dec 11 18:13:38 2007
From: joshques at gmail.com (Josh Harrison)
Date: Tue Dec 11 18:13:49 2007
Subject: [Slony1-general] slonik cluster creation question
In-Reply-To: <8d89ea1d0712111407s2bf6b3a7ub5f144db25aea077@mail.gmail.com>
References: <8d89ea1d0712111352s192edb29r198a1b513507118@mail.gmail.com>
	<60k5nkc2jn.fsf@dba2.int.libertyrms.com>
	<8d89ea1d0712111407s2bf6b3a7ub5f144db25aea077@mail.gmail.com>
Message-ID: <8d89ea1d0712111813u50435363va3d038eb51ba7e2b@mail.gmail.com>

Is there any special commands that should be used to execute the slonik
scripts?
What is slon_tools.conf. Should this be configured for using slony1?
thanks
josh

On Dec 11, 2007 5:07 PM, Josh Harrison <joshques@gmail.com> wrote:

> Thanks
>
>
>
> > > Hi
> > > Im a newbie to slony.
> > > I installed slony and im trying tis example given in this website.
> > > http://www.linuxjournal.com/article/7834
> > > I created the databases as mentioned and the website says...
> > > " Once the databases are created, we are ready to create our database
> > cluster containing a master and a single slave. Create the Slonik
> > cluster_setup.sh script
> > > and execute it. "
> > > My question is
> > > Where should I create this Slonik cluster_setup.sh script and how to
> > execute it?
> >
> > As long as you have PATH defined to have psql/slon/slonik in it, it
> > doesn't much matter where you create the script.
> >
> > In practice, we have found it a useful thing to create a directory
> > structure somewhere on our systems to organize the scripts used for
> > various system maintenances, so that we might have:
> >
> > mkdir -p $HOME/slony/2007-10-03-create-cluster-foo
> > mkdir -p $HOME/slony/2007-10-06-create-cluster-bar
> > mkdir -p $HOME/slony/2007-11-15-upgrade-cluster-bar
> > mkdir -p $HOME/slony/2007-12-10-failover-cluster-foo
> >
> > where each of those directories has scripts relevant to the activity
> > in it.
> >
> > In our environment, we often use the RT/3 ticketing system to manage
> > these procedures, so the directory name might contain a ticket number
> > to make it easy to crossreference between files and tickets.
> >
> > It's really a matter of organizing work activity; Slony-I doesn't
> > force you into any of this.
> > -
>
> How do you execute these scripts? Does slony automatically takes these
> scripts when you run the slon?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071211/=
8e14bce0/attachment-0001.htm
From joshques at gmail.com  Tue Dec 11 18:16:01 2007
From: joshques at gmail.com (Josh Harrison)
Date: Tue Dec 11 18:16:14 2007
Subject: [Slony1-general] postgres version upgrade question
In-Reply-To: <20071211193701.GP27409@crankycanuck.ca>
References: <8d89ea1d0712100954i7b136356hd639e05ba2ac3709@mail.gmail.com>
	<8d89ea1d0712101053g683bf7e8hb717f3e16a2063c9@mail.gmail.com>
	<8d89ea1d0712110658u18fe2496s80b4dd8595b44c5f@mail.gmail.com>
	<20071211154613.GA27409@crankycanuck.ca>
	<8d89ea1d0712110802r7b86c47am977363b02ef3107e@mail.gmail.com>
	<20071211160534.GB27409@crankycanuck.ca>
	<8d89ea1d0712110824h51c22272je34127d4f743527d@mail.gmail.com>
	<20071211163517.GF27409@crankycanuck.ca>
	<8d89ea1d0712111111r17c66cadod16dfdebf3efedda@mail.gmail.com>
	<20071211193701.GP27409@crankycanuck.ca>
Message-ID: <8d89ea1d0712111816r1fd40b44lef83bbcf5b0caf8b@mail.gmail.com>

I installed postgres8.2.5 and slony1 compiled fine with this version. Thanks
for your help
josh

On Dec 11, 2007 2:37 PM, Andrew Sullivan <ajs@crankycanuck.ca> wrote:

> On Tue, Dec 11, 2007 at 02:11:13PM -0500, Josh Harrison wrote:
> >
> >  I tried the stable release from this website...configured it with
>
> No, that's exactly what I've been trying to make clear.  I think the
> stable
> tarball needs something that's been added in the CVS stable tree in order
> to
> work properly with 8.3.  The RELEASE file in CVS says this:
>
> RELEASE 1.2.13
> - Fixed problem with compatibility with PostgreSQL 8.3; function
>  typenameTypeId() has 3 arguments as of 8.3.
>
> But since I don't see .13 available tarballed up on the site, I'm assuming
> you're getting .12.  I presume we'll need a release of Slony for 8.3
> compatibility shortly after 8.3 is released (or just before); but since
> it's
> in beta, we're relying on people getting the code from CVS.
>
> The following should work:
>
> CVSROOT=3D":pserver:anonymous@main.slony.info:/slony1" cvs login
> CVSROOT=3D":pserver:anonymous@main.slony.info:/slony1" cvs co -r
> REL_1_2_STABLE slony1-engine
>
> Whether this will solve your problem, I don't know, but AFAIK you won't be
> able to get the .12 version to work with 8.3 betas.
>
> A
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071211/=
c57f68bd/attachment.htm
From joshques at gmail.com  Wed Dec 12 07:13:25 2007
From: joshques at gmail.com (Josh Harrison)
Date: Wed Dec 12 07:13:29 2007
Subject: [Slony1-general] slonik cluster creation question
In-Reply-To: <3374895062-1160@e4ward.com>
References: <8d89ea1d0712111352s192edb29r198a1b513507118@mail.gmail.com>
	<60k5nkc2jn.fsf@dba2.int.libertyrms.com>
	<8d89ea1d0712111407s2bf6b3a7ub5f144db25aea077@mail.gmail.com>
	<3374860425-830@b.e4ward.com> <3374895062-1160@e4ward.com>
Message-ID: <8d89ea1d0712120713h1ab2da15g1483ff9897eb9337@mail.gmail.com>

On Dec 12, 2007 6:50 AM, <postgres@dac.e4ward.com> wrote:

> On Dec 12, 2007 12:13 AM, Josh Harrison <joshques@gmail.com> wrote:
> > Is there any special commands that should be used to execute the slonik
> > scripts?
> > What is slon_tools.conf. Should this be configured for using slony1?
> > thanks
> > josh
>
> You should read slony's documentation [1]. But this particular
> question can be answered by reading about the altperl administrative
> scripts [2].
>
> [1] http://www.slony.info/documentation/
> [2] http://www.slony.info/documentation/adminscripts.html
>
>
Thanks
I rad the above manual and tried to replicate the database as given in
this... http://www.slony.info/documentation/firstdb.html

These are the steps that I did.
1. set the shell variables like clustername,masterdbname etc thro export
command
2. created a user 'josh' with 'somepassword'
3. createdb -O $PGBENCHUSER -h $MASTERHOST $MASTERDBNAME
    createdb -O $PGBENCHUSER -h $SLAVEHOST $SLAVEDBNAME
    pgbench -i -s 1 -U $PGBENCHUSER -h $MASTERHOST $MASTERDBNAME
4.createlang -h $MASTERHOST plpgsql $MASTERDBNAME
5.pg_dump -s -U $REPLICATIONUSER -h $MASTERHOST $MASTERDBNAME | psql -U
$REPLICATIONUSER -h $SLAVEHOST $SLAVEDBNAME
6. pgbench -s 1 -c 5 -t 1000 -U $PGBENCHUSER -h $MASTERHOST $MASTERDBNAME

7. slony1 was configured using --perltools option. I copied
slon_tools.conf-sample to slon_tools.conf and placed it in the /etc dir.
This is my conf file (deleted the commented lines here for clarity)

-------------------------------------------------------------
if ($ENV{"SLONYNODES"}) {
    require $ENV{"SLONYNODES"};
} else {

    $CLUSTER_NAME =3D 'slony_example';
    $LOGDIR =3D 'export/home/sjothirajah/slony1';
    # $APACHE_ROTATOR =3D '/usr/local/apache/bin/rotatelogs';
    # SYNC check interval (slon -s option)
    # $SYNC_CHECK_INTERVAL =3D 1000;
    $MASTERNODE =3D 1;
    add_node(node     =3D> 1,
             host     =3D> 'localhost',
             dbname   =3D> 'pgbench',
             port     =3D> 5432,
             user     =3D> 'josh',
             password =3D> 'somepassword');

    add_node(node     =3D> 2,
             host     =3D> 'localhost',
             dbname   =3D> 'pgbenchslave',
             port     =3D> 5432,
             user     =3D> 'josh',
             password =3D> 'somepassword');
}
$SLONY_SETS =3D {
    "set1" =3D> {
        "set_id" =3D> 1,
        "table_id"    =3D> 1,
        "sequence_id" =3D> 1,
        "pkeyedtables" =3D> [
                          'accounts',
                          'tellers',
                          'branches',
                          ],
        "serialtables" =3D> ["history"],
    },
};
if ($ENV{"SLONYSET"}) {
    require $ENV{"SLONYSET"};
}
1;
--------------------------------------------------------------

8. slonik_init_cluster | slonik
<stdin>:10: Set up replication nodes
<stdin>:13: Next: configure paths for each node/origin
<stdin>:16: Replication nodes prepared
<stdin>:17: Please start a slon replication daemon for each node

9. slon_start 1
......
Slon successfully started for cluster slony_example, node node1
Start the watchdog process as well...

10.slon_start 2
...
Slon successfully started for cluster slony_example, node node2
PID [16697]
Start the watchdog process as well...

11. slonik_create_set 1
cluster name =3D slony_example;
 ....
.....
  echo 'All tables added';

12. slonik_subscribe_set 1  2 | slonik
<stdin>:4: PGRES_FATAL_ERROR select "_slony_example".subscribeSet(1, 1, 2,
't');  - ERROR:  Slony-I: subscribeSet(): set 1 not found

What is this error? What am I doing wrong here? When i check the
pgbenchslave  database, the table rows are not replicated?
Please advice
Thanks
josh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071212/=
2dc1ef81/attachment.htm
From lists at serioustechnology.com  Wed Dec 12 08:38:34 2007
From: lists at serioustechnology.com (Geoffrey)
Date: Wed Dec 12 08:38:42 2007
Subject: [Slony1-general] shortcut for telling slony to simply replicate
	everything?
Message-ID: <47600E8A.7070802@serioustechnology.com>

Is there a shortcut to tell slony to simply replicate a whole database 
without having to configure it for each table?

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From joshques at gmail.com  Wed Dec 12 08:59:47 2007
From: joshques at gmail.com (Josh Harrison)
Date: Wed Dec 12 08:59:52 2007
Subject: [Slony1-general] Slony-I: subscribeSet(): set 1 not found ERROR
Message-ID: <8d89ea1d0712120859g516bbf66sc90d790eb7e106c3@mail.gmail.com>

Hi,
Im trying slony for the first time....
Slon is running in both master and slave. For replication I execute this
script

#!/bin/sh
    slonik <<_EOF_
    	 # ----
    	 # This defines which namespace the replication system uses
    	 # ----
    	 cluster name =3D $CLUSTERNAME;

    	 # ----
    	 # Admin conninfo's are used by the slonik program to connect
    	 # to the node databases.  So these are the PQconnectdb arguments
    	 # that connect from the administrators workstation (where
    	 # slonik is executed).
    	 # ----
    	 node 1 admin conninfo =3D 'dbname=3D$MASTERDBNAME host=3D$MASTERHOST
user=3D$REPLICATIONUSER';
    	 node 2 admin conninfo =3D 'dbname=3D$SLAVEDBNAME host=3D$SLAVEHOST
user=3D$REPLICATIONUSER';

    	 # ----
    	 # Node 2 subscribes set 1
    	 # ----
    	 subscribe set ( id =3D 1, provider =3D 1, receiver =3D 2, forward =3D=
 no);
    _EOF_

And when i run this script I get this error...
PGRES_FATAL_ERROR select "_slony_example".subscribeSet(1, 1, 2, 'f');  -
sERROR:  Slony-I: subscribeSet(): set 1 not found

What is wrong here?
Thanks
josh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071212/=
4cdcae34/attachment.htm
From ahodgson at simkin.ca  Wed Dec 12 09:06:49 2007
From: ahodgson at simkin.ca (Alan Hodgson)
Date: Wed Dec 12 09:06:40 2007
Subject: [Slony1-general] Slony-I: subscribeSet(): set 1 not found ERROR
In-Reply-To: <8d89ea1d0712120859g516bbf66sc90d790eb7e106c3@mail.gmail.com>
References: <8d89ea1d0712120859g516bbf66sc90d790eb7e106c3@mail.gmail.com>
Message-ID: <200712120906.49714@hal.medialogik.com>

On Wednesday 12 December 2007, "Josh Harrison" <joshques@gmail.com> wrote:
> And when i run this script I get this error...
> PGRES_FATAL_ERROR select "_slony_example".subscribeSet(1, 1, 2, 'f');  -
> sERROR:  Slony-I: subscribeSet(): set 1 not found

It appears you haven't created set 1.

-- 
An economist is an expert who will know tomorrow why the things he predicted
yesterday didn't happen today.

From joshques at gmail.com  Wed Dec 12 10:36:34 2007
From: joshques at gmail.com (Josh Harrison)
Date: Wed Dec 12 10:36:41 2007
Subject: [Slony1-general] Slony-I: subscribeSet(): set 1 not found ERROR
In-Reply-To: <200712120906.49714@hal.medialogik.com>
References: <8d89ea1d0712120859g516bbf66sc90d790eb7e106c3@mail.gmail.com>
	<200712120906.49714@hal.medialogik.com>
Message-ID: <8d89ea1d0712121036j71c803en974fdbeeb5df7882@mail.gmail.com>

On Dec 12, 2007 12:06 PM, Alan Hodgson <ahodgson@simkin.ca> wrote:

> On Wednesday 12 December 2007, "Josh Harrison" <joshques@gmail.com> wrote:
> > And when i run this script I get this error...
> > PGRES_FATAL_ERROR select "_slony_example".subscribeSet(1, 1, 2, 'f');  -
> > sERROR:  Slony-I: subscribeSet(): set 1 not found
>
> It appears you haven't created set 1.
>

You are right...
I got it to work now. This is the link that Im trying now
http://slony.info/adminguide/slony1-1.2.6/doc/adminguide/firstdb.html

It replicates the tables that have their own primary key.
But for those ones that donot have their own PK(table 'history' in the above
given link) and needs a serial key to be generated by Slony, it doesnt
replicate the data. Why?

Also when it has to generate its own PK, does it add an extra column to the
table ? For example it has added an extra_column called
_Slony-I_slony_example_rowID to the master and slave database's 'history'
table.  Can you avoid this?

Thanks
josh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071212/=
2d48f482/attachment-0001.htm
From lists at serioustechnology.com  Wed Dec 12 11:22:58 2007
From: lists at serioustechnology.com (Geoffrey)
Date: Wed Dec 12 11:23:07 2007
Subject: [Slony1-general] shortcut for telling slony to simply replicate
	everything?
In-Reply-To: <F1B0F9305B343E43A1C3EECE48B853D501A83F45@CITGSNA01SXCH02.ana.firstamdata.com>
References: <47600E8A.7070802@serioustechnology.com>
	<F1B0F9305B343E43A1C3EECE48B853D501A83F45@CITGSNA01SXCH02.ana.firstamdata.com>
Message-ID: <47603512.1070804@serioustechnology.com>

Tomeh, Husam wrote:
> As Slony is a triggered-based replication solution, replication occurs
> at the table level, and thus each table has to be Slony-configured. 

I was afraid that would be the answer, thanks.

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From ajs at crankycanuck.ca  Wed Dec 12 11:31:51 2007
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Wed Dec 12 11:32:06 2007
Subject: [Slony1-general] shortcut for telling slony to simply replicate
	everything?
In-Reply-To: <47603512.1070804@serioustechnology.com>
References: <47600E8A.7070802@serioustechnology.com>
	<F1B0F9305B343E43A1C3EECE48B853D501A83F45@CITGSNA01SXCH02.ana.firstamdata.com>
	<47603512.1070804@serioustechnology.com>
Message-ID: <20071212193151.GK31954@crankycanuck.ca>

On Wed, Dec 12, 2007 at 02:22:58PM -0500, Geoffrey wrote:
> 
> I was afraid that would be the answer, thanks.

This is an easy script to write, though.  You can get every table name out
of postgres quite easily.

A

From lists at serioustechnology.com  Wed Dec 12 11:36:19 2007
From: lists at serioustechnology.com (Geoffrey)
Date: Wed Dec 12 11:36:27 2007
Subject: [Slony1-general] compile errors
Message-ID: <47603833.1080802@serioustechnology.com>

I'm trying to recompile slony on a machine and I keep getting the 
following errors:

xxid.c:18:25: access/xact.h: No such file or directory
xxid.c:19:28: access/transam.h: No such file or directory
xxid.c:20:26: executor/spi.h: No such file or directory

They do exist:

/usr/include/pgsql/server/access/xact.h
/usr/include/pgsql/server/access/transam.h
/usr/include/pgsql/server/access/spi.h

I'm following the same installation steps I performed on another node 
and it worked fine:

./configure --with-pgconfigdir=/usr/local/pgsql/bin/pg_config
make

Anyone point out my problem?

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From lists at serioustechnology.com  Wed Dec 12 11:56:09 2007
From: lists at serioustechnology.com (Geoffrey)
Date: Wed Dec 12 11:56:17 2007
Subject: [Slony1-general] shortcut for telling slony to simply replicate
	everything?
In-Reply-To: <20071212193151.GK31954@crankycanuck.ca>
References: <47600E8A.7070802@serioustechnology.com>	<F1B0F9305B343E43A1C3EECE48B853D501A83F45@CITGSNA01SXCH02.ana.firstamdata.com>	<47603512.1070804@serioustechnology.com>
	<20071212193151.GK31954@crankycanuck.ca>
Message-ID: <47603CD9.6030105@serioustechnology.com>

Andrew Sullivan wrote:
> On Wed, Dec 12, 2007 at 02:22:58PM -0500, Geoffrey wrote:
>> I was afraid that would be the answer, thanks.
> 
> This is an easy script to write, though.  You can get every table name out
> of postgres quite easily.

Yeah, I can script, I'm just lazy. ;)  As a matter of fact, it's done.

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From lists at serioustechnology.com  Wed Dec 12 12:19:40 2007
From: lists at serioustechnology.com (Geoffrey)
Date: Wed Dec 12 12:19:49 2007
Subject: [Slony1-general] compile errors
In-Reply-To: <47603833.1080802@serioustechnology.com>
References: <47603833.1080802@serioustechnology.com>
Message-ID: <4760425C.2030206@serioustechnology.com>

Geoffrey wrote:
> I'm trying to recompile slony on a machine and I keep getting the 
> following errors:

Please ignore this wasted bandwidth.  I figured it out, I was setting 
--with-pgconfigdir= incorrectly.

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From lists at serioustechnology.com  Wed Dec 12 12:21:04 2007
From: lists at serioustechnology.com (Geoffrey)
Date: Wed Dec 12 12:21:13 2007
Subject: [Slony1-general] config question
Message-ID: <476042B0.7070506@serioustechnology.com>

We have a single master that will be replicated to a single slave.  In 
this configuration are the slon_tools.conf files identical?

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From drees76 at gmail.com  Wed Dec 12 12:26:54 2007
From: drees76 at gmail.com (David Rees)
Date: Wed Dec 12 12:27:01 2007
Subject: [Slony1-general] config question
In-Reply-To: <476042B0.7070506@serioustechnology.com>
References: <476042B0.7070506@serioustechnology.com>
Message-ID: <72dbd3150712121226p69f6862bpb812113649f4cf58@mail.gmail.com>

On Dec 12, 2007 12:21 PM, Geoffrey <lists@serioustechnology.com> wrote:
> We have a single master that will be replicated to a single slave.  In
> this configuration are the slon_tools.conf files identical?

Yes, they will be identical.

-Dave
From lists at serioustechnology.com  Wed Dec 12 12:50:30 2007
From: lists at serioustechnology.com (Geoffrey)
Date: Wed Dec 12 12:50:40 2007
Subject: [Slony1-general] cluster initialization
Message-ID: <47604996.9080901@serioustechnology.com>

I attempted to initialize my cluster, but it failed because of 
connectivity issues.  After resolving that issue, I attempted to 
initialize the cluster again but I get the error:

<stdin>:6: Error: namespace "_esc_cluster" already exists in database of 
node 1
<stdin>:6: ERROR: no admin conninfo for node 157905168

Does this indicate the cluster was partially created the first time?

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From lists at serioustechnology.com  Wed Dec 12 17:24:44 2007
From: lists at serioustechnology.com (Geoffrey)
Date: Wed Dec 12 17:24:57 2007
Subject: [Slony1-general] error in docs?
Message-ID: <476089DC.2010506@serioustechnology.com>

I'm making progress here, but seems I may have found an error in the 
docs.  From:  http://slony.info/documentation/firstdb.html

I see the following:

# subscribe set to second node (1= set ID, 2= node ID)
$ slonik_subscribe_set  2 | slonik


slonik_subscribe_set complains thusly:

/usr/local/etc> slonik_subscribe_set 2|slonik
Usage: subscribe_set [--config file] set# node#

     Begins replicating a set to the specified node.

<stdin>:1: ERROR: syntax error at or near Need


So I'm assuming that it's expecting two arguments as in the comment above?


slonik_subscribe_set 1 2 | slonik

But that yields the following:

<stdin>:4: PGRES_FATAL_ERROR select "_esc_cluster".subscribeSet(1, 1, 2, 
't'); - ERROR:  insert or update on table "sl_path" violates foreign key 
constraint "pa_client-no_id-ref"l/etc> slonik_subscribe_set 1m2|slonik
DETAIL:  Key (pa_client)=(2) is not present in table "sl_node".

I'm not exactly sure where to go from here...


-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From lists at serioustechnology.com  Wed Dec 12 17:30:31 2007
From: lists at serioustechnology.com (Geoffrey)
Date: Wed Dec 12 17:30:49 2007
Subject: [Slony1-general] confusion over where to initialize and start
	processes
Message-ID: <47608B37.7090605@serioustechnology.com>

Again, looking at the docs.  It's not clear where these processes are 
supposed to be run from.  Taking the basic scenario with a single master 
and one node, where do I run the following:

# Initialize cluster:
$ slonik_init_cluster  | slonik

# Start slon  (here 1 and 2 are node numbers)
$ slon_start 1
$ slon_start 2

# Create Sets (here 1 is a set number)
$ slonik_create_set 1

# subscribe set to second node (1= set ID, 2= node ID)
$ slonik_subscribe_set  2 | slonik

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From lists at serioustechnology.com  Wed Dec 12 17:57:10 2007
From: lists at serioustechnology.com (Geoffrey)
Date: Wed Dec 12 17:57:22 2007
Subject: [Slony1-general] log error
Message-ID: <47609176.6090302@serioustechnology.com>

Sorry for the shotgun blasts of messages.

I'm checking the logs for my node2 and I see the following:

2007-12-12 20:44:32 EST FATAL  main: Cannot connect to local database - 
could not connect to server: D\uffff\uffff\uffffPVW
         Is the server running on host "earth" and accepting
         TCP/IP connections on port 5443?

Now I'm all too familiar with this error from working with Postgres. 
What I think is going on is that when it tries to connect to the 
database running on the local machine, it's passing the host parameter 
and failing to connect.  I can duplicate this issue with psql command line.

Problem is, I've tried setting the value to localhost, 127.0.0.1 and to 
a null string, but none of this works.

What should the host value be in the conf file for starting a slon 
process on the local machine?

I guess I could simply start that slon process on the other node, but 
that doesn't make a lot of sense.


-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From joshques at gmail.com  Wed Dec 12 18:10:28 2007
From: joshques at gmail.com (Josh Harrison)
Date: Wed Dec 12 18:10:38 2007
Subject: [Slony1-general] log error
In-Reply-To: <47609176.6090302@serioustechnology.com>
References: <47609176.6090302@serioustechnology.com>
Message-ID: <8d89ea1d0712121810g484e159bq49dd661b70a10909@mail.gmail.com>

If both the master and slave are in the same machine then set both to
localhost. If they  r in different machines then set it to their ip address.
josh

On Dec 12, 2007 8:57 PM, Geoffrey <lists@serioustechnology.com> wrote:

> Sorry for the shotgun blasts of messages.
>
> I'm checking the logs for my node2 and I see the following:
>
> 2007-12-12 20:44:32 EST FATAL  main: Cannot connect to local database -
> could not connect to server: D\uffff\uffff\uffffPVW
>         Is the server running on host "earth" and accepting
>         TCP/IP connections on port 5443?
>
> Now I'm all too familiar with this error from working with Postgres.
> What I think is going on is that when it tries to connect to the
> database running on the local machine, it's passing the host parameter
> and failing to connect.  I can duplicate this issue with psql command
> line.
>
> Problem is, I've tried setting the value to localhost, 127.0.0.1 and to
> a null string, but none of this works.
>
> What should the host value be in the conf file for starting a slon
> process on the local machine?
>
> I guess I could simply start that slon process on the other node, but
> that doesn't make a lot of sense.
>
>
> --
> Until later, Geoffrey
>
> Those who would give up essential Liberty, to purchase a little
> temporary Safety, deserve neither Liberty nor Safety.
>  - Benjamin Franklin
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071212/=
ed1dbdef/attachment.htm
From joshques at gmail.com  Wed Dec 12 18:14:04 2007
From: joshques at gmail.com (Josh Harrison)
Date: Wed Dec 12 18:14:15 2007
Subject: [Slony1-general] confusion over where to initialize and start
	processes
In-Reply-To: <47608B37.7090605@serioustechnology.com>
References: <47608B37.7090605@serioustechnology.com>
Message-ID: <8d89ea1d0712121814iff8761bx1c9dd54d9b0755d7@mail.gmail.com>

> Again, looking at the docs.  It's not clear where these processes are
> supposed to be run from.  Taking the basic scenario with a single master
> and one node, where do I run the following:
>
> # Initialize cluster:
> $ slonik_init_cluster  | slonik

Fire this at the master node

>
>
> # Start slon  (here 1 and 2 are node numbers)
> $ slon_start 1

At master

>
> $ slon_start 2

At slave node
If both your master and slave are in the same machine then fire them at the
same machine.

>
>
> # Create Sets (here 1 is a set number)
> $ slonik_create_set 1

At the master node

>
>
> # subscribe set to second node (1=3D set ID, 2=3D node ID)
> $ slonik_subscribe_set  2 | slonik

At the slave node

josh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071212/=
b33c8b67/attachment.htm
From marcus.gustafsson at visionten.net  Thu Dec 13 00:17:05 2007
From: marcus.gustafsson at visionten.net (Marcus Gustafsson)
Date: Thu Dec 13 00:17:27 2007
Subject: [Slony1-general] More debugging?
In-Reply-To: <475E6B90.3010200@visionten.net>
References: <475E6B90.3010200@visionten.net>
Message-ID: <4760EA81.5070701@visionten.net>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi again.

I've managed to figure out where it breaks now. It seems there is a bug
when you have the archive directory enabled and remote_worker.c tries to
log the "delete from %s;copy %s %s from stdin;" query on line 2883.
The archive_fp pointer which should contain the file pointer for the
archive log is NULL which terminates the thread.

I did (of course after finding exactly where it breaks) find the note
that the log shipping code didn't become stable until 1.2.11 which
explains why it wasn't fixed in the slony I was using.
As I won't actually be needing the log shipping function I'll just turn
it off for now, but hopefully this answer might be of help of someone else.

Regards,
 Marcus

Marcus Gustafsson skrev:
> Hi guys!
> 
> We are running a cluster of 2 (soon to be three) servers using
> slony1-1.1.5-1 with PostgreSQL 8.1.9.
> I have run in to a problem when trying to add the third node though.
> To create the new node I did:
> 
> * Extracted the database schema using slony1_extract_schema.sh (on the
>   master)
> * Created the database and all users involved on the new node
> * Installed the schema extracted in the first step
> * Ran slonik manually to initialize the node (store
>   node(id=3,comment='Second slave')
> * Started a local slon process checking the logs that it attached
> * Ran slonik manually to add the new storage paths (a bunch of
>   store path (...)
> * Noticed that syncs started to appear in the slon log (although not
>   acted upon as I yet had to subscribe the node)
> * Ran slonik manually to subscribe the new node (subscribe set
>   (id=1,provider=1,receiver=3,forward=yes))
> 
> After this I noticed that slon started to copy data (as intended) for
> each of the tables, but it never actually managed to start as it breaks
> on the first table:
> 
> <snip>a lot of prepare to copy and successfull copying of sequences</snip>
> 
> 2007-12-11 04:23:12 CST DEBUG2 remoteWorkerThread_1: copy table
> "public"."fb_fy_account_history"
> 2007-12-11 04:23:12 CST DEBUG3 remoteWorkerThread_1: table
> "public"."fb_fy_account_history" does not require Slony-I serial key
> 2007-12-11 04:23:12 CST DEBUG2 remoteWorkerThread_1: Begin COPY of table
> "public"."fb_fy_account_history"
> NOTICE:  truncate of "public"."fb_fy_account_history" succeeded
> 2007-12-11 04:23:12 CST DEBUG1 slon: done
> 2007-12-11 04:23:12 CST DEBUG2 slon: remove pid file
> 2007-12-11 04:23:12 CST DEBUG2 slon: exit(0)
> 
> 
> This is with debug level set to 4.
> From searching on the web it seems that something breaks when slon tries
> to insert the data in the new tables, but how can I figure out where it
> breaks? Are there any higher debug levels or any smart tricks to figure
> out why and where the copying breaks?
> 
> Regards,
>  Marcus

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.5 (MingW32)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFHYOqBzYC0ZmFVS9sRAvo3AJ0UtiNb3I81U1ZxfX28dujmshwcDACdH6ks
XsXh05EM5ATHgS0lm05sM7o=
=gZ0t
-----END PGP SIGNATURE-----
From joshques at gmail.com  Thu Dec 13 04:39:39 2007
From: joshques at gmail.com (Josh Harrison)
Date: Thu Dec 13 04:39:58 2007
Subject: [Slony1-general] setAddTable_int error
Message-ID: <8d89ea1d0712130439u13467c9bi8d05228ae91e6856@mail.gmail.com>

Hi,
I tried the example in the slony1 documentation for replication (
http://slony.info/adminguide/slony1-1.2.6/doc/adminguide/firstdb.html). It
works fine. It replicated the data and when i check the log of the slave and
master it generates these error messages. What does this mean?
WARNING:  there is no transaction in progress
ERROR:  Slony-I: setAddTable_int: table id 1 has already been assigned!

Thanks josh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071213/=
e1557e43/attachment.htm
From cbbrowne at ca.afilias.info  Thu Dec 13 05:42:29 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Thu Dec 13 05:42:36 2007
Subject: [Slony1-general] cluster initialization
In-Reply-To: <47604996.9080901@serioustechnology.com> (Geoffrey's message of
	"Wed, 12 Dec 2007 15:50:30 -0500")
References: <47604996.9080901@serioustechnology.com>
Message-ID: <60y7by90e2.fsf@dba2.int.libertyrms.com>

Geoffrey <lists@serioustechnology.com> writes:
> I attempted to initialize my cluster, but it failed because of
> connectivity issues.  After resolving that issue, I attempted to
> initialize the cluster again but I get the error:
>
> <stdin>:6: Error: namespace "_esc_cluster" already exists in database
> of node 1
> <stdin>:6: ERROR: no admin conninfo for node 157905168
>
> Does this indicate the cluster was partially created the first time?

It should be complete, to a point...  Things happen in transactions,
so node initialization either all happens or none of it happens.

You may find things simpler if you run a little slonik script to
"UNINSTALL NODE" to clean it out and then start again.
-- 
select 'cbbrowne' || '@' || 'linuxdatabases.info';
http://www3.sympatico.ca/cbbrowne/lsf.html
Signs  of  a Klingon  Programmer  #10:  "You cannot  really appreciate
Dilbert unless you've read it in the original Klingon."
From cbbrowne at ca.afilias.info  Thu Dec 13 05:47:05 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Thu Dec 13 05:47:11 2007
Subject: [Slony1-general] confusion over where to initialize and start
	processes
In-Reply-To: <47608B37.7090605@serioustechnology.com> (Geoffrey's message of
	"Wed, 12 Dec 2007 20:30:31 -0500")
References: <47608B37.7090605@serioustechnology.com>
Message-ID: <60tzmm906e.fsf@dba2.int.libertyrms.com>

Geoffrey <lists@serioustechnology.com> writes:
> Again, looking at the docs.  It's not clear where these processes are
> supposed to be run from.  Taking the basic scenario with a single
> master and one node, where do I run the following:
>
> # Initialize cluster:
> $ slonik_init_cluster  | slonik
>
> # Start slon  (here 1 and 2 are node numbers)
> $ slon_start 1
> $ slon_start 2
>
> # Create Sets (here 1 is a set number)
> $ slonik_create_set 1
>
> # subscribe set to second node (1= set ID, 2= node ID)
> $ slonik_subscribe_set  2 | slonik

You should be able to run these steps anywhere where you have Slony-I
software installed.

In some of our environments, we'd have *three* servers for this:
1.  Server where the database for node 1 resides
2.  Server where the database for node 2 resides
3.  Server where we intend to run slons.

In that case, we'd usually run *ALL* of this on the third server.

It's certainly simpler to run it all in one place.
-- 
let name="cbbrowne" and tld="ca.afilias.info" in String.concat "@" [name;tld];;
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
From cbbrowne at ca.afilias.info  Thu Dec 13 05:51:08 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Thu Dec 13 05:51:11 2007
Subject: [Slony1-general] log error
In-Reply-To: <47609176.6090302@serioustechnology.com> (Geoffrey's message of
	"Wed, 12 Dec 2007 20:57:10 -0500")
References: <47609176.6090302@serioustechnology.com>
Message-ID: <60prxa8zzn.fsf@dba2.int.libertyrms.com>

Geoffrey <lists@serioustechnology.com> writes:
> Sorry for the shotgun blasts of messages.
>
> I'm checking the logs for my node2 and I see the following:
>
> 2007-12-12 20:44:32 EST FATAL  main: Cannot connect to local database
> -
> could not connect to server: D\uffff\uffff\uffffPVW
>         Is the server running on host "earth" and accepting
>         TCP/IP connections on port 5443?
>
> Now I'm all too familiar with this error from working with
> Postgres. What I think is going on is that when it tries to connect to
> the database running on the local machine, it's passing the host
> parameter and failing to connect.  I can duplicate this issue with
> psql command line.
>
> Problem is, I've tried setting the value to localhost, 127.0.0.1 and
> to a null string, but none of this works.
>
> What should the host value be in the conf file for starting a slon
> process on the local machine?

I'd be inclined to use a host name that isn't supposed to change.
Definitely NOT localhost or anything that assumes locality.

I expect there is some sort of pg_hba.conf problem here; not quite
sure.

> I guess I could simply start that slon process on the other node, but
> that doesn't make a lot of sense.

No, "solving" the issue that way will leave you with the problem that
when the slon wants to talk to the 'other' node, it will encounter
this problem again, breaking replication.

So you need to solve this right.
-- 
output = ("cbbrowne" "@" "linuxdatabases.info")
http://linuxdatabases.info/info/rdbms.html
We  all live in  a yellow  subroutine, a  yellow subroutine,  a yellow
subroutine...
From joshques at gmail.com  Thu Dec 13 06:42:46 2007
From: joshques at gmail.com (Josh Harrison)
Date: Thu Dec 13 06:42:49 2007
Subject: [Slony1-general] shortcut for telling slony to simply replicate
	everything?
In-Reply-To: <47603CD9.6030105@serioustechnology.com>
References: <47600E8A.7070802@serioustechnology.com>
	<F1B0F9305B343E43A1C3EECE48B853D501A83F45@CITGSNA01SXCH02.ana.firstamdata.com>
	<47603512.1070804@serioustechnology.com>
	<20071212193151.GK31954@crankycanuck.ca>
	<47603CD9.6030105@serioustechnology.com>
Message-ID: <8d89ea1d0712130642i7ff17b80k7cb7553f48235752@mail.gmail.com>

>
>
> > On Wed, Dec 12, 2007 at 02:22:58PM -0500, Geoffrey wrote:
> >> I was afraid that would be the answer, thanks.
> >
> > This is an easy script to write, though.  You can get every table name
> out
> > of postgres quite easily.
>

How do you write this script? I have a database with 100 tables and i have
to replicate them all. And if tey dont have a PK then you have to generate a
slony serial key...right!!!!
josh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071213/=
8dad0662/attachment.htm
From cedric.villemain at dalibo.com  Thu Dec 13 06:58:16 2007
From: cedric.villemain at dalibo.com (=?ISO-8859-1?Q?C=E9dric_Villemain?=)
Date: Thu Dec 13 06:58:23 2007
Subject: [Slony1-general] shortcut for telling slony to simply replicate
	everything?
In-Reply-To: <8d89ea1d0712130642i7ff17b80k7cb7553f48235752@mail.gmail.com>
References: <47600E8A.7070802@serioustechnology.com>	<F1B0F9305B343E43A1C3EECE48B853D501A83F45@CITGSNA01SXCH02.ana.firstamdata.com>	<47603512.1070804@serioustechnology.com>	<20071212193151.GK31954@crankycanuck.ca>	<47603CD9.6030105@serioustechnology.com>
	<8d89ea1d0712130642i7ff17b80k7cb7553f48235752@mail.gmail.com>
Message-ID: <47614888.7070602@dalibo.com>

Josh Harrison a =E9crit :
>>     =

>>> On Wed, Dec 12, 2007 at 02:22:58PM -0500, Geoffrey wrote:
>>>       =

>>>> I was afraid that would be the answer, thanks.
>>>>         =

>>> This is an easy script to write, though.  You can get every table name
>>>       =

>> out
>>     =

>>> of postgres quite easily.
>>>       =

>
> How do you write this script? I have a database with 100 tables and i have
> to replicate them all. And if tey dont have a PK then you have to generat=
e a
> slony serial key...right!!!!
> josh
>
>   =


check the perltools.

> ------------------------------------------------------------------------
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>   =



-- =

C=E9dric Villemain
Administrateur de Base de Donn=E9es
Cel: +33 (0)6 74 15 56 53
http://dalibo.com - http://dalibo.org

-------------- next part --------------
A non-text attachment was scrubbed...
Name: cedric.villemain.vcf
Type: text/x-vcard
Size: 266 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20071213=
/3dd13e98/cedric.villemain.vcf
From lists at serioustechnology.com  Thu Dec 13 06:58:31 2007
From: lists at serioustechnology.com (Geoffrey)
Date: Thu Dec 13 06:58:39 2007
Subject: [Slony1-general] shortcut for telling slony to simply replicate
	everything?
In-Reply-To: <8d89ea1d0712130642i7ff17b80k7cb7553f48235752@mail.gmail.com>
References: <47600E8A.7070802@serioustechnology.com>	
	<F1B0F9305B343E43A1C3EECE48B853D501A83F45@CITGSNA01SXCH02.ana.firstamdata.com>	
	<47603512.1070804@serioustechnology.com>	
	<20071212193151.GK31954@crankycanuck.ca>	
	<47603CD9.6030105@serioustechnology.com>
	<8d89ea1d0712130642i7ff17b80k7cb7553f48235752@mail.gmail.com>
Message-ID: <47614897.7010705@serioustechnology.com>

Josh Harrison wrote:
>>
>>> On Wed, Dec 12, 2007 at 02:22:58PM -0500, Geoffrey wrote:
>>>> I was afraid that would be the answer, thanks.
>>> This is an easy script to write, though.  You can get every table name
>> out
>>> of postgres quite easily.
> 
> How do you write this script? I have a database with 100 tables and i have
> to replicate them all. And if tey dont have a PK then you have to generate a
> slony serial key...right!!!!
> josh


All of my tables have PK, so that's not a problem for me.  All I had to 
do was produce a common separated list of the tables and then import 
that into the slon_tools.conf file:

echo '\d' |psql -t -p 5443 swr|
	awk -F'|' '/ table /{gsub(" ", "", $2);printf "%s,\n", $2}'

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From lists at serioustechnology.com  Thu Dec 13 07:08:11 2007
From: lists at serioustechnology.com (Geoffrey)
Date: Thu Dec 13 07:08:18 2007
Subject: [Slony1-general] log error
In-Reply-To: <60prxa8zzn.fsf@dba2.int.libertyrms.com>
References: <47609176.6090302@serioustechnology.com>
	<60prxa8zzn.fsf@dba2.int.libertyrms.com>
Message-ID: <47614ADB.7040109@serioustechnology.com>

Christopher Browne wrote:
> Geoffrey <lists@serioustechnology.com> writes:
>> Sorry for the shotgun blasts of messages.
>>
>> I'm checking the logs for my node2 and I see the following:
>>
>> 2007-12-12 20:44:32 EST FATAL  main: Cannot connect to local database
>> -
>> could not connect to server: D\uffff\uffff\uffffPVW
>>         Is the server running on host "earth" and accepting
>>         TCP/IP connections on port 5443?
>>
>> Now I'm all too familiar with this error from working with
>> Postgres. What I think is going on is that when it tries to connect to
>> the database running on the local machine, it's passing the host
>> parameter and failing to connect.  I can duplicate this issue with
>> psql command line.
>>
>> Problem is, I've tried setting the value to localhost, 127.0.0.1 and
>> to a null string, but none of this works.
>>
>> What should the host value be in the conf file for starting a slon
>> process on the local machine?
> 
> I'd be inclined to use a host name that isn't supposed to change.
> Definitely NOT localhost or anything that assumes locality.
> 
> I expect there is some sort of pg_hba.conf problem here; not quite
> sure.

That was part of it.  I forgot to turn on 'tcpip_socket = true' as well 
as permitting connectivity on my subnet.

There was still an issue of the host name.  I've resolved this issue by 
placing the IP address of the machine into the field.  For some reason 
it has a problem connecting to the database on the same machine when I 
specify the host name.

For now, that get's me past that issue.  Problem is, I get the following 
when attempt 'slon_start 2':

2007-12-13 10:04:43 EST ERROR  cannot get sl_local_node_id - ERROR: 
schema "_esc_cluster" does not exist 2007-12-13 10:04:43 EST FATAL 
main: Node is not initialized properly - sleep 10s

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From cbbrowne at ca.afilias.info  Thu Dec 13 07:41:37 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Thu Dec 13 07:41:42 2007
Subject: [Slony1-general] log error
In-Reply-To: <47614ADB.7040109@serioustechnology.com> (Geoffrey's message of
	"Thu, 13 Dec 2007 10:08:11 -0500")
References: <47609176.6090302@serioustechnology.com>
	<60prxa8zzn.fsf@dba2.int.libertyrms.com>
	<47614ADB.7040109@serioustechnology.com>
Message-ID: <60fxy6bo0e.fsf@dba2.int.libertyrms.com>

Geoffrey <lists@serioustechnology.com> writes:
> For now, that get's me past that issue.  Problem is, I get the
> following when attempt 'slon_start 2':
>
> 2007-12-13 10:04:43 EST ERROR  cannot get sl_local_node_id - ERROR:
> schema "_esc_cluster" does not exist 2007-12-13 10:04:43 EST FATAL
> main: Node is not initialized properly - sleep 10s

Well, apparently the "store node" for node #2 didn't get done...
-- 
"cbbrowne","@","linuxdatabases.info"
http://www3.sympatico.ca/cbbrowne/multiplexor.html
"What  you end  up with,  after  running an  operating system  concept
through these  many marketing coffee filters, is  something not unlike
plain hot water."  -- Matt Welsh
From cbbrowne at ca.afilias.info  Thu Dec 13 07:44:05 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Thu Dec 13 07:44:08 2007
Subject: [Slony1-general] shortcut for telling slony to simply replicate
	everything?
In-Reply-To: <8d89ea1d0712130642i7ff17b80k7cb7553f48235752@mail.gmail.com>
	(Josh Harrison's message of "Thu, 13 Dec 2007 09:42:46 -0500")
References: <47600E8A.7070802@serioustechnology.com>
	<F1B0F9305B343E43A1C3EECE48B853D501A83F45@CITGSNA01SXCH02.ana.firstamdata.com>
	<47603512.1070804@serioustechnology.com>
	<20071212193151.GK31954@crankycanuck.ca>
	<47603CD9.6030105@serioustechnology.com>
	<8d89ea1d0712130642i7ff17b80k7cb7553f48235752@mail.gmail.com>
Message-ID: <60bq8ubnwa.fsf@dba2.int.libertyrms.com>

"Josh Harrison" <joshques@gmail.com> writes:
> How do you write this script? 

Well, you can grab the table names and schemas from
information_schema.tables; stow that somewhere, and use it as input to
one of the scripts for setting up tables for replication.

These days, I rather favor the script
"tools/configure-replication.sh"; it generates a very nice set of
slonik scripts for initializing a cluster.
-- 
select 'cbbrowne' || '@' || 'acm.org';
http://cbbrowne.com/info/spreadsheets.html
The people's revolutionary committee has  decided that the name "e" is
retrogressive, unmulticious   and reactionary, and  has  been flushed.
Please update your abbrevs.
From lists at serioustechnology.com  Thu Dec 13 07:58:56 2007
From: lists at serioustechnology.com (Geoffrey)
Date: Thu Dec 13 07:59:05 2007
Subject: [Slony1-general] log error
In-Reply-To: <60fxy6bo0e.fsf@dba2.int.libertyrms.com>
References: <47609176.6090302@serioustechnology.com>	<60prxa8zzn.fsf@dba2.int.libertyrms.com>	<47614ADB.7040109@serioustechnology.com>
	<60fxy6bo0e.fsf@dba2.int.libertyrms.com>
Message-ID: <476156C0.4080309@serioustechnology.com>

Christopher Browne wrote:
> Geoffrey <lists@serioustechnology.com> writes:
>> For now, that get's me past that issue.  Problem is, I get the
>> following when attempt 'slon_start 2':
>>
>> 2007-12-13 10:04:43 EST ERROR  cannot get sl_local_node_id - ERROR:
>> schema "_esc_cluster" does not exist 2007-12-13 10:04:43 EST FATAL
>> main: Node is not initialized properly - sleep 10s
> 
> Well, apparently the "store node" for node #2 didn't get done...

Is this possibly an environment issue?  Configuration problem?  I'm not 
sure what you mean by the 'store node.'


-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From joshques at gmail.com  Thu Dec 13 08:14:31 2007
From: joshques at gmail.com (Josh Harrison)
Date: Thu Dec 13 08:14:38 2007
Subject: [Slony1-general] shortcut for telling slony to simply replicate
	everything?
In-Reply-To: <47614897.7010705@serioustechnology.com>
References: <47600E8A.7070802@serioustechnology.com>
	<F1B0F9305B343E43A1C3EECE48B853D501A83F45@CITGSNA01SXCH02.ana.firstamdata.com>
	<47603512.1070804@serioustechnology.com>
	<20071212193151.GK31954@crankycanuck.ca>
	<47603CD9.6030105@serioustechnology.com>
	<8d89ea1d0712130642i7ff17b80k7cb7553f48235752@mail.gmail.com>
	<47614897.7010705@serioustechnology.com>
Message-ID: <8d89ea1d0712130814j1262e670tafaf1bd61271177@mail.gmail.com>

On Dec 13, 2007 9:58 AM, Geoffrey <lists@serioustechnology.com> wrote:

> Josh Harrison wrote:
> >>
> >>> On Wed, Dec 12, 2007 at 02:22:58PM -0500, Geoffrey wrote:
> >>>> I was afraid that would be the answer, thanks.
> >>> This is an easy script to write, though.  You can get every table name
> >> out
> >>> of postgres quite easily.
> >
> > How do you write this script? I have a database with 100 tables and i
> have
> > to replicate them all. And if tey dont have a PK then you have to
> generate a
> > slony serial key...right!!!!
> > josh
>
>
> All of my tables have PK, so that's not a problem for me.  All I had to
> do was produce a common separated list of the tables and then import
> that into the slon_tools.conf file:
>
> echo '\d' |psql -t -p 5443 swr|
>        awk -F'|' '/ table /{gsub(" ", "", $2);printf "%s,\n", $2}'



Thanks...I tried this
echo '\d' |psql -t -p 5432 bench_replication|awk -F'|' '/ table /{gsub(" ",
"", $2);printf "%s,\n", $2}'

and I get this error
awk: syntax error near line 1
awk: illegal statement near line 1

Can you help
josh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071213/=
bdf059da/attachment.htm
From lists at serioustechnology.com  Thu Dec 13 08:29:28 2007
From: lists at serioustechnology.com (Geoffrey)
Date: Thu Dec 13 08:29:35 2007
Subject: [Slony1-general] shortcut for telling slony to simply replicate
	everything?
In-Reply-To: <8d89ea1d0712130814j1262e670tafaf1bd61271177@mail.gmail.com>
References: <47600E8A.7070802@serioustechnology.com>	
	<F1B0F9305B343E43A1C3EECE48B853D501A83F45@CITGSNA01SXCH02.ana.firstamdata.com>	
	<47603512.1070804@serioustechnology.com>	
	<20071212193151.GK31954@crankycanuck.ca>	
	<47603CD9.6030105@serioustechnology.com>	
	<8d89ea1d0712130642i7ff17b80k7cb7553f48235752@mail.gmail.com>	
	<47614897.7010705@serioustechnology.com>
	<8d89ea1d0712130814j1262e670tafaf1bd61271177@mail.gmail.com>
Message-ID: <47615DE8.1060706@serioustechnology.com>

Josh Harrison wrote:
> On Dec 13, 2007 9:58 AM, Geoffrey <lists@serioustechnology.com> wrote:
> 
>> Josh Harrison wrote:
>>>>> On Wed, Dec 12, 2007 at 02:22:58PM -0500, Geoffrey wrote:
>>>>>> I was afraid that would be the answer, thanks.
>>>>> This is an easy script to write, though.  You can get every table name
>>>> out
>>>>> of postgres quite easily.
>>> How do you write this script? I have a database with 100 tables and i
>> have
>>> to replicate them all. And if tey dont have a PK then you have to
>> generate a
>>> slony serial key...right!!!!
>>> josh
>>
>> All of my tables have PK, so that's not a problem for me.  All I had to
>> do was produce a common separated list of the tables and then import
>> that into the slon_tools.conf file:
>>
>> echo '\d' |psql -t -p 5443 swr|
>>        awk -F'|' '/ table /{gsub(" ", "", $2);printf "%s,\n", $2}'
> 
> 
> 
> Thanks...I tried this
> echo '\d' |psql -t -p 5432 bench_replication|awk -F'|' '/ table /{gsub(" ",
> "", $2);printf "%s,\n", $2}'
> 
> and I get this error
> awk: syntax error near line 1
> awk: illegal statement near line 1
> 
> Can you help

Hmm, works fine for me, what does this produce:

echo '\d' |psql -t -p 5432 bench_replication

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From joshques at gmail.com  Thu Dec 13 08:44:03 2007
From: joshques at gmail.com (Josh Harrison)
Date: Thu Dec 13 08:44:09 2007
Subject: [Slony1-general] shortcut for telling slony to simply replicate
	everything?
In-Reply-To: <47615DE8.1060706@serioustechnology.com>
References: <47600E8A.7070802@serioustechnology.com>
	<F1B0F9305B343E43A1C3EECE48B853D501A83F45@CITGSNA01SXCH02.ana.firstamdata.com>
	<47603512.1070804@serioustechnology.com>
	<20071212193151.GK31954@crankycanuck.ca>
	<47603CD9.6030105@serioustechnology.com>
	<8d89ea1d0712130642i7ff17b80k7cb7553f48235752@mail.gmail.com>
	<47614897.7010705@serioustechnology.com>
	<8d89ea1d0712130814j1262e670tafaf1bd61271177@mail.gmail.com>
	<47615DE8.1060706@serioustechnology.com>
Message-ID: <8d89ea1d0712130844iba682e6i4833b9e37b5389ee@mail.gmail.com>

On Dec 13, 2007 11:29 AM, Geoffrey <lists@serioustechnology.com> wrote:

> Josh Harrison wrote:
> > On Dec 13, 2007 9:58 AM, Geoffrey <lists@serioustechnology.com> wrote:
> >
> >> Josh Harrison wrote:
> >>>>> On Wed, Dec 12, 2007 at 02:22:58PM -0500, Geoffrey wrote:
> >>>>>> I was afraid that would be the answer, thanks.
> >>>>> This is an easy script to write, though.  You can get every table
> name
> >>>> out
> >>>>> of postgres quite easily.
> >>> How do you write this script? I have a database with 100 tables and i
> >> have
> >>> to replicate them all. And if tey dont have a PK then you have to
> >> generate a
> >>> slony serial key...right!!!!
> >>> josh
> >>
> >> All of my tables have PK, so that's not a problem for me.  All I had to
> >> do was produce a common separated list of the tables and then import
> >> that into the slon_tools.conf file:
> >>
> >> echo '\d' |psql -t -p 5443 swr|
> >>        awk -F'|' '/ table /{gsub(" ", "", $2);printf "%s,\n", $2}'
> >
> >
> >
> > Thanks...I tried this
> > echo '\d' |psql -t -p 5432 bench_replication|awk -F'|' '/ table /{gsub("
> ",
> > "", $2);printf "%s,\n", $2}'
> >
> > and I get this error
> > awk: syntax error near line 1
> > awk: illegal statement near line 1
> >
> > Can you help
>
> Hmm, works fine for me, what does this produce:
>
> echo '\d' |psql -t -p 5432 bench_replication
>

public | accounts | table | josh
 public | branches | table | josh
 public | dummy1   | table | josh
 public | dummy2   | table | josh
 public | history  | table | josh
 public | tellers  | table | josh

This s just a test database
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071213/=
8970f022/attachment.htm
From cbbrowne at ca.afilias.info  Thu Dec 13 08:46:18 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Thu Dec 13 08:46:22 2007
Subject: [Slony1-general] log error
In-Reply-To: <476156C0.4080309@serioustechnology.com> (Geoffrey's message of
	"Thu, 13 Dec 2007 10:58:56 -0500")
References: <47609176.6090302@serioustechnology.com>
	<60prxa8zzn.fsf@dba2.int.libertyrms.com>
	<47614ADB.7040109@serioustechnology.com>
	<60fxy6bo0e.fsf@dba2.int.libertyrms.com>
	<476156C0.4080309@serioustechnology.com>
Message-ID: <603au6bl0l.fsf@dba2.int.libertyrms.com>

Geoffrey <lists@serioustechnology.com> writes:
> Christopher Browne wrote:
>> Geoffrey <lists@serioustechnology.com> writes:
>>> For now, that get's me past that issue.  Problem is, I get the
>>> following when attempt 'slon_start 2':
>>>
>>> 2007-12-13 10:04:43 EST ERROR  cannot get sl_local_node_id - ERROR:
>>> schema "_esc_cluster" does not exist 2007-12-13 10:04:43 EST FATAL
>>> main: Node is not initialized properly - sleep 10s
>> Well, apparently the "store node" for node #2 didn't get done...
>
> Is this possibly an environment issue?  Configuration problem?  I'm
> not sure what you mean by the 'store node.'

Configuration, of a sort.

Setting up replication involves, at the slonik level, the following steps:

- Initializing the first node in the cluster (e.g. - INIT CLUSTER)
- Initializing other nodes (e.g. - STORE NODE), which is where things evidently broke down
- Setting up communications between nodes (STORE PATH)
- Setting up a replication set
  - CREATE SET (to begin setup)
  - SET ADD TABLE (to add tables in)
  - SET ADD SEQUENCE (to add in sequences)
- Then subscribing nodes to that set - SUBSCRIBE SET

If you see the message "Node is not initialized properly", that means
that either an INIT CLUSTER or a STORE NODE did not take place.
-- 
let name="cbbrowne" and tld="linuxdatabases.info" in String.concat "@" [name;tld];;
http://linuxdatabases.info/info/x.html
If one synchronized swimmer drowns, do the rest have to drown too?
From lists at serioustechnology.com  Thu Dec 13 08:51:59 2007
From: lists at serioustechnology.com (Geoffrey)
Date: Thu Dec 13 08:52:07 2007
Subject: [Slony1-general] log error
In-Reply-To: <603au6bl0l.fsf@dba2.int.libertyrms.com>
References: <47609176.6090302@serioustechnology.com>	<60prxa8zzn.fsf@dba2.int.libertyrms.com>	<47614ADB.7040109@serioustechnology.com>	<60fxy6bo0e.fsf@dba2.int.libertyrms.com>	<476156C0.4080309@serioustechnology.com>
	<603au6bl0l.fsf@dba2.int.libertyrms.com>
Message-ID: <4761632F.2040109@serioustechnology.com>

Christopher Browne wrote:
> Geoffrey <lists@serioustechnology.com> writes:
>> Christopher Browne wrote:
>>> Geoffrey <lists@serioustechnology.com> writes:
>>>> For now, that get's me past that issue.  Problem is, I get the
>>>> following when attempt 'slon_start 2':
>>>>
>>>> 2007-12-13 10:04:43 EST ERROR  cannot get sl_local_node_id - ERROR:
>>>> schema "_esc_cluster" does not exist 2007-12-13 10:04:43 EST FATAL
>>>> main: Node is not initialized properly - sleep 10s
>>> Well, apparently the "store node" for node #2 didn't get done...
>> Is this possibly an environment issue?  Configuration problem?  I'm
>> not sure what you mean by the 'store node.'
> 
> Configuration, of a sort.
> 
> Setting up replication involves, at the slonik level, the following steps:
> 
> - Initializing the first node in the cluster (e.g. - INIT CLUSTER)
> - Initializing other nodes (e.g. - STORE NODE), which is where things evidently broke down
> - Setting up communications between nodes (STORE PATH)
> - Setting up a replication set
>   - CREATE SET (to begin setup)
>   - SET ADD TABLE (to add tables in)
>   - SET ADD SEQUENCE (to add in sequences)
> - Then subscribing nodes to that set - SUBSCRIBE SET
> 
> If you see the message "Node is not initialized properly", that means
> that either an INIT CLUSTER or a STORE NODE did not take place.

Can you tell me which command do what?  Here's what I've done:

slonik_init_cluster |slonik
slon_start 1
slon_start 2

this is where it breaks down.  Should I be doing something after the 
slonik_init_cluster and before the slon_start ??

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From simon at 2ndquadrant.com  Thu Dec 13 08:52:25 2007
From: simon at 2ndquadrant.com (Simon Riggs)
Date: Thu Dec 13 08:52:21 2007
Subject: [Slony1-general] Version 1.2.12 released
In-Reply-To: <47419D07.7030605@free.fr>
References: <601wavf4kp.fsf@dba2.int.libertyrms.com>
	<47396E63.8080106@free.fr> <473C54EB.7060904@postgresqlfr.org>
	<47419D07.7030605@free.fr>
Message-ID: <1197564745.4255.1845.camel@ebony.site>

On Mon, 2007-11-19 at 15:26 +0100, Cyril SCETBON wrote:
> 
> St?phane A. Schildknecht wrote:
> 
> > Cyril SCETBON a ?crit :
> >> I think it would be better to be able to modify SLON_DATA_FETCH_SIZE
> >> by using a parameter on the slon command line. For example, we got a
> >> lot of updates (400 per second) between far geographical sites. I had
> >> to modify this variable and to recompile the slon binary cause I
> >> didn't find another way until now.
> >
> > How did you modify this variable? Increase or decrease ? 
> I've modified the value of SLON_DATA_FETCH_SIZE in src/slon/slon.h and 
> rebuilt it.
> I've changed it from 10 to 50 to make fetchs of 500 lines.
> > What was the
> > problem you encountered ?
> >   
> When vaccum was happening on slony tables the db rate of the replication 
> decreased and slony had to get 3000 DML a few minutes later to make the 
> subscriber up to date. But fetching 3000 DMLs orders by fetching 100 
> lines was too slow. That's why I've increased the value to make fetchs 
> of 500 lines.

Chris,

I didn't explicitly make the connection before but my investigation of
whether we needed to VACUUM at all was connected to Cyril's performance
decrease described above.

We discussed increasing SLON_DATA_FETCH_SIZE, but we probably wouldn't
need to do that if VACUUM didn't run and slow us down occasionally. 

So maybe we can knock one thing off your task list, at least?

I can't remember where we left the earlier discussion on the vacuuming.
Did you want me to make a patch, or can I leave it with you guys? No
reason to rush at all my end, just trying to remember where we were.

-- 
  Simon Riggs
  2ndQuadrant  http://www.2ndQuadrant.com

From lists at serioustechnology.com  Thu Dec 13 08:53:39 2007
From: lists at serioustechnology.com (Geoffrey)
Date: Thu Dec 13 08:53:46 2007
Subject: [Slony1-general] shortcut for telling slony to simply replicate
	everything?
In-Reply-To: <8d89ea1d0712130844iba682e6i4833b9e37b5389ee@mail.gmail.com>
References: <47600E8A.7070802@serioustechnology.com>	
	<F1B0F9305B343E43A1C3EECE48B853D501A83F45@CITGSNA01SXCH02.ana.firstamdata.com>	
	<47603512.1070804@serioustechnology.com>	
	<20071212193151.GK31954@crankycanuck.ca>	
	<47603CD9.6030105@serioustechnology.com>	
	<8d89ea1d0712130642i7ff17b80k7cb7553f48235752@mail.gmail.com>	
	<47614897.7010705@serioustechnology.com>	
	<8d89ea1d0712130814j1262e670tafaf1bd61271177@mail.gmail.com>	
	<47615DE8.1060706@serioustechnology.com>
	<8d89ea1d0712130844iba682e6i4833b9e37b5389ee@mail.gmail.com>
Message-ID: <47616393.9010702@serioustechnology.com>

Josh Harrison wrote:
> On Dec 13, 2007 11:29 AM, Geoffrey <lists@serioustechnology.com> wrote:
> 
>> Josh Harrison wrote:
>>> On Dec 13, 2007 9:58 AM, Geoffrey <lists@serioustechnology.com> wrote:
>>>
>>>> Josh Harrison wrote:
>>>>>>> On Wed, Dec 12, 2007 at 02:22:58PM -0500, Geoffrey wrote:
>>>>>>>> I was afraid that would be the answer, thanks.
>>>>>>> This is an easy script to write, though.  You can get every table
>> name
>>>>>> out
>>>>>>> of postgres quite easily.
>>>>> How do you write this script? I have a database with 100 tables and i
>>>> have
>>>>> to replicate them all. And if tey dont have a PK then you have to
>>>> generate a
>>>>> slony serial key...right!!!!
>>>>> josh
>>>> All of my tables have PK, so that's not a problem for me.  All I had to
>>>> do was produce a common separated list of the tables and then import
>>>> that into the slon_tools.conf file:
>>>>
>>>> echo '\d' |psql -t -p 5443 swr|
>>>>        awk -F'|' '/ table /{gsub(" ", "", $2);printf "%s,\n", $2}'
>>>
>>>
>>> Thanks...I tried this
>>> echo '\d' |psql -t -p 5432 bench_replication|awk -F'|' '/ table /{gsub("
>> ",
>>> "", $2);printf "%s,\n", $2}'
>>>
>>> and I get this error
>>> awk: syntax error near line 1
>>> awk: illegal statement near line 1
>>>
>>> Can you help
>> Hmm, works fine for me, what does this produce:
>>
>> echo '\d' |psql -t -p 5432 bench_replication
>>
> 
> public | accounts | table | josh
>  public | branches | table | josh
>  public | dummy1   | table | josh
>  public | dummy2   | table | josh
>  public | history  | table | josh
>  public | tellers  | table | josh
> 
> This s just a test database

Weird, this should work.  What shell are you using?  bash?  What distro?

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From lists at serioustechnology.com  Thu Dec 13 09:00:52 2007
From: lists at serioustechnology.com (Geoffrey)
Date: Thu Dec 13 09:01:00 2007
Subject: [Slony1-general] log error
In-Reply-To: <603au6bl0l.fsf@dba2.int.libertyrms.com>
References: <47609176.6090302@serioustechnology.com>	<60prxa8zzn.fsf@dba2.int.libertyrms.com>	<47614ADB.7040109@serioustechnology.com>	<60fxy6bo0e.fsf@dba2.int.libertyrms.com>	<476156C0.4080309@serioustechnology.com>
	<603au6bl0l.fsf@dba2.int.libertyrms.com>
Message-ID: <47616544.5030802@serioustechnology.com>

Christopher Browne wrote:
> Geoffrey <lists@serioustechnology.com> writes:
>> Christopher Browne wrote:
>>> Geoffrey <lists@serioustechnology.com> writes:
>>>> For now, that get's me past that issue.  Problem is, I get the
>>>> following when attempt 'slon_start 2':
>>>>
>>>> 2007-12-13 10:04:43 EST ERROR  cannot get sl_local_node_id - ERROR:
>>>> schema "_esc_cluster" does not exist 2007-12-13 10:04:43 EST FATAL
>>>> main: Node is not initialized properly - sleep 10s
>>> Well, apparently the "store node" for node #2 didn't get done...
>> Is this possibly an environment issue?  Configuration problem?  I'm
>> not sure what you mean by the 'store node.'
> 
> Configuration, of a sort.
> 
> Setting up replication involves, at the slonik level, the following steps:
> 
> - Initializing the first node in the cluster (e.g. - INIT CLUSTER)
> - Initializing other nodes (e.g. - STORE NODE), which is where things evidently broke down
> - Setting up communications between nodes (STORE PATH)
> - Setting up a replication set
>   - CREATE SET (to begin setup)
>   - SET ADD TABLE (to add tables in)
>   - SET ADD SEQUENCE (to add in sequences)
> - Then subscribing nodes to that set - SUBSCRIBE SET
> 
> If you see the message "Node is not initialized properly", that means
> that either an INIT CLUSTER or a STORE NODE did not take place.

I don't know if this helps any, but slony_show_configuration produces:

Slony Configuration
-------------------------------------

Slony-I Cluster: esc_cluster
Logs stored under /var/log/slony
Slony Binaries in: /usr/bin/

Node information
--------------------------------
Node:  1 Host:            rhws User: postgres Port: 5443 Forwarding? 
   Parent:  0 Database:        swr
          DSN: host=rhws dbname=swr user=postgres port=5443
Node:  2 Host:   172.16.255.15 User: postgres Port: 5443 Forwarding? 
   Parent:  1 Database:        swr
          DSN: host=172.16.255.15 dbname=swr user=postgres port=5443

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From joshques at gmail.com  Thu Dec 13 09:02:39 2007
From: joshques at gmail.com (Josh Harrison)
Date: Thu Dec 13 09:02:43 2007
Subject: [Slony1-general] shortcut for telling slony to simply replicate
	everything?
In-Reply-To: <47616393.9010702@serioustechnology.com>
References: <47600E8A.7070802@serioustechnology.com>
	<47603512.1070804@serioustechnology.com>
	<20071212193151.GK31954@crankycanuck.ca>
	<47603CD9.6030105@serioustechnology.com>
	<8d89ea1d0712130642i7ff17b80k7cb7553f48235752@mail.gmail.com>
	<47614897.7010705@serioustechnology.com>
	<8d89ea1d0712130814j1262e670tafaf1bd61271177@mail.gmail.com>
	<47615DE8.1060706@serioustechnology.com>
	<8d89ea1d0712130844iba682e6i4833b9e37b5389ee@mail.gmail.com>
	<47616393.9010702@serioustechnology.com>
Message-ID: <8d89ea1d0712130902l2355d8f3w5eba8cb7bb621ff0@mail.gmail.com>

On Dec 13, 2007 11:53 AM, Geoffrey <lists@serioustechnology.com> wrote:

> Josh Harrison wrote:
> > On Dec 13, 2007 11:29 AM, Geoffrey <lists@serioustechnology.com> wrote:
> >
> >> Josh Harrison wrote:
> >>> On Dec 13, 2007 9:58 AM, Geoffrey <lists@serioustechnology.com> wrote:
> >>>
> >>>> Josh Harrison wrote:
> >>>>>>> On Wed, Dec 12, 2007 at 02:22:58PM -0500, Geoffrey wrote:
> >>>>>>>> I was afraid that would be the answer, thanks.
> >>>>>>> This is an easy script to write, though.  You can get every table
> >> name
> >>>>>> out
> >>>>>>> of postgres quite easily.
> >>>>> How do you write this script? I have a database with 100 tables and
> i
> >>>> have
> >>>>> to replicate them all. And if tey dont have a PK then you have to
> >>>> generate a
> >>>>> slony serial key...right!!!!
> >>>>> josh
> >>>> All of my tables have PK, so that's not a problem for me.  All I had
> to
> >>>> do was produce a common separated list of the tables and then import
> >>>> that into the slon_tools.conf file:
> >>>>
> >>>> echo '\d' |psql -t -p 5443 swr|
> >>>>        awk -F'|' '/ table /{gsub(" ", "", $2);printf "%s,\n", $2}'
> >>>
> >>>
> >>> Thanks...I tried this
> >>> echo '\d' |psql -t -p 5432 bench_replication|awk -F'|' '/ table
> /{gsub("
> >> ",
> >>> "", $2);printf "%s,\n", $2}'
> >>>
> >>> and I get this error
> >>> awk: syntax error near line 1
> >>> awk: illegal statement near line 1
> >>>
> >>> Can you help
> >> Hmm, works fine for me, what does this produce:
> >>
> >> echo '\d' |psql -t -p 5432 bench_replication
> >>
> >
> > public | accounts | table | josh
> >  public | branches | table | josh
> >  public | dummy1   | table | josh
> >  public | dummy2   | table | josh
> >  public | history  | table | josh
> >  public | tellers  | table | josh
> >
> > This s just a test database
>
> Weird, this should work.  What shell are you using?  bash?  What distro?
>

bash --version
GNU bash, version 3.00.16(1)-release (i386-pc-solaris2.10)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071213/=
fb67f5b5/attachment.htm
From lists at serioustechnology.com  Thu Dec 13 09:22:45 2007
From: lists at serioustechnology.com (Geoffrey)
Date: Thu Dec 13 09:22:54 2007
Subject: [Slony1-general] shortcut for telling slony to simply replicate
	everything?
In-Reply-To: <8d89ea1d0712130902l2355d8f3w5eba8cb7bb621ff0@mail.gmail.com>
References: <47600E8A.7070802@serioustechnology.com>	
	<47603512.1070804@serioustechnology.com>	
	<20071212193151.GK31954@crankycanuck.ca>	
	<47603CD9.6030105@serioustechnology.com>	
	<8d89ea1d0712130642i7ff17b80k7cb7553f48235752@mail.gmail.com>	
	<47614897.7010705@serioustechnology.com>	
	<8d89ea1d0712130814j1262e670tafaf1bd61271177@mail.gmail.com>	
	<47615DE8.1060706@serioustechnology.com>	
	<8d89ea1d0712130844iba682e6i4833b9e37b5389ee@mail.gmail.com>	
	<47616393.9010702@serioustechnology.com>
	<8d89ea1d0712130902l2355d8f3w5eba8cb7bb621ff0@mail.gmail.com>
Message-ID: <47616A65.9020009@serioustechnology.com>

Josh Harrison wrote:

>>>>> Can you help
>>>> Hmm, works fine for me, what does this produce:
>>>>
>>>> echo '\d' |psql -t -p 5432 bench_replication
>>>>
>>> public | accounts | table | josh
>>>  public | branches | table | josh
>>>  public | dummy1   | table | josh
>>>  public | dummy2   | table | josh
>>>  public | history  | table | josh
>>>  public | tellers  | table | josh
>>>
>>> This s just a test database
>> Weird, this should work.  What shell are you using?  bash?  What distro?
>>
> 
> bash --version
> GNU bash, version 3.00.16(1)-release (i386-pc-solaris2.10)

This must be something inherent to bash on solaris.  I've tried it with 
bash and ksh on Linux and it works fine.  It's likely an issue with the 
way the quotes are being parsed.

I'll play with it and see if I can come up with an alternative solution, 
although I don't have solaris to test it on.


-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From lists at serioustechnology.com  Thu Dec 13 09:23:52 2007
From: lists at serioustechnology.com (Geoffrey)
Date: Thu Dec 13 09:24:01 2007
Subject: [Slony1-general] shortcut for telling slony to simply replicate
	everything?
In-Reply-To: <8d89ea1d0712130902l2355d8f3w5eba8cb7bb621ff0@mail.gmail.com>
References: <47600E8A.7070802@serioustechnology.com>	
	<47603512.1070804@serioustechnology.com>	
	<20071212193151.GK31954@crankycanuck.ca>	
	<47603CD9.6030105@serioustechnology.com>	
	<8d89ea1d0712130642i7ff17b80k7cb7553f48235752@mail.gmail.com>	
	<47614897.7010705@serioustechnology.com>	
	<8d89ea1d0712130814j1262e670tafaf1bd61271177@mail.gmail.com>	
	<47615DE8.1060706@serioustechnology.com>	
	<8d89ea1d0712130844iba682e6i4833b9e37b5389ee@mail.gmail.com>	
	<47616393.9010702@serioustechnology.com>
	<8d89ea1d0712130902l2355d8f3w5eba8cb7bb621ff0@mail.gmail.com>
Message-ID: <47616AA8.4050407@serioustechnology.com>

What version of gawk?

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From joshques at gmail.com  Thu Dec 13 09:27:42 2007
From: joshques at gmail.com (Josh Harrison)
Date: Thu Dec 13 09:27:47 2007
Subject: [Slony1-general] shortcut for telling slony to simply replicate
	everything?
In-Reply-To: <47616AA8.4050407@serioustechnology.com>
References: <47600E8A.7070802@serioustechnology.com>
	<47603CD9.6030105@serioustechnology.com>
	<8d89ea1d0712130642i7ff17b80k7cb7553f48235752@mail.gmail.com>
	<47614897.7010705@serioustechnology.com>
	<8d89ea1d0712130814j1262e670tafaf1bd61271177@mail.gmail.com>
	<47615DE8.1060706@serioustechnology.com>
	<8d89ea1d0712130844iba682e6i4833b9e37b5389ee@mail.gmail.com>
	<47616393.9010702@serioustechnology.com>
	<8d89ea1d0712130902l2355d8f3w5eba8cb7bb621ff0@mail.gmail.com>
	<47616AA8.4050407@serioustechnology.com>
Message-ID: <8d89ea1d0712130927w124d6c8ciab2ea02ed9df3622@mail.gmail.com>

On Dec 13, 2007 12:23 PM, Geoffrey <lists@serioustechnology.com> wrote:

> What version of gawk?
>
GNU Awk 3.1.5
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071213/=
6598c0c4/attachment.htm
From lists at serioustechnology.com  Thu Dec 13 09:35:13 2007
From: lists at serioustechnology.com (Geoffrey)
Date: Thu Dec 13 09:35:21 2007
Subject: [Slony1-general] shortcut for telling slony to simply replicate
	everything?
In-Reply-To: <8d89ea1d0712130927w124d6c8ciab2ea02ed9df3622@mail.gmail.com>
References: <47600E8A.7070802@serioustechnology.com>	
	<47603CD9.6030105@serioustechnology.com>	
	<8d89ea1d0712130642i7ff17b80k7cb7553f48235752@mail.gmail.com>	
	<47614897.7010705@serioustechnology.com>	
	<8d89ea1d0712130814j1262e670tafaf1bd61271177@mail.gmail.com>	
	<47615DE8.1060706@serioustechnology.com>	
	<8d89ea1d0712130844iba682e6i4833b9e37b5389ee@mail.gmail.com>	
	<47616393.9010702@serioustechnology.com>	
	<8d89ea1d0712130902l2355d8f3w5eba8cb7bb621ff0@mail.gmail.com>	
	<47616AA8.4050407@serioustechnology.com>
	<8d89ea1d0712130927w124d6c8ciab2ea02ed9df3622@mail.gmail.com>
Message-ID: <47616D51.1060500@serioustechnology.com>

Josh Harrison wrote:
> On Dec 13, 2007 12:23 PM, Geoffrey <lists@serioustechnology.com> wrote:
> 
>> What version of gawk?
>>
> GNU Awk 3.1.5

Newer then the machine I'm testing on:

GNU Awk 3.1.3

I'll play with it and let you know if I come up with another solution.


-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From lists at serioustechnology.com  Thu Dec 13 11:41:41 2007
From: lists at serioustechnology.com (Geoffrey)
Date: Thu Dec 13 11:41:54 2007
Subject: [Slony1-general] log error
In-Reply-To: <603au6bl0l.fsf@dba2.int.libertyrms.com>
References: <47609176.6090302@serioustechnology.com>	<60prxa8zzn.fsf@dba2.int.libertyrms.com>	<47614ADB.7040109@serioustechnology.com>	<60fxy6bo0e.fsf@dba2.int.libertyrms.com>	<476156C0.4080309@serioustechnology.com>
	<603au6bl0l.fsf@dba2.int.libertyrms.com>
Message-ID: <47618AF5.2010901@serioustechnology.com>

Christopher Browne wrote:
> Geoffrey <lists@serioustechnology.com> writes:
>> Christopher Browne wrote:
>>> Geoffrey <lists@serioustechnology.com> writes:
>>>> For now, that get's me past that issue.  Problem is, I get the
>>>> following when attempt 'slon_start 2':
>>>>
>>>> 2007-12-13 10:04:43 EST ERROR  cannot get sl_local_node_id - ERROR:
>>>> schema "_esc_cluster" does not exist 2007-12-13 10:04:43 EST FATAL
>>>> main: Node is not initialized properly - sleep 10s
>>> Well, apparently the "store node" for node #2 didn't get done...
>> Is this possibly an environment issue?  Configuration problem?  I'm
>> not sure what you mean by the 'store node.'
> 
> Configuration, of a sort.
> 
> Setting up replication involves, at the slonik level, the following steps:
> 
> - Initializing the first node in the cluster (e.g. - INIT CLUSTER)
> - Initializing other nodes (e.g. - STORE NODE), which is where things evidently broke down
> - Setting up communications between nodes (STORE PATH)
> - Setting up a replication set
>   - CREATE SET (to begin setup)
>   - SET ADD TABLE (to add tables in)
>   - SET ADD SEQUENCE (to add in sequences)
> - Then subscribing nodes to that set - SUBSCRIBE SET

Okay, I've revisited the above and it seems the documents fail to tell 
you to STORE NODE.  I did a:

slonik_store_node 2|slonik

Then started my slon daemons and then subscribed the set and it produced 
no errors and I successfully replicated my test database.

Again, it appears the documentation is lacking.  I'll put together a 
complete summary of my efforts and post later.

Thanks again.

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From cichy1 at gmail.com  Thu Dec 13 12:28:20 2007
From: cichy1 at gmail.com (cichy)
Date: Thu Dec 13 12:28:28 2007
Subject: [Slony1-general] Re: selective data replication question
Message-ID: <305b0d940712131228t79b10adwebed344e1b01b02f@mail.gmail.com>

> > are older than a week, but in such way that they are not deleted from the
> > second DB. Is it possible with slony? Maybe records with certain values in
> > some columns can be ommited from deletion in slave DB?
>
> Andrew Sullivan wrote:
> You can STORE TRIGGER on the second system, that saves those records
> somewhere else.  The obvious way to do this is to use a trigger on the
> replica that INSTEAD copies the records into a _different_, but that doesn't
> fire on DELETE.

So, it is not possible to make those records stay in the replicated
table in slave DB without adding there another table which will gather
data?
Maybe logging trigger could be modified or wrapped somehow, so it
doesn't log certain deletions?

PR
From ajs at crankycanuck.ca  Thu Dec 13 14:31:35 2007
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Thu Dec 13 14:31:52 2007
Subject: [Slony1-general] Re: selective data replication question
In-Reply-To: <305b0d940712131228t79b10adwebed344e1b01b02f@mail.gmail.com>
References: <305b0d940712131228t79b10adwebed344e1b01b02f@mail.gmail.com>
Message-ID: <20071213223135.GL7060@crankycanuck.ca>

On Thu, Dec 13, 2007 at 09:28:20PM +0100, cichy wrote:
> 
> So, it is not possible to make those records stay in the replicated
> table in slave DB without adding there another table which will gather
> data?
> Maybe logging trigger could be modified or wrapped somehow, so it
> doesn't log certain deletions?

I suppose that with enough hacking on it, you could do this, but I'd suggest
against it.  I know that there's a proposal afoot to do pre-filtering of
change applications.  I think it was discussed on list here a couple months
ago.

A

From simon at 2ndquadrant.com  Fri Dec 14 02:03:53 2007
From: simon at 2ndquadrant.com (Simon Riggs)
Date: Fri Dec 14 02:03:46 2007
Subject: [Slony1-general] Optimizing copy refresh
Message-ID: <1197626633.15521.37.camel@ebony.site>


in copy_set() line 3073 of /src/slon/remote_worker.c

uses DELETE rather than TRUNCATE prior to COPY


So some optimizations here could be
- use TRUNCATE to speed up refreshing a copy operation
- this will then allow (from 8.3 onwards) fast COPY mode

It's possible you've decided we don't need that part to be optimized,
which is OK, I'm just pointing out what's possible.

-- 
  Simon Riggs
  2ndQuadrant  http://www.2ndQuadrant.com

From cbbrowne at ca.afilias.info  Fri Dec 14 08:42:38 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri Dec 14 08:42:44 2007
Subject: [Slony1-general] Optimizing copy refresh
In-Reply-To: <1197626633.15521.37.camel@ebony.site> (Simon Riggs's message of
	"Fri, 14 Dec 2007 10:03:53 +0000")
References: <1197626633.15521.37.camel@ebony.site>
Message-ID: <60bq8t9qip.fsf@dba2.int.libertyrms.com>

Simon Riggs <simon@2ndquadrant.com> writes:
> in copy_set() line 3073 of /src/slon/remote_worker.c
>
> uses DELETE rather than TRUNCATE prior to COPY
>
>
> So some optimizations here could be
> - use TRUNCATE to speed up refreshing a copy operation
> - this will then allow (from 8.3 onwards) fast COPY mode
>
> It's possible you've decided we don't need that part to be optimized,
> which is OK, I'm just pointing out what's possible.

The code I *think* you're talking about is the following, right?

----------- remote_worker.c v 1.162 ------------------------------
		if (archive_dir)
		{
			slon_mkquery(&query1,
			 "delete from only %s;\ncopy %s %s from stdin;", tab_fqname, tab_fqname,
						 nodeon73 ? "" : PQgetvalue(res3, 0, 0));
			rc = archive_append_ds(node, &query1);
... more code elided ...

??

If it is, then I'll suggest that this doesn't represent a very
interesting optimization, from three perspectives:

  1.  This query is only applied against a log shipping subscription
      (because of the enclosure in the "if (archive_dir)" clause).

      Different logic is applied against a normal subscriber node.

  2.  The normal logic for a subscriber is implemented in the function
      prepareTableForCopy() in src/base/slony1_funcs.sql, and it
      *does* try doing a TRUNCATE, falling back to DELETE if it
      encounters an exception (which tends to imply that there are
      foreign keys getting in the way of TRUNCATE).

  3.  On a log shipping node, we may fairly reasonably expect the
      table to be empty, because you normally initialize with a
      schema but no data, thereby making the DELETE a formality
      (to make sure the table truly is empty).

      If there's no data in the table, DELETE should be pretty cheap
      ;-).

I don't see this being a terribly fruitful destination for further
optimization.  There would be some possibly non-zero value in drawing
in the same logic as in prepareTableForCopy(), but I'm not sure it's
worth complicating the code that way :-(.
-- 
let name="cbbrowne" and tld="linuxdatabases.info" in String.concat "@" [name;tld];;
http://linuxdatabases.info/info/linuxxian.html
We  are MICROS~1.   You will  be assimilated.   Resistance  is futile.
(Attributed to B.G., Gill Bates)
From cbbrowne at ca.afilias.info  Fri Dec 14 08:47:01 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri Dec 14 08:47:05 2007
Subject: [Slony1-general] Version 1.2.12 released
In-Reply-To: <1197564745.4255.1845.camel@ebony.site> (Simon Riggs's message of
	"Thu, 13 Dec 2007 16:52:25 +0000")
References: <601wavf4kp.fsf@dba2.int.libertyrms.com>
	<47396E63.8080106@free.fr> <473C54EB.7060904@postgresqlfr.org>
	<47419D07.7030605@free.fr> <1197564745.4255.1845.camel@ebony.site>
Message-ID: <607ijh9qbe.fsf@dba2.int.libertyrms.com>

Simon Riggs <simon@2ndquadrant.com> writes:
> Chris,
>
> I didn't explicitly make the connection before but my investigation of
> whether we needed to VACUUM at all was connected to Cyril's performance
> decrease described above.
>
> We discussed increasing SLON_DATA_FETCH_SIZE, but we probably wouldn't
> need to do that if VACUUM didn't run and slow us down occasionally. 
>
> So maybe we can knock one thing off your task list, at least?

OK, I'll knock that one off...

> I can't remember where we left the earlier discussion on the vacuuming.
> Did you want me to make a patch, or can I leave it with you guys? No
> reason to rush at all my end, just trying to remember where we were.

Actually, if you have have code in mind, I'd be pleased to see a
patch.  It would seem a good thing to enlarge the set of people that
have some familiarity with the internals :-).
-- 
(format nil "~S@~S" "cbbrowne" "linuxfinances.info")
http://cbbrowne.com/info/spreadsheets.html
Oh,  boy, virtual memory!  Now I'm  gonna make  myself a  really *big*
RAMdisk!
From simon at 2ndquadrant.com  Fri Dec 14 09:46:55 2007
From: simon at 2ndquadrant.com (Simon Riggs)
Date: Fri Dec 14 09:46:38 2007
Subject: [Slony1-general] Optimizing copy refresh
In-Reply-To: <60bq8t9qip.fsf@dba2.int.libertyrms.com>
References: <1197626633.15521.37.camel@ebony.site>
	<60bq8t9qip.fsf@dba2.int.libertyrms.com>
Message-ID: <1197654415.15521.146.camel@ebony.site>

On Fri, 2007-12-14 at 11:42 -0500, Christopher Browne wrote:

> If there's no data in the table, DELETE should be pretty cheap
>       ;-).
> 
> I don't see this being a terribly fruitful destination for further
> optimization. 

OK. Thanks for checking.

-- 
  Simon Riggs
  2ndQuadrant  http://www.2ndQuadrant.com

From simon at 2ndquadrant.com  Fri Dec 14 09:47:49 2007
From: simon at 2ndquadrant.com (Simon Riggs)
Date: Fri Dec 14 09:47:34 2007
Subject: [Slony1-general] Version 1.2.12 released
In-Reply-To: <607ijh9qbe.fsf@dba2.int.libertyrms.com>
References: <601wavf4kp.fsf@dba2.int.libertyrms.com>
	<47396E63.8080106@free.fr> <473C54EB.7060904@postgresqlfr.org>
	<47419D07.7030605@free.fr> <1197564745.4255.1845.camel@ebony.site>
	<607ijh9qbe.fsf@dba2.int.libertyrms.com>
Message-ID: <1197654469.15521.148.camel@ebony.site>

On Fri, 2007-12-14 at 11:47 -0500, Christopher Browne wrote:
> Simon Riggs <simon@2ndquadrant.com> writes:

> > I can't remember where we left the earlier discussion on the vacuuming.
> > Did you want me to make a patch, or can I leave it with you guys? No
> > reason to rush at all my end, just trying to remember where we were.
> 
> Actually, if you have have code in mind, I'd be pleased to see a
> patch.  It would seem a good thing to enlarge the set of people that
> have some familiarity with the internals :-).

OK. Will do early next week.

-- 
  Simon Riggs
  2ndQuadrant  http://www.2ndQuadrant.com

From joshques at gmail.com  Fri Dec 14 10:36:43 2007
From: joshques at gmail.com (Josh Harrison)
Date: Fri Dec 14 10:36:49 2007
Subject: [Slony1-general] slony switchover question
Message-ID: <8d89ea1d0712141036p4a116ce7h1493772f11db057a@mail.gmail.com>

Hi
I have a question regarding slony's switchover and failover option
The document says
"At the time of this writing switchover to another server requires the
application to reconnect to the database. So in order to avoid any
complications, we simply shut down the web server. Users who use pg_pool for
the applications database connections merely have to shut down the pool."

1  So does this mean that during the switchover, the web server should be
shut down and users will not be able to access the database at that time?
2. Is there any time frame for this switchover ie., how long it takes ? what
does this depend on?
3. Is there any other way to keep the web server up running during this
switch over operation?

Thnaks
josh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071214/=
fc0e6c44/attachment.htm
From cbbrowne at ca.afilias.info  Fri Dec 14 13:18:13 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri Dec 14 13:18:22 2007
Subject: [Slony1-general] slony switchover question
In-Reply-To: <8d89ea1d0712141036p4a116ce7h1493772f11db057a@mail.gmail.com>
	(Josh Harrison's message of "Fri, 14 Dec 2007 13:36:43 -0500")
References: <8d89ea1d0712141036p4a116ce7h1493772f11db057a@mail.gmail.com>
Message-ID: <603au59dre.fsf@dba2.int.libertyrms.com>

"Josh Harrison" <joshques@gmail.com> writes:
> I have a question regarding slony's switchover and failover option
> The document says
> "At the time of this writing switchover to another server requires the application to reconnect to the database. So in order to avoid any complications, we simply
> shut down the web server. Users who use pg_pool for the applications database connections merely have to shut down the pool."

If I describe this issue differently (and maybe that means changing
the docs!), maybe it'll make it clearer...

Any time you do switchover from one server to another, say, from "DB1"
to "DB2", this requires that the applications that were connecting to
DB1 drop those connections, and connect to DB2, instead.

How you will accomplish this is hugely dependent on how you set your
environment up.

Options might include:

 - Stop the application, change "DB1" to "DB2" in a config file, and
   restart the application.

 - Use a DNS CNAME so that your application points to "DBSERVER;" that
   way, you initially have DNS set up so that DBSERVER is a CNAME
   pointing at DB1, and you later change it to be a CNAME pointing at
   DB2.

   You may need for your application to be restarted in order for it
   to know to reopen DB connections.

 - If you're using pg_pool, or something similar, then the
   reconfiguration involves reconfiguring pg_pool, rather than your DNS
   server.

   But for the most part, the behaviour is logically similar to the
   DNS-based example above.

> 1? So does this mean that during the switchover, the web server
> should be shut down and users will not be able to access the
> database at that time?

Ideally, yes.  Cutting off access pretty forcibly tends to be a good
idea during a switchover; that way, there aren't any lingering locks
kicking around possibly preventing the switchover from completing
quickly.

> 2. Is there any time frame for this switchover ie., how long it
> takes ? what does this depend on?

The reason for it to take > 1s is that there are processes connected
to either the former master node or the soon-to-be-master node,
holding locks on tables that the switchover process needs to modify.

> 3. Is there any other way to keep the web server up running during
> this switch over operation?

If you're using some mechanism like CNAME/pg_pool so that it's always
pointing at "something current," and the application knows enough to
re-open connections any time it finds they fail, that may "play OK."
-- 
output = ("cbbrowne" "@" "linuxfinances.info")
http://cbbrowne.com/info/wp.html
Your latest program has been judged UNTASTEFUL by the T daemon;
and automatically deleted.
From joshques at gmail.com  Sat Dec 15 08:42:18 2007
From: joshques at gmail.com (Josh Harrison)
Date: Sat Dec 15 08:42:24 2007
Subject: [Slony1-general] slony switchover question
In-Reply-To: <603au59dre.fsf@dba2.int.libertyrms.com>
References: <8d89ea1d0712141036p4a116ce7h1493772f11db057a@mail.gmail.com>
	<603au59dre.fsf@dba2.int.libertyrms.com>
Message-ID: <8d89ea1d0712150842g1a1e6fb9v3e86f6094fc42b17@mail.gmail.com>

Thanks for the information. It was very useful
josh

On Dec 14, 2007 4:18 PM, Christopher Browne <cbbrowne@ca.afilias.info>
wrote:

> "Josh Harrison" <joshques@gmail.com> writes:
> > I have a question regarding slony's switchover and failover option
> > The document says
> > "At the time of this writing switchover to another server requires the
> application to reconnect to the database. So in order to avoid any
> complications, we simply
> > shut down the web server. Users who use pg_pool for the applications
> database connections merely have to shut down the pool."
>
> If I describe this issue differently (and maybe that means changing
> the docs!), maybe it'll make it clearer...
>
> Any time you do switchover from one server to another, say, from "DB1"
> to "DB2", this requires that the applications that were connecting to
> DB1 drop those connections, and connect to DB2, instead.
>
> How you will accomplish this is hugely dependent on how you set your
> environment up.
>
> Options might include:
>
>  - Stop the application, change "DB1" to "DB2" in a config file, and
>   restart the application.
>
>  - Use a DNS CNAME so that your application points to "DBSERVER;" that
>   way, you initially have DNS set up so that DBSERVER is a CNAME
>   pointing at DB1, and you later change it to be a CNAME pointing at
>   DB2.
>
>   You may need for your application to be restarted in order for it
>   to know to reopen DB connections.
>
>  - If you're using pg_pool, or something similar, then the
>   reconfiguration involves reconfiguring pg_pool, rather than your DNS
>   server.
>
>   But for the most part, the behaviour is logically similar to the
>   DNS-based example above.
>
> > 1 So does this mean that during the switchover, the web server
> > should be shut down and users will not be able to access the
> > database at that time?
>
> Ideally, yes.  Cutting off access pretty forcibly tends to be a good
> idea during a switchover; that way, there aren't any lingering locks
> kicking around possibly preventing the switchover from completing
> quickly.
>
> > 2. Is there any time frame for this switchover ie., how long it
> > takes ? what does this depend on?
>
> The reason for it to take > 1s is that there are processes connected
> to either the former master node or the soon-to-be-master node,
> holding locks on tables that the switchover process needs to modify.
>
> > 3. Is there any other way to keep the web server up running during
> > this switch over operation?
>
> If you're using some mechanism like CNAME/pg_pool so that it's always
> pointing at "something current," and the application knows enough to
> re-open connections any time it finds they fail, that may "play OK."
> --
> output =3D ("cbbrowne" "@" "linuxfinances.info")
> http://cbbrowne.com/info/wp.html
> Your latest program has been judged UNTASTEFUL by the T daemon;
> and automatically deleted.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071215/=
c1524109/attachment.htm
From JanWieck at Yahoo.com  Sat Dec 15 07:04:58 2007
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Sat Dec 15 09:55:45 2007
Subject: [Slony1-general] shortcut for telling slony to simply replicate
	everything?
In-Reply-To: <8d89ea1d0712130642i7ff17b80k7cb7553f48235752@mail.gmail.com>
References: <47600E8A.7070802@serioustechnology.com>	<F1B0F9305B343E43A1C3EECE48B853D501A83F45@CITGSNA01SXCH02.ana.firstamdata.com>	<47603512.1070804@serioustechnology.com>	<20071212193151.GK31954@crankycanuck.ca>	<47603CD9.6030105@serioustechnology.com>
	<8d89ea1d0712130642i7ff17b80k7cb7553f48235752@mail.gmail.com>
Message-ID: <4763ED1A.4020804@Yahoo.com>

On 12/13/2007 9:42 AM, Josh Harrison wrote:
> 
>      > On Wed, Dec 12, 2007 at 02:22:58PM -0500, Geoffrey wrote:
>      >> I was afraid that would be the answer, thanks.
>      >
>      > This is an easy script to write, though.  You can get every table
>     name out
>      > of postgres quite easily.
> 
> 
> How do you write this script? I have a database with 100 tables and i 
> have to replicate them all. And if tey dont have a PK then you have to 
> generate a slony serial key...right!!!!
> josh

Note that the slony serial key feature is considered depricated and will 
be removed in Slony-I version 2.0. So if you are in the process of 
setting up a new cluster, do yourself a favor and create your own PK's 
for all tables and don't use TABLE ADD KEY.


Jan

-- 
#======================================================================#
# It's easier to get forgiveness for being wrong than for being right. #
# Let's break this rule - forgive me.                                  #
#================================================== JanWieck@Yahoo.com #

From jameshtucker at gmail.com  Sun Dec 16 17:29:50 2007
From: jameshtucker at gmail.com (James Tucker)
Date: Sun Dec 16 17:30:02 2007
Subject: [Slony1-general] Different indexes on slave
In-Reply-To: <b10d372b0712131827n63ef1158y9bb6ca9336df8d1a@mail.gmail.com>
References: <b10d372b0712131827n63ef1158y9bb6ca9336df8d1a@mail.gmail.com>
Message-ID: <b10d372b0712161729r791fda12oc9c910ce32a98fce@mail.gmail.com>

Hi All,

We're currently running slony to replicate to our DR site.  We're looking at
creating another reporting database at each site so our application can use
that for reports etc, and the master for our normal oltp load.  The
reporting database only needs a subset of the tables included in the DR set.


I have 2 questions.

Is there any reason we can't create different indexes (aimed at faster
reports as apposed to OTLP) on the reporting slave ?

Currently I just have one set that includes all our tables, am I able to
create another set with just a selection of those tables ?  Or would I need
to recreate my existing set, splitting it.

i.e.

set1 =3D table1, table2, table3

set2 =3D table1, table2.

Thanks in advance.

James
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071217/=
6230ff7b/attachment.htm
From joshques at gmail.com  Sun Dec 16 18:59:58 2007
From: joshques at gmail.com (Josh Harrison)
Date: Sun Dec 16 19:00:11 2007
Subject: [Slony1-general] error while replicating between postgres 7.4 and
	8.1 version
Message-ID: <8d89ea1d0712161859h79362c86p95cba9470e284d63@mail.gmail.com>

Hi
Im trying to replicate between postgres version 7.4.18 and version 8.1.10.
I configured postgres-7.4 with enable-thread-safety option
I configured slony1 with this command
./configure --prefix=3D/export/home/josh/slony7.4 --enable-thread-safety
--with-pgconfigdir=3D/export/home/josh/postgres7.4/bin
--with-pgsourcetree=3D/export/home/josh/postgresql-7.4.18

When i try to execute the this script
#!/bin/sh
slonik <<_EOF_
        cluster name =3D slony_example;
        node 1 admin conninfo =3D 'dbname=3D$MASTERDBNAME host=3D$MASTERHOST
user=3D$REPLICATIONUSER';
        node 2 admin conninfo =3D 'dbname=3D$SLAVEDBNAME host=3D$SLAVEHOST
user=3D$REPLICATIONUSER';
        init cluster ( id=3D1, comment =3D 'Master Node');
        create set (id=3D1, origin=3D1, comment=3D'All pgbench tables');
       set add table (set id=3D1, origin=3D1, id=3D1, fully qualified name =
=3D '
public.sample1', comment=3D'accounts table');
        store node (id=3D2, comment =3D 'Slave node');
        store path (server =3D 1, client =3D 2, conninfo=3D'dbname=3D$MASTE=
RDBNAME
host=3D$MASTERHOST user=3D$REPLICATIONUSER');
        store path (server =3D 2, client =3D 1, conninfo=3D'dbname=3D$SLAVE=
DBNAME
host=3D$SLAVEHOST user=3D$REPLICATIONUSER');
_EOF_

I get theis error
<stdin>:21: PGRES_FATAL_ERROR load '$libdir/xxid';  - ERROR:  could not load
library "/export/home/josh/postgres7.4/lib/xxid.so": ld.so.1: postgres:
fatal: relocation error: file /export/home/josh/postgres7.4/lib/xxid.so:
symbol GetTopTransactionId: referenced symbol not found
<stdin>:21: Error: the extension for the xxid data type cannot be loaded in
database 'dbname=3Dtestdb1 host=3D172.31.0.67 user=3Djosh'
<stdin>:21: ERROR: no admin conninfo for node 134701624

The same works fine between postgresql versions 8.1.10 and 8.2.5 .
Why do I get this error when replicating between versions 7.4 and8.1. Does
slony1 replicate between these 2 versions? If so is there any other settings
that needs to be done?

Thanks in advance
josh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071216/=
22231124/attachment.htm
From cichy1 at gmail.com  Mon Dec 17 05:22:01 2007
From: cichy1 at gmail.com (cichy)
Date: Mon Dec 17 05:22:05 2007
Subject: [Slony1-general] Re: selective data replication question
In-Reply-To: <20071213223135.GL7060@crankycanuck.ca>
References: <305b0d940712131228t79b10adwebed344e1b01b02f@mail.gmail.com>
	<20071213223135.GL7060@crankycanuck.ca>
Message-ID: <305b0d940712170522o735647e2w63b008eb2848d09d@mail.gmail.com>

On Dec 13, 2007 11:31 PM, Andrew Sullivan wrote:
> On Thu, Dec 13, 2007 at 09:28:20PM +0100, cichy wrote:
> >
> > So, it is not possible to make those records stay in the replicated
> > table in slave DB without adding there another table which will gather
> > data?
> > Maybe logging trigger could be modified or wrapped somehow, so it
> > doesn't log certain deletions?
>
> I suppose that with enough hacking on it, you could do this, but I'd suggest
> against it.  I know that there's a proposal afoot to do pre-filtering of
> change applications.  I think it was discussed on list here a couple months
> ago.
>

I'm going to use the safe method, as I'm not sure what side effects
might happen after modyfying replication mechanisms.
Thank You, for your help.

PR
From joshques at gmail.com  Mon Dec 17 05:28:09 2007
From: joshques at gmail.com (Josh Harrison)
Date: Mon Dec 17 05:28:12 2007
Subject: [Slony1-general] Help pls---slony error ---PGRES_FATAL_ERROR load
	'$libdir/xxid';
	the extension for the xxid data type cannot be loaded in database '
Message-ID: <8d89ea1d0712170528u2160bc9aq5f0b8fff39134f50@mail.gmail.com>

Hi
Im trying to replicate between postgres version 7.4.18 and version 8.1.10.
I configured postgres-7.4 with enable-thread-safety option
I configured slony1 with this command
./configure --prefix=3D/export/home/josh/slony7.4 --enable-thread-safety
--with-pgconfigdir=3D/export/home/josh/postgres7.4/bin
--with-pgsourcetree=3D/export/home/josh/postgresql-7.4.18

When i try to execute the this script
#!/bin/sh
slonik <<_EOF_
        cluster name =3D slony_example;
        node 1 admin conninfo =3D 'dbname=3D$MASTERDBNAME host=3D$MASTERHOST
user=3D$REPLICATIONUSER';
        node 2 admin conninfo =3D 'dbname=3D$SLAVEDBNAME host=3D$SLAVEHOST
user=3D$REPLICATIONUSER';
        init cluster ( id=3D1, comment =3D 'Master Node');
        create set (id=3D1, origin=3D1, comment=3D'All pgbench tables');
       set add table (set id=3D1, origin=3D1, id=3D1, fully qualified name =
=3D '
public.sample1', comment=3D'accounts table');
        store node (id=3D2, comment =3D 'Slave node');
        store path (server =3D 1, client =3D 2, conninfo=3D'dbname=3D$MASTE=
RDBNAME
host=3D$MASTERHOST user=3D$REPLICATIONUSER');
        store path (server =3D 2, client =3D 1, conninfo=3D'dbname=3D$SLAVE=
DBNAME
host=3D$SLAVEHOST user=3D$REPLICATIONUSER');
_EOF_

I get theis error
<stdin>:21: PGRES_FATAL_ERROR load '$libdir/xxid';  - ERROR:  could not load
library "/export/home/josh/postgres7.4/lib/xxid.so": ld.so.1: postgres:
fatal: relocation error: file /export/home/josh/postgres7.4/lib/xxid.so:
symbol GetTopTransactionId: referenced symbol not found
<stdin>:21: Error: the extension for the xxid data type cannot be loaded in
database 'dbname=3Dtestdb1 host=3D172.31.0.67 user=3Djosh'
<stdin>:21: ERROR: no admin conninfo for node 134701624

The same works fine between postgresql versions 8.1.10 and 8.2.5 .
Why do I get this error when replicating between versions 7.4 and8.1.
Does slony1 replicate between these 2 versions? If so is there any other
settings that needs to be done?

Please help as Im stuck with this error the last 4 days
Thanks in advance
josh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071217/=
7d4cd929/attachment.htm
From stephane.schildknecht at postgresqlfr.org  Mon Dec 17 05:40:58 2007
From: stephane.schildknecht at postgresqlfr.org (=?ISO-8859-1?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Mon Dec 17 05:41:05 2007
Subject: [Slony1-general] Different indexes on slave
In-Reply-To: <b10d372b0712161729r791fda12oc9c910ce32a98fce@mail.gmail.com>
References: <b10d372b0712131827n63ef1158y9bb6ca9336df8d1a@mail.gmail.com>
	<b10d372b0712161729r791fda12oc9c910ce32a98fce@mail.gmail.com>
Message-ID: <47667C6A.6000704@postgresqlfr.org>

James Tucker a ?crit :
>
> Hi All,
>
> We're currently running slony to replicate to our DR site.  We're
> looking at creating another reporting database at each site so our
> application can use that for reports etc, and the master for our
> normal oltp load.  The reporting database only needs a subset of the
> tables included in the DR set.
>
> I have 2 questions.
>
> Is there any reason we can't create different indexes (aimed at faster
> reports as apposed to OTLP) on the reporting slave ?

None. It's one of Slony advantages. Indexes can differ.

>
> Currently I just have one set that includes all our tables, am I able
> to create another set with just a selection of those tables ?  Or
> would I need to recreate my existing set, splitting it.
>
> i.e.
>
> set1 = table1, table2, table3
>
> set2 = table1, table2.

A table can't appear in two different sets. For instance, which
replication set will you break when executing a script that alters that
table?


Regards,

-- 
St?phane SCHILDKNECHT
Pr?sident de PostgreSQLFr
T?l. 09 53 69 97 12
http://www.postgresqlfr.org

From cbbrowne at ca.afilias.info  Mon Dec 17 07:17:58 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Mon Dec 17 07:18:48 2007
Subject: [Slony1-general] Help pls---slony error ---PGRES_FATAL_ERROR load
	'$libdir/xxid';
	the extension for the xxid data type cannot be loaded in database '
In-Reply-To: <8d89ea1d0712170528u2160bc9aq5f0b8fff39134f50@mail.gmail.com>
	(Josh Harrison's message of "Mon, 17 Dec 2007 08:28:09 -0500")
References: <8d89ea1d0712170528u2160bc9aq5f0b8fff39134f50@mail.gmail.com>
Message-ID: <60ve6x8i55.fsf@dba2.int.libertyrms.com>

"Josh Harrison" <joshques@gmail.com> writes:
> Im trying to replicate between postgres version 7.4.18 and version 8.1.10.
>
> I configured postgres-7.4 with enable-thread-safety option
>
> I configured slony1 with this command
>
> ./configure --prefix=/export/home/josh/slony7.4 --enable-thread-safety --with-pgconfigdir=/export/home/josh/postgres7.4/bin
> --with-pgsourcetree=/export/home/josh/postgresql-7.4.18

One minor problem there...  The "--enable-thread-safety" option is
unnecessary there.  It's not the Slony-I build that requires this
option; it's the PostgreSQL build that needs it.

> When i try to execute the this script
>
> #!/bin/sh
>
> slonik <<_EOF_
> ????????cluster name = slony_example;
>
> ????????node 1 admin conninfo = 'dbname=$MASTERDBNAME host=$MASTERHOST user=$REPLICATIONUSER';
> ??????? node 2 admin conninfo = 'dbname=$SLAVEDBNAME host=$SLAVEHOST user=$REPLICATIONUSER';
>
> ????????init cluster ( id=1, comment = 'Master Node');
>
> ????????create set (id=1, origin=1, comment='All pgbench tables');
> ?????? set add table (set id=1, origin=1, id=1, fully qualified name = 'public.sample1', comment='accounts table');
> ??????? store node (id=2, comment = 'Slave node');
> ??????? store path (server = 1, client = 2, conninfo='dbname=$MASTERDBNAME host=$MASTERHOST user=$REPLICATIONUSER');
> ??????? store path (server = 2, client = 1, conninfo='dbname=$SLAVEDBNAME host=$SLAVEHOST user=$REPLICATIONUSER');
> _EOF_
>
> ?
>
> I get theis error
>
> <stdin>:21: PGRES_FATAL_ERROR load '$libdir/xxid';? - ERROR:? could not load library "/export/home/josh/postgres7.4/lib/xxid.so": ld.so.1: postgres: fatal:
> relocation error: file /export/home/josh/postgres7.4/lib/xxid.so: symbol GetTopTransactionId: referenced symbol not found
> <stdin>:21: Error: the extension for the xxid data type cannot be loaded in database 'dbname=testdb1 host=172.31.0.67 user=josh'
> <stdin>:21: ERROR: no admin conninfo for node 134701624
>
> ?
>
> The same works fine between postgresql versions 8.1.10 and 8.2.5 .
>
> Why do I get this error when replicating between versions 7.4 and8.1.
> Does slony1 replicate between these 2 versions? If so is there any other settings that needs to be done?
>
> ?
> Please help as Im stuck with this error the last 4 days

The question has been asked before on the mailing list...

<http://lists.slony.info/pipermail/slony1-general/2006-September/004821.html>
-- 
let name="cbbrowne" and tld="cbbrowne.com" in String.concat "@" [name;tld];;
http://www3.sympatico.ca/cbbrowne/internet.html
"Running Windows on  a Pentium is like having a  brand new Porsche but
only be able to drive backwards with the handbrake on."
-- (Unknown source)
From joshques at gmail.com  Mon Dec 17 07:36:58 2007
From: joshques at gmail.com (Josh Harrison)
Date: Mon Dec 17 07:37:03 2007
Subject: [Slony1-general] Help pls---slony error ---PGRES_FATAL_ERROR load
	'$libdir/xxid';
	the extension for the xxid data type cannot be loaded in database '
In-Reply-To: <60ve6x8i55.fsf@dba2.int.libertyrms.com>
References: <8d89ea1d0712170528u2160bc9aq5f0b8fff39134f50@mail.gmail.com>
	<60ve6x8i55.fsf@dba2.int.libertyrms.com>
Message-ID: <8d89ea1d0712170736j36437bd2s132a63e78a2f37f7@mail.gmail.com>

On Dec 17, 2007 10:17 AM, Christopher Browne <cbbrowne@ca.afilias.info>
wrote:

> "Josh Harrison" <joshques@gmail.com> writes:
> > Im trying to replicate between postgres version 7.4.18 and version
> 8.1.10.
> >
> > I configured postgres-7.4 with enable-thread-safety option
> >
> > I configured slony1 with this command
> >
> > ./configure --prefix=3D/export/home/josh/slony7.4 --enable-thread-safety
> --with-pgconfigdir=3D/export/home/josh/postgres7.4/bin
> > --with-pgsourcetree=3D/export/home/josh/postgresql-7.4.18
>
> One minor problem there...  The "--enable-thread-safety" option is
> unnecessary there.  It's not the Slony-I build that requires this
> option; it's the PostgreSQL build that needs it.
>
> > When i try to execute the this script
> >
> > #!/bin/sh
> >
> > slonik <<_EOF_
> > cluster name =3D slony_example;
> >
> > node 1 admin conninfo =3D 'dbname=3D$MASTERDBNAME host=3D$MASTERHOST
> user=3D$REPLICATIONUSER';
> > node 2 admin conninfo =3D 'dbname=3D$SLAVEDBNAME host=3D$SLAVEHOST
> user=3D$REPLICATIONUSER';
> >
> > init cluster ( id=3D1, comment =3D 'Master Node');
> >
> > create set (id=3D1, origin=3D1, comment=3D'All pgbench tables');
> > set add table (set id=3D1, origin=3D1, id=3D1, fully qualified name =3D=
 '
> public.sample1', comment=3D'accounts table');
> > store node (id=3D2, comment =3D 'Slave node');
> > store path (server =3D 1, client =3D 2, conninfo=3D'dbname=3D$MASTERDBN=
AME
> host=3D$MASTERHOST user=3D$REPLICATIONUSER');
> > store path (server =3D 2, client =3D 1, conninfo=3D'dbname=3D$SLAVEDBNA=
ME
> host=3D$SLAVEHOST user=3D$REPLICATIONUSER');
> > _EOF_
> >
> >
> >
> > I get theis error
> >
> > <stdin>:21: PGRES_FATAL_ERROR load '$libdir/xxid'; - ERROR: could not
> load library "/export/home/josh/postgres7.4/lib/xxid.so": ld.so.1:
> postgres: fatal:
> > relocation error: file /export/home/josh/postgres7.4/lib/xxid.so: symbol
> GetTopTransactionId: referenced symbol not found
> > <stdin>:21: Error: the extension for the xxid data type cannot be loaded
> in database 'dbname=3Dtestdb1 host=3D172.31.0.67 user=3Djosh'
> > <stdin>:21: ERROR: no admin conninfo for node 134701624
> >
> >
> >
> > The same works fine between postgresql versions 8.1.10 and 8.2.5 .
> >
> > Why do I get this error when replicating between versions 7.4 and8.1.
> > Does slony1 replicate between these 2 versions? If so is there any other
> settings that needs to be done?
> >
> >
> > Please help as Im stuck with this error the last 4 days
>
> The question has been asked before on the mailing list...
>
> <
> http://lists.slony.info/pipermail/slony1-general/2006-September/004821.ht=
ml
> >
> --


Thanks....
I solved the problem.
I configured postgresql and slony again from the scratch and removed all the
other versions of postgres that I had installed in my system.And it worked
just fine now.
I still dont know what was giving the problem before !!!anyhow the problem
was solved..
Thanks again
josh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071217/=
9ea2d14d/attachment.htm
From vivek at khera.org  Mon Dec 17 08:13:33 2007
From: vivek at khera.org (Vivek Khera)
Date: Mon Dec 17 08:13:38 2007
Subject: [Slony1-general] will truncate mess up slony?
Message-ID: <5680D695-0B45-49CB-9DDE-CB3511B1CE0E@khera.org>

I'm about to split a big table of mine using partitions.  I've done  
some testing on a test database, and the part of actually moving the  
data from the current table to each partition will take about 5 days,  
broken up into small bits of work as transactions.

Once the data is moved, I am left with a HUGE table which is otherwise  
empty.  A test run of "vacuum full" on the table takes nearly 2  
hours.  I can't really afford that on the production system, obviously.

So my question is, how to use TRUNCATE on that table?  Since it is  
already empty, does it matter to slony if I just issue TRUNCATE on  
each of the nodes?  Or do I need to go through the execute script  
slonik command?  Also, is TRUNCATE in this manner safe at all for slony?

Thanks!

From wmoran at collaborativefusion.com  Mon Dec 17 08:22:08 2007
From: wmoran at collaborativefusion.com (Bill Moran)
Date: Mon Dec 17 08:22:14 2007
Subject: [Slony1-general] will truncate mess up slony?
In-Reply-To: <5680D695-0B45-49CB-9DDE-CB3511B1CE0E@khera.org>
References: <5680D695-0B45-49CB-9DDE-CB3511B1CE0E@khera.org>
Message-ID: <20071217112208.2e52f508.wmoran@collaborativefusion.com>

In response to Vivek Khera <vivek@khera.org>:

> I'm about to split a big table of mine using partitions.  I've done  
> some testing on a test database, and the part of actually moving the  
> data from the current table to each partition will take about 5 days,  
> broken up into small bits of work as transactions.
> 
> Once the data is moved, I am left with a HUGE table which is otherwise  
> empty.  A test run of "vacuum full" on the table takes nearly 2  
> hours.  I can't really afford that on the production system, obviously.
> 
> So my question is, how to use TRUNCATE on that table?  Since it is  
> already empty, does it matter to slony if I just issue TRUNCATE on  
> each of the nodes?  Or do I need to go through the execute script  
> slonik command?  Also, is TRUNCATE in this manner safe at all for slony?

Personally, I would remove the table from replication, truncate it on all
nodes then add it back in to replication.  The initial sync won't take
long since the table is empty.

I doubt that's the only way possible, though.  What you are suggesting
_might_ be OK, but I don't know.

-- 
Bill Moran
Collaborative Fusion Inc.
http://people.collaborativefusion.com/~wmoran/

wmoran@collaborativefusion.com
Phone: 412-422-3463x4023
From vivek at khera.org  Mon Dec 17 08:31:10 2007
From: vivek at khera.org (Vivek Khera)
Date: Mon Dec 17 08:31:15 2007
Subject: [Slony1-general] will truncate mess up slony?
In-Reply-To: <20071217112208.2e52f508.wmoran@collaborativefusion.com>
References: <5680D695-0B45-49CB-9DDE-CB3511B1CE0E@khera.org>
	<20071217112208.2e52f508.wmoran@collaborativefusion.com>
Message-ID: <7C7962B9-809A-498E-9FFB-C96F432C8B83@khera.org>


On Dec 17, 2007, at 11:22 AM, Bill Moran wrote:

> Personally, I would remove the table from replication, truncate it  
> on all
> nodes then add it back in to replication.  The initial sync won't take
> long since the table is empty.
>
> I doubt that's the only way possible, though.  What you are suggesting
> _might_ be OK, but I don't know.

Hmmmm....  I guess that'd work... once I finish splitting and  
replicating the partitions I can drop the table from replication and  
not worry about it :-)

From cbbrowne at ca.afilias.info  Mon Dec 17 09:13:06 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Mon Dec 17 09:13:12 2007
Subject: [Slony1-general] will truncate mess up slony?
In-Reply-To: <7C7962B9-809A-498E-9FFB-C96F432C8B83@khera.org> (Vivek Khera's
	message of "Mon, 17 Dec 2007 11:31:10 -0500")
References: <5680D695-0B45-49CB-9DDE-CB3511B1CE0E@khera.org>
	<20071217112208.2e52f508.wmoran@collaborativefusion.com>
	<7C7962B9-809A-498E-9FFB-C96F432C8B83@khera.org>
Message-ID: <601w9l8ct9.fsf@dba2.int.libertyrms.com>

Vivek Khera <vivek@khera.org> writes:
> On Dec 17, 2007, at 11:22 AM, Bill Moran wrote:
>
>> Personally, I would remove the table from replication, truncate it
>> on all
>> nodes then add it back in to replication.  The initial sync won't take
>> long since the table is empty.
>>
>> I doubt that's the only way possible, though.  What you are suggesting
>> _might_ be OK, but I don't know.
>
> Hmmmm....  I guess that'd work... once I finish splitting and
> replicating the partitions I can drop the table from replication and
> not worry about it :-)

I like the "drop it from replication" then "not need to worry about
TRUNCATE effects."
-- 
(format nil "~S@~S" "cbbrowne" "linuxdatabases.info")
http://cbbrowne.com/info/
There are  three kinds of people:  those who can count,  and those who
can't.
From cbbrowne at ca.afilias.info  Mon Dec 17 12:48:35 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Mon Dec 17 12:48:46 2007
Subject: [Slony1-general] Changes to cleanup thread
In-Reply-To: <1197654469.15521.148.camel@ebony.site> (Simon Riggs's message of
	"Fri, 14 Dec 2007 17:47:49 +0000")
References: <601wavf4kp.fsf@dba2.int.libertyrms.com>
	<47396E63.8080106@free.fr> <473C54EB.7060904@postgresqlfr.org>
	<47419D07.7030605@free.fr> <1197564745.4255.1845.camel@ebony.site>
	<607ijh9qbe.fsf@dba2.int.libertyrms.com>
	<1197654469.15521.148.camel@ebony.site>
Message-ID: <60sl216o9o.fsf_-_@dba2.int.libertyrms.com>

Simon Riggs <simon@2ndquadrant.com> writes:
> On Fri, 2007-12-14 at 11:47 -0500, Christopher Browne wrote:
>> Simon Riggs <simon@2ndquadrant.com> writes:
>
>> > I can't remember where we left the earlier discussion on the vacuuming.
>> > Did you want me to make a patch, or can I leave it with you guys? No
>> > reason to rush at all my end, just trying to remember where we were.
>> 
>> Actually, if you have have code in mind, I'd be pleased to see a
>> patch.  It would seem a good thing to enlarge the set of people that
>> have some familiarity with the internals :-).
>
> OK. Will do early next week.

FYI, the bulk of the code traditionally lived in the C file,
src/slon/cleanup_thread.c, and was mostly implemented in C.  I think
this was because the XXID code was pretty "hackish," and not terribly
nicely accessible or manipulable as "native SQL."

I think that what with the txid type being native, in 8.3, this code
might now all be able to go into a stored procedure, into
src/backend/slony1_funcs.sql, and most of the code should now be able
to be cleaner and *way* easier to maintain as pl/pgsql.  If we're
eliminating VACUUM, then in principle, substantially all the code
ought to be able to reside in the pl/pgsql function cleanupEvent().

I think it warrants having some more discussion of what the shape of
policy for this ought to be.

I had a discussion this afternoon with the Data Services manager, who
brought up the point that there may be some value to consciously
keeping sl_log_* data for rather longer periods of time than is
presently the case.  

Jan is doing some work on "CLONE NODE" functionality; as things stand,
right now, the understanding of how it would work, as a series of
activities, is something like:

 - Submit a "CLONE NODE(source id=3, dest id=6)" request, indicating
   that we intend to duplicate node #3 onto node #6.

   This would start putting "placeholder data" into place for node #6,
   indicating, notably, that it will be a copy of node #3, and 
   enforcing that sl_log_* data needs to be kept around.

 - Take a dump of node #3, and start loading it into node #6.

   In Pg 8.3+Slony-I-HEAD, with the absence of the "catalog smashing"
   of earlier versions, this might be done either via "pg_dump | psql"
   or via PITR or via some "disk array snapshotting" capability.
   All should provide equally legitimate databases.

 - Once node #6 has been fully loaded, run a "MUTATE NODE" against it.

   This would cause it to rename vital internal bits to indicate that
   it's now node #6, not node #3.

   Add in a STORE PATH or two and some SUBSCRIBE SET function calls
   and node #6 will be able to start reporting in how far behind it
   *really* is, and it can join the cluster as a real node.

At present, the "placeholder bit" is a necessary precursor - you need
to have something that's holding off the system from purging out
elderly sl_event/sl_confirm/sl_log_* data, otherwise, default
behaviour will tend to lead to them being trimmed out as quickly as 10
minutes after things have propagated.  (There's a '10 minute' interval
in function cleanupEvent() in src/backend/slony1_funcs.sql.)

It could be that we should be planning for a much longer lifecycle for
that data, that we tend to keep ~2 days worth of old data, so that we
could take a nightly pg_dump and choose to use it as much as a day
later to populate a new node.

The right answer may be for the interval (currently 10 minutes) to be
a parameter passed by slon to cleanupEvent.
-- 
output = ("cbbrowne" "@" "linuxdatabases.info")
http://linuxdatabases.info/info/linuxxian.html
"Armenians   and   Azerbaijanis  in   Stepanakert,   capital  of   the
Nagorno-Karabakh autonomous  region, rioted over  much needed spelling
reform in the Soviet Union."  -- Rolling Stone's '88 Year in Review
From jameshtucker at gmail.com  Mon Dec 17 15:41:40 2007
From: jameshtucker at gmail.com (James Tucker)
Date: Mon Dec 17 15:41:56 2007
Subject: [Slony1-general] Different indexes on slave
In-Reply-To: <2c5101c840b9$c40cea29$1a5811ac@ana.firstamdata.com>
References: <2c5101c840b9$c40cea29$1a5811ac@ana.firstamdata.com>
Message-ID: <b10d372b0712171541j1d170348w92d2a29fda85c5db@mail.gmail.com>

Thanks very much.  What is the best way to take the slave out of read only
mode so we can alter indexes etc ?

On Dec 18, 2007 12:33 AM, Tomeh, Husam <HTomeh@facorelogic.com> wrote:

>
> Please see my comments below.
>
> -----Original Message-----
> From: "James Tucker" <jameshtucker@gmail.com>
> To: "slony1-general@lists.slony.info" <slony1-general@lists.slony.info>
> Sent: 12/16/2007 5:30 PM
> Subject: [Slony1-general] Different indexes on slave
>
> Hi All,
>
> We're currently running slony to replicate to our DR site.  We're looking
> at
> creating another reporting database at each site so our application can
> use
> that for reports etc, and the master for our normal oltp load.  The
> reporting database only needs a subset of the tables included in the DR
> set.
>
>
> I have 2 questions.
>
> Is there any reason we can't create different indexes (aimed at faster
> reports as apposed to OTLP) on the reporting slave ?
>
> [Husam: you should be able to do so. Actually this is one of the
> advantages of Slony triggered-based replication system.]
>
> Currently I just have one set that includes all our tables, am I able to
> create another set with just a selection of those tables ?  Or would I
> need
> to recreate my existing set, splitting it.
>
> [Husam: breaking your set would give you more flexblity - that'd be a good
> choice.]
>
> i.e.
>
> set1 =3D table1, table2, table3
>
> set2 =3D table1, table2.
>
> Thanks in advance.
>
> James
>
>
> **********************************************************************
> This message contains confidential information intended only for the use
> of the addressee(s) named above and may contain information that is legal=
ly
> privileged.  If you are not the addressee, or the person responsible for
> delivering it to the addressee, you are hereby notified that reading,
> disseminating, distributing or copying this message is strictly prohibite=
d.
>  If you have received this message by mistake, please immediately notify =
us
> by replying to the message and delete the original message immediately
> thereafter.
>
> Thank you.
>
>                                   FADLD Tag
> **********************************************************************
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071218/=
be588494/attachment.htm
From cbbrowne at ca.afilias.info  Mon Dec 17 15:57:50 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Mon Dec 17 15:58:03 2007
Subject: [Slony1-general] Different indexes on slave
In-Reply-To: <b10d372b0712171541j1d170348w92d2a29fda85c5db@mail.gmail.com>
	(James Tucker's message of "Tue, 18 Dec 2007 09:41:40 +1000")
References: <2c5101c840b9$c40cea29$1a5811ac@ana.firstamdata.com>
	<b10d372b0712171541j1d170348w92d2a29fda85c5db@mail.gmail.com>
Message-ID: <60hcig7u2p.fsf@dba2.int.libertyrms.com>

"James Tucker" <jameshtucker@gmail.com> writes:
> Thanks very much.? What is the best way to take the slave out of
> read only mode so we can alter indexes etc ?

You don't need to.

1.  You must NOT touch the key being used as the primary key.  Touch
it, and replication is liable to fail on that table, and break
overall.

2.  The database isn't in any "read only mode;" the replicated tables
are set up to forbid direct updates via INSERT/UPDATE/DELETE.  That
does not prevent you from doing what you wish with indexes.

Feel free to do...

  CREATE INDEX FOO on BAR(a,b,c);
-- 
let name="cbbrowne" and tld="linuxfinances.info" in name ^ "@" ^ tld;;
http://linuxdatabases.info/info/rdbms.html
Signs of a  Klingon   Programmer #5:  "I  have  challenged the  entire
quality assurance team to a Bat-Leth contest. They will not concern us
again."
From cbbrowne at ca.afilias.info  Mon Dec 17 16:03:50 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Mon Dec 17 16:04:02 2007
Subject: [Slony1-general] Changes to cleanup thread
In-Reply-To: <60sl216o9o.fsf_-_@dba2.int.libertyrms.com> (Christopher Browne's
	message of "Mon, 17 Dec 2007 15:48:35 -0500")
References: <601wavf4kp.fsf@dba2.int.libertyrms.com>
	<47396E63.8080106@free.fr> <473C54EB.7060904@postgresqlfr.org>
	<47419D07.7030605@free.fr> <1197564745.4255.1845.camel@ebony.site>
	<607ijh9qbe.fsf@dba2.int.libertyrms.com>
	<1197654469.15521.148.camel@ebony.site>
	<60sl216o9o.fsf_-_@dba2.int.libertyrms.com>
Message-ID: <60d4t47tsp.fsf@dba2.int.libertyrms.com>

Christopher Browne <cbbrowne@ca.afilias.info> writes:
>> OK. Will do early next week.

> I think it warrants having some more discussion of what the shape of
> policy for this ought to be.

I had a further chat with Jan, and it points at some further ideas
about policy...

> The right answer may be for the interval (currently 10 minutes) to be
> a parameter passed by slon to cleanupEvent.

That's one piece that would seem worthwhile.

It seems as though we might want two new parameters to this.

1.  Give the user the option of continuing to use the DELETE logic as
    it stands now.  Choice seems like a good thing.

2.  The interval value that presently is a constant value function
    cleanupEvent() should become a slon parameter, to allow the
    user to pick how long to keep old data.

    If that value is, say, 48h, then a pg_dump of a subscriber will be
    a candidate for being useful for CLONE NODE until the end of that
    48h period.

    That makes the dump a fair bit more valuable.
-- 
output = ("cbbrowne" "@" "ca.afilias.info")
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
From joshques at gmail.com  Tue Dec 18 05:13:45 2007
From: joshques at gmail.com (Josh Harrison)
Date: Tue Dec 18 05:13:48 2007
Subject: [Slony1-general] Slony table locking question
Message-ID: <8d89ea1d0712180513sa7c3228na184d2d94a1c10f3@mail.gmail.com>

Hi,
Im replicating a database from postrges 7.4(master) to 8.1(slave). This is
a test database of size 6GB. I see all the tables in the slave replication
set are being locked and Im not able to access them.
Is this the behavior or did I do something wrong here?
I thought slony allows the query to be queried when the replication is in
progress? So you cant query the slave during the replication?
thanks
josh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071218/=
4599adb6/attachment.htm
From cbbrowne at ca.afilias.info  Tue Dec 18 06:38:20 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Tue Dec 18 06:38:25 2007
Subject: [Slony1-general] Slony table locking question
In-Reply-To: <8d89ea1d0712180513sa7c3228na184d2d94a1c10f3@mail.gmail.com>
	(Josh Harrison's message of "Tue, 18 Dec 2007 08:13:45 -0500")
References: <8d89ea1d0712180513sa7c3228na184d2d94a1c10f3@mail.gmail.com>
Message-ID: <60hcig83vn.fsf@dba2.int.libertyrms.com>

"Josh Harrison" <joshques@gmail.com> writes:
> Im replicating a database from postrges 7.4(master) to 8.1(slave). This is? a test database of size 6GB. I see all the tables in the slave replication set are being
> locked and Im not able to access them.
> Is this the behavior or did I do something wrong here?
> I thought slony allows the query to be queried when the replication is in progress? So you cant query the slave during the replication?

You are seeing the intended behaviour.

Data is loaded, initially, as one rather large transaction.  (This has
always been the case.)  The result of that is that the initial set of
data is not visible until the subscription completes.

In 1.1 and earlier, the tables were not completely locked; locks were
acquired as work was done, which would progress things up to,
eventually, exclusive locks on the tables in order to add in triggers.
Unfortunately, this sometimes permitted deadlocks.  So in 1.2, the
locks are immediately escalated to table locks right from the start.

It's not really in any sense "worse" than before; you never could have
had access to data in the tables.
-- 
(reverse (concatenate 'string "ofni.secnanifxunil" "@" "enworbbc"))
http://www3.sympatico.ca/cbbrowne/languages.html
TECO Madness: a moment of regret, a lifetime of convenience.
-- Kent Pitman
From joshques at gmail.com  Tue Dec 18 07:01:28 2007
From: joshques at gmail.com (Josh Harrison)
Date: Tue Dec 18 07:01:32 2007
Subject: [Slony1-general] Slony table locking question
In-Reply-To: <60hcig83vn.fsf@dba2.int.libertyrms.com>
References: <8d89ea1d0712180513sa7c3228na184d2d94a1c10f3@mail.gmail.com>
	<60hcig83vn.fsf@dba2.int.libertyrms.com>
Message-ID: <8d89ea1d0712180701x1715944ah9b24a7a085e1444f@mail.gmail.com>

On Dec 18, 2007 9:38 AM, Christopher Browne <cbbrowne@ca.afilias.info>
wrote:

> "Josh Harrison" <joshques@gmail.com> writes:
> > Im replicating a database from postrges 7.4(master) to 8.1(slave). This
> is a test database of size 6GB. I see all the tables in the slave
> replication set are being
> > locked and Im not able to access them.
> > Is this the behavior or did I do something wrong here?
> > I thought slony allows the query to be queried when the replication is
> in progress? So you cant query the slave during the replication?
>
> You are seeing the intended behaviour.
>
> Data is loaded, initially, as one rather large transaction.  (This has
> always been the case.)  The result of that is that the initial set of
> data is not visible until the subscription completes.
>
> In 1.1 and earlier, the tables were not completely locked; locks were
> acquired as work was done, which would progress things up to,
> eventually, exclusive locks on the tables in order to add in triggers.
> Unfortunately, this sometimes permitted deadlocks.  So in 1.2, the
> locks are immediately escalated to table locks right from the start.
>
> It's not really in any sense "worse" than before; you never could have
> had access to data in the tables.
> --

Thanks. So is this the case anytime the slaves are replicating ie., you cant
query the slaves when they are replicating the data anytime whether
initially to catch up with the bulk data or later even for small data
updates/inserts?

Also I came across another problem now. When the slave is replicating the
data, it stopped since there was no disk space. So now I deleted some other
unnecassary database in that disk and the disk has space now. But it will
not resume te replication. Is that common. When i checked the salve's log it
says
......
......
2007-12-18 09:54:42 EST DEBUG2 remoteWorkerThread_1: all tables for set 1
found on subscriber
2007-12-18 09:54:42 EST DEBUG2 remoteWorkerThread_1: copy table
"public"."a_method"
2007-12-18 09:54:42 EST DEBUG3 remoteWorkerThread_1: table
"public"."a_method" does not require Slony-I serial key
2007-12-18 09:54:42 EST ERROR  remoteWorkerThread_1: "select
"_slony_rmrs".setAddTable_int(1, 2,
 '"public"."a_method"', 'a_method_pk', 'a_method table'); "
PGRES_FATAL_ERROR ERRO
R:  Slony-I: setAddTable_int: table id 2 has already been assigned!
2007-12-18 09:54:42 EST WARN   remoteWorkerThread_1: data copy for set 1
failed - sleep 60 seconds.

Before the 'no disk space' problem it had copied some tables's data..say the
first few tables. So how can I make it resume the replication from where it
stopped?

This is the slony slave's log message when the error happened
2007-12-18 08:54:08 EST ERROR  remoteWorkerThread_1: "select
"_slony_rmrs".finishTableAfterCopy(
6); analyze "public"."c_var"; " PGRES_FATAL_ERROR ERROR:  could not write
block 4807
55 of relation 1663/44356/48354: No space left on device
CONTEXT:  SQL statement "reindex table "public"."c_var""
PL/pgSQL function "finishtableaftercopy" line 26 at execute statement
2007-12-18 08:54:08 EST WARN   remoteWorkerThread_1: data copy for set 1
failed - sleep 15 seconds

Thanks
josh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071218/=
c5693353/attachment-0001.htm
From cbbrowne at ca.afilias.info  Tue Dec 18 08:03:36 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Tue Dec 18 08:03:41 2007
Subject: [Slony1-general] Slony table locking question
In-Reply-To: <8d89ea1d0712180701x1715944ah9b24a7a085e1444f@mail.gmail.com>
	(Josh Harrison's message of "Tue, 18 Dec 2007 10:01:28 -0500")
References: <8d89ea1d0712180513sa7c3228na184d2d94a1c10f3@mail.gmail.com>
	<60hcig83vn.fsf@dba2.int.libertyrms.com>
	<8d89ea1d0712180701x1715944ah9b24a7a085e1444f@mail.gmail.com>
Message-ID: <608x3s6ld3.fsf@dba2.int.libertyrms.com>

"Josh Harrison" <joshques@gmail.com> writes:
> Thanks. So is this the case anytime the slaves are replicating ie.,
> you cant query the slaves when they are replicating the data anytime
> whether initially to catch up with the bulk data or later even for
> small data updates/inserts?

When applying SYNCs to catch up, or as normal activity, the replicated
tables are not exclusively locked.  The entire SYNC is managed as a
single transaction, so the tuples involved in the update will
obviously be locked for the duration of that transaction, but that's
normally not a long time.

The set of activities that take out locks are documented in the manual
pages.


> Also I came across another problem now. When the slave is replicating the data, it stopped since there was no disk space. So now I deleted some other unnecassary
> database in that disk and the disk has space now. But it will not resume te replication. Is that common. When i checked the salve's log it says
> ......
> ......
> 2007-12-18 09:54:42 EST DEBUG2 remoteWorkerThread_1: all tables for set 1 found on subscriber
> 2007-12-18 09:54:42 EST DEBUG2 remoteWorkerThread_1: copy table "public"."a_method"
> 2007-12-18 09:54:42 EST DEBUG3 remoteWorkerThread_1: table "public"."a_method" does not require Slony-I serial key
> 2007-12-18 09:54:42 EST ERROR? remoteWorkerThread_1: "select "_slony_rmrs".setAddTable_int(1, 2,
> ?'"public"."a_method"', 'a_method_pk', 'a_method table'); " PGRES_FATAL_ERROR ERRO
> R:? Slony-I: setAddTable_int: table id 2 has already been assigned!
> 2007-12-18 09:54:42 EST WARN?? remoteWorkerThread_1: data copy for set 1 failed - sleep 60 seconds.
> Before the 'no disk space' problem it had copied some tables's data..say the first few tables. So how can I make it resume the replication from where it stopped?
> This is the slony slave's log message when the error happened
> 2007-12-18 08:54:08 EST ERROR? remoteWorkerThread_1: "select "_slony_rmrs".finishTableAfterCopy(
> 6); analyze "public"."c_var"; " PGRES_FATAL_ERROR ERROR:? could not write block 4807
> 55 of relation 1663/44356/48354: No space left on device
> CONTEXT:? SQL statement "reindex table "public"."c_var""
> PL/pgSQL function "finishtableaftercopy" line 26 at execute statement
> 2007-12-18 08:54:08 EST WARN?? remoteWorkerThread_1: data copy for set 1 failed - sleep 15 seconds

I'd be inclined to drop the node and recreate it.  That would be sure
to clean things out.

Note that when it gave up on copying the data, it gave up on ALL the
data; there's nothing to resume.
-- 
let name="cbbrowne" and tld="acm.org" in name ^ "@" ^ tld;;
http://linuxdatabases.info/info/
You know  how most packages say  "Open here". What is  the protocol if
the package says, "Open somewhere else"?
From joshques at gmail.com  Tue Dec 18 11:21:12 2007
From: joshques at gmail.com (Josh Harrison)
Date: Tue Dec 18 11:21:20 2007
Subject: [Slony1-general] pgpool-II & slony installation question
Message-ID: <8d89ea1d0712181121x77d2243cpb13f52b5e8d4ae15@mail.gmail.com>

Hi
Im currently testing postgres replication with slony and it seems to be
working fine. I want to install pgpool-II to this set-up for load balance
and failover detection. Im not sure where to start. Can you point me to the
right place...website or documentation that illustrates this set-up?

Thanks
josh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071218/=
d2f1d733/attachment.htm
From lists at serioustechnology.com  Tue Dec 18 11:45:06 2007
From: lists at serioustechnology.com (Geoffrey)
Date: Tue Dec 18 11:45:15 2007
Subject: [Slony1-general] multi database replication
Message-ID: <47682342.1020805@serioustechnology.com>

I want to make sure that I configure this thing right.  What we are 
doing is replicating multiple 11 databases that are currently running on 
the same machine to a replication machine.  So, we have 11 postmasters 
running on the production machine and will have the same on the 
replication machine.

What I need to do is configure Slony so that I can start the replication 
process on one database at a time.  I'm wondering if anyone else is 
doing something like this and might be able to share insights on how 
this should be configured in the slon_tools.conf file.

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From lists at serioustechnology.com  Tue Dec 18 16:36:11 2007
From: lists at serioustechnology.com (Geoffrey)
Date: Tue Dec 18 16:36:24 2007
Subject: [Slony1-general] error when running slonik_create_set
Message-ID: <4768677B.8020201@serioustechnology.com>

The first time I attempted to run slonik_create_set, I discovered I had 
a table that did not have a primary key.  I don't need to replicate this 
table so I removed it from my configuration file.  I received the 
following error which was quite clear to me:

<stdin>:162: PGRES_FATAL_ERROR select
"_esc_cluster".determineIdxnameUnique('public.esc_class', NULL);  - ERROR:
Slony-I: table "public"."esc_class" has no primary key


So I ran slonik_drop_set and then re-ran slonik_create_set.  I then 
received a similar error:

<stdin>:374: PGRES_FATAL_ERROR select 
"_esc_cluster".determineIdxnameUnique('public.65280', NULL);  - ERROR:
Slony-I: determineIdxnameUnique(): table "public"."65280" not found


It appears to me that it's looking for a table named 65280, but I do not 
have any such table in my slon_tools.conf file.

Any clues as to what is going on here would be appreciated.

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From lists at serioustechnology.com  Tue Dec 18 16:48:23 2007
From: lists at serioustechnology.com (Geoffrey)
Date: Tue Dec 18 16:48:37 2007
Subject: [Slony1-general] error when running slonik_create_set
In-Reply-To: <4768677B.8020201@serioustechnology.com>
References: <4768677B.8020201@serioustechnology.com>
Message-ID: <47686A57.10803@serioustechnology.com>

Geoffrey wrote:
> The first time I attempted to run slonik_create_set, I discovered I had 
> a table that did not have a primary key.  I don't need to replicate this 
> table so I removed it from my configuration file.  I received the 
> following error which was quite clear to me:
> 
> <stdin>:162: PGRES_FATAL_ERROR select
> "_esc_cluster".determineIdxnameUnique('public.esc_class', NULL);  - ERROR:
> Slony-I: table "public"."esc_class" has no primary key
> 
> 
> So I ran slonik_drop_set and then re-ran slonik_create_set.  I then 
> received a similar error:
> 
> <stdin>:374: PGRES_FATAL_ERROR select 
> "_esc_cluster".determineIdxnameUnique('public.65280', NULL);  - ERROR:
> Slony-I: determineIdxnameUnique(): table "public"."65280" not found
> 
> 
> It appears to me that it's looking for a table named 65280, but I do not 
> have any such table in my slon_tools.conf file.
> 
> Any clues as to what is going on here would be appreciated.

A little more info.  When looking at the output of slonik_create_set, 
the error comes just after adding a table named 'settle.'  The weird 
thing is that the next few tables in the slon_tools.conf file are:

stat, system, trac

But the output attempts to add a table named 65280, then the 'trac' 
table, so I don't see it trying to add the 'stat' or 'system' tables.

After this one anomaly, the rest of the output is correct.


-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From casey at pandora.com  Wed Dec 19 12:51:16 2007
From: casey at pandora.com (Casey Duncan)
Date: Wed Dec 19 12:51:30 2007
Subject: [Slony1-general] Bad failure mode encountered during EXECUTE SCRIPT
	(maybe fixed in 1.2.12?)
Message-ID: <146890A2-158F-4623-BA15-3B42B06D94D8@pandora.com>

Running slony 1.2.10 we encountered an issue with a schema upgrade  
when it propagated to the secondary in a two-node slony mirror. Our  
typical procedure for doing schema upgrades is as follows:

1, Point the application server clients to the secondary (the app  
becomes "read-only" as a result)
2. After a few minutes, turn off the slon daemons so we can control  
when the schema changes propagate
3. Appy the schema changes (to the primary) via slonik using execute  
script also adding and removing tables from the replication set as  
needed.
4. After the upgrade completes on the primary, point the app servers  
back to it, so the secondary is quiet.
5. Turn on the slon daemons and wait for the changes to propagate to  
the secondary.
6. Go to sleep or play video games or what-have-you 8^)

This has worked well for us for dozens (if not hundreds) of upgrades,  
with very occasional hiccups in step 5 due to timing related issues  
(when adding tables, etc).  Last night though we had a problem with  
step 4, a wedged pgpool process prevented the app servers from  
switching back to the primary. When we tried to switch them, the  
timed out trying to connect and spontaneously failed over to the  
secondary once again as they are programmed to. Unfortunately this  
went unnoticed as we proceeded to step 5. Due to the level of  
concurrency, this lead to the following deadlock error on the secondary:

2007-12-18 21:41:12.174 PST [d:radio_prod_seg11 u:slony p:6313 9]  
ERROR:  deadlo
ck detected
2007-12-18 21:41:12.174 PST [d:radio_prod_seg11 u:slony p:6313 10]  
DETAIL:  Proc
ess 6313 waits for AccessExclusiveLock on relation 20355 of database  
19833; bloc
ked by process 11991.
         Process 11991 waits for AccessShareLock on relation 20083 of  
database 19
833; blocked by process 6313.
2007-12-18 21:41:12.174 PST [d:radio_prod_seg11 u:slony p:6313 11]  
CONTEXT:  SQL
  statement "lock table "public"."feedback_packed" in access  
exclusive mode"
         PL/pgSQL function "altertableforreplication" line 53 at  
execute statemen
t
         SQL statement "SELECT  "_radio".alterTableForReplication( $1 )"
         PL/pgSQL function "ddlscript_complete_int" line 11 at perform
2007-12-18 21:41:12.174 PST [d:radio_prod_seg11 u:slony p:6313 12]  
STATEMENT:  s
elect "_radio".ddlScript_complete_int(1, -1);

Unfortunately this too went unnoticed at first, what we did notice  
was that the app servers were still failed over and we couldn't  
connect to the primary. This was quickly tracked down to the problem  
with pgpool which was fixed by restarting it. After that, we  
succeeded in switching the app servers back to the primary.

At that point the slon daemons were running, but the secondary daemon  
was not getting anywhere. A look at the logs revealed this error:

ERROR  remoteWorkerThread_1: "select "_radio".ddlScript_prepare_int 
(1, -1); " PGRES_FATAL_ERROR ERROR:  Slony-I: alterTableRestore():  
Table "public"."settlement_log" is not in altered state
  INFO  <output from /usr/lib/postgresql/bin/slon> CONTEXT:  SQL  
statement "SELECT  "_radio".alterTableRestore( $1 )"

This resulted in a bit of a sinking feeling in my gut, since I knew  
this likely meant that none of the replicated tables were in the  
altered state, thus none of the slony triggers were present to  
prevent data from being written to the secondary. A quick look at the  
tables revealed this to be the case. Unfortunately by this time the  
app servers were happily writing to the primary, thus the mirror was  
broken and the slony pair was hosed.

So the end result was that data got written to the secondary, and is  
more-or-less lost because other rows with the same primary key values  
got added to the primary subsequent to that.

This situation points to a lack of atomicity in execute script.  
Obviously the removal of the slony trigggers and the schema changes  
were applied in a separate transaction from the restoration of the  
triggers. This leads to this dangerous possibly that the former will  
succeed but the latter will fail, leading to the issue I ran into here.

Glancing at the changelog for slony 1.2.12, there appear to be  
changes around transaction handling in execute script. Would those  
changes prevent this problem? Note I plan to upgrade soon anyway, but  
obviously such a fix makes upgrading a more compelling thing for me  
to do even sooner.

Thanks.

-Casey




-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071219/c9abd121/attachment.htm
From ahodgson at simkin.ca  Wed Dec 19 13:13:03 2007
From: ahodgson at simkin.ca (Alan Hodgson)
Date: Wed Dec 19 13:12:59 2007
Subject: [Slony1-general] Bad failure mode encountered during EXECUTE
	SCRIPT (maybe fixed in 1.2.12?)
In-Reply-To: <146890A2-158F-4623-BA15-3B42B06D94D8@pandora.com>
References: <146890A2-158F-4623-BA15-3B42B06D94D8@pandora.com>
Message-ID: <200712191313.03867@hal.medialogik.com>

On Wednesday 19 December 2007, Casey Duncan <casey@pandora.com> wrote:
> Glancing at the changelog for slony 1.2.12, there appear to be
> changes around transaction handling in execute script. Would those
> changes prevent this problem? Note I plan to upgrade soon anyway, but
> obviously such a fix makes upgrading a more compelling thing for me
> to do even sooner.

1.2.10 does have a problem in this regard. 1.2.12 works correctly, as do 
versions before the breakage occurred.

-- 
Definition of an Economist: Someone who knows a little math, but doesn't 
have enough personality to become an accountant.
From jeff at frostconsultingllc.com  Wed Dec 19 13:17:24 2007
From: jeff at frostconsultingllc.com (Jeff Frost)
Date: Wed Dec 19 13:17:54 2007
Subject: [Slony1-general] Bad failure mode encountered during EXECUTE SC
	RIPT(maybe fixed in 1.2.12?)
Message-ID: <200712191617250000@2896924401>

Casey, if you search through the archives for deadlock you'll find a similar problem I had.  This has been fixed in 1.2.12.  Sorry for top posting, my phone doesn't quote worth a flip.

------- Original Message -------
From: Casey Duncan <casey@pandora.com>
To: slony1-general@lists.slony.info
Sent: 12/19/07, 3:51:16 PM
Subject: [Slony1-general] Bad failure mode encountered during EXECUTE SCRIPT(maybe fixed in 1.2.12?)

Running slony 1.2.10 we encountered an issue with a schema upgrade  
when it propagated to the secondary in a two-node slony mirror. Our  
typical procedure for doing schema upgrades is as follows:

1, Point the application server clients to the secondary (the app  
becomes "read-only" as a result)
2. After a few minutes, turn off the slon daemons so we can control  
when the schema changes propagate
3. Appy the schema changes (to the primary) via slonik using execute  
script also adding and removing tables from the replication set as  
needed.
4. After the upgrade completes on the primary, point the app servers  
back to it, so the secondary is quiet.
5. Turn on the slon daemons and wait for the changes to propagate to  
the secondary.
6. Go to sleep or play video games or what-have-you 8^)

This has worked well for us for dozens (if not hundreds) of upgrades,  
with very occasional hiccups in step 5 due to timing related issues  
(when adding tables, etc).  Last night though we had a problem with  
step 4, a wedged pgpool process prevented the app servers from  
switching back to the primary. When we tried to switch them, the  
timed out trying to connect and spontaneously failed over to the  
secondary once again as they are programmed to. Unfortunately this  
went unnoticed as we proceeded to step 5. Due to the level of  
concurrency, this lead to the following deadlock error on the secondary:

2007-12-18 21:41:12.174 PST [d:radio_prod_seg11 u:slony p:6313 9]  
ERROR:  deadlo
ck detected
2007-12-18 21:41:12.174 PST [d:radio_prod_seg11 u:slony p:6313 10]  
DETAIL:  Proc
ess 6313 waits for AccessExclusiveLock on relation 20355 of database  
19833; bloc
ked by process 11991.
         Process 11991 waits for AccessShareLock on relation 20083 of  
database 19
833; blocked by process 6313.
2007-12-18 21:41:12.174 PST [d:radio_prod_seg11 u:slony p:6313 11]  
CONTEXT:  SQL
  statement "lock table "public"."feedback_packed" in access  
exclusive mode"
         PL/pgSQL function "altertableforreplication" line 53 at  
execute statemen
t
         SQL statement "SELECT  "_radio".alterTableForReplication( $1 )"
         PL/pgSQL function "ddlscript_complete_int" line 11 at perform
2007-12-18 21:41:12.174 PST [d:radio_prod_seg11 u:slony p:6313 12]  
STATEMENT:  s
elect "_radio".ddlScript_complete_int(1, -1);

Unfortunately this too went unnoticed at first, what we did notice  
was that the app servers were still failed over and we couldn't  
connect to the primary. This was quickly tracked down to the problem  
with pgpool which was fixed by restarting it. After that, we  
succeeded in switching the app servers back to the primary.

At that point the slon daemons were running, but the secondary daemon  
was not getting anywhere. A look at the logs revealed this error:

ERROR  remoteWorkerThread_1: "select "_radio".ddlScript_prepare_int 
(1, -1); " PGRES_FATAL_ERROR ERROR:  Slony-I: alterTableRestore():  
Table "public"."settlement_log" is not in altered state
  INFO  <output from /usr/lib/postgresql/bin/slon> CONTEXT:  SQL  
statement "SELECT  "_radio".alterTableRestore( $1 )"

This resulted in a bit of a sinking feeling in my gut, since I knew  
this likely meant that none of the replicated tables were in the  
altered state, thus none of the slony triggers were present to  
prevent data from being written to the secondary. A quick look at the  
tables revealed this to be the case. Unfortunately by this time the  
app servers were happily writing to the primary, thus the mirror was  
broken and the slony pair was hosed.

So the end result was that data got written to the secondary, and is  
more-or-less lost because other rows with the same primary key values  
got added to the primary subsequent to that.

This situation points to a lack of atomicity in execute script.  
Obviously the removal of the slony trigggers and the schema changes  
were applied in a separate transaction from the restoration of the  
triggers. This leads to this dangerous possibly that the former will  
succeed but the latter will fail, leading to the issue I ran into here.

Glancing at the changelog for slony 1.2.12, there appear to be  
changes around transaction handling in execute script. Would those  
changes prevent this problem? Note I plan to upgrade soon anyway, but  
obviously such a fix makes upgrading a more compelling thing for me  
to do even sooner.

Thanks.

-Casey





From lists at serioustechnology.com  Wed Dec 19 15:12:35 2007
From: lists at serioustechnology.com (Geoffrey)
Date: Wed Dec 19 15:12:46 2007
Subject: [Slony1-general] questions about slon_tools.conf
Message-ID: <4769A563.9050704@serioustechnology.com>

As I understand it, if I'm replicating from one machine to another, I 
must have identical slon_tools.conf files on both machines.

If I run all my slonik scripts from the slave is this necessary?  That 
is, is it sufficient to have the slon_tools.conf file configured on the 
slave alone?

We plan to have eleven databases replicated.  Will I have to have a 
separate config file for each, since they are separate databases?

I'm having a hard time figuring out how to configure my next database 
for replication.  If I understand it correctly, each database will 
define a different cluster.  I don't see how this could be done in a 
single config file.  There's only one $MASTERNODE, and in our case we 
will have eleven.

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From joshques at gmail.com  Wed Dec 19 18:37:24 2007
From: joshques at gmail.com (Josh Harrison)
Date: Wed Dec 19 18:37:37 2007
Subject: [Slony1-general] Applying schema changes in slony
Message-ID: <8d89ea1d0712191837s76f03d6bva36f61b3800c7afd@mail.gmail.com>

Hi
I have a couple of questions regarding applying  schema changes in slony
The manual says
"When you run EXECUTE
SCRIPT<http://slony.info/adminguide/slony1-1.2.6/doc/adminguide/stmtddlscri=
pt.html>,
this causes the
slonik<http://slony.info/adminguide/slony1-1.2.6/doc/adminguide/slonik.html=
>to
request,
*for each table in the specified set*, an exclusive table lock"
So all the tables in the master and slave are locked for that time? So the
applications accessing that specified set of tables will receive some error
or something atthat particular time? How long is this time generally?
In the production environment is this okay? Anyone had tried this? Are there
any other problems that you had encountered using execute script in the
production env?  Is there any other alternatives?

Thanks
josh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071219/=
4c3b757a/attachment-0001.htm
From glynastill at yahoo.co.uk  Thu Dec 20 04:20:38 2007
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Thu Dec 20 04:21:00 2007
Subject: [Slony1-general] Dropping a replication set?
Message-ID: <387498.58861.qm@web25802.mail.ukl.yahoo.com>

Hi people,

I setup a slony replication set for a table and subscribed my a node
to it. However in the slony log the subscriber shows :

2007-12-20 11:50:38 GMT ERROR  remoteWorkerThread_1: node -1 not
found in runtime configuration
2007-12-20 11:50:38 GMT WARN   remoteWorkerThread_1: data copy for
set 3 failed - sleep 15 seconds

I have no idea why this error has come about, the table I put in the
replication set exists on both the publisher and subscriber.

What I wanted to do was just drop the replication set from the
publisher and subscriber and try setting it up again.

I've done most of my setup using pgAdminIII, and it doesn't seem to
have an option to drop the set. I did at one point manage to drop the
set from the publisher, but it remained on the subscriber and I
couldn't drop it. So I recreated it on the publisher to see if it'd
help - to no avail and now I don't have the option to drop either.

Could someone tell me how I'd go about dropping it from both the
subscriber and the publisher?

A pointer to a guide to doing the stuff pgAdmin does manually might
be a help too.

Thanks
Glyn 


      ___________________________________________________________
Yahoo! Answers - Got a question? Someone out there knows the answer. Try it
now.
http://uk.answers.yahoo.com/ 

From joshques at gmail.com  Thu Dec 20 06:33:49 2007
From: joshques at gmail.com (Josh Harrison)
Date: Thu Dec 20 06:33:52 2007
Subject: [Slony1-general] Adding a new table to the replication-Question
Message-ID: <8d89ea1d0712200633i7d64783br37fdb13f6b054192@mail.gmail.com>

Hi
I already have a set replicating properly   . This is the  script I used for
initializing the first cluster
        cluster name =3Dslony_example;
        node 1 admin conninfo =3D 'dbname=3D$MASTERDBNAME host=3D$MASTERHOST
user=3D$REPLICATIONUSER';
        node 2 admin conninfo =3D 'dbname=3D$SLAVEDBNAME host=3D$SLAVEHOST
user=3D$REPLICATIONUSER';
        init cluster ( id=3D1, comment =3D 'Master Node');
        create set (id=3D1, origin=3D1, comment=3D'All rmrs tables');
        set add table (set id=3D1, origin=3D1, id=3D2, fully qualified name=
 =3D '
public.a_method', comment=3D'a_method table');
         .....
        store node (id=3D2, comment =3D 'Slave node');
        store path (server =3D 1, client =3D 2, conninfo=3D'dbname=3D$MASTE=
RDBNAME
host=3D$MASTERHOST user=3D$REPLICATIONUSER');
        store path (server =3D 2, client =3D 1, conninfo=3D'dbname=3D$SLAVE=
DBNAME
host=3D$SLAVEHOST user=3D$REPLICATIONUSER');

   Now I want to add 2 tables dummy1 and dummy2 to the cluster. I had
created the tables using 'execute script' and the tables now exist in the
master and slave node. Now to add these 2 tables to the replication set I
try to run this script
        cluster name =3Dslony_example;
        node 1 admin conninfo =3D 'dbname=3D$MASTERDBNAME host=3D$MASTERHOST
user=3D$REPLICATIONUSER';
        node 2 admin conninfo =3D 'dbname=3D$SLAVEDBNAME host=3D$SLAVEHOST
user=3D$REPLICATIONUSER';
        create set (id=3D45, origin=3D1, comment=3D'All rmrs tables');
        set add table (set id=3D45, origin=3D1, id=3D46, fully qualified na=
me =3D '
public.dummy1', comment=3D'dummy1 table');
       set add table (set id=3D45, origin=3D1, id=3D47, fully qualified nam=
e =3D '
public.dummy2', comment=3D'dummy2 table');
       subscribe set(id=3D45, provider=3D1,receiver=3D2,forward=3Dno);
       merge set(id=3D1,add id=3D45, origin=3D1);

But I get this error. What am I doing wrong here?

<stdin>:36: PGRES_FATAL_ERROR select "_slony_example".storeSet(45, 'All
example tables');  - ERROR:  duplicate key violates unique constraint
"sl_set-pkey"
CONTEXT:  PL/pgSQL function "storeset" line 13 at SQL statement

Thanks
josh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071220/=
e4b95e15/attachment.htm
From glynastill at yahoo.co.uk  Thu Dec 20 06:55:14 2007
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Thu Dec 20 06:55:19 2007
Subject: [Slony1-general] Adding a new table to the replication-Question
In-Reply-To: <8d89ea1d0712200633i7d64783br37fdb13f6b054192@mail.gmail.com>
Message-ID: <412263.2217.qm@web25811.mail.ukl.yahoo.com>

I used pgAdmin to set up my sets, so I guess I'm missing the
intricate detail here.

However in pgAdmin to add another table to a replication set I have
to create a new set, subscribe the slaves and then merge the sets.

I presume you have to go through the same new set -> merge sets
process.

Glyn
--- Josh Harrison <joshques@gmail.com> wrote:

> Hi
> I already have a set replicating properly   . This is the  script I
> used for
> initializing the first cluster
>         cluster name =slony_example;
>         node 1 admin conninfo = 'dbname=$MASTERDBNAME
> host=$MASTERHOST
> user=$REPLICATIONUSER';
>         node 2 admin conninfo = 'dbname=$SLAVEDBNAME
> host=$SLAVEHOST
> user=$REPLICATIONUSER';
>         init cluster ( id=1, comment = 'Master Node');
>         create set (id=1, origin=1, comment='All rmrs tables');
>         set add table (set id=1, origin=1, id=2, fully qualified
> name = '
> public.a_method', comment='a_method table');
>          .....
>         store node (id=2, comment = 'Slave node');
>         store path (server = 1, client = 2,
> conninfo='dbname=$MASTERDBNAME
> host=$MASTERHOST user=$REPLICATIONUSER');
>         store path (server = 2, client = 1,
> conninfo='dbname=$SLAVEDBNAME
> host=$SLAVEHOST user=$REPLICATIONUSER');
> 
>    Now I want to add 2 tables dummy1 and dummy2 to the cluster. I
> had
> created the tables using 'execute script' and the tables now exist
> in the
> master and slave node. Now to add these 2 tables to the replication
> set I
> try to run this script
>         cluster name =slony_example;
>         node 1 admin conninfo = 'dbname=$MASTERDBNAME
> host=$MASTERHOST
> user=$REPLICATIONUSER';
>         node 2 admin conninfo = 'dbname=$SLAVEDBNAME
> host=$SLAVEHOST
> user=$REPLICATIONUSER';
>         create set (id=45, origin=1, comment='All rmrs tables');
>         set add table (set id=45, origin=1, id=46, fully qualified
> name = '
> public.dummy1', comment='dummy1 table');
>        set add table (set id=45, origin=1, id=47, fully qualified
> name = '
> public.dummy2', comment='dummy2 table');
>        subscribe set(id=45, provider=1,receiver=2,forward=no);
>        merge set(id=1,add id=45, origin=1);
> 
> But I get this error. What am I doing wrong here?
> 
> <stdin>:36: PGRES_FATAL_ERROR select "_slony_example".storeSet(45,
> 'All
> example tables');  - ERROR:  duplicate key violates unique
> constraint
> "sl_set-pkey"
> CONTEXT:  PL/pgSQL function "storeset" line 13 at SQL statement
> 
> Thanks
> josh
> > _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
> 



      __________________________________________________________
Sent from Yahoo! Mail - a smarter inbox http://uk.mail.yahoo.com

From joshques at gmail.com  Thu Dec 20 06:59:59 2007
From: joshques at gmail.com (Josh Harrison)
Date: Thu Dec 20 07:00:02 2007
Subject: [Slony1-general] Adding a new table to the replication-Question
In-Reply-To: <412263.2217.qm@web25811.mail.ukl.yahoo.com>
References: <8d89ea1d0712200633i7d64783br37fdb13f6b054192@mail.gmail.com>
	<412263.2217.qm@web25811.mail.ukl.yahoo.com>
Message-ID: <8d89ea1d0712200659y32cb8533jbb59338a3060b9b5@mail.gmail.com>

On Dec 20, 2007 9:55 AM, Glyn Astill <glynastill@yahoo.co.uk> wrote:

> I used pgAdmin to set up my sets, so I guess I'm missing the
> intricate detail here.
>
> However in pgAdmin to add another table to a replication set I have
> to create a new set, subscribe the slaves and then merge the sets.
>
> I presume you have to go through the same new set -> merge sets
> process.
>
> Yes. I do the same..create subscribe and merge. I somehow keep getting
this error. How do you create the table definition in pgadmin? Is pgAdmin a
better solution to manage slony?
josh

>
>      __________________________________________________________
> Sent from Yahoo! Mail - a smarter inbox http://uk.mail.yahoo.com
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071220/=
602a0c58/attachment.htm
From vivek at khera.org  Thu Dec 20 08:31:42 2007
From: vivek at khera.org (Vivek Khera)
Date: Thu Dec 20 08:31:47 2007
Subject: [Slony1-general] questions about slon_tools.conf
In-Reply-To: <4769A563.9050704@serioustechnology.com>
References: <4769A563.9050704@serioustechnology.com>
Message-ID: <5E13E951-3AAC-4D23-820F-EF8B97DB1522@khera.org>


On Dec 19, 2007, at 6:12 PM, Geoffrey wrote:

> As I understand it, if I'm replicating from one machine to another,  
> I must have identical slon_tools.conf files on both machines.

no, you need to change teh connection string so each slon connects to  
its own server it is responsible for.

the slons can run on any box; they just connect as clients to  
postgres.  most people tend to run the associated slon on the same box  
as the postgres server.

From ajs at crankycanuck.ca  Thu Dec 20 09:20:38 2007
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Thu Dec 20 09:20:52 2007
Subject: [Slony1-general] Applying schema changes in slony
In-Reply-To: <8d89ea1d0712191837s76f03d6bva36f61b3800c7afd@mail.gmail.com>
References: <8d89ea1d0712191837s76f03d6bva36f61b3800c7afd@mail.gmail.com>
Message-ID: <20071220172038.GC4924@crankycanuck.ca>

On Wed, Dec 19, 2007 at 09:37:24PM -0500, Josh Harrison wrote:
> In the production environment is this okay? Anyone had tried this? Are there

Basically, you have two choices in doing this:

1.  Schedule outages for upgrades.  If there's nothing else going on, the
schema changes should go through very quickly.

2.  Do some timing trickery.  There was a problem report just yesterday or
today that described how someone normally does this.  Basically, you use the
replica as a read-only system, stop the slons, perform the EXECUTE SCRIPT on
the origin, and then move your application back.  Start the slons and
thereby allow the replica to catch up.  There are potential gotchas about
this; test your procedure carefully!

A


From glynastill at yahoo.co.uk  Thu Dec 20 09:52:02 2007
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Thu Dec 20 09:52:08 2007
Subject: [Slony1-general] Dropping a replication set?
In-Reply-To: <387498.58861.qm@web25802.mail.ukl.yahoo.com>
Message-ID: <546863.26737.qm@web25807.mail.ukl.yahoo.com>

Any takers?

--- Glyn Astill <glynastill@yahoo.co.uk> wrote:

> Hi people,
> 
> I setup a slony replication set for a table and subscribed my a
> node
> to it. However in the slony log the subscriber shows :
> 
> 2007-12-20 11:50:38 GMT ERROR  remoteWorkerThread_1: node -1 not
> found in runtime configuration
> 2007-12-20 11:50:38 GMT WARN   remoteWorkerThread_1: data copy for
> set 3 failed - sleep 15 seconds
> 
> I have no idea why this error has come about, the table I put in
> the
> replication set exists on both the publisher and subscriber.
> 
> What I wanted to do was just drop the replication set from the
> publisher and subscriber and try setting it up again.
> 
> I've done most of my setup using pgAdminIII, and it doesn't seem to
> have an option to drop the set. I did at one point manage to drop
> the
> set from the publisher, but it remained on the subscriber and I
> couldn't drop it. So I recreated it on the publisher to see if it'd
> help - to no avail and now I don't have the option to drop either.
> 
> Could someone tell me how I'd go about dropping it from both the
> subscriber and the publisher?
> 
> A pointer to a guide to doing the stuff pgAdmin does manually might
> be a help too.
> 
> Thanks
> Glyn 
> 
> 
>       ___________________________________________________________
> Yahoo! Answers - Got a question? Someone out there knows the
> answer. Try it
> now.
> http://uk.answers.yahoo.com/ 
> 
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
> 



Glyn Astill



      __________________________________________________________
Sent from Yahoo! Mail - a smarter inbox http://uk.mail.yahoo.com

From lists at serioustechnology.com  Thu Dec 20 18:50:39 2007
From: lists at serioustechnology.com (Geoffrey)
Date: Thu Dec 20 18:50:54 2007
Subject: [Slony1-general] questions about slon_tools.conf
In-Reply-To: <5E13E951-3AAC-4D23-820F-EF8B97DB1522@khera.org>
References: <4769A563.9050704@serioustechnology.com>
	<5E13E951-3AAC-4D23-820F-EF8B97DB1522@khera.org>
Message-ID: <476B29FF.8000103@serioustechnology.com>

Vivek Khera wrote:
> 
> On Dec 19, 2007, at 6:12 PM, Geoffrey wrote:
> 
>> As I understand it, if I'm replicating from one machine to another, I 
>> must have identical slon_tools.conf files on both machines.
> 
> no, you need to change teh connection string so each slon connects to 
> its own server it is responsible for.
> 
> the slons can run on any box; they just connect as clients to postgres.  
> most people tend to run the associated slon on the same box as the 
> postgres server.

Thanks for the response.  Any ideas on the other part of my post?  That 
is, how do I configure slony to handle multiple databases on one machine 
to be replicated to multiple instances on a second machine?

We have eleven postmasters running on one machine in order to be able to 
better control the configuration of each and limit downtime.  What I 
need to do is replicate all eleven to another machine.

The example slon_tools.conf file does not appear to lend itself to this. 
  There is one MASTERNODE, whereas I need eleven.

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From praveen.k at renaissance-it.com  Fri Dec 21 01:23:00 2007
From: praveen.k at renaissance-it.com (Praveen Kumar (TUV))
Date: Fri Dec 21 01:22:25 2007
Subject: [Slony1-general] RE: Slony1-general Digest, Vol 10, Issue 29
Message-ID: <84D57263D486374587DA0820E60A2CC60194186C@srit_mail.renaissance-it.com>

Hello,
Plz follow below mentioned steps if you have your setup on linux.
1. Connect as root user in your systems where you have subscriber and
publisher.
2. Stop slony process in subscriber and publisher side by using command
-->killall slon
3. su - postgres
4. psql <<database name>> (Mention your database where where you have
subscriber and publisher ) here you will 
   enter in sql prompt)
5. \dn   ( from this command you will find the schema name in your
database and in next command you need
   schema name which is mentioned with _(underscore)in schema list)
6. drop schema _<<cluster_name>> cascade ; ( here <<cluster_name>> is
schema name with _( underscore) in 
   schema list);
 


Praveen Malik | DBA - Delivery
E-mail: praveen.k@renaissance-it.com | Extn: 1607
 


-----Original Message-----
From: slony1-general-bounces@lists.slony.info
[mailto:slony1-general-bounces@lists.slony.info] On Behalf Of
slony1-general-request@lists.slony.info
Sent: Thursday, December 20, 2007 11:22 PM
To: slony1-general@lists.slony.info
Subject: Slony1-general Digest, Vol 10, Issue 29

Send Slony1-general mailing list submissions to
	slony1-general@lists.slony.info

To subscribe or unsubscribe via the World Wide Web, visit
	http://lists.slony.info/mailman/listinfo/slony1-general
or, via email, send a message with subject or body 'help' to
	slony1-general-request@lists.slony.info

You can reach the person managing the list at
	slony1-general-owner@lists.slony.info

When replying, please edit your Subject line so it is more specific than
"Re: Contents of Slony1-general digest..."


Today's Topics:

   1. Dropping a replication set? (Glyn Astill)
   2. Adding a new table to the replication-Question (Josh Harrison)
   3. Re: Adding a new table to the replication-Question (Glyn Astill)
   4. Re: Adding a new table to the replication-Question (Josh Harrison)
   5. Re: questions about slon_tools.conf (Vivek Khera)
   6. Re: Applying schema changes in slony (Andrew Sullivan)
   7. Re: Dropping a replication set? (Glyn Astill)


----------------------------------------------------------------------

Message: 1
Date: Thu, 20 Dec 2007 12:20:38 +0000 (GMT)
From: Glyn Astill <glynastill@yahoo.co.uk>
Subject: [Slony1-general] Dropping a replication set?
To: slony1-general@lists.slony.info
Message-ID: <387498.58861.qm@web25802.mail.ukl.yahoo.com>
Content-Type: text/plain; charset=iso-8859-1

Hi people,

I setup a slony replication set for a table and subscribed my a node to
it. However in the slony log the subscriber shows :

2007-12-20 11:50:38 GMT ERROR  remoteWorkerThread_1: node -1 not found
in runtime configuration
2007-12-20 11:50:38 GMT WARN   remoteWorkerThread_1: data copy for
set 3 failed - sleep 15 seconds

I have no idea why this error has come about, the table I put in the
replication set exists on both the publisher and subscriber.

What I wanted to do was just drop the replication set from the publisher
and subscriber and try setting it up again.

I've done most of my setup using pgAdminIII, and it doesn't seem to have
an option to drop the set. I did at one point manage to drop the set
from the publisher, but it remained on the subscriber and I couldn't
drop it. So I recreated it on the publisher to see if it'd help - to no
avail and now I don't have the option to drop either.

Could someone tell me how I'd go about dropping it from both the
subscriber and the publisher?

A pointer to a guide to doing the stuff pgAdmin does manually might be a
help too.

Thanks
Glyn 


      ___________________________________________________________
Yahoo! Answers - Got a question? Someone out there knows the answer. Try
it now.
http://uk.answers.yahoo.com/ 



------------------------------

Message: 2
Date: Thu, 20 Dec 2007 09:33:49 -0500
From: "Josh Harrison" <joshques@gmail.com>
Subject: [Slony1-general] Adding a new table to the
	replication-Question
To: slony1-general@lists.slony.info
Message-ID:
	<8d89ea1d0712200633i7d64783br37fdb13f6b054192@mail.gmail.com>
Content-Type: text/plain; charset="iso-8859-1"

Hi
I already have a set replicating properly   . This is the  script I used
for
initializing the first cluster
        cluster name =3Dslony_example;
        node 1 admin conninfo =3D 'dbname=3D$MASTERDBNAME
host=3D$MASTERHOST user=3D$REPLICATIONUSER';
        node 2 admin conninfo =3D 'dbname=3D$SLAVEDBNAME
host=3D$SLAVEHOST user=3D$REPLICATIONUSER';
        init cluster ( id=3D1, comment =3D 'Master Node');
        create set (id=3D1, origin=3D1, comment=3D'All rmrs tables');
        set add table (set id=3D1, origin=3D1, id=3D2, fully qualified
name=  =3D '
public.a_method', comment=3D'a_method table');
         .....
        store node (id=3D2, comment =3D 'Slave node');
        store path (server =3D 1, client =3D 2,
conninfo=3D'dbname=3D$MASTE= RDBNAME host=3D$MASTERHOST
user=3D$REPLICATIONUSER');
        store path (server =3D 2, client =3D 1,
conninfo=3D'dbname=3D$SLAVE= DBNAME host=3D$SLAVEHOST
user=3D$REPLICATIONUSER');

   Now I want to add 2 tables dummy1 and dummy2 to the cluster. I had
created the tables using 'execute script' and the tables now exist in
the master and slave node. Now to add these 2 tables to the replication
set I try to run this script
        cluster name =3Dslony_example;
        node 1 admin conninfo =3D 'dbname=3D$MASTERDBNAME
host=3D$MASTERHOST user=3D$REPLICATIONUSER';
        node 2 admin conninfo =3D 'dbname=3D$SLAVEDBNAME
host=3D$SLAVEHOST user=3D$REPLICATIONUSER';
        create set (id=3D45, origin=3D1, comment=3D'All rmrs tables');
        set add table (set id=3D45, origin=3D1, id=3D46, fully qualified
na= me =3D '
public.dummy1', comment=3D'dummy1 table');
       set add table (set id=3D45, origin=3D1, id=3D47, fully qualified
nam= e =3D '
public.dummy2', comment=3D'dummy2 table');
       subscribe set(id=3D45, provider=3D1,receiver=3D2,forward=3Dno);
       merge set(id=3D1,add id=3D45, origin=3D1);

But I get this error. What am I doing wrong here?

<stdin>:36: PGRES_FATAL_ERROR select "_slony_example".storeSet(45, 'All
example tables');  - ERROR:  duplicate key violates unique constraint
"sl_set-pkey"
CONTEXT:  PL/pgSQL function "storeset" line 13 at SQL statement

Thanks
josh
-------------- next part --------------
An HTML attachment was scrubbed...
URL:
http://lists.slony.info/pipermail/slony1-general/attachments/20071220/=
e4b95e15/attachment-0001.htm

------------------------------

Message: 3
Date: Thu, 20 Dec 2007 14:55:14 +0000 (GMT)
From: Glyn Astill <glynastill@yahoo.co.uk>
Subject: Re: [Slony1-general] Adding a new table to the
	replication-Question
To: Josh Harrison <joshques@gmail.com>,
	slony1-general@lists.slony.info
Message-ID: <412263.2217.qm@web25811.mail.ukl.yahoo.com>
Content-Type: text/plain; charset=iso-8859-1

I used pgAdmin to set up my sets, so I guess I'm missing the intricate
detail here.

However in pgAdmin to add another table to a replication set I have to
create a new set, subscribe the slaves and then merge the sets.

I presume you have to go through the same new set -> merge sets process.

Glyn
--- Josh Harrison <joshques@gmail.com> wrote:

> Hi
> I already have a set replicating properly   . This is the  script I
> used for
> initializing the first cluster
>         cluster name =slony_example;
>         node 1 admin conninfo = 'dbname=$MASTERDBNAME host=$MASTERHOST

> user=$REPLICATIONUSER';
>         node 2 admin conninfo = 'dbname=$SLAVEDBNAME host=$SLAVEHOST 
> user=$REPLICATIONUSER';
>         init cluster ( id=1, comment = 'Master Node');
>         create set (id=1, origin=1, comment='All rmrs tables');
>         set add table (set id=1, origin=1, id=2, fully qualified name 
> = '
> public.a_method', comment='a_method table');
>          .....
>         store node (id=2, comment = 'Slave node');
>         store path (server = 1, client = 2, 
> conninfo='dbname=$MASTERDBNAME host=$MASTERHOST 
> user=$REPLICATIONUSER');
>         store path (server = 2, client = 1, 
> conninfo='dbname=$SLAVEDBNAME host=$SLAVEHOST user=$REPLICATIONUSER');
> 
>    Now I want to add 2 tables dummy1 and dummy2 to the cluster. I had 
> created the tables using 'execute script' and the tables now exist in 
> the master and slave node. Now to add these 2 tables to the 
> replication set I try to run this script
>         cluster name =slony_example;
>         node 1 admin conninfo = 'dbname=$MASTERDBNAME host=$MASTERHOST

> user=$REPLICATIONUSER';
>         node 2 admin conninfo = 'dbname=$SLAVEDBNAME host=$SLAVEHOST 
> user=$REPLICATIONUSER';
>         create set (id=45, origin=1, comment='All rmrs tables');
>         set add table (set id=45, origin=1, id=46, fully qualified 
> name = '
> public.dummy1', comment='dummy1 table');
>        set add table (set id=45, origin=1, id=47, fully qualified name

> = '
> public.dummy2', comment='dummy2 table');
>        subscribe set(id=45, provider=1,receiver=2,forward=no);
>        merge set(id=1,add id=45, origin=1);
> 
> But I get this error. What am I doing wrong here?
> 
> <stdin>:36: PGRES_FATAL_ERROR select "_slony_example".storeSet(45, 
> 'All example tables');  - ERROR:  duplicate key violates unique 
> constraint "sl_set-pkey"
> CONTEXT:  PL/pgSQL function "storeset" line 13 at SQL statement
> 
> Thanks
> josh
> > _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
> 



      __________________________________________________________
Sent from Yahoo! Mail - a smarter inbox http://uk.mail.yahoo.com



------------------------------

Message: 4
Date: Thu, 20 Dec 2007 09:59:59 -0500
From: "Josh Harrison" <joshques@gmail.com>
Subject: Re: [Slony1-general] Adding a new table to the
	replication-Question
To: "Glyn Astill" <glynastill@yahoo.co.uk>
Cc: slony1-general@lists.slony.info
Message-ID:
	<8d89ea1d0712200659y32cb8533jbb59338a3060b9b5@mail.gmail.com>
Content-Type: text/plain; charset="iso-8859-1"

On Dec 20, 2007 9:55 AM, Glyn Astill <glynastill@yahoo.co.uk> wrote:

> I used pgAdmin to set up my sets, so I guess I'm missing the intricate

> detail here.
>
> However in pgAdmin to add another table to a replication set I have to

> create a new set, subscribe the slaves and then merge the sets.
>
> I presume you have to go through the same new set -> merge sets 
> process.
>
> Yes. I do the same..create subscribe and merge. I somehow keep getting
this error. How do you create the table definition in pgadmin? Is
pgAdmin a better solution to manage slony?
josh

>
>      __________________________________________________________
> Sent from Yahoo! Mail - a smarter inbox http://uk.mail.yahoo.com
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL:
http://lists.slony.info/pipermail/slony1-general/attachments/20071220/=
602a0c58/attachment-0001.htm

------------------------------

Message: 5
Date: Thu, 20 Dec 2007 11:31:42 -0500
From: Vivek Khera <vivek@khera.org>
Subject: Re: [Slony1-general] questions about slon_tools.conf
To: Slony List <slony1-general@lists.slony.info>
Message-ID: <5E13E951-3AAC-4D23-820F-EF8B97DB1522@khera.org>
Content-Type: text/plain; charset=US-ASCII; format=flowed; delsp=yes


On Dec 19, 2007, at 6:12 PM, Geoffrey wrote:

> As I understand it, if I'm replicating from one machine to another, I 
> must have identical slon_tools.conf files on both machines.

no, you need to change teh connection string so each slon connects to
its own server it is responsible for.

the slons can run on any box; they just connect as clients to postgres.
most people tend to run the associated slon on the same box as the
postgres server.



------------------------------

Message: 6
Date: Thu, 20 Dec 2007 12:20:38 -0500
From: Andrew Sullivan <ajs@crankycanuck.ca>
Subject: Re: [Slony1-general] Applying schema changes in slony
To: slony1-general@lists.slony.info
Message-ID: <20071220172038.GC4924@crankycanuck.ca>
Content-Type: text/plain; charset=us-ascii

On Wed, Dec 19, 2007 at 09:37:24PM -0500, Josh Harrison wrote:
> In the production environment is this okay? Anyone had tried this? Are

> there

Basically, you have two choices in doing this:

1.  Schedule outages for upgrades.  If there's nothing else going on,
the schema changes should go through very quickly.

2.  Do some timing trickery.  There was a problem report just yesterday
or today that described how someone normally does this.  Basically, you
use the replica as a read-only system, stop the slons, perform the
EXECUTE SCRIPT on the origin, and then move your application back.
Start the slons and thereby allow the replica to catch up.  There are
potential gotchas about this; test your procedure carefully!

A




------------------------------

Message: 7
Date: Thu, 20 Dec 2007 17:52:02 +0000 (GMT)
From: Glyn Astill <glynastill@yahoo.co.uk>
Subject: Re: [Slony1-general] Dropping a replication set?
To: Glyn Astill <glynastill@yahoo.co.uk>,
	slony1-general@lists.slony.info
Message-ID: <546863.26737.qm@web25807.mail.ukl.yahoo.com>
Content-Type: text/plain; charset=iso-8859-1

Any takers?

--- Glyn Astill <glynastill@yahoo.co.uk> wrote:

> Hi people,
> 
> I setup a slony replication set for a table and subscribed my a node 
> to it. However in the slony log the subscriber shows :
> 
> 2007-12-20 11:50:38 GMT ERROR  remoteWorkerThread_1: node -1 not found

> in runtime configuration
> 2007-12-20 11:50:38 GMT WARN   remoteWorkerThread_1: data copy for
> set 3 failed - sleep 15 seconds
> 
> I have no idea why this error has come about, the table I put in the 
> replication set exists on both the publisher and subscriber.
> 
> What I wanted to do was just drop the replication set from the 
> publisher and subscriber and try setting it up again.
> 
> I've done most of my setup using pgAdminIII, and it doesn't seem to 
> have an option to drop the set. I did at one point manage to drop the 
> set from the publisher, but it remained on the subscriber and I 
> couldn't drop it. So I recreated it on the publisher to see if it'd 
> help - to no avail and now I don't have the option to drop either.
> 
> Could someone tell me how I'd go about dropping it from both the 
> subscriber and the publisher?
> 
> A pointer to a guide to doing the stuff pgAdmin does manually might be

> a help too.
> 
> Thanks
> Glyn
> 
> 
>       ___________________________________________________________
> Yahoo! Answers - Got a question? Someone out there knows the answer. 
> Try it now.
> http://uk.answers.yahoo.com/
> 
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
> 



Glyn Astill



      __________________________________________________________
Sent from Yahoo! Mail - a smarter inbox http://uk.mail.yahoo.com



------------------------------

_______________________________________________
Slony1-general mailing list
Slony1-general@lists.slony.info
http://lists.slony.info/mailman/listinfo/slony1-general


End of Slony1-general Digest, Vol 10, Issue 29
**********************************************
From glynastill at yahoo.co.uk  Fri Dec 21 02:25:50 2007
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Fri Dec 21 02:26:09 2007
Subject: [Slony1-general] RE: Slony1-general Digest, Vol 10, Issue 29
In-Reply-To: <84D57263D486374587DA0820E60A2CC60194186C@srit_mail.renaissance-it.com>
Message-ID: <405471.311.qm@web25813.mail.ukl.yahoo.com>

Hi Praveen,

>From looking over the steps below it seems this will drop my whole
cluster will it not?

I only want to drop one of the replication sets within my cluster.

I.e.

I have a slony I cluster called "replication1", and within this I
have 3 replication sets, "customers", "events" and "eventData".

I just want to drop the "eventData" replication set from the cluster.

Thanks
Glyn

--- "Praveen Kumar (TUV)" <praveen.k@renaissance-it.com> wrote:

> Hello,
> Plz follow below mentioned steps if you have your setup on linux.
> 1. Connect as root user in your systems where you have subscriber
> and
> publisher.
> 2. Stop slony process in subscriber and publisher side by using
> command
> -->killall slon
> 3. su - postgres
> 4. psql <<database name>> (Mention your database where where you
> have
> subscriber and publisher ) here you will 
>    enter in sql prompt)
> 5. \dn   ( from this command you will find the schema name in your
> database and in next command you need
>    schema name which is mentioned with _(underscore)in schema list)
> 6. drop schema _<<cluster_name>> cascade ; ( here <<cluster_name>>
> is
> schema name with _( underscore) in 
>    schema list);
>  
> 
> 
> Praveen Malik | DBA - Delivery
> E-mail: praveen.k@renaissance-it.com | Extn: 1607
>  
> 
> 
> -----Original Message-----
> From: slony1-general-bounces@lists.slony.info
> [mailto:slony1-general-bounces@lists.slony.info] On Behalf Of
> slony1-general-request@lists.slony.info
> Sent: Thursday, December 20, 2007 11:22 PM
> To: slony1-general@lists.slony.info
> Subject: Slony1-general Digest, Vol 10, Issue 29
> 
> Send Slony1-general mailing list submissions to
> 	slony1-general@lists.slony.info
> 
> To subscribe or unsubscribe via the World Wide Web, visit
> 	http://lists.slony.info/mailman/listinfo/slony1-general
> or, via email, send a message with subject or body 'help' to
> 	slony1-general-request@lists.slony.info
> 
> You can reach the person managing the list at
> 	slony1-general-owner@lists.slony.info
> 
> When replying, please edit your Subject line so it is more specific
> than
> "Re: Contents of Slony1-general digest..."
> 
> 
> Today's Topics:
> 
>    1. Dropping a replication set? (Glyn Astill)
>    2. Adding a new table to the replication-Question (Josh
> Harrison)
>    3. Re: Adding a new table to the replication-Question (Glyn
> Astill)
>    4. Re: Adding a new table to the replication-Question (Josh
> Harrison)
>    5. Re: questions about slon_tools.conf (Vivek Khera)
>    6. Re: Applying schema changes in slony (Andrew Sullivan)
>    7. Re: Dropping a replication set? (Glyn Astill)
> 
> 
>
----------------------------------------------------------------------
> 
> Message: 1
> Date: Thu, 20 Dec 2007 12:20:38 +0000 (GMT)
> From: Glyn Astill <glynastill@yahoo.co.uk>
> Subject: [Slony1-general] Dropping a replication set?
> To: slony1-general@lists.slony.info
> Message-ID: <387498.58861.qm@web25802.mail.ukl.yahoo.com>
> Content-Type: text/plain; charset=iso-8859-1
> 
> Hi people,
> 
> I setup a slony replication set for a table and subscribed my a
> node to
> it. However in the slony log the subscriber shows :
> 
> 2007-12-20 11:50:38 GMT ERROR  remoteWorkerThread_1: node -1 not
> found
> in runtime configuration
> 2007-12-20 11:50:38 GMT WARN   remoteWorkerThread_1: data copy for
> set 3 failed - sleep 15 seconds
> 
> I have no idea why this error has come about, the table I put in
> the
> replication set exists on both the publisher and subscriber.
> 
> What I wanted to do was just drop the replication set from the
> publisher
> and subscriber and try setting it up again.
> 
> I've done most of my setup using pgAdminIII, and it doesn't seem to
> have
> an option to drop the set. I did at one point manage to drop the
> set
> from the publisher, but it remained on the subscriber and I
> couldn't
> drop it. So I recreated it on the publisher to see if it'd help -
> to no
> avail and now I don't have the option to drop either.
> 
> Could someone tell me how I'd go about dropping it from both the
> subscriber and the publisher?
> 
> A pointer to a guide to doing the stuff pgAdmin does manually might
> be a
> help too.
> 
> Thanks
> Glyn 
> 
> 
>       ___________________________________________________________
> Yahoo! Answers - Got a question? Someone out there knows the
> answer. Try
> it now.
> http://uk.answers.yahoo.com/ 
> 
> 
> 
> ------------------------------
> 
> Message: 2
> Date: Thu, 20 Dec 2007 09:33:49 -0500
> From: "Josh Harrison" <joshques@gmail.com>
> Subject: [Slony1-general] Adding a new table to the
> 	replication-Question
> To: slony1-general@lists.slony.info
> Message-ID:
> 	<8d89ea1d0712200633i7d64783br37fdb13f6b054192@mail.gmail.com>
> Content-Type: text/plain; charset="iso-8859-1"
> 
> Hi
> I already have a set replicating properly   . This is the  script I
> used
> for
> initializing the first cluster
>         cluster name =3Dslony_example;
>         node 1 admin conninfo =3D 'dbname=3D$MASTERDBNAME
> host=3D$MASTERHOST user=3D$REPLICATIONUSER';
>         node 2 admin conninfo =3D 'dbname=3D$SLAVEDBNAME
> host=3D$SLAVEHOST user=3D$REPLICATIONUSER';
>         init cluster ( id=3D1, comment =3D 'Master Node');
>         create set (id=3D1, origin=3D1, comment=3D'All rmrs
> tables');
>         set add table (set id=3D1, origin=3D1, id=3D2, fully
> qualified
> name=  =3D '
> public.a_method', comment=3D'a_method table');
>          .....
>         store node (id=3D2, comment =3D 'Slave node');
>         store path (server =3D 1, client =3D 2,
> conninfo=3D'dbname=3D$MASTE= RDBNAME host=3D$MASTERHOST
> user=3D$REPLICATIONUSER');
>         store path (server =3D 2, client =3D 1,
> conninfo=3D'dbname=3D$SLAVE= DBNAME host=3D$SLAVEHOST
> user=3D$REPLICATIONUSER');
> 
>    Now I want to add 2 tables dummy1 and dummy2 to the cluster. I
> had
> created the tables using 'execute script' and the tables now exist
> in
> the master and slave node. Now to add these 2 tables to the
> replication
> set I try to run this script
>         cluster name =3Dslony_example;
>         node 1 admin conninfo =3D 'dbname=3D$MASTERDBNAME
> host=3D$MASTERHOST user=3D$REPLICATIONUSER';
>         node 2 admin conninfo =3D 'dbname=3D$SLAVEDBNAME
> host=3D$SLAVEHOST user=3D$REPLICATIONUSER';
>         create set (id=3D45, origin=3D1, comment=3D'All rmrs
> tables');
>         set add table (set id=3D45, origin=3D1, id=3D46, fully
> qualified
> na= me =3D '
> public.dummy1', comment=3D'dummy1 table');
>        set add table (set id=3D45, origin=3D1, id=3D47, fully
> qualified
> nam= e =3D '
> public.dummy2', comment=3D'dummy2 table');
>        subscribe set(id=3D45,
> provider=3D1,receiver=3D2,forward=3Dno);
>        merge set(id=3D1,add id=3D45, origin=3D1);
> 
> But I get this error. What am I doing wrong here?
> 
> <stdin>:36: PGRES_FATAL_ERROR select "_slony_example".storeSet(45,
> 'All
> example tables');  - ERROR:  duplicate key violates unique
> constraint
> "sl_set-pkey"
> CONTEXT:  PL/pgSQL function "storeset" line 13 at SQL statement
> 
> Thanks
> josh
> -------------- next part --------------
> 
=== message truncated ===



      ___________________________________________________________
Yahoo! Answers - Got a question? Someone out there knows the answer. Try it
now.
http://uk.answers.yahoo.com/ 

From cedric.villemain at dalibo.com  Fri Dec 21 04:12:04 2007
From: cedric.villemain at dalibo.com (=?ISO-8859-1?Q?C=E9dric_Villemain?=)
Date: Fri Dec 21 04:12:39 2007
Subject: [Slony1-general] RE: Slony1-general Digest, Vol 10, Issue 29
In-Reply-To: <84D57263D486374587DA0820E60A2CC60194186C@srit_mail.renaissance-it.com>
References: <84D57263D486374587DA0820E60A2CC60194186C@srit_mail.renaissance-it.com>
Message-ID: <476BAD94.9030402@dalibo.com>

Praveen Kumar (TUV) a =E9crit :
> Hello,
> Plz follow below mentioned steps if you have your setup on linux.
> 1. Connect as root user in your systems where you have subscriber and
> publisher.
> 2. Stop slony process in subscriber and publisher side by using command
> -->killall slon
> 3. su - postgres
> 4. psql <<database name>> (Mention your database where where you have
> subscriber and publisher ) here you will =

>    enter in sql prompt)
> 5. \dn   ( from this command you will find the schema name in your
> database and in next command you need
>    schema name which is mentioned with _(underscore)in schema list)
> 6. drop schema _<<cluster_name>> cascade ; ( here <<cluster_name>> is
> schema name with _( underscore) in =

>    schema list);
>  =

>   =


I've recently  read on irc #slony that it can be dangerous to just drop =

cascade !

Perhaps time to update some part of the docs ?

>
> Praveen Malik | DBA - Delivery
> E-mail: praveen.k@renaissance-it.com | Extn: 1607
>  =

>
>
> -----Original Message-----
> From: slony1-general-bounces@lists.slony.info
> [mailto:slony1-general-bounces@lists.slony.info] On Behalf Of
> slony1-general-request@lists.slony.info
> Sent: Thursday, December 20, 2007 11:22 PM
> To: slony1-general@lists.slony.info
> Subject: Slony1-general Digest, Vol 10, Issue 29
>
> Send Slony1-general mailing list submissions to
> 	slony1-general@lists.slony.info
>
> To subscribe or unsubscribe via the World Wide Web, visit
> 	http://lists.slony.info/mailman/listinfo/slony1-general
> or, via email, send a message with subject or body 'help' to
> 	slony1-general-request@lists.slony.info
>
> You can reach the person managing the list at
> 	slony1-general-owner@lists.slony.info
>
> When replying, please edit your Subject line so it is more specific than
> "Re: Contents of Slony1-general digest..."
>
>
> Today's Topics:
>
>    1. Dropping a replication set? (Glyn Astill)
>    2. Adding a new table to the replication-Question (Josh Harrison)
>    3. Re: Adding a new table to the replication-Question (Glyn Astill)
>    4. Re: Adding a new table to the replication-Question (Josh Harrison)
>    5. Re: questions about slon_tools.conf (Vivek Khera)
>    6. Re: Applying schema changes in slony (Andrew Sullivan)
>    7. Re: Dropping a replication set? (Glyn Astill)
>
>
> ----------------------------------------------------------------------
>
> Message: 1
> Date: Thu, 20 Dec 2007 12:20:38 +0000 (GMT)
> From: Glyn Astill <glynastill@yahoo.co.uk>
> Subject: [Slony1-general] Dropping a replication set?
> To: slony1-general@lists.slony.info
> Message-ID: <387498.58861.qm@web25802.mail.ukl.yahoo.com>
> Content-Type: text/plain; charset=3Diso-8859-1
>
> Hi people,
>
> I setup a slony replication set for a table and subscribed my a node to
> it. However in the slony log the subscriber shows :
>
> 2007-12-20 11:50:38 GMT ERROR  remoteWorkerThread_1: node -1 not found
> in runtime configuration
> 2007-12-20 11:50:38 GMT WARN   remoteWorkerThread_1: data copy for
> set 3 failed - sleep 15 seconds
>
> I have no idea why this error has come about, the table I put in the
> replication set exists on both the publisher and subscriber.
>
> What I wanted to do was just drop the replication set from the publisher
> and subscriber and try setting it up again.
>
> I've done most of my setup using pgAdminIII, and it doesn't seem to have
> an option to drop the set. I did at one point manage to drop the set
> from the publisher, but it remained on the subscriber and I couldn't
> drop it. So I recreated it on the publisher to see if it'd help - to no
> avail and now I don't have the option to drop either.
>
> Could someone tell me how I'd go about dropping it from both the
> subscriber and the publisher?
>
> A pointer to a guide to doing the stuff pgAdmin does manually might be a
> help too.
>
> Thanks
> Glyn =

>
>
>       ___________________________________________________________
> Yahoo! Answers - Got a question? Someone out there knows the answer. Try
> it now.
> http://uk.answers.yahoo.com/ =

>
>
>
> ------------------------------
>
> Message: 2
> Date: Thu, 20 Dec 2007 09:33:49 -0500
> From: "Josh Harrison" <joshques@gmail.com>
> Subject: [Slony1-general] Adding a new table to the
> 	replication-Question
> To: slony1-general@lists.slony.info
> Message-ID:
> 	<8d89ea1d0712200633i7d64783br37fdb13f6b054192@mail.gmail.com>
> Content-Type: text/plain; charset=3D"iso-8859-1"
>
> Hi
> I already have a set replicating properly   . This is the  script I used
> for
> initializing the first cluster
>         cluster name =3D3Dslony_example;
>         node 1 admin conninfo =3D3D 'dbname=3D3D$MASTERDBNAME
> host=3D3D$MASTERHOST user=3D3D$REPLICATIONUSER';
>         node 2 admin conninfo =3D3D 'dbname=3D3D$SLAVEDBNAME
> host=3D3D$SLAVEHOST user=3D3D$REPLICATIONUSER';
>         init cluster ( id=3D3D1, comment =3D3D 'Master Node');
>         create set (id=3D3D1, origin=3D3D1, comment=3D3D'All rmrs tables'=
);
>         set add table (set id=3D3D1, origin=3D3D1, id=3D3D2, fully qualif=
ied
> name=3D  =3D3D '
> public.a_method', comment=3D3D'a_method table');
>          .....
>         store node (id=3D3D2, comment =3D3D 'Slave node');
>         store path (server =3D3D 1, client =3D3D 2,
> conninfo=3D3D'dbname=3D3D$MASTE=3D RDBNAME host=3D3D$MASTERHOST
> user=3D3D$REPLICATIONUSER');
>         store path (server =3D3D 2, client =3D3D 1,
> conninfo=3D3D'dbname=3D3D$SLAVE=3D DBNAME host=3D3D$SLAVEHOST
> user=3D3D$REPLICATIONUSER');
>
>    Now I want to add 2 tables dummy1 and dummy2 to the cluster. I had
> created the tables using 'execute script' and the tables now exist in
> the master and slave node. Now to add these 2 tables to the replication
> set I try to run this script
>         cluster name =3D3Dslony_example;
>         node 1 admin conninfo =3D3D 'dbname=3D3D$MASTERDBNAME
> host=3D3D$MASTERHOST user=3D3D$REPLICATIONUSER';
>         node 2 admin conninfo =3D3D 'dbname=3D3D$SLAVEDBNAME
> host=3D3D$SLAVEHOST user=3D3D$REPLICATIONUSER';
>         create set (id=3D3D45, origin=3D3D1, comment=3D3D'All rmrs tables=
');
>         set add table (set id=3D3D45, origin=3D3D1, id=3D3D46, fully qual=
ified
> na=3D me =3D3D '
> public.dummy1', comment=3D3D'dummy1 table');
>        set add table (set id=3D3D45, origin=3D3D1, id=3D3D47, fully quali=
fied
> nam=3D e =3D3D '
> public.dummy2', comment=3D3D'dummy2 table');
>        subscribe set(id=3D3D45, provider=3D3D1,receiver=3D3D2,forward=3D3=
Dno);
>        merge set(id=3D3D1,add id=3D3D45, origin=3D3D1);
>
> But I get this error. What am I doing wrong here?
>
> <stdin>:36: PGRES_FATAL_ERROR select "_slony_example".storeSet(45, 'All
> example tables');  - ERROR:  duplicate key violates unique constraint
> "sl_set-pkey"
> CONTEXT:  PL/pgSQL function "storeset" line 13 at SQL statement
>
> Thanks
> josh
> -------------- next part --------------
> An HTML attachment was scrubbed...
> URL:
> http://lists.slony.info/pipermail/slony1-general/attachments/20071220/=3D
> e4b95e15/attachment-0001.htm
>
> ------------------------------
>
> Message: 3
> Date: Thu, 20 Dec 2007 14:55:14 +0000 (GMT)
> From: Glyn Astill <glynastill@yahoo.co.uk>
> Subject: Re: [Slony1-general] Adding a new table to the
> 	replication-Question
> To: Josh Harrison <joshques@gmail.com>,
> 	slony1-general@lists.slony.info
> Message-ID: <412263.2217.qm@web25811.mail.ukl.yahoo.com>
> Content-Type: text/plain; charset=3Diso-8859-1
>
> I used pgAdmin to set up my sets, so I guess I'm missing the intricate
> detail here.
>
> However in pgAdmin to add another table to a replication set I have to
> create a new set, subscribe the slaves and then merge the sets.
>
> I presume you have to go through the same new set -> merge sets process.
>
> Glyn
> --- Josh Harrison <joshques@gmail.com> wrote:
>
>   =

>> Hi
>> I already have a set replicating properly   . This is the  script I
>> used for
>> initializing the first cluster
>>         cluster name =3Dslony_example;
>>         node 1 admin conninfo =3D 'dbname=3D$MASTERDBNAME host=3D$MASTER=
HOST
>>     =

>
>   =

>> user=3D$REPLICATIONUSER';
>>         node 2 admin conninfo =3D 'dbname=3D$SLAVEDBNAME host=3D$SLAVEHO=
ST =

>> user=3D$REPLICATIONUSER';
>>         init cluster ( id=3D1, comment =3D 'Master Node');
>>         create set (id=3D1, origin=3D1, comment=3D'All rmrs tables');
>>         set add table (set id=3D1, origin=3D1, id=3D2, fully qualified n=
ame =

>> =3D '
>> public.a_method', comment=3D'a_method table');
>>          .....
>>         store node (id=3D2, comment =3D 'Slave node');
>>         store path (server =3D 1, client =3D 2, =

>> conninfo=3D'dbname=3D$MASTERDBNAME host=3D$MASTERHOST =

>> user=3D$REPLICATIONUSER');
>>         store path (server =3D 2, client =3D 1, =

>> conninfo=3D'dbname=3D$SLAVEDBNAME host=3D$SLAVEHOST user=3D$REPLICATIONU=
SER');
>>
>>    Now I want to add 2 tables dummy1 and dummy2 to the cluster. I had =

>> created the tables using 'execute script' and the tables now exist in =

>> the master and slave node. Now to add these 2 tables to the =

>> replication set I try to run this script
>>         cluster name =3Dslony_example;
>>         node 1 admin conninfo =3D 'dbname=3D$MASTERDBNAME host=3D$MASTER=
HOST
>>     =

>
>   =

>> user=3D$REPLICATIONUSER';
>>         node 2 admin conninfo =3D 'dbname=3D$SLAVEDBNAME host=3D$SLAVEHO=
ST =

>> user=3D$REPLICATIONUSER';
>>         create set (id=3D45, origin=3D1, comment=3D'All rmrs tables');
>>         set add table (set id=3D45, origin=3D1, id=3D46, fully qualified =

>> name =3D '
>> public.dummy1', comment=3D'dummy1 table');
>>        set add table (set id=3D45, origin=3D1, id=3D47, fully qualified =
name
>>     =

>
>   =

>> =3D '
>> public.dummy2', comment=3D'dummy2 table');
>>        subscribe set(id=3D45, provider=3D1,receiver=3D2,forward=3Dno);
>>        merge set(id=3D1,add id=3D45, origin=3D1);
>>
>> But I get this error. What am I doing wrong here?
>>
>> <stdin>:36: PGRES_FATAL_ERROR select "_slony_example".storeSet(45, =

>> 'All example tables');  - ERROR:  duplicate key violates unique =

>> constraint "sl_set-pkey"
>> CONTEXT:  PL/pgSQL function "storeset" line 13 at SQL statement
>>
>> Thanks
>> josh
>>     =

>>> _______________________________________________
>>>       =

>> Slony1-general mailing list
>> Slony1-general@lists.slony.info
>> http://lists.slony.info/mailman/listinfo/slony1-general
>>
>>     =

>
>
>
>       __________________________________________________________
> Sent from Yahoo! Mail - a smarter inbox http://uk.mail.yahoo.com
>
>
>
> ------------------------------
>
> Message: 4
> Date: Thu, 20 Dec 2007 09:59:59 -0500
> From: "Josh Harrison" <joshques@gmail.com>
> Subject: Re: [Slony1-general] Adding a new table to the
> 	replication-Question
> To: "Glyn Astill" <glynastill@yahoo.co.uk>
> Cc: slony1-general@lists.slony.info
> Message-ID:
> 	<8d89ea1d0712200659y32cb8533jbb59338a3060b9b5@mail.gmail.com>
> Content-Type: text/plain; charset=3D"iso-8859-1"
>
> On Dec 20, 2007 9:55 AM, Glyn Astill <glynastill@yahoo.co.uk> wrote:
>
>   =

>> I used pgAdmin to set up my sets, so I guess I'm missing the intricate
>>     =

>
>   =

>> detail here.
>>
>> However in pgAdmin to add another table to a replication set I have to
>>     =

>
>   =

>> create a new set, subscribe the slaves and then merge the sets.
>>
>> I presume you have to go through the same new set -> merge sets =

>> process.
>>
>> Yes. I do the same..create subscribe and merge. I somehow keep getting
>>     =

> this error. How do you create the table definition in pgadmin? Is
> pgAdmin a better solution to manage slony?
> josh
>
>   =

>>      __________________________________________________________
>> Sent from Yahoo! Mail - a smarter inbox http://uk.mail.yahoo.com
>>
>>
>>     =

> -------------- next part --------------
> An HTML attachment was scrubbed...
> URL:
> http://lists.slony.info/pipermail/slony1-general/attachments/20071220/=3D
> 602a0c58/attachment-0001.htm
>
> ------------------------------
>
> Message: 5
> Date: Thu, 20 Dec 2007 11:31:42 -0500
> From: Vivek Khera <vivek@khera.org>
> Subject: Re: [Slony1-general] questions about slon_tools.conf
> To: Slony List <slony1-general@lists.slony.info>
> Message-ID: <5E13E951-3AAC-4D23-820F-EF8B97DB1522@khera.org>
> Content-Type: text/plain; charset=3DUS-ASCII; format=3Dflowed; delsp=3Dyes
>
>
> On Dec 19, 2007, at 6:12 PM, Geoffrey wrote:
>
>   =

>> As I understand it, if I'm replicating from one machine to another, I =

>> must have identical slon_tools.conf files on both machines.
>>     =

>
> no, you need to change teh connection string so each slon connects to
> its own server it is responsible for.
>
> the slons can run on any box; they just connect as clients to postgres.
> most people tend to run the associated slon on the same box as the
> postgres server.
>
>
>
> ------------------------------
>
> Message: 6
> Date: Thu, 20 Dec 2007 12:20:38 -0500
> From: Andrew Sullivan <ajs@crankycanuck.ca>
> Subject: Re: [Slony1-general] Applying schema changes in slony
> To: slony1-general@lists.slony.info
> Message-ID: <20071220172038.GC4924@crankycanuck.ca>
> Content-Type: text/plain; charset=3Dus-ascii
>
> On Wed, Dec 19, 2007 at 09:37:24PM -0500, Josh Harrison wrote:
>   =

>> In the production environment is this okay? Anyone had tried this? Are
>>     =

>
>   =

>> there
>>     =

>
> Basically, you have two choices in doing this:
>
> 1.  Schedule outages for upgrades.  If there's nothing else going on,
> the schema changes should go through very quickly.
>
> 2.  Do some timing trickery.  There was a problem report just yesterday
> or today that described how someone normally does this.  Basically, you
> use the replica as a read-only system, stop the slons, perform the
> EXECUTE SCRIPT on the origin, and then move your application back.
> Start the slons and thereby allow the replica to catch up.  There are
> potential gotchas about this; test your procedure carefully!
>
> A
>
>
>
>
> ------------------------------
>
> Message: 7
> Date: Thu, 20 Dec 2007 17:52:02 +0000 (GMT)
> From: Glyn Astill <glynastill@yahoo.co.uk>
> Subject: Re: [Slony1-general] Dropping a replication set?
> To: Glyn Astill <glynastill@yahoo.co.uk>,
> 	slony1-general@lists.slony.info
> Message-ID: <546863.26737.qm@web25807.mail.ukl.yahoo.com>
> Content-Type: text/plain; charset=3Diso-8859-1
>
> Any takers?
>
> --- Glyn Astill <glynastill@yahoo.co.uk> wrote:
>
>   =

>> Hi people,
>>
>> I setup a slony replication set for a table and subscribed my a node =

>> to it. However in the slony log the subscriber shows :
>>
>> 2007-12-20 11:50:38 GMT ERROR  remoteWorkerThread_1: node -1 not found
>>     =

>
>   =

>> in runtime configuration
>> 2007-12-20 11:50:38 GMT WARN   remoteWorkerThread_1: data copy for
>> set 3 failed - sleep 15 seconds
>>
>> I have no idea why this error has come about, the table I put in the =

>> replication set exists on both the publisher and subscriber.
>>
>> What I wanted to do was just drop the replication set from the =

>> publisher and subscriber and try setting it up again.
>>
>> I've done most of my setup using pgAdminIII, and it doesn't seem to =

>> have an option to drop the set. I did at one point manage to drop the =

>> set from the publisher, but it remained on the subscriber and I =

>> couldn't drop it. So I recreated it on the publisher to see if it'd =

>> help - to no avail and now I don't have the option to drop either.
>>
>> Could someone tell me how I'd go about dropping it from both the =

>> subscriber and the publisher?
>>
>> A pointer to a guide to doing the stuff pgAdmin does manually might be
>>     =

>
>   =

>> a help too.
>>
>> Thanks
>> Glyn
>>
>>
>>       ___________________________________________________________
>> Yahoo! Answers - Got a question? Someone out there knows the answer. =

>> Try it now.
>> http://uk.answers.yahoo.com/
>>
>> _______________________________________________
>> Slony1-general mailing list
>> Slony1-general@lists.slony.info
>> http://lists.slony.info/mailman/listinfo/slony1-general
>>
>>     =

>
>
>
> Glyn Astill
>
>
>
>       __________________________________________________________
> Sent from Yahoo! Mail - a smarter inbox http://uk.mail.yahoo.com
>
>
>
> ------------------------------
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>
>
> End of Slony1-general Digest, Vol 10, Issue 29
> **********************************************
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>   =



-- =

C=E9dric Villemain
Administrateur de Base de Donn=E9es
Cel: +33 (0)6 74 15 56 53
http://dalibo.com - http://dalibo.org

-------------- next part --------------
A non-text attachment was scrubbed...
Name: cedric.villemain.vcf
Type: text/x-vcard
Size: 266 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20071221=
/a5ac6669/cedric.villemain-0001.vcf
From lists at serioustechnology.com  Fri Dec 21 04:39:27 2007
From: lists at serioustechnology.com (Geoffrey)
Date: Fri Dec 21 04:39:49 2007
Subject: [Slony1-general] multiple databases replicated from the same machine
Message-ID: <476BB3FF.3090804@serioustechnology.com>

Well, I'm not getting any bites on this issue, so either I'm the first 
person to try this, or I have bad breath.. ;)

Quick question.  Is the slony_tools.conf file only used at 
initialization and startup of the slony processes?  That is, once I've 
got my replication up and running, is the slony_tools.conf file 
referenced again?  The point is, I'm thinking that I can create multiple 
slony_tools.conf files, one for each database.  Link the appropriate one 
during the startup of slony for that database, then move on to the next 
database once that replication is going for the first one.

It appears to me that the slony_tools.conf file is simply a perl module 
that must be referenced by the code, so I'm assuming I can make this 
work, I just don't want to be hacking a bunch of different scripts.

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From lists at serioustechnology.com  Fri Dec 21 10:59:27 2007
From: lists at serioustechnology.com (Geoffrey)
Date: Fri Dec 21 10:59:37 2007
Subject: [Slony1-general] questions about slon_tools.conf
In-Reply-To: <F1B0F9305B343E43A1C3EECE48B853D501340030@CITGSNA01SXCH02.ana.firstamdata.com>
References: <4769A563.9050704@serioustechnology.com>
	<5E13E951-3AAC-4D23-820F-EF8B97DB1522@khera.org>
	<476B29FF.8000103@serioustechnology.com>
	<F1B0F9305B343E43A1C3EECE48B853D501340030@CITGSNA01SXCH02.ana.firstamdata.com>
Message-ID: <476C0D0F.7060307@serioustechnology.com>

Tomeh, Husam wrote:
> All I had to do is run separate instances of slon process for each slony cluster. 

Are you using the slon_tools.conf file?  As I see it, it only has the 
ability to deal with one cluster at a time.

>  
> Regards,
>  
>        -  Husam
> 
> ________________________________
> 
> From: slony1-general-bounces@lists.slony.info on behalf of Geoffrey
> Sent: Thu 12/20/2007 6:50 PM
> To: Slony List
> Subject: Re: [Slony1-general] questions about slon_tools.conf
> 
> 
> 
> Vivek Khera wrote:
>> On Dec 19, 2007, at 6:12 PM, Geoffrey wrote:
>>
>>> As I understand it, if I'm replicating from one machine to another, I
>>> must have identical slon_tools.conf files on both machines.
>> no, you need to change teh connection string so each slon connects to
>> its own server it is responsible for.
>>
>> the slons can run on any box; they just connect as clients to postgres. 
>> most people tend to run the associated slon on the same box as the
>> postgres server.
> 
> Thanks for the response.  Any ideas on the other part of my post?  That
> is, how do I configure slony to handle multiple databases on one machine
> to be replicated to multiple instances on a second machine?
> 
> We have eleven postmasters running on one machine in order to be able to
> better control the configuration of each and limit downtime.  What I
> need to do is replicate all eleven to another machine.
> 
> The example slon_tools.conf file does not appear to lend itself to this.
>   There is one MASTERNODE, whereas I need eleven.
> 
> --
> Until later, Geoffrey
> 
> Those who would give up essential Liberty, to purchase a little
> temporary Safety, deserve neither Liberty nor Safety.
>   - Benjamin Franklin
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
> 
> 
> 
> 
> **********************************************************************
> This message contains confidential information intended only for the use of the addressee(s) named above and may contain information that is legally privileged.  If you are not the addressee, or the person responsible for delivering it to the addressee, you are hereby notified that reading, disseminating, distributing or copying this message is strictly prohibited.  If you have received this message by mistake, please immediately notify us by replying to the message and delete the original message immediately thereafter.
> 
> Thank you.
> 
>                                    FADLD Tag
> **********************************************************************
> 


-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From casey at pandora.com  Fri Dec 21 11:26:40 2007
From: casey at pandora.com (Casey Duncan)
Date: Fri Dec 21 11:26:47 2007
Subject: [Slony1-general] Applying schema changes in slony
In-Reply-To: <8d89ea1d0712191837s76f03d6bva36f61b3800c7afd@mail.gmail.com>
References: <8d89ea1d0712191837s76f03d6bva36f61b3800c7afd@mail.gmail.com>
Message-ID: <516869C8-1F93-4F13-82A9-D8305A95DFF6@pandora.com>


On Dec 19, 2007, at 6:37 PM, Josh Harrison wrote:

> Hi
> I have a couple of questions regarding applying  schema changes in  
> slony
> The manual says
> "When you run EXECUTE SCRIPT, this causes the slonik to request,  
> for each table in the specified set, an exclusive table lock"
> So all the tables in the master and slave are locked for that time?  
> So the applications accessing that specified set of tables will  
> receive some error or something atthat particular time? How long is  
> this time generally?

The time it takes is a function of:

how long it takes to acquire the lock (all other transactions must  
complete first)
how long the ddl you are executing takes to run.

The latter could be anywhere from instantaneous to many hours  
depending on what you are doing and on how much data.

Note that you can control when the execute script actually runs on  
the secondaries by stopping and starting the slon daemons. This  
allows you to switch your applications to a secondary while the  
script is executing on the primary, and vice-versa when it executes  
on the secondaries. Of course while you are switched to the  
secondaries, your application cannot write to replicated tables,  
which are read-only there.

> In the production environment is this okay? Anyone had tried this?  
> Are there any other problems that you had encountered using execute  
> script in the production env?  Is there any other alternatives?

Whether it is ok or not is a total matter of policy. Execute script  
is typically not problematic in and of itself, but it's locking  
behavior is something that needs careful consideration. It means that  
you can have no client transactions on the replicated table set for  
the duration of the execute script. If you have clients executing  
transactions concurrently with execute script, you will find that it  
creates deadlocks rather readily.

Note that structural changes to your database (alter table, etc) will  
require exclusive locks on tables anyhow, so it could interfere with  
applications in a similar way to execute script. What makes execute  
script more disruptive is that it always takes exclusive locks on all  
tables in the table set every time.

Here are some "alternatives" for mitigating execute script's locking  
behavior:

- Switch applications to other nodes while a node is being upgraded.  
Modulate the upgrade timing by stopping and starting the slon  
daemons. (This is what I do)
- Use many small table sets instead of one big one. This means you  
may need multiple execute script statements, but each one will lock  
fewer tables at once.
- Don't use execute script for things that don't directly affect  
replication. For example, adding an index. Note that execute script  
can be very useful for large data changes, however, because changing  
millions of rows can be very painful to replicate row-by-row.

hth,

-Casey
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071221/388ddc77/attachment.htm
From darcyb at commandprompt.com  Fri Dec 21 13:42:15 2007
From: darcyb at commandprompt.com (Darcy Buskermolen)
Date: Fri Dec 21 13:42:25 2007
Subject: [Slony1-general] multiple databases replicated from the same
	machine
In-Reply-To: <476BB3FF.3090804@serioustechnology.com>
References: <476BB3FF.3090804@serioustechnology.com>
Message-ID: <200712211342.15882.darcyb@commandprompt.com>

On Friday 21 December 2007 04:39:27 Geoffrey wrote:
> Well, I'm not getting any bites on this issue, so either I'm the first
> person to try this, or I have bad breath.. ;)
>
> Quick question.  Is the slony_tools.conf file only used at
> initialization and startup of the slony processes?  That is, once I've
> got my replication up and running, is the slony_tools.conf file
> referenced again?  The point is, I'm thinking that I can create multiple
> slony_tools.conf files, one for each database.  Link the appropriate one
> during the startup of slony for that database, then move on to the next
> database once that replication is going for the first one.

slon_tools.conf is uses everytime you use one of the helper scripts to manage 
your replication, weather this is to to perform DDL, failover, switchover, 
add a node or remove a node (and more).



>
> It appears to me that the slony_tools.conf file is simply a perl module
> that must be referenced by the code, so I'm assuming I can make this
> work, I just don't want to be hacking a bunch of different scripts.

All of the tools if I'm not mistaken have the ability to be passed a config 
file, so there should be no hacking required.  except on those tools which 
can;t be passed a config file.




-- 
Darcy Buskermolen
Command Prompt, Inc.
+1.503.667.4564 X 102
http://www.commandprompt.com/
PostgreSQL solutions since 1997
From cbbrowne at ca.afilias.info  Fri Dec 21 15:35:46 2007
From: cbbrowne at ca.afilias.info (cbbrowne@ca.afilias.info)
Date: Fri Dec 21 15:35:56 2007
Subject: [Slony1-general] questions about slon_tools.conf
In-Reply-To: <476B29FF.8000103@serioustechnology.com>
References: <4769A563.9050704@serioustechnology.com>
	<5E13E951-3AAC-4D23-820F-EF8B97DB1522@khera.org>
	<476B29FF.8000103@serioustechnology.com>
Message-ID: <60562.64.229.177.7.1198280146.squirrel@look.libertyrms.info>

> Vivek Khera wrote:
>>
>> On Dec 19, 2007, at 6:12 PM, Geoffrey wrote:
>>
>>> As I understand it, if I'm replicating from one machine to another, I
>>> must have identical slon_tools.conf files on both machines.
>>
>> no, you need to change teh connection string so each slon connects to
>> its own server it is responsible for.
>>
>> the slons can run on any box; they just connect as clients to postgres.
>> most people tend to run the associated slon on the same box as the
>> postgres server.
>
> Thanks for the response.  Any ideas on the other part of my post?  That
> is, how do I configure slony to handle multiple databases on one machine
> to be replicated to multiple instances on a second machine?
>
> We have eleven postmasters running on one machine in order to be able to
> better control the configuration of each and limit downtime.  What I
> need to do is replicate all eleven to another machine.
>
> The example slon_tools.conf file does not appear to lend itself to this.
>   There is one MASTERNODE, whereas I need eleven.

On the one hand, the "altperl" Slony-I tools were only intended to deal
with relatively simple situations.  What you're trying to do falls pretty
clearly outside that "simplicity."

On another, I am not sure what sort of configuration to prefer, for this. 
I see two ways:

1.  To have 11 clusters, one for each "master database."  In that case,
each cluster is a simple one; you could use slon-tools.conf, but you'd
need to have 11 configurations.

2.  To have 1 cluster, where there are 12 nodes and 11 subscriptions. 
This feels like it has fewer "moving parts" than the "11 cluster"
approach.

If you're doing things that are this esoteric, don't expect the
'simplified tools' to work for you.  You'll need to write slonik scripts
"by hand."  Fortunately, it's not a severely complex language - it's
pretty simple to write such scripts.  (At least, the language is
simple...)




From cbbrowne at ca.afilias.info  Fri Dec 21 15:47:28 2007
From: cbbrowne at ca.afilias.info (cbbrowne@ca.afilias.info)
Date: Fri Dec 21 15:47:37 2007
Subject: [Slony1-general] multiple databases replicated from the same 
	machine
In-Reply-To: <476BB3FF.3090804@serioustechnology.com>
References: <476BB3FF.3090804@serioustechnology.com>
Message-ID: <60871.64.229.177.7.1198280848.squirrel@look.libertyrms.info>

> Well, I'm not getting any bites on this issue, so either I'm the first
> person to try this, or I have bad breath.. ;)
>
> Quick question.  Is the slony_tools.conf file only used at
> initialization and startup of the slony processes?  That is, once I've
> got my replication up and running, is the slony_tools.conf file
> referenced again?  The point is, I'm thinking that I can create multiple
> slony_tools.conf files, one for each database.  Link the appropriate one
> during the startup of slony for that database, then move on to the next
> database once that replication is going for the first one.
>
> It appears to me that the slony_tools.conf file is simply a perl module
> that must be referenced by the code, so I'm assuming I can make this
> work, I just don't want to be hacking a bunch of different scripts.

There is a "start_slon" script that references the slony_tools.conf to
find nodes.  So possibly there's a need to re-reference the .conf file.

However, it is highly preferred to use the more modern (and WAY simpler)
"tools/launch_clusters.sh" for that purpose.  (Indeed, anyone still using
"altperl" tools to run slons should be aware, and you guys know well who
you are! ;-), that I decline to continue to provide support for that!)

At any rate, the usual right answer is that the .conf file is mostly for
constructing the cluster, and once it's running that file ought to be
redundant.

From lists at serioustechnology.com  Fri Dec 21 17:17:14 2007
From: lists at serioustechnology.com (Geoffrey)
Date: Fri Dec 21 17:17:28 2007
Subject: [Slony1-general] questions about slon_tools.conf
In-Reply-To: <60562.64.229.177.7.1198280146.squirrel@look.libertyrms.info>
References: <4769A563.9050704@serioustechnology.com>
	<5E13E951-3AAC-4D23-820F-EF8B97DB1522@khera.org>
	<476B29FF.8000103@serioustechnology.com>
	<60562.64.229.177.7.1198280146.squirrel@look.libertyrms.info>
Message-ID: <476C659A.8070300@serioustechnology.com>

cbbrowne@ca.afilias.info wrote:
>> Vivek Khera wrote:
>>> On Dec 19, 2007, at 6:12 PM, Geoffrey wrote:
>>>
>>>> As I understand it, if I'm replicating from one machine to another, I
>>>> must have identical slon_tools.conf files on both machines.
>>> no, you need to change teh connection string so each slon connects to
>>> its own server it is responsible for.
>>>
>>> the slons can run on any box; they just connect as clients to postgres.
>>> most people tend to run the associated slon on the same box as the
>>> postgres server.
>> Thanks for the response.  Any ideas on the other part of my post?  That
>> is, how do I configure slony to handle multiple databases on one machine
>> to be replicated to multiple instances on a second machine?
>>
>> We have eleven postmasters running on one machine in order to be able to
>> better control the configuration of each and limit downtime.  What I
>> need to do is replicate all eleven to another machine.
>>
>> The example slon_tools.conf file does not appear to lend itself to this.
>>   There is one MASTERNODE, whereas I need eleven.
> 
> On the one hand, the "altperl" Slony-I tools were only intended to deal
> with relatively simple situations.  What you're trying to do falls pretty
> clearly outside that "simplicity."
> 
> On another, I am not sure what sort of configuration to prefer, for this. 
> I see two ways:
> 
> 1.  To have 11 clusters, one for each "master database."  In that case,
> each cluster is a simple one; you could use slon-tools.conf, but you'd
> need to have 11 configurations.

As I expected.

> 2.  To have 1 cluster, where there are 12 nodes and 11 subscriptions. 
> This feels like it has fewer "moving parts" than the "11 cluster"
> approach.

I don't see how this would work. I guess I'm stuck on the single 
MASTERNODE value in the slon_tools.conf file.  Wouldn't all 11 
subscriptions be subscribed to a single database? I'll have to put some 
thought to this approach.

> If you're doing things that are this esoteric, don't expect the
> 'simplified tools' to work for you.  You'll need to write slonik scripts
> "by hand."  Fortunately, it's not a severely complex language - it's
> pretty simple to write such scripts.  (At least, the language is
> simple...)

This is what I'm working on right now.  The nice thing is that the 
scripts send the output to standard out, so I can take that output 
produced, save it, tweek it for the next database and so on.

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From lists at serioustechnology.com  Fri Dec 21 17:18:32 2007
From: lists at serioustechnology.com (Geoffrey)
Date: Fri Dec 21 17:18:45 2007
Subject: [Slony1-general] multiple databases replicated from the same
	machine
In-Reply-To: <60871.64.229.177.7.1198280848.squirrel@look.libertyrms.info>
References: <476BB3FF.3090804@serioustechnology.com>
	<60871.64.229.177.7.1198280848.squirrel@look.libertyrms.info>
Message-ID: <476C65E8.5040502@serioustechnology.com>

cbbrowne@ca.afilias.info wrote:
>> Well, I'm not getting any bites on this issue, so either I'm the first
>> person to try this, or I have bad breath.. ;)
>>
>> Quick question.  Is the slony_tools.conf file only used at
>> initialization and startup of the slony processes?  That is, once I've
>> got my replication up and running, is the slony_tools.conf file
>> referenced again?  The point is, I'm thinking that I can create multiple
>> slony_tools.conf files, one for each database.  Link the appropriate one
>> during the startup of slony for that database, then move on to the next
>> database once that replication is going for the first one.
>>
>> It appears to me that the slony_tools.conf file is simply a perl module
>> that must be referenced by the code, so I'm assuming I can make this
>> work, I just don't want to be hacking a bunch of different scripts.
> 
> There is a "start_slon" script that references the slony_tools.conf to
> find nodes.  So possibly there's a need to re-reference the .conf file.
> 
> However, it is highly preferred to use the more modern (and WAY simpler)
> "tools/launch_clusters.sh" for that purpose.  (Indeed, anyone still using
> "altperl" tools to run slons should be aware, and you guys know well who
> you are! ;-), that I decline to continue to provide support for that!)

That's good to know.  Maybe the documentation should be updated to 
reflect that?

> At any rate, the usual right answer is that the .conf file is mostly for
> constructing the cluster, and once it's running that file ought to be
> redundant.

Thanks for your input and assistance.

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From cbbrowne at ca.afilias.info  Fri Dec 21 20:53:17 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri Dec 21 20:53:31 2007
Subject: [Slony1-general] questions about slon_tools.conf
In-Reply-To: <476C659A.8070300@serioustechnology.com> (Geoffrey's message of
	"Fri, 21 Dec 2007 20:17:14 -0500")
References: <4769A563.9050704@serioustechnology.com>
	<5E13E951-3AAC-4D23-820F-EF8B97DB1522@khera.org>
	<476B29FF.8000103@serioustechnology.com>
	<60562.64.229.177.7.1198280146.squirrel@look.libertyrms.info>
	<476C659A.8070300@serioustechnology.com>
Message-ID: <60fxxvtjnm.fsf@dba2.int.libertyrms.com>

Geoffrey <lists@serioustechnology.com> writes:
>> 2.  To have 1 cluster, where there are 12 nodes and 11
>> subscriptions. This feels like it has fewer "moving parts" than the
>> "11 cluster"
>> approach.
>
> I don't see how this would work. I guess I'm stuck on the single
> MASTERNODE value in the slon_tools.conf file.  Wouldn't all 11
> subscriptions be subscribed to a single database? I'll have to put
> some thought to this approach.

There isn't a way (not an easy one, anyways) to use the "altperl"
tools to do this.

You need to drop the idea that you're using those tools if you go down
this road.

I'm not sure what to use as an analogy here.  Perhaps the following
isn't too painful?

In the Windows world, you can use VB (or VB.NET) to write some limited
set of kinds of graphical applications.  If you need to build some
wacky specialized widget, VB may not be able to support you.  You'd be
forced to use the underlying APIs, probably in C++.

The analogy falls down a bit there - jumping from the frying pan of
"what some pre-cooked framework can do" to the fire of "ew - direct
coding via C++ APIs" is a lot worse than jumping from "what altperl
slony tools support" to "what handcoded slonik can do."  Handcoded
slonik scripts aren't particularly heinous :-).

>> If you're doing things that are this esoteric, don't expect the
>> 'simplified tools' to work for you.  You'll need to write slonik scripts
>> "by hand."  Fortunately, it's not a severely complex language - it's
>> pretty simple to write such scripts.  (At least, the language is
>> simple...)
>
> This is what I'm working on right now.  The nice thing is that the
> scripts send the output to standard out, so I can take that output
> produced, save it, tweek it for the next database and so on.

That will take you a fair ways.
-- 
select 'cbbrowne' || '@' || 'linuxfinances.info';
http://www3.sympatico.ca/cbbrowne/internet.html
"Linux poses  a real challenge for  those with a  taste for late-night
hacking (and/or conversations with God)." -- Matt Welsh
From joshques at gmail.com  Thu Dec 27 07:49:10 2007
From: joshques at gmail.com (Josh Harrison)
Date: Thu Dec 27 07:49:14 2007
Subject: [Slony1-general] Any big slony and WAL shipping users?
Message-ID: <8d89ea1d0712270749x3a2f7f57u522f3d0b4b9f5876@mail.gmail.com>

Hi,
We are trying to use slony and WAL shipping for warm standby for replication
with postgresql. Currently our systems are in oracle and we r checking the
feasibility to migrate to postgres. Replication is one major issue here.
Though everything seems to be working fine in our test environment, we just
want the assurance that Slony and WAL shipping is used by other large
production systems and running successfully.
What are the other large 24x7 productions systems that use slony and the
other WAL archiving of postgresql successfully?

Thanks
josh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071227/=
36a2c3cd/attachment.htm
From ajs at crankycanuck.ca  Thu Dec 27 09:37:32 2007
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Thu Dec 27 09:37:49 2007
Subject: [Slony1-general] Any big slony and WAL shipping users?
In-Reply-To: <8d89ea1d0712270749x3a2f7f57u522f3d0b4b9f5876@mail.gmail.com>
References: <8d89ea1d0712270749x3a2f7f57u522f3d0b4b9f5876@mail.gmail.com>
Message-ID: <20071227173732.GB12137@crankycanuck.ca>

On Thu, Dec 27, 2007 at 10:49:10AM -0500, Josh Harrison wrote:
> Hi,
> We are trying to use slony and WAL shipping for warm standby for replication

It's unusual to use both.  Any reason you want to?

Anyway. . .

> What are the other large 24x7 productions systems that use slony and the
> other WAL archiving of postgresql successfully?

Slony was originally written by Jan Wieck, and released by Afilias
(disclosure: currently my employer).  Afilias wrote it because we needed
better replication, and there were no community-offered systems.  We run the
registries for several Internet top-level domains, including .info and .org. 
We have fairly stringent uptime guarantees, and reasonably high transaction
volumes.  The databases are not immense, however.  Nevertheless, all the DNS
changes for .org (for instance) today are dependent on Slony operating
correctly.  I wouldn't say the system is perfect, but I think I can safely
say we've been quite happy with its flexibility.  User-space tools are a
little, uh, geeky still (with the possible exception of the GUI support --
our system deployment makes that a little hard for us to use).

There is someone who is using Slony to operate some rather large databases;
he can post here if he wants to share his experience with you.

A
From joshques at gmail.com  Thu Dec 27 09:49:55 2007
From: joshques at gmail.com (Josh Harrison)
Date: Thu Dec 27 09:50:03 2007
Subject: [Slony1-general] Any big slony and WAL shipping users?
In-Reply-To: <20071227173732.GB12137@crankycanuck.ca>
References: <8d89ea1d0712270749x3a2f7f57u522f3d0b4b9f5876@mail.gmail.com>
	<20071227173732.GB12137@crankycanuck.ca>
Message-ID: <8d89ea1d0712270949ra1570bv1ad553c955c56121@mail.gmail.com>

On Dec 27, 2007 12:37 PM, Andrew Sullivan <ajs@crankycanuck.ca> wrote:

> On Thu, Dec 27, 2007 at 10:49:10AM -0500, Josh Harrison wrote:
> > Hi,
> > We are trying to use slony and WAL shipping for warm standby for
> replication
>
> It's unusual to use both.  Any reason you want to?


We wanted to have 1 master and 1 slave that can be queried and 1 warm
standby server that can be brought up in case of crash.  So I thought it
might be better to have WAL shipping for warm standby since thats working
pretty good and Slony for master-slave replication.
Let me know your comments on this setup? What is better for this setup?


>
> Anyway. . .
>
> > What are the other large 24x7 productions systems that use slony and the
> > other WAL archiving of postgresql successfully?
>
> Slony was originally written by Jan Wieck, and released by Afilias
> (disclosure: currently my employer).  Afilias wrote it because we needed
> better replication, and there were no community-offered systems.  We run
> the
> registries for several Internet top-level domains, including .info and
> .org.
> We have fairly stringent uptime guarantees, and reasonably high
> transaction
> volumes.  The databases are not immense, however.  Nevertheless, all the
> DNS
> changes for .org (for instance) today are dependent on Slony operating
> correctly.  I wouldn't say the system is perfect, but I think I can safely
> say we've been quite happy with its flexibility.  User-space tools are a
> little, uh, geeky still (with the possible exception of the GUI support --
> our system deployment makes that a little hard for us to use).
>
> There is someone who is using Slony to operate some rather large
> databases;
> he can post here if he wants to share his experience with you.


That will be very useful since our people are debating on the reliability of
Slony for large databases!!!

Thanks
Josh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071227/=
db9f7e89/attachment.htm
From ajs at crankycanuck.ca  Thu Dec 27 10:08:50 2007
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Thu Dec 27 10:09:02 2007
Subject: [Slony1-general] Any big slony and WAL shipping users?
In-Reply-To: <8d89ea1d0712270949ra1570bv1ad553c955c56121@mail.gmail.com>
References: <8d89ea1d0712270749x3a2f7f57u522f3d0b4b9f5876@mail.gmail.com>
	<20071227173732.GB12137@crankycanuck.ca>
	<8d89ea1d0712270949ra1570bv1ad553c955c56121@mail.gmail.com>
Message-ID: <20071227180850.GF12137@crankycanuck.ca>

Note: I've removed -general, since this is really just a Slony discussion.

On Thu, Dec 27, 2007 at 12:49:55PM -0500, Josh Harrison wrote:
> We wanted to have 1 master and 1 slave that can be queried and 1 warm
> standby server that can be brought up in case of crash.  So I thought it
> might be better to have WAL shipping for warm standby since thats working
> pretty good and Slony for master-slave replication.
> Let me know your comments on this setup? What is better for this setup?

The disadvantage of that approach is that you have two different systems you
have to maintain.  You could maintain more than one Slony replica, which
would have the advantage of flexibility.  For instance, you could have two
replicas, and in the event your origin failed, you just move the origin to
one of the replicas.  If one of your replicas failed, however, you could
use the other replica for whatever thing the failed-replica was doing (so
your "query-only" system could also be your standby while you repaired the
other standby).

In general, I think the best arrangement is the least complicated one.  Two
different replication strategies in the same mix seems to me to be the sort
of complication that will make emergency recovery harder.  OTOH, two
different strategies presumably protects you from bugs in the other code. 
(For instance, a DNS company runs completely different name server code on
completely different hardware and OS platforms in order to make sure not to
be vulnerable to day-0 exploits.  That kind of thing.)

> That will be very useful since our people are debating on the reliability of
> Slony for large databases!!!

The size of the database is not the determining factor in Slony reliability. 
What is the change rate on your systems?  That's the big factor in any
replication system, really.  Afilias's systems are quite active -- there's a
_lot_ of churn on top level domains these days.

A

From simon at 2ndquadrant.com  Thu Dec 27 11:27:34 2007
From: simon at 2ndquadrant.com (Simon Riggs)
Date: Thu Dec 27 11:27:22 2007
Subject: [GENERAL] [Slony1-general] Any big slony and WAL shipping users?
In-Reply-To: <8d89ea1d0712270949ra1570bv1ad553c955c56121@mail.gmail.com>
References: <8d89ea1d0712270749x3a2f7f57u522f3d0b4b9f5876@mail.gmail.com>
	<20071227173732.GB12137@crankycanuck.ca>
	<8d89ea1d0712270949ra1570bv1ad553c955c56121@mail.gmail.com>
Message-ID: <1198783654.4221.355.camel@ebony.site>

On Thu, 2007-12-27 at 12:49 -0500, Josh Harrison wrote:
> 
> 
> On Dec 27, 2007 12:37 PM, Andrew Sullivan <ajs@crankycanuck.ca> wrote:
>         On Thu, Dec 27, 2007 at 10:49:10AM -0500, Josh Harrison wrote:
>         > Hi,
>         > We are trying to use slony and WAL shipping for warm standby
>         for replication
>         
>         
>         It's unusual to use both.  Any reason you want to?
> 
> We wanted to have 1 master and 1 slave that can be queried and 1 warm
> standby server that can be brought up in case of crash.  So I thought
> it might be better to have WAL shipping for warm standby since thats
> working pretty good and Slony for master-slave replication. 
> Let me know your comments on this setup? What is better for this
> setup?

That's a setup I've recommended in the past.

It's like using RAC and Data Guard together, which is also common.

-- 
  Simon Riggs
  2ndQuadrant  http://www.2ndQuadrant.com

From glynastill at yahoo.co.uk  Fri Dec 28 06:29:35 2007
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Fri Dec 28 06:29:39 2007
Subject: [Slony1-general] Re: [GENERAL] Any big slony and WAL shipping users?
In-Reply-To: <8d89ea1d0712270749x3a2f7f57u522f3d0b4b9f5876@mail.gmail.com>
Message-ID: <361160.36878.qm@web25812.mail.ukl.yahoo.com>

Hi Josh,

This is exactly the same setup I'm currently testing. For those
asking why use both WAL shipping and slony, it's simple; this means
we have no single point of failure. If slony stops replicating
because we mess up a replication set or our shipping method (NFS)
falls on its ass, at least we still have some replication going.

We have to use slony, like you we need a replica to take the load off
of our main system, this is mainly for our reporting processes.

Glyn

 
--- Josh Harrison <joshques@gmail.com> wrote:

> Hi,
> We are trying to use slony and WAL shipping for warm standby for
> replication
> with postgresql. Currently our systems are in oracle and we r
> checking the
> feasibility to migrate to postgres. Replication is one major issue
> here.
> Though everything seems to be working fine in our test environment,
> we just
> want the assurance that Slony and WAL shipping is used by other
> large
> production systems and running successfully.
> What are the other large 24x7 productions systems that use slony
> and the
> other WAL archiving of postgresql successfully?
> 
> Thanks
> josh
> 



      ___________________________________________________________
Yahoo! Answers - Got a question? Someone out there knows the answer. Try it
now.
http://uk.answers.yahoo.com/

From joshques at gmail.com  Fri Dec 28 09:06:42 2007
From: joshques at gmail.com (Josh Harrison)
Date: Fri Dec 28 09:06:48 2007
Subject: [Slony1-general] Re: [GENERAL] Any big slony and WAL shipping users?
In-Reply-To: <361160.36878.qm@web25812.mail.ukl.yahoo.com>
References: <8d89ea1d0712270749x3a2f7f57u522f3d0b4b9f5876@mail.gmail.com>
	<361160.36878.qm@web25812.mail.ukl.yahoo.com>
Message-ID: <8d89ea1d0712280906o27a90666v553904feb45c9e3a@mail.gmail.com>

Hi,
Thanks for all your response.
I also thought abt having 2 setups for backup and replication so that even
when slony fails I will always have the standby server (WAL shipping) to
help me out.
 I have another question regarding this. I also want to write these to the
tape. Right now we have a cron job doing level 0,1,2,...  backups of the
other servers to the tape regularly. What is the good way to include
postgres server backup to tape?
Thanks
josh

On Dec 28, 2007 9:29 AM, Glyn Astill <glynastill@yahoo.co.uk> wrote:

> Hi Josh,
>
> This is exactly the same setup I'm currently testing. For those
> asking why use both WAL shipping and slony, it's simple; this means
> we have no single point of failure. If slony stops replicating
> because we mess up a replication set or our shipping method (NFS)
> falls on its ass, at least we still have some replication going.
>
> We have to use slony, like you we need a replica to take the load off
> of our main system, this is mainly for our reporting processes.
>
> Glyn
>
>
> --- Josh Harrison <joshques@gmail.com> wrote:
>
> > Hi,
> > We are trying to use slony and WAL shipping for warm standby for
> > replication
> > with postgresql. Currently our systems are in oracle and we r
> > checking the
> > feasibility to migrate to postgres. Replication is one major issue
> > here.
> > Though everything seems to be working fine in our test environment,
> > we just
> > want the assurance that Slony and WAL shipping is used by other
> > large
> > production systems and running successfully.
> > What are the other large 24x7 productions systems that use slony
> > and the
> > other WAL archiving of postgresql successfully?
> >
> > Thanks
> > josh
> >
>
>
>
>      ___________________________________________________________
> Yahoo! Answers - Got a question? Someone out there knows the answer. Try
> it
> now.
> http://uk.answers.yahoo.com/
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071228/=
926ae289/attachment.htm
From vivek at khera.org  Sun Dec 30 09:26:55 2007
From: vivek at khera.org (Vivek Khera)
Date: Sun Dec 30 09:27:01 2007
Subject: [Slony1-general] warning during subscribe seems like a bug 
Message-ID: <D73E09BB-F02E-41A6-A94D-5E069709983B@khera.org>

I'm adding another table to my replication cluster, and created a new  
set with a single table in it.  The initial data copy failed because  
of some other transaction still being open, so it delayed.  The  
curious part is when the second (and every subsequent0 copy also  
failed, it issued a warning about "no transactin in progress" as shown  
below.  That warning is issued on every subsequent failure to  
subscribe the set.  (Turns out to be a vacuum that started just a  
minute prior to my subscribe!)


2007-12-30 12:02:18.645226500 DEBUG1 copy_set 3
2007-12-30 12:02:18.664078500 DEBUG1 remoteWorkerThread_4: connected  
to provider DB
2007-12-30 12:02:18.708326500 WARN   remoteWorkerThread_4:  
transactions earlier than XID 553658082 are still in progress
2007-12-30 12:02:18.711129500 WARN   remoteWorkerThread_4: data copy  
for set 3 failed - sleep 15 seconds
2007-12-30 12:02:33.713699500 DEBUG1 copy_set 3
2007-12-30 12:02:33.724418500 DEBUG1 remoteWorkerThread_4: connected  
to provider DB
2007-12-30 12:02:33.741157500 WARN   remoteWorkerThread_4:  
transactions earlier than XID 553658082 are still in progress
2007-12-30 12:02:33.741201500 WARN   remoteWorkerThread_4: data copy  
for set 3 failed - sleep 30 seconds
2007-12-30 12:02:33.741527500 WARNING:  there is no transaction in  
progress
2007-12-30 12:03:03.743469500 DEBUG1 copy_set 3
2007-12-30 12:03:03.752889500 DEBUG1 remoteWorkerThread_4: connected  
to provider DB
2007-12-30 12:03:03.759128500 WARN   remoteWorkerThread_4:  
transactions earlier than XID 553658082 are still in progress
2007-12-30 12:03:03.759269500 WARN   remoteWorkerThread_4: data copy  
for set 3 failed - sleep 60 seconds
2007-12-30 12:03:03.759571500 WARNING:  there is no transaction in  
progress
From heraud at tatm.com  Sun Dec 30 10:54:18 2007
From: heraud at tatm.com (Pascal Heraud)
Date: Sun Dec 30 10:55:04 2007
Subject: [Slony1-general] Slony1 and Geospatial data using PostGis
Message-ID: <4777E95A.9020909@tatm.com>

Hello all!

We're looking at migrating our the mecanism for replicating our 
production database to a spare server. Currently it's replicated every 
hour using in-house scripts and working well but will not produce a 
"fresh" copy of the database in case of switch.

That's why slony1 seems the best solution for us as we don't need to 
have two live DBs but a replication mecanism that is able more real-time.
The issue is that we are using spatial data with "PostGis" ( a library 
of types and functions to handle spatial data ).

I search the slony1 FAQ and googling but didn't find any information 
about the couple "Slony1-PostGis".
==>Do you know if slony1 works with PostGis, do we have any feedback 
about mixing them ? Is there any known issue or success story ?

Thank you for help !

Pascal.
LaRoueVerte
http://laroueverte.com

From cbbrowne at ca.afilias.info  Sun Dec 30 12:42:44 2007
From: cbbrowne at ca.afilias.info (cbbrowne@ca.afilias.info)
Date: Sun Dec 30 12:42:51 2007
Subject: [Slony1-general] warning during subscribe seems like a bug
In-Reply-To: <D73E09BB-F02E-41A6-A94D-5E069709983B@khera.org>
References: <D73E09BB-F02E-41A6-A94D-5E069709983B@khera.org>
Message-ID: <62278.64.229.229.122.1199047364.squirrel@look.libertyrms.info>

> I'm adding another table to my replication cluster, and created a new
> set with a single table in it.  The initial data copy failed because
> of some other transaction still being open, so it delayed.  The
> curious part is when the second (and every subsequent0 copy also
> failed, it issued a warning about "no transactin in progress" as shown
> below.  That warning is issued on every subsequent failure to
> subscribe the set.  (Turns out to be a vacuum that started just a
> minute prior to my subscribe!)

> 2007-12-30 12:03:03.743469500 DEBUG1 copy_set 3
> 2007-12-30 12:03:03.752889500 DEBUG1 remoteWorkerThread_4: connected
> to provider DB
> 2007-12-30 12:03:03.759128500 WARN   remoteWorkerThread_4:
> transactions earlier than XID 553658082 are still in progress
> 2007-12-30 12:03:03.759269500 WARN   remoteWorkerThread_4: data copy
> for set 3 failed - sleep 60 seconds
> 2007-12-30 12:03:03.759571500 WARNING:  there is no transaction in
> progress

That WARNING message is consistent with running ROLLBACK against the
provider node after not having done *any* work.

It's probably plausible to hunt this down, and if there has been no work,
to not bother with the ROLLBACK, however, I don't think it fixes terribly
much.

But from a "paranoid programming" perspective, I'd rather be a little
paranoid and *always* ROLLBACK at the end of the COPY_SET attempt, even at
the cost of the (not worrisome) warnings that you're seeing here.

From Gregory.Williamson at digitalglobe.com  Sun Dec 30 16:39:08 2007
From: Gregory.Williamson at digitalglobe.com (Gregory Williamson)
Date: Sun Dec 30 16:42:57 2007
Subject: [Slony1-general] Slony1 and Geospatial data using PostGis
References: <4777E95A.9020909@tatm.com>
Message-ID: <8B319E5A30FF4A48BE7EEAAF609DB233015E3141@COMAIL01.digitalglobe.com>

Pascal --

I've posted a similar question and have been monitoring this and other list=
s for some time, and I _think_ that Slony1 will quite happily deal with spa=
tial data; Slony1 does not seem to be limited to native PostgreSQL types.

The one gotcha might be speed if there are lots of large spatial objects to=
 be moved because of updates or inserts.

I'll be wading into this in the next few weeks and will post here or to the=
 postGIS list if I find any issues.

Apologies for top-posting -- very challenged mail reader.

Greg Williamson
Senior DBA
GlobeXplorer LLC, a DigitalGlobe company


-----Original Message-----
From: slony1-general-bounces@lists.slony.info on behalf of Pascal Heraud
Sent: Sun 12/30/2007 11:54 AM
To: slony1-general@lists.slony.info
Subject: [Slony1-general] Slony1 and Geospatial data using PostGis
 =

Hello all!

We're looking at migrating our the mecanism for replicating our =

production database to a spare server. Currently it's replicated every =

hour using in-house scripts and working well but will not produce a =

"fresh" copy of the database in case of switch.

That's why slony1 seems the best solution for us as we don't need to =

have two live DBs but a replication mecanism that is able more real-time.
The issue is that we are using spatial data with "PostGis" ( a library =

of types and functions to handle spatial data ).

I search the slony1 FAQ and googling but didn't find any information =

about the couple "Slony1-PostGis".
=3D=3D>Do you know if slony1 works with PostGis, do we have any feedback =

about mixing them ? Is there any known issue or success story ?

Thank you for help !

Pascal.
LaRoueVerte
http://laroueverte.com

_______________________________________________
Slony1-general mailing list
Slony1-general@lists.slony.info
http://lists.slony.info/mailman/listinfo/slony1-general

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071230/=
d8157d73/attachment.htm
From vivek at khera.org  Mon Dec 31 06:38:44 2007
From: vivek at khera.org (Vivek Khera)
Date: Mon Dec 31 06:38:48 2007
Subject: [Slony1-general] warning during subscribe seems like a bug
In-Reply-To: <62278.64.229.229.122.1199047364.squirrel@look.libertyrms.info>
References: <D73E09BB-F02E-41A6-A94D-5E069709983B@khera.org>
	<62278.64.229.229.122.1199047364.squirrel@look.libertyrms.info>
Message-ID: <19F78239-E077-4DB8-9DE0-9A148BD47515@khera.org>


On Dec 30, 2007, at 3:42 PM, cbbrowne@ca.afilias.info wrote:

> It's probably plausible to hunt this down, and if there has been no  
> work,
> to not bother with the ROLLBACK, however, I don't think it fixes  
> terribly
> much.
>
> But from a "paranoid programming" perspective, I'd rather be a little
> paranoid and *always* ROLLBACK at the end of the COPY_SET attempt,  
> even at
> the cost of the (not worrisome) warnings that you're seeing here.

Sounds like a plan to me!  But the part that confused me was it only  
happened on the subsequent subscribe attempts; not on the initial.

From HTomeh at facorelogic.com  Wed Dec 12 09:06:48 2007
From: HTomeh at facorelogic.com (Tomeh, Husam)
Date: Thu Sep 25 08:26:28 2008
Subject: [Slony1-general] Slony-I: subscribeSet(): set 1 not found
 ERROR
In-Reply-To: <8d89ea1d0712120859g516bbf66sc90d790eb7e106c3@mail.gmail.com>
References: <8d89ea1d0712120859g516bbf66sc90d790eb7e106c3@mail.gmail.com>
Message-ID: <F1B0F9305B343E43A1C3EECE48B853D501A83F46@CITGSNA01SXCH02.ana.firstamdata.com>

Have you created your replication set(s) before attempting to issue the
subscribe command?  The error may suggest that the set doesn't exist.
 
Regards,
 
    -  Husam

________________________________

From: slony1-general-bounces@lists.slony.info
[mailto:slony1-general-bounces@lists.slony.info] On Behalf Of Josh
Harrison
Sent: Wednesday, December 12, 2007 9:00 AM
To: slony1-general@lists.slony.info
Subject: [Slony1-general] Slony-I: subscribeSet(): set 1 not found ERROR


Hi,
Im trying slony for the first time....   
Slon is running in both master and slave. For replication I execute this
script

#!/bin/sh
    slonik <<_EOF_
    	 # ----
    	 # This defines which namespace the replication system uses

    	 # ----
    	 cluster name = $CLUSTERNAME;
    
    	 # ----
    	 # Admin conninfo's are used by the slonik program to connect
    	 # to the node databases.  So these are the PQconnectdb
arguments

    	 # that connect from the administrators workstation (where
    	 # slonik is executed).
    	 # ----
    	 node 1 admin conninfo = 'dbname=$MASTERDBNAME host=$MASTERHOST
user=$REPLICATIONUSER';

    	 node 2 admin conninfo = 'dbname=$SLAVEDBNAME host=$SLAVEHOST
user=$REPLICATIONUSER';
    
    	 # ----
    	 # Node 2 subscribes set 1
    	 # ----
    	 subscribe set ( id = 1, provider = 1, receiver = 2, forward =
no);

    _EOF_
And when i run this script I get this error...
PGRES_FATAL_ERROR select "_slony_example".subscribeSet(1, 1, 2, 'f');  -
sERROR:  Slony-I: subscribeSet(): set 1 not found

What is wrong here? 
Thanks
josh




**********************************************************************
This message contains confidential information intended only for the use of the addressee(s) named above and may contain information that is legally privileged.  If you are not the addressee, or the person responsible for delivering it to the addressee, you are hereby notified that reading, disseminating, distributing or copying this message is strictly prohibited.  If you have received this message by mistake, please immediately notify us by replying to the message and delete the original message immediately thereafter.

Thank you.

                                   FADLD Tag
**********************************************************************
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071212/48f60e90/attachment-0001.htm
From jameshtucker at gmail.com  Thu Dec 13 18:27:13 2007
From: jameshtucker at gmail.com (James Tucker)
Date: Thu Sep 25 08:26:29 2008
Subject: [Slony1-general] Different indexes on slave
Message-ID: <b10d372b0712131827n63ef1158y9bb6ca9336df8d1a@mail.gmail.com>

Hi All,

We're currently running slony to replicate to our DR site.  We're looking at
creating another reporting database at each site so our application can use
that for reports etc, and the master for our normal oltp load.  The
reporting database only needs a subset of the tables included in the DR set.

I have 2 questions.

Is there any reason we can't create different indexes (aimed at faster
reports as apposed to OTLP) on the reporting slave ?

Currently I just have one set that includes all our tables, am I able to
create another set with just a selection of those tables ?  Or would I need
to recreate my existing set, splitting it.

i.e.

set1 =3D table1, table2, table3

set2 =3D table1, table2.

Thanks in advance.

James
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071214/=
f7d33c11/attachment-0001.htm
From HTomeh at facorelogic.com  Mon Dec 17 06:33:32 2007
From: HTomeh at facorelogic.com (Tomeh, Husam)
Date: Thu Sep 25 08:26:30 2008
Subject: [Slony1-general] Different indexes on slave
Message-ID: <2c5101c840b9$c40cea29$1a5811ac@ana.firstamdata.com>


Please see my comments below.

-----Original Message-----
From: "James Tucker" <jameshtucker@gmail.com>
To: "slony1-general@lists.slony.info" <slony1-general@lists.slony.info>
Sent: 12/16/2007 5:30 PM
Subject: [Slony1-general] Different indexes on slave

Hi All,

We're currently running slony to replicate to our DR site.  We're looking at
creating another reporting database at each site so our application can use
that for reports etc, and the master for our normal oltp load.  The
reporting database only needs a subset of the tables included in the DR set.


I have 2 questions.

Is there any reason we can't create different indexes (aimed at faster
reports as apposed to OTLP) on the reporting slave ?

[Husam: you should be able to do so. Actually this is one of the advantages of Slony triggered-based replication system.]

Currently I just have one set that includes all our tables, am I able to
create another set with just a selection of those tables ?  Or would I need
to recreate my existing set, splitting it.

[Husam: breaking your set would give you more flexblity - that'd be a good choice.]

i.e.

set1 = table1, table2, table3

set2 = table1, table2.

Thanks in advance.

James


**********************************************************************
This message contains confidential information intended only for the use of the addressee(s) named above and may contain information that is legally privileged.  If you are not the addressee, or the person responsible for delivering it to the addressee, you are hereby notified that reading, disseminating, distributing or copying this message is strictly prohibited.  If you have received this message by mistake, please immediately notify us by replying to the message and delete the original message immediately thereafter.

Thank you.

                                   FADLD Tag
**********************************************************************

From michael.de.guzman at gmail.com  Tue Dec 18 00:27:27 2007
From: michael.de.guzman at gmail.com (Miguel d Vinci)
Date: Thu Sep 25 08:26:31 2008
Subject: [Slony1-general] Problem with Japanese Characters
Message-ID: <14384536.post@talk.nabble.com>


Hi!  I'm trying to implement Slony 1.2.9 in our system application.  Recently
I have encountered a problem with Japanese characters and I'm stuck.  Please
help.

Here is my platform:
* Postgres 8.1.8
* Slony 1.2.9
* Linux kernel 2.4.32

I have no problem creating slon shema and making the replication work.  I
have a Postgres script file to insert 60,000 records of Japanese characters
into one table.  The script works fine on the Primary Node and everything
(60,000 records) is saved.  However, only about 2,300+ records was
replicated on the Slave node.

Here is the error log:

2007-12-18 14:32:19 UTC DEBUG2 remoteWorkerThread_1_1: current remote
log_status = 0
 2007-12-18 14:32:19 UTC DEBUG2 remoteHelperThread_1_1: 0.058 seconds delay
for first row
 2007-12-18 14:32:19 UTC DEBUG2 remoteHelperThread_1_1: 0.128 seconds until
close cursor
 2007-12-18 14:32:19 UTC DEBUG2 remoteHelperThread_1_1: inserts=118
updates=236 deletes=0
 2007-12-18 14:32:19 UTC ERROR remoteWorkerThread_1: "insert into
"public"."icitem"
(ean,sourceean,instorecode,classcode,departmentcode,subdepartmentcode,itemname,standard,capname,capacity,unitname,unitcap,suppliercode,orderpoint,orderday,packqty,shelfcode,shelflevel,linelevel,stickertype,freedataa,freedatab,freedatac,freedata1,freedata2,freedata3,taxrate,deldate,unitprice,unitpricemem,salesprice,ordprice,promocode,promostartdate,promostarttime,promoenddate,promoendtime,lastprice,costprice,lastupdate,memprice,promotype,orddate,ordqty,delsched,stock,paperprintdate,isinitialized,initctr,promoqty,suppliername)
values ('4562176951037','','','0','5','0','????????????
???','','0','0.00','0','0.00','0','0','','0','','0','0','0','','','','0','0','0','0.00','','0.00','0.00','1757','0','0','','','','','0','0','2007-12-18','0','0','','0','','0','','f','0','0','');
 update only "public"."icdepartment" set ctr='544' where departmentcode='5'
and subdepartmentcode='0' and classcode='0';
 update only "public"."icstats" set allitems='3327' where cd='1';
 insert into "public"."icitem"
(ean,sourceean,instorecode,classcode,departmentcode,subdepartmentcode,itemname,standard,capname,capacity,unitname,unitcap,suppliercode,orderpoint,orderday,packqty,shelfcode,shelflevel,linelevel,stickertype,freedataa,freedatab,freedatac,freedata1,freedata2,freedata3,taxrate,deldate,unitprice,unitpricemem,salesprice,ordprice,promocode,promostartdate,promostarttime,promoenddate,promoendtime,lastprice,costprice,lastupdate,memprice,promotype,orddate,ordqty,delsched,stock,paperprintdate,isinitialized,initctr,promoqty,suppliername)
values ('4901925133025','','','0','4','0','????????
???','','0','0.00','0','0.00','0','0','','0','','0','0','0','','','','0','0','0','0.00','','0.00','0.00','982','0','0','','','','','0','0','2007-12-18','0','0','','0','','0','','f','0','0','');
 update only "public"."icdepartment" set ctr='425' where departmentcode='4'
and subdepartmentcode='0' and classcode='0';
 update only "public"."icstats" set allitems='3328' where cd='1';
 insert into "public"."icitem"
(ean,sourceean,instorecode,classcode,departmentcode,subdepartmentcode,itemname,standard,capname,capacity,unitname,unitcap,suppliercode,orderpoint,orderday,packqty,shelfcode,shelflevel,linelevel,stickertype,freedataa,freedatab,freedatac,freedata1,freedata2,freedata3,taxrate,deldate,unitprice,unitpricemem,salesprice,ordprice,promocode,promostartdate,promostarttime,promoenddate,promoendtime,lastprice,costprice,lastupdate,memprice,promotype,orddate,ordqty,delsched,stock,paperprintdate,isinitialized,initctr,promoqty,suppliername)
values ('4902881407144','','','0','4','0','????????????
???','','0','0.00','0','0.00','0','0','','0','','0','0','0','','','','0','0','0','0.00','','0.00','0.00','6261','0','0','','','','','0','0','2007-12-18','0','0','','0','','0','','f','0','0','');
 update only "public"."icdepartment" set ctr='426' where departmentcode='4'
and subdepartmentcode='0' and classcode='0';
 update only "public"."icstats" set allitems='3329' where cd='1';
 insert into "public"."icitem"
(ean,sourceean,instorecode,classcode,departmentcode,subdepartmentcode,itemname,standard,capname,capacity,unitname,unitcap,suppliercode,orderpoint,orderday,packqty,shelfcode,shelflevel,linelevel,stickertype,freedataa,freedatab,freedatac,freedata1,freedata2,freedata3,taxrate,deldate,unitprice,unitpricemem,salesprice,ordprice,promocode,promostartdate,promostarttime,promoenddate,promoendtime,lastprice,costprice,lastupdate,memprice,promotype,orddate,ordqty,delsched,stock,paperprintdate,isinitialized,initctr,promoqty,suppliername)
values
('4903333035762','','','0','5','0','????????????????????','','0','0.00','0','0.00','0','0','','0','','0','0','0','','','','0','0','0','0.00','','0.00','0.00','6417','0','0','','','','','0','0','2007-12-18','0','0','','0','','0','','f','0','0','');
 " ERROR: unsafe use of \' in a string literal at character 4778
 HINT: Use '' to write quotes in strings. \' is insecure in client-only
encodings.
  - qualification was:
 2007-12-18 14:32:19 UTC ERROR remoteWorkerThread_1: "insert into
"public"."icitem"
(ean,sourceean,instorecode,classcode,departmentcode,subdepartmentcode,itemname,standard,capname,capacity,unitname,unitcap,suppliercode,orderpoint,orderday,packqty,shelfcode,shelflevel,linelevel,stickertype,freedataa,freedatab,freedatac,freedata1,freedata2,freedata3,taxrate,deldate,unitprice,unitpricemem,salesprice,ordprice,promocode,promostartdate,promostarttime,promoenddate,promoendtime,lastprice,costprice,lastupdate,memprice,promotype,orddate,ordqty,delsched,stock,paperprintdate,isinitialized,initctr,promoqty,suppliername)
values ('4562176951037','','','0','5','0','????????????
???','','0','0.00','0','0.00','0','0','','0','','0','0','0','','','','0','0','0','0.00','','0.00','0.00','1757','0','0','','','','','0','0','2007-12-18','0','0','','0','','0','','f','0','0','');
 update only "public"."icdepartment" set ctr='544' where departmentcode='5'
and subdepartmentcode='0' and classcode='0';
 update only "public"."icstats" set allitems='3327' where cd='1';
 insert into "public"."icitem"
(ean,sourceean,instorecode,classcode,departmentcode,subdepartmentcode,itemname,standard,capname,capacity,unitname,unitcap,suppliercode,orderpoint,orderday,packqty,shelfcode,shelflevel,linelevel,stickertype,freedataa,freedatab,freedatac,freedata1,freedata2,freedata3,taxrate,deldate,unitprice,unitpricemem,salesprice,ordprice,promocode,promostartdate,promostarttime,promoenddate,promoendtime,lastprice,costprice,lastupdate,memprice,promotype,orddate,ordqty,delsched,stock,paperprintdate,isinitialized,initctr,promoqty,suppliername)
values ('4901925133025','','','0','4','0','????????
???','','0','0.00','0','0.00','0','0','','0','','0','0','0','','','','0','0','0','0.00','','0.00','0.00','982','0','0','','','','','0','0','2007-12-18','0','0','','0','','0','','f','0','0','');
 update only "public"."icdepartment" set ctr='425' where departmentcode='4'
and subdepartmentcode='0' and classcode='0';
 update only "public"."icstats" set allitems='3328' where cd='1';
 insert into "public"."icitem"
(ean,sourceean,instorecode,classcode,departmentcode,subdepartmentcode,itemname,standard,capname,capacity,unitname,unitcap,suppliercode,orderpoint,orderday,packqty,shelfcode,shelflevel,linelevel,stickertype,freedataa,freedatab,freedatac,freedata1,freedata2,freedata3,taxrate,deldate,unitprice,unitpricemem,salesprice,ordprice,promocode,promostartdate,promostarttime,promoenddate,promoendtime,lastprice,costprice,lastupdate,memprice,promotype,orddate,ordqty,delsched,stock,paperprintdate,isinitialized,initctr,promoqty,suppliername)
values ('4902881407144','','','0','4','0','????????????
???','','0','0.00','0','0.00','0','0','','0','','0','0','0','','','','0','0','0','0.00','','0.00','0.00','6261','0','0','','','','','0','0','2007-12-18','0','0','','0','','0','','f','0','0','');
 update only "public"."icdepartment" set ctr='426' where departmentcode='4'
and subdepartmentcode='0' and classcode='0';
 update only "public"."icstats" set allitems='3329' where cd='1';
 insert into "public"."icitem"
(ean,sourceean,instorecode,classcode,departmentcode,subdepartmentcode,itemname,standard,capname,capacity,unitname,unitcap,suppliercode,orderpoint,orderday,packqty,shelfcode,shelflevel,linelevel,stickertype,freedataa,freedatab,freedatac,freedata1,freedata2,freedata3,taxrate,deldate,unitprice,unitpricemem,salesprice,ordprice,promocode,promostartdate,promostarttime,promoenddate,promoendtime,lastprice,costprice,lastupdate,memprice,promotype,orddate,ordqty,delsched,stock,paperprintdate,isinitialized,initctr,promoqty,suppliername)
values
('4903333035762','','','0','5','0','????????????????????','','0','0.00','0','0.00','0','0','','0','','0','0','0','','','','0','0','0','0.00','','0.00','0.00','6417','0','0','','','','','0','0','2007-12-18','0','0','','0','','0','','f','0','0','');
 " ERROR: current transaction is aborted, commands ignored until end of
transaction block
  - qualification was:
 2007-12-18 14:32:19 UTC ERROR remoteWorkerThread_1: SYNC aborted
 2007-12-18 14:32:20 UTC DEBUG2 syncThread: new sl_action_seq 1 - SYNC 13
 2007-12-18 14:32:21 UTC DEBUG2 remoteListenThread_1: queue event 1,106 SYNC
 2007-12-18 14:32:23 UTC DEBUG2 remoteListenThread_1: queue event 1,107 SYNC
 2007-12-18 14:32:25 UTC DEBUG2 remoteListenThread_1: queue event 1,108 SYNC
 2007-12-18 14:32:26 UTC DEBUG2 localListenThread: Received event 2,13 SYNC

>From this log, the error "ERROR: unsafe use of \' in a string literal at
character 4778
 HINT: Use '' to write quotes in strings. \' is insecure in client-only
encodings." was reflected.  What confuses me is that the Secondary server
has the same database settings with the Primary Server.  Both servers have
database were created with UTF-8 encoding.  CLIENT-ENCODING (in
postgresql.conf) for both servers were set to SJIS.

Another weird part is this:  I dropped slony schema and recreated the
database on the Secondary Server.  I re-created slony and run slon.  After a
few moments, I checked the table in the Secondary Node and everything was
replicated.  So it means that the problem is triggered somewhere during the
actual INSERTing of records.

I'm really stuck with this problem and I would really appreciate it if
someone could tell me how to fix it.

Thanks in advance.

;) Miguel
-- 
View this message in context: http://www.nabble.com/Problem-with-Japanese-Characters-tp14384536p14384536.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.

From trinaths at intoto.com  Fri Dec 21 01:39:37 2007
From: trinaths at intoto.com (Trinath Somanchi)
Date: Thu Sep 25 08:26:32 2008
Subject: [Slony1-general] RE: Slony1-general Digest, Vol 10, Issue 29
In-Reply-To: <84D57263D486374587DA0820E60A2CC60194186C@srit_mail.renaissance-it.com>
References: <84D57263D486374587DA0820E60A2CC60194186C@srit_mail.renaissance-it.com>
Message-ID: <1198229947.3083.2.camel@localhost.localdomain>

Skipped content of type multipart/alternative-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.png
Type: image/png
Size: 14826 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20071221/5c2f55de/signature-0001.png
From HTomeh at facorelogic.com  Fri Dec 21 06:07:28 2007
From: HTomeh at facorelogic.com (Tomeh, Husam)
Date: Thu Sep 25 08:26:33 2008
Subject: [Slony1-general] questions about slon_tools.conf
References: <4769A563.9050704@serioustechnology.com>
	<5E13E951-3AAC-4D23-820F-EF8B97DB1522@khera.org>
	<476B29FF.8000103@serioustechnology.com>
Message-ID: <F1B0F9305B343E43A1C3EECE48B853D501340030@CITGSNA01SXCH02.ana.firstamdata.com>

All I had to do is run separate instances of slon process for each slony cl=
uster. =

 =

Regards,
 =

       -  Husam

________________________________

From: slony1-general-bounces@lists.slony.info on behalf of Geoffrey
Sent: Thu 12/20/2007 6:50 PM
To: Slony List
Subject: Re: [Slony1-general] questions about slon_tools.conf



Vivek Khera wrote:
>
> On Dec 19, 2007, at 6:12 PM, Geoffrey wrote:
>
>> As I understand it, if I'm replicating from one machine to another, I
>> must have identical slon_tools.conf files on both machines.
>
> no, you need to change teh connection string so each slon connects to
> its own server it is responsible for.
>
> the slons can run on any box; they just connect as clients to postgres. =

> most people tend to run the associated slon on the same box as the
> postgres server.

Thanks for the response.  Any ideas on the other part of my post?  That
is, how do I configure slony to handle multiple databases on one machine
to be replicated to multiple instances on a second machine?

We have eleven postmasters running on one machine in order to be able to
better control the configuration of each and limit downtime.  What I
need to do is replicate all eleven to another machine.

The example slon_tools.conf file does not appear to lend itself to this.
  There is one MASTERNODE, whereas I need eleven.

--
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
_______________________________________________
Slony1-general mailing list
Slony1-general@lists.slony.info
http://lists.slony.info/mailman/listinfo/slony1-general




**********************************************************************
This message contains confidential information intended only for the use of=
 the addressee(s) named above and may contain information that is legally p=
rivileged.  If you are not the addressee, or the person responsible for del=
ivering it to the addressee, you are hereby notified that reading, dissemin=
ating, distributing or copying this message is strictly prohibited.  If you=
 have received this message by mistake, please immediately notify us by rep=
lying to the message and delete the original message immediately thereafter.

Thank you.

                                   FADLD Tag
**********************************************************************
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071221/=
842ce20e/attachment-0001.htm
From khera at kcilink.com  Fri Dec 21 08:01:11 2007
From: khera at kcilink.com (Vivek Khera)
Date: Thu Sep 25 08:26:34 2008
Subject: [Slony1-general] questions about slon_tools.conf
In-Reply-To: <476B29FF.8000103@serioustechnology.com>
References: <4769A563.9050704@serioustechnology.com>
	<5E13E951-3AAC-4D23-820F-EF8B97DB1522@khera.org>
	<476B29FF.8000103@serioustechnology.com>
Message-ID: <05014B5B-2701-40DF-8239-56E7BE555273@kcilink.com>


On Dec 20, 2007, at 9:50 PM, Geoffrey wrote:

> The example slon_tools.conf file does not appear to lend itself to  
> this.  There is one MASTERNODE, whereas I need eleven.

you need to run eleven instances of slon, too.  basically, you run one  
slon per replication node per cluster.  so, in your case you have  
eleven actual postgres instances, you'll need at least eleven slons.   
in my case, I have two clusters on one postgres instance, so I need to  
slons.

From HTomeh at facorelogic.com  Fri Dec 21 14:30:59 2007
From: HTomeh at facorelogic.com (Tomeh, Husam)
Date: Thu Sep 25 08:26:35 2008
Subject: [Slony1-general] questions about slon_tools.conf
Message-ID: <374301c84421$1dd7abe1$195811ac@ana.firstamdata.com>

No, I haven't used it. Instead, I have created scripts for each cluster (to create the cluster, fire off slon daemon, define and subscribe the sets - so all necessary configurations included in the scripts).
 
Regards,

     - Husam

-----Original Message-----
From: "Geoffrey" <lists@serioustechnology.com>
To: "Tomeh, Husam" <HTomeh@facorelogic.com>
Cc: "Slony List" <slony1-general@lists.slony.info>
Sent: 12/21/2007 11:00 AM
Subject: Re: [Slony1-general] questions about slon_tools.conf

Tomeh, Husam wrote:
> All I had to do is run separate instances of slon process for each slony cluster. 

Are you using the slon_tools.conf file?  As I see it, it only has the 
ability to deal with one cluster at a time.

>  
> Regards,
>  
>        -  Husam
> 
> ________________________________
> 
> From: slony1-general-bounces@lists.slony.info on behalf of Geoffrey
> Sent: Thu 12/20/2007 6:50 PM
> To: Slony List
> Subject: Re: [Slony1-general] questions about slon_tools.conf
> 
> 
> 
> Vivek Khera wrote:
>> On Dec 19, 2007, at 6:12 PM, Geoffrey wrote:
>>
>>> As I understand it, if I'm replicating from one machine to another, I
>>> must have identical slon_tools.conf files on both machines.
>> no, you need to change teh connection string so each slon connects to
>> its own server it is responsible for.
>>
>> the slons can run on any box; they just connect as clients to postgres. 
>> most people tend to run the associated slon on the same box as the
>> postgres server.
> 
> Thanks for the response.  Any ideas on the other part of my post?  That
> is, how do I configure slony to handle multiple databases on one machine
> to be replicated to multiple instances on a second machine?
> 
> We have eleven postmasters running on one machine in order to be able to
> better control the configuration of each and limit downtime.  What I
> need to do is replicate all eleven to another machine.
> 
> The example slon_tools.conf file does not appear to lend itself to this.
>   There is one MASTERNODE, whereas I need eleven.
> 
> --
> Until later, Geoffrey
> 
> Those who would give up essential Liberty, to purchase a little
> temporary Safety, deserve neither Liberty nor Safety.
>   - Benjamin Franklin
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
> 
> 
> 
> 
> **********************************************************************
> This message contains confidential information intended only for the use of the addressee(s) named above and may contain information that is legally privileged.  If you are not the addressee, or the person responsible for delivering it to the addressee, you are hereby notified that reading, disseminating, distributing or copying this message is strictly prohibited.  If you have received this message by mistake, please immediately notify us by replying to the message and delete the original message immediately thereafter.
> 
> Thank you.
> 
>                                    FADLD Tag
> **********************************************************************
> 


-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin


From cbbrowne at ca.afilias.info  Fri Dec 21 15:42:22 2007
From: cbbrowne at ca.afilias.info (cbbrowne@ca.afilias.info)
Date: Thu Sep 25 08:26:36 2008
Subject: [Slony1-general] RE: Slony1-general Digest, Vol 10, Issue 29
In-Reply-To: <405471.311.qm@web25813.mail.ukl.yahoo.com>
References: <405471.311.qm@web25813.mail.ukl.yahoo.com>
Message-ID: <60767.64.229.177.7.1198280532.squirrel@look.libertyrms.info>

> Hi Praveen,
>
>>From looking over the steps below it seems this will drop my whole
> cluster will it not?
>
> I only want to drop one of the replication sets within my cluster.
>
> I.e.
>
> I have a slony I cluster called "replication1", and within this I
> have 3 replication sets, "customers", "events" and "eventData".
>
> I just want to drop the "eventData" replication set from the cluster.

There's something funny there...

Replication sets are numbered, not named.

I'd instead expect that you have three sets:

Set 1, with some tables for customers,
Set 4, with some tables for events,
Set 9, with EventData tables.

(Or it could be sets 1, 2, and 3; I don't want to assume either way.)

You could drop set #9 via the slonik command

DROP SET (ID = 9, EVENT NODE = [preferably the origin for set #9]);

(The script also needs to include the "preamble" stuff required in every
Slonik script...)

From fweimer at bfk.de  Fri Dec 28 02:22:21 2007
From: fweimer at bfk.de (Florian Weimer)
Date: Thu Sep 25 08:26:37 2008
Subject: [GENERAL] [Slony1-general] Any big slony and WAL shipping users?
In-Reply-To: <20071227180850.GF12137@crankycanuck.ca> (Andrew Sullivan's
	message of "Thu, 27 Dec 2007 13:08:50 -0500")
References: <8d89ea1d0712270749x3a2f7f57u522f3d0b4b9f5876@mail.gmail.com>
	<20071227173732.GB12137@crankycanuck.ca>
	<8d89ea1d0712270949ra1570bv1ad553c955c56121@mail.gmail.com>
	<20071227180850.GF12137@crankycanuck.ca>
Message-ID: <82abnvglvi.fsf@mid.bfk.de>

* Andrew Sullivan:

> (For instance, a DNS company runs completely different name server code on
> completely different hardware and OS platforms in order to make sure not to
> be vulnerable to day-0 exploits.  That kind of thing.)

This only helps against crasher bugs.  For code injection, it's
devastating if the attacker can compromise one node, and by
diversifying, he or she can choose which code base to attack.  I guess
that in the database case, it's mostly the same, with crash bugs on
the one side (where diversification helps), and creeping data
corruption bugs on the other (where it might increase risk).  If you
use multiple systems with a comparator, things are different, of
course.

-- 
Florian Weimer                <fweimer@bfk.de>
BFK edv-consulting GmbH       http://www.bfk.de/
Kriegsstra?e 100              tel: +49-721-96201-1
D-76133 Karlsruhe             fax: +49-721-96201-99
From connorsml at gmail.com  Tue Dec 11 08:11:10 2007
From: connorsml at gmail.com (Michael Connors)
Date: Thu Sep 25 08:27:05 2008
Subject: [Slony1-general] managing connections
Message-ID: <d9e7db140712110811k1f2f38fawd2de6ae1cacfdbcb@mail.gmail.com>

Hi,
I am new to Slony. I have just set up replication on my DB server, it is
working fine and working as it should. However I wonder if there is
something in Slony that will redirect all incoming inserts/updates to the
master, instead of just giving an error message, while processing the
selects on the slave.

I believe this is at least possible in pl/pgsql.

I tried using pgpool for this but it does not seem to work properly. If its
not possible directly in slony, could anyone recommend sqlrelay?

-- =

Regards,
Michael Connors
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071211/=
7d1cfc3d/attachment-0001.htm
From HTomeh at facorelogic.com  Wed Dec 12 08:55:22 2007
From: HTomeh at facorelogic.com (Tomeh, Husam)
Date: Thu Sep 25 08:27:07 2008
Subject: [Slony1-general] shortcut for telling slony to simply
	replicate everything?
In-Reply-To: <47600E8A.7070802@serioustechnology.com>
References: <47600E8A.7070802@serioustechnology.com>
Message-ID: <F1B0F9305B343E43A1C3EECE48B853D501A83F45@CITGSNA01SXCH02.ana.firstamdata.com>


As Slony is a triggered-based replication solution, replication occurs
at the table level, and thus each table has to be Slony-configured. 

Regards,

    Husam Tomeh

-----Original Message-----
From: slony1-general-bounces@lists.slony.info
[mailto:slony1-general-bounces@lists.slony.info] On Behalf Of Geoffrey
Sent: Wednesday, December 12, 2007 8:39 AM
To: slony1-general@lists.slony.info
Subject: [Slony1-general] shortcut for telling slony to simply replicate
everything?

Is there a shortcut to tell slony to simply replicate a whole database
without having to configure it for each table?

--
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
_______________________________________________
Slony1-general mailing list
Slony1-general@lists.slony.info
http://lists.slony.info/mailman/listinfo/slony1-general

**********************************************************************
This message contains confidential information intended only for the use of the addressee(s) named above and may contain information that is legally privileged.  If you are not the addressee, or the person responsible for delivering it to the addressee, you are hereby notified that reading, disseminating, distributing or copying this message is strictly prohibited.  If you have received this message by mistake, please immediately notify us by replying to the message and delete the original message immediately thereafter.

Thank you.

                                   FADLD Tag
**********************************************************************

