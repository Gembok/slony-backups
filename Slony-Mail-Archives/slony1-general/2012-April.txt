From smccloud at geo-comm.com  Tue Apr  3 10:51:58 2012
From: smccloud at geo-comm.com (Shaun McCloud)
Date: Tue, 3 Apr 2012 17:51:58 +0000
Subject: [Slony1-general] Query to see when Slony is done replicating
	changes?
Message-ID: <7742DD496427B743BC8B7BBF6D380BA037766C7D@EXCHANGE10.geo-comm.local>

Hello,

I'm wondering if its possible to query any of the databases in my cluster to see when Slony is done replicating changes to a single node.  I was going to use the Acks Outstanding statistic but then realized that the slave nodes that my controller service is waiting to update (and do not have Slony running on) will keep adding to that count.  If there is no statistic to query, is my assumption that tables are replicated in the order they are added to the replication set correct?

As for why I can't just let the changes replicate to all slaves at once, it is because of a no single point of failure for the web app that is reading the replicated data.

Shaun McCloud - Associate Software Developer
Geo-Comm, Inc
601 W. Saint Germain St., Saint Cloud, MN 56301
Office: 320.240.0040 Fax: 320.240.2389 Toll Free: 888.436.2666
click here to visit www.geo-comm.com<http://www.geo-comm.com/>
[cid:image001.jpg at 01CD1198.8E1EB250]<http://www.linkedin.com/companies/geocomm> [cid:image002.jpg at 01CD1198.8E1EB250] <http://twitter.com/_geocomm>
P Think before you print!
Microsoft Certified Desktop Support Technician (MCDST)

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20120403/00163103/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 1129 bytes
Desc: image001.jpg
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20120403/00163103/attachment.jpg 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.jpg
Type: image/jpeg
Size: 1068 bytes
Desc: image002.jpg
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20120403/00163103/attachment-0001.jpg 

From ssinger at ca.afilias.info  Wed Apr  4 08:33:29 2012
From: ssinger at ca.afilias.info (Steve Singer)
Date: Wed, 04 Apr 2012 11:33:29 -0400
Subject: [Slony1-general] Query to see when Slony is done replicating
 changes?
In-Reply-To: <7742DD496427B743BC8B7BBF6D380BA037766C7D@EXCHANGE10.geo-comm.local>
References: <7742DD496427B743BC8B7BBF6D380BA037766C7D@EXCHANGE10.geo-comm.local>
Message-ID: <4F7C69C9.2030006@ca.afilias.info>

On 12-04-03 01:51 PM, Shaun McCloud wrote:
> Hello,
>
> I?m wondering if its possible to query any of the databases in my
> cluster to see when Slony is done replicating changes to a single node.
> I was going to use the Acks Outstanding statistic but then realized that
> the slave nodes that my controller service is waiting to update (and do
> not have Slony running on) will keep adding to that count. If there is
> no statistic to query, is my assumption that tables are replicated in
> the order they are added to the replication set correct?
>

Slony replicates SYNC events.  Those SYNC events might have associated 
rows in sl_log_1 or sl_log_2 (that need to be replicated) or there might 
be no changes associated with a SYNC event.

The slon process on the master generates SYNC events x seconds.  When 
that SYNC event is replicated to a slave any data changes will also be 
replicated to the slave so that the slave is 'caught up' with the master 
as of that SYNC event.

So if node 100 is our master and node 200 is a slave.

sl_event
ev_origin ,ev_seqno,ev_type,.....
100       , 1, SYNC

is generated

then you know that this event has been replicated to the slave when the 
slaves sl_confirm tables has a row like

sl_confirm
-----------
con_origin, con_received, con_seqno
100,       200,         1


When the confirmation makes it back to the master then the sl_confirm on 
the master would have that row also








> As for why I can?t just let the changes replicate to all slaves at once,
> it is because of a no single point of failure for the web app that is
> reading the replicated data.
>
> *Shaun McCloud ? Associate Software Developer
> Geo-Comm, Inc*
> 601 W. Saint Germain St., Saint Cloud, MN 56301
> *Office:* 320.240.0040 *Fax:* 320.240.2389 *Toll Free:* 888.436.2666
> */click here to visit /**/www.geo-comm.com/* <http://www.geo-comm.com/>
>
> <http://www.linkedin.com/companies/geocomm> <http://twitter.com/_geocomm>
>
> PThink before you print!
>
> *Microsoft Certified Desktop Support Technician (MCDST)*
>
>
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


From greg at endpoint.com  Wed Apr  4 14:44:54 2012
From: greg at endpoint.com (Greg Sabino Mullane)
Date: Wed, 4 Apr 2012 17:44:54 -0400
Subject: [Slony1-general] Query to see when Slony is done replicating
 changes?
In-Reply-To: <7742DD496427B743BC8B7BBF6D380BA037766C7D@EXCHANGE10.geo-comm.local>
References: <7742DD496427B743BC8B7BBF6D380BA037766C7D@EXCHANGE10.geo-comm.local>
Message-ID: <20120404214454.GJ2947@tinybird.home>

On Tue, Apr 03, 2012 at 05:51:58PM +0000, Shaun McCloud wrote:
> I'm wondering if its possible to query any of the databases 
> in my cluster to see when Slony is done replicating changes 
> to a single node.

It might help to expand on what you mean exactly by "done 
replicating changes", as replication is an ongoing process, 
but you could use the replicate_row action of check_postgres.pl:

http://bucardo.org/check_postgres/check_postgres.pl.html

Since Slony does things in order, you know that if this check 
works, the node is "caught up" and has finished anything that might 
have been going on before the check started. It simply flips a value on 
a replicated table and reports back how long until that value 
propagates to another slave (or slaves).

-- 
Greg Sabino Mullane greg at endpoint.com
End Point Corporation
PGP Key: 0x14964AC8
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 163 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20120404/c8acbfe4/attachment.pgp 

From johan at snowflake.nu  Thu Apr  5 02:47:58 2012
From: johan at snowflake.nu (=?ISO-8859-1?Q?Johan_W=E4rlander?=)
Date: Thu, 5 Apr 2012 11:47:58 +0200
Subject: [Slony1-general] Second replication set as a subset of the first?
In-Reply-To: <CAMVaVjYV9XnC6MVcRssEH+AAnbTE1WXEf6qEx6pD0YhyW3_+ag@mail.gmail.com>
References: <CAMVaVjYV9XnC6MVcRssEH+AAnbTE1WXEf6qEx6pD0YhyW3_+ag@mail.gmail.com>
Message-ID: <CAMVaVjZ8jvVnTNStqLdf0vQqJ5ROTmS4aUZ8YD_Sgu=s4VjVgA@mail.gmail.com>

Hello!

I've recently rebuilt a Slony setup that was structured as master-slave
pairs, each in a separate Slony cluster. Now it's a single cluster instead,
running Slony 2.1.1 with multiple levels of slaves ; node1 -> node2 ->
{node3, node4}. These all subscribe to set 1,with *all* tables from node1.

I'd like to add node5, which should appear below node2 and subscribe to
just a small subset of the tables from node1.

Do I just add a new set with these particular tables, even though they
already exist in set1? Will this add a lot of traffic, or simply reuse the
existing logs?

Grateful for any suggestions,
Johan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20120405/60281433/attachment.htm 

From smccloud at geo-comm.com  Thu Apr  5 07:01:14 2012
From: smccloud at geo-comm.com (Shaun McCloud)
Date: Thu, 5 Apr 2012 14:01:14 +0000
Subject: [Slony1-general] Query to see when Slony is done replicating
 changes?
In-Reply-To: <20120404214454.GJ2947@tinybird.home>
References: <7742DD496427B743BC8B7BBF6D380BA037766C7D@EXCHANGE10.geo-comm.local>
	<20120404214454.GJ2947@tinybird.home>
Message-ID: <7742DD496427B743BC8B7BBF6D380BA037769E9F@EXCHANGE10.geo-comm.local>

Sorry,

What I mean by "done replicating changes" is that Slony has finished replicating the changes we just made to the master database to the slave database we are currently working with.

Our process is to stop Slony on all servers, remove the replication engine for our live database, restart Slony so the other database we are replicating can finish, make the changes to the master, then add the engine back to the master & one slave, restart Slony on them and then we need a way to tell that the changes have made it to that slave before we move on to the next slave.

Shaun McCloud ? Associate Software Developer
Geo-Comm, Inc
601 W. Saint Germain St., Saint Cloud, MN 56301
Office: 320.240.0040 Fax: 320.240.2389 Toll Free: 888.436.2666
click here to visit www.geo-comm.com
 
? Think before you print!
Microsoft Certified Desktop Support Technician (MCDST)

-----Original Message-----
From: Greg Sabino Mullane [mailto:greg at endpoint.com] 
Sent: Wednesday, April 04, 2012 16:45
To: Shaun McCloud
Cc: slony1-general at lists.slony.info
Subject: Re: [Slony1-general] Query to see when Slony is done replicating changes?

On Tue, Apr 03, 2012 at 05:51:58PM +0000, Shaun McCloud wrote:
> I'm wondering if its possible to query any of the databases in my 
> cluster to see when Slony is done replicating changes to a single 
> node.

It might help to expand on what you mean exactly by "done replicating changes", as replication is an ongoing process, but you could use the replicate_row action of check_postgres.pl:

http://bucardo.org/check_postgres/check_postgres.pl.html

Since Slony does things in order, you know that if this check works, the node is "caught up" and has finished anything that might have been going on before the check started. It simply flips a value on a replicated table and reports back how long until that value propagates to another slave (or slaves).

-- 
Greg Sabino Mullane greg at endpoint.com
End Point Corporation
PGP Key: 0x14964AC8

From smccloud at geo-comm.com  Thu Apr  5 09:24:38 2012
From: smccloud at geo-comm.com (Shaun McCloud)
Date: Thu, 5 Apr 2012 16:24:38 +0000
Subject: [Slony1-general] Query to see when Slony is done replicating
 changes?
In-Reply-To: <20120404214454.GJ2947@tinybird.home>
References: <7742DD496427B743BC8B7BBF6D380BA037766C7D@EXCHANGE10.geo-comm.local>
	<20120404214454.GJ2947@tinybird.home>
Message-ID: <7742DD496427B743BC8B7BBF6D380BA03776A0A1@EXCHANGE10.geo-comm.local>

Going along with my last email, how do you view the current configuration values for Slony (specifically the cleanup_interval) and change the cleanup _interval after the cluster has been created in a Windows environment?

Shaun McCloud ? Associate Software Developer
Geo-Comm, Inc
601 W. Saint Germain St., Saint Cloud, MN 56301
Office: 320.240.0040 Fax: 320.240.2389 Toll Free: 888.436.2666
click here to visit www.geo-comm.com
 
? Think before you print!
Microsoft Certified Desktop Support Technician (MCDST)


-----Original Message-----
From: Greg Sabino Mullane [mailto:greg at endpoint.com] 
Sent: Wednesday, April 04, 2012 16:45
To: Shaun McCloud
Cc: slony1-general at lists.slony.info
Subject: Re: [Slony1-general] Query to see when Slony is done replicating changes?

On Tue, Apr 03, 2012 at 05:51:58PM +0000, Shaun McCloud wrote:
> I'm wondering if its possible to query any of the databases in my 
> cluster to see when Slony is done replicating changes to a single 
> node.

It might help to expand on what you mean exactly by "done replicating changes", as replication is an ongoing process, but you could use the replicate_row action of check_postgres.pl:

http://bucardo.org/check_postgres/check_postgres.pl.html

Since Slony does things in order, you know that if this check works, the node is "caught up" and has finished anything that might have been going on before the check started. It simply flips a value on a replicated table and reports back how long until that value propagates to another slave (or slaves).

-- 
Greg Sabino Mullane greg at endpoint.com
End Point Corporation
PGP Key: 0x14964AC8

From vivek at khera.org  Sat Apr  7 17:35:17 2012
From: vivek at khera.org (Vick Khera)
Date: Sat, 7 Apr 2012 20:35:17 -0400
Subject: [Slony1-general] Second replication set as a subset of the
	first?
In-Reply-To: <CAMVaVjZ8jvVnTNStqLdf0vQqJ5ROTmS4aUZ8YD_Sgu=s4VjVgA@mail.gmail.com>
References: <CAMVaVjYV9XnC6MVcRssEH+AAnbTE1WXEf6qEx6pD0YhyW3_+ag@mail.gmail.com>
	<CAMVaVjZ8jvVnTNStqLdf0vQqJ5ROTmS4aUZ8YD_Sgu=s4VjVgA@mail.gmail.com>
Message-ID: <CALd+dcdPoqMKZzpPWcDEJoiC3U5PvjMgZ_12oZafWQX3X3r7BQ@mail.gmail.com>

On Thu, Apr 5, 2012 at 5:47 AM, Johan W?rlander <johan at snowflake.nu> wrote:
> Do I just add a new set with these particular tables, even though they
> already exist in set1? Will this add a lot of traffic, or simply reuse the
> existing logs?

The sets need to be non-intersecting.

From johan at snowflake.nu  Sat Apr  7 23:38:07 2012
From: johan at snowflake.nu (=?ISO-8859-1?Q?Johan_W=E4rlander?=)
Date: Sun, 8 Apr 2012 08:38:07 +0200
Subject: [Slony1-general] Second replication set as a subset of the
	first?
In-Reply-To: <CALd+dcdPoqMKZzpPWcDEJoiC3U5PvjMgZ_12oZafWQX3X3r7BQ@mail.gmail.com>
References: <CAMVaVjYV9XnC6MVcRssEH+AAnbTE1WXEf6qEx6pD0YhyW3_+ag@mail.gmail.com>
	<CAMVaVjZ8jvVnTNStqLdf0vQqJ5ROTmS4aUZ8YD_Sgu=s4VjVgA@mail.gmail.com>
	<CALd+dcdPoqMKZzpPWcDEJoiC3U5PvjMgZ_12oZafWQX3X3r7BQ@mail.gmail.com>
Message-ID: <CAMVaVjYHdKeY7c3cHQOx3NgFt4KmFqW=L4YuyZMubuHjT5iHDw@mail.gmail.com>

Right, Steve mentioned as much on #slony earlier. My understanding from his
and your comment, and the documentation, is that I'll need to follow the
sequence below:

1. Create a new, empty set
2. Subscribe all old nodes to the new set
3. Do 'set move table' and 'set move sequence' for the tables and sequences
to split out
4. Finally, subscribe the new node to only this new set

Will that do what I want, without disturbing the already-loaded tables on
the old nodes?
 Den 8 apr 2012 02:35 skrev "Vick Khera" <vivek at khera.org>:

> On Thu, Apr 5, 2012 at 5:47 AM, Johan W?rlander <johan at snowflake.nu>
> wrote:
> > Do I just add a new set with these particular tables, even though they
> > already exist in set1? Will this add a lot of traffic, or simply reuse
> the
> > existing logs?
>
> The sets need to be non-intersecting.
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20120408/3a052f1a/attachment.htm 

