From efraindector at motumweb.com  Thu Mar  1 15:42:51 2012
From: efraindector at motumweb.com (=?utf-8?Q?Efra=C3=ADn_D=C3=A9ctor?=)
Date: Thu, 1 Mar 2012 17:42:51 -0600
Subject: [Slony1-general] Cascading replication using altperl scripts
Message-ID: <CBE9D0DADE0A492383F7107721DB9BB4@CMOTUM25PC>

Hello list:
My name is Efrain and this week I?ve been using Slony-I, with the help of the documentation I?ve been able to setup replication between 2 nodes using slonik scripts and also with altperl scripts. For me, using altperl scritps is more comfortable but now I?m stucked trying to set cascading replication. I have this in mind:
A1 ?> B1 ?> B2
Meaning that A1 would be the master to B1 but also B1 would be master of B2. My slon_tools.conf looks like this:
add_node(node => 1,
host => '192.168.1.231',
dbname => 'prueba',
port => 5432,
user => 'postgres',
password => '1');
add_node(node => 2,
host => '192.168.1.232',
dbname => 'prueba',
port => 5432,
noforward => allow,
user => 'pgsql',
password => '2');
add_node(node => 3,
parent => 2,
host => '192.168.1.233',
dbname => 'prueba',
port => 5432,
user => 'pgsql',
password => '3');
I understand that B1 shall be configured to accept forward but I don?t now how to do this.
Any help would be really appreciated.
Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20120301/cab5e08a/attachment.htm 

From ngramsky at cs.umd.edu  Sat Mar  3 18:53:48 2012
From: ngramsky at cs.umd.edu (NewToSlony)
Date: Sat, 3 Mar 2012 18:53:48 -0800 (PST)
Subject: [Slony1-general]  Slony 2.0 will not install with postgreSQL 8.1
Message-ID: <33436818.post@talk.nabble.com>


If I'm reading the documentation of 2.0 correctly I should be able to install
Slony 2.0 with PostgreSQL versions 7.3.3 and higher.  Yet when I run the
configure script on my box it is giving me an error saying I cannot do so
unless my version is 8.3  Am I missing something?
-- 
View this message in context: http://old.nabble.com/Slony-2.0-will-not-install-with-postgreSQL-8.1-tp33436818p33436818.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.


From steve at ssinger.info  Sat Mar  3 19:03:04 2012
From: steve at ssinger.info (Steve Singer)
Date: Sat, 3 Mar 2012 22:03:04 -0500
Subject: [Slony1-general] Slony 2.0 will not install with postgreSQL 8.1
In-Reply-To: <33436818.post@talk.nabble.com>
References: <33436818.post@talk.nabble.com>
Message-ID: <BLU0-SMTP3310252D872491161E513A2DC530@phx.gbl>

On Sat, 3 Mar 2012, NewToSlony wrote:

>
> If I'm reading the documentation of 2.0 correctly I should be able to install
> Slony 2.0 with PostgreSQL versions 7.3.3 and higher.  Yet when I run the
> configure script on my box it is giving me an error saying I cannot do so
> unless my version is 8.3  Am I missing something?

No Slony 2.0+ requires at least Postgersql 8.3

Slony 1.2.x will work with postgresql 8.1


> -- 
> View this message in context: http://old.nabble.com/Slony-2.0-will-not-install-with-postgreSQL-8.1-tp33436818p33436818.html
> Sent from the Slony-I -- General mailing list archive at Nabble.com.
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>


From ngramsky at cs.umd.edu  Sun Mar  4 15:59:31 2012
From: ngramsky at cs.umd.edu (NewToSlony)
Date: Sun, 4 Mar 2012 15:59:31 -0800 (PST)
Subject: [Slony1-general]  Install without root permissions
Message-ID: <33440610.post@talk.nabble.com>


Is it possible to install Slony without root or sudo permissions?  I've tried
in the past but been unable to do so.  I was using the --with-pgconfigdir
option only but I'm not sure what the other options buy me or if the use of
one of those options lets me accomplish my goal.  It appears they only let
me spread the slony files around my machine.
-- 
View this message in context: http://old.nabble.com/Install-without-root-permissions-tp33440610p33440610.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.


From devrim at gunduz.org  Sun Mar  4 16:23:01 2012
From: devrim at gunduz.org (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Mon, 05 Mar 2012 02:23:01 +0200
Subject: [Slony1-general] Install without root permissions
In-Reply-To: <33440610.post@talk.nabble.com>
References: <33440610.post@talk.nabble.com>
Message-ID: <1330906981.20792.4.camel@lenovo01-laptop03.gunduz.org>

On Sun, 2012-03-04 at 15:59 -0800, NewToSlony wrote:
> 
> Is it possible to install Slony without root or sudo permissions?  

Use --prefix with configure :

./configure --prefix=/path/to/your/installation 

assuming that the user you compile and install slony has write access to
that specific directory.

-- 
Devrim G?ND?Z
Principal Systems Engineer @ EnterpriseDB: http://www.enterprisedb.com
PostgreSQL Dan??man?/Consultant, Red Hat Certified Engineer
Community: devrim~PostgreSQL.org, devrim.gunduz~linux.org.tr
http://www.gunduz.org  Twitter: http://twitter.com/devrimgunduz
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20120305/5c91c6f6/attachment.pgp 

From ngramsky at cs.umd.edu  Sun Mar  4 17:25:57 2012
From: ngramsky at cs.umd.edu (NewToSlony)
Date: Sun, 4 Mar 2012 17:25:57 -0800 (PST)
Subject: [Slony1-general] Install without root permissions
In-Reply-To: <1330906981.20792.4.camel@lenovo01-laptop03.gunduz.org>
References: <33440610.post@talk.nabble.com>
	<1330906981.20792.4.camel@lenovo01-laptop03.gunduz.org>
Message-ID: <33440809.post@talk.nabble.com>


That did not seem to work.  I'm getting the same error I get if I try it with
'with-pgconfigdir.

What I did:

 ./configure --prefix=/var/lib/pgsql/slony
 gmake all
 gmake install

Yet I get the following error:

$ gmake install
gmake[1]: Entering directory `/tmp/slony1-1.2.23/src'
gmake[2]: Entering directory `/tmp/slony1-1.2.23/src/xxid'
/bin/sh /tmp/slony1-1.2.23/config/mkinstalldirs /usr/lib64/pgsql/
/bin/sh /tmp/slony1-1.2.23/config/mkinstalldirs /usr/share/pgsql/
/bin/sh /tmp/slony1-1.2.23/config/install-sh -c -m 755 xxid.so
/usr/lib64/pgsql/
cp: cannot create regular file `/usr/lib64/pgsql//#inst.24369#': Permission
denied
gmake[2]: *** [install] Error 1
gmake[2]: Leaving directory `/tmp/slony1-1.2.23/src/xxid'
gmake[1]: *** [install] Error 2
gmake[1]: Leaving directory `/tmp/slony1-1.2.23/src'
gmake: *** [install] Error 2



I know I have write access as I created the /var/lib/pgsql/slony directory
as the postgres user(the same user I am trying the install as).

Thanks



Devrim G?ND?Z wrote:
> 
> On Sun, 2012-03-04 at 15:59 -0800, NewToSlony wrote:
>> 
>> Is it possible to install Slony without root or sudo permissions?  
> 
> Use --prefix with configure :
> 
> ./configure --prefix=/path/to/your/installation 
> 
> assuming that the user you compile and install slony has write access to
> that specific directory.
> 
> -- 
> Devrim G?ND?Z
> Principal Systems Engineer @ EnterpriseDB: http://www.enterprisedb.com
> PostgreSQL Dan??man?/Consultant, Red Hat Certified Engineer
> Community: devrim~PostgreSQL.org, devrim.gunduz~linux.org.tr
> http://www.gunduz.org  Twitter: http://twitter.com/devrimgunduz
> 
>  
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
> 
> 

-- 
View this message in context: http://old.nabble.com/Install-without-root-permissions-tp33440610p33440809.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.


From jeff at pgexperts.com  Sun Mar  4 18:40:28 2012
From: jeff at pgexperts.com (Jeff Frost)
Date: Sun, 4 Mar 2012 18:40:28 -0800
Subject: [Slony1-general] Install without root permissions
In-Reply-To: <33440809.post@talk.nabble.com>
References: <33440610.post@talk.nabble.com>
	<1330906981.20792.4.camel@lenovo01-laptop03.gunduz.org>
	<33440809.post@talk.nabble.com>
Message-ID: <7D4A6711-CCCC-438F-9AC4-0018B18ABD96@pgexperts.com>

Ah yes, the issue is that you need a few .so files installed in the postgresql libdir.  that appears to be: /usr/lib64/pgsql on your installation.  

BTW, any chance you could subscribe to the mailing list so we don't have to keep moderating each one of your emails to the list?

On Mar 4, 2012, at 5:25 PM, NewToSlony wrote:

> 
> That did not seem to work.  I'm getting the same error I get if I try it with
> 'with-pgconfigdir.
> 
> What I did:
> 
> ./configure --prefix=/var/lib/pgsql/slony
> gmake all
> gmake install
> 
> Yet I get the following error:
> 
> $ gmake install
> gmake[1]: Entering directory `/tmp/slony1-1.2.23/src'
> gmake[2]: Entering directory `/tmp/slony1-1.2.23/src/xxid'
> /bin/sh /tmp/slony1-1.2.23/config/mkinstalldirs /usr/lib64/pgsql/
> /bin/sh /tmp/slony1-1.2.23/config/mkinstalldirs /usr/share/pgsql/
> /bin/sh /tmp/slony1-1.2.23/config/install-sh -c -m 755 xxid.so
> /usr/lib64/pgsql/
> cp: cannot create regular file `/usr/lib64/pgsql//#inst.24369#': Permission
> denied
> gmake[2]: *** [install] Error 1
> gmake[2]: Leaving directory `/tmp/slony1-1.2.23/src/xxid'
> gmake[1]: *** [install] Error 2
> gmake[1]: Leaving directory `/tmp/slony1-1.2.23/src'
> gmake: *** [install] Error 2



From ngramsky at cs.umd.edu  Sun Mar  4 18:55:21 2012
From: ngramsky at cs.umd.edu (NewToSlony)
Date: Sun, 4 Mar 2012 18:55:21 -0800 (PST)
Subject: [Slony1-general] Install without root permissions
In-Reply-To: <7D4A6711-CCCC-438F-9AC4-0018B18ABD96@pgexperts.com>
References: <33440610.post@talk.nabble.com>
	<1330906981.20792.4.camel@lenovo01-laptop03.gunduz.org>
	<33440809.post@talk.nabble.com>
	<7D4A6711-CCCC-438F-9AC4-0018B18ABD96@pgexperts.com>
Message-ID: <33441006.post@talk.nabble.com>


I've subscribed.  Sorry, didn't realize I needed to do something...

About your reply, I'm not sure I completely follow you as I'm a bit green to
PostgreSQL.  What .so files am I missing?  How can they be missing if
PotgreSQL is working fine?  Do I need to specify other Slony options as I
run configure?



Jeff Frost-2 wrote:
> 
> Ah yes, the issue is that you need a few .so files installed in the
> postgresql libdir.  that appears to be: /usr/lib64/pgsql on your
> installation.  
> 
> BTW, any chance you could subscribe to the mailing list so we don't have
> to keep moderating each one of your emails to the list?
> 
> On Mar 4, 2012, at 5:25 PM, NewToSlony wrote:
> 
>> 
>> That did not seem to work.  I'm getting the same error I get if I try it
>> with
>> 'with-pgconfigdir.
>> 
>> What I did:
>> 
>> ./configure --prefix=/var/lib/pgsql/slony
>> gmake all
>> gmake install
>> 
>> Yet I get the following error:
>> 
>> $ gmake install
>> gmake[1]: Entering directory `/tmp/slony1-1.2.23/src'
>> gmake[2]: Entering directory `/tmp/slony1-1.2.23/src/xxid'
>> /bin/sh /tmp/slony1-1.2.23/config/mkinstalldirs /usr/lib64/pgsql/
>> /bin/sh /tmp/slony1-1.2.23/config/mkinstalldirs /usr/share/pgsql/
>> /bin/sh /tmp/slony1-1.2.23/config/install-sh -c -m 755 xxid.so
>> /usr/lib64/pgsql/
>> cp: cannot create regular file `/usr/lib64/pgsql//#inst.24369#':
>> Permission
>> denied
>> gmake[2]: *** [install] Error 1
>> gmake[2]: Leaving directory `/tmp/slony1-1.2.23/src/xxid'
>> gmake[1]: *** [install] Error 2
>> gmake[1]: Leaving directory `/tmp/slony1-1.2.23/src'
>> gmake: *** [install] Error 2
> 
> 
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
> 
> 

-- 
View this message in context: http://old.nabble.com/Install-without-root-permissions-tp33440610p33441006.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.


From ngramsky at cs.umd.edu  Tue Mar  6 08:29:02 2012
From: ngramsky at cs.umd.edu (NewToSlony)
Date: Tue, 6 Mar 2012 08:29:02 -0800 (PST)
Subject: [Slony1-general] How to install slony with more than one version of
 postgres
Message-ID: <33452102.post@talk.nabble.com>


I have a machine with two copies of Postgres on it.  I cannot remove the old
version as the admins will not allow that version to be removed.  The 2nd
version is the version I use and which to install Slony on.  I've used both
--prefix and --with-pgdconfigdir options, but the configure script still
keeps grabbing the other, older, incorrect version.  How can I install slony
and direct it to use only one of the two versions?
-- 
View this message in context: http://old.nabble.com/How-to-install-slony-with-more-than-one-version-of-postgres-tp33452102p33452102.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.


From vivek at khera.org  Tue Mar  6 10:13:52 2012
From: vivek at khera.org (Vick Khera)
Date: Tue, 6 Mar 2012 13:13:52 -0500
Subject: [Slony1-general] How to install slony with more than one
 version of postgres
In-Reply-To: <33452102.post@talk.nabble.com>
References: <33452102.post@talk.nabble.com>
Message-ID: <CALd+dcc2gKPZEaBfW6AfGr+JymD0u8sykEgjR+GyFE7vANJNtA@mail.gmail.com>

On Tue, Mar 6, 2012 at 11:29 AM, NewToSlony <ngramsky at cs.umd.edu> wrote:
> I have a machine with two copies of Postgres on it. ?I cannot remove the old
> version as the admins will not allow that version to be removed. ?The 2nd
> version is the version I use and which to install Slony on. ?I've used both
> --prefix and --with-pgdconfigdir options, but the configure script still
> keeps grabbing the other, older, incorrect version. ?How can I install slony
> and direct it to use only one of the two versions?

Try adjusting your shell PATH such that the new version is always
found first.  You might end up with the scripts finding the older
version's executables, causing such confusion.

From laurapassigni at yahoo.it  Wed Mar  7 02:57:24 2012
From: laurapassigni at yahoo.it (Laura Passigni)
Date: Wed, 7 Mar 2012 10:57:24 +0000 (GMT)
Subject: [Slony1-general] Slow sync
Message-ID: <1331117844.5271.YahooMailNeo@web28504.mail.ukl.yahoo.com>

Hi, 
I have a big database (about 1350GB) with Slony replica (1 master and 1 slave).
Last week I have had a network crash between master and slave server. Unfortunately there was a bulk import in progress in the master database.?As result the slave server?was not in sync with the master for few days. 
There are now about 80.000 records in the sl_event table and the sync is very slow. I have seen in the log file that the sync of each event requires about 1500/2000 seconds. It is a very huge time.
Is there something that I can do? Is there some faster way to sync the databases? 

Thank you,
Laura
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20120307/ee9e7537/attachment.htm 

From atsaloli.tech at gmail.com  Wed Mar  7 12:59:31 2012
From: atsaloli.tech at gmail.com (Aleksey Tsalolikhin)
Date: Wed, 7 Mar 2012 12:59:31 -0800
Subject: [Slony1-general] A 154 GB table swelled to 527 GB on the Slony
	slave. How to compact it?
In-Reply-To: <CA+jMWodz_6rhfCd9APKf3vkun-kp-gSW=-TgH_Fo+SPoQw2X8A@mail.gmail.com>
References: <CA+jMWodz_6rhfCd9APKf3vkun-kp-gSW=-TgH_Fo+SPoQw2X8A@mail.gmail.com>
Message-ID: <CA+jMWodFkAtogPhwk+Tik5Gind+WSFrQZAmkJb6th0OpSD-17A@mail.gmail.com>

Hello,

?We're replicating a PostgreSQL 8.4.x database using Slony1-1.2.x

?The origin database "data/base" directory is 197 GB in size.

?The slave database "data/base" directory is 562 GB in size and is
?over 75% filesystem utilization which has set off the "disk free" siren.

?My biggest table* measures 154 GB on the origin, and 533 GB on
?the slave. ?(*As reported by

?SELECT relname as "Table", pg_size_pretty(pg_total_relation_size(relid))
? As "Size" from pg_catalog.pg_statio_user_tables
? ORDER BY pg_total_relation_size(relid) DESC;
?)

?I took a peek at this table on the slave using pgadmin3. The table
?has auto-vacuum enabled, and TOAST autovacuum enabled.

?There are 8.6 million live tuples, and 1.5 million dead tuples.

?Last autovacuum was over a month ago.

?Last autoanalyze was 3 hours ago.

?Table size is 4 Gigs, and TOAST table size is 527 Gigs.
?Indexes size is 3 Gigs.

?Autovacuum threshold is 20%, and the table is just under that threshold.

?I ran vacuum analyze verbose. ?But the filesystem is still at 76%
utilization.
?In fact, now, the "data/base" directory has grown to 565 GB.

?Why is my slave bigger than my master? ?How can I compact it, please?

Best,
Aleksey

From ssinger at ca.afilias.info  Wed Mar  7 14:29:06 2012
From: ssinger at ca.afilias.info (Steve Singer)
Date: Wed, 07 Mar 2012 17:29:06 -0500
Subject: [Slony1-general] Slow sync
In-Reply-To: <1331117844.5271.YahooMailNeo@web28504.mail.ukl.yahoo.com>
References: <1331117844.5271.YahooMailNeo@web28504.mail.ukl.yahoo.com>
Message-ID: <4F57E132.3050607@ca.afilias.info>

On 12-03-07 05:57 AM, Laura Passigni wrote:
> Hi,
> I have a big database (about 1350GB) with Slony replica (1 master and 1
> slave).
> Last week I have had a network crash between master and slave server.
> Unfortunately there was a bulk import in progress in the master
> database. As result the slave server was not in sync with the master for
> few days.
> There are now about 80.000 records in the sl_event table and the sync is
> very slow. I have seen in the log file that the sync of each event
> requires about 1500/2000 seconds. It is a very huge time.
> Is there something that I can do? Is there some faster way to sync the
> databases?
> Thank you,
> Laura
>

It is possible that your issue is what we have been referring to as bug 
167.  This has been fixed in slony 2.1.0.  What happens is that when 
sl_log_1 or sl_log_2 grows beyond a certain size the query turns into a 
sequential scan.

Other than upgrading,  you need to push the sync interval up so you 
generate fewer syncs, and increase the sync_groupsize so it processes 
more syncs together.  This might allow slony to catch up.  Once it is 
caught up your sl_log tables will get truncated and you can go back to 
normal settings/operations.


>
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


From ssinger at ca.afilias.info  Wed Mar  7 14:37:55 2012
From: ssinger at ca.afilias.info (Steve Singer)
Date: Wed, 07 Mar 2012 17:37:55 -0500
Subject: [Slony1-general] A 154 GB table swelled to 527 GB on the Slony
 slave. How to compact it?
In-Reply-To: <CA+jMWodFkAtogPhwk+Tik5Gind+WSFrQZAmkJb6th0OpSD-17A@mail.gmail.com>
References: <CA+jMWodz_6rhfCd9APKf3vkun-kp-gSW=-TgH_Fo+SPoQw2X8A@mail.gmail.com>
	<CA+jMWodFkAtogPhwk+Tik5Gind+WSFrQZAmkJb6th0OpSD-17A@mail.gmail.com>
Message-ID: <4F57E343.8050808@ca.afilias.info>

On 12-03-07 03:59 PM, Aleksey Tsalolikhin wrote:
> Hello,


If the problem is that your table is bloated

The CLUSTER command 
http://www.postgresql.org/docs/8.4/static/sql-cluster.html will compact 
your table.  The VACUUM command does not normally return unused space to 
the operating system (some exceptions apply)





>
>   We're replicating a PostgreSQL 8.4.x database using Slony1-1.2.x
>
>   The origin database "data/base" directory is 197 GB in size.
>
>   The slave database "data/base" directory is 562 GB in size and is
>   over 75% filesystem utilization which has set off the "disk free" siren.
>
>   My biggest table* measures 154 GB on the origin, and 533 GB on
>   the slave.  (*As reported by
>
>   SELECT relname as "Table", pg_size_pretty(pg_total_relation_size(relid))
>    As "Size" from pg_catalog.pg_statio_user_tables
>    ORDER BY pg_total_relation_size(relid) DESC;
>   )
>
>   I took a peek at this table on the slave using pgadmin3. The table
>   has auto-vacuum enabled, and TOAST autovacuum enabled.
>
>   There are 8.6 million live tuples, and 1.5 million dead tuples.
>
>   Last autovacuum was over a month ago.
>
>   Last autoanalyze was 3 hours ago.
>
>   Table size is 4 Gigs, and TOAST table size is 527 Gigs.
>   Indexes size is 3 Gigs.
>
>   Autovacuum threshold is 20%, and the table is just under that threshold.
>
>   I ran vacuum analyze verbose.  But the filesystem is still at 76%
> utilization.
>   In fact, now, the "data/base" directory has grown to 565 GB.
>
>   Why is my slave bigger than my master?  How can I compact it, please?
>
> Best,
> Aleksey
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


From atsaloli.tech at gmail.com  Wed Mar  7 16:28:40 2012
From: atsaloli.tech at gmail.com (Aleksey Tsalolikhin)
Date: Wed, 7 Mar 2012 16:28:40 -0800
Subject: [Slony1-general] A 154 GB table swelled to 527 GB on the Slony
 slave. How to compact it?
In-Reply-To: <4F57E343.8050808@ca.afilias.info>
References: <CA+jMWodz_6rhfCd9APKf3vkun-kp-gSW=-TgH_Fo+SPoQw2X8A@mail.gmail.com>
	<CA+jMWodFkAtogPhwk+Tik5Gind+WSFrQZAmkJb6th0OpSD-17A@mail.gmail.com>
	<4F57E343.8050808@ca.afilias.info>
Message-ID: <CA+jMWoduFmhK4Ak5ZdCTKWH9GKW91psU-a4wU2DTxih5K52RBw@mail.gmail.com>

On Wed, Mar 7, 2012 at 2:37 PM, Steve Singer <ssinger at ca.afilias.info> wrote:
> On 12-03-07 03:59 PM, Aleksey Tsalolikhin wrote:
>>
>> Hello,
>
>
>
> If the problem is that your table is bloated
>
> The CLUSTER command
> http://www.postgresql.org/docs/8.4/static/sql-cluster.html will compact your
> table. ?The VACUUM command does not normally return unused space to the
> operating system (some exceptions apply)

Thank you, Steve.

I used "check_postgres" to check for bloat and it reported wasted size
only 1 GB.

table XYZ rows:8674174 pages:463848 shouldbe:318436 (1.5X) wasted
size:1191215104 (1 GB)

This does not seem much compared to table size on the master,
154 GB,and on the slave, 527 GB.

I can't run CLUSTER because I don't have another 500 GB free...  I am running
VACUUM FULL right now to return the unused disk space to the OS.
I wondering if it will free 1 GB or 300 GB.  I expect 1 GB, based on the
check_postgres "bloat" check results.

I'll run check_postgres "bloat" check again after the VACUUM FULL finishes.

This table does use TOAST and most of the data is in TOAST...  I wonder if the
1 GB size includes TOAST.

Best,
Aleksey

From atsaloli.tech at gmail.com  Wed Mar  7 18:31:14 2012
From: atsaloli.tech at gmail.com (Aleksey Tsalolikhin)
Date: Wed, 7 Mar 2012 18:31:14 -0800
Subject: [Slony1-general] A 154 GB table swelled to 527 GB on the Slony
 slave. How to compact it?
In-Reply-To: <CA+jMWoduFmhK4Ak5ZdCTKWH9GKW91psU-a4wU2DTxih5K52RBw@mail.gmail.com>
References: <CA+jMWodz_6rhfCd9APKf3vkun-kp-gSW=-TgH_Fo+SPoQw2X8A@mail.gmail.com>
	<CA+jMWodFkAtogPhwk+Tik5Gind+WSFrQZAmkJb6th0OpSD-17A@mail.gmail.com>
	<4F57E343.8050808@ca.afilias.info>
	<CA+jMWoduFmhK4Ak5ZdCTKWH9GKW91psU-a4wU2DTxih5K52RBw@mail.gmail.com>
Message-ID: <CA+jMWofTnhin+yMnfg-OYYPO95VA+gassY+8MfA_dh8B4aKEzA@mail.gmail.com>

On Wed, Mar 7, 2012 at 4:28 PM, Aleksey Tsalolikhin
<atsaloli.tech at gmail.com> wrote:
> On Wed, Mar 7, 2012 at 2:37 PM, Steve Singer <ssinger at ca.afilias.info> wrote:
>>
>>
>> If the problem is that your table is bloated

I ran VACUUM FULL on this table, but it is still over 500 GB in size.

 "check_postgres --action=bloat" now returns OK.  So it's not bloat.
 What else could it be, please?

 Best,
 Aleksey

From brianf at consistentstate.com  Thu Mar  8 12:08:30 2012
From: brianf at consistentstate.com (Brian Fehrle)
Date: Thu, 08 Mar 2012 13:08:30 -0700
Subject: [Slony1-general] Slow sync
In-Reply-To: <4F57E132.3050607@ca.afilias.info>
References: <1331117844.5271.YahooMailNeo@web28504.mail.ukl.yahoo.com>
	<4F57E132.3050607@ca.afilias.info>
Message-ID: <4F5911BE.7070606@consistentstate.com>

I had a similar situation recently, and had to get it caught up on a 
slow connection.

I increased the group size to allow more events be processed at a time, 
it did help catch up a bit faster.

Normally I have all daemons running on one box, so I also killed the 
daemon for this slave and ran it on the actual slave that was behind. It 
sped the sync times up by about 4X.

- Brian F

On 03/07/2012 03:29 PM, Steve Singer wrote:
> On 12-03-07 05:57 AM, Laura Passigni wrote:
>> Hi,
>> I have a big database (about 1350GB) with Slony replica (1 master and 1
>> slave).
>> Last week I have had a network crash between master and slave server.
>> Unfortunately there was a bulk import in progress in the master
>> database. As result the slave server was not in sync with the master for
>> few days.
>> There are now about 80.000 records in the sl_event table and the sync is
>> very slow. I have seen in the log file that the sync of each event
>> requires about 1500/2000 seconds. It is a very huge time.
>> Is there something that I can do? Is there some faster way to sync the
>> databases?
>> Thank you,
>> Laura
>>
> It is possible that your issue is what we have been referring to as bug
> 167.  This has been fixed in slony 2.1.0.  What happens is that when
> sl_log_1 or sl_log_2 grows beyond a certain size the query turns into a
> sequential scan.
>
> Other than upgrading,  you need to push the sync interval up so you
> generate fewer syncs, and increase the sync_groupsize so it processes
> more syncs together.  This might allow slony to catch up.  Once it is
> caught up your sl_log tables will get truncated and you can go back to
> normal settings/operations.
>
>
>>
>> _______________________________________________
>> Slony1-general mailing list
>> Slony1-general at lists.slony.info
>> http://lists.slony.info/mailman/listinfo/slony1-general
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


From scott.marlowe at gmail.com  Thu Mar  8 13:07:27 2012
From: scott.marlowe at gmail.com (Scott Marlowe)
Date: Thu, 8 Mar 2012 14:07:27 -0700
Subject: [Slony1-general] Slow sync
In-Reply-To: <4F5911BE.7070606@consistentstate.com>
References: <1331117844.5271.YahooMailNeo@web28504.mail.ukl.yahoo.com>
	<4F57E132.3050607@ca.afilias.info>
	<4F5911BE.7070606@consistentstate.com>
Message-ID: <CAOR=d=2u9GuwmqS2BHmsw9xkLFNiLCpM5H+1tKgMZajP9+jj_g@mail.gmail.com>

On Thu, Mar 8, 2012 at 1:08 PM, Brian Fehrle <brianf at consistentstate.com> wrote:
> I had a similar situation recently, and had to get it caught up on a
> slow connection.
>
> I increased the group size to allow more events be processed at a time,
> it did help catch up a bit faster.
>
> Normally I have all daemons running on one box, so I also killed the
> daemon for this slave and ran it on the actual slave that was behind. It
> sped the sync times up by about 4X.

This last paragraph++

From dbrb2002-sql at yahoo.com  Thu Mar 15 18:52:22 2012
From: dbrb2002-sql at yahoo.com (Brian Trudal)
Date: Thu, 15 Mar 2012 18:52:22 -0700 (PDT)
Subject: [Slony1-general] Re copy currently replicated table
Message-ID: <1331862742.79717.YahooMailNeo@web31816.mail.mud.yahoo.com>

Looks like a odd situation; 

I have 2 sets, and one set with 3 tables and another with 50+ tables. Both the sets are replicated to two subscribers; one set has correct data, but second set two tables are off.

And both the subscribers are up2date with origin; but 2 tables out of 3, has wrong number of rows (way off) in subscriber-1;

So, whats the best way to re-copy or re-initiate these two tables copy only to subsriber-1 without subsriber-2 (it shares the set) as subscriber-2 is prod read facing.

Thanks for the help
Brian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20120315/98080e98/attachment.htm 

From ssinger at ca.afilias.info  Fri Mar 16 06:57:15 2012
From: ssinger at ca.afilias.info (Steve Singer)
Date: Fri, 16 Mar 2012 09:57:15 -0400
Subject: [Slony1-general] Re copy currently replicated table
In-Reply-To: <1331862742.79717.YahooMailNeo@web31816.mail.mud.yahoo.com>
References: <1331862742.79717.YahooMailNeo@web31816.mail.mud.yahoo.com>
Message-ID: <4F6346BB.3000100@ca.afilias.info>

On 12-03-15 09:52 PM, Brian Trudal wrote:
> Looks like a odd situation;
>
> I have 2 sets, and one set with 3 tables and another with 50+ tables.
> Both the sets are replicated to two subscribers; one set has correct
> data, but second set two tables are off.

How did you get your cluster into this situation?  Something has gone wrong.

I assume your still using 2.0.7 with PG 8.4

>
> And both the subscribers are up2date with origin; but 2 tables out of 3,
> has wrong number of rows (way off) in subscriber-1;
>
> So, whats the best way to re-copy or re-initiate these two tables copy
> only to subsriber-1 without subsriber-2 (it shares the set) as
> subscriber-2 is prod read facing.

You can unsubscribe subscriber 1 from the set with the UNSUBSCRIBE SET 
command.  You can then resubscribe subscriber 1 with the
SUBSCRIBE SET command.  This should not effect subscriber 2.



>
> Thanks for the help
> Brian
>
>
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


From georgeesli at gmail.com  Fri Mar 16 08:34:06 2012
From: georgeesli at gmail.com (ESLI george)
Date: Fri, 16 Mar 2012 16:34:06 +0100
Subject: [Slony1-general] Slony installation query.
Message-ID: <CAPLB0Xuj4JHeS2cYQY1qxcDNRtBfoCsB4MT+mgAmJpLi7dyV+g@mail.gmail.com>

Hello,

We are Master students from Cologne University of Applied Sciences Germany.
We are building a prototype for a biogas plant and we are having some
problems implementing the structure

We want do a Master-Slave replication between ubuntu(Master) and
windows(Slave) in PostgreSQL 9.1 using Slony2.1. we have problems in
installing slony 2.1 in ubuntu. The problem is after
configuring(./configure) and then compiling using command 'make' the file
in slony1-2.1.1/src/backend/slony1_funcs.c. The header file Miscadmin.h is
not found and most of the header files(nodes/makefuncs.h, etc.,) are not
found. We have attached the screenshot of the error for Miscadmin.h. We
need to know where we can find these header files and what is the problem
in it.

We are looking forward for your support.

Thanks & Regards
Esli
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20120316/47d3f5ca/attachment-0001.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Terminal Screenshot.JPG
Type: image/jpeg
Size: 180444 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20120316/47d3f5ca/attachment-0001.jpeg 

From scott.marlowe at gmail.com  Fri Mar 16 10:03:03 2012
From: scott.marlowe at gmail.com (Scott Marlowe)
Date: Fri, 16 Mar 2012 11:03:03 -0600
Subject: [Slony1-general] Slony installation query.
In-Reply-To: <CAPLB0Xuj4JHeS2cYQY1qxcDNRtBfoCsB4MT+mgAmJpLi7dyV+g@mail.gmail.com>
References: <CAPLB0Xuj4JHeS2cYQY1qxcDNRtBfoCsB4MT+mgAmJpLi7dyV+g@mail.gmail.com>
Message-ID: <CAOR=d=3_52S0YwqbfKX5WC-QgKR_ni-ipScUeuzibQk4GZJcLQ@mail.gmail.com>

On Fri, Mar 16, 2012 at 9:34 AM, ESLI george <georgeesli at gmail.com> wrote:
> Hello,
>
> We are Master students from Cologne University of Applied Sciences Germany.
> We are building a prototype for a biogas plant and we are having some
> problems implementing the structure
>
> We want do a Master-Slave replication between ubuntu(Master) and
> windows(Slave) in PostgreSQL 9.1 using Slony2.1. we have problems in
> installing slony 2.1 in ubuntu. The problem is after
> configuring(./configure) and then compiling using command 'make' the file in
> slony1-2.1.1/src/backend/slony1_funcs.c. The header file Miscadmin.h is not
> found and most of the header files(nodes/makefuncs.h, etc.,) are not found.
> We have attached the screenshot of the error for Miscadmin.h. We need to
> know where we can find these header files and what is the problem in it.

Do you have the -dev packages for postgresql installed?

From scott.marlowe at gmail.com  Fri Mar 16 10:04:19 2012
From: scott.marlowe at gmail.com (Scott Marlowe)
Date: Fri, 16 Mar 2012 11:04:19 -0600
Subject: [Slony1-general] Slony installation query.
In-Reply-To: <CAOR=d=3_52S0YwqbfKX5WC-QgKR_ni-ipScUeuzibQk4GZJcLQ@mail.gmail.com>
References: <CAPLB0Xuj4JHeS2cYQY1qxcDNRtBfoCsB4MT+mgAmJpLi7dyV+g@mail.gmail.com>
	<CAOR=d=3_52S0YwqbfKX5WC-QgKR_ni-ipScUeuzibQk4GZJcLQ@mail.gmail.com>
Message-ID: <CAOR=d=3ZxYfi1BUKtUfZORRVtL_FMH3qNB=hC0NiYVWg1mrtyQ@mail.gmail.com>

Also I just noticed you sent your email to like 6 different
recipients.  Please don't do that.  Pick one.  The slony1 general list
is a good starting place.

On Fri, Mar 16, 2012 at 11:03 AM, Scott Marlowe <scott.marlowe at gmail.com> wrote:
> On Fri, Mar 16, 2012 at 9:34 AM, ESLI george <georgeesli at gmail.com> wrote:
>> Hello,
>>
>> We are Master students from Cologne University of Applied Sciences Germany.
>> We are building a prototype for a biogas plant and we are having some
>> problems implementing the structure
>>
>> We want do a Master-Slave replication between ubuntu(Master) and
>> windows(Slave) in PostgreSQL 9.1 using Slony2.1. we have problems in
>> installing slony 2.1 in ubuntu. The problem is after
>> configuring(./configure) and then compiling using command 'make' the file in
>> slony1-2.1.1/src/backend/slony1_funcs.c. The header file Miscadmin.h is not
>> found and most of the header files(nodes/makefuncs.h, etc.,) are not found.
>> We have attached the screenshot of the error for Miscadmin.h. We need to
>> know where we can find these header files and what is the problem in it.
>
> Do you have the -dev packages for postgresql installed?



-- 
To understand recursion, one must first understand recursion.

From ahodgson at simkin.ca  Fri Mar 16 10:06:38 2012
From: ahodgson at simkin.ca (Alan Hodgson)
Date: Fri, 16 Mar 2012 10:06:38 -0700
Subject: [Slony1-general] Slony installation query.
In-Reply-To: <CAPLB0Xuj4JHeS2cYQY1qxcDNRtBfoCsB4MT+mgAmJpLi7dyV+g@mail.gmail.com>
References: <CAPLB0Xuj4JHeS2cYQY1qxcDNRtBfoCsB4MT+mgAmJpLi7dyV+g@mail.gmail.com>
Message-ID: <2485310.h6C2lnVcC8@skynet.simkin.ca>

On Friday, March 16, 2012 04:34:06 PM ESLI george wrote:
> We want do a Master-Slave replication between ubuntu(Master) and
> windows(Slave) in PostgreSQL 9.1 using Slony2.1. we have problems in
> installing slony 2.1 in ubuntu. The problem is after
> configuring(./configure) and then compiling using command 'make' the file
> in slony1-2.1.1/src/backend/slony1_funcs.c. The header file Miscadmin.h is
> not found and most of the header files(nodes/makefuncs.h, etc.,) are not
> found. We have attached the screenshot of the error for Miscadmin.h. We
> need to know where we can find these header files and what is the problem
> in it.
> 
> We are looking forward for your support.
> 
> Thanks & Regards
> Esli

You need to install the postgresql development package for your distribution. 
I think that's postgresql-server-dev or something similar, on Ubuntu.

