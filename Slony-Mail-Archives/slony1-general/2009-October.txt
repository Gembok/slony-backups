From stuart at stuartbishop.net  Thu Oct  1 02:20:52 2009
From: stuart at stuartbishop.net (stuart@stuartbishop.net)
Date: Thu Oct  1 02:21:33 2009
Subject: [Slony1-general] Options for altering tables in one replication set
	with other replication sets live
Message-ID: <g09aqhd1f9wd2cuqsdUYAxe124vaj_firegpg@mail.gmail.com>

SGkuDQoNCkkgY3VycmVudGx5IGhhdmUgdGhyZWUgbm9kZXMgYW5kIHR3byByZXBsaWNhdGlvbiBz
ZXRzLiBFdmVyeSBtb250aCBJIG5lZWQgdG8gYWx0ZXIgdGhlIHRhYmxlcyBpbiB0aGUgbGFyZ2Vy
IHJlcGxpY2F0aW9uIHNldCB3aGlsZSBrZWVwaW5nIHRoZSBzbWFsbGVyIHJlcGxpY2F0aW9uIHNl
dCBsaXZlLiBUaGUgc2NyaXB0cyB0aGF0IGRvIHRoZSBhbHRlcmF0aW9uIGNhbiB0YWtlIGhvdXJz
IHRvIHJ1bi4NCg0KRVhFQ1VURSBTQ1JJUFQgd2FudHMgdG8gbG9jayBhbGwgdGFibGVzLCBkZXNw
aXRlIG1lIGJlaW5nIGEgY29uc2VudGluZyBhZHVsdCB3aG8gcHJvbWlzZXMgbm90IHRvIG11Y2sg
d2l0aCB0YWJsZXMgb3V0c2lkZSBvZiB0aGUgc3BlY2lmaWVkIFNFVCBJRCBzZXQuDQoNCkRvIEkg
bmVlZCB0byBzcGxpdCB0aGluZ3MgaW50byB0d28gY2x1c3RlcnM/DQoNCkFyZSB0aGVyZSBvdGhl
ciBhbHRlcm5hdGl2ZXMsIHN1Y2ggYXMgYSB2ZXJzaW9uIG9mIEVYRUNVVEUgU0NSSVBUIHRoYXQg
aGFzIGxlc3MgcGFyYW5vaWQgbG9ja2luZyBiZWhhdmlvcj8NCg0KSSdtIGN1cnJlbnRseSBydW5u
aW5nIDEuMi4xMyBidXQgY2FuIHVwZ3JhZGUgaWYgbmVlZGVkLiBPbmUgb3B0aW9uIEkgY291bGQg
Y29tZSB1cCB3aXRoIHdpdGggMi4wIHdvdWxkIGJlIGRyb3AgdGhlIGxhcmdlciByZXBsaWNhdGlv
biBzZXQgZW50aXJlbHkgb3V0IG9mIHRoZSBjbHVzdGVyLCBydW4gdGhlIHNjcmlwdHMgbWFudWFs
bHkgYWdhaW5zdCBlYWNoIG5vZGUsIHRoZW4gcmVidWlsZCB0aGUgcmVwbGljYXRpb24gc2V0IHVz
aW5nIE9NSVQgQ09QWSBidXQgdGhhdCBqdXN0IHNlZW1zIG5hc3R5IC0gSSdkIHByb2JhYmx5IGJl
IGJldHRlciBvZmYgd3JpdGluZyBteSBvd24gRVhFQ1VURSBTQ1JJUFQgcmVwbGFjZW1lbnQgdGhh
dCBvbmx5IGxvY2tzIGFuZCBtZXNzZXMgd2l0aCB0aGUgdHJpZ2dlcnMgb2YgdGFibGVzIGluIHRo
ZSB0YXJnZXRlZCBzZXQuDQoNCi0tIA0KU3R1YXJ0IEJpc2hvcCA8c3R1YXJ0QHN0dWFydGJpc2hv
cC5uZXQ+DQpodHRwOi8vd3d3LnN0dWFydGJpc2hvcC5uZXQvDQoNCi0tLS0tLS0tLS0tLS0tIG5l
eHQgcGFydCAtLS0tLS0tLS0tLS0tLQpBIG5vbi10ZXh0IGF0dGFjaG1lbnQgd2FzIHNjcnViYmVk
Li4uCk5hbWU6IHNpZ25hdHVyZS5hc2MKVHlwZTogYXBwbGljYXRpb24vcGdwLXNpZ25hdHVyZQpT
aXplOiAyNjIgYnl0ZXMKRGVzYzogT3BlblBHUCBkaWdpdGFsIHNpZ25hdHVyZQpVcmwgOiBodHRw
Oi8vbGlzdHMuc2xvbnkuaW5mby9waXBlcm1haWwvc2xvbnkxLWdlbmVyYWwvYXR0YWNobWVudHMv
MjAwOTEwMDEvZmQwODgyMTUvc2lnbmF0dXJlLnBncAo=
From ajs at crankycanuck.ca  Thu Oct  1 13:14:58 2009
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Thu Oct  1 13:15:17 2009
Subject: [Slony1-general] Options for altering tables in one
	replication set with other replication sets live
In-Reply-To: <g09aqhd1f9wd2cuqsdUYAxe124vaj_firegpg@mail.gmail.com>
References: <g09aqhd1f9wd2cuqsdUYAxe124vaj_firegpg@mail.gmail.com>
Message-ID: <20091001201458.GM7059@shinkuro.com>

On Thu, Oct 01, 2009 at 04:20:52PM +0700, stuart@stuartbishop.net wrote:
>
> EXECUTE SCRIPT wants to lock all tables, despite me being a
> consenting adult who promises not to muck with tables outside of the
> specified SET ID set.

[?]

> Are there other alternatives, such as a version of EXECUTE SCRIPT
> that has less paranoid locking behavior?

In the Old Days of Slony, EXECUTE SCRIPT locked the tables in the set,
not all tables.  It was changed because there was no way to prevent
people from inflicting self-damage.  I suppose you ought to be able to
re-patch the modern code with something like the old version.

I recall feeling somewhat equivocal about this change, precisely
because it would forestall exactly the sort of thing you are now
trying to do.

I seem to recall doing something similar with bare metal functions,
however, so you may be able to get around this just by not using
EXECUTE SCRIPT.

A

-- 
Andrew Sullivan
ajs@crankycanuck.ca
From lawrencew00 at hotmail.com  Thu Oct  1 19:27:03 2009
From: lawrencew00 at hotmail.com (Lawrence Wong)
Date: Thu Oct  1 19:27:28 2009
Subject: [Slony1-general] Multiple Databases
In-Reply-To: <20090930082916.63234070.wmoran@potentialtech.com>
References: <SNT101-W39A100DD781AEEDFDA3215BDD40@phx.gbl>
Message-ID: <SNT101-W42D71E157F7014A2136323BDD20@phx.gbl>


I am running Slony-I on 2 Windows 2003 Servers.  How would I start an extra=
 slon process on Windows?  Is this related to adding an engine for the serv=
ice?  =

The log file for slony doesn't say anything about db2.  But when I run slon=
ik.exe <scriptName>. It produces the error '48: ERROR: syntax error at or n=
ear cluster'.  That is the line that says "cluster name =3D slony_dbTwo;". =
 To experiment, I commented out this line and then ran the slonik script an=
d it gave me the same error but for the next line "node 3 admin conninfo=3D=
'host=3D192.168.112.4 dbname=3DdbTwo user=3Dpostgres password=3Dpostgres';"=
.  I guess this was expected.  I then deleted everything from my script aft=
er "cluster name =3D slony_dbTwo" and it ran ok.  I will try running the se=
cond half as a separate script.  But it would be really beneficial to run t=
hem in the same one.  =

LW . . . Lawrence

> Date: Wed, 30 Sep 2009 08:29:16 -0400
> From: wmoran@potentialtech.com
> To: lawrencew00@hotmail.com
> CC: slony1-general@lists.slony.info
> Subject: Re: [Slony1-general] Multiple Databases
> =

> In response to Lawrence Wong <lawrencew00@hotmail.com>:
> =

> > =

> > Hi,
> > I am trying to replicate two databases in a simple 1 master, 1 slave co=
nfiguration.  I was successful with one database but unsuccessful with 2.  =
I was wondering if anyone could point out my mistake in my slonik script tr=
ying to replicate 2 databases.  I have read that a simple way to go around =
is to have the tables in the same schema but I would like to keep the datab=
ases separate.  Here is my slonik script:
> =

> Wow.  Hotmail really mangled your email.  Just ran everything together.
> =

> Looking at the config, I don't see anything obviously wrong.  Here are
> some guesses as to what might be causing you trouble and/or how to
> debug further
> 1) Did you start 2 slon processes on each server?  You'll need a separate
>    slon for each cluster.
> 2) Perhaps try splitting that config in two and submitting separately.  I
>    don't know that submitting it all at once _won't_ work, but I've never
>    tried it.
> 3) What's in slony's log files?
> =

> If I were a betting man, I'd put money that #1 is the problem.
> =

> I assume this is what the config is supposed to look like:
> =

> cluster name =3D slony_dbOne;
> node 1 admin conninfo=3D'host=3D192.168.112.4 dbname=3Ddb user=3Dpostgres=
 password=3Dpostgres';
> node 2 admin conninfo=3D'host=3D192.168.112.5 dbname=3Ddb user=3Dpostgres=
 password=3Dpostgres';
> init cluster (id=3D1,comment=3D'node 1 dbOne');
> #CREATE SET
> create set (id =3D 1, origin =3D 1, comment =3D 'tables');
> #SET ADD TABLE
> set add table (set id=3D1, origin=3D1, id=3D1, fully qualified name =3D '=
schema1.table2',comment=3D'');
> set add table (set id=3D1, origin=3D1, id=3D2, fully qualified name =3D '=
schema1.table2',comment=3D'');
> #STORE NODE
> store node ( id =3D 2, comment =3D 'node 2 dbOne' );
> #STORE PATH
> store path ( server =3D 1, client =3D 2,	conninfo =3D 'dbname=3Ddb host=
=3D192.168.112.4 user=3Dpostgres password=3Dpostgres');
> store path ( server =3D 2, client =3D 1,	conninfo =3D 'dbname=3Ddb host=
=3D192.168.112.5 user=3Dpostgres password=3Dpostgres');
> #STORE LISTEN
> store listen ( origin =3D 1, provider =3D 1, receiver =3D 2 );
> store listen ( origin =3D 2, provider =3D 2, receiver =3D 1 );
> =

> cluster name =3D slony_dbTwo;
> node 3 admin conninfo=3D'host=3D192.168.112.4 dbname=3DdbTwo user=3Dpostg=
res password=3Dpostgres';
> node 4 admin conninfo=3D'host=3D192.168.112.5 dbname=3DdbTwo user=3Dpostg=
res password=3Dpostgres';
> init cluster (id=3D3,comment=3D'node 1 dbTwo');
> #CREATE SET
> create set (id =3D 2, origin =3D 3, comment =3D 'tables');
> #SET ADD TABLE
> set add sequence (set id=3D2, origin=3D3, id=3D1, fully qualified name =
=3D 'schema1.table1', comment=3D'');
> #STORE NODE
> store node ( id =3D 4, comment =3D 'node 2 dbTwo' );
> #STORE PATH
> store path ( server =3D 3, client =3D 4, conninfo =3D 'dbname=3DdbTwo hos=
t=3D192.168.112.4 user=3Dpostgres password=3Dpostgres');
> store path ( server =3D 4, client =3D 3, conninfo =3D 'dbname=3DdbTwo hos=
t=3D192.168.112.5 user=3Dpostgres password=3Dpostgres');
> #STORE LISTEN
> store listen ( origin =3D 3, provider =3D 3, receiver =3D 4 );
> store listen ( origin =3D 4, provider =3D 4, receiver =3D 3 );
> =

> -- =

> Bill Moran
> http://www.potentialtech.com
> http://people.collaborativefusion.com/~wmoran/
 		 	   		  =

_________________________________________________________________
We are your photos. Share us now with Windows Live Photos.
http://go.microsoft.com/?linkid=3D9666047
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20091002/=
15d57242/attachment.htm
From nettreeinc at gmail.com  Thu Oct  1 23:50:33 2009
From: nettreeinc at gmail.com (roctaiwan)
Date: Thu Oct  1 23:51:20 2009
Subject: [Slony1-general] How does it work if has different sets on
	different nodes?
In-Reply-To: <25127095.post@talk.nabble.com>
References: <25056529.post@talk.nabble.com>
	<20090820162918.GN6466@shinkuro.com>
	<25110900.post@talk.nabble.com>
	<20090824171657.GG2063@shinkuro.com>
	<25127095.post@talk.nabble.com>
Message-ID: <25711144.post@talk.nabble.com>


I still have doubt that on Slony docunment it use the word "set transfer" ,
"set moved". The "set" here descirbing, does the SET including the data in
the table that belongs to the set??

If set got moved or transfered, does the data within the table includes in
the set all transfer to the new node for switch over (set got switched
between two nodes) and failover situation(set moved to the new node)? 

Huang


roctaiwan wrote:
> 
> Andrew,
> 
> Then from what you said. Data within the tables between old master and new
> master will be different? then original master has all the data but now
> after failover Node 1 (original master ) got dropped and Node 2 is the new
> master. if node 2 don't have all the up-to-date data for ALL tables (from
> #12345 tables) then where does slaves getting data from?? This is the part
> where I want to get straight with. 
> 
> Also, Node 2 the new master but originally the slave 1 has table set for 1
> and 2. After failover which slave is the provider for table set 1 and 2
> ???
> 
> 
> Regard, 
> 
> Huang
> 
> 
> Andrew Sullivan-8 wrote:
>> 
>> On Sun, Aug 23, 2009 at 10:59:13PM -0700, roctaiwan wrote:
>>> 
>>> Hi Andrew,
>>> 
>>> If I understand the slony replication correct, is that after I do
>>> switchover
>>> or failover what it can do is promote another node to replace its origin
>>> node. 
>> 
>> Hold on: switchover and failover are completely different.  Failover
>> abandons the former origin.  Switchover does not.  Switchover is
>> intelligent about this, but failover just takes over at the new node
>> at whatever stage that node is in.  This works on a _set_, and not on
>> the node as such.
>> 
>>> If lets say failover, after origin node failed and another node
>>> replaced it, all other slave nodes in group will seek for sets from new
>>> master, basically failover script will change the "provider" from
>>> subscribe
>>> set command to the new master node. Therefore, new master should first
>>> sync
>>> with old master with all the data and having all sets isn't it? 
>> 
>> Not for failover, no.  Switchover does this in a controlled manner,
>> and therefore moves the set at a logical point in time for that set.
>>  
>>> Let's say Old master(node 1) has five tables (table 1,2,3,4,5) and new
>>> master (node 2) has only (table 1 and 2). After switch over or failover
>>> to
>>> the new master (node 2), will node 2 sync with old master and has all 5
>>> tables? 
>> 
>> I don't think so, no.
>> 
>> A
>> 
>> -- 
>> Andrew Sullivan
>> ajs@crankycanuck.ca
>> 
>> 
> 
> 

-- 
View this message in context: http://www.nabble.com/How-exactly-replication-works-for-different-sets-on-different-nodes--tp25056529p25711144.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.

From ajs at crankycanuck.ca  Fri Oct  2 09:32:09 2009
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Fri Oct  2 09:32:24 2009
Subject: [Slony1-general] How does it work if has different sets on
	different nodes?
In-Reply-To: <25711144.post@talk.nabble.com>
References: <25056529.post@talk.nabble.com>
	<20090820162918.GN6466@shinkuro.com>
	<25110900.post@talk.nabble.com>
	<20090824171657.GG2063@shinkuro.com>
	<25127095.post@talk.nabble.com> <25711144.post@talk.nabble.com>
Message-ID: <20091002163208.GL9699@shinkuro.com>

On Thu, Oct 01, 2009 at 11:50:33PM -0700, roctaiwan wrote:
> 
> I still have doubt that on Slony docunment it use the word "set transfer" ,
> "set moved". The "set" here descirbing, does the SET including the data in
> the table that belongs to the set??
> 

Sort of.  What it says is that, at a given point in time, the origin
node for the set moves.  That step assumes the previous subscription
by the new (target) origin node.  If the prior subscription hasn't
happened, things will simply not work.  If it hasn't _completed_,
you're going to endure a long outage before anything is actually
working.

A


-- 
Andrew Sullivan
ajs@crankycanuck.ca
From vivek at khera.org  Mon Oct  5 08:01:03 2009
From: vivek at khera.org (Vick Khera)
Date: Mon Oct  5 08:01:12 2009
Subject: [Slony1-general] when creating new table with FK reference to
	existing replicated table, do I need to run via EXECUTE SCRIPT?
Message-ID: <2968dfd60910050801x2ff69524q3d7ac65241c18a2c@mail.gmail.com>

Say I have a table "owners" which is currently replicated.  Now I am
adding to my DB a new table that has a FK reference to the primary key
of "owners".

Does that create table command need to be run via EXECUTE SCRIPT in
slony1?  I know that adding new table doesn't normally require I do
that (just like adding/updating functions) but the FK reference
technically modifies the target table by adding an internal trigger,
thus my question.

Thanks.
From melvin6925 at yahoo.com  Mon Oct  5 08:07:07 2009
From: melvin6925 at yahoo.com (Melvin Davidson)
Date: Mon Oct  5 08:07:16 2009
Subject: [Slony1-general] when creating new table with FK reference to
	existing replicated table, do I need to run via EXECUTE SCRIPT?
In-Reply-To: <2968dfd60910050801x2ff69524q3d7ac65241c18a2c@mail.gmail.com>
References: <2968dfd60910050801x2ff69524q3d7ac65241c18a2c@mail.gmail.com>
Message-ID: <676384.920.qm@web53007.mail.re2.yahoo.com>

>Does that create table command need to be run via EXECUTE SCRIPT in slony1?

Yes. Whenever you create or modify objects, you should always use EXECUTE SCRIPT.
Doing so insures that the changes are propagated across all nodes.


Melvin Davidson 


      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20091005/928f349d/attachment.htm
From ajs at crankycanuck.ca  Mon Oct  5 08:10:19 2009
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Mon Oct  5 08:10:34 2009
Subject: [Slony1-general] when creating new table with FK reference to
	existing replicated table, do I need to run via EXECUTE SCRIPT?
In-Reply-To: <2968dfd60910050801x2ff69524q3d7ac65241c18a2c@mail.gmail.com>
References: <2968dfd60910050801x2ff69524q3d7ac65241c18a2c@mail.gmail.com>
Message-ID: <20091005151018.GA25543@shinkuro.com>

On Mon, Oct 05, 2009 at 11:01:03AM -0400, Vick Khera wrote:
> 
> Does that create table command need to be run via EXECUTE SCRIPT in
> slony1? 

I believe it does,

> technically modifies the target table by adding an internal trigger,

for exactly this reason. 

A

-- 
Andrew Sullivan
ajs@crankycanuck.ca
From vivek at khera.org  Mon Oct  5 11:09:32 2009
From: vivek at khera.org (Vick Khera)
Date: Mon Oct  5 11:09:46 2009
Subject: [Slony1-general] when creating new table with FK reference to 
	existing replicated table, do I need to run via EXECUTE SCRIPT?
In-Reply-To: <20091005151018.GA25543@shinkuro.com>
References: <2968dfd60910050801x2ff69524q3d7ac65241c18a2c@mail.gmail.com>
	<20091005151018.GA25543@shinkuro.com>
Message-ID: <2968dfd60910051109v76415fbeo9fa0396b74bea994@mail.gmail.com>

On Mon, Oct 5, 2009 at 11:10 AM, Andrew Sullivan <ajs@crankycanuck.ca> wrote:
> On Mon, Oct 05, 2009 at 11:01:03AM -0400, Vick Khera wrote:
>>
>> Does that create table command need to be run via EXECUTE SCRIPT in
>> slony1?
>
> I believe it does,
>
>> technically modifies the target table by adding an internal trigger,
>
> for exactly this reason.
>

I'll be revising our internal procedural documentation forthwith.
Thanks for your response.
From vivek at khera.org  Mon Oct  5 11:10:26 2009
From: vivek at khera.org (Vick Khera)
Date: Mon Oct  5 11:10:38 2009
Subject: [Slony1-general] when creating new table with FK reference to 
	existing replicated table, do I need to run via EXECUTE SCRIPT?
In-Reply-To: <676384.920.qm@web53007.mail.re2.yahoo.com>
References: <2968dfd60910050801x2ff69524q3d7ac65241c18a2c@mail.gmail.com>
	<676384.920.qm@web53007.mail.re2.yahoo.com>
Message-ID: <2968dfd60910051110g270c40ccg4b6c011c61f63db3@mail.gmail.com>

On Mon, Oct 5, 2009 at 11:07 AM, Melvin Davidson <melvin6925@yahoo.com> wrote:
>>Does that create table command need to be run via EXECUTE SCRIPT in slony1?
>
> Yes. Whenever you create or modify objects, you should always use EXECUTE
> SCRIPT.
> Doing so insures that the changes are propagated across all nodes.

This is not required for adding new tables that stand alone (ie have
not FKs) or for function definitions.
From melvin6925 at yahoo.com  Mon Oct  5 11:29:41 2009
From: melvin6925 at yahoo.com (Melvin Davidson)
Date: Mon Oct  5 11:29:55 2009
Subject: [Slony1-general] when creating new table with FK reference to
	existing replicated table, do I need to run via EXECUTE SCRIPT?
In-Reply-To: <2968dfd60910051110g270c40ccg4b6c011c61f63db3@mail.gmail.com>
References: <2968dfd60910050801x2ff69524q3d7ac65241c18a2c@mail.gmail.com>
	<676384.920.qm@web53007.mail.re2.yahoo.com>
	<2968dfd60910051110g270c40ccg4b6c011c61f63db3@mail.gmail.com>
Message-ID: <166720.55652.qm@web53011.mail.re2.yahoo.com>

>This is not required for adding new tables that stand alone (ie have not FKs) or for function 
>definitions.

Not necessarily true. Simply put, if you want your slaves to stay in sync with the master, I highly recommend you use EXECUTE SCRIPT to propagate changes across all nodes. Even if the new object will not be immediately replicated, it's always best to insure schemas are identical on all nodes.
Note: There is no requirement to do this, just good practice. If you forget to manually create a table on all nodes and then add it to replication later, it will definitely bite you where i hurts. And if you have to fail over and the object isn't there, can you say for sure things will be fine?


Melvin Davidson 




________________________________
From: Vick Khera <vivek@khera.org>
To: slony <slony1-general@lists.slony.info>
Sent: Monday, October 5, 2009 1:10:26 PM
Subject: Re: [Slony1-general] when creating new table with FK reference to  existing replicated table, do I need to run via EXECUTE SCRIPT?

On Mon, Oct 5, 2009 at 11:07 AM, Melvin Davidson <melvin6925@yahoo.com> wrote:
>>Does that create table command need to be run via EXECUTE SCRIPT in slony1?
>
> Yes. Whenever you create or modify objects, you should always use EXECUTE
> SCRIPT.
> Doing so insures that the changes are propagated across all nodes.

This is not required for adding new tables that stand alone (ie have
not FKs) or for function definitions.
_______________________________________________
Slony1-general mailing list
Slony1-general@lists.slony.info
http://lists.slony.info/mailman/listinfo/slony1-general



      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20091005/e2c39a02/attachment.htm
From vivek at khera.org  Mon Oct  5 11:35:18 2009
From: vivek at khera.org (Vick Khera)
Date: Mon Oct  5 11:35:32 2009
Subject: [Slony1-general] when creating new table with FK reference to 
	existing replicated table, do I need to run via EXECUTE SCRIPT?
In-Reply-To: <166720.55652.qm@web53011.mail.re2.yahoo.com>
References: <2968dfd60910050801x2ff69524q3d7ac65241c18a2c@mail.gmail.com>
	<676384.920.qm@web53007.mail.re2.yahoo.com>
	<2968dfd60910051110g270c40ccg4b6c011c61f63db3@mail.gmail.com>
	<166720.55652.qm@web53011.mail.re2.yahoo.com>
Message-ID: <2968dfd60910051135w1f178b8dhe2917fae699cfcc6@mail.gmail.com>

On Mon, Oct 5, 2009 at 2:29 PM, Melvin Davidson <melvin6925@yahoo.com> wrote:
> Not necessarily true. Simply put, if you want your slaves to stay in sync
> with the master, I highly recommend you use EXECUTE SCRIPT to propagate
> changes across all nodes. Even if the new object

My question was not for "best practices" but rather if it is
technically required.  I'm fully versed with the former.  Running
EXECUTE SCRIPT is very disruptive to the cluster, so if at all
possible I'd like to avoid it and use my other mechanisms for schema
consistency.
From gordo169 at gmail.com  Mon Oct  5 11:48:07 2009
From: gordo169 at gmail.com (Gordon Shannon)
Date: Mon Oct  5 11:48:21 2009
Subject: [Slony1-general] when creating new table with FK reference to
	existing replicated table, do I need to run via EXECUTE SCRIPT?
In-Reply-To: <2968dfd60910051110g270c40ccg4b6c011c61f63db3@mail.gmail.com>
References: <2968dfd60910050801x2ff69524q3d7ac65241c18a2c@mail.gmail.com>
	<676384.920.qm@web53007.mail.re2.yahoo.com>
	<2968dfd60910051110g270c40ccg4b6c011c61f63db3@mail.gmail.com>
Message-ID: <25755920.post@talk.nabble.com>


I beg to disagree with those who say you MUST or even SHOULD use execute
script to create a table with a foreign key to a replicated table.  In the
same way that I can drop or add a key to a replicated table directly on the
slave, I would not expect Slony to care about the new foreign key reference.
Can anyone say what bad things might happen of which I am unaware?


Vivek Khera wrote:
> 
> On Mon, Oct 5, 2009 at 11:07 AM, Melvin Davidson <melvin6925@yahoo.com>
> wrote:
>>>Does that create table command need to be run via EXECUTE SCRIPT in
slony1?
>>
>> Yes. Whenever you create or modify objects, you should always use EXECUTE
>> SCRIPT.
>> Doing so insures that the changes are propagated across all nodes.
> 

-- 
View this message in context: http://www.nabble.com/when-creating-new-table-with-FK-reference-to-existing-replicated-table%2C-do-I-need-to-run-via-EXECUTE-SCRIPT--tp25752443p25755920.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.

From ajs at crankycanuck.ca  Mon Oct  5 12:34:22 2009
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Mon Oct  5 12:34:39 2009
Subject: [Slony1-general] when creating new table with FK reference to
	existing replicated table, do I need to run via EXECUTE SCRIPT?
In-Reply-To: <25755920.post@talk.nabble.com>
References: <2968dfd60910050801x2ff69524q3d7ac65241c18a2c@mail.gmail.com>
	<676384.920.qm@web53007.mail.re2.yahoo.com>
	<2968dfd60910051110g270c40ccg4b6c011c61f63db3@mail.gmail.com>
	<25755920.post@talk.nabble.com>
Message-ID: <20091005193421.GP25543@shinkuro.com>

On Mon, Oct 05, 2009 at 11:48:07AM -0700, Gordon Shannon wrote:
> 
> I beg to disagree with those who say you MUST or even SHOULD use execute
> script to create a table with a foreign key to a replicated table.  In the
> same way that I can drop or add a key to a replicated table directly on the
> slave, I would not expect Slony to care about the new foreign key reference.
> Can anyone say what bad things might happen of which I am unaware?

The problem is that FKs are implemented in Postgres by triggers, and
the trigger will then get created on the replica.  Since it's messing
with the catalogues for an _existing_ table, you might get surprises
(one of the triggers needs to be on the referred-to table.  See V's
original question -- that's the "implicit trigger" he asked about).
This is always the nasty corner with the old catalogue-munging Slony
did.

One thing I'm _not_ sure of (I'm showing how I'm getting out of
practice) is how any of this interacts with the newer trigger types
(and the 2.x Slony required to use them).  It could be that they won't
have trouble; I know that getting around this issue was one of the
main goals of the work, but I stopped working on Postgres before I had
to pay attention to the results.  I probably should have been more
clear that there might be a case where it's no longer needed.

A

-- 
Andrew Sullivan
ajs@crankycanuck.ca
From cbbrowne at ca.afilias.info  Mon Oct  5 15:37:27 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Mon Oct  5 15:38:05 2009
Subject: [Slony1-general] when creating new table with FK reference to
	existing replicated table, do I need to run via EXECUTE SCRIPT?
In-Reply-To: <2968dfd60910051109v76415fbeo9fa0396b74bea994@mail.gmail.com>
	(Vick Khera's message of "Mon, 5 Oct 2009 14:09:32 -0400")
References: <2968dfd60910050801x2ff69524q3d7ac65241c18a2c@mail.gmail.com>
	<20091005151018.GA25543@shinkuro.com>
	<2968dfd60910051109v76415fbeo9fa0396b74bea994@mail.gmail.com>
Message-ID: <87iqet79i0.fsf@dba2.int.libertyrms.com>

Vick Khera <vivek@khera.org> writes:
> On Mon, Oct 5, 2009 at 11:10 AM, Andrew Sullivan <ajs@crankycanuck.ca> wrote:
>> On Mon, Oct 05, 2009 at 11:01:03AM -0400, Vick Khera wrote:
>>>
>>> Does that create table command need to be run via EXECUTE SCRIPT in
>>> slony1?
>>
>> I believe it does,
>>
>>> technically modifies the target table by adding an internal trigger,
>>
>> for exactly this reason.
>>
>
> I'll be revising our internal procedural documentation forthwith.
> Thanks for your response.

In 2.0, I *think* it doesn't matter.

- If the table has no connection to a replicated table, then it
  shouldn't matter at all.

- If the table is a replicated table, then you know you need to add it
  to replication, and the "set add table" process will be rummaging at
  that table on all nodes in pretty predictable ways.

  In any case, you'd not be asking this about a table you're planning
  to replicate :-).

The third possibility...

- The table is not replicated, but has a FK reference to a replicated
  table.

  In this case, creating the table establishes a trigger against the
  replicated table to check references to the new table.

  Two possibilities:

  a) On the origin...

  The trigger needs to fire.  And it will...

  b) On a subscriber...

  The trigger shouldn't fire, because the replicated table isn't
  authoritative here.

  The slon runs in "replica" mode, which suppresses normally-created
  triggers.

I'm pretty sure that it doesn't matter whether or not you run CREATE
TABLE via EXECUTE SCRIPT.  

With Slony-I 2.0, regular triggers aren't modified; they're just
suppressed.  And they're suppressed irrespective of how you run CREATE
TABLE.

Establishing the table via CREATE TABLE feeds into the "hygenic"
matter of whether you're managing schema in a consistent way, but from
a "does the trigger fiddling get handled right?" perspective, it's
fine for you to use EXECUTE SCRIPT or not, at your choice.
-- 
(reverse (concatenate 'string "ofni.sailifa.ac" "@" "enworbbc"))
Christopher Browne
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"
From ajs at crankycanuck.ca  Tue Oct  6 07:26:08 2009
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Tue Oct  6 07:26:18 2009
Subject: [Slony1-general] when creating new table with FK reference to
	existing replicated table, do I need to run via EXECUTE SCRIPT?
In-Reply-To: <87iqet79i0.fsf@dba2.int.libertyrms.com>
References: <2968dfd60910050801x2ff69524q3d7ac65241c18a2c@mail.gmail.com>
	<20091005151018.GA25543@shinkuro.com>
	<2968dfd60910051109v76415fbeo9fa0396b74bea994@mail.gmail.com>
	<87iqet79i0.fsf@dba2.int.libertyrms.com>
Message-ID: <20091006142608.GJ27462@shinkuro.com>

On Mon, Oct 05, 2009 at 06:37:27PM -0400, Christopher Browne wrote:
> 
> In 2.0, I *think* it doesn't matter.

I'm tempted to note that, if even one of the principal developers has
to couch his remark that way, we maybe need some test case proofs one
way or the other.  Vick, care to oblige?

A


-- 
Andrew Sullivan
ajs@crankycanuck.ca
From lawrenceg at globalitcreations.com  Tue Oct  6 03:27:41 2009
From: lawrenceg at globalitcreations.com (Lawrence Giam)
Date: Tue Oct  6 09:49:55 2009
Subject: [Slony1-general] Monitoring Slony
Message-ID: <F42B651E7C095744BA93C7D0D087CCD301D9FDB1@gitc-mail01.globalitcreations.com>

Skipped content of type multipart/alternative-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 4414 bytes
Desc: gitclogo.jpg
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20091006/5755a774/attachment.jpeg
From jason at buberel.org  Tue Oct  6 10:01:18 2009
From: jason at buberel.org (Jason Buberel)
Date: Tue Oct  6 10:01:53 2009
Subject: [Slony1-general] Monitoring Slony
In-Reply-To: <F42B651E7C095744BA93C7D0D087CCD301D9FDB1@gitc-mail01.globalitcreations.com>
References: <F42B651E7C095744BA93C7D0D087CCD301D9FDB1@gitc-mail01.globalitcreations.com>
Message-ID: <381af7b40910061001g10708a67i1618abbe4adbccd6@mail.gmail.com>

Skipped content of type multipart/alternative-------------- next part -----=
---------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 4414 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20091006=
/f33892fe/attachment-0001.jpeg
From jcasanov at systemguards.com.ec  Tue Oct  6 11:21:36 2009
From: jcasanov at systemguards.com.ec (Jaime Casanova)
Date: Tue Oct  6 11:22:08 2009
Subject: [slony1-general] slony with postgres 8.4
Message-ID: <3073cc9b0910061121t595e82f2kb70d88184cbf4630@mail.gmail.com>

Hi,

i guess this is an enough asked question =)

i was trying 2.0.3rc2 and found some bugs some of them fixed already
in cvs but the nastier of them is some tables don't get replicated
(maybe the already fiexed bug about the shouldslonyvacuumtable()
function could be the cause?)

so my questions:
1) what should i look for understanding this issue? besides to try
last cvs code, of course

2) i want to migrate my production server to 8.4, i will have some
problems with 2.0.2?
    about the pg_autovaccum table that doesn't exist anymore what if i
recreate it just for this to work?

-- 
Atentamente,
Jaime Casanova
Soporte y capacitaci?n de PostgreSQL
Asesor?a y desarrollo de sistemas
Guayaquil - Ecuador
Cel. +59387171157
From vivek at khera.org  Tue Oct  6 18:43:30 2009
From: vivek at khera.org (Vick Khera)
Date: Tue Oct  6 18:44:02 2009
Subject: [Slony1-general] when creating new table with FK reference to 
	existing replicated table, do I need to run via EXECUTE SCRIPT?
In-Reply-To: <20091006142608.GJ27462@shinkuro.com>
References: <2968dfd60910050801x2ff69524q3d7ac65241c18a2c@mail.gmail.com>
	<20091005151018.GA25543@shinkuro.com>
	<2968dfd60910051109v76415fbeo9fa0396b74bea994@mail.gmail.com>
	<87iqet79i0.fsf@dba2.int.libertyrms.com>
	<20091006142608.GJ27462@shinkuro.com>
Message-ID: <2968dfd60910061843n79392861p32fe9ee4a8b0ece9@mail.gmail.com>

On Tue, Oct 6, 2009 at 10:26 AM, Andrew Sullivan <ajs@crankycanuck.ca> wrote:
> I'm tempted to note that, if even one of the principal developers has
> to couch his remark that way, we maybe need some test case proofs one
> way or the other. ?Vick, care to oblige?

I'm of the opinion that if the implicit trigger still fires on the
replica it is not a horrible thing.  It just wastes some cycles.  In
my case ultimately the new table was to be added to replication.  I
just wanted to avoid the burden of shutting down things enough that an
EXECUTE SCRIPT could successfully run.  The rate of change on this DB
is very high and I usually end up with some failure unless I disable
sections of the app.
From lawrenceg at globalitcreations.com  Tue Oct  6 20:12:27 2009
From: lawrenceg at globalitcreations.com (Lawrence Giam)
Date: Tue Oct  6 21:29:03 2009
Subject: [Slony1-general] Slony Maintenance guide
Message-ID: <F42B651E7C095744BA93C7D0D087CCD301D9FDB3@gitc-mail01.globalitcreations.com>

Skipped content of type multipart/alternative-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 4414 bytes
Desc: att9D6.jpg
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20091007/e3e1655b/attachment.jpeg
From nagy at ecircle-ag.com  Wed Oct  7 01:20:03 2009
From: nagy at ecircle-ag.com (Csaba Nagy)
Date: Wed Oct  7 01:20:51 2009
Subject: [Slony1-general] when creating new table with FK reference to
	existing replicated table, do I need to run via EXECUTE SCRIPT?
In-Reply-To: <2968dfd60910061843n79392861p32fe9ee4a8b0ece9@mail.gmail.com>
References: <2968dfd60910050801x2ff69524q3d7ac65241c18a2c@mail.gmail.com>
	<20091005151018.GA25543@shinkuro.com>
	<2968dfd60910051109v76415fbeo9fa0396b74bea994@mail.gmail.com>
	<87iqet79i0.fsf@dba2.int.libertyrms.com>
	<20091006142608.GJ27462@shinkuro.com>
	<2968dfd60910061843n79392861p32fe9ee4a8b0ece9@mail.gmail.com>
Message-ID: <1254903603.3372.425.camel@pcd12478>

Hi all,

On Wed, 2009-10-07 at 03:43 +0200, Vick Khera wrote:
> I'm of the opinion that if the implicit trigger still fires on the
> replica it is not a horrible thing.  It just wastes some cycles.  In
> my case ultimately the new table was to be added to replication.  I
> just wanted to avoid the burden of shutting down things enough that an
> EXECUTE SCRIPT could successfully run.  The rate of change on this DB
> is very high and I usually end up with some failure unless I disable
> sections of the app.

Wouldn't it work to run the table creation via EXECUTE SCRIPT only on
the slaves ? I think it is possible to run EXECUTE SCRIPT only on a
selected node, so you would run it directly on the master, and
separately via EXECUTE SCRIPT on the slave(s). I guess a short full
downtime on a slave is acceptable, except of course if you also use the
slaves for select... then maybe it would work to create the table on the
slaves by taking them off-line one by one.

Cheers,
Csaba.


From stuart at stuartbishop.net  Wed Oct  7 02:48:03 2009
From: stuart at stuartbishop.net (Stuart Bishop)
Date: Wed Oct  7 02:49:00 2009
Subject: [Slony1-general] Options for altering tables in one replication
	set with other replication sets live
In-Reply-To: <20091001201458.GM7059@shinkuro.com>
Message-ID: <g0hwcjkr9b5aoqu8qhUYAxe124vaj_firegpg@mail.gmail.com>

T24gRnJpLCBPY3QgMiwgMjAwOSBhdCAzOjE0IEFNLCBBbmRyZXcgU3VsbGl2YW4gPGFqc0BjcmFu
a3ljYW51Y2suY2E+IHdyb3RlOg0KPiBPbiBUaHUsIE9jdCAwMSwgMjAwOSBhdCAwNDoyMDo1MlBN
ICswNzAwLCBzdHVhcnRAc3R1YXJ0YmlzaG9wLm5ldCB3cm90ZToNCj4+DQo+PiBFWEVDVVRFIFND
UklQVCB3YW50cyB0byBsb2NrIGFsbCB0YWJsZXMsIGRlc3BpdGUgbWUgYmVpbmcgYQ0KPj4gY29u
c2VudGluZyBhZHVsdCB3aG8gcHJvbWlzZXMgbm90IHRvIG11Y2sgd2l0aCB0YWJsZXMgb3V0c2lk
ZSBvZiB0aGUNCj4+IHNwZWNpZmllZCBTRVQgSUQgc2V0Lg0KPg0KPiBb4oCmXQ0KPg0KPj4gQXJl
IHRoZXJlIG90aGVyIGFsdGVybmF0aXZlcywgc3VjaCBhcyBhIHZlcnNpb24gb2YgRVhFQ1VURSBT
Q1JJUFQNCj4+IHRoYXQgaGFzIGxlc3MgcGFyYW5vaWQgbG9ja2luZyBiZWhhdmlvcj8NCj4NCj4g
SW4gdGhlIE9sZCBEYXlzIG9mIFNsb255LCBFWEVDVVRFIFNDUklQVCBsb2NrZWQgdGhlIHRhYmxl
cyBpbiB0aGUgc2V0LA0KPiBub3QgYWxsIHRhYmxlcy4gwqBJdCB3YXMgY2hhbmdlZCBiZWNhdXNl
IHRoZXJlIHdhcyBubyB3YXkgdG8gcHJldmVudA0KPiBwZW9wbGUgZnJvbSBpbmZsaWN0aW5nIHNl
bGYtZGFtYWdlLiDCoEkgc3VwcG9zZSB5b3Ugb3VnaHQgdG8gYmUgYWJsZSB0bw0KPiByZS1wYXRj
aCB0aGUgbW9kZXJuIGNvZGUgd2l0aCBzb21ldGhpbmcgbGlrZSB0aGUgb2xkIHZlcnNpb24uDQo+
DQo+IEkgcmVjYWxsIGZlZWxpbmcgc29tZXdoYXQgZXF1aXZvY2FsIGFib3V0IHRoaXMgY2hhbmdl
LCBwcmVjaXNlbHkNCj4gYmVjYXVzZSBpdCB3b3VsZCBmb3Jlc3RhbGwgZXhhY3RseSB0aGUgc29y
dCBvZiB0aGluZyB5b3UgYXJlIG5vdw0KPiB0cnlpbmcgdG8gZG8uDQo+DQo+IEkgc2VlbSB0byBy
ZWNhbGwgZG9pbmcgc29tZXRoaW5nIHNpbWlsYXIgd2l0aCBiYXJlIG1ldGFsIGZ1bmN0aW9ucywN
Cj4gaG93ZXZlciwgc28geW91IG1heSBiZSBhYmxlIHRvIGdldCBhcm91bmQgdGhpcyBqdXN0IGJ5
IG5vdCB1c2luZw0KPiBFWEVDVVRFIFNDUklQVC4NCg0KVGhhbmtzLg0KDQpJIHRoaW5rIEkgd2ls
bCBiZSBhYmxlIHRvIGF2b2lkIHRoZSBwcm9ibGVtIHRoaXMgdGltZSBieSBtb3ZpbmcgdGhlIHNt
YWxsIGhpZ2hseSBhdmFpbGFibGUgc2V0IG1hc3RlciB0byBhIGRlZGljYXRlZCBzZXJ2ZXIgd2hp
Y2ggZG9lcyBub3QgaGF2ZSBhIHJlcGxpY2Egb2YgdGhlIGxhcmdlciByZXBsaWNhdGlvbiBzZXQg
KHRoaXMgd2FzIGhhcHBlbmluZyBhbnl3YXkpLiBUaGUgc2VydmljZXMgdGhhdCBuZWVkIGFjY2Vz
cyBkdXJpbmcgbWFpbnRlbmFuY2Ugd2lsbCBqdXN0IG5lZWQgdG8gdXNlIHRoZSBtYXN0ZXIgb25s
eSAodGhlIHRhYmxlcyBvbiB0aGUgc2xhdmVzIHdpbGwgYmUgbG9ja2VkIC0gdGhleSBuZWVkIHRv
IGV4aXN0IGluIHRoZSBzYW1lIGRhdGFiYXNlcyBhcyB0aGUgbGFyZ2VyIHJlcGxpY2F0aW9uIHNl
dHMgYXMgd2UgbmVlZCB0byBydW4gSk9JTnMgYmV0d2VlbiB0aGVtKS4NCg0KSSBkbyB0aGluayB0
aGF0IHRoaXMgbG9ja2luZyBiZWhhdmlvciBzaG91bGQgYmUgb3B0aW9uYWwgb3IgZXZlbiByZXZl
cnRlZCAtIEkgY2FuIHVuZGVyc3RhbmQgdGhlIGRlc2lyZSB0byBzdG9wIHVzZXJzIHNob290aW5n
IHRoZW1zZWx2ZXMgaW4gdGhlIGZvb3QgYnV0IGluIHRoaXMgY2FzZSBpcyBhbHNvIHJlbW92ZXMg
dXNlZnVsIGZ1bmN0aW9uYWxpdHkgZm9yIGxpdHRsZSBnYWluICh1c2VycyBzdGlsbCBoYXZlIHBs
ZW50eSBvZiBvdGhlciB3YXlzIHRvIHNob290IHRoZW1zZWx2ZXMgaW4gdGhlIGZvb3QsIHN1Y2gg
YXMgdHJ1bmNhdGUsIGRyb3AgdGFibGUsIGV4ZWN1dGluZyBzY3JpcHRzIG9uIGluY29ycmVjdCBu
b2RlcywgZXRjLikuDQoNCkkgZG8gZm9yZXNlZSB0aGlzIGJpdGluZyBtZSBhZ2FpbiBpbiB0aGUg
ZnV0dXJlIGFzIEkgYnJlYWsgbXkgbGFyZ2UgcmVwbGljYXRpb24gc2V0IGludG8gc21hbGxlciBj
aHVua3MgdG8gYWxsb3cgbWUgdG8gcGVyZm9ybSBtYWludGVuYW5jZSBvbiBwYXJ0cyBvZiB0aGUg
c3lzdGVtIHdpdGhvdXQgdGhlIHdob2xlIHN5c3RlbSBuZWVkaW5nIHRvIGdvIGRvd24sIHNvIEkn
bSBzdXJlIEknbGwgYmUgcmV2aXNpdGluZyBhbmQgZGVjaWRlIHRoZW4gaWYgSSBzaG91bGQgZ2V0
IFNsb255LUkgcGF0Y2hlZCBvciByZXdvcmsgbXkgcm9sbG91dCBhbmQgbWFpbnRlbmFuY2UgdG9v
bHMgdG8gbm90IHVzZSBzbG9uaWsuDQoNCi0tIA0KU3R1YXJ0IEJpc2hvcCA8c3R1YXJ0QHN0dWFy
dGJpc2hvcC5uZXQ+DQpodHRwOi8vd3d3LnN0dWFydGJpc2hvcC5uZXQvDQoNCi0tLS0tLS0tLS0t
LS0tIG5leHQgcGFydCAtLS0tLS0tLS0tLS0tLQpBIG5vbi10ZXh0IGF0dGFjaG1lbnQgd2FzIHNj
cnViYmVkLi4uCk5hbWU6IHNpZ25hdHVyZS5hc2MKVHlwZTogYXBwbGljYXRpb24vcGdwLXNpZ25h
dHVyZQpTaXplOiAyNjIgYnl0ZXMKRGVzYzogT3BlblBHUCBkaWdpdGFsIHNpZ25hdHVyZQpVcmwg
OiBodHRwOi8vbGlzdHMuc2xvbnkuaW5mby9waXBlcm1haWwvc2xvbnkxLWdlbmVyYWwvYXR0YWNo
bWVudHMvMjAwOTEwMDcvNzZhMDYzNDMvc2lnbmF0dXJlLnBncAo=
From rocrash at gmx.de  Wed Oct  7 03:21:01 2009
From: rocrash at gmx.de (Robert Doerfler)
Date: Wed Oct  7 03:25:55 2009
Subject: [Slony1-general] Slony1-2.0.3-rc2 + PostgreSQL8.4
Message-ID: <hahq2d$j6g$1@ger.gmane.org>

Hi,

i upgraded to PostgreSQL 8.4, re-compiled slony and when i'm running my 
init script i'll get the following error message:


postgres@con2:/home/testuser/scripte$ ./init.sh 
./init.sh:9: PGRES_FATAL_ERROR load '$libdir/slony1_funcs';  - ERROR:  
could not load library "/opt/PostgreSQL/8.4/lib/postgresql/
slony1_funcs.so": /opt/PostgreSQL/8.4/lib/postgresql/slony1_funcs.so: 
undefined symbol: SerializableSnapshot
./init.sh:9: Error: the extension for the Slony-I C functions cannot be 
loaded in database 'dbname=db host=con2 user=postgres

Does someone knows how to fix this?


-- 
Greetings,

Robert

From ajs at crankycanuck.ca  Wed Oct  7 08:36:10 2009
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Wed Oct  7 08:36:42 2009
Subject: [Slony1-general] Slony Maintenance guide
In-Reply-To: <F42B651E7C095744BA93C7D0D087CCD301D9FDB3@gitc-mail01.globalitcreations.com>
References: <F42B651E7C095744BA93C7D0D087CCD301D9FDB3@gitc-mail01.globalitcreations.com>
Message-ID: <20091007153608.GA31210@shinkuro.com>

On Wed, Oct 07, 2009 at 11:12:27AM +0800, Lawrence Giam wrote:
> Hi All,
>  
> I was reading in the Slony 1.2.16 documentation on maintenance section
> 6.1 - Interaction with PostgreSQL autovacuum. In the documentation,
> there is this query which was recommended to execute in order to exclude
> some slony tables from being run by the Postgres autovacuum features. I
> am running Postgres 8.1.7 on Debian Etch.

I completely forget how the autovacuum tables on 8.1.x work, but I
think you want to have a careful look at its documentation.
Autovacuum in 8.1 was, IIRC, significantly different from later
versions and ISTR that it was the wrong choice for certain kinds of
workloads.  The change you need is _something_ like what you're
suggesting, but I wouldn't recommend it without a fairly clear
understanding of the autovacuum issues in 8.1.

(On another note, one of the problems with the Debian release model is
that it inevitably results in very old major Postgres releases.  I'd
counsel looking into a backport, because Postgres has advanced a lot
past 8.1, if you ask me.)

A



-- 
Andrew Sullivan
ajs@crankycanuck.ca
From lawrenceg at globalitcreations.com  Wed Oct  7 01:46:55 2009
From: lawrenceg at globalitcreations.com (Lawrence Giam)
Date: Wed Oct  7 09:59:36 2009
Subject: [Slony1-general] Slon daemon config file
Message-ID: <F42B651E7C095744BA93C7D0D087CCD301D9FDBA@gitc-mail01.globalitcreations.com>

Skipped content of type multipart/alternative-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 4414 bytes
Desc: gitclogo.jpg
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20091007/0a154ec2/attachment.jpeg
From vivek at khera.org  Thu Oct  8 07:39:56 2009
From: vivek at khera.org (Vick Khera)
Date: Thu Oct  8 07:40:04 2009
Subject: [Slony1-general] Slony1-2.0.3-rc2 + PostgreSQL8.4
In-Reply-To: <hahq2d$j6g$1@ger.gmane.org>
References: <hahq2d$j6g$1@ger.gmane.org>
Message-ID: <2968dfd60910080739i70834218ka589fd2356c78d9c@mail.gmail.com>

I believe you have to use slony 2.0 from CVS checkout, as this fix is
not in any released version.


On Wed, Oct 7, 2009 at 6:21 AM, Robert Doerfler <rocrash@gmx.de> wrote:
> Does someone knows how to fix this?
>
From lawrenceg at globalitcreations.com  Wed Oct  7 21:40:44 2009
From: lawrenceg at globalitcreations.com (Lawrence Giam)
Date: Thu Oct  8 08:11:46 2009
Subject: [Slony1-general] Slony Maintenance guide
Message-ID: <F42B651E7C095744BA93C7D0D087CCD301D9FDC0@gitc-mail01.globalitcreations.com>

Hi All,

Doing a further search on the FREEZE keyword, I found this post
http://www.nabble.com/Where-art-thou-pg_clog--td8993364.html where it
mention PostgreSQL 8.1.7 fixed the VACUUM FREEZE bug.

I just happens to have PostgreSQL 8.1.15 and 8.1.17 installed and I
checked in the pg_catalog.pg_autovacuum table, it seem that the 2 table
item - freeze_min_age and freeze_max_age is not found in both table.

If this is the case, I suggest that the Slony documentation guide be
revised to point this fact out and also to update the respective SQL
query command in the documentation.

Regards,
Lawrence Giam
........................................................................
..........................
Lawrence Giam | Global IT Creations Pte Ltd |  Network Administrator  
website: http://www.globalitcreations.com
phone: +65 6836 4768 ext 115| fax: + 65 6836 4736 | mobile: + 65 9758
7448 



-----Original Message-----
From: slony1-general-bounces@lists.slony.info
[mailto:slony1-general-bounces@lists.slony.info] On Behalf Of Andrew
Sullivan
Sent: Wednesday, 7 October 2009 11:36 PM
To: slony1-general@lists.slony.info
Subject: Re: [Slony1-general] Slony Maintenance guide


On Wed, Oct 07, 2009 at 11:12:27AM +0800, Lawrence Giam wrote:
> Hi All,
>  
> I was reading in the Slony 1.2.16 documentation on maintenance section

> 6.1 - Interaction with PostgreSQL autovacuum. In the documentation, 
> there is this query which was recommended to execute in order to 
> exclude some slony tables from being run by the Postgres autovacuum 
> features. I am running Postgres 8.1.7 on Debian Etch.

I completely forget how the autovacuum tables on 8.1.x work, but I think
you want to have a careful look at its documentation. Autovacuum in 8.1
was, IIRC, significantly different from later versions and ISTR that it
was the wrong choice for certain kinds of workloads.  The change you
need is _something_ like what you're suggesting, but I wouldn't
recommend it without a fairly clear understanding of the autovacuum
issues in 8.1.

(On another note, one of the problems with the Debian release model is
that it inevitably results in very old major Postgres releases.  I'd
counsel looking into a backport, because Postgres has advanced a lot
past 8.1, if you ask me.)

A



-- 
Andrew Sullivan
ajs@crankycanuck.ca _______________________________________________
Slony1-general mailing list
Slony1-general@lists.slony.info
http://lists.slony.info/mailman/listinfo/slony1-general
From bnichols at ca.afilias.info  Thu Oct  8 10:02:56 2009
From: bnichols at ca.afilias.info (Brad Nicholson)
Date: Thu Oct  8 10:03:10 2009
Subject: [Slony1-general] Slony Maintenance guide
In-Reply-To: <F42B651E7C095744BA93C7D0D087CCD301D9FDC0@gitc-mail01.globalitcreations.com>
References: <F42B651E7C095744BA93C7D0D087CCD301D9FDC0@gitc-mail01.globalitcreations.com>
Message-ID: <1255021376.11743.79.camel@bnicholson-desktop>

On Thu, 2009-10-08 at 12:40 +0800, Lawrence Giam wrote:
> Hi All,
> 
> Doing a further search on the FREEZE keyword, I found this post
> http://www.nabble.com/Where-art-thou-pg_clog--td8993364.html where it
> mention PostgreSQL 8.1.7 fixed the VACUUM FREEZE bug.
> 
> I just happens to have PostgreSQL 8.1.15 and 8.1.17 installed and I
> checked in the pg_catalog.pg_autovacuum table, it seem that the 2 table
> item - freeze_min_age and freeze_max_age is not found in both table.

The columns you mention were added in PG 8.2

-- 
Brad Nicholson  416-673-4106
Database Administrator, Afilias Canada Corp.


From brianf at consistentstate.com  Fri Oct  9 15:02:11 2009
From: brianf at consistentstate.com (Brian Fehrle)
Date: Fri Oct  9 15:02:46 2009
Subject: [Slony1-general] Postgres 8.4.1 support?
Message-ID: <4ACFB2E3.9040302@consistentstate.com>

Hello everyone,

    I'm currently setting up some servers for testing purposes with 
Postgresql and Slony. My original setup was Postgres 8.3.8 and Slony 
1.2.16 and it worked fine, however I need to begin migrating things over 
to Postgres 8.4. Upgrading to Postgres 8.4.1 prompted several types of 
errors with the different Slony versions:

Slony 1.2.16 did not work

Slony 1.2.17-rc workded but gave me the error:
Possible unsupported PostgreSQL version (80401) 8.4, defaulting to 8.1 
support

Slony 2.0.2-rc gave me this error
Possible unsupported PostgreSQL version (80401) 8.4, defaulting to 8.3 
support

My question is, what is the current status of Slony and Postgres 8.4.x 
support? Supported but not stable? Stable and I'm just using the wrong 
version? Or not recommended at this time? My own tests showed that Slony 
1.2.17-rc worked, however getting errors is not ideal at all. I'd hate 
to run into some major problems down the road if I stick with that 
installation.

I'm going to try out Slony 2.0.3RC and see how it looks, but using an RC 
makes me a bit uneasy.

Thanks,
     Brian F.
From jcasanov at systemguards.com.ec  Fri Oct  9 15:41:13 2009
From: jcasanov at systemguards.com.ec (Jaime Casanova)
Date: Fri Oct  9 15:43:31 2009
Subject: [slony1-general] slony with postgres 8.4
In-Reply-To: <3073cc9b0910061121t595e82f2kb70d88184cbf4630@mail.gmail.com>
References: <3073cc9b0910061121t595e82f2kb70d88184cbf4630@mail.gmail.com>
Message-ID: <3073cc9b0910091541kbb98fads502d514d91108bf0@mail.gmail.com>

On Tue, Oct 6, 2009 at 1:21 PM, Jaime Casanova
<jcasanov@systemguards.com.ec> wrote:
>
> so my questions:
> 1) what should i look for understanding this issue? besides to try
> last cvs code, of course
>

i tried to download latest cvs but i get 2.0.2, is there a way to
obtain latest 2.0.3?

-- 
Atentamente,
Jaime Casanova
Soporte y capacitaci?n de PostgreSQL
Asesor?a y desarrollo de sistemas
Guayaquil - Ecuador
Cel. +59387171157
From jcasanov at systemguards.com.ec  Sat Oct 10 12:32:23 2009
From: jcasanov at systemguards.com.ec (Jaime Casanova)
Date: Sat Oct 10 12:32:51 2009
Subject: [slony1-general] slony with postgres 8.4
In-Reply-To: <3073cc9b0910061121t595e82f2kb70d88184cbf4630@mail.gmail.com>
References: <3073cc9b0910061121t595e82f2kb70d88184cbf4630@mail.gmail.com>
Message-ID: <3073cc9b0910101232h759819bm126e7bae56011e84@mail.gmail.com>

On Tue, Oct 6, 2009 at 1:21 PM, Jaime Casanova
<jcasanov@systemguards.com.ec> wrote:
> Hi,
>
> i guess this is an enough asked question =)
>
> i was trying 2.0.3rc2 and found some bugs some of them fixed already
> in cvs but the nastier of them is some tables don't get replicated
> (maybe the already fiexed bug about the shouldslonyvacuumtable()
> function could be the cause?)
>

when trying current cvs i get this same error (some tables doesn't
replicate) and there are the *same* tables that last time... the log
from slony tell they were replicated, somebody has an idea of where to
look?

-- 
Atentamente,
Jaime Casanova
Soporte y capacitaci?n de PostgreSQL
Asesor?a y desarrollo de sistemas
Guayaquil - Ecuador
Cel. +59387171157
From kleptog at gmail.com  Sat Oct 10 14:28:04 2009
From: kleptog at gmail.com (Martijn van Oosterhout)
Date: Sat Oct 10 14:28:20 2009
Subject: [Slony1-general] Slon daemon config file
In-Reply-To: <F42B651E7C095744BA93C7D0D087CCD301D9FDBA@gitc-mail01.globalitcreations.com>
References: <AcpHKreWL00z/AN7RWKgTT6EqOc4Aw==>
	<F42B651E7C095744BA93C7D0D087CCD301D9FDBA@gitc-mail01.globalitcreations.com>
Message-ID: <2fc2c5f10910101428p7cd5d75eg3fd3bbe8ec86b7fc@mail.gmail.com>

On Wed, Oct 7, 2009 at 10:46 AM, Lawrence Giam <
lawrenceg@globalitcreations.com> wrote:

>  Hi All,
>
> I have been reading through Slony 1.2.16 documentation and doing a number
> of experiments on trying to understand the slon daemon and slon_watchdog.=
 In
> the documentation, it mentions a few ways to start the slon daemon.
>
>
I see you did not receive a reply. I'm just going to comment with my
experiences. While I saw all the ways to start and manage the slon daemon,
in the end I opted to just run it under daemontools, which replaces the
watchdog function. Also, since I opted to always run the slon daemon on the
same machine as the database it was managing I could do away with the
slon_tools.conf on any machine other than the master. The host is always
localhost, the user always slony, the database was fixed for my case.
daemontools also handles all the logging and such. The slon daemon has a
config file, but it can be the same on every machine.

This is slony 2.0 however, maybe older versions work differently.

1. Is there a common config file for the slon daemon to be started and
> stopped?
>

The slon daemon does indeed have its own config file, but it contains no
information about the configuration of the cluster. It reads that from the
database directly.


> 2. Can I customize the config file slon_tools.conf with the options for t=
he
> slon daemon? If yes, any sample config to follow or I can take the options
> generated by mkslonconf.sh and use it in the slon_tools.conf?
>

No, slon options should be in the slon config file.


> 3. How can I intregrate the slon daemon script for use in /etc/init.d with
> start/stop function?
> 4. Is the procedure for killing the slon daemon the correct way to do
> thing?
> 5. If the slon daemon is started by the launch_clusters.sh script, is
> killing the proccess the only way to do it?
> 6. Can the start_slon.sh script be usable for Slony 1.2.16?
>

These I can't help you with.


> 7. When the slon daemon is stopped, will it be reflected in the postgres
> cluster database? Which table can I see the info?
>

Well, it's will be reflected by the fact that the replication stops working.
So sl_status with show the node as lagging. I have anagios check monitoring
the table and it's very goog at spotting when things are going wrong.

Hope this helps,
-- =

Martijn van Oosterhout <kleptog@gmail.com> http://svana.org/kleptog/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20091010/=
eb7045e3/attachment.htm
From filip.rembialkowski at gmail.com  Mon Oct 12 04:40:55 2009
From: filip.rembialkowski at gmail.com (=?UTF-8?Q?Filip_Rembia=C5=82kowski?=)
Date: Mon Oct 12 04:41:35 2009
Subject: [Slony1-general] encoding problem
Message-ID: <92869e660910120440v70f51242kf32eb18498ce511b@mail.gmail.com>

SGksCgpQb3N0Z3JlU1FMIDguNCwgU2xvbnktSSAyLjAuMy1yYzIKCkknbSB0cnlpbmcgdG8gc2V0
dXAgcmVwbGljYXRpb24uCk9uIHNvdXJjZSAob3JpZ2luKSBwb3N0Z3JlcyBzZXJ2ZXIsIEkgZ2V0
IHRoaXMgZXJyb3I6CgpMT0c6ICBkdXJhdGlvbjogMy4wOTEgbXMgIHN0YXRlbWVudDogc2VsZWN0
ICJfcmVwbGljYXRpb24iLmNvcHlGaWVsZHMoMSk7CkVSUk9SOiAgY2hhcmFjdGVyIDB4ODI5YyBv
ZiBlbmNvZGluZyAiTVVMRV9JTlRFUk5BTCIgaGFzIG5vIGVxdWl2YWxlbnQgaW4KIldJTjEyNTAi
ClNUQVRFTUVOVDogIGNvcHkgInB1YmxpYyIuInVzbHVnaSIgKDxGSUVMRFMgTElTVD4pIHRvIHN0
ZG91dDsKCkkgaGF2ZSBubyBpZGVhIHdoeSAiV0lOMTI1MCIgY29tZXMgaW50byBzdGFnZTsgIGJv
dGggZGF0YWJhc2VzIGFyZSBVVEYtOC4KCgpXaGF0IGNhbiBJIGRvIHRvIGZpeCB0aGlzPwoKCkhl
bHAgYXBwcmVjaWF0ZWQuCgpQUy4gSSdtIGFsbW9zdCBzdXJlIGl0IHdhcyBkaXNjdXNzZWQgaGVy
ZSwgb3Igb25lIG9mIFBnIGxpc3RzLCBidXQgSSBjYW4ndApmaW5kIGl0LiBTb3JyeS4KCgoKCi0t
IApGaWxpcCBSZW1iaWHFgmtvd3NraQpKSUQsbWFpbHRvOmZpbGlwLnJlbWJpYWxrb3dza2lAZ21h
aWwuY29tCmh0dHA6Ly9maWxpcC5yZW1iaWFsa293c2tpLm5ldC8KLS0tLS0tLS0tLS0tLS0gbmV4
dCBwYXJ0IC0tLS0tLS0tLS0tLS0tCkFuIEhUTUwgYXR0YWNobWVudCB3YXMgc2NydWJiZWQuLi4K
VVJMOiBodHRwOi8vbGlzdHMuc2xvbnkuaW5mby9waXBlcm1haWwvc2xvbnkxLWdlbmVyYWwvYXR0
YWNobWVudHMvMjAwOTEwMTIvOTNhYjM4MTYvYXR0YWNobWVudC5odG0K
From lawrenceg at globalitcreations.com  Mon Oct 12 00:56:28 2009
From: lawrenceg at globalitcreations.com (Lawrence Giam)
Date: Mon Oct 12 08:17:45 2009
Subject: [Slony1-general] PostgreSQL upgrade and Slony
Message-ID: <F42B651E7C095744BA93C7D0D087CCD301D9FDD1@gitc-mail01.globalitcreations.com>

Skipped content of type multipart/alternative-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 4414 bytes
Desc: gitclogo.jpg
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20091012/eab39ff7/attachment.jpeg
From devrim at gunduz.org  Mon Oct 12 08:22:32 2009
From: devrim at gunduz.org (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Mon Oct 12 08:24:02 2009
Subject: [Slony1-general] PostgreSQL upgrade and Slony
In-Reply-To: <F42B651E7C095744BA93C7D0D087CCD301D9FDD1@gitc-mail01.globalitcreations.com>
References: <F42B651E7C095744BA93C7D0D087CCD301D9FDD1@gitc-mail01.globalitcreations.com>
Message-ID: <1255360952.12885.0.camel@hp-laptop2.gunduz.org>

T24gTW9uLCAyMDA5LTEwLTEyIGF0IDE1OjU2ICswODAwLCBMYXdyZW5jZSBHaWFtIHdyb3RlOgo+
IDEuIFN1cHBvc2UgSSB3YW50IHRvIHVwZ3JhZGUgUG9zdGdyZVNRTCB0byA4LjEuMTgsIGRvIEkg
bmVlZCB0bwo+IHJlLWJ1aWxkIFNsb255IHdpdGggdGhlIFBvc3RncmVTUUwgOC4xLjE4IHNvdXJj
ZSA/CgpOby4KCj4gMi4gU3VwcG9zZSBJIHVwZ3JhZGVkIFBvc3RncmVTUUwgdG8gOC4xLjE4IGFu
ZCBmb3VuZCB0aGVyZSBhcmUgc29tZQo+IHByb2JsZW0sIGlzIGl0IHBvc3NpYmxlIHRvIGRvd25n
cmFkZSBpdCBiYWNrIHRvIDguMS4xNyB3aXRob3V0IGFueQo+IHByb2JsZW0gd2l0aCBTbG9ueSBv
ciBkbyBJIGhhdmUgdG8gcmVidWlsZCBTbG9ueSBhZ2Fpbj8KCllvdSBkb24ndCBoYXZlIHRvIHJl
YnVpbGQgU2xvbnkgYWdhaW4uCgpSZWdhcmRzLCAKLS0gCkRldnJpbSBHw5xORMOcWiwgUkhDRQpD
b21tYW5kIFByb21wdCAtIGh0dHA6Ly93d3cuQ29tbWFuZFByb21wdC5jb20gCmRldnJpbX5ndW5k
dXoub3JnLCBkZXZyaW1+UG9zdGdyZVNRTC5vcmcsIGRldnJpbS5ndW5kdXp+bGludXgub3JnLnRy
Cmh0dHA6Ly93d3cuZ3VuZHV6Lm9yZyAgVHdpdHRlcjogaHR0cDovL3R3aXR0ZXIuY29tL2RldnJp
bWd1bmR1egotLS0tLS0tLS0tLS0tLSBuZXh0IHBhcnQgLS0tLS0tLS0tLS0tLS0KQSBub24tdGV4
dCBhdHRhY2htZW50IHdhcyBzY3J1YmJlZC4uLgpOYW1lOiBub3QgYXZhaWxhYmxlClR5cGU6IGFw
cGxpY2F0aW9uL3BncC1zaWduYXR1cmUKU2l6ZTogMTk3IGJ5dGVzCkRlc2M6IFRoaXMgaXMgYSBk
aWdpdGFsbHkgc2lnbmVkIG1lc3NhZ2UgcGFydApVcmwgOiBodHRwOi8vbGlzdHMuc2xvbnkuaW5m
by9waXBlcm1haWwvc2xvbnkxLWdlbmVyYWwvYXR0YWNobWVudHMvMjAwOTEwMTIvYjY1MDExODIv
YXR0YWNobWVudC5wZ3AK
From ajs at crankycanuck.ca  Tue Oct 13 06:05:24 2009
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Tue Oct 13 06:05:42 2009
Subject: [Slony1-general] Postgres 8.4.1 support?
In-Reply-To: <4ACFB2E3.9040302@consistentstate.com>
References: <4ACFB2E3.9040302@consistentstate.com>
Message-ID: <20091013130524.GA94878@shinkuro.com>

On Fri, Oct 09, 2009 at 04:02:11PM -0600, Brian Fehrle wrote:
> I'm going to try out Slony 2.0.3RC and see how it looks, but using an RC  
> makes me a bit uneasy.

>From the slony.info sidebar:

Version slony1-2.0.3-rc.tar.bz2 has been made available.
Changes since 2.0.2 are as follows:
PostgreSQL 8.4 has been released; slonik needs to explicitly recognize it

A

-- 
Andrew Sullivan
ajs@crankycanuck.ca
From ajs at crankycanuck.ca  Tue Oct 13 06:12:01 2009
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Tue Oct 13 06:12:07 2009
Subject: [Slony1-general] encoding problem
In-Reply-To: <92869e660910120440v70f51242kf32eb18498ce511b@mail.gmail.com>
References: <92869e660910120440v70f51242kf32eb18498ce511b@mail.gmail.com>
Message-ID: <20091013131200.GB94878@shinkuro.com>

On Mon, Oct 12, 2009 at 01:40:55PM +0200, Filip Rembia?kowski wrote:

> LOG:  duration: 3.091 ms  statement: select "_replication".copyFields(1);
> ERROR:  character 0x829c of encoding "MULE_INTERNAL" has no equivalent in
> "WIN1250"
> STATEMENT:  copy "public"."uslugi" (<FIELDS LIST>) to stdout;
> 
> I have no idea why "WIN1250" comes into stage;  both databases are UTF-8.

It may be the client encoding.  What locale are the slon daemons running under?

A


-- 
Andrew Sullivan
ajs@crankycanuck.ca
From vivek at khera.org  Tue Oct 13 07:23:38 2009
From: vivek at khera.org (Vick Khera)
Date: Tue Oct 13 07:23:44 2009
Subject: [Slony1-general] PostgreSQL upgrade and Slony
In-Reply-To: <F42B651E7C095744BA93C7D0D087CCD301D9FDD1@gitc-mail01.globalitcreations.com>
References: <F42B651E7C095744BA93C7D0D087CCD301D9FDD1@gitc-mail01.globalitcreations.com>
Message-ID: <2968dfd60910130723q4592662emfdd79a8b4966e3ee@mail.gmail.com>

On Mon, Oct 12, 2009 at 3:56 AM, Lawrence Giam
<lawrenceg@globalitcreations.com> wrote:
>
> I have some questions regarding upgrading/downgrading of PostgreSQL version with regards to Slony-1. I currently have PostgreSQL 8.1.17 and Slony-1 1.2.16 installed.
> 1. Suppose I want to upgrade PostgreSQL to 8.1.18, do I need to re-build Slony with the PostgreSQL 8.1.18 source??
> 2. Suppose I upgraded PostgreSQL to 8.1.18 and found there are some problem, is it possible to downgrade it back to 8.1.17 without any problem with Slony or do I have to rebuild Slony again?

0) no need for HTML attachments of your company logo on the mailing
list. ?It really doesn't help solve your problem in any way, and just
wastes everyone's resources. ?in fact, plain text mail is even better.
1) you should not need to. ?the API/ABI in postgres doesn't change in
minor release numbers.
2) should not be a problem. ?see 1 above.
From jcasanov at systemguards.com.ec  Tue Oct 13 09:42:50 2009
From: jcasanov at systemguards.com.ec (Jaime Casanova)
Date: Tue Oct 13 09:43:17 2009
Subject: [slony1-general] initial copy incomplete when using 2.0.3rc2
Message-ID: <3073cc9b0910130942l98cebcfkc0c98fa33daa4db8@mail.gmail.com>

Hi,

As i reported here
http://lists.slony.info/pipermail/slony1-general/2009-October/010076.html
when using 2.0.3rc2 i have some tables not replicating...
actually what happens is that those tables doesn't get copied in the
initial copy... i can workaround it by dropping the table from the
set, readding it to a new set and then merge...

the only real problem i have found, once updated to current cvs, is
that one... any ideas about where to look?

-- 
Atentamente,
Jaime Casanova
Soporte y capacitaci?n de PostgreSQL
Asesor?a y desarrollo de sistemas
Guayaquil - Ecuador
Cel. +59387171157
From jks at selectacast.net  Tue Oct 13 17:59:40 2009
From: jks at selectacast.net (Joseph S)
Date: Tue Oct 13 18:00:06 2009
Subject: [Slony1-general] What it slony doing here?
Message-ID: <4AD5227C.4040702@selectacast.net>

I notice there are frequent big gaps in time between  
"remoteHelperThread_1_1: allocate line buffers" "remoteWorkerThread_1: 
returning lines to pool". What is going on during this time?

2009-10-13 20:55:34 EDT DEBUG4 remoteWorkerThread_1: returning lines to pool
2009-10-13 20:55:34 EDT DEBUG4 remoteHelperThread_1_1: fetch from cursor
2009-10-13 20:55:34 EDT DEBUG4 remoteHelperThread_1_1: fetched 100 log rows
2009-10-13 20:55:34 EDT DEBUG4 remoteHelperThread_1_1: deliver 10 lines 
to worker
2009-10-13 20:55:34 EDT DEBUG4 remoteHelperThread_1_1: allocate line buffers
2009-10-13 20:55:37 EDT DEBUG4 remoteWorkerThread_1: returning lines to pool
2009-10-13 20:55:37 EDT DEBUG4 remoteHelperThread_1_1: fetch from cursor
2009-10-13 20:55:37 EDT DEBUG4 remoteHelperThread_1_1: fetched 100 log rows
2009-10-13 20:55:37 EDT DEBUG4 remoteHelperThread_1_1: deliver 10 lines 
to worker
2009-10-13 20:55:37 EDT DEBUG4 remoteHelperThread_1_1: allocate line buffers
2009-10-13 20:55:37 EDT DEBUG4 remoteHelperThread_1_1: fetch from cursor
2009-10-13 20:55:37 EDT DEBUG4 remoteHelperThread_1_1: fetched 100 log rows
2009-10-13 20:55:37 EDT DEBUG4 remoteHelperThread_1_1: deliver 10 lines 
to worker
2009-10-13 20:55:37 EDT DEBUG4 remoteHelperThread_1_1: allocate line buffers
2009-10-13 20:55:37 EDT DEBUG4 remoteHelperThread_1_1: fetch from cursor
2009-10-13 20:55:37 EDT DEBUG4 remoteHelperThread_1_1: fetched 100 log rows
2009-10-13 20:55:37 EDT DEBUG4 remoteHelperThread_1_1: deliver 10 lines 
to worker
2009-10-13 20:55:37 EDT DEBUG4 remoteHelperThread_1_1: allocate line buffers
2009-10-13 20:55:37 EDT DEBUG4 remoteHelperThread_1_1: fetch from cursor
2009-10-13 20:55:37 EDT DEBUG4 remoteHelperThread_1_1: fetched 100 log rows
2009-10-13 20:55:37 EDT DEBUG4 remoteHelperThread_1_1: deliver 10 lines 
to worker
2009-10-13 20:55:37 EDT DEBUG4 remoteHelperThread_1_1: allocate line buffers
2009-10-13 20:55:38 EDT DEBUG4 remoteWorkerThread_1: returning lines to pool
2009-10-13 20:55:38 EDT DEBUG4 remoteHelperThread_1_1: fetch from cursor
2009-10-13 20:55:38 EDT DEBUG4 remoteHelperThread_1_1: fetched 100 log rows
2009-10-13 20:55:38 EDT DEBUG4 remoteHelperThread_1_1: deliver 10 lines 
to worker
2009-10-13 20:55:38 EDT DEBUG4 remoteHelperThread_1_1: allocate line buffers
2009-10-13 20:55:47 EDT DEBUG4 remoteWorkerThread_1: returning lines to pool
2009-10-13 20:55:47 EDT DEBUG4 remoteHelperThread_1_1: fetch from cursor
2009-10-13 20:55:47 EDT DEBUG4 remoteHelperThread_1_1: fetched 100 log rows
2009-10-13 20:55:47 EDT DEBUG4 remoteHelperThread_1_1: deliver 10 lines 
to worker
2009-10-13 20:55:47 EDT DEBUG4 remoteHelperThread_1_1: allocate line buffers
2009-10-13 20:55:47 EDT DEBUG4 remoteHelperThread_1_1: fetch from cursor
2009-10-13 20:55:47 EDT DEBUG4 remoteHelperThread_1_1: fetched 100 log rows
2009-10-13 20:55:47 EDT DEBUG4 remoteHelperThread_1_1: deliver 10 lines 
to worker
2009-10-13 20:55:47 EDT DEBUG4 remoteHelperThread_1_1: allocate line buffers
2009-10-13 20:55:47 EDT DEBUG4 remoteHelperThread_1_1: fetch from cursor


From vivek at khera.org  Wed Oct 14 07:11:56 2009
From: vivek at khera.org (Vick Khera)
Date: Wed Oct 14 07:12:01 2009
Subject: [Slony1-general] What it slony doing here?
In-Reply-To: <4AD5227C.4040702@selectacast.net>
References: <4AD5227C.4040702@selectacast.net>
Message-ID: <2968dfd60910140711x4062eb49qe6137181febfef76@mail.gmail.com>

On Tue, Oct 13, 2009 at 8:59 PM, Joseph S <jks@selectacast.net> wrote:
> I notice there are frequent big gaps in time between
> ?"remoteHelperThread_1_1: allocate line buffers" "remoteWorkerThread_1:
> returning lines to pool". What is going on during this time?
>

I'm fairly sure that is the time during which the changes from those
change-log lines are being applied to the replica.
From mdibango at hotmail.com  Wed Oct 14 07:42:44 2009
From: mdibango at hotmail.com (Emmanuel --)
Date: Wed Oct 14 07:42:51 2009
Subject: [Slony1-general] ERROR cannot get sl_local_no_id - Simple test of
	Slony
Message-ID: <SNT105-W4DB66633F89AF349411A2CAC60@phx.gbl>


Hi,

I'm a newbee in slony replication. I'm trying to install a client1-client2 =
replication test on windows vista (sorry...) and Postgres 8.3

First I create the Slony-I windows service. It appears in the service list.=
 Then I start it.
Then I launch the cluster creation (cluster-setup.sh script)  with Cygwin t=
ool
Finaly I launch the slon deamons with launch.sh

Resulting the launch.sh I got the following 6 lines :
>>> CONFIG main: slon version 1.2.15 starting up
>>> ERROR cannot get sl_local_no_id - Error: schema "_clustertest" does not=
 exist
>>> FATAL main: Node is not initialized properly - sleep 10s
>>> CONFIG main: slon version 1.2.15 starting up
>>> ERROR cannot get sl_local_no_id - Error: schema "_clustertest" does not=
 exist
>>> FATAL main: Node is not initialized properly - sleep 10s

Fact : I can see _clustertest schema in both database.

Questions :
- one of my script is wrong ?
- did i miss on step on windows postgresql configuration ?
- the pgpass.conf file ( stored at ..../postresql/8.3/pgpass.conf ) on wind=
ows have to be declared somewhere in a postgre configuration file ?

------------ cluster-setup.sh --------
#!/bin/sh
CLUSTER=3Dclustertest
DB1=3Dslony-client1
DB2=3Dslony-client2
H=3Dlocalhost
U=3Dpostgres
slonik <<_EOF_
cluster name =3D $CLUSTER;
node 1 admin conninfo =3D 'dbname=3D$DB1 host=3D$H user=3D$U';
node 2 admin conninfo =3D 'dbname=3D$DB2 host=3D$H user=3D$U';
init cluster (id =3D 1, comment =3D 'Node 1');
create set (id =3D 1, origin =3D 1,comment =3D 'contact table');
set add table (set id =3D 1, origin =3D 1, id =3D 1,full qualified name =3D=
 'public.contact',comment =3D 'Table contact');
set add sequence (set id =3D 1, origin =3D 1, id =3D 2,full qualified name =
=3D 'public.contact_id_seq',comment =3D 'Sequence contact_id_seq');
store node (id =3D 2, comment =3D 'Node 2');
store path (server =3D 1, client =3D 2,conninfo =3D 'dbname=3D$DB1 host=3D$=
H user=3D$U');
store path (server =3D 2, client =3D 1,conninfo =3D 'dbname=3D$DB2 host=3D$=
H user=3D$U');
store listen (origin =3D 1, receiver =3D 2);
store listen (origin =3D 2, receiver =3D 1);
subscribe set (id =3D 1, provider =3D 1, receiver =3D 2, forward =3D yes);

------------- launch.sh ---------

#!/bin/sh
CLUSTER=3Dclustertest
DB1=3Dslony-client1
DB2=3Dslony-client2
H=3Dlocalhost
U=3Dpostgres
slon $CLUSTER "dbname=3D$DB1 user=3D$U host=3D$H"
slon $CLUSTER "dbname=3D$DB2 user=3D$U host=3D$H"

-------------- contact table ----------

CREATE TABLE contact
(
  id bigserial NOT NULL,
  "name" character varying(200),
  CONSTRAINT pk_user PRIMARY KEY (id)
)
WITH (OIDS=3DFALSE);
ALTER TABLE contact OWNER TO postgres;

-------------- pgpass.conf ---------------
127.0.0.1:5432:slony-client1:postgres:--secret--
127.0.0.1:5432:slony-client2:postgres:--secret--

 		 	   		  =

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20091014/=
8226dc1b/attachment.htm
From cbbrowne at ca.afilias.info  Wed Oct 14 08:57:55 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed Oct 14 08:58:04 2009
Subject: [Slony1-general] What it slony doing here?
In-Reply-To: <4AD5227C.4040702@selectacast.net> (Joseph S.'s message of "Tue, 
	13 Oct 2009 20:59:40 -0400")
References: <4AD5227C.4040702@selectacast.net>
Message-ID: <87pr8q7yt8.fsf@dba2.int.libertyrms.com>

Joseph S <jks@selectacast.net> writes:
> I notice there are frequent big gaps in time between
> "remoteHelperThread_1_1: allocate line buffers" "remoteWorkerThread_1:
> returning lines to pool". What is going on during this time?
>
> 2009-10-13 20:55:34 EDT DEBUG4 remoteWorkerThread_1: returning lines to pool
> 2009-10-13 20:55:34 EDT DEBUG4 remoteHelperThread_1_1: fetch from cursor
> 2009-10-13 20:55:34 EDT DEBUG4 remoteHelperThread_1_1: fetched 100 log rows
> 2009-10-13 20:55:34 EDT DEBUG4 remoteHelperThread_1_1: deliver 10
> lines to worker
> 2009-10-13 20:55:34 EDT DEBUG4 remoteHelperThread_1_1: allocate line buffers
> 2009-10-13 20:55:37 EDT DEBUG4 remoteWorkerThread_1: returning lines to pool

A whole bunch of INSERTs/UPDATEs/DELETEs against a subscriber :-).

This is part of the heavy-work loop that is applying changes to the
subscriber.  Each of those fetches represents 100 replicated tuples
being propagated to the subscriber.

Why the 9 second pause is a good question, though.  Not sure why
things would pause there.
-- 
let name="cbbrowne" and tld="ca.afilias.info" in name ^ "@" ^ tld;;
Christopher Browne
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"
From cbbrowne at ca.afilias.info  Wed Oct 14 08:59:26 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed Oct 14 08:59:35 2009
Subject: [Slony1-general] Slony-I version 1.2.17 released
Message-ID: <87ljje7yqp.fsf@dba2.int.libertyrms.com>

Finally got the "round tuits" to run through a full phase of tests,
and version 1.2.17 is now out.

See http://slony.info for the "gory details."

The notable thing is that it now works with PostgreSQL 8.4.
-- 
let name="cbbrowne" and tld="ca.afilias.info" in name ^ "@" ^ tld;;
Christopher Browne
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"
From jks at selectacast.net  Wed Oct 14 09:12:27 2009
From: jks at selectacast.net (Joseph S)
Date: Wed Oct 14 09:12:42 2009
Subject: [Slony1-general] What it slony doing here?
In-Reply-To: <2968dfd60910140711x4062eb49qe6137181febfef76@mail.gmail.com>
References: <4AD5227C.4040702@selectacast.net>
	<2968dfd60910140711x4062eb49qe6137181febfef76@mail.gmail.com>
Message-ID: <4AD5F86B.2010602@selectacast.net>



Vick Khera wrote:
> On Tue, Oct 13, 2009 at 8:59 PM, Joseph S <jks@selectacast.net> wrote:
>   
>> I notice there are frequent big gaps in time between
>>  "remoteHelperThread_1_1: allocate line buffers" "remoteWorkerThread_1:
>> returning lines to pool". What is going on during this time?
>>
>>     
>
> I'm fairly sure that is the time during which the changes from those
> change-log lines are being applied to the replica.
> _______________________________________________
>   
Well obviously, but my question is why the big pauses after some 
"remoteHelperThread_1_1: allocate line buffers" but not all of them?

From akpgeek at gmail.com  Wed Oct 14 12:02:28 2009
From: akpgeek at gmail.com (akp geek)
Date: Wed Oct 14 12:06:45 2009
Subject: [Slony1-general] Slony installation -- make error - Solaris 10
In-Reply-To: <2024a9fb0910141156m6bbb3c03v1c0cfb44dc8404c7@mail.gmail.com>
References: <2024a9fb0910141156m6bbb3c03v1c0cfb44dc8404c7@mail.gmail.com>
Message-ID: <2024a9fb0910141202p2541b76bkf1ad9495eac8e175@mail.gmail.com>

 Hi
I am trying to install Slony ( slony1-2.0.3-rc2 ) on Solaris 10 and
configure runs without issues. After that when I run gmake I ran into the
following issue.

Can you please help?

gmake[2]: Entering directory
`/export/home/slony/slony1-2.0.3-rc2/src/slony_logshipper'
bison -y -d  parser.y
gmake[2]: *** [parser.c] Segmentation Fault (core dumped)
gmake[2]: Leaving directory
`/export/home/slony/slony1-2.0.3-rc2/src/slony_logshipper'
gmake[1]: *** [all] Error 2
gmake[1]: Leaving directory `/export/home/slony/slony1-2.0.3-rc2/src'
gmake: *** [all] Error 2

regards
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20091014/=
e8e3d315/attachment.htm
From lawrenceg at globalitcreations.com  Wed Oct 14 22:30:21 2009
From: lawrenceg at globalitcreations.com (Lawrence Giam)
Date: Thu Oct 15 04:54:56 2009
Subject: [Slony1-general] Using Pg_dump to backup database for worst case
	scenario
Message-ID: <F42B651E7C095744BA93C7D0D087CCD301D9FDDF@gitc-mail01.globalitcreations.com>

Skipped content of type multipart/alternative-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 4414 bytes
Desc: gitclogo.jpg
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20091015/04c3459f/attachment.jpeg
From vivek at khera.org  Thu Oct 15 07:18:03 2009
From: vivek at khera.org (Vick Khera)
Date: Thu Oct 15 07:18:10 2009
Subject: [Slony1-general] What it slony doing here?
In-Reply-To: <4AD5F86B.2010602@selectacast.net>
References: <4AD5227C.4040702@selectacast.net>
	<2968dfd60910140711x4062eb49qe6137181febfef76@mail.gmail.com>
	<4AD5F86B.2010602@selectacast.net>
Message-ID: <2968dfd60910150718t44f3652ckfa362de3dbdb87ef@mail.gmail.com>

On Wed, Oct 14, 2009 at 12:12 PM, Joseph S <jks@selectacast.net> wrote:
> Well obviously, but my question is why the big pauses after some
> "remoteHelperThread_1_1: allocate line buffers" but not all of them?

Turn on logging and see what's going on.  I notice slowness sometimes.
 The best I've been able to ascertain is that the FETCH on the origin
is taking a long time, or that the COMMIT on the replica is taking a
long time.  I'm betting that's due to the fsync() on the WAL file.

It is such a fast moving target that it is very hard to detect exactly
what is making it slow.  It happens to my application as well, not
just slony, so I don't think it is a slony specific issue.
From vivek at khera.org  Thu Oct 15 07:19:14 2009
From: vivek at khera.org (Vick Khera)
Date: Thu Oct 15 07:19:20 2009
Subject: [Slony1-general] Slony installation -- make error - Solaris 10
In-Reply-To: <2024a9fb0910141202p2541b76bkf1ad9495eac8e175@mail.gmail.com>
References: <2024a9fb0910141156m6bbb3c03v1c0cfb44dc8404c7@mail.gmail.com>
	<2024a9fb0910141202p2541b76bkf1ad9495eac8e175@mail.gmail.com>
Message-ID: <2968dfd60910150719y125afdbv4f383e77e91e9200@mail.gmail.com>

On Wed, Oct 14, 2009 at 3:02 PM, akp geek <akpgeek@gmail.com> wrote:
> bison -y -d? parser.y
> gmake[2]: *** [parser.c] Segmentation Fault (core dumped)

can you run bison on any other grammar file?  perhaps you need to
re-install bison.
From vivek at khera.org  Thu Oct 15 07:26:24 2009
From: vivek at khera.org (Vick Khera)
Date: Thu Oct 15 07:26:30 2009
Subject: [Slony1-general] Using Pg_dump to backup database for worst case 
	scenario
In-Reply-To: <F42B651E7C095744BA93C7D0D087CCD301D9FDDF@gitc-mail01.globalitcreations.com>
References: <F42B651E7C095744BA93C7D0D087CCD301D9FDDF@gitc-mail01.globalitcreations.com>
Message-ID: <2968dfd60910150726j204c410aye853cf94932b500e@mail.gmail.com>

Again with the JPG files? ?Please... turn off your HTML. ?Thanks.

On Thu, Oct 15, 2009 at 1:30 AM, Lawrence Giam
<lawrenceg@globalitcreations.com> wrote:
>
> at a daily dump of the database for backup purpose and for worst case scenario where all else fails. The slony documentation mention this slony1_extract_schema.sh script which I feel is rather risky to be running on a daily basis and resource consuming on a production server

Does your schema ?change on a daily basis?  If so, then you're really
doing something out of the norm, and likely have a flawed design.  I
extract my schema only on changes, which are few and far between.

> 1. Is there a procedure for simplfying the dumping of database without cluster information which can be run on a daily basis?
> 2. Can anyone share how you actually implement daily backup with Slony?
> 3. Lastly how is the restore procedure like?

Just take the dump from the origin, to ensure everything is
consistent.  Do the dump in "c" format.  When you need to restore,
first get a listing of the objects in the dump using pg_restore -l
then edit that listing to eliminate any objects related to slony and
the slony schema, then restore just the remaining objects with
pg_restore -L.

The alternative is to take a data-only dump from either server, then
use your prepared "extracted" schema (up to but not including the
constraints and indexes) then restore to that.  Finally, apply the
remainder of the extracted schema with the indexes and FKs and other
constraints.  The extracted schema file is easy to split since you
just have to look for the first ADD CONSTRAINT and split it in half
right there.
From plk.zuber at gmail.com  Thu Oct 15 12:48:24 2009
From: plk.zuber at gmail.com (=?UTF-8?Q?Filip_Rembia=C5=82kowski?=)
Date: Thu Oct 15 12:48:42 2009
Subject: [Slony1-general] encoding problem
In-Reply-To: <20091013131200.GB94878@shinkuro.com>
References: <92869e660910120440v70f51242kf32eb18498ce511b@mail.gmail.com>
	<20091013131200.GB94878@shinkuro.com>
Message-ID: <92869e660910151248g50e07dc9kc1e1296a1a49fda2@mail.gmail.com>

MjAwOS8xMC8xMyBBbmRyZXcgU3VsbGl2YW4gPGFqc0BjcmFua3ljYW51Y2suY2E+Cgo+IE9uIE1v
biwgT2N0IDEyLCAyMDA5IGF0IDAxOjQwOjU1UE0gKzAyMDAsIEZpbGlwIFJlbWJpYcWCa293c2tp
IHdyb3RlOgo+Cj4gPiBMT0c6ICBkdXJhdGlvbjogMy4wOTEgbXMgIHN0YXRlbWVudDogc2VsZWN0
ICJfcmVwbGljYXRpb24iLmNvcHlGaWVsZHMoMSk7Cj4gPiBFUlJPUjogIGNoYXJhY3RlciAweDgy
OWMgb2YgZW5jb2RpbmcgIk1VTEVfSU5URVJOQUwiIGhhcyBubyBlcXVpdmFsZW50IGluCj4gPiAi
V0lOMTI1MCIKPiA+IFNUQVRFTUVOVDogIGNvcHkgInB1YmxpYyIuInVzbHVnaSIgKDxGSUVMRFMg
TElTVD4pIHRvIHN0ZG91dDsKPiA+Cj4gPiBJIGhhdmUgbm8gaWRlYSB3aHkgIldJTjEyNTAiIGNv
bWVzIGludG8gc3RhZ2U7ICBib3RoIGRhdGFiYXNlcyBhcmUgVVRGLTguCj4KPiBJdCBtYXkgYmUg
dGhlIGNsaWVudCBlbmNvZGluZy4gIFdoYXQgbG9jYWxlIGFyZSB0aGUgc2xvbiBkYWVtb25zIHJ1
bm5pbmcKPiB1bmRlcj8KPgoKeWVzLCB0aGlzIHdhcyB0aGUgY2FzZS4KCnRoZSBkYXRhYmFzZSB3
YXMgbGF0aW4yIC0gZW5jb2RlZCwgYnV0IGZyb20gc29tZSByZWFzb24gKCopIHRoaXMgd2FzIG1h
ZGU6CkFMVEVSIERBVEFCQVNFIGZvbyBTRVQgY2xpZW50X2VuY29kaW5nIFRPICdXSU4xMjUwJzsK
cHJvYmxlbSB3YXMgc29sdmVkIGJ5OgpBTFRFUiBST0xFIHNsb255IFNFVCBjbGllbnRfZW5jb2Rp
bmcgdG8gJ0xBVElOMic7CgpidHcgLSB0aGlzIGFsc28gYnJlYWtzICJwZ19kdW1wIGRibmFtZSI7
IEkgaGF2ZSB0byB1c2UgLUUgTEFUSU4yIHRvIG1ha2UgaXQKd29yawoKKCopIGJ1c2luZXNzLWNy
aXRpY2FsIHdpbjMyIGFwcAoKCi0tIApGaWxpcCBSZW1iaWHFgmtvd3NraQpKSUQsbWFpbHRvOmZp
bGlwLnJlbWJpYWxrb3dza2lAZ21haWwuY29tCmh0dHA6Ly9maWxpcC5yZW1iaWFsa293c2tpLm5l
dC8KLS0tLS0tLS0tLS0tLS0gbmV4dCBwYXJ0IC0tLS0tLS0tLS0tLS0tCkFuIEhUTUwgYXR0YWNo
bWVudCB3YXMgc2NydWJiZWQuLi4KVVJMOiBodHRwOi8vbGlzdHMuc2xvbnkuaW5mby9waXBlcm1h
aWwvc2xvbnkxLWdlbmVyYWwvYXR0YWNobWVudHMvMjAwOTEwMTUvODUwNDhjODUvYXR0YWNobWVu
dC5odG0K
From mark.kirkwood at catalyst.net.nz  Thu Oct 15 14:18:40 2009
From: mark.kirkwood at catalyst.net.nz (Mark Kirkwood)
Date: Thu Oct 15 14:19:01 2009
Subject: [Slony1-general] Slony installation -- make error - Solaris 10
In-Reply-To: <2024a9fb0910141202p2541b76bkf1ad9495eac8e175@mail.gmail.com>
References: <2024a9fb0910141156m6bbb3c03v1c0cfb44dc8404c7@mail.gmail.com>
	<2024a9fb0910141202p2541b76bkf1ad9495eac8e175@mail.gmail.com>
Message-ID: <4AD791B0.5000108@catalyst.net.nz>

akp geek wrote:
>
>
> gmake[2]: Entering directory 
> `/export/home/slony/slony1-2.0.3-rc2/src/slony_logshipper'
> bison -y -d  parser.y
> gmake[2]: *** [parser.c] Segmentation Fault (core dumped)
What is the version of bison? (could be important)

regards

Mark
From peter.geoghegan86 at gmail.com  Sun Oct 18 06:21:58 2009
From: peter.geoghegan86 at gmail.com (Peter Geoghegan)
Date: Sun Oct 18 06:22:05 2009
Subject: [Slony1-general] Using Slony 2.0.2 with 8.4,
	Missing autovacuum table, missing entries in sl_status
Message-ID: <db471ace0910180621j1c6e93d9g4107ba1f8e702da2@mail.gmail.com>

Hello,

I have two minor problems with Slony (in addition to my earlier
problem that I resolved to live with with sl_status having a spurious
event lag, which is apparently a known bug where confirmation events
sometimes don't get back).

I have a fairly standard setup, 1 master and 3 slaves. The master runs
postgresl 8.4.0 on windows, and each of the Slaves run 8.3.* on Linux.
I'm using Hiroshi Saito's Slony 2.0.2 package for MS Windows.

My problems are:

1. Sometimes, sl_status on the master omits the status of 2 out of 3
of the slaves that are being replicated to. When this happens, it
alternates between which slave node (which st_received) is displayed.
The problem then goes away without any intervention from me, and all
three slaves are listed. Should I worry about this?

2. I'm having the problem discussed here on the list back in July:
http://www.nabble.com/pg_autovacuum-table-gone-in-8.4--td24516041.html
, with the following error appearing in my event log:

ERROR cleanupThread: "select nspname, relname from
"_lustre_cluster".TablesToVacuum();" - ERROR: relation
"pg_catalog.pg_autovacuum" does not exist LINE 1: select enabled from
"pg_catalog".pg_autovacuum where vacreli... ^ QUERY: select enabled
from "pg_catalog".pg_autovacuum where vacrelid = $1 CONTEXT: PL/pgSQL
function "shouldslonyvacuumtable" line 25 at SQL statement PL/pgSQL
function "tablestovacuum" line 6 at IF

The problem is caused by postgres 8.4 not having a
pg_catalog.pg_autovacuum table.


Chris Browne said :

"Happily, when I "forked" the function into 8.3 and 8.4 versions, it
turns out that the API was perfectly fine for either; indeed, the
change to pull data from pg_class rather than pg_autovacuum is
relatively minor within the function.

I just committed that to 2.0+HEAD. "

Since I'm evidently missing changes from that revision, is it possible
for me to update my Slony stored procedures or something so I don't
have this problem? How?

Regards,
Peter Geoghegan
From vivek at khera.org  Mon Oct 19 07:12:41 2009
From: vivek at khera.org (Vick Khera)
Date: Mon Oct 19 07:12:49 2009
Subject: [Slony1-general] Slony-I version 1.2.17 released
In-Reply-To: <87ljje7yqp.fsf@dba2.int.libertyrms.com>
References: <87ljje7yqp.fsf@dba2.int.libertyrms.com>
Message-ID: <2968dfd60910190712n55fb2ba7n9456d8c5cddefb9e@mail.gmail.com>

On Wed, Oct 14, 2009 at 11:59 AM, Christopher Browne
<cbbrowne@ca.afilias.info> wrote:
> Finally got the "round tuits" to run through a full phase of tests,
> and version 1.2.17 is now out.

I'm updating the FreeBSD port for slony1 1.2.  Are you going to
release slony1-1.2.17-docs.tar.bz2 as well, or will there be no
accompanying documentation for slony 1.2 anymore?  Should I just use
the 2.0 docs since they distinguish between the versions anyhow?
From glynastill at yahoo.co.uk  Mon Oct 19 07:49:55 2009
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Mon Oct 19 07:50:05 2009
Subject: [Slony1-general] PGRES_FATAL_ERROR ERROR: cannot change return type
	of existing function
Message-ID: <57001.91201.qm@web23604.mail.ird.yahoo.com>

Hi chaps,

Is anyone else seeing this when doing UPGRADE FUNCTIONS?  I'm guessing it's the recent int / bigint changes?

And I'm getting:

glyn@Way5d:/pgsql/slony$ slonik upgrade_functions.scr
upgrade_functions.scr:9: Possible unsupported PostgreSQL version 8.3, defaulting to 8.1 support
upgrade_functions.scr:9: loading of file /usr/local/pgsql/share//slony1_funcs.sql: PGRES_FATAL_ERROR ERROR:  cannot change return type of existing function
HINT:  Use DROP FUNCTION first.
ERROR:  cannot change return type of existing function
HINT:  Use DROP FUNCTION first.

Send instant messages to your online friends http://uk.messenger.yahoo.com 
From glynastill at yahoo.co.uk  Mon Oct 19 08:04:52 2009
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Mon Oct 19 08:05:01 2009
Subject: [Slony1-general] PGRES_FATAL_ERROR ERROR: cannot change return
	type of existing function
In-Reply-To: <57001.91201.qm@web23604.mail.ird.yahoo.com>
Message-ID: <714911.80539.qm@web23601.mail.ird.yahoo.com>



--- On Mon, 19/10/09, Glyn Astill <glynastill@yahoo.co.uk> wrote:
> Hi chaps,
> 
> Is anyone else seeing this when doing UPGRADE
> FUNCTIONS?? I'm guessing it's the recent int / bigint
> changes?
> 
> And I'm getting:
> 
> glyn@Way5d:/pgsql/slony$ slonik upgrade_functions.scr
> upgrade_functions.scr:9: Possible unsupported PostgreSQL
> version 8.3, defaulting to 8.1 support
> upgrade_functions.scr:9: loading of file
> /usr/local/pgsql/share//slony1_funcs.sql: PGRES_FATAL_ERROR
> ERROR:? cannot change return type of existing function
> HINT:? Use DROP FUNCTION first.
> ERROR:? cannot change return type of existing
> function
> HINT:? Use DROP FUNCTION first.


I bumbled around it with the following on each node:

psql -U slony -d SEE -c 'drop function _main_replication_test.ddlscript_complete(integer, text, integer)'
psql -U slony -d SEE -c 'drop function _main_replication_test.updatereloid(integer, integer)'
sed -e 's/@NAMESPACE@/_main_replication_test/g;s/@MODULEVERSION@/1.2.17/g' slony1_funcs.sql | psql -U slony -d SEE

Glyn


      
From glynastill at yahoo.co.uk  Mon Oct 19 08:11:29 2009
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Mon Oct 19 08:11:39 2009
Subject: [Slony1-general] PGRES_FATAL_ERROR ERROR: cannot change return
	type of existing function
In-Reply-To: <714911.80539.qm@web23601.mail.ird.yahoo.com>
Message-ID: <22703.20453.qm@web23607.mail.ird.yahoo.com>



--- On Mon, 19/10/09, Glyn Astill <glynastill@yahoo.co.uk> wrote:
> 
> --- On Mon, 19/10/09, Glyn Astill <glynastill@yahoo.co.uk>
> wrote:
> > Hi chaps,
> > 
> > Is anyone else seeing this when doing UPGRADE
> > FUNCTIONS?? I'm guessing it's the recent int /
> bigint
> > changes?
> > 
> > And I'm getting:
> > 
> > glyn@Way5d:/pgsql/slony$ slonik upgrade_functions.scr
> > upgrade_functions.scr:9: Possible unsupported
> PostgreSQL
> > version 8.3, defaulting to 8.1 support
> > upgrade_functions.scr:9: loading of file
> > /usr/local/pgsql/share//slony1_funcs.sql:
> PGRES_FATAL_ERROR
> > ERROR:? cannot change return type of existing
> function
> > HINT:? Use DROP FUNCTION first.
> > ERROR:? cannot change return type of existing
> > function
> > HINT:? Use DROP FUNCTION first.
> 
> 
> I bumbled around it with the following on each node:
> 
> psql -U slony -d SEE -c 'drop function
> _main_replication_test.ddlscript_complete(integer, text,
> integer)'
> psql -U slony -d SEE -c 'drop function
> _main_replication_test.updatereloid(integer, integer)'
> sed -e
> 's/@NAMESPACE@/_main_replication_test/g;s/@MODULEVERSION@/1.2.17/g'
> slony1_funcs.sql | psql -U slony -d SEE
> 

Actually :

sed -e 's/@NAMESPACE@/_main_replication_test/g;s/@MODULEVERSION@/1.2.17/g;s/@CLUSTERNAME@/main_replication_test/g' slony1_funcs.sql | psql -U slony -d SEE

Glyn


      
From akpgeek at gmail.com  Tue Oct 20 08:30:53 2009
From: akpgeek at gmail.com (akp geek)
Date: Tue Oct 20 09:37:03 2009
Subject: [Slony1-general] Slony installation -- make error - Solaris 10
In-Reply-To: <4AD791B0.5000108@catalyst.net.nz>
References: <2024a9fb0910141156m6bbb3c03v1c0cfb44dc8404c7@mail.gmail.com>
	<2024a9fb0910141202p2541b76bkf1ad9495eac8e175@mail.gmail.com>
	<4AD791B0.5000108@catalyst.net.nz>
Message-ID: <2024a9fb0910200830m112edb3dhbb8011014d887c4e@mail.gmail.com>

The version of bison I have is bash-3.00# bison --version
bison (GNU Bison) 1.875
Written by Robert Corbett and Richard Stallman.

Copyright (C) 2002 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.


Regards

On Thu, Oct 15, 2009 at 5:18 PM, Mark Kirkwood <
mark.kirkwood@catalyst.net.nz> wrote:

> akp geek wrote:
>
>>
>>
>> gmake[2]: Entering directory
>> `/export/home/slony/slony1-2.0.3-rc2/src/slony_logshipper'
>> bison -y -d  parser.y
>> gmake[2]: *** [parser.c] Segmentation Fault (core dumped)
>>
> What is the version of bison? (could be important)
>
> regards
>
> Mark
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20091020/=
f6dc81b4/attachment.htm
From vivek at khera.org  Tue Oct 20 10:23:35 2009
From: vivek at khera.org (Vick Khera)
Date: Tue Oct 20 10:23:45 2009
Subject: [Slony1-general] Slony installation -- make error - Solaris 10
In-Reply-To: <2024a9fb0910200830m112edb3dhbb8011014d887c4e@mail.gmail.com>
References: <2024a9fb0910141156m6bbb3c03v1c0cfb44dc8404c7@mail.gmail.com>
	<2024a9fb0910141202p2541b76bkf1ad9495eac8e175@mail.gmail.com>
	<4AD791B0.5000108@catalyst.net.nz>
	<2024a9fb0910200830m112edb3dhbb8011014d887c4e@mail.gmail.com>
Message-ID: <2968dfd60910201023j783941c7xc93785ab1f528894@mail.gmail.com>

On Tue, Oct 20, 2009 at 11:30 AM, akp geek <akpgeek@gmail.com> wrote:
> The version of bison I have is
> bash-3.00# bison --version
> bison (GNU Bison) 1.875
> Written by Robert Corbett and Richard Stallman.

Upgrade to 2.4.1 and try again.
From cbbrowne at ca.afilias.info  Tue Oct 20 15:45:56 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Tue Oct 20 15:46:16 2009
Subject: [Slony1-general] Slony installation -- make error - Solaris 10
In-Reply-To: <2024a9fb0910200830m112edb3dhbb8011014d887c4e@mail.gmail.com>
References: <2024a9fb0910141156m6bbb3c03v1c0cfb44dc8404c7@mail.gmail.com>
	<2024a9fb0910141202p2541b76bkf1ad9495eac8e175@mail.gmail.com>
	<4AD791B0.5000108@catalyst.net.nz>
	<2024a9fb0910200830m112edb3dhbb8011014d887c4e@mail.gmail.com>
Message-ID: <20091020184556.128152oj1lh718ro@webmail.afilias.info>

Quoting akp geek <akpgeek@gmail.com>:

> The version of bison I have is bash-3.00# bison --version
> bison (GNU Bison) 1.875
> Written by Robert Corbett and Richard Stallman.
>
> Copyright (C) 2002 Free Software Foundation, Inc.
> This is free software; see the source for copying conditions.  There is NO
> warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

It seems surprising that *any* version of Bison would core dump here;  
while it wouldn't shock me if one could have a  
too-old-to-be-compatible version, the grammars in Slony-I shouldn't  
challenge it terribly much!

I'm not near our production environment; it would be a handy thing if  
one of our DBAs could check what version of bison is in use for  
production builds.  I suspect it's 1.875, but I'm not sure.

I'll note that PostgreSQL adopted the requirement of version 1.875  
back in 2003:
http://archives.postgresql.org/pgsql-hackers/2003-03/msg01065.php

I'm actually suspicious that perhaps the problem is that something is  
actually "busted" in that Bison install.  It might be an idea to try  
building PostgreSQL from source, or at least the parser.

It should suffice to:
a) Run configure
b) "touch" the following file:
./pgsql/src/backend/parser/gram.y
c) In that directory ($SOMEWHERE/pgsql/src/backend/parser)
run the command:
   make gram.c

My suspicion is that that, too, will fail.  It would seem quite  
remarkable for that to succeed and for the slonik parser to fail!

If there's a real problem with parser.y, then we should no doubt fix  
it, but it seems quite unexpected for parser.y to be the root of the  
problem.


From glynastill at yahoo.co.uk  Wed Oct 21 05:45:41 2009
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Wed Oct 21 05:45:47 2009
Subject: [Slony1-general] PGRES_FATAL_ERROR ERROR: cannot change return
	type of existing function
In-Reply-To: <57001.91201.qm@web23604.mail.ird.yahoo.com>
Message-ID: <397138.69566.qm@web23605.mail.ird.yahoo.com>

Am I the only one getting this?

--- On Mon, 19/10/09, Glyn Astill <glynastill@yahoo.co.uk> wrote:

> From: Glyn Astill <glynastill@yahoo.co.uk>
> Subject: [Slony1-general] PGRES_FATAL_ERROR ERROR: cannot change return type of existing function
> To: slony1-general@lists.slony.info
> Date: Monday, 19 October, 2009, 3:49 PM
> Hi chaps,
> 
> Is anyone else seeing this when doing UPGRADE
> FUNCTIONS?? I'm guessing it's the recent int / bigint
> changes?
> 
> And I'm getting:
> 
> glyn@Way5d:/pgsql/slony$ slonik upgrade_functions.scr
> upgrade_functions.scr:9: Possible unsupported PostgreSQL
> version 8.3, defaulting to 8.1 support
> upgrade_functions.scr:9: loading of file
> /usr/local/pgsql/share//slony1_funcs.sql: PGRES_FATAL_ERROR
> ERROR:? cannot change return type of existing function
> HINT:? Use DROP FUNCTION first.
> ERROR:? cannot change return type of existing
> function
> HINT:? Use DROP FUNCTION first.
> 
> Send instant messages to your online friends http://uk.messenger.yahoo.com
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
> 

Send instant messages to your online friends http://uk.messenger.yahoo.com 
From cbbrowne at ca.afilias.info  Wed Oct 21 05:55:04 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed Oct 21 05:55:09 2009
Subject: [Slony1-general] PGRES_FATAL_ERROR ERROR: cannot change return
	type of existing function
In-Reply-To: <714911.80539.qm@web23601.mail.ird.yahoo.com>
References: <714911.80539.qm@web23601.mail.ird.yahoo.com>
Message-ID: <20091021085504.21101bhuhw2q3cmg@webmail.afilias.info>

Quoting Glyn Astill <glynastill@yahoo.co.uk>:
> --- On Mon, 19/10/09, Glyn Astill <glynastill@yahoo.co.uk> wrote:
>> Hi chaps,
>>
>> Is anyone else seeing this when doing UPGRADE
>> FUNCTIONS?? I'm guessing it's the recent int / bigint
>> changes?
>>
>> And I'm getting:
>>
>> glyn@Way5d:/pgsql/slony$ slonik upgrade_functions.scr
>> upgrade_functions.scr:9: Possible unsupported PostgreSQL
>> version 8.3, defaulting to 8.1 support
>> upgrade_functions.scr:9: loading of file
>> /usr/local/pgsql/share//slony1_funcs.sql: PGRES_FATAL_ERROR
>> ERROR:? cannot change return type of existing function
>> HINT:? Use DROP FUNCTION first.
>> ERROR:? cannot change return type of existing
>> function
>> HINT:? Use DROP FUNCTION first.
>
>
> I bumbled around it with the following on each node:
>
> psql -U slony -d SEE -c 'drop function  
> _main_replication_test.ddlscript_complete(integer, text, integer)'
> psql -U slony -d SEE -c 'drop function  
> _main_replication_test.updatereloid(integer, integer)'
> sed -e  
> 's/@NAMESPACE@/_main_replication_test/g;s/@MODULEVERSION@/1.2.17/g'  
> slony1_funcs.sql | psql -U slony -d SEE

The following patch should rectify this...

Index: slony1_funcs.sql
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/backend/slony1_funcs.sql,v
retrieving revision 1.145.2.19
diff -c -u -r1.145.2.19 slony1_funcs.sql
cvs diff: conflicting specifications of output style
--- slony1_funcs.sql    23 Sep 2009 16:14:32 -0000      1.145.2.19
+++ slony1_funcs.sql    21 Oct 2009 12:32:57 -0000
@@ -3643,6 +3643,8 @@
  --
  --     Generate the DDL_SCRIPT event
  -- ----------------------------------------------------------------------
+drop function if exists @NAMESPACE@.ddlScript_complete (int4, text,  
int4);  -- Needed because function signature has changed!
+
  create or replace function @NAMESPACE@.ddlScript_complete (int4, text, int4)
  returns bigint
  as $$
@@ -5063,6 +5065,7 @@
  --
  --      Reset the relnames
  -- ----------------------------------------------------------------------
+drop function if exists @NAMESPACE@.updateReloid (int4, int4);
  create or replace function @NAMESPACE@.updateReloid (int4, int4)
  returns bigint
  as $$

That's working and committed to 2.0 + HEAD.

From glynastill at yahoo.co.uk  Wed Oct 21 06:43:37 2009
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Wed Oct 21 06:43:45 2009
Subject: [Slony1-general] PGRES_FATAL_ERROR ERROR: cannot change return
	type of existing function
In-Reply-To: <20091021085504.21101bhuhw2q3cmg@webmail.afilias.info>
Message-ID: <914304.56394.qm@web23601.mail.ird.yahoo.com>



--- On Wed, 21/10/09, Christopher Browne <cbbrowne@ca.afilias.info> wrote:

> 
> The following patch should rectify this...
> 
> Index: slony1_funcs.sql
> ===================================================================
> RCS file:
> /home/cvsd/slony1/slony1-engine/src/backend/slony1_funcs.sql,v
> retrieving revision 1.145.2.19
> diff -c -u -r1.145.2.19 slony1_funcs.sql
> cvs diff: conflicting specifications of output style
> --- slony1_funcs.sql? ? 23 Sep 2009 16:14:32
> -0000? ? ? 1.145.2.19
> +++ slony1_funcs.sql? ? 21 Oct 2009 12:32:57
> -0000
> @@ -3643,6 +3643,8 @@
>  --
>  --? ???Generate the DDL_SCRIPT event
>  --
> ----------------------------------------------------------------------
> +drop function if exists @NAMESPACE@.ddlScript_complete
> (int4, text, int4);? -- Needed because function
> signature has changed!
> +
>  create or replace function @NAMESPACE@.ddlScript_complete
> (int4, text, int4)
>  returns bigint
>  as $$
> @@ -5063,6 +5065,7 @@
>  --
>  --? ? ? Reset the relnames
>  --
> ----------------------------------------------------------------------
> +drop function if exists @NAMESPACE@.updateReloid (int4,
> int4);
>  create or replace function @NAMESPACE@.updateReloid (int4,
> int4)
>  returns bigint
>  as $$
> 
> That's working and committed to 2.0 + HEAD.
> 

That's cool, just a note that I was upgrading to 1.2.17 when I got this, not 2.0.x


      
From bnichols at ca.afilias.info  Wed Oct 21 07:20:12 2009
From: bnichols at ca.afilias.info (Brad Nicholson)
Date: Wed Oct 21 07:20:20 2009
Subject: [Slony1-general] Slony installation -- make error - Solaris 10
In-Reply-To: <20091020184556.128152oj1lh718ro@webmail.afilias.info>
References: <2024a9fb0910141156m6bbb3c03v1c0cfb44dc8404c7@mail.gmail.com>
	<2024a9fb0910141202p2541b76bkf1ad9495eac8e175@mail.gmail.com>
	<4AD791B0.5000108@catalyst.net.nz>
	<2024a9fb0910200830m112edb3dhbb8011014d887c4e@mail.gmail.com>
	<20091020184556.128152oj1lh718ro@webmail.afilias.info>
Message-ID: <1256134812.4316.102.camel@bnicholson-desktop>

On Tue, 2009-10-20 at 18:45 -0400, Christopher Browne wrote:
> Quoting akp geek <akpgeek@gmail.com>:
> 
> > The version of bison I have is bash-3.00# bison --version
> > bison (GNU Bison) 1.875
> > Written by Robert Corbett and Richard Stallman.
> >
> > Copyright (C) 2002 Free Software Foundation, Inc.
> > This is free software; see the source for copying conditions.  There is NO
> > warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
> 
> It seems surprising that *any* version of Bison would core dump here;  
> while it wouldn't shock me if one could have a  
> too-old-to-be-compatible version, the grammars in Slony-I shouldn't  
> challenge it terribly much!
> 
> I'm not near our production environment; it would be a handy thing if  
> one of our DBAs could check what version of bison is in use for  
> production builds.  I suspect it's 1.875, but I'm not sure.

Correct - 1.875

-- 
Brad Nicholson  416-673-4106
Database Administrator, Afilias Canada Corp.


From cbbrowne at ca.afilias.info  Wed Oct 21 08:25:42 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed Oct 21 08:25:53 2009
Subject: [Slony1-general] PGRES_FATAL_ERROR ERROR: cannot change return
	type of existing function
In-Reply-To: <914304.56394.qm@web23601.mail.ird.yahoo.com>
References: <914304.56394.qm@web23601.mail.ird.yahoo.com>
Message-ID: <20091021112542.11426br725j0sv06@webmail.afilias.info>

Quoting Glyn Astill <glynastill@yahoo.co.uk>:
>> That's working and committed to 2.0 + HEAD.
>>
>
> That's cool, just a note that I was upgrading to 1.2.17 when I got  
> this, not 2.0.x

Uh, oh...

That means I need to fix 1.2.17, presumably rolling 1.2.18.

And I need to think about that a little further; "DROP FUNCTION IF  
EXISTS" wasn't introduced until, I believe, PostgreSQL 8.2.  (It's not  
in 8.1.)

So that strategy won't work for 1.2 :-(.

Thanks for letting me know!


From vivek at khera.org  Wed Oct 21 09:11:51 2009
From: vivek at khera.org (Vick Khera)
Date: Wed Oct 21 09:12:02 2009
Subject: [Slony1-general] PGRES_FATAL_ERROR ERROR: cannot change return 
	type of existing function
In-Reply-To: <20091021112542.11426br725j0sv06@webmail.afilias.info>
References: <914304.56394.qm@web23601.mail.ird.yahoo.com>
	<20091021112542.11426br725j0sv06@webmail.afilias.info>
Message-ID: <2968dfd60910210911x147775deo75d94afd4f2be20f@mail.gmail.com>

On Wed, Oct 21, 2009 at 11:25 AM, Christopher Browne
<cbbrowne@ca.afilias.info> wrote:
> And I need to think about that a little further; "DROP FUNCTION IF EXISTS"
> wasn't introduced until, I believe, PostgreSQL 8.2. ?(It's not in 8.1.)
>
> So that strategy won't work for 1.2 :-(.

can you wrap it inside a SAVEPOINT, and then rollback to the savepoint
if it fails?  not sure how you'd do that in a simple SQL script,
though :-(
From cbbrowne at ca.afilias.info  Wed Oct 21 19:21:54 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed Oct 21 19:22:21 2009
Subject: [Slony1-general] PGRES_FATAL_ERROR ERROR: cannot change return
	type of existing function
In-Reply-To: <2968dfd60910210911x147775deo75d94afd4f2be20f@mail.gmail.com>
References: <914304.56394.qm@web23601.mail.ird.yahoo.com>
	<20091021112542.11426br725j0sv06@webmail.afilias.info>
	<2968dfd60910210911x147775deo75d94afd4f2be20f@mail.gmail.com>
Message-ID: <20091021222154.14022lvgf0zcemki@webmail.afilias.info>

Quoting Vick Khera <vivek@khera.org>:

> On Wed, Oct 21, 2009 at 11:25 AM, Christopher Browne
> <cbbrowne@ca.afilias.info> wrote:
>> And I need to think about that a little further; "DROP FUNCTION IF EXISTS"
>> wasn't introduced until, I believe, PostgreSQL 8.2. ?(It's not in 8.1.)
>>
>> So that strategy won't work for 1.2 :-(.
>
> can you wrap it inside a SAVEPOINT, and then rollback to the savepoint
> if it fails?  not sure how you'd do that in a simple SQL script,
> though :-(

I don't think we had SAVEPOINT in 7.4, which is still supported...

I have a patch with a strategy for this; basically just creating a  
little stored procedure which simulates the aspect of "DROP FUNCTION  
IF EXISTS" that we need.

That is, the SP looks in information_schema to see if there's a  
function in the cluster's schema with the given name, and drops it, if  
there.

It's not very smart; there's a scenario where it'll blow up, but I  
think that scenario corresponds to someone having hacked things up  
dramatically enough that they can't *realistically* expect UPDATE  
FUNCTIONS to work out well for them.

Patch is sitting in a mailbox waiting for me to try it out...


From threshar at torgo.978.org  Fri Oct 23 07:10:54 2009
From: threshar at torgo.978.org (Jeff)
Date: Fri Oct 23 07:11:25 2009
Subject: [Slony1-general] PGRES_FATAL_ERROR ERROR: cannot change return
	type of existing function
In-Reply-To: <20091021085504.21101bhuhw2q3cmg@webmail.afilias.info>
References: <714911.80539.qm@web23601.mail.ird.yahoo.com>
	<20091021085504.21101bhuhw2q3cmg@webmail.afilias.info>
Message-ID: <6CA951EC-BD82-4EB8-ADFC-F64103721155@torgo.978.org>


On Oct 21, 2009, at 8:55 AM, Christopher Browne wrote:
> The following patch should rectify this...
>
> Index: slony1_funcs.sql
> ===================================================================
> RCS file: /home/cvsd/slony1/slony1-engine/src/backend/ 
> slony1_funcs.sql,v
> retrieving revision 1.145.2.19
> diff -c -u -r1.145.2.19 slony1_funcs.sql
> cvs diff: conflicting specifications of output style
> --- slony1_funcs.sql    23 Sep 2009 16:14:32 -0000      1.145.2.19
> +++ slony1_funcs.sql    21 Oct 2009 12:32:57 -0000
> @@ -3643,6 +3643,8 @@
> --
> --     Generate the DDL_SCRIPT event
> --  
> ----------------------------------------------------------------------
> +drop function if exists @NAMESPACE@.ddlScript_complete (int4, text,  
> int4);  -- Needed because function signature has changed!
> +
> create or replace function @NAMESPACE@.ddlScript_complete (int4,  
> text, int4)
> returns bigint
> as $$
> @@ -5063,6 +5065,7 @@
> --
> --      Reset the relnames
> --  
> ----------------------------------------------------------------------
> +drop function if exists @NAMESPACE@.updateReloid (int4, int4);
> create or replace function @NAMESPACE@.updateReloid (int4, int4)
> returns bigint
> as $$
>
> That's working and committed to 2.0 + HEAD.
>

This works for me.
My origin is 8.2, slave is 8.4 (preparing for an upgrade! wheeee!)

It was a bit surprising this slipped through.

--
Jeff Trout <jeff@jefftrout.com>
http://www.stuarthamm.net/
http://www.dellsmartexitin.com/



From threshar at torgo.978.org  Fri Oct 23 07:57:12 2009
From: threshar at torgo.978.org (Jeff)
Date: Fri Oct 23 07:57:46 2009
Subject: [Slony1-general] Another 8.4 issue with 1.2.17
Message-ID: <B852F3CE-B2BB-4E54-8C55-D113DDF3263A@torgo.978.org>

Just ran into this problem - the origin is 8.2, replica is 8.4.1

2009-10-23 10:47:42 EDT DEBUG1 copy_set 3
2009-10-23 10:47:42 EDT DEBUG1 remoteWorkerThread_1: connected to  
provider DB
2009-10-23 10:47:42 EDT WARN   remoteWorkerThread_1: transactions  
earlier than XID 3820504992 are still in progress
2009-10-23 10:47:42 EDT WARN   remoteWorkerThread_1: data copy for set  
3 failed - sleep 60 seconds
NOTICE:  there is no transaction in progress
2009-10-23 10:48:42 EDT DEBUG1 copy_set 3
2009-10-23 10:48:42 EDT DEBUG1 remoteWorkerThread_1: connected to  
provider DB
2009-10-23 10:48:42 EDT ERROR  remoteWorkerThread_1: Could not lock  
table "public"."companyinfo" on subscriber
2009-10-23 10:48:42 EDT WARN   remoteWorkerThread_1: data copy for set  
3 failed - sleep 60 seconds
NOTICE:  there is no transaction in progress

In the PG log
LOG:  checkpoint starting: time
ERROR:  LOCK TABLE can only be used in transaction blocks
STATEMENT:  lock table "public"."companyinfo";
	
It seems in 8.4 you can only LOCK table inside a txn where it worked  
outside of a txn previously.

My hack solution until I can code something up is to restart slon -  
this seems to fix the issue.
I suspect there's a missing BEGIN in the retry loop in slon - I've  
seen slon get into semi-buggered states like this on 8.2 before but  
figured it was a fluke.

indie=> select version();
                                                   version
------------------------------------------------------------------------------------------------------------
  PostgreSQL 8.2.11 on x86_64-unknown-linux-gnu, compiled by GCC gcc  
(GCC) 4.1.2 20070925 (Red Hat 4.1.2-27)
(1 row)

indie=> lock table companyinfo;
LOCK TABLE

---

------------------------------------------------------------------------------------------------------------------
  PostgreSQL 8.4.1 on x86_64-unknown-linux-gnu, compiled by GCC gcc  
(GCC) 4.3.2 20081105 (Red Hat 4.3.2-7), 64-bit
(1 row)

indie=> lock table companyinfo;
ERROR:  LOCK TABLE can only be used in transaction blocks

--
Jeff Trout <jeff@jefftrout.com>
http://www.stuarthamm.net/
http://www.dellsmartexitin.com/



From tmblue at gmail.com  Fri Oct 23 10:02:40 2009
From: tmblue at gmail.com (Tory M Blue)
Date: Fri Oct 23 10:02:53 2009
Subject: [Slony1-general] Postgres 8.4 run with 1.2.17 slon or move to the
	2.0.2 branch?
Message-ID: <8a547c840910231002y1195fc8eta5d51690fbe2ed8b@mail.gmail.com>

Should I move to the 2.0 branch (2.0.2) for 8.4 compatibility or should I
stick with 1.2.17 for the time being? I'm trying to move my test
environments (pre production), to 8.4 but wondering prior to this, what
version of slon should I be on ?

Thanks
Tory
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20091023/=
6ad486d7/attachment.htm
From threshar at torgo.978.org  Fri Oct 23 10:41:08 2009
From: threshar at torgo.978.org (Jeff)
Date: Fri Oct 23 10:41:44 2009
Subject: [Slony1-general] Another 8.4 issue with 1.2.17 [Patch attached]
In-Reply-To: <B852F3CE-B2BB-4E54-8C55-D113DDF3263A@torgo.978.org>
References: <B852F3CE-B2BB-4E54-8C55-D113DDF3263A@torgo.978.org>
Message-ID: <894F8D8B-28DE-43A3-BE9B-40F13D46F7E7@torgo.978.org>


On Oct 23, 2009, at 10:57 AM, Jeff wrote:

> Just ran into this problem - the origin is 8.2, replica is 8.4.1
>
> 2009-10-23 10:47:42 EDT DEBUG1 copy_set 3
> 2009-10-23 10:47:42 EDT DEBUG1 remoteWorkerThread_1: connected to  
> provider DB
> 2009-10-23 10:47:42 EDT WARN   remoteWorkerThread_1: transactions  
> earlier than XID 3820504992 are still in progress
> 2009-10-23 10:47:42 EDT WARN   remoteWorkerThread_1: data copy for  
> set 3 failed - sleep 60 seconds
> NOTICE:  there is no transaction in progress
> 2009-10-23 10:48:42 EDT DEBUG1 copy_set 3
> 2009-10-23 10:48:42 EDT DEBUG1 remoteWorkerThread_1: connected to  
> provider DB
> 2009-10-23 10:48:42 EDT ERROR  remoteWorkerThread_1: Could not lock  
> table "public"."companyinfo" on subscriber
> 2009-10-23 10:48:42 EDT WARN   remoteWorkerThread_1: data copy for  
> set 3 failed - sleep 60 seconds
> NOTICE:  there is no transaction in progress
>
> In the PG log
> LOG:  checkpoint starting: time
> ERROR:  LOCK TABLE can only be used in transaction blocks
> STATEMENT:  lock table "public"."companyinfo";

So I've dug into this and attached a patch to solve it.

In a nutshell in the event loop we start a transaction, then if we are  
not an accept set event we lock the config lock table.  We then zero  
out query1. (this is in remote_worker.c).

The ENABLE_SUBSCRIPTION event runs in a while(true) loop.
First it executes query1 (which thanks to the above, is empty), then  
tries to copy_set.  If copy_set fails for whatever reason we ROLLBACK  
our local conn (query2) and then loop.

The problem with this is when we come back around in the next look  
we're outside of a transaction and one won't be started because query1  
is reset.  This causes LOCK TABLE to barf on PG8.4.  You are forever  
stuck until you restart slon.  This also explains another problem I've  
seen a couple times.

We subscribe to a set with say 3 tables.
The initial subscription fails due to an earlier txn wait.
We copy the first table of hte set successfully.
Then the second table fails to copy due to some DDL issue (perhaps for  
some reason a PK or column is missing).  We issue a rollback but since  
we are not in a txn, nothing happens. The event does not suceed so we  
try again
What happens next is since our previous work wasn't rolled back slony  
sees we've already got teh deny trigger & friends on the first table  
and barfs.   Cue infinite loop fixed only by shutting down slon and  
playing with the sl_ tables.

This patch keeps a count of how many retries we've had on this  
copy_set.  If we are on retry > 0 then we re-issue a start  
transaction, set islolation, and lock the config table. My testing has  
showed that this works.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: copy_set_retry.patch
Type: application/octet-stream
Size: 2598 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20091023/36a8cafe/copy_set_retry.obj
-------------- next part --------------



--
Jeff Trout <jeff@jefftrout.com>
http://www.stuarthamm.net/
http://www.dellsmartexitin.com/



From threshar at torgo.978.org  Fri Oct 23 10:50:27 2009
From: threshar at torgo.978.org (Jeff)
Date: Fri Oct 23 10:50:52 2009
Subject: [Slony1-general] Postgres 8.4 run with 1.2.17 slon or move to the
	2.0.2 branch?
In-Reply-To: <8a547c840910231002y1195fc8eta5d51690fbe2ed8b@mail.gmail.com>
References: <8a547c840910231002y1195fc8eta5d51690fbe2ed8b@mail.gmail.com>
Message-ID: <DEAFC55C-BB28-45D4-91B2-FEC52637FF67@torgo.978.org>


On Oct 23, 2009, at 1:02 PM, Tory M Blue wrote:

> Should I move to the 2.0 branch (2.0.2) for 8.4 compatibility or  
> should I stick with 1.2.17 for the time being? I'm trying to move my  
> test environments (pre production), to 8.4 but wondering prior to  
> this, what version of slon should I be on ?
>
> Thanks
> Tory
>

I can't speak for 2.x but wait for 1.2.18 for 8.4 - as you can see in  
the archives two nasty bugs have been found in 1.2.17

>
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general

--
Jeff Trout <jeff@jefftrout.com>
http://www.stuarthamm.net/
http://www.dellsmartexitin.com/



From vivek at khera.org  Fri Oct 23 10:51:24 2009
From: vivek at khera.org (Vick Khera)
Date: Fri Oct 23 10:51:38 2009
Subject: [Slony1-general] Another 8.4 issue with 1.2.17 [Patch attached]
In-Reply-To: <894F8D8B-28DE-43A3-BE9B-40F13D46F7E7@torgo.978.org>
References: <B852F3CE-B2BB-4E54-8C55-D113DDF3263A@torgo.978.org>
	<894F8D8B-28DE-43A3-BE9B-40F13D46F7E7@torgo.978.org>
Message-ID: <2968dfd60910231051i5f85c0f3h993f8d3fb4b0f595@mail.gmail.com>

On Fri, Oct 23, 2009 at 1:41 PM, Jeff <threshar@torgo.978.org> wrote:
> The ENABLE_SUBSCRIPTION event runs in a while(true) loop.
> First it executes query1 (which thanks to the above, is empty), then tries
> to copy_set. ?If copy_set fails for whatever reason we ROLLBACK our local
> conn (query2) and then loop.
>

I think this has been a long lasting bug.  When I do a subscription
and the initial copy fails, it *always* issues a warning about commit
outside of a transaction once it succeeds on a subsequent event.  I'll
bet this patch fixes this problem as well.

Nice work!
From cbbrowne at ca.afilias.info  Fri Oct 23 14:21:18 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri Oct 23 14:21:52 2009
Subject: [Slony1-general] Another 8.4 issue with 1.2.17 [Patch attached]
In-Reply-To: <894F8D8B-28DE-43A3-BE9B-40F13D46F7E7@torgo.978.org>
References: <B852F3CE-B2BB-4E54-8C55-D113DDF3263A@torgo.978.org>
	<894F8D8B-28DE-43A3-BE9B-40F13D46F7E7@torgo.978.org>
Message-ID: <4AE21E4E.5040000@ca.afilias.info>

Jeff wrote:
> This patch keeps a count of how many retries we've had on this 
> copy_set.  If we are on retry > 0 then we re-issue a start 
> transaction, set islolation, and lock the config table. My testing has 
> showed that this works.

Excellent catch!

It seems apropos for 2.0, too.
From jcasanov at systemguards.com.ec  Fri Oct 23 15:09:12 2009
From: jcasanov at systemguards.com.ec (Jaime Casanova)
Date: Fri Oct 23 15:09:50 2009
Subject: [Slony1-general] Another 8.4 issue with 1.2.17
In-Reply-To: <B852F3CE-B2BB-4E54-8C55-D113DDF3263A@torgo.978.org>
References: <B852F3CE-B2BB-4E54-8C55-D113DDF3263A@torgo.978.org>
Message-ID: <3073cc9b0910231509t2d979c05hf47df744f6411cd3@mail.gmail.com>

On Fri, Oct 23, 2009 at 9:57 AM, Jeff <threshar@torgo.978.org> wrote:
>
> It seems in 8.4 you can only LOCK table inside a txn where it worked outside
> of a txn previously.
>

actually it never worked outside a txn (the lock was taken and
released immediately) now it just is more clearly about that :)

-- 
Atentamente,
Jaime Casanova
Soporte y capacitaci?n de PostgreSQL
Asesor?a y desarrollo de sistemas
Guayaquil - Ecuador
Cel. +59387171157
