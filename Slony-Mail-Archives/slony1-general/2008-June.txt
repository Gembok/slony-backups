From roberto1437 at yahoo.com.ar  Mon Jun  2 15:37:14 2008
From: roberto1437 at yahoo.com.ar (Roberto Mariano)
Date: Mon Jun  2 15:37:29 2008
Subject: [Slony1-general] A problem in Windows Server
Message-ID: <424442.96294.qm@web56712.mail.re3.yahoo.com>

CiZuYnNwO0hpLAombmJzcDsKSSBoYXZlIGNvbmZpZ3VyZWQgYSBTbG9ueS1JIChhIG1hc3RlciBh
bmQgYSBzbGF2ZSkgYmV0d2VlbiAyIFdpbmRvd3MgMjAwMyBTZXJ2ZXJzIHdpY2ggYXJlIHJ1bm5p
bmcgUG9zdGdyZXMgOC4zLiAKCkl0IHdvcmtzIGZpbmUgcnVubmluZyB0aGUgU0xPTi5leGUgcHJv
Z3JhbXMgZnJvbSB0aGUgY29tbWFuZCBsaW5lLiBCdXQgd2hlbiBJIHdhbnQgdG8gY3JlYXRlIHRo
ZSBXaW5kb3dzIHNlcnZpY2U6CiZuYnNwOwomZ3Q7Jm5ic3A7c2xvbiAtcmVnc2VydmljZSBTbG9u
eS1JCiZuYnNwOwpBbiBlcnJvciBvY2N1cnM6CiZuYnNwOwpGYWlsZWQgdG8gY3JlYXRlIHNlcnZp
Y2U6IDEwNTcKJm5ic3A7Ckkgd2FzIGxvZ2dlZCBhcyAiQWRtaW5pc3RyYXRvciIgd2hpY2ggaGFz
IGFsbCBwZXJtaXNzaW9uLiZuYnNwOwombmJzcDsKU29tZWJvZHkgY2FuIGhlbHAgbWU/IAombmJz
cDsKVGhhbmsgeW91IHZlcnkgbXVjaC4KJm5ic3A7ClJvYmVydG8gQ3J1Y2lhbmVsbGkuCiZuYnNw
OwoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KQ29y
cmVvIFlhaG9vIQpFc3BhY2lvIHBhcmEgdG9kb3MgdHVzIG1lbnNhamVzLCBhbnRpdmlydXMgeSBh
bnRpc3BhbSDCoWdyYXRpcyEgCsKhQWJyw60gdHUgY3VlbnRhIHlhISAtIGh0dHA6Ly9jb3JyZW8u
eWFob28uY29tLmFyCi0tLS0tLS0tLS0tLS0tIG5leHQgcGFydCAtLS0tLS0tLS0tLS0tLQpBbiBI
VE1MIGF0dGFjaG1lbnQgd2FzIHNjcnViYmVkLi4uClVSTDogaHR0cDovL2xpc3RzLnNsb255Lmlu
Zm8vcGlwZXJtYWlsL3Nsb255MS1nZW5lcmFsL2F0dGFjaG1lbnRzLzIwMDgwNjAyL2RlNWJmN2Q4
L2F0dGFjaG1lbnQuaHRtCg==
From m.eriksson at albourne.com  Tue Jun  3 04:08:47 2008
From: m.eriksson at albourne.com (Martin Eriksson)
Date: Tue Jun  3 04:09:21 2008
Subject: [Slony1-general] problem with slonik_move_set only changing the
 subscription on one node
Message-ID: <4845263F.5030401@albourne.com>

Hi,

Been trying out lots of things with slony lately. And i've run into a 
bit a problem when i move the origin. Its probably nothing serious, its 
probably just me doing it wrong.
running slony 1.2.14

got 2 machines. M1 and M2.
on M1 i got Origin (1) postgres 8.2.4
one M2 i got Slave 1 (2) postgres 8.3.1

replication is working successfull.

on M1 I add a second slave (3) Postgres 8.3.1 (diffrent port) add it 
using the "slonik_store_node" and then subscribe it to 1.
I update the slon config file on both machines to take into account the 
new node.

All data is replicated over successfully to 3.
Replication works correctly, insert a record on 1 is showed correctly on 
both 2 and 3.

I issue the "slonik_move_set" moving my set from 1 to 3 (on M1)

but it appear that it is only the subscription of 1 -> 3 that is changed 
to correctly be 3->1
but for some reason 1->2 remain as such!

but i get messages in log:
 BSTLOG:  unexpected EOF on client connection
 BSTNOTICE:  Slony-I: cleanup stale sl_nodelock entry for pid=9764

but that is all! that is on M2 where 2 resides.

replication continue to work afterwards but of course it will be chain 
instead of a master and two slaves. it will go 3 -> 1 -> 2

on the M2 if i try to issue the slonik_move_set again it will just say:
 PGRES_FATAL_ERROR select "_hfdb_cluster".lockSet(1); select 
"_hfdb_cluster".getMaxXid();  - ERROR:  Slony-I: set 1 does not 
originate on local node

which is correct since 1 is no longer the provider! except that 2 thinks 
it....

so for some reason it just doesn't like moving my node 2 subscription 
anyone got some ideas? permissions? but feels weird since everything 
else appear to be working correctly.


regards
Martin
From Marcin.Kasperski at softax.com.pl  Tue Jun  3 06:57:08 2008
From: Marcin.Kasperski at softax.com.pl (Marcin Kasperski)
Date: Tue Jun  3 07:00:09 2008
Subject: [Slony1-general] So ... must master be able to reach subscriber,
	or not?
Message-ID: <87hcca1v0r.fsf@softax.com.pl>


(just preparing to configure my first Slony setup and reading docs,
 which seem to contain different opinions)

There is machine MST on which master database runs.
There is machine CLI on which subscriber database is to run, from
which slonik scripts are to be executed just as most psql-s.

CLI is able to reach MST 

MST is *not* able to reach CLI (bah, it even can't address it at the
moment)

Will Slony-I work in such config, or not? 
After reading http://slony.info/documentation/plainpaths.html
I feel that it should, but a few other articles tend to require
any-to-any communication paths.

So - do master need a connection to subscriber?

And if so - for what?
(I understand that it would be needed if master had to read events
 from subscriber, also if I were to swap master with backup, but
 is this all?)


From pelin.01 at gmail.com  Tue Jun  3 07:07:16 2008
From: pelin.01 at gmail.com (pelin)
Date: Tue Jun  3 07:07:21 2008
Subject: [Slony1-general] consulta slon -regservice
Message-ID: <6a8366e40806030707p424df89av21eb62571a6b994f@mail.gmail.com>

Saludos a todos.
Soy novato en el uso de slony.
Estoy usando windows XP y 2003.
cuando ejecuto
C:\Archivos de programa\PostgreSQL\8.2\bin>slon -regservice Slony-I
Failed to create service: 1057
obtengo ese error en el Windows 2003 pero en el XP no tengo problemas.

He registrado la slevent.dll lo hace sin inconvenientes.
Lo hice como usuario administrador,tanto mediante terminal server como en
forma local pero nada.
espero puedan ayudarme.

Saludos!

Atentamente
Rolando Sergio Rodriguez
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080603/=
d2bc2a52/attachment.htm
From cbbrowne at ca.afilias.info  Tue Jun  3 08:12:40 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Tue Jun  3 08:12:50 2008
Subject: [Slony1-general] So ... must master be able to reach subscriber,
	or not?
In-Reply-To: <87hcca1v0r.fsf@softax.com.pl> (Marcin Kasperski's message of
	"Tue, 03 Jun 2008 15:57:08 +0200")
References: <87hcca1v0r.fsf@softax.com.pl>
Message-ID: <60d4mywo0n.fsf@dba2.int.libertyrms.com>

Marcin Kasperski <Marcin.Kasperski@softax.com.pl> writes:
> (just preparing to configure my first Slony setup and reading docs,
>  which seem to contain different opinions)
>
> There is machine MST on which master database runs.
> There is machine CLI on which subscriber database is to run, from
> which slonik scripts are to be executed just as most psql-s.
>
> CLI is able to reach MST 
>
> MST is *not* able to reach CLI (bah, it even can't address it at the
> moment)
>
> Will Slony-I work in such config, or not? 
> After reading http://slony.info/documentation/plainpaths.html
> I feel that it should, but a few other articles tend to require
> any-to-any communication paths.
>
> So - do master need a connection to subscriber?
>
> And if so - for what?
> (I understand that it would be needed if master had to read events
>  from subscriber, also if I were to swap master with backup, but
>  is this all?)

I assume here that you just have two databases, on two hosts, MST and
CLI.

It is necessary that the slon process managing node MST is able to
access both the MST and CLI hosts:

  - It is managing node MST, so obviously must access it;
  - It needs to be able to receive events and confirmations of events
    from node CLI.

Similarly, it is necessary that the slon process managing node CLI is
able to access both the MST and CLI hosts:

  - It is managing node CLI, so obviously must access it;
  - It needs to be able to receive events and confirmations of events
    from node MST.  With MST being the origin, it is also the case that
    this slon process will be drawing data from MST to replicate it to
    node CLI.

If CLI is able to reach MST, then you could presumably run the slon
processes managing both nodes on CLI.
-- 
select 'cbbrowne' || '@' || 'linuxfinances.info';
http://www3.sympatico.ca/cbbrowne/spreadsheets.html
(THASSERT (PLANNER RG))
                -- Example of HACKER statement.
From Marcin.Kasperski at softax.com.pl  Tue Jun  3 10:30:22 2008
From: Marcin.Kasperski at softax.com.pl (Marcin Kasperski)
Date: Tue Jun  3 10:26:44 2008
Subject: [Slony1-general] 
	Re: So ... must master be able to reach subscriber, or not?
References: <87hcca1v0r.fsf@softax.com.pl>
	<60d4mywo0n.fsf@dba2.int.libertyrms.com>
Message-ID: <8763sqtoi9.fsf@softax.com.pl>

> I assume here that you just have two databases, on two hosts, MST and
> CLI.

Yes. At least for the sake of this discussion.

> It is necessary that the slon process managing node MST is able to
> access both the MST and CLI hosts:
>
>   - It is managing node MST, so obviously must access it;
>   - It needs to be able to receive events and confirmations of events
>     from node CLI.

And here are my doubts. Do MST really needs to receive anything from CLI?
And what (which events and confirmations)?

Especially http://linuxfinances.info/info/plainpaths.html claims that
"You forcibly need to have a path between each subscriber node and its
provider; other paths are optional, and will not be used unless a
listen path in sl_listen. is needed that uses that particular path."

But, at the same time a few other docs claim what you do.

> If CLI is able to reach MST, then you could presumably run the slon
> processes managing both nodes on CLI.

I remember some strong advice against running slon across weak
connection. From http://linuxfinances.info/info/bestpractices.html:
"Each slon(1) should run on a host on the same local network as the
node that it is servicing, as it does a lot of communications with its
database" (...)  "slon(1) processes should run in the same "network
context" as the node that each is responsible for managing so that the
connection to that node is a "local" one. Do not run such links across
a WAN. "

-- 
----------------------------------------------------------------------
| Marcin Kasperski   |  In any large change, 1/3 will think it is
| http://mekk.waw.pl | great, 1/3 will think it is stupid, and 1/3
|                    |               will wait (Reed)
----------------------------------------------------------------------

From hannu at krosing.net  Tue Jun  3 11:38:59 2008
From: hannu at krosing.net (Hannu Krosing)
Date: Tue Jun  3 11:39:36 2008
Subject: [Slony1-general] So ... must master be able to reach
	subscriber, or not?
In-Reply-To: <87hcca1v0r.fsf@softax.com.pl>
References: <87hcca1v0r.fsf@softax.com.pl>
Message-ID: <1212518339.7453.3.camel@huvostro>

On Tue, 2008-06-03 at 15:57 +0200, Marcin Kasperski wrote:
> (just preparing to configure my first Slony setup and reading docs,
>  which seem to contain different opinions)
> 
> There is machine MST on which master database runs.
> There is machine CLI on which subscriber database is to run, from
> which slonik scripts are to be executed just as most psql-s.
> 
> CLI is able to reach MST 
> 
> MST is *not* able to reach CLI (bah, it even can't address it at the
> moment)

you have to have a connection both ways 

one way to do it is setting up a ssh tunnel from CLI:

ssh R:5555:127.0.0.1:5432 MST

and use host=127.0.0.1 post=5555 as masters address on client

> Will Slony-I work in such config, or not? 
> After reading http://slony.info/documentation/plainpaths.html
> I feel that it should, but a few other articles tend to require
> any-to-any communication paths.
> 
> So - do master need a connection to subscriber?
> 
> And if so - for what?
> (I understand that it would be needed if master had to read events
>  from subscriber, also if I were to swap master with backup, but
>  is this all?)
> 
> 
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general

From lists at serioustechnology.com  Thu Jun  5 10:13:37 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Thu Jun  5 10:13:46 2008
Subject: [Slony1-general] pulling data from a slave.
Message-ID: <48481EC1.8010107@serioustechnology.com>

We have the need to pull data from a slony slave.  Will it cause any 
problems if we add triggers/rules to perform this function, or does 
slony disable the ability to add triggers/rules to the slave?

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From ajs at crankycanuck.ca  Thu Jun  5 10:16:39 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Thu Jun  5 10:17:04 2008
Subject: [Slony1-general] pulling data from a slave.
In-Reply-To: <48481EC1.8010107@serioustechnology.com>
References: <48481EC1.8010107@serioustechnology.com>
Message-ID: <20080605171639.GC11131@crankycanuck.ca>

On Thu, Jun 05, 2008 at 01:13:37PM -0400, Geoffrey wrote:
> We have the need to pull data from a slony slave.  Will it cause any 
> problems if we add triggers/rules to perform this function, or does 
> slony disable the ability to add triggers/rules to the slave?

Have a look at the STORE TRIGGER command.

A
From lists at serioustechnology.com  Thu Jun  5 10:43:44 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Thu Jun  5 10:43:54 2008
Subject: [Slony1-general] pulling data from a slave.
In-Reply-To: <20080605171639.GC11131@crankycanuck.ca>
References: <48481EC1.8010107@serioustechnology.com>
	<20080605171639.GC11131@crankycanuck.ca>
Message-ID: <484825D0.6060805@serioustechnology.com>

Andrew Sullivan wrote:
> On Thu, Jun 05, 2008 at 01:13:37PM -0400, Geoffrey wrote:
>> We have the need to pull data from a slony slave.  Will it cause any 
>> problems if we add triggers/rules to perform this function, or does 
>> slony disable the ability to add triggers/rules to the slave?
> 
> Have a look at the STORE TRIGGER command.

I think I get the gist of this command, but I'm wondering if I'm missing 
something.  If I add a trigger to a slave after slony has been set up, 
but before any of the nodes have been subscribed, does slony still stop 
that trigger from firing?

I guess the real question is, when can I add these triggers?  Do they 
need to be in the database before I set slony up, or can I add them 
after replication has started.

My original intention was to have the replication process already in 
place, then add the triggers to the slave.

If I take this approach, do I still need to use the STORE TRIGGER command?


-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From ajs at crankycanuck.ca  Thu Jun  5 10:50:47 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Thu Jun  5 10:51:03 2008
Subject: [Slony1-general] pulling data from a slave.
In-Reply-To: <484825D0.6060805@serioustechnology.com>
References: <48481EC1.8010107@serioustechnology.com>
	<20080605171639.GC11131@crankycanuck.ca>
	<484825D0.6060805@serioustechnology.com>
Message-ID: <20080605175047.GD11131@crankycanuck.ca>

On Thu, Jun 05, 2008 at 01:43:44PM -0400, Geoffrey wrote:
> I think I get the gist of this command, but I'm wondering if I'm missing 
> something.  If I add a trigger to a slave after slony has been set up, 
> but before any of the nodes have been subscribed, does slony still stop 
> that trigger from firing?

No, subscribe the nodes first.  You don't want your trigger firing on every
row that the subscription copies over!

For a complicated setup like this, you _will_ need a testbed, so I strongly
suggest you build one.

A
From lists at serioustechnology.com  Thu Jun  5 10:57:33 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Thu Jun  5 10:57:44 2008
Subject: [Slony1-general] pulling data from a slave.
In-Reply-To: <20080605175047.GD11131@crankycanuck.ca>
References: <48481EC1.8010107@serioustechnology.com>	<20080605171639.GC11131@crankycanuck.ca>	<484825D0.6060805@serioustechnology.com>
	<20080605175047.GD11131@crankycanuck.ca>
Message-ID: <4848290D.1050609@serioustechnology.com>

Andrew Sullivan wrote:
> On Thu, Jun 05, 2008 at 01:43:44PM -0400, Geoffrey wrote:
>> I think I get the gist of this command, but I'm wondering if I'm missing 
>> something.  If I add a trigger to a slave after slony has been set up, 
>> but before any of the nodes have been subscribed, does slony still stop 
>> that trigger from firing?
> 
> No, subscribe the nodes first.  You don't want your trigger firing on every
> row that the subscription copies over!

Good point.  Question though, do I still need the STORE TRIGGER command 
in this situation?  That is, if I add new triggers to the slave database 
after I've started replicating, does slony stop those triggers from firing?

> For a complicated setup like this, you _will_ need a testbed, so I strongly
> suggest you build one.

Exactly, I'm working in our test environment now.  Test slave as well as 
test master.

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From ajs at crankycanuck.ca  Thu Jun  5 11:03:49 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Thu Jun  5 11:04:04 2008
Subject: [Slony1-general] pulling data from a slave.
In-Reply-To: <4848290D.1050609@serioustechnology.com>
References: <48481EC1.8010107@serioustechnology.com>
	<20080605171639.GC11131@crankycanuck.ca>
	<484825D0.6060805@serioustechnology.com>
	<20080605175047.GD11131@crankycanuck.ca>
	<4848290D.1050609@serioustechnology.com>
Message-ID: <20080605180349.GE11131@crankycanuck.ca>

On Thu, Jun 05, 2008 at 01:57:33PM -0400, Geoffrey wrote:
> 
> Good point.  Question though, do I still need the STORE TRIGGER command 
> in this situation?  That is, if I add new triggers to the slave database 
> after I've started replicating, does slony stop those triggers from firing?

You sure do.  If you don't, then when you go to do DDL later, things blow up
real good.

A

From cbbrowne at ca.afilias.info  Thu Jun  5 11:14:49 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Thu Jun  5 11:15:00 2008
Subject: [Slony1-general] pulling data from a slave.
In-Reply-To: <4848290D.1050609@serioustechnology.com> (Geoffrey's message of
	"Thu, 05 Jun 2008 13:57:33 -0400")
References: <48481EC1.8010107@serioustechnology.com>
	<20080605171639.GC11131@crankycanuck.ca>
	<484825D0.6060805@serioustechnology.com>
	<20080605175047.GD11131@crankycanuck.ca>
	<4848290D.1050609@serioustechnology.com>
Message-ID: <60od6fpx46.fsf@dba2.int.libertyrms.com>

Geoffrey <lists@serioustechnology.com> writes:
> Andrew Sullivan wrote:
>> On Thu, Jun 05, 2008 at 01:43:44PM -0400, Geoffrey wrote:
>>> I think I get the gist of this command, but I'm wondering if I'm
>>> missing something.  If I add a trigger to a slave after slony has
>>> been set up, but before any of the nodes have been subscribed, does
>>> slony still stop that trigger from firing?
>> No, subscribe the nodes first.  You don't want your trigger firing
>> on every
>> row that the subscription copies over!
>
> Good point.  Question though, do I still need the STORE TRIGGER
> command in this situation?  That is, if I add new triggers to the
> slave database after I've started replicating, does slony stop those
> triggers from firing?

It is useful to look at this from a "mechanical" perspective, that is,
from the basis of what Slony-I does.

The control that Slony-I imposes on triggers is as follows:

- When you run SET ADD TABLE against an origin node, Slony-I Slony-I runs
  alterTableForReplication() against each table.  This adds a function
  to each table to run the logtrigger() function.  Not directly
  germaine, but I'm being systematic, which means there should be
  fewer additional questions that need to be asked :-).

- When SUBSCRIBE SET runs on the subscriber, Slony-I runs
  alterTableForReplication() against each table.  (Just like on the
  origin.)

  Unlike on the origin, this does two things:
   - Adds the "denyaccess" trigger
   - Disables any triggers not declared via STORE TRIGGER and
     stored in the table sl_trigger.

- UNSUBSCRIBE SET / DROP NODE run alterTableRestore() against each
  table, which undoes the above (differing between origin + subscriber)

- EXECUTE SCRIPT does the following:
    - Runs alterTableRestore() against each table, putting things
      back into "original state," then
    - Runs the DDL script, then
    - Runs alterTableForReplication() against each table to put things
      back into 'replication mode'

This thus indicates 4 times when something can happen that will cause
Slony-I to "fiddle around" with the triggers.

If you add triggers to a subscriber after you start replicating, then
those triggers will immediately start to work as soon as you apply
them.

The "surprising" situation that could happen is that if you run a DDL
script the next day, those triggers will get shut off by
alterTableForReplication() at the end of the DDL script.

You may avoid that surprise by running STORE TRIGGER to indicate that
the trigger should be kept turned on.

Note that it is not important *when* you run STORE TRIGGER; you can
run it before the trigger exists, and that won't cause any problem.
Just be sure to run it before you run DDL or mess about with
subscriptions :-).

Note also that in v2.0, STORE TRIGGER goes away because there is a
much better "native" feature in PG 8.3 to allow for automating
activation/de-activation.

Given those 4 "times when things can happen," hopefully that allows
you to reason about what is going on.  That tends to be more useful
than taking a trajectory around the matter by needing to ask "20
questions :-)."
-- 
select 'cbbrowne' || '@' || 'linuxdatabases.info';
http://linuxdatabases.info/info/multiplexor.html
"It's a pretty rare beginner who isn't clueless.  If beginners weren't
clueless, the infamous Unix learning cliff wouldn't be a problem."
-- david parsons
From lists at serioustechnology.com  Thu Jun  5 11:59:33 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Thu Jun  5 11:59:45 2008
Subject: [Slony1-general] pulling data from a slave.
In-Reply-To: <60od6fpx46.fsf@dba2.int.libertyrms.com>
References: <48481EC1.8010107@serioustechnology.com>	<20080605171639.GC11131@crankycanuck.ca>	<484825D0.6060805@serioustechnology.com>	<20080605175047.GD11131@crankycanuck.ca>	<4848290D.1050609@serioustechnology.com>
	<60od6fpx46.fsf@dba2.int.libertyrms.com>
Message-ID: <48483795.2070506@serioustechnology.com>

Christopher Browne wrote:

> Given those 4 "times when things can happen," hopefully that allows
> you to reason about what is going on.  That tends to be more useful
> than taking a trajectory around the matter by needing to ask "20
> questions :-)."

Thanks for the extended explanation, it will likely save the list some 
bandwidth. ;)


-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From Gregory.Williamson at digitalglobe.com  Thu Jun  5 12:12:27 2008
From: Gregory.Williamson at digitalglobe.com (Gregory Williamson)
Date: Thu Jun  5 12:14:26 2008
Subject: [Slony1-general] pulling data from a slave.
References: <48481EC1.8010107@serioustechnology.com>	<20080605171639.GC11131@crankycanuck.ca>	<484825D0.6060805@serioustechnology.com>	<20080605175047.GD11131@crankycanuck.ca>	<4848290D.1050609@serioustechnology.com>
	<60od6fpx46.fsf@dba2.int.libertyrms.com>
	<48483795.2070506@serioustechnology.com>
Message-ID: <8B319E5A30FF4A48BE7EEAAF609DB233015E3A10@COMAIL01.digitalglobe.com>

Geoffrey wrote:
> =

> Christopher Browne wrote:
> =

> > Given those 4 "times when things can happen," hopefully that allows
> > you to reason about what is going on.  That tends to be more useful
> > than taking a trajectory around the matter by needing to ask "20
> > questions :-)."
> =

> Thanks for the extended explanation, it will likely save the list some =

> bandwidth. ;)

Very useful description -- +1 to the +1.

Thanks!

Greg Williamson
Senior DBA
DigitalGlobe

Confidentiality Notice: This e-mail message, including any attachments, is =
for the sole use of the intended recipient(s) and may contain confidential =
and privileged information and must be protected in accordance with those p=
rovisions. Any unauthorized review, use, disclosure or distribution is proh=
ibited. If you are not the intended recipient, please contact the sender by=
 reply e-mail and destroy all copies of the original message.

(My corporate masters made me say this.)



-- =

Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
_______________________________________________
Slony1-general mailing list
Slony1-general@lists.slony.info
http://lists.slony.info/mailman/listinfo/slony1-general

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080605/=
3553ddf7/attachment.htm
From dquiroga at integratech.com.ar  Thu Jun  5 12:12:48 2008
From: dquiroga at integratech.com.ar (damian quiroga)
Date: Thu Jun  5 12:15:13 2008
Subject: [Slony1-general] Memory leak in slony1-1.2.10?
Message-ID: <1212693168.3640.8.camel@localhost>

Hi

I'm using slony1-1.2.10, Linux spec-2 2.6.22-gentoo-r5,
postgresql-8.2.4-r1, libpq-8.2.4, libpqxx-2.6.8

If I follow the steps in "Replicating Your First Database", and then
check for the memory usage of the slon processes using ps I notice that
the RSS of each one (the worker process for pgbench and the worker
process for pgbenchslave) increases in 4 kilobytes about every 2
minutes.

I ran the test again with valgrind and the results show in the summary
for the slon process for the "master" node:
(...)
==00:00:02:02.047 2024== 2,280 bytes in 19 blocks are definitely lost in
loss record 16 of 17
==00:00:02:02.047 2024==    at 0x4022998: malloc
(in /usr/lib/valgrind/x86-linux/vgpreload_memcheck.so)
==00:00:02:02.047 2024==    by 0x403158A: PQmakeEmptyPGresult
(in /usr/lib/libpq.so.5.0)
==00:00:02:02.047 2024==    by 0x403A1EC: (within /usr/lib/libpq.so.5.0)
==00:00:02:02.047 2024==    by 0x4030623: (within /usr/lib/libpq.so.5.0)
==00:00:02:02.047 2024==    by 0x40321B5: PQgetResult
(in /usr/lib/libpq.so.5.0)
==00:00:02:02.047 2024==    by 0x403235A: (within /usr/lib/libpq.so.5.0)
==00:00:02:02.047 2024==    by 0x804F936: remoteListenThread_main
(remote_listen.c:262)
==00:00:02:02.047 2024==    by 0x4051FFA: start_thread
(in /lib/libpthread-2.5.so)
==00:00:02:02.047 2024==    by 0x412195D: clone (in /lib/libc-2.5.so)

In the summary for the slon process for the "slave" node:
(...)
==00:00:02:02.080 2036== 30,824 (4,200 direct, 26,624 indirect) bytes in
35 blocks are definitely lost in loss record 19 of 20
==00:00:02:02.080 2036==    at 0x4022998: malloc
(in /usr/lib/valgrind/x86-linux/vgpreload_memcheck.so)
==00:00:02:02.080 2036==    by 0x403158A: PQmakeEmptyPGresult
(in /usr/lib/libpq.so.5.0)
==00:00:02:02.081 2036==    by 0x403A21A: (within /usr/lib/libpq.so.5.0)
==00:00:02:02.081 2036==    by 0x4030623: (within /usr/lib/libpq.so.5.0)
==00:00:02:02.081 2036==    by 0x40321B5: PQgetResult
(in /usr/lib/libpq.so.5.0)
==00:00:02:02.081 2036==    by 0x403235A: (within /usr/lib/libpq.so.5.0)
==00:00:02:02.081 2036==    by 0x8058E4F: remoteWorkerThread_main
(remote_worker.c:2938)
==00:00:02:02.081 2036==    by 0x4051FFA: start_thread
(in /lib/libpthread-2.5.so)
==00:00:02:02.081 2036==    by 0x412195D: clone (in /lib/libc-2.5.so)

The line remote_listen.c:262 is
	res = PQexec(dbconn, dstring_data(&query1));
for which PQclear() is only called if (PQresultStatus(res) !=
PGRES_COMMAND_OK)

And the line remote_worker.c:2938 is
	res4 = PQexec(loc_dbconn, dstring_data(&query2));
for which again PQclear() is only called if (PQresultStatus(res4) !=
PGRES_COMMAND_OK)

Shouldn't PQClear() be also called when the query is successful?

I tried adding the PQClear() calls and running the test again. The
results were that the 4 kilobytes increases in memory usage are now more
unfrequent (about every 10 minutes). But I don't know whether doing that
is correct or not. So my doubts are:
a) Are those really a memory leaks?
b) Is that the correct way to fix them?

Thanks in advance,

-- 
Dami?n Quiroga
Integratech S.A


From lists at serioustechnology.com  Thu Jun  5 13:58:48 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Thu Jun  5 13:59:04 2008
Subject: [Slony1-general] adding tables/triggers to a slony slave
In-Reply-To: <20080530165618.GB11328@crankycanuck.ca>
References: <484018E6.60208@serioustechnology.com>
	<20080530155041.GA11328@crankycanuck.ca>
	<48402E1D.5000402@serioustechnology.com>
	<20080530165618.GB11328@crankycanuck.ca>
Message-ID: <48485388.9070701@serioustechnology.com>

Andrew Sullivan wrote:
> On Fri, May 30, 2008 at 12:41:01PM -0400, Geoffrey wrote:
>> Are you saying that if we set the slony triggers to 'always fire', the 
>> will not fire if we 'disable all triggers?'
> 
> As far as I know, even the changes in 8.3 don't allow you to say, "Even if I
> tell you to do so later, don't stop firing this trigger."  You could just
> disable the _other_ triggers.

I have a better understanding as to how this whole process is supposed
to work, thus I want to present it here to make sure it will work.

We intend to execute the following on all slony triggers:

ALTER TABLE foo ENABLE ALWAYS TRIGGER bar;

Assuming this will cause the slony triggers to fire when we do the 
following to disable our triggers:

SET session_replication_role TO 'replica';


The reason we have to do this is because we have a distributed database 
system.  That is, we have multiple databases that have a mechanism that 
causes communications between these databases.

Short example.

User creates a record that must be distributed across all the databases. 
  There is a trigger that recognizes this occurence and therefore 
generates a record in another database that will be eventually 
distributed to the other databases.  There is a process that reads these 
records and then distributes them.  The problem is we need to make sure 
that when this process distributes them to the other databases, new 
records are not created to redistribute these records.

Granted, there's a flaw in that approach, and it's on the schedule to be 
fixed, but we've got to get the replication going first.

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin

From lists at serioustechnology.com  Thu Jun  5 14:00:25 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Thu Jun  5 14:00:41 2008
Subject: [Slony1-general] does subscribing a node create triggers?
Message-ID: <484853E9.9070807@serioustechnology.com>

I am trying to figure out at what point slony triggers are added to the 
master node.  I'm assuming that they will be their prior to node 
subscription.  Is this a correct assumption?

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From ahodgson at simkin.ca  Thu Jun  5 14:32:14 2008
From: ahodgson at simkin.ca (Alan Hodgson)
Date: Thu Jun  5 14:32:32 2008
Subject: [Slony1-general] does subscribing a node create triggers?
In-Reply-To: <484853E9.9070807@serioustechnology.com>
References: <484853E9.9070807@serioustechnology.com>
Message-ID: <200806051432.14710@hal.medialogik.com>

On Thursday 05 June 2008, Geoffrey <lists@serioustechnology.com> wrote:
> I am trying to figure out at what point slony triggers are added to the
> master node.  I'm assuming that they will be their prior to node
> subscription.  Is this a correct assumption?

Yeah, they get added when you do SET ADD TABLE.

-- 
Alan
From scetbon at echo.fr  Fri Jun  6 02:44:50 2008
From: scetbon at echo.fr (Cyril SCETBON)
Date: Fri Jun  6 02:45:21 2008
Subject: [Slony1-general] slonik segfault
Message-ID: <48490712.6070202@echo.fr>

Hi guys,

When I try to create a lot of set slonik dies with segmentation fault 
message. The only way to succeed is to split the file containing the 
create set statement and to try them one by one or two by two. When I 
use strace on slonik it displays :

read(3, "#--\n# Slony-I organizes tables i"..., 8192) = 8192
read(3, "d table (set id=5, origin=201, i"..., 8192) = 8192
read(3, ");\nset add table (set id=9, orig"..., 8192) = 8192
mmap(NULL, 18446744073709547520, PROT_READ|PROT_WRITE, 
MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = -1 ENOMEM (Cannot allocate memory)

Is there a maximum number of lines ? a memory parameter to use with slonik ?

thanks
-- 
Cyril SCETBON
From scetbon at echo.fr  Fri Jun  6 02:46:18 2008
From: scetbon at echo.fr (Cyril SCETBON)
Date: Fri Jun  6 02:46:47 2008
Subject: [Slony1-general] slonik segfault
In-Reply-To: <48490712.6070202@echo.fr>
References: <48490712.6070202@echo.fr>
Message-ID: <4849076A.80806@echo.fr>

FYI, I'm using version 1.2.10

Cyril SCETBON wrote:
> Hi guys,
>
> When I try to create a lot of set slonik dies with segmentation fault 
> message. The only way to succeed is to split the file containing the 
> create set statement and to try them one by one or two by two. When I 
> use strace on slonik it displays :
>
> read(3, "#--\n# Slony-I organizes tables i"..., 8192) = 8192
> read(3, "d table (set id=5, origin=201, i"..., 8192) = 8192
> read(3, ");\nset add table (set id=9, orig"..., 8192) = 8192
> mmap(NULL, 18446744073709547520, PROT_READ|PROT_WRITE, 
> MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = -1 ENOMEM (Cannot allocate memory)
>
> Is there a maximum number of lines ? a memory parameter to use with 
> slonik ?
>
> thanks

-- 
Cyril SCETBON
From Marcin.Kasperski at softax.com.pl  Fri Jun  6 05:22:20 2008
From: Marcin.Kasperski at softax.com.pl (Marcin Kasperski)
Date: Fri Jun  6 06:08:26 2008
Subject: [Slony1-general] MOVE SET should warn that it proceeeds async...
Message-ID: <873anqvjlv.fsf@platon.mekk.waw.pl>

Well, I had my moment of doubt.

I configured simple replication config of 3 databases, then tried MOVE
SET to change the master node (using standard LOCK SET and MOVE SET
combo as suggested by slonik_move_set).

Everything worked correctly and without errors. Then I tried updates and
... on new master I got

ERROR:  Slony-I: Table msg is replicated and cannot be modified on a subscriber node

Tried on old master to make it sure, got the same error there too.

I started to write some call for help, but after ~ a few minutes the new master
finally started to accept updates.

I think it would make sense to add a sentence or two to the docs warning about
this effect.... (I believe the fact that I use weak machine increased the delay,
but the bare fact that this is async matters)

From m.eriksson at albourne.com  Fri Jun  6 06:23:52 2008
From: m.eriksson at albourne.com (Martin Eriksson)
Date: Fri Jun  6 06:24:00 2008
Subject: [Slony1-general] MOVE SET should warn that it proceeeds async...
In-Reply-To: <873anqvjlv.fsf@platon.mekk.waw.pl>
References: <873anqvjlv.fsf@platon.mekk.waw.pl>
Message-ID: <48493A68.8010307@albourne.com>

Hi Marcin,

could you test one thing as well see if you get same problem as I had (a 
few threads down)

if you try to issue "slonik_drop_node" on your previous master node does 
it work? mine didn't as its claiming its still used, but maybe its the 
same problem as you had and its just taking LONG to change the 
subscription on my second slave...

but I think i let it sit for some time...


Marcin Kasperski wrote:
> Well, I had my moment of doubt.
>
> I configured simple replication config of 3 databases, then tried MOVE
> SET to change the master node (using standard LOCK SET and MOVE SET
> combo as suggested by slonik_move_set).
>
> Everything worked correctly and without errors. Then I tried updates and
> ... on new master I got
>
> ERROR:  Slony-I: Table msg is replicated and cannot be modified on a subscriber node
>
> Tried on old master to make it sure, got the same error there too.
>
> I started to write some call for help, but after ~ a few minutes the new master
> finally started to accept updates.
>
> I think it would make sense to add a sentence or two to the docs warning about
> this effect.... (I believe the fact that I use weak machine increased the delay,
> but the bare fact that this is async matters)
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>   

From scetbon at echo.fr  Fri Jun  6 06:31:59 2008
From: scetbon at echo.fr (Cyril SCETBON)
Date: Fri Jun  6 06:32:17 2008
Subject: [Slony1-general] slonik segfault
In-Reply-To: <4849076A.80806@echo.fr>
References: <48490712.6070202@echo.fr> <4849076A.80806@echo.fr>
Message-ID: <48493C4F.3080001@echo.fr>

the same script but with blank lines and comment (beginning with # 
character) resolve the issue. It's certainly related to the number of 
consecutive statements. Is it a known BUG ?

Cyril SCETBON wrote:
> FYI, I'm using version 1.2.10
>
> Cyril SCETBON wrote:
>> Hi guys,
>>
>> When I try to create a lot of set slonik dies with segmentation fault 
>> message. The only way to succeed is to split the file containing the 
>> create set statement and to try them one by one or two by two. When I 
>> use strace on slonik it displays :
>>
>> read(3, "#--\n# Slony-I organizes tables i"..., 8192) = 8192
>> read(3, "d table (set id=5, origin=201, i"..., 8192) = 8192
>> read(3, ");\nset add table (set id=9, orig"..., 8192) = 8192
>> mmap(NULL, 18446744073709547520, PROT_READ|PROT_WRITE, 
>> MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = -1 ENOMEM (Cannot allocate memory)
>>
>> Is there a maximum number of lines ? a memory parameter to use with 
>> slonik ?
>>
>> thanks
>

-- 
Cyril SCETBON
From lists at serioustechnology.com  Fri Jun  6 06:32:33 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Fri Jun  6 06:32:38 2008
Subject: [Slony1-general] does subscribing a node create triggers?
In-Reply-To: <200806051432.14710@hal.medialogik.com>
References: <484853E9.9070807@serioustechnology.com>
	<200806051432.14710@hal.medialogik.com>
Message-ID: <48493C71.1060406@serioustechnology.com>

Alan Hodgson wrote:
> On Thursday 05 June 2008, Geoffrey <lists@serioustechnology.com> wrote:
>> I am trying to figure out at what point slony triggers are added to the
>> master node.  I'm assuming that they will be their prior to node
>> subscription.  Is this a correct assumption?
> 
> Yeah, they get added when you do SET ADD TABLE.

Thanks for that.  I'm concerned that I don't see any new triggers on my 
replicated tables in my node 2 database.  I see the following in my node 
1 (master) though:

_master_cluster_logtrigger_1 AFTER INSERT OR DELETE OR UPDATE ON avlds 
FOR EACH ROW EXECUTE PROCEDURE 
_master_cluster.logtrigger('_master_cluster', '1', 'kv
vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv')

I have run the following slonik scripts:

slonik_init_cluster --config $CONFIG

slon_start --config $CONFIG 1
slon_start --config $CONFIG 2

slonik_create_set --config $CONFIG 1
slonik_create_set --config $CONFIG 2

As far as I can see, all that's left is to subscribe the sets, shouldn't 
there be new slony triggers on replicated tables in the NODE 2 database?


-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From Marcin.Kasperski at softax.com.pl  Fri Jun  6 07:10:22 2008
From: Marcin.Kasperski at softax.com.pl (Marcin Kasperski)
Date: Fri Jun  6 07:06:22 2008
Subject: [Slony1-general] Re: MOVE SET should warn that it proceeeds async...
References: <873anqvjlv.fsf@platon.mekk.waw.pl> <48493A68.8010307@albourne.com>
Message-ID: <87od6er6wh.fsf@softax.com.pl>

> if you try to issue "slonik_drop_node" on your previous master node
> does it work?

Yes, I already did it on the previous configuration.

> mine didn't as its claiming its still used, but maybe
> its the same problem as you had and its just taking LONG to change the
> subscription on my second slave...

It went rather slow (a few mins on small database), but worked.

Not sure whether this is related but earlier to move the node
I had to kill some programs running on the same postgres instance
(in spite of the fact that they worked on unrelated database)

PS Maybe your database is not yet fully synchronized? Drop node
will wait until earlier things are processed...

From m.eriksson at albourne.com  Fri Jun  6 07:56:32 2008
From: m.eriksson at albourne.com (Martin Eriksson)
Date: Fri Jun  6 07:56:40 2008
Subject: [Slony1-general] Re: MOVE SET should warn that it proceeeds
	async...
In-Reply-To: <87od6er6wh.fsf@softax.com.pl>
References: <873anqvjlv.fsf@platon.mekk.waw.pl>
	<48493A68.8010307@albourne.com> <87od6er6wh.fsf@softax.com.pl>
Message-ID: <48495020.7050706@albourne.com>

hmm could be i've missunderstood something...

but it appears that move set does not change all the subscriptions to 
the orgin node?

It appear that if i got
1 -> 3
1 -> 2

and i do move set
from 1-> 3

1 will subscribe from 3, but 2 will continue to subscribe from 1.

how should I go about moving subscription on node 2 to point to 3 instead?

But I would think that changing the origin should change all the 
subscriptions but it appear not to do that.. from the manual:

"After this command, the set cannot be unlocked on the old origin any 
more. The old origin will continue as a forwarding subscriber of the set 
and the subscription chain from the old origin to the new origin will be 
reversed"

so that would just mean it just changes that specific provider <-> 
subscriber link not all of them?



Marcin Kasperski wrote:
>> if you try to issue "slonik_drop_node" on your previous master node
>> does it work?
>>     
>
> Yes, I already did it on the previous configuration.
>
>   
>> mine didn't as its claiming its still used, but maybe
>> its the same problem as you had and its just taking LONG to change the
>> subscription on my second slave...
>>     
>
> It went rather slow (a few mins on small database), but worked.
>
> Not sure whether this is related but earlier to move the node
> I had to kill some programs running on the same postgres instance
> (in spite of the fact that they worked on unrelated database)
>
> PS Maybe your database is not yet fully synchronized? Drop node
> will wait until earlier things are processed...
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>   

From lists at serioustechnology.com  Fri Jun  6 08:04:57 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Fri Jun  6 08:05:02 2008
Subject: [Slony1-general] does subscribing a node create triggers?
In-Reply-To: <48493C71.1060406@serioustechnology.com>
References: <484853E9.9070807@serioustechnology.com>	<200806051432.14710@hal.medialogik.com>
	<48493C71.1060406@serioustechnology.com>
Message-ID: <48495219.5020702@serioustechnology.com>

Geoffrey wrote:

> As far as I can see, all that's left is to subscribe the sets, shouldn't 
> there be new slony triggers on replicated tables in the NODE 2 database?

I found the answer to my own question.  Seems that the triggers are not 
created in the NODE 2 database until I run the slonik_subscribe_set script.

After running it, I now see the following trigger:

_pro_cluster_denyaccess_1 BEFORE INSERT OR DELETE OR UPDATE ON avlds FOR EAC
H ROW EXECUTE PROCEDURE _pro_cluster.denyaccess('_pro_cluster')

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From cbbrowne at ca.afilias.info  Fri Jun  6 08:46:35 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri Jun  6 08:46:43 2008
Subject: [Slony1-general] slonik segfault
In-Reply-To: <48490712.6070202@echo.fr> (Cyril SCETBON's message of "Fri,
	06 Jun 2008 11:44:50 +0200")
References: <48490712.6070202@echo.fr>
Message-ID: <60lk1io9b8.fsf@dba2.int.libertyrms.com>

Cyril SCETBON <scetbon@echo.fr> writes:
> When I try to create a lot of set slonik dies with segmentation fault
> message. The only way to succeed is to split the file containing the
> create set statement and to try them one by one or two by two. When I
> use strace on slonik it displays :
>
> read(3, "#--\n# Slony-I organizes tables i"..., 8192) = 8192
> read(3, "d table (set id=5, origin=201, i"..., 8192) = 8192
> read(3, ");\nset add table (set id=9, orig"..., 8192) = 8192
> mmap(NULL, 18446744073709547520, PROT_READ|PROT_WRITE,
> MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = -1 ENOMEM (Cannot allocate memory)
>
> Is there a maximum number of lines ? a memory parameter to use with slonik ?
>
> thanks

We're using Bison to generate the parser, and it normally doesn't
present any particular fixed limits on how much data it can handle.

I just ran a test run where I created 500 tables and then added them,
in one fell swoop, to replication, using the sample script...
Attached is a patch that may be applied to the sample script in the
Slony-I source tree to get the same results.

With 500 tables to set up and copy, even though they were empty, it
took 452 seconds to apply the subscription.  (Cheap desktop PC :-).)

I encountered no problems.  Might there be something odd about your
platform where your OS defines stack size for programs to be rather
small?  That doesn't make *much* sense; if such an effect were
breaking slonik, then it ought to be breaking other things, like maybe
your PostgreSQL instance!

Here's an excerpt of the set creation slonik script:

include </tmp/slonytest-temp.A24149/preamble.slonik>;
create set (id=1, origin=1, comment='SLONTEST82 Tables and Sequences');
set add table (id=1, set id=1, origin=1, fully qualified name='public.t1', comment='SLONTEST82 table public.t1');
set add table (id=2, set id=1, origin=1, fully qualified name='public.t2', comment='SLONTEST82 table public.t2');
set add table (id=3, set id=1, origin=1, fully qualified name='public.t3', comment='SLONTEST82 table public.t3');
set add table (id=4, set id=1, origin=1, fully qualified name='public.t4', comment='SLONTEST82 table public.t4');
set add table (id=5, set id=1, origin=1, fully qualified name='public.t5', comment='SLONTEST82 table public.t5');
...
set add table (id=494, set id=1, origin=1, fully qualified name='public.t494', comment='SLONTEST82 table public.t494');
set add table (id=495, set id=1, origin=1, fully qualified name='public.t495', comment='SLONTEST82 table public.t495');
set add table (id=496, set id=1, origin=1, fully qualified name='public.t496', comment='SLONTEST82 table public.t496');
set add table (id=497, set id=1, origin=1, fully qualified name='public.t497', comment='SLONTEST82 table public.t497');
set add table (id=498, set id=1, origin=1, fully qualified name='public.t498', comment='SLONTEST82 table public.t498');
set add table (id=499, set id=1, origin=1, fully qualified name='public.t499', comment='SLONTEST82 table public.t499');
set add table (id=500, set id=1, origin=1, fully qualified name='public.t500', comment='SLONTEST82 table public.t500');
set add sequence (id=1, set id=1, origin=1, fully qualified name='public.t1_id_seq', comment='SLONTEST82 sequence public.t1_id_seq');
set add sequence (id=2, set id=1, origin=1, fully qualified name='public.t2_id_seq', comment='SLONTEST82 sequence public.t2_id_seq');
set add sequence (id=3, set id=1, origin=1, fully qualified name='public.t3_id_seq', comment='SLONTEST82 sequence public.t3_id_seq');
set add sequence (id=4, set id=1, origin=1, fully qualified name='public.t4_id_seq', comment='SLONTEST82 sequence public.t4_id_seq');
set add sequence (id=5, set id=1, origin=1, fully qualified name='public.t5_id_seq', comment='SLONTEST82 sequence public.t5_id_seq');
set add sequence (id=6, set id=1, origin=1, fully qualified name='public.t6_id_seq', comment='SLONTEST82 sequence public.t6_id_seq');
set add sequence (id=7, set id=1, origin=1, fully qualified name='public.t7_id_seq', comment='SLONTEST82 sequence public.t7_id_seq');
...
set add sequence (id=496, set id=1, origin=1, fully qualified name='public.t496_id_seq', comment='SLONTEST82 sequence public.t496_id_seq');
set add sequence (id=497, set id=1, origin=1, fully qualified name='public.t497_id_seq', comment='SLONTEST82 sequence public.t497_id_seq');
set add sequence (id=498, set id=1, origin=1, fully qualified name='public.t498_id_seq', comment='SLONTEST82 sequence public.t498_id_seq');
set add sequence (id=499, set id=1, origin=1, fully qualified name='public.t499_id_seq', comment='SLONTEST82 sequence public.t499_id_seq');
set add sequence (id=500, set id=1, origin=1, fully qualified name='public.t500_id_seq', comment='SLONTEST82 sequence public.t500_id_seq');

Here's the CVS diff:

chris@dba2:Slony-I/CMD/slony1-1.2/tools> cvs diff -u configure-replication.sh
Index: configure-replication.sh
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/tools/configure-replication.sh,v
retrieving revision 1.1.2.4
diff -c -u -r1.1.2.4 configure-replication.sh
cvs diff: conflicting specifications of output style
--- configure-replication.sh	6 Mar 2008 18:49:03 -0000	1.1.2.4
+++ configure-replication.sh	6 Jun 2008 15:43:33 -0000
@@ -6,6 +6,13 @@
 NUMNODES=${NUMNODES:-"2"}
 
 # Defaults - origin node
+DB1=db1
+DB2=db2
+HOST1=localhost
+HOST2=localhost
+PORT1=5882
+PORT2=5882
+
 DB1=${DB1:-${PGDATABASE:-"slonytest"}}
 HOST1=${HOST1:-`hostname`}
 USER1=${USER1:-${PGUSER:-"slony"}}
@@ -117,15 +124,18 @@
  recurringemail recurringprint session shipto sic status tax
  transactions translation vendor vendortax warehouse yearend"
 
+ALTTABLES1=""
+ALTSEQUENCES1=""
+for i in `seq 500`; do
+   ALTTABLES1="$ALTTABLES1 t${i}"
+   ALTSEQUENCES1="$ALTSEQUENCES1 t${i}_id_seq"
+   psql -h $HOST1 -p $PORT1 -d $DB1 -c "create table t${i} (id serial primary key, data text not null unique);"
+   psql -h $HOST2 -p $PORT2 -d $DB2 -c "create table t${i} (id serial primary key, data text not null unique);"
+done
+
 for t in `echo $ALTTABLES1`; do
   ALTTABLES="$ALTTABLES public.${t}"
 done
-  
-ALTSEQUENCES1="acc_trans_entry_id_seq audittrail_entry_id_seq
- custom_field_catalog_field_id_seq custom_table_catalog_table_id_seq
- id inventory_entry_id_seq invoiceid jcitemsid orderitemsid
- partscustomer_entry_id_seq partsvendor_entry_id_seq
- session_session_id_seq shipto_entry_id_seq"
 
 for s in `echo $ALTSEQUENCES1`; do
   ALTSEQUENCES="$ALTSEQUENCES public.${s}"

-- 
(format nil "~S@~S" "cbbrowne" "linuxdatabases.info")
http://linuxfinances.info/info/spiritual.html
"The program is manufactured by Quantel, a Silicon Valley company
located in Clearwater, Florida."
From cbbrowne at ca.afilias.info  Fri Jun  6 08:47:48 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri Jun  6 08:47:55 2008
Subject: [Slony1-general] does subscribing a node create triggers?
In-Reply-To: <48493C71.1060406@serioustechnology.com> (Geoffrey's message of
	"Fri, 06 Jun 2008 09:32:33 -0400")
References: <484853E9.9070807@serioustechnology.com>
	<200806051432.14710@hal.medialogik.com>
	<48493C71.1060406@serioustechnology.com>
Message-ID: <60hcc6o997.fsf@dba2.int.libertyrms.com>

Geoffrey <lists@serioustechnology.com> writes:
> Alan Hodgson wrote:
>> On Thursday 05 June 2008, Geoffrey <lists@serioustechnology.com> wrote:
>>> I am trying to figure out at what point slony triggers are added to the
>>> master node.  I'm assuming that they will be their prior to node
>>> subscription.  Is this a correct assumption?
>> Yeah, they get added when you do SET ADD TABLE.
>
> Thanks for that.  I'm concerned that I don't see any new triggers on
> my replicated tables in my node 2 database.  I see the following in my
> node 1 (master) though:
>
> _master_cluster_logtrigger_1 AFTER INSERT OR DELETE OR UPDATE ON avlds
> FOR EACH ROW EXECUTE PROCEDURE
> _master_cluster.logtrigger('_master_cluster', '1', 'kv
> vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv')
>
> I have run the following slonik scripts:
>
> slonik_init_cluster --config $CONFIG
>
> slon_start --config $CONFIG 1
> slon_start --config $CONFIG 2
>
> slonik_create_set --config $CONFIG 1
> slonik_create_set --config $CONFIG 2
>
> As far as I can see, all that's left is to subscribe the sets,
> shouldn't there be new slony triggers on replicated tables in the NODE
> 2 database?

The triggers on subscribers do not get set up until you run "subscribe
set."
-- 
(format nil "~S@~S" "cbbrowne" "linuxfinances.info")
http://linuxfinances.info/info/oses.html
"Natives who beat drums to drive off evil spirits are objects of scorn
to smart Americans who blow horns to break up traffic jams."
-- Unknown
From lists at serioustechnology.com  Fri Jun  6 09:05:23 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Fri Jun  6 09:05:31 2008
Subject: [Slony1-general] What mechanism actually causes replication?
Message-ID: <48496043.8060201@serioustechnology.com>

I can't seem to figure out what 'mechanism' actually causes replication. 
  That may be a too simplistic view of the whole process, but the bottom 
line is, I have to make sure that our manipulation of the 
'session_replication_role' is going to properly address the issue of 
insuring slony continues to replicate our data.

Is it the '_pro_cluster_logtrigger_1' trigger in the NODE 1 Database 
that is responsible for the actual replication process?

That is, if I do the following:

ALTER TABLE foo ENABLE ALWAYS TRIGGER _pro_cluster_logtrigger_1;

I'm assuming that the replication will not be interrupted as this 
trigger will always fire regardless of the 'session_replication_role' 
setting.

Another way of putting it is, is it the '*_logtrigger_1' trigger that is 
added to replicated tables responsible (directly or indirectly) for the 
actual replication of data.

I say 'directly or indirectly' as I see that this trigger runs the 
procedure _pro_cluster.logtrigger, and without looking into that 
procedure mechanism, it's possible that it has a cascading effect that 
ultimately effects the replication of data.

Please understand, I realize our current approach is not the best 
solution, but, I don't set the priorities and replication is higher on 
the list, then changing the way our application works.


-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From kevin at kevinkempterllc.com  Fri Jun  6 13:04:52 2008
From: kevin at kevinkempterllc.com (kevin kempter)
Date: Fri Jun  6 13:05:05 2008
Subject: [Slony1-general] how to add a new table to an existing replication
	set ?
Message-ID: <55B4FF41-60EA-432A-B97F-3B67CE5F57B0@kevinkempterllc.com>

Hi List;

I have a new setup (testing) with a single table in the rep set. I  
want to add a second table to the rep set, I thought I could do this:


#!/bin/bash

. slony.dg.env


echo "PATH= [$PATH]"

slonik <<_EOF_

cluster name = $CLUSTERNAME;

node 1 admin conninfo = 'dbname=$MASTERDBNAME host=$MASTERHOST port= 
$MASTERPORT user=$REPUSER';
node 2 admin conninfo = 'dbname=$SLAVEDBNAME host=$SLAVEHOST port= 
$SLAVEPORT user=$REPUSER';

set add table ( set id=1, origin=1, id=2, fully qualified name =  
'paneon0.database_version');


_EOF_




However, when I run the above script I get this:

<stdin>:7: PGRES_FATAL_ERROR select "_dg_cluster".setAddTable(1, 2,  
'paneon0.database_version', 'database_version_pk',  
'paneon0.database_version');  - ERROR:  Slony-I: cannot add table to  
currently subscribed set 1


Any thoughts ?


Thanks in advance


/Kevin
From cbbrowne at ca.afilias.info  Fri Jun  6 13:46:45 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri Jun  6 13:47:02 2008
Subject: [Slony1-general] Re: MOVE SET should warn that it proceeeds
	async...
In-Reply-To: <48495020.7050706@albourne.com> (Martin Eriksson's message of
	"Fri, 06 Jun 2008 17:56:32 +0300")
References: <873anqvjlv.fsf@platon.mekk.waw.pl>
	<48493A68.8010307@albourne.com> <87od6er6wh.fsf@softax.com.pl>
	<48495020.7050706@albourne.com>
Message-ID: <60ve0mmgui.fsf@dba2.int.libertyrms.com>

Martin Eriksson <m.eriksson@albourne.com> writes:
> hmm could be i've missunderstood something...
>
> but it appears that move set does not change all the subscriptions to
> the orgin node?
>
> It appear that if i got
> 1 -> 3
> 1 -> 2
>
> and i do move set
> from 1-> 3
>
> 1 will subscribe from 3, but 2 will continue to subscribe from 1.
>
> how should I go about moving subscription on node 2 to point to 3 instead?

You can submit a SUBSCRIBE SET request to point node #2 to use node
#3.

Slony-I doesn't assume that *everything* should get redirected; it
tends to do the minimal change (which is, after all, what you asked
for!).  This is, in effect, the difference between DWIS and DWIM, that
is, Do What I Say versus Do What I Mean.

Historically, systems that try to implement DWIM tend to be rather
less predictable than those implementing DWIS, because their behaviour
has rather more complex policy bundled into it.
-- 
let name="cbbrowne" and tld="linuxfinances.info" in name ^ "@" ^ tld;;
http://linuxfinances.info/info/nonrdbms.html
Never take life seriously. Nobody gets out alive anyway. 
From cbbrowne at ca.afilias.info  Fri Jun  6 13:52:16 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri Jun  6 13:52:29 2008
Subject: [Slony1-general] What mechanism actually causes replication?
In-Reply-To: <48496043.8060201@serioustechnology.com> (Geoffrey's message of
	"Fri, 06 Jun 2008 12:05:23 -0400")
References: <48496043.8060201@serioustechnology.com>
Message-ID: <60r6bamglb.fsf@dba2.int.libertyrms.com>

Geoffrey <lists@serioustechnology.com> writes:
> I can't seem to figure out what 'mechanism' actually causes
> replication. That may be a too simplistic view of the whole process,
> but the bottom line is, I have to make sure that our manipulation of
> the 'session_replication_role' is going to properly address the issue
> of insuring slony continues to replicate our data.
>
> Is it the '_pro_cluster_logtrigger_1' trigger in the NODE 1 Database
> that is responsible for the actual replication process?
>
> That is, if I do the following:
>
> ALTER TABLE foo ENABLE ALWAYS TRIGGER _pro_cluster_logtrigger_1;
>
> I'm assuming that the replication will not be interrupted as this
> trigger will always fire regardless of the 'session_replication_role'
> setting.
>
> Another way of putting it is, is it the '*_logtrigger_1' trigger that
> is added to replicated tables responsible (directly or indirectly) for
> the actual replication of data.
>
> I say 'directly or indirectly' as I see that this trigger runs the
> procedure _pro_cluster.logtrigger, and without looking into that
> procedure mechanism, it's possible that it has a cascading effect that
> ultimately effects the replication of data.
>
> Please understand, I realize our current approach is not the best
> solution, but, I don't set the priorities and replication is higher on
> the list, then changing the way our application works.

In a sense, it's *ALL* a big indirection.

Slony-I started by implementing an event management system, to get
events propagating between the nodes.

Once you've got that, replicating data is a convenient side-effect
:-).

Having replication working requires several things cooperating...

- The "logtrigger" triggers running on the origin collect data into
  sl_log_*.

- You need to have a slon working against the origin, marking off SYNC
  events every so often, which allows us to do incremental processing
  of replication data.

- The slon process connected to the subscriber listens for SYNC
  events, which tell it "Hey, we may have some new data for you!"
  SYNC information allows the subscriber to identify which data to
  look for in sl_log_*.

At the end of all that, you have replication.
-- 
(format nil "~S@~S" "cbbrowne" "cbbrowne.com")
http://linuxfinances.info/info/linuxxian.html
Jury  -- Twelve  people  who  determine which  client  has the  better
lawyer.
From drees76 at gmail.com  Fri Jun  6 13:56:00 2008
From: drees76 at gmail.com (David Rees)
Date: Fri Jun  6 13:56:13 2008
Subject: [Slony1-general] how to add a new table to an existing
	replication set ?
In-Reply-To: <55B4FF41-60EA-432A-B97F-3B67CE5F57B0@kevinkempterllc.com>
References: <55B4FF41-60EA-432A-B97F-3B67CE5F57B0@kevinkempterllc.com>
Message-ID: <72dbd3150806061356w4b7937abv4001722bc8f81829@mail.gmail.com>

On Fri, Jun 6, 2008 at 1:04 PM, kevin kempter <kevin@kevinkempterllc.com> wrote:
> Hi List;
>
> I have a new setup (testing) with a single table in the rep set. I want to
> add a second table to the rep set, I thought I could do this:

You need to create a new set with the new table you want to add,
subscribe the new set to the same subscribers as the existing set,
then merge the new set with the old set.

http://slony.info/documentation/addthings.html
http://slony.info/documentation/stmtmergeset.html

-Dave
From cbbrowne at ca.afilias.info  Fri Jun  6 13:56:04 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri Jun  6 13:56:16 2008
Subject: [Slony1-general] how to add a new table to an existing
	replication set ?
In-Reply-To: <55B4FF41-60EA-432A-B97F-3B67CE5F57B0@kevinkempterllc.com> (kevin
	kempter's message of "Fri, 6 Jun 2008 14:04:52 -0600")
References: <55B4FF41-60EA-432A-B97F-3B67CE5F57B0@kevinkempterllc.com>
Message-ID: <60k5h2mgez.fsf@dba2.int.libertyrms.com>

kevin kempter <kevin@kevinkempterllc.com> writes:
> However, when I run the above script I get this:
>
> <stdin>:7: PGRES_FATAL_ERROR select "_dg_cluster".setAddTable(1, 2,
> 'paneon0.database_version', 'database_version_pk',
> 'paneon0.database_version');  - ERROR:  Slony-I: cannot add table to
> currently subscribed set 1
>
>
> Any thoughts ?

Evidently the error message is not specific enough; I thought it was.

I'll be committing the following patch momentarily.  Hopefully the
elaboration gives you some idea of what you must do.

Index: slony1_funcs.sql
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/backend/slony1_funcs.sql,v
retrieving revision 1.139
diff -c -u -r1.139 slony1_funcs.sql
cvs diff: conflicting specifications of output style
--- slony1_funcs.sql	28 May 2008 18:09:47 -0000	1.139
+++ slony1_funcs.sql	6 Jun 2008 20:54:27 -0000
@@ -2700,7 +2700,7 @@
 	if exists (select true from @NAMESPACE@.sl_subscribe
 			where sub_set = p_set_id)
 	then
-		raise exception ''Slony-I: cannot add table to currently subscribed set %'',
+		raise exception ''Slony-I: cannot add table to currently subscribed set % - must attach to an unsubscribed set'',
 				p_set_id;
 	end if;
-- 
let name="cbbrowne" and tld="acm.org" in String.concat "@" [name;tld];;
http://cbbrowne.com/info/x.html
We'll know that rock is dead when you have  to have a  degree to get a
job in it.
From Marcin.Kasperski at softax.com.pl  Fri Jun  6 13:18:56 2008
From: Marcin.Kasperski at softax.com.pl (Marcin Kasperski)
Date: Fri Jun  6 14:08:32 2008
Subject: [Slony1-general] Re: MOVE SET should warn that it proceeeds async...
References: <873anqvjlv.fsf@platon.mekk.waw.pl>
	<48493A68.8010307@albourne.com> <87od6er6wh.fsf@softax.com.pl>
	<48495020.7050706@albourne.com>
Message-ID: <87abhynwpb.fsf@platon.mekk.waw.pl>

> but it appears that move set does not change all the subscriptions to
> the orgin node?
> (...)
> how should I go about moving subscription on node 2 to point to 3 instead?

Yes, it does not. I just tested it today, when I tried to drop original
node after moving set and got error that it is still subscribed.

But bare resubscribing the client do
(after move set just do

  subscribe set (id = <set-id>, provider = <new-master>, receiver = <receiver>, forward=yes)

and receiver will switch to new master)

>

From Marcin.Kasperski at softax.com.pl  Fri Jun  6 13:14:49 2008
From: Marcin.Kasperski at softax.com.pl (Marcin Kasperski)
Date: Fri Jun  6 14:10:16 2008
Subject: [Slony1-general] Re: how to add a new table to an existing
	replication set ?
References: <55B4FF41-60EA-432A-B97F-3B67CE5F57B0@kevinkempterllc.com>
Message-ID: <87ej7anww6.fsf@platon.mekk.waw.pl>

> ERROR:  Slony-I: cannot add table to
> currently subscribed set 1
>
> Any thoughts ?
>

Haven't tried, but ... create new set, subscribe it and then merge sets.

From lists at serioustechnology.com  Fri Jun  6 14:10:32 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Fri Jun  6 14:10:47 2008
Subject: [Slony1-general] What mechanism actually causes replication?
In-Reply-To: <60r6bamglb.fsf@dba2.int.libertyrms.com>
References: <48496043.8060201@serioustechnology.com>
	<60r6bamglb.fsf@dba2.int.libertyrms.com>
Message-ID: <4849A7C8.7070501@serioustechnology.com>

Christopher Browne wrote:

> In a sense, it's *ALL* a big indirection.
> 
> Slony-I started by implementing an event management system, to get
> events propagating between the nodes.
> 
> Once you've got that, replicating data is a convenient side-effect
> :-).
> 
> Having replication working requires several things cooperating...
> 
> - The "logtrigger" triggers running on the origin collect data into
>   sl_log_*.
> 
> - You need to have a slon working against the origin, marking off SYNC
>   events every so often, which allows us to do incremental processing
>   of replication data.
> 
> - The slon process connected to the subscriber listens for SYNC
>   events, which tell it "Hey, we may have some new data for you!"
>   SYNC information allows the subscriber to identify which data to
>   look for in sl_log_*.
> 
> At the end of all that, you have replication.

I'm learning more then I ever wanted to about Slony. ;)  Thanks again 
Christopher for your detailed response.

What I'm trying to avoid is the situation we had the last time we tried 
setting up Slony.  At that time, we were on 7.4.19 Postgresql and we 
would 'disable all triggers' while our distributed database process did 
it's thing.  The problem was, this would cause our replication 
subscriber to get out of sync with the origin.

The expectation is that if we set the 'right slony triggers' to 'fire 
always' we can avoid this issue and take advantage of the 'SET 
session_replication_role' functionality in Postgresql 8.3, we can 
eliminate our original problem with the earlier 7.4 Postgresql.

My problem is, defining the 'right slony triggers.'

 From the perspective of Slony is it sufficient to insure the 
'logtrigger' triggers fire?  As those are the only triggers I see on the 
replicated tables, I assume that is the case.  You know what they say 
about assumptions though.


-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From Marcin.Kasperski at softax.com.pl  Fri Jun  6 14:48:37 2008
From: Marcin.Kasperski at softax.com.pl (Marcin Kasperski)
Date: Fri Jun  6 15:08:29 2008
Subject: [Slony1-general] Re: how to add a new table to an existing
	replication set ?
References: <55B4FF41-60EA-432A-B97F-3B67CE5F57B0@kevinkempterllc.com>
	<60k5h2mgez.fsf@dba2.int.libertyrms.com>
Message-ID: <8763smnsju.fsf@platon.mekk.waw.pl>

> -		raise exception ''Slony-I: cannot add table to currently subscribed set %'',
> +		raise exception ''Slony-I: cannot add table to currently subscribed set % - must attach to an unsubscribed set'',

Not sure whether this will be of much more help ;-)

Those Oracle guys have some bad ideas, but the one of enumerating and
identifying errors is a good one. If I get mystique ORA-34234: ...
error, I can open docs and read detailed description of what this bug
means. Or even google for it.

Maybe in the long term it could make sense to consider such a thing
for Slony?

-- 
----------------------------------------------------------------------
| Marcin Kasperski   |    You have the right to accept your
| http://mekk.waw.pl | responsibilites instead of having them
|                    |         assigned to you. (Beck)
----------------------------------------------------------------------

From cbbrowne at ca.afilias.info  Fri Jun  6 15:36:13 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri Jun  6 15:36:34 2008
Subject: [Slony1-general] Re: how to add a new table to an existing
	replication set ?
In-Reply-To: <8763smnsju.fsf@platon.mekk.waw.pl> (Marcin Kasperski's message
	of "Fri, 06 Jun 2008 23:48:37 +0200")
References: <55B4FF41-60EA-432A-B97F-3B67CE5F57B0@kevinkempterllc.com>
	<60k5h2mgez.fsf@dba2.int.libertyrms.com>
	<8763smnsju.fsf@platon.mekk.waw.pl>
Message-ID: <603anqmbs2.fsf@dba2.int.libertyrms.com>

Marcin Kasperski <Marcin.Kasperski@softax.com.pl> writes:

>> -		raise exception ''Slony-I: cannot add table to currently subscribed set %'',
>> +		raise exception ''Slony-I: cannot add table to currently subscribed set % - must attach to an unsubscribed set'',
>
> Not sure whether this will be of much more help ;-)
>
> Those Oracle guys have some bad ideas, but the one of enumerating and
> identifying errors is a good one. If I get mystique ORA-34234: ...
> error, I can open docs and read detailed description of what this bug
> means. Or even google for it.
>
> Maybe in the long term it could make sense to consider such a thing
> for Slony?

Hmm.  If I Google for
 "Slony-I: cannot add table to currently subscribed set", I get the following:

    http://www.google.ca/search?q=Slony-I%3A+cannot+add+table+to+currently+subscribed+set

The first two URLs found *do* contain exactly relevant documentation
which already give more detail than I added to the error message:

http://www.slony.info/adminguide/slony1-1.2.6/doc/adminguide/stmtsetaddtable.html
http://www.slony.info/adminguide/slony1-1.2.6/doc/adminguide/loganalysis.html
-- 
let name="cbbrowne" and tld="linuxfinances.info" in String.concat "@" [name;tld];;
http://cbbrowne.com/info/sgml.html
Rules of the Evil Overlord #78.  "I will not tell my Legions of Terror
"And he must  be taken alive!" The command will be:  ``And try to take
him alive if it is reasonably practical.''"
<http://www.eviloverlord.com/>
From Marcin.Kasperski at softax.com.pl  Fri Jun  6 15:38:49 2008
From: Marcin.Kasperski at softax.com.pl (Marcin Kasperski)
Date: Fri Jun  6 16:08:41 2008
Subject: [Slony1-general] My small success story (and a few remarks)
Message-ID: <87y75imbnq.fsf@platon.mekk.waw.pl>


Well, just wanted to say "Thank you" to Slony authors, and also
report, that after a 3 evenings of docreading, about 4 hours
of actual "write plan + write scripts + run them" work, and
about 3 hours of waiting, I managed to:

- upgrade two databases from postgresql 8.1 to 8.3 using slony to
  migrate the data without downtime
- setup slony replication to backup machine and actually replicate
  my ~1.5GB database over WAN

A few observations/remarks/suggestions:

- perl tools are helpful, as it is easier to patch scripts than to
  write them from scratch, but are often very stupid. One should
  always review what they generated and correct it before running.
  For example:

  - slonik_create_set defaults to public. schema wherever the tables truly are
  - slonik_init_cluster does not handle "the same database is achieved by
    different means from different places" config (perfectly
    handled by slonik)
  - slonik_init_cluster generates store path for all database pairs, even if
    given databases are totally unrelated (are not in the same
    set)
  - no script uses DEFINE and INCLUDE
  - databases running on the same machine (but different ports) get the
    same comment
  - I could run slon deamon directly from slon_tools.conf, but in no way
    could generate slon.conf from slon_tools.conf

- I applied the following policy (which helped me noticeably, I feel):

  - always review and edit what slonik_* scripts produced before running
  - use slonik_print_preamble to create preamble file, add there DEFINEs
    for all node and sets identifiers, then include this file to every
    script and use @identifiers instead of constants
  - always read the reference doc for every instruction slonik_* scripts
    suggested
  - use non-overlapping numeric identifiers (so my nodes are 1,2,3,...;
    my sets are 11,21,31, ...; my tables are 101, 102, .. (in set 11),
    201, 202 (in set 21), ... - this way in most cases I can deduce
    from the number itself what does it mean
    { I understand that numeric ids are used for performance reasons,
      applying such a convention and using DEFINEs in docs would make
      them noticealby less criptic }

- error messages are good and helpful, but one really should read docs
  and have some picture of things 

- reference doc (slonik instrucitons etc) is very good, but introductory
  doc is worse - there are noticeable fragments clearly related to
  obsolete/legacy functionality, pgbench replication example is
  oversimplified and can't be used as basis for true plan, discussions
  about alternative techniques are somewhat scattered. Some refresh of
  those docs could make sense. I found Readme.Debian, which clearly
  enumerated replication steps and named alternatives, to be of great
  help, before I found it I felt lost.

  { and yes, it really helps to read reference docs, I recommend it
    to those who feel lost }

- most important obstacle I faced while using slony for upgrade was
  ... slony version mismatch. Simply and just, Debian packaged
  slony 1-2-1 with postgres 8.1 and 1-2-13 with 8.3. I managed
  to compile 1-2-13 for 8.1, but it required some messing with
  packages (downgrading libpq-dev to 8.1-compatible, guessing
  some lacking packages configure did not test for - for example
  flex and bison, and postgresql-8.1-server-dev)

  Not sure whether this is remark to Slony, or maybe to packagers,
  but it would make sense to support such upgrades better (for
  example, by providing new slony compiled against old database).
  Slony docs could also mention those preparations in the chapter
  about database upgrades.

- at least on Debian and Ubuntu scripts like test_slony_state
  (in general, most scripts from tools dir) are not packaged, it could
  make sense to check why and recommend packaging them, at least as
  samples

- on Debian and Ubuntu for some reason debug=4 is used by default,
  filling logs with a lot of useless information

- a few times I found it to be unexpected that different things
  happen async (for example, case of moving master, when there
  was a few minutes when all bases could not be updated), it would
  make sense to mention this in docs (and maybe add some WAITs
  in slonik_* generated scripts)

- it was great discovery for me that I need slony_tools.conf only
  on admin machine and run slonik only just from there - I feel
  that such a picture could be of some help somewhere in docs

- SLONYNODES do not work anymore, there is --config=<> option
  in slonik_*

- cluster initialization (/node adding) could install plpgsql
  instead o complaining that it is not found

- it would be nice to have a way to make report of the replication
  structure (who is pulling which table from whom) and maybe just
  regenerate slonik scripts out of the real configuration

- I wanted to configure slony for low-mem, low-io config, mostly
  experimented with slon.conf for this. Some example "big fullspeed
  site" and "small light site" configs could be nice to have.

- to test whether initial replication has finished I used
  simple SELECT from destination table (which was blocked
  until initial replication finished). I am curious whether
  there is a better way.

- it would be nice if "node ... admin conninfo ..." checked
  whether the connection works and reported problems, a few times I
  found myself patching some pg_hba.conf while subscribing nodes or
  defining sets

Best regards and thanks everybody for this pleasant tool.

-- 
----------------------------------------------------------------------
| Marcin Kasperski   | We want to know as early as possible whether
| http://mekk.waw.pl | the project will succeed. Thus we attack the
|                    |        high-risk areas first. (Martin)
----------------------------------------------------------------------

From Marcin.Kasperski at softax.com.pl  Sat Jun  7 05:05:27 2008
From: Marcin.Kasperski at softax.com.pl (Marcin Kasperski)
Date: Sat Jun  7 05:08:19 2008
Subject: [Slony1-general] Vertical table split (aka "slony please ignore
	this delete")? Or...
Message-ID: <87prqtmovs.fsf@platon.mekk.waw.pl>


Let's say I have

    ProductionDatabase ----slony----> ReportDatabase

let's say there is a table - say - "events", which gathers some
data over time. Let's also say I need all this data in ReportDatabase,
but only data from last few weeks in ProductionDatabase.

So I'd like to remove old data from "events" in ProductionDatabase,
but would like to keep them in ReportDatabase.

Is it possible to convince Slony to ignore such a DELETE

(yes, I know, everything bad may happen if I later re-add a row
with the key matching the removed row, or do sth similar)



-- 
----------------------------------------------------------------------
| Marcin Kasperski   | We want to know as early as possible whether
| http://mekk.waw.pl | the project will succeed. Thus we attack the
|                    |        high-risk areas first. (Martin)
----------------------------------------------------------------------

From roberto1437 at yahoo.com.ar  Sat Jun  7 13:06:57 2008
From: roberto1437 at yahoo.com.ar (Roberto Mariano)
Date: Sat Jun  7 13:07:08 2008
Subject: [Slony1-general] consulta slon -regservice
Message-ID: <420638.89367.qm@web56714.mail.re3.yahoo.com>

CnNsb24gLXJlZ3NlcnZpY2UgCgpjcmVhIHVuIHNlcnZpY2lvIHF1ZSBlbiBkZWZpbml0aXZhIG5v
IGVzIG3DoXMgcXVlIHVuYSBzZXJpZSBkZSBsbGF2ZXMgZGUgUmVnaXN0cnkuCgpGYWxsYSBlbiBX
aW5kb3dzIDIwMDMgU2VydmVyIHBvcnF1ZSBNaWNyb3NvZnQgY2FtYmnDsyBhbGd1bmFzIGxsYXZl
cy4KCkxvIHBvZMOpcyBsZXZhbnRhciBjcmVhbmRvIGVsIHNlcnZpY2lvIGEgbWFuby4KClNpIG5v
IHRlbsOpcyBlbCBXaW5kb3dzIFJlc291cmNlIEtpdCBwYXJhIDIwMDMgU2VydmVyIGxvIGJhasOh
cyBkZSBNaWNyb3NvZnQuIFNvbiB1dGlsaWRhZGVzIGRlIGzDrW5lYSBkZSBjb21hbmRvcy4gVW5v
IGRlIGxvcyBwcm9ncmFtYXMgZXMgaW5zdHNydi5leGUuIEhhY8OpOgoKJmx0O3BhdGgmZ3Q7XGlu
c3RzcnYgU2xvbnktSSAiQzpcQXJjaGl2b3MgZGUgcHJvZ3JhbWFcUG9zdGdyZXNxbFw4LjNcYmlu
XHNsb24uZXhlIgoKKFVzw6EgZWwgcGF0aCBxdWUgdGVuZ2FzIGEgc2xvbi4pIFRlIHZhIGEgZGVj
aXIgcXVlIGxvIGNyZcOzLgoKRGVzZGUgUGFuZWwgZGUgQ29udHJvbCAtIEhlcnJhbWllbnRhcyBB
ZG1pbmlzdHJhdGl2YXMgLSBTZXJ2aWNpb3MgdmVyaWZpY8OhIHF1ZSBlc3TDqSBjcmVhZG8geSBk
ZXNoYWJpbGl0YWxvLgoKQWhvcmEgdmFzIGEgcmVnZWRpdAoKQnVzY8OhczoKCkhLRVlfTE9DQUxf
TUFDSElORVxTWVNURU1cQ3VycmVudENvbnRyb2xTZXRcU2VydmljZXNcU2xvbnktSQoKKFRpZW5l
IHF1ZSBlc3Rhci4pCgpBYnLDrSBsYSBsbGF2ZSBJbWFnZVBhdGguCgpWYWxlOgoKJmx0O2xvIHF1
ZSBoYXlhcyBwdWVzdG8mZ3Q7XHNsb24uZXhlIgoKQWdyZWfDoSBlc3RvICIgLXNlcnZpY2UiIGEg
Y29udGludWFjacOzbiBkZSBzbG9uLmV4ZS4KCkNyZcOhIHVuYSBudWV2YSBlbnRyYWRhIE11bHRp
bMOtbmVhIChSRUdfTVVMVElfU1opIGFsIG1pc21vIG5pdmVsIHF1ZSBlc3TDoSBJbWFnZVBhdGgu
CgpOb21icmU6IERlcGVuZE9uU2VydmljZSIKClZhbG9yOiBSUENTUwoKU2Fsw60gZGUgUmVnZWRp
dCB5IHZhcyBhIGRlIG51ZXZvIGEgUGFuZWwgZGUgQ29udHJvbCAtIEhlcnJhbWllbnRhcyBBZG1p
bmlzdHJhdGl2YXMgLSBTZXJ2aWNpb3MuIEJ1c2PDoSBTbG9ueS1JLgoKQXNlZ3VyYXRlIHF1ZSBl
bCBjb21hbmRvIHF1ZSBtdWVzdHJhJm5ic3A7IChzbG9uLmV4ZSkgdGVuZ2EgbGEgb3BjacOzbiAt
c2VydmljZSB5IHF1ZSBmaWd1cmUgbGEgZGVwZW5kZW5jaWEgZGUgU2VydmljaW8gZGUgTGxhbWFk
YSBSZW1vdGEuCgpBaMOtIHBhc2FsbyBhIEF1dG9tw6F0aWNvIHkgbGUgZMOhcyBJbmljaWFyLiBT
aSB0b2RvIGZ1ZSBiaWVuIHRpZW5lIHF1ZSBhcnJhbmNhciBzaW4gcHJvYmxlbWFzLgoKVGUgdmEg
YSBmYWx0YXIgaGFjZXI6CgpzbG9uIC1hZGRlbmdpbmUgU2xvbnktSSAmbHQ7dHUgYXJjaGl2byBk
ZSBjb25mJmd0OwoKWSByZWluaWNpYXIgZWwgc2VydmljaW8gKG8gV2luZG93cykuCgpTdWVydGUu
CgpBdGVudG9zIHNhbHVkb3MgZGVzZGUgQnVlbm9zIEFpcmVzLgoKUm9iZXJ0byBDcnVjaWFuZWxs
aS4KCgoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18K
Q29ycmVvIFlhaG9vIQpFc3BhY2lvIHBhcmEgdG9kb3MgdHVzIG1lbnNhamVzLCBhbnRpdmlydXMg
eSBhbnRpc3BhbSDCoWdyYXRpcyEgCsKhQWJyw60gdHUgY3VlbnRhIHlhISAtIGh0dHA6Ly9jb3Jy
ZW8ueWFob28uY29tLmFyCi0tLS0tLS0tLS0tLS0tIG5leHQgcGFydCAtLS0tLS0tLS0tLS0tLQpB
biBIVE1MIGF0dGFjaG1lbnQgd2FzIHNjcnViYmVkLi4uClVSTDogaHR0cDovL2xpc3RzLnNsb255
LmluZm8vcGlwZXJtYWlsL3Nsb255MS1nZW5lcmFsL2F0dGFjaG1lbnRzLzIwMDgwNjA3L2JlNjlm
Yzg1L2F0dGFjaG1lbnQuaHRtCg==
From rafael.domiciano at gmail.com  Sat Jun  7 17:20:17 2008
From: rafael.domiciano at gmail.com (Rafael Domiciano)
Date: Sat Jun  7 17:20:32 2008
Subject: [Slony1-general] Vertical table split (aka "slony please ignore
	this delete")? Or...
In-Reply-To: <87prqtmovs.fsf@platon.mekk.waw.pl>
References: <87prqtmovs.fsf@platon.mekk.waw.pl>
Message-ID: <3a0028490806071720x971c522v6dce71b408e78c14@mail.gmail.com>

Hello Marcin,

The Replication of data is activity when some I, U or D is executed, because
Slony is trigger based. So, you can disbled the trigger of the table
"events", and after you have done you work you enable her.

Now, if your table doesn't have a PK, there is a great possibility to have
some error on the replication.

The better way to work is to have a "flag", like "delete", where you can
mark if the tuple is deleted or not, and you don't need to really delete the
record, and you can filtre to show in the user's screen.

Rafael Domiciano
DBA Postgres
Senff Ltda.

2008/6/7 Marcin Kasperski <Marcin.Kasperski@softax.com.pl>:

>
> Let's say I have
>
>    ProductionDatabase ----slony----> ReportDatabase
>
> let's say there is a table - say - "events", which gathers some
> data over time. Let's also say I need all this data in ReportDatabase,
> but only data from last few weeks in ProductionDatabase.
>
> So I'd like to remove old data from "events" in ProductionDatabase,
> but would like to keep them in ReportDatabase.
>
> Is it possible to convince Slony to ignore such a DELETE
>
> (yes, I know, everything bad may happen if I later re-add a row
> with the key matching the removed row, or do sth similar)
>
>
>
> --
> ----------------------------------------------------------------------
> | Marcin Kasperski   | We want to know as early as possible whether
> | http://mekk.waw.pl | the project will succeed. Thus we attack the
> |                    |        high-risk areas first. (Martin)
> ----------------------------------------------------------------------
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080607/=
0aed5ced/attachment.htm
From scetbon at echo.fr  Sun Jun  8 01:55:20 2008
From: scetbon at echo.fr (Cyril SCETBON)
Date: Sun Jun  8 01:55:51 2008
Subject: [Slony1-general] slonik segfault
In-Reply-To: <60lk1io9b8.fsf@dba2.int.libertyrms.com>
References: <48490712.6070202@echo.fr> <60lk1io9b8.fsf@dba2.int.libertyrms.com>
Message-ID: <484B9E78.5060201@echo.fr>

Here you can find the script which raises a segmentation fault :

http://pastebin.com/m1524b62f

To make it works you can apply the following patch :

--- script_with_error.slk    2008-06-02 18:30:23.000000000 +0200
+++ script_with_success.slk   2008-06-06 16:44:35.000000000 +0200
@@ -151,6 +151,9 @@
 set add table (set id=8, origin=201, id=137, fully qualified name = 
'public.t_137', comment='table 137');
 set add table (set id=8, origin=201, id=138, fully qualified name = 
'public.t_138', comment='table 138');
 set add table (set id=8, origin=201, id=139, fully qualified name = 
'public.t_139', comment='table 139');
+
+# creation set 9
+#
 create set (id=9, origin=201, comment='set number 9');
 set add table (set id=9, origin=201, id=140, fully qualified name = 
'public.t_140', comment='table 140');
 set add table (set id=9, origin=201, id=141, fully qualified name = 
'public.t_141', comment='table 141');
@@ -391,6 +394,10 @@
 set add table (set id=21, origin=201, id=364, fully qualified name = 
'public.t_364', comment='table 364');
 set add table (set id=21, origin=201, id=365, fully qualified name = 
'public.t_365', comment='table 365');
 set add table (set id=21, origin=201, id=366, fully qualified name = 
'public.t_366', comment='table 366');
+
+# creation du set 22
+#
+
 create set (id=22, origin=201, comment='set number 22');
 set add table (set id=22, origin=201, id=367, fully qualified name = 
'public.t_367', comment='table 367');
 set add table (set id=22, origin=201, id=368, fully qualified name = 
'public.t_368', comment='table 368');
@@ -410,6 +417,7 @@
 set add table (set id=22, origin=201, id=382, fully qualified name = 
'public.t_382', comment='table 382');
 set add table (set id=22, origin=201, id=383, fully qualified name = 
'public.t_383', comment='table 383');
 set add table (set id=22, origin=201, id=384, fully qualified name = 
'public.t_384', comment='table 384');
+
 create set (id=23, origin=201, comment='set number 23');
 set add table (set id=23, origin=201, id=385, fully qualified name = 
'public.t_385', comment='table 385');
 set add table (set id=23, origin=201, id=386, fully qualified name = 
'public.t_386', comment='table 386');
@@ -428,6 +436,9 @@
 set add table (set id=23, origin=201, id=399, fully qualified name = 
'public.t_399', comment='table 399');
 set add table (set id=23, origin=201, id=400, fully qualified name = 
'public.t_400', comment='table 400');
 set add table (set id=23, origin=201, id=401, fully qualified name = 
'public.t_401', comment='table 401');
+
+# creation set 24
+#
 create set (id=24, origin=201, comment='set number 24');
 set add table (set id=24, origin=201, id=402, fully qualified name = 
'public.t_402', comment='table 402');
 set add table (set id=24, origin=201, id=403, fully qualified name = 
'public.t_403', comment='table 403');
@@ -447,6 +458,9 @@
 set add table (set id=24, origin=201, id=417, fully qualified name = 
'public.t_417', comment='table 417');
 set add table (set id=24, origin=201, id=418, fully qualified name = 
'public.t_418', comment='table 418');
 set add table (set id=24, origin=201, id=419, fully qualified name = 
'public.t_419', comment='table 419');
+
+# creation set 25
+#
 create set (id=25, origin=201, comment='set number 25');
 set add table (set id=25, origin=201, id=420, fully qualified name = 
'public.t_420', comment='table 420');
 set add table (set id=25, origin=201, id=421, fully qualified name = 
'public.t_421', comment='table 421');


As you can see there's no much difference between them ...

Regards

Christopher Browne wrote:
> Cyril SCETBON <scetbon@echo.fr> writes:
>   
>> When I try to create a lot of set slonik dies with segmentation fault
>> message. The only way to succeed is to split the file containing the
>> create set statement and to try them one by one or two by two. When I
>> use strace on slonik it displays :
>>
>> read(3, "#--\n# Slony-I organizes tables i"..., 8192) = 8192
>> read(3, "d table (set id=5, origin=201, i"..., 8192) = 8192
>> read(3, ");\nset add table (set id=9, orig"..., 8192) = 8192
>> mmap(NULL, 18446744073709547520, PROT_READ|PROT_WRITE,
>> MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = -1 ENOMEM (Cannot allocate memory)
>>
>> Is there a maximum number of lines ? a memory parameter to use with slonik ?
>>
>> thanks
>>     
>
> We're using Bison to generate the parser, and it normally doesn't
> present any particular fixed limits on how much data it can handle.
>
> I just ran a test run where I created 500 tables and then added them,
> in one fell swoop, to replication, using the sample script...
> Attached is a patch that may be applied to the sample script in the
> Slony-I source tree to get the same results.
>
> With 500 tables to set up and copy, even though they were empty, it
> took 452 seconds to apply the subscription.  (Cheap desktop PC :-).)
>
> I encountered no problems.  Might there be something odd about your
> platform where your OS defines stack size for programs to be rather
> small?  That doesn't make *much* sense; if such an effect were
> breaking slonik, then it ought to be breaking other things, like maybe
> your PostgreSQL instance!
>
> Here's an excerpt of the set creation slonik script:
>
> include </tmp/slonytest-temp.A24149/preamble.slonik>;
> create set (id=1, origin=1, comment='SLONTEST82 Tables and Sequences');
> set add table (id=1, set id=1, origin=1, fully qualified name='public.t1', comment='SLONTEST82 table public.t1');
> set add table (id=2, set id=1, origin=1, fully qualified name='public.t2', comment='SLONTEST82 table public.t2');
> set add table (id=3, set id=1, origin=1, fully qualified name='public.t3', comment='SLONTEST82 table public.t3');
> set add table (id=4, set id=1, origin=1, fully qualified name='public.t4', comment='SLONTEST82 table public.t4');
> set add table (id=5, set id=1, origin=1, fully qualified name='public.t5', comment='SLONTEST82 table public.t5');
> ...
> set add table (id=494, set id=1, origin=1, fully qualified name='public.t494', comment='SLONTEST82 table public.t494');
> set add table (id=495, set id=1, origin=1, fully qualified name='public.t495', comment='SLONTEST82 table public.t495');
> set add table (id=496, set id=1, origin=1, fully qualified name='public.t496', comment='SLONTEST82 table public.t496');
> set add table (id=497, set id=1, origin=1, fully qualified name='public.t497', comment='SLONTEST82 table public.t497');
> set add table (id=498, set id=1, origin=1, fully qualified name='public.t498', comment='SLONTEST82 table public.t498');
> set add table (id=499, set id=1, origin=1, fully qualified name='public.t499', comment='SLONTEST82 table public.t499');
> set add table (id=500, set id=1, origin=1, fully qualified name='public.t500', comment='SLONTEST82 table public.t500');
> set add sequence (id=1, set id=1, origin=1, fully qualified name='public.t1_id_seq', comment='SLONTEST82 sequence public.t1_id_seq');
> set add sequence (id=2, set id=1, origin=1, fully qualified name='public.t2_id_seq', comment='SLONTEST82 sequence public.t2_id_seq');
> set add sequence (id=3, set id=1, origin=1, fully qualified name='public.t3_id_seq', comment='SLONTEST82 sequence public.t3_id_seq');
> set add sequence (id=4, set id=1, origin=1, fully qualified name='public.t4_id_seq', comment='SLONTEST82 sequence public.t4_id_seq');
> set add sequence (id=5, set id=1, origin=1, fully qualified name='public.t5_id_seq', comment='SLONTEST82 sequence public.t5_id_seq');
> set add sequence (id=6, set id=1, origin=1, fully qualified name='public.t6_id_seq', comment='SLONTEST82 sequence public.t6_id_seq');
> set add sequence (id=7, set id=1, origin=1, fully qualified name='public.t7_id_seq', comment='SLONTEST82 sequence public.t7_id_seq');
> ...
> set add sequence (id=496, set id=1, origin=1, fully qualified name='public.t496_id_seq', comment='SLONTEST82 sequence public.t496_id_seq');
> set add sequence (id=497, set id=1, origin=1, fully qualified name='public.t497_id_seq', comment='SLONTEST82 sequence public.t497_id_seq');
> set add sequence (id=498, set id=1, origin=1, fully qualified name='public.t498_id_seq', comment='SLONTEST82 sequence public.t498_id_seq');
> set add sequence (id=499, set id=1, origin=1, fully qualified name='public.t499_id_seq', comment='SLONTEST82 sequence public.t499_id_seq');
> set add sequence (id=500, set id=1, origin=1, fully qualified name='public.t500_id_seq', comment='SLONTEST82 sequence public.t500_id_seq');
>
> Here's the CVS diff:
>
> chris@dba2:Slony-I/CMD/slony1-1.2/tools> cvs diff -u configure-replication.sh
> Index: configure-replication.sh
> ===================================================================
> RCS file: /home/cvsd/slony1/slony1-engine/tools/configure-replication.sh,v
> retrieving revision 1.1.2.4
> diff -c -u -r1.1.2.4 configure-replication.sh
> cvs diff: conflicting specifications of output style
> --- configure-replication.sh	6 Mar 2008 18:49:03 -0000	1.1.2.4
> +++ configure-replication.sh	6 Jun 2008 15:43:33 -0000
> @@ -6,6 +6,13 @@
>  NUMNODES=${NUMNODES:-"2"}
>  
>  # Defaults - origin node
> +DB1=db1
> +DB2=db2
> +HOST1=localhost
> +HOST2=localhost
> +PORT1=5882
> +PORT2=5882
> +
>  DB1=${DB1:-${PGDATABASE:-"slonytest"}}
>  HOST1=${HOST1:-`hostname`}
>  USER1=${USER1:-${PGUSER:-"slony"}}
> @@ -117,15 +124,18 @@
>   recurringemail recurringprint session shipto sic status tax
>   transactions translation vendor vendortax warehouse yearend"
>  
> +ALTTABLES1=""
> +ALTSEQUENCES1=""
> +for i in `seq 500`; do
> +   ALTTABLES1="$ALTTABLES1 t${i}"
> +   ALTSEQUENCES1="$ALTSEQUENCES1 t${i}_id_seq"
> +   psql -h $HOST1 -p $PORT1 -d $DB1 -c "create table t${i} (id serial primary key, data text not null unique);"
> +   psql -h $HOST2 -p $PORT2 -d $DB2 -c "create table t${i} (id serial primary key, data text not null unique);"
> +done
> +
>  for t in `echo $ALTTABLES1`; do
>    ALTTABLES="$ALTTABLES public.${t}"
>  done
> -  
> -ALTSEQUENCES1="acc_trans_entry_id_seq audittrail_entry_id_seq
> - custom_field_catalog_field_id_seq custom_table_catalog_table_id_seq
> - id inventory_entry_id_seq invoiceid jcitemsid orderitemsid
> - partscustomer_entry_id_seq partsvendor_entry_id_seq
> - session_session_id_seq shipto_entry_id_seq"
>  
>  for s in `echo $ALTSEQUENCES1`; do
>    ALTSEQUENCES="$ALTSEQUENCES public.${s}"
>
>   

-- 
Cyril SCETBON - Ing?nieur bases de donn?es
AUSY pour France T?l?com - OPF/PORTAILS/DOP/HEBEX

T?l : +33 (0)4 97 12 87 60
Jabber : cscetbon@jabber.org
France Telecom - Orange
790 Avenue du Docteur Maurice Donat 
B?timent Marco Polo C2 - Bureau 202
06250 Mougins
France

***********************************
Ce message et toutes les pieces jointes (ci-apres le 'message') sont
confidentiels et etablis a l'intention exclusive de ses destinataires.
Toute utilisation ou diffusion non autorisee est interdite.
Tout message electronique est susceptible d'alteration. Le Groupe France
Telecom decline toute responsabilite au titre de ce message s'il a ete
altere, deforme ou falsifie.
Si vous n'etes pas destinataire de ce message, merci de le detruire
immediatement et d'avertir l'expediteur.
***********************************
This message and any attachments (the 'message') are confidential and
intended solely for the addressees.
Any unauthorised use or dissemination is prohibited.
Messages are susceptible to alteration. France Telecom Group shall not be
liable for the message if altered, changed or falsified.
If you are not recipient of this message, please cancel it immediately and
inform the sender.
************************************

From Marcin.Kasperski at softax.com.pl  Sun Jun  8 01:31:51 2008
From: Marcin.Kasperski at softax.com.pl (Marcin Kasperski)
Date: Sun Jun  8 02:08:45 2008
Subject: [Slony1-general] Re: Vertical table split (aka "slony please ignore
	this delete")? Or...
References: <87prqtmovs.fsf@platon.mekk.waw.pl>
	<3a0028490806071720x971c522v6dce71b408e78c14@mail.gmail.com>
Message-ID: <87hcc4mio8.fsf@platon.mekk.waw.pl>

> The Replication of data is activity when some I, U or D is executed,
> because Slony is trigger based. So, you can disbled the trigger of
> the table "events", and after you have done you work you enable her.

This is some idea, but this way I would loose also all "normal"
operations made while the slony trigger is disabled. So some LOCK
TABLE should be probably added too.

What I am mostly afraid is whether Slony has some extra cross-checks
or sth similar which would show up later...

-- 
----------------------------------------------------------------------
| Marcin Kasperski   |    You have the right to accept your
| http://mekk.waw.pl | responsibilites instead of having them
|                    |         assigned to you. (Beck)
----------------------------------------------------------------------

From m.eriksson at albourne.com  Sun Jun  8 23:56:54 2008
From: m.eriksson at albourne.com (Martin Eriksson)
Date: Sun Jun  8 23:57:30 2008
Subject: [Slony1-general] Re: MOVE SET should warn that it proceeeds
	async...
In-Reply-To: <60ve0mmgui.fsf@dba2.int.libertyrms.com>
References: <873anqvjlv.fsf@platon.mekk.waw.pl>	<48493A68.8010307@albourne.com>
	<87od6er6wh.fsf@softax.com.pl>	<48495020.7050706@albourne.com>
	<60ve0mmgui.fsf@dba2.int.libertyrms.com>
Message-ID: <484CD436.80804@albourne.com>

Thanks Christopher for clearing it up!

and thanks Marcin for taking the time to check on it.

Maybe this should be a bit more clearly stated in the documentation?

It can sort of be read between the lines but clearly stating it would 
not hurt :)

cheers
Martin


Christopher Browne wrote:
> Martin Eriksson <m.eriksson@albourne.com> writes:
>   
>> hmm could be i've missunderstood something...
>>
>> but it appears that move set does not change all the subscriptions to
>> the orgin node?
>>
>> It appear that if i got
>> 1 -> 3
>> 1 -> 2
>>
>> and i do move set
>> from 1-> 3
>>
>> 1 will subscribe from 3, but 2 will continue to subscribe from 1.
>>
>> how should I go about moving subscription on node 2 to point to 3 instead?
>>     
>
> You can submit a SUBSCRIBE SET request to point node #2 to use node
> #3.
>
> Slony-I doesn't assume that *everything* should get redirected; it
> tends to do the minimal change (which is, after all, what you asked
> for!).  This is, in effect, the difference between DWIS and DWIM, that
> is, Do What I Say versus Do What I Mean.
>
> Historically, systems that try to implement DWIM tend to be rather
> less predictable than those implementing DWIS, because their behaviour
> has rather more complex policy bundled into it.
>   

From pelin.01 at gmail.com  Mon Jun  9 04:53:39 2008
From: pelin.01 at gmail.com (pelin)
Date: Mon Jun  9 04:54:09 2008
Subject: [Slony1-general] consulta slon -regservice OKS!
Message-ID: <6a8366e40806090453r6e59d3d7qd5b72b0d3041c482@mail.gmail.com>

Muchas gracias Roberto!!!!, me anduvo a la perfeccion.
Ni ahi que me imaginaba que seria eso. yo trabajo en linux y me encontre de
repente con un 2003 rebelde :S

Saludos desde Chaco!

Atentamente
Rolando Sergio Rodriguez
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080609/=
24a87851/attachment.htm
From scetbon at echo.fr  Mon Jun  9 06:07:18 2008
From: scetbon at echo.fr (Cyril SCETBON)
Date: Mon Jun  9 06:07:32 2008
Subject: [Slony1-general] slonik segfault
In-Reply-To: <60lk1io9b8.fsf@dba2.int.libertyrms.com>
References: <48490712.6070202@echo.fr> <60lk1io9b8.fsf@dba2.int.libertyrms.com>
Message-ID: <484D2B06.6040400@echo.fr>

Christopher,

Did you test the script I sent you ? if this is the case, did you get 
the same error ?

Thanks.


Christopher Browne wrote:
> Cyril SCETBON <scetbon@echo.fr> writes:
>   
>> When I try to create a lot of set slonik dies with segmentation fault
>> message. The only way to succeed is to split the file containing the
>> create set statement and to try them one by one or two by two. When I
>> use strace on slonik it displays :
>>
>> read(3, "#--\n# Slony-I organizes tables i"..., 8192) = 8192
>> read(3, "d table (set id=5, origin=201, i"..., 8192) = 8192
>> read(3, ");\nset add table (set id=9, orig"..., 8192) = 8192
>> mmap(NULL, 18446744073709547520, PROT_READ|PROT_WRITE,
>> MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = -1 ENOMEM (Cannot allocate memory)
>>
>> Is there a maximum number of lines ? a memory parameter to use with slonik ?
>>
>> thanks
>>     
>
> We're using Bison to generate the parser, and it normally doesn't
> present any particular fixed limits on how much data it can handle.
>
> I just ran a test run where I created 500 tables and then added them,
> in one fell swoop, to replication, using the sample script...
> Attached is a patch that may be applied to the sample script in the
> Slony-I source tree to get the same results.
>
> With 500 tables to set up and copy, even though they were empty, it
> took 452 seconds to apply the subscription.  (Cheap desktop PC :-).)
>
> I encountered no problems.  Might there be something odd about your
> platform where your OS defines stack size for programs to be rather
> small?  That doesn't make *much* sense; if such an effect were
> breaking slonik, then it ought to be breaking other things, like maybe
> your PostgreSQL instance!
>
> Here's an excerpt of the set creation slonik script:
>
> include </tmp/slonytest-temp.A24149/preamble.slonik>;
> create set (id=1, origin=1, comment='SLONTEST82 Tables and Sequences');
> set add table (id=1, set id=1, origin=1, fully qualified name='public.t1', comment='SLONTEST82 table public.t1');
> set add table (id=2, set id=1, origin=1, fully qualified name='public.t2', comment='SLONTEST82 table public.t2');
> set add table (id=3, set id=1, origin=1, fully qualified name='public.t3', comment='SLONTEST82 table public.t3');
> set add table (id=4, set id=1, origin=1, fully qualified name='public.t4', comment='SLONTEST82 table public.t4');
> set add table (id=5, set id=1, origin=1, fully qualified name='public.t5', comment='SLONTEST82 table public.t5');
> ...
> set add table (id=494, set id=1, origin=1, fully qualified name='public.t494', comment='SLONTEST82 table public.t494');
> set add table (id=495, set id=1, origin=1, fully qualified name='public.t495', comment='SLONTEST82 table public.t495');
> set add table (id=496, set id=1, origin=1, fully qualified name='public.t496', comment='SLONTEST82 table public.t496');
> set add table (id=497, set id=1, origin=1, fully qualified name='public.t497', comment='SLONTEST82 table public.t497');
> set add table (id=498, set id=1, origin=1, fully qualified name='public.t498', comment='SLONTEST82 table public.t498');
> set add table (id=499, set id=1, origin=1, fully qualified name='public.t499', comment='SLONTEST82 table public.t499');
> set add table (id=500, set id=1, origin=1, fully qualified name='public.t500', comment='SLONTEST82 table public.t500');
> set add sequence (id=1, set id=1, origin=1, fully qualified name='public.t1_id_seq', comment='SLONTEST82 sequence public.t1_id_seq');
> set add sequence (id=2, set id=1, origin=1, fully qualified name='public.t2_id_seq', comment='SLONTEST82 sequence public.t2_id_seq');
> set add sequence (id=3, set id=1, origin=1, fully qualified name='public.t3_id_seq', comment='SLONTEST82 sequence public.t3_id_seq');
> set add sequence (id=4, set id=1, origin=1, fully qualified name='public.t4_id_seq', comment='SLONTEST82 sequence public.t4_id_seq');
> set add sequence (id=5, set id=1, origin=1, fully qualified name='public.t5_id_seq', comment='SLONTEST82 sequence public.t5_id_seq');
> set add sequence (id=6, set id=1, origin=1, fully qualified name='public.t6_id_seq', comment='SLONTEST82 sequence public.t6_id_seq');
> set add sequence (id=7, set id=1, origin=1, fully qualified name='public.t7_id_seq', comment='SLONTEST82 sequence public.t7_id_seq');
> ...
> set add sequence (id=496, set id=1, origin=1, fully qualified name='public.t496_id_seq', comment='SLONTEST82 sequence public.t496_id_seq');
> set add sequence (id=497, set id=1, origin=1, fully qualified name='public.t497_id_seq', comment='SLONTEST82 sequence public.t497_id_seq');
> set add sequence (id=498, set id=1, origin=1, fully qualified name='public.t498_id_seq', comment='SLONTEST82 sequence public.t498_id_seq');
> set add sequence (id=499, set id=1, origin=1, fully qualified name='public.t499_id_seq', comment='SLONTEST82 sequence public.t499_id_seq');
> set add sequence (id=500, set id=1, origin=1, fully qualified name='public.t500_id_seq', comment='SLONTEST82 sequence public.t500_id_seq');
>
> Here's the CVS diff:
>
> chris@dba2:Slony-I/CMD/slony1-1.2/tools> cvs diff -u configure-replication.sh
> Index: configure-replication.sh
> ===================================================================
> RCS file: /home/cvsd/slony1/slony1-engine/tools/configure-replication.sh,v
> retrieving revision 1.1.2.4
> diff -c -u -r1.1.2.4 configure-replication.sh
> cvs diff: conflicting specifications of output style
> --- configure-replication.sh	6 Mar 2008 18:49:03 -0000	1.1.2.4
> +++ configure-replication.sh	6 Jun 2008 15:43:33 -0000
> @@ -6,6 +6,13 @@
>  NUMNODES=${NUMNODES:-"2"}
>  
>  # Defaults - origin node
> +DB1=db1
> +DB2=db2
> +HOST1=localhost
> +HOST2=localhost
> +PORT1=5882
> +PORT2=5882
> +
>  DB1=${DB1:-${PGDATABASE:-"slonytest"}}
>  HOST1=${HOST1:-`hostname`}
>  USER1=${USER1:-${PGUSER:-"slony"}}
> @@ -117,15 +124,18 @@
>   recurringemail recurringprint session shipto sic status tax
>   transactions translation vendor vendortax warehouse yearend"
>  
> +ALTTABLES1=""
> +ALTSEQUENCES1=""
> +for i in `seq 500`; do
> +   ALTTABLES1="$ALTTABLES1 t${i}"
> +   ALTSEQUENCES1="$ALTSEQUENCES1 t${i}_id_seq"
> +   psql -h $HOST1 -p $PORT1 -d $DB1 -c "create table t${i} (id serial primary key, data text not null unique);"
> +   psql -h $HOST2 -p $PORT2 -d $DB2 -c "create table t${i} (id serial primary key, data text not null unique);"
> +done
> +
>  for t in `echo $ALTTABLES1`; do
>    ALTTABLES="$ALTTABLES public.${t}"
>  done
> -  
> -ALTSEQUENCES1="acc_trans_entry_id_seq audittrail_entry_id_seq
> - custom_field_catalog_field_id_seq custom_table_catalog_table_id_seq
> - id inventory_entry_id_seq invoiceid jcitemsid orderitemsid
> - partscustomer_entry_id_seq partsvendor_entry_id_seq
> - session_session_id_seq shipto_entry_id_seq"
>  
>  for s in `echo $ALTSEQUENCES1`; do
>    ALTSEQUENCES="$ALTSEQUENCES public.${s}"
>
>   

-- 
Cyril SCETBON - Ing?nieur bases de donn?es
AUSY pour France T?l?com - OPF/PORTAILS/DOP/HEBEX

T?l : +33 (0)4 97 12 87 60
Jabber : cscetbon@jabber.org
France Telecom - Orange
790 Avenue du Docteur Maurice Donat 
B?timent Marco Polo C2 - Bureau 202
06250 Mougins
France

***********************************
Ce message et toutes les pieces jointes (ci-apres le 'message') sont
confidentiels et etablis a l'intention exclusive de ses destinataires.
Toute utilisation ou diffusion non autorisee est interdite.
Tout message electronique est susceptible d'alteration. Le Groupe France
Telecom decline toute responsabilite au titre de ce message s'il a ete
altere, deforme ou falsifie.
Si vous n'etes pas destinataire de ce message, merci de le detruire
immediatement et d'avertir l'expediteur.
***********************************
This message and any attachments (the 'message') are confidential and
intended solely for the addressees.
Any unauthorised use or dissemination is prohibited.
Messages are susceptible to alteration. France Telecom Group shall not be
liable for the message if altered, changed or falsified.
If you are not recipient of this message, please cancel it immediately and
inform the sender.
************************************

From ajs at crankycanuck.ca  Mon Jun  9 06:35:15 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Mon Jun  9 06:35:43 2008
Subject: [Slony1-general] adding tables/triggers to a slony slave
In-Reply-To: <48485388.9070701@serioustechnology.com>
References: <484018E6.60208@serioustechnology.com>
	<20080530155041.GA11328@crankycanuck.ca>
	<48402E1D.5000402@serioustechnology.com>
	<20080530165618.GB11328@crankycanuck.ca>
	<48485388.9070701@serioustechnology.com>
Message-ID: <20080609133515.GA3525@crankycanuck.ca>

On Thu, Jun 05, 2008 at 04:58:48PM -0400, Geoffrey wrote:
> I have a better understanding as to how this whole process is supposed
> to work, thus I want to present it here to make sure it will work.
> 
> We intend to execute the following on all slony triggers:
> 
> ALTER TABLE foo ENABLE ALWAYS TRIGGER bar;
> 
> Assuming this will cause the slony triggers to fire when we do the 
> following to disable our triggers:
> 
> SET session_replication_role TO 'replica';

If I read that right, what you want is the Slony triggers to keep working
and none of the others to do.  Is that right?  If so, that ought to work. 
It's certainly the way the mechanism is designed.  

> User creates a record that must be distributed across all the databases. 
>  There is a trigger that recognizes this occurence and therefore 
> generates a record in another database that will be eventually 
> distributed to the other databases.  There is a process that reads these 
> records and then distributes them.  The problem is we need to make sure 
> that when this process distributes them to the other databases, new 
> records are not created to redistribute these records.

You're also going to run into the "prevent insertions not by Slony" trigger
here, no?  (Or have you allowed for that?)

A

From rafael.domiciano at gmail.com  Mon Jun  9 07:22:56 2008
From: rafael.domiciano at gmail.com (Rafael Domiciano)
Date: Mon Jun  9 07:23:01 2008
Subject: [Slony1-general] Re: Vertical table split (aka "slony please
	ignore this delete")? Or...
In-Reply-To: <87hcc4mio8.fsf@platon.mekk.waw.pl>
References: <87prqtmovs.fsf@platon.mekk.waw.pl>
	<3a0028490806071720x971c522v6dce71b408e78c14@mail.gmail.com>
	<87hcc4mio8.fsf@platon.mekk.waw.pl>
Message-ID: <3a0028490806090722t36b1d07aoad1f53f16c7c1ec8@mail.gmail.com>

Yeah, this way you gona to loose others operations.

So I thing the better way is to create a flag in your table and make filter
in it.

2008/6/8 Marcin Kasperski <Marcin.Kasperski@softax.com.pl>:

> > The Replication of data is activity when some I, U or D is executed,
> > because Slony is trigger based. So, you can disbled the trigger of
> > the table "events", and after you have done you work you enable her.
>
> This is some idea, but this way I would loose also all "normal"
> operations made while the slony trigger is disabled. So some LOCK
> TABLE should be probably added too.
>
> What I am mostly afraid is whether Slony has some extra cross-checks
> or sth similar which would show up later...
>
> --
> ----------------------------------------------------------------------
> | Marcin Kasperski   |    You have the right to accept your
> | http://mekk.waw.pl | responsibilites instead of having them
> |                    |         assigned to you. (Beck)
> ----------------------------------------------------------------------
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080609/=
bf17461e/attachment.htm
From lists at serioustechnology.com  Mon Jun  9 07:38:50 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Mon Jun  9 07:38:57 2008
Subject: [Slony1-general] adding tables/triggers to a slony slave
In-Reply-To: <20080609133515.GA3525@crankycanuck.ca>
References: <484018E6.60208@serioustechnology.com>	<20080530155041.GA11328@crankycanuck.ca>	<48402E1D.5000402@serioustechnology.com>	<20080530165618.GB11328@crankycanuck.ca>	<48485388.9070701@serioustechnology.com>
	<20080609133515.GA3525@crankycanuck.ca>
Message-ID: <484D407A.7080602@serioustechnology.com>

Andrew Sullivan wrote:
> On Thu, Jun 05, 2008 at 04:58:48PM -0400, Geoffrey wrote:
>> I have a better understanding as to how this whole process is supposed
>> to work, thus I want to present it here to make sure it will work.
>>
>> We intend to execute the following on all slony triggers:
>>
>> ALTER TABLE foo ENABLE ALWAYS TRIGGER bar;
>>
>> Assuming this will cause the slony triggers to fire when we do the 
>> following to disable our triggers:
>>
>> SET session_replication_role TO 'replica';
> 
> If I read that right, what you want is the Slony triggers to keep working
> and none of the others to do.  Is that right?  If so, that ought to work. 
> It's certainly the way the mechanism is designed.

That's exactly what we want to do.

>> User creates a record that must be distributed across all the databases. 
>>  There is a trigger that recognizes this occurence and therefore 
>> generates a record in another database that will be eventually 
>> distributed to the other databases.  There is a process that reads these 
>> records and then distributes them.  The problem is we need to make sure 
>> that when this process distributes them to the other databases, new 
>> records are not created to redistribute these records.
> 
> You're also going to run into the "prevent insertions not by Slony" trigger
> here, no?  (Or have you allowed for that?)

This will only happen on the master node, so Slony won't be preventing 
insertions there.

I might have confused folks as I've been posting about two different 
issues.  The main issue on the master node is that we need to make sure 
that the Slony triggers fire when we disable OUR triggers.

The issue on the slave is that we want to be able to add triggers that 
send data to another system, a non-slony system.

My apologies for mixing the two threads.

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From cbbrowne at ca.afilias.info  Mon Jun  9 08:09:11 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Mon Jun  9 08:09:21 2008
Subject: [Slony1-general] slonik segfault
In-Reply-To: <484D2B06.6040400@echo.fr> (Cyril SCETBON's message of "Mon,
	09 Jun 2008 15:07:18 +0200")
References: <48490712.6070202@echo.fr>
	<60lk1io9b8.fsf@dba2.int.libertyrms.com> <484D2B06.6040400@echo.fr>
Message-ID: <60hcc2lk6g.fsf@dba2.int.libertyrms.com>

Cyril SCETBON <scetbon@echo.fr> writes:
> Did you test the script I sent you ? if this is the case, did you get
> the same error ?

I only just saw it...

I don't see anything that seems wrong with it.

I set up a "node 201", and 512 simple tables, and had no trouble
wrapping it with a little bit of extra slonik to make it work.

At the moment, it's 350-odd tables into the subscription process; I
don't anticipate any problems.
-- 
(format nil "~S@~S" "cbbrowne" "cbbrowne.com")
http://linuxfinances.info/info/spreadsheets.html
I've told you for the fifty-thousandth time, stop exaggerating. 
From scetbon at echo.fr  Mon Jun  9 09:03:12 2008
From: scetbon at echo.fr (Cyril SCETBON)
Date: Mon Jun  9 09:03:20 2008
Subject: [Slony1-general] slonik segfault
In-Reply-To: <60hcc2lk6g.fsf@dba2.int.libertyrms.com>
References: <48490712.6070202@echo.fr>	<60lk1io9b8.fsf@dba2.int.libertyrms.com>
	<484D2B06.6040400@echo.fr> <60hcc2lk6g.fsf@dba2.int.libertyrms.com>
Message-ID: <484D5440.2020004@echo.fr>



Christopher Browne wrote:
> Cyril SCETBON <scetbon@echo.fr> writes:
>   
>> Did you test the script I sent you ? if this is the case, did you get
>> the same error ?
>>     
>
> I only just saw it...
>
> I don't see anything that seems wrong with it.
>
> I set up a "node 201", and 512 simple tables, and had no trouble
> wrapping it with a little bit of extra slonik to make it work.
>   
I suppose, you did not get the segmentation fault error
> At the moment, it's 350-odd tables into the subscription process; I
> don't anticipate any problems.
>   
I get the error immediately when I launch the slonik script that's why I 
think it's a parsing error.

It's really seems to be a buggy piece of code.

-- 
Cyril SCETBON - Ing?nieur bases de donn?es
AUSY pour France T?l?com - OPF/PORTAILS/DOP/HEBEX

T?l : +33 (0)4 97 12 87 60
Jabber : cscetbon@jabber.org
France Telecom - Orange
790 Avenue du Docteur Maurice Donat 
B?timent Marco Polo C2 - Bureau 202
06250 Mougins
France

***********************************
Ce message et toutes les pieces jointes (ci-apres le 'message') sont
confidentiels et etablis a l'intention exclusive de ses destinataires.
Toute utilisation ou diffusion non autorisee est interdite.
Tout message electronique est susceptible d'alteration. Le Groupe France
Telecom decline toute responsabilite au titre de ce message s'il a ete
altere, deforme ou falsifie.
Si vous n'etes pas destinataire de ce message, merci de le detruire
immediatement et d'avertir l'expediteur.
***********************************
This message and any attachments (the 'message') are confidential and
intended solely for the addressees.
Any unauthorised use or dissemination is prohibited.
Messages are susceptible to alteration. France Telecom Group shall not be
liable for the message if altered, changed or falsified.
If you are not recipient of this message, please cancel it immediately and
inform the sender.
************************************

From cbbrowne at ca.afilias.info  Mon Jun  9 11:21:18 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Mon Jun  9 11:21:32 2008
Subject: [Slony1-general] slonik segfault
In-Reply-To: <484D5440.2020004@echo.fr> (Cyril SCETBON's message of "Mon,
	09 Jun 2008 18:03:12 +0200")
References: <48490712.6070202@echo.fr>
	<60lk1io9b8.fsf@dba2.int.libertyrms.com> <484D2B06.6040400@echo.fr>
	<60hcc2lk6g.fsf@dba2.int.libertyrms.com> <484D5440.2020004@echo.fr>
Message-ID: <603anmlba9.fsf@dba2.int.libertyrms.com>

Cyril SCETBON <scetbon@echo.fr> writes:
>> I set up a "node 201", and 512 simple tables, and had no trouble
>> wrapping it with a little bit of extra slonik to make it work.
>>
> I suppose, you did not get the segmentation fault error

Correct, I did not get a segmentation fault.

>> At the moment, it's 350-odd tables into the subscription process; I
>> don't anticipate any problems.
>>
> I get the error immediately when I launch the slonik script that's why
> I think it's a parsing error.
>
> It's really seems to be a buggy piece of code.

And that does not particularly make sense in that:
a) I can't duplicate the problem,
b) Others haven't been reporting similar problems.

We didn't create a parser out of whole cloth; we are using Flex and
Bison, which are *widely* used for this purpose.  The FSF periodically
releases updates, demonstrating that bugs are periodically found,
however, we're not using any of the sorts of edges of these tools that
would lead me to expect us to be encountering bugs with those tools.

There has *got* to be some difference between our environments that is
leading to this difference in behaviour; what more can you tell us
about your environment?

- What OS platform?
- What version of PostgreSQL?
- What version of Slony-I?
- How did you get Slony-I installed (e.g. - "downloaded a binary RPM", or
  "built from sources," ...)?

I recall (can't find it in notes :-() a patch not too long back where
we had a case where we ran free() on some arguments in slonik.c before
we used the values; it worked fine on all the platforms we had tried
this on, but someone had a platform where memory allocation worked
slightly differently and that broke.  Given some precise version
information, maybe we can discover what is special about your platform
that something's breaking there.
-- 
let name="cbbrowne" and tld="linuxdatabases.info" in name ^ "@" ^ tld;;
http://linuxdatabases.info/info/wp.html
THERE'S TOO MUCH BLOOD IN MY CAFFEINE SYSTEM!! 
From lists at serioustechnology.com  Mon Jun  9 13:17:17 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Mon Jun  9 13:17:29 2008
Subject: [Slony1-general] What mechanism actually causes replication?
In-Reply-To: <4849A7C8.7070501@serioustechnology.com>
References: <48496043.8060201@serioustechnology.com>	<60r6bamglb.fsf@dba2.int.libertyrms.com>
	<4849A7C8.7070501@serioustechnology.com>
Message-ID: <484D8FCD.5060409@serioustechnology.com>

I may be about to display my ignorance regarding Postgresql, but it 
won't be the first time.

I've got a number of sequences that are to be replicated in our 
databases.  I understand that sequences are special one row tables, but 
I don't see any triggers on my master node sequences that would cause 
the values to be replicated.

How is this handled in Slony?

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From drees76 at gmail.com  Mon Jun  9 13:25:17 2008
From: drees76 at gmail.com (David Rees)
Date: Mon Jun  9 13:25:36 2008
Subject: [Slony1-general] What mechanism actually causes replication?
In-Reply-To: <484D8FCD.5060409@serioustechnology.com>
References: <48496043.8060201@serioustechnology.com>
	<60r6bamglb.fsf@dba2.int.libertyrms.com>
	<4849A7C8.7070501@serioustechnology.com>
	<484D8FCD.5060409@serioustechnology.com>
Message-ID: <72dbd3150806091325w12a7a85dqa9a25732b5c09f18@mail.gmail.com>

On Mon, Jun 9, 2008 at 1:17 PM, Geoffrey <lists@serioustechnology.com> wrote:
> I've got a number of sequences that are to be replicated in our databases.
>  I understand that sequences are special one row tables, but I don't see any
> triggers on my master node sequences that would cause the values to be
> replicated.
>
> How is this handled in Slony?

http://slony.info/documentation/definingsets.html#AEN869
http://slony.info/documentation/stmtsetaddsequence.html

-Dave
From ahodgson at simkin.ca  Mon Jun  9 13:51:07 2008
From: ahodgson at simkin.ca (Alan Hodgson)
Date: Mon Jun  9 13:51:21 2008
Subject: [Slony1-general] What mechanism actually causes replication?
In-Reply-To: <484D8FCD.5060409@serioustechnology.com>
References: <48496043.8060201@serioustechnology.com>
	<4849A7C8.7070501@serioustechnology.com>
	<484D8FCD.5060409@serioustechnology.com>
Message-ID: <200806091351.07215@hal.medialogik.com>

On Monday 09 June 2008, Geoffrey <lists@serioustechnology.com> wrote:
> I've got a number of sequences that are to be replicated in our
> databases.  I understand that sequences are special one row tables, but
> I don't see any triggers on my master node sequences that would cause
> the values to be replicated.
>
> How is this handled in Slony?

I believe it just copies over the current sequence values on every sync, but 
I could be wrong. Obviously, they have to be part of the replication set 
for this to happen.

-- 
Alan
From cbbrowne at ca.afilias.info  Mon Jun  9 13:56:19 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Mon Jun  9 13:56:34 2008
Subject: [Slony1-general] What mechanism actually causes replication?
In-Reply-To: <200806091351.07215@hal.medialogik.com> (Alan Hodgson's message
	of "Mon, 9 Jun 2008 13:51:07 -0700")
References: <48496043.8060201@serioustechnology.com>
	<4849A7C8.7070501@serioustechnology.com>
	<484D8FCD.5060409@serioustechnology.com>
	<200806091351.07215@hal.medialogik.com>
Message-ID: <60prqqjpjg.fsf@dba2.int.libertyrms.com>

Alan Hodgson <ahodgson@simkin.ca> writes:
> On Monday 09 June 2008, Geoffrey <lists@serioustechnology.com> wrote:
>> I've got a number of sequences that are to be replicated in our
>> databases.  I understand that sequences are special one row tables, but
>> I don't see any triggers on my master node sequences that would cause
>> the values to be replicated.
>>
>> How is this handled in Slony?
>
> I believe it just copies over the current sequence values on every sync, but 
> I could be wrong. Obviously, they have to be part of the replication set 
> for this to happen.

They are essentially handled via polling; every time a SYNC is
processed, we pull all of the replicated sequence values.

In v2.0, the values get pulled each time; we only pass on an update
when the sequence actually changes.
-- 
select 'cbbrowne' || '@' || 'linuxfinances.info';
http://linuxdatabases.info/info/nonrdbms.html
I found out why  cats drink out of the toilet. My  mother told me it's
because it's cold in there. And I'm like: How did my mother know THAT?
--Wendy Liebman
From lists at serioustechnology.com  Mon Jun  9 14:03:43 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Mon Jun  9 14:03:57 2008
Subject: [Slony1-general] What mechanism actually causes replication?
In-Reply-To: <60prqqjpjg.fsf@dba2.int.libertyrms.com>
References: <48496043.8060201@serioustechnology.com>	<4849A7C8.7070501@serioustechnology.com>	<484D8FCD.5060409@serioustechnology.com>	<200806091351.07215@hal.medialogik.com>
	<60prqqjpjg.fsf@dba2.int.libertyrms.com>
Message-ID: <484D9AAF.1050209@serioustechnology.com>

Christopher Browne wrote:
> Alan Hodgson <ahodgson@simkin.ca> writes:
>> On Monday 09 June 2008, Geoffrey <lists@serioustechnology.com> wrote:
>>> I've got a number of sequences that are to be replicated in our
>>> databases.  I understand that sequences are special one row tables, but
>>> I don't see any triggers on my master node sequences that would cause
>>> the values to be replicated.
>>>
>>> How is this handled in Slony?
>> I believe it just copies over the current sequence values on every sync, but 
>> I could be wrong. Obviously, they have to be part of the replication set 
>> for this to happen.
> 
> They are essentially handled via polling; every time a SYNC is
> processed, we pull all of the replicated sequence values.
> 
> In v2.0, the values get pulled each time; we only pass on an update
> when the sequence actually changes.

So then I assume that I don't need to worry about replication_role 
values with regard to replicating sequences, since there are no triggers 
involved.


-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From scetbon at echo.fr  Tue Jun 10 03:21:01 2008
From: scetbon at echo.fr (Cyril SCETBON)
Date: Tue Jun 10 03:21:34 2008
Subject: [Slony1-general] slonik segfault
In-Reply-To: <603anmlba9.fsf@dba2.int.libertyrms.com>
References: <48490712.6070202@echo.fr>	<60lk1io9b8.fsf@dba2.int.libertyrms.com>
	<484D2B06.6040400@echo.fr>	<60hcc2lk6g.fsf@dba2.int.libertyrms.com>
	<484D5440.2020004@echo.fr> <603anmlba9.fsf@dba2.int.libertyrms.com>
Message-ID: <484E558D.3020806@echo.fr>



Christopher Browne wrote:
> Cyril SCETBON <scetbon@echo.fr> writes:
>   
>>> I set up a "node 201", and 512 simple tables, and had no trouble
>>> wrapping it with a little bit of extra slonik to make it work.
>>>
>>>       
>> I suppose, you did not get the segmentation fault error
>>     
>
> Correct, I did not get a segmentation fault.
>   
ok
>   
>>> At the moment, it's 350-odd tables into the subscription process; I
>>> don't anticipate any problems.
>>>
>>>       
>> I get the error immediately when I launch the slonik script that's why
>> I think it's a parsing error.
>>
>> It really seems to be a buggy piece of code.
>>     
>
> And that does not particularly make sense in that:
> a) I can't duplicate the problem,
> b) Others haven't been reporting similar problems.
>
> We didn't create a parser out of whole cloth; we are using Flex and
> Bison, which are *widely* used for this purpose.  The FSF periodically
> releases updates, demonstrating that bugs are periodically found,
> however, we're not using any of the sorts of edges of these tools that
> would lead me to expect us to be encountering bugs with those tools.
>   
ok
> There has *got* to be some difference between our environments that is
> leading to this difference in behaviour; what more can you tell us
> about your environment?
>
> - What OS platform?
>   
Linux Debian Etch amd64 (X86_64)
> - What version of PostgreSQL?
>   
8.2.4
> - What version of Slony-I?
>   
1.2.10
> - How did you get Slony-I installed (e.g. - "downloaded a binary RPM", or
>   "built from sources," ...)?
>   
debian packages maintained by Peter Eisentraut
> I recall (can't find it in notes :-() a patch not too long back where
> we had a case where we ran free() on some arguments in slonik.c before
> we used the values; it worked fine on all the platforms we had tried
> this on, but someone had a platform where memory allocation worked
> slightly differently and that broke.  Given some precise version
> information, maybe we can discover what is special about your platform
> that something's breaking there.
>   
Regards
-- 
Cyril SCETBON
From lists at serioustechnology.com  Tue Jun 10 11:05:26 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Tue Jun 10 11:05:35 2008
Subject: [Slony1-general] truncate of "public"."foo" succeeded
Message-ID: <484EC266.40309@serioustechnology.com>

I don't remember seeing these messages before, maybe I'm wrong. 
Question is, the node 2 database I'm replicating to, is already empty. 
Does slony simply try a wholesale truncation of all replicated tables 
anyway?

Also, I see a couple messages like these:

truncate of "public"."foo" failed - doing delete

I don't understand why the truncation would fail.

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From cbbrowne at ca.afilias.info  Tue Jun 10 11:13:01 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Tue Jun 10 11:13:11 2008
Subject: [Slony1-general] truncate of "public"."foo" succeeded
In-Reply-To: <484EC266.40309@serioustechnology.com> (Geoffrey's message of
	"Tue, 10 Jun 2008 14:05:26 -0400")
References: <484EC266.40309@serioustechnology.com>
Message-ID: <608wxdjh02.fsf@dba2.int.libertyrms.com>

Geoffrey <lists@serioustechnology.com> writes:
> I don't remember seeing these messages before, maybe I'm
> wrong. Question is, the node 2 database I'm replicating to, is already
> empty. Does slony simply try a wholesale truncation of all replicated
> tables anyway?

Yes, it does, in order to make *sure* that it's starting with a clean
slate.

> Also, I see a couple messages like these:
>
> truncate of "public"."foo" failed - doing delete
>
> I don't understand why the truncation would fail.

That normally happens because Slony-I found a foreign key constraint
that prevented TRUNCATE from working.  No big problem.
-- 
(reverse (concatenate 'string "moc.enworbbc" "@" "enworbbc"))
http://www3.sympatico.ca/cbbrowne/rdbms.html
"... While programs written for Sun machines won't run unmodified on
Intel-based computers, Sun said the two packages will be completely
compatible and that software companies can convert a program from one
system to the other through a fairly straightforward and automated
process known as ``recompiling.''" -- San Jose Mercury News
From wmoran at collaborativefusion.com  Tue Jun 10 11:16:25 2008
From: wmoran at collaborativefusion.com (Bill Moran)
Date: Tue Jun 10 11:17:33 2008
Subject: [Slony1-general] truncate of "public"."foo" succeeded
In-Reply-To: <484EC266.40309@serioustechnology.com>
References: <484EC266.40309@serioustechnology.com>
Message-ID: <20080610141625.42c5b9d6.wmoran@collaborativefusion.com>

In response to Geoffrey <lists@serioustechnology.com>:

> I don't remember seeing these messages before, maybe I'm wrong. 
> Question is, the node 2 database I'm replicating to, is already empty. 
> Does slony simply try a wholesale truncation of all replicated tables 
> anyway?

Yes.  Slony doesn't trust the user to have a properly cleaned out
database, which (IMHO) is A Good Thing.

> Also, I see a couple messages like these:
> 
> truncate of "public"."foo" failed - doing delete
> 
> I don't understand why the truncation would fail.

>From the PostgreSQL docs:
RESTRICT

    Refuse to truncate if any of the tables have foreign-key references from tables that are not to be truncated. This is the default. 


-- 
Bill Moran
Collaborative Fusion Inc.
http://people.collaborativefusion.com/~wmoran/

wmoran@collaborativefusion.com
Phone: 412-422-3463x4023
From lists at serioustechnology.com  Tue Jun 10 11:30:41 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Tue Jun 10 11:30:52 2008
Subject: [Slony1-general] truncate of "public"."foo" succeeded
In-Reply-To: <608wxdjh02.fsf@dba2.int.libertyrms.com>
References: <484EC266.40309@serioustechnology.com>
	<608wxdjh02.fsf@dba2.int.libertyrms.com>
Message-ID: <484EC851.5080202@serioustechnology.com>

Christopher Browne wrote:
> Geoffrey <lists@serioustechnology.com> writes:
>> I don't remember seeing these messages before, maybe I'm
>> wrong. Question is, the node 2 database I'm replicating to, is already
>> empty. Does slony simply try a wholesale truncation of all replicated
>> tables anyway?
> 
> Yes, it does, in order to make *sure* that it's starting with a clean
> slate.
> 
>> Also, I see a couple messages like these:
>>
>> truncate of "public"."foo" failed - doing delete
>>
>> I don't understand why the truncation would fail.
> 
> That normally happens because Slony-I found a foreign key constraint
> that prevented TRUNCATE from working.  No big problem.

Thank you both Chris and Bill.

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From lists at serioustechnology.com  Tue Jun 10 13:14:54 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Tue Jun 10 13:15:08 2008
Subject: [Slony1-general] FATAL error in log
Message-ID: <484EE0BE.8050005@serioustechnology.com>

I'm seeing the following error in my logs and I don't quite understand 
why.  The sequence noted in the error is the 19th sequence in the set. 
It's the first set, so I don't know how it is possible that the 19th 
sequence id could already be used:

2008-06-10 16:09:01 EDT ERROR  remoteWorkerThread_1: "select 
"_ser_cluster".setAddSequence_int(1, 19, '"public"."sched_recid_seq"', 
'Sequence public.sched_recid_seq')" PGRES_FATAL_ERROR ERROR:  Slony-I: 
setAddSequence_int(): sequence ID 19 has already been assigned


Any insights will be greatly appreciated.  Here is the set definition:

  "avldsSet" => {

     "set_id" => 1,
     "table_id"    => 1,
     "sequence_id" => 1,

      "pkeyedtables" => [
         "avlds", "bill", "cash", "edi204h", "edi210h",
         "edi214h", "fax", "invoice", "item", "logs",
         "mbill", "mcash", "monetary", "move", "mpaid",
         "mpay", "pallet", "pay", "sched", "settle"
     ],

     "sequences" => [
         "avlds_recid_seq", "bill_recid_seq", "cash_recid_seq",
         "edi204h_recid_seq", "edi210h_recid_seq", "edi214h_recid_seq",
         "fax_recid_seq", "invoice_recid_seq", "item_recid_seq",
         "logs_recid_seq", "mbill_recid_seq", "mcash_recid_seq",
         "monetary_recid_seq", "move_recid_seq", "mpaid_recid_seq",
         "mpay_recid_seq", "pallet_recid_seq", "pay_recid_seq",
         "sched_recid_seq", "settle_recid_seq", "avlds_order_num_seq"
         ],
     },


-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From ajs at crankycanuck.ca  Tue Jun 10 13:34:01 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Tue Jun 10 13:34:30 2008
Subject: [Slony1-general] FATAL error in log
In-Reply-To: <484EE0BE.8050005@serioustechnology.com>
References: <484EE0BE.8050005@serioustechnology.com>
Message-ID: <20080610203400.GB8828@crankycanuck.ca>

On Tue, Jun 10, 2008 at 04:14:54PM -0400, Geoffrey wrote:

> 2008-06-10 16:09:01 EDT ERROR  remoteWorkerThread_1: "select 
> "_ser_cluster".setAddSequence_int(1, 19, '"public"."sched_recid_seq"', 
> 'Sequence public.sched_recid_seq')" PGRES_FATAL_ERROR ERROR:  Slony-I: 
> setAddSequence_int(): sequence ID 19 has already been assigned

Do you have another set with a sequence 19 in it?

From lists at serioustechnology.com  Tue Jun 10 13:49:51 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Tue Jun 10 13:50:05 2008
Subject: [Slony1-general] FATAL error in log
In-Reply-To: <20080610203400.GB8828@crankycanuck.ca>
References: <484EE0BE.8050005@serioustechnology.com>
	<20080610203400.GB8828@crankycanuck.ca>
Message-ID: <484EE8EF.4040600@serioustechnology.com>

Andrew Sullivan wrote:
> On Tue, Jun 10, 2008 at 04:14:54PM -0400, Geoffrey wrote:
> 
>> 2008-06-10 16:09:01 EDT ERROR  remoteWorkerThread_1: "select 
>> "_ser_cluster".setAddSequence_int(1, 19, '"public"."sched_recid_seq"', 
>> 'Sequence public.sched_recid_seq')" PGRES_FATAL_ERROR ERROR:  Slony-I: 
>> setAddSequence_int(): sequence ID 19 has already been assigned
> 
> Do you have another set with a sequence 19 in it?

No, this is the first set.  The next set starts the sequence id at 100. 
  There's only two sets.

I'm using the slonik scripts.

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From msteben at autorevenue.com  Wed Jun 11 08:12:28 2008
From: msteben at autorevenue.com (Mark Steben)
Date: Wed Jun 11 08:12:46 2008
Subject: [Slony1-general] Newbie to slony-1
Message-ID: <004401c8cbd5$902c15e0$14010a0a@dei26g028575>

Hi, this is the first time I'm attempting to use slony. I have just a few
quick 'get started'questions.

 

I have successfully installed slony 1.2.14 on both intended master and slave
machines.

Although the machines are in the same physical location they are on separate
subnets.

I have copied the database schema that I intend to perform replication on
onto the slave machine.

Now I am attempting to run the slonik script to define the cluster, nodes,
add table sets, 

  Store nodes, store paths, and store listens

 

1.      I believe the master admin node has been defined but the slave admin
node had an error

During definition.  How do I verify that? In fact are there verification
tools for me to use?

2.      How do I 'restart' the definition process. When I just resubmit the
shell script it tells

Me that the master node has already been defined and kicks out.  Do I just
start

With the slave node definition?

3.      Any other 'words to the wise' for the newbie would be appreciated.

 

I am tailoring my definition script from the one offered by the Open
Technology Group

Administration class.  Thank you for your time.

 

 

Mark Steben

Senior Database Administrator
@utoRevenueT 
A Dominion Enterprises Company
480 Pleasant Street
Suite B200
Lee, MA 01238
413-243-4800 Home Office 
413-243-4809 Corporate Fax

msteben <blocked::mailto:name@autorevenue.com> @autorevenue.com

Visit our new website at 
 <blocked::http://www.autorevenue.com/> www.autorevenue.com

 

IMPORTANT: The information contained in this e-mail message is confidential
and is intended only for the named addressee(s). If the reader of this
e-mail message is not the intended recipient (or the individual responsible
for the delivery of this e-mail message to the intended recipient), please
be advised that any re-use, dissemination, distribution or copying of this
e-mail message is prohibited.  If you have received this e-mail message in
error, please reply to the sender that you have received this e-mail message
in error and then delete it.  Thank you.

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080611/a018c410/attachment.htm
From jc at oxado.com  Wed Jun 11 08:37:51 2008
From: jc at oxado.com (Jacques Caron)
Date: Wed Jun 11 08:38:06 2008
Subject: [Slony1-general] slonik segfault
In-Reply-To: <48490712.6070202@echo.fr>
References: <48490712.6070202@echo.fr>
Message-ID: <20080611153755.30645120F045@zeus.directinfos.com>

At 11:44 06/06/2008, Cyril SCETBON wrote:
>Hi guys,
>
>When I try to create a lot of set slonik dies with segmentation 
>fault message. The only way to succeed is to split the file 
>containing the create set statement and to try them one by one or 
>two by two. When I use strace on slonik it displays :
>
>read(3, "#--\n# Slony-I organizes tables i"..., 8192) = 8192
>read(3, "d table (set id=5, origin=201, i"..., 8192) = 8192
>read(3, ");\nset add table (set id=9, orig"..., 8192) = 8192
>mmap(NULL, 18446744073709547520, PROT_READ|PROT_WRITE, 
>MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = -1 ENOMEM (Cannot allocate memory)

FYI, the mmap size is the (unsigned 64 bit integer) equivalent of 
-4096, so it looks like "something" attempted a negative size malloc 
(that got rounded to -4096, a multiple of the page size). Not quite 
sure which piece of code could lead to that result...

Jacques.

From Marcin.Kasperski at softax.com.pl  Wed Jun 11 10:35:40 2008
From: Marcin.Kasperski at softax.com.pl (Marcin Kasperski)
Date: Wed Jun 11 10:31:19 2008
Subject: [Slony1-general] Re: Newbie to slony-1
References: <004401c8cbd5$902c15e0$14010a0a@dei26g028575>
Message-ID: <87hcbzg9hv.fsf@softax.com.pl>

> 2.      How do I ?restart? the definition process. When I just resubmit the
> shell script it tells
>
> Me that the master node has already been defined and kicks out.  Do I just
> start > With the slave node definition?

Yes. In general, save output from slonik to the file, comment out the
already executed commands, submit the rest.

> 3.      Any other ?words to the wise? for the newbie would be appreciated.

You may find my recent post

http://article.gmane.org/gmane.comp.db.postgresql.slony1.general/6686

to be of some interest, I recently went through this path.

> IMPORTANT: The information contained in this e-mail message is confidential and
> is intended only for the named addressee(s). 

Yeah, I always find this very funny to see such clauses on public
mailing lists. Ugh, is it legal that I posted a reply???

-- 
----------------------------------------------------------------------
| Marcin Kasperski   | You have the right to produce quality work
| http://mekk.waw.pl |          at all the times. (Beck)
|                    |
----------------------------------------------------------------------

From lists at serioustechnology.com  Wed Jun 11 10:51:12 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Wed Jun 11 10:51:23 2008
Subject: [Slony1-general] replication set up, but no replication
Message-ID: <48501090.6040201@serioustechnology.com>

I'm am totally confused and really don't know where else to look.  We 
have 12 databases that I'm trying to replicate.  They all have their own 
postmaster and separate ports.  I wrote a script, which uses the altperl 
scripts to setup slony and get replication going.  This script has 
worked flawlessly in the past.  All you do is pass it the database name 
and it takes it from there.

I put it in a loop so that it would run through all the databases.  Now 
here's the weird part.  Although it appears that all databases were 
properly set up for replication, about half of them are not.  That is to 
say, that tables that I know should be replicating have no records in 
them on the node 2 box.

So, I started over and first tested one of the databases that properly 
replicated and it worked fine again.   I then ran the same script for 
one of the databases that did not replicate, and again there is no 
transfer of data.  The tables are empty on the node 2 machine.

Looking at the logs, I don't see anything that jumps out at me.  How can 
I determine why this is not working?

Both machines are running Red Hat EL 4 and:

Postgres 8.3.1
slony 1.2.14

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From lists at serioustechnology.com  Wed Jun 11 11:01:51 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Wed Jun 11 11:02:03 2008
Subject: [Slony1-general] replication set up, but no replication
In-Reply-To: <48501090.6040201@serioustechnology.com>
References: <48501090.6040201@serioustechnology.com>
Message-ID: <4850130F.9010600@serioustechnology.com>

More info on this issue. Okay, found something else here:

remoteWorkerThread_1: copy from stdin on local node - PGRES_FATAL_ERROR 
ERROR:  invalid byte sequence for encoding "UTF8": 0xfa
HINT:  This error can also happen if the byte sequence does not match 
the encoding expected by the server, which is controlled by 
"client_encoding".
CONTEXT:  COPY avlds, line 339294

Is this a complaint because Slony expects one type of encoding and 
Postgresql is using a different one?  Or is it because of difference 
encoding between the two nodes?  As far as I can see, the encoding is 
the same on both nodes.

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From pgsql at j-davis.com  Wed Jun 11 11:07:52 2008
From: pgsql at j-davis.com (Jeff Davis)
Date: Wed Jun 11 11:08:04 2008
Subject: [Slony1-general] replication set up, but no replication
In-Reply-To: <4850130F.9010600@serioustechnology.com>
References: <48501090.6040201@serioustechnology.com>
	<4850130F.9010600@serioustechnology.com>
Message-ID: <1213207672.31665.4.camel@dogma.ljc.laika.com>

On Wed, 2008-06-11 at 14:01 -0400, Geoffrey wrote:
> remoteWorkerThread_1: copy from stdin on local node - PGRES_FATAL_ERROR 
> ERROR:  invalid byte sequence for encoding "UTF8": 0xfa
> HINT:  This error can also happen if the byte sequence does not match 
> the encoding expected by the server, which is controlled by 
> "client_encoding".
> CONTEXT:  COPY avlds, line 339294
> 
> Is this a complaint because Slony expects one type of encoding and 
> Postgresql is using a different one?  Or is it because of difference 
> encoding between the two nodes?  As far as I can see, the encoding is 
> the same on both nodes.

If the encoding is the same everywhere, and you are using PostgreSQL
8.2, it's likely that you got an invalid byte sequence in a text field
by using backslash-escapes.

Once that happens, COPY will no longer work correctly. In fact, a
pg_dump might not be able to be restored.

Slony relies on COPY working correctly, so it's failing for that reason.

Try sanitizing your data to be valid UTF-8 or only using the C locale
(SQL_ASCII encoding).

Regards,
	Jeff Davis

From lists at serioustechnology.com  Wed Jun 11 11:20:36 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Wed Jun 11 11:20:49 2008
Subject: [Slony1-general] replication set up, but no replication
In-Reply-To: <1213207672.31665.4.camel@dogma.ljc.laika.com>
References: <48501090.6040201@serioustechnology.com>	
	<4850130F.9010600@serioustechnology.com>
	<1213207672.31665.4.camel@dogma.ljc.laika.com>
Message-ID: <48501774.3090706@serioustechnology.com>

Jeff Davis wrote:
> On Wed, 2008-06-11 at 14:01 -0400, Geoffrey wrote:
>> remoteWorkerThread_1: copy from stdin on local node - PGRES_FATAL_ERROR 
>> ERROR:  invalid byte sequence for encoding "UTF8": 0xfa
>> HINT:  This error can also happen if the byte sequence does not match 
>> the encoding expected by the server, which is controlled by 
>> "client_encoding".
>> CONTEXT:  COPY avlds, line 339294
>>
>> Is this a complaint because Slony expects one type of encoding and 
>> Postgresql is using a different one?  Or is it because of difference 
>> encoding between the two nodes?  As far as I can see, the encoding is 
>> the same on both nodes.
> 
> If the encoding is the same everywhere, and you are using PostgreSQL
> 8.2, it's likely that you got an invalid byte sequence in a text field
> by using backslash-escapes.
> 
> Once that happens, COPY will no longer work correctly. In fact, a
> pg_dump might not be able to be restored.
> 
> Slony relies on COPY working correctly, so it's failing for that reason.
> 
> Try sanitizing your data to be valid UTF-8 or only using the C locale
> (SQL_ASCII encoding).

I think I'm on to something here.  The encoding is in fact different on 
the two nodes.  I'm going to correct that issue and retry my replication.

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From pgsql at j-davis.com  Wed Jun 11 11:24:16 2008
From: pgsql at j-davis.com (Jeff Davis)
Date: Wed Jun 11 11:24:27 2008
Subject: [Slony1-general] replication set up, but no replication
In-Reply-To: <1213207672.31665.4.camel@dogma.ljc.laika.com>
References: <48501090.6040201@serioustechnology.com>
	<4850130F.9010600@serioustechnology.com>
	<1213207672.31665.4.camel@dogma.ljc.laika.com>
Message-ID: <1213208656.31665.9.camel@dogma.ljc.laika.com>

On Wed, 2008-06-11 at 11:07 -0700, Jeff Davis wrote:
> If the encoding is the same everywhere, and you are using PostgreSQL
> 8.2, it's likely that you got an invalid byte sequence in a text field
> by using backslash-escapes.

I see you're using 8.3, where this problem should be fixed. Are you sure
that it's 8.3 everywhere, and the same encoding/locale everywhere?

It appears that you got an invalid byte sequence in there somehow, can
you investigate a little and see where it's coming from?

Regards,
	Jeff Davis

From scetbon at echo.fr  Wed Jun 11 12:53:35 2008
From: scetbon at echo.fr (Cyril SCETBON)
Date: Wed Jun 11 12:54:05 2008
Subject: [Slony1-general] slonik segfault
In-Reply-To: <20080611153755.30645120F045@zeus.directinfos.com>
References: <48490712.6070202@echo.fr>
	<20080611153755.30645120F045@zeus.directinfos.com>
Message-ID: <48502D3F.8080001@echo.fr>



Jacques Caron wrote:
> At 11:44 06/06/2008, Cyril SCETBON wrote:
>> Hi guys,
>>
>> When I try to create a lot of set slonik dies with segmentation fault 
>> message. The only way to succeed is to split the file containing the 
>> create set statement and to try them one by one or two by two. When I 
>> use strace on slonik it displays :
>>
>> read(3, "#--\n# Slony-I organizes tables i"..., 8192) = 8192
>> read(3, "d table (set id=5, origin=201, i"..., 8192) = 8192
>> read(3, ");\nset add table (set id=9, orig"..., 8192) = 8192
>> mmap(NULL, 18446744073709547520, PROT_READ|PROT_WRITE, 
>> MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = -1 ENOMEM (Cannot allocate memory)
>
> FYI, the mmap size is the (unsigned 64 bit integer) equivalent of 
> -4096, so it looks like "something" attempted a negative size malloc 
> (that got rounded to -4096, a multiple of the page size). Not quite 
> sure which piece of code could lead to that result...
the type is an unsigned integer. So if the value is too big a cast 
occurs that should not give a negative value, but a shorter value...
>
> Jacques.
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general

-- 
Cyril SCETBON - Ing?nieur bases de donn?es
AUSY pour France T?l?com - OPF/PORTAILS/DOP/HEBEX

T?l : +33 (0)4 97 12 87 60
Jabber : cscetbon@jabber.org
France Telecom - Orange
790 Avenue du Docteur Maurice Donat 
B?timent Marco Polo C2 - Bureau 202
06250 Mougins
France

***********************************
Ce message et toutes les pieces jointes (ci-apres le 'message') sont
confidentiels et etablis a l'intention exclusive de ses destinataires.
Toute utilisation ou diffusion non autorisee est interdite.
Tout message electronique est susceptible d'alteration. Le Groupe France
Telecom decline toute responsabilite au titre de ce message s'il a ete
altere, deforme ou falsifie.
Si vous n'etes pas destinataire de ce message, merci de le detruire
immediatement et d'avertir l'expediteur.
***********************************
This message and any attachments (the 'message') are confidential and
intended solely for the addressees.
Any unauthorised use or dissemination is prohibited.
Messages are susceptible to alteration. France Telecom Group shall not be
liable for the message if altered, changed or falsified.
If you are not recipient of this message, please cancel it immediately and
inform the sender.
************************************

From lists at serioustechnology.com  Wed Jun 11 13:14:42 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Wed Jun 11 13:14:57 2008
Subject: [Slony1-general] replication set up, but no replication
In-Reply-To: <1213208656.31665.9.camel@dogma.ljc.laika.com>
References: <48501090.6040201@serioustechnology.com>	
	<4850130F.9010600@serioustechnology.com>	
	<1213207672.31665.4.camel@dogma.ljc.laika.com>
	<1213208656.31665.9.camel@dogma.ljc.laika.com>
Message-ID: <48503232.7050607@serioustechnology.com>

Jeff Davis wrote:
> On Wed, 2008-06-11 at 11:07 -0700, Jeff Davis wrote:
>> If the encoding is the same everywhere, and you are using PostgreSQL
>> 8.2, it's likely that you got an invalid byte sequence in a text field
>> by using backslash-escapes.
> 
> I see you're using 8.3, where this problem should be fixed. Are you sure
> that it's 8.3 everywhere, and the same encoding/locale everywhere?

I definitely seem some issues with encoding, and from what I see, 
there's database and client encoding.  The database encoding is 
different, but I've not figured out where that is configured, assuming 
it should be in the postgresql.conf file somewhere.  It appears that the 
client_encoding is different as well, although I would have expected 
that to have been taken care when the databases were built.  I have 
explicitly set the client_encoding in the postgresql.conf file, but 
haven't found where to set the database encoding.

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From lists at serioustechnology.com  Wed Jun 11 13:27:17 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Wed Jun 11 13:27:31 2008
Subject: [Slony1-general] table truncation
Message-ID: <48503525.3040405@serioustechnology.com>

I'm assuming that when replicating data, only replicated tables are 
truncated?  It makes sense, but I want to make sure I'm not missing 
something.  After all, Slony doesn't know about tables you haven't told 
it about, right?

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From pgsql at j-davis.com  Wed Jun 11 13:58:50 2008
From: pgsql at j-davis.com (Jeff Davis)
Date: Wed Jun 11 13:59:05 2008
Subject: [Slony1-general] replication set up, but no replication
In-Reply-To: <48503232.7050607@serioustechnology.com>
References: <48501090.6040201@serioustechnology.com>
	<4850130F.9010600@serioustechnology.com>
	<1213207672.31665.4.camel@dogma.ljc.laika.com>
	<1213208656.31665.9.camel@dogma.ljc.laika.com>
	<48503232.7050607@serioustechnology.com>
Message-ID: <1213217930.31665.13.camel@dogma.ljc.laika.com>

On Wed, 2008-06-11 at 16:14 -0400, Geoffrey wrote:
> I definitely seem some issues with encoding, and from what I see, 
> there's database and client encoding.  The database encoding is 
> different, but I've not figured out where that is configured, assuming 
> it should be in the postgresql.conf file somewhere.  It appears that the 
> client_encoding is different as well, although I would have expected 
> that to have been taken care when the databases were built.  I have 
> explicitly set the client_encoding in the postgresql.conf file, but 
> haven't found where to set the database encoding.

The database encoding can only be set at initdb time. Client_encoding is
only used to be able to convert from one encoding to another, assuming
that some conversion exists. You might be able to get it working by
setting the client encoding to something like iso-8859-1.

The PostgreSQL manual has more details.

Regards,
	Jeff Davis

From lists at serioustechnology.com  Wed Jun 11 14:43:34 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Wed Jun 11 14:43:51 2008
Subject: [Slony1-general] replication set up, but no replication
In-Reply-To: <1213217930.31665.13.camel@dogma.ljc.laika.com>
References: <48501090.6040201@serioustechnology.com>	
	<4850130F.9010600@serioustechnology.com>	
	<1213207672.31665.4.camel@dogma.ljc.laika.com>	
	<1213208656.31665.9.camel@dogma.ljc.laika.com>	
	<48503232.7050607@serioustechnology.com>
	<1213217930.31665.13.camel@dogma.ljc.laika.com>
Message-ID: <48504706.9080708@serioustechnology.com>

Jeff Davis wrote:
> On Wed, 2008-06-11 at 16:14 -0400, Geoffrey wrote:
>> I definitely seem some issues with encoding, and from what I see, 
>> there's database and client encoding.  The database encoding is 
>> different, but I've not figured out where that is configured, assuming 
>> it should be in the postgresql.conf file somewhere.  It appears that the 
>> client_encoding is different as well, although I would have expected 
>> that to have been taken care when the databases were built.  I have 
>> explicitly set the client_encoding in the postgresql.conf file, but 
>> haven't found where to set the database encoding.
> 
> The database encoding can only be set at initdb time. Client_encoding is
> only used to be able to convert from one encoding to another, assuming
> that some conversion exists. You might be able to get it working by
> setting the client encoding to something like iso-8859-1.
> 
> The PostgreSQL manual has more details.

Thanks, I'm in the process of re-creating the node 2 empty databases 
with the proper encoding.  Something must have changed from 7.4 to 8.3, 
because I used the same process to create these databases, and didn't 
have this problem before.

> 
> Regards,
> 	Jeff Davis
> 
> 


-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From cbbrowne at ca.afilias.info  Wed Jun 11 15:36:27 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed Jun 11 15:36:43 2008
Subject: [Slony1-general] table truncation
In-Reply-To: <48503525.3040405@serioustechnology.com> (Geoffrey's message of
	"Wed, 11 Jun 2008 16:27:17 -0400")
References: <48503525.3040405@serioustechnology.com>
Message-ID: <60r6b3iopg.fsf@dba2.int.libertyrms.com>

Geoffrey <lists@serioustechnology.com> writes:
> I'm assuming that when replicating data, only replicated tables are
> truncated?  It makes sense, but I want to make sure I'm not missing
> something.  After all, Slony doesn't know about tables you haven't
> told it about, right?

Right!  Slony-I will truncate some of its own internal tables, but I
don't think you were worried about those ;-).
-- 
let name="cbbrowne" and tld="acm.org" in String.concat "@" [name;tld];;
http://cbbrowne.com/info/
A Linux  machine!  because  a 486  is a terrible  thing to  waste!  
-- <jjs@wintermute.ucr.edu> Joe Sloan
From lists at serioustechnology.com  Wed Jun 11 15:47:43 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Wed Jun 11 15:48:00 2008
Subject: [Slony1-general] table truncation
In-Reply-To: <60r6b3iopg.fsf@dba2.int.libertyrms.com>
References: <48503525.3040405@serioustechnology.com>
	<60r6b3iopg.fsf@dba2.int.libertyrms.com>
Message-ID: <4850560F.5060706@serioustechnology.com>

Christopher Browne wrote:
> Geoffrey <lists@serioustechnology.com> writes:
>> I'm assuming that when replicating data, only replicated tables are
>> truncated?  It makes sense, but I want to make sure I'm not missing
>> something.  After all, Slony doesn't know about tables you haven't
>> told it about, right?
> 
> Right!  Slony-I will truncate some of its own internal tables, but I
> don't think you were worried about those ;-).

True, I've got enough to worry about. ;)

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From jc at oxado.com  Wed Jun 11 15:49:47 2008
From: jc at oxado.com (Jacques Caron)
Date: Wed Jun 11 16:34:26 2008
Subject: [Slony1-general] slonik segfault
In-Reply-To: <48502D3F.8080001@echo.fr>
References: <48490712.6070202@echo.fr>
	<20080611153755.30645120F045@zeus.directinfos.com>
	<48502D3F.8080001@echo.fr>
Message-ID: <20080611233404.0B2B0120F03D@zeus.directinfos.com>

Try this:

cat >test_4096.c <<EOF
#include <stdio.h>

int main()
{
         unsigned long long a;

         a = -4096;

         printf("%llu\n",a);

         return 0;
}
EOF
cc -g -Wall test_4096.c -o test_4096
./test_4096

-4096 is represented as 0xfffffffffffff000 (as a signed 64 bit 
integer). If you cast it to an unsigned 64 bit integer, you get 
18446744073709547520.

The probability that something calls malloc requesting 18 billion 
gigabytes is low. The probability that something calls malloc 
requesting a negative size is much higher.

You might want to try strace'ing a one-liner that does a "malloc(-1)" 
(or more certainly "malloc(-4097)" depending on how the "rounding" is 
done?) just for fun :-)

cat >test_malloc.c <<EOF
#include <stdlib.h>

int main()
{
         malloc(-1);
         return 0;
}
EOF
cc -g -Wall test_malloc.c -o test_malloc
strace ./test_malloc

Results differ from platform to platform, depending mainly on the 
specific implementation of malloc. FreeBSD doesn't yield any "fun" 
results, but apparently your OS does.

I have gone quickly through the slonik source, including the flex and 
bison generated code, and I don't offhand see any reason for a 
negative malloc to happen, but there must be a case where something 
ends up requesting a negative number of bytes. My guess was around 
the yyleng manipulation, but it seems (?) to be correct, so it must 
be somewhere else, or it is your version of flex or bison that is buggy.

What are your versions of flex and bison?

Jacques.

At 21:53 11/06/2008, Cyril SCETBON wrote:


>Jacques Caron wrote:
>>At 11:44 06/06/2008, Cyril SCETBON wrote:
>>>Hi guys,
>>>
>>>When I try to create a lot of set slonik dies with segmentation 
>>>fault message. The only way to succeed is to split the file 
>>>containing the create set statement and to try them one by one or 
>>>two by two. When I use strace on slonik it displays :
>>>
>>>read(3, "#--\n# Slony-I organizes tables i"..., 8192) = 8192
>>>read(3, "d table (set id=5, origin=201, i"..., 8192) = 8192
>>>read(3, ");\nset add table (set id=9, orig"..., 8192) = 8192
>>>mmap(NULL, 18446744073709547520, PROT_READ|PROT_WRITE, 
>>>MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = -1 ENOMEM (Cannot allocate memory)
>>
>>FYI, the mmap size is the (unsigned 64 bit integer) equivalent of 
>>-4096, so it looks like "something" attempted a negative size 
>>malloc (that got rounded to -4096, a multiple of the page size). 
>>Not quite sure which piece of code could lead to that result...
>the type is an unsigned integer. So if the value is too big a cast 
>occurs that should not give a negative value, but a shorter value...
>>
>>Jacques.
>>
>>_______________________________________________
>>Slony1-general mailing list
>>Slony1-general@lists.slony.info
>>http://lists.slony.info/mailman/listinfo/slony1-general
>
>--
>Cyril SCETBON - Ing?nieur bases de donn?es
>AUSY pour France T?l?com - OPF/PORTAILS/DOP/HEBEX
>
>T?l : +33 (0)4 97 12 87 60
>Jabber : cscetbon@jabber.org
>France Telecom - Orange
>790 Avenue du Docteur Maurice Donat B?timent Marco Polo C2 - Bureau 202
>06250 Mougins
>France
>
>***********************************
>Ce message et toutes les pieces jointes (ci-apres le 'message') sont
>confidentiels et etablis a l'intention exclusive de ses destinataires.
>Toute utilisation ou diffusion non autorisee est interdite.
>Tout message electronique est susceptible d'alteration. Le Groupe France
>Telecom decline toute responsabilite au titre de ce message s'il a ete
>altere, deforme ou falsifie.
>Si vous n'etes pas destinataire de ce message, merci de le detruire
>immediatement et d'avertir l'expediteur.
>***********************************
>This message and any attachments (the 'message') are confidential and
>intended solely for the addressees.
>Any unauthorised use or dissemination is prohibited.
>Messages are susceptible to alteration. France Telecom Group shall not be
>liable for the message if altered, changed or falsified.
>If you are not recipient of this message, please cancel it immediately and
>inform the sender.
>************************************

From dquiroga at integratech.com.ar  Wed Jun 11 20:09:03 2008
From: dquiroga at integratech.com.ar (Damian Quiroga)
Date: Wed Jun 11 20:09:24 2008
Subject: [Slony1-general] High memory usage when using high table id
Message-ID: <2060915e0806112009o47b6f010rde50ad2be7929214@mail.gmail.com>

Hi

I'm replicating a database with about a hundred tables using slony. I have a
master node and a slave node.

The memory usage of the slon processes are normally only a few MB. I have
noticed however that adding a table named cdr.cdr_20080611 to the
replication causes the memory use of the slon process for the slave node to
raise to about 161 MB. even if the table is empty.

After many tests I realized that the reason for this behavior is that I am
using table id 20080611 when I add this table to a set. If I use a smaller
table id, say 1000 this doesn't happen.

According to my tests, the higher the table id the higher the memory usage
on the slon process for the slave node. I think this is a bug since by
choosing a high enough table id the memory consumption can become *very*
large.

I would appreciate it if you tell me what you think about that.

By the way, I'm using slony 1.2.10 (but I haven't seen anything about this
topic in the release notes for newer versions)

Thanks

Dami=E1n Quiroga
Integratech S.A
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080612/=
03a2a1d9/attachment-0001.htm
From rafael.domiciano at gmail.com  Thu Jun 12 04:58:40 2008
From: rafael.domiciano at gmail.com (Rafael Domiciano)
Date: Thu Jun 12 04:59:15 2008
Subject: [Slony1-general] replication set up, but no replication
In-Reply-To: <48504706.9080708@serioustechnology.com>
References: <48501090.6040201@serioustechnology.com>
	<4850130F.9010600@serioustechnology.com>
	<1213207672.31665.4.camel@dogma.ljc.laika.com>
	<1213208656.31665.9.camel@dogma.ljc.laika.com>
	<48503232.7050607@serioustechnology.com>
	<1213217930.31665.13.camel@dogma.ljc.laika.com>
	<48504706.9080708@serioustechnology.com>
Message-ID: <3a0028490806120458v2177b65dod7d9d102fef0aee4@mail.gmail.com>

Good morning,

I had the same issued, about the enconding.
My replication is made by 2 PCs using Fedora, and slony 1.2.14.
And I started the DB with encoding UTF-8, but at the start of the Slon I had
the same error discussed here.
So, i had to change de i18n file of fedora to use ISO8859-1, recreated the
db and now my base is sync... :)

2008/6/11 Geoffrey <lists@serioustechnology.com>:

> Jeff Davis wrote:
>
>> On Wed, 2008-06-11 at 16:14 -0400, Geoffrey wrote:
>>
>>> I definitely seem some issues with encoding, and from what I see, there=
's
>>> database and client encoding.  The database encoding is different, but =
I've
>>> not figured out where that is configured, assuming it should be in the
>>> postgresql.conf file somewhere.  It appears that the client_encoding is
>>> different as well, although I would have expected that to have been tak=
en
>>> care when the databases were built.  I have explicitly set the
>>> client_encoding in the postgresql.conf file, but haven't found where to=
 set
>>> the database encoding.
>>>
>>
>> The database encoding can only be set at initdb time. Client_encoding is
>> only used to be able to convert from one encoding to another, assuming
>> that some conversion exists. You might be able to get it working by
>> setting the client encoding to something like iso-8859-1.
>>
>> The PostgreSQL manual has more details.
>>
>
> Thanks, I'm in the process of re-creating the node 2 empty databases with
> the proper encoding.  Something must have changed from 7.4 to 8.3, becaus=
e I
> used the same process to create these databases, and didn't have this
> problem before.
>
>
>> Regards,
>>        Jeff Davis
>>
>>
>>
>
> --
> Until later, Geoffrey
>
> Those who would give up essential Liberty, to purchase a little
> temporary Safety, deserve neither Liberty nor Safety.
>  - Benjamin Franklin
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080612/=
70ee6fa1/attachment.htm
From lists at serioustechnology.com  Thu Jun 12 05:25:09 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Thu Jun 12 05:25:13 2008
Subject: [Slony1-general] replication set up, but no replication
In-Reply-To: <3a0028490806120458v2177b65dod7d9d102fef0aee4@mail.gmail.com>
References: <48501090.6040201@serioustechnology.com>	
	<4850130F.9010600@serioustechnology.com>	
	<1213207672.31665.4.camel@dogma.ljc.laika.com>	
	<1213208656.31665.9.camel@dogma.ljc.laika.com>	
	<48503232.7050607@serioustechnology.com>	
	<1213217930.31665.13.camel@dogma.ljc.laika.com>	
	<48504706.9080708@serioustechnology.com>
	<3a0028490806120458v2177b65dod7d9d102fef0aee4@mail.gmail.com>
Message-ID: <485115A5.9000309@serioustechnology.com>

Rafael Domiciano wrote:
> Good morning,
> 
> I had the same issued, about the enconding.
> My replication is made by 2 PCs using Fedora, and slony 1.2.14.
> And I started the DB with encoding UTF-8, but at the start of the Slon I had
> the same error discussed here.
> So, i had to change de i18n file of fedora to use ISO8859-1, recreated the
> db and now my base is sync... :)

Thanks, once I got all my encodings the same, all is well.

> 
> 2008/6/11 Geoffrey <lists@serioustechnology.com>:
> 
>> Jeff Davis wrote:
>>
>>> On Wed, 2008-06-11 at 16:14 -0400, Geoffrey wrote:
>>>
>>>> I definitely seem some issues with encoding, and from what I see, there's
>>>> database and client encoding.  The database encoding is different, but I've
>>>> not figured out where that is configured, assuming it should be in the
>>>> postgresql.conf file somewhere.  It appears that the client_encoding is
>>>> different as well, although I would have expected that to have been taken
>>>> care when the databases were built.  I have explicitly set the
>>>> client_encoding in the postgresql.conf file, but haven't found where to set
>>>> the database encoding.
>>>>
>>> The database encoding can only be set at initdb time. Client_encoding is
>>> only used to be able to convert from one encoding to another, assuming
>>> that some conversion exists. You might be able to get it working by
>>> setting the client encoding to something like iso-8859-1.
>>>
>>> The PostgreSQL manual has more details.
>>>
>> Thanks, I'm in the process of re-creating the node 2 empty databases with
>> the proper encoding.  Something must have changed from 7.4 to 8.3, because I
>> used the same process to create these databases, and didn't have this
>> problem before.
>>
>>
>>> Regards,
>>>        Jeff Davis
>>>
>>>
>>>
>> --
>> Until later, Geoffrey
>>
>> Those who would give up essential Liberty, to purchase a little
>> temporary Safety, deserve neither Liberty nor Safety.
>>  - Benjamin Franklin
>> _______________________________________________
>> Slony1-general mailing list
>> Slony1-general@lists.slony.info
>> http://lists.slony.info/mailman/listinfo/slony1-general
>>
> 


-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From lists at serioustechnology.com  Thu Jun 12 05:26:28 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Thu Jun 12 05:26:32 2008
Subject: [Slony1-general] replication set up, but no replication
In-Reply-To: <1213217930.31665.13.camel@dogma.ljc.laika.com>
References: <48501090.6040201@serioustechnology.com>	
	<4850130F.9010600@serioustechnology.com>	
	<1213207672.31665.4.camel@dogma.ljc.laika.com>	
	<1213208656.31665.9.camel@dogma.ljc.laika.com>	
	<48503232.7050607@serioustechnology.com>
	<1213217930.31665.13.camel@dogma.ljc.laika.com>
Message-ID: <485115F4.8030608@serioustechnology.com>

Jeff Davis wrote:
> On Wed, 2008-06-11 at 16:14 -0400, Geoffrey wrote:
>> I definitely seem some issues with encoding, and from what I see, 
>> there's database and client encoding.  The database encoding is 
>> different, but I've not figured out where that is configured, assuming 
>> it should be in the postgresql.conf file somewhere.  It appears that the 
>> client_encoding is different as well, although I would have expected 
>> that to have been taken care when the databases were built.  I have 
>> explicitly set the client_encoding in the postgresql.conf file, but 
>> haven't found where to set the database encoding.
> 
> The database encoding can only be set at initdb time. Client_encoding is
> only used to be able to convert from one encoding to another, assuming
> that some conversion exists. You might be able to get it working by
> setting the client encoding to something like iso-8859-1.

Thanks to all for all the assistance with these issues.  I am not 
successfully replicating and will be testing our 'replication_role' 
solution.  I'll post an update as to our successes (as that is what I 
expect :) )

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From scetbon at echo.fr  Thu Jun 12 05:40:30 2008
From: scetbon at echo.fr (Cyril SCETBON)
Date: Thu Jun 12 05:40:46 2008
Subject: [Slony1-general] slonik segfault
In-Reply-To: <20080611233404.0B2B0120F03D@zeus.directinfos.com>
References: <48490712.6070202@echo.fr>	<20080611153755.30645120F045@zeus.directinfos.com>	<48502D3F.8080001@echo.fr>
	<20080611233404.0B2B0120F03D@zeus.directinfos.com>
Message-ID: <4851193E.5060404@echo.fr>



Jacques Caron wrote:
> Try this:
>
> cat >test_4096.c <<EOF
> #include <stdio.h>
>
> int main()
> {
>         unsigned long long a;
>
>         a = -4096;
>
>         printf("%llu\n",a);
>
>         return 0;
> }
> EOF
> cc -g -Wall test_4096.c -o test_4096
> ./test_4096
>
> -4096 is represented as 0xfffffffffffff000 (as a signed 64 bit 
> integer). If you cast it to an unsigned 64 bit integer, you get 
> 18446744073709547520.
>
> The probability that something calls malloc requesting 18 billion 
> gigabytes is low. The probability that something calls malloc 
> requesting a negative size is much higher.
>
> You might want to try strace'ing a one-liner that does a "malloc(-1)" 
> (or more certainly "malloc(-4097)" depending on how the "rounding" is 
> done?) just for fun :-)
>
> cat >test_malloc.c <<EOF
> #include <stdlib.h>
>
> int main()
> {
>         malloc(-1);
>         return 0;
> }
> EOF
> cc -g -Wall test_malloc.c -o test_malloc
> strace ./test_malloc
>
> Results differ from platform to platform, depending mainly on the 
> specific implementation of malloc. FreeBSD doesn't yield any "fun" 
> results, but apparently your OS does.
I've tested it on the host and did not get any error with a negative 
value or a big value :

cat test_malloc.c

#include <stdlib.h>
#include <stdio.h>

int main()
{
        printf("malloc(-4096)\n");
        malloc(-4096);
        printf("malloc(18446744073709547520)\n");
        malloc(18446744073709547520);
        return 0;
}

cc -g -w test_malloc.c -o test_malloc

 ./test_malloc
malloc(-4096)
malloc(18446744073709547520)

no segmentation fault, and the strace command shows :

write(1, "malloc(-4096)\n", 14malloc(-4096)
)         = 14
brk(0)                                  = 0x501000
brk(0x521000)                           = 0x521000
mmap(NULL, 2097152, PROT_NONE, MAP_PRIVATE|MAP_ANONYMOUS|MAP_NORESERVE, 
-1, 0) = 0x2b78f91d1000
munmap(0x2b78f91d1000, 192512)          = 0
munmap(0x2b78f9300000, 856064)          = 0
mprotect(0x2b78f9200000, 131072, PROT_READ|PROT_WRITE) = 0
mmap(NULL, 2097152, PROT_NONE, MAP_PRIVATE|MAP_ANONYMOUS|MAP_NORESERVE, 
-1, 0) = 0x2b78f9300000
munmap(0x2b78f9400000, 1048576)         = 0
mprotect(0x2b78f9300000, 131072, PROT_READ|PROT_WRITE) = 0
munmap(0x2b78f9300000, 1048576)         = 0
write(1, "malloc(18446744073709547520)\n", 29malloc(18446744073709547520)
) = 29
mmap(NULL, 2097152, PROT_NONE, MAP_PRIVATE|MAP_ANONYMOUS|MAP_NORESERVE, 
-1, 0) = 0x2b78f9300000
munmap(0x2b78f9400000, 1048576)         = 0
mprotect(0x2b78f9300000, 131072, PROT_READ|PROT_WRITE) = 0
munmap(0x2b78f9300000, 1048576)         = 0
munmap(0x2b78f8e94000, 4096)            = 0
exit_group(0)                           = ?
Process 15518 detached

Regards

>
> I have gone quickly through the slonik source, including the flex and 
> bison generated code, and I don't offhand see any reason for a 
> negative malloc to happen, but there must be a case where something 
> ends up requesting a negative number of bytes. My guess was around the 
> yyleng manipulation, but it seems (?) to be correct, so it must be 
> somewhere else, or it is your version of flex or bison that is buggy.
>
> What are your versions of flex and bison?
>
> Jacques.
>
> At 21:53 11/06/2008, Cyril SCETBON wrote:
>
>
>> Jacques Caron wrote:
>>> At 11:44 06/06/2008, Cyril SCETBON wrote:
>>>> Hi guys,
>>>>
>>>> When I try to create a lot of set slonik dies with segmentation 
>>>> fault message. The only way to succeed is to split the file 
>>>> containing the create set statement and to try them one by one or 
>>>> two by two. When I use strace on slonik it displays :
>>>>
>>>> read(3, "#--\n# Slony-I organizes tables i"..., 8192) = 8192
>>>> read(3, "d table (set id=5, origin=201, i"..., 8192) = 8192
>>>> read(3, ");\nset add table (set id=9, orig"..., 8192) = 8192
>>>> mmap(NULL, 18446744073709547520, PROT_READ|PROT_WRITE, 
>>>> MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = -1 ENOMEM (Cannot allocate memory)
>>>
>>> FYI, the mmap size is the (unsigned 64 bit integer) equivalent of 
>>> -4096, so it looks like "something" attempted a negative size malloc 
>>> (that got rounded to -4096, a multiple of the page size). Not quite 
>>> sure which piece of code could lead to that result...
>> the type is an unsigned integer. So if the value is too big a cast 
>> occurs that should not give a negative value, but a shorter value...
>>>
>>> Jacques.
>>>
>>> _______________________________________________
>>> Slony1-general mailing list
>>> Slony1-general@lists.slony.info
>>> http://lists.slony.info/mailman/listinfo/slony1-general
>>
>> -- 
>> Cyril SCETBON - Ing?nieur bases de donn?es
>> AUSY pour France T?l?com - OPF/PORTAILS/DOP/HEBEX
>>
>> T?l : +33 (0)4 97 12 87 60
>> Jabber : cscetbon@jabber.org
>> France Telecom - Orange
>> 790 Avenue du Docteur Maurice Donat B?timent Marco Polo C2 - Bureau 202
>> 06250 Mougins
>> France
>>
>> ***********************************
>> Ce message et toutes les pieces jointes (ci-apres le 'message') sont
>> confidentiels et etablis a l'intention exclusive de ses destinataires.
>> Toute utilisation ou diffusion non autorisee est interdite.
>> Tout message electronique est susceptible d'alteration. Le Groupe France
>> Telecom decline toute responsabilite au titre de ce message s'il a ete
>> altere, deforme ou falsifie.
>> Si vous n'etes pas destinataire de ce message, merci de le detruire
>> immediatement et d'avertir l'expediteur.
>> ***********************************
>> This message and any attachments (the 'message') are confidential and
>> intended solely for the addressees.
>> Any unauthorised use or dissemination is prohibited.
>> Messages are susceptible to alteration. France Telecom Group shall 
>> not be
>> liable for the message if altered, changed or falsified.
>> If you are not recipient of this message, please cancel it 
>> immediately and
>> inform the sender.
>> ************************************
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general

-- 
Cyril SCETBON - Ing?nieur bases de donn?es
AUSY pour France T?l?com - OPF/PORTAILS/DOP/HEBEX

T?l : +33 (0)4 97 12 87 60
Jabber : cscetbon@jabber.org
France Telecom - Orange
790 Avenue du Docteur Maurice Donat 
B?timent Marco Polo C2 - Bureau 202
06250 Mougins
France

***********************************
Ce message et toutes les pieces jointes (ci-apres le 'message') sont
confidentiels et etablis a l'intention exclusive de ses destinataires.
Toute utilisation ou diffusion non autorisee est interdite.
Tout message electronique est susceptible d'alteration. Le Groupe France
Telecom decline toute responsabilite au titre de ce message s'il a ete
altere, deforme ou falsifie.
Si vous n'etes pas destinataire de ce message, merci de le detruire
immediatement et d'avertir l'expediteur.
***********************************
This message and any attachments (the 'message') are confidential and
intended solely for the addressees.
Any unauthorised use or dissemination is prohibited.
Messages are susceptible to alteration. France Telecom Group shall not be
liable for the message if altered, changed or falsified.
If you are not recipient of this message, please cancel it immediately and
inform the sender.
************************************

From jc at oxado.com  Thu Jun 12 06:18:47 2008
From: jc at oxado.com (Jacques Caron)
Date: Thu Jun 12 06:24:19 2008
Subject: [Slony1-general] slonik segfault
In-Reply-To: <4851193E.5060404@echo.fr>
References: <48490712.6070202@echo.fr>
	<20080611153755.30645120F045@zeus.directinfos.com>
	<48502D3F.8080001@echo.fr>
	<20080611233404.0B2B0120F03D@zeus.directinfos.com>
	<4851193E.5060404@echo.fr>
Message-ID: <20080612132411.DB3AA120F01A@zeus.directinfos.com>

Hi,

At 14:40 12/06/2008, Cyril SCETBON wrote:
>I've tested it on the host and did not get any error with a negative 
>value or a big value :
>
>cat test_malloc.c
>
>#include <stdlib.h>
>#include <stdio.h>
>
>int main()
>{
>        printf("malloc(-4096)\n");
>        malloc(-4096);
>        printf("malloc(18446744073709547520)\n");
>        malloc(18446744073709547520);
>        return 0;
>}
>
>cc -g -w test_malloc.c -o test_malloc
>
>./test_malloc
>malloc(-4096)
>malloc(18446744073709547520)
>
>no segmentation fault

Quite normal, the malloc itself won't cause a segfault, it's the fact 
that something later uses space requested via malloc that couldn't be 
allocated (malloc then returned 0). What's the return value of the 
malloc calls?

>, and the strace command shows :
>
>write(1, "malloc(-4096)\n", 14malloc(-4096)
>)         = 14
>brk(0)                                  = 0x501000
>brk(0x521000)                           = 0x521000
>mmap(NULL, 2097152, PROT_NONE, 
>MAP_PRIVATE|MAP_ANONYMOUS|MAP_NORESERVE, -1, 0) = 0x2b78f91d1000
>munmap(0x2b78f91d1000, 192512)          = 0
>munmap(0x2b78f9300000, 856064)          = 0
>mprotect(0x2b78f9200000, 131072, PROT_READ|PROT_WRITE) = 0
>mmap(NULL, 2097152, PROT_NONE, 
>MAP_PRIVATE|MAP_ANONYMOUS|MAP_NORESERVE, -1, 0) = 0x2b78f9300000
>munmap(0x2b78f9400000, 1048576)         = 0
>mprotect(0x2b78f9300000, 131072, PROT_READ|PROT_WRITE) = 0
>munmap(0x2b78f9300000, 1048576)         = 0
>write(1, "malloc(18446744073709547520)\n", 29malloc(18446744073709547520)
>) = 29
>mmap(NULL, 2097152, PROT_NONE, 
>MAP_PRIVATE|MAP_ANONYMOUS|MAP_NORESERVE, -1, 0) = 0x2b78f9300000
>munmap(0x2b78f9400000, 1048576)         = 0
>mprotect(0x2b78f9300000, 131072, PROT_READ|PROT_WRITE) = 0
>munmap(0x2b78f9300000, 1048576)         = 0
>munmap(0x2b78f8e94000, 4096)            = 0
>exit_group(0)                           = ?
>Process 15518 detached

- you'll notice that the mmap calls are the same for both calls 
(don't quite know what malloc is really doing here, it seems to be 
allocating more space then freeing up bits, probably trying to align 
on some large size), though neither size matches the actual request (?)

- the malloc-induced mmap is quite different from the one in your 
original strace (see the flags). Is that the same box? You must have 
some special compile flags or libraries in your slonik compile that 
change malloc's behaviour. Was your slony-1 install locally compiled 
or installed from binaries? If the latter you might want to try a 
good old wget/tar/configure/make to see if the result is the same...

Jacques.

From salmanb at quietcaresystems.com  Thu Jun 12 09:27:55 2008
From: salmanb at quietcaresystems.com (salman)
Date: Thu Jun 12 09:28:04 2008
Subject: [Slony1-general] Add new slave to cluster
Message-ID: <48514E8B.2070304@quietcaresystems.com>

Hello,

Trying to find some documentation on how to add a new slave into an 
existing cluster. I understand the parts about subscribing nodes and 
sets, but I'm having a difficult time finding any docs on how to import 
the schema from the master to the new slave and leave out any 
slony-specific table/trigger declerations.

I tried using the '-n schema' option with pg_dump, but that still seems 
to dump slony table triggers.

-salman
From salmanb at quietcaresystems.com  Thu Jun 12 09:38:29 2008
From: salmanb at quietcaresystems.com (salman)
Date: Thu Jun 12 09:38:38 2008
Subject: [Slony1-general] Add new slave to cluster
In-Reply-To: <48514E8B.2070304@quietcaresystems.com>
References: <48514E8B.2070304@quietcaresystems.com>
Message-ID: <48515105.90504@quietcaresystems.com>

salman wrote:
> Hello,
> 
> Trying to find some documentation on how to add a new slave into an 
> existing cluster. I understand the parts about subscribing nodes and 
> sets, but I'm having a difficult time finding any docs on how to import 
> the schema from the master to the new slave and leave out any 
> slony-specific table/trigger declerations.
> 
> I tried using the '-n schema' option with pg_dump, but that still seems 
> to dump slony table triggers.
> 
> -salman


Nevermind. Exporting the schema that way worked. Now to add the new 
install into the mix.

-salman
From stephane.schildknecht at postgresqlfr.org  Thu Jun 12 11:26:34 2008
From: stephane.schildknecht at postgresqlfr.org (=?UTF-8?B?IlN0w6lwaGFuZSBBLiBTY2hpbGRrbmVjaHQi?=)
Date: Thu Jun 12 11:26:48 2008
Subject: [Slony1-general] can't drop a node, can't recreate it
Message-ID: <48516A5A.4040405@postgresqlfr.org>

Hi,

While trying to add tables to a replication, I had a strange behaviour I can't
repair by now.

I use slony-1.2.13, PG. 8.2.7.

I have 2 sets replicating in both ways.

One replication goes from 1 -> 11 -> 71 -> 72
the other one from 72 to 1.

What I did was :

create set id 99 originating on 1
add tables to that set
subscribe 11 to 99 from 1, 71 to 99 from 11 and 72 to 99 from 71.

But then I had the message that set 99 did not exist on 72, and replication hanged.

Trying to drop set 99 from replication did not let me resync node 72, as it
still tried to subscribe to unexisting set 99.

I then switch set 2 from 72 to 71. That worked.

Then I tried to uninstall node 72, drop schema. OK

But from then, I couldn't issue dropnode( 72 ) on node 1. It seems to be
waiting indefinitely, and I have such messages in logs :

Jun 12 20:22:54 myhost slon[29751]: [138-1] 2008-06-12 20:22:54 CEST ERROR
remoteListenThread_72: "select "_replication".registerNodeConnection(1); listen
"_replication_Event";
Jun 12 20:22:54 myhost slon[29751]: [138-2]  " - ERREUR:  le sch?ma ?
_replication ? n'existe pas
(it complains about replication schema not existing)...

What can I do as I do not want to recreate the whole replication from scratch
(many nodes, two ways, two sets...). What's more recrreating a single node does
take almost 3 hours.


Thanks by advance.

Regards
-- 
St?phane SCHILDKNECHT
Pr?sident de PostgreSQLFr
T?l. 09 53 69 97 12
http://www.postgresql.fr
From dane at greatschools.net  Thu Jun 12 11:39:41 2008
From: dane at greatschools.net (Dane Miller)
Date: Thu Jun 12 11:41:19 2008
Subject: [Slony1-general] What mechanism actually causes replication?
In-Reply-To: <48496043.8060201@serioustechnology.com>
References: <48496043.8060201@serioustechnology.com>
Message-ID: <1213295981.20093.39.camel@danedesk.greatschools.net>

Geoffrey wrote:
> I can't seem to figure out what 'mechanism' actually causes replication. 
>   That may be a too simplistic view of the whole process, but the bottom 
> line is, I have to make sure that our manipulation of the 
> 'session_replication_role' is going to properly address the issue of 
> insuring slony continues to replicate our data.

During my own slony learning process (which is ongoing) I tried to spell
out the precise mechanisms of slony replication in the following post
from Nov 2007:

http://article.gmane.org/gmane.comp.db.postgresql.slony1.general/5532

To quote myself:

> Do I get the gist of it here?  If not, could someone be so kind as to correct me?
> 
> Tracing an insert from the origin to a subscriber (2 node cluster)
> 
> 1. INSERT into the origin
> 2. AFTER ROW trigger executes logtrigger which inserts into sl_log_{1,2}
> 3. origin's slon checks sl_log_{1,2}, inserts event into sl_event, generates NOTIFY
> 4. subscriber receives NOTIFY, inserts event into its sl_event table, inserts confirmation into its
> local sl_confirm table.
> 5. subscriber inserts event into origin's sl_confirm table
> 6. subscriber queries origin's sl_log_{1,2} using event info
> 7. Subscriber applies result of #6 to its local tables.


I get the feeling this isn't the whole picture.  Specifically missing
are SYNCs and sequence handling.  But perhaps this is still helpful to
list-goers.

Dane
-- 
Dane Miller
Systems Administrator
Greatschools, Inc
http://www.greatschools.net

From dane at greatschools.net  Thu Jun 12 15:26:54 2008
From: dane at greatschools.net (Dane Miller)
Date: Thu Jun 12 15:28:34 2008
Subject: [Slony1-general] order of replication
Message-ID: <1213309614.20093.86.camel@danedesk.greatschools.net>

Hi Slony Folks,

I'm supporting a web application that uses a replicated sequence to
track I/U/D transactions across multiple nodes.  Whenever the
application issues Insert/Update/Delete queries against the origin node
it increments transaction_id_seq and stores the value in memcache.
Before the application issues SELECT queries against a subscriber node,
it compares the value of transaction_id in memcache with the value on a
subscriber.  If the subscriber's value is greater-than or equal-to the
value in memcache, the application issues the SELECT against the
subscriber.  If not, the application knows the subscriber's data is
stale and issues the SELECT against the origin.  This is our
application's solution to replication lag.

I'd like to verify that this approach to replication lag works with the
way Slony orders replication events.

Consider the below example. Does Slony guarantee that the updated
sequence will always appear after (or concurrently with) the result of
the I/U/D statements on subscriber nodes?

For example:
  BEGIN;
  --
  -- write statements
  --
  INSERT into table1 values (...);
  INSERT into table2 values (...);
  UPDATE table3 set col1='x' where col5='y';

  --
  -- increment transaction_id in postgresql and memcache
  --
  SELECT nextval('transaction_id_seq');
  -- application code sets memcache max_transaction_id
  -- to curval('vibe_transaction_id')
  COMMIT;


Thanks for your advice,

Dane

-- 
Dane Miller
Systems Administrator
Greatschools, Inc
http://www.greatschools.net

From dane at greatschools.net  Thu Jun 12 15:31:49 2008
From: dane at greatschools.net (Dane Miller)
Date: Thu Jun 12 15:33:21 2008
Subject: [Slony1-general] Add new slave to cluster
In-Reply-To: <48514E8B.2070304@quietcaresystems.com>
References: <48514E8B.2070304@quietcaresystems.com>
Message-ID: <1213309909.20093.90.camel@danedesk.greatschools.net>

salman wrote:
> Trying to find some documentation on how to add a new slave into an 
> existing cluster. I understand the parts about subscribing nodes and 
> sets, but I'm having a difficult time finding any docs on how to
> import the schema from the master to the new slave and leave out any 
> slony-specific table/trigger declerations.
> 
> I tried using the '-n schema' option with pg_dump, but that still
> seems to dump slony table triggers. 

Slony-I adds a "_clustername" schema and triggers to the postgresql
tables that are being replicated. To get a clean copy of the table
definitions without slony's customizations, we use
slony1_extract_schema.sh from /tools in slony's CVS repo.  Here's a
link:

http://main.slony.info/viewcvs/viewvc.cgi/slony1-engine/tools/slony1_extract_schema.sh?view=log

On The Origin

      * cd /tmp
      * sudo -u pgsql ./slony1_extract_schema.sh \community replication
        tmpextract > /tmp/community.schema.sql

community.schema.sql is a clean copy of the table schema without slony's
customizations.


From stephane.schildknecht at postgresqlfr.org  Fri Jun 13 03:09:01 2008
From: stephane.schildknecht at postgresqlfr.org (=?UTF-8?B?IlN0w6lwaGFuZSBBLiBTY2hpbGRrbmVjaHQi?=)
Date: Fri Jun 13 03:09:35 2008
Subject: [Slony1-general] CREATE SET did not reach every node
Message-ID: <4852473D.9090207@postgresqlfr.org>

Hi,

I add a set to an existing replication. I then added tables to that set, and
wanting to merge it with an existing one, I tried to subscribe each node to
that set.

Unfortunately, one of the node (72, see below) did not know about that set, and
subscription failed, leaving the whole replication in an unstable state.

I can't do anything as node 72 is trying to subscribe a unknown set.

I tried to switch 72 and 71, for the 2nd set. I succeeded, but then, node 71 is
unsuccessful at providing data for other nodes.

Trying to drop node 72 from replication with 1 as event node hangs. Presumably
due to a lock taken by node 1 for doing it.

So node 1 continue to try to access a node that does not exist, and 71 can't
provide data.

Do I have another option that rebuilding the wole replication ? That may be a
half day production break at least...

More information:
PG 8.2.6
Slony1-1.2.13
OS : Linux debian 2.6.18-6-amd64

My replication schema is composed of:
9 nodes
2 sets

The replication goes two ways :
Set 1 :
1--11--21
    \--23
    \--25
    \--26
    \--27
    \--71--72

Set 2 :
72--71--11--1
        \--23


Is there a known bug I wasn't aware of?
Did I make sthg wrong?
What sort of information could be useful?

Best regards,
-- 
St?phane SCHILDKNECHT
Pr?sident de PostgreSQLFr
T?l. 09 53 69 97 12
http://www.postgresql.fr
From ajs at crankycanuck.ca  Fri Jun 13 06:01:00 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Fri Jun 13 06:01:21 2008
Subject: [Slony1-general] Vertical table split (aka "slony please ignore
	this delete")? Or...
In-Reply-To: <87prqtmovs.fsf@platon.mekk.waw.pl>
References: <87prqtmovs.fsf@platon.mekk.waw.pl>
Message-ID: <20080613130100.GA28292@crankycanuck.ca>

On Sat, Jun 07, 2008 at 02:05:27PM +0200, Marcin Kasperski wrote:
 
> So I'd like to remove old data from "events" in ProductionDatabase,
> but would like to keep them in ReportDatabase.
> 
> Is it possible to convince Slony to ignore such a DELETE

No, but you could put a trigger in the report database that actually puts
the records in a _different_ table, and use views to see things (so you
don't really need to change your application).  Ideally, you'll want to
partition by year or something anyway, because eventually you're probably
going to want to drop records off the table (like, records 7 years old,
maybe?).

A

From nyamada at millburncorp.com  Fri Jun 13 06:24:48 2008
From: nyamada at millburncorp.com (Norman Yamada)
Date: Fri Jun 13 06:24:52 2008
Subject: [Slony1-general] How do I drop rule from replicated table?
In-Reply-To: <20080612190003.EFF6B290EB8@main.slony.info>
References: <20080612190003.EFF6B290EB8@main.slony.info>
Message-ID: <1A962840-045C-4E86-B0E4-C0FF7AA5464A@millburncorp.com>

Dear All:

Running slony 1.2.13; 4 slave nodes; master and 3 of the nodes running  
postgres 8.2.6; one slave node running 8.3.1

I have a replicated table that has a oninsert rule.

I'd like to drop the rule from the table. How do I do this? I thought  
I could use a EXECUTE SCRIPT command to push the rule drop to all  
nodes, but this failed with a FATAL error. (Yes, I do realize the  
target of the rule has been changed in the system catalog tables for  
all slave nodes; and so need to drop this rule through a slonik  
mechanism -- I just don't know what that mechanism is! --

Thanks --

Norman
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 2431 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20080613/4691deb9/smime.bin
From ajs at crankycanuck.ca  Fri Jun 13 06:40:12 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Fri Jun 13 06:40:22 2008
Subject: [Slony1-general] order of replication
In-Reply-To: <1213309614.20093.86.camel@danedesk.greatschools.net>
References: <1213309614.20093.86.camel@danedesk.greatschools.net>
Message-ID: <20080613134012.GB28292@crankycanuck.ca>

On Thu, Jun 12, 2008 at 03:26:54PM -0700, Dane Miller wrote:
> Consider the below example. Does Slony guarantee that the updated
> sequence will always appear after (or concurrently with) the result of
> the I/U/D statements on subscriber nodes?

Not necessarily.  Slony sets the sequence on the target to the value of the
sequence at the time of the sync, because there isn't any other way to look
at the sequence value.  The idea is that it's ok for a sequence to be
_ahead_ of the rest of the database, because this is consistent with the
semantics of sequences in an unreplicated database (they always advance, so
they're never-go-backwards series that possibly have gaps).  

If you want this, you could probably do it using a table that is replicated
and that gets updated with currval() using a trigger or something.

A

From ajs at crankycanuck.ca  Fri Jun 13 07:23:56 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Fri Jun 13 07:24:06 2008
Subject: [Slony1-general] CREATE SET did not reach every node
In-Reply-To: <4852473D.9090207@postgresqlfr.org>
References: <4852473D.9090207@postgresqlfr.org>
Message-ID: <20080613142356.GC28292@crankycanuck.ca>

On Fri, Jun 13, 2008 at 12:09:01PM +0200, "St?phane A. Schildknecht" wrote:
> 
> Unfortunately, one of the node (72, see below) did not know about that set, and
> subscription failed, leaving the whole replication in an unstable state.
> 
> I can't do anything as node 72 is trying to subscribe a unknown set.

Did you ensure that every node had the subscription before you performed the
merge?  If not, then yes, this is hopelessly broken.

> Do I have another option that rebuilding the wole replication ? That may be a
> half day production break at least...

You have to grovel through the events that 72 is attempting to process, yank
all the latest events (72 will be really broken now), then drop the tables
that made up the added set from replication.  Probably you'll have to drop
the 72 node.  Then rebuild the set, rebuild 72, and only _then_ once
everyone has the subscription, perform the merge.

A
From chander at otg-nc.com  Fri Jun 13 07:38:20 2008
From: chander at otg-nc.com (Chander Ganesan)
Date: Fri Jun 13 07:38:20 2008
Subject: [Slony1-general] Slony download ordering..
Message-ID: <4852865C.2060804@otg-nc.com>

Hello,

Just a thought.  I recently went to the download page at: 
http://slony.info/downloads/1.2/source/ and accidentally downloaded 
1.2.0 . 

Might it be useful to reverse-order the list so that the most recent 
version appears at the top?

Thanks

chander
From stephane.schildknecht at postgresqlfr.org  Fri Jun 13 07:44:49 2008
From: stephane.schildknecht at postgresqlfr.org (=?ISO-8859-1?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Fri Jun 13 07:44:58 2008
Subject: [Slony1-general] CREATE SET did not reach every node
In-Reply-To: <20080613142356.GC28292@crankycanuck.ca>
References: <4852473D.9090207@postgresqlfr.org>
	<20080613142356.GC28292@crankycanuck.ca>
Message-ID: <485287E1.3000306@postgresqlfr.org>

Andrew Sullivan a ?crit :
> On Fri, Jun 13, 2008 at 12:09:01PM +0200, "St?phane A. Schildknecht" wrote:
>> Unfortunately, one of the node (72, see below) did not know about that set, and
>> subscription failed, leaving the whole replication in an unstable state.
>>
>> I can't do anything as node 72 is trying to subscribe a unknown set.
> 
> Did you ensure that every node had the subscription before you performed the
> merge?  If not, then yes, this is hopelessly broken.

Problem arose *before* I could try to merge. Node 72 did not subscribe that set
as it told "unknown set". Seems like every node but 72 knew there was a new set
with tables in.

> 
>> Do I have another option that rebuilding the wole replication ? That may be a
>> half day production break at least...
> 
> You have to grovel through the events that 72 is attempting to process, yank
> all the latest events (72 will be really broken now), then drop the tables
> that made up the added set from replication.  Probably you'll have to drop
> the 72 node.  Then rebuild the set, rebuild 72, and only _then_ once
> everyone has the subscription, perform the merge.

Well problem is I may have done something worse. In fact, I can't drop node 72
from node 1. Process hangs.

Seems to me that every node is trying to acces a no-more existing node. And
therefore, I'm afraid I can't execute any slonik configuration command...

I now have lines like :

2008-06-13 16:34:43 CEST ERROR  remoteListenThread_72: "select
"_slonturf".registerNodeConnection(1); listen "_slonturf_Event"; " - ERREUR:
le sch?ma ? _slonturf ? n'existe pas
2008-06-13 16:37:31 CEST ERROR  slon_connectdb: PQconnectdb("dbname=turf
host=code port=5432 user=slony password=poiklmnb") failed - could not connect
to server: Connection timed out
        Is the server running on host "code" and accepting
        TCP/IP connections on port 5432?
2008-06-13 16:38:02 CEST ERROR  remoteListenThread_72: "select
"_slonturf".registerNodeConnection(11); unlisten "_slonturf_Event"; " - ERREUR:
 le sch?ma ? _slonturf ? n'existe pas
...

Node 71 does not complain about not knowing 72, but it doesn't propagate data
to 11.

So, is there a way to drop any knowing of 72 from every node ?

Regards,
SAS
From msteben at autorevenue.com  Fri Jun 13 13:17:14 2008
From: msteben at autorevenue.com (Mark Steben)
Date: Fri Jun 13 13:17:02 2008
Subject: [Slony1-general] trying to run test_slony_state.pl
Message-ID: <000001c8cd92$7835f320$14010a0a@dei26g028575>

Hi, again from the newbie, 

I have successfully started slony-1 on both master and slave machines -
works great!

Now, per the Slony.info home page I am trying to run the test_slony_state
perl script.

There are several pm files it cannot find.  As I'm notified of each failure
I copy from

Another machine that has the files.  So far I have copied:

  Pg.pm

  Version.pm

  

Now it's saying it can't find vpp.pm.  and I don't have that on my 'copying
machine'

 

I'm not a perl programmer/administrator.  Can someone give me some guidance
as to

Where I can load these scripts from so I don't have to keep copying?

 

Thanks in advance.

 

Mark Steben

Senior Database Administrator
@utoRevenueT 
A Dominion Enterprises Company
480 Pleasant Street
Suite B200
Lee, MA 01238
413-243-4800 Home Office 
413-243-4809 Corporate Fax

msteben <blocked::mailto:name@autorevenue.com> @autorevenue.com

Visit our new website at 
 <blocked::http://www.autorevenue.com/> www.autorevenue.com

 

IMPORTANT: The information contained in this e-mail message is confidential
and is intended only for the named addressee(s). If the reader of this
e-mail message is not the intended recipient (or the individual responsible
for the delivery of this e-mail message to the intended recipient), please
be advised that any re-use, dissemination, distribution or copying of this
e-mail message is prohibited.  If you have received this e-mail message in
error, please reply to the sender that you have received this e-mail message
in error and then delete it.  Thank you.

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080613/448d0157/attachment.htm
From cbbrowne at ca.afilias.info  Fri Jun 13 14:11:03 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri Jun 13 14:11:18 2008
Subject: [Slony1-general] trying to run test_slony_state.pl
In-Reply-To: <000001c8cd92$7835f320$14010a0a@dei26g028575> (Mark Steben's
	message of "Fri, 13 Jun 2008 16:17:14 -0400")
References: <000001c8cd92$7835f320$14010a0a@dei26g028575>
Message-ID: <60prqlghw8.fsf@dba2.int.libertyrms.com>

"Mark Steben" <msteben@autorevenue.com> writes:

> <html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns:st1="urn:schemas-microsoft-com:office:smarttags" xmlns="http://www.w3.org/TR/REC-html40">
>
> <head>
> <meta http-equiv=Content-Type content="text/html; charset=us-ascii">
> <meta name=Generator content="Microsoft Word 11 (filtered medium)">
> <o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
>  name="PostalCode"/>
> <o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
>  name="State"/>
> <o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
>  name="City"/>
> <o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
>  name="place"/>
> <o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
>  name="Street"/>
> <o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
>  name="address"/>
> <!--[if !mso]>
> <style>
> st1\:*{behavior:url(#default#ieooui) }
> </style>
> <![endif]-->
> <style>
> <!--
>  /* Style Definitions */
>  p.MsoNormal, li.MsoNormal, div.MsoNormal
> 	{margin:0in;
> 	margin-bottom:.0001pt;
> 	font-size:12.0pt;
> 	font-family:"Times New Roman";}
> a:link, span.MsoHyperlink
> 	{color:blue;
> 	text-decoration:underline;}
> a:visited, span.MsoHyperlinkFollowed
> 	{color:purple;
> 	text-decoration:underline;}
> span.EmailStyle17
> 	{mso-style-type:personal-compose;
> 	font-family:"Times New Roman";
> 	color:windowtext;
> 	font-weight:normal;
> 	font-style:normal;
> 	text-decoration:none none;}
> @page Section1
> 	{size:8.5in 11.0in;
> 	margin:1.0in 1.25in 1.0in 1.25in;}
> div.Section1
> 	{page:Section1;}
> -->
> </style>
>
> </head>
>
> <body lang=EN-US link=blue vlink=purple>
>
> <div class=Section1>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'>Hi, again from the newbie, <o:p></o:p></span></font></p>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'>I have successfully started slony-1 on both master and slave machines &#8211;
> works great!<o:p></o:p></span></font></p>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'>Now, per the Slony.info home page I am trying to run the
> test_slony_state perl script.<o:p></o:p></span></font></p>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'>There are several pm files it cannot find. &nbsp;As I&#8217;m notified of
> each failure I copy from<o:p></o:p></span></font></p>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'>Another machine that has the files. &nbsp;So far I have copied:<o:p></o:p></span></font></p>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'>&nbsp;&nbsp;Pg.pm<o:p></o:p></span></font></p>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'>&nbsp;&nbsp;Version.pm<o:p></o:p></span></font></p>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'>&nbsp;&nbsp;<o:p></o:p></span></font></p>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'>Now it&#8217;s saying it can&#8217;t find vpp.pm. &nbsp;and I don&#8217;t
> have that on my &#8216;copying machine&#8217;<o:p></o:p></span></font></p>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'><o:p>&nbsp;</o:p></span></font></p>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'>I&#8217;m not a perl programmer/administrator. &nbsp;Can someone give me
> some guidance as to<o:p></o:p></span></font></p>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'>Where I can load these scripts from so I don&#8217;t have to keep copying?<o:p></o:p></span></font></p>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'><o:p>&nbsp;</o:p></span></font></p>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'>Thanks in advance.<o:p></o:p></span></font></p>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'><o:p>&nbsp;</o:p></span></font></p>
>
> <div>
>
> <p class=MsoNormal><font size=4 face="Times New Roman"><span style='font-size:
> 13.5pt'>Mark Steben</span></font><o:p></o:p></p>
>
> <p class=MsoNormal><font size=4 color=black face="Times New Roman"><span
> style='font-size:13.5pt;color:black'>Senior Database Administrator<br>
> </span></font><font size=5 color=maroon><span style='font-size:18.0pt;
> color:maroon'>@utoRevenue&#8482;</span></font><font size=4 color=maroon><span
> style='font-size:15.0pt;color:maroon'> <br>
> </span></font><font size=1><span style='font-size:9.0pt'>A Dominion Enterprises
> Company<br>
> </span></font><font size=4><span style='font-size:13.5pt'>480 Pleasant Street<br>
> <st1:address w:st="on"><st1:Street w:st="on">Suite</st1:Street> B200</st1:address><br>
> <st1:place w:st="on"><st1:City w:st="on">Lee</st1:City>, <st1:State w:st="on">MA</st1:State>
>  <st1:PostalCode w:st="on">01238</st1:PostalCode></st1:place><br>
> 413-243-4800&nbsp;Home&nbsp;Office&nbsp;<br>
> 413-243-4809 Corporate Fax</span></font><o:p></o:p></p>
>
> <div>
>
> <p class=MsoNormal><font size=4 face="Times New Roman"><span style='font-size:
> 13.5pt'>msteben</span></font><font size=2><span style='font-size:10.5pt'><a
> href="blocked::mailto:name@autorevenue.com"
> title="blocked::mailto:name@autorevenue.com"><font size=4 color=black
> title="blocked::mailto:name@autorevenue.com"><span style='font-size:13.5pt;
> color:black'><span title="blocked::mailto:name@autorevenue.com">@autorevenue.com</span></font></a></span><br>
> <br>
> </span></font><font size=4><span style='font-size:13.5pt'>Visit our new website
> at <br>
> </span></font><font size=2><span style='font-size:10.5pt'><a
> href="blocked::http://www.autorevenue.com/"
> title="blocked::http://www.autorevenue.com/"><font size=4 color=maroon
> title="blocked::http://www.autorevenue.com/"><span style='font-size:13.5pt;
> color:maroon'>www.autorevenue.com</span></font></a></span></font><o:p></o:p></p>
>
> </div>
>
> </div>
>
> <div>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'>&nbsp;<o:p></o:p></span></font></p>
>
> </div>
>
> <div>
>
> <p class=MsoNormal><font size=2 color=maroon face="Times New Roman"><span
> style='font-size:10.0pt;color:maroon'>IMPORTANT: The information contained in
> this e-mail message is confidential and is intended only for the named
> addressee(s). If the reader of this e-mail message is not the intended
> recipient (or the individual responsible for the delivery of this e-mail message
> to the intended recipient), please be advised that any re-use, dissemination,
> distribution or copying of this e-mail message is prohibited. &nbsp;If you have
> received this e-mail message in error, please reply to the sender that you have
> received this e-mail message in error and then delete it. &nbsp;Thank you.</span></font><font
> size=2 color=maroon><span style='font-size:10.0pt;color:maroon'><o:p></o:p></span></font></p>
>
> </div>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'><o:p>&nbsp;</o:p></span></font></p>
>
> </div>
>
> </body>
>
> </html>

Two preliminaries:

- If you could post in other than "Microsoft Word HTML," that would
  make it way easier to read this...

- Notices warning about "misuse" of email are particularly useless on
  public mailing lists, as we most certainly do not control who receives
  email.

As for installing Perl components, I have only a couple of comments.

a) DBI appears to be the preferable interface these days; you probably
would prefer to use test_slony_state-dbi.pl rather than the one using
the older (near-deprecated) Pg module.

b) Perl has its own dependancy tracking system for its modules.  It is
almost certain that copying modules one by one will NOT work out,
particularly when you get into modular things like DBI.

Here are a couple of links that might be useful:

http://www.codepedia.com/1/PerlDBITutorial
http://www.rcbowen.com/imho/cgi-database/windows/
-- 
let name="cbbrowne" and tld="linuxfinances.info" in name ^ "@" ^ tld;;
http://www3.sympatico.ca/cbbrowne/emacs.html
Een schip op het strand is een baken in zee.
From kevin at kevinkempterllc.com  Fri Jun 13 15:44:46 2008
From: kevin at kevinkempterllc.com (kevin kempter)
Date: Fri Jun 13 15:45:04 2008
Subject: [Slony1-general] table add key issues
Message-ID: <F2DA0D1B-519A-4465-B914-34430ED36038@kevinkempterllc.com>

Hi list;

I've run this:

1) I created the db's on both servers, created the replication user,  
did a dump from the master & restore to the slave, etc...

2) ran this script: (the slony.dg.env contains all the env variables)
#!/bin/bash

. slony.dg.env



slonik <<_EOF_

cluster name = $CLUSTERNAME;

node 1 admin conninfo = 'dbname=$MASTERDBNAME host=$MASTERHOST port= 
$MASTERPORT user=$REPUSER password=Blue.moon3';
node 2 admin conninfo = 'dbname=$SLAVEDBNAME host=$SLAVEHOST port= 
$SLAVEPORT user=$REPUSER password=Blue.moon3';

init cluster ( id=1, comment = 'Master Node');


create set ( id=1, origin=1, comment = 'PA REPLICATION SET' );

set add table ( set id=1, origin=1, id=1, fully qualified name =  
'cagold.address');
set add table ( set id=1, origin=1, id=2, fully qualified name =  
'cagold.address_history');



store node (id=2, comment = 'Slave Node 1');

store path (server = 1, client = 2, conninfo='dbname=$MASTERDBNAME  
host=$MASTERHOST port=$MASTERPORT user=$REPUSER password=Blue.moon3');
store path (server = 2, client = 1, conninfo='dbname=$SLAVEDBNAME host= 
$SLAVEHOST port=$SLAVEPORT user=$REPUSER password=Blue.moon3');


store listen (origin=1, provider = 1, receiver =2);
store listen (origin=2, provider = 2, receiver =1);

_EOF_


3) this gives me this error:
<stdin>:13: PGRES_FATAL_ERROR select  
"_ca_cluster".determineIdxnameUnique('cagold.address_history', NULL);   
- ERROR:  Slony-I: table "cagold"."address_history" has no primary key




4) so I alter the script like this:
#!/bin/bash

. slony.dg.env



slonik <<_EOF_

cluster name = $CLUSTERNAME;

node 1 admin conninfo = 'dbname=$MASTERDBNAME host=$MASTERHOST port= 
$MASTERPORT user=$REPUSER password=Blue.moon3';
node 2 admin conninfo = 'dbname=$SLAVEDBNAME host=$SLAVEHOST port= 
$SLAVEPORT user=$REPUSER password=Blue.moon3';

init cluster ( id=1, comment = 'Master Node');

table add key (node id = 1, fully qualified name =  
'cagold.address_history');


create set ( id=1, origin=1, comment = 'PA REPLICATION SET' );

set add table ( set id=1, origin=1, id=1, fully qualified name =  
'cagold.address');
set add table ( set id=1, origin=1, id=2, fully qualified name =  
'cagold.address_history');



store node (id=2, comment = 'Slave Node 1');

store path (server = 1, client = 2, conninfo='dbname=$MASTERDBNAME  
host=$MASTERHOST port=$MASTERPORT user=$REPUSER password=Blue.moon3');
store path (server = 2, client = 1, conninfo='dbname=$SLAVEDBNAME host= 
$SLAVEHOST port=$SLAVEPORT user=$REPUSER password=Blue.moon3');


store listen (origin=1, provider = 1, receiver =2);
store listen (origin=2, provider = 2, receiver =1);

_EOF_


5) I reset everything, and re-run and I get the same error:

<stdin>:15: PGRES_FATAL_ERROR select  
"_ca_cluster".determineIdxnameUnique('cagold.address_history', NULL);   
- ERROR:  Slony-I: table "cagold"."address_history" has no primary key

to "reset" I did the following:

a) dropped (with cascade) the underscore schema named after the  
replication cluster in the master
b) dropped the slave db
c) re-setup the slave
d) re-ran the above script



Any thoughts ?


Thanks in advance...

From plk.zuber at gmail.com  Sat Jun 14 16:11:10 2008
From: plk.zuber at gmail.com (=?UTF-8?Q?Filip_Rembia=C5=82kowski?=)
Date: Sat Jun 14 16:11:25 2008
Subject: [Slony1-general] table add key issues
In-Reply-To: <F2DA0D1B-519A-4465-B914-34430ED36038@kevinkempterllc.com>
References: <F2DA0D1B-519A-4465-B914-34430ED36038@kevinkempterllc.com>
Message-ID: <92869e660806141611h66be3477ic9fefeb22dfbc3d1@mail.gmail.com>

MjAwOC82LzE0IGtldmluIGtlbXB0ZXIgPGtldmluQGtldmlua2VtcHRlcmxsYy5jb20+OgoKPiBI
aSBsaXN0Owo+Cj4gSSd2ZSBydW4gdGhpczoKPgo+IDEpIEkgY3JlYXRlZCB0aGUgZGIncyBvbiBi
b3RoIHNlcnZlcnMsIGNyZWF0ZWQgdGhlIHJlcGxpY2F0aW9uIHVzZXIsIGRpZCBhCj4gZHVtcCBm
cm9tIHRoZSBtYXN0ZXIgJiByZXN0b3JlIHRvIHRoZSBzbGF2ZSwgZXRjLi4uCj4KPiAyKSByYW4g
dGhpcyBzY3JpcHQ6ICh0aGUgc2xvbnkuZGcuZW52IGNvbnRhaW5zIGFsbCB0aGUgZW52IHZhcmlh
YmxlcykKPiAjIS9iaW4vYmFzaAo+Cj4gLiBzbG9ueS5kZy5lbnYKPgo+Cj4KPiBzbG9uaWsgPDxf
RU9GXwo+Cj4gY2x1c3RlciBuYW1lID0gJENMVVNURVJOQU1FOwo+Cj4gbm9kZSAxIGFkbWluIGNv
bm5pbmZvID0gJ2RibmFtZT0kTUFTVEVSREJOQU1FIGhvc3Q9JE1BU1RFUkhPU1QKPiBwb3J0PSRN
QVNURVJQT1JUIHVzZXI9JFJFUFVTRVIgcGFzc3dvcmQ9Qmx1ZS5tb29uMyc7Cj4gbm9kZSAyIGFk
bWluIGNvbm5pbmZvID0gJ2RibmFtZT0kU0xBVkVEQk5BTUUgaG9zdD0kU0xBVkVIT1NUCj4gcG9y
dD0kU0xBVkVQT1JUIHVzZXI9JFJFUFVTRVIgcGFzc3dvcmQ9Qmx1ZS5tb29uMyc7Cj4KPiBpbml0
IGNsdXN0ZXIgKCBpZD0xLCBjb21tZW50ID0gJ01hc3RlciBOb2RlJyk7Cj4KPgo+IGNyZWF0ZSBz
ZXQgKCBpZD0xLCBvcmlnaW49MSwgY29tbWVudCA9ICdQQSBSRVBMSUNBVElPTiBTRVQnICk7Cj4K
PiBzZXQgYWRkIHRhYmxlICggc2V0IGlkPTEsIG9yaWdpbj0xLCBpZD0xLCBmdWxseSBxdWFsaWZp
ZWQgbmFtZSA9Cj4gJ2NhZ29sZC5hZGRyZXNzJyk7Cj4gc2V0IGFkZCB0YWJsZSAoIHNldCBpZD0x
LCBvcmlnaW49MSwgaWQ9MiwgZnVsbHkgcXVhbGlmaWVkIG5hbWUgPQo+ICdjYWdvbGQuYWRkcmVz
c19oaXN0b3J5Jyk7Cj4KPgo+Cj4gc3RvcmUgbm9kZSAoaWQ9MiwgY29tbWVudCA9ICdTbGF2ZSBO
b2RlIDEnKTsKPgo+IHN0b3JlIHBhdGggKHNlcnZlciA9IDEsIGNsaWVudCA9IDIsIGNvbm5pbmZv
PSdkYm5hbWU9JE1BU1RFUkRCTkFNRQo+IGhvc3Q9JE1BU1RFUkhPU1QgcG9ydD0kTUFTVEVSUE9S
VCB1c2VyPSRSRVBVU0VSIHBhc3N3b3JkPUJsdWUubW9vbjMnKTsKPiBzdG9yZSBwYXRoIChzZXJ2
ZXIgPSAyLCBjbGllbnQgPSAxLCBjb25uaW5mbz0nZGJuYW1lPSRTTEFWRURCTkFNRQo+IGhvc3Q9
JFNMQVZFSE9TVCBwb3J0PSRTTEFWRVBPUlQgdXNlcj0kUkVQVVNFUiBwYXNzd29yZD1CbHVlLm1v
b24zJyk7Cj4KPgo+IHN0b3JlIGxpc3RlbiAob3JpZ2luPTEsIHByb3ZpZGVyID0gMSwgcmVjZWl2
ZXIgPTIpOwo+IHN0b3JlIGxpc3RlbiAob3JpZ2luPTIsIHByb3ZpZGVyID0gMiwgcmVjZWl2ZXIg
PTEpOwo+Cj4gX0VPRl8KPgo+Cj4gMykgdGhpcyBnaXZlcyBtZSB0aGlzIGVycm9yOgo+IDxzdGRp
bj46MTM6IFBHUkVTX0ZBVEFMX0VSUk9SIHNlbGVjdAo+ICJfY2FfY2x1c3RlciIuZGV0ZXJtaW5l
SWR4bmFtZVVuaXF1ZSgnY2Fnb2xkLmFkZHJlc3NfaGlzdG9yeScsIE5VTEwpOyAgLQo+IEVSUk9S
OiAgU2xvbnktSTogdGFibGUgImNhZ29sZCIuImFkZHJlc3NfaGlzdG9yeSIgaGFzIG5vIHByaW1h
cnkga2V5Cj4KPgo+Cj4KPiA0KSBzbyBJIGFsdGVyIHRoZSBzY3JpcHQgbGlrZSB0aGlzOgo+ICMh
L2Jpbi9iYXNoCj4KPiAuIHNsb255LmRnLmVudgo+Cj4KPgo+IHNsb25payA8PF9FT0ZfCj4KPiBj
bHVzdGVyIG5hbWUgPSAkQ0xVU1RFUk5BTUU7Cj4KPiBub2RlIDEgYWRtaW4gY29ubmluZm8gPSAn
ZGJuYW1lPSRNQVNURVJEQk5BTUUgaG9zdD0kTUFTVEVSSE9TVAo+IHBvcnQ9JE1BU1RFUlBPUlQg
dXNlcj0kUkVQVVNFUiBwYXNzd29yZD1CbHVlLm1vb24zJzsKPiBub2RlIDIgYWRtaW4gY29ubmlu
Zm8gPSAnZGJuYW1lPSRTTEFWRURCTkFNRSBob3N0PSRTTEFWRUhPU1QKPiBwb3J0PSRTTEFWRVBP
UlQgdXNlcj0kUkVQVVNFUiBwYXNzd29yZD1CbHVlLm1vb24zJzsKPgo+IGluaXQgY2x1c3RlciAo
IGlkPTEsIGNvbW1lbnQgPSAnTWFzdGVyIE5vZGUnKTsKPgo+IHRhYmxlIGFkZCBrZXkgKG5vZGUg
aWQgPSAxLCBmdWxseSBxdWFsaWZpZWQgbmFtZSA9Cj4gJ2NhZ29sZC5hZGRyZXNzX2hpc3Rvcnkn
KTsKPgo+Cj4gY3JlYXRlIHNldCAoIGlkPTEsIG9yaWdpbj0xLCBjb21tZW50ID0gJ1BBIFJFUExJ
Q0FUSU9OIFNFVCcgKTsKPgo+IHNldCBhZGQgdGFibGUgKCBzZXQgaWQ9MSwgb3JpZ2luPTEsIGlk
PTEsIGZ1bGx5IHF1YWxpZmllZCBuYW1lID0KPiAnY2Fnb2xkLmFkZHJlc3MnKTsKPiBzZXQgYWRk
IHRhYmxlICggc2V0IGlkPTEsIG9yaWdpbj0xLCBpZD0yLCBmdWxseSBxdWFsaWZpZWQgbmFtZSA9
Cj4gJ2NhZ29sZC5hZGRyZXNzX2hpc3RvcnknKTsKPgo+Cj4KPiBzdG9yZSBub2RlIChpZD0yLCBj
b21tZW50ID0gJ1NsYXZlIE5vZGUgMScpOwo+Cj4gc3RvcmUgcGF0aCAoc2VydmVyID0gMSwgY2xp
ZW50ID0gMiwgY29ubmluZm89J2RibmFtZT0kTUFTVEVSREJOQU1FCj4gaG9zdD0kTUFTVEVSSE9T
VCBwb3J0PSRNQVNURVJQT1JUIHVzZXI9JFJFUFVTRVIgcGFzc3dvcmQ9Qmx1ZS5tb29uMycpOwo+
IHN0b3JlIHBhdGggKHNlcnZlciA9IDIsIGNsaWVudCA9IDEsIGNvbm5pbmZvPSdkYm5hbWU9JFNM
QVZFREJOQU1FCj4gaG9zdD0kU0xBVkVIT1NUIHBvcnQ9JFNMQVZFUE9SVCB1c2VyPSRSRVBVU0VS
IHBhc3N3b3JkPUJsdWUubW9vbjMnKTsKPgo+Cj4gc3RvcmUgbGlzdGVuIChvcmlnaW49MSwgcHJv
dmlkZXIgPSAxLCByZWNlaXZlciA9Mik7Cj4gc3RvcmUgbGlzdGVuIChvcmlnaW49MiwgcHJvdmlk
ZXIgPSAyLCByZWNlaXZlciA9MSk7Cj4KPiBfRU9GXwo+Cj4KPiA1KSBJIHJlc2V0IGV2ZXJ5dGhp
bmcsIGFuZCByZS1ydW4gYW5kIEkgZ2V0IHRoZSBzYW1lIGVycm9yOgo+Cj4gPHN0ZGluPjoxNTog
UEdSRVNfRkFUQUxfRVJST1Igc2VsZWN0Cj4gIl9jYV9jbHVzdGVyIi5kZXRlcm1pbmVJZHhuYW1l
VW5pcXVlKCdjYWdvbGQuYWRkcmVzc19oaXN0b3J5JywgTlVMTCk7ICAtCj4gRVJST1I6ICBTbG9u
eS1JOiB0YWJsZSAiY2Fnb2xkIi4iYWRkcmVzc19oaXN0b3J5IiBoYXMgbm8gcHJpbWFyeSBrZXkK
Pgo+IHRvICJyZXNldCIgSSBkaWQgdGhlIGZvbGxvd2luZzoKPgo+IGEpIGRyb3BwZWQgKHdpdGgg
Y2FzY2FkZSkgdGhlIHVuZGVyc2NvcmUgc2NoZW1hIG5hbWVkIGFmdGVyIHRoZSByZXBsaWNhdGlv
bgo+IGNsdXN0ZXIgaW4gdGhlIG1hc3Rlcgo+IGIpIGRyb3BwZWQgdGhlIHNsYXZlIGRiCj4gYykg
cmUtc2V0dXAgdGhlIHNsYXZlCj4gZCkgcmUtcmFuIHRoZSBhYm92ZSBzY3JpcHQKPgo+Cj4KPiBB
bnkgdGhvdWdodHMgPwo+CgoKZG8gbm90IHVzZSBUQUJMRSBBREQgS0VZIHVubGVzcyB5b3UgYXJl
IDE1MCUgc3VyZSB5b3UgcmVhbGx5IG5lZWQgaXQuCgpTbG9ueSBkb2NzIHN0YXRlIHRoaXMgcXVp
dGUgY2xlYXJseSwgaWYgeW91IHJlLXJlYWQgdGhlc2U6CiogaHR0cDovL3Nsb255LmluZm8vZG9j
dW1lbnRhdGlvbi9kZWZpbmluZ3NldHMuaHRtbAoqIGh0dHA6Ly9zbG9ueS5pbmZvL2RvY3VtZW50
YXRpb24vc3RtdHRhYmxlYWRka2V5Lmh0bWwKCnlvdSB3aWxsIG1vc3QgcHJvYmFibHkgc2VlIHRo
YXQgVEFCTEUgQUREIEtFWSBpcyBhIHdyb25nIHdheSBvZiBzb2x2aW5nIHlvdXIKcHJvYmxlbS4K
CmlmIHlvdXIgdGFibGUgaXMgaW1wb3J0YW50IGVub3VnaCB0byBiZSB3b3J0aCByZXBsaWNhdGlu
ZywgaXQgZGVzZXJ2ZXMgYSBQSwo6LSkKSWYgdGhlcmUgaXMgcmVhbCByZXF1aXJlbWVudCBmb3Ig
bm90IGhhdmluZyBQSywgcGxlYXNlIGNhbiB5b3Ugc2hhcmUgaXQgd2l0aAp1cz8gaXQgd2lsbCBi
ZSBhIHJhcml0eS4uLgoKCgoKCmJ0dywgU1RPUkUgTElTVEVOIGlzIG5vdCBuZWVkZWQgYW55IG1v
cmUsIHNlZQpodHRwOi8vc2xvbnkuaW5mby9kb2N1bWVudGF0aW9uL3N0bXRzdG9yZWxpc3Rlbi5o
dG1sCgoKCj4KPiBUaGFua3MgaW4gYWR2YW5jZS4uLgo+Cj4gX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX18KPiBTbG9ueTEtZ2VuZXJhbCBtYWlsaW5nIGxpc3QK
PiBTbG9ueTEtZ2VuZXJhbEBsaXN0cy5zbG9ueS5pbmZvCj4gaHR0cDovL2xpc3RzLnNsb255Lmlu
Zm8vbWFpbG1hbi9saXN0aW5mby9zbG9ueTEtZ2VuZXJhbAo+CgoKCi0tIApGaWxpcCBSZW1iaWHF
gmtvd3NraQotLS0tLS0tLS0tLS0tLSBuZXh0IHBhcnQgLS0tLS0tLS0tLS0tLS0KQW4gSFRNTCBh
dHRhY2htZW50IHdhcyBzY3J1YmJlZC4uLgpVUkw6IGh0dHA6Ly9saXN0cy5zbG9ueS5pbmZvL3Bp
cGVybWFpbC9zbG9ueTEtZ2VuZXJhbC9hdHRhY2htZW50cy8yMDA4MDYxNS85OTU4YTFmZi9hdHRh
Y2htZW50Lmh0bQo=
From plk.zuber at gmail.com  Sat Jun 14 16:20:29 2008
From: plk.zuber at gmail.com (=?UTF-8?Q?Filip_Rembia=C5=82kowski?=)
Date: Sat Jun 14 16:20:44 2008
Subject: [Slony1-general] Slony download ordering..
In-Reply-To: <4852865C.2060804@otg-nc.com>
References: <4852865C.2060804@otg-nc.com>
Message-ID: <92869e660806141620s2755c60fw22d070dc6febe76c@mail.gmail.com>

MjAwOC82LzEzIENoYW5kZXIgR2FuZXNhbiA8Y2hhbmRlckBvdGctbmMuY29tPjoKCj4gSGVsbG8s
Cj4KPiBKdXN0IGEgdGhvdWdodC4gIEkgcmVjZW50bHkgd2VudCB0byB0aGUgZG93bmxvYWQgcGFn
ZSBhdDoKPiBodHRwOi8vc2xvbnkuaW5mby9kb3dubG9hZHMvMS4yL3NvdXJjZS8gYW5kIGFjY2lk
ZW50YWxseSBkb3dubG9hZGVkIDEuMi4wCj4gLgo+IE1pZ2h0IGl0IGJlIHVzZWZ1bCB0byByZXZl
cnNlLW9yZGVyIHRoZSBsaXN0IHNvIHRoYXQgdGhlIG1vc3QgcmVjZW50Cj4gdmVyc2lvbiBhcHBl
YXJzIGF0IHRoZSB0b3A/CgoKanVzdCB1c2UgIlF1aWNrIERvd25sb2FkcyIgYm94IG9uIHRoZSBo
b21lcGFnZSwgbm8gbW9yZSBtaXN0YWtlcyA6KQoKCgoKLS0gCkZpbGlwIFJlbWJpYcWCa293c2tp
Ci0tLS0tLS0tLS0tLS0tIG5leHQgcGFydCAtLS0tLS0tLS0tLS0tLQpBbiBIVE1MIGF0dGFjaG1l
bnQgd2FzIHNjcnViYmVkLi4uClVSTDogaHR0cDovL2xpc3RzLnNsb255LmluZm8vcGlwZXJtYWls
L3Nsb255MS1nZW5lcmFsL2F0dGFjaG1lbnRzLzIwMDgwNjE1L2ZkZTcyZTQwL2F0dGFjaG1lbnQu
aHRtCg==
From chander at otg-nc.com  Sat Jun 14 17:56:23 2008
From: chander at otg-nc.com (Chander Ganesan)
Date: Sat Jun 14 17:56:35 2008
Subject: [Slony1-general] Slony download ordering..
In-Reply-To: <92869e660806141620s2755c60fw22d070dc6febe76c@mail.gmail.com>
References: <4852865C.2060804@otg-nc.com>
	<92869e660806141620s2755c60fw22d070dc6febe76c@mail.gmail.com>
Message-ID: <485468B7.6060804@otg-nc.com>

Filip Rembia?kowski wrote:
> 2008/6/13 Chander Ganesan <chander@otg-nc.com 
> <mailto:chander@otg-nc.com>>:
>
>     Hello,
>
>     Just a thought.  I recently went to the download page at:
>     http://slony.info/downloads/1.2/source/ and accidentally
>     downloaded 1.2.0 .
>     Might it be useful to reverse-order the list so that the most
>     recent version appears at the top?
>
>
> just use "Quick Downloads" box on the homepage, no more mistakes :)
Sure.  For me the next time I try to download Slony.  But what about 
others? 

I just thought I'd bring it up, since it seems logical to order it the 
other way....

-- 
Chander Ganesan
Open Technology Group, Inc.
One Copley Parkway, Suite 210
Morrisville, NC  27560
919-463-0999/877-258-8987
http://www.otg-nc.com

From geustace at godzone.net.nz  Sat Jun 14 23:10:55 2008
From: geustace at godzone.net.nz (Glen Eustace)
Date: Sat Jun 14 23:11:22 2008
Subject: [Slony1-general] Replication has failed to restart after upgrade
Message-ID: <4854B26F.2060308@godzone.net.nz>

Hi,

Over the weekend, I had to move a master database to a new server, the 
Pg version went for 8.1 to 8.2 so the move was pg_dumpall -o | pgsql

I updated the server names in the paths on both slave and master and 
then tried to restart the slon processes.  The new master complained 
about the versions of slony's schema. (not surprising)

I have downloaded and build 1.2.14 for both the new master 8.2.7 and the 
old slave 8.2.9 and installed.  I have run update functions on both and 
both sets of slon daemons start but changes are not being replicated.

There are no errors in the slony logs.

The sl_log_2 table has entries in it.

Assuming I have done something wrong, what do I do to get replication 
going again.

Any help appreciated.
-- 
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
Glen and Rosanne Eustace
GodZone Internet Services, a division of AGRE Enterprises Ltd.
P.O. Box 8020, Palmerston North, New Zealand 4446.
Ph: +64 6 357 8168, Fax +64 6 357 8165, Mob: +64 21 424 015
http://www.godzone.net.nz

"A Ministry specialising in providing low-cost Internet Services
to NZ Christian Churches, Ministries and Organisations."
From geustace at godzone.net.nz  Sat Jun 14 23:29:04 2008
From: geustace at godzone.net.nz (Glen Eustace)
Date: Sat Jun 14 23:29:30 2008
Subject: [Slony1-general] Replication has failed to restart after upgrade
In-Reply-To: <4854B26F.2060308@godzone.net.nz>
References: <4854B26F.2060308@godzone.net.nz>
Message-ID: <4854B6B0.3080304@godzone.net.nz>

Glen Eustace wrote:

> Assuming I have done something wrong, what do I do to get replication 
> going again.

Well, one thing I had done wrong was to remember that the new server is 
running IPv6 and the old one had not been.  I didn't have an pg_hba 
entry for IPv6 for the slave server.  I do now.

Both servers now show connections from each other and the two tables 
sl_log_1&2 are now empty, but updates I expected to see on the slave 
haven't happened.




-- 
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
Glen and Rosanne Eustace
GodZone Internet Services, a division of AGRE Enterprises Ltd.
P.O. Box 8020, Palmerston North, New Zealand 4446.
Ph: +64 6 357 8168, Fax +64 6 357 8165, Mob: +64 21 424 015
http://www.godzone.net.nz

"A Ministry specialising in providing low-cost Internet Services
to NZ Christian Churches, Ministries and Organisations."
From ervin.szoradi at dunaweb.hu  Sun Jun 15 13:04:57 2008
From: ervin.szoradi at dunaweb.hu (=?ISO-8859-1?Q?Sz=F3r=E1di_Ervin?=)
Date: Sun Jun 15 13:05:01 2008
Subject: [Slony1-general] Re: Slony1-general Digest, Vol 16, Issue 17
In-Reply-To: <20080614190004.D5C1E290E21@main.slony.info>
References: <20080614190004.D5C1E290E21@main.slony.info>
Message-ID: <485575E9.2090407@dunaweb.hu>

Hi.

Please help Me!

I have a 6 primary server (exampe: London, Paris, New York .......) and 
1 secondary server which contains 6 schema (London, Paris, New York ).
I have to replicate all 6 server to only one dut different schema.
How can I do it?

Irvine
From lists at serioustechnology.com  Mon Jun 16 05:53:51 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Mon Jun 16 05:53:55 2008
Subject: [Slony1-general] Rebuild slony if I update Postgresql?
Message-ID: <4856625F.9020201@serioustechnology.com>

First of all, I would thank the folks on the list for their assistance 
over the past couple of weeks.  It does appear that we are successfully 
replicating our thirteen databases.  Using replicaton_role appears to 
have addressed our issues with triggers.

I'm looking at upgrading our machines from 8.3.1 to 8.3.3, and wasn't 
sure if that would require recompiling Slony.  I'm assuming I won't have 
to do anymore then that if anything at all.

Thanks again.

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From scetbon at echo.fr  Mon Jun 16 06:22:44 2008
From: scetbon at echo.fr (Cyril SCETBON)
Date: Mon Jun 16 06:22:53 2008
Subject: [Slony1-general] slonik segfault
In-Reply-To: <20080612132411.DB3AA120F01A@zeus.directinfos.com>
References: <48490712.6070202@echo.fr>
	<20080611153755.30645120F045@zeus.directinfos.com>
	<48502D3F.8080001@echo.fr>
	<20080611233404.0B2B0120F03D@zeus.directinfos.com>
	<4851193E.5060404@echo.fr>
	<20080612132411.DB3AA120F01A@zeus.directinfos.com>
Message-ID: <48566924.3000004@echo.fr>



Jacques Caron wrote:
> Hi,
>
> At 14:40 12/06/2008, Cyril SCETBON wrote:
>> I've tested it on the host and did not get any error with a negative 
>> value or a big value :
>>
>> cat test_malloc.c
>>
>> #include <stdlib.h>
>> #include <stdio.h>
>>
>> int main()
>> {
>>        printf("malloc(-4096)\n");
>>        malloc(-4096);
>>        printf("malloc(18446744073709547520)\n");
>>        malloc(18446744073709547520);
>>        return 0;
>> }
>>
>> cc -g -w test_malloc.c -o test_malloc
>>
>> ./test_malloc
>> malloc(-4096)
>> malloc(18446744073709547520)
>>
>> no segmentation fault
>
> Quite normal, the malloc itself won't cause a segfault, it's the fact 
> that something later uses space requested via malloc that couldn't be 
> allocated (malloc then returned 0). What's the return value of the 
> malloc calls?
malloc returns NULL in the both cases
>
>> , and the strace command shows :
>>
>> write(1, "malloc(-4096)\n", 14malloc(-4096)
>> )         = 14
>> brk(0)                                  = 0x501000
>> brk(0x521000)                           = 0x521000
>> mmap(NULL, 2097152, PROT_NONE, 
>> MAP_PRIVATE|MAP_ANONYMOUS|MAP_NORESERVE, -1, 0) = 0x2b78f91d1000
>> munmap(0x2b78f91d1000, 192512)          = 0
>> munmap(0x2b78f9300000, 856064)          = 0
>> mprotect(0x2b78f9200000, 131072, PROT_READ|PROT_WRITE) = 0
>> mmap(NULL, 2097152, PROT_NONE, 
>> MAP_PRIVATE|MAP_ANONYMOUS|MAP_NORESERVE, -1, 0) = 0x2b78f9300000
>> munmap(0x2b78f9400000, 1048576)         = 0
>> mprotect(0x2b78f9300000, 131072, PROT_READ|PROT_WRITE) = 0
>> munmap(0x2b78f9300000, 1048576)         = 0
>> write(1, "malloc(18446744073709547520)\n", 
>> 29malloc(18446744073709547520)
>> ) = 29
>> mmap(NULL, 2097152, PROT_NONE, 
>> MAP_PRIVATE|MAP_ANONYMOUS|MAP_NORESERVE, -1, 0) = 0x2b78f9300000
>> munmap(0x2b78f9400000, 1048576)         = 0
>> mprotect(0x2b78f9300000, 131072, PROT_READ|PROT_WRITE) = 0
>> munmap(0x2b78f9300000, 1048576)         = 0
>> munmap(0x2b78f8e94000, 4096)            = 0
>> exit_group(0)                           = ?
>> Process 15518 detached
>
> - you'll notice that the mmap calls are the same for both calls (don't 
> quite know what malloc is really doing here, it seems to be allocating 
> more space then freeing up bits, probably trying to align on some 
> large size), though neither size matches the actual request (?)
ok
>
> - the malloc-induced mmap is quite different from the one in your 
> original strace (see the flags). Is that the same box? 
It's the same host
> You must have some special compile flags or libraries in your slonik 
> compile that change malloc's behaviour. Was your slony-1 install 
> locally compiled or installed from binaries?
packaged (debian) from sources :

cc -g -Wall -O2 -Wall -Wmissing-prototypes -Wmissing-declarations 
-I../.. -DPGSHARE="\"/usr/share/slony1\""  -I/usr/incl
ude/postgresql/8.2/server/ -I/usr/include/postgresql/  -c -o slonik.o 
slonik.c
cc -g -Wall -O2 -Wall -Wmissing-prototypes -Wmissing-declarations 
-I../.. -DPGSHARE="\"/usr/share/slony1\""  -I/usr/incl
ude/postgresql/8.2/server/ -I/usr/include/postgresql/  -c -o dbutil.o 
dbutil.c
cc -g -Wall -O2 -Wall -Wmissing-prototypes -Wmissing-declarations 
-I../.. -DPGSHARE="\"/usr/share/slony1\""  -I/usr/incl
ude/postgresql/8.2/server/ -I/usr/include/postgresql/  -c -o parser.o 
parser.c
> If the latter you might want to try a good old wget/tar/configure/make 
> to see if the result is the same...
>
> Jacques.
>

-- 
Cyril SCETBON - Ing?nieur bases de donn?es
AUSY pour France T?l?com - OPF/PORTAILS/DOP/HEBEX

T?l : +33 (0)4 97 12 87 60
Jabber : cscetbon@jabber.org
France Telecom - Orange
790 Avenue du Docteur Maurice Donat 
B?timent Marco Polo C2 - Bureau 202
06250 Mougins
France

***********************************
Ce message et toutes les pieces jointes (ci-apres le 'message') sont
confidentiels et etablis a l'intention exclusive de ses destinataires.
Toute utilisation ou diffusion non autorisee est interdite.
Tout message electronique est susceptible d'alteration. Le Groupe France
Telecom decline toute responsabilite au titre de ce message s'il a ete
altere, deforme ou falsifie.
Si vous n'etes pas destinataire de ce message, merci de le detruire
immediatement et d'avertir l'expediteur.
***********************************
This message and any attachments (the 'message') are confidential and
intended solely for the addressees.
Any unauthorised use or dissemination is prohibited.
Messages are susceptible to alteration. France Telecom Group shall not be
liable for the message if altered, changed or falsified.
If you are not recipient of this message, please cancel it immediately and
inform the sender.
************************************

From cbbrowne at ca.afilias.info  Mon Jun 16 07:56:36 2008
From: cbbrowne at ca.afilias.info (cbbrowne@ca.afilias.info)
Date: Mon Jun 16 07:56:42 2008
Subject: [Slony1-general] table add key issues
In-Reply-To: <F2DA0D1B-519A-4465-B914-34430ED36038@kevinkempterllc.com>
References: <F2DA0D1B-519A-4465-B914-34430ED36038@kevinkempterllc.com>
Message-ID: <59793.74.12.197.129.1213628196.squirrel@webmail.afilias.info>

> init cluster ( id=1, comment = 'Master Node');
>
> table add key (node id = 1, fully qualified name =
> 'cagold.address_history');
>
>
> create set ( id=1, origin=1, comment = 'PA REPLICATION SET' );
>
> set add table ( set id=1, origin=1, id=1, fully qualified name =
> 'cagold.address');
> set add table ( set id=1, origin=1, id=2, fully qualified name =
> 'cagold.address_history');

> 5) I reset everything, and re-run and I get the same error:
>
> <stdin>:15: PGRES_FATAL_ERROR select
> "_ca_cluster".determineIdxnameUnique('cagold.address_history', NULL);
> - ERROR:  Slony-I: table "cagold"."address_history" has no primary key
>
> to "reset" I did the following:
>
> a) dropped (with cascade) the underscore schema named after the
> replication cluster in the master
> b) dropped the slave db
> c) re-setup the slave
> d) re-ran the above script
>
> Any thoughts ?

FYI, there was no need to go back to the very beginning in this process
(e.g. - to drop replication and drop databases and such).

You did correctly notice that you didn't have a primary key; as observed
elsewhere, the *RIGHT* answer is to add one yourself.

TABLE ADD KEY is considered something of a misfeature, and has been
removed in v2.

But if you feel like you really MUST use TABLE ADD KEY, then you can do
so; you should look at the documentation for SET ADD TABLE, as you'll need
to modify the command to indicate that you're using TABLE ADD KEY on the
table...

http://linuxfinances.info/info/stmtsetaddtable.html

Note that once you submit a TABLE ADD KEY request, this is NOT an
idempotent operation, and this will *break* things if you try to "clean
up" via dropping the replication schema.  Dropping the schema won't make
the slony-created key column go away.

From namlas at gmail.com  Mon Jun 16 08:10:55 2008
From: namlas at gmail.com (Salman)
Date: Mon Jun 16 08:11:03 2008
Subject: [Slony1-general] Upgrading from postgres 8.2.3 to 8.3.1
Message-ID: <49c8d3350806160810q30e5a694h1aff2d7cf25cccdb@mail.gmail.com>

All,

I am trying to upgrade our current version of postgres 8.2.3 to 8.3.1.
I have installed 8.3.1 on the same machine as our 8.2.3 install and am
now trying to add the new install as a slave. When I run the slonik
commands, I get an error back saying that $libdir/xxid.so was not
found.

I did check in the 8.2.3 and 8.3.1 $libdir-s and while there is a
xxid.so file in the 8.2.3 $libdir, there isn't one in the 8.3.1; the
config options for both installs were kept the same.

I tried a google search already but could not find a work around for
the issue. http://linuxfinances.info/info/faq.html#AEN47452 recommends
only having one install of postgres, but that's not possible during an
upgrade.

Would just copying the lib file from one install to another work? I
assume that's likely to break things.
From cbbrowne at ca.afilias.info  Mon Jun 16 09:14:29 2008
From: cbbrowne at ca.afilias.info (cbbrowne@ca.afilias.info)
Date: Mon Jun 16 09:14:36 2008
Subject: [Slony1-general] Upgrading from postgres 8.2.3 to 8.3.1
In-Reply-To: <49c8d3350806160810q30e5a694h1aff2d7cf25cccdb@mail.gmail.com>
References: <49c8d3350806160810q30e5a694h1aff2d7cf25cccdb@mail.gmail.com>
Message-ID: <60581.74.12.197.129.1213632869.squirrel@webmail.afilias.info>

> All,
>
> I am trying to upgrade our current version of postgres 8.2.3 to 8.3.1.
> I have installed 8.3.1 on the same machine as our 8.2.3 install and am
> now trying to add the new install as a slave. When I run the slonik
> commands, I get an error back saying that $libdir/xxid.so was not
> found.
>
> I did check in the 8.2.3 and 8.3.1 $libdir-s and while there is a
> xxid.so file in the 8.2.3 $libdir, there isn't one in the 8.3.1; the
> config options for both installs were kept the same.
>
> I tried a google search already but could not find a work around for
> the issue. http://linuxfinances.info/info/faq.html#AEN47452 recommends
> only having one install of postgres, but that's not possible during an
> upgrade.

Yeah, the suggestion is to have as few builds around as you can, to
minimize confusion.

Obviously if you need to run 8.2 and 8.3, that's going to require two
PostgreSQL builds :-).

> Would just copying the lib file from one install to another work? I
> assume that's likely to break things.

Quite so, there are differences between APIs with 8.2 and 8.3.

What you should do is to do a separate Slony-I build against 8.3, from
"configure" to "make install."

That will ensure consistency within the Slony-I build.

From ajs at crankycanuck.ca  Mon Jun 16 09:47:35 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Mon Jun 16 09:48:00 2008
Subject: [Slony1-general] Rebuild slony if I update Postgresql?
In-Reply-To: <4856625F.9020201@serioustechnology.com>
References: <4856625F.9020201@serioustechnology.com>
Message-ID: <20080616164735.GA23361@crankycanuck.ca>

On Mon, Jun 16, 2008 at 08:53:51AM -0400, Geoffrey wrote:
> 
> I'm looking at upgrading our machines from 8.3.1 to 8.3.3, and wasn't 
> sure if that would require recompiling Slony.  I'm assuming I won't have 
> to do anymore then that if anything at all.

Nope, you shouldn't have to do anything.

From msteben at autorevenue.com  Mon Jun 16 13:51:12 2008
From: msteben at autorevenue.com (Mark Steben)
Date: Mon Jun 16 13:51:43 2008
Subject: [Slony1-general] trying to run test_slony_state.pl
In-Reply-To: <60prqlghw8.fsf@dba2.int.libertyrms.com>
Message-ID: <003f01c8cff2$b7fb15a0$14010a0a@dei26g028575>

Thank you - will post in MS Word plain vanilla from now on.



Mark Steben
Senior Database Administrator
@utoRevenueT 
A Dominion Enterprises Company
480 Pleasant Street
Suite B200
Lee, MA 01238
413-243-4800 Home Office 
413-243-4809 Corporate Fax
msteben@autorevenue.com

Visit our new website at 
www.autorevenue.com

-----Original Message-----
From: Christopher Browne [mailto:cbbrowne@ca.afilias.info] 
Sent: Friday, June 13, 2008 5:11 PM
To: Mark Steben
Cc: slony1-general@lists.slony.info
Subject: Re: [Slony1-general] trying to run test_slony_state.pl

"Mark Steben" <msteben@autorevenue.com> writes:

Two preliminaries:

- If you could post in other than "Microsoft Word HTML," that would
  make it way easier to read this...

- Notices warning about "misuse" of email are particularly useless on
  public mailing lists, as we most certainly do not control who receives
  email.

As for installing Perl components, I have only a couple of comments.

a) DBI appears to be the preferable interface these days; you probably
would prefer to use test_slony_state-dbi.pl rather than the one using
the older (near-deprecated) Pg module.

b) Perl has its own dependancy tracking system for its modules.  It is
almost certain that copying modules one by one will NOT work out,
particularly when you get into modular things like DBI.

Here are a couple of links that might be useful:

http://www.codepedia.com/1/PerlDBITutorial
http://www.rcbowen.com/imho/cgi-database/windows/
-- 
let name="cbbrowne" and tld="linuxfinances.info" in name ^ "@" ^ tld;;
http://www3.sympatico.ca/cbbrowne/emacs.html
Een schip op het strand is een baken in zee.

From lists at serioustechnology.com  Mon Jun 16 14:14:10 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Mon Jun 16 14:14:23 2008
Subject: [Slony1-general] trying to run test_slony_state.pl
In-Reply-To: <003f01c8cff2$b7fb15a0$14010a0a@dei26g028575>
References: <003f01c8cff2$b7fb15a0$14010a0a@dei26g028575>
Message-ID: <4856D7A2.6000702@serioustechnology.com>

Mark Steben wrote:
> Thank you - will post in MS Word plain vanilla from now on.

How about plain old text??

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From m.eriksson at albourne.com  Tue Jun 17 00:05:46 2008
From: m.eriksson at albourne.com (Martin Eriksson)
Date: Tue Jun 17 00:06:15 2008
Subject: [Slony1-general] Upgrading from postgres 8.2.3 to 8.3.1
In-Reply-To: <49c8d3350806160810q30e5a694h1aff2d7cf25cccdb@mail.gmail.com>
References: <49c8d3350806160810q30e5a694h1aff2d7cf25cccdb@mail.gmail.com>
Message-ID: <4857624A.5020900@albourne.com>

Hi Salman,

I just did this whole exercise with 1 master and 3 slaves and some of 
the main points:

    * need two postgres installations running at the same time on
      different ports 8.2.3, 8.3.1)
    * I guess you will upgrade slony to 1.2.14 as well, as Christopher
      pointed out need to do the "configure" and "make install" but if
      you are upgrading your 8.2.3 slony installation as well, make sure
      that you run "make clean" before doing the make install. else you
      will get older lib files and you will get that error below (i got
      it too)
    * using MOVE_SET only switch the subscription of the nodes in
      question, not other nodes that subscribe the original master,
      those need to be switched manually with "Subscribe_set"
    * If you like me, want to drop the 8.2.3 node and change the port of
      the 8.3.1 to the old port of the 8.2.3. Take the dbs down change
      the port in postgres.conf take the 8.3.1 db up on the new port
      then for each node you need to issue the "store path" command to
      upgrade the paths so all nodes know the correct new port.

You can check my previous messages on this list as i went through most 
of the problems you are likely to face doing this.


Salman wrote:
> All,
>
> I am trying to upgrade our current version of postgres 8.2.3 to 8.3.1.
> I have installed 8.3.1 on the same machine as our 8.2.3 install and am
> now trying to add the new install as a slave. When I run the slonik
> commands, I get an error back saying that $libdir/xxid.so was not
> found.
>
> I did check in the 8.2.3 and 8.3.1 $libdir-s and while there is a
> xxid.so file in the 8.2.3 $libdir, there isn't one in the 8.3.1; the
> config options for both installs were kept the same.
>
> I tried a google search already but could not find a work around for
> the issue. http://linuxfinances.info/info/faq.html#AEN47452 recommends
> only having one install of postgres, but that's not possible during an
> upgrade.
>
> Would just copying the lib file from one install to another work? I
> assume that's likely to break things.
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>   

From stephane.schildknecht at postgresqlfr.org  Tue Jun 17 05:56:43 2008
From: stephane.schildknecht at postgresqlfr.org (=?ISO-8859-1?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Tue Jun 17 05:56:50 2008
Subject: [Slony1-general] trying to run test_slony_state.pl
In-Reply-To: <4856D7A2.6000702@serioustechnology.com>
References: <003f01c8cff2$b7fb15a0$14010a0a@dei26g028575>
	<4856D7A2.6000702@serioustechnology.com>
Message-ID: <4857B48B.8070509@postgresqlfr.org>

Geoffrey a ?crit :
> Mark Steben wrote:
>> Thank you - will post in MS Word plain vanilla from now on.
> 
> How about plain old text??
> 

Hey, plain old text? Is it still taught in school ?
From lists at serioustechnology.com  Tue Jun 17 06:02:19 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Tue Jun 17 06:02:24 2008
Subject: [Slony1-general] trying to run test_slony_state.pl
In-Reply-To: <4857B48B.8070509@postgresqlfr.org>
References: <003f01c8cff2$b7fb15a0$14010a0a@dei26g028575>
	<4856D7A2.6000702@serioustechnology.com>
	<4857B48B.8070509@postgresqlfr.org>
Message-ID: <4857B5DB.30902@serioustechnology.com>

St?phane A. Schildknecht wrote:
> Geoffrey a ?crit :
>> Mark Steben wrote:
>>> Thank you - will post in MS Word plain vanilla from now on.
>> How about plain old text??
>>
> 
> Hey, plain old text? Is it still taught in school ?


Good point, likely not. ;)


-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From bnichols at ca.afilias.info  Tue Jun 17 06:52:03 2008
From: bnichols at ca.afilias.info (Brad Nicholson)
Date: Tue Jun 17 06:52:09 2008
Subject: [Slony1-general] trying to run test_slony_state.pl
In-Reply-To: <60prqlghw8.fsf@dba2.int.libertyrms.com>
References: <000001c8cd92$7835f320$14010a0a@dei26g028575>
	<60prqlghw8.fsf@dba2.int.libertyrms.com>
Message-ID: <1213710723.6044.56.camel@bnicholson-desktop>

On Fri, 2008-06-13 at 17:11 -0400, Christopher Browne wrote:
> a) DBI appears to be the preferable interface these days; you probably
> would prefer to use test_slony_state-dbi.pl rather than the one using
> the older (near-deprecated) Pg module.

Perhaps that docs should be updated to reflect that.  They say that you
should run test_slony_state.pl

> b) Perl has its own dependancy tracking system for its modules.  It is
> almost certain that copying modules one by one will NOT work out,
> particularly when you get into modular things like DBI.

Again, since it is a recommended tool perhaps the dependencies and
installation should be documented, even if they are Perl specific.
-- 
?Brad Nicholson  416-673-4106
Database Administrator, Afilias Canada Corp.

From namlas at gmail.com  Tue Jun 17 09:05:14 2008
From: namlas at gmail.com (Salman)
Date: Tue Jun 17 09:05:23 2008
Subject: [Slony1-general] Upgrading from postgres 8.2.3 to 8.3.1
In-Reply-To: <4857624A.5020900@albourne.com>
References: <49c8d3350806160810q30e5a694h1aff2d7cf25cccdb@mail.gmail.com>
	<4857624A.5020900@albourne.com>
Message-ID: <49c8d3350806170905i72d9fb2cn269640c56d311008@mail.gmail.com>

On Tue, Jun 17, 2008 at 3:05 AM, Martin Eriksson
<m.eriksson@albourne.com> wrote:
> Hi Salman,
>
> I just did this whole exercise with 1 master and 3 slaves and some of the
> main points:
>
>   * need two postgres installations running at the same time on
>     different ports 8.2.3, 8.3.1)
>   * I guess you will upgrade slony to 1.2.14 as well, as Christopher
>     pointed out need to do the "configure" and "make install" but if
>     you are upgrading your 8.2.3 slony installation as well, make sure
>     that you run "make clean" before doing the make install. else you
>     will get older lib files and you will get that error below (i got
>     it too)
>   * using MOVE_SET only switch the subscription of the nodes in
>     question, not other nodes that subscribe the original master,
>     those need to be switched manually with "Subscribe_set"
>   * If you like me, want to drop the 8.2.3 node and change the port of
>     the 8.3.1 to the old port of the 8.2.3. Take the dbs down change
>     the port in postgres.conf take the 8.3.1 db up on the new port
>     then for each node you need to issue the "store path" command to
>     upgrade the paths so all nodes know the correct new port.
>
> You can check my previous messages on this list as i went through most of
> the problems you are likely to face doing this.
>
>

Martin, Christopher,

Thank you very much for the pointers. I successfully added the new
slave and it is not syncing against the master. I'll search the list
for Martin's replies to see what other problems can possibly arise.
From dane at greatschools.net  Tue Jun 17 10:43:16 2008
From: dane at greatschools.net (Dane Miller)
Date: Tue Jun 17 10:45:12 2008
Subject: [Slony1-general] order of replication
In-Reply-To: <20080613134012.GB28292@crankycanuck.ca>
References: <1213309614.20093.86.camel@danedesk.greatschools.net>
	<20080613134012.GB28292@crankycanuck.ca>
Message-ID: <1213724596.23894.18.camel@danedesk.greatschools.net>

Andrew Sullivan wrote:
> Dane Miller wrote:
> > Consider the below example. Does Slony guarantee that the updated
> > sequence will always appear after (or concurrently with) the result
> > of the I/U/D statements on subscriber nodes?
> 
> Not necessarily.  Slony sets the sequence on the target to the value
> of the sequence at the time of the sync, because there isn't any other
> way to look at the sequence value.  The idea is that it's ok for a
> sequence to be _ahead_ of the rest of the database, because this is
> consistent with the semantics of sequences in an unreplicated database
> (they always advance, so they're never-go-backwards series that
> possibly have gaps).  
> 
> If you want this, you could probably do it using a table that is
> replicated and that gets updated with currval() using a trigger or
> something. 

Thanks very much Andrew.  I think this explains errors we are seeing on
supposedly up-to-date subscriber nodes.

I think storing currval() in a table, as you suggest, looks promising...
perhaps using TRUNCATE before each insert to avoid dead tuple bloat.

Dane
-- 
Dane Miller
Systems Administrator
Greatschools, Inc
http://www.greatschools.net

From wmoran at collaborativefusion.com  Tue Jun 17 10:49:22 2008
From: wmoran at collaborativefusion.com (Bill Moran)
Date: Tue Jun 17 10:50:25 2008
Subject: [Slony1-general] order of replication
In-Reply-To: <1213724596.23894.18.camel@danedesk.greatschools.net>
References: <1213309614.20093.86.camel@danedesk.greatschools.net>
	<20080613134012.GB28292@crankycanuck.ca>
	<1213724596.23894.18.camel@danedesk.greatschools.net>
Message-ID: <20080617134922.90058bfb.wmoran@collaborativefusion.com>

In response to Dane Miller <dane@greatschools.net>:

> Andrew Sullivan wrote:
> > Dane Miller wrote:
> > > Consider the below example. Does Slony guarantee that the updated
> > > sequence will always appear after (or concurrently with) the result
> > > of the I/U/D statements on subscriber nodes?
> > 
> > Not necessarily.  Slony sets the sequence on the target to the value
> > of the sequence at the time of the sync, because there isn't any other
> > way to look at the sequence value.  The idea is that it's ok for a
> > sequence to be _ahead_ of the rest of the database, because this is
> > consistent with the semantics of sequences in an unreplicated database
> > (they always advance, so they're never-go-backwards series that
> > possibly have gaps).  
> > 
> > If you want this, you could probably do it using a table that is
> > replicated and that gets updated with currval() using a trigger or
> > something. 
> 
> Thanks very much Andrew.  I think this explains errors we are seeing on
> supposedly up-to-date subscriber nodes.
> 
> I think storing currval() in a table, as you suggest, looks promising...
> perhaps using TRUNCATE before each insert to avoid dead tuple bloat.

Don't TRUNCATE a replicated table.  It will ruin replication.

-- 
Bill Moran
Collaborative Fusion Inc.
http://people.collaborativefusion.com/~wmoran/

wmoran@collaborativefusion.com
Phone: 412-422-3463x4023
From JanWieck at Yahoo.com  Tue Jun 17 11:08:04 2008
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Tue Jun 17 11:08:13 2008
Subject: [Slony1-general] Fixed a bug in wait for event
Message-ID: <4857FD84.1010606@Yahoo.com>

I just committed a small fix to the remote worker. The bug was actually 
revealed after a change I made to the ducttape test #2. I added wait for 
event commands there in order to start subscribing node 3, which 
cascades from node 2, as soon as node 2 had finished its copy set.

The problem was that node 3 as a "not subscribed to anything at all" 
node was listening on node 1 for events originating from node 1. That is 
fine under normal circumstances. However, in this specific setup the 
attempt is to subscribe a set, originating on 1, cascaded with node 2 as 
data provider which at this point is for sure lagging behind (it just 
started to catch up after the copy set). What happens is that the 
SUBSCRIBE_SET event originates on node 2 (data provider) and travels to 
node 1 (origin). There it causes the ENABLE_SUBSCRIPTION event to be 
generated. This event is received by node 3 "directly", which causes 
node 3 to wait and check in 5 second intervals if node 2 finally has 
caught up to at least that ENABLE_SUBSCRIPTION event.

In that wait loop, it never processed any confirm forward messages, 
which were added to the end of the internal message loop. I changed a 
few things to make sure that confirm forward messages are kept at the 
head of the remote worker internal message queue.

There have been repeated comments that wait for event does not work in 
connection with subscribe set. This bug may have been one, the other 
might be that people don't realize that subscribing to a set internally 
does create two events, and both need to be waited for in the right order.

The correct sequence of slonik commands to wait for a subscribe is:

     subscribe set (...);
     wait for event (origin = <data provider>, confirmed = <set origin>,
             wait on = <set origin>, timeout = 0);
     sync (id = <set origin>);
     wait for event (origin = <set origin>, confirmed = <new subscriber>,
             wait on = <new subscriber>, timeout = 0);

The first "wait for event" waits until the actual subscribe set command 
has been processed by the origin on the data set. The following "sync" 
command is necessary to update slonik's idea of what the last event 
sequence on the set origin is. The second "wait for event" now will wait 
until that very sync has been confirmed by the new subscriber, which 
means that it has finished not only the copy set, but also the very 
first sync operation thereafter.

The "wait for event" has a timeout. In case of subscribe set operations, 
which are known to lead to hours or in some cases even days of lag, such 
timeout is for sure unwanted. It is disabled with timeout=0.


Jan

-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin

From Marcin.Kasperski at softax.com.pl  Tue Jun 17 11:27:14 2008
From: Marcin.Kasperski at softax.com.pl (Marcin Kasperski)
Date: Tue Jun 17 11:22:43 2008
Subject: [Slony1-general] Making Slony lazy? (= encouraging it to sync less
	frequently in bigger blocks)
Message-ID: <87zlpjyl19.fsf@softax.com.pl>


I would like to make my slony somewhat lazy. By "lazy" I mean
preferring less frequent updates in bigger packs. The factor to
optimize is network and database usage. I am OK with subscriber being
a few hours behind the master.

I played a bit with slon.conf, trying border values (on both sides,
just in case), like

   sync_interval=60000
   sync_interval_timeout=120000
   sync_group_maxsize=100
   desired_sync_time=300000

Is it going towards my aim? Can I do anything except that? Are those
truly maximums as config texts say, or maybe could be increased even
more?

From dane at greatschools.net  Thu Jun 19 12:18:12 2008
From: dane at greatschools.net (Dane Miller)
Date: Thu Jun 19 12:18:28 2008
Subject: [Slony1-general] Documentation typo
Message-ID: <1213903092.15835.31.camel@danedesk.greatschools.net>

Hi Slony Friends,
  I just came across this typo in the MERGE SET documentation and wanted
to let y'all know...

http://slony.info/documentation/stmtmergeset.html

In the example, WAIT FOR=1 should be WAIT ON=1

Example
# Assuming that set 1 has direct subscribers 2 and 3
     SUBSCRIBE SET (ID = 999, PROVIDER = 1, RECEIVER = 2);
     SYNC (ID=1);
     WAIT FOR EVENT (ORIGIN = 1, CONFIRMED = 2, WAIT FOR=1);
     SUBSCRIBE SET (ID = 999, PROVIDER = 1, RECEIVER = 3);
     SYNC (ID=1);
     WAIT FOR EVENT (ORIGIN = 1, CONFIRMED = 3, WAIT FOR=1);
     MERGE SET ( ID = 1, ADD ID = 999, ORIGIN = 1 );
    

Dane
-- 
Dane Miller
Systems Administrator
Greatschools, Inc
http://www.greatschools.net

From cbbrowne at ca.afilias.info  Thu Jun 19 13:36:29 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Thu Jun 19 13:36:42 2008
Subject: [Slony1-general] Documentation typo
In-Reply-To: <1213903092.15835.31.camel@danedesk.greatschools.net> (Dane
	Miller's message of "Thu, 19 Jun 2008 12:18:12 -0700")
References: <1213903092.15835.31.camel@danedesk.greatschools.net>
Message-ID: <60r6at40xe.fsf@dba2.int.libertyrms.com>

Dane Miller <dane@greatschools.net> writes:
> Hi Slony Friends,
>   I just came across this typo in the MERGE SET documentation and wanted
> to let y'all know...
>
> http://slony.info/documentation/stmtmergeset.html
>
> In the example, WAIT FOR=1 should be WAIT ON=1
>
> Example
> # Assuming that set 1 has direct subscribers 2 and 3
>      SUBSCRIBE SET (ID = 999, PROVIDER = 1, RECEIVER = 2);
>      SYNC (ID=1);
>      WAIT FOR EVENT (ORIGIN = 1, CONFIRMED = 2, WAIT FOR=1);
>      SUBSCRIBE SET (ID = 999, PROVIDER = 1, RECEIVER = 3);
>      SYNC (ID=1);
>      WAIT FOR EVENT (ORIGIN = 1, CONFIRMED = 3, WAIT FOR=1);
>      MERGE SET ( ID = 1, ADD ID = 999, ORIGIN = 1 );

Already fixed in -HEAD; fixed this in the 1.2 branch.
-- 
"cbbrowne","@","acm.org"
http://linuxdatabases.info/info/lisp.html
I was just  wondering if the Chinese are busy trying  to deal with the
"Year Of The Dragon" bug.
From yi.zhao at alibaba-inc.com  Thu Jun 19 20:24:24 2008
From: yi.zhao at alibaba-inc.com (Yi Zhao)
Date: Thu Jun 19 20:22:56 2008
Subject: [Slony1-general] confusion about compile with slony, help:D
Message-ID: <1213932264.3165.6.camel@localhost.localdomain>

hi, all:
when I compile slony1-1.2.9 with PostgreSQL 8.3.1
I got he message as follows:
---------------------------------------------------------------------------
slony1_funcs.c: In function ?_Slony_I_getModuleVersion?:
slony1_funcs.c:293: warning: implicit declaration of function
?VARATT_SIZEP?
slony1_funcs.c:293: error: lvalue required as left operand of assignment
slony1_funcs.c: In function ?_Slony_I_getSessionRole?:
slony1_funcs.c:366: error: lvalue required as left operand of assignment
slony1_funcs.c:372: error: lvalue required as left operand of assignment
slony1_funcs.c:378: error: lvalue required as left operand of assignment
slony1_funcs.c: In function ?_Slony_I_logTrigger?:
slony1_funcs.c:620: error: lvalue required as left operand of assignment
slony1_funcs.c:858: error: lvalue required as left operand of assignment
slony1_funcs.c:925: error: lvalue required as left operand of assignment
slony1_funcs.c: In function ?slon_quote_literal?:
slony1_funcs.c:1100: warning: pointer targets in passing argument 1 of
?pg_mblen? differ in signedness
slony1_funcs.c: In function ?_slon_quote_ident?:
slony1_funcs.c:1233: error: lvalue required as left operand of
assignment
slony1_funcs.c: In function ?getClusterStatus?:
slony1_funcs.c:1351: warning: passing argument 1 of ?typenameTypeId?
from incompatible pointer type
slony1_funcs.c:1351: error: too few arguments to function
?typenameTypeId?
slony1_funcs.c:1434: warning: passing argument 1 of ?typenameTypeId?
from incompatible pointer type
slony1_funcs.c:1434: error: too few arguments to function
?typenameTypeId?
slony1_funcs.c:1475: error: lvalue required as left operand of
assignment
slony1_funcs.c:1478: error: lvalue required as left operand of
assignment
slony1_funcs.c:1481: error: lvalue required as left operand of
assignment
make[2]: *** [slony1_funcs.o] Error 1
make[2]: Leaving directory
`/home/zhaoyi/package/slony/slony1-1.2.9/src/backend'
make[1]: *** [all] Error 2
make[1]: Leaving directory `/home/zhaoyi/package/slony/slony1-1.2.9/src'
make: *** [all] Error 2
--------------------------------------------------------------------------
how can I fixed?
anly help is appreciated.

thanks!

From devrim at CommandPrompt.com  Thu Jun 19 23:52:51 2008
From: devrim at CommandPrompt.com (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Thu Jun 19 23:53:32 2008
Subject: [Slony1-general] confusion about compile with slony, help:D
In-Reply-To: <1213932264.3165.6.camel@localhost.localdomain>
References: <1213932264.3165.6.camel@localhost.localdomain>
Message-ID: <1213944771.2734.22.camel@laptop.gunduz.org>

Ck9uIEZyaSwgMjAwOC0wNi0yMCBhdCAxMToyNCArMDgwMCwgWWkgWmhhbyB3cm90ZToKPiB3aGVu
IEkgY29tcGlsZSBzbG9ueTEtMS4yLjkgd2l0aCBQb3N0Z3JlU1FMIDguMy4xCgpJSVJDIFNsb255
IDEuMi45IGRvZXMgbm90IGNvbXBpbGUgYWdhaW5zdCBQb3N0Z3JlU1FMIDguMy4xIC0tIEFueSBy
ZWFzb24Kd2h5IGRvbid0IHlvdSB1c2UgMS4yLjE0PwoKUmVnYXJkcywKLS0gCkRldnJpbSBHw5xO
RMOcWiAsIFJIQ0UKUG9zdGdyZVNRTCBSZXBsaWNhdGlvbiwgQ29uc3VsdGluZywgQ3VzdG9tIERl
dmVsb3BtZW50LCAyNHg3IHN1cHBvcnQKTWFuYWdlZCBTZXJ2aWNlcywgU2hhcmVkIGFuZCBEZWRp
Y2F0ZWQgSG9zdGluZwpDby1BdXRob3JzOiBwbFBIUCwgT0RCQ25nIC0gaHR0cDovL3d3dy5jb21t
YW5kcHJvbXB0LmNvbS8KLS0tLS0tLS0tLS0tLS0gbmV4dCBwYXJ0IC0tLS0tLS0tLS0tLS0tCkEg
bm9uLXRleHQgYXR0YWNobWVudCB3YXMgc2NydWJiZWQuLi4KTmFtZTogbm90IGF2YWlsYWJsZQpU
eXBlOiBhcHBsaWNhdGlvbi9wZ3Atc2lnbmF0dXJlClNpemU6IDE5NyBieXRlcwpEZXNjOiBUaGlz
IGlzIGEgZGlnaXRhbGx5IHNpZ25lZCBtZXNzYWdlIHBhcnQKVXJsIDogaHR0cDovL2xpc3RzLnNs
b255LmluZm8vcGlwZXJtYWlsL3Nsb255MS1nZW5lcmFsL2F0dGFjaG1lbnRzLzIwMDgwNjIwL2Mz
MzQ3NGU4L2F0dGFjaG1lbnQucGdwCg==
From yi.zhao at alibaba-inc.com  Fri Jun 20 00:09:28 2008
From: yi.zhao at alibaba-inc.com (Yi Zhao)
Date: Fri Jun 20 00:08:04 2008
Subject: [Slony1-general] confusion about compile with slony, help:D
In-Reply-To: <1213944771.2734.22.camel@laptop.gunduz.org>
References: <1213932264.3165.6.camel@localhost.localdomain>
	<1213944771.2734.22.camel@laptop.gunduz.org>
Message-ID: <1213945768.3165.9.camel@localhost.localdomain>

now, I'm using Slony 1.2.14. It's work!
?thanks.

best regards,
ZhaoYi
On Fri, 2008-06-20 at 09:52 +0300, Devrim G?ND?Z wrote:
> On Fri, 2008-06-20 at 11:24 +0800, Yi Zhao wrote:
> > when I compile slony1-1.2.9 with PostgreSQL 8.3.1
> 
> IIRC Slony 1.2.9 does not compile against PostgreSQL 8.3.1 -- Any reason
> why don't you use 1.2.14?
> 
> Regards,

From scetbon at echo.fr  Fri Jun 20 02:29:13 2008
From: scetbon at echo.fr (Cyril SCETBON)
Date: Fri Jun 20 02:30:04 2008
Subject: [Slony1-general] Mixing 3 slony on 3 databases on the same servers
Message-ID: <485B7869.9010400@echo.fr>

Hi guys,

I got a real issue. I've the following configuration :

                         M1 ------------------> S1
                               |
                               |------------------>S2--------------->S3

on each server I have one postgresql server with 3 databases (say db1, 
db2, db3).

At the moment, db1 is in production. The issue is that when I try to 
subscribe slaves of db2 I get the following error :

transactions earlier than XID 212275674 are still in progress

I found that these transactions have been initiated by the slaves of 
db1. So transactionid of db1 have impact on subscription of slave of db2

Outch!!!

any advice ?

-- 
Cyril SCETBON
From Marcin.Kasperski at softax.com.pl  Fri Jun 20 03:27:02 2008
From: Marcin.Kasperski at softax.com.pl (Marcin Kasperski)
Date: Fri Jun 20 03:22:47 2008
Subject: [Slony1-general] Re: Mixing 3 slony on 3 databases on the same
	servers
References: <485B7869.9010400@echo.fr>
Message-ID: <87lk10pfk9.fsf@softax.com.pl>

> I found that these transactions have been initiated by the slaves of
> db1. So transactionid of db1 have impact on subscription of slave of
> db2

Yes, it is so. It is even documented

> any advice ?

Restart components which hold transactions....


From scetbon at echo.fr  Fri Jun 20 07:32:42 2008
From: scetbon at echo.fr (Cyril SCETBON)
Date: Fri Jun 20 07:32:47 2008
Subject: [Slony1-general] Re: Mixing 3 slony on 3 databases on the same
	servers
In-Reply-To: <87lk10pfk9.fsf@softax.com.pl>
References: <485B7869.9010400@echo.fr> <87lk10pfk9.fsf@softax.com.pl>
Message-ID: <485BBF8A.5020001@echo.fr>



Marcin Kasperski wrote:
>> I found that these transactions have been initiated by the slaves of
>> db1. So transactionid of db1 have impact on subscription of slave of
>> db2
>>     
>
> Yes, it is so. It is even documented
>
>   
>> any advice ?
>>     
>
> Restart components which hold transactions....
>   
I can't cause the subscription last for 5 hours. I can't restart slon 
each subscribe set
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>   

-- 
Cyril SCETBON - Ing?nieur bases de donn?es
AUSY pour France T?l?com - OPF/PORTAILS/DOP/HEBEX

T?l : +33 (0)4 97 12 87 60
Jabber : cscetbon@jabber.org
France Telecom - Orange
790 Avenue du Docteur Maurice Donat 
B?timent Marco Polo C2 - Bureau 202
06250 Mougins
France

***********************************
Ce message et toutes les pieces jointes (ci-apres le 'message') sont
confidentiels et etablis a l'intention exclusive de ses destinataires.
Toute utilisation ou diffusion non autorisee est interdite.
Tout message electronique est susceptible d'alteration. Le Groupe France
Telecom decline toute responsabilite au titre de ce message s'il a ete
altere, deforme ou falsifie.
Si vous n'etes pas destinataire de ce message, merci de le detruire
immediatement et d'avertir l'expediteur.
***********************************
This message and any attachments (the 'message') are confidential and
intended solely for the addressees.
Any unauthorised use or dissemination is prohibited.
Messages are susceptible to alteration. France Telecom Group shall not be
liable for the message if altered, changed or falsified.
If you are not recipient of this message, please cancel it immediately and
inform the sender.
************************************

From scetbon at echo.fr  Fri Jun 20 07:35:04 2008
From: scetbon at echo.fr (Cyril SCETBON)
Date: Fri Jun 20 07:35:08 2008
Subject: [Slony1-general] Re: Mixing 3 slony on 3 databases on the same
	servers
In-Reply-To: <87lk10pfk9.fsf@softax.com.pl>
References: <485B7869.9010400@echo.fr> <87lk10pfk9.fsf@softax.com.pl>
Message-ID: <485BC018.4060900@echo.fr>



Marcin Kasperski wrote:
>> I found that these transactions have been initiated by the slaves of
>> db1. So transactionid of db1 have impact on subscription of slave of
>> db2
>>     
>
> Yes, it is so. It is even documented
>
>   
>> any advice ?
>>     
>
> Restart components which hold transactions....
>   
I can't cause I have to make the subscription last for 5 hours.
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>   

-- 
Cyril SCETBON - Ing?nieur bases de donn?es
AUSY pour France T?l?com - OPF/PORTAILS/DOP/HEBEX

T?l : +33 (0)4 97 12 87 60
Jabber : cscetbon@jabber.org
France Telecom - Orange
790 Avenue du Docteur Maurice Donat 
B?timent Marco Polo C2 - Bureau 202
06250 Mougins
France

***********************************
Ce message et toutes les pieces jointes (ci-apres le 'message') sont
confidentiels et etablis a l'intention exclusive de ses destinataires.
Toute utilisation ou diffusion non autorisee est interdite.
Tout message electronique est susceptible d'alteration. Le Groupe France
Telecom decline toute responsabilite au titre de ce message s'il a ete
altere, deforme ou falsifie.
Si vous n'etes pas destinataire de ce message, merci de le detruire
immediatement et d'avertir l'expediteur.
***********************************
This message and any attachments (the 'message') are confidential and
intended solely for the addressees.
Any unauthorised use or dissemination is prohibited.
Messages are susceptible to alteration. France Telecom Group shall not be
liable for the message if altered, changed or falsified.
If you are not recipient of this message, please cancel it immediately and
inform the sender.
************************************

From ajs at crankycanuck.ca  Fri Jun 20 09:04:46 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Fri Jun 20 09:05:11 2008
Subject: [Slony1-general] Re: Mixing 3 slony on 3 databases on the same
	servers
In-Reply-To: <485BC018.4060900@echo.fr>
References: <485B7869.9010400@echo.fr> <87lk10pfk9.fsf@softax.com.pl>
	<485BC018.4060900@echo.fr>
Message-ID: <20080620160446.GA22338@crankycanuck.ca>

On Fri, Jun 20, 2008 at 04:35:04PM +0200, Cyril SCETBON wrote:
> >  
> I can't cause I have to make the subscription last for 5 hours.

You either have to stop those other transactions, or you need to use more
than one postmaster.  Alas.

A
From szoradi at t-email.hu  Sat Jun 21 01:43:21 2008
From: szoradi at t-email.hu (=?ISO-8859-1?Q?Sz=F3r=E1di_Ervin?=)
Date: Sat Jun 21 01:43:23 2008
Subject: [Slony1-general] If I use Slony can I replicate 2 table but other
	way? 
In-Reply-To: <20080620190004.B0A36290EA1@main.slony.info>
References: <20080620190004.B0A36290EA1@main.slony.info>
Message-ID: <4847A70B.1080105@t-email.hu>

Hi,

I have a big question.
If I use Slony can I replicate 2 table but other way?
Example: 1. server item.table to ---> 2. server and other partner.table 
2. server to ---> 1. server.
The database name and Schema name is same. (example: Database)

Irvine
From szoradi at t-email.hu  Sat Jun 21 01:50:57 2008
From: szoradi at t-email.hu (=?ISO-8859-1?Q?Sz=F3r=E1di_Ervin?=)
Date: Sat Jun 21 01:51:32 2008
Subject: [Slony1-general] If I use Slony can I replicate 2 table but other
	way?
In-Reply-To: <20080620190004.B0A36290EA1@main.slony.info>
References: <20080620190004.B0A36290EA1@main.slony.info>
Message-ID: <485CC0F1.9070201@t-email.hu>

Hi,

I have a big question.
If I use Slony can I replicate 2 table but other way?
Example: 1. server item.table to ---> 2. server and other partner.table 
2. server to ---> 1. server.
The database name and Schema name is same. (example: Database)

Irvine
From wmoran at collaborativefusion.com  Sat Jun 21 03:17:44 2008
From: wmoran at collaborativefusion.com (Bill Moran)
Date: Sat Jun 21 03:18:16 2008
Subject: [Slony1-general] If I use Slony can I replicate 2 table but
	other way?
In-Reply-To: <4847A70B.1080105@t-email.hu>
References: <20080620190004.B0A36290EA1@main.slony.info>
	<4847A70B.1080105@t-email.hu>
Message-ID: <20080621061744.37727eba.wmoran@collaborativefusion.com>

"Sz?r?di Ervin" <szoradi@t-email.hu> wrote:
>
> Hi,
> 
> I have a big question.
> If I use Slony can I replicate 2 table but other way?
> Example: 1. server item.table to ---> 2. server and other partner.table 
> 2. server to ---> 1. server.
> The database name and Schema name is same. (example: Database)

Yes.  Slony is flexible enough to do this.

-- 
Bill Moran
Collaborative Fusion Inc.

wmoran@collaborativefusion.com
Phone: 412-422-3463x4023

****************************************************************
IMPORTANT: This message contains confidential information
and is intended only for the individual named. If the reader of
this message is not an intended recipient (or the individual
responsible for the delivery of this message to an intended
recipient), please be advised that any re-use, dissemination,
distribution or copying of this message is prohibited. Please
notify the sender immediately by e-mail if you have received
this e-mail by mistake and delete this e-mail from your system.
E-mail transmission cannot be guaranteed to be secure or
error-free as information could be intercepted, corrupted, lost,
destroyed, arrive late or incomplete, or contain viruses. The
sender therefore does not accept liability for any errors or
omissions in the contents of this message, which arise as a
result of e-mail transmission.
****************************************************************
From szoradi at t-email.hu  Sat Jun 21 04:46:54 2008
From: szoradi at t-email.hu (=?ISO-8859-1?Q?Sz=F3r=E1di_Ervin?=)
Date: Sat Jun 21 04:47:30 2008
Subject: [Slony1-general] If I use Slony can I replicate 2 table but other
	way?
In-Reply-To: <20080621061744.37727eba.wmoran@collaborativefusion.com>
References: <20080620190004.B0A36290EA1@main.slony.info>
	<4847A70B.1080105@t-email.hu>
	<20080621061744.37727eba.wmoran@collaborativefusion.com>
Message-ID: <485CEA2E.3050505@t-email.hu>

Bill Moran ?rta:
> "Sz?r?di Ervin" <szoradi@t-email.hu> wrote:
>   
>> Hi,
>>
>> I have a big question.
>> If I use Slony can I replicate 2 table but other way?
>> Example: 1. server item.table to ---> 2. server and other partner.table 
>> 2. server to ---> 1. server.
>> The database name and Schema name is same. (example: Database)
>>     
>
> Yes.  Slony is flexible enough to do this.
>
>   

How can I do it?

I use slony in windows platform.

I have to create other service or 1 Slony service can manage this 2 ways?
I think I have to create other replication set and configure it.
How can I configure the revers replication set?

What is the most important when a try to set the 2. (revers) replication 
set?




From scetbon at echo.fr  Sat Jun 21 14:24:37 2008
From: scetbon at echo.fr (Cyril SCETBON)
Date: Sat Jun 21 14:24:59 2008
Subject: [Slony1-general] Re: Mixing 3 slony on 3 databases on the same
	servers
In-Reply-To: <20080620160446.GA22338@crankycanuck.ca>
References: <485B7869.9010400@echo.fr>
	<87lk10pfk9.fsf@softax.com.pl>	<485BC018.4060900@echo.fr>
	<20080620160446.GA22338@crankycanuck.ca>
Message-ID: <485D7195.1060404@echo.fr>



Andrew Sullivan wrote:
> On Fri, Jun 20, 2008 at 04:35:04PM +0200, Cyril SCETBON wrote:
>   
>>>  
>>>       
>> I can't cause I have to make the subscription last for 5 hours.
>>     
>
> You either have to stop those other transactions, or you need to use more
> than one postmaster.  Alas.
>   
that's bad :-(

Don't you think Slony should check if an earlier transaction exists but 
also if relations locked (in that transaction) are concerned by the 
replication ?

Regards
-- 
Cyril SCETBON
From yi.zhao at alibaba-inc.com  Sun Jun 22 00:01:41 2008
From: yi.zhao at alibaba-inc.com (Yi Zhao)
Date: Sun Jun 22 00:00:15 2008
Subject: [Slony1-general] how to clean the cache after the switch of master?
In-Reply-To: <485D7195.1060404@echo.fr>
References: <485B7869.9010400@echo.fr> <87lk10pfk9.fsf@softax.com.pl>
	<485BC018.4060900@echo.fr> <20080620160446.GA22338@crankycanuck.ca>
	<485D7195.1060404@echo.fr>
Message-ID: <1214118101.4716.9.camel@localhost.localdomain>

hi, all:
when I do some insert after the switch of the master node in replication
cluster, slony alway give a notice as follows:
------------------
ERROR:  cache lookup failed for type 17140
CONTEXT:  SQL statement "INSERT INTO _replication.sl_log_1 (log_origin,
log_xid, log_tableid, log_actionseq, log_cmdtype, log_cmddata) VALUES
(1, $1, $2, nextval('_replication.sl_action_seq'), $3, $4);"
------------------
so, I must quit psql client, and relogin, it's works.

what's wrong with slony and what I should do except quit and relogin
psql client?

any help is appricate, thanks.

Regards.

From ajs at crankycanuck.ca  Mon Jun 23 05:57:16 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Mon Jun 23 05:57:42 2008
Subject: [Slony1-general] Re: Mixing 3 slony on 3 databases on the same
	servers
In-Reply-To: <485D7195.1060404@echo.fr>
References: <485B7869.9010400@echo.fr> <87lk10pfk9.fsf@softax.com.pl>
	<485BC018.4060900@echo.fr> <20080620160446.GA22338@crankycanuck.ca>
	<485D7195.1060404@echo.fr>
Message-ID: <20080623125716.GA5839@crankycanuck.ca>

On Sat, Jun 21, 2008 at 11:24:37PM +0200, Cyril SCETBON wrote:
> 
> Don't you think Slony should check if an earlier transaction exists but 
> also if relations locked (in that transaction) are concerned by the 
> replication ?

There's no way for Slony to know this.  I agree it would be nice, but it's
simply impossible.  This is a consequence of the way MVCC in Postgres works.

(I'm oversimplifying, note, because there are a few tricks in 8.3 and up
that have solved some of these problems.  But that won't help you.)

A
From ajs at crankycanuck.ca  Mon Jun 23 05:59:38 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Mon Jun 23 05:59:47 2008
Subject: [Slony1-general] how to clean the cache after the switch of
	master?
In-Reply-To: <1214118101.4716.9.camel@localhost.localdomain>
References: <485B7869.9010400@echo.fr> <87lk10pfk9.fsf@softax.com.pl>
	<485BC018.4060900@echo.fr> <20080620160446.GA22338@crankycanuck.ca>
	<485D7195.1060404@echo.fr>
	<1214118101.4716.9.camel@localhost.localdomain>
Message-ID: <20080623125938.GB5839@crankycanuck.ca>

Please start a new thread when changing the subject.

On Sun, Jun 22, 2008 at 03:01:41PM +0800, Yi Zhao wrote:
> hi, all:
> when I do some insert after the switch of the master node in replication
> cluster, slony alway give a notice as follows:
> ------------------
> ERROR:  cache lookup failed for type 17140
> CONTEXT:  SQL statement "INSERT INTO _replication.sl_log_1 (log_origin,
> log_xid, log_tableid, log_actionseq, log_cmdtype, log_cmddata) VALUES
> (1, $1, $2, nextval('_replication.sl_action_seq'), $3, $4);"
> ------------------
> so, I must quit psql client, and relogin, it's works.
> 
> what's wrong with slony and what I should do except quit and relogin
> psql client?

Nothing's wrong.  The underlying database has changed, and that means that
cached plans are no longer valid.  Switchover is not a transparent
operation.  You need to log out and reconnect.

A

From cbbrowne at ca.afilias.info  Mon Jun 23 07:22:09 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Mon Jun 23 07:22:15 2008
Subject: [Slony1-general] how to clean the cache after the switch of
	master?
In-Reply-To: <1214118101.4716.9.camel@localhost.localdomain> (Yi Zhao's
	message of "Sun, 22 Jun 2008 15:01:41 +0800")
References: <485B7869.9010400@echo.fr> <87lk10pfk9.fsf@softax.com.pl>
	<485BC018.4060900@echo.fr> <20080620160446.GA22338@crankycanuck.ca>
	<485D7195.1060404@echo.fr>
	<1214118101.4716.9.camel@localhost.localdomain>
Message-ID: <60ej6o44fi.fsf@dba2.int.libertyrms.com>

Yi Zhao <yi.zhao@alibaba-inc.com> writes:
> when I do some insert after the switch of the master node in replication
> cluster, slony alway give a notice as follows:
> ------------------
> ERROR:  cache lookup failed for type 17140
> CONTEXT:  SQL statement "INSERT INTO _replication.sl_log_1 (log_origin,
> log_xid, log_tableid, log_actionseq, log_cmdtype, log_cmddata) VALUES
> (1, $1, $2, nextval('_replication.sl_action_seq'), $3, $4);"
> ------------------
> so, I must quit psql client, and relogin, it's works.
>
> what's wrong with slony and what I should do except quit and relogin
> psql client?

Nothing is wrong with Slony-I; this is an issue with PostgreSQL where
the problem is that old cached query plans are still being run even
after the underlying object (e.g. - _replication.sl_log_1) has
changed.

As you have observed, this may be resolved by closing the connection
and opening a new one.

In PostgreSQL 8.3, this is supposed to be resolved; see the release
notes for:

   "Automatically re-plan cached queries when table definitions change
   or statistics are updated"
-- 
(reverse (concatenate 'string "ofni.sailifa.ac" "@" "enworbbc"))
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
From scetbon at echo.fr  Mon Jun 23 08:29:47 2008
From: scetbon at echo.fr (Cyril SCETBON)
Date: Mon Jun 23 08:29:56 2008
Subject: [Slony1-general] Re: Mixing 3 slony on 3 databases on the same
	servers
In-Reply-To: <20080623125716.GA5839@crankycanuck.ca>
References: <485B7869.9010400@echo.fr>
	<87lk10pfk9.fsf@softax.com.pl>	<485BC018.4060900@echo.fr>
	<20080620160446.GA22338@crankycanuck.ca>	<485D7195.1060404@echo.fr>
	<20080623125716.GA5839@crankycanuck.ca>
Message-ID: <485FC16B.6040807@echo.fr>



Andrew Sullivan wrote:
> On Sat, Jun 21, 2008 at 11:24:37PM +0200, Cyril SCETBON wrote:
>   
>> Don't you think Slony should check if an earlier transaction exists but 
>> also if relations locked (in that transaction) are concerned by the 
>> replication ?
>>     
>
> There's no way for Slony to know this.  I agree it would be nice, but it's
> simply impossible.  This is a consequence of the way MVCC in Postgres works.
>   
I was thinking that simply looking at pg_locks (known for hurting 
performance) would help.
> (I'm oversimplifying, note, because there are a few tricks in 8.3 and up
> that have solved some of these problems. 
ok
>  But that won't help you.)
>   
Damn :-(

Thanks
> A
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>   

-- 
Cyril SCETBON
From yi.zhao at alibaba-inc.com  Mon Jun 23 18:42:21 2008
From: yi.zhao at alibaba-inc.com (Yi Zhao)
Date: Mon Jun 23 18:40:49 2008
Subject: [Slony1-general] how to clean the cache after the switch of
	master?
In-Reply-To: <60ej6o44fi.fsf@dba2.int.libertyrms.com>
References: <485B7869.9010400@echo.fr> <87lk10pfk9.fsf@softax.com.pl>
	<485BC018.4060900@echo.fr> <20080620160446.GA22338@crankycanuck.ca>
	<485D7195.1060404@echo.fr>
	<1214118101.4716.9.camel@localhost.localdomain>
	<60ej6o44fi.fsf@dba2.int.libertyrms.com>
Message-ID: <1214271741.3164.1.camel@localhost.localdomain>

thank u very much,
Regards,

Yi
On Mon, 2008-06-23 at 10:22 -0400, Christopher Browne wrote:
> Yi Zhao <yi.zhao@alibaba-inc.com> writes:
> > when I do some insert after the switch of the master node in replication
> > cluster, slony alway give a notice as follows:
> > ------------------
> > ERROR:  cache lookup failed for type 17140
> > CONTEXT:  SQL statement "INSERT INTO _replication.sl_log_1 (log_origin,
> > log_xid, log_tableid, log_actionseq, log_cmdtype, log_cmddata) VALUES
> > (1, $1, $2, nextval('_replication.sl_action_seq'), $3, $4);"
> > ------------------
> > so, I must quit psql client, and relogin, it's works.
> >
> > what's wrong with slony and what I should do except quit and relogin
> > psql client?
> 
> Nothing is wrong with Slony-I; this is an issue with PostgreSQL where
> the problem is that old cached query plans are still being run even
> after the underlying object (e.g. - _replication.sl_log_1) has
> changed.
> 
> As you have observed, this may be resolved by closing the connection
> and opening a new one.
> 
> In PostgreSQL 8.3, this is supposed to be resolved; see the release
> notes for:
> 
>    "Automatically re-plan cached queries when table definitions change
>    or statistics are updated"

From ajs at crankycanuck.ca  Tue Jun 24 08:59:56 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Tue Jun 24 09:00:26 2008
Subject: [Slony1-general] Re: Mixing 3 slony on 3 databases on the same
	servers
In-Reply-To: <485FC16B.6040807@echo.fr>
References: <485B7869.9010400@echo.fr> <87lk10pfk9.fsf@softax.com.pl>
	<485BC018.4060900@echo.fr> <20080620160446.GA22338@crankycanuck.ca>
	<485D7195.1060404@echo.fr> <20080623125716.GA5839@crankycanuck.ca>
	<485FC16B.6040807@echo.fr>
Message-ID: <20080624155956.GA12039@crankycanuck.ca>

On Mon, Jun 23, 2008 at 05:29:47PM +0200, Cyril SCETBON wrote:
> >
> >There's no way for Slony to know this.  I agree it would be nice, but it's
> >simply impossible.  This is a consequence of the way MVCC in Postgres 
> >works.
> >  
> I was thinking that simply looking at pg_locks (known for hurting 
> performance) would help.

No.

Suppose T1 starts, and then sits there for a while.  It will be in pg_locks
(because every transaction has one entry), but you don't know what tables
it's going to touch by looking at that view.

Now, Slony comes along and wants to dump the database in a consistent way,
because it is setting up.  This is the consistent starting point _before
which_ Slony knows it can ignore transactions (because remember, when you
set up replication on a table, you created the triggers; but Slony has to
know what the starting point is in that list of transactions for any given
replica).  All that Slony can know, then, is whether there are transactions
prior to itself outstanding.  If the answer is yes, Slony has to wait until
those transactions commit, so it can be sure that nothing will happen that
(1) the dump can't see and (2) will never be included in any data sent to
the target replica.

That's sort of oversimplifying it, but it's the basic problem.

A

From scetbon at echo.fr  Tue Jun 24 11:53:17 2008
From: scetbon at echo.fr (Cyril SCETBON)
Date: Tue Jun 24 11:53:59 2008
Subject: [Slony1-general] Re: Mixing 3 slony on 3 databases on the same
	servers
In-Reply-To: <20080624155956.GA12039@crankycanuck.ca>
References: <485B7869.9010400@echo.fr>
	<87lk10pfk9.fsf@softax.com.pl>	<485BC018.4060900@echo.fr>
	<20080620160446.GA22338@crankycanuck.ca>	<485D7195.1060404@echo.fr>
	<20080623125716.GA5839@crankycanuck.ca>	<485FC16B.6040807@echo.fr>
	<20080624155956.GA12039@crankycanuck.ca>
Message-ID: <4861429D.3010500@echo.fr>



Andrew Sullivan wrote:
> On Mon, Jun 23, 2008 at 05:29:47PM +0200, Cyril SCETBON wrote:
>   
>>> There's no way for Slony to know this.  I agree it would be nice, but it's
>>> simply impossible.  This is a consequence of the way MVCC in Postgres 
>>> works.
>>>  
>>>       
>> I was thinking that simply looking at pg_locks (known for hurting 
>> performance) would help.
>>     
>
> No.
>
> Suppose T1 starts, and then sits there for a while.  It will be in pg_locks
> (because every transaction has one entry), but you don't know what tables
> it's going to touch by looking at that view.
>   
Ok I missed it
But you know in which database the transactions started. So the most 
basic thing is to say if there is no older connection on the database to 
replicate, slony can start , no ?
> Now, Slony comes along and wants to dump the database in a consistent way,
> because it is setting up.  This is the consistent starting point _before
> which_ Slony knows it can ignore transactions (because remember, when you
> set up replication on a table, you created the triggers; but Slony has to
> know what the starting point is in that list of transactions for any given
> replica).  All that Slony can know, then, is whether there are transactions
> prior to itself outstanding.  If the answer is yes, Slony has to wait until
> those transactions commit, so it can be sure that nothing will happen that
> (1) the dump can't see and (2) will never be included in any data sent to
> the target replica.
>   
yes
> That's sort of oversimplifying it, but it's the basic problem.
>   
ok
> A
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>   

-- 
Cyril SCETBON - Ing?nieur bases de donn?es
AUSY pour France T?l?com - OPF/PORTAILS/DOP/HEBEX

T?l : +33 (0)4 97 12 87 60
Jabber : cscetbon@jabber.org
France Telecom - Orange
790 Avenue du Docteur Maurice Donat 
B?timent Marco Polo C2 - Bureau 202
06250 Mougins
France

***********************************
Ce message et toutes les pieces jointes (ci-apres le 'message') sont
confidentiels et etablis a l'intention exclusive de ses destinataires.
Toute utilisation ou diffusion non autorisee est interdite.
Tout message electronique est susceptible d'alteration. Le Groupe France
Telecom decline toute responsabilite au titre de ce message s'il a ete
altere, deforme ou falsifie.
Si vous n'etes pas destinataire de ce message, merci de le detruire
immediatement et d'avertir l'expediteur.
***********************************
This message and any attachments (the 'message') are confidential and
intended solely for the addressees.
Any unauthorised use or dissemination is prohibited.
Messages are susceptible to alteration. France Telecom Group shall not be
liable for the message if altered, changed or falsified.
If you are not recipient of this message, please cancel it immediately and
inform the sender.
************************************

From troy at troywolf.com  Tue Jun 24 13:39:07 2008
From: troy at troywolf.com (Troy Wolf)
Date: Tue Jun 24 13:39:21 2008
Subject: [Slony1-general] Can a single table be in multiple replication sets?
Message-ID: <e0d7c3f50806241339r7cfc2ec1y35a8d784f23730a1@mail.gmail.com>

I have had what I'd consider to be the most common replication setup:
2 database servers, 1 origin, 1 subscriber, 1 replication set. Slony
replication has been working well for months. The situation is
changing. See Node 3 below.

Node 1 - the origin and main application database
Node 2 - the subscriber and main application backup database
Node 3 - a special database that only needs a subset of the main
application tables

I configured Node 2 to allow it to forward.

My thought was that I'd create a second replication set containing
only the subset of tables needed for Node 3 and use Node 2 as the
origin.

When I try to create the set, I get a PGRES_FATAL_ERROR:  duplicate
key violates unique constraint "sl_table_tab_reloid_key"

So it appears I can't have a single table in more than one replication
set? How do I accomplish what I want?
From ahodgson at simkin.ca  Tue Jun 24 14:00:42 2008
From: ahodgson at simkin.ca (Alan Hodgson)
Date: Tue Jun 24 14:01:00 2008
Subject: [Slony1-general] Can a single table be in multiple replication
	sets?
In-Reply-To: <e0d7c3f50806241339r7cfc2ec1y35a8d784f23730a1@mail.gmail.com>
References: <e0d7c3f50806241339r7cfc2ec1y35a8d784f23730a1@mail.gmail.com>
Message-ID: <200806241400.42207@hal.medialogik.com>

On Tuesday 24 June 2008, "Troy Wolf" <troy@troywolf.com> wrote:
> So it appears I can't have a single table in more than one replication
> set? How do I accomplish what I want?

Your subset of tables must be in a separate set. Node 2 subscribes to both 
sets, node 3 subscribes to only the new set.

-- 
Alan
From ajs at crankycanuck.ca  Tue Jun 24 14:46:26 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Tue Jun 24 14:46:57 2008
Subject: [Slony1-general] Re: Mixing 3 slony on 3 databases on the same
	servers
In-Reply-To: <4861429D.3010500@echo.fr>
References: <485B7869.9010400@echo.fr> <87lk10pfk9.fsf@softax.com.pl>
	<485BC018.4060900@echo.fr> <20080620160446.GA22338@crankycanuck.ca>
	<485D7195.1060404@echo.fr> <20080623125716.GA5839@crankycanuck.ca>
	<485FC16B.6040807@echo.fr> <20080624155956.GA12039@crankycanuck.ca>
	<4861429D.3010500@echo.fr>
Message-ID: <20080624214626.GD12039@crankycanuck.ca>

On Tue, Jun 24, 2008 at 08:53:17PM +0200, Cyril SCETBON wrote:

> But you know in which database the transactions started. So the most 
> basic thing is to say if there is no older connection on the database to 
> replicate, slony can start , no ?

I am led to believe that the problem is precisely that when you look up the
visibility information, you actually can't tell which database the
transaction started in.  This is well past my Latin, however, so you'll need
someone who understands the C code to explain this more completely.  (I
suspect that the people who really could answer this won't, because you
include that disclaimer at the bottom of the message.  Some people refuse to
reply to messages that have such disclaimers.)

A
From alex at bengler.no  Tue Jun 24 15:45:58 2008
From: alex at bengler.no (Alexander Staubo)
Date: Tue Jun 24 15:46:13 2008
Subject: [Slony1-general] Problem with sync/wait before merge set
Message-ID: <88daf38c0806241545j57c98ba6mde6bf9928f9541b5@mail.gmail.com>

I am having the same problem as this list member:

  http://www.mail-archive.com/slony1-general@gborg.postgresql.org/msg03382.html

I'm using Slony 1.2.14 on OS X (installed via MacPorts).

Here's a sample script:

  create set (id=10000, origin=1);
  set add table (set id=10000, origin=1, id=15, fully qualified
name='public.profiles');
  subscribe set (id=10000, provider=1, receiver=2, forward=yes);
  wait for event (origin=2, confirmed=1);
  sync (id=1);
  wait for event (origin=1, confirmed=2);
  merge set (id=1, add id=10000, origin=1);

This fails with:

<stdin>:4: PGRES_FATAL_ERROR select
"_origo_development_test".mergeSet(1, 10000);  - ERROR:  Slony-I: set
10000 has subscriptions in progress - cannot merge

There are no errors in the slon daemon logs.

Alexander.
From JanWieck at Yahoo.com  Tue Jun 24 18:47:25 2008
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Tue Jun 24 18:47:46 2008
Subject: [Slony1-general] Can a single table be in multiple replication
	sets?
In-Reply-To: <e0d7c3f50806241339r7cfc2ec1y35a8d784f23730a1@mail.gmail.com>
References: <e0d7c3f50806241339r7cfc2ec1y35a8d784f23730a1@mail.gmail.com>
Message-ID: <4861A3AD.60200@Yahoo.com>

On 6/24/2008 4:39 PM, Troy Wolf wrote:
> I have had what I'd consider to be the most common replication setup:
> 2 database servers, 1 origin, 1 subscriber, 1 replication set. Slony
> replication has been working well for months. The situation is
> changing. See Node 3 below.
> 
> Node 1 - the origin and main application database
> Node 2 - the subscriber and main application backup database
> Node 3 - a special database that only needs a subset of the main
> application tables
> 
> I configured Node 2 to allow it to forward.

That's a bit difficult at first (until you get the picture). Since every 
table can only be a member of one set, in order to have "shared" as well 
as "individual" subscription sets, one has to create more sets.

Let's say you have tables A, B and C. There are nodes X, Y and Z with X 
being the origin. Now you want A and C replicated to Y and B and C 
replicated to Z. So A goes into set 1, B into set 2, C into set 3 and 
then Y subscribes to 1+3 and Z subscribes 2+3.

There is a lot of special logic inside of slon that ensures that tables 
in different sets, that origin on the same node, are sync'd together. So 
this setup will not break integrity on the subscribers.


Jan

> 
> My thought was that I'd create a second replication set containing
> only the subset of tables needed for Node 3 and use Node 2 as the
> origin.
> 
> When I try to create the set, I get a PGRES_FATAL_ERROR:  duplicate
> key violates unique constraint "sl_table_tab_reloid_key"
> 
> So it appears I can't have a single table in more than one replication
> set? How do I accomplish what I want?
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin

From scetbon at echo.fr  Wed Jun 25 00:53:15 2008
From: scetbon at echo.fr (Cyril SCETBON)
Date: Wed Jun 25 00:53:42 2008
Subject: [Slony1-general] Re: Mixing 3 slony on 3 databases on the same
	servers
In-Reply-To: <20080624214626.GD12039@crankycanuck.ca>
References: <485B7869.9010400@echo.fr>
	<87lk10pfk9.fsf@softax.com.pl>	<485BC018.4060900@echo.fr>
	<20080620160446.GA22338@crankycanuck.ca>	<485D7195.1060404@echo.fr>
	<20080623125716.GA5839@crankycanuck.ca>	<485FC16B.6040807@echo.fr>
	<20080624155956.GA12039@crankycanuck.ca>	<4861429D.3010500@echo.fr>
	<20080624214626.GD12039@crankycanuck.ca>
Message-ID: <4861F96B.3090104@echo.fr>



Andrew Sullivan wrote:
> On Tue, Jun 24, 2008 at 08:53:17PM +0200, Cyril SCETBON wrote:
>
>   
>> But you know in which database the transactions started. So the most 
>> basic thing is to say if there is no older connection on the database to 
>> replicate, slony can start , no ?
>>     
>
> I am led to believe that the problem is precisely that when you look up the
> visibility information, you actually can't tell which database the
> transaction started in. 
ok
>  This is well past my Latin, however, so you'll need
> someone who understands the C code to explain this more completely.
ok
>   (I
> suspect that the people who really could answer this won't, because you
> include that disclaimer at the bottom of the message.  Some people refuse to
> reply to messages that have such disclaimers.)
>   

Thank you Andrew.
> A
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>   

From anjaliawake at gmail.com  Wed Jun 25 04:17:19 2008
From: anjaliawake at gmail.com (Anjali Himanshu)
Date: Wed Jun 25 04:17:49 2008
Subject: [Slony1-general] /usr/local/pgsql/lib/xxid.so: undefined symbol:
	elog_start
Message-ID: <9662b8750806250417o9a50b46k3ad925db1ccfba71@mail.gmail.com>

postgres@boss:~$ sh /usr/local/pgsql/data/cluster_setup.sh
<stdin>:7: PGRES_FATAL_ERROR load '$libdir/xxid';  - ERROR:  could not load
library "/usr/local/pgsql/lib/xxid.so": /usr/local/pgsql/lib/xxid.so:
undefined symbol: elog_start
<stdin>:7: Error: the extension for the xxid data type cannot be loaded in
database 'dbname=3Dcontactdb host=3Dlocalhost user=3Dpostgres'
<stdin>:7: ERROR: no admin conninfo for node 134598928
postgres@boss:~$
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080625/=
bfd1e783/attachment.htm
From troy at troywolf.com  Wed Jun 25 06:06:57 2008
From: troy at troywolf.com (Troy Wolf)
Date: Wed Jun 25 06:07:01 2008
Subject: [Slony1-general] Can a single table be in multiple replication
	sets?
In-Reply-To: <4861A3AD.60200@Yahoo.com>
References: <e0d7c3f50806241339r7cfc2ec1y35a8d784f23730a1@mail.gmail.com>
	<4861A3AD.60200@Yahoo.com>
Message-ID: <e0d7c3f50806250606s3f5b6923j42d882447b5c0b31@mail.gmail.com>

First, thank you for the prompt reply! From your explanation, I derive
that a table can only ever have one origin. Which on the surface seems
to make obvious sense except that I thought there was the idea that a
subscriber could act as an origin for other subscribers.

I also think I have a misunderstanding about what the 'forward' option
in the SUBSCRIBE statement means. From
http://slony.info/documentation/stmtsubscribeset.html:
    FORWARD = boolean
    Flag whether or not the new subscriber should store the log
information during replication to make it possible candidate for the
provider role for future nodes.

So back to your example: Let's say you have tables A, B and C. There
are nodes X, Y and Z with X being the origin. I want as little impact
on X as possible. Node Y needs to be kept up to date as close to real
time as possible. Node Z serves a special purpose and only needs a
subset of the tables, but replicating all the tables would be
acceptable. It is not as important that Z be kept in real-time sync.
The point is to replicate the data to Z with as little impact on X as
possible. This is why I thought I could use Y as the "origin" for Z. I
thought this was effectively using Y as a forwarder of X.

I'll take my lumps now!


On Tue, Jun 24, 2008 at 8:47 PM, Jan Wieck <JanWieck@yahoo.com> wrote:
>
> On 6/24/2008 4:39 PM, Troy Wolf wrote:
>>
>> I have had what I'd consider to be the most common replication setup:
>> 2 database servers, 1 origin, 1 subscriber, 1 replication set. Slony
>> replication has been working well for months. The situation is
>> changing. See Node 3 below.
>>
>> Node 1 - the origin and main application database
>> Node 2 - the subscriber and main application backup database
>> Node 3 - a special database that only needs a subset of the main
>> application tables
>>
>> I configured Node 2 to allow it to forward.
>
> That's a bit difficult at first (until you get the picture). Since every table can only be a member of one set, in order to have "shared" as well as "individual" subscription sets, one has to create more sets.
>
> Let's say you have tables A, B and C. There are nodes X, Y and Z with X being the origin. Now you want A and C replicated to Y and B and C replicated to Z. So A goes into set 1, B into set 2, C into set 3 and then Y subscribes to 1+3 and Z subscribes 2+3.
>
> There is a lot of special logic inside of slon that ensures that tables in different sets, that origin on the same node, are sync'd together. So this setup will not break integrity on the subscribers.
>
>
> Jan
>
>>
>> My thought was that I'd create a second replication set containing
>> only the subset of tables needed for Node 3 and use Node 2 as the
>> origin.
>>
>> When I try to create the set, I get a PGRES_FATAL_ERROR:  duplicate
>> key violates unique constraint "sl_table_tab_reloid_key"
>>
>> So it appears I can't have a single table in more than one replication
>> set? How do I accomplish what I want?
>> _______________________________________________
>> Slony1-general mailing list
>> Slony1-general@lists.slony.info
>> http://lists.slony.info/mailman/listinfo/slony1-general
>
>
> --
> Anyone who trades liberty for security deserves neither
> liberty nor security. -- Benjamin Franklin
>
From cbbrowne at ca.afilias.info  Wed Jun 25 07:33:36 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed Jun 25 07:33:44 2008
Subject: [Slony1-general] /usr/local/pgsql/lib/xxid.so: undefined symbol:
	elog_start
In-Reply-To: <9662b8750806250417o9a50b46k3ad925db1ccfba71@mail.gmail.com>
	(Anjali Himanshu's message of "Wed, 25 Jun 2008 16:47:19 +0530")
References: <9662b8750806250417o9a50b46k3ad925db1ccfba71@mail.gmail.com>
Message-ID: <60skv137pb.fsf@dba2.int.libertyrms.com>

"Anjali Himanshu" <anjaliawake@gmail.com> writes:
> postgres@boss:~$ sh /usr/local/pgsql/data/cluster
>
> _setup.sh
> <stdin>:7: PGRES_FATAL_ERROR load '$libdir/xxid';? - ERROR:? could not load library "/usr/local/pgsql/lib/xxid.so":
> /usr/local/pgsql/lib/xxid.so: undefined symbol: elog_start
> <stdin>:7: Error: the extension for the xxid data type cannot be loaded in database 'dbname=contactdb host=localhost user=postgres'
> <stdin>:7: ERROR: no admin conninfo for node 134598928
> postgres@boss:~$

This might result from an attempt to load a version of xxid.so
compiled for one version of PostgreSQL into an instance of another
version.

Problem reports that do not include details such as the version
numbers of both the Slony-I build and the PostgreSQL build tend to be
really difficult to interpret.
-- 
(format nil "~S@~S" "cbbrowne" "acm.org")
http://linuxfinances.info/info/lsf.html
If you have a procedure with ten parameters, you probably missed some.
-- Alan J. Perlis
From ajs at crankycanuck.ca  Wed Jun 25 07:39:13 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Wed Jun 25 07:39:37 2008
Subject: [Slony1-general] Problem with sync/wait before merge set
In-Reply-To: <88daf38c0806241545j57c98ba6mde6bf9928f9541b5@mail.gmail.com>
References: <88daf38c0806241545j57c98ba6mde6bf9928f9541b5@mail.gmail.com>
Message-ID: <20080625143913.GA22336@crankycanuck.ca>

On Wed, Jun 25, 2008 at 12:45:58AM +0200, Alexander Staubo wrote:
> This fails with:
> 
> <stdin>:4: PGRES_FATAL_ERROR select
> "_origo_development_test".mergeSet(1, 10000);  - ERROR:  Slony-I: set
> 10000 has subscriptions in progress - cannot merge
> 
> There are no errors in the slon daemon logs.

Could this be fixed by the change Jan just made:

http://lists.slony.info/pipermail/slony1-general/2008-June/008218.html

?
From anjaliawake at gmail.com  Wed Jun 25 07:40:50 2008
From: anjaliawake at gmail.com (Anjali Himanshu)
Date: Wed Jun 25 07:40:55 2008
Subject: Fwd: [Slony1-general] /usr/local/pgsql/lib/xxid.so: undefined symbol:
	elog_start
In-Reply-To: <9662b8750806250736x3b0ae4e4r266e2faa07b26f96@mail.gmail.com>
References: <9662b8750806250417o9a50b46k3ad925db1ccfba71@mail.gmail.com>
	<60skv137pb.fsf@dba2.int.libertyrms.com>
	<9662b8750806250736x3b0ae4e4r266e2faa07b26f96@mail.gmail.com>
Message-ID: <9662b8750806250740g51035ff3hccf5103474bc6490@mail.gmail.com>

SLony-1.0.5 and Postgres 7.4.21 are being used.


On Wed, Jun 25, 2008 at 8:03 PM, Christopher Browne <
cbbrowne@ca.afilias.info> wrote:

>  "Anjali Himanshu" <anjaliawake@gmail.com> writes:
> > postgres@boss:~$ sh /usr/local/pgsql/data/cluster
> >
> > _setup.sh
> > <stdin>:7: PGRES_FATAL_ERROR load '$libdir/xxid';  - ERROR:  could not
> load library "/usr/local/pgsql/lib/xxid.so":
> > /usr/local/pgsql/lib/xxid.so: undefined symbol: elog_start
> > <stdin>:7: Error: the extension for the xxid data type cannot be loaded
> in database 'dbname=3Dcontactdb host=3Dlocalhost user=3Dpostgres'
> > <stdin>:7: ERROR: no admin conninfo for node 134598928
> > postgres@boss:~$
>
> This might result from an attempt to load a version of xxid.so
> compiled for one version of PostgreSQL into an instance of another
> version.
>
> Problem reports that do not include details such as the version
> numbers of both the Slony-I build and the PostgreSQL build tend to be
> really difficult to interpret.
> --
> (format nil "~S@~S" "cbbrowne" "acm.org")
> http://linuxfinances.info/info/lsf.html
> If you have a procedure with ten parameters, you probably missed some.
> -- Alan J. Perlis
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080625/=
9f50adad/attachment.htm
From troy at troywolf.com  Wed Jun 25 08:40:14 2008
From: troy at troywolf.com (Troy Wolf)
Date: Wed Jun 25 08:40:20 2008
Subject: [Slony1-general] Re: Slony1-general Digest, Vol 16, Issue 27
In-Reply-To: <20080625143347.9D34A290D7B@main.slony.info>
References: <20080625143347.9D34A290D7B@main.slony.info>
Message-ID: <e0d7c3f50806250840g7d4a534dq1a551121c1c7b65f@mail.gmail.com>

Alexander Staubo,

DISCLAIMER: I am a relative newbie myself, so my advice is worth what you pay...
If, like the user in the link you provided, you are trying to
SUBSCRIBE, then use WAIT FOR EVENT to know when the SUBSCRIBE has
completed, then your problem is that this does not work. WAIT FOR
EVENT is unable to reliably know when the subscribe has completed, and
you cannot MERGE SET until the SUBSCRIBE completes.

You'll probably notice that if you wait long enough--usually a few
seconds depending on your data size--the MERGE will work.

If the MERGE never works and keeps telling you a SUBSCRIBE is in
progress, then check your logs to see if something is holding up the
subscribe--like older transactions or locks. Look for
removeWorkerThread warnings about "transactions earlier than XID %s
are still in progress". Then you may have to do some postgres dba
magic to find the process that owns that transaction and kill it. We
occasionally have this problem and sometimes it is because a user
started a transaction (BEGIN) and never completed the transaction
(COMMIT / ROLLBACK). The subscribe process needs to acquire locks on
all the tables--even tables that are not part of the replication set.

In our organization, we also have an application that does almost
constant writes to a table. We usually have to stop that application
to allow Slony blocking transactions to complete. This is despite the
fact that the table the application writes to is not in any
replication set.


> Date: Wed, 25 Jun 2008 00:45:58 +0200
> From: "Alexander Staubo" <alex@bengler.no>
> Subject: [Slony1-general] Problem with sync/wait before merge set
> To: slony1-general@lists.slony.info
> Message-ID:
>        <88daf38c0806241545j57c98ba6mde6bf9928f9541b5@mail.gmail.com>
> Content-Type: text/plain; charset=UTF-8
>
> I am having the same problem as this list member:
>
>  http://www.mail-archive.com/slony1-general@gborg.postgresql.org/msg03382.html
>
> I'm using Slony 1.2.14 on OS X (installed via MacPorts).
>
> Here's a sample script:
>
>  create set (id=10000, origin=1);
>  set add table (set id=10000, origin=1, id=15, fully qualified
> name='public.profiles');
>  subscribe set (id=10000, provider=1, receiver=2, forward=yes);
>  wait for event (origin=2, confirmed=1);
>  sync (id=1);
>  wait for event (origin=1, confirmed=2);
>  merge set (id=1, add id=10000, origin=1);
>
> This fails with:
>
> <stdin>:4: PGRES_FATAL_ERROR select
> "_origo_development_test".mergeSet(1, 10000);  - ERROR:  Slony-I: set
> 10000 has subscriptions in progress - cannot merge
>
> There are no errors in the slon daemon logs.
>
> Alexander.
From ahodgson at simkin.ca  Wed Jun 25 08:42:38 2008
From: ahodgson at simkin.ca (Alan Hodgson)
Date: Wed Jun 25 08:42:44 2008
Subject: [Slony1-general] Can a single table be in multiple replication
	sets?
In-Reply-To: <e0d7c3f50806250606s3f5b6923j42d882447b5c0b31@mail.gmail.com>
References: <e0d7c3f50806241339r7cfc2ec1y35a8d784f23730a1@mail.gmail.com>
	<4861A3AD.60200@Yahoo.com>
	<e0d7c3f50806250606s3f5b6923j42d882447b5c0b31@mail.gmail.com>
Message-ID: <200806250842.38827@hal.medialogik.com>

On Wednesday 25 June 2008, "Troy Wolf" <troy@troywolf.com> wrote:
> This is why I thought I could use Y as the "origin" for Z. I
> thought this was effectively using Y as a forwarder of X.

You absolutely can. The master table will still be on the originating node, 
but updates can flow through an intermediate node.

You still need to breakup the tables into multiple sets if you only want to 
do so for a subset of the tables, though.

-- 
Alan
From alex at bengler.no  Wed Jun 25 08:55:49 2008
From: alex at bengler.no (Alexander Staubo)
Date: Wed Jun 25 08:55:55 2008
Subject: [Slony1-general] Re: Slony1-general Digest, Vol 16, Issue 27
In-Reply-To: <e0d7c3f50806250840g7d4a534dq1a551121c1c7b65f@mail.gmail.com>
References: <20080625143347.9D34A290D7B@main.slony.info>
	<e0d7c3f50806250840g7d4a534dq1a551121c1c7b65f@mail.gmail.com>
Message-ID: <88daf38c0806250855x16d09893t2c4fceb37fe0fa4a@mail.gmail.com>

On Wed, Jun 25, 2008 at 5:40 PM, Troy Wolf <troy@troywolf.com> wrote:
> DISCLAIMER: I am a relative newbie myself, so my advice is worth what you pay...
> If, like the user in the link you provided, you are trying to
> SUBSCRIBE, then use WAIT FOR EVENT to know when the SUBSCRIBE has
> completed, then your problem is that this does not work. WAIT FOR
> EVENT is unable to reliably know when the subscribe has completed, and
> you cannot MERGE SET until the SUBSCRIBE completes.
>
> You'll probably notice that if you wait long enough--usually a few
> seconds depending on your data size--the MERGE will work.

Correct on both counts.

> If the MERGE never works and keeps telling you a SUBSCRIBE is in
> progress, then check your logs to see if something is holding up the
> subscribe--like older transactions or locks. Look for
> removeWorkerThread warnings about "transactions earlier than XID %s
> are still in progress". Then you may have to do some postgres dba
> magic to find the process that owns that transaction and kill it. We
> occasionally have this problem and sometimes it is because a user
> started a transaction (BEGIN) and never completed the transaction
> (COMMIT / ROLLBACK). The subscribe process needs to acquire locks on
> all the tables--even tables that are not part of the replication set.

Unfortunately, nothing is holding it up, as far as I can see, and
there are no warnings or errors in the log -- it's all debug. I am
running this on a development machine with no other clients, so there
is no chance that the wait is being sabotaged by concurrent writes.

Thanks for trying to help :-)

Alexander.
From alex at bengler.no  Wed Jun 25 08:56:48 2008
From: alex at bengler.no (Alexander Staubo)
Date: Wed Jun 25 08:56:54 2008
Subject: [Slony1-general] Problem with sync/wait before merge set
In-Reply-To: <20080625143913.GA22336@crankycanuck.ca>
References: <88daf38c0806241545j57c98ba6mde6bf9928f9541b5@mail.gmail.com>
	<20080625143913.GA22336@crankycanuck.ca>
Message-ID: <88daf38c0806250856p48a7da25u72a51616f7fa79b7@mail.gmail.com>

On Wed, Jun 25, 2008 at 4:39 PM, Andrew Sullivan <ajs@crankycanuck.ca> wrote:
> Could this be fixed by the change Jan just made:
>
> http://lists.slony.info/pipermail/slony1-general/2008-June/008218.html

Maybe. I'm not using cascaded replication, however, which is the use
case that Jan seems to be describing.

Alexander.
From troy at troywolf.com  Wed Jun 25 10:21:36 2008
From: troy at troywolf.com (Troy Wolf)
Date: Wed Jun 25 10:21:45 2008
Subject: [Slony1-general] Re: Slony1-general Digest, Vol 16, Issue 27
In-Reply-To: <88daf38c0806250855x16d09893t2c4fceb37fe0fa4a@mail.gmail.com>
References: <20080625143347.9D34A290D7B@main.slony.info>
	<e0d7c3f50806250840g7d4a534dq1a551121c1c7b65f@mail.gmail.com>
	<88daf38c0806250855x16d09893t2c4fceb37fe0fa4a@mail.gmail.com>
Message-ID: <e0d7c3f50806251021t510f8793h6d50fa52ec6acb36@mail.gmail.com>

>> If, like the user in the link you provided, you are trying to
>> SUBSCRIBE, then use WAIT FOR EVENT to know when the SUBSCRIBE has
>> completed, then your problem is that this does not work. WAIT FOR
>> EVENT is unable to reliably know when the subscribe has completed, and
>> you cannot MERGE SET until the SUBSCRIBE completes.
>>
>> You'll probably notice that if you wait long enough--usually a few
>> seconds depending on your data size--the MERGE will work.
>
> Correct on both counts.

Then you do not have a problem. What I tried to convey is that you
cannot do WAIT FOR EVENT. To my knowledge, all you can do with a
subscribe is manually wait for it to finish. You can do this by
watching the logs and noticing when the subscribe completes.
Alternatively, you can do what I do--I have a script that does the
subscribe then pauses waiting for me to hit ENTER to continue with the
MERGE. I simply wait 10 seconds or so then hit ENTER. If the MERGE
fails, I just assume the subscribe is still in process and go back to
the code that prompts the user to wait and hit ENTER when ready for
the MERGE. If I were to automate this script, I'd probably catch the
MERGE failure, go into a wait, then try again. Each time it fails, I'd
double my wait. Perhaps fail 10 times before giving up with a fatal
error.
From cbbrowne at ca.afilias.info  Wed Jun 25 10:59:12 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed Jun 25 10:59:23 2008
Subject: [Slony1-general] Re: Slony1-general Digest, Vol 16, Issue 27
In-Reply-To: <e0d7c3f50806251021t510f8793h6d50fa52ec6acb36@mail.gmail.com>
	(Troy Wolf's message of "Wed, 25 Jun 2008 12:21:36 -0500")
References: <20080625143347.9D34A290D7B@main.slony.info>
	<e0d7c3f50806250840g7d4a534dq1a551121c1c7b65f@mail.gmail.com>
	<88daf38c0806250855x16d09893t2c4fceb37fe0fa4a@mail.gmail.com>
	<e0d7c3f50806251021t510f8793h6d50fa52ec6acb36@mail.gmail.com>
Message-ID: <60bq1p2y6n.fsf@dba2.int.libertyrms.com>

"Troy Wolf" <troy@troywolf.com> writes:
>>> If, like the user in the link you provided, you are trying to
>>> SUBSCRIBE, then use WAIT FOR EVENT to know when the SUBSCRIBE has
>>> completed, then your problem is that this does not work. WAIT FOR
>>> EVENT is unable to reliably know when the subscribe has completed, and
>>> you cannot MERGE SET until the SUBSCRIBE completes.
>>>
>>> You'll probably notice that if you wait long enough--usually a few
>>> seconds depending on your data size--the MERGE will work.
>>
>> Correct on both counts.
>
> Then you do not have a problem. What I tried to convey is that you
> cannot do WAIT FOR EVENT. To my knowledge, all you can do with a
> subscribe is manually wait for it to finish. You can do this by
> watching the logs and noticing when the subscribe completes.
> Alternatively, you can do what I do--I have a script that does the
> subscribe then pauses waiting for me to hit ENTER to continue with the
> MERGE. I simply wait 10 seconds or so then hit ENTER. If the MERGE
> fails, I just assume the subscribe is still in process and go back to
> the code that prompts the user to wait and hit ENTER when ready for
> the MERGE. If I were to automate this script, I'd probably catch the
> MERGE failure, go into a wait, then try again. Each time it fails, I'd
> double my wait. Perhaps fail 10 times before giving up with a fatal
> error.

We're trying to get things to a point where you *could* use WAIT FOR
EVENT to validate that subscriptions have completed.  (At least, as
long as there wasn't some other failure; if there are 10 error
conditions, in a complex distributed system, we can't always hope to
catch them *all*!)

You can't expect to WAIT FOR EVENT against the SUBSCRIBE_SET event;
the process of subscription is spread across multiple events, and the
event whose confirmation would *directly* indicate completion of the
subscription isn't available within the slonik script.

However, there *is* a way to WAIT FOR EVENT that you should be able to
expect to work, and if it doesn't there's something buggy going on.

You submit the subscription, but THEN you submit a SYNC event.  *That*
event has got to get processed *after* the subscription work is done.
And you can wait on THAT.

Thus:
  
  include <preamble.slonik>;   # Pull in configuration
  # Get the subscription going
  subscribe set (id=1, provider=1, receiver=2, forward=yes);

  sync(id=1);    # Submits a SYNC event
  wait for event (origin=all, confirmed=2, wait on=1);   # Waits for that event to be confirmed on node #2

No doubt I should add this to the documentation :-).
-- 
(format nil "~S@~S" "cbbrowne" "linuxfinances.info")
http://cbbrowne.com/info/linux.html
Rules of the Evil Overlord #155. "If I know of any heroes in the land,
I will not under any circumstance kill their mentors, teachers, and/or
best friends."  <http://www.eviloverlord.com/>
From ajs at crankycanuck.ca  Wed Jun 25 11:17:21 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Wed Jun 25 11:17:36 2008
Subject: [Slony1-general] Re: Slony1-general Digest, Vol 16, Issue 27
In-Reply-To: <60bq1p2y6n.fsf@dba2.int.libertyrms.com>
References: <20080625143347.9D34A290D7B@main.slony.info>
	<e0d7c3f50806250840g7d4a534dq1a551121c1c7b65f@mail.gmail.com>
	<88daf38c0806250855x16d09893t2c4fceb37fe0fa4a@mail.gmail.com>
	<e0d7c3f50806251021t510f8793h6d50fa52ec6acb36@mail.gmail.com>
	<60bq1p2y6n.fsf@dba2.int.libertyrms.com>
Message-ID: <20080625181721.GB22336@crankycanuck.ca>

On Wed, Jun 25, 2008 at 01:59:12PM -0400, Christopher Browne wrote:
> 
> However, there *is* a way to WAIT FOR EVENT that you should be able to
> expect to work, and if it doesn't there's something buggy going on.

I thought that was in the original report, no?  That's why I asked whether
Jan's change helped.
 
> No doubt I should add this to the documentation :-).

I actually saw a discussion of this in the documentation somewhere recently,
so I think it's there, just not highlighted.

A
From troy at troywolf.com  Wed Jun 25 11:56:03 2008
From: troy at troywolf.com (Troy Wolf)
Date: Wed Jun 25 11:56:13 2008
Subject: [Slony1-general] Re: Slony1-general Digest, Vol 16, Issue 27
In-Reply-To: <60bq1p2y6n.fsf@dba2.int.libertyrms.com>
References: <20080625143347.9D34A290D7B@main.slony.info>
	<e0d7c3f50806250840g7d4a534dq1a551121c1c7b65f@mail.gmail.com>
	<88daf38c0806250855x16d09893t2c4fceb37fe0fa4a@mail.gmail.com>
	<e0d7c3f50806251021t510f8793h6d50fa52ec6acb36@mail.gmail.com>
	<60bq1p2y6n.fsf@dba2.int.libertyrms.com>
Message-ID: <e0d7c3f50806251156y2f791c87w875d476e5e96da48@mail.gmail.com>

On Wed, Jun 25, 2008 at 12:59 PM, Christopher Browne
<cbbrowne@ca.afilias.info> wrote:
> You submit the subscription, but THEN you submit a SYNC event.  *That*
> event has got to get processed *after* the subscription work is done.
> And you can wait on THAT.
>
> Thus:
>
>  include <preamble.slonik>;   # Pull in configuration
>  # Get the subscription going
>  subscribe set (id=1, provider=1, receiver=2, forward=yes);
>
>  sync(id=1);    # Submits a SYNC event
>  wait for event (origin=all, confirmed=2, wait on=1);   # Waits for that event to be confirmed on node #2
>
> No doubt I should add this to the documentation :-).

Simple and BRILLIANT!
From alex at bengler.no  Wed Jun 25 12:20:02 2008
From: alex at bengler.no (Alexander Staubo)
Date: Wed Jun 25 12:20:13 2008
Subject: [Slony1-general] Re: Slony1-general Digest, Vol 16, Issue 27
In-Reply-To: <60bq1p2y6n.fsf@dba2.int.libertyrms.com>
References: <20080625143347.9D34A290D7B@main.slony.info>
	<e0d7c3f50806250840g7d4a534dq1a551121c1c7b65f@mail.gmail.com>
	<88daf38c0806250855x16d09893t2c4fceb37fe0fa4a@mail.gmail.com>
	<e0d7c3f50806251021t510f8793h6d50fa52ec6acb36@mail.gmail.com>
	<60bq1p2y6n.fsf@dba2.int.libertyrms.com>
Message-ID: <88daf38c0806251220h1ccf2419jecd1f239229db29a@mail.gmail.com>

On Wed, Jun 25, 2008 at 7:59 PM, Christopher Browne
<cbbrowne@ca.afilias.info> wrote:
> However, there *is* a way to WAIT FOR EVENT that you should be able to
> expect to work, and if it doesn't there's something buggy going on.
>
> You submit the subscription, but THEN you submit a SYNC event.  *That*
> event has got to get processed *after* the subscription work is done.
> And you can wait on THAT.

Are you gusy even reading my original message? I am doing exactly this
-- I do a "wait for event", then a "sync", then a wait again --
exactly as described by the Slony 1.2 documentation:

  http://www.slony.info/documentation/addthings.html

...from which I quote:

> If you wish to know, deterministically, that each subscription has completed,
> you'll need to submit the following sort of slonik script for each subscription:
>
> SUBSCRIBE SET (ID=1, PROVIDER=1, RECEIVER=2);
> WAIT FOR EVENT (ORIGIN=2, CONFIRMED = 1);
> SYNC(ID = 1);
> WAIT FOR EVENT (ORIGIN=1, CONFIRMED=2);

The problem is that I cannot get this to *work*.

As for Troy's suggestion that manually check when the subscription is
complete, that's not an acceptable solution. My goal is to simplify
the deployment of Slony-based databases, not complicate it; the code I
am writing is part of a deployment framework that needs to be
automated, so I am completely dependent on being able to interact with
Slony in a stable, predictable fashion.

Instead of issueing a "wait for event", I have tried looking at the
sl_subscribe table on the slave node and seeing if it has an entry
with sub_active set to true. Unfortunately, this entry seems to be
present even before the subscription has been enabled.

Alexander.
From troy at troywolf.com  Wed Jun 25 12:23:55 2008
From: troy at troywolf.com (Troy Wolf)
Date: Wed Jun 25 12:24:07 2008
Subject: [Slony1-general] Re: Slony1-general Digest, Vol 16, Issue 27
In-Reply-To: <88daf38c0806251220h1ccf2419jecd1f239229db29a@mail.gmail.com>
References: <20080625143347.9D34A290D7B@main.slony.info>
	<e0d7c3f50806250840g7d4a534dq1a551121c1c7b65f@mail.gmail.com>
	<88daf38c0806250855x16d09893t2c4fceb37fe0fa4a@mail.gmail.com>
	<e0d7c3f50806251021t510f8793h6d50fa52ec6acb36@mail.gmail.com>
	<60bq1p2y6n.fsf@dba2.int.libertyrms.com>
	<88daf38c0806251220h1ccf2419jecd1f239229db29a@mail.gmail.com>
Message-ID: <e0d7c3f50806251223u52d7a391jdccb9270ec9f2d74@mail.gmail.com>

On Wed, Jun 25, 2008 at 2:20 PM, Alexander Staubo <alex@bengler.no> wrote:
> Are you gusy even reading my original message? I am doing exactly this
> -- I do a "wait for event", then a "sync", then a wait again --
> exactly as described by the Slony 1.2 documentation:
>
>  http://www.slony.info/documentation/addthings.html
>
> ...from which I quote:
>
>> If you wish to know, deterministically, that each subscription has completed,
>> you'll need to submit the following sort of slonik script for each subscription:
>>
>> SUBSCRIBE SET (ID=1, PROVIDER=1, RECEIVER=2);
>> WAIT FOR EVENT (ORIGIN=2, CONFIRMED = 1);
>> SYNC(ID = 1);
>> WAIT FOR EVENT (ORIGIN=1, CONFIRMED=2);
>
> The problem is that I cannot get this to *work*.

My apologies, I did read your code, but this was before I knew about
the little SYNC trick. I replied based on what works for me. The
behavior you described is what I expected...yeah, you get to manually
wait then do the MERGE. However, it sounds like the SYNC trick should
work, so I'm changing my shell scripts right now to implement this.
I'll let you know if it works for me or not. Sorry for the confusion.
I'm trying to give back and not only ask questions! :)
From ajs at crankycanuck.ca  Wed Jun 25 12:57:43 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Wed Jun 25 12:58:00 2008
Subject: [Slony1-general] Re: Slony1-general Digest, Vol 16, Issue 27
In-Reply-To: <88daf38c0806251220h1ccf2419jecd1f239229db29a@mail.gmail.com>
References: <20080625143347.9D34A290D7B@main.slony.info>
	<e0d7c3f50806250840g7d4a534dq1a551121c1c7b65f@mail.gmail.com>
	<88daf38c0806250855x16d09893t2c4fceb37fe0fa4a@mail.gmail.com>
	<e0d7c3f50806251021t510f8793h6d50fa52ec6acb36@mail.gmail.com>
	<60bq1p2y6n.fsf@dba2.int.libertyrms.com>
	<88daf38c0806251220h1ccf2419jecd1f239229db29a@mail.gmail.com>
Message-ID: <20080625195743.GD22336@crankycanuck.ca>

On Wed, Jun 25, 2008 at 09:20:02PM +0200, Alexander Staubo wrote:
> 
> Are you gusy even reading my original message? I am doing exactly this
> -- I do a "wait for event", then a "sync", then a wait again --
> exactly as described by the Slony 1.2 documentation:

See my other message; that's what I thought.  This is why I think _maybe_
Jan's recent fix could apply.  Have you tried getting the stable HEAD?  If
it changes things, then we have identified the bug.  (I'm especially asking
because it appears this bug has been there for some time, and previous cases
that may have been dismissed as operator error should perhaps have been
treated as a bug report instead.)

A

From troy at troywolf.com  Wed Jun 25 14:28:08 2008
From: troy at troywolf.com (Troy Wolf)
Date: Wed Jun 25 14:28:22 2008
Subject: [Slony1-general] Adding a third node as subscriber to second node
	who is subscriber of first node?
Message-ID: <e0d7c3f50806251428s1b4a76e5m4ada6aa045000321@mail.gmail.com>

Nodes: 1,2,3
Sets: 1

Node 1 is origin.

Node 2 is subscribed to set 1 using:
    subscribe set (id=1, provider=1, receiver=2, forward=yes);

This works fine. Now I want to add Node 3 into the cluster and
subscribe it to set 1 using node 2 as the provider. I tried to do
this:

    subscribe set (id=1, provider=2, receiver=3, forward=yes);

I see in node 3's slon log that it is continuously attempting to copy
all the tables in the set, but it fails with this error:
2008-06-25 17:05:10 EDT ERROR  remoteWorkerThread_2: "select
"_slony".subscribeSet_int(1, 2, 3, 't'); notify "_slony_Event"; notify
"_slony_Confirm"; insert into "_slony".sl_event     (ev_origin,
ev_seqno, ev_timestamp,      ev_minxid, ev_maxxid, ev_xip, ev_type ,
ev_data1, ev_data2, ev_data3, ev_data4    ) values ('2', '292975',
'2008-06-25 16:58:12.379701', '98189397', '98199106',
'''98189397'',''98199029''', 'SUBSCRIBE_SET', '1', '2', '3', 't');
insert into "_slony".sl_confirm      (con_origin, con_received,
con_seqno, con_timestamp)    values (2, 3, '292975', now()); commit
transaction;" PGRES_FATAL_ERROR ERROR:  Slony-I: subscribeSet_int():
set 1 is not active, cannot change provider

I am confused by both parts of this error. That is, set 1 is in fact
"active". Node 2 is being kept in sync with Node 1 using set 1.
"Cannot change provider" worried me that I somehow was messing with
Node 2's subscription to set 1. The query below shows that set 1 is in
fact active.

    select
    	'Set ' || sub_set as \"Set\",
    	'Node ' || sub_provider as \"Is Provided By\",
    	'Node ' || sub_receiver as \"Is Received By\",
    sub_forward as \"Is Forwardable\",
    (select case when sub_active then ' Is Active ' else 'Is Not
Active' end) as \"Is Active\"
    from sl_subscribe;

Returns:
  Set  | Is Provided By | Is Received By | Is Forwardable |  Is Active
-------+----------------+----------------+----------------+-------------
 Set 1 | Node 1         | Node 2         | t              |  Is Active
From dane at greatschools.net  Wed Jun 25 14:43:29 2008
From: dane at greatschools.net (Dane Miller)
Date: Wed Jun 25 14:44:09 2008
Subject: [Slony1-general] tracking replication lag with a transaction_id
	table (was: order of replication)
In-Reply-To: <1213724596.23894.18.camel@danedesk.greatschools.net>
References: <1213309614.20093.86.camel@danedesk.greatschools.net>
	<20080613134012.GB28292@crankycanuck.ca>
	<1213724596.23894.18.camel@danedesk.greatschools.net>
Message-ID: <1214430209.9788.68.camel@danedesk.greatschools.net>

Andrew Sullivan wrote:
> Dane Miller wrote:
> > Consider the below example. Does Slony guarantee that the updated
> > sequence will always appear after (or concurrently with) the
> > result of the I/U/D statements on subscriber nodes?
> 
> Not necessarily.  Slony sets the sequence on the target to the value
> of the sequence at the time of the sync, because there isn't any
> other way to look at the sequence value.  The idea is that it's ok
> for a sequence to be _ahead_ of the rest of the database, because
> this is consistent with the semantics of sequences in an
> unreplicated database (they always advance, so they're
> never-go-backwards series that possibly have gaps).  
> 
> If you want this, you could probably do it using a table that is
> replicated and that gets updated with currval() using a trigger or
> something. 

I'd like to solicit advice on an efficient way to update a column with
currval() that doesn't incur lots of dead tuple bloat.  In a separate
post Bill Moran made it clear I shouldn't truncate replicated tables --
which makes perfect sense, thanks for the clue bat Bill.  But I *think* I
also want to avoid having to constantly vacuum this table during
frequent UPDATEs (see #3 below for why this is couched in 'I think').

This question might be better posed on one of the postgresql-* lists, so
please point me away if necessary.  However, I'm hoping this is relevant
insofar as it relates to handling replication lag.

Here's the table definition for reference:

CREATE TABLE transaction_log
( 
  tid integer default nextval('transaction_id'::regclass) not null
);


So far I've thought of three ways to store the latest sequence value...

1) Append-only into 1 table
  INSERT into transaction_log default values;
  -- schedule periodic DELETE && VACUUM jobs to clear old tid rows

2) Append-only into 2 tables
  -- same as 1) but alternating which table to insert into based on a
datetime range.  E.g. use transaction_log1 on odd days and
transaction_log2 on even days.  Similar to Slony's use of sl_log{1,2}
  -- schedule table maintenance while alternate table is in use.

3) use UPDATE statements 
  UPDATE transcation_log set tid=DEFAULT;
  -- autovacuum will clean up dead tuples as needed
  -- Heap-Only Tuples (Postgresql 8.3) reclaim space and reduce need to
vacuum




-- 
Dane Miller
Systems Administrator
Greatschools, Inc
http://www.greatschools.net

From anjaliawake at gmail.com  Thu Jun 26 00:25:19 2008
From: anjaliawake at gmail.com (Anjali Himanshu)
Date: Thu Jun 26 00:25:47 2008
Subject: [Slony1-general] Missing yacc parser.y parser.c
Message-ID: <9662b8750806260025g7febff5erbfeda2ca331bfdb8@mail.gmail.com>

While trying to install Slony 1.2.14 and postgres 7.4.21. I am getting the
folowing errors.

Missing yacc parser.y parser.c
make[2]: *** [parser.c] Error 1
make[2]: Leaving directory
`/root/Desktop/Downloads/slony1-1.2.14/src/slony_logshipper'
make[1]: *** [install] Error 2
make[1]: Leaving directory `/root/Desktop/Downloads/slony1-1.2.14/src'
make: *** [install] Error 2

I tried installing bison. But still, I am getting the same error.

On Thu, Jun 26, 2008 at 5:11 AM, Anjali Himanshu <anjaliawake@gmail.com>
wrote:

> Thanks, I have downloaded Slony v 1.2.14. I will also download Postgres
> 8.xx and will try to replicate the database. Is there any way to open and
> edit '.so' files ?
>
>
> On Wed, Jun 25, 2008 at 9:52 PM, Christopher Browne <
> cbbrowne@ca.afilias.info> wrote:
>
>> "Anjali Himanshu" <anjaliawake@gmail.com> writes:
>> > Today we tried downloading slony version 2.xx. But, we were unable to
>> dowmload.
>>
>> There is no "version 2.xx"
>>
>> The latest version may be found at the following URL:
>>
>> <http://slony.info/downloads/1.2/source/>
>> --
>> output =3D ("cbbrowne" "@" "acm.org")
>> http://linuxfinances.info/info/emacs.html
>> God is a comedian, playing to an audience too afraid to laugh.
>> -- Voltaire
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080626/=
f93a91b7/attachment.htm
From yi.zhao at alibaba-inc.com  Thu Jun 26 00:52:28 2008
From: yi.zhao at alibaba-inc.com (Yi Zhao)
Date: Thu Jun 26 00:51:00 2008
Subject: [Slony1-general] Missing yacc parser.y parser.c
In-Reply-To: <9662b8750806260025g7febff5erbfeda2ca331bfdb8@mail.gmail.com>
References: <9662b8750806260025g7febff5erbfeda2ca331bfdb8@mail.gmail.com>
Message-ID: <1214466748.3176.2.camel@localhost.localdomain>

be sure u have installed bison and flex

Regards,
Yi
On Thu, 2008-06-26 at 12:55 +0530, Anjali Himanshu wrote:
> While trying to install Slony 1.2.14 and postgres 7.4.21. I am getting
> the folowing errors.
> 
> Missing yacc parser.y parser.c
> make[2]: *** [parser.c] Error 1
> make[2]: Leaving directory
> `/root/Desktop/Downloads/slony1-1.2.14/src/slony_logshipper'
> make[1]: *** [install] Error 2
> make[1]: Leaving directory `/root/Desktop/Downloads/slony1-1.2.14/src'
> make: *** [install] Error 2
> 
> I tried installing bison. But still, I am getting the same error.
> 
> On Thu, Jun 26, 2008 at 5:11 AM, Anjali Himanshu
> <anjaliawake@gmail.com> wrote:
>         Thanks, I have downloaded Slony v 1.2.14. I will also download
>         Postgres 8.xx and will try to replicate the database. Is there
>         any way to open and edit '.so' files ?
>         
>         
>         
>         On Wed, Jun 25, 2008 at 9:52 PM, Christopher Browne
>         <cbbrowne@ca.afilias.info> wrote:
>                 "Anjali Himanshu" <anjaliawake@gmail.com> writes:
>                 
>                 > Today we tried downloading slony version 2.xx. But,
>                 we were unable to dowmload.
>                 
>                 
>                 There is no "version 2.xx"
>                 
>                 The latest version may be found at the following URL:
>                 
>                 <http://slony.info/downloads/1.2/source/>
>                 --
>                 output = ("cbbrowne" "@" "acm.org")
>                 http://linuxfinances.info/info/emacs.html
>                 God is a comedian, playing to an audience too afraid
>                 to laugh.
>                 -- Voltaire
>         
>         
> 
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general

From anjaliawake at gmail.com  Thu Jun 26 00:53:54 2008
From: anjaliawake at gmail.com (Anjali Himanshu)
Date: Thu Jun 26 00:54:21 2008
Subject: [Slony1-general] Missing yacc parser.y parser.c
In-Reply-To: <9662b8750806260051r7d635f97scd56b4bb43dea51f@mail.gmail.com>
References: <9662b8750806260025g7febff5erbfeda2ca331bfdb8@mail.gmail.com>
	<1214466748.3176.2.camel@localhost.localdomain>
	<9662b8750806260051r7d635f97scd56b4bb43dea51f@mail.gmail.com>
Message-ID: <9662b8750806260053w23d445fdy39f6b4e847d3145c@mail.gmail.com>

Now, I have installed flex too. But, nothing is happening.

On Thu, Jun 26, 2008 at 1:21 PM, Anjali Himanshu <anjaliawake@gmail.com>
wrote:

> Yes, I have installed bison.
>
>
> On Thu, Jun 26, 2008 at 1:22 PM, Yi Zhao <yi.zhao@alibaba-inc.com> wrote:
>
>> be sure u have installed bison and flex
>>
>> Regards,
>> Yi
>> On Thu, 2008-06-26 at 12:55 +0530, Anjali Himanshu wrote:
>> > While trying to install Slony 1.2.14 and postgres 7.4.21. I am getting
>> > the folowing errors.
>> >
>> > Missing yacc parser.y parser.c
>> > make[2]: *** [parser.c] Error 1
>> > make[2]: Leaving directory
>> > `/root/Desktop/Downloads/slony1-1.2.14/src/slony_logshipper'
>> > make[1]: *** [install] Error 2
>> > make[1]: Leaving directory `/root/Desktop/Downloads/slony1-1.2.14/src'
>> > make: *** [install] Error 2
>> >
>> > I tried installing bison. But still, I am getting the same error.
>> >
>> > On Thu, Jun 26, 2008 at 5:11 AM, Anjali Himanshu
>> > <anjaliawake@gmail.com> wrote:
>> >         Thanks, I have downloaded Slony v 1.2.14. I will also download
>> >         Postgres 8.xx and will try to replicate the database. Is there
>> >         any way to open and edit '.so' files ?
>> >
>> >
>> >
>> >         On Wed, Jun 25, 2008 at 9:52 PM, Christopher Browne
>> >         <cbbrowne@ca.afilias.info> wrote:
>> >                 "Anjali Himanshu" <anjaliawake@gmail.com> writes:
>> >
>> >                 > Today we tried downloading slony version 2.xx. But,
>> >                 we were unable to dowmload.
>> >
>> >
>> >                 There is no "version 2.xx"
>> >
>> >                 The latest version may be found at the following URL:
>> >
>> >                 <http://slony.info/downloads/1.2/source/>
>> >                 --
>> >                 output =3D ("cbbrowne" "@" "acm.org")
>> >                 http://linuxfinances.info/info/emacs.html
>> >                 God is a comedian, playing to an audience too afraid
>> >                 to laugh.
>> >                 -- Voltaire
>> >
>> >
>> >
>> > _______________________________________________
>> > Slony1-general mailing list
>> > Slony1-general@lists.slony.info
>> > http://lists.slony.info/mailman/listinfo/slony1-general
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080626/=
2a9d8ef9/attachment.htm
From anjaliawake at gmail.com  Thu Jun 26 02:38:33 2008
From: anjaliawake at gmail.com (Anjali Himanshu)
Date: Thu Jun 26 02:39:03 2008
Subject: [Slony1-general] Missing yacc parser.y parser.c
In-Reply-To: <9662b8750806260126w3b563fb5see12f62a782d8b5b@mail.gmail.com>
References: <9662b8750806260025g7febff5erbfeda2ca331bfdb8@mail.gmail.com>
	<1214466748.3176.2.camel@localhost.localdomain>
	<9662b8750806260051r7d635f97scd56b4bb43dea51f@mail.gmail.com>
	<1214468732.3176.4.camel@localhost.localdomain>
	<9662b8750806260126w3b563fb5see12f62a782d8b5b@mail.gmail.com>
Message-ID: <9662b8750806260238j652fb43ay76f6faf2de91d902@mail.gmail.com>

I recompiled Slony. Then, tried reinstalling it. That error went.

On Thu, Jun 26, 2008 at 1:56 PM, Anjali Himanshu <anjaliawake@gmail.com>
wrote:

> Yes, I installed flex too...
>
>
> On Thu, Jun 26, 2008 at 1:55 PM, Yi Zhao <yi.zhao@alibaba-inc.com> wrote:
>
>> do you have install flex?
>>
>> On Thu, 2008-06-26 at 13:21 +0530, Anjali Himanshu wrote:
>> > Yes, I have installed bison.
>> >
>> > On Thu, Jun 26, 2008 at 1:22 PM, Yi Zhao <yi.zhao@alibaba-inc.com>
>> > wrote:
>> >         be sure u have installed bison and flex
>> >
>> >         Regards,
>> >         Yi
>> >
>> >         On Thu, 2008-06-26 at 12:55 +0530, Anjali Himanshu wrote:
>> >         > While trying to install Slony 1.2.14 and postgres 7.4.21. I
>> >         am getting
>> >         > the folowing errors.
>> >         >
>> >         > Missing yacc parser.y parser.c
>> >         > make[2]: *** [parser.c] Error 1
>> >         > make[2]: Leaving directory
>> >         > `/root/Desktop/Downloads/slony1-1.2.14/src/slony_logshipper'
>> >         > make[1]: *** [install] Error 2
>> >         > make[1]: Leaving directory
>> >         `/root/Desktop/Downloads/slony1-1.2.14/src'
>> >         > make: *** [install] Error 2
>> >         >
>> >         > I tried installing bison. But still, I am getting the same
>> >         error.
>> >         >
>> >         > On Thu, Jun 26, 2008 at 5:11 AM, Anjali Himanshu
>> >         > <anjaliawake@gmail.com> wrote:
>> >         >         Thanks, I have downloaded Slony v 1.2.14. I will
>> >         also download
>> >         >         Postgres 8.xx and will try to replicate the
>> >         database. Is there
>> >         >         any way to open and edit '.so' files ?
>> >         >
>> >         >
>> >         >
>> >         >         On Wed, Jun 25, 2008 at 9:52 PM, Christopher Browne
>> >         >         <cbbrowne@ca.afilias.info> wrote:
>> >         >                 "Anjali Himanshu" <anjaliawake@gmail.com>
>> >         writes:
>> >         >
>> >         >                 > Today we tried downloading slony version
>> >         2.xx. But,
>> >         >                 we were unable to dowmload.
>> >         >
>> >         >
>> >         >                 There is no "version 2.xx"
>> >         >
>> >         >                 The latest version may be found at the
>> >         following URL:
>> >         >
>> >         >                 <http://slony.info/downloads/1.2/source/>
>> >         >                 --
>> >         >                 output =3D ("cbbrowne" "@" "acm.org")
>> >         >                 http://linuxfinances.info/info/emacs.html
>> >         >                 God is a comedian, playing to an audience
>> >         too afraid
>> >         >                 to laugh.
>> >         >                 -- Voltaire
>> >         >
>> >         >
>> >         >
>> >
>> >         > _______________________________________________
>> >         > Slony1-general mailing list
>> >         > Slony1-general@lists.slony.info
>> >         > http://lists.slony.info/mailman/listinfo/slony1-general
>> >
>> >
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080626/=
174f4e65/attachment.htm
From anjaliawake at gmail.com  Thu Jun 26 02:44:42 2008
From: anjaliawake at gmail.com (Anjali Himanshu)
Date: Thu Jun 26 02:45:12 2008
Subject: [Slony1-general] Missing yacc parser.y parser.c
In-Reply-To: <9662b8750806260238j652fb43ay76f6faf2de91d902@mail.gmail.com>
References: <9662b8750806260025g7febff5erbfeda2ca331bfdb8@mail.gmail.com>
	<1214466748.3176.2.camel@localhost.localdomain>
	<9662b8750806260051r7d635f97scd56b4bb43dea51f@mail.gmail.com>
	<1214468732.3176.4.camel@localhost.localdomain>
	<9662b8750806260126w3b563fb5see12f62a782d8b5b@mail.gmail.com>
	<9662b8750806260238j652fb43ay76f6faf2de91d902@mail.gmail.com>
Message-ID: <9662b8750806260244p4e4a61fdu1eaa12edf0dd130c@mail.gmail.com>

Can you tell me, how to uninstall Slony on linux.

i am trying to run the shell script for replication. I am getting the error:

<stdin>:7: loading of file /usr/share/slony1/slony1_funcs.sql:
PGRES_FATAL_ERROR ERROR:  Slonik version: 1.2.9 !=3D Slony-I version in PG
build 1.2.14
ERROR:  Slonik version: 1.2.9 !=3D Slony-I version in PG build 1.2.14
<stdin>:7: ERROR: no admin conninfo for node 134598928


On Thu, Jun 26, 2008 at 3:08 PM, Anjali Himanshu <anjaliawake@gmail.com>
wrote:

> I recompiled Slony. Then, tried reinstalling it. That error went.
>
>
> On Thu, Jun 26, 2008 at 1:56 PM, Anjali Himanshu <anjaliawake@gmail.com>
> wrote:
>
>> Yes, I installed flex too...
>>
>>
>> On Thu, Jun 26, 2008 at 1:55 PM, Yi Zhao <yi.zhao@alibaba-inc.com> wrote:
>>
>>> do you have install flex?
>>>
>>> On Thu, 2008-06-26 at 13:21 +0530, Anjali Himanshu wrote:
>>> > Yes, I have installed bison.
>>> >
>>> > On Thu, Jun 26, 2008 at 1:22 PM, Yi Zhao <yi.zhao@alibaba-inc.com>
>>> > wrote:
>>> >         be sure u have installed bison and flex
>>> >
>>> >         Regards,
>>> >         Yi
>>> >
>>> >         On Thu, 2008-06-26 at 12:55 +0530, Anjali Himanshu wrote:
>>> >         > While trying to install Slony 1.2.14 and postgres 7.4.21. I
>>> >         am getting
>>> >         > the folowing errors.
>>> >         >
>>> >         > Missing yacc parser.y parser.c
>>> >         > make[2]: *** [parser.c] Error 1
>>> >         > make[2]: Leaving directory
>>> >         > `/root/Desktop/Downloads/slony1-1.2.14/src/slony_logshipper'
>>> >         > make[1]: *** [install] Error 2
>>> >         > make[1]: Leaving directory
>>> >         `/root/Desktop/Downloads/slony1-1.2.14/src'
>>> >         > make: *** [install] Error 2
>>> >         >
>>> >         > I tried installing bison. But still, I am getting the same
>>> >         error.
>>> >         >
>>> >         > On Thu, Jun 26, 2008 at 5:11 AM, Anjali Himanshu
>>> >         > <anjaliawake@gmail.com> wrote:
>>> >         >         Thanks, I have downloaded Slony v 1.2.14. I will
>>> >         also download
>>> >         >         Postgres 8.xx and will try to replicate the
>>> >         database. Is there
>>> >         >         any way to open and edit '.so' files ?
>>> >         >
>>> >         >
>>> >         >
>>> >         >         On Wed, Jun 25, 2008 at 9:52 PM, Christopher Browne
>>> >         >         <cbbrowne@ca.afilias.info> wrote:
>>> >         >                 "Anjali Himanshu" <anjaliawake@gmail.com>
>>> >         writes:
>>> >         >
>>> >         >                 > Today we tried downloading slony version
>>> >         2.xx. But,
>>> >         >                 we were unable to dowmload.
>>> >         >
>>> >         >
>>> >         >                 There is no "version 2.xx"
>>> >         >
>>> >         >                 The latest version may be found at the
>>> >         following URL:
>>> >         >
>>> >         >                 <http://slony.info/downloads/1.2/source/>
>>> >         >                 --
>>> >         >                 output =3D ("cbbrowne" "@" "acm.org")
>>> >         >                 http://linuxfinances.info/info/emacs.html
>>> >         >                 God is a comedian, playing to an audience
>>> >         too afraid
>>> >         >                 to laugh.
>>> >         >                 -- Voltaire
>>> >         >
>>> >         >
>>> >         >
>>> >
>>> >         > _______________________________________________
>>> >         > Slony1-general mailing list
>>> >         > Slony1-general@lists.slony.info
>>> >         > http://lists.slony.info/mailman/listinfo/slony1-general
>>> >
>>> >
>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080626/=
85b4b6e9/attachment-0001.htm
From glynastill at yahoo.co.uk  Thu Jun 26 03:23:31 2008
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Thu Jun 26 03:24:03 2008
Subject: [Slony1-general] Re: Slony1-general Digest, Vol 16, Issue 27
Message-ID: <606827.78900.qm@web25801.mail.ukl.yahoo.com>

I'm confused, are we saying that there's a possible case where a SUBSCRIBE, WAIT FOR EVENT then a SYNC and WAIT FOR EVENT to each subscriber might not indicate that the subscription has finished?

I do this with the timeout=0 parameter before going straight onto a MERGE SET, so far I've seen no issues......

----- Original Message ----
> From: Christopher Browne <cbbrowne@ca.afilias.info>
> To: Troy Wolf <troy@troywolf.com>
> Cc: slony1-general@lists.slony.info
> Sent: Wednesday, 25 June, 2008 6:59:12 PM
> Subject: Re: [Slony1-general] Re: Slony1-general Digest, Vol 16, Issue 27
> 
> "Troy Wolf" writes:
> >>> If, like the user in the link you provided, you are trying to
> >>> SUBSCRIBE, then use WAIT FOR EVENT to know when the SUBSCRIBE has
> >>> completed, then your problem is that this does not work. WAIT FOR
> >>> EVENT is unable to reliably know when the subscribe has completed, and
> >>> you cannot MERGE SET until the SUBSCRIBE completes.
> >>>
> >>> You'll probably notice that if you wait long enough--usually a few
> >>> seconds depending on your data size--the MERGE will work.
> >>
> >> Correct on both counts.
> >
> > Then you do not have a problem. What I tried to convey is that you
> > cannot do WAIT FOR EVENT. To my knowledge, all you can do with a
> > subscribe is manually wait for it to finish. You can do this by
> > watching the logs and noticing when the subscribe completes.
> > Alternatively, you can do what I do--I have a script that does the
> > subscribe then pauses waiting for me to hit ENTER to continue with the
> > MERGE. I simply wait 10 seconds or so then hit ENTER. If the MERGE
> > fails, I just assume the subscribe is still in process and go back to
> > the code that prompts the user to wait and hit ENTER when ready for
> > the MERGE. If I were to automate this script, I'd probably catch the
> > MERGE failure, go into a wait, then try again. Each time it fails, I'd
> > double my wait. Perhaps fail 10 times before giving up with a fatal
> > error.
> 
> We're trying to get things to a point where you *could* use WAIT FOR
> EVENT to validate that subscriptions have completed.  (At least, as
> long as there wasn't some other failure; if there are 10 error
> conditions, in a complex distributed system, we can't always hope to
> catch them *all*!)
> 
> You can't expect to WAIT FOR EVENT against the SUBSCRIBE_SET event;
> the process of subscription is spread across multiple events, and the
> event whose confirmation would *directly* indicate completion of the
> subscription isn't available within the slonik script.
> 
> However, there *is* a way to WAIT FOR EVENT that you should be able to
> expect to work, and if it doesn't there's something buggy going on.
> 
> You submit the subscription, but THEN you submit a SYNC event.  *That*
> event has got to get processed *after* the subscription work is done.
> And you can wait on THAT.
> 
> Thus:
>   
>   include ;   # Pull in configuration
>   # Get the subscription going
>   subscribe set (id=1, provider=1, receiver=2, forward=yes);
> 
>   sync(id=1);    # Submits a SYNC event
>   wait for event (origin=all, confirmed=2, wait on=1);   # Waits for that event 
> to be confirmed on node #2
> 
> No doubt I should add this to the documentation :-).
> -- 


      __________________________________________________________
Not happy with your email address?.
Get the one you really want - millions of new email addresses available now at Yahoo! http://uk.docs.yahoo.com/ymail/new.html
From anjaliawake at gmail.com  Thu Jun 26 03:44:55 2008
From: anjaliawake at gmail.com (Anjali Himanshu)
Date: Thu Jun 26 03:45:26 2008
Subject: [Slony1-general] Missing yacc parser.y parser.c
In-Reply-To: <9662b8750806260244p4e4a61fdu1eaa12edf0dd130c@mail.gmail.com>
References: <9662b8750806260025g7febff5erbfeda2ca331bfdb8@mail.gmail.com>
	<1214466748.3176.2.camel@localhost.localdomain>
	<9662b8750806260051r7d635f97scd56b4bb43dea51f@mail.gmail.com>
	<1214468732.3176.4.camel@localhost.localdomain>
	<9662b8750806260126w3b563fb5see12f62a782d8b5b@mail.gmail.com>
	<9662b8750806260238j652fb43ay76f6faf2de91d902@mail.gmail.com>
	<9662b8750806260244p4e4a61fdu1eaa12edf0dd130c@mail.gmail.com>
Message-ID: <9662b8750806260344m5adfb4bch83718a76bd1b6724@mail.gmail.com>

I removed the Debian package for Slony. Now the error is gone.

On Thu, Jun 26, 2008 at 3:14 PM, Anjali Himanshu <anjaliawake@gmail.com>
wrote:

> Can you tell me, how to uninstall Slony on linux.
>
> i am trying to run the shell script for replication. I am getting the
> error:
>
> <stdin>:7: loading of file /usr/share/slony1/slony1_funcs.sql:
> PGRES_FATAL_ERROR ERROR:  Slonik version: 1.2.9 !=3D Slony-I version in PG
> build 1.2.14
> ERROR:  Slonik version: 1.2.9 !=3D Slony-I version in PG build 1.2.14
> <stdin>:7: ERROR: no admin conninfo for node 134598928
>
>
>
> On Thu, Jun 26, 2008 at 3:08 PM, Anjali Himanshu <anjaliawake@gmail.com>
> wrote:
>
>> I recompiled Slony. Then, tried reinstalling it. That error went.
>>
>>
>> On Thu, Jun 26, 2008 at 1:56 PM, Anjali Himanshu <anjaliawake@gmail.com>
>> wrote:
>>
>>> Yes, I installed flex too...
>>>
>>>
>>> On Thu, Jun 26, 2008 at 1:55 PM, Yi Zhao <yi.zhao@alibaba-inc.com>
>>> wrote:
>>>
>>>> do you have install flex?
>>>>
>>>> On Thu, 2008-06-26 at 13:21 +0530, Anjali Himanshu wrote:
>>>> > Yes, I have installed bison.
>>>> >
>>>> > On Thu, Jun 26, 2008 at 1:22 PM, Yi Zhao <yi.zhao@alibaba-inc.com>
>>>> > wrote:
>>>> >         be sure u have installed bison and flex
>>>> >
>>>> >         Regards,
>>>> >         Yi
>>>> >
>>>> >         On Thu, 2008-06-26 at 12:55 +0530, Anjali Himanshu wrote:
>>>> >         > While trying to install Slony 1.2.14 and postgres 7.4.21. I
>>>> >         am getting
>>>> >         > the folowing errors.
>>>> >         >
>>>> >         > Missing yacc parser.y parser.c
>>>> >         > make[2]: *** [parser.c] Error 1
>>>> >         > make[2]: Leaving directory
>>>> >         > `/root/Desktop/Downloads/slony1-1.2.14/src/slony_logshippe=
r'
>>>> >         > make[1]: *** [install] Error 2
>>>> >         > make[1]: Leaving directory
>>>> >         `/root/Desktop/Downloads/slony1-1.2.14/src'
>>>> >         > make: *** [install] Error 2
>>>> >         >
>>>> >         > I tried installing bison. But still, I am getting the same
>>>> >         error.
>>>> >         >
>>>> >         > On Thu, Jun 26, 2008 at 5:11 AM, Anjali Himanshu
>>>> >         > <anjaliawake@gmail.com> wrote:
>>>> >         >         Thanks, I have downloaded Slony v 1.2.14. I will
>>>> >         also download
>>>> >         >         Postgres 8.xx and will try to replicate the
>>>> >         database. Is there
>>>> >         >         any way to open and edit '.so' files ?
>>>> >         >
>>>> >         >
>>>> >         >
>>>> >         >         On Wed, Jun 25, 2008 at 9:52 PM, Christopher Browne
>>>> >         >         <cbbrowne@ca.afilias.info> wrote:
>>>> >         >                 "Anjali Himanshu" <anjaliawake@gmail.com>
>>>> >         writes:
>>>> >         >
>>>> >         >                 > Today we tried downloading slony version
>>>> >         2.xx. But,
>>>> >         >                 we were unable to dowmload.
>>>> >         >
>>>> >         >
>>>> >         >                 There is no "version 2.xx"
>>>> >         >
>>>> >         >                 The latest version may be found at the
>>>> >         following URL:
>>>> >         >
>>>> >         >                 <http://slony.info/downloads/1.2/source/>
>>>> >         >                 --
>>>> >         >                 output =3D ("cbbrowne" "@" "acm.org")
>>>> >         >                 http://linuxfinances.info/info/emacs.html
>>>> >         >                 God is a comedian, playing to an audience
>>>> >         too afraid
>>>> >         >                 to laugh.
>>>> >         >                 -- Voltaire
>>>> >         >
>>>> >         >
>>>> >         >
>>>> >
>>>> >         > _______________________________________________
>>>> >         > Slony1-general mailing list
>>>> >         > Slony1-general@lists.slony.info
>>>> >         > http://lists.slony.info/mailman/listinfo/slony1-general
>>>> >
>>>> >
>>>>
>>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080626/=
717a6f5f/attachment.htm
From alex at bengler.no  Thu Jun 26 06:20:10 2008
From: alex at bengler.no (Alexander Staubo)
Date: Thu Jun 26 06:20:14 2008
Subject: [Slony1-general] Re: Slony1-general Digest, Vol 16, Issue 27
In-Reply-To: <606827.78900.qm@web25801.mail.ukl.yahoo.com>
References: <606827.78900.qm@web25801.mail.ukl.yahoo.com>
Message-ID: <88daf38c0806260620u47b15414uc368df72ad2a157f@mail.gmail.com>

On Thu, Jun 26, 2008 at 12:23 PM, Glyn Astill <glynastill@yahoo.co.uk> wrote:
> I'm confused, are we saying that there's a possible case where a SUBSCRIBE, WAIT FOR EVENT then a SYNC and WAIT FOR EVENT to each subscriber might not indicate that the subscription has finished?

That is what we're saying. At least nobody so far has pointed out any
problems with my script -- so it sounds like this functionality is
broken in certain cases.

My replication setup is ridiculously simple, which is why I'm
surprised that it doesn't work. I have two replication nodes on the
same machine running on two different PostgreSQL processes. Just a few
tables and sequences, and a single table set.

Alexander.
From troy at troywolf.com  Thu Jun 26 06:26:56 2008
From: troy at troywolf.com (Troy Wolf)
Date: Thu Jun 26 06:27:00 2008
Subject: [Slony1-general] Re: Slony1-general Digest, Vol 16, Issue 27
In-Reply-To: <88daf38c0806251220h1ccf2419jecd1f239229db29a@mail.gmail.com>
References: <20080625143347.9D34A290D7B@main.slony.info>
	<e0d7c3f50806250840g7d4a534dq1a551121c1c7b65f@mail.gmail.com>
	<88daf38c0806250855x16d09893t2c4fceb37fe0fa4a@mail.gmail.com>
	<e0d7c3f50806251021t510f8793h6d50fa52ec6acb36@mail.gmail.com>
	<60bq1p2y6n.fsf@dba2.int.libertyrms.com>
	<88daf38c0806251220h1ccf2419jecd1f239229db29a@mail.gmail.com>
Message-ID: <e0d7c3f50806260626m271c96ceg9dadcb99cd21fa6d@mail.gmail.com>

Alexander, I don't know if this is the missing magic, but compare your
code to the the code Chris Browne posted:

On Wed, Jun 25, 2008 at 2:20 PM, Alexander Staubo <alex@bengler.no> wrote:
>> SUBSCRIBE SET (ID=1, PROVIDER=1, RECEIVER=2);
>> WAIT FOR EVENT (ORIGIN=2, CONFIRMED = 1);
>> SYNC(ID = 1);
>> WAIT FOR EVENT (ORIGIN=1, CONFIRMED=2);

Chris Browne:
subscribe set (id=1, provider=1, receiver=2, forward=yes);
sync(id=1);    # Submits a SYNC event
wait for event (origin=all, confirmed=2, wait on=1);   # Waits for
that event to be confirmed on node #2

First notice that the WAIT FOR EVENT after the SUBSCRIBE is useless.
It tells you nothing. Second, notice the "origin=all" and "wait on=1"
in the WAIT FOR EVENT after the SYNC. Perhaps these are important
ingredients?
From ajs at crankycanuck.ca  Thu Jun 26 06:57:03 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Thu Jun 26 06:57:27 2008
Subject: [Slony1-general] Re: Slony1-general Digest, Vol 16, Issue 27
In-Reply-To: <e0d7c3f50806260626m271c96ceg9dadcb99cd21fa6d@mail.gmail.com>
References: <20080625143347.9D34A290D7B@main.slony.info>
	<e0d7c3f50806250840g7d4a534dq1a551121c1c7b65f@mail.gmail.com>
	<88daf38c0806250855x16d09893t2c4fceb37fe0fa4a@mail.gmail.com>
	<e0d7c3f50806251021t510f8793h6d50fa52ec6acb36@mail.gmail.com>
	<60bq1p2y6n.fsf@dba2.int.libertyrms.com>
	<88daf38c0806251220h1ccf2419jecd1f239229db29a@mail.gmail.com>
	<e0d7c3f50806260626m271c96ceg9dadcb99cd21fa6d@mail.gmail.com>
Message-ID: <20080626135703.GA28168@crankycanuck.ca>

On Thu, Jun 26, 2008 at 08:26:56AM -0500, Troy Wolf wrote:

> It tells you nothing. Second, notice the "origin=all" and "wait on=1"
> in the WAIT FOR EVENT after the SYNC. Perhaps these are important
> ingredients?

Aha!  Teach me to read quickly.  Yes, Troy, you have it.  The origin=all and
wait on=1 are both needed, or you don't wait long enough.

A

From ajs at crankycanuck.ca  Thu Jun 26 08:01:17 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Thu Jun 26 08:01:40 2008
Subject: [Slony1-general] tracking replication lag with a transaction_id
	table (was: order of replication)
In-Reply-To: <1214430209.9788.68.camel@danedesk.greatschools.net>
References: <1213309614.20093.86.camel@danedesk.greatschools.net>
	<20080613134012.GB28292@crankycanuck.ca>
	<1213724596.23894.18.camel@danedesk.greatschools.net>
	<1214430209.9788.68.camel@danedesk.greatschools.net>
Message-ID: <20080626150117.GC28168@crankycanuck.ca>

On Wed, Jun 25, 2008 at 02:43:29PM -0700, Dane Miller wrote:

> which makes perfect sense, thanks for the clue bat Bill.  But I *think* I
> also want to avoid having to constantly vacuum this table during
> frequent UPDATEs (see #3 below for why this is couched in 'I think').

You shouldn't need to worry about constant vacuuming.  See below.

> 3) use UPDATE statements 
>   UPDATE transcation_log set tid=DEFAULT;
>   -- autovacuum will clean up dead tuples as needed
>   -- Heap-Only Tuples (Postgresql 8.3) reclaim space and reduce need to
> vacuum

Yes.  If you're on 8.3, then if you set the table with a suitable fill
factor and put no index on the field that contains the value, you'll be in
fine shape.  HOT works, I have seen it in action, and I'm a believer.  Note
that this means you need a dummy primary key on this table.

A
From troy at troywolf.com  Thu Jun 26 11:13:43 2008
From: troy at troywolf.com (Troy Wolf)
Date: Thu Jun 26 11:13:53 2008
Subject: [Slony1-general] Logshipping dump import failure
Message-ID: <e0d7c3f50806261113h7eff6722l5ca058a88c210e74@mail.gmail.com>

I have not had a response to the error I received when trying to
subscribe a third node to my set. So in the meantime, I'm
investigating logshipping which is probably a better option for the
replication needs of this third node anyway.

I've read the logshipping notes a dozen times.
http://www.slony.info/documentation/logshipping.html

I used slony1_dump.sh on Node 2 (subscriber to set 1 from Node 1). It
appeared to work fine. It quickly produced a SQL file that is about
11MB. On the third node, I am using this command to import the dump:

psql -d my_db_name -a -f dump.txt

The import is failing, and it appears it is choking on an array
column. That is, I have a table with a column that has a data type of
text[] -- which is an array. In the dump, this is represented as
{a,b,c}. If I take the line that the import is choking on and remove
that column, it works.

Thoughts?
From ajs at crankycanuck.ca  Thu Jun 26 11:29:04 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Thu Jun 26 11:29:31 2008
Subject: [Slony1-general] Logshipping dump import failure
In-Reply-To: <e0d7c3f50806261113h7eff6722l5ca058a88c210e74@mail.gmail.com>
References: <e0d7c3f50806261113h7eff6722l5ca058a88c210e74@mail.gmail.com>
Message-ID: <20080626182904.GF28168@crankycanuck.ca>

On Thu, Jun 26, 2008 at 01:13:43PM -0500, Troy Wolf wrote:
> I have not had a response to the error I received when trying to
> subscribe a third node to my set. So in the meantime, I'm

I didn't reply because I'm mystified.  It looked right to me.

> The import is failing, and it appears it is choking on an array
> column. That is, I have a table with a column that has a data type of
> text[] -- which is an array. In the dump, this is represented as
> {a,b,c}. If I take the line that the import is choking on and remove
> that column, it works.
> 
> Thoughts?

If you dump the table itself, what does that line say?  This also looks
right to me.

From jennifer.spencer at stanford.edu  Thu Jun 26 11:40:11 2008
From: jennifer.spencer at stanford.edu (Jennifer Spencer)
Date: Thu Jun 26 11:40:23 2008
Subject: [Slony1-general] Logshipping dump import failure
In-Reply-To: <20080626182904.GF28168@crankycanuck.ca>
References: <e0d7c3f50806261113h7eff6722l5ca058a88c210e74@mail.gmail.com>
	<20080626182904.GF28168@crankycanuck.ca>
Message-ID: <4863E28B.6080805@stanford.edu>

I too have had some issues with importing the slony1_dump.sh results.  I think it has to do with the 
shell environment itself interfering.  When I issued "set noglobs on", it sometimes improved things. 
You could try that.  Or, you could try to remove those special escape characters (maybe "{" is part of 
the problem).  Your shell may be trying to interpret those characters on the way into postgres.

In my case, I had trouble with the way it handles NULL values.  Because I am impatient, I got sick of 
trying to figure out what was going on in my particular shell.  Instead, I modified the program's 
"copy out" command so that it handled null values as "NULL" instead of the default "\N" (or was it 
"/N" - I can't remember).  You may wish to actually edit a copy of slony1_dump, as I did, and change 
the copy out command to something that will work, such as "copy out ... with binary".
See the postgres page : http://www.postgresql.org/docs/current/interactive/sql-copy.html
for more info on your copy options.

-Jennifer

Andrew Sullivan wrote:
> On Thu, Jun 26, 2008 at 01:13:43PM -0500, Troy Wolf wrote:
>> I have not had a response to the error I received when trying to
>> subscribe a third node to my set. So in the meantime, I'm
> 
> I didn't reply because I'm mystified.  It looked right to me.
> 
>> The import is failing, and it appears it is choking on an array
>> column. That is, I have a table with a column that has a data type of
>> text[] -- which is an array. In the dump, this is represented as
>> {a,b,c}. If I take the line that the import is choking on and remove
>> that column, it works.
>>
>> Thoughts?
> 
> If you dump the table itself, what does that line say?  This also looks
> right to me.
> 
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
From alex at bengler.no  Thu Jun 26 11:52:30 2008
From: alex at bengler.no (Alexander Staubo)
Date: Thu Jun 26 11:52:44 2008
Subject: [Slony1-general] Re: Slony1-general Digest, Vol 16, Issue 27
In-Reply-To: <e0d7c3f50806260626m271c96ceg9dadcb99cd21fa6d@mail.gmail.com>
References: <20080625143347.9D34A290D7B@main.slony.info>
	<e0d7c3f50806250840g7d4a534dq1a551121c1c7b65f@mail.gmail.com>
	<88daf38c0806250855x16d09893t2c4fceb37fe0fa4a@mail.gmail.com>
	<e0d7c3f50806251021t510f8793h6d50fa52ec6acb36@mail.gmail.com>
	<60bq1p2y6n.fsf@dba2.int.libertyrms.com>
	<88daf38c0806251220h1ccf2419jecd1f239229db29a@mail.gmail.com>
	<e0d7c3f50806260626m271c96ceg9dadcb99cd21fa6d@mail.gmail.com>
Message-ID: <88daf38c0806261152v4140b1d3nf53c023748118618@mail.gmail.com>

T24gVGh1LCBKdW4gMjYsIDIwMDggYXQgMzoyNiBQTSwgVHJveSBXb2xmIDx0cm95QHRyb3l3b2xm
LmNvbT4gd3JvdGU6Cj4gQWxleGFuZGVyLCBJIGRvbid0IGtub3cgaWYgdGhpcyBpcyB0aGUgbWlz
c2luZyBtYWdpYywgYnV0IGNvbXBhcmUgeW91cgo+IGNvZGUgdG8gdGhlIHRoZSBjb2RlIENocmlz
IEJyb3duZSBwb3N0ZWQ6Cj4KPiBPbiBXZWQsIEp1biAyNSwgMjAwOCBhdCAyOjIwIFBNLCBBbGV4
YW5kZXIgU3RhdWJvIDxhbGV4QGJlbmdsZXIubm8+IHdyb3RlOgo+Pj4gU1VCU0NSSUJFIFNFVCAo
SUQ9MSwgUFJPVklERVI9MSwgUkVDRUlWRVI9Mik7Cj4+PiBXQUlUIEZPUiBFVkVOVCAoT1JJR0lO
PTIsIENPTkZJUk1FRCA9IDEpOwo+Pj4gU1lOQyhJRCA9IDEpOwo+Pj4gV0FJVCBGT1IgRVZFTlQg
KE9SSUdJTj0xLCBDT05GSVJNRUQ9Mik7Cj4KPiBDaHJpcyBCcm93bmU6Cj4gc3Vic2NyaWJlIHNl
dCAoaWQ9MSwgcHJvdmlkZXI9MSwgcmVjZWl2ZXI9MiwgZm9yd2FyZD15ZXMpOwo+IHN5bmMoaWQ9
MSk7ICAgICMgU3VibWl0cyBhIFNZTkMgZXZlbnQKPiB3YWl0IGZvciBldmVudCAob3JpZ2luPWFs
bCwgY29uZmlybWVkPTIsIHdhaXQgb249MSk7ICAgIyBXYWl0cyBmb3IKPiB0aGF0IGV2ZW50IHRv
IGJlIGNvbmZpcm1lZCBvbiBub2RlICMyCj4KPiBGaXJzdCBub3RpY2UgdGhhdCB0aGUgV0FJVCBG
T1IgRVZFTlQgYWZ0ZXIgdGhlIFNVQlNDUklCRSBpcyB1c2VsZXNzLgo+IEl0IHRlbGxzIHlvdSBu
b3RoaW5nLiBTZWNvbmQsIG5vdGljZSB0aGUgIm9yaWdpbj1hbGwiIGFuZCAid2FpdCBvbj0xIgo+
IGluIHRoZSBXQUlUIEZPUiBFVkVOVCBhZnRlciB0aGUgU1lOQy4gUGVyaGFwcyB0aGVzZSBhcmUg
aW1wb3J0YW50Cj4gaW5ncmVkaWVudHM/CgpQZXJoYXBzLCBidXQgaXQgZG9lcyBub3Qgd29yayBo
ZXJlOyBJJ20gZ2V0dGluZyB0aGUgc2FtZSBlcnJvciBhcyBiZWZvcmUuCgpJIGFtIGF0dGFjaGlu
ZyB0aGUgbG9ncyBmcm9tIGJvdGggbm9kZXMuIEkgaGF2ZSBhbm5vdGF0ZWQgdGhlbSBhdCB0aGUK
ZXhhY3QgcG9pbnQgd2hlcmUgSSBydW4gdGhlIHN5bmMgYW5kIHdhaXQuCgpBbGV4YW5kZXIuCi0t
LS0tLS0tLS0tLS0tIG5leHQgcGFydCAtLS0tLS0tLS0tLS0tLQpBIG5vbi10ZXh0IGF0dGFjaG1l
bnQgd2FzIHNjcnViYmVkLi4uCk5hbWU6IGxvZ3MudGFyLmd6ClR5cGU6IGFwcGxpY2F0aW9uL3gt
Z3ppcApTaXplOiA0ODExIGJ5dGVzCkRlc2M6IG5vdCBhdmFpbGFibGUKVXJsIDogaHR0cDovL2xp
c3RzLnNsb255LmluZm8vcGlwZXJtYWlsL3Nsb255MS1nZW5lcmFsL2F0dGFjaG1lbnRzLzIwMDgw
NjI2L2Y2MTgzNTFiL2xvZ3MudGFyLmJpbgo=
From troy at troywolf.com  Thu Jun 26 13:03:49 2008
From: troy at troywolf.com (Troy Wolf)
Date: Thu Jun 26 13:04:02 2008
Subject: [Slony1-general] Re: Slony1-general Digest, Vol 16, Issue 33
In-Reply-To: <20080626190003.EC1AC290EA2@main.slony.info>
References: <20080626190003.EC1AC290EA2@main.slony.info>
Message-ID: <e0d7c3f50806261303l223c5667p1f7b9ece286569e6@mail.gmail.com>

> Date: Thu, 26 Jun 2008 14:29:04 -0400
> From: Andrew Sullivan <ajs@crankycanuck.ca>
> Subject: Re: [Slony1-general] Logshipping dump import failure
> To: slony1-general@lists.slony.info
> Message-ID: <20080626182904.GF28168@crankycanuck.ca>
> Content-Type: text/plain; charset=us-ascii
>
> On Thu, Jun 26, 2008 at 01:13:43PM -0500, Troy Wolf wrote:
>> I have not had a response to the error I received when trying to
>> subscribe a third node to my set. So in the meantime, I'm
>
> I didn't reply because I'm mystified.  It looked right to me.
>
>> The import is failing, and it appears it is choking on an array
>> column. That is, I have a table with a column that has a data type of
>> text[] -- which is an array. In the dump, this is represented as
>> {a,b,c}. If I take the line that the import is choking on and remove
>> that column, it works.
>>
>> Thoughts?
>
> If you dump the table itself, what does that line say?  This also looks
> right to me.

First, the failure was not truly because of the array as it turns out.
When doing psql import, you have to look at the FIRST error...not the
last error that is visible. Only the first error tells you why the
import actually failed. My problem was simply constraint issues
requiring me to import the tables in a specific order.

I'm not sure why my command-line copy test "proved" that the array
column fails. I must not know how to do that correctly? Argh. Sorry to
waste some of your time.
From ajs at crankycanuck.ca  Thu Jun 26 13:19:16 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Thu Jun 26 13:19:47 2008
Subject: [Slony1-general] Re: Slony1-general Digest, Vol 16, Issue 33
In-Reply-To: <e0d7c3f50806261303l223c5667p1f7b9ece286569e6@mail.gmail.com>
References: <20080626190003.EC1AC290EA2@main.slony.info>
	<e0d7c3f50806261303l223c5667p1f7b9ece286569e6@mail.gmail.com>
Message-ID: <20080626201916.GG28168@crankycanuck.ca>

On Thu, Jun 26, 2008 at 03:03:49PM -0500, Troy Wolf wrote:

> When doing psql import, you have to look at the FIRST error...not the
> last error that is visible.

Yes, alas.  

> I'm not sure why my command-line copy test "proved" that the array
> column fails. 

Someone else posted a remark about your shell catching various shell special
characters.  Maybe it was that (I have already forgotten what you showed, so
I can't say for sure :)

A
From troy at troywolf.com  Thu Jun 26 15:04:28 2008
From: troy at troywolf.com (Troy Wolf)
Date: Thu Jun 26 15:04:43 2008
Subject: [Slony1-general] slony_logshipper: node is on archive counter X,
	this archive log expects Y
Message-ID: <e0d7c3f50806261504u4c7a6cb4h75bd4b6234f945b9@mail.gmail.com>

I am using slony_logshipper for admittedly the first time. I keep
getting errors like this:

INFO  2008-06-26 17:31:31 > Processing archive file
/foo/logship/in/slony1_log_2_00000000000000000121.sql
ERROR 2008-06-26 17:31:31 > PGRES_FATAL_ERROR: ERROR:  Slony-I: node
is on archive counter 118, this archive log expects 120
Query was: select "_slony".archiveTracking_offline('121', '2008-06-25
18:21:35.407583');
WARN  2008-06-26 17:31:31 > waiting for resume

I can simply kill the slony_logshipper process and restart and it will
make it a little further before stopping on the same error but with
higher numbers. This seems odd. Seems if there is a problem, it should
continue to be a problem each time I run slony_logshipper. What is
this error and why does it make it a little further each time?

Another user explains this exact same issue, but there was not a
resolution in the thread:
http://www.nabble.com/node-is-on-archive-counter-44,-this-archive-log-expects-45-td16970660.html

On a side note, the way slony_logshipper works seems kind of odd, but
then again, there is a lot I don't know about it. It is odd to me that
it reaches a fatal error yet does not actually stop the process. You
have to either kill it, or run the command again with a -r option to
"resume from error". However, the resume option never allows the
process to continue past the error. If instead, I kill the
slony_logshipper process, then restart it, it is always able to apply
a few more log files before barfing the error.
From troy at troywolf.com  Fri Jun 27 07:03:33 2008
From: troy at troywolf.com (Troy Wolf)
Date: Fri Jun 27 07:03:39 2008
Subject: [Slony1-general] Re: Slony1-general Digest, Vol 16, Issue 27
In-Reply-To: <88daf38c0806261152v4140b1d3nf53c023748118618@mail.gmail.com>
References: <20080625143347.9D34A290D7B@main.slony.info>
	<e0d7c3f50806250840g7d4a534dq1a551121c1c7b65f@mail.gmail.com>
	<88daf38c0806250855x16d09893t2c4fceb37fe0fa4a@mail.gmail.com>
	<e0d7c3f50806251021t510f8793h6d50fa52ec6acb36@mail.gmail.com>
	<60bq1p2y6n.fsf@dba2.int.libertyrms.com>
	<88daf38c0806251220h1ccf2419jecd1f239229db29a@mail.gmail.com>
	<e0d7c3f50806260626m271c96ceg9dadcb99cd21fa6d@mail.gmail.com>
	<88daf38c0806261152v4140b1d3nf53c023748118618@mail.gmail.com>
Message-ID: <e0d7c3f50806270703i344292fdre7e5897600450646@mail.gmail.com>

Alexander (and others), I tested this and it works perfectly. Thanks,
Chris Browne. I know a lot of people use PERL scripts, etc. I use
"simple" bash shell scripts with the slonik commands. Here is a
snippet of my subscribe code. I have my common slonik preamble stuff
in a file named slonik_preamble.txt. I hope this helps you, Alexander:

slonik <<_EOF_
    include <./slonik_preamble.txt>
    subscribe set (id=1, provider=1, receiver=2, forward=yes);
_EOF_
RET=$?
if [ $RET -ne 0 ]; then
    echo ""
    echo "Your request to subscribe failed!"
    echo ""
    exit 2
fi

echo ""
echo "Your request to subscribe is in progress. We must now wait for the"
echo "subscription to complete. Normally, this will take no more than"
echo "30 seconds--depending on the size of the data. If it takes longer,"
echo "there may be an open transaction that is cramping our style."
echo ""

slonik <<_EOF_
    include <./slonik_preamble.txt>
    SYNC(id=1);
    WAIT FOR EVENT (origin=all, confirmed=2, wait on=1);
_EOF_
RET=$?
if [ $RET -ne 0 ]; then
    echo ""
    echo "There was a failure while waiting for the subscribe to complete!"
    echo "It is time to tail the slon logs to investigate."
    echo ""
    exit 2
fi

echo ""
echo "Your request to subscribe completed. Replication should now be working."
echo ""
exit 0


On Thu, Jun 26, 2008 at 1:52 PM, Alexander Staubo <alex@bengler.no> wrote:
>
> Perhaps, but it does not work here; I'm getting the same error as before.
>
> I am attaching the logs from both nodes. I have annotated them at the
> exact point where I run the sync and wait.
>
> Alexander.
From alex at bengler.no  Fri Jun 27 08:59:06 2008
From: alex at bengler.no (Alexander Staubo)
Date: Fri Jun 27 08:59:14 2008
Subject: [Slony1-general] Re: Slony1-general Digest, Vol 16, Issue 27
In-Reply-To: <e0d7c3f50806270703i344292fdre7e5897600450646@mail.gmail.com>
References: <20080625143347.9D34A290D7B@main.slony.info>
	<e0d7c3f50806250840g7d4a534dq1a551121c1c7b65f@mail.gmail.com>
	<88daf38c0806250855x16d09893t2c4fceb37fe0fa4a@mail.gmail.com>
	<e0d7c3f50806251021t510f8793h6d50fa52ec6acb36@mail.gmail.com>
	<60bq1p2y6n.fsf@dba2.int.libertyrms.com>
	<88daf38c0806251220h1ccf2419jecd1f239229db29a@mail.gmail.com>
	<e0d7c3f50806260626m271c96ceg9dadcb99cd21fa6d@mail.gmail.com>
	<88daf38c0806261152v4140b1d3nf53c023748118618@mail.gmail.com>
	<e0d7c3f50806270703i344292fdre7e5897600450646@mail.gmail.com>
Message-ID: <88daf38c0806270859y1ee00830xfd1ebfb5eb35e903@mail.gmail.com>

On Fri, Jun 27, 2008 at 4:03 PM, Troy Wolf <troy@troywolf.com> wrote:
> Alexander (and others), I tested this and it works perfectly. Thanks,
> Chris Browne. I know a lot of people use PERL scripts, etc. I use
> "simple" bash shell scripts with the slonik commands. Here is a
> snippet of my subscribe code. I have my common slonik preamble stuff
> in a file named slonik_preamble.txt. I hope this helps you, Alexander:

All right, I tried a different tack, and finally discovered the cause
of my problem: I was not executing "sync" and "wait for event" in the
same Slonik script; instead, I was issuing the sync first and then the
wait in a second Slonik call.

Perhaps there is a rational explanation for this behaviour, but to a
Slony newbie such as myself, this is not obvious.

The reason I have been doing it in separate scripts is that I generate
the scripts dynamically through a set of wrappers, letting me easily
decompose complex Slony operations into multiple high-level calls:

  cluster.find_set(10000).drop!
  set = cluster.find_set(1)
  set.add_table!("contacts", :id => 16)
  cluster.wait_for_event(:all, master, :wait_on => slave, :timeout =>
0, :sync => true)

and so on. Having the calls map one-to-one with Slony commands makes
the implementation simpler, but I guess I have to change this.

Alexander.
From cbbrowne at ca.afilias.info  Fri Jun 27 10:53:04 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri Jun 27 10:53:16 2008
Subject: [Slony1-general] Re: Slony1-general Digest, Vol 16, Issue 27
In-Reply-To: <88daf38c0806270859y1ee00830xfd1ebfb5eb35e903@mail.gmail.com>
	(Alexander Staubo's message of "Fri, 27 Jun 2008 17:59:06 +0200")
References: <20080625143347.9D34A290D7B@main.slony.info>
	<e0d7c3f50806250840g7d4a534dq1a551121c1c7b65f@mail.gmail.com>
	<88daf38c0806250855x16d09893t2c4fceb37fe0fa4a@mail.gmail.com>
	<e0d7c3f50806251021t510f8793h6d50fa52ec6acb36@mail.gmail.com>
	<60bq1p2y6n.fsf@dba2.int.libertyrms.com>
	<88daf38c0806251220h1ccf2419jecd1f239229db29a@mail.gmail.com>
	<e0d7c3f50806260626m271c96ceg9dadcb99cd21fa6d@mail.gmail.com>
	<88daf38c0806261152v4140b1d3nf53c023748118618@mail.gmail.com>
	<e0d7c3f50806270703i344292fdre7e5897600450646@mail.gmail.com>
	<88daf38c0806270859y1ee00830xfd1ebfb5eb35e903@mail.gmail.com>
Message-ID: <604p7e229r.fsf@dba2.int.libertyrms.com>

"Alexander Staubo" <alex@bengler.no> writes:
> On Fri, Jun 27, 2008 at 4:03 PM, Troy Wolf <troy@troywolf.com> wrote:
>> Alexander (and others), I tested this and it works perfectly. Thanks,
>> Chris Browne. I know a lot of people use PERL scripts, etc. I use
>> "simple" bash shell scripts with the slonik commands. Here is a
>> snippet of my subscribe code. I have my common slonik preamble stuff
>> in a file named slonik_preamble.txt. I hope this helps you, Alexander:
>
> All right, I tried a different tack, and finally discovered the cause
> of my problem: I was not executing "sync" and "wait for event" in the
> same Slonik script; instead, I was issuing the sync first and then the
> wait in a second Slonik call.
>
> Perhaps there is a rational explanation for this behaviour, but to a
> Slony newbie such as myself, this is not obvious.

Ah, that would explain it; if you don't submit them in the same
request, the WAIT FOR EVENT has no way to know what event to wait for.

> The reason I have been doing it in separate scripts is that I generate
> the scripts dynamically through a set of wrappers, letting me easily
> decompose complex Slony operations into multiple high-level calls:
>
>   cluster.find_set(10000).drop!
>   set = cluster.find_set(1)
>   set.add_table!("contacts", :id => 16)
>   cluster.wait_for_event(:all, master, :wait_on => slave, :timeout =>
> 0, :sync => true)
>
> and so on. Having the calls map one-to-one with Slony commands makes
> the implementation simpler, but I guess I have to change this.

Unfortunately, 1-to-1 has some downsides :-(.

Some of the functionality requires grouping operations together.
-- 
output = ("cbbrowne" "@" "linuxfinances.info")
http://linuxdatabases.info/info/finances.html
"Here I  am, brain the  size of a planet, and  they ask me to take you
down the the bridge.  Call that job satisfaction?  'Cos I don't."
-- Marvin the Paranoid Android
From alex at bengler.no  Fri Jun 27 11:56:01 2008
From: alex at bengler.no (Alexander Staubo)
Date: Fri Jun 27 11:56:13 2008
Subject: [Slony1-general] Replication of sequences required?
Message-ID: <88daf38c0806271156s63d979eakc0816abb226dc445@mail.gmail.com>

Am I correct in thinking that there are cases where you don't need to
set up replication of sequences at all?

For example, if you're setting up Slony slaves for the sole purpose of
off-loading read-only queries from the master *and* you only ever use
sequences in conjunction with "serial" columns, then sequences on the
slaves are irrelevant and could be ignored altogether.

Alexander.
From msteben at autorevenue.com  Fri Jun 27 12:28:19 2008
From: msteben at autorevenue.com (Mark Steben)
Date: Fri Jun 27 12:27:48 2008
Subject: [Slony1-general] execute script doesn't work
Message-ID: <005201c8d88b$f48e4f40$14010a0a@dei26g028575>

U2tpcHBlZCBjb250ZW50IG9mIHR5cGUgbXVsdGlwYXJ0L2FsdGVybmF0aXZlLS0tLS0tLS0tLS0t
LS0gbmV4dCBwYXJ0IC0tLS0tLS0tLS0tLS0tCkEgbm9uLXRleHQgYXR0YWNobWVudCB3YXMgc2Ny
dWJiZWQuLi4KTmFtZTogbm90IGF2YWlsYWJsZQpUeXBlOiBpbWFnZS9naWYKU2l6ZTogMjQ5MyBi
eXRlcwpEZXNjOiBub3QgYXZhaWxhYmxlClVybCA6IGh0dHA6Ly9saXN0cy5zbG9ueS5pbmZvL3Bp
cGVybWFpbC9zbG9ueTEtZ2VuZXJhbC9hdHRhY2htZW50cy8yMDA4MDYyNy9iMjY3NDUxOS9hdHRh
Y2htZW50LmdpZgo=
From cbbrowne at ca.afilias.info  Fri Jun 27 12:40:03 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri Jun 27 12:40:17 2008
Subject: [Slony1-general] Replication of sequences required?
In-Reply-To: <88daf38c0806271156s63d979eakc0816abb226dc445@mail.gmail.com>
	(Alexander Staubo's message of "Fri, 27 Jun 2008 20:56:01 +0200")
References: <88daf38c0806271156s63d979eakc0816abb226dc445@mail.gmail.com>
Message-ID: <60vdzuzmy4.fsf@dba2.int.libertyrms.com>

"Alexander Staubo" <alex@bengler.no> writes:
> Am I correct in thinking that there are cases where you don't need to
> set up replication of sequences at all?
>
> For example, if you're setting up Slony slaves for the sole purpose of
> off-loading read-only queries from the master *and* you only ever use
> sequences in conjunction with "serial" columns, then sequences on the
> slaves are irrelevant and could be ignored altogether.

If you never care about failover or moving the "master" role around,
then you're correct, there is no real need to replicate sequences.
-- 
(reverse (concatenate 'string "ofni.secnanifxunil" "@" "enworbbc"))
http://linuxfinances.info/info/x.html
"Absolutely nothing should be concluded from these figures except that
no  conclusion can be  drawn from  them."  
-- By Joseph L. Brothers, Linux/PowerPC Project
From shahaf at redfin.com  Fri Jun 27 12:47:47 2008
From: shahaf at redfin.com (Shahaf Abileah)
Date: Fri Jun 27 12:48:08 2008
Subject: [Slony1-general] execute script doesn't work
In-Reply-To: <005201c8d88b$f48e4f40$14010a0a@dei26g028575>
References: <005201c8d88b$f48e4f40$14010a0a@dei26g028575>
Message-ID: <082D8A131DF72A4D88C908A1AD3DEB220419BC3F@mail-1.rf.lan>

U2tpcHBlZCBjb250ZW50IG9mIHR5cGUgbXVsdGlwYXJ0L2FsdGVybmF0aXZlLS0tLS0tLS0tLS0t
LS0gbmV4dCBwYXJ0IC0tLS0tLS0tLS0tLS0tCkEgbm9uLXRleHQgYXR0YWNobWVudCB3YXMgc2Ny
dWJiZWQuLi4KTmFtZTogbm90IGF2YWlsYWJsZQpUeXBlOiBpbWFnZS9naWYKU2l6ZTogMjQ5MyBi
eXRlcwpEZXNjOiBpbWFnZTAwMS5naWYKVXJsIDogaHR0cDovL2xpc3RzLnNsb255LmluZm8vcGlw
ZXJtYWlsL3Nsb255MS1nZW5lcmFsL2F0dGFjaG1lbnRzLzIwMDgwNjI3LzAyZTYwNDIzL2F0dGFj
aG1lbnQtMDAwMS5naWYK
From cbbrowne at ca.afilias.info  Fri Jun 27 13:02:05 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri Jun 27 13:02:20 2008
Subject: [Slony1-general] execute script doesn't work
In-Reply-To: <005201c8d88b$f48e4f40$14010a0a@dei26g028575> (Mark Steben's
	message of "Fri, 27 Jun 2008 15:28:19 -0400")
References: <005201c8d88b$f48e4f40$14010a0a@dei26g028575>
Message-ID: <60r6aizlxe.fsf@dba2.int.libertyrms.com>

"Mark Steben" <msteben@autorevenue.com> writes:

> <html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns:st1="urn:schemas-microsoft-com:office:smarttags" xmlns="http://www.w3.org/TR/REC-html40">
>
> <head>
> <meta http-equiv=Content-Type content="text/html; charset=koi8-r">
> <meta name=Generator content="Microsoft Word 11 (filtered medium)">
> <!--[if !mso]>
> <style>
> v\:* {behavior:url(#default#VML);}
> o\:* {behavior:url(#default#VML);}
> w\:* {behavior:url(#default#VML);}
> .shape {behavior:url(#default#VML);}
> </style>
> <![endif]--><o:SmartTagType
>  namespaceuri="urn:schemas-microsoft-com:office:smarttags" name="address"/>
> <o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
>  name="Street"/>
> <!--[if !mso]>
> <style>
> st1\:*{behavior:url(#default#ieooui) }
> </style>
> <![endif]-->
> <style>
> <!--
>  /* Font Definitions */
>  @font-face
> 	{font-family:"Franklin Gothic Medium";
> 	panose-1:2 11 6 3 2 1 2 2 2 4;}
> @font-face
> 	{font-family:Webdings;
> 	panose-1:5 3 1 2 1 5 9 6 7 3;}
> @font-face
> 	{font-family:"Wingdings 2";
> 	panose-1:5 2 1 2 1 5 7 7 7 7;}
>  /* Style Definitions */
>  p.MsoNormal, li.MsoNormal, div.MsoNormal
> 	{margin:0in;
> 	margin-bottom:.0001pt;
> 	font-size:12.0pt;
> 	font-family:"Times New Roman";}
> a:link, span.MsoHyperlink
> 	{color:blue;
> 	text-decoration:underline;}
> a:visited, span.MsoHyperlinkFollowed
> 	{color:purple;
> 	text-decoration:underline;}
> span.EmailStyle17
> 	{mso-style-type:personal-compose;
> 	font-family:"Times New Roman";
> 	color:windowtext;
> 	font-weight:normal;
> 	font-style:normal;
> 	text-decoration:none none;}
> @page Section1
> 	{size:8.5in 11.0in;
> 	margin:1.0in 1.25in 1.0in 1.25in;}
> div.Section1
> 	{page:Section1;}
> -->
> </style>
> <!--[if gte mso 9]><xml>
>  <o:shapedefaults v:ext="edit" spidmax="1027" />
> </xml><![endif]--><!--[if gte mso 9]><xml>
>  <o:shapelayout v:ext="edit">
>   <o:idmap v:ext="edit" data="1" />
>  </o:shapelayout></xml><![endif]-->
> </head>
>
> <body lang=EN-US link=blue vlink=purple>
>
> <div class=Section1>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'><o:p>&nbsp;</o:p></span></font></p>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'>Very basic question from a very new slony user<o:p></o:p></span></font></p>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'>I am running slony 1.2.14.? <o:p></o:p></span></font></p>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'>?Very simple configuration &#8211; 1 master? 1 slave<o:p></o:p></span></font></p>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'>?Both running ?postgres 8.2.5.? <o:p></o:p></span></font></p>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'>I have slony working, successfully replicating seven tables.<o:p></o:p></span></font></p>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'>I also have successfully run some of the monitoring scripts<o:p></o:p></span></font></p>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'>? (E.G. TEST_SLONY_STATE-DBI. PL)<o:p></o:p></span></font></p>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'>Now I want to simply add a column to one of the tables.<o:p></o:p></span></font></p>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'>Documentation ?states it is &#8216;essential &#8216; to run EXECUTE
> SCRIPT <o:p></o:p></span></font></p>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'>?On the origin node when changing table schemas.? <o:p></o:p></span></font></p>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'>Trying to get it working through slonik.? Not sure if I am using slonik
> correctly.<o:p></o:p></span></font></p>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'><o:p>&nbsp;</o:p></span></font></p>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'>This is the script and the result:<o:p></o:p></span></font></p>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'><o:p>&nbsp;</o:p></span></font></p>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'>slonik &lt;&lt;_EOF_<o:p></o:p></span></font></p>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'>&gt; execute script (<o:p></o:p></span></font></p>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'>&gt; set id = 1,<o:p></o:p></span></font></p>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'>&gt; filename = '/home/postgres/add.insert.date.to.agents',<o:p></o:p></span></font></p>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'>&gt; event node = 1<o:p></o:p></span></font></p>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'>&gt; );<o:p></o:p></span></font></p>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'>&gt; _EOF_<o:p></o:p></span></font></p>
>
> <p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
> 12.0pt'>&lt;stdin&gt;:1: ERROR: syntax error at or near execute<o:p></o:p></span></font></p>

The problem here is that every slonik script needs to start with the
"preamble" portion, that is, it must start with:

a) Declaration of the cluster
  CLUSTER NAME = something;

b) Declarations of how slonik can reach the nodes.

   If the command is accessing node #1, then it must at least have...

  NODE 1 ADMIN CONNINFO = 'dsn for accessing node 1, maybe dbname=mydb host=host1 port=5432';

Any script that doesn't begin with "CLUSTER NAME" (or a reference to a
file *containing* "CLUSTER NAME") will error out in this fashion.
-- 
(reverse (concatenate 'string "moc.enworbbc" "@" "enworbbc"))
http://linuxfinances.info/info/rdbms.html
"There is   nothing in the world  more  helpless and irresponsible and
depraved than a man in the depths of an ether binge."
-- Dr. Hunter S. Thompson
From cbbrowne at ca.afilias.info  Fri Jun 27 13:41:51 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri Jun 27 13:42:08 2008
Subject: [Slony1-general] Initial release candidate for Slony-I 2.0
Message-ID: <60myl6zk34.fsf@dba2.int.libertyrms.com>

We are pleased to present the first release candidate for version 2 of
Slony-I.  It will almost certainly not be the final for v2.0.0, but
has been tested enough (by Jan and I) that it seems worthwhile to
encourage others to test it and see if there are issues that we didn't
notice.

Differences from 1.2 stream

- Removal of TABLE ADD KEY

- It drops all support for databases prior to Postgres version 8.3.

This is required because we now make use of new functionality in
Postgres, namely the trigger and rule support for session replication
role. As of now, every node (origin/subscriber/mixed) can be dumped with
pg_dump and result in a consistent snapshot of the database.

- Still need alterTableRestore() for the upgrade from 1.2.x to 2.0.
upgradeSchema() will restore the system catalog to a consistent
state and define+configure the new versions of the log and deny_access
triggers. 

- Fix EXECUTE SCRIPT so that it records the ev_seqno for WAIT FOR EVENT
and make sure all DDL is executed in session_replication_role "local"
on the origin as well as all subscribers. This will cause the slony
triggers to ignore all DML statements while user triggers follow the
regular configuration options for ENABLE [REPLICA/ALWAYS] or DISABLE.

- Let the logshipping files also switch to session_replication_role =
"replica" or "local" (for DDL).

- Sequence tracking becomes enormously less expensive; rather than
polling *ALL* sequence values for each and every SYNC, the slon
stores the last value, and only records entries in sl_seqlog when
the value changes from that last value.  If most sequences are
relatively inactive, they won't require entries in sl_seqlog very
often.

- Change to tools/slony1_dump.sh (used to generate log shipping dump);
  change quoting of "\\\backslashes\\\" to get rid of warning

- Cleanup thread revised to push most of the logic to evaluate which
  tables are to be vacuumed into a pair of stored functions.

  This fairly massively simplifies the C code.

- Revised logging levels so that most of the interesting messages are
  spit out at SLON_CONFIG and SLON_INFO levels.  This can allow users
  to drop out the higher DEBUG levels and still have useful logs.

- Changed log selection query to be less affected by long running
  transaction.  This should help, in particular, the scenario where
  it takes a very long time to subscribe to a set.  In that situation,
  we have had the problem where applying the later SYNCs gets
  extremely costly as the query selecting logs wound up forced into a
  Seq Scan rather than an index scan.

- Removed all support for STORE/DROP TRIGGER commands. Users 
  should use the ALTER TABLE [ENABLE|DISABLE] TRIGGER functionality 
  available directly in Postgres from now on.

- Improve Wiki page generation script so that it has an option to add in
  a set of [[Category:Foo]] tags to allow automated categorization.

- Documented how to fix tables that presently use Slony-I-generated
  primary key candidates generated by TABLE ADD KEY

- Add some specific timestamps during the 2007 "DST rule change
  ambiguous time" (e.g. - during the period which, under former rules,
  was not DST, but which now is, due to the recent rule change).

  Bill Moran ran into some problems with such dates; varying
  PostgreSQL versions returned somewhat varying results.  This wasn't
  a Slony-I problem; the data was indeed being replicated correctly.

- Made configure a bit smarter about automatically locating
  docbook2man-spec.pl on Debian, Fedora, BSD.

- Tests now generate |pipe|delimited|output| indicating a number of
  attributes of each test, including system/platform information,
  versions, and whether or not the test succeeded or failed.

- Revised functions that generate listen paths

- tools/configure-replication.sh script permits specifying a
  destination path for generated config files.  This enables using
  it within automated processes, and makes it possible to use it to
  generate Slonik scripts for tests in the "test bed," which has
  the further merit of making tools/configure-replication.sh a
  regularly-regression-tested tool.

- Fix to bug #15 - where long cluster name (>40 chars) leads to
  things breaking when an index name is created that contains
  the cluster name.

  -> Warn upon creating a long cluster name.
  -> Give a useful exception that explains the cause rather
     than merely watching index creation fail.

   http://www.slony.info/bugzilla/show_bug.cgi?id=15

- Fix for bug #19 - added a script to help the administrator
  search for any triggers on the database that is the source for
  a schema that is to be used to initialize a log shipping node.

  The problem is that some/most/sometimes all triggers and rules
  are likely to need to be dropped from the log shipping node lest
  they interfere with replication.

- Elimination of custom "xxid" functions

  PostgreSQL 8.3 introduces a set of "txid" functions and a
  "txid_snapshot" type, which eliminates the need for Slony-I to have
  its own C functions for doing XID comparisons.

  Note that this affects the structure of sl_event, and leads to some
  changes in the coding of the regression tests.

  This eliminates the src/xxid directory and contents

- All of the interesting cleanup work is now done in the stored
  function, cleanupEvent(interval, boolean).

  Interesting side-effect: You can now induce a cleanup manually,
  which will be useful for testing.

- cleanupEvent now has two parameters, passed in from slon config
  parameters:

  interval - cleanup_interval (default '10 minutes')

   This controls how quickly old events are trimmed out.  It used to
   be a hard-coded value.

   Old events are trimmed out once the confirmations are aged by
   (cleanup_interval).

   This then controls when the data in sl_log_1/sl_log_2 can be
   dropped.

   Data in *those* tables is deleted when it is older than the
   earliest XID still captured in sl_event.

  boolean - cleanup_deletelogs (default 'false')

   This controls whether or not we DELETE data from sl_log_1/sl_log_2

   By default, we now NEVER delete data from the log tables; we
   instead use TRUNCATE.

- We now consider initiating a log switch every time cleanupEvent()
  runs.

  If the call to logswitch_finish() indicates that there was no log
  switch in progress, we initiate one.

  This means that log switches will be initiated almost as often as
  possible.  That's a policy well worth debating :-).

- logswitch_finish() changes a fair bit...

  It uses the same logic as in cleanupEvent() to determine if there
  are any *relevant* tuples left in sl_log_[whatever], rather than
  (potentially) scanning the table to see if there are any undeleted
  tuples left.

- At slon startup time, it logs (at SLON_CONFIG level) all of the
  parameter values.  Per Bugzilla entry #21.

  http://www.slony.info/bugzilla/show_bug.cgi?id=21

- New slonik "CLONE PREPARE" and "CLONE FINISH" command to assist in
  creating duplicate nodes based on taking a copy of some existing
  subscriber node.

- We no longer use LISTEN/NOTIFY for events and confirmations, which
  eliminates the usage that has caused pg_listener bloat.  We instead
  poll against the event table.

- Various instances where slonik would use a default node ID of 1 have
  been changed to remove this.

  Slonik scripts may need to be changed to indicate an EVENT NODE (or
  similar) after migration to v2.0 as a result.

  The slonik commands involved:

  - STORE NODE - EVENT NODE
  - DROP NODE - EVENT NODE
  - WAIT FOR EVENT - WAIT ON
  - FAILOVER - BACKUP NODE
  - EXECUTE SCRIPT - EVENT NODE

- Fixed a problem where ACCEPT_SET would wait for the corresponding
  MOVE_SET or FAILOVER_SET to arrive while holding an exclusive lock
  on sl_config_lock, preventing the other remote worker to process
  that event.

-- 
"cbbrowne","@","ca.afilias.info"
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
From alex at bengler.no  Fri Jun 27 16:13:55 2008
From: alex at bengler.no (Alexander Staubo)
Date: Fri Jun 27 16:14:12 2008
Subject: [Slony1-general] Replication of sequences required?
In-Reply-To: <60vdzuzmy4.fsf@dba2.int.libertyrms.com>
References: <88daf38c0806271156s63d979eakc0816abb226dc445@mail.gmail.com>
	<60vdzuzmy4.fsf@dba2.int.libertyrms.com>
Message-ID: <88daf38c0806271613h16e0b1bau8f25282860a64bd6@mail.gmail.com>

On Fri, Jun 27, 2008 at 9:40 PM, Christopher Browne
<cbbrowne@ca.afilias.info> wrote:
> If you never care about failover or moving the "master" role around,
> then you're correct, there is no real need to replicate sequences.

Thanks!

Alexander.
From depesz at depesz.com  Sun Jun 29 09:15:26 2008
From: depesz at depesz.com (hubert depesz lubaczewski)
Date: Sun Jun 29 09:15:39 2008
Subject: [Slony1-general] what exactly is "sync event"?
Message-ID: <20080629161526.GA22014@depesz.com>

hi,
basically the question is simple: there is sl_status and it shows lag in
events.
i know that some events are "system" ones (like add table and so on),
but there is sync event which sends data.

what it really is? when slony creates new sync event? is it related to
modification statements? modification transactions? time intervals?

i would really like to understand, so if it is clearly defined/described
some place i would really love to get pointer to this place. or perhaps
a description in here, on the list.

best regards,

depesz

From bijayant4u at yahoo.com  Mon Jun 30 06:29:27 2008
From: bijayant4u at yahoo.com (bijayant kumar)
Date: Mon Jun 30 06:29:31 2008
Subject: [Slony1-general] Node is not initialized properly
Message-ID: <151680.49768.qm@web32701.mail.mud.yahoo.com>

Hello list,

I am a very new user of slony1 so please forgive me if i am asking very stupid question. 
I have installed Postgresql and Slony1 on two gentoo machine. Postgresql is working fine no problem at all. I want to use Slony1 to replicate the two databases across the systems. To understand the slony1 concept i made a 
test database with one single table and only one entry into it. But when i start slony1 i get error like

2008-06-30 15:54:55 IST ERROR  cannot get sl_local_node_id - ERROR:  schema "_bijayant" does not exist
2008-06-30 15:54:55 IST FATAL  main: Node is not initialized properly - sleep 10s

Now i am giving here my configuration details.

/* Master Server */
IP Address 192.168.99.23
Database name bijayant
Table name kavach

bijayant=# select * from kavach;
 id |   name   | designation |   address
----+----------+-------------+-------------
  1 | Bijayant | consultant  | Lakkasandra
(1 row)


vi /etc/slon_tools.conf

if ($ENV{"SLONYNODES"}) {
    require $ENV{"SLONYNODES"};
} else {
    $CLUSTER_NAME = 'bijayant';
    $LOGDIR = '/var/log/slony';
    $MASTERNODE = 1;
    add_node(node     => 1,
             host     => '192.168.99.23',
             dbname   => 'bijayant',
             port     => 5432,
             user     => 'bijayant',
             password => 'bijayant');

    add_node(node     => 2,
             host     => '192.168.99.134',
             dbname   => 'bijayant',
             port     => 5432,
             user     => 'bijayant',
             password => 'bijayant',
             parent => 1
             );
}

$SLONY_SETS = {
                "set1" => {
                           "set_id" => 1,
                           "pkeyedtables" => [
                           'public.kavach',
                           ],
        },
if ($ENV{"SLONYSET"}) {
    require $ENV{"SLONYSET"};
}

1;

vi /etc/conf.d/slony1
USER=postgres
CLUSTER=bijayant
DBUSER=bijayant
DBNAME=bijayant
DBHOST=192.168.99.23
LOGFILE=/var/lib/postgresql/data/slony1.log
LOGLEVEL=4

/* On the Slave Server */

IP Address 192.168.99.134
Database name bijayant
Table name kavach

vi /etc/slon_tools.conf

if ($ENV{"SLONYNODES"}) {
    require $ENV{"SLONYNODES"};
} else {
    $CLUSTER_NAME = 'bijayant';
    $LOGDIR = '/var/log/slony';
    # SYNC check interval (slon -s option)
    # $SYNC_CHECK_INTERVAL = 1000;
    $MASTERNODE = 1;
    add_node(node     => 1,
             host     => '192.168.99.23',
             dbname   => 'bijayant',
             port     => 5432,
             user     => 'bijayant',
             password => 'bijayant');

    add_node(node     => 2,
             host     => '192.168.99.134',
             dbname   => 'bijayant',
             port     => 5432,
             user     => 'bijayant',
             password => 'bijayant',
             parent => 1
             );
}
$SLONY_SETS = {
    "set1" => {
               "set_id" => 1,
                "pkeyedtables" => [
                                  'public.kavach',
                                  ],
              },
};

if ($ENV{"SLONYSET"}) {
    require $ENV{"SLONYSET"};
}

1;

vi /etc/conf.d/slony1
USER=postgres
CLUSTER=bijayant
DBUSER=bijayant
DBNAME=bijayant
DBHOST=192.168.99.23
LOGFILE=/var/lib/postgresql/data/slony1.log
LOGLEVEL=4 

When i start the slony1 /etc/init.d/slony1 start on both the machine it generates lots of logs with errors line like

2008-06-30 15:54:55 IST DEBUG2 slon_retry() from pid=19007
2008-06-30 15:54:55 IST DEBUG1 slon: retry requested
2008-06-30 15:54:55 IST DEBUG2 slon: notify worker process to shutdown
2008-06-30 15:54:55 IST DEBUG2 slon: child terminated status: 0; pid: 19007, current worker pid: 19007
2008-06-30 15:54:55 IST DEBUG1 slon: restart of worker
2008-06-30 15:54:55 IST CONFIG main: slon version 1.2.10 starting up
2008-06-30 15:54:55 IST DEBUG2 slon: watchdog process started
2008-06-30 15:54:55 IST DEBUG2 slon: watchdog ready - pid = 19005
2008-06-30 15:54:55 IST DEBUG2 slon: worker process created - pid = 19034
2008-06-30 15:54:55 IST ERROR  cannot get sl_local_node_id - ERROR:  schema "_bijayant" does not exist
2008-06-30 15:54:55 IST FATAL  main: Node is not initialized properly - sleep 10s

I am sure that i am not understanding some basic things about the slony1. Can anybody help me to understand the logic, i will be very helpful for you all. Please tell me what i am doing wrong here, what should i do. I have read the documentation at the website but not able to understand fully. Please help me out.

Thanks & Regards,
Bijayant Kumar

Send instant messages to your online friends http://uk.messenger.yahoo.com 
From m.eriksson at albourne.com  Mon Jun 30 06:48:16 2008
From: m.eriksson at albourne.com (Martin Eriksson)
Date: Mon Jun 30 06:48:36 2008
Subject: [Slony1-general] Node is not initialized properly
In-Reply-To: <151680.49768.qm@web32701.mail.mud.yahoo.com>
References: <151680.49768.qm@web32701.mail.mud.yahoo.com>
Message-ID: <4868E420.7040800@albourne.com>

Very basic, but saw no mention of it in the e-mail,

I assume you ran the "slonik_init_cluster" before trying to start the 
slon daemons? as that does the slony setup on each of the dbs



bijayant kumar wrote:
> Hello list,
>
> I am a very new user of slony1 so please forgive me if i am asking very stupid question. 
> I have installed Postgresql and Slony1 on two gentoo machine. Postgresql is working fine no problem at all. I want to use Slony1 to replicate the two databases across the systems. To understand the slony1 concept i made a 
> test database with one single table and only one entry into it. But when i start slony1 i get error like
>
> 2008-06-30 15:54:55 IST ERROR  cannot get sl_local_node_id - ERROR:  schema "_bijayant" does not exist
> 2008-06-30 15:54:55 IST FATAL  main: Node is not initialized properly - sleep 10s
>
> Now i am giving here my configuration details.
>
> /* Master Server */
> IP Address 192.168.99.23
> Database name bijayant
> Table name kavach
>
> bijayant=# select * from kavach;
>  id |   name   | designation |   address
> ----+----------+-------------+-------------
>   1 | Bijayant | consultant  | Lakkasandra
> (1 row)
>
>
> vi /etc/slon_tools.conf
>
> if ($ENV{"SLONYNODES"}) {
>     require $ENV{"SLONYNODES"};
> } else {
>     $CLUSTER_NAME = 'bijayant';
>     $LOGDIR = '/var/log/slony';
>     $MASTERNODE = 1;
>     add_node(node     => 1,
>              host     => '192.168.99.23',
>              dbname   => 'bijayant',
>              port     => 5432,
>              user     => 'bijayant',
>              password => 'bijayant');
>
>     add_node(node     => 2,
>              host     => '192.168.99.134',
>              dbname   => 'bijayant',
>              port     => 5432,
>              user     => 'bijayant',
>              password => 'bijayant',
>              parent => 1
>              );
> }
>
> $SLONY_SETS = {
>                 "set1" => {
>                            "set_id" => 1,
>                            "pkeyedtables" => [
>                            'public.kavach',
>                            ],
>         },
> if ($ENV{"SLONYSET"}) {
>     require $ENV{"SLONYSET"};
> }
>
> 1;
>
> vi /etc/conf.d/slony1
> USER=postgres
> CLUSTER=bijayant
> DBUSER=bijayant
> DBNAME=bijayant
> DBHOST=192.168.99.23
> LOGFILE=/var/lib/postgresql/data/slony1.log
> LOGLEVEL=4
>
> /* On the Slave Server */
>
> IP Address 192.168.99.134
> Database name bijayant
> Table name kavach
>
> vi /etc/slon_tools.conf
>
> if ($ENV{"SLONYNODES"}) {
>     require $ENV{"SLONYNODES"};
> } else {
>     $CLUSTER_NAME = 'bijayant';
>     $LOGDIR = '/var/log/slony';
>     # SYNC check interval (slon -s option)
>     # $SYNC_CHECK_INTERVAL = 1000;
>     $MASTERNODE = 1;
>     add_node(node     => 1,
>              host     => '192.168.99.23',
>              dbname   => 'bijayant',
>              port     => 5432,
>              user     => 'bijayant',
>              password => 'bijayant');
>
>     add_node(node     => 2,
>              host     => '192.168.99.134',
>              dbname   => 'bijayant',
>              port     => 5432,
>              user     => 'bijayant',
>              password => 'bijayant',
>              parent => 1
>              );
> }
> $SLONY_SETS = {
>     "set1" => {
>                "set_id" => 1,
>                 "pkeyedtables" => [
>                                   'public.kavach',
>                                   ],
>               },
> };
>
> if ($ENV{"SLONYSET"}) {
>     require $ENV{"SLONYSET"};
> }
>
> 1;
>
> vi /etc/conf.d/slony1
> USER=postgres
> CLUSTER=bijayant
> DBUSER=bijayant
> DBNAME=bijayant
> DBHOST=192.168.99.23
> LOGFILE=/var/lib/postgresql/data/slony1.log
> LOGLEVEL=4 
>
> When i start the slony1 /etc/init.d/slony1 start on both the machine it generates lots of logs with errors line like
>
> 2008-06-30 15:54:55 IST DEBUG2 slon_retry() from pid=19007
> 2008-06-30 15:54:55 IST DEBUG1 slon: retry requested
> 2008-06-30 15:54:55 IST DEBUG2 slon: notify worker process to shutdown
> 2008-06-30 15:54:55 IST DEBUG2 slon: child terminated status: 0; pid: 19007, current worker pid: 19007
> 2008-06-30 15:54:55 IST DEBUG1 slon: restart of worker
> 2008-06-30 15:54:55 IST CONFIG main: slon version 1.2.10 starting up
> 2008-06-30 15:54:55 IST DEBUG2 slon: watchdog process started
> 2008-06-30 15:54:55 IST DEBUG2 slon: watchdog ready - pid = 19005
> 2008-06-30 15:54:55 IST DEBUG2 slon: worker process created - pid = 19034
> 2008-06-30 15:54:55 IST ERROR  cannot get sl_local_node_id - ERROR:  schema "_bijayant" does not exist
> 2008-06-30 15:54:55 IST FATAL  main: Node is not initialized properly - sleep 10s
>
> I am sure that i am not understanding some basic things about the slony1. Can anybody help me to understand the logic, i will be very helpful for you all. Please tell me what i am doing wrong here, what should i do. I have read the documentation at the website but not able to understand fully. Please help me out.
>
> Thanks & Regards,
> Bijayant Kumar
>
> Send instant messages to your online friends http://uk.messenger.yahoo.com 
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>   

From bijayant4u at yahoo.com  Mon Jun 30 06:58:47 2008
From: bijayant4u at yahoo.com (bijayant kumar)
Date: Mon Jun 30 06:58:52 2008
Subject: [Slony1-general] Node is not initialized properly
In-Reply-To: <4868E420.7040800@albourne.com>
Message-ID: <212398.88459.qm@web32705.mail.mud.yahoo.com>

Thanks for the reply. I executed the command "slonik_init_cluster".It gives the output like

# INIT CLUSTER
cluster name = bijayant;
 node 1 admin conninfo='host=192.168.99.23 dbname=bijayant user=bijayant port=5432 password=bijayant';
 node 2 admin conninfo='host=192.168.99.134 dbname=bijayant user=bijayant port=5432 password=bijayant';
  init cluster (id = 1, comment = 'Node 1 - bijayant@192.168.99.23');

# STORE NODE
  store node (id = 2, event node = 1, comment = 'Node 2 - bijayant@192.168.99.134');
  echo 'Set up replication nodes';

# STORE PATH
  echo 'Next: configure paths for each node/origin';
  store path (server = 1, client = 2, conninfo = 'host=192.168.99.23 dbname=bijayant user=bijayant port=5432 password=bijayant');
  store path (server = 2, client = 1, conninfo = 'host=192.168.99.134 dbname=bijayant user=bijayant port=5432 password=bijayant');
  echo 'Replication nodes prepared';
  echo 'Please start a slon replication daemon for each node';

After that i run the slonik daemon and got the error mentioned.


Bijayant Kumar


--- On Mon, 30/6/08, Martin Eriksson <m.eriksson@albourne.com> wrote:

> From: Martin Eriksson <m.eriksson@albourne.com>
> Subject: Re: [Slony1-general] Node is not initialized properly
> To: 
> Cc: slony1-general@lists.slony.info
> Date: Monday, 30 June, 2008, 7:18 PM
> Very basic, but saw no mention of it in the e-mail,
> 
> I assume you ran the "slonik_init_cluster" before
> trying to start the 
> slon daemons? as that does the slony setup on each of the
> dbs
> 
> 
> 
> bijayant kumar wrote:
> > Hello list,
> >
> > I am a very new user of slony1 so please forgive me if
> i am asking very stupid question. 
> > I have installed Postgresql and Slony1 on two gentoo
> machine. Postgresql is working fine no problem at all. I
> want to use Slony1 to replicate the two databases across
> the systems. To understand the slony1 concept i made a 
> > test database with one single table and only one entry
> into it. But when i start slony1 i get error like
> >
> > 2008-06-30 15:54:55 IST ERROR  cannot get
> sl_local_node_id - ERROR:  schema "_bijayant"
> does not exist
> > 2008-06-30 15:54:55 IST FATAL  main: Node is not
> initialized properly - sleep 10s
> >
> > Now i am giving here my configuration details.
> >
> > /* Master Server */
> > IP Address 192.168.99.23
> > Database name bijayant
> > Table name kavach
> >
> > bijayant=# select * from kavach;
> >  id |   name   | designation |   address
> > ----+----------+-------------+-------------
> >   1 | Bijayant | consultant  | Lakkasandra
> > (1 row)
> >
> >
> > vi /etc/slon_tools.conf
> >
> > if ($ENV{"SLONYNODES"}) {
> >     require $ENV{"SLONYNODES"};
> > } else {
> >     $CLUSTER_NAME = 'bijayant';
> >     $LOGDIR = '/var/log/slony';
> >     $MASTERNODE = 1;
> >     add_node(node     => 1,
> >              host     => '192.168.99.23',
> >              dbname   => 'bijayant',
> >              port     => 5432,
> >              user     => 'bijayant',
> >              password => 'bijayant');
> >
> >     add_node(node     => 2,
> >              host     => '192.168.99.134',
> >              dbname   => 'bijayant',
> >              port     => 5432,
> >              user     => 'bijayant',
> >              password => 'bijayant',
> >              parent => 1
> >              );
> > }
> >
> > $SLONY_SETS = {
> >                 "set1" => {
> >                            "set_id" => 1,
> >                            "pkeyedtables"
> => [
> >                            'public.kavach',
> >                            ],
> >         },
> > if ($ENV{"SLONYSET"}) {
> >     require $ENV{"SLONYSET"};
> > }
> >
> > 1;
> >
> > vi /etc/conf.d/slony1
> > USER=postgres
> > CLUSTER=bijayant
> > DBUSER=bijayant
> > DBNAME=bijayant
> > DBHOST=192.168.99.23
> > LOGFILE=/var/lib/postgresql/data/slony1.log
> > LOGLEVEL=4
> >
> > /* On the Slave Server */
> >
> > IP Address 192.168.99.134
> > Database name bijayant
> > Table name kavach
> >
> > vi /etc/slon_tools.conf
> >
> > if ($ENV{"SLONYNODES"}) {
> >     require $ENV{"SLONYNODES"};
> > } else {
> >     $CLUSTER_NAME = 'bijayant';
> >     $LOGDIR = '/var/log/slony';
> >     # SYNC check interval (slon -s option)
> >     # $SYNC_CHECK_INTERVAL = 1000;
> >     $MASTERNODE = 1;
> >     add_node(node     => 1,
> >              host     => '192.168.99.23',
> >              dbname   => 'bijayant',
> >              port     => 5432,
> >              user     => 'bijayant',
> >              password => 'bijayant');
> >
> >     add_node(node     => 2,
> >              host     => '192.168.99.134',
> >              dbname   => 'bijayant',
> >              port     => 5432,
> >              user     => 'bijayant',
> >              password => 'bijayant',
> >              parent => 1
> >              );
> > }
> > $SLONY_SETS = {
> >     "set1" => {
> >                "set_id" => 1,
> >                 "pkeyedtables" => [
> >                                  
> 'public.kavach',
> >                                   ],
> >               },
> > };
> >
> > if ($ENV{"SLONYSET"}) {
> >     require $ENV{"SLONYSET"};
> > }
> >
> > 1;
> >
> > vi /etc/conf.d/slony1
> > USER=postgres
> > CLUSTER=bijayant
> > DBUSER=bijayant
> > DBNAME=bijayant
> > DBHOST=192.168.99.23
> > LOGFILE=/var/lib/postgresql/data/slony1.log
> > LOGLEVEL=4 
> >
> > When i start the slony1 /etc/init.d/slony1 start on
> both the machine it generates lots of logs with errors line
> like
> >
> > 2008-06-30 15:54:55 IST DEBUG2 slon_retry() from
> pid=19007
> > 2008-06-30 15:54:55 IST DEBUG1 slon: retry requested
> > 2008-06-30 15:54:55 IST DEBUG2 slon: notify worker
> process to shutdown
> > 2008-06-30 15:54:55 IST DEBUG2 slon: child terminated
> status: 0; pid: 19007, current worker pid: 19007
> > 2008-06-30 15:54:55 IST DEBUG1 slon: restart of worker
> > 2008-06-30 15:54:55 IST CONFIG main: slon version
> 1.2.10 starting up
> > 2008-06-30 15:54:55 IST DEBUG2 slon: watchdog process
> started
> > 2008-06-30 15:54:55 IST DEBUG2 slon: watchdog ready -
> pid = 19005
> > 2008-06-30 15:54:55 IST DEBUG2 slon: worker process
> created - pid = 19034
> > 2008-06-30 15:54:55 IST ERROR  cannot get
> sl_local_node_id - ERROR:  schema "_bijayant"
> does not exist
> > 2008-06-30 15:54:55 IST FATAL  main: Node is not
> initialized properly - sleep 10s
> >
> > I am sure that i am not understanding some basic
> things about the slony1. Can anybody help me to understand
> the logic, i will be very helpful for you all. Please tell
> me what i am doing wrong here, what should i do. I have
> read the documentation at the website but not able to
> understand fully. Please help me out.
> >
> > Thanks & Regards,
> > Bijayant Kumar
> >
> > Send instant messages to your online friends
> http://uk.messenger.yahoo.com 
> > _______________________________________________
> > Slony1-general mailing list
> > Slony1-general@lists.slony.info
> >
> http://lists.slony.info/mailman/listinfo/slony1-general
> >   
> 
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general

Send instant messages to your online friends http://uk.messenger.yahoo.com 
From open at immo.ru  Mon Jun 30 06:56:54 2008
From: open at immo.ru (open)
Date: Mon Jun 30 07:01:32 2008
Subject: [Slony1-general] Node is not initialized properly
In-Reply-To: <212398.88459.qm@web32705.mail.mud.yahoo.com>
References: <212398.88459.qm@web32705.mail.mud.yahoo.com>
Message-ID: <4868E626.6080606@immo.ru>

An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080630/04859016/attachment-0001.htm
From glynastill at yahoo.co.uk  Mon Jun 30 07:09:28 2008
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Mon Jun 30 07:09:33 2008
Subject: [Slony1-general] Node is not initialized properly
Message-ID: <705634.98531.qm@web25801.mail.ukl.yahoo.com>

Check to see if you have the _bijayant schema in your bijayant database, if not then the init cluster never got created.

I've never used the slony tools, but it looks like the output you got from slonik_init_cluster didn't actually get run through slonik. Perhaps you have to pipe the output into slonik?



----- Original Message ----
> From: bijayant kumar <bijayant4u@yahoo.com>
> To: Martin Eriksson <m.eriksson@albourne.com>
> Cc: slony1-general@lists.slony.info
> Sent: Monday, 30 June, 2008 2:58:47 PM
> Subject: Re: [Slony1-general] Node is not initialized properly
> 
> Thanks for the reply. I executed the command "slonik_init_cluster".It gives the 
> output like
> 
> # INIT CLUSTER
> cluster name = bijayant;
> node 1 admin conninfo='host=192.168.99.23 dbname=bijayant user=bijayant 
> port=5432 password=bijayant';
> node 2 admin conninfo='host=192.168.99.134 dbname=bijayant user=bijayant 
> port=5432 password=bijayant';
>   init cluster (id = 1, comment = 'Node 1 - bijayant@192.168.99.23');
> 
> # STORE NODE
>   store node (id = 2, event node = 1, comment = 'Node 2 - 
> bijayant@192.168.99.134');
>   echo 'Set up replication nodes';
> 
> # STORE PATH
>   echo 'Next: configure paths for each node/origin';
>   store path (server = 1, client = 2, conninfo = 'host=192.168.99.23 
> dbname=bijayant user=bijayant port=5432 password=bijayant');
>   store path (server = 2, client = 1, conninfo = 'host=192.168.99.134 
> dbname=bijayant user=bijayant port=5432 password=bijayant');
>   echo 'Replication nodes prepared';
>   echo 'Please start a slon replication daemon for each node';
> 
> After that i run the slonik daemon and got the error mentioned.
> 
> 
> Bijayant Kumar
> 
> 
> --- On Mon, 30/6/08, Martin Eriksson wrote:
> 
> > From: Martin Eriksson 
> > Subject: Re: [Slony1-general] Node is not initialized properly
> > To: 
> > Cc: slony1-general@lists.slony.info
> > Date: Monday, 30 June, 2008, 7:18 PM
> > Very basic, but saw no mention of it in the e-mail,
> > 
> > I assume you ran the "slonik_init_cluster" before
> > trying to start the 
> > slon daemons? as that does the slony setup on each of the
> > dbs
> > 
> > 
> > 
> > bijayant kumar wrote:
> > > Hello list,
> > >
> > > I am a very new user of slony1 so please forgive me if
> > i am asking very stupid question. 
> > > I have installed Postgresql and Slony1 on two gentoo
> > machine. Postgresql is working fine no problem at all. I
> > want to use Slony1 to replicate the two databases across
> > the systems. To understand the slony1 concept i made a 
> > > test database with one single table and only one entry
> > into it. But when i start slony1 i get error like
> > >
> > > 2008-06-30 15:54:55 IST ERROR  cannot get
> > sl_local_node_id - ERROR:  schema "_bijayant"
> > does not exist
> > > 2008-06-30 15:54:55 IST FATAL  main: Node is not
> > initialized properly - sleep 10s
> > >
> > > Now i am giving here my configuration details.
> > >
> > > /* Master Server */
> > > IP Address 192.168.99.23
> > > Database name bijayant
> > > Table name kavach
> > >
> > > bijayant=# select * from kavach;
> > >  id |   name   | designation |   address
> > > ----+----------+-------------+-------------
> > >   1 | Bijayant | consultant  | Lakkasandra
> > > (1 row)
> > >
> > >
> > > vi /etc/slon_tools.conf
> > >
> > > if ($ENV{"SLONYNODES"}) {
> > >     require $ENV{"SLONYNODES"};
> > > } else {
> > >     $CLUSTER_NAME = 'bijayant';
> > >     $LOGDIR = '/var/log/slony';
> > >     $MASTERNODE = 1;
> > >     add_node(node     => 1,
> > >              host     => '192.168.99.23',
> > >              dbname   => 'bijayant',
> > >              port     => 5432,
> > >              user     => 'bijayant',
> > >              password => 'bijayant');
> > >
> > >     add_node(node     => 2,
> > >              host     => '192.168.99.134',
> > >              dbname   => 'bijayant',
> > >              port     => 5432,
> > >              user     => 'bijayant',
> > >              password => 'bijayant',
> > >              parent => 1
> > >              );
> > > }
> > >
> > > $SLONY_SETS = {
> > >                 "set1" => {
> > >                            "set_id" => 1,
> > >                            "pkeyedtables"
> > => [
> > >                            'public.kavach',
> > >                            ],
> > >         },
> > > if ($ENV{"SLONYSET"}) {
> > >     require $ENV{"SLONYSET"};
> > > }
> > >
> > > 1;
> > >
> > > vi /etc/conf.d/slony1
> > > USER=postgres
> > > CLUSTER=bijayant
> > > DBUSER=bijayant
> > > DBNAME=bijayant
> > > DBHOST=192.168.99.23
> > > LOGFILE=/var/lib/postgresql/data/slony1.log
> > > LOGLEVEL=4
> > >
> > > /* On the Slave Server */
> > >
> > > IP Address 192.168.99.134
> > > Database name bijayant
> > > Table name kavach
> > >
> > > vi /etc/slon_tools.conf
> > >
> > > if ($ENV{"SLONYNODES"}) {
> > >     require $ENV{"SLONYNODES"};
> > > } else {
> > >     $CLUSTER_NAME = 'bijayant';
> > >     $LOGDIR = '/var/log/slony';
> > >     # SYNC check interval (slon -s option)
> > >     # $SYNC_CHECK_INTERVAL = 1000;
> > >     $MASTERNODE = 1;
> > >     add_node(node     => 1,
> > >              host     => '192.168.99.23',
> > >              dbname   => 'bijayant',
> > >              port     => 5432,
> > >              user     => 'bijayant',
> > >              password => 'bijayant');
> > >
> > >     add_node(node     => 2,
> > >              host     => '192.168.99.134',
> > >              dbname   => 'bijayant',
> > >              port     => 5432,
> > >              user     => 'bijayant',
> > >              password => 'bijayant',
> > >              parent => 1
> > >              );
> > > }
> > > $SLONY_SETS = {
> > >     "set1" => {
> > >                "set_id" => 1,
> > >                 "pkeyedtables" => [
> > >                                  
> > 'public.kavach',
> > >                                   ],
> > >               },
> > > };
> > >
> > > if ($ENV{"SLONYSET"}) {
> > >     require $ENV{"SLONYSET"};
> > > }
> > >
> > > 1;
> > >
> > > vi /etc/conf.d/slony1
> > > USER=postgres
> > > CLUSTER=bijayant
> > > DBUSER=bijayant
> > > DBNAME=bijayant
> > > DBHOST=192.168.99.23
> > > LOGFILE=/var/lib/postgresql/data/slony1.log
> > > LOGLEVEL=4 
> > >
> > > When i start the slony1 /etc/init.d/slony1 start on
> > both the machine it generates lots of logs with errors line
> > like
> > >
> > > 2008-06-30 15:54:55 IST DEBUG2 slon_retry() from
> > pid=19007
> > > 2008-06-30 15:54:55 IST DEBUG1 slon: retry requested
> > > 2008-06-30 15:54:55 IST DEBUG2 slon: notify worker
> > process to shutdown
> > > 2008-06-30 15:54:55 IST DEBUG2 slon: child terminated
> > status: 0; pid: 19007, current worker pid: 19007
> > > 2008-06-30 15:54:55 IST DEBUG1 slon: restart of worker
> > > 2008-06-30 15:54:55 IST CONFIG main: slon version
> > 1.2.10 starting up
> > > 2008-06-30 15:54:55 IST DEBUG2 slon: watchdog process
> > started
> > > 2008-06-30 15:54:55 IST DEBUG2 slon: watchdog ready -
> > pid = 19005
> > > 2008-06-30 15:54:55 IST DEBUG2 slon: worker process
> > created - pid = 19034
> > > 2008-06-30 15:54:55 IST ERROR  cannot get
> > sl_local_node_id - ERROR:  schema "_bijayant"
> > does not exist
> > > 2008-06-30 15:54:55 IST FATAL  main: Node is not
> > initialized properly - sleep 10s
> > >
> > > I am sure that i am not understanding some basic
> > things about the slony1. Can anybody help me to understand
> > the logic, i will be very helpful for you all. Please tell
> > me what i am doing wrong here, what should i do. I have
> > read the documentation at the website but not able to
> > understand fully. Please help me out.
> > >
> > > Thanks & Regards,
> > > Bijayant Kumar
> > >
> > > Send instant messages to your online friends
> > http://uk.messenger.yahoo.com 
> > > _______________________________________________
> > > Slony1-general mailing list
> > > Slony1-general@lists.slony.info
> > >
> > http://lists.slony.info/mailman/listinfo/slony1-general
> > >  
> > 
> > _______________________________________________
> > Slony1-general mailing list
> > Slony1-general@lists.slony.info
> > http://lists.slony.info/mailman/listinfo/slony1-general
> 
> Send instant messages to your online friends http://uk.messenger.yahoo.com
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general



      __________________________________________________________
Not happy with your email address?.
Get the one you really want - millions of new email addresses available now at Yahoo! http://uk.docs.yahoo.com/ymail/new.html
From m.eriksson at albourne.com  Mon Jun 30 08:04:24 2008
From: m.eriksson at albourne.com (Martin Eriksson)
Date: Mon Jun 30 08:04:36 2008
Subject: [Slony1-general] Node is not initialized properly
In-Reply-To: <212398.88459.qm@web32705.mail.mud.yahoo.com>
References: <212398.88459.qm@web32705.mail.mud.yahoo.com>
Message-ID: <4868F5F8.3060008@albourne.com>

If you only run it like that, it only prints what it will execute, to 
actually execute this you need to | it to the slonik app..

eg. /data/pgsql/slony/slonik_init_cluster --config <file> | 
/data/pgsql/bin/slonik

all scripts starting with "slonik_" doesn't actually do anything 
themself, its just a way to format a command correctly for the slonik 
parser, which actually does the work..



bijayant kumar wrote:
> Thanks for the reply. I executed the command "slonik_init_cluster".It gives the output like
>
> # INIT CLUSTER
> cluster name = bijayant;
>  node 1 admin conninfo='host=192.168.99.23 dbname=bijayant user=bijayant port=5432 password=bijayant';
>  node 2 admin conninfo='host=192.168.99.134 dbname=bijayant user=bijayant port=5432 password=bijayant';
>   init cluster (id = 1, comment = 'Node 1 - bijayant@192.168.99.23');
>
> # STORE NODE
>   store node (id = 2, event node = 1, comment = 'Node 2 - bijayant@192.168.99.134');
>   echo 'Set up replication nodes';
>
> # STORE PATH
>   echo 'Next: configure paths for each node/origin';
>   store path (server = 1, client = 2, conninfo = 'host=192.168.99.23 dbname=bijayant user=bijayant port=5432 password=bijayant');
>   store path (server = 2, client = 1, conninfo = 'host=192.168.99.134 dbname=bijayant user=bijayant port=5432 password=bijayant');
>   echo 'Replication nodes prepared';
>   echo 'Please start a slon replication daemon for each node';
>
> After that i run the slonik daemon and got the error mentioned.
>
>
> Bijayant Kumar
>
>
> --- On Mon, 30/6/08, Martin Eriksson <m.eriksson@albourne.com> wrote:
>
>   
>> From: Martin Eriksson <m.eriksson@albourne.com>
>> Subject: Re: [Slony1-general] Node is not initialized properly
>> To: 
>> Cc: slony1-general@lists.slony.info
>> Date: Monday, 30 June, 2008, 7:18 PM
>> Very basic, but saw no mention of it in the e-mail,
>>
>> I assume you ran the "slonik_init_cluster" before
>> trying to start the 
>> slon daemons? as that does the slony setup on each of the
>> dbs
>>
>>
>>
>> bijayant kumar wrote:
>>     
>>> Hello list,
>>>
>>> I am a very new user of slony1 so please forgive me if
>>>       
>> i am asking very stupid question. 
>>     
>>> I have installed Postgresql and Slony1 on two gentoo
>>>       
>> machine. Postgresql is working fine no problem at all. I
>> want to use Slony1 to replicate the two databases across
>> the systems. To understand the slony1 concept i made a 
>>     
>>> test database with one single table and only one entry
>>>       
>> into it. But when i start slony1 i get error like
>>     
>>> 2008-06-30 15:54:55 IST ERROR  cannot get
>>>       
>> sl_local_node_id - ERROR:  schema "_bijayant"
>> does not exist
>>     
>>> 2008-06-30 15:54:55 IST FATAL  main: Node is not
>>>       
>> initialized properly - sleep 10s
>>     
>>> Now i am giving here my configuration details.
>>>
>>> /* Master Server */
>>> IP Address 192.168.99.23
>>> Database name bijayant
>>> Table name kavach
>>>
>>> bijayant=# select * from kavach;
>>>  id |   name   | designation |   address
>>> ----+----------+-------------+-------------
>>>   1 | Bijayant | consultant  | Lakkasandra
>>> (1 row)
>>>
>>>
>>> vi /etc/slon_tools.conf
>>>
>>> if ($ENV{"SLONYNODES"}) {
>>>     require $ENV{"SLONYNODES"};
>>> } else {
>>>     $CLUSTER_NAME = 'bijayant';
>>>     $LOGDIR = '/var/log/slony';
>>>     $MASTERNODE = 1;
>>>     add_node(node     => 1,
>>>              host     => '192.168.99.23',
>>>              dbname   => 'bijayant',
>>>              port     => 5432,
>>>              user     => 'bijayant',
>>>              password => 'bijayant');
>>>
>>>     add_node(node     => 2,
>>>              host     => '192.168.99.134',
>>>              dbname   => 'bijayant',
>>>              port     => 5432,
>>>              user     => 'bijayant',
>>>              password => 'bijayant',
>>>              parent => 1
>>>              );
>>> }
>>>
>>> $SLONY_SETS = {
>>>                 "set1" => {
>>>                            "set_id" => 1,
>>>                            "pkeyedtables"
>>>       
>> => [
>>     
>>>                            'public.kavach',
>>>                            ],
>>>         },
>>> if ($ENV{"SLONYSET"}) {
>>>     require $ENV{"SLONYSET"};
>>> }
>>>
>>> 1;
>>>
>>> vi /etc/conf.d/slony1
>>> USER=postgres
>>> CLUSTER=bijayant
>>> DBUSER=bijayant
>>> DBNAME=bijayant
>>> DBHOST=192.168.99.23
>>> LOGFILE=/var/lib/postgresql/data/slony1.log
>>> LOGLEVEL=4
>>>
>>> /* On the Slave Server */
>>>
>>> IP Address 192.168.99.134
>>> Database name bijayant
>>> Table name kavach
>>>
>>> vi /etc/slon_tools.conf
>>>
>>> if ($ENV{"SLONYNODES"}) {
>>>     require $ENV{"SLONYNODES"};
>>> } else {
>>>     $CLUSTER_NAME = 'bijayant';
>>>     $LOGDIR = '/var/log/slony';
>>>     # SYNC check interval (slon -s option)
>>>     # $SYNC_CHECK_INTERVAL = 1000;
>>>     $MASTERNODE = 1;
>>>     add_node(node     => 1,
>>>              host     => '192.168.99.23',
>>>              dbname   => 'bijayant',
>>>              port     => 5432,
>>>              user     => 'bijayant',
>>>              password => 'bijayant');
>>>
>>>     add_node(node     => 2,
>>>              host     => '192.168.99.134',
>>>              dbname   => 'bijayant',
>>>              port     => 5432,
>>>              user     => 'bijayant',
>>>              password => 'bijayant',
>>>              parent => 1
>>>              );
>>> }
>>> $SLONY_SETS = {
>>>     "set1" => {
>>>                "set_id" => 1,
>>>                 "pkeyedtables" => [
>>>                                  
>>>       
>> 'public.kavach',
>>     
>>>                                   ],
>>>               },
>>> };
>>>
>>> if ($ENV{"SLONYSET"}) {
>>>     require $ENV{"SLONYSET"};
>>> }
>>>
>>> 1;
>>>
>>> vi /etc/conf.d/slony1
>>> USER=postgres
>>> CLUSTER=bijayant
>>> DBUSER=bijayant
>>> DBNAME=bijayant
>>> DBHOST=192.168.99.23
>>> LOGFILE=/var/lib/postgresql/data/slony1.log
>>> LOGLEVEL=4 
>>>
>>> When i start the slony1 /etc/init.d/slony1 start on
>>>       
>> both the machine it generates lots of logs with errors line
>> like
>>     
>>> 2008-06-30 15:54:55 IST DEBUG2 slon_retry() from
>>>       
>> pid=19007
>>     
>>> 2008-06-30 15:54:55 IST DEBUG1 slon: retry requested
>>> 2008-06-30 15:54:55 IST DEBUG2 slon: notify worker
>>>       
>> process to shutdown
>>     
>>> 2008-06-30 15:54:55 IST DEBUG2 slon: child terminated
>>>       
>> status: 0; pid: 19007, current worker pid: 19007
>>     
>>> 2008-06-30 15:54:55 IST DEBUG1 slon: restart of worker
>>> 2008-06-30 15:54:55 IST CONFIG main: slon version
>>>       
>> 1.2.10 starting up
>>     
>>> 2008-06-30 15:54:55 IST DEBUG2 slon: watchdog process
>>>       
>> started
>>     
>>> 2008-06-30 15:54:55 IST DEBUG2 slon: watchdog ready -
>>>       
>> pid = 19005
>>     
>>> 2008-06-30 15:54:55 IST DEBUG2 slon: worker process
>>>       
>> created - pid = 19034
>>     
>>> 2008-06-30 15:54:55 IST ERROR  cannot get
>>>       
>> sl_local_node_id - ERROR:  schema "_bijayant"
>> does not exist
>>     
>>> 2008-06-30 15:54:55 IST FATAL  main: Node is not
>>>       
>> initialized properly - sleep 10s
>>     
>>> I am sure that i am not understanding some basic
>>>       
>> things about the slony1. Can anybody help me to understand
>> the logic, i will be very helpful for you all. Please tell
>> me what i am doing wrong here, what should i do. I have
>> read the documentation at the website but not able to
>> understand fully. Please help me out.
>>     
>>> Thanks & Regards,
>>> Bijayant Kumar
>>>
>>> Send instant messages to your online friends
>>>       
>> http://uk.messenger.yahoo.com 
>>     
>>> _______________________________________________
>>> Slony1-general mailing list
>>> Slony1-general@lists.slony.info
>>>
>>>       
>> http://lists.slony.info/mailman/listinfo/slony1-general
>>     
>>>   
>>>       
>> _______________________________________________
>> Slony1-general mailing list
>> Slony1-general@lists.slony.info
>> http://lists.slony.info/mailman/listinfo/slony1-general
>>     
>
> Send instant messages to your online friends http://uk.messenger.yahoo.com 
>   

From cbbrowne at ca.afilias.info  Mon Jun 30 09:09:18 2008
From: cbbrowne at ca.afilias.info (cbbrowne@ca.afilias.info)
Date: Mon Jun 30 09:09:45 2008
Subject: [Slony1-general] Node is not initialized properly
In-Reply-To: <4868F5F8.3060008@albourne.com>
References: <212398.88459.qm@web32705.mail.mud.yahoo.com>
	<4868F5F8.3060008@albourne.com>
Message-ID: <49730.10.1.2.190.1214842158.squirrel@webmail.afilias.info>

> If you only run it like that, it only prints what it will execute, to
> actually execute this you need to | it to the slonik app..
>
> eg. /data/pgsql/slony/slonik_init_cluster --config <file> |
> /data/pgsql/bin/slonik
>
> all scripts starting with "slonik_" doesn't actually do anything
> themself, its just a way to format a command correctly for the slonik
> parser, which actually does the work..

I think you have gotten to the root of the issue; yes, indeed, the slonik
generator scripts do not directly submit the slonik scripts; they merely
generate them.

We found it was a pretty big "foot gun" if we had them run slonik
directly.  What seemed way wiser was actually a little bit different from
what you suggest...

Step 1:  Run the script, and capture the output...

  /data/pgsql/slony/slonik_init_cluster --config <file> >
/tmp/init_cluster.slonik

Step 2:  Examine the result

View /tmp/init_cluster.slonik to make sure it has appropriate contents.

Step 3:  Run slonik on the script

Run...
   slonik /tmp/init_cluster.slonik



From dba at richyen.com  Mon Jun 30 11:55:04 2008
From: dba at richyen.com (Richard Yen)
Date: Mon Jun 30 11:55:18 2008
Subject: [Slony1-general] Logshipping dump import failure
In-Reply-To: <4863E28B.6080805@stanford.edu>
References: <e0d7c3f50806261113h7eff6722l5ca058a88c210e74@mail.gmail.com>
	<20080626182904.GF28168@crankycanuck.ca>
	<4863E28B.6080805@stanford.edu>
Message-ID: <2FB1BF5B-9984-4062-AD80-EE3C8FF157FC@richyen.com>

I've found that when setting up the schema (before the data dump),  
you'll need to split the schema dump into two halves.  Otherwise, when  
you go around to do the data dump, all the foreign keys are already  
there, and some of the COPY statements will fail because the foreign  
key needs to refer to a not-yet-existing row in another table.

I've taken up the habit of splitting my schema dump into 2 parts,  
right where the first "ALTER TABLE" statement shows up.

Hope this helps!

--Richard


On Jun 26, 2008, at 11:40 AM, Jennifer Spencer wrote:

> I too have had some issues with importing the slony1_dump.sh  
> results.  I think it has to do with the shell environment itself  
> interfering.  When I issued "set noglobs on", it sometimes improved  
> things. You could try that.  Or, you could try to remove those  
> special escape characters (maybe "{" is part of the problem).  Your  
> shell may be trying to interpret those characters on the way into  
> postgres.
>
> In my case, I had trouble with the way it handles NULL values.   
> Because I am impatient, I got sick of trying to figure out what was  
> going on in my particular shell.  Instead, I modified the program's  
> "copy out" command so that it handled null values as "NULL" instead  
> of the default "\N" (or was it "/N" - I can't remember).  You may  
> wish to actually edit a copy of slony1_dump, as I did, and change  
> the copy out command to something that will work, such as "copy  
> out ... with binary".
> See the postgres page : http://www.postgresql.org/docs/current/interactive/sql-copy.html
> for more info on your copy options.
>
> -Jennifer
>
> Andrew Sullivan wrote:
>> On Thu, Jun 26, 2008 at 01:13:43PM -0500, Troy Wolf wrote:
>>> I have not had a response to the error I received when trying to
>>> subscribe a third node to my set. So in the meantime, I'm
>> I didn't reply because I'm mystified.  It looked right to me.
>>> The import is failing, and it appears it is choking on an array
>>> column. That is, I have a table with a column that has a data type  
>>> of
>>> text[] -- which is an array. In the dump, this is represented as
>>> {a,b,c}. If I take the line that the import is choking on and remove
>>> that column, it works.
>>>
>>> Thoughts?
>> If you dump the table itself, what does that line say?  This also  
>> looks
>> right to me.
>> _______________________________________________
>> Slony1-general mailing list
>> Slony1-general@lists.slony.info
>> http://lists.slony.info/mailman/listinfo/slony1-general
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general

From technovicebd at gmail.com  Fri Jun  6 02:56:58 2008
From: technovicebd at gmail.com (Technovice BD)
Date: Thu Sep 25 08:27:21 2008
Subject: [Slony1-general] Fwd: Help help!! I want help for replicating
	database using slony
In-Reply-To: <9954a75f0806060254t2b927777jaf162f340f4d207d@mail.gmail.com>
References: <9954a75f0806060254t2b927777jaf162f340f4d207d@mail.gmail.com>
Message-ID: <9954a75f0806060256q5e0fd085q4085a585b7581601@mail.gmail.com>

---------- Forwarded message ----------
From: Technovice BD <technovicebd@gmail.com>
Date: Fri, Jun 6, 2008 at 3:54 PM
Subject: Help help!! I want help for replicating database using slony
To: mailman@lists.slony.info
Cc: r_islam@erp-bd.com


Hello

I am using slony -I for replication of a database in (PgSql). I am facing an
issue which needs to be resolved.

*Issue:*

  For replication I created a master database & a slave database on
different machine. If master machine is switched off or down for any reason,
is there any way to edit the slave database without deleting the cluster
which is created to make relation with the master machine?

Waiting for reply.

Thanks
Md. Sajjadul Farooque Robin
Software Engineer
ERP System Ltd.
Dhaka, Bangladesh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080606/=
6875442b/attachment-0001.htm
From vikassharma at deloitte.com  Mon Jun  9 03:52:01 2008
From: vikassharma at deloitte.com (Sharma, Vikas O (IN - Delhi))
Date: Thu Sep 25 08:27:23 2008
Subject: [Slony1-general] Loadbinary("slevent.dll") failed 
Message-ID: <1A339DDC70642E4CA41CDE91E565C4996463BA@inmum0442.atrapa.deloitte.com>

Hi all 

I followed the instructions:

 

On typing on the command prompt

regsvr32 slevent.dll 

 

I got error message Loadbinary("slevent.dll") failed - invalid access to
memory location.

 

And when I copy ur suggested slevent.dll from the sourse
http://developer.pgadmin.org/~hiroshi/S ... levent.dll
<http://developer.pgadmin.org/%7Ehiroshi/Slony-I/slevent.dll> 

On registration time it gives error message         slevent.dll was
loaded, but the dllregisterserver entry point was not found. 

 
This file can't be registered.

 

 

Please help..                                                     

 

 

 
Um, There was the before same report. However, The problem was not
reproduced in the
environment of Dave with me. It was very strange. So, I wish to check
one.
Here is a new version.
http://developer.pgadmin.org/~hiroshi/Slony-I/
<http://developer.pgadmin.org/%7Ehiroshi/Slony-I/> 
And if a problem still reappears, please use this. (This is VC8 compile
module)
http://developer.pgadmin.org/~hiroshi/S ... levent.dll
<http://developer.pgadmin.org/%7Ehiroshi/Slony-I/slevent.dll> 
MinGW (GCC) will be suspected if it operates well.
 
Regards,
Hiroshi Saito 
 
This message (including any attachments) contains confidential information intended for a specific individual and purpose, and is protected by law. If you are not the intended recipient, you should delete this message and are hereby notified that any disclosure, copying, or distribution of this message, or the taking of any action based on it, is strictly prohibited.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080609/78f816e7/attachment-0001.htm
From thomas.stegemann at materna.de  Wed Jun 18 10:24:02 2008
From: thomas.stegemann at materna.de (Thomas Stegemann)
Date: Thu Sep 25 08:27:24 2008
Subject: [Slony1-general] A problem in Windows Server
In-Reply-To: <424442.96294.qm@web56712.mail.re3.yahoo.com>
References: <424442.96294.qm@web56712.mail.re3.yahoo.com>
Message-ID: <17987870.post@talk.nabble.com>


Hi,

we had the same problem on a german Windows.
try (with the correct path):
sc create Slony-I binPath= "c:\Programme (x86)\PostgreSQL\8.2\bin\slon.exe
-service" depend= "RPCSS"

instead of:
slon -regservice Slony-I

I think slon uses the wrong - not standard - user name for CreateService.



Roberto Mariano wrote:
> 
> 
> &nbsp;Hi,
> &nbsp;
> I have configured a Slony-I (a master and a slave) between 2 Windows 2003
> Servers wich are running Postgres 8.3. 
> 
> It works fine running the SLON.exe programs from the command line. But
> when I want to create the Windows service:
> &nbsp;
> &gt;&nbsp;slon -regservice Slony-I
> &nbsp;
> An error occurs:
> &nbsp;
> Failed to create service: 1057
> &nbsp;
> I was logged as "Administrator" which has all permission.&nbsp;
> &nbsp;
> Somebody can help me? 
> &nbsp;
> Thank you very much.
> &nbsp;
> Roberto Crucianelli.
> &nbsp;
> 
> __________________________________________________
> Correo Yahoo!
> Espacio para todos tus mensajes, antivirus y antispam ?gratis! 
> ?Abr? tu cuenta ya! - http://correo.yahoo.com.ar
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
> 
> 

-- 
View this message in context: http://www.nabble.com/A-problem-in-Windows-Server-tp17612398p17987870.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.

From anjaliawake at gmail.com  Wed Jun 25 04:10:08 2008
From: anjaliawake at gmail.com (Anjali Himanshu)
Date: Thu Sep 25 08:27:25 2008
Subject: [Slony1-general] /usr/local/pgsql/lib/xxid.so: undefined symbol:
	elog_start
Message-ID: <9662b8750806250409w1d0f1ebej28e0619644ef990f@mail.gmail.com>

postgres@boss:~$ sh /usr/local/pgsql/data/cluster_setup.sh
<stdin>:7: PGRES_FATAL_ERROR load '$libdir/xxid';  - ERROR:  could not load
library "/usr/local/pgsql/lib/xxid.so": /usr/local/pgsql/lib/xxid.so:
undefined symbol: elog_start
<stdin>:7: Error: the extension for the xxid data type cannot be loaded in
database 'dbname=3Dcontactdb host=3Dlocalhost user=3Dpostgres'
<stdin>:7: ERROR: no admin conninfo for node 134598928
postgres@boss:~$
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080625/=
049e8c4b/attachment-0001.htm
From anjaliawake at gmail.com  Wed Jun 25 09:14:22 2008
From: anjaliawake at gmail.com (Anjali Himanshu)
Date: Thu Sep 25 08:27:26 2008
Subject: [Slony1-general] /usr/local/pgsql/lib/xxid.so: undefined symbol:
	elog_start
In-Reply-To: <60k5gd35k7.fsf@dba2.int.libertyrms.com>
References: <9662b8750806250417o9a50b46k3ad925db1ccfba71@mail.gmail.com>
	<60skv137pb.fsf@dba2.int.libertyrms.com>
	<9662b8750806250736x3b0ae4e4r266e2faa07b26f96@mail.gmail.com>
	<60k5gd35k7.fsf@dba2.int.libertyrms.com>
Message-ID: <9662b8750806250914l121c99a6mcbfb0b78753892bc@mail.gmail.com>

while I was trying to run slony 1.0.5 and Postgres 8.2.7. Errors like
'xxidv00.so' in 'share' dir not found were coming. It was saying unsupported
postgres version. That's why we shifted to postgres 7.4. But, some other
errors came up.

On Wed, Jun 25, 2008 at 8:49 PM, Christopher Browne <
cbbrowne@ca.afilias.info> wrote:

> "Anjali Himanshu" <anjaliawake@gmail.com> writes:
> > SLony-1.0.5 and Postgres 7.4.21 are being used.
>
> This isn't really a resolution to the direct problem, but you really
> must consider using newer versions.
>
> - You are running a major version of PostgreSQL that's almost five
>  years old (7.4 was released in late 2003); there are plenty of
>  data-eating bugs that have been resolved in the 4 *major* releases
>  that follow 7.4.  (e.g. - 8.0, 8.1, 8.2, and 8.3)
>
> - You are trying to run a major version of Slony-I that is now two
>  major versions old, and, again, there are plenty of bugs (some
>  possibly data-eating) that have been resolved in subsequent
>  releases that will never be addressed in the 1.0 branch.
>
> We have sufficiently few people working on Slony-I that we can't
> realistic afford to spend time trying to address problems people are
> having with releases older than 1.2.
>
> You may not, at this time, have an option of upgrading the PostgreSQL
> instance, but you *don't* have the option of *NOT* going to a newer
> version of Slony-I.  Get a copy of 1.2.14.
> --
> select 'cbbrowne' || '@' || 'linuxfinances.info';
> http://linuxdatabases.info/info/multiplexor.html
> "Windows NT was designed to be administered by an idiot and usually
> is..."  -- Chris Adams" <adamsc@gigante.ml.org>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080625/=
7694c122/attachment-0001.htm
