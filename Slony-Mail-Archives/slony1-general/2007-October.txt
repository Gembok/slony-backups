From jpfletch at ca.afilias.info  Mon Oct  1 12:55:17 2007
From: jpfletch at ca.afilias.info (JP Fletcher)
Date: Mon Oct  1 12:56:00 2007
Subject: [Slony1-general] fresh schema for a logshipped node
Message-ID: <470150A5.4000700@ca.afilias.info>

Hi,

How is it that i'm supposed to get clean schema for a logshipped node?
I've previously pg_dumped form the log shipped node's provider, which is
 itself a subscriber.  On some dbs, however, i've run into the 'pg_dump
sanity check failed' issue when dumping from a subscriber, so I though
i'd try slony1_extract_schema.sh.  This extracts schema fine from an
origin, but won't work for a log shipped node (i.e the output of
slony1_dump.sh won't apply) unless I manually drop all of the triggers
and constraints that are present on the origin...

JP
From ajs at crankycanuck.ca  Tue Oct  2 11:38:23 2007
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Tue Oct  2 11:38:45 2007
Subject: [Slony1-general] fresh schema for a logshipped node
In-Reply-To: <470150A5.4000700@ca.afilias.info>
References: <470150A5.4000700@ca.afilias.info>
Message-ID: <20071002183823.GA25398@crankycanuck.ca>

Ugh.  Surely JP's report is a P1 bug?

A

On Mon, Oct 01, 2007 at 03:55:17PM -0400, JP Fletcher wrote:
> Hi,
> 
> How is it that i'm supposed to get clean schema for a logshipped node?
> I've previously pg_dumped form the log shipped node's provider, which is
>  itself a subscriber.  On some dbs, however, i've run into the 'pg_dump
> sanity check failed' issue when dumping from a subscriber, so I though
> i'd try slony1_extract_schema.sh.  This extracts schema fine from an
> origin, but won't work for a log shipped node (i.e the output of
> slony1_dump.sh won't apply) unless I manually drop all of the triggers
> and constraints that are present on the origin...
> 
> JP
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general

-- 
Andrew Sullivan  | ajs@crankycanuck.ca
A certain description of men are for getting out of debt, yet are
against all taxes for raising money to pay it off.
		--Alexander Hamilton
From andrew.george.hammond at gmail.com  Tue Oct  2 12:19:03 2007
From: andrew.george.hammond at gmail.com (Andrew Hammond)
Date: Tue Oct  2 12:19:14 2007
Subject: [Slony1-general] slony-i + drbd
In-Reply-To: <2b17483b0709281700o2c9af247x33b4249e0ae17d4d@mail.gmail.com>
References: <2b17483b0709281700o2c9af247x33b4249e0ae17d4d@mail.gmail.com>
Message-ID: <5a0a9d6f0710021219s3e4e6dfel26f409690d64e2b1@mail.gmail.com>

On 9/28/07, Will Langford <unfies@gmail.com> wrote:
>
> Hi,
>
> I work for a company that installs network services in many locations,
> each are completely isolated/localized.  These services include moderate =
to
> heavy postgresql traffic, with either a balanced select/update ratio, or
> slightly leaning towards more updates.
>
> Due to the nature of our products, we typically only need a single mid to
> low range server to handle our loads.  Times are changing, our products a=
re
> becoming more demanding, and needs are changing as well.
>
> We've always had a heartbeat/drbd fail over system on location so that if
> our system goes down, a backup takes over.  We've had insanely great succ=
ess
> with this setup.  The low amount of down time is acceptable, although our
> system is generally a 24/7 grinder.
>
> If we keep our current setup where the two primary nodes have the database
> live in DRBD, and there's a third report crunching box, how tolerant is
> slony-1 to heartbeat/drbd switch over to a new system ? Or is there some
> kind of multi-master replication system that's effective for a 2 or 3 sys=
tem
> setup ?
>
> Lately, I've been looking at several bottle necks in our system.  I've had
> good results with moving to a newer version of postgres, and also with
> changing out the underlying filesystem from ext3 to reiser.  I've done ab=
out
> all I can to tweak configuration file stuffs relating to
> wal/fsm/buffers/etc.  I've also done what I can to get proper columns
> indexed in the myriad of tables used.  The last couple things left for
> optimization attempts would be to generate diagrammed output of query
> patterns of our software and possibly also to move as many software queri=
es
> to function calls rather than just strings passed to the c lib back end (=
ie:
> to avoid constant tokenizing).
>
> Given that we typically have only two servers on location, it seems that
> many of the multi-master replication/clustering addons would end up with a
> negative speed benefit, especially given the 'bad' update/select ratio.  =
As
> such, we do have some client softwares that do only some mean ole huge na=
sty
> selects explicitly (no updates), and there are daily report crunchings on
> nonvolatile (ie: previous day's) data.
>
> We're a small software house, and many of the enterprise solutions are
> beyond our budget... so... make do with what ya got, etc.  We could
> probabily easily justify an additional low end server to handle the
> read-only client softwares, as long as they were executed soley on this b=
ox.
>
>
> So..... if the non-volatile read only queries are being executed on the
> slave system.... I can see this as being a fairly decent performance boon
> during peak report generation etc.  Anything that would need write access
> would either connect to the master system, or generate some .sql files to=
 be
> copied over and ran on the master system.
>
> Our current DRBD/failover system is for the database files and all other
> our-software specific files to live on the DRBD replicated mount point.
> We've not had any problems with a crashed / tripped-over-power-chord fail
> over issues with postgres firing up on the backup server after discovering
> the first node is dead.  And, I actually kind of prefer this system compa=
red
> to application level replication, because any kind of lock/stall caused by
> the application replication subsystem is detrimental, and our client
> software is a bit volatile at times (a 5 year old work in progress....
> feature creep etc). So... my question becomes (just to copy/paste) :
>
> If we keep our current setup where the two primary nodes have the database
> live in DRBD, and there's a third report crunching box, how tolerant is
> slony-1 to heartbeat/drbd switch over to a new system ? Or is there some
> kind of multi-master replication system that's effective for a 2 or 3 sys=
tem
> setup ?
>


So long as the ip's used by the slons are glued to the data, you might
survive. I'd test the heck out of such a system before deploying it in
production. I recall having plenty of issues with HACMP (the IBM / AIX
flavour, using SAN storage with multiple connections instead of drbd).
You'll also need some way to trigger slon resets. Otherwise this is more a
question about PostgreSQL surviving drbd/failover, which according to the
above, it already does.

A
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071002/=
e761f723/attachment.htm
From jpfletch at ca.afilias.info  Tue Oct  2 14:16:08 2007
From: jpfletch at ca.afilias.info (JP Fletcher)
Date: Tue Oct  2 14:16:37 2007
Subject: [Slony1-general] command_on_logarchive option
Message-ID: <4702B518.6060602@ca.afilias.info>

Hi,

I'm experimenting with logshipping (v.1.2.11) and am using, for the 
first time, the option in the slon conf file:

command_on_logarchive

I created a shell script that this command calls which applies syncs 
archives after they are written:

   
command_on_logarchive="/opt/clusters/cluster1_slony/archive/apply_archive.sh"

My cluster has four nodes, not counting the log shipped replica, 8141, 
8142, 8143, and 8194.  Node 8194 is the provider to the logshipped node, 
so I only configured 'command_on_logarchive' for the slon servicing this 
node, my assumption is that this is correct.  Nodes 8143, and 8141 are 
origins for sets.

When I started things up, everything appeared to be fine.  The slon 
successfully applied 37 archives, each originating on either node 8141 
or 8143.  The 38th archive, however, and several subsequent archives 
originated on node 8142.  The slon made no attempt to apply these 
archives.  This left the archive counter  on 37.  The next archive the 
slon attempted to apply was from node 8143, and  expected the  archive 
counter to be on 48, which of course it was not, and everything went 
pear-shaped.   I have three questions:

1.  Should I have expected the command_on_logarchive option to work, and 
if so, did i do something wrong?

2.  Why does the slon not try to apply archives from node8142?

3.  Why are there archives from a node that is not active (no events 
should have originated on 8142, and no archive files exist for the other 
non-origin node)?

 
-- 

JP Fletcher
Database Administrator
Afilias Canada
voice: 416.646.3304 ext. 4123
fax: 416.646.3305
mobile: 416.561.4763
jpfletch@ca.afilias.info


From cbbrowne at ca.afilias.info  Tue Oct  2 14:48:33 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Tue Oct  2 14:48:46 2007
Subject: [Slony1-general] command_on_logarchive option
In-Reply-To: <4702B518.6060602@ca.afilias.info> (JP Fletcher's message of "Tue,
	02 Oct 2007 17:16:08 -0400")
References: <4702B518.6060602@ca.afilias.info>
Message-ID: <60ejgdmbm6.fsf@dba2.int.libertyrms.com>

JP Fletcher <jpfletch@ca.afilias.info> writes:
> I'm experimenting with logshipping (v.1.2.11) and am using, for the
> first time, the option in the slon conf file:
>
> command_on_logarchive
>
> I created a shell script that this command calls which applies syncs
> archives after they are written:
>
>   command_on_logarchive="/opt/clusters/cluster1_slony/archive/apply_archive.sh"
>
> My cluster has four nodes, not counting the log shipped replica, 8141,
> 8142, 8143, and 8194.  Node 8194 is the provider to the logshipped
> node, so I only configured 'command_on_logarchive' for the slon
> servicing this node, my assumption is that this is correct.  Nodes
> 8143, and 8141 are origins for sets.
>
> When I started things up, everything appeared to be fine.  The slon
> successfully applied 37 archives, each originating on either node 8141
> or 8143.  The 38th archive, however, and several subsequent archives
> originated on node 8142.  The slon made no attempt to apply these
> archives.  This left the archive counter  on 37.  The next archive the
> slon attempted to apply was from node 8143, and  expected the  archive
> counter to be on 48, which of course it was not, and everything went
> pear-shaped.   I have three questions:
>
> 1.  Should I have expected the command_on_logarchive option to work,
> and if so, did i do something wrong?

Hopefully apply_archive.sh looked something like:

#!/bin/sh
PGBINDIR=????
${PGBINDIR}/slony_logshipper $1

That might be hoped to work, although not quite right yet in 1.2.11
:-(.

> 2.  Why does the slon not try to apply archives from node8142?

slon shouldn't; I think you're meaning the slony_logshipper...

> 3.  Why are there archives from a node that is not active (no events
> should have originated on 8142, and no archive files exist for the
> other non-origin node)?

The node that isn't active should have very few, very infrequent,
archives that are devoid of actual content (beyond the headers).

It is expected that there *will* be some events coming from other
nodes, as every node does generate events, even if infrequently.

The behaviour will change a bit in 1.2.12; Jan just committed some
changes at the end of last week to fix up the handling of sequencing
of the archives, which turned out to be (sigh) troublesome.
-- 
select 'cbbrowne' || '@' || 'cbbrowne.com';
http://cbbrowne.com/info/
Rules of the Evil Overlord #79. "If my doomsday device happens to come
with  a reverse switch, as  soon as  it has  been employed  it will be
melted    down and  made  into   limited-edition commemorative coins."
<http://www.eviloverlord.com/>
From jpfletch at ca.afilias.info  Tue Oct  2 15:05:16 2007
From: jpfletch at ca.afilias.info (JP Fletcher)
Date: Tue Oct  2 15:05:45 2007
Subject: [Slony1-general] command_on_logarchive option
In-Reply-To: <60ejgdmbm6.fsf@dba2.int.libertyrms.com>
References: <4702B518.6060602@ca.afilias.info>
	<60ejgdmbm6.fsf@dba2.int.libertyrms.com>
Message-ID: <4702C09C.6080607@ca.afilias.info>

Christopher Browne wrote:
> JP Fletcher <jpfletch@ca.afilias.info> writes:
>   
>> I'm experimenting with logshipping (v.1.2.11) and am using, for the
>> first time, the option in the slon conf file:
>>
>> command_on_logarchive
>>
>> I created a shell script that this command calls which applies syncs
>> archives after they are written:
>>
>>   command_on_logarchive="/opt/clusters/cluster1_slony/archive/apply_archive.sh"
>>
>> My cluster has four nodes, not counting the log shipped replica, 8141,
>> 8142, 8143, and 8194.  Node 8194 is the provider to the logshipped
>> node, so I only configured 'command_on_logarchive' for the slon
>> servicing this node, my assumption is that this is correct.  Nodes
>> 8143, and 8141 are origins for sets.
>>
>> When I started things up, everything appeared to be fine.  The slon
>> successfully applied 37 archives, each originating on either node 8141
>> or 8143.  The 38th archive, however, and several subsequent archives
>> originated on node 8142.  The slon made no attempt to apply these
>> archives.  This left the archive counter  on 37.  The next archive the
>> slon attempted to apply was from node 8143, and  expected the  archive
>> counter to be on 48, which of course it was not, and everything went
>> pear-shaped.   I have three questions:
>>
>> 1.  Should I have expected the command_on_logarchive option to work,
>> and if so, did i do something wrong?
>>     
>
> Hopefully apply_archive.sh looked something like:
>
> #!/bin/sh
> PGBINDIR=????
> ${PGBINDIR}/slony_logshipper $1
>
> That might be hoped to work, although not quite right yet in 1.2.11
>   

#!/bin/bash

SQL_ARCHIVE=$1

/opt/dbs/pgsql81_slonytest/bin/psql -h yrg-testbed2 -p 9533 -U slony -f 
$SQL_ARCHIVE cluster1_logship >> 
/opt/clusters/cluster1_slony/archive/apply_archive.log 2>&1

if [ $? != 0 ]; then

   echo "Failed to apply archive $SQL_ARCHIVE >> 
/opt/clusters/cluster1_slony/archive/apply_archive.log 2>&1"
   exit 1
  fi

mv $SQL_ARCHIVE $SQL_ARCHIVE.applied

> :-(.
>
>   
>> 2.  Why does the slon not try to apply archives from node8142?
>>     
>
> slon shouldn't; I think you're meaning the slony_logshipper...
>   

Yes, of course you're correct, but it doesn't look like the shell script 
was even run for these files.
>   
>> 3.  Why are there archives from a node that is not active (no events
>> should have originated on 8142, and no archive files exist for the
>> other non-origin node)?
>>     
>
> The node that isn't active should have very few, very infrequent,
> archives that are devoid of actual content (beyond the headers).
>
> It is expected that there *will* be some events coming from other
> nodes, as every node does generate events, even if infrequently.
>
> The behaviour will change a bit in 1.2.12; Jan just committed some
> changes at the end of last week to fix up the handling of sequencing
> of the archives, which turned out to be (sigh) troublesome.
>   


-- 
JP Fletcher
Database Administrator
Afilias Canada
voice: 416.646.3304 ext. 4123
fax: 416.646.3305
mobile: 416.561.4763
jpfletch@ca.afilias.info


From dant at cdkkt.com  Tue Oct  2 17:02:27 2007
From: dant at cdkkt.com (Daniel B. Thurman)
Date: Tue Oct  2 17:02:39 2007
Subject: [Slony1-general] Slony fails on reboot
Message-ID: <021126B987E43D44A860139823C079110E2B9B@orion.cdkkt.com>


Platform: Windows 2000 Server
Slony: v1.2.9

Seems that when I reboot my server, slon fails to start properly.  I had
to restart PostgreSql services, then restart Slony.  After this point,
everything seems to work fine.

Is there some way to ensure PostgreSQL starts first before starting
Slony service?


No virus found in this outgoing message.
Checked by AVG Free Edition. 
Version: 7.5.488 / Virus Database: 269.13.37/1042 - Release Date: 10/1/2007 6:59 PM
 
From steve at st4vs.net  Tue Oct  2 17:23:00 2007
From: steve at st4vs.net (Steve Dommett)
Date: Tue Oct  2 17:23:18 2007
Subject: [Slony1-general] Slony fails on reboot
In-Reply-To: <021126B987E43D44A860139823C079110E2B9B@orion.cdkkt.com>
References: <021126B987E43D44A860139823C079110E2B9B@orion.cdkkt.com>
Message-ID: <200710030123.00986.steve@st4vs.net>

On Wednesday 03 October 2007, Daniel B. Thurman wrote:
> Platform: Windows 2000 Server
>
> Is there some way to ensure PostgreSQL starts first before starting
> Slony service?

I've little experience with that OS, but the first google hit for "windows 
service dependencies" seems to be what you  are looking for:
http://support.microsoft.com/kb/193888

Have fun,
  Steve.
From dant at cdkkt.com  Tue Oct  2 19:08:01 2007
From: dant at cdkkt.com (Daniel B. Thurman)
Date: Tue Oct  2 19:08:14 2007
Subject: [Slony1-general] Slony fails on reboot
Message-ID: <021126B987E43D44A860139823C079110E2B9D@orion.cdkkt.com>

>[mailto:slony1-general-bounces@lists.slony.info]On Behalf Of Steve
>Dommett
>Sent: Tuesday, October 02, 2007 5:23 PM
>To: slony1-general@lists.slony.info
>Subject: Re: [Slony1-general] Slony fails on reboot
>
>
>On Wednesday 03 October 2007, Daniel B. Thurman wrote:
>> Platform: Windows 2000 Server
>>
>> Is there some way to ensure PostgreSQL starts first before starting
>> Slony service?
>
>I've little experience with that OS, but the first google hit 
>for "windows 
>service dependencies" seems to be what you  are looking for:
>http://support.microsoft.com/kb/193888
>
>Have fun,
>  Steve.
>_______________________________________________

Well, I tried to add 'pgsql-8.2' dependency to the slony-I service
via the registry and that does not work, in fact, it screws it up.
I noticed that the postgresql service is started first before slony-I
but the problem here is that there is not enough time for the databases
to start up AND provide port access in time for slony-I to connect
to it so it fails. Does not slony-I have any retry connection option
settings in the configuration files? Did anyone get this sort of problem?

As it is, I have to first restart the postgresql service then the slony-I
service and everything works fine thereafter.


No virus found in this outgoing message.
Checked by AVG Free Edition. 
Version: 7.5.488 / Virus Database: 269.13.37/1042 - Release Date: 10/1/2007 6:59 PM
 
From steve at st4vs.net  Tue Oct  2 19:37:58 2007
From: steve at st4vs.net (Steve Dommett)
Date: Tue Oct  2 19:38:21 2007
Subject: [Slony1-general] Slony fails on reboot
In-Reply-To: <021126B987E43D44A860139823C079110E2B9D@orion.cdkkt.com>
References: <021126B987E43D44A860139823C079110E2B9D@orion.cdkkt.com>
Message-ID: <200710030337.58970.steve@st4vs.net>

On Wednesday 03 October 2007, Daniel B. Thurman wrote:
> Well, I tried to add 'pgsql-8.2' dependency to the slony-I service
> via the registry and that does not work, in fact, it screws it up.
Following the advice in the last note in the link I quoted previously, if you 
need Slony1 to start near the end of the boot procedure then you can try 
making it depend on a service that starts later than most:
> Note If you have a service that needs to start late in the boot cycle but
> you do not have a specific service dependency, as explained above, then
> choose one of the services which startup last as the data value for the
> value "Depends on Service". Services commonly selected are Spooler and
> Messenger.

Hopefully (in the technical sense of course ;-), this will give pgsql-8.2 
enough time to start accepting socket connections.

PS Are you sure it's not just a sluggish DNS server causing Postgres to take 
so long to start up fully?

Take care,
  Steve.
From drees76 at gmail.com  Tue Oct  2 23:43:26 2007
From: drees76 at gmail.com (David Rees)
Date: Tue Oct  2 23:43:45 2007
Subject: [Slony1-general] Slony fails on reboot
In-Reply-To: <021126B987E43D44A860139823C079110E2B9B@orion.cdkkt.com>
References: <021126B987E43D44A860139823C079110E2B9B@orion.cdkkt.com>
Message-ID: <72dbd3150710022343o30929f9coa16e115fa70e7b79@mail.gmail.com>

On 10/2/07, Daniel B. Thurman <dant@cdkkt.com> wrote:
>
> Platform: Windows 2000 Server
> Slony: v1.2.9
>
> Seems that when I reboot my server, slon fails to start properly.  I had
> to restart PostgreSql services, then restart Slony.  After this point,
> everything seems to work fine.
>
> Is there some way to ensure PostgreSQL starts first before starting
> Slony service?

You should be able to configure the Slony service to restart
automatically after a configurable delay, and how many times to
restart before giving up on restarting it. So you could likely tell it
to restart after a minute and never stop trying to start it up.

I know I've done something like this before on Windows servers, but
not sure if you can do that on W2K server.

-Dave
From dpage at postgresql.org  Wed Oct  3 00:53:20 2007
From: dpage at postgresql.org (Dave Page)
Date: Wed Oct  3 00:53:45 2007
Subject: [Slony1-general] Slony fails on reboot
In-Reply-To: <021126B987E43D44A860139823C079110E2B9D@orion.cdkkt.com>
References: <021126B987E43D44A860139823C079110E2B9D@orion.cdkkt.com>
Message-ID: <47034A70.3080400@postgresql.org>

Daniel B. Thurman wrote:
> Well, I tried to add 'pgsql-8.2' dependency to the slony-I service
> via the registry and that does not work, in fact, it screws it up.
> I noticed that the postgresql service is started first before slony-I
> but the problem here is that there is not enough time for the databases
> to start up AND provide port access in time for slony-I to connect
> to it so it fails. Does not slony-I have any retry connection option
> settings in the configuration files? Did anyone get this sort of problem?

PostgreSQL 8.2.5 fixes this by waiting until recovery is complete and
the server is started before reporting to the service control manager
that it's running. This ensures the SCM won't try to start dependent
services too early.

I'm not sure if the upgrade process will modify the service registration
though. If not, yell and I'll fire up a windows box and tell you what to
tweak.

/D
From rod at iol.ie  Wed Oct  3 03:39:07 2007
From: rod at iol.ie (Raymond O'Donnell)
Date: Wed Oct  3 03:39:31 2007
Subject: [Slony1-general] Slony fails on reboot
In-Reply-To: <72dbd3150710022343o30929f9coa16e115fa70e7b79@mail.gmail.com>
References: <021126B987E43D44A860139823C079110E2B9B@orion.cdkkt.com>
	<72dbd3150710022343o30929f9coa16e115fa70e7b79@mail.gmail.com>
Message-ID: <4703714B.50008@iol.ie>

On 03/10/2007 07:43, David Rees wrote:

> I know I've done something like this before on Windows servers, but
> not sure if you can do that on W2K server.

I'm pretty sure that you can - I just had a look at the services on my 
XP laptop, and on the "Recovery" tab of the service properties you can 
(i) tell it to retry multiple time and (ii) specify the delay between 
retries.

HTH,

Ray.

---------------------------------------------------------------
Raymond O'Donnell, Director of Music, Galway Cathedral, Ireland
rod@iol.ie
---------------------------------------------------------------
From dant at cdkkt.com  Wed Oct  3 06:32:12 2007
From: dant at cdkkt.com (Daniel B. Thurman)
Date: Wed Oct  3 06:32:17 2007
Subject: [Slony1-general] Slony fails on reboot
Message-ID: <021126B987E43D44A860139823C079110E2B9E@orion.cdkkt.com>

>[mailto:slony1-general-bounces@lists.slony.info]On Behalf Of Raymond
>O'Donnell
>Sent: Wednesday, October 03, 2007 3:39 AM
>To: David Rees
>Cc: Slony-I (E-mail)
>Subject: Re: [Slony1-general] Slony fails on reboot
>
>
>On 03/10/2007 07:43, David Rees wrote:
>
>> I know I've done something like this before on Windows servers, but
>> not sure if you can do that on W2K server.
>
>I'm pretty sure that you can - I just had a look at the services on my 
>XP laptop, and on the "Recovery" tab of the service properties you can 
>(i) tell it to retry multiple time and (ii) specify the delay between 
>retries.
>
>HTH,
>
>Ray.
>

Uh, the problem is that after reboot, the PostgreSQL service is running but
the databases are still trying to come up and before ports are released to
the public whilst slony-I services are running but "ran past" PostgreSQL
which was not ready and Slony-I will not attempt to (re)connect to the
PostgreSQL database(s).  Slony-I is dead in the water until restarted!
So the issue of Recovery may not do you any good because the services
are running and there is no fault here to recover!

I cannot tell if there is a problem both with PostgreSQL and Slony-I since
both services had to be restarted in order to restore some sense of normalcy.

No virus found in this outgoing message.
Checked by AVG Free Edition. 
Version: 7.5.488 / Virus Database: 269.13.39/1045 - Release Date: 10/2/2007 6:43 PM
 
From slony at someones.net  Thu Oct  4 03:27:08 2007
From: slony at someones.net (Menno Spaans)
Date: Thu Oct  4 03:27:38 2007
Subject: [Slony1-general] Question about 2 nodes with multiple directions
Message-ID: <20071004102708.GB719@someones.net>


Hi,

I'm trying to build a setup in which I have 2 hosts (nodes), which
both have a master and a slave database. The idea is that they cross
replicate to each other. See the ascii graph below:

  +--------------------+            +--------------------+
  |                    |            |                    |
  |  +--------------+  | cl_1.set1? |  +--------------+  |
  |  | slo_mas_db_1 |--|------------|->| slo_sla_db_1 |  |
  |  +--------------+  |            |  +--------------+  |
  |  | table1       |  |            |  | table1       |  |
  |  | table2       |  |            |  | table2       |  |
  |  +--------------+  |            |  +--------------+  |
  |                    |            |                    |
  |  +--------------+  | cl_2.set1? |  +--------------+  |
  |  | slo_sla_db_2 |<-|------------|--| slo_mas_db_2 |  |
  |  +--------------+  |            |  +--------------+  |
  |  | table1       |  |            |  | table1       |  |
  |  | table2       |  |            |  | table2       |  |
  |  +--------------+  |            |  +--------------+  |
  |                    |            |                    |
  |      Host 1        |            |      Host 2        |
  +--------------------+            +--------------------+


I'm using slony version 1.2.9 with postgres 8.1.
The first replication set works like a charm, but I can get slony to do
the second replication set.

I'm completely new to slony, so if I missed something in the
documentation about this please point me to right place.

Can anyone tell me if I'm trying something which simply isn't
possible or that I'm overlooking something. 

If more info is needed please shout.

Thanks in advance,

-- 
 Greetings,
   Menno Spaans

From plk.zuber at gmail.com  Thu Oct  4 04:04:45 2007
From: plk.zuber at gmail.com (=?UTF-8?Q?Filip_Rembia=C5=82kowski?=)
Date: Thu Oct  4 04:05:05 2007
Subject: [Slony1-general] Question about 2 nodes with multiple directions
In-Reply-To: <20071004102708.GB719@someones.net>
References: <20071004102708.GB719@someones.net>
Message-ID: <92869e660710040404m7a71d780q35bb6c6d34682905@mail.gmail.com>

2007/10/4, Menno Spaans <slony@someones.net>:
>
> Hi,
>
> I'm trying to build a setup in which I have 2 hosts (nodes), which
> both have a master and a slave database. The idea is that they cross
> replicate to each other. See the ascii graph below:
>
>   +--------------------+            +--------------------+
>   |                    |            |                    |
>   |  +--------------+  | cl_1.set1? |  +--------------+  |
>   |  | slo_mas_db_1 |--|------------|->| slo_sla_db_1 |  |
>   |  +--------------+  |            |  +--------------+  |
>   |  | table1       |  |            |  | table1       |  |
>   |  | table2       |  |            |  | table2       |  |
>   |  +--------------+  |            |  +--------------+  |
>   |                    |            |                    |
>   |  +--------------+  | cl_2.set1? |  +--------------+  |
>   |  | slo_sla_db_2 |<-|------------|--| slo_mas_db_2 |  |
>   |  +--------------+  |            |  +--------------+  |
>   |  | table1       |  |            |  | table1       |  |
>   |  | table2       |  |            |  | table2       |  |
>   |  +--------------+  |            |  +--------------+  |
>   |                    |            |                    |
>   |      Host 1        |            |      Host 2        |
>   +--------------------+            +--------------------+
>
>
> I'm using slony version 1.2.9 with postgres 8.1.
> The first replication set works like a charm, but I can get slony to do
> the second replication set.

Why? what's the problem? maybe you did not run slon daemons for the
second cluster?


>
> I'm completely new to slony, so if I missed something in the
> documentation about this please point me to right place.
>
> Can anyone tell me if I'm trying something which simply isn't
> possible or that I'm overlooking something.
>

It is possible.

You should consider if you really need four databases an two clusters.
Maybe you need just two databases, two replication sets in one slony
cluster, with data flowing in opposite directions.



-- 
Filip Rembia?kowski
From slony at someones.net  Thu Oct  4 05:24:06 2007
From: slony at someones.net (Menno Spaans)
Date: Thu Oct  4 05:24:23 2007
Subject: [Slony1-general] Question about 2 nodes with multiple directions
In-Reply-To: <92869e660710040404m7a71d780q35bb6c6d34682905@mail.gmail.com>
References: <20071004102708.GB719@someones.net>
	<92869e660710040404m7a71d780q35bb6c6d34682905@mail.gmail.com>
Message-ID: <20071004122406.GH719@someones.net>

On Thu, Oct 04, 2007 at 12:04:45PM +0100, Filip Rembia??kowski wrote:

HI Filip,

Thanks for you're response.

> 2007/10/4, Menno Spaans <slony@someones.net>:
> >
> > Hi,
> >
> > I'm trying to build a setup in which I have 2 hosts (nodes), which
> > both have a master and a slave database. The idea is that they cross
> > replicate to each other. See the ascii graph below:
> >
> >   +--------------------+            +--------------------+
> >   |                    |            |                    |
> >   |  +--------------+  | cl_1.set1? |  +--------------+  |
> >   |  | slo_mas_db_1 |--|------------|->| slo_sla_db_1 |  |
> >   |  +--------------+  |            |  +--------------+  |
> >   |  | table1       |  |            |  | table1       |  |
> >   |  | table2       |  |            |  | table2       |  |
> >   |  +--------------+  |            |  +--------------+  |
> >   |                    |            |                    |
> >   |  +--------------+  | cl_2.set1? |  +--------------+  |
> >   |  | slo_sla_db_2 |<-|------------|--| slo_mas_db_2 |  |
> >   |  +--------------+  |            |  +--------------+  |
> >   |  | table1       |  |            |  | table1       |  |
> >   |  | table2       |  |            |  | table2       |  |
> >   |  +--------------+  |            |  +--------------+  |
> >   |                    |            |                    |
> >   |      Host 1        |            |      Host 2        |
> >   +--------------------+            +--------------------+
> >
> >
> > I'm using slony version 1.2.9 with postgres 8.1.
> > The first replication set works like a charm, but I can get slony to do
> > the second replication set.
> 
> Why? what's the problem? maybe you did not run slon daemons for the
> second cluster?

I'm using the watchdog script for this, but indeed it seems only one set
of slony deamons is running. I need more coffee apparently.

I shall check my configuration and start the deamon by hand to see if
that brings up both cluster's/replication set's.

> >
> > I'm completely new to slony, so if I missed something in the
> > documentation about this please point me to right place.
> >
> > Can anyone tell me if I'm trying something which simply isn't
> > possible or that I'm overlooking something.
> >
> 
> It is possible.

Thanks, I'll continue with this. I was afraid I was trying something
which couldn't work.

> You should consider if you really need four databases an two clusters.
> Maybe you need just two databases, two replication sets in one slony
> cluster, with data flowing in opposite directions.

Yes, the application for which we are using this setup needs a specific
set of tables so I can't put those in the same database because of name
collision.


-- 
 Greetings,
   Menno Spaans

From slony at someones.net  Thu Oct  4 05:48:31 2007
From: slony at someones.net (Menno Spaans)
Date: Thu Oct  4 05:48:48 2007
Subject: [Slony1-general] Question about 2 nodes with multiple directions
In-Reply-To: <20071004122406.GH719@someones.net>
References: <20071004102708.GB719@someones.net>
	<92869e660710040404m7a71d780q35bb6c6d34682905@mail.gmail.com>
	<20071004122406.GH719@someones.net>
Message-ID: <20071004124831.GI719@someones.net>

On Thu, Oct 04, 2007 at 02:24:06PM +0200, Menno Spaans wrote:

Hi,

It workes, I created two seperate config files for the watchdog.
With the config for the first set in one file and for the second set in
the second file. 

Starting 2 watchdog's with the seperate config files solved the problem.
(which was that the second set was not replicating).

Thanks for the pointer.

> On Thu, Oct 04, 2007 at 12:04:45PM +0100, Filip Rembia??kowski wrote:
> 
> HI Filip,
> 
> Thanks for you're response.
> 
> > 2007/10/4, Menno Spaans <slony@someones.net>:
> > >
> > > Hi,
> > >
> > > I'm trying to build a setup in which I have 2 hosts (nodes), which
> > > both have a master and a slave database. The idea is that they cross
> > > replicate to each other. See the ascii graph below:
> > >
> > >   +--------------------+            +--------------------+
> > >   |                    |            |                    |
> > >   |  +--------------+  | cl_1.set1? |  +--------------+  |
> > >   |  | slo_mas_db_1 |--|------------|->| slo_sla_db_1 |  |
> > >   |  +--------------+  |            |  +--------------+  |
> > >   |  | table1       |  |            |  | table1       |  |
> > >   |  | table2       |  |            |  | table2       |  |
> > >   |  +--------------+  |            |  +--------------+  |
> > >   |                    |            |                    |
> > >   |  +--------------+  | cl_2.set1? |  +--------------+  |
> > >   |  | slo_sla_db_2 |<-|------------|--| slo_mas_db_2 |  |
> > >   |  +--------------+  |            |  +--------------+  |
> > >   |  | table1       |  |            |  | table1       |  |
> > >   |  | table2       |  |            |  | table2       |  |
> > >   |  +--------------+  |            |  +--------------+  |
> > >   |                    |            |                    |
> > >   |      Host 1        |            |      Host 2        |
> > >   +--------------------+            +--------------------+
> > >
> > >
> > > I'm using slony version 1.2.9 with postgres 8.1.
> > > The first replication set works like a charm, but I can get slony to do
> > > the second replication set.
> > 
> > Why? what's the problem? maybe you did not run slon daemons for the
> > second cluster?
> 
> I'm using the watchdog script for this, but indeed it seems only one set
> of slony deamons is running. I need more coffee apparently.
> 
> I shall check my configuration and start the deamon by hand to see if
> that brings up both cluster's/replication set's.
> 
> > >
> > > I'm completely new to slony, so if I missed something in the
> > > documentation about this please point me to right place.
> > >
> > > Can anyone tell me if I'm trying something which simply isn't
> > > possible or that I'm overlooking something.
> > >
> > 
> > It is possible.
> 
> Thanks, I'll continue with this. I was afraid I was trying something
> which couldn't work.
> 
> > You should consider if you really need four databases an two clusters.
> > Maybe you need just two databases, two replication sets in one slony
> > cluster, with data flowing in opposite directions.
> 
> Yes, the application for which we are using this setup needs a specific
> set of tables so I can't put those in the same database because of name
> collision.
> 
-- 
 Greetings,
   Menno Spaans


From dan at sidhe.org  Sat Oct  6 12:58:37 2007
From: dan at sidhe.org (Dan Sugalski)
Date: Sat Oct  6 13:02:28 2007
Subject: [Slony1-general] Slony 1.2.11 segfaults on AIX
Message-ID: <a06240800c32d963b4954@[192.168.1.200]>

I've been trying to get Slony installed on some Postgres 8.2.5 
instances I've got running on a couple of AIX boxes, but with no luck 
at all, and I'm hoping someone's run into the same problem and has a 
solution.

Postgres itself builds, tests, and runs just fine. More than fine, 
it's a screamer and leaves the Postgres instances I have on some 
Fujitsu Solaris boxes in the dust. Slony 1.2.11 also builds and 
installs just fine. The trouble comes in as soon as I try to get any 
sort of replication going.

Doing an init cluster with the AIX box as a master, or a store node 
with the AIX box as a slave, crashes Postgres. From the core file 
left behind, the death is in slony's .so, when it tries to call 
palloc. According to gdb, palloc's function address is NULL, and so 
the task gets an illegal instruction trap and dies.

This is very consistent; I've built Postgres and Slony as both 32 and 
64 bit executables, and with both xlc6 (IBM's compiler) and gcc. The 
results are the same, palloc's address is always NULL and things die.

 From what I can tell, it looks like when slony's .so is loaded, the 
palloc call *back* into Postgres' shared objects never resolves, so 
it's left NULL and things die. Unfortunately AIX's way of handling 
shared objects is... somewhat unique and I've got no experience with 
it. I have a feeling there's a simple fix somewhere, but beats me 
what it is. Google's been no help, but that's not too much of a 
surprise since I don't quite know what I'm looking for. (The obvious 
simple searches haven't turned up much of use)

Has anyone come across this? Better yet, anyone know a fix?
-- 
				Dan

--------------------------------------it's like this-------------------
Dan Sugalski                          even samurai
dan@sidhe.org                         have teddy bears and even
                                       teddy bears get drunk
From dan at sidhe.org  Sat Oct  6 12:58:37 2007
From: dan at sidhe.org (Dan Sugalski)
Date: Sat Oct  6 13:04:01 2007
Subject: [Slony1-general] Slony 1.2.11 segfaults on AIX
Message-ID: <a06240800c32d963b4954@[192.168.1.200]>

I've been trying to get Slony installed on some Postgres 8.2.5 
instances I've got running on a couple of AIX boxes, but with no luck 
at all, and I'm hoping someone's run into the same problem and has a 
solution.

Postgres itself builds, tests, and runs just fine. More than fine, 
it's a screamer and leaves the Postgres instances I have on some 
Fujitsu Solaris boxes in the dust. Slony 1.2.11 also builds and 
installs just fine. The trouble comes in as soon as I try to get any 
sort of replication going.

Doing an init cluster with the AIX box as a master, or a store node 
with the AIX box as a slave, crashes Postgres. From the core file 
left behind, the death is in slony's .so, when it tries to call 
palloc. According to gdb, palloc's function address is NULL, and so 
the task gets an illegal instruction trap and dies.

This is very consistent; I've built Postgres and Slony as both 32 and 
64 bit executables, and with both xlc6 (IBM's compiler) and gcc. The 
results are the same, palloc's address is always NULL and things die.

 From what I can tell, it looks like when slony's .so is loaded, the 
palloc call *back* into Postgres' shared objects never resolves, so 
it's left NULL and things die. Unfortunately AIX's way of handling 
shared objects is... somewhat unique and I've got no experience with 
it. I have a feeling there's a simple fix somewhere, but beats me 
what it is. Google's been no help, but that's not too much of a 
surprise since I don't quite know what I'm looking for. (The obvious 
simple searches haven't turned up much of use)

Has anyone come across this? Better yet, anyone know a fix?
-- 
				Dan

--------------------------------------it's like this-------------------
Dan Sugalski                          even samurai
dan@sidhe.org                         have teddy bears and even
                                       teddy bears get drunk
From dant at cdkkt.com  Sun Oct  7 11:42:33 2007
From: dant at cdkkt.com (Daniel B. Thurman)
Date: Sun Oct  7 11:42:41 2007
Subject: [Slony1-general] Seems slony-I is having some problems,
	after some period of time passes...
Message-ID: <021126B987E43D44A860139823C079110E2BA4@orion.cdkkt.com>


Platform: Win 2000 Server
Slony-I: v1.2.9

>From my Logs:

1) 10/7/2007: 300AM
a) FATAL  syncThread: "start transaction;set transaction isolation level serializable;select last_value from "_MasterCluster".sl_action_seq;" - FATAL:  terminating connection due to administrator command
server closed the connection unexpectedly
	This probably means the server terminated abnormally
	before or while processing the request.

b) WARN   engine for 'E:\Program Files\PostgreSQL\8.2\Slony\slon.conf' terminated, restarting. 

c) CONFIG main: slon version 1.2.9 starting up

d) FATAL  main: Cannot connect to local database - FATAL:  the database system is shutting down
 - sleep 10s

e) ERROR  Process for engine at 'E:\Program Files\PostgreSQL\8.2\Slony\slon.conf' died on startup. 

f) 2007-10-07 03:00:53 LOG:  logger shutting down

2) 10/7/2007: 3:04AM

a) FATAL  main: Cannot connect to local database - FATAL:  the database system is starting up
 - sleep 10s

b) ERROR  Process for engine at 'E:\Program Files\PostgreSQL\8.2\Slony\slon.conf' died on startup. 

c) INFO   started 0 slon engine(s) 

So, it seems that PostgreSQL (v8.2.5) and/or slony-I is causing some kind of trouble, I think?

No virus found in this outgoing message.
Checked by AVG Free Edition. 
Version: 7.5.488 / Virus Database: 269.14.3/1054 - Release Date: 10/6/2007 7:12 PM
 
From jpfletch at ca.afilias.info  Tue Oct  9 06:41:48 2007
From: jpfletch at ca.afilias.info (JP Fletcher)
Date: Tue Oct  9 06:42:24 2007
Subject: [Slony1-general] command_on_logarchive option
In-Reply-To: <4702C09C.6080607@ca.afilias.info>
References: <4702B518.6060602@ca.afilias.info>	<60ejgdmbm6.fsf@dba2.int.libertyrms.com>
	<4702C09C.6080607@ca.afilias.info>
Message-ID: <470B851C.1060304@ca.afilias.info>

In my previous post, I submitted the shell script I was calling w/ 
command_on_logarchive.  Does anyone have any idea why it wouldn't would 
run in some cases?  In my test it only seemed to call the script when a 
sync archive came from a node that is an origin for a set...


JP Fletcher wrote:
> Christopher Browne wrote:
>> JP Fletcher <jpfletch@ca.afilias.info> writes:
>>  
>>> I'm experimenting with logshipping (v.1.2.11) and am using, for the
>>> first time, the option in the slon conf file:
>>>
>>> command_on_logarchive
>>>
>>> I created a shell script that this command calls which applies syncs
>>> archives after they are written:
>>>
>>>   
>>> command_on_logarchive="/opt/clusters/cluster1_slony/archive/apply_archive.sh" 
>>>
>>>
>>> My cluster has four nodes, not counting the log shipped replica, 8141,
>>> 8142, 8143, and 8194.  Node 8194 is the provider to the logshipped
>>> node, so I only configured 'command_on_logarchive' for the slon
>>> servicing this node, my assumption is that this is correct.  Nodes
>>> 8143, and 8141 are origins for sets.
>>>
>>> When I started things up, everything appeared to be fine.  The slon
>>> successfully applied 37 archives, each originating on either node 8141
>>> or 8143.  The 38th archive, however, and several subsequent archives
>>> originated on node 8142.  The slon made no attempt to apply these
>>> archives.  This left the archive counter  on 37.  The next archive the
>>> slon attempted to apply was from node 8143, and  expected the  archive
>>> counter to be on 48, which of course it was not, and everything went
>>> pear-shaped.   I have three questions:
>>>
>>> 1.  Should I have expected the command_on_logarchive option to work,
>>> and if so, did i do something wrong?
>>>     
>>
>> Hopefully apply_archive.sh looked something like:
>>
>> #!/bin/sh
>> PGBINDIR=????
>> ${PGBINDIR}/slony_logshipper $1
>>
>> That might be hoped to work, although not quite right yet in 1.2.11
>>   
>
> #!/bin/bash
>
> SQL_ARCHIVE=$1
>
> /opt/dbs/pgsql81_slonytest/bin/psql -h yrg-testbed2 -p 9533 -U slony 
> -f $SQL_ARCHIVE cluster1_logship >> 
> /opt/clusters/cluster1_slony/archive/apply_archive.log 2>&1
>
> if [ $? != 0 ]; then
>
>   echo "Failed to apply archive $SQL_ARCHIVE >> 
> /opt/clusters/cluster1_slony/archive/apply_archive.log 2>&1"
>   exit 1
>  fi
>
> mv $SQL_ARCHIVE $SQL_ARCHIVE.applied
>
>> :-(.
>>
>>  
>>> 2.  Why does the slon not try to apply archives from node8142?
>>>     
>>
>> slon shouldn't; I think you're meaning the slony_logshipper...
>>   
>
> Yes, of course you're correct, but it doesn't look like the shell 
> script was even run for these files.
>>  
>>> 3.  Why are there archives from a node that is not active (no events
>>> should have originated on 8142, and no archive files exist for the
>>> other non-origin node)?
>>>     
>>
>> The node that isn't active should have very few, very infrequent,
>> archives that are devoid of actual content (beyond the headers).
>>
>> It is expected that there *will* be some events coming from other
>> nodes, as every node does generate events, even if infrequently.
>>
>> The behaviour will change a bit in 1.2.12; Jan just committed some
>> changes at the end of last week to fix up the handling of sequencing
>> of the archives, which turned out to be (sigh) troublesome.
>>   
>
>


-- 
JP Fletcher
Database Administrator
Afilias Canada
voice: 416.646.3304 ext. 4123
fax: 416.646.3305
mobile: 416.561.4763
jpfletch@ca.afilias.info


From bnichols at ca.afilias.info  Tue Oct  9 06:59:50 2007
From: bnichols at ca.afilias.info (Brad Nicholson)
Date: Tue Oct  9 06:59:54 2007
Subject: [Slony1-general] Slony 1.2.11 segfaults on AIX
In-Reply-To: <a06240800c32d963b4954@[192.168.1.200]>
References: <a06240800c32d963b4954@[192.168.1.200]>
Message-ID: <1191938390.7762.12.camel@bnicholson-desktop>

On Sat, 2007-10-06 at 15:58 -0400, Dan Sugalski wrote:
> I've been trying to get Slony installed on some Postgres 8.2.5 
> instances I've got running on a couple of AIX boxes, but with no luck 
> at all, and I'm hoping someone's run into the same problem and has a 
> solution.

Can you us more information about how you built both Postgres and Slony?
We have different version of both Slony and Postgres, but we have them
running fine on AIX.

-- 
Brad Nicholson  416-673-4106
Database Administrator, Afilias Canada Corp.


From dan at sidhe.org  Tue Oct  9 08:33:07 2007
From: dan at sidhe.org (dan@sidhe.org)
Date: Tue Oct  9 08:35:16 2007
Subject: [Slony1-general] Slony 1.2.11 segfaults on AIX
In-Reply-To: <1191938390.7762.12.camel@bnicholson-desktop>
References: <a06240800c32d963b4954@[192.168.1.200]>
	<1191938390.7762.12.camel@bnicholson-desktop>
Message-ID: <28669.199.172.169.15.1191943987.squirrel@localhost>

[Bah, forgot to Cc this to the list...]

> On Sat, 2007-10-06 at 15:58 -0400, Dan Sugalski wrote:
>> I've been trying to get Slony installed on some Postgres 8.2.5
>> instances I've got running on a couple of AIX boxes, but with no luck
>> at all, and I'm hoping someone's run into the same problem and has a
>> solution.
>
> Can you us more information about how you built both Postgres and Slony?
> We have different version of both Slony and Postgres, but we have them
> running fine on AIX.

The relevant bits from pg_config from the current build of postgres I'm
running says:

CONFIGURE = '--enable-thread-safety' '--prefix=/pginstall/pg/pg-8.2.4.aix'
'--without-readline' '--without-zlib' 'CC=xlc' 'CFLAGS=-q64'
CC = xlc
CPPFLAGS =
CFLAGS = -q64 -qnoansialias
CFLAGS_SL =
LDFLAGS = -Wl,-blibpath:/pginstall/pg/pg-8.2.4.aix/lib:/usr/lib:/lib
LDFLAGS_SL = -Wl,-bnoentry -Wl,-H512 -Wl,-bM:SRE
LIBS = -lpgport -lld -lm
VERSION = PostgreSQL 8.2.4

Slonly 1.2.11 was built with:


./configure --with-pgconfigdir=/pginstall/pg/pg-8.2.4.aix/bin/

We're running AIX 5.3, xlc 6, though I'm not sure the xlc version matters.
(This was happening with gcc as well)

-Dan
From plk.zuber at gmail.com  Tue Oct  9 14:38:18 2007
From: plk.zuber at gmail.com (=?UTF-8?Q?Filip_Rembia=C5=82kowski?=)
Date: Tue Oct  9 14:38:27 2007
Subject: [Slony1-general] Seems slony-I is having some problems,
	after some period of time passes...
In-Reply-To: <021126B987E43D44A860139823C079110E2BA4@orion.cdkkt.com>
References: <021126B987E43D44A860139823C079110E2BA4@orion.cdkkt.com>
Message-ID: <92869e660710091438u220b4eb4l4c86e2524edaf704@mail.gmail.com>

2007/10/7, Daniel B. Thurman <dant@cdkkt.com>:
>
> Platform: Win 2000 Server
> Slony-I: v1.2.9
>
> >From my Logs:
>
> 1) 10/7/2007: 300AM
> a) FATAL  syncThread: "start transaction;set transaction isolation level serializable;select last_value from "_MasterCluster".sl_action_seq;" - FATAL:  terminating connection due to administrator command
> server closed the connection unexpectedly
>         This probably means the server terminated abnormally
>         before or while processing the request.

read the message literally; you have a problem with the server itself,
not with slony

what happens if you connect to database with psql and issue the same commands?

F.
From plk.zuber at gmail.com  Tue Oct  9 16:22:30 2007
From: plk.zuber at gmail.com (=?UTF-8?Q?Filip_Rembia=C5=82kowski?=)
Date: Tue Oct  9 16:22:42 2007
Subject: [Slony1-general] Seems slony-I is having some problems,
	after some period of time passes...
In-Reply-To: <021126B987E43D44A860139823C079110E2BA5@orion.cdkkt.com>
References: <021126B987E43D44A860139823C079110E2BA5@orion.cdkkt.com>
Message-ID: <92869e660710091622n2d41b160w6f51c422973bfea6@mail.gmail.com>

2007/10/9, Daniel B. Thurman <dant@cdkkt.com>:
> It works only if I restart PG then Slony-I.  Seems there is
> a startup timing issue after a reboot as I reported before.


 thx for the info, I did not see your previous message

could you please "replay to all" next time? this is a common practice
in these mailing lists - so everybody can see what's going on

cheers, Filip
From WCoole at aperiogroup.com  Wed Oct 10 10:21:07 2007
From: WCoole at aperiogroup.com (Walter Coole)
Date: Wed Oct 10 10:21:03 2007
Subject: [Slony1-general] RE: Newby Help
Message-ID: <4292CEA5F4927248979C701CA83500BB67F090@SERVER.aperiogroup.local>

I haven't found any binary RPMs newer than
postgresql-slony1-engine-1.2.2-1_PG8.2.0.i386.rpm, so it looks like my
best shot is to get the source rpm and compile myself.  What version is
most likely to work (cleanly) with postgresql-server-8.2.4?  Are there
any known major problems with 1.2.10?

 

From: Walter Coole 
Sent: Tuesday, October 09, 2007 6:40 PM
To: 'slony1-general@lists.slony.info'
Subject: Newby Help

 

Is there a simple guide for setting up a simple configuration: 1 master
and 1 slave?

 

I've been attempting to follow
http://slony.info/documentation/index.html, but it seems to assume a
level of knowledge I don't have.

 

I think part of my difficulties is that
postgresql-slony1-engine-1.2.2-1_PG8.2.0.i386.rpm doesn't work with
postgresql-server-8.2.4-1PGDG.i686.rpm .

Is there a known-compatible set of rpms that I could start from?

 

Thanks.

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071010/9cecc5a1/attachment.htm
From stephane.schildknecht at postgresqlfr.org  Wed Oct 10 23:17:26 2007
From: stephane.schildknecht at postgresqlfr.org (=?UTF-8?B?U3TDqXBoYW5lIFNjaGlsZGtuZWNodA==?=)
Date: Wed Oct 10 23:17:44 2007
Subject: [Slony1-general] RE: Newby Help
In-Reply-To: <4292CEA5F4927248979C701CA83500BB67F090@SERVER.aperiogroup.local>
References: <4292CEA5F4927248979C701CA83500BB67F090@SERVER.aperiogroup.local>
Message-ID: <470DBFF6.9020009@postgresqlfr.org>

Walter Coole a ?crit :
>
> I haven?t found any binary RPMs newer than
> postgresql-slony1-engine-1.2.2-1_PG8.2.0.i386.rpm, so it looks like my
> best shot is to get the source rpm and compile myself.  What version
> is most likely to work (cleanly) with postgresql-server-8.2.4?  Are
> there any known major problems with 1.2.10?
>
>  
>
> *From:* Walter Coole
> *Sent:* Tuesday, October 09, 2007 6:40 PM
> *To:* 'slony1-general@lists.slony.info'
> *Subject:* Newby Help
>
>  
>
> Is there a simple guide for setting up a simple configuration: 1
> master and 1 slave?
>
>  
>
> I?ve been attempting to follow
> http://slony.info/documentation/index.html, but it seems to assume a
> level of knowledge I don?t have.
>
>  
>
> I think part of my difficulties is that
> postgresql-slony1-engine-1.2.2-1_PG8.2.0.i386.rpm doesn?t work with
> postgresql-server-8.2.4-1PGDG.i686.rpm .
>
> Is there a known-compatible set of rpms that I could start from?
>
>  
>
> Thanks.
>
>  
>

Hi,

May I suggest PG 8.2.5 and Slony 1.2.11 ?

If I remember what Devrim said a few weeks ago,

./configure
make rpm

works just fine.

What's more, I am using slony1.2.10 with PG8.2.3 and 8.2.4 and with the
exception that I take care about what does not correctly work with
"execute script", it just does what I want it to do. However, we plan to
install slony 1.2.11 against PG825 asap.

Best regards,

-- 
St?phane SCHILDKNECHT
Pr?sident de PostgreSQLFr
http://www.postgresqlfr.org

From m.eriksson at albourne.com  Wed Oct 10 23:56:31 2007
From: m.eriksson at albourne.com (Martin Eriksson)
Date: Wed Oct 10 23:56:51 2007
Subject: [Slony1-general] problem with functions in slony execute script
Message-ID: <470DC91F.1030205@albourne.com>

Hi,

Been using Slony for a while but recently we decided to use a bit more 
of its features for our release process (re-creating nodes is just 
getting too time consuming)

so we keep track of db changes and once release come we just use the 
slonik_execute_script with our update script. This release we modified 
public functions. (droping, modifying, creating)

and looks like slonik statement parser cant handle it.. just get:
DDL Statement failed - PGRES_FATAL_ERROR
when the all the update file contain is
"drop function my_function(integer,integer);

using Slony 1.2.11 and postgres 8.2.4

I assume this a bug, and being worked on any suggestions for a work around?

cheers
Martin

From m.eriksson at albourne.com  Thu Oct 11 00:21:02 2007
From: m.eriksson at albourne.com (Martin Eriksson)
Date: Thu Oct 11 00:22:02 2007
Subject: [Slony1-general] problem with functions in slony execute script
In-Reply-To: <470DC91F.1030205@albourne.com>
References: <470DC91F.1030205@albourne.com>
Message-ID: <470DCEDE.8030200@albourne.com>

well, i guess i've I'd looked a bit harder at the documentation i would 
have been able to answer this without bothering this mailing list.. :/


from documentation:

    *

      There are various sorts of objects that don't have triggers that
      Slony-I /doesn't/ replicate, such as stored functions, and it is
      quite likely to cause you grief if you propagate updates to them
      associated with a replication set where EXECUTE SCRIPT will lock a
      whole lot of tables that didn't really need to be locked.

      If you are propagating a stored procedure that /isn't/ used all
      the time (such that you'd care if it was briefly out of sync
      between nodes), then you could simply submit it to each node using
      psql, making no special use of Slony-I.

      If it /does/ matter that the object be propagated at the same
      location in the transaction stream on all the nodes, then you but
      no tables need to be locked, then you need to use EXECUTE SCRIPT,
      locking challenges or no


so guess that answers my problem.. I'll probably take the whole cluster 
off-line for the update make sure functions are not used and 
drop/create/modify on all nodes separately... a bit of a pain.. but 
doable..


Martin Eriksson wrote:
> Hi,
>
> Been using Slony for a while but recently we decided to use a bit more 
> of its features for our release process (re-creating nodes is just 
> getting too time consuming)
>
> so we keep track of db changes and once release come we just use the 
> slonik_execute_script with our update script. This release we modified 
> public functions. (droping, modifying, creating)
>
> and looks like slonik statement parser cant handle it.. just get:
> DDL Statement failed - PGRES_FATAL_ERROR
> when the all the update file contain is
> "drop function my_function(integer,integer);
>
> using Slony 1.2.11 and postgres 8.2.4
>
> I assume this a bug, and being worked on any suggestions for a work 
> around?
>
> cheers
> Martin
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general

-- 
*_____________________
Martin Eriksson*
/Albourne Partners (Cyprus) Ltd
Maria House, 1 Avlonos Street, Nicosia 1075, Cyprus
P: +357 22 750652| F: +357 22 750654
m.eriksson@albourne.com
www.albourne.com <http://www.albourne.com>

If you are not an intended recipient of this e-mail, please notify the 
sender, delete it and do not read, act upon, print, disclose, copy, 
retain or redistribute it. Please visit 
http://www.albourne.com/email.html 
<http://www.albourne.com/email.html>for important additional terms 
relating to this e-mail.
/
From slony-9999-exp at sblk.de  Thu Oct 11 10:18:28 2007
From: slony-9999-exp at sblk.de (H. Meyer)
Date: Thu Oct 11 10:18:43 2007
Subject: [Slony1-general] Slony1 replication between x86 and x86_64 linux
	systems supported?
Message-ID: <470E5AE4.1050301@sblk.de>

Hi,

I am planning to synchronise two PostgreSQL 8.2.5 databases using Slony1
(one master DB, one read-only slave DB).
However, one of the servers is running Debian Etch i386 and the other
one Debian Etch amd64.
Does Slony1 support the replication between servers with 32bit and 64bit
systems?
Thanks.

Greetings
H. Meyer
From wmoran at collaborativefusion.com  Thu Oct 11 10:27:52 2007
From: wmoran at collaborativefusion.com (Bill Moran)
Date: Thu Oct 11 10:27:59 2007
Subject: [Slony1-general] Slony1 replication between x86 and x86_64
	linux systems supported?
In-Reply-To: <470E5AE4.1050301@sblk.de>
References: <470E5AE4.1050301@sblk.de>
Message-ID: <20071011132752.c8f25bcd.wmoran@collaborativefusion.com>

In response to "H. Meyer" <slony-9999-exp@sblk.de>:

> Hi,
> 
> I am planning to synchronise two PostgreSQL 8.2.5 databases using Slony1
> (one master DB, one read-only slave DB).
> However, one of the servers is running Debian Etch i386 and the other
> one Debian Etch amd64.
> Does Slony1 support the replication between servers with 32bit and 64bit
> systems?

Slony works fine in such circumstances.  I'm doing it here with
production systems.  Slony is abstracted from the OS enough that it
just works.

-- 
Bill Moran
Collaborative Fusion Inc.
http://people.collaborativefusion.com/~wmoran/

wmoran@collaborativefusion.com
Phone: 412-422-3463x4023
From andrew.george.hammond at gmail.com  Thu Oct 11 11:26:21 2007
From: andrew.george.hammond at gmail.com (Andrew Hammond)
Date: Thu Oct 11 11:26:28 2007
Subject: [Slony1-general] problem with functions in slony execute script
In-Reply-To: <470DC91F.1030205@albourne.com>
References: <470DC91F.1030205@albourne.com>
Message-ID: <5a0a9d6f0710111126q3ca0f4aat2fe0e93147de79d2@mail.gmail.com>

On 10/10/07, Martin Eriksson <m.eriksson@albourne.com> wrote:
>
>
> so we keep track of db changes and once release come we just use the
> slonik_execute_script with our update script. This release we modified
> public functions. (droping, modifying, creating)
>
> and looks like slonik statement parser cant handle it.. just get:
> DDL Statement failed - PGRES_FATAL_ERROR
> when the all the update file contain is
> "drop function my_function(integer,integer);
>
> using Slony 1.2.11 and postgres 8.2.4
>
> I assume this a bug, and being worked on any suggestions for a work
> around?
>

Did you test your execute script with psql doing something like

BEGIN;
\i my_ddl_script.sql
ROLLBACK;

And yes, the technique mentioned in the workaround below will work just
fine. In fact, unless you have some reason to believe that your script must
absolutely be kept in sync, then simply running the DDL changes without
taking the cluster off-line shouldn't be a problem. You will obviously need
to co-ordinate these changes with your application, but that's just as
obviously out of scope for a slony mailing list. :)

Andrew
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071011/=
a8954c52/attachment.htm
From craig_james at emolecules.com  Fri Oct 12 08:33:25 2007
From: craig_james at emolecules.com (Craig James)
Date: Fri Oct 12 08:30:34 2007
Subject: [Slony1-general] Copying data from a non-Slony table
In-Reply-To: <200709270717.07797.darcy@dbitech.ca>
References: <46FA8F06.4090901@emolecules.com>	<2ca799770709262115w4215bc83r4d6701ee1e04d28d@mail.gmail.com>	<46FBBA95.2070606@emolecules.com>
	<200709270717.07797.darcy@dbitech.ca>
Message-ID: <470F93C5.7060502@emolecules.com>

The slony-II Wiki has been hit with some serious spamming.  Hundreds of links to pornography, anti-virus, Viagra, etc.  For example: http://www.slony2.org/wiki/index.php?title=Documentation

Craig
From craig_james at emolecules.com  Fri Oct 12 08:34:53 2007
From: craig_james at emolecules.com (Craig James)
Date: Fri Oct 12 08:32:01 2007
Subject: [Slony1-general] Copying data from a non-Slony table
In-Reply-To: <470F93C5.7060502@emolecules.com>
References: <46FA8F06.4090901@emolecules.com>	<2ca799770709262115w4215bc83r4d6701ee1e04d28d@mail.gmail.com>	<46FBBA95.2070606@emolecules.com>	<200709270717.07797.darcy@dbitech.ca>
	<470F93C5.7060502@emolecules.com>
Message-ID: <470F941D.4050507@emolecules.com>

Craig James wrote:
> The slony-II Wiki has been hit with some serious spamming.  Hundreds of 
> links to pornography, anti-virus, Viagra, etc.  For example: 
> http://www.slony2.org/wiki/index.php?title=Documentation

Sorry, I meant to give it a new subject, didn't mean to hijack this thread.

Craig
From ajs at crankycanuck.ca  Fri Oct 12 08:45:30 2007
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Fri Oct 12 08:45:46 2007
Subject: Slony-2 blog spam (was: [Slony1-general] Copying data . . .)
In-Reply-To: <470F93C5.7060502@emolecules.com>
References: <46FA8F06.4090901@emolecules.com>
	<2ca799770709262115w4215bc83r4d6701ee1e04d28d@mail.gmail.com>
	<46FBBA95.2070606@emolecules.com>
	<200709270717.07797.darcy@dbitech.ca>
	<470F93C5.7060502@emolecules.com>
Message-ID: <20071012154530.GH23696@crankycanuck.ca>

On Fri, Oct 12, 2007 at 08:33:25AM -0700, Craig James wrote:
> The slony-II Wiki has been hit with some serious spamming.  Hundreds of 
> links to pornography, anti-virus, Viagra, etc.  For example: 
> http://www.slony2.org/wiki/index.php?title=Documentation

Thanks.  We don't run that site, though.  I think it may be operated
by Gavin Sherry.

A

-- 
Andrew Sullivan  | ajs@crankycanuck.ca
This work was visionary and imaginative, and goes to show that visionary
and imaginative work need not end up well. 
		--Dennis Ritchie
From drees76 at gmail.com  Fri Oct 12 12:35:47 2007
From: drees76 at gmail.com (David Rees)
Date: Fri Oct 12 12:35:55 2007
Subject: Slony-2 blog spam (was: [Slony1-general] Copying data . . .)
In-Reply-To: <20071012154530.GH23696@crankycanuck.ca>
References: <46FA8F06.4090901@emolecules.com>
	<2ca799770709262115w4215bc83r4d6701ee1e04d28d@mail.gmail.com>
	<46FBBA95.2070606@emolecules.com>
	<200709270717.07797.darcy@dbitech.ca>
	<470F93C5.7060502@emolecules.com>
	<20071012154530.GH23696@crankycanuck.ca>
Message-ID: <72dbd3150710121235i6eb3a5b0qc9312cf9a75fe7a8@mail.gmail.com>

On 10/12/07, Andrew Sullivan <ajs@crankycanuck.ca> wrote:
> On Fri, Oct 12, 2007 at 08:33:25AM -0700, Craig James wrote:
> > The slony-II Wiki has been hit with some serious spamming.  Hundreds of
> > links to pornography, anti-virus, Viagra, etc.  For example:
> > http://www.slony2.org/wiki/index.php?title=Documentation
>
> Thanks.  We don't run that site, though.  I think it may be operated
> by Gavin Sherry.

I went ahead and reverted to the last non-spam version.

-Dave
From tim.bowden at westnet.com.au  Fri Oct 12 22:16:57 2007
From: tim.bowden at westnet.com.au (Tim Bowden)
Date: Fri Oct 12 22:17:15 2007
Subject: Slony-2 blog spam (was: [Slony1-general] Copying data . . .)
In-Reply-To: <72dbd3150710121235i6eb3a5b0qc9312cf9a75fe7a8@mail.gmail.com>
References: <46FA8F06.4090901@emolecules.com>
	<2ca799770709262115w4215bc83r4d6701ee1e04d28d@mail.gmail.com>
	<46FBBA95.2070606@emolecules.com> <200709270717.07797.darcy@dbitech.ca>
	<470F93C5.7060502@emolecules.com>
	<20071012154530.GH23696@crankycanuck.ca>
	<72dbd3150710121235i6eb3a5b0qc9312cf9a75fe7a8@mail.gmail.com>
Message-ID: <1192252618.5804.31.camel@edoras>


On Fri, 2007-10-12 at 12:35 -0700, David Rees wrote:
> On 10/12/07, Andrew Sullivan <ajs@crankycanuck.ca> wrote:
> > On Fri, Oct 12, 2007 at 08:33:25AM -0700, Craig James wrote:
> > > The slony-II Wiki has been hit with some serious spamming.  Hundreds of
> > > links to pornography, anti-virus, Viagra, etc.  For example:
> > > http://www.slony2.org/wiki/index.php?title=Documentation
> >
> > Thanks.  We don't run that site, though.  I think it may be operated
> > by Gavin Sherry.
> 
> I went ahead and reverted to the last non-spam version.
> 
> -Dave

Might need to be locked down a little more.  Spam's still there.

Tim Bowden


From drees76 at gmail.com  Sat Oct 13 00:14:22 2007
From: drees76 at gmail.com (David Rees)
Date: Sat Oct 13 00:14:36 2007
Subject: Slony-2 blog spam (was: [Slony1-general] Copying data . . .)
In-Reply-To: <1192252618.5804.31.camel@edoras>
References: <46FA8F06.4090901@emolecules.com>
	<2ca799770709262115w4215bc83r4d6701ee1e04d28d@mail.gmail.com>
	<46FBBA95.2070606@emolecules.com>
	<200709270717.07797.darcy@dbitech.ca>
	<470F93C5.7060502@emolecules.com>
	<20071012154530.GH23696@crankycanuck.ca>
	<72dbd3150710121235i6eb3a5b0qc9312cf9a75fe7a8@mail.gmail.com>
	<1192252618.5804.31.camel@edoras>
Message-ID: <72dbd3150710130014r5bdf70a1sc0ebaa66d65443be@mail.gmail.com>

On 10/12/07, Tim Bowden <tim.bowden@westnet.com.au> wrote:
> On Fri, 2007-10-12 at 12:35 -0700, David Rees wrote:
> > On 10/12/07, Andrew Sullivan <ajs@crankycanuck.ca> wrote:
> > > Thanks.  We don't run that site, though.  I think it may be operated
> > > by Gavin Sherry.
> >
> > I went ahead and reverted to the last non-spam version.
>
> Might need to be locked down a little more.  Spam's still there.

*sigh* reverted it again. The wiki needs some anti-spam measures put
into place. Anyone contact Gavin?

-Dave
From craig_james at emolecules.com  Sat Oct 13 10:44:47 2007
From: craig_james at emolecules.com (Craig James)
Date: Sat Oct 13 10:41:54 2007
Subject: [Slony1-general] Re: Slony-2 blog spam
In-Reply-To: <72dbd3150710130014r5bdf70a1sc0ebaa66d65443be@mail.gmail.com>
References: <46FA8F06.4090901@emolecules.com>	<2ca799770709262115w4215bc83r4d6701ee1e04d28d@mail.gmail.com>	<46FBBA95.2070606@emolecules.com>	<200709270717.07797.darcy@dbitech.ca>	<470F93C5.7060502@emolecules.com>	<20071012154530.GH23696@crankycanuck.ca>	<72dbd3150710121235i6eb3a5b0qc9312cf9a75fe7a8@mail.gmail.com>	<1192252618.5804.31.camel@edoras>
	<72dbd3150710130014r5bdf70a1sc0ebaa66d65443be@mail.gmail.com>
Message-ID: <4711040F.8050608@emolecules.com>

David Rees wrote:
> On 10/12/07, Tim Bowden <tim.bowden@westnet.com.au> wrote:
>> On Fri, 2007-10-12 at 12:35 -0700, David Rees wrote:
>>> On 10/12/07, Andrew Sullivan <ajs@crankycanuck.ca> wrote:
>>>> Thanks.  We don't run that site, though.  I think it may be operated
>>>> by Gavin Sherry.
>>> I went ahead and reverted to the last non-spam version.
>> Might need to be locked down a little more.  Spam's still there.
> 
> *sigh* reverted it again. The wiki needs some anti-spam measures put
> into place. Anyone contact Gavin?

Apparently a lot of tech wikis are having this problem.  Some spammers have figured out how to create accounts, and their bots are defacing all sorts of tech sites.  Don't bother restoring it until the spam blocking is in place, it's just a waste of time.

Craig

From cbbrowne at ca.afilias.info  Mon Oct 15 08:01:53 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Mon Oct 15 08:02:07 2007
Subject: [Slony1-general] Slony1 replication between x86 and x86_64 linux
	systems supported?
In-Reply-To: <470E5AE4.1050301@sblk.de> (H. Meyer's message of "Thu,
	11 Oct 2007 19:18:28 +0200")
References: <470E5AE4.1050301@sblk.de>
Message-ID: <60odf0mnfi.fsf@dba2.int.libertyrms.com>

"H. Meyer" <slony-9999-exp@sblk.de> writes:
> I am planning to synchronise two PostgreSQL 8.2.5 databases using Slony1
> (one master DB, one read-only slave DB).
> However, one of the servers is running Debian Etch i386 and the other
> one Debian Etch amd64.
> Does Slony1 support the replication between servers with 32bit and 64bit
> systems?

Should work fine - we have historically replicated between boxes
running AIX and Solaris, with radically different hardware involved,
so "little" differences like x86 versus x86_64 should be no big deal.

Actually, there was a period of time when we were running a build of
PostgreSQL and Slony-I compiled for Red Hat Advanced Server (or was it
RHEL?  don't recall...) (32 bit IA-32) on some Opteron boxs running
SuSE Linux in 64 bit mode.

It wasn't until I was needing to upgrade some (not-Slony-I-related) C
functions that it was discovered that entirely the wrong kind of
binaries had been installed.  No problems had been encountered...
-- 
let name="cbbrowne" and tld="linuxdatabases.info" in String.concat "@" [name;tld];;
http://www3.sympatico.ca/cbbrowne/
"Cars  move  huge weights at   high    speeds by controlling   violent
explosions many times a second.  ...car analogies are always fatal..."
-- <westprog@my-dejanews.com>
From petergeoghegan at hotmail.com  Tue Oct 16 00:58:07 2007
From: petergeoghegan at hotmail.com (Peter Geoghegan)
Date: Tue Oct 16 00:58:21 2007
Subject: [Slony1-general] Making one system a master in respect of some
 replication set, but a slave in respect of another
Message-ID: <BAY122-W3007879778011332FF69D1D69C0@phx.gbl>


Hello,
 =

I had hoped one of you could answer a query about Slony-I's functionality. =

 =

I propose creating what is a multi-master replication set in an extremely l=
imited sense. The master is where data about items in stock and their detai=
ls are stored. The slaves have no cause to modify these tables, but require=
 their own local copies, which they acquire through replication. However, t=
he nodes need to report some things back to the master (which is where the =
core business logic is implemented), where they may have there own table(s)=
 that accrue information given by the slaves (sales information). So, there=
 are different masters, but each is a master only in respect of its own tab=
les (replication set).
 =

The question is, can I use slony-I in this way to retrieve this information=
 from the slaves, or will I need to devise another mechanism, such as accru=
eing sales as XML or something, and sending them via some generic messaging=
 protocol (the system is implemented in C++) ?,
 =

Regards,
Peter Geoghegan
_________________________________________________________________
Download 30 FREE Emoticons for your Windows Live Messenger!
http://www.livemessenger-emoticons.com/en-ie/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071016/=
4ccdd1d3/attachment.htm
From ajs at crankycanuck.ca  Tue Oct 16 06:59:31 2007
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Tue Oct 16 06:59:44 2007
Subject: [Slony1-general] Making one system a master in respect of some
	replication set, but a slave in respect of another
In-Reply-To: <BAY122-W3007879778011332FF69D1D69C0@phx.gbl>
References: <BAY122-W3007879778011332FF69D1D69C0@phx.gbl>
Message-ID: <20071016135931.GE3255@crankycanuck.ca>

On Tue, Oct 16, 2007 at 08:58:07AM +0100, Peter Geoghegan wrote:
>  
> The question is, can I use slony-I in this way to retrieve this
> information from the slaves, or will I need to devise another
> mechanism, such as accrueing sales as XML or something, and sending
> them via some generic messaging protocol (the system is implemented
> in C++) ?,

You can do it with Slony, but you'll need to jump through some hoops
to manage it, I suspect.

The key is to see that Slony doesn't replicate a _database_, but a
set of tables.  So there's a set that contains the data that every
node needs, and that is replicated to all the "remote" nodes.  Then,
each "remote" node has a set of local tables which are replicated to
the "central" node.  You'll probably want a view on the "central"
system that allows it to view the aggregated data from all the
"remote" nodes.  You'll also need to do some scripting, I think, to
make this system even somewhat sane to manage.

A

-- 
Andrew Sullivan  | ajs@crankycanuck.ca
When my information changes, I alter my conclusions.  What do you do sir?
		--attr. John Maynard Keynes
From cbbrowne at ca.afilias.info  Tue Oct 16 12:54:22 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Tue Oct 16 12:54:33 2007
Subject: [Slony1-general] Bug Tracking
Message-ID: <60myuiltsh.fsf@dba2.int.libertyrms.com>

One thing that seems to have fallen by the wayside in the migration
from gBorg to the nice new digs of main.slony.info at Command Prompt
is the bug tracker.

We used to have the gBorg bug tracker; there is not now any tooling to
help support tracking bugs.  I have been getting pestered by some
community members about this, as the statuses of some of the issues
that have come up in the v1.2 branch have not been totally obvious.

Way Back When, we were talking about the migration from gBorg to the
new site, there was some enthusiasm over using a Bugzilla instance at
Command Prompt, which seems still to be there at
<http://pgbugs.commandprompt.com/>.

Is that still something that people would be enthusiastic about?  

I think activating it would take some (hopefully small?) amount of
effort on Command Prompt's part...
-- 
let name="cbbrowne" and tld="linuxdatabases.info" in String.concat "@" [name;tld];;
http://linuxfinances.info/info/lisp.html
C program run -- Run program run -- Run, C program, Run! -- (please)
From nico-postgres-slony1 at schottelius.org  Wed Oct 17 08:51:14 2007
From: nico-postgres-slony1 at schottelius.org (Nico Schottelius)
Date: Wed Oct 17 08:51:19 2007
Subject: [Slony1-general] Problem initialising the cluster
Message-ID: <20071017155114.GA32273@schottelius.org>

Hello guys!

I'm trying to initialise the cluster and get the following error:

[17:49] u0235:slony-I# slonik < slonik_init_3 
<stdin>:15: PGRES_FATAL_ERROR select
"_testcluster3".determineIdxnameUnique('public.history', NULL);  -
ERROR:  Slony-I: table "public"."history" has no primary key
[17:49] u0235:slony-I# 

Although I've this:

table add key (node id = 1, fully qualified name = 'public.history');

I'm using the pgbench example as found on slony.info/.../firstdb.html

This is the full slonik script I use:
--------------------------------------------------------------------------------
[17:50] u0235:slony-I# cat slonik_init_3     
cluster name = testcluster3;

node 1 admin conninfo = 'dbname=pgbench host=localhost user=pgbench';
node 2 admin conninfo = 'dbname=pgbenchslave host=localhost
user=pgbench';

init cluster ( id=1, comment = 'Master Node' );

table add key (node id = 1, fully qualified name = 'public.history');

create set (id=1, origin=1, comment='All pgbench tables');

set add table (set id=1, origin=1, id=1, fully qualified name =
'public.accounts', comment='accounts table');
set add table (set id=1, origin=1, id=2, fully qualified name =
'public.branches', comment='branches table');
set add table (set id=1, origin=1, id=3, fully qualified name =
'public.tellers', comment='tellers table');
set add table (set id=1, origin=1, id=4, fully qualified name =
'public.history', comment='history table');

store node (id=2, comment = 'Slave node');
store path (server = 1, client =2, conninfo='dbname=pgbench
host=localhost user=pgbench');
store path (server = 2, client =1, conninfo='dbname=pgbenchslave
host=localhost user=pgbench');
[17:50] u0235:slony-I# 

--------------------------------------------------------------------------------

Anyone a hint on what I am doing wrong?

Sincerly

Nico

-- 
Think about Free and Open Source Software (FOSS).
http://nico.schottelius.org/documentations/foss/the-term-foss/

PGP: BFE4 C736 ABE5 406F 8F42  F7CF B8BE F92A 9885 188C
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: Digital signature
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20071017/c27ca159/attachment.pgp
From bnichols at ca.afilias.info  Wed Oct 17 09:08:53 2007
From: bnichols at ca.afilias.info (Brad Nicholson)
Date: Wed Oct 17 09:08:59 2007
Subject: [Slony1-general] Problem initialising the cluster
In-Reply-To: <20071017155114.GA32273@schottelius.org>
References: <20071017155114.GA32273@schottelius.org>
Message-ID: <1192637333.6131.27.camel@bnicholson-desktop>

On Wed, 2007-10-17 at 17:51 +0200, Nico Schottelius wrote:
> Hello guys!
> 
> I'm trying to initialise the cluster and get the following error:
> 
> [17:49] u0235:slony-I# slonik < slonik_init_3 
> <stdin>:15: PGRES_FATAL_ERROR select
> "_testcluster3".determineIdxnameUnique('public.history', NULL);  -
> ERROR:  Slony-I: table "public"."history" has no primary key
> [17:49] u0235:slony-I# 
> 
> Although I've this:
> 
> table add key (node id = 1, fully qualified name = 'public.history');

Yikes!!  Don't use table add key.  The developement team have
acknowledged it as a mis-feature, and it will be removed (I beleive).
Add your own key to the table and use that.

-- 
Brad Nicholson  416-673-4106
Database Administrator, Afilias Canada Corp.


From darcyb at commandprompt.com  Wed Oct 17 09:24:52 2007
From: darcyb at commandprompt.com (Darcy Buskermolen)
Date: Wed Oct 17 09:25:10 2007
Subject: [Slony1-general] Problem initialising the cluster
In-Reply-To: <1192637333.6131.27.camel@bnicholson-desktop>
References: <20071017155114.GA32273@schottelius.org>
	<1192637333.6131.27.camel@bnicholson-desktop>
Message-ID: <200710170924.53217.darcyb@commandprompt.com>

On Wednesday 17 October 2007 09:08:53 Brad Nicholson wrote:
> On Wed, 2007-10-17 at 17:51 +0200, Nico Schottelius wrote:
> > Hello guys!
> >
> > I'm trying to initialise the cluster and get the following error:
> >
> > [17:49] u0235:slony-I# slonik < slonik_init_3
> > <stdin>:15: PGRES_FATAL_ERROR select
> > "_testcluster3".determineIdxnameUnique('public.history', NULL);  -
> > ERROR:  Slony-I: table "public"."history" has no primary key
> > [17:49] u0235:slony-I#
> >
> > Although I've this:
> >
> > table add key (node id = 1, fully qualified name = 'public.history');
>
> Yikes!!  Don't use table add key.  The developement team have
> acknowledged it as a mis-feature, and it will be removed (I beleive).

Yes in -HEAD it has been removed, do not expect this misfeature to be there in 
1.3 once released.


> Add your own key to the table and use that.



-- 


Darcy Buskermolen
The PostgreSQL company, Command Prompt Inc.
http://www.commandprompt.com/
From WCoole at aperiogroup.com  Wed Oct 17 10:51:07 2007
From: WCoole at aperiogroup.com (Walter Coole)
Date: Wed Oct 17 10:51:16 2007
Subject: [Slony1-general] RE: Newby Help
In-Reply-To: <470DBFF6.9020009@postgresqlfr.org>
References: <4292CEA5F4927248979C701CA83500BB67F090@SERVER.aperiogroup.local>
	<470DBFF6.9020009@postgresqlfr.org>
Message-ID: <4292CEA5F4927248979C701CA83500BB67F205@SERVER.aperiogroup.local>

Thanks for the hint; I've gotten and unpacked slony1-1.2.10.tar.bz2, configure apparently needs pg_config, which is apparently part of the package postgresql-devel.

	yum install postgresql-devel 

throws the error:

	Error: Missing Dependency: libpq.so.5 is needed by package postgresql-server
	Error: Missing Dependency: postgresql = 8.2.4 is needed by package postgresql-server

I find this error confusing, since

	yum info postgresql

says:

	...
	Installed Packages
	Name   : postgresql
	Arch   : i686
	Version: 8.2.4
	...

It sounds like yum is saying "I have postgresql 8.2.4 installed, but I need to install postgresql 8.2.4 to resolve a dependency.", which doesn't make sense.

Have I misunderstood what is needed to install Slony on a Fedora 6 system running postgresql 8.2.4?

Are there more specific instructions on how to install for this system than the ones I'm following (http://slony.info/documentation/installation.html )?

Thanks!

-----Original Message-----
From: slony1-general-bounces@lists.slony.info [mailto:slony1-general-bounces@lists.slony.info] On Behalf Of St?phane Schildknecht
Sent: Wednesday, October 10, 2007 11:17 PM
To: Walter Coole
Cc: slony1-general@lists.slony.info
Subject: Re: [Slony1-general] RE: Newby Help

Walter Coole a ?crit :
>
> I haven?t found any binary RPMs newer than
> postgresql-slony1-engine-1.2.2-1_PG8.2.0.i386.rpm, so it looks like my
> best shot is to get the source rpm and compile myself.  What version
> is most likely to work (cleanly) with postgresql-server-8.2.4?  Are
> there any known major problems with 1.2.10?
>
>  
>
> *From:* Walter Coole
> *Sent:* Tuesday, October 09, 2007 6:40 PM
> *To:* 'slony1-general@lists.slony.info'
> *Subject:* Newby Help
>
>  
>
> Is there a simple guide for setting up a simple configuration: 1
> master and 1 slave?
>
>  
>
> I?ve been attempting to follow
> http://slony.info/documentation/index.html, but it seems to assume a
> level of knowledge I don?t have.
>
>  
>
> I think part of my difficulties is that
> postgresql-slony1-engine-1.2.2-1_PG8.2.0.i386.rpm doesn?t work with
> postgresql-server-8.2.4-1PGDG.i686.rpm .
>
> Is there a known-compatible set of rpms that I could start from?
>
>  
>
> Thanks.
>
>  
>

Hi,

May I suggest PG 8.2.5 and Slony 1.2.11 ?

If I remember what Devrim said a few weeks ago,

./configure
make rpm

works just fine.

What's more, I am using slony1.2.10 with PG8.2.3 and 8.2.4 and with the
exception that I take care about what does not correctly work with
"execute script", it just does what I want it to do. However, we plan to
install slony 1.2.11 against PG825 asap.

Best regards,

-- 
St?phane SCHILDKNECHT
Pr?sident de PostgreSQLFr
http://www.postgresqlfr.org

_______________________________________________
Slony1-general mailing list
Slony1-general@lists.slony.info
http://lists.slony.info/mailman/listinfo/slony1-general
From WCoole at aperiogroup.com  Wed Oct 17 14:32:09 2007
From: WCoole at aperiogroup.com (Walter Coole)
Date: Wed Oct 17 14:32:18 2007
Subject: [Slony1-general] RE: Newby Help
In-Reply-To: <4292CEA5F4927248979C701CA83500BB67F205@SERVER.aperiogroup.local>
References: <4292CEA5F4927248979C701CA83500BB67F090@SERVER.aperiogroup.local><470DBFF6.9020009@postgresqlfr.org>
	<4292CEA5F4927248979C701CA83500BB67F205@SERVER.aperiogroup.local>
Message-ID: <4292CEA5F4927248979C701CA83500BB67F21A@SERVER.aperiogroup.local>

In the answering-my-own-question style:

I found that if I got the postgresql-devel-8.2.4-1PGDG.i386.rpm from http://rpm.pbone.net/index.php3/stat/4/idpl/4556810/com/postgresql-devel-8.2.4-1PGDG.i386.rpm.html , used rpm to find out what its dependencies were, used yum to resolve each of the dependencies, and then installed that rpm with rpm, I got it working to the point that I was able to wade through the instructions at http://slony.info/documentation/firstdb.html .

I actually managed to replicate a table!

Thanks.

-----Original Message-----
From: slony1-general-bounces@lists.slony.info [mailto:slony1-general-bounces@lists.slony.info] On Behalf Of Walter Coole
Sent: Wednesday, October 17, 2007 10:51 AM
To: St?phane Schildknecht
Cc: slony1-general@lists.slony.info
Subject: RE: [Slony1-general] RE: Newby Help

Thanks for the hint; I've gotten and unpacked slony1-1.2.10.tar.bz2, configure apparently needs pg_config, which is apparently part of the package postgresql-devel.

	yum install postgresql-devel 

throws the error:

	Error: Missing Dependency: libpq.so.5 is needed by package postgresql-server
	Error: Missing Dependency: postgresql = 8.2.4 is needed by package postgresql-server

I find this error confusing, since

	yum info postgresql

says:

	...
	Installed Packages
	Name   : postgresql
	Arch   : i686
	Version: 8.2.4
	...

It sounds like yum is saying "I have postgresql 8.2.4 installed, but I need to install postgresql 8.2.4 to resolve a dependency.", which doesn't make sense.

Have I misunderstood what is needed to install Slony on a Fedora 6 system running postgresql 8.2.4?

Are there more specific instructions on how to install for this system than the ones I'm following (http://slony.info/documentation/installation.html )?

Thanks!

-----Original Message-----
From: slony1-general-bounces@lists.slony.info [mailto:slony1-general-bounces@lists.slony.info] On Behalf Of St?phane Schildknecht
Sent: Wednesday, October 10, 2007 11:17 PM
To: Walter Coole
Cc: slony1-general@lists.slony.info
Subject: Re: [Slony1-general] RE: Newby Help

Walter Coole a ?crit :
>
> I haven?t found any binary RPMs newer than 
> postgresql-slony1-engine-1.2.2-1_PG8.2.0.i386.rpm, so it looks like my 
> best shot is to get the source rpm and compile myself.  What version 
> is most likely to work (cleanly) with postgresql-server-8.2.4?  Are 
> there any known major problems with 1.2.10?
>
>  
>
> *From:* Walter Coole
> *Sent:* Tuesday, October 09, 2007 6:40 PM
> *To:* 'slony1-general@lists.slony.info'
> *Subject:* Newby Help
>
>  
>
> Is there a simple guide for setting up a simple configuration: 1 
> master and 1 slave?
>
>  
>
> I?ve been attempting to follow
> http://slony.info/documentation/index.html, but it seems to assume a 
> level of knowledge I don?t have.
>
>  
>
> I think part of my difficulties is that 
> postgresql-slony1-engine-1.2.2-1_PG8.2.0.i386.rpm doesn?t work with 
> postgresql-server-8.2.4-1PGDG.i686.rpm .
>
> Is there a known-compatible set of rpms that I could start from?
>
>  
>
> Thanks.
>
>  
>

Hi,

May I suggest PG 8.2.5 and Slony 1.2.11 ?

If I remember what Devrim said a few weeks ago,

./configure
make rpm

works just fine.

What's more, I am using slony1.2.10 with PG8.2.3 and 8.2.4 and with the exception that I take care about what does not correctly work with "execute script", it just does what I want it to do. However, we plan to install slony 1.2.11 against PG825 asap.

Best regards,

--
St?phane SCHILDKNECHT
Pr?sident de PostgreSQLFr
http://www.postgresqlfr.org

_______________________________________________
Slony1-general mailing list
Slony1-general@lists.slony.info
http://lists.slony.info/mailman/listinfo/slony1-general
From henry at zen.co.za  Thu Oct 18 01:15:17 2007
From: henry at zen.co.za (Henry - Zen Search SA)
Date: Thu Oct 18 01:16:01 2007
Subject: [Slony1-general] Re-enabling replication for dropped table.
Message-ID: <63797.196.23.181.69.1192695317.squirrel@zenmail.co.za>


Hello all,

I've clicked around for hours, but cannot seem to find the answer (I wish
lists.slony.info had a friggin search facility like any sane mailing
list).

Here's the problem:

Replication is working perfectly between a master and slave.

An automated script which was missed dropped one of the tables which is
part of the replication set.

How can I re-enable replication on that one table?  The slon documentation
is replete with commands to do things, but nothing about how to deal with
this kind of scenario (ie, the table has been recreated, but the
replication trigger [with it's funny arguments] has been zapped).  The row
for this table in _dialup_cluster.sl_table still exists, but I have no
idea how to proceed to get this table back into the fold.


Thanks for the any pointers.

Regards
Henry

From drees76 at gmail.com  Thu Oct 18 02:06:34 2007
From: drees76 at gmail.com (David Rees)
Date: Thu Oct 18 02:06:54 2007
Subject: [Slony1-general] Re-enabling replication for dropped table.
In-Reply-To: <63797.196.23.181.69.1192695317.squirrel@zenmail.co.za>
References: <63797.196.23.181.69.1192695317.squirrel@zenmail.co.za>
Message-ID: <72dbd3150710180206y121ed0f5ub4a0603c7c8aa58c@mail.gmail.com>

On 10/18/07, Henry - Zen Search SA <henry@zen.co.za> wrote:
> How can I re-enable replication on that one table?  The slon documentation
> is replete with commands to do things, but nothing about how to deal with
> this kind of scenario (ie, the table has been recreated, but the
> replication trigger [with it's funny arguments] has been zapped).  The row
> for this table in _dialup_cluster.sl_table still exists, but I have no
> idea how to proceed to get this table back into the fold.

The easiest solution will be to drop replication from those nodes and
restart from scratch. If you can afford the time to do this, that
should work.

Otherwise, someone with more internal Slony knowledge will have to
chime in on what tables will have to be mucked with before adding the
table to a new set and merging the sets together.

-Dave
From henry at zen.co.za  Thu Oct 18 02:42:40 2007
From: henry at zen.co.za (Henry - Zen Search SA)
Date: Thu Oct 18 02:43:22 2007
Subject: [Slony1-general] Re-enabling replication for dropped table.
In-Reply-To: <72dbd3150710180206y121ed0f5ub4a0603c7c8aa58c@mail.gmail.com>
References: <63797.196.23.181.69.1192695317.squirrel@zenmail.co.za>
	<72dbd3150710180206y121ed0f5ub4a0603c7c8aa58c@mail.gmail.com>
Message-ID: <61990.196.23.181.69.1192700560.squirrel@zenmail.co.za>


Thanks for the prompt response, Dave.

On Thu, October 18, 2007 11:06 am, David Rees wrote:
> The easiest solution will be to drop replication from those nodes and
> restart from scratch. If you can afford the time to do this, that
> should work.

ja, I though of that - just such a mission for a single table though.  I'm
loath to take that horrible Microsoft approach.

> Otherwise, someone with more internal Slony knowledge will have to
> chime in on what tables will have to be mucked with before adding the
> table to a new set and merging the sets together.

Muck is the right word.  Slony's (seems) great, but crikey, what a
complicated system.  Then again, maybe it just seems that way because it's
so bloody complicated to work with.

I think slony needs *another* layer on top of slonik - so much of it is
hit and miss.

How about this:  how does slony determine the last argument for the
_db_cluster.logtrigger() trigger?

_db_cluster.logtrigger('_db_cluster', '2', 'vvk'):

::  '_db_cluster' is obvious - that's the DB name.
::  '2' is the tab_id (from schema.sl_table)
::  what is that ever-growing series of 'v's in 'vvk'?

If I can determine what to stick in there, then I can try recreating that
trigger manually and see what happens.



Regards
Henry

--
Zen Search SA
http://zen.co.za/
From slony-9999-exp at sblk.de  Thu Oct 18 02:48:17 2007
From: slony-9999-exp at sblk.de (H. Meyer)
Date: Thu Oct 18 02:48:41 2007
Subject: [Slony1-general] slony-1 logging non-modifying updates in sl_log_1
Message-ID: <47172BE1.5070503@sblk.de>

Hi,

I've just recently started to use slony-1 (thanks to all you guys who
replied to my last message about 32bit<->64bit OS replication btw :o).

Everything seems to be working perfectly at the moment.
However, there are some strange entries in sl_log_1.
i.e.

> select * from _replication.sl_log_1 where log_xid=39903977;
 log_origin | log_xid  | log_tableid | log_actionseq | log_cmdtype |
       log_cmddata
------------+----------+-------------+---------------+-------------+---------------------------------
          1 | 39903977 |          72 |        691449 | U           |
id='2210825' where id='2210825'

The column "id" is the primary key of that table. And as far as I know
(wasn't able to verify that yet) none of our queries would ever do
something like UPDATE ... SET id=X,... WHERE id=X.

But even if there are such queries, why would slony-1 need to log that?
No data was modified, so nothing needs to be replicated.
Just curious :o)

And one other thing. I've read in the documentation that someone wrote a
script to get slony-1 stats printed in mrtg. Has anything similar been
done for munin (http://munin.projects.linpro.no/) yet? If not, I might
be looking into that. Not quite sure which values would be most
interesting to display though.
st_lag_num_events and/or st_lag_time in sl_status seem interesting.
Anything else?

Greetings
H. Meyer
From ajs at crankycanuck.ca  Thu Oct 18 04:46:11 2007
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Thu Oct 18 04:46:42 2007
Subject: [Slony1-general] Re-enabling replication for dropped table.
In-Reply-To: <63797.196.23.181.69.1192695317.squirrel@zenmail.co.za>
References: <63797.196.23.181.69.1192695317.squirrel@zenmail.co.za>
Message-ID: <20071018114611.GJ9189@crankycanuck.ca>

On Thu, Oct 18, 2007 at 10:15:17AM +0200, Henry - Zen Search SA wrote:
> 
> An automated script which was missed dropped one of the tables which is
> part of the replication set.

I think we need more information to help you.  Do you mean a script
performed 

	DROP TABLE tablename

on the origin, and not on the replica?

If so, then yes, you have some problems.

What you need to do is use the internal functions of slony on the
replicas to remove that table from the replication set.  This is the
man page you want to read:

http://slony.info/documentation/function.setdroptable-int-integer.html

Then, you drop the table on the replica.  If you want to have it back
again, don't drop it, but you can TRUNCATE it if you want.  Rebuild
the table on the origin, add it to a _new_ set and subscribe the
replica to it.  Then, optionally, MERGE SET to put it back into the
single set you have.  And _make sure_ you don't have any other
"automated scripts" helpfully cleaning out tables for you ;-)

I strongly suggest you try this out several times on a test system,
make a script that performs all the commands for you, and then use
that script to do the work.  This is not the sort of operation you
want to fat finger.

A

-- 
Andrew Sullivan  | ajs@crankycanuck.ca
In the future this spectacle of the middle classes shocking the avant-
garde will probably become the textbook definition of Postmodernism. 
                --Brad Holland
From ajs at crankycanuck.ca  Thu Oct 18 04:53:17 2007
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Thu Oct 18 04:53:43 2007
Subject: [Slony1-general] Re-enabling replication for dropped table.
In-Reply-To: <61990.196.23.181.69.1192700560.squirrel@zenmail.co.za>
References: <63797.196.23.181.69.1192695317.squirrel@zenmail.co.za>
	<72dbd3150710180206y121ed0f5ub4a0603c7c8aa58c@mail.gmail.com>
	<61990.196.23.181.69.1192700560.squirrel@zenmail.co.za>
Message-ID: <20071018115317.GK9189@crankycanuck.ca>

On Thu, Oct 18, 2007 at 11:42:40AM +0200, Henry - Zen Search SA wrote:
> > restart from scratch. If you can afford the time to do this, that
> > should work.
> 
> ja, I though of that - just such a mission for a single table though.  I'm
> loath to take that horrible Microsoft approach.

I don't think it's a "Microsoft approach".  What you had was a script
that did something akin to zapping /etc or /usr/bin or such like on a
UNIX box -- some people would conclude that it's easier to reinstall
the OS and then restore from backup than to try to patch up the
running system.

> Muck is the right word.  Slony's (seems) great, but crikey, what a
> complicated system.  Then again, maybe it just seems that way because it's
> so bloody complicated to work with.

Well, it's a very flexible tool with powerful capabilities.  More
powerful systems tend to be more complicated.  That said. . .

> I think slony needs *another* layer on top of slonik - so much of it is
> hit and miss.

. . .slonik was intended to be a bootstrapping user interface, and
Jan always hoped someone would make a _nice_ UI for Slony.  I gather
that (mumble pgadmin?) has done some work in that direction.

> How about this:  how does slony determine the last argument for the
> _db_cluster.logtrigger() trigger?

It has to do with the kinds of data that will be sent.  I think you
don't want to be fooling with this unless you already understand the
C code that underlies the trigger. 

> If I can determine what to stick in there, then I can try recreating that
> trigger manually and see what happens.

I would suggest you not do it that way.  See my other post about how
to refresh this table.  You need to rebuild it from scratch.  You
don't have to drop everything; just that table.

A
-- 
Andrew Sullivan  | ajs@crankycanuck.ca
The fact that technology doesn't work is no bar to success in the marketplace.
		--Philip Greenspun
From ajs at crankycanuck.ca  Thu Oct 18 04:57:17 2007
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Thu Oct 18 04:57:44 2007
Subject: [Slony1-general] slony-1 logging non-modifying updates in sl_log_1
In-Reply-To: <47172BE1.5070503@sblk.de>
References: <47172BE1.5070503@sblk.de>
Message-ID: <20071018115717.GN9189@crankycanuck.ca>

On Thu, Oct 18, 2007 at 11:48:17AM +0200, H. Meyer wrote:

> But even if there are such queries, why would slony-1 need to log that?
> No data was modified, so nothing needs to be replicated.
> Just curious :o)

In a non-modifying case like this, Slony still needs to log it,
because just because the query didn't cause modification on the
_origin_ doesn't mean it might not do it on the _replica_.  There
could, for instance, be a trigger on the replica that causes
modification as a side effect.  So the replicas still need to know
about it.

A

-- 
Andrew Sullivan  | ajs@crankycanuck.ca
When my information changes, I alter my conclusions.  What do you do sir?
		--attr. John Maynard Keynes
From henry at zen.co.za  Thu Oct 18 06:37:47 2007
From: henry at zen.co.za (Henry - Zen Search SA)
Date: Thu Oct 18 06:38:17 2007
Subject: [Slony1-general] Re-enabling replication for dropped table.
In-Reply-To: <20071018114611.GJ9189@crankycanuck.ca>
References: <63797.196.23.181.69.1192695317.squirrel@zenmail.co.za>
	<20071018114611.GJ9189@crankycanuck.ca>
Message-ID: <64474.196.23.181.69.1192714667.squirrel@zenmail.co.za>


On Thu, October 18, 2007 1:46 pm, Andrew Sullivan wrote:
> On Thu, Oct 18, 2007 at 10:15:17AM +0200, Henry - Zen Search SA wrote:
>>
>> An automated script which was missed dropped one of the tables which is
>> part of the replication set.
>
> I think we need more information to help you.  Do you mean a script
> performed
>
> 	DROP TABLE tablename
>
> on the origin, and not on the replica?
>
> If so, then yes, you have some problems.

Yes, this is what happened.  A miserable little legacy script floating
around (instead of DELETEing, it DROPped and repopulated - don't ask).

> What you need to do is use the internal functions of slony on the
> replicas to remove that table from the replication set.  This is the
> man page you want to read:
>
> http://slony.info/documentation/function.setdroptable-int-integer.html
>
> Then, you drop the table on the replica.  If you want to have it back
> again, don't drop it, but you can TRUNCATE it if you want.  Rebuild
> the table on the origin, add it to a _new_ set and subscribe the
> replica to it.  Then, optionally, MERGE SET to put it back into the
> single set you have.  And _make sure_ you don't have any other
> "automated scripts" helpfully cleaning out tables for you ;-)

Thanks, will give this a try.

> I strongly suggest you try this out several times on a test system,
> make a script that performs all the commands for you, and then use
> that script to do the work.  This is not the sort of operation you
> want to fat finger.

Yup, very true.

Thank you very much for the pointers.

Regards
Henry
From henry at zen.co.za  Thu Oct 18 06:55:05 2007
From: henry at zen.co.za (Henry - Zen Search SA)
Date: Thu Oct 18 06:55:19 2007
Subject: [Slony1-general] Re-enabling replication for dropped table.
In-Reply-To: <20071018115317.GK9189@crankycanuck.ca>
References: <63797.196.23.181.69.1192695317.squirrel@zenmail.co.za>
	<72dbd3150710180206y121ed0f5ub4a0603c7c8aa58c@mail.gmail.com>
	<61990.196.23.181.69.1192700560.squirrel@zenmail.co.za>
	<20071018115317.GK9189@crankycanuck.ca>
Message-ID: <61051.196.23.181.69.1192715705.squirrel@zenmail.co.za>


On Thu, October 18, 2007 1:53 pm, Andrew Sullivan wrote:

>> I think slony needs *another* layer on top of slonik - so much of it is
>> hit and miss.
>
> . . .slonik was intended to be a bootstrapping user interface, and
> Jan always hoped someone would make a _nice_ UI for Slony.  I gather
> that (mumble pgadmin?) has done some work in that direction.

btw, don't get me wrong, I think I slony is excellent - it belongs in the
same elite category of open source systems (think apache, mysql, pg, php,
perl, linux, etc) which, despite their horrendous complexity, work well.

I gave pgadmin a try (thinking it would ease the learning curve a bit and
just get me going) a few weeks ago when I first decided to give slony a
try.  For slony support, it's not quite there yet (only for creating an
initial set and adding another node, I think - but even with this it seems
a bit beta).

...but to further your mumble, after slogging through the slony init stuff
(and ending up with nice parameterized scripts to automate slony setup for
existing DBs [the next time I need it]), I suppose this is what open
source depends on:  folks having a FAT irritable groan about some rough
edges/whatever and deciding to give that itch an almighty scratch.

Just wish there were more hours in the day, dammit.
From ajs at crankycanuck.ca  Thu Oct 18 07:09:36 2007
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Thu Oct 18 07:09:46 2007
Subject: [Slony1-general] Re-enabling replication for dropped table.
In-Reply-To: <61051.196.23.181.69.1192715705.squirrel@zenmail.co.za>
References: <63797.196.23.181.69.1192695317.squirrel@zenmail.co.za>
	<72dbd3150710180206y121ed0f5ub4a0603c7c8aa58c@mail.gmail.com>
	<61990.196.23.181.69.1192700560.squirrel@zenmail.co.za>
	<20071018115317.GK9189@crankycanuck.ca>
	<61051.196.23.181.69.1192715705.squirrel@zenmail.co.za>
Message-ID: <20071018140936.GU9189@crankycanuck.ca>

On Thu, Oct 18, 2007 at 03:55:05PM +0200, Henry - Zen Search SA wrote:
> source depends on:  folks having a FAT irritable groan about some rough
> edges/whatever and deciding to give that itch an almighty scratch.

Yes :P

A

-- 
Andrew Sullivan  | ajs@crankycanuck.ca
Never get involved in litigation. Your hair will fall out, your bones 
will turn to sand.  And it will still be going on.
		--Tom Waits 
From henry at zen.co.za  Thu Oct 18 07:16:14 2007
From: henry at zen.co.za (Henry - Zen Search SA)
Date: Thu Oct 18 07:16:50 2007
Subject: [Slony1-general] Re-enabling replication for dropped table.
In-Reply-To: <63797.196.23.181.69.1192695317.squirrel@zenmail.co.za>
References: <63797.196.23.181.69.1192695317.squirrel@zenmail.co.za>
Message-ID: <61507.196.23.181.69.1192716974.squirrel@zenmail.co.za>


Just to wrap up this thread:

Doing:

select  _db_cluster.setdroptable_int(121);

Produces the error:

ERROR:  Slony-I: alterTableRestore(): Table with id 121 not found

---

I think I've screwed things somewhere along the line with my tinkering and
will rather acknowledge the lesson well learned -- and as David suggested
from the start, drop replication from the nodes, and restart from scratch.
 Things will only get worse from here on out, wasting everyone's time.

Thank you to everyone who assisted.

Regards
Henry
From bnichols at ca.afilias.info  Thu Oct 18 07:22:51 2007
From: bnichols at ca.afilias.info (Brad Nicholson)
Date: Thu Oct 18 07:22:56 2007
Subject: [Slony1-general] Re-enabling replication for dropped table.
In-Reply-To: <61507.196.23.181.69.1192716974.squirrel@zenmail.co.za>
References: <63797.196.23.181.69.1192695317.squirrel@zenmail.co.za>
	<61507.196.23.181.69.1192716974.squirrel@zenmail.co.za>
Message-ID: <1192717371.6131.30.camel@bnicholson-desktop>

On Thu, 2007-10-18 at 16:16 +0200, Henry - Zen Search SA wrote:
> Just to wrap up this thread:
> 
> Doing:
> 
> select  _db_cluster.setdroptable_int(121);
> 
> Produces the error:
> 
> ERROR:  Slony-I: alterTableRestore(): Table with id 121 not found


You can probably get around this by manually creating a table the table
and then calling the setdroptable_int function.  Test it first, though.


> http://lists.slony.info/mailman/listinfo/slony1-general
-- 
Brad Nicholson  416-673-4106
Database Administrator, Afilias Canada Corp.


From henry at zen.co.za  Thu Oct 18 07:35:33 2007
From: henry at zen.co.za (Henry - Zen Search SA)
Date: Thu Oct 18 07:35:59 2007
Subject: [Slony1-general] Re-enabling replication for dropped table.
In-Reply-To: <1192717371.6131.30.camel@bnicholson-desktop>
References: <63797.196.23.181.69.1192695317.squirrel@zenmail.co.za>
	<61507.196.23.181.69.1192716974.squirrel@zenmail.co.za>
	<1192717371.6131.30.camel@bnicholson-desktop>
Message-ID: <62114.196.23.181.69.1192718133.squirrel@zenmail.co.za>


On Thu, October 18, 2007 4:22 pm, Brad Nicholson wrote:
>> ERROR:  Slony-I: alterTableRestore(): Table with id 121 not found
> You can probably get around this by manually creating a table the table
> and then calling the setdroptable_int function.  Test it first, though.

Thanks Brad - but my use of the euphemism "tinkering" was tacit
acknowledgement that I had a lookie-poo in the slony tables and may have
"tinkered" therein; gave it a little stir.

She is bor'ken.

h
From ajs at crankycanuck.ca  Thu Oct 18 07:43:10 2007
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Thu Oct 18 07:43:18 2007
Subject: [Slony1-general] Re-enabling replication for dropped table.
In-Reply-To: <61507.196.23.181.69.1192716974.squirrel@zenmail.co.za>
References: <63797.196.23.181.69.1192695317.squirrel@zenmail.co.za>
	<61507.196.23.181.69.1192716974.squirrel@zenmail.co.za>
Message-ID: <20071018144310.GV9189@crankycanuck.ca>

On Thu, Oct 18, 2007 at 04:16:14PM +0200, Henry - Zen Search SA wrote:
> 
> Just to wrap up this thread:
> 
> Doing:
> 
> select  _db_cluster.setdroptable_int(121);

That should be on the replica, you know, right?  It will error on the
origin.

A
-- 
Andrew Sullivan  | ajs@crankycanuck.ca
From ajs at crankycanuck.ca  Thu Oct 18 07:45:03 2007
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Thu Oct 18 07:45:11 2007
Subject: [Slony1-general] Re-enabling replication for dropped table.
In-Reply-To: <62114.196.23.181.69.1192718133.squirrel@zenmail.co.za>
References: <63797.196.23.181.69.1192695317.squirrel@zenmail.co.za>
	<61507.196.23.181.69.1192716974.squirrel@zenmail.co.za>
	<1192717371.6131.30.camel@bnicholson-desktop>
	<62114.196.23.181.69.1192718133.squirrel@zenmail.co.za>
Message-ID: <20071018144503.GW9189@crankycanuck.ca>

On Thu, Oct 18, 2007 at 04:35:33PM +0200, Henry - Zen Search SA wrote:
> acknowledgement that I had a lookie-poo in the slony tables and may have
> "tinkered" therein; gave it a little stir.

Ah, well, in that case, you need to make sure you unhook replication
completely, and then probably drop the slony schema before starting
over.  If you start poking at catalogue tables before you're sure you
know what you're doing, you're as likely as not to do irreparable
harm.

-- 
Andrew Sullivan  | ajs@crankycanuck.ca
This work was visionary and imaginative, and goes to show that visionary
and imaginative work need not end up well. 
		--Dennis Ritchie
From cbbrowne at ca.afilias.info  Thu Oct 18 07:52:45 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Thu Oct 18 07:52:50 2007
Subject: [Slony1-general] Re-enabling replication for dropped table.
In-Reply-To: <61507.196.23.181.69.1192716974.squirrel@zenmail.co.za>
	(henry@zen.co.za's message of "Thu,
	18 Oct 2007 16:16:14 +0200 (SAST)")
References: <63797.196.23.181.69.1192695317.squirrel@zenmail.co.za>
	<61507.196.23.181.69.1192716974.squirrel@zenmail.co.za>
Message-ID: <608x60jwzm.fsf@dba2.int.libertyrms.com>

"Henry - Zen Search SA" <henry@zen.co.za> writes:
> Just to wrap up this thread:
>
> Doing:
>
> select  _db_cluster.setdroptable_int(121);
>
> Produces the error:
>
> ERROR:  Slony-I: alterTableRestore(): Table with id 121 not found
>
> ---
>
> I think I've screwed things somewhere along the line with my tinkering and
> will rather acknowledge the lesson well learned -- and as David suggested
> from the start, drop replication from the nodes, and restart from scratch.
>  Things will only get worse from here on out, wasting everyone's time.
>
> Thank you to everyone who assisted.

Actually, no, I don't think you have "mucked things up further" at
this point...

That error message doesn't surprise me too much, based on the scenario
you described.

What I *think* would probably work to clean things up would be
outlined thus:

- On each node, clean out the configuration for table #121

  - On the "master" node, where you had actually dropped the table,
    this solely involves deleting the entry in sl_table.

    e.g. - "delete from _db_cluster.sl_table where id = 121;"

  - On other nodes, where the table hasn't been mucked with, you can
    pretty cleanly drop the table from replication via:

    select  _db_cluster.setdroptable_int(121);

  Once one of those two actions has been taken everywhere, you can add
  the table back to replication...

- Make sure the table is present on all nodes

- Submit slonik script consisting of:

  CREATE SET for a new set
  SET ADD TABLE to add your errant table to the new set
  SUBSCRIBE SET as many times as needed to get the table replicating

- Once replication is back working on that table...
  Slonik MERGE SET will merge the new set into the old one so that
  you don't have the complexity of extra replication sets in your
  configuration

-- 
output = ("cbbrowne" "@" "linuxdatabases.info")
http://www3.sympatico.ca/cbbrowne/nonrdbms.html
A Linux  machine!  because  a 486  is a terrible  thing to  waste!  
-- <jjs@wintermute.ucr.edu> Joe Sloan
From cbbrowne at ca.afilias.info  Thu Oct 18 07:55:59 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Thu Oct 18 07:56:04 2007
Subject: [Slony1-general] slony-1 logging non-modifying updates in sl_log_1
In-Reply-To: <47172BE1.5070503@sblk.de> (H. Meyer's message of "Thu,
	18 Oct 2007 11:48:17 +0200")
References: <47172BE1.5070503@sblk.de>
Message-ID: <604pgojwu8.fsf@dba2.int.libertyrms.com>

"H. Meyer" <slony-9999-exp@sblk.de> writes:
> I've just recently started to use slony-1 (thanks to all you guys who
> replied to my last message about 32bit<->64bit OS replication btw :o).
>
> Everything seems to be working perfectly at the moment.
> However, there are some strange entries in sl_log_1.
> i.e.
>
>> select * from _replication.sl_log_1 where log_xid=39903977;
>  log_origin | log_xid  | log_tableid | log_actionseq | log_cmdtype |
>        log_cmddata
> ------------+----------+-------------+---------------+-------------+---------------------------------
>           1 | 39903977 |          72 |        691449 | U           |
> id='2210825' where id='2210825'
>
> The column "id" is the primary key of that table. And as far as I know
> (wasn't able to verify that yet) none of our queries would ever do
> something like UPDATE ... SET id=X,... WHERE id=X.
>
> But even if there are such queries, why would slony-1 need to log that?
> No data was modified, so nothing needs to be replicated.
> Just curious :o)

You might have a trigger that runs on a subscriber every time there is
an update to this table (say, for cache invalidation or such).  Even
though the modification is "pretty null", the application can still
depend on this.

> And one other thing. I've read in the documentation that someone wrote a
> script to get slony-1 stats printed in mrtg. Has anything similar been
> done for munin (http://munin.projects.linpro.no/) yet? If not, I might
> be looking into that. Not quite sure which values would be most
> interesting to display though.
> st_lag_num_events and/or st_lag_time in sl_status seem interesting.
> Anything else?

It might be interesting to count SYNC events in sl_event, and
particularly, to count both the counts of SYNC and non-SYNC events.

But you have certainly hit the obviously interesting bits...
-- 
let name="cbbrowne" and tld="linuxfinances.info" in String.concat "@" [name;tld];;
http://www3.sympatico.ca/cbbrowne/multiplexor.html
Lisp Users:
Due to the holiday next Monday, there will be no garbage collection.
From darcyb at commandprompt.com  Thu Oct 18 14:09:42 2007
From: darcyb at commandprompt.com (Darcy Buskermolen)
Date: Thu Oct 18 14:10:04 2007
Subject: [Slony1-general] Bug Tracking
In-Reply-To: <60myuiltsh.fsf@dba2.int.libertyrms.com>
References: <60myuiltsh.fsf@dba2.int.libertyrms.com>
Message-ID: <200710181409.42472.darcyb@commandprompt.com>

On Tuesday 16 October 2007 12:54:22 Christopher Browne wrote:
> One thing that seems to have fallen by the wayside in the migration
> from gBorg to the nice new digs of main.slony.info at Command Prompt
> is the bug tracker.
>
> We used to have the gBorg bug tracker; there is not now any tooling to
> help support tracking bugs.  I have been getting pestered by some
> community members about this, as the statuses of some of the issues
> that have come up in the v1.2 branch have not been totally obvious.
>
> Way Back When, we were talking about the migration from gBorg to the
> new site, there was some enthusiasm over using a Bugzilla instance at
> Command Prompt, which seems still to be there at
> <http://pgbugs.commandprompt.com/>.
>
> Is that still something that people would be enthusiastic about?

+2

>
> I think activating it would take some (hopefully small?) amount of
> effort on Command Prompt's part...

Very little effort on out part, however due to Devrim and myself attending the 
PostgreSQL conference in Portland, we may not be able to get to this this 
week, but can have it activated by mid next week at the latest.



-- 


Darcy Buskermolen
The PostgreSQL company, Command Prompt Inc.
http://www.commandprompt.com/
From henry at zen.co.za  Fri Oct 19 04:01:38 2007
From: henry at zen.co.za (Henry - Zen Search SA)
Date: Fri Oct 19 04:02:49 2007
Subject: [Slony1-general] Re-enabling replication for dropped table.
In-Reply-To: <608x60jwzm.fsf@dba2.int.libertyrms.com>
References: <63797.196.23.181.69.1192695317.squirrel@zenmail.co.za>
	<61507.196.23.181.69.1192716974.squirrel@zenmail.co.za>
	<608x60jwzm.fsf@dba2.int.libertyrms.com>
Message-ID: <62389.196.23.181.69.1192791698.squirrel@zenmail.co.za>


On Thu, October 18, 2007 4:52 pm, Christopher Browne wrote:
> "Henry - Zen Search SA" <henry@zen.co.za> writes:
> Actually, no, I don't think you have "mucked things up further" at
> this point...
>
> That error message doesn't surprise me too much, based on the scenario
> you described.
>
> What I *think* would probably work to clean things up would be
> outlined thus:
>
> - On each node, clean out the configuration for table #121
>
>   - On the "master" node, where you had actually dropped the table,
>     this solely involves deleting the entry in sl_table.
>
>     e.g. - "delete from _db_cluster.sl_table where id = 121;"
>
>   - On other nodes, where the table hasn't been mucked with, you can
>     pretty cleanly drop the table from replication via:
>
>     select  _db_cluster.setdroptable_int(121);
>
>   Once one of those two actions has been taken everywhere, you can add
>   the table back to replication...
>
> - Make sure the table is present on all nodes
>
> - Submit slonik script consisting of:
>
>   CREATE SET for a new set
>   SET ADD TABLE to add your errant table to the new set
>   SUBSCRIBE SET as many times as needed to get the table replicating
>
> - Once replication is back working on that table...
>   Slonik MERGE SET will merge the new set into the old one so that
>   you don't have the complexity of extra replication sets in your
>   configuration


Great, that worked, thanks Christopher.   Looks like replication is back
online for this table!

Thank you very much.

Regards
Henry

--
Zen Search SA
http://zen.co.za/
From drees76 at gmail.com  Fri Oct 19 12:50:22 2007
From: drees76 at gmail.com (David Rees)
Date: Fri Oct 19 12:50:37 2007
Subject: [Slony1-general] Postgres Upgrade Scenario Question
Message-ID: <72dbd3150710191250j5d793feakf8390886cb245341@mail.gmail.com>

I think I'm missing something obvious here...

I've got Slony running in my test evironment with a simple 2-node setup.

I want to upgrade Postgres on a slave node from Pg 8.2 to 8.3 Beta
with a minimal amount of downtime. So the idea is that I bring up
another Pg instance on a different port and add the node to the
cluster.

So I have 3 nodes with both Slaves on the same machine:
Node 1 - "Master" node
Node 2 - "Slave" node Pg 8.2
Node 3 - "Slave" node Pg 8.3

Now that I've verified that the new Pg instance is working properly, I
want to take down the Pg 8.2 bring up the Pg 8.3 on the standard Pg
port. That in itself is easy enough to do:

1. Stop all slon daemons.
2. Drop Pg 8.2 node from cluster.
3. Stop Pg 8.2
4. Restart Pg 8.3 on the old port
5. Update slon config for old port.
6. Update sl_path info how???
7. Restart slon daemons

Step 6 is where I get a bit unsure/lost. It looks like there is
connection information stored in the sl_path table and that should be
updated before starting up the slon daemons.

The question is: what's the best way to do it? Manually? Or will the
slon daemons magically figure this out on their own?

-Dave
From jpfletch at ca.afilias.info  Fri Oct 19 12:59:02 2007
From: jpfletch at ca.afilias.info (JP Fletcher)
Date: Fri Oct 19 13:00:07 2007
Subject: [Slony1-general] Postgres Upgrade Scenario Question
In-Reply-To: <72dbd3150710191250j5d793feakf8390886cb245341@mail.gmail.com>
References: <72dbd3150710191250j5d793feakf8390886cb245341@mail.gmail.com>
Message-ID: <47190C86.4020000@ca.afilias.info>

David Rees wrote:
> I think I'm missing something obvious here...
>
> I've got Slony running in my test evironment with a simple 2-node setup.
>
> I want to upgrade Postgres on a slave node from Pg 8.2 to 8.3 Beta
> with a minimal amount of downtime. So the idea is that I bring up
> another Pg instance on a different port and add the node to the
> cluster.
>
> So I have 3 nodes with both Slaves on the same machine:
> Node 1 - "Master" node
> Node 2 - "Slave" node Pg 8.2
> Node 3 - "Slave" node Pg 8.3
>
> Now that I've verified that the new Pg instance is working properly, I
> want to take down the Pg 8.2 bring up the Pg 8.3 on the standard Pg
> port. That in itself is easy enough to do:
>
> 1. Stop all slon daemons.
> 2. Drop Pg 8.2 node from cluster.
> 3. Stop Pg 8.2
> 4. Restart Pg 8.3 on the old port
> 5. Update slon config for old port.
> 6. Update sl_path info how???
> 7. Restart slon daemons
>
> Step 6 is where I get a bit unsure/lost. It looks like there is
> connection information stored in the sl_path table and that should be
> updated before starting up the slon daemons.
>   
What is it that you think should be updated?  When you stop your 8.2 
instance, and bring up the 8.3 instance on the port formerly occupied by 
8.2, the conninfo in sl_path will match the 8.3 instance.


> The question is: what's the best way to do it? Manually? Or will the
> slon daemons magically figure this out on their own?
>
> -Dave
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>   


-- 
JP Fletcher
Database Administrator
Afilias Canada
voice: 416.646.3304 ext. 4123
fax: 416.646.3305
mobile: 416.561.4763
jpfletch@ca.afilias.info


From cbbrowne at ca.afilias.info  Fri Oct 19 15:16:27 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri Oct 19 15:16:37 2007
Subject: [Slony1-general] Good news: 1.2.12 Real Soon Now(tm)
Message-ID: <60bqaug37o.fsf@dba2.int.libertyrms.com>

Jan and I have had a pretty good day today...

- I was able to get log shipping tests to work
- Jan "stomped" a bug that had been pointed out a couple weeks ago

All that has been checked into CVS, and it has pointed me to a change
or two to the documentation (need to say a little more about WAIT FOR
EVENT).

I think we can look forward to version 1.2.12 early next week.
-- 
output = ("cbbrowne" "@" "linuxdatabases.info")
http://www3.sympatico.ca/cbbrowne/internet.html
Who  needs fault-tolerant  computers when  there's obviously  an ample
market of fault-tolerant users?
From drees76 at gmail.com  Fri Oct 19 15:42:42 2007
From: drees76 at gmail.com (David Rees)
Date: Fri Oct 19 15:42:53 2007
Subject: [Slony1-general] Postgres Upgrade Scenario Question
In-Reply-To: <47190C86.4020000@ca.afilias.info>
References: <72dbd3150710191250j5d793feakf8390886cb245341@mail.gmail.com>
	<47190C86.4020000@ca.afilias.info>
Message-ID: <72dbd3150710191542w4d6c2ab6q83ab55a407e3ef7f@mail.gmail.com>

On 10/19/07, JP Fletcher <jpfletch@ca.afilias.info> wrote:
> David Rees wrote:
> > 1. Stop all slon daemons.
> > 2. Drop Pg 8.2 node from cluster.
> > 3. Stop Pg 8.2
> > 4. Restart Pg 8.3 on the old port
> > 5. Update slon config for old port.
> > 6. Update sl_path info how???
> > 7. Restart slon daemons
> >
> > Step 6 is where I get a bit unsure/lost. It looks like there is
> > connection information stored in the sl_path table and that should be
> > updated before starting up the slon daemons.
>
> What is it that you think should be updated?  When you stop your 8.2
> instance, and bring up the 8.3 instance on the port formerly occupied by
> 8.2, the conninfo in sl_path will match the 8.3 instance.

Right, but the 8.2 instance is node 2, the 8.3 instance is node 3.
Step 2 includes dropping node 2 from the cluster.

You could also ignore the fact that node 2 is going away for example,
and lets just say I wanted to change the port that node 3 is running
on... what's the "best practice" for doing so?

Updating sl_path is easy enough (only have 3 databases replicated on
this test setup, so that is 6 sl_path tables that need updating), I
just imagined that there would have been a more straight forward way
since everything else in slony is so straight forward. :-)

-Dave
From drees76 at gmail.com  Fri Oct 19 15:44:58 2007
From: drees76 at gmail.com (David Rees)
Date: Fri Oct 19 15:45:07 2007
Subject: [Slony1-general] Good news: 1.2.12 Real Soon Now(tm)
In-Reply-To: <60bqaug37o.fsf@dba2.int.libertyrms.com>
References: <60bqaug37o.fsf@dba2.int.libertyrms.com>
Message-ID: <72dbd3150710191544m6364760bk1dc87cf96151a702@mail.gmail.com>

On 10/19/07, Christopher Browne <cbbrowne@ca.afilias.info> wrote:
> All that has been checked into CVS, and it has pointed me to a change
> or two to the documentation (need to say a little more about WAIT FOR
> EVENT).

I found what appears to be a typo in the docs today:

http://slony.info/documentation/reshape.html

Look at the last line in the bulleted section where it says "when
changes are made to sl_path or sl_path", it seems that one of the
sl_path references is redundant.

> I think we can look forward to version 1.2.12 early next week.

Great!

-Dave
From tgoodair at ca.afilias.info  Sat Oct 20 12:04:03 2007
From: tgoodair at ca.afilias.info (Tim Goodaire)
Date: Sat Oct 20 12:05:24 2007
Subject: [Slony1-general] Good news: 1.2.12 Real Soon Now(tm)
In-Reply-To: <60bqaug37o.fsf@dba2.int.libertyrms.com>
References: <60bqaug37o.fsf@dba2.int.libertyrms.com>
Message-ID: <20071020190403.GA22854@dba6>

Which bug did Jan fix?

On Fri, Oct 19, 2007 at 06:16:27PM -0400, Christopher Browne wrote:
> Jan and I have had a pretty good day today...
> 
> - I was able to get log shipping tests to work
> - Jan "stomped" a bug that had been pointed out a couple weeks ago
> 
> All that has been checked into CVS, and it has pointed me to a change
> or two to the documentation (need to say a little more about WAIT FOR
> EVENT).
> 
> I think we can look forward to version 1.2.12 early next week.
-- 
Tim Goodaire    416-673-4126    tgoodair@ca.afilias.info
Database Team Lead, Afilias Canada Corp.
From JanWieck at Yahoo.com  Sat Oct 20 14:57:37 2007
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Sat Oct 20 14:57:57 2007
Subject: [Slony1-general] Good news: 1.2.12 Real Soon Now(tm)
In-Reply-To: <20071020190403.GA22854@dba6>
References: <60bqaug37o.fsf@dba2.int.libertyrms.com>
	<20071020190403.GA22854@dba6>
Message-ID: <471A79D1.3050004@Yahoo.com>

On 10/20/2007 3:04 PM, Tim Goodaire wrote:
> Which bug did Jan fix?

Three nodes (n1, n2, n3). Two sets (s1, s2), both originate on n1. n2 
subscribes to s1 and s2 direct. n3 subscribes s1 direct and s2 cascaded 
via n2.

This caused n3 to stop replicating due to a syntax error in the log 
selecting SQL in case that the subscription of the second set caused it 
to be initially at a higher ssl_setsync than the first one.


Jan

> 
> On Fri, Oct 19, 2007 at 06:16:27PM -0400, Christopher Browne wrote:
>> Jan and I have had a pretty good day today...
>> 
>> - I was able to get log shipping tests to work
>> - Jan "stomped" a bug that had been pointed out a couple weeks ago
>> 
>> All that has been checked into CVS, and it has pointed me to a change
>> or two to the documentation (need to say a little more about WAIT FOR
>> EVENT).
>> 
>> I think we can look forward to version 1.2.12 early next week.




-- 
#======================================================================#
# It's easier to get forgiveness for being wrong than for being right. #
# Let's break this rule - forgive me.                                  #
#================================================== JanWieck@Yahoo.com #
From jpfletch at ca.afilias.info  Sat Oct 20 18:21:16 2007
From: jpfletch at ca.afilias.info (JP Fletcher)
Date: Sat Oct 20 18:21:33 2007
Subject: [Slony1-general] Postgres Upgrade Scenario Question
In-Reply-To: <72dbd3150710191542w4d6c2ab6q83ab55a407e3ef7f@mail.gmail.com>
References: <72dbd3150710191250j5d793feakf8390886cb245341@mail.gmail.com>	
	<47190C86.4020000@ca.afilias.info>
	<72dbd3150710191542w4d6c2ab6q83ab55a407e3ef7f@mail.gmail.com>
Message-ID: <471AA98C.9030305@ca.afilias.info>

David Rees wrote:
> On 10/19/07, JP Fletcher <jpfletch@ca.afilias.info> wrote:
>> David Rees wrote:
>>> 1. Stop all slon daemons.
>>> 2. Drop Pg 8.2 node from cluster.
>>> 3. Stop Pg 8.2
>>> 4. Restart Pg 8.3 on the old port
>>> 5. Update slon config for old port.
>>> 6. Update sl_path info how???
>>> 7. Restart slon daemons
>>>
>>> Step 6 is where I get a bit unsure/lost. It looks like there is
>>> connection information stored in the sl_path table and that should be
>>> updated before starting up the slon daemons.
>> What is it that you think should be updated?  When you stop your 8.2
>> instance, and bring up the 8.3 instance on the port formerly occupied by
>> 8.2, the conninfo in sl_path will match the 8.3 instance.
> 
> Right, but the 8.2 instance is node 2, the 8.3 instance is node 3.
> Step 2 includes dropping node 2 from the cluster.
> 
> You could also ignore the fact that node 2 is going away for example,
> and lets just say I wanted to change the port that node 3 is running
> on... what's the "best practice" for doing so?

When we do this sort of thing, we bring down both old and new
postmasters, swap the ports, then restart.  Then we reshape sl_path with
slonik STORE PATH commands.  And we wait to drop the old node until
later.

> 
> Updating sl_path is easy enough (only have 3 databases replicated on
> this test setup, so that is 6 sl_path tables that need updating), I
> just imagined that there would have been a more straight forward way
> since everything else in slony is so straight forward. :-)
> 
> -Dave

From cyril.scetbon at free.fr  Sun Oct 21 12:52:40 2007
From: cyril.scetbon at free.fr (Cyril SCETBON)
Date: Sun Oct 21 12:52:51 2007
Subject: [Slony1-general] unexpected EOF on client connection when adding
	node
Message-ID: <471BAE08.3000507@free.fr>

Hi,



I'm testing slonik scripts and see this error on each node. It seems 
that slonik does not close properly the connection.

I'm using version 1.2.1. Where can I found changes between 1.2.1 and 
1.2.11 version ?


Thanks

-- 
Cyril SCETBON
From andrew.george.hammond at gmail.com  Mon Oct 22 10:22:38 2007
From: andrew.george.hammond at gmail.com (Andrew Hammond)
Date: Mon Oct 22 10:22:44 2007
Subject: [Slony1-general] unexpected EOF on client connection when adding
	node
In-Reply-To: <471BAE08.3000507@free.fr>
References: <471BAE08.3000507@free.fr>
Message-ID: <5a0a9d6f0710221022j41a47c58wf70c915673253893@mail.gmail.com>

On 10/21/07, Cyril SCETBON <cyril.scetbon@free.fr> wrote:
>
> Hi,
>
> I'm testing slonik scripts and see this error on each node. It seems
> that slonik does not close properly the connection.
>
> I'm using version 1.2.1.


That's a bad idea for anything other than just playing around with slony,
and even then, you're much better off to use something recent. The only help
you're likely to receive when you have problems with such an old release is
"upgrade to latest."

Where can I found changes between 1.2.1 and
> 1.2.11 version ?



There's a file in the base directory of the tarball called RELEASE. Take a
look in there.

Andrew
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071022/=
ba4ad818/attachment.htm
From cbbrowne at ca.afilias.info  Mon Oct 22 11:54:21 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Mon Oct 22 11:54:21 2007
Subject: [Slony1-general] Good news: 1.2.12 Real Soon Now(tm)
In-Reply-To: <72dbd3150710191544m6364760bk1dc87cf96151a702@mail.gmail.com>
	(David Rees's message of "Fri, 19 Oct 2007 15:44:58 -0700")
References: <60bqaug37o.fsf@dba2.int.libertyrms.com>
	<72dbd3150710191544m6364760bk1dc87cf96151a702@mail.gmail.com>
Message-ID: <603aw3f09u.fsf@dba2.int.libertyrms.com>

"David Rees" <drees76@gmail.com> writes:
> On 10/19/07, Christopher Browne <cbbrowne@ca.afilias.info> wrote:
>> All that has been checked into CVS, and it has pointed me to a change
>> or two to the documentation (need to say a little more about WAIT FOR
>> EVENT).
>
> I found what appears to be a typo in the docs today:
>
> http://slony.info/documentation/reshape.html
>
> Look at the last line in the bulleted section where it says "when
> changes are made to sl_path or sl_path", it seems that one of the
> sl_path references is redundant.

Yup, one should refer to sl_subscribe.  Thanks for pointing that
out...

>> I think we can look forward to version 1.2.12 early next week.
>
> Great!

I'm presently running through regression tests, mostly with success,
but also with some cases of "need to tweak the test scripts a bit."
(Seems pretty univerally to be for the better...)
-- 
(reverse (concatenate 'string "ofni.sesabatadxunil" "@" "enworbbc"))
http://linuxdatabases.info/info/linuxdistributions.html
Do not meddle in the affairs  of wizards, for it  makes them soggy and
hard to light.
From cyril.scetbon at free.fr  Mon Oct 22 12:25:03 2007
From: cyril.scetbon at free.fr (Cyril SCETBON)
Date: Mon Oct 22 12:25:14 2007
Subject: [Slony1-general] unexpected EOF on client connection when adding
	node
In-Reply-To: <5a0a9d6f0710221022j41a47c58wf70c915673253893@mail.gmail.com>
References: <471BAE08.3000507@free.fr>
	<5a0a9d6f0710221022j41a47c58wf70c915673253893@mail.gmail.com>
Message-ID: <471CF90F.4030903@free.fr>



Andrew Hammond wrote:

> On 10/21/07, *Cyril SCETBON* <cyril.scetbon@free.fr 
> <mailto:cyril.scetbon@free.fr>> wrote:
>
>     Hi,
>
>     I'm testing slonik scripts and see this error on each node. It seems
>     that slonik does not close properly the connection.
>
>     I'm using version 1.2.1. 
>
>
> That's a bad idea for anything other than just playing around with 
> slony, and even then, you're much better off to use something recent. 
> The only help you're likely to receive when you have problems with 
> such an old release is "upgrade to latest."
Sorry, I checked and it's not 1.2.1 version but 1.2.10
>
>     Where can I found changes between 1.2.1 and
>     1.2.11 version ?
>
>
>
> There's a file in the base directory of the tarball called RELEASE. 
> Take a look in there.
thanks
>
> Andrew
>
>
>
>
> ------------------------------------------------------------------------
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>   
-- 
Cyril SCETBON
From devrim at CommandPrompt.com  Mon Oct 22 22:06:14 2007
From: devrim at CommandPrompt.com (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Mon Oct 22 22:06:48 2007
Subject: [Slony1-general] Good news: 1.2.12 Real Soon Now(tm)
In-Reply-To: <60bqaug37o.fsf@dba2.int.libertyrms.com>
References: <60bqaug37o.fsf@dba2.int.libertyrms.com>
Message-ID: <1193115974.5255.19.camel@localhost.localdomain>

SGksCgpPbiBGcmksIDIwMDctMTAtMTkgYXQgMTg6MTYgLTA0MDAsIENocmlzdG9waGVyIEJyb3du
ZSB3cm90ZToKPiBJIHRoaW5rIHdlIGNhbiBsb29rIGZvcndhcmQgdG8gdmVyc2lvbiAxLjIuMTIg
ZWFybHkgbmV4dCB3ZWVrLgoKKlBsZWFzZSogcHVzaCBhbiBSQyBvciBiZXRhIGZpcnN0LCBpbnN0
ZWFkIG9mIGFubm91bmNpbmcgMS4yLjEyCmRpcmVjdGx5LCBzbyB0aGF0IHBlb3BsZSBjYW4gdHJ5
IGl0IG9uY2UgbW9yZS4KClJlZ2FyZHMsCi0tIApEZXZyaW0gR8OcTkTDnFoKUG9zdGdyZVNRTCBS
ZXBsaWNhdGlvbiwgQ29uc3VsdGluZywgQ3VzdG9tIERldmVsb3BtZW50LCAyNHg3IHN1cHBvcnQK
TWFuYWdlZCBTZXJ2aWNlcywgU2hhcmVkIGFuZCBEZWRpY2F0ZWQgSG9zdGluZwpDby1BdXRob3Jz
OiBwbFBIUCwgT0RCQ25nIC0gaHR0cDovL3d3dy5jb21tYW5kcHJvbXB0LmNvbS8KCgotLS0tLS0t
LS0tLS0tLSBuZXh0IHBhcnQgLS0tLS0tLS0tLS0tLS0KQSBub24tdGV4dCBhdHRhY2htZW50IHdh
cyBzY3J1YmJlZC4uLgpOYW1lOiBub3QgYXZhaWxhYmxlClR5cGU6IGFwcGxpY2F0aW9uL3BncC1z
aWduYXR1cmUKU2l6ZTogMTg5IGJ5dGVzCkRlc2M6IFRoaXMgaXMgYSBkaWdpdGFsbHkgc2lnbmVk
IG1lc3NhZ2UgcGFydApVcmwgOiBodHRwOi8vbGlzdHMuc2xvbnkuaW5mby9waXBlcm1haWwvc2xv
bnkxLWdlbmVyYWwvYXR0YWNobWVudHMvMjAwNzEwMjIvYjBjODk2NjYvYXR0YWNobWVudC5wZ3AK
From ajs at crankycanuck.ca  Tue Oct 23 13:09:32 2007
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Tue Oct 23 13:09:45 2007
Subject: [Slony1-general] problems with slony1-engine-1.2.2-1_PG8.2.5and
	postgresql-server-8.2.5-1PGDG.rhel4
In-Reply-To: <1EC0C3E5FD3B7248827EF428F633C7E01417FF@caotta0025m.na.ubiquity.net>
References: <1EC0C3E5FD3B7248827EF428F633C7E01417FF@caotta0025m.na.ubiquity.net>
Message-ID: <20071023200932.GQ26559@crankycanuck.ca>

Note: you're posting to the old list, I think.  You actually want the
new list.  I've changed the To: line, but cc:d the old list.

(Admins: I thought we'd made the old list no-post?)

On Tue, Oct 23, 2007 at 03:10:28PM -0400, Ouray Viney wrote:

> 	I suspected this initially and checked the permission on the
> file; it was originally set to "root".

Could anyone else read it?  It'd be the read permissions that are
relevant here.
 
> 	Does anyone know how the $libdir is set or what it really should
> be (I ran ltrace to try to find out but it wasn't actually evaluated:

You can use pg_config to learn that.

A

> 	After changing the permissions I re-ran the command but with no
> further progress.
> 
> 	Here are the current permissions on the file:
> 
> 	-rwxrwxrwx  1 postgres postgres 7.9K Oct 19 12:19 xxid.so
> 
> 	Note:  Obviously not required to have +x.
> 
> 	Does anyone else have any ideas why the error occurs?

That may be the problem, actually.  I am not sure whether postgres
will load the module with the execute bit set.  Also, you need to
check permissions on the parent directory.

A
-- 
Andrew Sullivan  | ajs@crankycanuck.ca
The plural of anecdote is not data.
		--Roger Brinner
From cbbrowne at ca.afilias.info  Tue Oct 23 13:58:00 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Tue Oct 23 13:57:59 2007
Subject: [Slony1-general] Slony-I 1.2.11 pre1 now available
In-Reply-To: <1193115974.5255.19.camel@localhost.localdomain> (Devrim
	=?iso-8859-1?Q?G=DCND=DCZ's?= message of "Mon,
	22 Oct 2007 22:06:14 -0700")
References: <60bqaug37o.fsf@dba2.int.libertyrms.com>
	<1193115974.5255.19.camel@localhost.localdomain>
Message-ID: <60ir4xeeg7.fsf_-_@dba2.int.libertyrms.com>

Devrim G?ND?Z <devrim@CommandPrompt.com> writes:
> On Fri, 2007-10-19 at 18:16 -0400, Christopher Browne wrote:
>> I think we can look forward to version 1.2.12 early next week.
>
> *Please* push an RC or beta first, instead of announcing 1.2.12
> directly, so that people can try it once more.

Right you are.

A "pre1" version has been put on the web site.

I won't reiterate what's on the web site about this; I turned the
release notes into HTML there...
-- 
let name="cbbrowne" and tld="acm.org" in String.concat "@" [name;tld];;
http://slony.info/
If only women came with pull-down menus and online help.
From oviney at avaya.com  Tue Oct 23 20:46:04 2007
From: oviney at avaya.com (Ouray Viney)
Date: Tue Oct 23 20:47:17 2007
Subject: [Slony1-general] problems with
	slony1-engine-1.2.2-1_PG8.2.5andpostgresql-server-8.2.5-1PGDG.rhel4
References: <1EC0C3E5FD3B7248827EF428F633C7E01417FF@caotta0025m.na.ubiquity.net>
	<20071023200932.GQ26559@crankycanuck.ca>
Message-ID: <1EC0C3E5FD3B7248827EF428F633C7E0282319@caotta0025m.na.ubiquity.net>

Hi All:

Note:  Special thank you to Andrew for sorting out my previous posting ;)

OK, to further my research and efforts to solve this problem I have checked a few things that I suspected as probable causes:

1. The location of the xxid.so that is failing to load and its respective permissions.
2. The location where postgres looks for $libdir (using pg_config)
3. Checked the postgres logs for any errors related to my attempts to run the slonik script (script included in the previous post).

...and here are the results:

1.
The location was in /usr/lib/pgsql/xxid.so and the permissions were fine:

-rwxr-xr-x  1 root root 8064 Oct 23 15:09 /usr/lib/pgsql/xxid.so

2.
The location of libdir in my installation:
[root@pgmaster ~]# pg_config | grep LIBDIR
LIBDIR = /usr/lib
PKGLIBDIR = /usr/lib/pgsql

3.
In the pg_log (/var/lib/pgsql/data/pg_log) directory, I checked the most recent log file and noticed:
ERROR:  access to library "$libdir/xxid" is not allowed
STATEMENT:  load '$libdir/xxid';
ERROR:  access to library "$libdir/xxid" is not allowed
STATEMENT:  load '$libdir/xxid';

This leads me to my next question; Why doesn't PostgreSQL not translate/evaluate the variable $libdir?  Or perhaps better yet... it that normal log entry for this type of error?  

Here is a list of the binary versions that I have installed (Just to make it clear what software versions I am using 
):

[root@pgmaster pg_log]# rpm -qa | grep postgres
postgresql-docs-8.2.5-1PGDG.rhel4
compat-postgresql-libs-4-2PGDG.rhel4
postgresql-slony1-engine-1.2.2-1_PG8.2.5
postgresql-libs-8.2.5-1PGDG.rhel4
postgresql-contrib-8.2.5-1PGDG.rhel4
postgresql-plpython-8.2.5-1PGDG.rhel4
postgresql-slony1-engine-debuginfo-1.2.2-1_PG8.2.5
postgresql-8.2.5-1PGDG.rhel4
postgresql-jdbc-7.4.13-2.RHEL4.1
postgresql-devel-8.2.5-1PGDG.rhel4
postgresql-pltcl-8.2.5-1PGDG.rhel4
postgresql-server-8.2.5-1PGDG.rhel4
postgresql-test-8.2.5-1PGDG.rhel4
postgresql-plperl-8.2.5-1PGDG.rhel4

Obviously, the most important one are:
postgresql-server-8.2.5-1PGDG.rhel4
postgresql-slony1-engine-1.2.2-1_PG8.2.5

I built the slony1-engine rpm from the source rpm that I got from the Slony-I website.

I am going to do some more digging, but for now I am at a loss.  I really don't want to have to redo this whole installation/configuration process using the source (assuming that will produce better results) without at least knowing why I had a problem using the binaries.

Note:  For fun I actually tried to load the xxid.so "extension" inside my schema using the following commands:

psql \somedb

LOAD '$libdir/xxid'; 

which resulted in failure...

pgbench=# LOAD '$libdir/xxid';
LOAD
pgbench=#

in the logs:

STATEMENT:  LOAD
        LOAD '$libdir/xxid';
LOG:  unexpected EOF on client connection
ERROR:  syntax error at or near "history" at character 1
STATEMENT:  history
        LOAD '$libdir/xxid';

I appreciate any help/pointers in resolving this problem without just reinstalling or just building from source.  I would like to ensure that I understand what is causing the failure.  As I will need to support this in the future.

Kind Rgds,

Ouray Viney


-----Original Message-----
From:	slony1-general-bounces@gborg.postgresql.org on behalf of Andrew Sullivan
Sent:	Tue 10/23/2007 21:09
To:	slony1-general@lists.slony.info
Cc:	slony1-general@gborg.postgresql.org
Subject:	Re: [Slony1-general] problems with slony1-engine-1.2.2-1_PG8.2.5andpostgresql-server-8.2.5-1PGDG.rhel4

Note: you're posting to the old list, I think.  You actually want the
new list.  I've changed the To: line, but cc:d the old list.

(Admins: I thought we'd made the old list no-post?)

On Tue, Oct 23, 2007 at 03:10:28PM -0400, Ouray Viney wrote:

> 	I suspected this initially and checked the permission on the
> file; it was originally set to "root".

Could anyone else read it?  It'd be the read permissions that are
relevant here.
 
> 	Does anyone know how the $libdir is set or what it really should
> be (I ran ltrace to try to find out but it wasn't actually evaluated:

You can use pg_config to learn that.

A

> 	After changing the permissions I re-ran the command but with no
> further progress.
> 
> 	Here are the current permissions on the file:
> 
> 	-rwxrwxrwx  1 postgres postgres 7.9K Oct 19 12:19 xxid.so
> 
> 	Note:  Obviously not required to have +x.
> 
> 	Does anyone else have any ideas why the error occurs?

That may be the problem, actually.  I am not sure whether postgres
will load the module with the execute bit set.  Also, you need to
check permissions on the parent directory.

A
-- 
Andrew Sullivan  | ajs@crankycanuck.ca
The plural of anecdote is not data.
		--Roger Brinner
_______________________________________________
Slony1-general mailing list
Slony1-general@gborg.postgresql.org
http://gborg.postgresql.org/mailman/listinfo/slony1-general


From ajs at crankycanuck.ca  Wed Oct 24 06:43:54 2007
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Wed Oct 24 06:44:07 2007
Subject: [Slony1-general] problems with
	slony1-engine-1.2.2-1_PG8.2.5andpostgresql-server-8.2.5-1PGDG.rhel4
In-Reply-To: <1EC0C3E5FD3B7248827EF428F633C7E0282319@caotta0025m.na.ubiquity.net>
References: <1EC0C3E5FD3B7248827EF428F633C7E01417FF@caotta0025m.na.ubiquity.net>
	<20071023200932.GQ26559@crankycanuck.ca>
	<1EC0C3E5FD3B7248827EF428F633C7E0282319@caotta0025m.na.ubiquity.net>
Message-ID: <20071024134354.GE30253@crankycanuck.ca>

On Tue, Oct 23, 2007 at 11:46:04PM -0400, Ouray Viney wrote:
> 
> 1.
> The location was in /usr/lib/pgsql/xxid.so and the permissions were fine:
                       ^^^^^^^^^^^^^

> 2.
> The location of libdir in my installation:
> [root@pgmaster ~]# pg_config | grep LIBDIR
> LIBDIR = /usr/lib
           ^^^^^^^^

This is your problem, I think.  Because

> ERROR:  access to library "$libdir/xxid" is not allowed
                             ^^^^^^^

should expand to /usr/lib/xxid.  Which doesn't exist.  I'm not sure
why it's happening this way, but you could perhaps do something about
it by making a symlink.

> This leads me to my next question; Why doesn't PostgreSQL not
> translate/evaluate the variable $libdir?  

It does.  See above.

> Here is a list of the binary versions that I have installed (Just
> to make it clear what software versions I am using

I think someone who knows more about the packaging stuff will have to
speak to this.  I don't use RPMs if I can avoid it.

A
-- 
Andrew Sullivan  | ajs@crankycanuck.ca
"The year's penultimate month" is not in truth a good way of saying
November.
		--H.W. Fowler
From cbbrowne at ca.afilias.info  Wed Oct 24 08:03:44 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed Oct 24 08:03:39 2007
Subject: [Slony1-general] Slony-I 1.2.12-pre1 now available
In-Reply-To: <60ir4xeeg7.fsf_-_@dba2.int.libertyrms.com> (Christopher Browne's
	message of "Tue, 23 Oct 2007 16:58:00 -0400")
References: <60bqaug37o.fsf@dba2.int.libertyrms.com>
	<1193115974.5255.19.camel@localhost.localdomain>
	<60ir4xeeg7.fsf_-_@dba2.int.libertyrms.com>
Message-ID: <60640weer3.fsf_-_@dba2.int.libertyrms.com>

Um, that was supposed to be 1.2.12, not 1.2.11.

A pre-release version 1.2.12 is now available at <http://slony.info/>;
see the front page for links to the tarball as well as to see what
changes are included in this version.
-- 
(reverse (concatenate 'string "gro.mca" "@" "enworbbc"))
http://linuxfinances.info/info/linuxdistributions.html
"Fear leads to anger.  Anger leads to hate.  Hate leads to using
Windows NT for mission-critical applications."  --- What Yoda *meant*
to say
From oviney at avaya.com  Wed Oct 24 08:05:07 2007
From: oviney at avaya.com (Ouray Viney)
Date: Wed Oct 24 08:06:20 2007
Subject: [Slony1-general] problems with
	slony1-engine-1.2.2-1_PG8.2.5andpostgresql-server-8.2.5-1PGDG.rhel4
Message-ID: <1EC0C3E5FD3B7248827EF428F633C7E014180C@caotta0025m.na.ubiquity.net>

Hi All:

I actually tried creating a symlink to that location (on all the
nodes)... as I suspected the same.  To be safe, I restarted the servers
on all the nodes, but this still didn't resolve the errors.

ERROR:  access to library "$libdir/xxid" is not allowed
STATEMENT:  load '$libdir/xxid';

Any other ideas?

Kind Rgds,

Ouray Viney

-----Original Message-----
From: Andrew Sullivan [mailto:ajs@crankycanuck.ca] 
Sent: October 24, 2007 9:44 AM
To: Ouray Viney
Cc: slony1-general@lists.slony.info; slony1-general@gborg.postgresql.org
Subject: Re: [Slony1-general] problems with
slony1-engine-1.2.2-1_PG8.2.5andpostgresql-server-8.2.5-1PGDG.rhel4

On Tue, Oct 23, 2007 at 11:46:04PM -0400, Ouray Viney wrote:
> 
> 1.
> The location was in /usr/lib/pgsql/xxid.so and the permissions were
fine:
                       ^^^^^^^^^^^^^

> 2.
> The location of libdir in my installation:
> [root@pgmaster ~]# pg_config | grep LIBDIR
> LIBDIR = /usr/lib
           ^^^^^^^^

This is your problem, I think.  Because

> ERROR:  access to library "$libdir/xxid" is not allowed
                             ^^^^^^^

should expand to /usr/lib/xxid.  Which doesn't exist.  I'm not sure
why it's happening this way, but you could perhaps do something about
it by making a symlink.

> This leads me to my next question; Why doesn't PostgreSQL not
> translate/evaluate the variable $libdir?  

It does.  See above.

> Here is a list of the binary versions that I have installed (Just
> to make it clear what software versions I am using

I think someone who knows more about the packaging stuff will have to
speak to this.  I don't use RPMs if I can avoid it.

A
-- 
Andrew Sullivan  | ajs@crankycanuck.ca
"The year's penultimate month" is not in truth a good way of saying
November.
		--H.W. Fowler

From ajs at crankycanuck.ca  Wed Oct 24 08:19:50 2007
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Wed Oct 24 08:20:28 2007
Subject: [Slony1-general] problems with
	slony1-engine-1.2.2-1_PG8.2.5andpostgresql-server-8.2.5-1PGDG.rhel4
In-Reply-To: <1EC0C3E5FD3B7248827EF428F633C7E014180C@caotta0025m.na.ubiquity.net>
References: <1EC0C3E5FD3B7248827EF428F633C7E014180C@caotta0025m.na.ubiquity.net>
Message-ID: <20071024151950.GL30253@crankycanuck.ca>

On Wed, Oct 24, 2007 at 11:05:07AM -0400, Ouray Viney wrote:
> 
> Any other ideas?

Did you also check directory permissions?  The postmaster user will
need the execute bit set on all those directories in order to get in.

But as I already suggested, what would be more informative probably
is for you to talk to the packagers.

A


-- 
Andrew Sullivan  | ajs@crankycanuck.ca
This work was visionary and imaginative, and goes to show that visionary
and imaginative work need not end up well. 
		--Dennis Ritchie
From oviney at avaya.com  Wed Oct 24 08:40:06 2007
From: oviney at avaya.com (Ouray Viney)
Date: Wed Oct 24 08:41:02 2007
Subject: [Slony1-general] problems with
	slony1-engine-1.2.2-1_PG8.2.5andpostgresql-server-8.2.5-1PGDG.rhel4
Message-ID: <1EC0C3E5FD3B7248827EF428F633C7E014180D@caotta0025m.na.ubiquity.net>

Hi Andrew:

	Thank you for being so helpful.  Who should I be contacting if I
want to talk to the packagers?

Cheers,

Ouray

-----Original Message-----
From: Andrew Sullivan [mailto:ajs@crankycanuck.ca] 
Sent: October 24, 2007 11:20 AM
To: Ouray Viney
Cc: slony1-general@lists.slony.info; slony1-general@gborg.postgresql.org
Subject: Re: [Slony1-general] problems with
slony1-engine-1.2.2-1_PG8.2.5andpostgresql-server-8.2.5-1PGDG.rhel4

On Wed, Oct 24, 2007 at 11:05:07AM -0400, Ouray Viney wrote:
> 
> Any other ideas?

Did you also check directory permissions?  The postmaster user will
need the execute bit set on all those directories in order to get in.

But as I already suggested, what would be more informative probably
is for you to talk to the packagers.

A


-- 
Andrew Sullivan  | ajs@crankycanuck.ca
This work was visionary and imaginative, and goes to show that visionary
and imaginative work need not end up well. 
		--Dennis Ritchie

From ajs at crankycanuck.ca  Wed Oct 24 09:21:10 2007
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Wed Oct 24 09:21:31 2007
Subject: [Slony1-general] problems with
	slony1-engine-1.2.2-1_PG8.2.5andpostgresql-server-8.2.5-1PGDG.rhel4
In-Reply-To: <1EC0C3E5FD3B7248827EF428F633C7E014180D@caotta0025m.na.ubiquity.net>
References: <1EC0C3E5FD3B7248827EF428F633C7E014180D@caotta0025m.na.ubiquity.net>
Message-ID: <20071024162110.GN30253@crankycanuck.ca>

On Wed, Oct 24, 2007 at 11:40:06AM -0400, Ouray Viney wrote:
> Hi Andrew:
> 
> 	Thank you for being so helpful.  Who should I be contacting if I
> want to talk to the packagers?

I think Devrim does them.  He's usually on this list, although he may
be busy with other things, and not be seeing these messages.

A

-- 
Andrew Sullivan  | ajs@crankycanuck.ca
In the future this spectacle of the middle classes shocking the avant-
garde will probably become the textbook definition of Postmodernism. 
                --Brad Holland
From devrim at CommandPrompt.com  Wed Oct 24 09:41:29 2007
From: devrim at CommandPrompt.com (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Wed Oct 24 09:42:16 2007
Subject: [Slony1-general] problems with slony1-engine-1.2.2-1_PG8.2.5
	and postgresql-server-8.2.5-1PGDG.rhel4
In-Reply-To: <471E1160.3090007@ubiquitysoftware.com>
References: <471E1160.3090007@ubiquitysoftware.com>
Message-ID: <1193244089.22012.19.camel@laptop.gunduz.org>

SGksCgpPbiBUdWUsIDIwMDctMTAtMjMgYXQgMTE6MjEgLTA0MDAsIE91cmF5IFZpbmV5IHdyb3Rl
Ogo+IDxzdGRpbj46MjI6IFBHUkVTX0ZBVEFMX0VSUk9SIGxvYWQgJyRsaWJkaXIveHhpZCc7ICAt
IEVSUk9SOiAgYWNjZXNzCj4gdG8KPiBsaWJyYXJ5ICIkbGliZGlyL3h4aWQiIGlzIG5vdCBhbGxv
d2VkCj4gPHN0ZGluPjoyMjogRXJyb3I6IHRoZSBleHRlbnNpb24gZm9yIHRoZSB4eGlkIGRhdGEg
dHlwZSBjYW5ub3QgYmUKPiBsb2FkZWQgCgpUaGUgU2xvbnkgdmVyc2lvbiBpcyB0b28gb2xkIC0t
IFBsZWFzZSB1c2UgYSBuZXdlciBvbmUuIEkgYXBwbGllZCBsb3RzCm9mIGZpeGVzIHRvIHRoZSBz
cGVjIGZpbGUgaW4gdGhlIHJlY2VudCB2ZXJzaW9ucyBzbyB0aGF0IHRoZXkgY2FuIGJlCmNvbXBp
bGVkIHdlbGwuIAoKWW91IGNhbiB0cnkgdGhpcyBvbmU6CgpodHRwOi8vc2xvbnkuaW5mby9kb3du
bG9hZHMvMS4yL3NvdXJjZS9zbG9ueTEtMS4yLjEyLXByZTEudGFyLmJ6MgoKUGxlYXNlIGRvIGxl
dCBtZSBrbm93IGlmIHlvdSBoYXZlIHN0aWxsIHByb2JsZW1zIHVzaW5nIHRoaXMgb25lLgoKUmVn
YXJkcywKLS0gCkRldnJpbSBHw5xORMOcWgpQb3N0Z3JlU1FMIFJlcGxpY2F0aW9uLCBDb25zdWx0
aW5nLCBDdXN0b20gRGV2ZWxvcG1lbnQsIDI0eDcgc3VwcG9ydApNYW5hZ2VkIFNlcnZpY2VzLCBT
aGFyZWQgYW5kIERlZGljYXRlZCBIb3N0aW5nCkNvLUF1dGhvcnM6IHBsUEhQLCBPREJDbmcgLSBo
dHRwOi8vd3d3LmNvbW1hbmRwcm9tcHQuY29tLwoKCi0tLS0tLS0tLS0tLS0tIG5leHQgcGFydCAt
LS0tLS0tLS0tLS0tLQpBIG5vbi10ZXh0IGF0dGFjaG1lbnQgd2FzIHNjcnViYmVkLi4uCk5hbWU6
IG5vdCBhdmFpbGFibGUKVHlwZTogYXBwbGljYXRpb24vcGdwLXNpZ25hdHVyZQpTaXplOiAxODkg
Ynl0ZXMKRGVzYzogVGhpcyBpcyBhIGRpZ2l0YWxseSBzaWduZWQgbWVzc2FnZSBwYXJ0ClVybCA6
IGh0dHA6Ly9saXN0cy5zbG9ueS5pbmZvL3BpcGVybWFpbC9zbG9ueTEtZ2VuZXJhbC9hdHRhY2ht
ZW50cy8yMDA3MTAyNC80Mjc4YTI1ZC9hdHRhY2htZW50LnBncAo=
From devrim at CommandPrompt.com  Wed Oct 24 09:45:01 2007
From: devrim at CommandPrompt.com (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Wed Oct 24 09:45:52 2007
Subject: [Slony1-general] problems with
	slony1-engine-1.2.2-1_PG8.2.5andpostgresql-server-8.2.5-1PGDG.rhel4
In-Reply-To: <20071024162110.GN30253@crankycanuck.ca>
References: <1EC0C3E5FD3B7248827EF428F633C7E014180D@caotta0025m.na.ubiquity.net>
	<20071024162110.GN30253@crankycanuck.ca>
Message-ID: <1193244301.22012.21.camel@laptop.gunduz.org>

SGksCgpPbiBXZWQsIDIwMDctMTAtMjQgYXQgMTI6MjEgLTA0MDAsIEFuZHJldyBTdWxsaXZhbiB3
cm90ZToKCj4gSSB0aGluayBEZXZyaW0gZG9lcyB0aGVtLiAgSGUncyB1c3VhbGx5IG9uIHRoaXMg
bGlzdCwgYWx0aG91Z2ggaGUgbWF5Cj4gYmUgYnVzeSB3aXRoIG90aGVyIHRoaW5ncywgYW5kIG5v
dCBiZSBzZWVpbmcgdGhlc2UgbWVzc2FnZXMuIAoKSSBzZXR1cCBhIHNlYXJjaCBmb2xkZXIgdGhh
dCBpbmNsdWRlcyBhbGwgdGhlIG1lc3NhZ2VzIHRoYXQgaW5jbHVkZQoicnBtIiBpbiBpdCA7KQoK
UmVnYXJkcywKLS0gCkRldnJpbSBHw5xORMOcWgpQb3N0Z3JlU1FMIFJlcGxpY2F0aW9uLCBDb25z
dWx0aW5nLCBDdXN0b20gRGV2ZWxvcG1lbnQsIDI0eDcgc3VwcG9ydApNYW5hZ2VkIFNlcnZpY2Vz
LCBTaGFyZWQgYW5kIERlZGljYXRlZCBIb3N0aW5nCkNvLUF1dGhvcnM6IHBsUEhQLCBPREJDbmcg
LSBodHRwOi8vd3d3LmNvbW1hbmRwcm9tcHQuY29tLwoKCi0tLS0tLS0tLS0tLS0tIG5leHQgcGFy
dCAtLS0tLS0tLS0tLS0tLQpBIG5vbi10ZXh0IGF0dGFjaG1lbnQgd2FzIHNjcnViYmVkLi4uCk5h
bWU6IG5vdCBhdmFpbGFibGUKVHlwZTogYXBwbGljYXRpb24vcGdwLXNpZ25hdHVyZQpTaXplOiAx
ODkgYnl0ZXMKRGVzYzogVGhpcyBpcyBhIGRpZ2l0YWxseSBzaWduZWQgbWVzc2FnZSBwYXJ0ClVy
bCA6IGh0dHA6Ly9saXN0cy5zbG9ueS5pbmZvL3BpcGVybWFpbC9zbG9ueTEtZ2VuZXJhbC9hdHRh
Y2htZW50cy8yMDA3MTAyNC8xOTE0ZmYyZi9hdHRhY2htZW50LnBncAo=
From oviney at ubiquitysoftware.com  Wed Oct 24 09:57:50 2007
From: oviney at ubiquitysoftware.com (Ouray Viney)
Date: Wed Oct 24 09:58:42 2007
Subject: [Slony1-general] problems with slony1-engine-1.2.2-1_PG8.2.5and
	postgresql-server-8.2.5-1PGDG.rhel4
In-Reply-To: <1193244089.22012.19.camel@laptop.gunduz.org>
References: <471E1160.3090007@ubiquitysoftware.com>
	<1193244089.22012.19.camel@laptop.gunduz.org>
Message-ID: <471F798E.5060200@ubiquitysoftware.com>

SGkgRGV2cmltOgoKICAgIEludGVyZXN0aW5nLi4uIEkgd2lsbCB0cnkgdG8gYnVpbGQgdGhlIHJw
bXMgZnJvbSB0aGUgcGFja2FnZSB0aGF0CnlvdSBoYXZlIGdpdmVuIG1lIGFjY2VzcyB0byBhbmQg
cmVwb3J0IGJhY2sgb24gdGhlIHN0YXR1cy4gIFRoYW5rIHlvdQpmb3IgdGFraW5nIHRoZSB0aW1l
IHRvIHJlc3BvbmQuIAoKS2luZCBSZ2RzLAoKLS0gCgoKCiAgICBPdXJheSBWaW5leSB8IFNvZnR3
YXJlIERldmVsb3AgRW5naW5lZXIgSUkgfCBBdmF5YSB8IDUxNSBMZWdnZXQKICAgIERyaXZlIHwg
U3VpdGUgNDAwIHwgT3R0YXdhLCBPTiwgSzJHNlo2IHwKICAgIFZvaWNlOiArMS42MTMuMjcxLjUw
NzIgfCBGYXggKzEuNjEzLjI3MS44ODE3IHwgb3ZpbmV5QGF2YXlhLmNvbQoKICAgIHd3dy5hdmF5
YS5jYSA8aHR0cDovL3d3dy5hdmF5YS5jYT4KCgpEZXZyaW0gR8OcTkTDnFogd3JvdGU6Cj4gSGks
Cj4KPiBPbiBUdWUsIDIwMDctMTAtMjMgYXQgMTE6MjEgLTA0MDAsIE91cmF5IFZpbmV5IHdyb3Rl
Ogo+ICAgCj4+IDxzdGRpbj46MjI6IFBHUkVTX0ZBVEFMX0VSUk9SIGxvYWQgJyRsaWJkaXIveHhp
ZCc7ICAtIEVSUk9SOiAgYWNjZXNzCj4+IHRvCj4+IGxpYnJhcnkgIiRsaWJkaXIveHhpZCIgaXMg
bm90IGFsbG93ZWQKPj4gPHN0ZGluPjoyMjogRXJyb3I6IHRoZSBleHRlbnNpb24gZm9yIHRoZSB4
eGlkIGRhdGEgdHlwZSBjYW5ub3QgYmUKPj4gbG9hZGVkIAo+PiAgICAgCj4KPiBUaGUgU2xvbnkg
dmVyc2lvbiBpcyB0b28gb2xkIC0tIFBsZWFzZSB1c2UgYSBuZXdlciBvbmUuIEkgYXBwbGllZCBs
b3RzCj4gb2YgZml4ZXMgdG8gdGhlIHNwZWMgZmlsZSBpbiB0aGUgcmVjZW50IHZlcnNpb25zIHNv
IHRoYXQgdGhleSBjYW4gYmUKPiBjb21waWxlZCB3ZWxsLiAKPgo+IFlvdSBjYW4gdHJ5IHRoaXMg
b25lOgo+Cj4gaHR0cDovL3Nsb255LmluZm8vZG93bmxvYWRzLzEuMi9zb3VyY2Uvc2xvbnkxLTEu
Mi4xMi1wcmUxLnRhci5iejIKPgo+IFBsZWFzZSBkbyBsZXQgbWUga25vdyBpZiB5b3UgaGF2ZSBz
dGlsbCBwcm9ibGVtcyB1c2luZyB0aGlzIG9uZS4KPgo+IFJlZ2FyZHMsCj4gICAKCi0tLS0tLS0t
LS0tLS0tIG5leHQgcGFydCAtLS0tLS0tLS0tLS0tLQpTa2lwcGVkIGNvbnRlbnQgb2YgdHlwZSBt
dWx0aXBhcnQvcmVsYXRlZA==
From oviney at ubiquitysoftware.com  Wed Oct 24 10:48:03 2007
From: oviney at ubiquitysoftware.com (Ouray Viney)
Date: Wed Oct 24 10:49:21 2007
Subject: [Slony1-general] problems
	withslony1-engine-1.2.2-1_PG8.2.5andpostgresql-server-8.2.5-1PGDG.rhel4
In-Reply-To: <1193244301.22012.21.camel@laptop.gunduz.org>
References: <1EC0C3E5FD3B7248827EF428F633C7E014180D@caotta0025m.na.ubiquity.net>
	<20071024162110.GN30253@crankycanuck.ca>
	<1193244301.22012.21.camel@laptop.gunduz.org>
Message-ID: <471F8553.40407@ubiquitysoftware.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi Devrim:

    I just ran the ./configure and then "make rpm" (as user
"postgres") which resulted in the following error (based on the packed
you recommended to try):

- -bash-3.00$ make rpm
rm -rf postgresql-slony1-1.2.12* =install=
for x in `cd . && find . -name CVS -prune -o -print`; do \
  file=`expr X$x : 'X\./\(.*\)'`; \
  if test -d "./$file" ; then \
    mkdir "postgresql-slony1-1.2.12/$file" && chmod 777
"postgresql-slony1-1.2.12/$file"; \
  else \
    ln "./$file" "postgresql-slony1-1.2.12/$file" >/dev/null 2>&1 \
      || cp "./$file" "postgresql-slony1-1.2.12/$file"; \
  fi || exit; \
done
/bin/tar cf postgresql-slony1-1.2.12.tar postgresql-slony1-1.2.12
gzip --best postgresql-slony1-1.2.12.tar
rm -rf postgresql-slony1-1.2.12
rpmbuild -ta postgresql-slony1-1.2.12.tar.gz
error: Failed to rename /usr/src/redhat/SPECS/rpm-spec.qeCcW8 to
/usr/src/redhat/SPECS/rpm-spec.qeCcW8: No such file or directory: No
such file or directory
make: *** [rpm] Error 1

A quick check for the file:

- -bash-3.00$ ls /usr/src/redhat/SPECS/rpm-spec.0fYjjj
ls: /usr/src/redhat/SPECS/rpm-spec.0fYjjj: No such file or directory

Any ideas why this would be happening... perhaps I am missing a step?
I saw this step (make rpm) on the main page of the Slony website.

Much appreciated.

Cheers,

Ouray

Devrim G?ND?Z wrote:
> Hi,
>
> On Wed, 2007-10-24 at 12:21 -0400, Andrew Sullivan wrote:
>
>> I think Devrim does them.  He's usually on this list, although he may
>> be busy with other things, and not be seeing these messages.
>
> I setup a search folder that includes all the messages that include
> "rpm" in it ;)
>
> Regards,

- --
New Avaya Signature



    Ouray Viney | Software Develop Engineer II | Avaya | 515 Legget
    Drive | Suite 400 | Ottawa, ON, K2G6Z6 |
    Voice: +1.613.271.5072 | Fax +1.613.271.8817 | oviney@avaya.com

    www.avaya.ca <http://www.avaya.ca>

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFHH4VTVcRnbway3JoRAnxeAKClGMSGE+Fm5bNJBei22kQEjpCGVACeJna3
G6GZuiwad/NShvaODhZjDrw=
=NT4G
-----END PGP SIGNATURE-----

From devrim at CommandPrompt.com  Wed Oct 24 11:21:18 2007
From: devrim at CommandPrompt.com (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Wed Oct 24 11:22:09 2007
Subject: [Slony1-general] problems
	withslony1-engine-1.2.2-1_PG8.2.5andpostgresql-server-8.2.5-1PGDG.rhel4
In-Reply-To: <471F8553.40407@ubiquitysoftware.com>
References: <1EC0C3E5FD3B7248827EF428F633C7E014180D@caotta0025m.na.ubiquity.net>
	<20071024162110.GN30253@crankycanuck.ca>
	<1193244301.22012.21.camel@laptop.gunduz.org>
	<471F8553.40407@ubiquitysoftware.com>
Message-ID: <1193250078.22012.25.camel@laptop.gunduz.org>

SGksCgpPbiBXZWQsIDIwMDctMTAtMjQgYXQgMTM6NDggLTA0MDAsIE91cmF5IFZpbmV5IHdyb3Rl
Ogo+IAo+IC1iYXNoLTMuMDAkIGxzIC91c3Ivc3JjL3JlZGhhdC9TUEVDUy9ycG0tc3BlYy4wZllq
amoKPiBsczogL3Vzci9zcmMvcmVkaGF0L1NQRUNTL3JwbS1zcGVjLjBmWWpqajogTm8gc3VjaCBm
aWxlIG9yIGRpcmVjdG9yeQo+IAo+IEFueSBpZGVhcyB3aHkgdGhpcyB3b3VsZCBiZSBoYXBwZW5p
bmcuLi4gcGVyaGFwcyBJIGFtIG1pc3NpbmcgYSBzdGVwPwo+IEkgc2F3IHRoaXMgc3RlcCAobWFr
ZSBycG0pIG9uIHRoZSBtYWluIHBhZ2Ugb2YgdGhlIFNsb255IHdlYnNpdGUuCgpBcmUgeW91IHJ1
bm5pbmcgdGhpcyBhcyByb290PyBJZiBub3QsIHJ1biB0aGlzIGFzIHJvb3QuCgpSZWdhcmRzLAot
LSAKRGV2cmltIEfDnE5Ew5xaClBvc3RncmVTUUwgUmVwbGljYXRpb24sIENvbnN1bHRpbmcsIEN1
c3RvbSBEZXZlbG9wbWVudCwgMjR4NyBzdXBwb3J0Ck1hbmFnZWQgU2VydmljZXMsIFNoYXJlZCBh
bmQgRGVkaWNhdGVkIEhvc3RpbmcKQ28tQXV0aG9yczogcGxQSFAsIE9EQkNuZyAtIGh0dHA6Ly93
d3cuY29tbWFuZHByb21wdC5jb20vCgoKLS0tLS0tLS0tLS0tLS0gbmV4dCBwYXJ0IC0tLS0tLS0t
LS0tLS0tCkEgbm9uLXRleHQgYXR0YWNobWVudCB3YXMgc2NydWJiZWQuLi4KTmFtZTogbm90IGF2
YWlsYWJsZQpUeXBlOiBhcHBsaWNhdGlvbi9wZ3Atc2lnbmF0dXJlClNpemU6IDE4OSBieXRlcwpE
ZXNjOiBUaGlzIGlzIGEgZGlnaXRhbGx5IHNpZ25lZCBtZXNzYWdlIHBhcnQKVXJsIDogaHR0cDov
L2xpc3RzLnNsb255LmluZm8vcGlwZXJtYWlsL3Nsb255MS1nZW5lcmFsL2F0dGFjaG1lbnRzLzIw
MDcxMDI0LzQ3ZDM0Y2E0L2F0dGFjaG1lbnQucGdwCg==
From oviney at ubiquitysoftware.com  Wed Oct 24 11:28:02 2007
From: oviney at ubiquitysoftware.com (Ouray Viney)
Date: Wed Oct 24 11:28:37 2007
Subject: [Slony1-general]
	problems	withslony1-engine-1.2.2-1_PG8.2.5andpostgresql-server-8.2.5-1PGDG.rhel4
In-Reply-To: <1193250078.22012.25.camel@laptop.gunduz.org>
References: <1EC0C3E5FD3B7248827EF428F633C7E014180D@caotta0025m.na.ubiquity.net>	
	<20071024162110.GN30253@crankycanuck.ca>	
	<1193244301.22012.21.camel@laptop.gunduz.org>	
	<471F8553.40407@ubiquitysoftware.com>
	<1193250078.22012.25.camel@laptop.gunduz.org>
Message-ID: <471F8EB2.6060207@ubiquitysoftware.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi,
	You were correct I was running this as postgres user :0.

	Here is what I get when I run it as root:

[root@somehost slony1-1.2.12-pre1]# make rpm
rm -rf postgresql-slony1-1.2.12* =install=
for x in `cd . && find . -name CVS -prune -o -print`; do \
  file=`expr X$x : 'X\./\(.*\)'`; \
  if test -d "./$file" ; then \
    mkdir "postgresql-slony1-1.2.12/$file" && chmod 777
"postgresql-slony1-1.2.12/$file"; \
  else \
    ln "./$file" "postgresql-slony1-1.2.12/$file" >/dev/null 2>&1 \
      || cp "./$file" "postgresql-slony1-1.2.12/$file"; \
  fi || exit; \
done
/bin/tar cf postgresql-slony1-1.2.12.tar postgresql-slony1-1.2.12
gzip --best postgresql-slony1-1.2.12.tar
rm -rf postgresql-slony1-1.2.12
rpmbuild -ta postgresql-slony1-1.2.12.tar.gz
error: File /opt/slony1-1.2.12-pre1/postgresql-slony1-1.2.12.tar.bz2: No
such file or directory
make: *** [rpm] Error 1

Perhaps I am missing something?  I just don't want to hack around as I
am not 100 % sure why I am seeing this error.

Kind Rgds,

Ouray

Devrim G?ND?Z wrote:
> Hi,
> 
> On Wed, 2007-10-24 at 13:48 -0400, Ouray Viney wrote:
>> -bash-3.00$ ls /usr/src/redhat/SPECS/rpm-spec.0fYjjj
>> ls: /usr/src/redhat/SPECS/rpm-spec.0fYjjj: No such file or directory
>>
>> Any ideas why this would be happening... perhaps I am missing a step?
>> I saw this step (make rpm) on the main page of the Slony website.
> 
> Are you running this as root? If not, run this as root.
> 
> Regards,

- --


    Ouray Viney | Software Develop Engineer II | Avaya | 515 Legget
    Drive | Suite 400 | Ottawa, ON, K2G6Z6 |
    Voice: +1.613.271.5072 | Fax +1.613.271.8817 | oviney@avaya.com

    www.avaya.ca <http://www.avaya.ca>

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFHH46yVcRnbway3JoRAolKAJ9M7EBM+6DFFEHmXObZdIr0GbYGpQCglod1
RUZQVrb94LrLpz+ekos8FEg=
=bwoN
-----END PGP SIGNATURE-----
From devrim at CommandPrompt.com  Wed Oct 24 11:35:07 2007
From: devrim at CommandPrompt.com (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Wed Oct 24 11:35:54 2007
Subject: [Slony1-general]
	problems	withslony1-engine-1.2.2-1_PG8.2.5andpostgresql-server-8.2.5-1PGDG.rhel4
In-Reply-To: <471F8EB2.6060207@ubiquitysoftware.com>
References: <1EC0C3E5FD3B7248827EF428F633C7E014180D@caotta0025m.na.ubiquity.net>
	<20071024162110.GN30253@crankycanuck.ca>
	<1193244301.22012.21.camel@laptop.gunduz.org>
	<471F8553.40407@ubiquitysoftware.com>
	<1193250078.22012.25.camel@laptop.gunduz.org>
	<471F8EB2.6060207@ubiquitysoftware.com>
Message-ID: <1193250907.22012.28.camel@laptop.gunduz.org>

SGksCgpPbiBXZWQsIDIwMDctMTAtMjQgYXQgMTQ6MjggLTA0MDAsIE91cmF5IFZpbmV5IHdyb3Rl
Ogo+IC9iaW4vdGFyIGNmIHBvc3RncmVzcWwtc2xvbnkxLTEuMi4xMi50YXIgcG9zdGdyZXNxbC1z
bG9ueTEtMS4yLjEyCj4gZ3ppcCAtLWJlc3QgcG9zdGdyZXNxbC1zbG9ueTEtMS4yLjEyLnRhcgo+
IHJtIC1yZiBwb3N0Z3Jlc3FsLXNsb255MS0xLjIuMTIKPiBycG1idWlsZCAtdGEgcG9zdGdyZXNx
bC1zbG9ueTEtMS4yLjEyLnRhci5nego+IGVycm9yOiBGaWxlIC9vcHQvc2xvbnkxLTEuMi4xMi1w
cmUxL3Bvc3RncmVzcWwtc2xvbnkxLTEuMi4xMi50YXIuYnoyOgo+IE5vCj4gc3VjaCBmaWxlIG9y
IGRpcmVjdG9yeQo+IG1ha2U6ICoqKiBbcnBtXSBFcnJvciAxCj4gCj4gUGVyaGFwcyBJIGFtIG1p
c3Npbmcgc29tZXRoaW5nPyAgSSBqdXN0IGRvbid0IHdhbnQgdG8gaGFjayBhcm91bmQgYXMgSQo+
IGFtIG5vdCAxMDAgJSBzdXJlIHdoeSBJIGFtIHNlZWluZyB0aGlzIGVycm9yLiAKClllYWgsIEkg
Y29tbWl0dGVkIGEgZml4IGZvciB0aGF0IGEgZmV3IG1pbnV0ZXMgYmVmb3JlLiBQbGVhc2UgZWRp
dApwb3N0Z3Jlc3FsLXNsb255MS5zcGVjLmluIGFuZCBjaGFuZ2UgLmJ6MiB0byAuZ3ogaW4gdGhl
IHNwZWMgZmlsZS4gVGhhdAp3aWxsIGJlIGFuIGVhc2llciBmaXggZm9yIHlvdSAoQ1ZTIHZlcnNp
b24gaGFzIGFsbCB0aGUgcmVmZXJlbmNlcwphcyAuYnoyKQoKUmVnYXJkcywKLS0gCkRldnJpbSBH
w5xORMOcWgpQb3N0Z3JlU1FMIFJlcGxpY2F0aW9uLCBDb25zdWx0aW5nLCBDdXN0b20gRGV2ZWxv
cG1lbnQsIDI0eDcgc3VwcG9ydApNYW5hZ2VkIFNlcnZpY2VzLCBTaGFyZWQgYW5kIERlZGljYXRl
ZCBIb3N0aW5nCkNvLUF1dGhvcnM6IHBsUEhQLCBPREJDbmcgLSBodHRwOi8vd3d3LmNvbW1hbmRw
cm9tcHQuY29tLwoKCi0tLS0tLS0tLS0tLS0tIG5leHQgcGFydCAtLS0tLS0tLS0tLS0tLQpBIG5v
bi10ZXh0IGF0dGFjaG1lbnQgd2FzIHNjcnViYmVkLi4uCk5hbWU6IG5vdCBhdmFpbGFibGUKVHlw
ZTogYXBwbGljYXRpb24vcGdwLXNpZ25hdHVyZQpTaXplOiAxODkgYnl0ZXMKRGVzYzogVGhpcyBp
cyBhIGRpZ2l0YWxseSBzaWduZWQgbWVzc2FnZSBwYXJ0ClVybCA6IGh0dHA6Ly9saXN0cy5zbG9u
eS5pbmZvL3BpcGVybWFpbC9zbG9ueTEtZ2VuZXJhbC9hdHRhY2htZW50cy8yMDA3MTAyNC9iMGJi
OGNkMi9hdHRhY2htZW50LnBncAo=
From oviney at avaya.com  Wed Oct 24 14:19:22 2007
From: oviney at avaya.com (Ouray Viney)
Date: Wed Oct 24 14:20:37 2007
Subject: SOLVED RE: [Slony1-general] problems
	withslony1-engine-1.2.2-1_PG8.2.5 and
	postgresql-server-8.2.5-1PGDG.rhel4
Message-ID: <1EC0C3E5FD3B7248827EF428F633C7E0141810@caotta0025m.na.ubiquity.net>

Hi All:

	First, I would like to thank Devrim and DarcyB on #slony!  Thank you for your patience and seeing this all the way though to resolution.

	The solution:

	In my bash script that was passing arguments to slonik, I had defined the replication user as "pgsql" when in reality it should have been postgres.  This is what was causing the error related to loading the xxid.so.

	<snippet>	
REPLICATIONUSER=postgres
export REPLICATIONUSER
	</snippet>

Cheers,

Ouray

-----Original Message-----
From: Devrim G?ND?Z [mailto:devrim@CommandPrompt.com] 
Sent: October 24, 2007 2:35 PM
To: Ouray Viney
Cc: Slony-I General Discussion
Subject: Re: [Slony1-general]problems withslony1-engine-1.2.2-1_PG8.2.5andpostgresql-server-8.2.5-1PGDG.rhel4

Hi,

On Wed, 2007-10-24 at 14:28 -0400, Ouray Viney wrote:
> /bin/tar cf postgresql-slony1-1.2.12.tar postgresql-slony1-1.2.12
> gzip --best postgresql-slony1-1.2.12.tar
> rm -rf postgresql-slony1-1.2.12
> rpmbuild -ta postgresql-slony1-1.2.12.tar.gz
> error: File /opt/slony1-1.2.12-pre1/postgresql-slony1-1.2.12.tar.bz2:
> No
> such file or directory
> make: *** [rpm] Error 1
> 
> Perhaps I am missing something?  I just don't want to hack around as I
> am not 100 % sure why I am seeing this error. 

Yeah, I committed a fix for that a few minutes before. Please edit
postgresql-slony1.spec.in and change .bz2 to .gz in the spec file. That
will be an easier fix for you (CVS version has all the references
as .bz2)

Regards,
-- 
Devrim G?ND?Z
PostgreSQL Replication, Consulting, Custom Development, 24x7 support
Managed Services, Shared and Dedicated Hosting
Co-Authors: plPHP, ODBCng - http://www.commandprompt.com/



From z-saito at guitar.ocn.ne.jp  Wed Oct 24 18:25:41 2007
From: z-saito at guitar.ocn.ne.jp (Hiroshi Saito)
Date: Wed Oct 24 18:25:25 2007
Subject: [Slony1-general] Slony-I 1.2.12-pre1 now available
References: <60bqaug37o.fsf@dba2.int.libertyrms.com><1193115974.5255.19.camel@localhost.localdomain><60ir4xeeg7.fsf_-_@dba2.int.libertyrms.com>
	<60640weer3.fsf_-_@dba2.int.libertyrms.com>
Message-ID: <00c801c816a5$f5567cc0$c601a8c0@HP22720319231>

Hi.

As for windows, logsjipper has a fork() problem....
However,  It is not indispensable. therefore, it ignores. =

Please apply it.

A result is the following. =

http://developer.pgadmin.org/~hiroshi/Slony-I/work/slony1-1.2.12-pre1-confi=
gure-log.txt
http://developer.pgadmin.org/~hiroshi/Slony-I/work/slony1-1.2.12-pre1-make-=
log.txt
http://developer.pgadmin.org/~hiroshi/Slony-I/work/slony1-1.2.12-pre1-test1=
-log.txt

Thanks!

Regards,
Hiroshi Saito

----- Original Message ----- =

From: "Christopher Browne" <cbbrowne@ca.afilias.info>


> Um, that was supposed to be 1.2.12, not 1.2.11.
> =

> A pre-release version 1.2.12 is now available at <http://slony.info/>;
> see the front page for links to the tarball as well as to see what
> changes are included in this version.
> -- =

> (reverse (concatenate 'string "gro.mca" "@" "enworbbc"))
> http://linuxfinances.info/info/linuxdistributions.html
> "Fear leads to anger.  Anger leads to hate.  Hate leads to using
> Windows NT for mission-critical applications."  --- What Yoda *meant*
> to say
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
-------------- next part --------------
A non-text attachment was scrubbed...
Name: slony1-1.2.12-pre1-patch
Type: application/octet-stream
Size: 699 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20071025=
/b0e02883/slony1-1.2.obj
From depesz at depesz.com  Thu Oct 25 17:46:47 2007
From: depesz at depesz.com (hubert depesz lubaczewski)
Date: Thu Oct 25 17:47:02 2007
Subject: [Slony1-general] deadlock in "execute script"?
Message-ID: <20071026004647.GA8979@depesz.com>

hi
i need to add 1 field to soem table that is replicated.
so i wrote appropriate sql:
=> cat go.sql
ALTER TABLE XXX add column yyy integer;

and slonik call:
=> cat execute.sh
#!/bin/bash
. setshell.sh
slonik <<_EOF_
    cluster name = $CLUSTER;
    node 1 admin conninfo = '$MASTERCONNINFO';
    node 2 admin conninfo = '$SLAVECONNINFO';
    execute script ( set id = 1, filename = 'go.sql', event node = 1);
_EOF_

i run it wehn the load on machine is minimal (it's next to impossible to
get lower load, as i'm doing it at 3 a.m.!), but all i get is:

#v+
<stdin>:6: PGRES_FATAL_ERROR select "_QQQ".ddlScript_prepare(1, -1);  - ERROR:  deadlock detected
DETAIL:  Process 7628 waits for AccessExclusiveLock on relation 56719 of database 55909; blocked by process 6705.
Process 6705 waits for AccessShareLock on relation 56624 of database 55909; blocked by process 7628.
CONTEXT:  SQL statement "lock table "public"."ZZZ" in access exclusive mode"
PL/pgSQL function "altertablerestore" line 47 at execute statement
SQL statement "SELECT  "_QQQ".alterTableRestore(tab_id) from "_QQQ".sl_table where tab_set in (select set_id from "_QQQ".sl_set where set_origin = "_QQQ".getLocalNodeId('_QQQ'))"
PL/pgSQL function "ddlscript_prepare" line 34 at perform
#v-

what can i do?
i really think there should be better way of handling schema modifications -
execute script is very unfriendly. and, as it seems - in some cases it simply doesn't work :(

depesz

-- 
quicksil1er: "postgres is excellent, but like any DB it requires a
highly paid DBA.  here's my CV!" :)
http://www.depesz.com/ - blog dla ciebie (i moje CV)
From david at fetter.org  Thu Oct 25 19:59:12 2007
From: david at fetter.org (David Fetter)
Date: Thu Oct 25 19:59:26 2007
Subject: [Slony1-general] VALUES () ... ();
Message-ID: <20071026025912.GC17890@fetter.org>

Folks,

Does Slony-I 2-to-be use INSERT ... VALUES (...), ..., (...); to pass
INSERTs?  It seems to me this would be quicker than a flock of
single-tuple INSERTs, and since we're having flag day with 8.3, we're
guaranteed the feature is there. :)

Cheers,
David.
-- 
David Fetter <david@fetter.org> http://fetter.org/
Phone: +1 415 235 3778  AIM: dfetter666  Yahoo!: dfetter
Skype: davidfetter      XMPP: david.fetter@gmail.com

Remember to vote!
Consider donating to Postgres: http://www.postgresql.org/about/donate
From simon at 2ndquadrant.com  Fri Oct 26 00:37:08 2007
From: simon at 2ndquadrant.com (Simon Riggs)
Date: Fri Oct 26 00:39:05 2007
Subject: [Slony1-general] VALUES () ... ();
In-Reply-To: <20071026025912.GC17890@fetter.org>
References: <20071026025912.GC17890@fetter.org>
Message-ID: <1193384228.4242.424.camel@ebony.site>

On Thu, 2007-10-25 at 19:59 -0700, David Fetter wrote:

> Does Slony-I 2-to-be use INSERT ... VALUES (...), ..., (...); to pass
> INSERTs?  It seems to me this would be quicker than a flock of
> single-tuple INSERTs, and since we're having flag day with 8.3, we're
> guaranteed the feature is there. :)

It's not easily possible to do this because each invocation of the log
trigger has a different set of values and they can't see each others
values.

It could be possible to do this on the apply side by saving up data from
log table row to row until we can issue a single mega-INSERT. But if we
were going to do that, why not initiate a COPY, which would handle the
bulk cases even better? The difficulty would be in deciding what the
logic should be to invoke the special case SQL construction.

Another thought: I notice that Slony writes out all of the column names
for each insert e.g. (col1, col2, col3) VALUES (x, y, x)

It would be straightforward to remove the (col1, col2, col3) text from
each INSERT statement since that is optional. That would reduce the
overhead of each INSERT row and reduce the parsing time on the other
side also.

-- 
  Simon Riggs
  2ndQuadrant  http://www.2ndQuadrant.com

From wooh at wooh.hu  Fri Oct 26 04:57:12 2007
From: wooh at wooh.hu (Adam PAPAI)
Date: Fri Oct 26 04:57:33 2007
Subject: [Slony1-general] Master -> Slave -> Master
Message-ID: <4721D618.1070208@wooh.hu>

Hello List,

Is it possible to change the Master->Slave status to Slave->Master with 
one or to command?

I mean I want to change  the p1 (Master) -> p2 (Slave)  to p2 (Master) 
-> p1 (Slave)


Or do I have to define a new CLUSTER for that?

So first, create a cluster for p1 (master) -> p2 (slave) and when I want 
to reverse the replication from p2 to p1, stop the replication for this 
node and create a new cluster definition and start the replication again 
for the newly created cluster?




-- 
Adam PAPAI
D i g i t a l Influence
http://www.digitalinfluence.hu
E-mail: wooh@wooh.hu
Phone: +36 30 33-55-735 (Hungary)
From nagy at ecircle-ag.com  Fri Oct 26 05:03:40 2007
From: nagy at ecircle-ag.com (Csaba Nagy)
Date: Fri Oct 26 05:04:48 2007
Subject: [Slony1-general] Master -> Slave -> Master
In-Reply-To: <4721D618.1070208@wooh.hu>
References: <4721D618.1070208@wooh.hu>
Message-ID: <1193400220.12694.3.camel@PCD12478>

On Fri, 2007-10-26 at 13:57 +0200, Adam PAPAI wrote:
> Hello List,
> 
> Is it possible to change the Master->Slave status to Slave->Master with 
> one or to command?

See:
http://slony.info/documentation/stmtmoveset.html

and look for slonik_move_set here:
http://slony.info/documentation/adminscripts.html

Cheers,
Csaba.


From david at fetter.org  Fri Oct 26 05:54:56 2007
From: david at fetter.org (David Fetter)
Date: Fri Oct 26 05:54:59 2007
Subject: [Slony1-general] VALUES () ... ();
In-Reply-To: <1193384228.4242.424.camel@ebony.site>
References: <20071026025912.GC17890@fetter.org>
	<1193384228.4242.424.camel@ebony.site>
Message-ID: <20071026125456.GD17890@fetter.org>

On Fri, Oct 26, 2007 at 08:37:08AM +0100, Simon Riggs wrote:
> On Thu, 2007-10-25 at 19:59 -0700, David Fetter wrote:
> 
> > Does Slony-I 2-to-be use INSERT ... VALUES (...), ..., (...); to pass
> > INSERTs?  It seems to me this would be quicker than a flock of
> > single-tuple INSERTs, and since we're having flag day with 8.3, we're
> > guaranteed the feature is there. :)
> 
> It's not easily possible to do this because each invocation of the log
> trigger has a different set of values and they can't see each others
> values.
> 
> It could be possible to do this on the apply side by saving up data from
> log table row to row until we can issue a single mega-INSERT. But if we
> were going to do that, why not initiate a COPY, which would handle the
> bulk cases even better? The difficulty would be in deciding what the
> logic should be to invoke the special case SQL construction.

Maybe an AFTER trigger per-statement for INSERTs?

Cheers,
David.
> 
> Another thought: I notice that Slony writes out all of the column names
> for each insert e.g. (col1, col2, col3) VALUES (x, y, x)
> 
> It would be straightforward to remove the (col1, col2, col3) text from
> each INSERT statement since that is optional. That would reduce the
> overhead of each INSERT row and reduce the parsing time on the other
> side also.
> 
> -- 
>   Simon Riggs
>   2ndQuadrant  http://www.2ndQuadrant.com

-- 
David Fetter <david@fetter.org> http://fetter.org/
Phone: +1 415 235 3778  AIM: dfetter666  Yahoo!: dfetter
Skype: davidfetter      XMPP: david.fetter@gmail.com

Remember to vote!
Consider donating to Postgres: http://www.postgresql.org/about/donate
From ajs at crankycanuck.ca  Fri Oct 26 06:54:51 2007
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Fri Oct 26 06:55:05 2007
Subject: [Slony1-general] deadlock in "execute script"?
In-Reply-To: <20071026004647.GA8979@depesz.com>
References: <20071026004647.GA8979@depesz.com>
Message-ID: <20071026135451.GD4717@crankycanuck.ca>

On Fri, Oct 26, 2007 at 02:46:47AM +0200, hubert depesz lubaczewski wrote:
> 
> i run it wehn the load on machine is minimal (it's next to impossible to
> get lower load, as i'm doing it at 3 a.m.!), but all i get is:
> 
> #v+
> <stdin>:6: PGRES_FATAL_ERROR select "_QQQ".ddlScript_prepare(1, -1);  - ERROR:  deadlock detected
> DETAIL:  Process 7628 waits for AccessExclusiveLock on relation 56719 of database 55909; blocked by process 6705.
> Process 6705 waits for AccessShareLock on relation 56624 of database 55909; blocked by process 7628.

Without knowing what those other transactions are trying to do, it's
sort of impossible to tell you.  But it sounds like something else
has a lock on that table.  You really need to take an application
outage to do DDL changes.  This is actually true on single-node
systems, too (you're taking one implicitly, because you have an
exclusive lock on that table while you're making the change).  Across
a replicated set like this, the outage period is just more obvious.

> i really think there should be better way of handling schema
> modifications - execute script is very unfriendly. and, as it seems
> - in some cases it simply doesn't work :(

It would work if you weren't trying to use the table.  

If you have a "better way of handling schema modifications" that will
actually work, please propose it.

A

-- 
Andrew Sullivan  | ajs@crankycanuck.ca
The whole tendency of modern prose is away from concreteness.
		--George Orwell
From ajs at crankycanuck.ca  Fri Oct 26 06:56:35 2007
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Fri Oct 26 06:56:43 2007
Subject: [Slony1-general] VALUES () ... ();
In-Reply-To: <1193384228.4242.424.camel@ebony.site>
References: <20071026025912.GC17890@fetter.org>
	<1193384228.4242.424.camel@ebony.site>
Message-ID: <20071026135635.GE4717@crankycanuck.ca>

On Fri, Oct 26, 2007 at 08:37:08AM +0100, Simon Riggs wrote:
> Another thought: I notice that Slony writes out all of the column names
> for each insert e.g. (col1, col2, col3) VALUES (x, y, x)

It only writes out the column names it needs to change, I thought?

A

-- 
Andrew Sullivan  | ajs@crankycanuck.ca
"The year's penultimate month" is not in truth a good way of saying
November.
		--H.W. Fowler
From cbbrowne at ca.afilias.info  Fri Oct 26 07:04:31 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri Oct 26 07:04:26 2007
Subject: [Slony1-general] VALUES () ... ();
In-Reply-To: <1193384228.4242.424.camel@ebony.site> (Simon Riggs's message of
	"Fri, 26 Oct 2007 08:37:08 +0100")
References: <20071026025912.GC17890@fetter.org>
	<1193384228.4242.424.camel@ebony.site>
Message-ID: <60hcke7z0w.fsf@dba2.int.libertyrms.com>

Simon Riggs <simon@2ndquadrant.com> writes:
> On Thu, 2007-10-25 at 19:59 -0700, David Fetter wrote:
>
>> Does Slony-I 2-to-be use INSERT ... VALUES (...), ..., (...); to pass
>> INSERTs?  It seems to me this would be quicker than a flock of
>> single-tuple INSERTs, and since we're having flag day with 8.3, we're
>> guaranteed the feature is there. :)
>
> It's not easily possible to do this because each invocation of the log
> trigger has a different set of values and they can't see each others
> values.
>
> It could be possible to do this on the apply side by saving up data from
> log table row to row until we can issue a single mega-INSERT. But if we
> were going to do that, why not initiate a COPY, which would handle the
> bulk cases even better? The difficulty would be in deciding what the
> logic should be to invoke the special case SQL construction.
>
> Another thought: I notice that Slony writes out all of the column names
> for each insert e.g. (col1, col2, col3) VALUES (x, y, x)

I put together a rough proposal a while back as to handling this more
efficiently.

The idea would be to detect consecutive updates to the same table, and
rewrite INSERTs to use multiple VALUE subclauses, as well as to detect
multiple UPDATEs involving the same SET clause, and fold together the
WHERE clauses.  DELETE has an obvious optimization too.

It adds a fair bit of complexity, and proably won't help OLTP traffic
terribly much (where it is common to intersperse tables heavily).  I
don't think it's the "big Win," though.

> It would be straightforward to remove the (col1, col2, col3) text from
> each INSERT statement since that is optional. That would reduce the
> overhead of each INSERT row and reduce the parsing time on the other
> side also.

Very unsafe.  What if the subscriber decides to consider the columns
to be in a different order?  Do we need to go back and ask for the
"reordering columns" feature that periodically pops up?

I see a much bigger win in Jan's idea to use COPY to get sl_log_n data
to the subscriber As Fast As Parsing Allows, and then use rules on
sl_log_n to generate INSERT/UPDATE/DELETE requests on the subscriber
to do the work.  That would take a lot of the load off the provider,
and COPY seems likely to be way faster than other rewritings.

-- 
(format nil "~S@~S" "cbbrowne" "acm.org")
http://cbbrowne.com/info/languages.html
Do not meddle in the affairs of dragons, for you are crunchy and taste
good with ketchup.
From david at fetter.org  Fri Oct 26 07:20:03 2007
From: david at fetter.org (David Fetter)
Date: Fri Oct 26 07:20:07 2007
Subject: [Slony1-general] VALUES () ... ();
In-Reply-To: <60hcke7z0w.fsf@dba2.int.libertyrms.com>
References: <20071026025912.GC17890@fetter.org>
	<1193384228.4242.424.camel@ebony.site>
	<60hcke7z0w.fsf@dba2.int.libertyrms.com>
Message-ID: <20071026142003.GG17890@fetter.org>

On Fri, Oct 26, 2007 at 10:04:31AM -0400, Christopher Browne wrote:
> Simon Riggs <simon@2ndquadrant.com> writes:
> > On Thu, 2007-10-25 at 19:59 -0700, David Fetter wrote:
> >
> >> Does Slony-I 2-to-be use INSERT ... VALUES (...), ..., (...); to
> >> pass INSERTs?  It seems to me this would be quicker than a flock
> >> of single-tuple INSERTs, and since we're having flag day with
> >> 8.3, we're guaranteed the feature is there. :)
> >
> > It's not easily possible to do this because each invocation of the
> > log trigger has a different set of values and they can't see each
> > others values.
> >
> > It could be possible to do this on the apply side by saving up
> > data from log table row to row until we can issue a single
> > mega-INSERT. But if we were going to do that, why not initiate a
> > COPY, which would handle the bulk cases even better? The
> > difficulty would be in deciding what the logic should be to invoke
> > the special case SQL construction.
> >
> > Another thought: I notice that Slony writes out all of the column
> > names for each insert e.g. (col1, col2, col3) VALUES (x, y, x)
> 
> I put together a rough proposal a while back as to handling this
> more efficiently.
> 
> The idea would be to detect consecutive updates to the same table,
> and rewrite INSERTs to use multiple VALUE subclauses, as well as to
> detect multiple UPDATEs involving the same SET clause, and fold
> together the WHERE clauses.  DELETE has an obvious optimization too.

You mean piling together the PKs and doing a DELETE .. WHERE (pk,
fields) = ANY(...) ?

> It adds a fair bit of complexity, and proably won't help OLTP traffic
> terribly much (where it is common to intersperse tables heavily).  I
> don't think it's the "big Win," though.
> 
> > It would be straightforward to remove the (col1, col2, col3) text from
> > each INSERT statement since that is optional. That would reduce the
> > overhead of each INSERT row and reduce the parsing time on the other
> > side also.
> 
> Very unsafe.  What if the subscriber decides to consider the columns
> to be in a different order?  Do we need to go back and ask for the
> "reordering columns" feature that periodically pops up?
> 
> I see a much bigger win in Jan's idea to use COPY to get sl_log_n
> data to the subscriber As Fast As Parsing Allows, and then use rules
> on sl_log_n to generate INSERT/UPDATE/DELETE requests on the
> subscriber to do the work.  That would take a lot of the load off
> the provider, and COPY seems likely to be way faster than other
> rewritings.

That's a very interesting idea, and kinda orthogonal to the
INSERT/UPDATE/DELETE speedups above.  How big a change would it be?

Cheers,
D
-- 
David Fetter <david@fetter.org> http://fetter.org/
Phone: +1 415 235 3778  AIM: dfetter666  Yahoo!: dfetter
Skype: davidfetter      XMPP: david.fetter@gmail.com

Remember to vote!
Consider donating to Postgres: http://www.postgresql.org/about/donate
From cedric.villemain at dalibo.com  Fri Oct 26 07:33:27 2007
From: cedric.villemain at dalibo.com (=?ISO-8859-1?Q?C=E9dric_Villemain?=)
Date: Fri Oct 26 07:33:33 2007
Subject: [Slony1-general] VALUES () ... ();
In-Reply-To: <60hcke7z0w.fsf@dba2.int.libertyrms.com>
References: <20071026025912.GC17890@fetter.org>	<1193384228.4242.424.camel@ebony.site>
	<60hcke7z0w.fsf@dba2.int.libertyrms.com>
Message-ID: <4721FAB7.2010408@dalibo.com>

Christopher Browne a ?crit :
> Simon Riggs <simon@2ndquadrant.com> writes:
>   
>> On Thu, 2007-10-25 at 19:59 -0700, David Fetter wrote:
>>
>>     
>>> Does Slony-I 2-to-be use INSERT ... VALUES (...), ..., (...); to pass
>>> INSERTs?  It seems to me this would be quicker than a flock of
>>> single-tuple INSERTs, and since we're having flag day with 8.3, we're
>>> guaranteed the feature is there. :)
>>>       
>> It's not easily possible to do this because each invocation of the log
>> trigger has a different set of values and they can't see each others
>> values.
>>
>> It could be possible to do this on the apply side by saving up data from
>> log table row to row until we can issue a single mega-INSERT. But if we
>> were going to do that, why not initiate a COPY, which would handle the
>> bulk cases even better? The difficulty would be in deciding what the
>> logic should be to invoke the special case SQL construction.
>>
>> Another thought: I notice that Slony writes out all of the column names
>> for each insert e.g. (col1, col2, col3) VALUES (x, y, x)
>>     
>
> I put together a rough proposal a while back as to handling this more
> efficiently.
>
> The idea would be to detect consecutive updates to the same table, and
> rewrite INSERTs to use multiple VALUE subclauses, as well as to detect
> multiple UPDATEs involving the same SET clause, and fold together the
> WHERE clauses.  DELETE has an obvious optimization too.
>
> It adds a fair bit of complexity, and proably won't help OLTP traffic
> terribly much (where it is common to intersperse tables heavily).  I
> don't think it's the "big Win," though.
>
>   
>> It would be straightforward to remove the (col1, col2, col3) text from
>> each INSERT statement since that is optional. That would reduce the
>> overhead of each INSERT row and reduce the parsing time on the other
>> side also.
>>     
>
> Very unsafe.  What if the subscriber decides to consider the columns
> to be in a different order?  Do we need to go back and ask for the
> "reordering columns" feature that periodically pops up?
>
> I see a much bigger win in Jan's idea to use COPY to get sl_log_n data
> to the subscriber As Fast As Parsing Allows, and then use rules on
> sl_log_n to generate INSERT/UPDATE/DELETE requests on the subscriber
> to do the work.  That would take a lot of the load off the provider,
> and COPY seems likely to be way faster than other rewritings.
>   

AFAIS, what really dammage replication is big update.
Because of a lot of row are added on sl_log and there is some 
seqscan=off in slony code wich burn the server (in 
src/slon/remote_worker.c). (I have also try to change the cursor size 
(get more or less lines a time, is there some doc about that ?)

Can it be possible to catch when an update/insert/delete change more 
than XX lines, and then apply different strategy ? (insert values () () 
() is not as fast as copy, but is several times quickest than insert 
values () ).

From cbbrowne at ca.afilias.info  Fri Oct 26 07:44:33 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri Oct 26 07:44:23 2007
Subject: [Slony1-general] VALUES () ... ();
In-Reply-To: <20071026142003.GG17890@fetter.org> (David Fetter's message of
	"Fri, 26 Oct 2007 07:20:03 -0700")
References: <20071026025912.GC17890@fetter.org>
	<1193384228.4242.424.camel@ebony.site>
	<60hcke7z0w.fsf@dba2.int.libertyrms.com>
	<20071026142003.GG17890@fetter.org>
Message-ID: <60bqam7x66.fsf@dba2.int.libertyrms.com>

David Fetter <david@fetter.org> writes:
> On Fri, Oct 26, 2007 at 10:04:31AM -0400, Christopher Browne wrote:
>> Simon Riggs <simon@2ndquadrant.com> writes:
>> > On Thu, 2007-10-25 at 19:59 -0700, David Fetter wrote:
>> >
>> >> Does Slony-I 2-to-be use INSERT ... VALUES (...), ..., (...); to
>> >> pass INSERTs?  It seems to me this would be quicker than a flock
>> >> of single-tuple INSERTs, and since we're having flag day with
>> >> 8.3, we're guaranteed the feature is there. :)
>> >
>> > It's not easily possible to do this because each invocation of the
>> > log trigger has a different set of values and they can't see each
>> > others values.
>> >
>> > It could be possible to do this on the apply side by saving up
>> > data from log table row to row until we can issue a single
>> > mega-INSERT. But if we were going to do that, why not initiate a
>> > COPY, which would handle the bulk cases even better? The
>> > difficulty would be in deciding what the logic should be to invoke
>> > the special case SQL construction.
>> >
>> > Another thought: I notice that Slony writes out all of the column
>> > names for each insert e.g. (col1, col2, col3) VALUES (x, y, x)
>> 
>> I put together a rough proposal a while back as to handling this
>> more efficiently.
>> 
>> The idea would be to detect consecutive updates to the same table,
>> and rewrite INSERTs to use multiple VALUE subclauses, as well as to
>> detect multiple UPDATEs involving the same SET clause, and fold
>> together the WHERE clauses.  DELETE has an obvious optimization too.
>
> You mean piling together the PKs and doing a DELETE .. WHERE (pk,
> fields) = ANY(...) ?

Right.

>> It adds a fair bit of complexity, and proably won't help OLTP traffic
>> terribly much (where it is common to intersperse tables heavily).  I
>> don't think it's the "big Win," though.
>> 
>> > It would be straightforward to remove the (col1, col2, col3) text from
>> > each INSERT statement since that is optional. That would reduce the
>> > overhead of each INSERT row and reduce the parsing time on the other
>> > side also.
>> 
>> Very unsafe.  What if the subscriber decides to consider the columns
>> to be in a different order?  Do we need to go back and ask for the
>> "reordering columns" feature that periodically pops up?

FYI, there is a further downside to the removal: It means you cannot
have any case where you "hack" a subscriber to have an extra column.
It also breaks the case where you use log shipping to generate a
temporal database, where there are additional temporal columns.

>> I see a much bigger win in Jan's idea to use COPY to get sl_log_n
>> data to the subscriber As Fast As Parsing Allows, and then use rules
>> on sl_log_n to generate INSERT/UPDATE/DELETE requests on the
>> subscriber to do the work.  That would take a lot of the load off
>> the provider, and COPY seems likely to be way faster than other
>> rewritings.
>
> That's a very interesting idea, and kinda orthogonal to the
> INSERT/UPDATE/DELETE speedups above.  How big a change would it be?

Fairly substantial.

It requires a pretty sophisticated stored procedure to run on the
subscriber that does the remapping of sl_log_n data into actual
updates.

It would have the interesting feature of meaning that the
configuration that controls table names lives on the subscriber, not
the provider, and perhaps give some extra flexibility there.  

Log shipping nodes would need to be aware of tables (e.g. - it would
need to track sl_table).

At this point, it's just a "gedanken experiment."
-- 
"cbbrowne","@","cbbrowne.com"
http://linuxfinances.info/info/sap.html
"The Linux  philosophy is laugh in  the face of  danger.  Oops.  Wrong
One.  'Do it yourself.'  That's it."  -- Linus Torvalds
From oviney at avaya.com  Fri Oct 26 07:52:47 2007
From: oviney at avaya.com (Ouray Viney)
Date: Fri Oct 26 07:53:27 2007
Subject: [Slony1-general] test_slony_replication.pl returns -> "Failure -
	connection to"
Message-ID: <1EC0C3E5FD3B7248827EF428F633C7E0141821@caotta0025m.na.ubiquity.net>

Hi All:

	I hoping that someone might have seen this before and can help.

	Note:  I have googled but didn't find anything related.

	I have a Master and two slave setup using PostgreSQL (8.2.5) and
Slony-I (slony1-1.2.12-pre1).  I am using the scripts that are in the
tools/ directory in the source tree.

	Here is the output that I get when I run the BASH wrapper
script:

<snippet>
[root@somehost tools]# ./run_rep_tests.sh 
DSN: dbname=pgbench host=pgmaster port=5432 password=uscl2004
Found master: 1
Rummage for DSNs
Query:

   select p.pa_server, p.pa_conninfo
   from _slony_example.sl_path p
   where exists (select * from _slony_example.sl_subscribe s where 
                          s.sub_set = 1 and 
                          (s.sub_provider = p.pa_server or
s.sub_receiver = p.pa_server) and
                          sub_active = 't')
   group by pa_server, pa_conninfo;

Query:  select * from "_slony_example".sl_subscribe s1 where sub_set = 1
and sub_receiver = 3 and sub_active;
Found live set!
DSN[3] = dbname=pgbenchslave2 host=pgslave2 user=postgres
DSN[1] = dbname=pgbench host=pgmaster user=postgres
Query:  select * from "_slony_example".sl_subscribe s1 where sub_set = 1
and sub_receiver = 2 and sub_active;
Found live set!
DSN[2] = dbname=pgbenchslave1 host=pgslave1 user=postgres
Connecting to master node 1 - DSN:[dbname=pgbench host=pgmaster
user=postgres password=uscl2004]
Connecting to slave node 3 - DSN:[dbname=pgbenchslave2 host=pgslave2
user=postgres password=uscl2004]
Failure - connection to 
Connecting to slave node 2 - DSN:[dbname=pgbenchslave1 host=pgslave1
user=postgres password=uscl2004]
Failure - connection to 
Connecting to master node 1 - DSN:[dbname=pgbench host=pgmaster
user=postgres password=uscl2004]
Connecting to slave node 3 - DSN:[dbname=pgbenchslave2 host=pgslave2
user=postgres password=uscl2004]
Failure - connection to 
Connecting to slave node 3 - DSN:[dbname=pgbenchslave2 host=pgslave2
user=postgres password=uscl2004]
Failure - connection to 
Connecting to slave node 2 - DSN:[dbname=pgbenchslave1 host=pgslave1
user=postgres password=uscl2004]
Failure - connection to 
Connecting to slave node 2 - DSN:[dbname=pgbenchslave1 host=pgslave1
user=postgres password=uscl2004]
Failure - connection to 
Connecting to master node 1 - DSN:[dbname=pgbench host=pgmaster
user=postgres password=uscl2004]
Final query to master
</snippet>

In my PostgreSQL pg_hba.conf I have set the AUTH type to TRUST, so that
my clients don't have to use passwords to connect.  I have looked at the
code in the perl script and can see that there is a condition that
appears to be triggering this error message:

<snippet>
sub report_failed_conn {
    my ($ci) = @_;
    $ci =~ s/password=.*$//g;
    print "Failure - connection to $ci\n";
}
</snippet>

I am using the following values in the bash rapper script:

<snippet>
#!/bin/sh
# $Id: run_rep_tests.sh,v 1.2 2005-05-04 20:33:04 cbbrowne Exp $
# Run Slony-I Replication Tests

#PASS="some secret"
TESTQUERY="select name, created_on from some_table order by id desc
limit 1;"
PERL=/usr/bin/perl
SCRIPT=test_slony_replication.pl
HOST=pgmaster
USER=postgres
PASS=uscl2004

$PERL $SCRIPT -database=pgbench -host=$HOST -user=$USER
-cluster=slony_example -port=5432 -password=$PASS
--finalquery=$TESTQUERY
#$PERL $SCRIPT -database=pgbench -host=$HOST -user=$USER
-cluster=slony_example -port=5432 --finalquery="$TESTQUERY"
</snippet>

Please let me know if this is related to the postgresql environment or
if this is a bug.

Kind Rgds,

Ouray Viney

From jc at oxado.com  Fri Oct 26 08:15:58 2007
From: jc at oxado.com (Jacques Caron)
Date: Fri Oct 26 08:16:14 2007
Subject: [Slony1-general] deadlock in "execute script"?
In-Reply-To: <20071026135451.GD4717@crankycanuck.ca>
References: <20071026004647.GA8979@depesz.com>
	<20071026135451.GD4717@crankycanuck.ca>
Message-ID: <20071026151601.C14BF116280A@zeus.directinfos.com>

At 15:54 26/10/2007, Andrew Sullivan wrote:
>On Fri, Oct 26, 2007 at 02:46:47AM +0200, hubert depesz lubaczewski wrote:
> >
> > i run it wehn the load on machine is minimal (it's next to impossible to
> > get lower load, as i'm doing it at 3 a.m.!), but all i get is:
> >
> > #v+
> > <stdin>:6: PGRES_FATAL_ERROR select "_QQQ".ddlScript_prepare(1, 
> -1);  - ERROR:  deadlock detected
> > DETAIL:  Process 7628 waits for AccessExclusiveLock on relation 
> 56719 of database 55909; blocked by process 6705.
> > Process 6705 waits for AccessShareLock on relation 56624 of 
> database 55909; blocked by process 7628.
>
>Without knowing what those other transactions are trying to do, it's
>sort of impossible to tell you.  But it sounds like something else
>has a lock on that table.

Not quite... It means something else has locks (even a very light 
read lock) on two random tables in the set, and got the locks in a 
different order than Slony tries to grab the locks before dropping 
the triggers, applying the script and restoring them. And since that 
order is currently random, it's nearly impossible to avoid :-(

>If you have a "better way of handling schema modifications" that will
>actually work, please propose it.

For the "add a column" case, *without* a default value, constraint or 
anything else like that:

1. add the column on all destination databases first (Slony won't 
mind and just ignore them)

2. change the trigger on the table on the origin database to add a 
"v" to the last argument:
UPDATE pg_trigger SET tgargs=substring(tgargs for 
octet_length(tgargs)-1)||E'v\\000' where tgname = '<name of trigger here>';

This additional "v" is ignored by Slony until the column is added

3. add the column on the origin database

Et voil? :-)

Notes:
- if you have any additional qualifiers on the column (a default, a 
contraint...), *really* think about it a lot before you try to use 
this. It really has a very good chance of breaking the replication or 
producing inconsistent results between origin and destination databases.

- a quick patch of the logtrigger C code (to ignore any columns after 
the end of the "kkvv" string) would avoid the need for the second step above

- the same thing would mean we could remove all trailing "v"s and 
save a few cycles on each update (the code only cares about the "k"s 
and any "v"s that are before or between "k"s)

- obviously a slonik EXECUTE ADD COLUMN instruction doing the ALTER 
TABLE ADD COLUMNs all over the place in the right order would be great

- alternatively, some way to tell EXECUTE SCRIPT to only lock (and 
"un-trigger" and "re-trigger") a defined set of tables (those 
actually affected by the DDL script) and/or to lock them in a 
particular order could be quite useful

- in the worst case, having EXECUTE SCRIPT lock tables in the order 
of their tab_id (ditto sequences) would be useful. Better: adding a 
"tab_lock_order" and sort on that one (as changing tab_ids after the 
fact seems a bit dangerous, eh).

Hope that helps, comments welcome.

Jacques.

From simon at 2ndquadrant.com  Fri Oct 26 08:58:15 2007
From: simon at 2ndquadrant.com (Simon Riggs)
Date: Fri Oct 26 08:59:58 2007
Subject: [Slony1-general] VALUES () ... ();
In-Reply-To: <60bqam7x66.fsf@dba2.int.libertyrms.com>
References: <20071026025912.GC17890@fetter.org>
	<1193384228.4242.424.camel@ebony.site>
	<60hcke7z0w.fsf@dba2.int.libertyrms.com>
	<20071026142003.GG17890@fetter.org>
	<60bqam7x66.fsf@dba2.int.libertyrms.com>
Message-ID: <1193414295.4242.554.camel@ebony.site>

On Fri, 2007-10-26 at 10:44 -0400, Christopher Browne wrote:

> >> > It would be straightforward to remove the (col1, col2, col3) text from
> >> > each INSERT statement since that is optional. That would reduce the
> >> > overhead of each INSERT row and reduce the parsing time on the other
> >> > side also.
> >> 
> >> Very unsafe.  What if the subscriber decides to consider the columns
> >> to be in a different order?  Do we need to go back and ask for the
> >> "reordering columns" feature that periodically pops up?
> 
> FYI, there is a further downside to the removal: It means you cannot
> have any case where you "hack" a subscriber to have an extra column.
> It also breaks the case where you use log shipping to generate a
> temporal database, where there are additional temporal columns.
> 
> >> I see a much bigger win in Jan's idea to use COPY to get sl_log_n
> >> data to the subscriber As Fast As Parsing Allows, and then use rules
> >> on sl_log_n to generate INSERT/UPDATE/DELETE requests on the
> >> subscriber to do the work.  That would take a lot of the load off
> >> the provider, and COPY seems likely to be way faster than other
> >> rewritings.

If removing the list of columns is a problem, how would the COPY idea
work? Or would you supply the list of columns as well as the data? I
take the point that the table definitions may differ.

We already have a list of the tables we replicate, so why not store the
list of columns being replicated also? We need only use the list when
the definitions differ.

Shipping the list of columns means the names all have to be checked,
which causes much additional parse time, as well as additional log table
space and network bandwidth.

So perhaps we should remove the column names as a standalone
optimisation, as well as a precursor to the COPY suggestion.

-- 
  Simon Riggs
  2ndQuadrant  http://www.2ndQuadrant.com

From ajs at crankycanuck.ca  Fri Oct 26 09:32:20 2007
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Fri Oct 26 09:32:37 2007
Subject: [Slony1-general] VALUES () ... ();
In-Reply-To: <1193414295.4242.554.camel@ebony.site>
References: <20071026025912.GC17890@fetter.org>
	<1193384228.4242.424.camel@ebony.site>
	<60hcke7z0w.fsf@dba2.int.libertyrms.com>
	<20071026142003.GG17890@fetter.org>
	<60bqam7x66.fsf@dba2.int.libertyrms.com>
	<1193414295.4242.554.camel@ebony.site>
Message-ID: <20071026163220.GX4717@crankycanuck.ca>

On Fri, Oct 26, 2007 at 04:58:15PM +0100, Simon Riggs wrote:

> We already have a list of the tables we replicate, so why not store the
> list of columns being replicated also? We need only use the list when
> the definitions differ.

It strikes me that this is going to require a buch of extra
maintenance work -- every time you do DDL, you're going also to have
to make sure you get exactly the right order of columns everywhere,
and be able to make sure that doesn't get out of sync in any way.  We
already have problems with cases where we have not relied on the
actual catalogues on the actual nodes (because we fiddled with them),
and they've created all manner of headaches.  Adding another
dependency to some lookaside table that only Slony knows about seems
to me to be a way of addition additional fragility.  Also, it adds
yet more complicated code (are they in the same order?  Ok, do X. 
No?  Then do Y) to a system that is already more complicated than I
think anybody likes.  That wrinkly code will have to be maintained.

So unless this is going to provide a really significant win (on the
order of 20% or more), I can't see the value in chasing it down.  I
think some of the other proposals are more likely to provide similar
benefits without the drawbacks.

-- 
Andrew Sullivan  | ajs@crankycanuck.ca
Everything that happens in the world happens at some place.
		--Jane Jacobs 
From cbbrowne at ca.afilias.info  Fri Oct 26 11:37:01 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri Oct 26 11:36:53 2007
Subject: [Slony1-general] Slony-I 1.2.12-pre1 now available
In-Reply-To: <00c801c816a5$f5567cc0$c601a8c0@HP22720319231> (Hiroshi Saito's
	message of "Thu, 25 Oct 2007 10:25:41 +0900")
References: <60bqaug37o.fsf@dba2.int.libertyrms.com>
	<1193115974.5255.19.camel@localhost.localdomain>
	<60ir4xeeg7.fsf_-_@dba2.int.libertyrms.com>
	<60640weer3.fsf_-_@dba2.int.libertyrms.com>
	<00c801c816a5$f5567cc0$c601a8c0@HP22720319231>
Message-ID: <60ve8t7meq.fsf@dba2.int.libertyrms.com>

"Hiroshi Saito" <z-saito@guitar.ocn.ne.jp> writes:
> As for windows, logsjipper has a fork() problem....
> However,  It is not indispensable. therefore, it ignores. Please apply
> it.

Thanks for the patch; it has been applied to both 1.2 and to HEAD.
-- 
let name="cbbrowne" and tld="cbbrowne.com" in name ^ "@" ^ tld;;
http://linuxfinances.info/info/spiritual.html
How is my programming?  Call 1-800-DEV-NULL
From dane at greatschools.net  Fri Oct 26 11:46:06 2007
From: dane at greatschools.net (Dane Miller)
Date: Fri Oct 26 11:46:16 2007
Subject: [Slony1-general] monitoring slony delay with mysql-heartbeat
Message-ID: <1193424366.6024.26.camel@danedesk.greatschools.net>

Hi Slony Folks,

I recently started administering a Postgres/Slony-1 cluster and wasn't
satisfied with the replication monitoring scripts in Slony's tools/
directory.  So I turned to the very fine mysql-heartbeat.  Thanks to
some recent work by the author, as of revision 1104, mysql-heartbeat
works great for Postgres too!  Just use the command line option
--dbidriver=Pg.

Read about it here:
http://mysqltoolkit.sourceforge.net/

And get it from SVN here (this feature is currently only in SVN):
http://mysqltoolkit.svn.sourceforge.net/viewvc/mysqltoolkit/trunk/mysql-heartbeat/

>From the author:
MySQL Heartbeat
Monitors replication delay via a two-part process: a heartbeat on the
master, and monitoring on the slave. It tells how far the slave is
behind the master at the top of a replication hierarchy.... It produces
moving averages over arbitrary time windows, so you can see on average
how much your slave has lagged during the last 1, 5 and 15 minutes (by
default ? you can customize this). It can run as a daemon too.

Enjoy!
Dane

-- 
Dane Miller
Systems Administrator
Great Schools, Inc
http://greatschools.net

From WCoole at aperiogroup.com  Fri Oct 26 12:05:31 2007
From: WCoole at aperiogroup.com (Walter Coole)
Date: Fri Oct 26 12:05:36 2007
Subject: [Slony1-general] Mysterious "node -1" blocking copy set
Message-ID: <4292CEA5F4927248979C701CA83500BB67F449@SERVER.aperiogroup.local>

It appears that I'm getting a similar symptom; the log shows:

 =


2007-10-26 11:54:26 PDT ERROR  remoteWorkerThread_1: node -1 not found in r=
untime configuration

2007-10-26 11:54:26 PDT WARN   remoteWorkerThread_1: data copy for set 1 fa=
iled - sleep 60 seconds

 =


I shut down with:

 =


/usr/local/bin/slonik_unsubscribe_set 1 2 | slonik

/usr/local/bin/slon_kill

 =


Then started up again with:

 =


/usr/local/bin/slon_start 1

/usr/local/bin/slon_start 2

 =


The slons are up and passing SYNCs around, but:

 =


/usr/local/bin/slonik_subscribe_set 1 2 | slonik

 =


Gets me back to the "node -1" error.  I'm clearly missing something; I don'=
t understand where the -1 node number comes from.

 =


I'm really new at this, but I had these nodes replicating a couple days ago=
 with this config, so I must not be cleaning up something on shutdown.

 =


Thanks

Christopher Browne
Thu, 13 Sep 2007 09:48:47 -0700

Fran=E7ois Girault <[EMAIL PROTECTED]> writes:
> I have troubles with a simple two nodes cluster. I have a set, id=3D3,
> that can't be copied on a slave node cause of this error :
> =

> 2007-09-13 17:07:23 CEST DEBUG1 copy_set 3
> 2007-09-13 17:07:23 CEST ERROR  remoteWorkerThread_1: node -1 not
> found in runtime configuration
> 2007-09-13 17:07:23 CEST WARN   remoteWorkerThread_1: data copy for
> set 3 failed - sleep 60 seconds
> =

> The most strange thing : even when I drop the set 3, the log message
> persists ! I don't know what to do and I can't uninstall all and
> rebuild the cluster.
 =

Generally, this has to do with the slon process being a bit confused
as to the runtime configuration *in memory.*
 =

Restart the slon, and this ought to alleviate the problem.
 =

It strikes me that maybe we should have logic in the remoteWorker
thread which notices "Oh, it's looking for node -1, which *obviously*
doesn't exist.  Maybe I should fall over and let another slon take
over..."
-- =

output =3D ("cbbrowne" "@" "cbbrowne.com")
http://cbbrowne.com/info/slony.html
E.V.A., pod 5, launching...

 =


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071026/=
1239a312/attachment.htm
From devrim at CommandPrompt.com  Fri Oct 26 12:42:54 2007
From: devrim at CommandPrompt.com (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Fri Oct 26 12:44:14 2007
Subject: [Slony1-general] Slony-I 1.2.12-pre1 now available
In-Reply-To: <60640weer3.fsf_-_@dba2.int.libertyrms.com>
References: <60bqaug37o.fsf@dba2.int.libertyrms.com>
	<1193115974.5255.19.camel@localhost.localdomain>
	<60ir4xeeg7.fsf_-_@dba2.int.libertyrms.com>
	<60640weer3.fsf_-_@dba2.int.libertyrms.com>
Message-ID: <1193427774.18328.64.camel@laptop.gunduz.org>

SGksCgpPbiBXZWQsIDIwMDctMTAtMjQgYXQgMTE6MDMgLTA0MDAsIENocmlzdG9waGVyIEJyb3du
ZSB3cm90ZToKPiBBIHByZS1yZWxlYXNlIHZlcnNpb24gMS4yLjEyIGlzIG5vdyBhdmFpbGFibGUg
YXQgPGh0dHA6Ly9zbG9ueS5pbmZvLz47CgoxLjIuMTJwcmUxKyB0aGUgcGF0Y2hlcyBJIGFwcGxp
ZWQgZm9yIGRvY3Mgd29ya2VkIGZpbmUgb24gUkhFTDQgYW5kIFJIRUwKNS4gVGVzdGVkIHdpdGgg
RGFyY3kuCgpSZWdhcmRzLAotLSAKRGV2cmltIEfDnE5Ew5xaClBvc3RncmVTUUwgUmVwbGljYXRp
b24sIENvbnN1bHRpbmcsIEN1c3RvbSBEZXZlbG9wbWVudCwgMjR4NyBzdXBwb3J0Ck1hbmFnZWQg
U2VydmljZXMsIFNoYXJlZCBhbmQgRGVkaWNhdGVkIEhvc3RpbmcKQ28tQXV0aG9yczogcGxQSFAs
IE9EQkNuZyAtIGh0dHA6Ly93d3cuY29tbWFuZHByb21wdC5jb20vCgoKLS0tLS0tLS0tLS0tLS0g
bmV4dCBwYXJ0IC0tLS0tLS0tLS0tLS0tCkEgbm9uLXRleHQgYXR0YWNobWVudCB3YXMgc2NydWJi
ZWQuLi4KTmFtZTogbm90IGF2YWlsYWJsZQpUeXBlOiBhcHBsaWNhdGlvbi9wZ3Atc2lnbmF0dXJl
ClNpemU6IDE4OSBieXRlcwpEZXNjOiBUaGlzIGlzIGEgZGlnaXRhbGx5IHNpZ25lZCBtZXNzYWdl
IHBhcnQKVXJsIDogaHR0cDovL2xpc3RzLnNsb255LmluZm8vcGlwZXJtYWlsL3Nsb255MS1nZW5l
cmFsL2F0dGFjaG1lbnRzLzIwMDcxMDI2Lzk5OTlmZWJjL2F0dGFjaG1lbnQucGdwCg==
From simon at 2ndquadrant.com  Sat Oct 27 14:40:32 2007
From: simon at 2ndquadrant.com (Simon Riggs)
Date: Sat Oct 27 14:42:27 2007
Subject: [Slony1-general] VALUES () ... ();
In-Reply-To: <20071026163220.GX4717@crankycanuck.ca>
References: <20071026025912.GC17890@fetter.org>
	<1193384228.4242.424.camel@ebony.site>
	<60hcke7z0w.fsf@dba2.int.libertyrms.com>
	<20071026142003.GG17890@fetter.org>
	<60bqam7x66.fsf@dba2.int.libertyrms.com>
	<1193414295.4242.554.camel@ebony.site>
	<20071026163220.GX4717@crankycanuck.ca>
Message-ID: <1193521232.4242.612.camel@ebony.site>

On Fri, 2007-10-26 at 12:32 -0400, Andrew Sullivan wrote:

> So unless this is going to provide a really significant win (on the
> order of 20% or more), I can't see the value in chasing it down.  I
> think some of the other proposals are more likely to provide similar
> benefits without the drawbacks.

Agreed. I'm merely pointing out that if we go with the COPY speed-up
mentioned up-thread then we'll have to do this logic also. That might
give us 20% increase, but just dropping the cols list definitely won't.

-- 
  Simon Riggs
  2ndQuadrant  http://www.2ndQuadrant.com

From depesz at depesz.com  Sun Oct 28 04:10:46 2007
From: depesz at depesz.com (hubert depesz lubaczewski)
Date: Sun Oct 28 04:11:10 2007
Subject: [Slony1-general] deadlock in "execute script"?
In-Reply-To: <20071026135451.GD4717@crankycanuck.ca>
References: <20071026004647.GA8979@depesz.com>
	<20071026135451.GD4717@crankycanuck.ca>
Message-ID: <20071028111046.GA19183@depesz.com>

On Fri, Oct 26, 2007 at 09:54:51AM -0400, Andrew Sullivan wrote:
> > i really think there should be better way of handling schema
> > modifications - execute script is very unfriendly. and, as it seems
> > - in some cases it simply doesn't work :(
> It would work if you weren't trying to use the table.  
> If you have a "better way of handling schema modifications" that will
> actually work, please propose it.

i dont have. the problem i see is that bringing the database down to add
a simple column is not really acceptable.

why cant slony simply ignore "v" parts of trigger argument?

after all - insert/update/delete happens trigger *knows* the structure
of the table the event took place on.

so, sorry - but i really dont see the point in insisting to stop
production database to add some secondary, non-key, field.

depesz

-- 
quicksil1er: "postgres is excellent, but like any DB it requires a
highly paid DBA.  here's my CV!" :)
http://www.depesz.com/ - blog dla ciebie (i moje CV)
From simon at 2ndquadrant.com  Sun Oct 28 05:42:58 2007
From: simon at 2ndquadrant.com (Simon Riggs)
Date: Sun Oct 28 05:44:45 2007
Subject: [Slony1-general] VALUES () ... ();
In-Reply-To: <20071026135635.GE4717@crankycanuck.ca>
References: <20071026025912.GC17890@fetter.org>
	<1193384228.4242.424.camel@ebony.site>
	<20071026135635.GE4717@crankycanuck.ca>
Message-ID: <1193575378.4242.688.camel@ebony.site>

On Fri, 2007-10-26 at 09:56 -0400, Andrew Sullivan wrote:
> On Fri, Oct 26, 2007 at 08:37:08AM +0100, Simon Riggs wrote:
> > Another thought: I notice that Slony writes out all of the column names
> > for each insert e.g. (col1, col2, col3) VALUES (x, y, x)
> 
> It only writes out the column names it needs to change, I thought?

Yes, you're right. That means for an INSERT that is all of them.

(Just noticed this email).

-- 
  Simon Riggs
  2ndQuadrant  http://www.2ndQuadrant.com

From david at fetter.org  Sun Oct 28 11:26:48 2007
From: david at fetter.org (David Fetter)
Date: Sun Oct 28 11:26:57 2007
Subject: [Slony1-general] monitoring slony delay with mysql-heartbeat
In-Reply-To: <1193424366.6024.26.camel@danedesk.greatschools.net>
References: <1193424366.6024.26.camel@danedesk.greatschools.net>
Message-ID: <20071028182648.GA2006@fetter.org>

On Fri, Oct 26, 2007 at 11:46:06AM -0700, Dane Miller wrote:
> Hi Slony Folks,
> 
> I recently started administering a Postgres/Slony-1 cluster and wasn't
> satisfied with the replication monitoring scripts in Slony's tools/
> directory.  So I turned to the very fine mysql-heartbeat.  Thanks to
> some recent work by the author, as of revision 1104, mysql-heartbeat
> works great for Postgres too!  Just use the command line option
> --dbidriver=Pg.
> 
> Read about it here:
> http://mysqltoolkit.sourceforge.net/
> 
> And get it from SVN here (this feature is currently only in SVN):
> http://mysqltoolkit.svn.sourceforge.net/viewvc/mysqltoolkit/trunk/mysql-heartbeat/

Maybe I'm missing something obvious, but I don't see anything about
this in their documentation.  Any way to get it some prominence there?

Cheers,
David.

> 
> From the author:
> MySQL Heartbeat
> Monitors replication delay via a two-part process: a heartbeat on the
> master, and monitoring on the slave. It tells how far the slave is
> behind the master at the top of a replication hierarchy.... It produces
> moving averages over arbitrary time windows, so you can see on average
> how much your slave has lagged during the last 1, 5 and 15 minutes (by
> default ? you can customize this). It can run as a daemon too.
> 
> Enjoy!
> Dane
> 
> -- 
> Dane Miller
> Systems Administrator
> Great Schools, Inc
> http://greatschools.net
> 
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general

-- 
David Fetter <david@fetter.org> http://fetter.org/
Phone: +1 415 235 3778  AIM: dfetter666  Yahoo!: dfetter
Skype: davidfetter      XMPP: david.fetter@gmail.com

Remember to vote!
Consider donating to Postgres: http://www.postgresql.org/about/donate
From cedric.villemain at dalibo.com  Mon Oct 29 02:29:07 2007
From: cedric.villemain at dalibo.com (=?UTF-8?B?Q8OpZHJpYyBWaWxsZW1haW4=?=)
Date: Mon Oct 29 02:29:31 2007
Subject: [Slony1-general] monitoring slony delay with mysql-heartbeat
In-Reply-To: <20071028182648.GA2006@fetter.org>
References: <1193424366.6024.26.camel@danedesk.greatschools.net>
	<20071028182648.GA2006@fetter.org>
Message-ID: <4725A7E3.2060903@dalibo.com>

David Fetter a ?crit :
> On Fri, Oct 26, 2007 at 11:46:06AM -0700, Dane Miller wrote:
>   
>> Hi Slony Folks,
>>
>> I recently started administering a Postgres/Slony-1 cluster and wasn't
>> satisfied with the replication monitoring scripts in Slony's tools/
>> directory.  So I turned to the very fine mysql-heartbeat.  Thanks to
>> some recent work by the author, as of revision 1104, mysql-heartbeat
>> works great for Postgres too!  Just use the command line option
>> --dbidriver=Pg.
>>
>> Read about it here:
>> http://mysqltoolkit.sourceforge.net/
>>
>> And get it from SVN here (this feature is currently only in SVN):
>> http://mysqltoolkit.svn.sourceforge.net/viewvc/mysqltoolkit/trunk/mysql-heartbeat/
>>     
>
> Maybe I'm missing something obvious, but I don't see anything about
> this in their documentation.  Any way to get it some prominence there?
>
> Cheers,
> David.nt.
>   
looking at the code, there is nothing very fantastic. It supports pg as 
it can support anything.

I personnaly get the same results with a table updated every second, and 
a munin graph grabing the last values from each node. Munin can do all 
the average I want.
>   
>> From the author:
>> MySQL Heartbeat
>> Monitors replication delay via a two-part process: a heartbeat on the
>> master, and monitoring on the slave. It tells how far the slave is
>> behind the master at the top of a replication hierarchy.... It produces
>> moving averages over arbitrary time windows, so you can see on average
>> how much your slave has lagged during the last 1, 5 and 15 minutes (by
>> default ? you can customize this). It can run as a daemon too.
>>
>> Enjoy!
>> Dane
>>
>> -- 
>> Dane Miller
>> Systems Administrator
>> Great Schools, Inc
>> http://greatschools.net
>>
>> _______________________________________________
>> Slony1-general mailing list
>> Slony1-general@lists.slony.info
>> http://lists.slony.info/mailman/listinfo/slony1-general
>>     
>
>   

From ajs at crankycanuck.ca  Mon Oct 29 09:53:00 2007
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Mon Oct 29 09:53:20 2007
Subject: [Slony1-general] deadlock in "execute script"?
In-Reply-To: <20071028111046.GA19183@depesz.com>
References: <20071026004647.GA8979@depesz.com>
	<20071026135451.GD4717@crankycanuck.ca>
	<20071028111046.GA19183@depesz.com>
Message-ID: <20071029165300.GU15327@crankycanuck.ca>

On Sun, Oct 28, 2007 at 12:10:46PM +0100, hubert depesz lubaczewski wrote:
> i dont have. the problem i see is that bringing the database down to add
> a simple column is not really acceptable.

You don't take the _database_ down, you take the application down.

> why cant slony simply ignore "v" parts of trigger argument?
> 
> after all - insert/update/delete happens trigger *knows* the structure
> of the table the event took place on.

No, it doesn't.  That's exactly the problem.  It looks like it to a
user, but Slony uses the SPI facility to avoid overhead, which means
that it _can't_ know about these changes.  There is work afoot to
make it more possible (see other messages about this), but those
changes won't be backward compatible.  Now that we have reasonably
stable releases that support older versions, we may be in a position
to add backward incompatible features (we did that to 7.3, for
instance, recently).  But up until 8.3, the features you need to
achieve what you want just weren't there anyway.

A

-- 
Andrew Sullivan  | ajs@crankycanuck.ca
In the future this spectacle of the middle classes shocking the avant-
garde will probably become the textbook definition of Postmodernism. 
                --Brad Holland
From depesz at depesz.com  Mon Oct 29 11:36:53 2007
From: depesz at depesz.com (hubert depesz lubaczewski)
Date: Mon Oct 29 11:37:03 2007
Subject: [Slony1-general] deadlock in "execute script"?
In-Reply-To: <20071029165300.GU15327@crankycanuck.ca>
References: <20071026004647.GA8979@depesz.com>
	<20071026135451.GD4717@crankycanuck.ca>
	<20071028111046.GA19183@depesz.com>
	<20071029165300.GU15327@crankycanuck.ca>
Message-ID: <20071029183653.GB12691@depesz.com>

On Mon, Oct 29, 2007 at 12:53:00PM -0400, Andrew Sullivan wrote:
> You don't take the _database_ down, you take the application down.

all applications using the database. which is (at the very least to
end-user) the same as if i did take the database down.

the distinction is of course there, but it's useful for technological
distinction - for user standpoint it's indistinguishable.

> No, it doesn't.  That's exactly the problem.  It looks like it to a
> user, but Slony uses the SPI facility to avoid overhead, which means
> that it _can't_ know about these changes.  There is work afoot to
> make it more possible (see other messages about this), but those
> changes won't be backward compatible.  Now that we have reasonably
> stable releases that support older versions, we may be in a position
> to add backward incompatible features (we did that to 7.3, for
> instance, recently).  But up until 8.3, the features you need to
> achieve what you want just weren't there anyway.

ok, i've practically never wrote anything using spi, so i'm off the base
here. if you say it will become possible with 8.3, and some future,
yet-to-be-written version of slony - it's fair enough. it's good to know
that the developers know about the issue and are doing something about
it.

depesz

-- 
quicksil1er: "postgres is excellent, but like any DB it requires a
highly paid DBA.  here's my CV!" :)
http://www.depesz.com/ - blog dla ciebie (i moje CV)
From drees76 at gmail.com  Mon Oct 29 17:22:22 2007
From: drees76 at gmail.com (David Rees)
Date: Mon Oct 29 17:22:35 2007
Subject: [Slony1-general] Postgres Upgrade Scenario Question
In-Reply-To: <471AA98C.9030305@ca.afilias.info>
References: <72dbd3150710191250j5d793feakf8390886cb245341@mail.gmail.com>
	<47190C86.4020000@ca.afilias.info>
	<72dbd3150710191542w4d6c2ab6q83ab55a407e3ef7f@mail.gmail.com>
	<471AA98C.9030305@ca.afilias.info>
Message-ID: <72dbd3150710291722p4fcce63dpf1e2a5755656a0d0@mail.gmail.com>

On 10/20/07, JP Fletcher <jpfletch@ca.afilias.info> wrote:
> When we do this sort of thing, we bring down both old and new
> postmasters, swap the ports, then restart.  Then we reshape sl_path with
> slonik STORE PATH commands.  And we wait to drop the old node until
> later.

Thanks, that's the type of hint I was looking for. Anyway, for the
archives, here's how I migrated the server.

Brief setup overview again:

Node 1: "master server" on server1@5432
Node 2: "slave server" on server2@5432
Node 3: "slave server" on server2@5433

Goal is to drop node 2 and move node 3 to node 2's port.

1. Stop slon daemons
2. Update node 3 configuration files (postgresql.conf, slon conf
files, etc) to reflect new node 3 port.
3. Restart node 3 postgresql on new port
4. Drop node 2
5. Execute slonik store path command to update path.
6. Start slon daemons
7. Check that everything looks OK.

-Dave
From thomas at tada.se  Tue Oct 30 03:23:49 2007
From: thomas at tada.se (Thomas Hallgren)
Date: Tue Oct 30 03:24:15 2007
Subject: [Slony1-general] Newbie questions
Message-ID: <47270635.60208@tada.se>

Hi,
I'm trying to wrap my head around Slony-I and how to use it from an 
application server like JBoss with Hibernate. I'm not clear on the 
relationship between actual connections established by a client and 
nodes in the cluster.

Is it true that any connection that is established is either connected 
to a slave or to the master (origin) for a specific replication set? 
I.e. there's no node in between that will redirect updates to the master 
for the replication set in question?

I'm trying to figure out how to do a controlled switchover and the 
implications of doing that. My appservers can work with two different 
connections if needed but it will be somewhat cumbersome if they need to 
change their settings when I do a switchover. Is there a way to do 
switchover and maintain the connection settings (i.e. host, database, 
credentials)? Ideally, the connections should survive the switch.

I'm also looking into automatic switchover in case the master fails for 
some reason. The Heartbeat product seems to be useful for this. Are you 
aware of any examples on how to do this? Any pointer or hint would be 
useful.

Kind Regards,
Thomas Hallgren

From plk.zuber at gmail.com  Tue Oct 30 04:33:35 2007
From: plk.zuber at gmail.com (=?UTF-8?Q?Filip_Rembia=C5=82kowski?=)
Date: Tue Oct 30 04:33:58 2007
Subject: [Slony1-general] Newbie questions
In-Reply-To: <47270635.60208@tada.se>
References: <47270635.60208@tada.se>
Message-ID: <92869e660710300433r1499ac7cpad33672d197eee51@mail.gmail.com>

2007/10/30, Thomas Hallgren <thomas@tada.se>:
> Hi,
> I'm trying to wrap my head around Slony-I and how to use it from an
> application server like JBoss with Hibernate. I'm not clear on the
> relationship between actual connections established by a client and
> nodes in the cluster.
>
> Is it true that any connection that is established is either connected
> to a slave or to the master (origin) for a specific replication set?
> I.e. there's no node in between that will redirect updates to the master
> for the replication set in question?
>
> I'm trying to figure out how to do a controlled switchover and the
> implications of doing that. My appservers can work with two different
> connections if needed but it will be somewhat cumbersome if they need to
> change their settings when I do a switchover. Is there a way to do
> switchover and maintain the connection settings (i.e. host, database,
> credentials)? Ideally, the connections should survive the switch.
>
> I'm also looking into automatic switchover in case the master fails for
> some reason. The Heartbeat product seems to be useful for this. Are you
> aware of any examples on how to do this? Any pointer or hint would be
> useful.


It seems you need pgpool-II + slony + heartbeat(or similar) setup

I heard gossips that there are actually a few people in the world who
managed to do this :)

No single ready made HOWTO exists I know of.

google for pgpool+slony+heartbeat.
there are some interesting documents, including presentations from PGCon.

HTH

-- 
Filip Rembia?kowski
From cbbrowne at ca.afilias.info  Tue Oct 30 12:42:41 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Tue Oct 30 12:42:50 2007
Subject: [Slony1-general] Version 1.2.12 release candidate 2
Message-ID: <60tzo8z8we.fsf@dba2.int.libertyrms.com>

There have been a number of changes over the last week, so I have
built another release candidate.

Nothing terribly major - release notes listed in the news item on
1.2.12 pre2...
-- 
"cbbrowne","@","acm.org"
http://slony.info/
"Optimization hinders evolution."  -- Alan J. Perlis
From dk at in-telegence.net  Wed Oct 31 01:19:34 2007
From: dk at in-telegence.net (Dominik Klein)
Date: Wed Oct 31 01:19:58 2007
Subject: [Slony1-general] How to pass parameters to a slonik script?
Message-ID: <47283A96.2030207@in-telegence.net>

Hi

(how?) is it possible to pass parameters to a slonik script?

Like in a bash script

#!/bin/bash
echo $1

and then "./script.sh test" would output "test".

Regards
Dominik
From stephen.hindmarch at bt.com  Wed Oct 31 04:49:06 2007
From: stephen.hindmarch at bt.com (stephen.hindmarch@bt.com)
Date: Wed Oct 31 04:49:33 2007
Subject: [Slony1-general] How to pass parameters to a slonik script?
In-Reply-To: <47283A96.2030207@in-telegence.net>
Message-ID: <614CEAAF10695543B87ED664C03A5DB204E9A100@E03MVX1-UKDY.domain1.systemhost.net>

Dominik,

Its as straightforward as you might think. Here is a fragment of a bash
script that I use as part of my application. This function issues the
subscribe set command to bring a new subscribing node into the system
and get its replication from a particular provider node. In this
application there is only one set (set 1) but you could extend the
principle to cover multiple sets.

## Subscribe
subscribe(){
    provider=$1
    subscriber=$2
    if test ${provider} -eq ${subscriber};then
	return
    fi
    slonik <<EOF
include <$conf_file>;
echo 'Subscribing ${subscriber} to ${provider}';
subscribe set
(id=1,provider=$provider,receiver=$subscriber,forward=yes);
echo 'Done';
EOF
}

Steve Hindmarch
BT Design

> -----Original Message-----
> From: slony1-general-bounces@lists.slony.info 
> [mailto:slony1-general-bounces@lists.slony.info] On Behalf Of 
> Dominik Klein
> Sent: 31 October 2007 08:20
> To: slony1-general@lists.slony.info
> Subject: [Slony1-general] How to pass parameters to a slonik script?
> 
> Hi
> 
> (how?) is it possible to pass parameters to a slonik script?
> 
> Like in a bash script
> 
> #!/bin/bash
> echo $1
> 
> and then "./script.sh test" would output "test".
> 
> Regards
> Dominik
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
> 
From dk at in-telegence.net  Wed Oct 31 04:51:44 2007
From: dk at in-telegence.net (Dominik Klein)
Date: Wed Oct 31 04:52:11 2007
Subject: [Slony1-general] How to pass parameters to a slonik script?
In-Reply-To: <614CEAAF10695543B87ED664C03A5DB204E9A100@E03MVX1-UKDY.domain1.systemhost.net>
References: <614CEAAF10695543B87ED664C03A5DB204E9A100@E03MVX1-UKDY.domain1.systemhost.net>
Message-ID: <47286C50.80104@in-telegence.net>

> ## Subscribe
> subscribe(){
>     provider=$1
>     subscriber=$2
>     if test ${provider} -eq ${subscriber};then
> 	return
>     fi
>     slonik <<EOF
> include <$conf_file>;
> echo 'Subscribing ${subscriber} to ${provider}';
> subscribe set
> (id=1,provider=$provider,receiver=$subscriber,forward=yes);
> echo 'Done';
> EOF
> }

Okay, this will propably work. Thank you very much.

Regards
Dominik
From cbbrowne at ca.afilias.info  Wed Oct 31 06:35:31 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed Oct 31 06:35:35 2007
Subject: [Slony1-general] How to pass parameters to a slonik script?
In-Reply-To: <47283A96.2030207@in-telegence.net> (Dominik Klein's message of
	"Wed, 31 Oct 2007 09:19:34 +0100")
References: <47283A96.2030207@in-telegence.net>
Message-ID: <60ir4nz9ss.fsf@dba2.int.libertyrms.com>

Dominik Klein <dk@in-telegence.net> writes:
> (how?) is it possible to pass parameters to a slonik script?
>
> Like in a bash script
>
> #!/bin/bash
> echo $1
>
> and then "./script.sh test" would output "test".

Slonik is intentionally a *very* limited language, and it doesn't
itself support variables like that.

But nothing prevents you from using a shell script to generate the
slonik script, and having Bash do the parameter processing.

Thus, something like:

#!/bin/bash
PARM=$1
slonik <<EOF
include <my_standard_preamble.slonik>
### preamble kept out so I don't have to worry about initializing it
echo 'Display parm 1 - ${PARM}';
EOF

Parameter handling was in Bash's hands in that script.

You want a loop, you can have a loop:

#!/bin/bash
PARM=$1

for i in 10 9 8 7 6 5 4 3 2 1; do
  COUNTDOWN="${COUNTDOWN}
  echo 'counting down - ${i}';
"
done

slonik <<EOF
include <my_standard_preamble.slonik>
### preamble kept out so I don't have to worry about initializing it
echo 'Display parm 1 - ${PARM}';
${COUNTDOWN}
EOF

But don't hold your breath on having Slonik enhanced to do this sort
of thing...
-- 
let name="cbbrowne" and tld="cbbrowne.com" in name ^ "@" ^ tld;;
http://cbbrowne.com/info/linuxxian.html
"Being really good at C++ is  like being really good at using rocks to
sharpen sticks."  -- Thant Tessman
From cyril.scetbon at free.fr  Wed Oct 31 09:41:54 2007
From: cyril.scetbon at free.fr (Cyril SCETBON)
Date: Wed Oct 31 09:42:03 2007
Subject: [Slony1-general] Move SET seems not to work properly
Message-ID: <4728B052.30303@free.fr>

Hi,



I get the following configuration :


select * from "_CLUSTER1".sl_subscribe;
sub_set | sub_provider | sub_receiver | sub_forward | sub_active
---------+--------------+--------------+-------------+------------
       1 |            1 |            2 | t           | t
       1 |            1 |            3 | t           | t
       1 |            3 |            4 | t           | t


I used the following slonik script to make node 2 the new provider :


CLUSTER NAME = CLUSTER1;
NODE 1 ADMIN CONNINFO = 'dbname=dbrep host=host1 user=postgres port=5433';
NODE 2 ADMIN CONNINFO = 'dbname=dbrep host=host2 user=postgres port=5434';
NODE 3 ADMIN CONNINFO = 'dbname=dbrep host=host3 user=postgres port=5435';
NODE 4 ADMIN CONNINFO = 'dbname=dbrep host=host4 user=postgres port=5436';
LOCK SET (ID = 1, ORIGIN = 1);
MOVE SET (ID = 1, OLD ORIGIN = 1, NEW ORIGIN = 2);


But the new configuration is :


select * from "_CLUSTER1".sl_subscribe;
sub_set | sub_provider | sub_receiver | sub_forward | sub_active
---------+--------------+--------------+-------------+------------
       1 |            1 |            3 | t           | t
       1 |            3 |            4 | t           | t
       1 |            2 |            1 | t           | t


on nodes 1,2,3 but not on node 3 :


select * from "_CLUSTER1".sl_subscribe;
sub_set | sub_provider | sub_receiver | sub_forward | sub_active
---------+--------------+--------------+-------------+------------
       1 |            1 |            2 | t           | t
       1 |            1 |            3 | t           | t
       1 |            3 |            4 | t           | t


I was thinking that the one node 4 is displaying would be the new
configuration.


On node 3, I see ACCEPT_SET - MOVE_SET or FAILOVER_SET exists -
adjusting setsync status in slon.log, while on node 4, I get ACCEPT_SET
- MOVE_SET or FAILOVER_SET not received yet - sleep



Thanks for you help.


-- 
Cyril SCETBON

From lists at serioustechnology.com  Wed Oct 31 10:57:59 2007
From: lists at serioustechnology.com (Geoffrey)
Date: Wed Oct 31 10:58:13 2007
Subject: [Slony1-general] slony installation
Message-ID: <4728C227.5070600@serioustechnology.com>

We are planning on setting up a single 'master -> slave' configuration 
for disaster recovery.  The master and slave machines will be located in 
different locations.

I'm a bit confused by the documentation:

 From 3.1, At present, Slony-I as well as PostgreSQL need to be able to 
be compiled from source at your site.

Warning in section 4:

If you need Slony-I to do an upgrade from some elderly version of 
PostgreSQL to a newer version, or if you need a late-breaking CVS 
version, outside the context of a major release, then be prepared to 
need to build both PostgreSQL and Slony-I from source. The remainder of 
this section assumes this...

 From 4.7

Even though Slony-I can be compiled and run on most Linux distributions, 
it is also possible to install Slony-I using binary packages. Slony 
Global Development Team provides official RPMs and SRPMs for many 
versions or Red Hat ana Fedora Core.

So my question is, is it necessary to compile Slony and/or Postgres for 
this environment?  We are running Postgresql 7.4.18 on Red Hat AS 4.  It 
would be a lot easier if I didn't have to compile Postgresql.

Also, I don't see a reference to how I 'prime' the slave.  That is, is 
there an easy way to get the existing historical data from my master 
machine to the slave?  Will Slony replicate everything at the time it is 
configured and started?

Thanks for any assistance.

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From ajs at crankycanuck.ca  Wed Oct 31 11:13:29 2007
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Wed Oct 31 11:13:49 2007
Subject: [Slony1-general] slony installation
In-Reply-To: <4728C227.5070600@serioustechnology.com>
References: <4728C227.5070600@serioustechnology.com>
Message-ID: <20071031181329.GI23699@crankycanuck.ca>

On Wed, Oct 31, 2007 at 01:57:59PM -0400, Geoffrey wrote:
> 
> So my question is, is it necessary to compile Slony and/or Postgres for 
> this environment?  We are running Postgresql 7.4.18 on Red Hat AS 4.  It 
> would be a lot easier if I didn't have to compile Postgresql.

You shouldn't need to compile PostgreSQL.  You might want to have the
-dev package installed wherever you are going to make your Slony
packages.  Devrim provides RPMs (I think what he's actually supplying
in source RPMs, which you then make into binaries for your system). 
He'll probably respond to this, because I know he catches mail when
it has "RPM" in it.
 
> Also, I don't see a reference to how I 'prime' the slave.  That is, is 
> there an easy way to get the existing historical data from my master 
> machine to the slave?  Will Slony replicate everything at the time it is 
> configured and started?

Yes.  Just copy the schema to the replica.  Don't bother copying all
the data, because it'll all be truncated and re-copied when you
subscribe.

A

-- 
Andrew Sullivan  | ajs@crankycanuck.ca
Users never remark, "Wow, this software may be buggy and hard 
to use, but at least there is a lot of code underneath."
		--Damien Katz
From devrim at CommandPrompt.com  Wed Oct 31 11:18:48 2007
From: devrim at CommandPrompt.com (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Wed Oct 31 11:21:00 2007
Subject: [Slony1-general] slony installation
In-Reply-To: <4728C227.5070600@serioustechnology.com>
References: <4728C227.5070600@serioustechnology.com>
Message-ID: <1193854728.10273.21.camel@laptop.gunduz.org>

SGksCgpPbiBXZWQsIDIwMDctMTAtMzEgYXQgMTM6NTcgLTA0MDAsIEdlb2ZmcmV5IHdyb3RlOgoK
PiBTbyBteSBxdWVzdGlvbiBpcywgaXMgaXQgbmVjZXNzYXJ5IHRvIGNvbXBpbGUgU2xvbnkgYW5k
L29yIFBvc3RncmVzCj4gZm9yICB0aGlzIGVudmlyb25tZW50PyAgV2UgYXJlIHJ1bm5pbmcgUG9z
dGdyZXNxbCA3LjQuMTggb24gUmVkIEhhdCBBUwo+IDQuICBJdCB3b3VsZCBiZSBhIGxvdCBlYXNp
ZXIgaWYgSSBkaWRuJ3QgaGF2ZSB0byBjb21waWxlIFBvc3RncmVzcWwuIAoKWW91IGRvbid0IG5l
ZWQgdG8gY29tcGlsZSBQb3N0Z3JlU1FMLiBKdXN0IGRvd25sb2FkIGFuZCBleHRyYWN0IFNsb255
LUkKdGFyYmFsbCAgZmlyc3QuIFRoZW4gcnVuIHRoZXNlIGFzIHJvb3Q6CgouL2NvbmZpZ3VyZQpt
YWtlIHJwbQoKbWFrZSBycG0gd2lsbCBidWlsZCB5b3UgYW4gUlBNIHRvIHVzZSB3aXRoIHlvdXIg
UG9zdGdyZVNRTCB2ZXJzaW9uIChpbgp5b3VyIGNhc2UgNy40LjE4KS4gSSBjYW5ub3QgcHJvdmlk
ZSBiaW5hcnkgUlBNcywgYmVjYXVzZSBmb3IgZWFjaApSSC9GZWRvcmEgcmVsZWFzZSBhbmQgYXJj
aCwgSSB3aWxsIG5lZWQgdG8gYnVpbGQgUlBNcyBvZiBTbG9ueS1JIGFnYWluc3QKZWFjaCBzdXBw
b3J0ZWQgUG9zdGdyZVNRTCByZWxlYXNlcyA6KQoKSSBzdWdnZXN0IHlvdSB0byB1c2UgdGhlIHBy
ZXJlbGVhc2UgMiBvZiBsYXRlc3QgdmVyc2lvbiAod2hpY2ggd2lsbApwcm9iYWJseSB0dXJuIHRv
IHN0YWJsZSBzb29uKToKCmh0dHA6Ly9zbG9ueS5pbmZvL2Rvd25sb2Fkcy8xLjIvc291cmNlL3Ns
b255MS0xLjIuMTItcHJlMi50YXIuYnoyCgpUaGlzIHJlbGVhc2UgYWxzbyBpbmNsdWRlcyBhbiBp
bml0IHNjcmlwdC4KClBsZWFzZSBkbyBsZXQgbWUga25vdyBpZiB5b3UgaGF2ZSBwcm9ibGVtcyBi
dWlsZGluZyB0aGUgcGFja2FnZS4KClJlZ2FyZHMsCi0tIApEZXZyaW0gR8OcTkTDnFoKUG9zdGdy
ZVNRTCBSZXBsaWNhdGlvbiwgQ29uc3VsdGluZywgQ3VzdG9tIERldmVsb3BtZW50LCAyNHg3IHN1
cHBvcnQKTWFuYWdlZCBTZXJ2aWNlcywgU2hhcmVkIGFuZCBEZWRpY2F0ZWQgSG9zdGluZwpDby1B
dXRob3JzOiBwbFBIUCwgT0RCQ25nIC0gaHR0cDovL3d3dy5jb21tYW5kcHJvbXB0LmNvbS8KCgot
LS0tLS0tLS0tLS0tLSBuZXh0IHBhcnQgLS0tLS0tLS0tLS0tLS0KQSBub24tdGV4dCBhdHRhY2ht
ZW50IHdhcyBzY3J1YmJlZC4uLgpOYW1lOiBub3QgYXZhaWxhYmxlClR5cGU6IGFwcGxpY2F0aW9u
L3BncC1zaWduYXR1cmUKU2l6ZTogMTg5IGJ5dGVzCkRlc2M6IFRoaXMgaXMgYSBkaWdpdGFsbHkg
c2lnbmVkIG1lc3NhZ2UgcGFydApVcmwgOiBodHRwOi8vbGlzdHMuc2xvbnkuaW5mby9waXBlcm1h
aWwvc2xvbnkxLWdlbmVyYWwvYXR0YWNobWVudHMvMjAwNzEwMzEvYmVmNmI3OTAvYXR0YWNobWVu
dC5wZ3AK
From cbbrowne at ca.afilias.info  Wed Oct 31 11:42:11 2007
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed Oct 31 11:42:22 2007
Subject: [Slony1-general] slony installation
In-Reply-To: <4728C227.5070600@serioustechnology.com> (Geoffrey's message of
	"Wed, 31 Oct 2007 13:57:59 -0400")
References: <4728C227.5070600@serioustechnology.com>
Message-ID: <60ejfbyvlo.fsf@dba2.int.libertyrms.com>

Geoffrey <lists@serioustechnology.com> writes:
> We are planning on setting up a single 'master -> slave' configuration
> for disaster recovery.  The master and slave machines will be located
> in different locations.
>
> I'm a bit confused by the documentation:
>
> From 3.1, At present, Slony-I as well as PostgreSQL need to be able to
> be compiled from source at your site.
>
> Warning in section 4:
>
> If you need Slony-I to do an upgrade from some elderly version of
> PostgreSQL to a newer version, or if you need a late-breaking CVS
> version, outside the context of a major release, then be prepared to
> need to build both PostgreSQL and Slony-I from source. The remainder
> of this section assumes this...

Thanks for pointing that out; I'll modify s3.1, which has become "less
accurate."

> From 4.7
>
> Even though Slony-I can be compiled and run on most Linux
> distributions, it is also possible to install Slony-I using binary
> packages. Slony Global Development Team provides official RPMs and
> SRPMs for many versions or Red Hat ana Fedora Core.
>
> So my question is, is it necessary to compile Slony and/or Postgres
> for this environment?  We are running Postgresql 7.4.18 on Red Hat AS
> 4.  It would be a lot easier if I didn't have to compile Postgresql.

On 7.4, with Slony-I versions newer than 1.1.0, as long as you do have
the "development package(s)" installed, you should be able to avoid
the need to build PostgreSQL from scratch.

If someone doesn't already have a binary Slony-I package for your
PostgreSQL release, then it's likely that you will be stuck compiling
Slony-I...

> Also, I don't see a reference to how I 'prime' the slave.  That is, is
> there an easy way to get the existing historical data from my master
> machine to the slave?  Will Slony replicate everything at the time it
> is configured and started?

The subscription process pulls all data from the "provider" node, so
that yes, it will automatically grab the existing historical data.

You need to "prime" the slave node with the database schema, but the
tables should preferably be left empty, as they will get TRUNCATEd as
part of the subscription process.
-- 
let name="cbbrowne" and tld="linuxfinances.info" in String.concat "@" [name;tld];;
http://linuxdatabases.info/info/multiplexor.html
I have this nagging fear that everyone is out to make me paranoid. 
From devrim at CommandPrompt.com  Wed Oct 31 12:02:09 2007
From: devrim at CommandPrompt.com (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Wed Oct 31 12:04:19 2007
Subject: [Slony1-general] slony installation
In-Reply-To: <1193854728.10273.21.camel@laptop.gunduz.org>
References: <4728C227.5070600@serioustechnology.com>
	<1193854728.10273.21.camel@laptop.gunduz.org>
Message-ID: <1193857329.10273.35.camel@laptop.gunduz.org>

SGksCgpPbiBXZWQsIDIwMDctMTAtMzEgYXQgMTE6MTggLTA3MDAsIERldnJpbSBHw5xORMOcWiB3
cm90ZToKCj4gWW91IGRvbid0IG5lZWQgdG8gY29tcGlsZSBQb3N0Z3JlU1FMLiBKdXN0IGRvd25s
b2FkIGFuZCBleHRyYWN0Cj4gU2xvbnktSSB0YXJiYWxsICBmaXJzdC4gVGhlbiBydW4gdGhlc2Ug
YXMgcm9vdDoKPiAKPiAuL2NvbmZpZ3VyZQo+IG1ha2UgcnBtCgpFcnIuLiBQbGVhc2UgYmVmb3Jl
IHJ1bm5pbmcgY29uZmlndXJlLCBwbGVhc2UgZWRpdApwb3N0Z3Jlc3FsLXNsb255MS1lbmdpbmUu
c3BlYy5pbiBhbmQgc2V0IAoKJXshP2RvY3M6JWRlZmluZSBkb2NzIDF9Cgp0bwoKJXshP2RvY3M6
JWRlZmluZSBkb2NzIDB9CgpzaW5jZSBSSEVMIDQgaGFzIGEgZG9jdW1lbnRlZCBidWcgd2l0aCB0
aGUgTkFNRUxFTiBpc3N1ZXMuCgpSZWdhcmRzLAotLSAKRGV2cmltIEfDnE5Ew5xaClBvc3RncmVT
UUwgUmVwbGljYXRpb24sIENvbnN1bHRpbmcsIEN1c3RvbSBEZXZlbG9wbWVudCwgMjR4NyBzdXBw
b3J0Ck1hbmFnZWQgU2VydmljZXMsIFNoYXJlZCBhbmQgRGVkaWNhdGVkIEhvc3RpbmcKQ28tQXV0
aG9yczogcGxQSFAsIE9EQkNuZyAtIGh0dHA6Ly93d3cuY29tbWFuZHByb21wdC5jb20vCgoKLS0t
LS0tLS0tLS0tLS0gbmV4dCBwYXJ0IC0tLS0tLS0tLS0tLS0tCkEgbm9uLXRleHQgYXR0YWNobWVu
dCB3YXMgc2NydWJiZWQuLi4KTmFtZTogbm90IGF2YWlsYWJsZQpUeXBlOiBhcHBsaWNhdGlvbi9w
Z3Atc2lnbmF0dXJlClNpemU6IDE4OSBieXRlcwpEZXNjOiBUaGlzIGlzIGEgZGlnaXRhbGx5IHNp
Z25lZCBtZXNzYWdlIHBhcnQKVXJsIDogaHR0cDovL2xpc3RzLnNsb255LmluZm8vcGlwZXJtYWls
L3Nsb255MS1nZW5lcmFsL2F0dGFjaG1lbnRzLzIwMDcxMDMxL2YxNTg2NTA0L2F0dGFjaG1lbnQu
cGdwCg==
From andrew.george.hammond at gmail.com  Wed Oct 31 16:09:09 2007
From: andrew.george.hammond at gmail.com (Andrew Hammond)
Date: Wed Oct 31 16:09:23 2007
Subject: [Slony1-general] Newbie questions
In-Reply-To: <47270635.60208@tada.se>
References: <47270635.60208@tada.se>
Message-ID: <5a0a9d6f0710311609p16bc29f4obf2226641ac98c7f@mail.gmail.com>

On 10/30/07, Thomas Hallgren <thomas@tada.se> wrote:
>
> Hi,
> I'm trying to wrap my head around Slony-I and how to use it from an
> application server like JBoss with Hibernate. I'm not clear on the
> relationship between actual connections established by a client and
> nodes in the cluster.
>
> Is it true that any connection that is established is either connected
> to a slave or to the master (origin) for a specific replication set?


Yes.

I.e. there's no node in between that will redirect updates to the master
> for the replication set in question?


pgpool-II may do this for you, but I don't think it's very slony aware. Mind
you, I haven't looked at it in ages. Be aware that doing this (having
middleware balance connections between a replica and the origin) is not as
straight forward as it initially appears.

I'm trying to figure out how to do a controlled switchover and the
> implications of doing that. My appservers can work with two different
> connections if needed but it will be somewhat cumbersome if they need to
> change their settings when I do a switchover. Is there a way to do
> switchover and maintain the connection settings (i.e. host, database,
> credentials)? Ideally, the connections should survive the switch.


I am not aware of any tool that supports this. You're asking a heck of a lot
for a connection to survive that kind of thing. IMHO it is a far superior
approach to design your applications to re-connect automatically.

I'm also looking into automatic switchover in case the master fails for
> some reason. The Heartbeat product seems to be useful for this. Are you
> aware of any examples on how to do this? Any pointer or hint would be
> useful.


heartbeat can do this, and there examples of scripts to fire off a failover.
I suggest that you consider your business needs very carefully before
allowing some process to implement an action which can result in the loss of
committed transactions.

I should also point out that if you're using heartbeat, you will have a
virtual IP which is associated with the database. That IP will migrate
between the two machines depending which is currently the origin. You should
use this IP for client connections to the database, but you must NOT use
this IP for the slons.

Andrew
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20071031/=
db5d932c/attachment.htm
From dane at greatschools.net  Wed Oct 31 22:52:01 2007
From: dane at greatschools.net (Dane Miller)
Date: Wed Oct 31 22:56:18 2007
Subject: [Slony1-general] trace the path of replicated data
Message-ID: <17587634.16921193896321439.JavaMail.root@zimbra.greatschools.net>

Hi Slony folks,

I've been reading docs trying to understand how Slony works.  I've tried to outline below my understanding of how an INSERT into the origin gets replicated to the subscriber.  Do I get the gist of it here?  If not, could someone be so kind as to correct me?  I hope this isn't too much of a newbie question, but I didn't find an answer in the admin guide on slony.info.

Tracing an insert from the origin to a subscriber (2 node cluster)

1. INSERT into the origin
2. AFTER ROW trigger executes logtrigger which inserts into sl_log_{1,2}
3. origin's slon checks sl_log_{1,2}, inserts event into sl_event, generates NOTIFY
4. subscriber receives NOTIFY, inserts event into its sl_event table, inserts confirmation into its local sl_confirm table.
5. subscriber inserts event into origin's sl_confirm table
6. subscriber queries origin's sl_log_{1,2} using event info
7. Subscriber applies result of #6 to its local tables.

whew!  If this has been covered elsewhere, please point me in the right direction.  I got this far by reading Slony-I-concept.pdf, but it seemed to cover more complex setups, and I got a bit lost in the detail.

Thanks,
Dane
