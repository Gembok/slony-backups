From lists at serioustechnology.com  Wed Jan  2 16:22:44 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Wed Jan  2 16:22:56 2008
Subject: [Slony1-general] slon_kill uses signal 9 ??
Message-ID: <477C2AD4.1000800@serioustechnology.com>

I was surprised to see that the slon_kill script uses signal 9 to kill 
the slony daemons.  Is this necessary?

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From jameshtucker at gmail.com  Thu Jan  3 21:38:38 2008
From: jameshtucker at gmail.com (James Tucker)
Date: Thu Jan  3 21:38:50 2008
Subject: [Slony1-general] Re: Slony1-general Digest, Vol 10, Issue 31
In-Reply-To: <20071221200003.C8F0A1484EA@main.slony.info>
References: <20071221200003.C8F0A1484EA@main.slony.info>
Message-ID: <b10d372b0801032138s418d4db0ud09461c9463d279e@mail.gmail.com>

Hi Geoffrey,

I've seen a few responses however not sure that your question has been
answered.  We run a similar configuration, about 10 separate databases all
replicated to a corresponding slave in the DR site.  You need to run a slon
daemon for each node in each cluster, so you'll end up with a lot of slony
processes.  I just created a different .conf file for each db and then to
control them, call them individually using the slon_start script.

i.e.

DB1 =3D /usr/local/slony/db1/db1.conf
DB2 =3D /usr/local/slony/db2/db2.conf

start db1 node 1.
slon_start --config /usr/local/slony/db1/db1.conf 1

start db2 node 1
slon_start --config /usr/local/slony/db2/db2.conf 1

I also use different users for each database to give some separation.  I've
noticed the slon_kill script will kill all the watchdog processes for all
db's if they run as the same user which is another good reason to separate.

Cheers

James


On Dec 22, 2007 6:00 AM, <slony1-general-request@lists.slony.info> wrote:

>
> ----------------------------------------------------------------------
>
> Message: 1
> Date: Fri, 21 Dec 2007 07:39:27 -0500
> From: Geoffrey <lists@serioustechnology.com>
> Subject: [Slony1-general] multiple databases replicated from the same
>        machine
> To: slony <slony1-general@lists.slony.info>
> Message-ID: <476BB3FF.3090804@serioustechnology.com>
> Content-Type: text/plain; charset=3DISO-8859-1; format=3Dflowed
>
> Well, I'm not getting any bites on this issue, so either I'm the first
> person to try this, or I have bad breath.. ;)
>
> Quick question.  Is the slony_tools.conf file only used at
> initialization and startup of the slony processes?  That is, once I've
> got my replication up and running, is the slony_tools.conf file
> referenced again?  The point is, I'm thinking that I can create multiple
> slony_tools.conf files, one for each database.  Link the appropriate one
> during the startup of slony for that database, then move on to the next
> database once that replication is going for the first one.
>
> It appears to me that the slony_tools.conf file is simply a perl module
> that must be referenced by the code, so I'm assuming I can make this
> work, I just don't want to be hacking a bunch of different scripts.
>
> --
> Until later, Geoffrey
>
> Those who would give up essential Liberty, to purchase a little
> temporary Safety, deserve neither Liberty nor Safety.
>  - Benjamin Franklin
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080104/=
1b05730a/attachment.htm
From michael.de.guzman at gmail.com  Fri Jan  4 00:53:01 2008
From: michael.de.guzman at gmail.com (Miguel d Vinci)
Date: Fri Jan  4 00:53:15 2008
Subject: [Slony1-general] Problem with Japanese Characters
Message-ID: <14384536.post@talk.nabble.com>


Hi!  I'm trying to implement Slony 1.2.9 in our system application.  Recently
I have encountered a problem with Japanese characters and I'm stuck.  Please
help.

Here is my platform:
* Postgres 8.1.8
* Slony 1.2.9
* Linux kernel 2.4.32

I have no problem creating slon shema and making the replication work.  I
have a Postgres script file to insert 60,000 records of Japanese characters
into one table.  The script works fine on the Primary Node and everything
(60,000 records) is saved.  However, only about 2,300+ records was
replicated on the Slave node.

Here is the error log:

2007-12-18 14:32:19 UTC DEBUG2 remoteWorkerThread_1_1: current remote
log_status = 0
 2007-12-18 14:32:19 UTC DEBUG2 remoteHelperThread_1_1: 0.058 seconds delay
for first row
 2007-12-18 14:32:19 UTC DEBUG2 remoteHelperThread_1_1: 0.128 seconds until
close cursor
 2007-12-18 14:32:19 UTC DEBUG2 remoteHelperThread_1_1: inserts=118
updates=236 deletes=0
 2007-12-18 14:32:19 UTC ERROR remoteWorkerThread_1: "insert into
"public"."icitem"
(ean,sourceean,instorecode,classcode,departmentcode,subdepartmentcode,itemname,standard,capname,capacity,unitname,unitcap,suppliercode,orderpoint,orderday,packqty,shelfcode,shelflevel,linelevel,stickertype,freedataa,freedatab,freedatac,freedata1,freedata2,freedata3,taxrate,deldate,unitprice,unitpricemem,salesprice,ordprice,promocode,promostartdate,promostarttime,promoenddate,promoendtime,lastprice,costprice,lastupdate,memprice,promotype,orddate,ordqty,delsched,stock,paperprintdate,isinitialized,initctr,promoqty,suppliername)
values ('4562176951037','','','0','5','0','????????????
???','','0','0.00','0','0.00','0','0','','0','','0','0','0','','','','0','0','0','0.00','','0.00','0.00','1757','0','0','','','','','0','0','2007-12-18','0','0','','0','','0','','f','0','0','');
 update only "public"."icdepartment" set ctr='544' where departmentcode='5'
and subdepartmentcode='0' and classcode='0';
 update only "public"."icstats" set allitems='3327' where cd='1';
 insert into "public"."icitem"
(ean,sourceean,instorecode,classcode,departmentcode,subdepartmentcode,itemname,standard,capname,capacity,unitname,unitcap,suppliercode,orderpoint,orderday,packqty,shelfcode,shelflevel,linelevel,stickertype,freedataa,freedatab,freedatac,freedata1,freedata2,freedata3,taxrate,deldate,unitprice,unitpricemem,salesprice,ordprice,promocode,promostartdate,promostarttime,promoenddate,promoendtime,lastprice,costprice,lastupdate,memprice,promotype,orddate,ordqty,delsched,stock,paperprintdate,isinitialized,initctr,promoqty,suppliername)
values ('4901925133025','','','0','4','0','????????
???','','0','0.00','0','0.00','0','0','','0','','0','0','0','','','','0','0','0','0.00','','0.00','0.00','982','0','0','','','','','0','0','2007-12-18','0','0','','0','','0','','f','0','0','');
 update only "public"."icdepartment" set ctr='425' where departmentcode='4'
and subdepartmentcode='0' and classcode='0';
 update only "public"."icstats" set allitems='3328' where cd='1';
 insert into "public"."icitem"
(ean,sourceean,instorecode,classcode,departmentcode,subdepartmentcode,itemname,standard,capname,capacity,unitname,unitcap,suppliercode,orderpoint,orderday,packqty,shelfcode,shelflevel,linelevel,stickertype,freedataa,freedatab,freedatac,freedata1,freedata2,freedata3,taxrate,deldate,unitprice,unitpricemem,salesprice,ordprice,promocode,promostartdate,promostarttime,promoenddate,promoendtime,lastprice,costprice,lastupdate,memprice,promotype,orddate,ordqty,delsched,stock,paperprintdate,isinitialized,initctr,promoqty,suppliername)
values ('4902881407144','','','0','4','0','????????????
???','','0','0.00','0','0.00','0','0','','0','','0','0','0','','','','0','0','0','0.00','','0.00','0.00','6261','0','0','','','','','0','0','2007-12-18','0','0','','0','','0','','f','0','0','');
 update only "public"."icdepartment" set ctr='426' where departmentcode='4'
and subdepartmentcode='0' and classcode='0';
 update only "public"."icstats" set allitems='3329' where cd='1';
 insert into "public"."icitem"
(ean,sourceean,instorecode,classcode,departmentcode,subdepartmentcode,itemname,standard,capname,capacity,unitname,unitcap,suppliercode,orderpoint,orderday,packqty,shelfcode,shelflevel,linelevel,stickertype,freedataa,freedatab,freedatac,freedata1,freedata2,freedata3,taxrate,deldate,unitprice,unitpricemem,salesprice,ordprice,promocode,promostartdate,promostarttime,promoenddate,promoendtime,lastprice,costprice,lastupdate,memprice,promotype,orddate,ordqty,delsched,stock,paperprintdate,isinitialized,initctr,promoqty,suppliername)
values
('4903333035762','','','0','5','0','????????????????????','','0','0.00','0','0.00','0','0','','0','','0','0','0','','','','0','0','0','0.00','','0.00','0.00','6417','0','0','','','','','0','0','2007-12-18','0','0','','0','','0','','f','0','0','');
 " ERROR: unsafe use of \' in a string literal at character 4778
 HINT: Use '' to write quotes in strings. \' is insecure in client-only
encodings.
  - qualification was:
 2007-12-18 14:32:19 UTC ERROR remoteWorkerThread_1: "insert into
"public"."icitem"
(ean,sourceean,instorecode,classcode,departmentcode,subdepartmentcode,itemname,standard,capname,capacity,unitname,unitcap,suppliercode,orderpoint,orderday,packqty,shelfcode,shelflevel,linelevel,stickertype,freedataa,freedatab,freedatac,freedata1,freedata2,freedata3,taxrate,deldate,unitprice,unitpricemem,salesprice,ordprice,promocode,promostartdate,promostarttime,promoenddate,promoendtime,lastprice,costprice,lastupdate,memprice,promotype,orddate,ordqty,delsched,stock,paperprintdate,isinitialized,initctr,promoqty,suppliername)
values ('4562176951037','','','0','5','0','????????????
???','','0','0.00','0','0.00','0','0','','0','','0','0','0','','','','0','0','0','0.00','','0.00','0.00','1757','0','0','','','','','0','0','2007-12-18','0','0','','0','','0','','f','0','0','');
 update only "public"."icdepartment" set ctr='544' where departmentcode='5'
and subdepartmentcode='0' and classcode='0';
 update only "public"."icstats" set allitems='3327' where cd='1';
 insert into "public"."icitem"
(ean,sourceean,instorecode,classcode,departmentcode,subdepartmentcode,itemname,standard,capname,capacity,unitname,unitcap,suppliercode,orderpoint,orderday,packqty,shelfcode,shelflevel,linelevel,stickertype,freedataa,freedatab,freedatac,freedata1,freedata2,freedata3,taxrate,deldate,unitprice,unitpricemem,salesprice,ordprice,promocode,promostartdate,promostarttime,promoenddate,promoendtime,lastprice,costprice,lastupdate,memprice,promotype,orddate,ordqty,delsched,stock,paperprintdate,isinitialized,initctr,promoqty,suppliername)
values ('4901925133025','','','0','4','0','????????
???','','0','0.00','0','0.00','0','0','','0','','0','0','0','','','','0','0','0','0.00','','0.00','0.00','982','0','0','','','','','0','0','2007-12-18','0','0','','0','','0','','f','0','0','');
 update only "public"."icdepartment" set ctr='425' where departmentcode='4'
and subdepartmentcode='0' and classcode='0';
 update only "public"."icstats" set allitems='3328' where cd='1';
 insert into "public"."icitem"
(ean,sourceean,instorecode,classcode,departmentcode,subdepartmentcode,itemname,standard,capname,capacity,unitname,unitcap,suppliercode,orderpoint,orderday,packqty,shelfcode,shelflevel,linelevel,stickertype,freedataa,freedatab,freedatac,freedata1,freedata2,freedata3,taxrate,deldate,unitprice,unitpricemem,salesprice,ordprice,promocode,promostartdate,promostarttime,promoenddate,promoendtime,lastprice,costprice,lastupdate,memprice,promotype,orddate,ordqty,delsched,stock,paperprintdate,isinitialized,initctr,promoqty,suppliername)
values ('4902881407144','','','0','4','0','????????????
???','','0','0.00','0','0.00','0','0','','0','','0','0','0','','','','0','0','0','0.00','','0.00','0.00','6261','0','0','','','','','0','0','2007-12-18','0','0','','0','','0','','f','0','0','');
 update only "public"."icdepartment" set ctr='426' where departmentcode='4'
and subdepartmentcode='0' and classcode='0';
 update only "public"."icstats" set allitems='3329' where cd='1';
 insert into "public"."icitem"
(ean,sourceean,instorecode,classcode,departmentcode,subdepartmentcode,itemname,standard,capname,capacity,unitname,unitcap,suppliercode,orderpoint,orderday,packqty,shelfcode,shelflevel,linelevel,stickertype,freedataa,freedatab,freedatac,freedata1,freedata2,freedata3,taxrate,deldate,unitprice,unitpricemem,salesprice,ordprice,promocode,promostartdate,promostarttime,promoenddate,promoendtime,lastprice,costprice,lastupdate,memprice,promotype,orddate,ordqty,delsched,stock,paperprintdate,isinitialized,initctr,promoqty,suppliername)
values
('4903333035762','','','0','5','0','????????????????????','','0','0.00','0','0.00','0','0','','0','','0','0','0','','','','0','0','0','0.00','','0.00','0.00','6417','0','0','','','','','0','0','2007-12-18','0','0','','0','','0','','f','0','0','');
 " ERROR: current transaction is aborted, commands ignored until end of
transaction block
  - qualification was:
 2007-12-18 14:32:19 UTC ERROR remoteWorkerThread_1: SYNC aborted
 2007-12-18 14:32:20 UTC DEBUG2 syncThread: new sl_action_seq 1 - SYNC 13
 2007-12-18 14:32:21 UTC DEBUG2 remoteListenThread_1: queue event 1,106 SYNC
 2007-12-18 14:32:23 UTC DEBUG2 remoteListenThread_1: queue event 1,107 SYNC
 2007-12-18 14:32:25 UTC DEBUG2 remoteListenThread_1: queue event 1,108 SYNC
 2007-12-18 14:32:26 UTC DEBUG2 localListenThread: Received event 2,13 SYNC

>From this log, the error "ERROR: unsafe use of \' in a string literal at
character 4778
 HINT: Use '' to write quotes in strings. \' is insecure in client-only
encodings." was reflected.  What confuses me is that the Secondary server
has the same database settings with the Primary Server.  Both servers have
database were created with UTF-8 encoding.  CLIENT-ENCODING (in
postgresql.conf) for both servers were set to SJIS.

Another weird part is this:  I dropped slony schema and recreated the
database on the Secondary Server.  I re-created slony and run slon.  After a
few moments, I checked the table in the Secondary Node and everything was
replicated.  So it means that the problem is triggered somewhere during the
actual INSERTing of records.

I'm really stuck with this problem and I would really appreciate it if
someone could tell me how to fix it.

Thanks in advance.

;) Miguel
-- 
View this message in context: http://www.nabble.com/Problem-with-Japanese-Characters-tp14384536p14384536.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.

From marcus.gustafsson at visionten.net  Fri Jan  4 01:49:28 2008
From: marcus.gustafsson at visionten.net (Marcus Gustafsson)
Date: Fri Jan  4 01:49:53 2008
Subject: [Slony1-general] pgpool-II & slony installation question
In-Reply-To: <8d89ea1d0712181121x77d2243cpb13f52b5e8d4ae15@mail.gmail.com>
References: <8d89ea1d0712181121x77d2243cpb13f52b5e8d4ae15@mail.gmail.com>
Message-ID: <477E0128.6020704@visionten.net>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Josh Harrison wrote:
> Hi
> Im currently testing postgres replication with slony and it seems to be
> working fine. I want to install pgpool-II to this set-up for load
> balance and failover detection. Im not sure where to start. Can you
> point me to the right place...website or documentation that illustrates
> this set-up?

I've been doing some digging in the pgpool-II code because we want
exactly what you are talking about and it seems that this is not yet
supported by pgpool-II. When the master (lowest numbered backend) fails
it automatically selects the next backend in the series and uses that as
the master.

I'm working on a patch (which won't be too general as pgpool as of yet
only works on a per connection basis rather than a per set basis, but it
is good enough for us as we only have one set with one master).

I can send you a note when (if) we got a patch for it if you want.

/Marcus
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.5 (MingW32)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFHfgEoZk3kto/xJ1MRAi7hAKDnv03NcEUWYmm+V+qgjGeHLxQuDwCeIAC8
v6luzN/PHHeZInoPIR//3bo=
=X4//
-----END PGP SIGNATURE-----
From cbbrowne at ca.afilias.info  Mon Jan  7 09:43:53 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Mon Jan  7 09:44:00 2008
Subject: [Slony1-general] Proposal: using COPY to pull sl_log_? data to
	subscribers
Message-ID: <60bq7x350m.fsf@dba2.int.libertyrms.com>

I have been looking at this idea for a while, and I *think* it has
enough merit to consider implementing it.

The present way that SYNCs are processed may be outlined thus:

 - slon opens a LOG cursor to the provider that selects the contents
   of sl_log_1/sl_log_2 that are relevant to the SYNC set being
   processed

 - slon fetches 100 entries at a time, leaving out all Large Tuples
   (based on configurable parameter)

 - For each of the 100 entries, the slon generates an
   INSERT/UPDATE/DELETE, and delivers them to the worker process.

   In cases where the tuples were Very Large, those tuples get queried
   individually.

 - If the subscriber is a logging subscriber, we then also insert the
   sl_log_? data into the appropriate sl_log_? table on the subscriber.

I propose a rather different approach, that uses COPY and a stored
procedure.

 - Rather than opening a cursor, we submit a COPY query against the
 provider of the form:

   "COPY (select * from sl_log_1 where [SYNC criteria] union all
          select * from sl_log_2 where [SYNC criteria]) to stdout;"

 - We then set up a "COPY [subscriber's_current_sl_log_? table] from stdin;" 
   on the subscriber.

 - We loop, so long as there is data provided by the first statement, and
   COPY the data to the subscriber node.

 - Once the COPY is complete, we run a stored procedure on the
   subscriber node, telling it the same [SYNC criteria] given above, and
   this stored procedure runs through the data in sl_log_? on the subscriber
   in actionseq order.  For each row, it will:

    - build an insert/update/delete statement
    - execute that statement

I can already see several straightforward improvements and tradeoffs
in this, as compared with what we have now.  (Hopefully none of it
involves overly baroque plans with obvious fatal errors! - see below!)

  1.  Some processing load gets taken off the provider

      The "LOG cursor" query becomes a "COPY [foo] to stdout" query,
      and it's worth noting that we lose the need to have an ORDER BY
      clause, which eliminates a sort.

  2.  Processing load is moved from slon to subscriber DBMS

      The present slon loads sl_log_? tuples into memory, and the C
      code generates the INSERT/UPDATE/DELETE.

      In the proposed method, the stored procedure does that work,
      on the subscriber DBMS.

      An important question: Will that loop lead to grossly excessive
      backend memory usage in cases where Large Tuples are processed?
      (e.g. - where the INSERT statement is inserting a tuple
      consisting of 40MB of data)

  3.  We use COPY to load data onto the subscriber

      There are two very large benefits to this, in that:
       i) COPY should be *WAY* faster than the INSERT presently used;
       ii) We can COPY in specific-sized-buffer chunks, which eliminates
           the somewhat-overly baroque code that tries to limit slon
           memory usage.

      There is a downside: with this approach, we now have no option
      for a subscriber node to NOT be configured to be a provider; all
      nodes now load data into the sl_log_? tables.

   4. The "shape" of lag times, on subscribers, changes somewhat.

      Right now, there is a sort of "linear" behaviour; if a SYNC is
      half-done, then that means that
           - half of the tuples needing updates have been updated;
           - half of the sl_log_? copies have been loaded.

      With the new behaviour, we load all of the data into sl_log_?
      before doing anything about applying changes into the replicated
      tables.

      I'm not sure if this one matters at all.

   5. There is the new potential to untie loading sl_log_? from
      processing it.

      That is, we could, in principle, make those processes
      asynchronous, with separate COMMITs.  

      De-synchronizing log application from log copying adds the
      interesting result that we probably cut down on the potential
      for data loss in case of loss of an origin node.

      Let us suppose, for sake of argument (and I'm making up
      numbers!)  that present processing takes 2.0s per SYNC, and that
      the new approach takes 0.15s to copy sl_log_?, and 1.5s to apply
      sl_log_?.

      Given those (made-up) numbers, the new approach means that that
      SYNC is vulnerable to loss for only 0.15s, rather than the 2.0s
      of the past.

      Further, if we did enough tracking to do this, it ought to be
      possible to set up a replication node which consists *solely* of
      the Slony-I schema.  You'd have a small database whose contents
      would "churn" pretty heavily, but where it would likely all be
      cached.

   6. Replication is applied based on subscriber node configuration

      Thus, you could rename tables on a subscriber-by-subscriber
      basis.

      I think that's more fitting...

There's enough interaction with worker threads that this would
represent a fairly significant code change to Slony-I, and the number
of changes in behaviour warrant community discussion.

My belief is that it's a worthwhile change, even considering the
tradeoffs (notable one being #3 - you can't have "subscribe only"
nodes that don't record sl_log_? data).

Jan has observed that there is something of a "downside" in that we do
*not* gain, in any of this, the ability to use prepared statements (or
similar) against the replicated tables.  He's keen on creating some
new approach where the triggers capture something looking more like
the underlying data structure of the tuple, and where the action, on
the subscriber, involves updating the table down nearer to the
"storage level" deeper inside PostgreSQL.  I'm not sure that's
actually an argument against doing this.
-- 
let name="cbbrowne" and tld="acm.org" in name ^ "@" ^ tld;;
http://www3.sympatico.ca/cbbrowne/
Evil Overlords tend to get overthrown due to overly baroque plans with
obvious fatal  errors.  Follow the  "Rules of the Evil  Overlord," and
you need not fear heroic  opposition, whether that hero be James Bond,
Flash Gordon, or a little hobbit named Frodo.
From ajs at crankycanuck.ca  Tue Jan  8 06:55:49 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Tue Jan  8 06:56:02 2008
Subject: [Slony1-general] Proposal: using COPY to pull sl_log_? data to
	subscribers
In-Reply-To: <60bq7x350m.fsf@dba2.int.libertyrms.com>
References: <60bq7x350m.fsf@dba2.int.libertyrms.com>
Message-ID: <20080108145549.GC23841@crankycanuck.ca>

On Mon, Jan 07, 2008 at 12:43:53PM -0500, Christopher Browne wrote:
> I have been looking at this idea for a while, and I *think* it has
> enough merit to consider implementing it.

[&c.] 

This proposal seems like a good idea to me, but I think particular community
input is needed on a couple areas.

>   1.  Some processing load gets taken off the provider

[. . .]

>   2.  Processing load is moved from slon to subscriber DBMS

What this means, of course, is that load goes down on the origin and up on
every subscriber.  This seems to me to be obviously desirable, but I wonder
if there's anyone who has designed specifically around the load profile of
Slony today, and who will have problems with this new load profile.  Anyone?

>       An important question: Will that loop lead to grossly excessive
>       backend memory usage in cases where Large Tuples are processed?
>       (e.g. - where the INSERT statement is inserting a tuple
>       consisting of 40MB of data)

This is obviously an empirical matter, but I suggest people need to start
thinking very carefully about possible test cases -- particularly unusual
and expensive ones -- now.  The worst effect of this change would be if we
traded load on the origin for lighter load that only works 95% of the time. 
Reliability is, I think, the cardinal value in this system, and everything
else needs to be sacrificed to that.

>       There is a downside: with this approach, we now have no option
>       for a subscriber node to NOT be configured to be a provider; all
>       nodes now load data into the sl_log_? tables.

Does anyone care about this?  It strikes me that the subscribe-only option
is a frill that could be traded away, but if people are dedicated to it, now
would be a good time to speak up.

I like the proposal, but it'd be nice to here widespread agreement on a
change that is a fairly deep architectural one before we go ahead with this
strategy.

A
From lists at serioustechnology.com  Tue Jan  8 07:32:30 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Tue Jan  8 07:32:37 2008
Subject: [Slony1-general] Re: Slony1-general Digest, Vol 10, Issue 31
In-Reply-To: <b10d372b0801032138s418d4db0ud09461c9463d279e@mail.gmail.com>
References: <20071221200003.C8F0A1484EA@main.slony.info>
	<b10d372b0801032138s418d4db0ud09461c9463d279e@mail.gmail.com>
Message-ID: <4783978E.1060707@serioustechnology.com>

James Tucker wrote:
James, thanks for you response, this is likely the path I'll choose as well.

> Hi Geoffrey,
> 
> I've seen a few responses however not sure that your question has been
> answered.  We run a similar configuration, about 10 separate databases all
> replicated to a corresponding slave in the DR site.  You need to run a slon
> daemon for each node in each cluster, so you'll end up with a lot of slony
> processes.  I just created a different .conf file for each db and then to
> control them, call them individually using the slon_start script.
> 
> i.e.
> 
> DB1 = /usr/local/slony/db1/db1.conf
> DB2 = /usr/local/slony/db2/db2.conf
> 
> start db1 node 1.
> slon_start --config /usr/local/slony/db1/db1.conf 1
> 
> start db2 node 1
> slon_start --config /usr/local/slony/db2/db2.conf 1
> 
> I also use different users for each database to give some separation.  I've
> noticed the slon_kill script will kill all the watchdog processes for all
> db's if they run as the same user which is another good reason to separate.
> 
> Cheers
> 
> James
> 
> 
> On Dec 22, 2007 6:00 AM, <slony1-general-request@lists.slony.info> wrote:
> 
>> ----------------------------------------------------------------------
>>
>> Message: 1
>> Date: Fri, 21 Dec 2007 07:39:27 -0500
>> From: Geoffrey <lists@serioustechnology.com>
>> Subject: [Slony1-general] multiple databases replicated from the same
>>        machine
>> To: slony <slony1-general@lists.slony.info>
>> Message-ID: <476BB3FF.3090804@serioustechnology.com>
>> Content-Type: text/plain; charset=ISO-8859-1; format=flowed
>>
>> Well, I'm not getting any bites on this issue, so either I'm the first
>> person to try this, or I have bad breath.. ;)
>>
>> Quick question.  Is the slony_tools.conf file only used at
>> initialization and startup of the slony processes?  That is, once I've
>> got my replication up and running, is the slony_tools.conf file
>> referenced again?  The point is, I'm thinking that I can create multiple
>> slony_tools.conf files, one for each database.  Link the appropriate one
>> during the startup of slony for that database, then move on to the next
>> database once that replication is going for the first one.
>>
>> It appears to me that the slony_tools.conf file is simply a perl module
>> that must be referenced by the code, so I'm assuming I can make this
>> work, I just don't want to be hacking a bunch of different scripts.
>>
>> --
>> Until later, Geoffrey
>>
>> Those who would give up essential Liberty, to purchase a little
>> temporary Safety, deserve neither Liberty nor Safety.
>>  - Benjamin Franklin
>>
>>
>>
>>
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From jameshtucker at gmail.com  Tue Jan  8 18:10:42 2008
From: jameshtucker at gmail.com (James Tucker)
Date: Tue Jan  8 18:10:52 2008
Subject: [Slony1-general] Recompile Slony
Message-ID: <b10d372b0801081810o4d6081e8w8036e857d3c5a3ce@mail.gmail.com>

Hi All,

Just wondering when there is a requirement to recompile slony against new
libraries.  i.e. if I'm upgrading from 8.2.4 to 8.2.6, it's not a major
release, do I need to recompile ?

I don't want to change slony versions, just postgresql versions because of
the recently disclosed vulnerabilities.

Thanks

James
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080109/=
693f2386/attachment.htm
From vostorga at gmail.com  Wed Jan  9 07:22:40 2008
From: vostorga at gmail.com (=?ISO-8859-1?Q?V=EDctor?=)
Date: Wed Jan  9 07:22:43 2008
Subject: [Slony1-general] Recompile Slony
In-Reply-To: <b10d372b0801081810o4d6081e8w8036e857d3c5a3ce@mail.gmail.com>
References: <b10d372b0801081810o4d6081e8w8036e857d3c5a3ce@mail.gmail.com>
Message-ID: <2b391080801090722m4f403e56i3c57639d4b10bb3@mail.gmail.com>

As far as I know, there is no reason to recompile slony If you use the same
slony version in all replication servers.

V=EDctor.

On Jan 8, 2008 8:10 PM, James Tucker <jameshtucker@gmail.com> wrote:

> Hi All,
>
> Just wondering when there is a requirement to recompile slony against new
> libraries.  i.e. if I'm upgrading from 8.2.4 to 8.2.6, it's not a major
> release, do I need to recompile ?
>
> I don't want to change slony versions, just postgresql versions because of
> the recently disclosed vulnerabilities.
>
> Thanks
>
> James
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080109/=
4cba0664/attachment.htm
From glynastill at yahoo.co.uk  Wed Jan  9 07:50:39 2008
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Wed Jan  9 07:50:44 2008
Subject: [Slony1-general] Slony startup scripts
Message-ID: <670557.58365.qm@web25802.mail.ukl.yahoo.com>

Hi people,

Until now I've been starting the slon daemon from the command line,
and now I wan't to move it to a startup script. Looking over things I
see I'm probably going to be best using a slon.conf file now as well.
this leaves me with a few questions.

1) I don't see any parameter in the slon.conf to set where my logs
go. Is this possible or do I just have to pipe the output to a file
like I'm already doing?

2) further to the above, can slony rotate it's logs automatically?
I.e. so I can have a new log file every day?

3) I've had a look athe the supplied script for redhat, although I'm
using Debian so theres going to be a few differences. One of these is
that I've been stopping the slons with "kill <processid>", the redhat
script uses "killproc slon". How can I kill the slon in my script?
read the .pid file?

4)I've jsut discovered the altperl scripts in the docs, and they look
really useful. The docs say to run configure with "--with-perltools"
before compiling and they'll get installed. I didn't do this. can I
install the altperl scripts without a recompile?

Thanks
Glyn


      ___________________________________________________________
Yahoo! Answers - Got a question? Someone out there knows the answer. Try it
now.
http://uk.answers.yahoo.com/ 

From cbbrowne at ca.afilias.info  Wed Jan  9 07:56:00 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed Jan  9 07:56:04 2008
Subject: [Slony1-general] Slony startup scripts
In-Reply-To: <670557.58365.qm@web25802.mail.ukl.yahoo.com> (Glyn Astill's
	message of "Wed, 9 Jan 2008 07:50:39 -0800 (PST)")
References: <670557.58365.qm@web25802.mail.ukl.yahoo.com>
Message-ID: <60ejcryovj.fsf@dba2.int.libertyrms.com>

Glyn Astill <glynastill@yahoo.co.uk> writes:
> Until now I've been starting the slon daemon from the command line,
> and now I wan't to move it to a startup script. Looking over things I
> see I'm probably going to be best using a slon.conf file now as well.
> this leaves me with a few questions.
>
> 1) I don't see any parameter in the slon.conf to set where my logs
> go. Is this possible or do I just have to pipe the output to a file
> like I'm already doing?

slon makes no attempt to redirect output; you capture it as you like.

> 2) further to the above, can slony rotate it's logs automatically?
> I.e. so I can have a new log file every day?

There are numerous tools for this purpose that are generic to all
kinds of log files; no point in having Slony-I duplicate this kind of
functionality.

> 3) I've had a look athe the supplied script for redhat, although I'm
> using Debian so theres going to be a few differences. One of these is
> that I've been stopping the slons with "kill <processid>", the redhat
> script uses "killproc slon". How can I kill the slon in my script?
> read the .pid file?

Yes, that's the reason for capturing the PID in that file.

> 4)I've jsut discovered the altperl scripts in the docs, and they look
> really useful. The docs say to run configure with "--with-perltools"
> before compiling and they'll get installed. I didn't do this. can I
> install the altperl scripts without a recompile?

You'll need to rerun "configure", but that doesn't force you to do a
recompile of anything in /src/...
-- 
(reverse (concatenate 'string "moc.enworbbc" "@" "enworbbc"))
http://linuxfinances.info/info/sgml.html
"Everything should  be made as  simple as possible, but  not simpler."
-- Albert Einstein
From glynastill at yahoo.co.uk  Wed Jan  9 09:23:28 2008
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Wed Jan  9 09:23:40 2008
Subject: [Slony1-general] Slony startup scripts
In-Reply-To: <60ejcryovj.fsf@dba2.int.libertyrms.com>
Message-ID: <472201.45434.qm@web25803.mail.ukl.yahoo.com>

Hi Chris,

Thanks for the info.

I seem to be struggling using the conf file, I did

/usr/local/pgsql/bin/slon -f /data/postgres/slon.conf
>/data/postgres/slon.log 2>&1 &

I've specified the connection string and cluster in the conf file. Am
I missing something here?

Glyn

--- Christopher Browne <cbbrowne@ca.afilias.info> wrote:

> Glyn Astill <glynastill@yahoo.co.uk> writes:
> > Until now I've been starting the slon daemon from the command
> line,
> > and now I wan't to move it to a startup script. Looking over
> things I
> > see I'm probably going to be best using a slon.conf file now as
> well.
> > this leaves me with a few questions.
> >
> > 1) I don't see any parameter in the slon.conf to set where my
> logs
> > go. Is this possible or do I just have to pipe the output to a
> file
> > like I'm already doing?
> 
> slon makes no attempt to redirect output; you capture it as you
> like.
> 
> > 2) further to the above, can slony rotate it's logs
> automatically?
> > I.e. so I can have a new log file every day?
> 
> There are numerous tools for this purpose that are generic to all
> kinds of log files; no point in having Slony-I duplicate this kind
> of
> functionality.
> 
> > 3) I've had a look athe the supplied script for redhat, although
> I'm
> > using Debian so theres going to be a few differences. One of
> these is
> > that I've been stopping the slons with "kill <processid>", the
> redhat
> > script uses "killproc slon". How can I kill the slon in my
> script?
> > read the .pid file?
> 
> Yes, that's the reason for capturing the PID in that file.
> 
> > 4)I've jsut discovered the altperl scripts in the docs, and they
> look
> > really useful. The docs say to run configure with
> "--with-perltools"
> > before compiling and they'll get installed. I didn't do this. can
> I
> > install the altperl scripts without a recompile?
> 
> You'll need to rerun "configure", but that doesn't force you to do
> a
> recompile of anything in /src/...
> -- 
> (reverse (concatenate 'string "moc.enworbbc" "@" "enworbbc"))
> http://linuxfinances.info/info/sgml.html
> "Everything should  be made as  simple as possible, but  not
> simpler."
> -- Albert Einstein
> 



Glyn Astill



      __________________________________________________________
Sent from Yahoo! Mail - a smarter inbox http://uk.mail.yahoo.com


From dba at richyen.com  Wed Jan  9 09:28:56 2008
From: dba at richyen.com (Richard Yen)
Date: Wed Jan  9 09:29:03 2008
Subject: [Slony1-general] Lag times/events increasing as time passes
Message-ID: <6809E5C1-F6B3-43D6-AA6C-B3AA88777F26@richyen.com>

Hi All,

I've got a monitor running on my Slony cluster, and it notifies me  
when lag_num_events and/or lag_time exceeds a particular threshold.   
For the purposes of business requirements, I've set the threshold to  
10 seconds and 20 events, with a sync_time of 500ms in my conf file.   
With time, the frequency of the notifications of lag have increased.   
Consequently, I was able to convince the authorities to let me  
increase the thresholds to 30 seconds and 60 events.  More time passed  
(months), and now I'm getting pages again.

Is there a known bloating issue with slony and its lag times?  If so,  
how can we un-bloat?

Thanks!
--Richard
From glynastill at yahoo.co.uk  Wed Jan  9 10:25:51 2008
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Wed Jan  9 10:25:59 2008
Subject: [Slony1-general] Slony startup scripts
In-Reply-To: <472201.45434.qm@web25803.mail.ukl.yahoo.com>
Message-ID: <481076.54080.qm@web25812.mail.ukl.yahoo.com>

I now get the following error:

Way5b:/data/postgres# /etc/init.d/slony start
Starting Slon: Starting /usr/local/pgsql/bin/slon...
2008-01-09 18:21:03 GMT ERROR  could not open configuration file
"/data/postgres/slon.conf"
2008-01-09 18:21:03 GMT CONFIG main: slon version 1.2.12 starting up

The file is there, is owned by postgres with read write permissions.

Any ideas

--- Glyn Astill <glynastill@yahoo.co.uk> wrote:

> Hi Chris,
> 
> Thanks for the info.
> 
> I seem to be struggling using the conf file, I did
> 
> /usr/local/pgsql/bin/slon -f /data/postgres/slon.conf
> >/data/postgres/slon.log 2>&1 &
> 
> I've specified the connection string and cluster in the conf file.
> Am
> I missing something here?
> 
> Glyn
> 
> --- Christopher Browne <cbbrowne@ca.afilias.info> wrote:
> 
> > Glyn Astill <glynastill@yahoo.co.uk> writes:
> > > Until now I've been starting the slon daemon from the command
> > line,
> > > and now I wan't to move it to a startup script. Looking over
> > things I
> > > see I'm probably going to be best using a slon.conf file now as
> > well.
> > > this leaves me with a few questions.
> > >
> > > 1) I don't see any parameter in the slon.conf to set where my
> > logs
> > > go. Is this possible or do I just have to pipe the output to a
> > file
> > > like I'm already doing?
> > 
> > slon makes no attempt to redirect output; you capture it as you
> > like.
> > 
> > > 2) further to the above, can slony rotate it's logs
> > automatically?
> > > I.e. so I can have a new log file every day?
> > 
> > There are numerous tools for this purpose that are generic to all
> > kinds of log files; no point in having Slony-I duplicate this
> kind
> > of
> > functionality.
> > 
> > > 3) I've had a look athe the supplied script for redhat,
> although
> > I'm
> > > using Debian so theres going to be a few differences. One of
> > these is
> > > that I've been stopping the slons with "kill <processid>", the
> > redhat
> > > script uses "killproc slon". How can I kill the slon in my
> > script?
> > > read the .pid file?
> > 
> > Yes, that's the reason for capturing the PID in that file.
> > 
> > > 4)I've jsut discovered the altperl scripts in the docs, and
> they
> > look
> > > really useful. The docs say to run configure with
> > "--with-perltools"
> > > before compiling and they'll get installed. I didn't do this.
> can
> > I
> > > install the altperl scripts without a recompile?
> > 
> > You'll need to rerun "configure", but that doesn't force you to
> do
> > a
> > recompile of anything in /src/...
> > -- 
> > (reverse (concatenate 'string "moc.enworbbc" "@" "enworbbc"))
> > http://linuxfinances.info/info/sgml.html
> > "Everything should  be made as  simple as possible, but  not
> > simpler."
> > -- Albert Einstein
> > 
> 
> 
> 
> Glyn Astill
> 
> 
> 
>       __________________________________________________________
> Sent from Yahoo! Mail - a smarter inbox http://uk.mail.yahoo.com
> 
> 
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
> 



      __________________________________________________________
Sent from Yahoo! Mail - a smarter inbox http://uk.mail.yahoo.com

From cbbrowne at ca.afilias.info  Wed Jan  9 10:49:06 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed Jan  9 10:49:12 2008
Subject: [Slony1-general] Lag times/events increasing as time passes
In-Reply-To: <6809E5C1-F6B3-43D6-AA6C-B3AA88777F26@richyen.com> (Richard Yen's
	message of "Wed, 9 Jan 2008 09:28:56 -0800")
References: <6809E5C1-F6B3-43D6-AA6C-B3AA88777F26@richyen.com>
Message-ID: <601w8qzvfh.fsf@dba2.int.libertyrms.com>

Richard Yen <dba@richyen.com> writes:
> I've got a monitor running on my Slony cluster, and it notifies me
> when lag_num_events and/or lag_time exceeds a particular threshold.
> For the purposes of business requirements, I've set the threshold to
> 10 seconds and 20 events, with a sync_time of 500ms in my conf file.
> With time, the frequency of the notifications of lag have increased.
> Consequently, I was able to convince the authorities to let me
> increase the thresholds to 30 seconds and 60 events.  More time passed
> (months), and now I'm getting pages again.
>
> Is there a known bloating issue with slony and its lag times?  If so,
> how can we un-bloat?

Well, I'd start by running a VACUUM VERBOSE against the Slony-I
tables.

Thus...

PGDATABASE=something
PGPORT=something
PGUSER=suitable
CLUSTER=foo
export CLUSTER
TABLES="sl_archive_counter sl_config_lock sl_confirm sl_event
sl_listen sl_log_1 sl_log_2 sl_node sl_nodelock sl_path sl_registry
sl_seqlog sl_sequence sl_set sl_setsync sl_subscribe sl_table"
export TABLES
for table in `echo ${TABLES}`; do
   vacuumdb -t "\"_${CLUSTER}\".${table}" -v
done

And see if there's some table that has grown precipitously.  If you're
on Slony-I 1.2, then sl_log_1 and sl_log_2 should periodically be
getting truncated, so they oughtn't be a problem.

I could see there being growth of sl_seqlog, if you have a lot of
sequences, but that shouldn't cause the problem you are describing.

You might find a table deserving a reindex.  It would be useful to see
the stats, if that's the case.
-- 
(reverse (concatenate 'string "ofni.secnanifxunil" "@" "enworbbc"))
http://cbbrowne.com/info/internet.html
Rules  of the  Evil Overlord  #41. "Once  my power  is secure,  I will
destroy all those pesky time-travel devices."
<http://www.eviloverlord.com/>
From cbbrowne at ca.afilias.info  Wed Jan  9 10:51:48 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed Jan  9 10:51:55 2008
Subject: [Slony1-general] Slony startup scripts
In-Reply-To: <481076.54080.qm@web25812.mail.ukl.yahoo.com> (Glyn Astill's
	message of "Wed, 9 Jan 2008 10:25:51 -0800 (PST)")
References: <481076.54080.qm@web25812.mail.ukl.yahoo.com>
Message-ID: <60wsqiygqj.fsf@dba2.int.libertyrms.com>

Glyn Astill <glynastill@yahoo.co.uk> writes:
> I now get the following error:
>
> Way5b:/data/postgres# /etc/init.d/slony start
> Starting Slon: Starting /usr/local/pgsql/bin/slon...
> 2008-01-09 18:21:03 GMT ERROR  could not open configuration file
> "/data/postgres/slon.conf"
> 2008-01-09 18:21:03 GMT CONFIG main: slon version 1.2.12 starting up
>
> The file is there, is owned by postgres with read write permissions.
>
> Any ideas

Run strace against it to see if it says anything interesting?

e.g. - run:

% strace /path/to/slon -f /data/postgres/slon.conf > /tmp/output.log 2> /tmp/output.err

and then look through the trace to see what system calls failed
-- 
let name="cbbrowne" and tld="acm.org" in String.concat "@" [name;tld];;
http://cbbrowne.com/info/linuxdistributions.html
"It's like  a house   of cards  that   Godzilla  has  been  blundering
through."  -- Moon, describing how system messages work on ITS
From glynastill at yahoo.co.uk  Wed Jan  9 10:55:50 2008
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Wed Jan  9 10:55:57 2008
Subject: [Slony1-general] Slony startup scripts
In-Reply-To: <60wsqiygqj.fsf@dba2.int.libertyrms.com>
Message-ID: <12499.33237.qm@web25807.mail.ukl.yahoo.com>

Hi Chris,

If I do "/usr/local/pgsql/bin/slon -f /data/postgres/slon.conf" at in
the terminal it works, however it does not from the startup script.

Will try strace now...

--- Christopher Browne <cbbrowne@ca.afilias.info> wrote:

> Glyn Astill <glynastill@yahoo.co.uk> writes:
> > I now get the following error:
> >
> > Way5b:/data/postgres# /etc/init.d/slony start
> > Starting Slon: Starting /usr/local/pgsql/bin/slon...
> > 2008-01-09 18:21:03 GMT ERROR  could not open configuration file
> > "/data/postgres/slon.conf"
> > 2008-01-09 18:21:03 GMT CONFIG main: slon version 1.2.12 starting
> up
> >
> > The file is there, is owned by postgres with read write
> permissions.
> >
> > Any ideas
> 
> Run strace against it to see if it says anything interesting?
> 
> e.g. - run:
> 
> % strace /path/to/slon -f /data/postgres/slon.conf >
> /tmp/output.log 2> /tmp/output.err
> 
> and then look through the trace to see what system calls failed
> -- 
> let name="cbbrowne" and tld="acm.org" in String.concat "@"
> [name;tld];;
> http://cbbrowne.com/info/linuxdistributions.html
> "It's like  a house   of cards  that   Godzilla  has  been 
> blundering
> through."  -- Moon, describing how system messages work on ITS
> 



      __________________________________________________________
Sent from Yahoo! Mail - a smarter inbox http://uk.mail.yahoo.com


From cbbrowne at ca.afilias.info  Wed Jan  9 11:00:13 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed Jan  9 11:00:18 2008
Subject: [Slony1-general] Slony startup scripts
In-Reply-To: <12499.33237.qm@web25807.mail.ukl.yahoo.com> (Glyn Astill's
	message of "Wed, 9 Jan 2008 10:55:50 -0800 (PST)")
References: <12499.33237.qm@web25807.mail.ukl.yahoo.com>
Message-ID: <60sl16ygci.fsf@dba2.int.libertyrms.com>

Glyn Astill <glynastill@yahoo.co.uk> writes:
> Hi Chris,
>
> If I do "/usr/local/pgsql/bin/slon -f /data/postgres/slon.conf" at in
> the terminal it works, however it does not from the startup script.
>
> Will try strace now...

Hmm.

I assume you're specifying full path names in the startup script, so
it's not running afoul of (say) having $PATH defined differently.

The only other thing that comes to mind is that sometimes ulimit
settings differ when running init as compared to a user shell.  But I
can't think of what resource the system would decline to give because
of this; usually the problem is along the lines of getting
insufficient memory space, but that doesn't seem like the problem
you're having.
-- 
(reverse (concatenate 'string "moc.enworbbc" "@" "enworbbc"))
http://www3.sympatico.ca/cbbrowne/languages.html
Rules  of  the Evil  Overlord  #93.  "If I  decide  to  hold a  double
execution of  the hero and an  underling who failed or  betrayed me, I
will  see   to  it   that  the  hero   is  scheduled  to   go  first."
<http://www.eviloverlord.com/>
From glynastill at yahoo.co.uk  Wed Jan  9 11:01:16 2008
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Wed Jan  9 11:01:23 2008
Subject: [Slony1-general] Slony startup scripts
In-Reply-To: <60wsqiygqj.fsf@dba2.int.libertyrms.com>
Message-ID: <52691.46555.qm@web25808.mail.ukl.yahoo.com>

Actually.. How do I run strace from with my start script?


I'm basically doing:

prefix=/usr/local/pgsql
PGDATA="/data/postgres"
PGUSER="slony"
SLONLOG="$PGDATA/slon.log"
SLONCONF="-f $PGDATA/slon.conf"
SLONPID=="$PGDATA/slon.pid"
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
DAEMON="$prefix/bin/slon"

start-stop-daemon --start --verbose --pidfile $SLONPID --chuid
$PGUSER --exec $DAEMON -- $SLONCONF 

--- Christopher Browne <cbbrowne@ca.afilias.info> wrote:

> Glyn Astill <glynastill@yahoo.co.uk> writes:
> > I now get the following error:
> >
> > Way5b:/data/postgres# /etc/init.d/slony start
> > Starting Slon: Starting /usr/local/pgsql/bin/slon...
> > 2008-01-09 18:21:03 GMT ERROR  could not open configuration file
> > "/data/postgres/slon.conf"
> > 2008-01-09 18:21:03 GMT CONFIG main: slon version 1.2.12 starting
> up
> >
> > The file is there, is owned by postgres with read write
> permissions.
> >
> > Any ideas
> 
> Run strace against it to see if it says anything interesting?
> 
> e.g. - run:
> 
> % strace /path/to/slon -f /data/postgres/slon.conf >
> /tmp/output.log 2> /tmp/output.err
> 
> and then look through the trace to see what system calls failed
> -- 
> let name="cbbrowne" and tld="acm.org" in String.concat "@"
> [name;tld];;
> http://cbbrowne.com/info/linuxdistributions.html
> "It's like  a house   of cards  that   Godzilla  has  been 
> blundering
> through."  -- Moon, describing how system messages work on ITS
> 



      ___________________________________________________________
Support the World Aids Awareness campaign this month with Yahoo! For Good http://uk.promotions.yahoo.com/forgood/

From cbbrowne at ca.afilias.info  Wed Jan  9 11:27:21 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed Jan  9 11:27:28 2008
Subject: [Slony1-general] Slony startup scripts
In-Reply-To: <52691.46555.qm@web25808.mail.ukl.yahoo.com> (Glyn Astill's
	message of "Wed, 9 Jan 2008 11:01:16 -0800 (PST)")
References: <52691.46555.qm@web25808.mail.ukl.yahoo.com>
Message-ID: <60odbuyf3a.fsf@dba2.int.libertyrms.com>

Glyn Astill <glynastill@yahoo.co.uk> writes:
> Actually.. How do I run strace from with my start script?
>
>
> I'm basically doing:
>
> prefix=/usr/local/pgsql
> PGDATA="/data/postgres"
> PGUSER="slony"
> SLONLOG="$PGDATA/slon.log"
> SLONCONF="-f $PGDATA/slon.conf"
> SLONPID=="$PGDATA/slon.pid"
> PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
> DAEMON="$prefix/bin/slon"
>
> start-stop-daemon --start --verbose --pidfile $SLONPID --chuid
> $PGUSER --exec $DAEMON -- $SLONCONF 

Actually, I think I now see the problem, at least partly.

I expect that "start-stop-daemon" isn't invoking slon the way it
expects to be invoked.

start-stop-daemon is presumably a function with a bunch of parameters
which then assembles a command line to use to invoke a daemon program.

I'll bet that it *isn't* assembling something looking like:

   /usr/local/pgsql/bin/slon -f /data/postgres/slon.conf

I don't know what it *is* building, but I can only assume that it's
NOT that (and I'm pretty sure I'm right ;-)).

It may be assembling something like:

   /usr/local/pgsql/bin/slon -- -f /data/postgres/slon.conf

(though that is simply a wild guess)

I haven't tried to "seriously daemonize" the slon; it *isn't* a daemon
in the sense of automatically throwing itself into the background, so
I haven't tried to use tools that expect to work with true daemons.
-- 
let name="cbbrowne" and tld="acm.org" in String.concat "@" [name;tld];;
http://www3.sympatico.ca/cbbrowne/linux.html
Why are men like blenders?
You need one, but you're not quite sure why. 
From glynastill at yahoo.co.uk  Wed Jan  9 16:51:33 2008
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Wed Jan  9 16:51:44 2008
Subject: [Slony1-general] Slony startup scripts
In-Reply-To: <60odbuyf3a.fsf@dba2.int.libertyrms.com>
Message-ID: <677758.77003.qm@web25801.mail.ukl.yahoo.com>

Hi Chris,

In that case I shall take a look at putting together a script that
doesn't use the start-stop-daemon. The reason I did use it is I'm
really a novice when it comes to scripts and couldn't think how to
get the PID out of the file easily to do the kill part.

I'll tackle it again in the morning, if you have any ideas then I'd
be greatful.

Thanks
Glyn
 
--- Christopher Browne <cbbrowne@ca.afilias.info> wrote:

> Glyn Astill <glynastill@yahoo.co.uk> writes:
> > Actually.. How do I run strace from with my start script?
> >
> >
> > I'm basically doing:
> >
> > prefix=/usr/local/pgsql
> > PGDATA="/data/postgres"
> > PGUSER="slony"
> > SLONLOG="$PGDATA/slon.log"
> > SLONCONF="-f $PGDATA/slon.conf"
> > SLONPID=="$PGDATA/slon.pid"
> > PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
> > DAEMON="$prefix/bin/slon"
> >
> > start-stop-daemon --start --verbose --pidfile $SLONPID --chuid
> > $PGUSER --exec $DAEMON -- $SLONCONF 
> 
> Actually, I think I now see the problem, at least partly.
> 
> I expect that "start-stop-daemon" isn't invoking slon the way it
> expects to be invoked.
> 
> start-stop-daemon is presumably a function with a bunch of
> parameters
> which then assembles a command line to use to invoke a daemon
> program.
> 
> I'll bet that it *isn't* assembling something looking like:
> 
>    /usr/local/pgsql/bin/slon -f /data/postgres/slon.conf
> 
> I don't know what it *is* building, but I can only assume that it's
> NOT that (and I'm pretty sure I'm right ;-)).
> 
> It may be assembling something like:
> 
>    /usr/local/pgsql/bin/slon -- -f /data/postgres/slon.conf
> 
> (though that is simply a wild guess)
> 
> I haven't tried to "seriously daemonize" the slon; it *isn't* a
> daemon
> in the sense of automatically throwing itself into the background,
> so
> I haven't tried to use tools that expect to work with true daemons.
> -- 
> let name="cbbrowne" and tld="acm.org" in String.concat "@"
> [name;tld];;
> http://www3.sympatico.ca/cbbrowne/linux.html
> Why are men like blenders?
> You need one, but you're not quite sure why. 
> 



      __________________________________________________________
Sent from Yahoo! Mail - a smarter inbox http://uk.mail.yahoo.com


From drees76 at gmail.com  Wed Jan  9 22:59:34 2008
From: drees76 at gmail.com (David Rees)
Date: Wed Jan  9 22:59:47 2008
Subject: [Slony1-general] Recompile Slony
In-Reply-To: <b10d372b0801081810o4d6081e8w8036e857d3c5a3ce@mail.gmail.com>
References: <b10d372b0801081810o4d6081e8w8036e857d3c5a3ce@mail.gmail.com>
Message-ID: <72dbd3150801092259r4d1807ffua0da32a1e5b16019@mail.gmail.com>

On Jan 8, 2008 6:10 PM, James Tucker <jameshtucker@gmail.com> wrote:
> Just wondering when there is a requirement to recompile slony against new
> libraries.  i.e. if I'm upgrading from 8.2.4 to 8.2.6, it's not a major
> release, do I need to recompile ?
>
> I don't want to change slony versions, just postgresql versions because of
> the recently disclosed vulnerabilities.

For minor releases/updates of Postgres, you should not need to recompile Slony.

-Dave
From marcus.gustafsson at visionten.net  Thu Jan 10 02:23:08 2008
From: marcus.gustafsson at visionten.net (Marcus Gustafsson)
Date: Thu Jan 10 02:23:33 2008
Subject: [Slony1-general] Slonik segfaulting.
Message-ID: <4785F20C.1090608@visionten.net>

Hi all!

Are there any known issues with the slony RPM
postgresql-slony1-engine-1.1.5-1_PG8.1.4.i686.rpm?

I have a small slony cluster where I removed node 1 for reinstallation,
but when I try to reinsert it (as a new node) with:

cluster name = MyCluster;
node 2 admin conninfo = 'dbname=mycluster host=db2.internal user=slony
password=secret';
node 3 admin conninfo = 'dbname=mycluster host=db3.internal user=slony
password=secret';
node 4 admin conninfo = 'dbname=mycluster host=db1.internal user=slony
password=secret';
store node(id=4, event node=2);

slonik crashes with a segmentation fault.
GDB gives me a backtrace which looks like this:

#0  0x0804ed5a in slon_appendquery_int ()
#1  0x0804f047 in slon_mkquery ()
#2  0x0804cf31 in slonik_store_node ()
#3  0x0804e8dd in script_exec_stmts ()
#4  0x0804ea41 in script_exec ()
#5  0x0804ebed in main ()

I'll obviously keep debugging, but before I jump headfirst in the code
someone else might have an idea of what is wrong?

/Marcus
From glynastill at yahoo.co.uk  Thu Jan 10 04:40:41 2008
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Thu Jan 10 04:41:00 2008
Subject: [Slony1-general] Slony startup scripts
In-Reply-To: <60odbuyf3a.fsf@dba2.int.libertyrms.com>
Message-ID: <69062.47809.qm@web25804.mail.ukl.yahoo.com>

Hi Chris,

It seems it may not be the start-stop-daemon afterall. I changed my
script to not use it and just start via su. 

E.g. I have this:

su - $PGUSER -c "$SLONDAEMON -f $SLONCONF &" >> "$SLONLOG" 2>&1 <
/dev/null
echo "su - $PGUSER -c '$SLONDAEMON -f $SLONCONF &' >> "$SLONLOG" 2>&1
< /dev/null"

And it echos to the screen the following

su - slony -c '/usr/local/pgsql/bin/slon -f /data/postgres/slon.conf'
>> /data/postgres/
slon.log 2>&1 < /dev/null

Does that look wrong?

Either way, I end up with the following in my log file:

2008-01-10 12:34:59 GMT ERROR  could not open configuration file
"/data/postgres/slon.conf"
2008-01-10 12:34:59 GMT CONFIG main: slon version 1.2.12 starting up
usage: /usr/local/pgsql/bin/slon [options] clustername conninfo

And slon.conf is there:

-rwxrw-rw- 1 slony slony 4513 2008-01-09 17:55
/data/postgres/slon.conf



--- Christopher Browne <cbbrowne@ca.afilias.info> wrote:

> Glyn Astill <glynastill@yahoo.co.uk> writes:
> > Actually.. How do I run strace from with my start script?
> >
> >
> > I'm basically doing:
> >
> > prefix=/usr/local/pgsql
> > PGDATA="/data/postgres"
> > PGUSER="slony"
> > SLONLOG="$PGDATA/slon.log"
> > SLONCONF="-f $PGDATA/slon.conf"
> > SLONPID=="$PGDATA/slon.pid"
> > PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
> > DAEMON="$prefix/bin/slon"
> >
> > start-stop-daemon --start --verbose --pidfile $SLONPID --chuid
> > $PGUSER --exec $DAEMON -- $SLONCONF 
> 
> Actually, I think I now see the problem, at least partly.
> 
> I expect that "start-stop-daemon" isn't invoking slon the way it
> expects to be invoked.
> 
> start-stop-daemon is presumably a function with a bunch of
> parameters
> which then assembles a command line to use to invoke a daemon
> program.
> 
> I'll bet that it *isn't* assembling something looking like:
> 
>    /usr/local/pgsql/bin/slon -f /data/postgres/slon.conf
> 
> I don't know what it *is* building, but I can only assume that it's
> NOT that (and I'm pretty sure I'm right ;-)).
> 
> It may be assembling something like:
> 
>    /usr/local/pgsql/bin/slon -- -f /data/postgres/slon.conf
> 
> (though that is simply a wild guess)
> 
> I haven't tried to "seriously daemonize" the slon; it *isn't* a
> daemon
> in the sense of automatically throwing itself into the background,
> so
> I haven't tried to use tools that expect to work with true daemons.
> -- 
> let name="cbbrowne" and tld="acm.org" in String.concat "@"
> [name;tld];;
> http://www3.sympatico.ca/cbbrowne/linux.html
> Why are men like blenders?
> You need one, but you're not quite sure why. 
> 



      ___________________________________________________________
Yahoo! Answers - Got a question? Someone out there knows the answer. Try it
now.
http://uk.answers.yahoo.com/ 

From glynastill at yahoo.co.uk  Thu Jan 10 05:53:45 2008
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Thu Jan 10 05:53:50 2008
Subject: [Slony1-general] Slony startup scripts
In-Reply-To: <69062.47809.qm@web25804.mail.ukl.yahoo.com>
Message-ID: <901511.9934.qm@web25813.mail.ukl.yahoo.com>

Solved. It was permissions; I think I'd been staring at my monitor
too long.

I'm not using start-stop-daemon anymore, however I have tested it and
can confirm it works.


--- Glyn Astill <glynastill@yahoo.co.uk> wrote:

> Hi Chris,
> 
> It seems it may not be the start-stop-daemon afterall. I changed my
> script to not use it and just start via su. 
> 
> E.g. I have this:
> 
> su - $PGUSER -c "$SLONDAEMON -f $SLONCONF &" >> "$SLONLOG" 2>&1 <
> /dev/null
> echo "su - $PGUSER -c '$SLONDAEMON -f $SLONCONF &' >> "$SLONLOG"
> 2>&1
> < /dev/null"
> 
> And it echos to the screen the following
> 
> su - slony -c '/usr/local/pgsql/bin/slon -f
> /data/postgres/slon.conf'
> >> /data/postgres/
> slon.log 2>&1 < /dev/null
> 
> Does that look wrong?
> 
> Either way, I end up with the following in my log file:
> 
> 2008-01-10 12:34:59 GMT ERROR  could not open configuration file
> "/data/postgres/slon.conf"
> 2008-01-10 12:34:59 GMT CONFIG main: slon version 1.2.12 starting
> up
> usage: /usr/local/pgsql/bin/slon [options] clustername conninfo
> 
> And slon.conf is there:
> 
> -rwxrw-rw- 1 slony slony 4513 2008-01-09 17:55
> /data/postgres/slon.conf
> 
> 
> 
> --- Christopher Browne <cbbrowne@ca.afilias.info> wrote:
> 
> > Glyn Astill <glynastill@yahoo.co.uk> writes:
> > > Actually.. How do I run strace from with my start script?
> > >
> > >
> > > I'm basically doing:
> > >
> > > prefix=/usr/local/pgsql
> > > PGDATA="/data/postgres"
> > > PGUSER="slony"
> > > SLONLOG="$PGDATA/slon.log"
> > > SLONCONF="-f $PGDATA/slon.conf"
> > > SLONPID=="$PGDATA/slon.pid"
> > >
> PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
> > > DAEMON="$prefix/bin/slon"
> > >
> > > start-stop-daemon --start --verbose --pidfile $SLONPID --chuid
> > > $PGUSER --exec $DAEMON -- $SLONCONF 
> > 
> > Actually, I think I now see the problem, at least partly.
> > 
> > I expect that "start-stop-daemon" isn't invoking slon the way it
> > expects to be invoked.
> > 
> > start-stop-daemon is presumably a function with a bunch of
> > parameters
> > which then assembles a command line to use to invoke a daemon
> > program.
> > 
> > I'll bet that it *isn't* assembling something looking like:
> > 
> >    /usr/local/pgsql/bin/slon -f /data/postgres/slon.conf
> > 
> > I don't know what it *is* building, but I can only assume that
> it's
> > NOT that (and I'm pretty sure I'm right ;-)).
> > 
> > It may be assembling something like:
> > 
> >    /usr/local/pgsql/bin/slon -- -f /data/postgres/slon.conf
> > 
> > (though that is simply a wild guess)
> > 
> > I haven't tried to "seriously daemonize" the slon; it *isn't* a
> > daemon
> > in the sense of automatically throwing itself into the
> background,
> > so
> > I haven't tried to use tools that expect to work with true
> daemons.
> > -- 
> > let name="cbbrowne" and tld="acm.org" in String.concat "@"
> > [name;tld];;
> > http://www3.sympatico.ca/cbbrowne/linux.html
> > Why are men like blenders?
> > You need one, but you're not quite sure why. 
> > 
> 
> 
> 
>       ___________________________________________________________
> Yahoo! Answers - Got a question? Someone out there knows the
> answer. Try it
> now.
> http://uk.answers.yahoo.com/ 
> 
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
> 



      ___________________________________________________________
Yahoo! Answers - Got a question? Someone out there knows the answer. Try it
now.
http://uk.answers.yahoo.com/

From cbbrowne at ca.afilias.info  Thu Jan 10 08:57:20 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Thu Jan 10 08:57:26 2008
Subject: [Slony1-general] Slonik segfaulting.
In-Reply-To: <4785F20C.1090608@visionten.net> (Marcus Gustafsson's message of
	"Thu, 10 Jan 2008 18:23:08 +0800")
References: <4785F20C.1090608@visionten.net>
Message-ID: <60abndy5xr.fsf@dba2.int.libertyrms.com>

Marcus Gustafsson <marcus.gustafsson@visionten.net> writes:
> Hi all!
>
> Are there any known issues with the slony RPM
> postgresql-slony1-engine-1.1.5-1_PG8.1.4.i686.rpm?
>
> I have a small slony cluster where I removed node 1 for reinstallation,
> but when I try to reinsert it (as a new node) with:
>
> cluster name = MyCluster;
> node 2 admin conninfo = 'dbname=mycluster host=db2.internal user=slony
> password=secret';
> node 3 admin conninfo = 'dbname=mycluster host=db3.internal user=slony
> password=secret';
> node 4 admin conninfo = 'dbname=mycluster host=db1.internal user=slony
> password=secret';
> store node(id=4, event node=2);
>
> slonik crashes with a segmentation fault.
> GDB gives me a backtrace which looks like this:
>
> #0  0x0804ed5a in slon_appendquery_int ()
> #1  0x0804f047 in slon_mkquery ()
> #2  0x0804cf31 in slonik_store_node ()
> #3  0x0804e8dd in script_exec_stmts ()
> #4  0x0804ea41 in script_exec ()
> #5  0x0804ebed in main ()
>
> I'll obviously keep debugging, but before I jump headfirst in the code
> someone else might have an idea of what is wrong?

Nothing jumps out at me; this sounds consistent with the notion of
slonik trying to build a query, and finding that one of the components
was NULL.

I don't see anything reported as fixed subsequent to 1.1.5; I vaguely
remember fixing a problem with this in the 1.2 series, but don't see
anything expressly in the release notes.  I would suggest considering
a much newer version of Slony-I; you're on a version that was released
2 years ago, and a great number of bugs have been fixed since.

Looking at the code directly... I notice slon_mkquery() gets called 16
times in slonik_store_node(), and slon_appendquery() gets called 3
times (which may be totally a red herring!).

Does GDB give you any idea as to where it was in slonik_store_node()?
-- 
(format nil "~S@~S" "cbbrowne" "acm.org")
http://linuxdatabases.info/info/x.html
Sex is the mathematics urge sublimated.
-- M. C. Reed.
From g0chman at gmail.com  Thu Jan 10 14:23:42 2008
From: g0chman at gmail.com (=?ISO-8859-1?Q?Jaison_J._Gonz=E1lez_Chaux?=)
Date: Thu Jan 10 14:23:51 2008
Subject: [Slony1-general] Query about Slony-i from Colombia
In-Reply-To: <6d3ad6bd0801101419t2fec75e7r2f0c60876acd185a@mail.gmail.com>
References: <6d3ad6bd0801101410o5b98ab49icbc14e950bcaebde@mail.gmail.com>
	<6d3ad6bd0801101419t2fec75e7r2f0c60876acd185a@mail.gmail.com>
Message-ID: <6d3ad6bd0801101423y53b071adg4f47b0cede917d00@mail.gmail.com>

Hi,

Good evening, my name is Jaison Gonz=E1lez and I am very interested in know=
ing
a bit more about slony-I, I have read some info found on your web about
slony, because I have to install it and make it for academic purposes.

What have I done:

1. Installed postgres 8.2.

2. Installed slony by default on postgres 8.2. (have already proven that it
is working).

3. Created three cluster in different ports.
    I used this:

C:\Archivos de programa\PostgreSQL\8.2\bin>initdb -D "C:\Cluster_3" -U root
-W
  It showed somethings, and assigned the password

C:\Archivos de programa\PostgreSQL\8.2\bin>pg_ctl register -N "PostgresCL_3"
-Uroot -P root -D "C:\Cluster_3"
 Worked out well

C:\Archivos de programa\PostgreSQL\8.2\bin>psql -Uroot -dDB_Cluster_3 -p5437
 Worked out well

4. Assigned the plpgsql language to the databases.

5. Changed the xxid.sql to xxid.v80.sql

6. Tried to configure the cluster name, nodes and stuffs like that, this is
what I put:

cluster name=3DCluster_10;

node 1 admin conninfo =3D 'dbname=3DDB_Cluster_1 host=3D 127.0.0.1 user=3Dr=
oot
password=3Droot port=3D5435';
node 2 admin conninfo =3D 'dbname=3DDB_Cluster_2 host=3D127.0.0.1 user=3Dro=
ot
password=3Droot port=3D5436';
node 3 admin conninfo =3D 'dbname=3DDB_Cluster_3 host=3D127.0.0.1 user=3Dro=
ot
password=3Droot port=3D5437';

init cluster (id=3D1, comment=3D'Nodo maestro');

create set (id=3D1, origin=3D1, comment=3D'aqui van todas mis tablas');

set add table (set id=3D1, origin=3D1, id=3D1, fully qualified name=3D'
public.Personas', comment=3D'tabla de Personas del Cluster_1');
set add table (set id=3D1, origin=3D1, id=3D2, fully qualified name=3D'
public.Personas', comment=3D'tabla de Personas del Cluster_2');
set add table (set id=3D1, origin=3D1, id=3D3, fully qualified name=3D'
public.Personas', comment=3D'tabla de Personas del Cluster_3');

store node (id=3D2, comment=3D'Nodo esclavo Cluster_2');
store node (id=3D3, comment=3D'Nodo esclavo Cluster_3');

store path (server=3D1, client=3D1, conninfo=3D'dbname=3DDB_Cluster_1
host=3D127.0.0.1user=3Droot password=3Droot port=3D5435');
store path (server=3D1, client=3D2, conninfo=3D'dbname=3DDB_Cluster_2
host=3D127.0.0.1user=3Droot password=3Droot port=3D5436');
store path (server=3D1, client=3D3, conninfo=3D'dbname=3DDB_Cluster_3
host=3D127.0.0.1user=3Droot password=3Droot port=3D5437');
   store listen (origin=3D1, provider=3D1, receiver=3D2);
   store listen (origin=3D2, provider=3D2, receiver=3D1);
   store listen (origin=3D3, provider=3D3, receiver=3D1);

If I leave the script like that it says:

C:\Archivos de programa\PostgreSQL\8.2\bin>slonik config.conf

config.conf:37: PGRES_FATAL_ERROR select "_Cluster_11".setAddTable(1, 2, '
public.Personas', 'Personas_pkey', 'tabla de Personas del Cluster_2');  -
ERROR:  duplicate key violates unique constraint "sl_table_tab_reloid_key"

CONTEXTO:  SQL statement "INSERT INTO "_Cluster_11".sl_table (tab_id,
tab_reloid, tab_relname, tab_nspname, tab_set, tab_idxname, tab_altered,
tab_comment) values ( $1 ,  $2 ,  $3 ,  $4 ,  $5 ,  $6 , false,  $7 )"

PL/pgSQL function "setaddtable_int" line 103 at SQL statement

SQL statement "SELECT  "_Cluster_11".setAddTable_int( $1 ,  $2 ,  $3 ,  $4 ,
$5 )"

PL/pgSQL function "setaddtable" line 37 at perform

 And I really dont know what it is, then I put that line on comments [#set
add table (set id=3D1, origin=3D1, id=3D2, fully qualified name=3D'public.P=
ersonas',
comment=3D'tabla de Personas del Cluster_2');] and the it happens the
samething with the following one

 Well the I decided to leave those two on comments, and then this appears:

C:\Archivos de programa\PostgreSQL\8.2\bin>slonik config.conf

config.conf:64: PGRES_FATAL_ERROR select "_Cluster_12".storeListen(2, 2, 1);


 -ERROR:  insert or update on table "sl_listen" violates foreign key
constraint "sl_listen-sl_path-ref"

DETALLE:  Key (li_provider,li_receiver)=3D(2,1) is not present in table
"sl_path".



CONTEXTO:  SQL statement "INSERT INTO "_Cluster_12".sl_listen (li_origin,
li_provider, li_receiver) values ( $1 ,  $2 ,  $3 )"

PL/pgSQL function "storelisten_int" line 36 at SQL statement

SQL statement "SELECT  "_Cluster_12".storeListen_int ( $1 ,  $2 ,  $3 )"

PL/pgSQL function "storelisten" line 6 at perform

 And I really don't know why, or well I know that it refers to the store
listen part but really don't know how to solve it out=85

 I do really appreciate any help or guidance.
Jaison J. Gonz=E1lez Chaux
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080110/=
a3fbbc84/attachment.htm
From cbbrowne at ca.afilias.info  Thu Jan 10 14:40:40 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Thu Jan 10 14:40:50 2008
Subject: [Slony1-general] Query about Slony-i from Colombia
In-Reply-To: <6d3ad6bd0801101423y53b071adg4f47b0cede917d00@mail.gmail.com>
	(Jaison J. =?iso-8859-1?Q?Gonz=E1lez?= Chaux's message of "Thu,
	10 Jan 2008 17:23:42 -0500")
References: <6d3ad6bd0801101410o5b98ab49icbc14e950bcaebde@mail.gmail.com>
	<6d3ad6bd0801101419t2fec75e7r2f0c60876acd185a@mail.gmail.com>
	<6d3ad6bd0801101423y53b071adg4f47b0cede917d00@mail.gmail.com>
Message-ID: <60lk6xwbh3.fsf@dba2.int.libertyrms.com>

"Jaison J. Gonz?lez Chaux" <g0chman@gmail.com> writes:
> Good evening, my name is Jaison Gonz?lez and I am very interested in knowing a bit more about slony-I, I have read some info found on your  web about slony, because I
> have to install it and make it for academic purposes.
>
> What have I done:

>        set add table (set id=1, origin=1, id=1, fully qualified name=' public.Personas', comment='tabla de Personas del Cluster_1');
>        set add table (set id=1, origin=1, id=2, fully qualified name='public.Personas', comment='tabla de Personas del Cluster_2');
>        set add table (set id=1, origin=1, id=3, fully qualified name='public.Personas', comment='tabla de Personas del Cluster_3');

I see a problem here: you are naming the same table three times.  You
only need to specify that table once.

>        store path (server=1, client=1, conninfo='dbname=DB_Cluster_1 host=127.0.0.1 user=root password=root port=5435');
>        store path (server=1, client=2, conninfo='dbname=DB_Cluster_2 host=127.0.0.1 user=root password=root port=5436');
>        store path (server=1, client=3, conninfo='dbname=DB_Cluster_3 host=127.0.0.1 user=root password=root port=5437');

There is a problem here; you need to have more paths between servers
and clients across the cluster to allow events to propagate around.

The path with "server=1, client=1" is a useless one, as there is no
need for the slon managing node #1 to connect to node #1 to access
events from node #1.

I'd be inclined to instead define paths more like:

        store path (server=1, client=2, ...
        store path (server=1, client=3, ...
        store path (server=2, client=1, ...
        store path (server=2, client=3, ...
        store path (server=3, client=1, ...
        store path (server=3, client=2, ...

> ?? store listen (origin=1, provider=1, receiver=2);
> ?? store listen (origin=2, provider=2, receiver=1);
> ?? store listen (origin=3, provider=3, receiver=1);

In the 1.2 branch of Slony-I, it manages listen paths for you.  This
set is inadequate; for a cluster of 3 nodes, there *MUST* be at least
6 listen paths, so that each node (there are 3 of them) knows how to
receive events from the other nodes (2 remain).  (3 x 2 = 6).

>        If I leave the script like that it says:
>
>        C:\Archivos de programa\PostgreSQL\8.2\bin>slonik config.conf
>
>        config.conf:37: PGRES_FATAL_ERROR select "_Cluster_11".setAddTable(1,  2, 'public.Personas', 'Personas_pkey',  'tabla de Personas  del Cluster_2');?  - ERROR:?
>        duplicate key violates unique constraint "sl_table_tab_reloid_key"
>
>        CONTEXTO:? SQL  statement "INSERT INTO  "_Cluster_11".sl_table (tab_id, tab_reloid, tab_relname,  tab_nspname, tab_set,  tab_idxname, tab_altered, tab_comment)
>        values ( $1 ,? $2 ,?$3 ,? $4 ,? $5 ,?$6 , false,? $7 )"
>
>        PL/pgSQL function "setaddtable_int" line 103 at SQL statement
>
>        SQL statement "SELECT?"_Cluster_11".setAddTable_int( $1 ,? $2 ,?$3 ,? $4 ,? $5 )"
>
>        PL/pgSQL function "setaddtable" line 37 at perform

These errors are consistent with what I mentioned above, that you ask
to replicate the same table three times.  It is only added to a set
once.


>        ?And I really dont know  what it is,  then I put  that line on comments  [#set add table  (set id=1,  origin=1,  id=2, fully qualified  name='public.Personas',
>        comment='tabla de Personas del Cluster_2');] and the it happens the samething with the following one
>
>        ?Well the I decided to leave those two on comments, and then this appears:
>
>        C:\Archivos de programa\PostgreSQL\8.2\bin>slonik config.conf
>
>        config.conf:64: PGRES_FATAL_ERROR select "_Cluster_12".storeListen(2, 2, 1);
>
>        ?-ERROR:?insert or update on table "sl_listen" violates foreign key constraint "sl_listen-sl_path-ref"
>
>        DETALLE:? Key (li_provider,li_receiver)=(2,1) is not present in table "sl_path".
>
>        CONTEXTO:? SQL statement "INSERT INTO "_Cluster_12".sl_listen (li_origin, li_provider, li_receiver) values ( $1 ,? $2 ,? $3 )"
>
>        PL/pgSQL function "storelisten_int" line 36 at SQL statement
>
>        SQL statement "SELECT?"_Cluster_12".storeListen_int ( $1 ,? $2 ,?$3 )"
>
>        PL/pgSQL function "storelisten" line 6 at perform
>
> ?And I really don't know why, or well I know that it refers to the store listen part but really don't know how to solve it out...

This reflects the problem that you don't have enough paths stored.
You shouldn't need to specify listen paths anymore as they are
automatically calculated by Slony-I. 

You absolutely need enough paths
defined via STORE PATH in order for events to be able to propagate
from every node to every other node.  For a 3 node cluster, the minimum feasible number of STORE PATH requests would be 3
-- 
output = ("cbbrowne" "@" "ca.afilias.info")
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
From jameshtucker at gmail.com  Thu Jan 10 16:45:18 2008
From: jameshtucker at gmail.com (James Tucker)
Date: Thu Jan 10 16:45:28 2008
Subject: [Slony1-general] Slony startup scripts
Message-ID: <b10d372b0801101645g7f774fcbpd4a4dbc0ac664968@mail.gmail.com>

Hi Glyn,

It's not something silly like the /data/postgres directory being owned by
postgres and having 700 perms ?

Cheers

James

>
>
> Message: 4
> Date: Thu, 10 Jan 2008 04:40:41 -0800 (PST)
> From: Glyn Astill <glynastill@yahoo.co.uk>
> Subject: Re: [Slony1-general] Slony startup scripts
> To: Christopher Browne <cbbrowne@ca.afilias.info>
> Cc: slony1-general@lists.slony.info
> Message-ID: <69062.47809.qm@web25804.mail.ukl.yahoo.com>
> Content-Type: text/plain; charset=3Diso-8859-1
>
> Hi Chris,
>
> It seems it may not be the start-stop-daemon afterall. I changed my
> script to not use it and just start via su.
>
> E.g. I have this:
>
> su - $PGUSER -c "$SLONDAEMON -f $SLONCONF &" >> "$SLONLOG" 2>&1 <
> /dev/null
> echo "su - $PGUSER -c '$SLONDAEMON -f $SLONCONF &' >> "$SLONLOG" 2>&1
> < /dev/null"
>
> And it echos to the screen the following
>
> su - slony -c '/usr/local/pgsql/bin/slon -f /data/postgres/slon.conf'
> >> /data/postgres/
> slon.log 2>&1 < /dev/null
>
> Does that look wrong?
>
> Either way, I end up with the following in my log file:
>
> 2008-01-10 12:34:59 GMT ERROR  could not open configuration file
> "/data/postgres/slon.conf"
> 2008-01-10 12:34:59 GMT CONFIG main: slon version 1.2.12 starting up
> usage: /usr/local/pgsql/bin/slon [options] clustername conninfo
>
> And slon.conf is there:
>
> -rwxrw-rw- 1 slony slony 4513 2008-01-09 17:55
> /data/postgres/slon.conf
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080111/=
696ca6d4/attachment-0001.htm
From marcus.gustafsson at visionten.net  Thu Jan 10 20:07:54 2008
From: marcus.gustafsson at visionten.net (Marcus Gustafsson)
Date: Thu Jan 10 20:08:12 2008
Subject: [Slony1-general] Slonik segfaulting.
In-Reply-To: <60abndy5xr.fsf@dba2.int.libertyrms.com>
References: <4785F20C.1090608@visionten.net>
	<60abndy5xr.fsf@dba2.int.libertyrms.com>
Message-ID: <4786EB9A.8070605@visionten.net>

Christopher Browne skrev:
> Marcus Gustafsson <marcus.gustafsson@visionten.net> writes:
>> Hi all!
>>
>> Are there any known issues with the slony RPM
>> postgresql-slony1-engine-1.1.5-1_PG8.1.4.i686.rpm?
>>
>> I have a small slony cluster where I removed node 1 for reinstallation,
>> but when I try to reinsert it (as a new node) with:
>>
>> cluster name = MyCluster;
>> node 2 admin conninfo = 'dbname=mycluster host=db2.internal user=slony
>> password=secret';
>> node 3 admin conninfo = 'dbname=mycluster host=db3.internal user=slony
>> password=secret';
>> node 4 admin conninfo = 'dbname=mycluster host=db1.internal user=slony
>> password=secret';
>> store node(id=4, event node=2);
>>
>> slonik crashes with a segmentation fault.
>> GDB gives me a backtrace which looks like this:
>>
>> #0  0x0804ed5a in slon_appendquery_int ()
>> #1  0x0804f047 in slon_mkquery ()
>> #2  0x0804cf31 in slonik_store_node ()
>> #3  0x0804e8dd in script_exec_stmts ()
>> #4  0x0804ea41 in script_exec ()
>> #5  0x0804ebed in main ()
>>
>> I'll obviously keep debugging, but before I jump headfirst in the code
>> someone else might have an idea of what is wrong?
> 
> Nothing jumps out at me; this sounds consistent with the notion of
> slonik trying to build a query, and finding that one of the components
> was NULL.
> 
> I don't see anything reported as fixed subsequent to 1.1.5; I vaguely
> remember fixing a problem with this in the 1.2 series, but don't see
> anything expressly in the release notes.  I would suggest considering
> a much newer version of Slony-I; you're on a version that was released
> 2 years ago, and a great number of bugs have been fixed since.

Oh! I wasn't aware that the release we were running was that far behind.
 I probably should schedule an upgrade rather than spending time on
debugging problems which might already be solved.
Which release is currently recommended for production usage? I'd prefer
not to run a bleeding-edge version on this particular cluster. Is it the
1.2.12-1 one available as a source rpm on the slony webpage a good idea?

> Looking at the code directly... I notice slon_mkquery() gets called 16
> times in slonik_store_node(), and slon_appendquery() gets called 3
> times (which may be totally a red herring!).
> 
> Does GDB give you any idea as to where it was in slonik_store_node()?

Not really, I don't have the source for that version on the machine I
was running slonik on at the moment. The function starts at 0x804cd60
and calls slon_mkquery at 0x804cf2c (slonik_store_node+460) which should
be just before it calls the first "db_exec_command".

Anyways, I'll try to upgrade first and see if that solves the problem.

Thanks for the help!

/Marcus
From g0chman at gmail.com  Fri Jan 11 01:27:54 2008
From: g0chman at gmail.com (=?ISO-8859-1?Q?Jaison_J._Gonz=E1lez_Chaux?=)
Date: Fri Jan 11 01:28:10 2008
Subject: [Slony1-general] Query about Slony-i from Colombia
In-Reply-To: <60lk6xwbh3.fsf@dba2.int.libertyrms.com>
References: <6d3ad6bd0801101410o5b98ab49icbc14e950bcaebde@mail.gmail.com>
	<6d3ad6bd0801101419t2fec75e7r2f0c60876acd185a@mail.gmail.com>
	<6d3ad6bd0801101423y53b071adg4f47b0cede917d00@mail.gmail.com>
	<60lk6xwbh3.fsf@dba2.int.libertyrms.com>
Message-ID: <6d3ad6bd0801110127q2d71f779p81d1e9f3f15298bb@mail.gmail.com>

Hi,

Thank you very much Mr. Browne for answering me back, I changed the script
to this,

cluster name=3DCluster_10;

init cluster (id=3D1, comment=3D'Nodo maestro');

create set (id=3D1, origin=3D1, comment=3D'aqui van todas mis tablas');

set add table (set id=3D1, origin=3D1, id=3D1, fully qualified name=3D'
public.Personas', comment=3D'tabla de Personas del Cluster_1');
#set add table (set id=3D1, origin=3D1, id=3D2, fully qualified name=3D'
public.Personas', comment=3D'tabla de Personas del Cluster_2');
#set add table (set id=3D1, origin=3D1, id=3D3, fully qualified name=3D'
public.Personas', comment=3D'tabla de Personas del Cluster_3');

store node (id=3D2, comment=3D'Nodo esclavo Cluster_2');
store node (id=3D3, comment=3D'Nodo esclavo Cluster_3');

store path (server=3D1, client=3D2, conninfo=3D'dbname=3DDB_Cluster_1
host=3D127.0.0.1user=3Droot password=3Droot port=3D5435');
store path (server=3D1, client=3D3, conninfo=3D'dbname=3DDB_Cluster_1
host=3D127.0.0.1user=3Droot password=3Droot port=3D5435');
store path (server=3D2, client=3D1, conninfo=3D'dbname=3DDB_Cluster_2
host=3D127.0.0.1user=3Droot password=3Droot port=3D5436');
store path (server=3D2, client=3D3, conninfo=3D'dbname=3DDB_Cluster_2
host=3D127.0.0.1user=3Droot password=3Droot port=3D5436');
store path (server=3D3, client=3D1, conninfo=3D'dbname=3DDB_Cluster_3
host=3D127.0.0.1user=3Droot password=3Droot port=3D5437');
store path (server=3D3, client=3D2, conninfo=3D'dbname=3DDB_Cluster_3
host=3D127.0.0.1user=3Droot password=3Droot port=3D5437');

store listen (origin=3D1, provider=3D1, receiver=3D2);
store listen (origin=3D1, provider=3D1, receiver=3D3);
store listen (origin=3D2, provider=3D2, receiver=3D1);
store listen (origin=3D2, provider=3D2, receiver=3D3);
store listen (origin=3D3, provider=3D3, receiver=3D1);
store listen (origin=3D3, provider=3D3, receiver=3D2);


but even so now I get a new error message

C:\Archivos de programa\PostgreSQL\8.2\bin>slonik config.conf
config.conf:36: PGRES_FATAL_ERROR select
"_Cluster_14".determineIdxnameUnique('public.Personas', NULL);
- ERROR:  Slony-I: determineIdxnameUnique(): table " public"."Personas" not
found

So I look out in google and put "Slony-I: determineIdxnameUnique():", and
found this <
http://linuxfinances.info/info/function.determineidxnameunique-text-name.ht=
ml>
, FUNCTION determineIdxnameUnique (tab_fqname, indexname) Given a tablename,
tab_fqname, check that the unique index, indexname, exists or return the
primary key index name for the table. If there is no unique index, it raises
an exception.

I am not sure of which index key does it talk, if it is of the databases
form the clusters, all of them have their owns, I will add to this post the
databases (all of them =96DB_Cluster_1, DB_Cluster_2 and DB_Cluster_3- has =
the
same) struct

-- Table: "Personas"

-- DROP TABLE "Personas";

CREATE TABLE "Personas"
(
  "Id" integer NOT NULL,
  nom1 "char",
  nom2 "char",
  apel1 "char",
  apel2 "char",
  CONSTRAINT "Personas_pkey" PRIMARY KEY ("Id")
)
WITHOUT OIDS;
ALTER TABLE "Personas" OWNER TO root;

 I do really appreciate any help or guidance.

Jaison J. Gonz=3DE1lez Chaux
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080111/=
dc98de0a/attachment.htm
From dr.michi at gmail.com  Fri Jan 11 03:56:42 2008
From: dr.michi at gmail.com (Michael Weber)
Date: Fri Jan 11 03:57:01 2008
Subject: [Slony1-general] Replicating a replicated data
Message-ID: <4b15b0190801110356v723df29by894ffc82bbb9fae4@mail.gmail.com>

Hi everybody,

I have a database (with a handful of tables) replicated to our
institute. Here, some more tables are added to the database.

This resulting set (the replicated tables plus the locally created
ones) I would like to replicate inside our institute. I do not want to
replicate to the same master database out of security concerns, and
because it is far away and bandwith is also a cost issue.

How do I best go about this? Can I create a second configuration file,
and run slony on the replicated (slave) database as if it were a
'normal' database?

I run debian etch, postgres 8.2 and slony 1.2.19


Michael
From bnichols at ca.afilias.info  Fri Jan 11 06:21:46 2008
From: bnichols at ca.afilias.info (Brad Nicholson)
Date: Fri Jan 11 06:19:15 2008
Subject: [Slony1-general] Replicating a replicated data
In-Reply-To: <4b15b0190801110356v723df29by894ffc82bbb9fae4@mail.gmail.com>
References: <4b15b0190801110356v723df29by894ffc82bbb9fae4@mail.gmail.com>
Message-ID: <1200061306.5586.80.camel@bnicholson-desktop>


On Fri, 2008-01-11 at 12:56 +0100, Michael Weber wrote:
> Hi everybody,
> 
> I have a database (with a handful of tables) replicated to our
> institute. Here, some more tables are added to the database.
> 
> This resulting set (the replicated tables plus the locally created
> ones) I would like to replicate inside our institute. I do not want to
> replicate to the same master database out of security concerns, and
> because it is far away and bandwith is also a cost issue.

You can do this with one configuration.

Lets say that the external database you are replicating to your
Institute is A.  The internal database that you are replicating into in
your Institute is B, and the the third database in your Institute is C.

Set it up like this:

Set 1 - A is the origin
	A is the provider to B
	B is the provider to C

Create Set 2 with the tables and sequences local to your institute

Set 2 - B is the origin
	B is the provider to C

Now, there is one big caveat to this setup.  You will no longer be able
to use pg_dump to backup database B.  You can not pg_dump a replica, and
what you've done with this config is make B both a provider and a
replica.

-- 
Brad Nicholson  416-673-4106
Database Administrator, Afilias Canada Corp.


From dr.michi at gmail.com  Fri Jan 11 06:30:26 2008
From: dr.michi at gmail.com (Michael Weber)
Date: Fri Jan 11 06:30:31 2008
Subject: [Slony1-general] Replicating a replicated data
In-Reply-To: <1200061306.5586.80.camel@bnicholson-desktop>
References: <4b15b0190801110356v723df29by894ffc82bbb9fae4@mail.gmail.com>
	<1200061306.5586.80.camel@bnicholson-desktop>
Message-ID: <4b15b0190801110630j72564378t430a87a950c31758@mail.gmail.com>

> Lets say that the external database you are replicating to your
> Institute is A.  The internal database that you are replicating into in
> your Institute is B, and the the third database in your Institute is C.
>
> Set it up like this:
>
> Set 1 - A is the origin
>         A is the provider to B
>         B is the provider to C
>
> Create Set 2 with the tables and sequences local to your institute
>
> Set 2 - B is the origin
>         B is the provider to C
>
> Now, there is one big caveat to this setup.  You will no longer be able
> to use pg_dump to backup database B.  You can not pg_dump a replica, and
> what you've done with this config is make B both a provider and a
> replica.
>
Thanks for the quick reply!

Once everything is running I don't think a dump will be necessary.
What do I do if things break (e.g. server C dies) and I need to refill
the database? How do I do this without a dump? Or is pg_dump no
problem with slony stopped.

What do I need to take care of when I change the configuration? Just
stop slony, change the config, probably run initialize node, and then
start slony again? Is it that easy?


Michael
From wmoran at collaborativefusion.com  Fri Jan 11 06:34:24 2008
From: wmoran at collaborativefusion.com (Bill Moran)
Date: Fri Jan 11 06:34:29 2008
Subject: [Slony1-general] What is the risk from running pg_dump on a replica
Message-ID: <20080111093424.8428570a.wmoran@collaborativefusion.com>


Every so often, I see this brought up on-list about how it's such a
bad idea to do pg_dump from a Slony-I replica.

I do this quite frequently (to grab data out of our production environment
to our lab for testing purposes, for example).  I've yet to see any
problems ... what is it that's supposed to go awry when I do this?
What is the danger?

-- 
Bill Moran
Collaborative Fusion Inc.
http://people.collaborativefusion.com/~wmoran/

wmoran@collaborativefusion.com
Phone: 412-422-3463x4023
From bnichols at ca.afilias.info  Fri Jan 11 07:05:14 2008
From: bnichols at ca.afilias.info (Brad Nicholson)
Date: Fri Jan 11 07:02:42 2008
Subject: [Slony1-general] Replicating a replicated data
In-Reply-To: <4b15b0190801110630j72564378t430a87a950c31758@mail.gmail.com>
References: <4b15b0190801110356v723df29by894ffc82bbb9fae4@mail.gmail.com>
	<1200061306.5586.80.camel@bnicholson-desktop>
	<4b15b0190801110630j72564378t430a87a950c31758@mail.gmail.com>
Message-ID: <1200063914.5586.88.camel@bnicholson-desktop>


On Fri, 2008-01-11 at 15:30 +0100, Michael Weber wrote:
> > Lets say that the external database you are replicating to your
> > Institute is A.  The internal database that you are replicating into in
> > your Institute is B, and the the third database in your Institute is C.
> >
> > Set it up like this:
> >
> > Set 1 - A is the origin
> >         A is the provider to B
> >         B is the provider to C
> >
> > Create Set 2 with the tables and sequences local to your institute
> >
> > Set 2 - B is the origin
> >         B is the provider to C
> >
> > Now, there is one big caveat to this setup.  You will no longer be able
> > to use pg_dump to backup database B.  You can not pg_dump a replica, and
> > what you've done with this config is make B both a provider and a
> > replica.
> >
> Thanks for the quick reply!
> 
> Once everything is running I don't think a dump will be necessary.
> What do I do if things break (e.g. server C dies) and I need to refill
> the database? How do I do this without a dump? Or is pg_dump no
> problem with slony stopped.

You would use slony for this.  If you lost C, you would drop node C from
replication, then re-add and re-subscribe it.  This will copy all the
data from the sets over to it.

> What do I need to take care of when I change the configuration? Just
> stop slony, change the config, probably run initialize node, and then
> start slony again? Is it that easy?

You don't need to stop slony, you can make the changes on the fly.  I
would recommend (as always) testing the changes out before doing them,
especially if you are new to slony.

-- 
Brad Nicholson  416-673-4106
Database Administrator, Afilias Canada Corp.


From vivek at khera.org  Fri Jan 11 07:29:21 2008
From: vivek at khera.org (Vivek Khera)
Date: Fri Jan 11 07:29:26 2008
Subject: [Slony1-general] What is the risk from running pg_dump on a
	replica
In-Reply-To: <20080111093424.8428570a.wmoran@collaborativefusion.com>
References: <20080111093424.8428570a.wmoran@collaborativefusion.com>
Message-ID: <8BA4C2B1-E551-4754-A638-7775F4262798@khera.org>


On Jan 11, 2008, at 9:34 AM, Bill Moran wrote:

> I do this quite frequently (to grab data out of our production  
> environment
> to our lab for testing purposes, for example).  I've yet to see any
> problems ... what is it that's supposed to go awry when I do this?
> What is the danger?

your schema is mucked about by slony, so when you restore, you may not  
get what you expect to get in terms of triggers, rules, etc.

I sometimes take a clean schema dump (with slony stuff removed) from  
the master, and data-only dump from the replica, then use the   
pg_restore -l and -L options to prune what gets restored (ie, comment  
out all the slony related stuff).
From ajs at crankycanuck.ca  Fri Jan 11 07:44:49 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Fri Jan 11 07:45:03 2008
Subject: [Slony1-general] What is the risk from running pg_dump on a
	replica
In-Reply-To: <20080111093424.8428570a.wmoran@collaborativefusion.com>
References: <20080111093424.8428570a.wmoran@collaborativefusion.com>
Message-ID: <20080111154449.GU5963@crankycanuck.ca>

On Fri, Jan 11, 2008 at 09:34:24AM -0500, Bill Moran wrote:
> 
> I do this quite frequently (to grab data out of our production environment
> to our lab for testing purposes, for example).  I've yet to see any
> problems ... what is it that's supposed to go awry when I do this?
> What is the danger?

Slony has fooled with the catalog tables.  You get an unrestorable dump. 
Some versions of pg_dump actually won't dump as a result of this -- they
notice the problem, and quit.

There's a tool that ships with Slony that is supposed to allow dumping on a
replica.  It doesn't seem to have had a lot of testing.  It'd be nice to get
some reports of its utility and reliability.

A
From cbbrowne at ca.afilias.info  Fri Jan 11 07:57:10 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri Jan 11 07:57:14 2008
Subject: [Slony1-general] Slonik segfaulting.
In-Reply-To: <4786EB9A.8070605@visionten.net> (Marcus Gustafsson's message of
	"Fri, 11 Jan 2008 12:07:54 +0800")
References: <4785F20C.1090608@visionten.net>
	<60abndy5xr.fsf@dba2.int.libertyrms.com>
	<4786EB9A.8070605@visionten.net>
Message-ID: <60d4s8we21.fsf@dba2.int.libertyrms.com>

Marcus Gustafsson <marcus.gustafsson@visionten.net> writes:
> Oh! I wasn't aware that the release we were running was that far behind.
>  I probably should schedule an upgrade rather than spending time on
> debugging problems which might already be solved.
> Which release is currently recommended for production usage? I'd prefer
> not to run a bleeding-edge version on this particular cluster. Is it the
> 1.2.12-1 one available as a source rpm on the slony webpage a good idea?

Yes, that would be a good idea.

There's going to be a 1.2.13 once PostgreSQL 8.3 comes out, and there
are a few small bugs getting fixed in addition to 8.3 support, but
there's nothing at all show-stopping that's post-1.2.12.

On the other hand, there are a number of things fixed in 1.2.12 that
*are* quite material.

You can always check the release notes; I'd like to think they are
pretty good.  (Of course, I wrote them, so I may be biased ;-).)
-- 
select 'cbbrowne' || '@' || 'acm.org';
http://cbbrowne.com/info/internet.html
Rules  of  the  Evil  Overlord  #57. "Before  employing  any  captured
artifacts  or machinery, I  will carefully  read the  owner's manual."
<http://www.eviloverlord.com/>
From cbbrowne at ca.afilias.info  Fri Jan 11 08:05:23 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri Jan 11 08:05:27 2008
Subject: [Slony1-general] What is the risk from running pg_dump on a
	replica
In-Reply-To: <20080111154449.GU5963@crankycanuck.ca> (Andrew Sullivan's
	message of "Fri, 11 Jan 2008 10:44:49 -0500")
References: <20080111093424.8428570a.wmoran@collaborativefusion.com>
	<20080111154449.GU5963@crankycanuck.ca>
Message-ID: <608x2wwdoc.fsf@dba2.int.libertyrms.com>

Andrew Sullivan <ajs@crankycanuck.ca> writes:
> On Fri, Jan 11, 2008 at 09:34:24AM -0500, Bill Moran wrote:
>> 
>> I do this quite frequently (to grab data out of our production environment
>> to our lab for testing purposes, for example).  I've yet to see any
>> problems ... what is it that's supposed to go awry when I do this?
>> What is the danger?
>
> Slony has fooled with the catalog tables.  You get an unrestorable dump. 
> Some versions of pg_dump actually won't dump as a result of this -- they
> notice the problem, and quit.

An oddity is that sometimes pg_dump will complain, and sometimes it
won't.

Note that the trouble is more precise in nature than merely
"unrestorable dump;" the trouble is that when pg_dump tries to dump
the schema, it may encounter problems due to the way that triggers get
re-attached (on subscribers) to the primary key index rather than to
the table.

- It shouldn't mean that the schema dump of the table loses columns;

- It definitely doesn't mean that the portion of pg_dump that generates
  the COPY statement has anything improper about it;

- The trouble *is* that the trigger trickery may corrupt that part of
  the schema dump.

> There's a tool that ships with Slony that is supposed to allow dumping on a
> replica.  It doesn't seem to have had a lot of testing.  It'd be nice to get
> some reports of its utility and reliability.

Actually, it's now used in the regression test that tests out log
shipping, so I think that the claim that it "doesn't seem to have had
a lot of testing" is becoming unfair.

Note that this all is to change in the next major Slony-I release;
with the changes in trigger support in PG 8.3, there is no longer a
need to fool with the system catalog, so pg_dump becomes usable again.
-- 
let name="cbbrowne" and tld="linuxdatabases.info" in name ^ "@" ^ tld;;
http://linuxdatabases.info/info/unix.html
"Some people, when confronted with a Unix problem, think "I know, I'll
use sed." Now they have two problems."  -- Jamie Zawinski
From ajs at crankycanuck.ca  Fri Jan 11 08:09:53 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Fri Jan 11 08:10:13 2008
Subject: [Slony1-general] What is the risk from running pg_dump on a
	replica
In-Reply-To: <608x2wwdoc.fsf@dba2.int.libertyrms.com>
References: <20080111093424.8428570a.wmoran@collaborativefusion.com>
	<20080111154449.GU5963@crankycanuck.ca>
	<608x2wwdoc.fsf@dba2.int.libertyrms.com>
Message-ID: <20080111160953.GV5963@crankycanuck.ca>

On Fri, Jan 11, 2008 at 11:05:23AM -0500, Christopher Browne wrote:
> 
> Actually, it's now used in the regression test that tests out log
> shipping, so I think that the claim that it "doesn't seem to have had
> a lot of testing" is becoming unfair.

Excellent news!  

> Note that this all is to change in the next major Slony-I release;
> with the changes in trigger support in PG 8.3, there is no longer a
> need to fool with the system catalog, so pg_dump becomes usable again.

Right, I forgot to mention that.

A
From glynastill at yahoo.co.uk  Fri Jan 11 09:59:25 2008
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Fri Jan 11 09:59:34 2008
Subject: [Slony1-general] What is the risk from running pg_dump on a
	replica
In-Reply-To: <20080111160953.GV5963@crankycanuck.ca>
Message-ID: <281461.25494.qm@web25807.mail.ukl.yahoo.com>

I'm in the process of building a system that uses slony-I for
replication, and I'm just starting to look at the best ways to do my
backups.

So far until I saw this thread I'd assumed that I could do a pg_dump
on a subscriber and keep that as my main backup. Or do a file system
backup of the subscriber.

In this case what would be the best way to restore the system from
that backup in the case of a publisher failing? 

Any ideas on backup / restore techniques would be appreciated.


--- Andrew Sullivan <ajs@crankycanuck.ca> wrote:

> On Fri, Jan 11, 2008 at 11:05:23AM -0500, Christopher Browne wrote:
> > 
> > Actually, it's now used in the regression test that tests out log
> > shipping, so I think that the claim that it "doesn't seem to have
> had
> > a lot of testing" is becoming unfair.
> 
> Excellent news!  
> 
> > Note that this all is to change in the next major Slony-I
> release;
> > with the changes in trigger support in PG 8.3, there is no longer
> a
> > need to fool with the system catalog, so pg_dump becomes usable
> again.
> 
> Right, I forgot to mention that.
> 
> A
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
> 



      __________________________________________________________
Sent from Yahoo! Mail - a smarter inbox http://uk.mail.yahoo.com


From tgoodair at ca.afilias.info  Fri Jan 11 10:03:52 2008
From: tgoodair at ca.afilias.info (Tim Goodaire)
Date: Fri Jan 11 10:04:15 2008
Subject: [Slony1-general] What is the risk from running pg_dump on a
	replica
In-Reply-To: <281461.25494.qm@web25807.mail.ukl.yahoo.com>
References: <281461.25494.qm@web25807.mail.ukl.yahoo.com>
Message-ID: <200801111303.52827.tgoodair@ca.afilias.info>

You could take your backup from the origin instead of the subscriber.

On January 11, 2008 12:59:25 pm Glyn Astill wrote:
> I'm in the process of building a system that uses slony-I for
> replication, and I'm just starting to look at the best ways to do my
> backups.
>
> So far until I saw this thread I'd assumed that I could do a pg_dump
> on a subscriber and keep that as my main backup. Or do a file system
> backup of the subscriber.
>
> In this case what would be the best way to restore the system from
> that backup in the case of a publisher failing?
>
> Any ideas on backup / restore techniques would be appreciated.
>
> --- Andrew Sullivan <ajs@crankycanuck.ca> wrote:
> > On Fri, Jan 11, 2008 at 11:05:23AM -0500, Christopher Browne wrote:
> > > Actually, it's now used in the regression test that tests out log
> > > shipping, so I think that the claim that it "doesn't seem to have
> >
> > had
> >
> > > a lot of testing" is becoming unfair.
> >
> > Excellent news!
> >
> > > Note that this all is to change in the next major Slony-I
> >
> > release;
> >
> > > with the changes in trigger support in PG 8.3, there is no longer
> >
> > a
> >
> > > need to fool with the system catalog, so pg_dump becomes usable
> >
> > again.
> >
> > Right, I forgot to mention that.
> >
> > A
> > _______________________________________________
> > Slony1-general mailing list
> > Slony1-general@lists.slony.info
> > http://lists.slony.info/mailman/listinfo/slony1-general
>
>       __________________________________________________________
> Sent from Yahoo! Mail - a smarter inbox http://uk.mail.yahoo.com
>
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general



-- 
Tim Goodaire    416-673-4126    tgoodair@ca.afilias.info
Database Team Lead, Afilias Canada Corp.
From rod at iol.ie  Fri Jan 11 10:22:08 2008
From: rod at iol.ie (Raymond O'Donnell)
Date: Fri Jan 11 10:22:29 2008
Subject: [Slony1-general] What is the risk from running pg_dump on
	a	replica
In-Reply-To: <608x2wwdoc.fsf@dba2.int.libertyrms.com>
References: <20080111093424.8428570a.wmoran@collaborativefusion.com>	<20080111154449.GU5963@crankycanuck.ca>
	<608x2wwdoc.fsf@dba2.int.libertyrms.com>
Message-ID: <4787B3D0.3010707@iol.ie>

On 11/01/2008 16:05, Christopher Browne wrote:

> Note that this all is to change in the next major Slony-I release;
> with the changes in trigger support in PG 8.3, there is no longer a
> need to fool with the system catalog, so pg_dump becomes usable again.

You mean that we'll be able to take a usable dump from a subscriber 
node? Cool!

Ray.


---------------------------------------------------------------
Raymond O'Donnell, Director of Music, Galway Cathedral, Ireland
rod@iol.ie
---------------------------------------------------------------
From John.Fansler at ateb.com  Fri Jan 11 10:27:11 2008
From: John.Fansler at ateb.com (John Fansler)
Date: Fri Jan 11 10:25:45 2008
Subject: [Slony1-general] Slony events in windows
Message-ID: <7C0800F63CCF4149AC0FC5EE2A041226036D3DF7@sr002-2k3exc.ateb.com>

Hello,

 

I'm currently playing with a slightly older version of slony (1.2.9)
included in my postgres windows installation.

 

>From reading the docs it appears that log_level of 2 is recommended. The
problem is that the amount of logging done at that level takes over the
windows application event log.

 

Is there a way to configure slony in windows to use its own windows
event log instead of the application event log?

 

Thanks,

 

-john

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080111/7aa79862/attachment-0001.htm
From cbbrowne at ca.afilias.info  Fri Jan 11 10:38:31 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri Jan 11 10:38:38 2008
Subject: [Slony1-general] Query about Slony-i from Colombia
In-Reply-To: <6d3ad6bd0801110127q2d71f779p81d1e9f3f15298bb@mail.gmail.com>
	(Jaison J. =?iso-8859-1?Q?Gonz=E1lez?= Chaux's message of "Fri,
	11 Jan 2008 04:27:54 -0500")
References: <6d3ad6bd0801101410o5b98ab49icbc14e950bcaebde@mail.gmail.com>
	<6d3ad6bd0801101419t2fec75e7r2f0c60876acd185a@mail.gmail.com>
	<6d3ad6bd0801101423y53b071adg4f47b0cede917d00@mail.gmail.com>
	<60lk6xwbh3.fsf@dba2.int.libertyrms.com>
	<6d3ad6bd0801110127q2d71f779p81d1e9f3f15298bb@mail.gmail.com>
Message-ID: <604pdkw6l4.fsf@dba2.int.libertyrms.com>

"Jaison J. Gonz?lez Chaux" <g0chman@gmail.com> writes:
> Thank you very much Mr. Browne for answering me back, I changed the script to this,
>
>               cluster name=Cluster_10;
>
>               init cluster (id=1, comment='Nodo maestro');
>
>               create set (id=1, origin=1, comment='aqui van todas mis tablas');
>
>               set add table (set id=1, origin=1, id=1, fully qualified name=' public.Personas', comment='tabla de Personas del Cluster_1');
>               #set add table (set id=1, origin=1, id=2, fully qualified name='public.Personas', comment='tabla de Personas del Cluster_2');
>               #set add table (set id=1, origin=1, id=3, fully qualified name='public.Personas', comment='tabla de Personas del Cluster_3');
>
>               store node (id=2, comment='Nodo esclavo Cluster_2');
>               store node (id=3, comment='Nodo esclavo Cluster_3');
>
>               store path (server=1, client=2, conninfo='dbname=DB_Cluster_1 host=127.0.0.1 user=root password=root port=5435');
>               store path (server=1, client=3, conninfo='dbname=DB_Cluster_1 host=127.0.0.1 user=root password=root port=5435');
>               store path (server=2, client=1, conninfo='dbname=DB_Cluster_2 host=127.0.0.1 user=root password=root port=5436');
>               store path (server=2, client=3, conninfo='dbname=DB_Cluster_2 host=127.0.0.1 user=root password=root port=5436');
>               store path (server=3, client=1, conninfo='dbname=DB_Cluster_3 host=127.0.0.1 user=root password=root port=5437');
>               store path (server=3, client=2, conninfo='dbname=DB_Cluster_3 host=127.0.0.1 user=root password=root port=5437');
>
>               store listen (origin=1, provider=1, receiver=2);
>               store listen (origin=1, provider=1, receiver=3);
>               store listen (origin=2, provider=2, receiver=1);
>               store listen (origin=2, provider=2, receiver=3);
>               store listen (origin=3, provider=3, receiver=1);
>               store listen (origin=3, provider=3, receiver=2);

The "store listen" requests are pretty unnecessary, as Slony-I will
normally ignore those and generate the entries *it* thinks should be
in the table "sl_listen".

> but even so now I get a new error message
>
>               C:\Archivos de programa\PostgreSQL\8.2\bin>slonik config.conf
>               config.conf:36: PGRES_FATAL_ERROR select "_Cluster_14".determineIdxnameUnique('public.Personas', NULL);?
>               - ERROR:?Slony-I: determineIdxnameUnique(): table " public"."Personas" not found

There's an extra space in there, which is probably causing this problem:

   set add table (set id=1, origin=1, id=1, fully qualified name=' public.Personas', comment='tabla de Personas del Cluster_1');
                                                                  ^---- whitespace right here...

That looks like the problem to me.
-- 
(format nil "~S@~S" "cbbrowne" "linuxdatabases.info")
http://linuxdatabases.info/info/finances.html
Rules of the Evil Overlord #177.  "If a scientist with a beautiful and
unmarried  daughter  refuses to  work  for me,  I  will  not hold  her
hostage. Instead, I  will offer to pay for her  future wedding and her
children's college tuition." <http://www.eviloverlord.com/>
From z-saito at guitar.ocn.ne.jp  Fri Jan 11 10:58:12 2008
From: z-saito at guitar.ocn.ne.jp (Hiroshi Saito)
Date: Fri Jan 11 10:58:17 2008
Subject: [Slony1-general] Slony events in windows
References: <7C0800F63CCF4149AC0FC5EE2A041226036D3DF7@sr002-2k3exc.ateb.com>
Message-ID: <052b01c85483$ea18c540$c601a8c0@HP22720319231>

Hi.

Umm, sorry, I cann't understand well the meaning which you say...
Is the quantity of it of a log a problem? or, Divide the kind of log.
Do you want only a specific thing? Concretely, what is a point?

Regards,
Hiroshi Saito

----- Original Message ----- 
From: John Fansler
To: slony1-general@lists.slony.info
Sent: Saturday, January 12, 2008 3:27 AM
Subject: [Slony1-general] Slony events in windows


Hello,

I'm currently playing with a slightly older version of slony (1.2.9) included in my postgres windows installation.

>From reading the docs it appears that log_level of 2 is recommended. The problem is that the amount of logging done at 
that level takes over the windows application event log.

Is there a way to configure slony in windows to use its own windows event log instead of the application event log?

Thanks,

-john



_______________________________________________
Slony1-general mailing list
Slony1-general@lists.slony.info
http://lists.slony.info/mailman/listinfo/slony1-general 

From John.Fansler at ateb.com  Fri Jan 11 11:07:19 2008
From: John.Fansler at ateb.com (John Fansler)
Date: Fri Jan 11 11:05:48 2008
Subject: [Slony1-general] Slony events in windows
In-Reply-To: <052b01c85483$ea18c540$c601a8c0@HP22720319231>
References: <7C0800F63CCF4149AC0FC5EE2A041226036D3DF7@sr002-2k3exc.ateb.com>
	<052b01c85483$ea18c540$c601a8c0@HP22720319231>
Message-ID: <7C0800F63CCF4149AC0FC5EE2A041226036D3DF8@sr002-2k3exc.ateb.com>

Hey,

If I set the log_level=2, the number of events generated by slony in the
windows application event log overruns most anything else that may be
logging to that event log. Roughly every 10 seconds (my poll interval)
slony generates around 14 events to that log file.

I'm new to slony, but thought I read that log_level=2 is a good level to
monitor with. If so, it would be nice to be able to tell slony to log to
a "Slony" windows event log instead of the "Application" windows event
log. That way the number of events from Slony wouldn't impact tracing
anything from other applications that use the application windows event
log.

Please let me know if I'm still not clear or if there is another
recommendation for handling this!

Thanks in advance for any help you can provide,

-john

-----Original Message-----
From: Hiroshi Saito [mailto:z-saito@guitar.ocn.ne.jp] 
Sent: Friday, January 11, 2008 1:58 PM
To: John Fansler; slony1-general@lists.slony.info
Subject: Re: [Slony1-general] Slony events in windows

Hi.

Umm, sorry, I cann't understand well the meaning which you say...
Is the quantity of it of a log a problem? or, Divide the kind of log.
Do you want only a specific thing? Concretely, what is a point?

Regards,
Hiroshi Saito

----- Original Message ----- 
From: John Fansler
To: slony1-general@lists.slony.info
Sent: Saturday, January 12, 2008 3:27 AM
Subject: [Slony1-general] Slony events in windows


Hello,

I'm currently playing with a slightly older version of slony (1.2.9)
included in my postgres windows installation.

>From reading the docs it appears that log_level of 2 is recommended. The
problem is that the amount of logging done at 
that level takes over the windows application event log.

Is there a way to configure slony in windows to use its own windows
event log instead of the application event log?

Thanks,

-john



_______________________________________________
Slony1-general mailing list
Slony1-general@lists.slony.info
http://lists.slony.info/mailman/listinfo/slony1-general 

From wmoran at collaborativefusion.com  Fri Jan 11 11:41:37 2008
From: wmoran at collaborativefusion.com (Bill Moran)
Date: Fri Jan 11 11:41:46 2008
Subject: [Slony1-general] What is the risk from running pg_dump on a
	replica
In-Reply-To: <200801111303.52827.tgoodair@ca.afilias.info>
References: <281461.25494.qm@web25807.mail.ukl.yahoo.com>
	<200801111303.52827.tgoodair@ca.afilias.info>
Message-ID: <20080111144137.1b8078f6.wmoran@collaborativefusion.com>

In response to Tim Goodaire <tgoodair@ca.afilias.info>:

> You could take your backup from the origin instead of the subscriber.

Note that it seems that you can get the _data_ from the replica (i.e.
pg_dump -a), but not the schema ... that has to come from the primary
(or from your original data definition)

> 
> On January 11, 2008 12:59:25 pm Glyn Astill wrote:
> > I'm in the process of building a system that uses slony-I for
> > replication, and I'm just starting to look at the best ways to do my
> > backups.
> >
> > So far until I saw this thread I'd assumed that I could do a pg_dump
> > on a subscriber and keep that as my main backup. Or do a file system
> > backup of the subscriber.
> >
> > In this case what would be the best way to restore the system from
> > that backup in the case of a publisher failing?
> >
> > Any ideas on backup / restore techniques would be appreciated.
> >
> > --- Andrew Sullivan <ajs@crankycanuck.ca> wrote:
> > > On Fri, Jan 11, 2008 at 11:05:23AM -0500, Christopher Browne wrote:
> > > > Actually, it's now used in the regression test that tests out log
> > > > shipping, so I think that the claim that it "doesn't seem to have
> > >
> > > had
> > >
> > > > a lot of testing" is becoming unfair.
> > >
> > > Excellent news!
> > >
> > > > Note that this all is to change in the next major Slony-I
> > >
> > > release;
> > >
> > > > with the changes in trigger support in PG 8.3, there is no longer
> > >
> > > a
> > >
> > > > need to fool with the system catalog, so pg_dump becomes usable
> > >
> > > again.
> > >
> > > Right, I forgot to mention that.
> > >
> > > A
> > > _______________________________________________
> > > Slony1-general mailing list
> > > Slony1-general@lists.slony.info
> > > http://lists.slony.info/mailman/listinfo/slony1-general
> >
> >       __________________________________________________________
> > Sent from Yahoo! Mail - a smarter inbox http://uk.mail.yahoo.com
> >
> >
> > _______________________________________________
> > Slony1-general mailing list
> > Slony1-general@lists.slony.info
> > http://lists.slony.info/mailman/listinfo/slony1-general
> 
> 
> 
> -- 
> Tim Goodaire    416-673-4126    tgoodair@ca.afilias.info
> Database Team Lead, Afilias Canada Corp.
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
> 
> 
> 
> 
> 
> 


-- 
Bill Moran
Collaborative Fusion Inc.
http://people.collaborativefusion.com/~wmoran/

wmoran@collaborativefusion.com
Phone: 412-422-3463x4023

****************************************************************
IMPORTANT: This message contains confidential information and is
intended only for the individual named. If the reader of this
message is not an intended recipient (or the individual
responsible for the delivery of this message to an intended
recipient), please be advised that any re-use, dissemination,
distribution or copying of this message is prohibited. Please
notify the sender immediately by e-mail if you have received
this e-mail by mistake and delete this e-mail from your system.
E-mail transmission cannot be guaranteed to be secure or
error-free as information could be intercepted, corrupted, lost,
destroyed, arrive late or incomplete, or contain viruses. The
sender therefore does not accept liability for any errors or
omissions in the contents of this message, which arise as a
result of e-mail transmission.
****************************************************************
From bnichols at ca.afilias.info  Fri Jan 11 13:01:35 2008
From: bnichols at ca.afilias.info (Brad Nicholson)
Date: Fri Jan 11 12:59:07 2008
Subject: [Slony1-general] What is the risk from running pg_dump on a
	replica
In-Reply-To: <20080111144137.1b8078f6.wmoran@collaborativefusion.com>
References: <281461.25494.qm@web25807.mail.ukl.yahoo.com>
	<200801111303.52827.tgoodair@ca.afilias.info>
	<20080111144137.1b8078f6.wmoran@collaborativefusion.com>
Message-ID: <1200085295.5586.101.camel@bnicholson-desktop>


On Fri, 2008-01-11 at 14:41 -0500, Bill Moran wrote:
> In response to Tim Goodaire <tgoodair@ca.afilias.info>:
> 
> > You could take your backup from the origin instead of the subscriber.
> 
> Note that it seems that you can get the _data_ from the replica (i.e.
> pg_dump -a), but not the schema ... that has to come from the primary
> (or from your original data definition)

Sometimes.  We have databases that where pg_dump will run against the
replica, we have ones that it where it fails the a sanity check and
complains about missing OID's (pg 8.1 in both cases).

You should be able to use PITR against the replica.  You could recover
the replica and then uninstall slony from the recovered node.

-- 
Brad Nicholson  416-673-4106
Database Administrator, Afilias Canada Corp.


From cbbrowne at ca.afilias.info  Fri Jan 11 13:32:54 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri Jan 11 13:33:03 2008
Subject: [Slony1-general] What is the risk from running pg_dump on a
	replica
In-Reply-To: <200801111303.52827.tgoodair@ca.afilias.info> (Tim Goodaire's
	message of "Fri, 11 Jan 2008 13:03:52 -0500")
References: <281461.25494.qm@web25807.mail.ukl.yahoo.com>
	<200801111303.52827.tgoodair@ca.afilias.info>
Message-ID: <60zlvcujy1.fsf@dba2.int.libertyrms.com>

Tim Goodaire <tgoodair@ca.afilias.info> writes:
> You could take your backup from the origin instead of the subscriber.

You can do considerably better than that...

You need to take the *SCHEMA DUMP* from the origin, which isn't hugely
expensive.

You can then take a data-only dump from a subscriber.

You can then meld them together, to give you a Proper Schema, and a
dump that *didn't* have to open a 4-hour-long transaction against the
origin node.
-- 
(format nil "~S@~S" "cbbrowne" "cbbrowne.com")
http://linuxfinances.info/info/sap.html
"So, does this mean goodbye to the "Bluescreen of Death" and hello to
the "Bluescreen of Holy Vengeance?"" -- Observed on Slashdot after
hearing Al Qaeda terrorists may have hacked on Windows XP...
From cbbrowne at ca.afilias.info  Fri Jan 11 13:34:40 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri Jan 11 13:34:48 2008
Subject: [Slony1-general] Slony events in windows
In-Reply-To: <7C0800F63CCF4149AC0FC5EE2A041226036D3DF7@sr002-2k3exc.ateb.com>
	(John Fansler's message of "Fri, 11 Jan 2008 13:27:11 -0500")
References: <7C0800F63CCF4149AC0FC5EE2A041226036D3DF7@sr002-2k3exc.ateb.com>
Message-ID: <60ve60ujv3.fsf@dba2.int.libertyrms.com>

"John Fansler" <John.Fansler@ateb.com> writes:
> I'm currently playing with a slightly older version of slony (1.2.9) included in my postgres windows installation.:p>
>
> :p>?
>
> From reading the docs it appears that log_level of 2 is recommended. The problem is that the amount of logging done at that level takes over the windows application
> event log.:p>
>
> :p>?
>
> Is there a way to configure slony in windows to use its own windows event log instead of the application event log?:p>

I don't know about what happens on Windows...

I will comment that the Next Major Version revises the log levels
considerably, so that you should be able to set log_level to 0, and
get most of the Interesting Stuff.
-- 
output = reverse("gro.mca" "@" "enworbbc")
http://www3.sympatico.ca/cbbrowne/internet.html
"If you give a man a fish, he will eat for a day. If you teach him how
to fish, he will sit in a boat and drink beer all day."
From glynastill at yahoo.co.uk  Fri Jan 11 16:10:48 2008
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Fri Jan 11 16:11:00 2008
Subject: [Slony1-general] What is the risk from running pg_dump on a
	replica
In-Reply-To: <1200085295.5586.101.camel@bnicholson-desktop>
Message-ID: <846188.73276.qm@web25806.mail.ukl.yahoo.com>

I've wedged together 2 posts here:
 
> > > You could take your backup from the origin instead of the
> subscriber.
> > 
> > Note that it seems that you can get the _data_ from the replica
> (i.e.
> > pg_dump -a), but not the schema ... that has to come from the
> primary
> > (or from your original data definition)
> 
> Sometimes.  We have databases that where pg_dump will run against
> the
> replica, we have ones that it where it fails the a sanity check and
> complains about missing OID's (pg 8.1 in both cases).
> 
> You should be able to use PITR against the replica.  You could
> recover
> the replica and then uninstall slony from the recovered node.

I'm guessing this is the easiest option; backup the replica - in the
case of failure restore the replica and remove slony - then set it up
again and resync a new subscriber.


> You can do considerably better than that...

> You need to take the *SCHEMA DUMP* from the origin, which isn't 
> hugely
> expensive.

> You can then take a data-only dump from a subscriber.

> You can then meld them together, to give you a Proper Schema, and a
> dump that *didn't* have to open a 4-hour-long transaction against 
> the
> origin node.

This sounds good, so if I take a schema dump from the publisher and
the data from the subscriber, then theres nothing stopping me
restoring the schema, then the data?

You mention a long transaction against the origin. My assumption was
that during a backup/pg_dump no other operations could happen, is
this correct?

If we were to take backups at night, a 4 hour transaction is not bad
as long as the servers could still write/read data.

Is it a bad idea to purely rely regular schema and data dumps as a
backup? Are there any other backups I should be thinking of doing?
I.e. regular file system backups?

So far from what I've read the backup options are:

WAL incremental backups
File system backups
pg_dump



      __________________________________________________________
Sent from Yahoo! Mail - a smarter inbox http://uk.mail.yahoo.com


From ajs at crankycanuck.ca  Sat Jan 12 05:41:28 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Sat Jan 12 05:41:40 2008
Subject: [Slony1-general] What is the risk from running pg_dump on a
	replica
In-Reply-To: <846188.73276.qm@web25806.mail.ukl.yahoo.com>
References: <1200085295.5586.101.camel@bnicholson-desktop>
	<846188.73276.qm@web25806.mail.ukl.yahoo.com>
Message-ID: <20080112134128.GA12642@crankycanuck.ca>

On Fri, Jan 11, 2008 at 04:10:48PM -0800, Glyn Astill wrote:
> You mention a long transaction against the origin. My assumption was
> that during a backup/pg_dump no other operations could happen, is
> this correct?

Nope.  But pg_dump runs in a transaction, and that will cause Slony's logs
to bloat.

> Is it a bad idea to purely rely regular schema and data dumps as a
> backup? Are there any other backups I should be thinking of doing?
> I.e. regular file system backups?

You should read the Postgres manual about backups.  All the advice there
applies.

A
From glynastill at yahoo.co.uk  Sat Jan 12 09:59:27 2008
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Sat Jan 12 09:59:33 2008
Subject: [Slony1-general] What is the risk from running pg_dump on a
	replica
In-Reply-To: <20080112134128.GA12642@crankycanuck.ca>
Message-ID: <262660.28751.qm@web25803.mail.ukl.yahoo.com>

> 
> > Is it a bad idea to purely rely regular schema and data dumps as
> a
> > backup? Are there any other backups I should be thinking of
> doing?
> > I.e. regular file system backups?
> 
> You should read the Postgres manual about backups.  All the advice
> there
> applies.

But the manual just says the options are pg_dump or filesystem
backup. I want to know what you guys concider a good backup.


      ___________________________________________________________
Yahoo! Answers - Got a question? Someone out there knows the answer. Try it
now.
http://uk.answers.yahoo.com/ 

From craig_james at emolecules.com  Sat Jan 12 17:00:42 2008
From: craig_james at emolecules.com (Craig James)
Date: Sat Jan 12 17:00:52 2008
Subject: [Slony1-general] URGENT: Migration of master node locked my database
In-Reply-To: <D73E09BB-F02E-41A6-A94D-5E069709983B@khera.org>
References: <D73E09BB-F02E-41A6-A94D-5E069709983B@khera.org>
Message-ID: <478962BA.5000609@emolecules.com>

Help please!

I tried to migrate the Slony master node to a new server with this script.  It seemed simple but...

  slonik <<_EOF_                                                                  
                                                                                  
  cluster name = db_cluster;                                                      
  node 1 admin conninfo = 'dbname=db host=host1 user=postgres';                  
  node 2 admin conninfo = 'dbname=db host=host2 user=postgres';                                                                                                   
                                                                                
  lock set (id = 1, origin = 1);                                                  
  wait for event (origin = 1, confirmed = 2);                                     
  move set (id = 1, old origin = 1, new origin = 2);                              
  
  _EOF_

The script sat there for about 30 minutes with no activity.  No CPU load, vmstat didn't show any activity, nothing, so I finally had to kill it.

Now all of my tables are locked, and I can't do our weekend update of our data.  When I try to do anything, I get:

   execute failed: ERROR: Slony-I: Table sample is currently locked against updates because of MOVE_SET operation in progress.

Help!  This is critical.  I need to at least get back to where I can update our database, like TONIGHT!  I thought this would be a fast operation, because in the past (on smaller databases), it's been virtually instantaneous.

1. How do I release the lock?
2. Why didn't the migration work???

Thanks!
Craig
From jeff at frostconsultingllc.com  Sat Jan 12 17:09:27 2008
From: jeff at frostconsultingllc.com (Jeff Frost)
Date: Sat Jan 12 17:09:37 2008
Subject: [Slony1-general] URGENT: Migration of master node locked my
	database
In-Reply-To: <478962BA.5000609@emolecules.com>
References: <D73E09BB-F02E-41A6-A94D-5E069709983B@khera.org>
	<478962BA.5000609@emolecules.com>
Message-ID: <Pine.LNX.4.64.0801121707550.7808@discord.home.frostconsultingllc.com>

On Sat, 12 Jan 2008, Craig James wrote:

> Now all of my tables are locked, and I can't do our weekend update of our 
> data.  When I try to do anything, I get:
>
>  execute failed: ERROR: Slony-I: Table sample is currently locked against 
> updates because of MOVE_SET operation in progress.
>
> Help!  This is critical.  I need to at least get back to where I can update 
> our database, like TONIGHT!  I thought this would be a fast operation, 
> because in the past (on smaller databases), it's been virtually 
> instantaneous.
>
> 1. How do I release the lock?
> 2. Why didn't the migration work???
>

Craig,

You can unlock it with the UNLOCK SET command.  You can find it here in the 
docs:

http://slony.info/documentation/stmtunlockset.html

I'd check the logs to see if there are any clues as to why the move set failed 
to complete.

BTW, what version of slony are you using?

-- 
Jeff Frost, Owner 	<jeff@frostconsultingllc.com>
Frost Consulting, LLC 	http://www.frostconsultingllc.com/
Phone: 650-780-7908	FAX: 650-649-1954
From craig_james at emolecules.com  Sat Jan 12 17:34:13 2008
From: craig_james at emolecules.com (Craig James)
Date: Sat Jan 12 17:34:23 2008
Subject: [Slony1-general] URGENT: Migration of master node locked my
	database
In-Reply-To: <Pine.LNX.4.64.0801121707550.7808@discord.home.frostconsultingllc.com>
References: <D73E09BB-F02E-41A6-A94D-5E069709983B@khera.org>
	<478962BA.5000609@emolecules.com>
	<Pine.LNX.4.64.0801121707550.7808@discord.home.frostconsultingllc.com>
Message-ID: <47896A95.4030001@emolecules.com>

Jeff Frost wrote:
> On Sat, 12 Jan 2008, Craig James wrote:
> =

>> Now all of my tables are locked, and I can't do our weekend update of =

>> our data.  When I try to do anything, I get:
>>
>>  execute failed: ERROR: Slony-I: Table sample is currently locked =

>> against updates because of MOVE_SET operation in progress.
>>
>> Help!  This is critical.  I need to at least get back to where I can =

>> update our database, like TONIGHT!  I thought this would be a fast =

>> operation, because in the past (on smaller databases), it's been =

>> virtually instantaneous.
>>
>> 1. How do I release the lock?
>> 2. Why didn't the migration work???
>>
> =

> Craig,
> =

> You can unlock it with the UNLOCK SET command.  You can find it here in =

> the docs:
> =

> http://slony.info/documentation/stmtunlockset.html

Thanks, Jeff, you saved my day.


> I'd check the logs to see if there are any clues as to why the move set =

> failed to complete.

Nothing jumps out at me.  On the master node, there's nothing at all during=
 the time the script was running.  Just a bunch of "DST DEBUG1 cleanupThrea=
d" events, nothing else.

On the slave node, there are some messages; maybe the attached logfile will=
 mean something to you.

One fact I discovered: The clocks on the two machines were badly out of syn=
c, about 30 minutes.  I assume this is a Bad Thing?

Another fact: After the migrate-node operation failed, I had to restart Pos=
tgres because one Postgres process was using 100% CPU, and several hundred =
other processes were waiting on SELECT statements -- the CPU was rapidly ge=
tting wedged and wasn't far from locking up altogether.  (These were web-si=
te visitors trying to do queries, each one caused another blocked process.)

So the "lost connection" message may be when I shut down Postgres.

> BTW, what version of slony are you using?

Version 1.2.9, Postgres 8.1.4.

Thanks,
Craig

-------------- next part --------------
2008-01-12 16:24:08 PST DEBUG2 remoteWorkerThread_1: current local log_stat=
us is 0
2008-01-12 16:24:08 PST DEBUG2 remoteWorkerThread_1_1: current remote log_s=
tatus =3D 0
2008-01-12 16:24:08 PST DEBUG2 remoteHelperThread_1_1: 0.003 seconds delay =
for first row
2008-01-12 16:24:08 PST DEBUG2 remoteHelperThread_1_1: 0.004 seconds until =
close cursor
2008-01-12 16:24:08 PST DEBUG2 remoteHelperThread_1_1: inserts=3D0 updates=
=3D0 deletes=3D0
2008-01-12 16:24:08 PST DEBUG2 remoteWorkerThread_1: new sl_rowid_seq value=
: 1000000000000000
2008-01-12 16:24:08 PST DEBUG2 remoteWorkerThread_1: SYNC 791981 done in 0.=
011 seconds
2008-01-12 16:24:16 PST DEBUG2 remoteListenThread_1: LISTEN
2008-01-12 16:24:17 PST DEBUG2 syncThread: new sl_action_seq 1 - SYNC 759693
2008-01-12 16:24:17 PST DEBUG2 remoteWorkerThread_1: forward confirm 2,7596=
93 received by 1
2008-01-12 16:24:17 PST ERROR  remoteListenThread_1: "select ev_origin, ev_=
seqno, ev_timestamp,        ev_minxid, ev_maxxid, ev_xip,        ev_type,  =
      ev_data1, ev_data2,        ev_data3, ev_data4,        ev_data5, ev_da=
ta6,        ev_data7, ev_data8 from "_emol_warehouse_1_cluster".sl_event e =
where (e.ev_origin =3D '1' and e.ev_seqno > '791981') order by e.ev_origin,=
 e.ev_seqno" - FATAL:  terminating connection due to administrator command
2008-01-12 16:24:20 PST DEBUG2 localListenThread: Received event 2,759693 S=
YNC
2008-01-12 16:24:27 PST DEBUG2 syncThread: new sl_action_seq 1 - SYNC 759694
2008-01-12 16:24:31 PST DEBUG1 remoteListenThread_1: connected to 'dbname=
=3Demol_warehouse_1  host=3Dradon user=3Dpostgres'
2008-01-12 16:24:32 PST DEBUG2 localListenThread: Received event 2,759694 S=
YNC
2008-01-12 16:24:32 PST DEBUG2 remoteWorkerThread_1: forward confirm 2,7596=
94 received by 1
2008-01-12 16:24:35 PST DEBUG2 remoteListenThread_1: queue event 1,791982 S=
YNC
2008-01-12 16:24:35 PST DEBUG2 remoteListenThread_1: UNLISTEN
2008-01-12 16:24:35 PST DEBUG2 remoteWorkerThread_1: Received event 1,79198=
2 SYNC
2008-01-12 16:24:35 PST DEBUG2 remoteWorkerThread_1: SYNC 791982 processing
2008-01-12 16:24:35 PST DEBUG2 remoteWorkerThread_1: syncing set 1 with 19 =
table(s) from provider 1
2008-01-12 16:24:35 PST DEBUG2  ssy_action_list length: 0
2008-01-12 16:24:35 PST DEBUG2 remoteWorkerThread_1: current local log_stat=
us is 0
2008-01-12 16:24:35 PST ERROR  remoteWorkerThread_1: "start transaction; se=
t enable_seqscan =3D off; set enable_indexscan =3D on; " PGRES_FATAL_ERROR =
FATAL:  terminating connection due to administrator command
server closed the connection unexpectedly
	This probably means the server terminated abnormally
	before or while processing the request.
2008-01-12 16:24:35 PST ERROR  remoteWorkerThread_1: "close LOG; " PGRES_FA=
TAL_ERROR 2008-01-12 16:24:35 PST ERROR  remoteWorkerThread_1: "rollback tr=
ansaction; set enable_seqscan =3D default; set enable_indexscan =3D default=
; " PGRES_FATAL_ERROR 2008-01-12 16:24:35 PST DEBUG2 remoteHelperThread_1_1=
: 26.656 seconds until close cursor
2008-01-12 16:24:35 PST DEBUG2 remoteHelperThread_1_1: inserts=3D0 updates=
=3D0 deletes=3D0
2008-01-12 16:24:35 PST ERROR  remoteWorkerThread_1: helper 1 finished with=
 error
2008-01-12 16:24:35 PST ERROR  remoteWorkerThread_1: SYNC aborted
2008-01-12 16:24:37 PST DEBUG2 syncThread: new sl_action_seq 1 - SYNC 759695
2008-01-12 16:24:38 PST DEBUG2 localListenThread: Received event 2,759695 S=
YNC
2008-01-12 16:24:43 PST DEBUG2 remoteListenThread_1: LISTEN
2008-01-12 16:24:45 PST DEBUG2 remoteListenThread_1: queue event 1,791983 S=
YNC
2008-01-12 16:24:45 PST DEBUG2 remoteListenThread_1: UNLISTEN
2008-01-12 16:24:45 PST DEBUG2 remoteWorkerThread_1: SYNC 791982 processing
2008-01-12 16:24:45 PST DEBUG1 remoteWorkerThread_1: connected to data prov=
ider 1 on 'dbname=3Demol_warehouse_1  host=3Dradon user=3Dpostgres'
2008-01-12 16:24:45 PST DEBUG2 remoteWorkerThread_1: syncing set 1 with 19 =
table(s) from provider 1
2008-01-12 16:24:45 PST DEBUG2  ssy_action_list length: 0
2008-01-12 16:24:45 PST DEBUG2 remoteWorkerThread_1: current local log_stat=
us is 0
2008-01-12 16:24:45 PST DEBUG2 remoteWorkerThread_1_1: current remote log_s=
tatus =3D 0
2008-01-12 16:24:46 PST DEBUG2 remoteHelperThread_1_1: 0.794 seconds delay =
for first row
2008-01-12 16:24:46 PST DEBUG2 remoteHelperThread_1_1: 0.794 seconds until =
close cursor
2008-01-12 16:24:46 PST DEBUG2 remoteHelperThread_1_1: inserts=3D0 updates=
=3D0 deletes=3D0
2008-01-12 16:24:46 PST DEBUG2 remoteWorkerThread_1: new sl_rowid_seq value=
: 1000000000000000
2008-01-12 16:24:46 PST DEBUG2 remoteWorkerThread_1: SYNC 791982 done in 1.=
066 seconds
2008-01-12 16:24:46 PST DEBUG2 remoteWorkerThread_1: forward confirm 2,7596=
95 received by 1
2008-01-12 16:24:46 PST DEBUG2 remoteWorkerThread_1: Received event 1,79198=
3 SYNC
2008-01-12 16:24:46 PST DEBUG2 remoteWorkerThread_1: SYNC 791983 processing
2008-01-12 16:24:46 PST DEBUG2 remoteWorkerThread_1: syncing set 1 with 19 =
table(s) from provider 1
2008-01-12 16:24:46 PST DEBUG2  ssy_action_list length: 0
2008-01-12 16:24:46 PST DEBUG2 remoteWorkerThread_1: current local log_stat=
us is 0
2008-01-12 16:24:46 PST DEBUG2 remoteWorkerThread_1_1: current remote log_s=
tatus =3D 0
2008-01-12 16:24:46 PST DEBUG2 remoteHelperThread_1_1: 0.001 seconds delay =
for first row
From jeff at frostconsultingllc.com  Sat Jan 12 17:51:57 2008
From: jeff at frostconsultingllc.com (Jeff Frost)
Date: Sat Jan 12 17:52:08 2008
Subject: [Slony1-general] URGENT: Migration of master node locked my
	database
In-Reply-To: <47896A95.4030001@emolecules.com>
References: <D73E09BB-F02E-41A6-A94D-5E069709983B@khera.org>
	<478962BA.5000609@emolecules.com>
	<Pine.LNX.4.64.0801121707550.7808@discord.home.frostconsultingllc.com>
	<47896A95.4030001@emolecules.com>
Message-ID: <Pine.LNX.4.64.0801121737380.7808@discord.home.frostconsultingllc.com>

On Sat, 12 Jan 2008, Craig James wrote:

>> You can unlock it with the UNLOCK SET command.  You can find it here in the 
>> docs:
>> 
>> http://slony.info/documentation/stmtunlockset.html
>
> Thanks, Jeff, you saved my day.

I've had it happen to me before as well.  Interestingly, after unlocking the 
set in the past, I've been able to successfully lock and move the set almost 
immediately afterwards.  That was a few revisions of slony back though, so 
your mileage may vary.

>> I'd check the logs to see if there are any clues as to why the move set 
>> failed to complete.
>
> Nothing jumps out at me.  On the master node, there's nothing at all during 
> the time the script was running.  Just a bunch of "DST DEBUG1 cleanupThread" 
> events, nothing else.
>
> On the slave node, there are some messages; maybe the attached logfile will 
> mean something to you.
>

It looks like it was successfully syncing prior to you killing it and 
restarting postgres, but we've only got about a minute's worth of log data 
here.  It would probably be interesting to see immediately after you started 
the move set.  You might need to grep out the uninteresting bits.

> One fact I discovered: The clocks on the two machines were badly out of sync, 
> about 30 minutes.  I assume this is a Bad Thing?

It's officially listed as a requirement here: 
http://slony.info/documentation/requirements.html

You might check the slon logs for any indication this is what caused your 
problem.  I thought slon did its work based entirely on xxid, but I could be 
wrong.  Perhaps one of the developers will comment.  In any event, I'm sure 
you know the clocks should be in sync as a best practice.

>
> Another fact: After the migrate-node operation failed, I had to restart 
> Postgres because one Postgres process was using 100% CPU, and several hundred 
> other processes were waiting on SELECT statements -- the CPU was rapidly 
> getting wedged and wasn't far from locking up altogether.  (These were 
> web-site visitors trying to do queries, each one caused another blocked 
> process.)
>
> So the "lost connection" message may be when I shut down Postgres.
>
>> BTW, what version of slony are you using?
>
> Version 1.2.9, Postgres 8.1.4.

You should upgrade both.  The postgresql 8.1 branch is up to: 8.1.11, so that 
puts you 7 revisions back.  There are lots of important bug fixes in those 
revisions.  Upgrading to 8.1.11 is relatively painless as it can be done in 
place.  You should probably consider upgrading to 8.2.6 when you have a 
chance.

Slony is up to 1.2.12 and also has lots of important bug fixes in 
those revisions.

-- 
Jeff Frost, Owner 	<jeff@frostconsultingllc.com>
Frost Consulting, LLC 	http://www.frostconsultingllc.com/
Phone: 650-780-7908	FAX: 650-649-1954
From g0chman at gmail.com  Sun Jan 13 07:35:58 2008
From: g0chman at gmail.com (=?ISO-8859-1?Q?Jaison_J._Gonz=E1lez_Chaux?=)
Date: Sun Jan 13 07:36:04 2008
Subject: [Slony1-general] Re: Query about Slony-i from Colombia
In-Reply-To: <6d3ad6bd0801101423y53b071adg4f47b0cede917d00@mail.gmail.com>
References: <6d3ad6bd0801101410o5b98ab49icbc14e950bcaebde@mail.gmail.com>
	<6d3ad6bd0801101419t2fec75e7r2f0c60876acd185a@mail.gmail.com>
	<6d3ad6bd0801101423y53b071adg4f47b0cede917d00@mail.gmail.com>
Message-ID: <6d3ad6bd0801130735o6d8e4b38v68c97760c2225205@mail.gmail.com>

Hi,

First of all, i would like give my most sincere thanks to Mr. Christopher
Brownes for his help in slony-I replication, now I have to create a new set.

Before I did have this one

Cluster_1


/\


                              /      \


                           /            \

                                                                 Cluster_2
           Cluster_3

Now I do have to create a scheme like this one:


Cluster_1


                                                     /\


                              /      \


                           /            \

                                                                 Cluster_2
           Cluster_3


                        /\


                              /       \


                           /             \


             Cluster_4            Cluster_5

For what I have created this configuration files:

config.conf
###########################################################################=
###############################
cluster name=3DCluster_1;

node 1 admin conninfo =3D 'dbname=3DDB_Cluster_1 host=3D127.0.0.1 user=3Dro=
ot
password=3Droot port=3D5435';
node 2 admin conninfo =3D 'dbname=3DDB_Cluster_2 host=3D127.0.0.1 user=3Dro=
ot
password=3Droot port=3D5436';
node 3 admin conninfo =3D 'dbname=3DDB_Cluster_3 host=3D127.0.0.1 user=3Dro=
ot
password=3Droot port=3D5437';
node 4 admin conninfo =3D 'dbname=3DDB_Cluster_4 host=3D127.0.0.1 user=3Dro=
ot
password=3Droot port=3D5438';
node 5 admin conninfo =3D 'dbname=3DDB_Cluster_5 host=3D127.0.0.1 user=3Dro=
ot
password=3Droot port=3D5439';

 init cluster (id=3D1, comment=3D'Nodo maestro del Cluster_2 y Cluster_3');
#init cluster (id=3D3, comment=3D'Nodo maestro del Cluster_4 y Cluster_5');

 create set (id=3D1, origin=3D1, comment=3D'aqui van todas las tablas del
Cluster_1');
#create set (id=3D3, origin=3D3, comment=3D'aqui van todas mis tablas del
Cluster_2');

 set add table (set id=3D1, origin=3D1, id=3D1, fully qualified name=3D'
public.Personas', comment=3D'tabla de Personas del Cluster_1');
#set add table (set id=3D2, origin=3D2, id=3D2, fully qualified name=3D'
public.Personas', comment=3D'tabla de Personas del Cluster_2');
#set add table (set id=3D3, origin=3D3, id=3D3, fully qualified name=3D'
public.Personas', comment=3D'tabla de Personas del Cluster_3');

store node (id=3D2, comment=3D'Nodo esclavo Cluster_2');
store node (id=3D3, comment=3D'Nodo esclavo Cluster_3');
store node (id=3D4, comment=3D'Nodo esclavo Cluster_4');
store node (id=3D5, comment=3D'Nodo esclavo Cluster_5');

store path (server=3D1, client=3D2, conninfo=3D'dbname=3DDB_Cluster_1
host=3D127.0.0.1user=3Droot password=3Droot port=3D5435');
store path (server=3D1, client=3D3, conninfo=3D'dbname=3DDB_Cluster_1
host=3D127.0.0.1user=3Droot password=3Droot port=3D5435');
store path (server=3D1, client=3D4, conninfo=3D'dbname=3DDB_Cluster_1
host=3D127.0.0.1user=3Droot password=3Droot port=3D5435');
store path (server=3D1, client=3D5, conninfo=3D'dbname=3DDB_Cluster_1
host=3D127.0.0.1user=3Droot password=3Droot port=3D5435');
store path (server=3D2, client=3D1, conninfo=3D'dbname=3DDB_Cluster_2
host=3D127.0.0.1user=3Droot password=3Droot port=3D5436');
store path (server=3D2, client=3D3, conninfo=3D'dbname=3DDB_Cluster_2
host=3D127.0.0.1user=3Droot password=3Droot port=3D5436');
store path (server=3D2, client=3D4, conninfo=3D'dbname=3DDB_Cluster_2
host=3D127.0.0.1user=3Droot password=3Droot port=3D5436');
store path (server=3D2, client=3D5, conninfo=3D'dbname=3DDB_Cluster_2
host=3D127.0.0.1user=3Droot password=3Droot port=3D5436');
store path (server=3D3, client=3D1, conninfo=3D'dbname=3DDB_Cluster_3
host=3D127.0.0.1user=3Droot password=3Droot port=3D5437');
store path (server=3D3, client=3D2, conninfo=3D'dbname=3DDB_Cluster_3
host=3D127.0.0.1user=3Droot password=3Droot port=3D5437');
store path (server=3D3, client=3D4, conninfo=3D'dbname=3DDB_Cluster_3
host=3D127.0.0.1user=3Droot password=3Droot port=3D5437');
store path (server=3D3, client=3D5, conninfo=3D'dbname=3DDB_Cluster_3
host=3D127.0.0.1user=3Droot password=3Droot port=3D5437');
store path (server=3D4, client=3D1, conninfo=3D'dbname=3DDB_Cluster_4
host=3D127.0.0.1user=3Droot password=3Droot port=3D5438');
store path (server=3D4, client=3D2, conninfo=3D'dbname=3DDB_Cluster_4
host=3D127.0.0.1user=3Droot password=3Droot port=3D5438');
store path (server=3D4, client=3D3, conninfo=3D'dbname=3DDB_Cluster_4
host=3D127.0.0.1user=3Droot password=3Droot port=3D5438');
store path (server=3D4, client=3D5, conninfo=3D'dbname=3DDB_Cluster_4
host=3D127.0.0.1user=3Droot password=3Droot port=3D5438');
store path (server=3D5, client=3D1, conninfo=3D'dbname=3DDB_Cluster_5
host=3D127.0.0.1user=3Droot password=3Droot port=3D5439');
store path (server=3D5, client=3D2, conninfo=3D'dbname=3DDB_Cluster_5
host=3D127.0.0.1user=3Droot password=3Droot port=3D5439');
store path (server=3D5, client=3D3, conninfo=3D'dbname=3DDB_Cluster_5
host=3D127.0.0.1user=3Droot password=3Droot port=3D5439');
store path (server=3D5, client=3D4, conninfo=3D'dbname=3DDB_Cluster_5
host=3D127.0.0.1user=3Droot password=3Droot port=3D5439');

store listen (origin=3D1, provider=3D1, receiver=3D2);
store listen (origin=3D1, provider=3D1, receiver=3D3);
store listen (origin=3D1, provider=3D1, receiver=3D4);
store listen (origin=3D1, provider=3D1, receiver=3D5);
store listen (origin=3D2, provider=3D2, receiver=3D1);
store listen (origin=3D2, provider=3D2, receiver=3D3);
store listen (origin=3D2, provider=3D2, receiver=3D4);
store listen (origin=3D2, provider=3D2, receiver=3D5);
store listen (origin=3D3, provider=3D3, receiver=3D1);
store listen (origin=3D3, provider=3D3, receiver=3D2);
store listen (origin=3D3, provider=3D3, receiver=3D4);
store listen (origin=3D3, provider=3D3, receiver=3D5);
store listen (origin=3D4, provider=3D4, receiver=3D1);
store listen (origin=3D4, provider=3D4, receiver=3D2);
store listen (origin=3D4, provider=3D4, receiver=3D3);
store listen (origin=3D4, provider=3D4, receiver=3D5);
store listen (origin=3D5, provider=3D5, receiver=3D1);
store listen (origin=3D5, provider=3D5, receiver=3D2);
store listen (origin=3D5, provider=3D5, receiver=3D3);
store listen (origin=3D5, provider=3D5, receiver=3D4);
###########################################################################=
###############################

 Config2.conf
###########################################################################=
###############################
cluster name=3DCluster_1;

node 1 admin conninfo =3D 'dbname=3DDB_Cluster_1 host=3D127.0.0.1 user=3Dro=
ot
password=3Droot port=3D5435';
node 2 admin conninfo =3D 'dbname=3DDB_Cluster_2 host=3D127.0.0.1 user=3Dro=
ot
password=3Droot port=3D5436';
node 3 admin conninfo =3D 'dbname=3DDB_Cluster_3 host=3D127.0.0.1 user=3Dro=
ot
password=3Droot port=3D5437';
node 4 admin conninfo =3D 'dbname=3DDB_Cluster_4 host=3D127.0.0.1 user=3Dro=
ot
password=3Droot port=3D5438';
node 5 admin conninfo =3D 'dbname=3DDB_Cluster_5 host=3D127.0.0.1 user=3Dro=
ot
password=3Droot port=3D5439';

 SUBSCRIBE SET (ID=3D1, PROVIDER=3D1, RECEIVER=3D2, FORWARD=3DYES);
SUBSCRIBE SET (ID=3D1, PROVIDER=3D1, RECEIVER=3D3, FORWARD=3DYES);
SUBSCRIBE SET (ID=3D1, PROVIDER=3D1, RECEIVER=3D4, FORWARD=3DYES);
SUBSCRIBE SET (ID=3D1, PROVIDER=3D1, RECEIVER=3D5, FORWARD=3DYES);
###########################################################################=
###############################

So I tried restricting some of the lines in the "strore path" and "store
listen" in the config.conf, and on the config2.con the subscribe but
apparently did not workout, because when I ran the slonik config.conf it
said:

 Tabla de c=F3digos activa: 1252

C:\Archivos de programa\PostgreSQL\8.2\bin>slonik config.conf
config.conf:50: Error: namespace "_Cluster_1" already exists in database of
node 3

but when i leave as it was at the begginis (all of the nodes replicating to
Cluster_1) it works out very well, and do replicates the data as its ment to
be.

 In other hand I need to implement failover (to node 2 instead of node 1),
so I created a

 failover.conf
###########################################################################=
###############################
failover (id=3D1, backup node=3D2);
###########################################################################=
###############################

 But once again it showed me an error message=85

C:\Archivos de programa\PostgreSQL\8.2\bin>slonik config.conf

 C:\Archivos de programa\PostgreSQL\8.2\bin>slonik config2.conf

C:\Archivos de programa\PostgreSQL\8.2\bin>slonik failover.conf
failover.conf:9: ERROR: syntax error at or near failover

I will really appreciate if anyone can help me out with it=85

Jaison Jos=E9 Gonz=E1lez Chaux
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080113/=
f0f35f9b/attachment-0001.htm
From ajs at crankycanuck.ca  Sun Jan 13 09:22:41 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Sun Jan 13 09:22:55 2008
Subject: [Slony1-general] URGENT: Migration of master node locked my
	database
In-Reply-To: <Pine.LNX.4.64.0801121737380.7808@discord.home.frostconsultingllc.com>
References: <D73E09BB-F02E-41A6-A94D-5E069709983B@khera.org>
	<478962BA.5000609@emolecules.com>
	<Pine.LNX.4.64.0801121707550.7808@discord.home.frostconsultingllc.com>
	<47896A95.4030001@emolecules.com>
	<Pine.LNX.4.64.0801121737380.7808@discord.home.frostconsultingllc.com>
Message-ID: <20080113172241.GA22741@crankycanuck.ca>

On Sat, Jan 12, 2008 at 05:51:57PM -0800, Jeff Frost wrote:
> You might check the slon logs for any indication this is what caused your 
> problem.  I thought slon did its work based entirely on xxid, but I could 
> be wrong.  Perhaps one of the developers will comment.  In any event, I'm 
> sure you know the clocks should be in sync as a best practice.

Not entirely based on xxid, no.  They can't be synced across nodes.  You
_must_ be nntp-synced between your nodes.  They should peer from one
another, and _then_ get their time from some other source.

A

From bnichols at ca.afilias.info  Mon Jan 14 06:06:13 2008
From: bnichols at ca.afilias.info (Brad Nicholson)
Date: Mon Jan 14 06:03:18 2008
Subject: [Slony1-general] What is the risk from running pg_dump on a
	replica
In-Reply-To: <60zlvcujy1.fsf@dba2.int.libertyrms.com>
References: <281461.25494.qm@web25807.mail.ukl.yahoo.com>
	<200801111303.52827.tgoodair@ca.afilias.info>
	<60zlvcujy1.fsf@dba2.int.libertyrms.com>
Message-ID: <1200319573.5586.104.camel@bnicholson-desktop>


On Fri, 2008-01-11 at 16:32 -0500, Christopher Browne wrote:
> Tim Goodaire <tgoodair@ca.afilias.info> writes:
> > You could take your backup from the origin instead of the subscriber.
> 
> You can do considerably better than that...
> 
> You need to take the *SCHEMA DUMP* from the origin, which isn't hugely
> expensive.
> 
> You can then take a data-only dump from a subscriber.

Sometimes.  

Sometimes the data only pg_dump will also fails with missing OID
warnings.

-- 
Brad Nicholson  416-673-4106
Database Administrator, Afilias Canada Corp.


From glynastill at yahoo.co.uk  Mon Jan 14 07:32:01 2008
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Mon Jan 14 07:32:08 2008
Subject: [Slony1-general] What is the risk from running pg_dump on a
	replica
In-Reply-To: <1200319573.5586.104.camel@bnicholson-desktop>
Message-ID: <6671.50335.qm@web25809.mail.ukl.yahoo.com>

> On Fri, 2008-01-11 at 16:32 -0500, Christopher Browne wrote:
> > Tim Goodaire <tgoodair@ca.afilias.info> writes:
> > > You could take your backup from the origin instead of the
> subscriber.
> > 
> > You can do considerably better than that...
> > 
> > You need to take the *SCHEMA DUMP* from the origin, which isn't
> hugely
> > expensive.
> > 
> > You can then take a data-only dump from a subscriber.
> 
> Sometimes.  
> 
> Sometimes the data only pg_dump will also fails with missing OID
> warnings.
> 

Um, this isn't exactly filling me with confidence about my backups...


      __________________________________________________________
Sent from Yahoo! Mail - a smarter inbox http://uk.mail.yahoo.com


From vivek at khera.org  Mon Jan 14 08:34:45 2008
From: vivek at khera.org (Vivek Khera)
Date: Mon Jan 14 08:34:51 2008
Subject: [Slony1-general] What is the risk from running pg_dump on a
	replica
In-Reply-To: <1200319573.5586.104.camel@bnicholson-desktop>
References: <281461.25494.qm@web25807.mail.ukl.yahoo.com>
	<200801111303.52827.tgoodair@ca.afilias.info>
	<60zlvcujy1.fsf@dba2.int.libertyrms.com>
	<1200319573.5586.104.camel@bnicholson-desktop>
Message-ID: <91BBFA54-0976-443A-8F77-2ED3BAE21B57@khera.org>


On Jan 14, 2008, at 9:06 AM, Brad Nicholson wrote:

> Sometimes the data only pg_dump will also fails with missing OID
> warnings.

What conditions would cause this?  Do you dump your data with OIDs?   
Are your schemas not 100% consistent?

I've been doing dumps "split" dumps like this for a long time and  
never had a failure, so I'm curious what conditions could cause it.

From bnichols at ca.afilias.info  Mon Jan 14 08:53:44 2008
From: bnichols at ca.afilias.info (Brad Nicholson)
Date: Mon Jan 14 08:50:50 2008
Subject: [Slony1-general] What is the risk from running pg_dump on a
	replica
In-Reply-To: <91BBFA54-0976-443A-8F77-2ED3BAE21B57@khera.org>
References: <281461.25494.qm@web25807.mail.ukl.yahoo.com>
	<200801111303.52827.tgoodair@ca.afilias.info>
	<60zlvcujy1.fsf@dba2.int.libertyrms.com>
	<1200319573.5586.104.camel@bnicholson-desktop>
	<91BBFA54-0976-443A-8F77-2ED3BAE21B57@khera.org>
Message-ID: <1200329624.5586.108.camel@bnicholson-desktop>

On Mon, 2008-01-14 at 11:34 -0500, Vivek Khera wrote:
> On Jan 14, 2008, at 9:06 AM, Brad Nicholson wrote:
> 
> > Sometimes the data only pg_dump will also fails with missing OID
> > warnings.
> 
> What conditions would cause this?  Do you dump your data with OIDs?   
> Are your schemas not 100% consistent?

I'm not sure what the cause is. 
 
Schemas are 100% consistent (an audit had been done prior).  Dump was
just a standard pg_dump with the data only falg, no OIDs.

> I've been doing dumps "split" dumps like this for a long time and  
> never had a failure, so I'm curious what conditions could cause it.

If I had to guess, I'd say that the way slony corrupts the schema is
sometimes tripping the santiy check in pg_dump, and sometimes it isn't.

-- 
Brad Nicholson  416-673-4106
Database Administrator, Afilias Canada Corp.


From craig_james at emolecules.com  Mon Jan 14 10:56:30 2008
From: craig_james at emolecules.com (Craig James)
Date: Mon Jan 14 10:56:38 2008
Subject: [Slony1-general] URGENT: Migration of master node locked
	my	database
In-Reply-To: <20080113172241.GA22741@crankycanuck.ca>
References: <D73E09BB-F02E-41A6-A94D-5E069709983B@khera.org>	<478962BA.5000609@emolecules.com>	<Pine.LNX.4.64.0801121707550.7808@discord.home.frostconsultingllc.com>	<47896A95.4030001@emolecules.com>	<Pine.LNX.4.64.0801121737380.7808@discord.home.frostconsultingllc.com>
	<20080113172241.GA22741@crankycanuck.ca>
Message-ID: <478BB05E.2040802@emolecules.com>

Andrew Sullivan wrote:
> On Sat, Jan 12, 2008 at 05:51:57PM -0800, Jeff Frost wrote:
>> You might check the slon logs for any indication this is what caused your 
>> problem.  I thought slon did its work based entirely on xxid, but I could 
>> be wrong.  Perhaps one of the developers will comment.  In any event, I'm 
>> sure you know the clocks should be in sync as a best practice.
> 
> Not entirely based on xxid, no.  They can't be synced across nodes.  You
> _must_ be nntp-synced between your nodes.  They should peer from one
> another, and _then_ get their time from some other source.

I want to be sure I understand this: Are you saying that a few milliseconds of time skew between servers will make Slony fail?

Craig

From bnichols at ca.afilias.info  Mon Jan 14 11:50:47 2008
From: bnichols at ca.afilias.info (Brad Nicholson)
Date: Mon Jan 14 11:50:55 2008
Subject: [Slony1-general] URGENT: Migration of master node locked
	my	database
In-Reply-To: <478BB05E.2040802@emolecules.com>
References: <D73E09BB-F02E-41A6-A94D-5E069709983B@khera.org>
	<478962BA.5000609@emolecules.com>
	<Pine.LNX.4.64.0801121707550.7808@discord.home.frostconsultingllc.com>
	<47896A95.4030001@emolecules.com>
	<Pine.LNX.4.64.0801121737380.7808@discord.home.frostconsultingllc.com>
	<20080113172241.GA22741@crankycanuck.ca>
	<478BB05E.2040802@emolecules.com>
Message-ID: <1200340247.5586.115.camel@bnicholson-desktop>


On Mon, 2008-01-14 at 10:56 -0800, Craig James wrote:
> Andrew Sullivan wrote:
> > On Sat, Jan 12, 2008 at 05:51:57PM -0800, Jeff Frost wrote:
> >> You might check the slon logs for any indication this is what caused your 
> >> problem.  I thought slon did its work based entirely on xxid, but I could 
> >> be wrong.  Perhaps one of the developers will comment.  In any event, I'm 
> >> sure you know the clocks should be in sync as a best practice.
> > 
> > Not entirely based on xxid, no.  They can't be synced across nodes.  You
> > _must_ be nntp-synced between your nodes.  They should peer from one
> > another, and _then_ get their time from some other source.
> 
> I want to be sure I understand this: Are you saying that a few milliseconds of time skew between servers will make Slony fail?
> 

No, it won't.  There is always going to be some minor skew, even when
synced with NTP.

-- 
Brad Nicholson  416-673-4106
Database Administrator, Afilias Canada Corp.


From craig_james at emolecules.com  Mon Jan 14 15:49:42 2008
From: craig_james at emolecules.com (Craig James)
Date: Mon Jan 14 15:49:52 2008
Subject: [Slony1-general] URGENT: Migration of master node
	locked	my	database
In-Reply-To: <1200340247.5586.115.camel@bnicholson-desktop>
References: <D73E09BB-F02E-41A6-A94D-5E069709983B@khera.org>	
	<478962BA.5000609@emolecules.com>	
	<Pine.LNX.4.64.0801121707550.7808@discord.home.frostconsultingllc.com>	
	<47896A95.4030001@emolecules.com>	
	<Pine.LNX.4.64.0801121737380.7808@discord.home.frostconsultingllc.com>	
	<20080113172241.GA22741@crankycanuck.ca>
	<478BB05E.2040802@emolecules.com>
	<1200340247.5586.115.camel@bnicholson-desktop>
Message-ID: <478BF516.8070501@emolecules.com>

Brad Nicholson wrote:
>> Andrew Sullivan wrote:
>>> On Sat, Jan 12, 2008 at 05:51:57PM -0800, Jeff Frost wrote:
>>>> You might check the slon logs for any indication this is what caused your 
>>>> problem.  I thought slon did its work based entirely on xxid, but I could 
>>>> be wrong.  Perhaps one of the developers will comment.  In any event, I'm 
>>>> sure you know the clocks should be in sync as a best practice.
>>> Not entirely based on xxid, no.  They can't be synced across nodes.  You
>>> _must_ be nntp-synced between your nodes.  They should peer from one
>>> another, and _then_ get their time from some other source.
>> I want to be sure I understand this: Are you saying that a few milliseconds
>>  of time skew between servers will make Slony fail?
>>
> 
> No, it won't.  There is always going to be some minor skew, even when
> synced with NTP.

Then why is it required to run  nntp between nodes, and only have one external connection to a time server?  Even using independent connections to a time service, the various Slony hosts keep their clocks very closely synchronized.  If a few milliseconds doesn't matter, then it seems to me that an ordinary ntpd(1) should be good enough.

Is there an actual spec for "how much time skew is too much" for Slony?  Like, "All hosts must have their clocks synced within 100 msec."  Or is it just a "good idea" that's not formalized?

What are the consequences of having to servers with out-of-sync clocks?

Thanks,
Craig


From g0chman at gmail.com  Mon Jan 14 15:51:01 2008
From: g0chman at gmail.com (=?ISO-8859-1?Q?Jaison_J._Gonz=E1lez_Chaux?=)
Date: Mon Jan 14 15:51:10 2008
Subject: [Slony1-general] Re: Query about Slony-i from Colombia
In-Reply-To: <6d3ad6bd0801130735o6d8e4b38v68c97760c2225205@mail.gmail.com>
References: <6d3ad6bd0801101410o5b98ab49icbc14e950bcaebde@mail.gmail.com>
	<6d3ad6bd0801101419t2fec75e7r2f0c60876acd185a@mail.gmail.com>
	<6d3ad6bd0801101423y53b071adg4f47b0cede917d00@mail.gmail.com>
	<6d3ad6bd0801130735o6d8e4b38v68c97760c2225205@mail.gmail.com>
Message-ID: <6d3ad6bd0801141551l4d73b752j95124abc4bd85cd4@mail.gmail.com>

Hi everyone,
I have been on working on my slony-i issue and got parto of the
solution but once again i get an error message and dont really know
what to do next wirh it?.
Now I have a new schema and have already got it working separately,
but I must join it?
I have a Cluster_1, which is the master of Cluster_2 and cluster_3, at
the same time Cluster_3 is the master node of Cluster_4 and Cluster_5,
but Cluster_3 must be linked to Cluster_1 for what I have created two
clusters (two scripts), and got them "working", but when I execute the
script where we specify the SUBSCRIBE SET I get an error message
C:\Archivos de programa\PostgreSQL\8.2\bin>slonik config2_M2.conf
config2_M2.conf:29: PGRES_FATAL_ERROR select
"_Cluster_M".subscribeSet(4, 4, 1,'t');  - ERROR:  Slony-I:
subscribeSet(): set 4 not found

I will really appreciate if anyone can help me out with this? please?

The scripts I am using are these:

First Cluster:
configM1.conf
################################################################################
cluster name=Cluster_1;

node 1 admin conninfo = 'dbname=DB_Cluster_1 host=127.0.0.1 user=root
password=root port=5435';
node 2 admin conninfo = 'dbname=DB_Cluster_2 host=127.0.0.1 user=root
password=root port=5436';
node 3 admin conninfo = 'dbname=DB_Cluster_3 host=127.0.0.1 user=root
password=root port=5437';

init cluster (id=1, comment='Nodo maestro del Cluster_2 y Cluster_3');

create set (id=1, origin=1, comment='aqui van todas las tablas del Cluster_1');

set add table (set id=1, origin=1, id=1, fully qualified
name='public.Personas', comment='tabla de Personas del Cluster_1');

store node (id=2, comment='Nodo esclavo Cluster_2');
store node (id=3, comment='Nodo esclavo Cluster_3');

store path (server=1, client=2, conninfo='dbname=DB_Cluster_1
host=127.0.0.1 user=root password=root port=5435');
store path (server=1, client=3, conninfo='dbname=DB_Cluster_1
host=127.0.0.1 user=root password=root port=5435');
store path (server=2, client=1, conninfo='dbname=DB_Cluster_2
host=127.0.0.1 user=root password=root port=5436');
store path (server=2, client=3, conninfo='dbname=DB_Cluster_2
host=127.0.0.1 user=root password=root port=5436');
store path (server=3, client=1, conninfo='dbname=DB_Cluster_3
host=127.0.0.1 user=root password=root port=5437');
store path (server=3, client=2, conninfo='dbname=DB_Cluster_3
host=127.0.0.1 user=root password=root port=5437');

store listen (origin=1, provider=1, receiver=2);
store listen (origin=1, provider=1, receiver=3);
store listen (origin=2, provider=2, receiver=1);
store listen (origin=2, provider=2, receiver=3);
store listen (origin=3, provider=3, receiver=1);
store listen (origin=3, provider=3, receiver=2);
################################################################################

Config2_M1.conf
################################################################################
cluster name=Cluster_1;

node 1 admin conninfo = 'dbname=DB_Cluster_1 host=127.0.0.1 user=root
password=root port=5435';
node 2 admin conninfo = 'dbname=DB_Cluster_2 host=127.0.0.1 user=root
password=root port=5436';
node 3 admin conninfo = 'dbname=DB_Cluster_3 host=127.0.0.1 user=root
password=root port=5437';

SUBSCRIBE SET (ID=1, PROVIDER=1, RECEIVER=2, FORWARD=YES);
SUBSCRIBE SET (ID=1, PROVIDER=1, RECEIVER=3, FORWARD=YES);
################################################################################

Cluster 2:
configM2.conf
################################################################################
cluster name=Cluster_M;

node 4 admin conninfo = 'dbname=DB_Cluster_1 host=127.0.0.1 user=root
password=root port=5435';
node 1 admin conninfo = 'dbname=DB_Cluster_3 host=127.0.0.1 user=root
password=root port=5437';
node 2 admin conninfo = 'dbname=DB_Cluster_4 host=127.0.0.1 user=root
password=root port=5438';
node 3 admin conninfo = 'dbname=DB_Cluster_5 host=127.0.0.1 user=root
password=root port=5439';

init cluster (id=1, comment='Nodo maestro del Cluster_4 y Cluster_5');

create set (id=1, origin=1, comment='aqui van todas las tablas del Cluster_3');

set add table (set id=1, origin=1, id=1, fully qualified
name='public.Personas', comment='tabla de Personas del Cluster_3');

store node (id=4, comment='nodo esclavo-maestro Cluster_1');
store node (id=2, comment='Nodo esclavo Cluster_4');
store node (id=3, comment='Nodo esclavo Cluster_5');

store path (server=1, client=2, conninfo='dbname=DB_Cluster_3
host=127.0.0.1 user=root password=root port=5437');
store path (server=1, client=3, conninfo='dbname=DB_Cluster_3
host=127.0.0.1 user=root password=root port=5437');
store path (server=1, client=4, conninfo='dbname=DB_Cluster_3
host=127.0.0.1 user=root password=root port=5437');
store path (server=2, client=1, conninfo='dbname=DB_Cluster_4
host=127.0.0.1 user=root password=root port=5438');
store path (server=2, client=3, conninfo='dbname=DB_Cluster_4
host=127.0.0.1 user=root password=root port=5438');
store path (server=3, client=1, conninfo='dbname=DB_Cluster_5
host=127.0.0.1 user=root password=root port=5439');
store path (server=3, client=2, conninfo='dbname=DB_Cluster_5
host=127.0.0.1 user=root password=root port=5439');
store path (server=4, client=1, conninfo='dbname=DB_Cluster_1
host=127.0.0.1 user=root password=root port=5435');

store listen (origin=1, provider=1, receiver=2);
store listen (origin=1, provider=1, receiver=3);
store listen (origin=1, provider=1, receiver=4);
store listen (origin=2, provider=2, receiver=1);
store listen (origin=2, provider=2, receiver=3);
store listen (origin=3, provider=3, receiver=1);
store listen (origin=3, provider=3, receiver=2);
store listen (origin=4, provider=4, receiver=1);
################################################################################

Config2_M2.conf
################################################################################
cluster name=Cluster_M;

node 4 admin conninfo = 'dbname=DB_Cluster_1 host=127.0.0.1 user=root
password=root port=5435';
node 1 admin conninfo = 'dbname=DB_Cluster_3 host=127.0.0.1 user=root
password=root port=5437';
node 2 admin conninfo = 'dbname=DB_Cluster_4 host=127.0.0.1 user=root
password=root port=5438';
node 3 admin conninfo = 'dbname=DB_Cluster_5 host=127.0.0.1 user=root
password=root port=5439';

SUBSCRIBE SET (ID=4, PROVIDER=4, RECEIVER=1, FORWARD=YES);
SUBSCRIBE SET (ID=1, PROVIDER=1, RECEIVER=2, FORWARD=YES);
SUBSCRIBE SET (ID=1, PROVIDER=1, RECEIVER=3, FORWARD=YES);
################################################################################

I will really appreciate if anyone can help me out with it?

Jaison Jos? Gonz?lez Chaux
From glynastill at yahoo.co.uk  Tue Jan 15 06:57:07 2008
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Tue Jan 15 06:57:12 2008
Subject: [Slony1-general] Problem dropping a set
Message-ID: <493280.5097.qm@web25811.mail.ukl.yahoo.com>

Hi chaps,

I set up a replication cluster using the pgAdmin scripts, and added a
replication set with some tables and sequences in it (table /sequence
Ids 1 - 4). I've kept the Id numbers the same as the table Ids.

Then I added another set (Id 2), and added a table and a sequence
with Id 5.

In my slony log I get the error:

"remoteWorkerThread_1: node -1 not found in runtime configuration"

Does anyone know what causes the error above? I've read that it
indicates slony had a problem at a point whilst subscribing so it
flipped the node number to -1 to stop any further steps happening,
however this doesn't help me track down what caused it.


Then I did a "DROP SET ( ID=2, ORIGIN=1 );" using slonik on the
origin, and the set was removed from the origin, but it's still
visible (using pgadmin) on the subscriber (I have restarted the
slons).  I notice this error occours periodically now in the slony
logs, so it seems the subscriber is trying to subscribe it?  E.g.

------------------------------------------------------

2008-01-15_144529 GMT DEBUG2 syncThread: new sl_action_seq 1 - SYNC
38491
2008-01-15_144533 GMT DEBUG1 copy_set 2
2008-01-15_144533 GMT ERROR  remoteWorkerThread_1: node -1 not found
in runtime configuration
2008-01-15_144533 GMT WARN   remoteWorkerThread_1: data copy for set
2 failed - sleep 60 seconds
WARNING:  there is no transaction in progress

------------------------------------------------------

How do I remove this set from the subscriber?

I've had this happen before. Removing the cluster and setting it up
again resolves the problem, however once we are in a production
environment I can't go dropping the whole cluster and replicating all
the tables from scratch when it happens.

Any pointers would be greatly appreciated
Glyn


Glyn Astill



      ___________________________________________________________
Yahoo! Answers - Got a question? Someone out there knows the answer. Try it
now.
http://uk.answers.yahoo.com/ 

From cbbrowne at ca.afilias.info  Tue Jan 15 07:35:04 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Tue Jan 15 07:35:09 2008
Subject: [Slony1-general] URGENT: Migration of master node
	locked	my	database
In-Reply-To: <478BF516.8070501@emolecules.com> (Craig James's message of "Mon,
	14 Jan 2008 15:49:42 -0800")
References: <D73E09BB-F02E-41A6-A94D-5E069709983B@khera.org>
	<478962BA.5000609@emolecules.com>
	<Pine.LNX.4.64.0801121707550.7808@discord.home.frostconsultingllc.com>
	<47896A95.4030001@emolecules.com>
	<Pine.LNX.4.64.0801121737380.7808@discord.home.frostconsultingllc.com>
	<20080113172241.GA22741@crankycanuck.ca>
	<478BB05E.2040802@emolecules.com>
	<1200340247.5586.115.camel@bnicholson-desktop>
	<478BF516.8070501@emolecules.com>
Message-ID: <60bq7numon.fsf@dba2.int.libertyrms.com>

Craig James <craig_james@emolecules.com> writes:
> Brad Nicholson wrote:
>>> Andrew Sullivan wrote:
>>>> On Sat, Jan 12, 2008 at 05:51:57PM -0800, Jeff Frost wrote:
>>>>> You might check the slon logs for any indication this is what
>>>>> caused your problem.  I thought slon did its work based entirely
>>>>> on xxid, but I could be wrong.  Perhaps one of the developers
>>>>> will comment.  In any event, I'm sure you know the clocks should
>>>>> be in sync as a best practice.
>>>> Not entirely based on xxid, no.  They can't be synced across nodes.  You
>>>> _must_ be nntp-synced between your nodes.  They should peer from one
>>>> another, and _then_ get their time from some other source.
>>> I want to be sure I understand this: Are you saying that a few milliseconds
>>>  of time skew between servers will make Slony fail?
>>>
>> No, it won't.  There is always going to be some minor skew, even when
>> synced with NTP.
>
> Then why is it required to run  nntp between nodes, and only have one external connection to a time server?  Even using independent connections to a time service, the various Slony hosts keep their clocks very closely synchronized.  If a few milliseconds doesn't matter, then it seems to me that an ordinary ntpd(1) should be good enough.
>
> Is there an actual spec for "how much time skew is too much" for Slony?  Like, "All hosts must have their clocks synced within 100 msec."  Or is it just a "good idea" that's not formalized?
>
> What are the consequences of having to servers with out-of-sync clocks?

The consequences are not terribly bad, for Slony-I, directly.

It uses local XID values to determine ordering of things, so it
oughtn't get confused.[1]

The consequences may be bad, *for your application.*  If your
application looks at timestamps on DB servers, then it will make wrong
decisions to the extent to which the times are wrong.

And certainly you'll find things confusing if you are rummaging thru
logs, trying to figure out when something happened, only to discover
that timestamps steer you wrong.

Footnotes: 

[1] One possible exception: The cleanup thread won't clean up events
until they are confirmed everywhere, and at least 10 minutes old.  If
systems disagree on what "10 minutes old" means, you might purge them
earlier or later.  However, note that the events aren't purged until
*confirmed everywhere,* so replication will have taken place before
the purge...
-- 
(reverse (concatenate 'string "ofni.sesabatadxunil" "@" "enworbbc"))
http://cbbrowne.com/info/sgml.html
"Any man whose errors take ten years to correct is quite a man."
-- J. Robert Oppenheimer, speaking of Albert Einstein 
From cbbrowne at ca.afilias.info  Tue Jan 15 07:37:46 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Tue Jan 15 07:37:50 2008
Subject: [Slony1-general] Problem dropping a set
In-Reply-To: <493280.5097.qm@web25811.mail.ukl.yahoo.com> (Glyn Astill's
	message of "Tue, 15 Jan 2008 06:57:07 -0800 (PST)")
References: <493280.5097.qm@web25811.mail.ukl.yahoo.com>
Message-ID: <607iibumk5.fsf@dba2.int.libertyrms.com>

Glyn Astill <glynastill@yahoo.co.uk> writes:
> I set up a replication cluster using the pgAdmin scripts, and added a
> replication set with some tables and sequences in it (table /sequence
> Ids 1 - 4). I've kept the Id numbers the same as the table Ids.
>
> Then I added another set (Id 2), and added a table and a sequence
> with Id 5.
>
> In my slony log I get the error:
>
> "remoteWorkerThread_1: node -1 not found in runtime configuration"
>
> Does anyone know what causes the error above? I've read that it
> indicates slony had a problem at a point whilst subscribing so it
> flipped the node number to -1 to stop any further steps happening,
> however this doesn't help me track down what caused it.

Hmm.  I wonder if node -1 is the virtual one that pgAdmin hacks into
place as a place to store path information for slonik-like activity...

This seems like something to ask the pgAdmin guys about...
-- 
let name="cbbrowne" and tld="cbbrowne.com" in name ^ "@" ^ tld;;
http://www3.sympatico.ca/cbbrowne/emacs.html
"Not to oppose error, is to approve of it, and  not to defend truth is
to suppress it; not to confound evil men when we can do it, is no less
a sin than to encourage them."  -- Pope Felix III, ca. 490
From glynastill at yahoo.co.uk  Tue Jan 15 07:48:27 2008
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Tue Jan 15 07:48:32 2008
Subject: [Slony1-general] Problem dropping a set
In-Reply-To: <607iibumk5.fsf@dba2.int.libertyrms.com>
Message-ID: <703342.57296.qm@web25807.mail.ukl.yahoo.com>

> 
> Hmm.  I wonder if node -1 is the virtual one that pgAdmin hacks
> into
> place as a place to store path information for slonik-like
> activity...

Does that mean it's definately not behaviour we'd be seeing if we
didn't use pgAdmin?

In pgAdmin it asks for the pgAdmin node - I entered 99 in here based
on their example.

I've started using slonik today, previous to that I'd never touched
it and just gone with pgAdmin as it seemed easiest initially.

I shall find my way over to the pgAdmin list, and see what I can find
out, however any ideas that I could try to resolve the problem would
be appreciated.


      ___________________________________________________________
Support the World Aids Awareness campaign this month with Yahoo! For Good http://uk.promotions.yahoo.com/forgood/

From lists at serioustechnology.com  Tue Jan 15 08:12:24 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Tue Jan 15 08:12:31 2008
Subject: [Slony1-general] Re: Slony1-general Digest, Vol 10, Issue 31
In-Reply-To: <b10d372b0801032138s418d4db0ud09461c9463d279e@mail.gmail.com>
References: <20071221200003.C8F0A1484EA@main.slony.info>
	<b10d372b0801032138s418d4db0ud09461c9463d279e@mail.gmail.com>
Message-ID: <478CDB68.50506@serioustechnology.com>

James, thanks for the feedback.  I'm in the process of tweeking my 
configuration files and had a question.  Do the set names have to vary 
from one config to the other?  That is, for example, config file #1 has 
as it's first set name 'set1', will I have a problem if I have a 'set1' 
in my second config file?

Basically we are replicating N number of virtually identical databases, 
so I plan on providing a different cluster name for each config file, 
but I wasn't sure if the sets defined would have to have different names 
from one config file to the other.

Thanks for any insights.

James Tucker wrote:
> Hi Geoffrey,
> 
> I've seen a few responses however not sure that your question has been
> answered.  We run a similar configuration, about 10 separate databases all
> replicated to a corresponding slave in the DR site.  You need to run a slon
> daemon for each node in each cluster, so you'll end up with a lot of slony
> processes.  I just created a different .conf file for each db and then to
> control them, call them individually using the slon_start script.
> 
> i.e.
> 
> DB1 = /usr/local/slony/db1/db1.conf
> DB2 = /usr/local/slony/db2/db2.conf
> 
> start db1 node 1.
> slon_start --config /usr/local/slony/db1/db1.conf 1
> 
> start db2 node 1
> slon_start --config /usr/local/slony/db2/db2.conf 1
> 
> I also use different users for each database to give some separation.  I've
> noticed the slon_kill script will kill all the watchdog processes for all
> db's if they run as the same user which is another good reason to separate.
> 
> Cheers
> 
> James
> 
> 
> On Dec 22, 2007 6:00 AM, <slony1-general-request@lists.slony.info> wrote:
> 
>> ----------------------------------------------------------------------
>>
>> Message: 1
>> Date: Fri, 21 Dec 2007 07:39:27 -0500
>> From: Geoffrey <lists@serioustechnology.com>
>> Subject: [Slony1-general] multiple databases replicated from the same
>>        machine
>> To: slony <slony1-general@lists.slony.info>
>> Message-ID: <476BB3FF.3090804@serioustechnology.com>
>> Content-Type: text/plain; charset=ISO-8859-1; format=flowed
>>
>> Well, I'm not getting any bites on this issue, so either I'm the first
>> person to try this, or I have bad breath.. ;)
>>
>> Quick question.  Is the slony_tools.conf file only used at
>> initialization and startup of the slony processes?  That is, once I've
>> got my replication up and running, is the slony_tools.conf file
>> referenced again?  The point is, I'm thinking that I can create multiple
>> slony_tools.conf files, one for each database.  Link the appropriate one
>> during the startup of slony for that database, then move on to the next
>> database once that replication is going for the first one.
>>
>> It appears to me that the slony_tools.conf file is simply a perl module
>> that must be referenced by the code, so I'm assuming I can make this
>> work, I just don't want to be hacking a bunch of different scripts.
>>
>> --
>> Until later, Geoffrey
>>
>> Those who would give up essential Liberty, to purchase a little
>> temporary Safety, deserve neither Liberty nor Safety.
>>  - Benjamin Franklin
>>
>>
>>
>>
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From smaston at bzzagent.com  Tue Jan 15 12:34:10 2008
From: smaston at bzzagent.com (Sarah Maston)
Date: Tue Jan 15 12:34:14 2008
Subject: [Slony1-general] Execute Script Blew Up My Cluster
Message-ID: <C3B282F2.54D8%smaston@bzzagent.com>


--SUMMARY OF ISSUE--
 
I performed the following execute scripts on the master node.
The DDL went through on the master and created the two fields on the
specified table as predicted.
However, when the DDL reached the first subscriber (Node20) the log threw up
various errors about a table id different than the one being modified.
(from locking the set? The table with id = 105 was in the same set as the
table (id = 137) being updated).
 
At this point there was an endless looping of the error below.  The other
nodes that are subscribed to Node20 did not receive the update, and they did
not receive the new subscription to Node10 when we attempted a switch over
using ?SUBSCRIBE SET?s and then dropping Node20.
 
Finally, we just dropped them all? and started the cluster out from scratch.
 
I am a relatively new user.  We used to have a replication setup with a
master and three slaves running pg8.0.4 and slony1.1 and this kind of schema
upgrade went through without a hitch.
 
Does anyone have any clues as to what I did wrong or what I should have
done?   Any and all help is greatly appreciated.
 
~Sarah
e:smaston@bzzagent.com
 
 
--REPLICATION SETUP--
 
Postgres v8.2.5
Slony v1.2.12
 
                                         / --> node30
node10 --> node20  -->   | --> node40
                                         \ --> node50
 
Node10 is the master.
Node20 is the slave that then cascades to three other slaves.
 
--EXECUTE SCRIPTS--
 
#!/bin/sh
#
#Execute scripts for table alterations and updates..
#  
#
#
/usr/local/pgsql/bin/slonik <<_EOF_
cluster name = bzz_cluster;
node 10 admin conninfo='dbname= db host= a.b.c.d1 user= dbuser;
node 20 admin conninfo='dbname= db host= a.b.c.d2 user= dbuser;
node 30 admin conninfo='dbname= db host= a.b.c.d3 user= dbuser;
node 40 admin conninfo='dbname= db host= a.b.c.d4 user= dbuser;
node 50 admin conninfo='dbname= db host= a.b.c.d5 user= dbuser;
try {
execute script (
   set id = 1,
   filename = 'Slonize_file_1_set_1.sql',
   event node = 10
);
execute script (
   set id = 1,
   filename = 'Slonize_file_2_set_1.sql',
   event node = 10
);
}
on error {
exit 1;
}
echo 'Execute scripts complete. ';
_EOF_
 
 
--DDL FILES--
 
Slonize_file_1_set_1.sql
ALTER TABLE table_1 ADD COLUMN address_company_name varchar(100);
ALTER TABLE table_1 ADD COLUMN is_address_verified boolean;
 
Slonize_file_2_set_1.sql
ALTER TABLE table_1 ALTER COLUMN address_company_name SET DEFAULT NULL;
ALTER TABLE table_1 ALTER COLUMN is_address_verified SET DEFAULT false;
 
 
--LOG FILE from Node20--
 
2008-01-13 20:21:31 CST DEBUG2 remoteListenThread_10: queue event 10,795627
DDL_SCRIPT
2008-01-13 20:21:31 CST DEBUG2 remoteListenThread_10: queue event 10,795628
SYNC
2008-01-13 20:21:31 CST DEBUG2 remoteWorkerThread_10: Received event
10,795627 DDL_SCRIPT
2008-01-13 20:21:31 CST DEBUG2 remoteListenThread_10: queue event 10,795629
DDL_SCRIPT
2008-01-13 20:21:31 CST DEBUG2 remoteListenThread_10: queue event 10,795630
SYNC
?
2008-01-13 20:21:31 CST INFO   prepare for DDL script - set:1 onlyonnode:-1
?
2008-01-13 20:21:31 CST ERROR  remoteWorkerThread_10: "select
"_cluster".ddlScript_prepare_int(1, -1); " PGRES_FATAL_ERROR ERROR: Slony-I:
alterTableRestore(): Table with id 105 not
found
CONTEXT:  SQL statement "SELECT  "_ cluster".alterTableRestore( $1 )"
PL/pgSQL function "ddlscript_prepare_int" line 46 at perform
2008-01-13 20:21:31 CST ERROR  remoteWorkerThread_10: DDL preparation failed
- set 1 - only on node -1
2008-01-13 20:21:31 CST DEBUG2 slon_retry() from pid=22512
2008-01-13 20:21:31 CST DEBUG1 slon: retry requested
2008-01-13 20:21:31 CST DEBUG2 slon: notify worker process to shutdown



From michelspintor at gmail.com  Wed Jan 16 09:52:52 2008
From: michelspintor at gmail.com (Michel)
Date: Wed Jan 16 09:52:59 2008
Subject: [Slony1-general] Problem after upgrade from 1.2.6 to 1.2.12
Message-ID: <1380bb1e0801160952q72dc5383ie9519c31553cbd52@mail.gmail.com>

Hi,

Sorry by my English, i?m from S?o Paulo - Brasil.
I?ll try to explain my problem:

I use slony on my company to replicate data from 1 master to 11 nodes.
While i was using slony 1.2.6 everything was ok but after a upgrade
for 1.2.12, everything is slower...
Even on the localnetwork the time to replicate the data is to higher.

Before what was taking fews seconds now in sometimes take minutes, on
the same situations that before.

The postmaster is with many process like this, what before was so fast
that i coundn?t see::

notify "_schema_Event"; notify "_schema_Confirm";
select "_schema".forwardConfirm(3, 7, '1308481', '2008-01-16 15:47:48.718985');
select "_schema".createEvent('_schema', 'SYNC', NULL);

notify interrupt waiting
notify interrupt waiting

this process is doing: SELECT waiting

Thanks
From glynastill at yahoo.co.uk  Thu Jan 17 01:32:21 2008
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Thu Jan 17 01:32:40 2008
Subject: [Slony1-general] Re: [pgadmin-support] Drop set problem - pgAdmin /
	Slony I
In-Reply-To: <393822.8931.qm@web25811.mail.ukl.yahoo.com>
Message-ID: <934271.1970.qm@web25801.mail.ukl.yahoo.com>

Does anyone have any idea about this?

> > How do I remove this set from the subscriber?
> 
> I think it's somehow scheduled up behind whatever that thing
>going
> for 
> node -1 is looking. If you can get rid of that one from
>sl_listen,
> I bet 
> the set dropping will go through.
> 
> 
 
There doesn't seem to be a -1 node in the sl_listen on the origin
or the subscriber.
 
I've removed the second set that was still visible on the subscriber
from the sl_set table, however I'm still getting an event in the log
where it tries to "copy_set 2" and comes back with the error "set 2
not found in runtime configuration".
 
Any idea on how I remove / stop this?
 
> > I've had this happen before. Removing the cluster and setting
>it
> up
> > again resolves the problem, however once we are in a production
> > environment I can't go dropping the whole cluster and
>replicating
> all
> > the tables from scratch when it happens.
> 
> Can you give us an exact step-by-step on how to make it happen?
> 

I tried to subscribe a new set with a new table in it and for some
reason it failed with the error mentioned. The slony logs show that
slony was periodically trying to subscribe on the subscriber.

Seeing as I couldn't remove it from pgAdmin, I went in and ran a
slonik script to drop the set, however I didn't try to unsubscribe
it
with slonik first. So is there a chance it's come about from me not
unsubscribing first?

What's the law on mixing the use of pgAdmin and slonik to
administer slony?



      ___________________________________________________________
Support the World Aids Awareness campaign this month with Yahoo! For Good http://uk.promotions.yahoo.com/forgood/

From michelspintor at gmail.com  Thu Jan 17 03:56:15 2008
From: michelspintor at gmail.com (Michel)
Date: Thu Jan 17 03:56:34 2008
Subject: [Slony1-general] Re: Problem after upgrade from 1.2.6 to 1.2.12
In-Reply-To: <1380bb1e0801160952q72dc5383ie9519c31553cbd52@mail.gmail.com>
References: <1380bb1e0801160952q72dc5383ie9519c31553cbd52@mail.gmail.com>
Message-ID: <1380bb1e0801170356u496c3a0co84cd8daae2787a90@mail.gmail.com>

My server is a dual opteron 248
8GB DDR ECC
2 HD SCSI
Postgres 8.2.5
Linux: 2.6.17.13-SMP (optimized)
Slony 1.2.12 (compiled default)

Today is worst than yesterday ?cause is taking many time for any light
replication like simples insert and update, it now is taking around
4~5minutes on localnetwork.

Can i downgrade to 1.2.6? I did it on a test server and it worked even
with same errors messages like:

"Possible unsupported PostgreSQL version 8.2, defaulting to 8.0 support"

But even with this message the replication is working on test servers
and too much fast like 1.2.12.

Some advice?

Thanks



On Jan 16, 2008 2:52 PM, Michel <michelspintor@gmail.com> wrote:
> Hi,
>
> Sorry by my English, i?m from S?o Paulo - Brasil.
> I?ll try to explain my problem:
>
> I use slony on my company to replicate data from 1 master to 11 nodes.
> While i was using slony 1.2.6 everything was ok but after a upgrade
> for 1.2.12, everything is slower...
> Even on the localnetwork the time to replicate the data is to higher.
>
> Before what was taking fews seconds now in sometimes take minutes, on
> the same situations that before.
>
> The postmaster is with many process like this, what before was so fast
> that i coundn?t see::
>
> notify "_schema_Event"; notify "_schema_Confirm";
> select "_schema".forwardConfirm(3, 7, '1308481', '2008-01-16 15:47:48.718985');
> select "_schema".createEvent('_schema', 'SYNC', NULL);
>
> notify interrupt waiting
> notify interrupt waiting
>
> this process is doing: SELECT waiting
>
> Thanks
>
From cyril.scetbon at free.fr  Thu Jan 17 06:52:25 2008
From: cyril.scetbon at free.fr (Cyril SCETBON)
Date: Thu Jan 17 06:42:48 2008
Subject: [Slony1-general] Version 1.2.12 released
In-Reply-To: <1195748137.4246.173.camel@ebony.site>
References: <601wavf4kp.fsf@dba2.int.libertyrms.com> <47396E63.8080106@free.fr>
	<1195748137.4246.173.camel@ebony.site>
Message-ID: <478F6BA9.7090102@free.fr>

Hi,


Here are the plots of several metrics taken with the original slon =

binary (25 september 2007) and with the new slon binary (including =

modifications of static variables, 16 october 2007)


Regards


Simon Riggs wrote:

> On Tue, 2007-11-13 at 10:29 +0100, Cyril SCETBON wrote:
>
>   =

>> I think it would be better to be able to modify SLON_DATA_FETCH_SIZE by =

>> using a parameter on the slon command line. For example, we got a lot of =

>> updates (400 per second) between far geographical sites. I had to modify =

>> this variable and to recompile the slon binary cause I didn't find =

>> another way until now.
>>     =

>
> Cyril,
>
> Could you publish your performance results? That will help everybody to
> understand the benefit of this change.
>
> Do you have results for a variety of settings? It may be that we just
> make a permanent change of the #DEFINEd value, rather than making it
> configurable.
>
>   =


-- =

Cyril SCETBON


-------------- next part --------------
A non-text attachment was scrubbed...
Name: b1_16102007.png
Type: image/png
Size: 10186 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20080117=
/8cdc6e95/b1_16102007-0001.png
-------------- next part --------------
A non-text attachment was scrubbed...
Name: b1_25092007.png
Type: image/png
Size: 8619 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20080117=
/8cdc6e95/b1_25092007-0001.png
From stephane.schildknecht at postgresqlfr.org  Thu Jan 17 07:08:43 2008
From: stephane.schildknecht at postgresqlfr.org (=?ISO-8859-1?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Thu Jan 17 07:08:49 2008
Subject: [Slony1-general] Problem dropping a set
In-Reply-To: <607iibumk5.fsf@dba2.int.libertyrms.com>
References: <493280.5097.qm@web25811.mail.ukl.yahoo.com>
	<607iibumk5.fsf@dba2.int.libertyrms.com>
Message-ID: <478F6F7B.8020503@postgresqlfr.org>

Christopher Browne a ?crit :
> Glyn Astill <glynastill@yahoo.co.uk> writes:
>> I set up a replication cluster using the pgAdmin scripts, and added a
>> replication set with some tables and sequences in it (table /sequence
>> Ids 1 - 4). I've kept the Id numbers the same as the table Ids.
>>
>> Then I added another set (Id 2), and added a table and a sequence
>> with Id 5.
>>
>> In my slony log I get the error:
>>
>> "remoteWorkerThread_1: node -1 not found in runtime configuration"
>>
>> Does anyone know what causes the error above? I've read that it
>> indicates slony had a problem at a point whilst subscribing so it
>> flipped the node number to -1 to stop any further steps happening,
>> however this doesn't help me track down what caused it.
> 
> Hmm.  I wonder if node -1 is the virtual one that pgAdmin hacks into
> place as a place to store path information for slonik-like activity...
> 
> This seems like something to ask the pgAdmin guys about...

I'm afraid it is not PgAdmin related. In fact, we encountered the same
situation here, and I never used PgAdmin to administrate my nodes.

What we did was to add a new set to an existing replication with 4
tables in it. Subscription went well on some node, but it fails on one
node with same message as above (node -1...).

Regards,

-- 
St?phane SCHILDKNECHT
Pr?sident de PostgreSQLFr
T?l. 09 53 69 97 12
http://www.postgresqlfr.org
From cbbrowne at ca.afilias.info  Thu Jan 17 07:57:46 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Thu Jan 17 07:57:51 2008
Subject: [Slony1-general] Modifying SLON_DATA_FETCH_SIZE
In-Reply-To: <478F6BA9.7090102@free.fr> (Cyril SCETBON's message of "Thu,
	17 Jan 2008 15:52:25 +0100")
References: <601wavf4kp.fsf@dba2.int.libertyrms.com>
	<47396E63.8080106@free.fr> <1195748137.4246.173.camel@ebony.site>
	<478F6BA9.7090102@free.fr>
Message-ID: <60lk6oqwat.fsf_-_@dba2.int.libertyrms.com>

Note I've changed the subject to make that seem more relevant...

Cyril SCETBON <cyril.scetbon@free.fr> writes:
> Here are the plots of several metrics taken with the original slon
> binary (25 september 2007) and with the new slon binary (including
> modifications of static variables, 16 october 2007)

The graphs aren't quite well enough marked to figure out what's
what...

Is the first one, where "delay" times seem to stay low, but where
there are pretty regular spikes for everything else, the modified
slon, and the second one, where there are fewer but generally rather
higher spikes, represents the "stock" slon?

If what I *think* I am seeing is correct, then there looks as though
there may be some value in increasing the default value for
SLON_DATA_FETCH_SIZE, but I think I need to understand this better.

You might want to comment on some of the lines, and relative
interpretations.  Also, it's not clear what you set
SLON_DATA_FETCH_SIZE to.

What would seem ideal to me would be to have 3 or 4 graphs, where
there is an attempt to keep as many similarities as possible...  Thus,
my "ideal" would involve the following sorts of properties:

 - Preferably, each run would be at about the same time of day, or
   whatever is relevant such that we can expect to see similar
   performance characteristics;

 - It would be nice to have some information on each graph indicating
   amounts of replication traffic (e.g. - numbers of tuples getting
   replicated) so that we can see how well they compare.

 - Multiple runs, and hence multiple graphs, varying on SLON_DATA_FETCH_SIZE:
   - One with the "baseline" of 100
   - One with SLON_DATA_FETCH_SIZE = 400
   - One with SLON_DATA_FETCH_SIZE = 1600
   - One with SLON_DATA_FETCH_SIZE = 3200

  Those numbers are scaling up by a factor of x4 each time, so that we
  can see a pretty wide range of increase.

 - If you can track the size of the slon processes, that may also be
   useful; it might turn out that increasing SLON_DATA_FETCH_SIZE to
   5000 has wonderful performance effects as long as you have 4GB of
   memory available, but that the slon will start swapping if you have
   more modest hardware :-(.

 That may be a lot of work, which I obviously can't make you do :-).
 It may be that further explanations of what is in the two existing
 graphs will tell us enough to come up with a better value than
 SLON_DATA_FETCH_SIZE = 100.

My expectation is that we'll discover that most of the benefits,
e.g. - most of the reshaping of performance, come from the early
increases, and that this comes at only modest memory consumption
costs, and that further improvements would be costlier.

If that turns out to be the case, then the right answer may be to bump
up the default value from 100 to 400, for everyone, and to turn it
into a tunable parameter.  I'd like to have a way to draw that
conclusion!
-- 
let name="cbbrowne" and tld="linuxdatabases.info" in String.concat "@" [name;tld];;
http://cbbrowne.com/info/spiritual.html
'Typos in FINNEGANS WAKE? How could you tell?' -- Kim Stanley Robinson
From vostorga at gmail.com  Thu Jan 17 08:42:55 2008
From: vostorga at gmail.com (=?ISO-8859-1?Q?V=EDctor?=)
Date: Thu Jan 17 08:43:00 2008
Subject: [Slony1-general] Problem dropping a set
In-Reply-To: <478F6F7B.8020503@postgresqlfr.org>
References: <493280.5097.qm@web25811.mail.ukl.yahoo.com>
	<607iibumk5.fsf@dba2.int.libertyrms.com>
	<478F6F7B.8020503@postgresqlfr.org>
Message-ID: <2b391080801170842k246d73a8y17f4e05f775deb2b@mail.gmail.com>

As far as I know, the node -1 error is caused by a slony version mismatch
between nodes.

Regards.

On Jan 17, 2008 9:08 AM, "St=E9phane A. Schildknecht" <
stephane.schildknecht@postgresqlfr.org> wrote:

> Christopher Browne a =E9crit :
> > Glyn Astill <glynastill@yahoo.co.uk> writes:
> >> I set up a replication cluster using the pgAdmin scripts, and added a
> >> replication set with some tables and sequences in it (table /sequence
> >> Ids 1 - 4). I've kept the Id numbers the same as the table Ids.
> >>
> >> Then I added another set (Id 2), and added a table and a sequence
> >> with Id 5.
> >>
> >> In my slony log I get the error:
> >>
> >> "remoteWorkerThread_1: node -1 not found in runtime configuration"
> >>
> >> Does anyone know what causes the error above? I've read that it
> >> indicates slony had a problem at a point whilst subscribing so it
> >> flipped the node number to -1 to stop any further steps happening,
> >> however this doesn't help me track down what caused it.
> >
> > Hmm.  I wonder if node -1 is the virtual one that pgAdmin hacks into
> > place as a place to store path information for slonik-like activity...
> >
> > This seems like something to ask the pgAdmin guys about...
>
> I'm afraid it is not PgAdmin related. In fact, we encountered the same
> situation here, and I never used PgAdmin to administrate my nodes.
>
> What we did was to add a new set to an existing replication with 4
> tables in it. Subscription went well on some node, but it fails on one
> node with same message as above (node -1...).
>
> Regards,
>
> --
> St=E9phane SCHILDKNECHT
> Pr=E9sident de PostgreSQLFr
> T=E9l. 09 53 69 97 12
> http://www.postgresqlfr.org
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080117/=
170423cc/attachment.htm
From simon at 2ndquadrant.com  Thu Jan 17 10:06:44 2008
From: simon at 2ndquadrant.com (Simon Riggs)
Date: Thu Jan 17 10:06:16 2008
Subject: [Slony1-general] Version 1.2.12 released
In-Reply-To: <478F6BA9.7090102@free.fr>
References: <601wavf4kp.fsf@dba2.int.libertyrms.com>
	<47396E63.8080106@free.fr> <1195748137.4246.173.camel@ebony.site>
	<478F6BA9.7090102@free.fr>
Message-ID: <1200593204.4255.243.camel@ebony.site>

On Thu, 2008-01-17 at 15:52 +0100, Cyril SCETBON wrote:

> Here are the plots of several metrics taken with the original slon 
> binary (25 september 2007) and with the new slon binary (including 
> modifications of static variables, 16 october 2007)

Cool graphs.

First graph the effect you highlighted is shown very clearly.

Second one may need repeating because if the performance really does get
a lot worse *sometimes* then we may want to go back.

Does this include Chris's latest changes to avoid VACUUM altogether?

-- 
  Simon Riggs
  2ndQuadrant  http://www.2ndQuadrant.com

From glynastill at yahoo.co.uk  Thu Jan 17 10:31:37 2008
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Thu Jan 17 10:31:45 2008
Subject: [Slony1-general] Problem dropping a set
In-Reply-To: <2b391080801170842k246d73a8y17f4e05f775deb2b@mail.gmail.com>
Message-ID: <932014.33142.qm@web25802.mail.ukl.yahoo.com>


> As far as I know, the node -1 error is caused by a slony version
> mismatch
> between nodes.

I have the same version of slony and postgres on both machines. Could
pgAdmin be appearing as a different slony version?

I've just done the same setup using slonik and not using pgAdmin at
all. I've managed to get this error everytime I've tried to add
tables into replication using pgAdmin, allthough I'll admit my
procedure of doing things was not consistant.

One thing I have noticed is that in the sl_listen table I now only
have 2 records. Previously I had 6, 4 of which pointed to node 99
which is the pgAdmin node.


The slonik scripts are very straight forward and a joy to use, so
I'll probably stick to these. I can also keep 1 slonik script with
everything I've done commented out in it so I can se what I've done
previously too.

Also whats the word on doing things from slonik scripts and then
doing bits from within pgAdmin? Recipie for disaster?


      __________________________________________________________
Sent from Yahoo! Mail - a smarter inbox http://uk.mail.yahoo.com

From glynastill at yahoo.co.uk  Fri Jan 18 02:49:38 2008
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Fri Jan 18 02:49:56 2008
Subject: [Slony1-general] could not write block 177927 of temporary file: No
	space left on device
Message-ID: <690620.21833.qm@web25809.mail.ukl.yahoo.com>

Hi chaps,

I've just taken a look at my slony log on a subscriber and it has the
following messages in it

2008-01-18_053116 GMT ERROR  remoteHelperThread_1_1: "fetch 100 from
LOG; " ERROR:  could not write block 177927 of temporary file: No
space left on device
HINT:  Perhaps out of disk space?
2008-01-18_053116 GMT DEBUG4 remoteHelperThread_1_1: return 10 unused
line buffers

I've definately got enough disk space though.

I had created a table on the origin and subscriber, setup replication
and was migrating data into the one on the origin.

I've not seen this message before, what could be causing it?


      __________________________________________________________
Sent from Yahoo! Mail - a smarter inbox http://uk.mail.yahoo.com


From glynastill at yahoo.co.uk  Fri Jan 18 03:35:06 2008
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Fri Jan 18 03:35:26 2008
Subject: [Slony1-general] could not write block 177927 of temporary file:
	No space left on device
In-Reply-To: <690620.21833.qm@web25809.mail.ukl.yahoo.com>
Message-ID: <852488.80231.qm@web25814.mail.ukl.yahoo.com>

Actually looking at this again (sorry for posting it on the slony
list), its probably a disk space issue not anything to do with slony,
but I can't see why.

If I try to create a large file on my volume as the postgres or slony
user there is no problem.

And I'm not using disk quotas, "df" shows I have plenty of space, and
"df -i" shows there are plenty of inodes free.


--- Glyn Astill <glynastill@yahoo.co.uk> wrote:

> Hi chaps,
> 
> I've just taken a look at my slony log on a subscriber and it has
> the
> following messages in it
> 
> 2008-01-18_053116 GMT ERROR  remoteHelperThread_1_1: "fetch 100
> from
> LOG; " ERROR:  could not write block 177927 of temporary file: No
> space left on device
> HINT:  Perhaps out of disk space?
> 2008-01-18_053116 GMT DEBUG4 remoteHelperThread_1_1: return 10
> unused
> line buffers
> 
> I've definately got enough disk space though.
> 
> I had created a table on the origin and subscriber, setup
> replication
> and was migrating data into the one on the origin.
> 
> I've not seen this message before, what could be causing it?
> 
> 
>       __________________________________________________________
> Sent from Yahoo! Mail - a smarter inbox http://uk.mail.yahoo.com
> 
> 
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
> 



      __________________________________________________________
Sent from Yahoo! Mail - a smarter inbox http://uk.mail.yahoo.com

From glynastill at yahoo.co.uk  Fri Jan 18 03:58:09 2008
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Fri Jan 18 03:58:29 2008
Subject: [Slony1-general] could not write block 177927 of temporary file:
	No space left on device
In-Reply-To: <690620.21833.qm@web25809.mail.ukl.yahoo.com>
Message-ID: <958556.57541.qm@web25804.mail.ukl.yahoo.com>

Okay, I've found it.

The error message was in the slony log on the subscriber, but the
lack of disk space was on the origin, which I guess is where the
message came from.

--- Glyn Astill <glynastill@yahoo.co.uk> wrote:

> Hi chaps,
> 
> I've just taken a look at my slony log on a subscriber and it has
> the
> following messages in it
> 
> 2008-01-18_053116 GMT ERROR  remoteHelperThread_1_1: "fetch 100
> from
> LOG; " ERROR:  could not write block 177927 of temporary file: No
> space left on device
> HINT:  Perhaps out of disk space?
> 2008-01-18_053116 GMT DEBUG4 remoteHelperThread_1_1: return 10
> unused
> line buffers
> 
> I've definately got enough disk space though.
> 
> I had created a table on the origin and subscriber, setup
> replication
> and was migrating data into the one on the origin.
> 
> I've not seen this message before, what could be causing it?
> 
> 
>       __________________________________________________________
> Sent from Yahoo! Mail - a smarter inbox http://uk.mail.yahoo.com
> 
> 
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
> 



      ___________________________________________________________
Yahoo! Answers - Got a question? Someone out there knows the answer. Try it
now.
http://uk.answers.yahoo.com/ 

From g0chman at gmail.com  Sat Jan 19 10:51:49 2008
From: g0chman at gmail.com (=?ISO-8859-1?Q?Jaison_J._Gonz=E1lez_Chaux?=)
Date: Sat Jan 19 10:51:56 2008
Subject: [Slony1-general] Working with the failover command
Message-ID: <6d3ad6bd0801191051k4e805567u4c9752b911e80fb3@mail.gmail.com>

Hi everyone,

I am running slony-i with the failover script, it actually replicates
all the nodes that it is suppoused to, but when i am executing the
failover.conf script it shows me this error message, tried executing
it with a switchover but nothing?

I will really appreciate if someone can give a hint, or at least give
me some suggestions?

C:\Archivos de programa\PostgreSQL\8.2\bin>slonik failover.conf
failover.conf:14: PGRES_FATAL_ERROR select "_Clus1".failedNode(1, 3);
- ERROR: Slony-I: cannot failover - node 2 has no path to the backup node

Failover.conf
######################################################################################
cluster name=Clus1;

node 1 admin conninfo = 'dbname=DB_Cluster_1 host=127.0.0.1 user=root
password=root port=5435';
node 2 admin conninfo = 'dbname=DB_Cluster_2 host=127.0.0.1 user=root
password=root port=5436';
node 3 admin conninfo = 'dbname=DB_Cluster_3 host=127.0.0.1 user=root
password=root port=5437';

failover (id=1, backup node=3);
######################################################################################

best regards...

Jaison J. Gonz?lez Chaux
From cbbrowne at ca.afilias.info  Mon Jan 21 07:55:58 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Mon Jan 21 07:56:04 2008
Subject: [Slony1-general] Working with the failover command
In-Reply-To: <6d3ad6bd0801191051k4e805567u4c9752b911e80fb3@mail.gmail.com>
	(Jaison J. =?iso-8859-1?Q?Gonz=E1lez?= Chaux's message of "Sat,
	19 Jan 2008 13:51:49 -0500")
References: <6d3ad6bd0801191051k4e805567u4c9752b911e80fb3@mail.gmail.com>
Message-ID: <601w8bp3zl.fsf@dba2.int.libertyrms.com>

"Jaison J. Gonz?lez Chaux" <g0chman@gmail.com> writes:
> Hi everyone,
>
> I am running slony-i with the failover script, it actually replicates
> all the nodes that it is suppoused to, but when i am executing the
> failover.conf script it shows me this error message, tried executing
> it with a switchover but nothing

>
> I will really appreciate if someone can give a hint, or at least give
> me some suggestions

>
> C:\Archivos de programa\PostgreSQL\8.2\bin>slonik failover.conf
> failover.conf:14: PGRES_FATAL_ERROR select "_Clus1".failedNode(1, 3);
> - ERROR: Slony-I: cannot failover - node 2 has no path to the backup node
>
> Failover.conf
> ######################################################################################
> cluster name=Clus1;
>
> node 1 admin conninfo = 'dbname=DB_Cluster_1 host=127.0.0.1 user=root
> password=root port=5435';
> node 2 admin conninfo = 'dbname=DB_Cluster_2 host=127.0.0.1 user=root
> password=root port=5436';
> node 3 admin conninfo = 'dbname=DB_Cluster_3 host=127.0.0.1 user=root
> password=root port=5437';
>
> failover (id=1, backup node=3);
> ######################################################################################

It would seem to me that the error message is already giving some
clues...

I'm guessing that you have some really minimal set of paths defined in
sl_path (via the Slonik command "STORE PATH").

Evidently, node #2 has no path defined in sl_path that allows it
access to node #3.

That being the case, after the failover, there will be no way for node
#2 to access events or data generated by node #3.

In effect, you can't fail over if you haven't got a configuration that
will function after the failover.

Probably the appropriate STORE PATH that was needed was the following:

  store path (server=3, client=2, conninfo='dbname=DB_Cluster_3 host=127.0.0.1 user=root password=root port=5437';
-- 
let name="cbbrowne" and tld="acm.org" in String.concat "@" [name;tld];;
http://linuxfinances.info/info/sap.html
Paranoid schizophrenics outnumber their enemies at least two to one.
From postgres at dac.e4ward.com  Mon Jan 21 12:55:57 2008
From: postgres at dac.e4ward.com (postgres@dac.e4ward.com)
Date: Mon Jan 21 12:56:08 2008
Subject: [Slony1-general] Restoring a backup from origin
Message-ID: <3378383760-2295@e4ward.com>

Hi all,

I have a backup from an origin node (the master) and I'm needing to
restore it as a stand-alone database.
Which would be the best practice here?

A UNINSTALL_NODE command doesn't seem to work.

Thank you.

-- 
Diego Algorta Casamayou
http://www.oboxodo.com - http://diego.algorta.net
From diego.algorta at gmail.com  Tue Jan 22 05:11:57 2008
From: diego.algorta at gmail.com (Diego Algorta Casamayou)
Date: Tue Jan 22 05:11:59 2008
Subject: [Slony1-general] What is the risk from running pg_dump on a
	replica
In-Reply-To: <3377521983-2024@e4ward.com>
References: <281461.25494.qm@web25807.mail.ukl.yahoo.com>
	<200801111303.52827.tgoodair@ca.afilias.info>
	<3377521983-2024@e4ward.com>
Message-ID: <78d5ab170801220511k46fb97edj9048ec3ff8478968@mail.gmail.com>

On Jan 11, 2008 7:32 PM, Christopher Browne <cbbrowne@ca.afilias.info> wrote:
> Tim Goodaire <tgoodair@ca.afilias.info> writes:
> > You could take your backup from the origin instead of the subscriber.
>
> You can do considerably better than that...
>
> You need to take the *SCHEMA DUMP* from the origin, which isn't hugely
> expensive.
>
> You can then take a data-only dump from a subscriber.
>
> You can then meld them together, to give you a Proper Schema, and a
> dump that *didn't* have to open a 4-hour-long transaction against the
> origin node.

OK. So just to summarize:

On the master:
$ pg_dump -Fc -s -f database_schema.sql my_replicated_database

On the slave:
$ pg_dump -Fc -a -f database_data.sql my_replicated_database

To restore the backup:
$ createdb my_restored_database
$ pg_restore -d my_restored_database database_schema.sql
$ pg_restore -d my_restored_database database_data.sql

And that's it? Any option/switch I'm missing?

What usage could I give to this restored database? May I use it as a
master in case the master died? In that case I think a failover to the
running slave would be faster.
What should I do to use it in a non-replicated environment? A staging
environment, for example for testing purposes where I need
production-like data.

Thank you.
-- 
Diego Algorta Casamayou
http://www.oboxodo.com - http://diego.algorta.net
From rod at iol.ie  Tue Jan 22 05:16:40 2008
From: rod at iol.ie (Raymond O'Donnell)
Date: Tue Jan 22 05:16:50 2008
Subject: [Slony1-general] What is the risk from running pg_dump on
	a	replica
In-Reply-To: <78d5ab170801220511k46fb97edj9048ec3ff8478968@mail.gmail.com>
References: <281461.25494.qm@web25807.mail.ukl.yahoo.com>	<200801111303.52827.tgoodair@ca.afilias.info>	<3377521983-2024@e4ward.com>
	<78d5ab170801220511k46fb97edj9048ec3ff8478968@mail.gmail.com>
Message-ID: <4795ECB8.9030508@iol.ie>

On 22/01/2008 13:11, Diego Algorta Casamayou wrote:

> What usage could I give to this restored database? May I use it as a
> master in case the master died? In that case I think a failover to the
> running slave would be faster.

Well, it's a backup - no more and no less. The whole point of Slony (or 
any replication system) is that you have a nearly-up-to-date copy of 
your database to which you can failover if the master goes belly-up. A 
backup is always going to be less current than a well-running Slony slave.

> What should I do to use it in a non-replicated environment? A staging
> environment, for example for testing purposes where I need
> production-like data.

That's what I do; as well as keeping a copy as a backup, of course. :-)

Ray.

---------------------------------------------------------------
Raymond O'Donnell, Director of Music, Galway Cathedral, Ireland
rod@iol.ie
---------------------------------------------------------------
From diego.algorta at gmail.com  Tue Jan 22 05:22:59 2008
From: diego.algorta at gmail.com (Diego Algorta Casamayou)
Date: Tue Jan 22 05:23:00 2008
Subject: [Slony1-general] What is the risk from running pg_dump on a
	replica
In-Reply-To: <4795ECB8.9030508@iol.ie>
References: <281461.25494.qm@web25807.mail.ukl.yahoo.com>
	<200801111303.52827.tgoodair@ca.afilias.info>
	<3377521983-2024@e4ward.com>
	<78d5ab170801220511k46fb97edj9048ec3ff8478968@mail.gmail.com>
	<4795ECB8.9030508@iol.ie>
Message-ID: <78d5ab170801220522w47d36163k5b3541150baa3a26@mail.gmail.com>

On Jan 22, 2008 11:16 AM, Raymond O'Donnell <rod@iol.ie> wrote:
> On 22/01/2008 13:11, Diego Algorta Casamayou wrote:
>
> > What usage could I give to this restored database? May I use it as a
> > master in case the master died? In that case I think a failover to the
> > running slave would be faster.
>
> Well, it's a backup - no more and no less. The whole point of Slony (or
> any replication system) is that you have a nearly-up-to-date copy of
> your database to which you can failover if the master goes belly-up. A
> backup is always going to be less current than a well-running Slony slave.

I know, I know. But for example, I currently have full backups made
from my master node. And restoring that backup to use it as an
independent database doesn't really work because it still has slony
all over the place. Running UNINSTALL NODE on it doesn't work either.

>
> > What should I do to use it in a non-replicated environment? A staging
> > environment, for example for testing purposes where I need
> > production-like data.
>
> That's what I do; as well as keeping a copy as a backup, of course. :-)

OK. But what do you do to get rid of slony on that restored database?

This should be a common issue, but I can't find a clear note on it on
the documentation.

Thank you.
-- 
Diego Algorta Casamayou
http://www.oboxodo.com - http://diego.algorta.net
From rod at iol.ie  Tue Jan 22 05:36:57 2008
From: rod at iol.ie (Raymond O'Donnell)
Date: Tue Jan 22 05:38:26 2008
Subject: [Slony1-general] What is the risk from running pg_dump on a
	replica
In-Reply-To: <78d5ab170801220522w47d36163k5b3541150baa3a26@mail.gmail.com>
References: <281461.25494.qm@web25807.mail.ukl.yahoo.com>	
	<200801111303.52827.tgoodair@ca.afilias.info>	
	<3377521983-2024@e4ward.com>	
	<78d5ab170801220511k46fb97edj9048ec3ff8478968@mail.gmail.com>	
	<4795ECB8.9030508@iol.ie>
	<78d5ab170801220522w47d36163k5b3541150baa3a26@mail.gmail.com>
Message-ID: <4795F179.3070907@iol.ie>

On 22/01/2008 13:22, Diego Algorta Casamayou wrote:

> I know, I know. But for example, I currently have full backups made
> from my master node. And restoring that backup to use it as an
> independent database doesn't really work because it still has slony
> all over the place. Running UNINSTALL NODE on it doesn't work either.

[snip]

> OK. But what do you do to get rid of slony on that restored database?
> 
> This should be a common issue, but I can't find a clear note on it on
> the documentation.

Ah - I understand you now. Yes, I'm sure it's a common issue, and I've 
never seen a clear answer to it either. I dump only the "public" schema, 
which gets rid of most (though not all) of the Slony bits. I either live 
with the rest, or else I go through the dump file and edit them out by 
hand (it's a small database).

Not ideal, but it works for me.

Ray.

---------------------------------------------------------------
Raymond O'Donnell, Director of Music, Galway Cathedral, Ireland
rod@iol.ie
---------------------------------------------------------------
From wmoran at collaborativefusion.com  Tue Jan 22 06:08:32 2008
From: wmoran at collaborativefusion.com (Bill Moran)
Date: Tue Jan 22 06:08:36 2008
Subject: [Slony1-general] What is the risk from running pg_dump on a
	replica
In-Reply-To: <78d5ab170801220522w47d36163k5b3541150baa3a26@mail.gmail.com>
References: <281461.25494.qm@web25807.mail.ukl.yahoo.com>
	<200801111303.52827.tgoodair@ca.afilias.info>
	<3377521983-2024@e4ward.com>
	<78d5ab170801220511k46fb97edj9048ec3ff8478968@mail.gmail.com>
	<4795ECB8.9030508@iol.ie>
	<78d5ab170801220522w47d36163k5b3541150baa3a26@mail.gmail.com>
Message-ID: <20080122090832.42b7f5e1.wmoran@collaborativefusion.com>

In response to "Diego Algorta Casamayou" <diego.algorta@gmail.com>:

> On Jan 22, 2008 11:16 AM, Raymond O'Donnell <rod@iol.ie> wrote:
> > On 22/01/2008 13:11, Diego Algorta Casamayou wrote:
> >
> > > What usage could I give to this restored database? May I use it as a
> > > master in case the master died? In that case I think a failover to the
> > > running slave would be faster.
> >
> > Well, it's a backup - no more and no less. The whole point of Slony (or
> > any replication system) is that you have a nearly-up-to-date copy of
> > your database to which you can failover if the master goes belly-up. A
> > backup is always going to be less current than a well-running Slony slave.
> 
> I know, I know. But for example, I currently have full backups made
> from my master node. And restoring that backup to use it as an
> independent database doesn't really work because it still has slony
> all over the place. Running UNINSTALL NODE on it doesn't work either.
> 
> >
> > > What should I do to use it in a non-replicated environment? A staging
> > > environment, for example for testing purposes where I need
> > > production-like data.
> >
> > That's what I do; as well as keeping a copy as a backup, of course. :-)
> 
> OK. But what do you do to get rid of slony on that restored database?

DROP SCHEMA _[clustername] CASCADE;
... always works for me.

> This should be a common issue, but I can't find a clear note on it on
> the documentation.

Don't know why that's not documented.  Anyone?

-- 
Bill Moran
Collaborative Fusion Inc.
http://people.collaborativefusion.com/~wmoran/

wmoran@collaborativefusion.com
Phone: 412-422-3463x4023
From wmoran at collaborativefusion.com  Tue Jan 22 06:09:26 2008
From: wmoran at collaborativefusion.com (Bill Moran)
Date: Tue Jan 22 06:09:29 2008
Subject: [Slony1-general] What is the risk from running pg_dump on a
	replica
In-Reply-To: <78d5ab170801220511k46fb97edj9048ec3ff8478968@mail.gmail.com>
References: <281461.25494.qm@web25807.mail.ukl.yahoo.com>
	<200801111303.52827.tgoodair@ca.afilias.info>
	<3377521983-2024@e4ward.com>
	<78d5ab170801220511k46fb97edj9048ec3ff8478968@mail.gmail.com>
Message-ID: <20080122090926.0c07ad72.wmoran@collaborativefusion.com>

In response to "Diego Algorta Casamayou" <diego.algorta@gmail.com>:

> On Jan 11, 2008 7:32 PM, Christopher Browne <cbbrowne@ca.afilias.info> wrote:
> > Tim Goodaire <tgoodair@ca.afilias.info> writes:
> > > You could take your backup from the origin instead of the subscriber.
> >
> > You can do considerably better than that...
> >
> > You need to take the *SCHEMA DUMP* from the origin, which isn't hugely
> > expensive.
> >
> > You can then take a data-only dump from a subscriber.
> >
> > You can then meld them together, to give you a Proper Schema, and a
> > dump that *didn't* have to open a 4-hour-long transaction against the
> > origin node.
> 
> OK. So just to summarize:
> 
> On the master:
> $ pg_dump -Fc -s -f database_schema.sql my_replicated_database
> 
> On the slave:
> $ pg_dump -Fc -a -f database_data.sql my_replicated_database

I recommend the addition of --disable-triggers on the second one.

But more important is to test the restore process periodically to ensure
that it works.

> To restore the backup:
> $ createdb my_restored_database
> $ pg_restore -d my_restored_database database_schema.sql
> $ pg_restore -d my_restored_database database_data.sql
> 
> And that's it? Any option/switch I'm missing?
> 
> What usage could I give to this restored database? May I use it as a
> master in case the master died? In that case I think a failover to the
> running slave would be faster.
> What should I do to use it in a non-replicated environment? A staging
> environment, for example for testing purposes where I need
> production-like data.

-- 
Bill Moran
Collaborative Fusion Inc.
http://people.collaborativefusion.com/~wmoran/

wmoran@collaborativefusion.com
Phone: 412-422-3463x4023
From m.eriksson at albourne.com  Tue Jan 22 06:29:01 2008
From: m.eriksson at albourne.com (Martin Eriksson)
Date: Tue Jan 22 06:29:14 2008
Subject: [Slony1-general] What is the risk from running pg_dump on
	a	replica
In-Reply-To: <78d5ab170801220522w47d36163k5b3541150baa3a26@mail.gmail.com>
References: <281461.25494.qm@web25807.mail.ukl.yahoo.com>	<200801111303.52827.tgoodair@ca.afilias.info>	<3377521983-2024@e4ward.com>	<78d5ab170801220511k46fb97edj9048ec3ff8478968@mail.gmail.com>	<4795ECB8.9030508@iol.ie>
	<78d5ab170801220522w47d36163k5b3541150baa3a26@mail.gmail.com>
Message-ID: <4795FDAD.9020503@albourne.com>

Hi, I agree this is rather a messy business once you got your slony 
stuff running specially if you got your slony nodes spread all over the 
world like we do here..

we have decided to deal with it in the following manner.

Production database are always running 1 master and currently 4 slaves 
(all in different countries even different continents) and that database 
is about 500 tables and data is not that bad (around 3-5 gigs)

but of course we need to have a fully working development environment 
and in development environment we have no interest to have all the slony 
data.

so we have come up with a procedure for handling all this.

in SVN we got a clean schema dump of the last production release.

we always have an development environment that has all changes (no 
slony) since last release so when we want to update our development 
environment with new data we take a schema dump from the development 
environment and compare it with the latest production schema checked 
into SVN, and the diff is the changes.

So we create a new database, load the production schema from SVN

then take a data dump from the closest production database node with:
pg_dump -F c -N <slony_cluster> -a -Z 9 <database> > datadump.sql

(-N = exclude schema, dont want to get the slony schema data)

then pg_restore it on the new db.

apply the changes

and we got a new fresh development environment without any slony.

this we do every 5-10 days to maintain fresh data in development environment

Once release comes around a diff is generated as above for the changes a 
slony script is generated based on the changes its then applied to a 
slony test cluster (identical to production but all in one location) to 
verify that the schema changes are compatible with slony.

if all is OK, script is applied to production and then the current 
schema on the development environment is checked into SVN as the new 
production schema.

we only allow database schema changes on release because allowing 
changes to schema between release would be a horror to cope with if 
something goes wrong.

If our production database should fail on a slony update, and its not 
fixable right away etc it will take approximately 60h to do a full 
restore.. and of course this is not really an option.

sorry for the long winded response.. but just wanted to give some idea 
how we have come to terms with it.


if this is a bit much, there is always what Bill Moran suggested,

drop schema _slony_cluster CASCADE

works good as well.

Regards
Martin

Diego Algorta Casamayou wrote:
> On Jan 22, 2008 11:16 AM, Raymond O'Donnell <rod@iol.ie> wrote:
>   
>> On 22/01/2008 13:11, Diego Algorta Casamayou wrote:
>>
>>     
>>> What usage could I give to this restored database? May I use it as a
>>> master in case the master died? In that case I think a failover to the
>>> running slave would be faster.
>>>       
>> Well, it's a backup - no more and no less. The whole point of Slony (or
>> any replication system) is that you have a nearly-up-to-date copy of
>> your database to which you can failover if the master goes belly-up. A
>> backup is always going to be less current than a well-running Slony slave.
>>     
>
> I know, I know. But for example, I currently have full backups made
> from my master node. And restoring that backup to use it as an
> independent database doesn't really work because it still has slony
> all over the place. Running UNINSTALL NODE on it doesn't work either.
>
>   
>>> What should I do to use it in a non-replicated environment? A staging
>>> environment, for example for testing purposes where I need
>>> production-like data.
>>>       
>> That's what I do; as well as keeping a copy as a backup, of course. :-)
>>     
>
> OK. But what do you do to get rid of slony on that restored database?
>
> This should be a common issue, but I can't find a clear note on it on
> the documentation.
>
> Thank you.
>   

-- 
*_____________________
Martin Eriksson*
/Albourne Partners (Cyprus) Ltd
Maria House, 1 Avlonos Street, Nicosia 1075, Cyprus
P: +357 22 750652| F: +357 22 750654
m.eriksson@albourne.com
www.albourne.com <http://www.albourne.com>

If you are not an intended recipient of this e-mail, please notify the 
sender, delete it and do not read, act upon, print, disclose, copy, 
retain or redistribute it. Please visit 
http://www.albourne.com/email.html 
<http://www.albourne.com/email.html>for important additional terms 
relating to this e-mail.
/
From cbbrowne at ca.afilias.info  Tue Jan 22 08:00:59 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Tue Jan 22 08:01:05 2008
Subject: [Slony1-general] What is the risk from running pg_dump on a
	replica
In-Reply-To: <20080122090832.42b7f5e1.wmoran@collaborativefusion.com> (Bill
	Moran's message of "Tue, 22 Jan 2008 09:08:32 -0500")
References: <281461.25494.qm@web25807.mail.ukl.yahoo.com>
	<200801111303.52827.tgoodair@ca.afilias.info>
	<3377521983-2024@e4ward.com>
	<78d5ab170801220511k46fb97edj9048ec3ff8478968@mail.gmail.com>
	<4795ECB8.9030508@iol.ie>
	<78d5ab170801220522w47d36163k5b3541150baa3a26@mail.gmail.com>
	<20080122090832.42b7f5e1.wmoran@collaborativefusion.com>
Message-ID: <6063xlonno.fsf@dba2.int.libertyrms.com>

Bill Moran <wmoran@collaborativefusion.com> writes:
> In response to "Diego Algorta Casamayou" <diego.algorta@gmail.com>:
>
>> On Jan 22, 2008 11:16 AM, Raymond O'Donnell <rod@iol.ie> wrote:
>> > On 22/01/2008 13:11, Diego Algorta Casamayou wrote:
>> >
>> > > What usage could I give to this restored database? May I use it as a
>> > > master in case the master died? In that case I think a failover to the
>> > > running slave would be faster.
>> >
>> > Well, it's a backup - no more and no less. The whole point of Slony (or
>> > any replication system) is that you have a nearly-up-to-date copy of
>> > your database to which you can failover if the master goes belly-up. A
>> > backup is always going to be less current than a well-running Slony slave.
>> 
>> I know, I know. But for example, I currently have full backups made
>> from my master node. And restoring that backup to use it as an
>> independent database doesn't really work because it still has slony
>> all over the place. Running UNINSTALL NODE on it doesn't work either.
>> 
>> >
>> > > What should I do to use it in a non-replicated environment? A staging
>> > > environment, for example for testing purposes where I need
>> > > production-like data.
>> >
>> > That's what I do; as well as keeping a copy as a backup, of course. :-)
>> 
>> OK. But what do you do to get rid of slony on that restored database?
>
> DROP SCHEMA _[clustername] CASCADE;
> ... always works for me.
>
>> This should be a common issue, but I can't find a clear note on it on
>> the documentation.
>
> Don't know why that's not documented.  Anyone?

In the "fabled next version," that does indeed become the full method,
in that ALL of the objects that Slony-I creates will be enclosed in
that schema.

In v1.0-v1.2, there is regrettably more to it.

 - Any tables defined using TABLE ADD KEY (to put in a surrogate primary key)
   need to have the extra column dropped

 - On subscribers, rules and triggers need to get "relinked" because
   the catalog gets hacked up to deactivate them.

So on 1.0-1.2, the "right answer" is to use the slonik command
"UNINSTALL NODE," which seems reasonably documented...
-- 
let name="cbbrowne" and tld="cbbrowne.com" in String.concat "@" [name;tld];;
http://cbbrowne.com/info/advocacy.html
Roses are red
Violets are blue
Some poems rhyme
But this one doesn't. 
From ajs at crankycanuck.ca  Tue Jan 22 09:00:59 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Tue Jan 22 09:01:14 2008
Subject: [Slony1-general] What is the risk from running pg_dump on a
	replica
In-Reply-To: <78d5ab170801220522w47d36163k5b3541150baa3a26@mail.gmail.com>
References: <281461.25494.qm@web25807.mail.ukl.yahoo.com>
	<200801111303.52827.tgoodair@ca.afilias.info>
	<3377521983-2024@e4ward.com>
	<78d5ab170801220511k46fb97edj9048ec3ff8478968@mail.gmail.com>
	<4795ECB8.9030508@iol.ie>
	<78d5ab170801220522w47d36163k5b3541150baa3a26@mail.gmail.com>
Message-ID: <20080122170059.GJ20919@crankycanuck.ca>

On Tue, Jan 22, 2008 at 11:22:59AM -0200, Diego Algorta Casamayou wrote:
> OK. But what do you do to get rid of slony on that restored database?
> 
> This should be a common issue, but I can't find a clear note on it on
> the documentation.

The documentation needs to be fixed.  It's missing discussion of this
problem.  There's a program that ships with Slony, though, that is supposed
to help with this.  I believe I already mentioned it up thread.  I can't
recall its name now, though.  Please look at your tarball.

A
From vivek at khera.org  Tue Jan 22 13:15:19 2008
From: vivek at khera.org (Vivek Khera)
Date: Tue Jan 22 13:15:27 2008
Subject: [Slony1-general] What is the risk from running pg_dump on a
	replica
In-Reply-To: <78d5ab170801220522w47d36163k5b3541150baa3a26@mail.gmail.com>
References: <281461.25494.qm@web25807.mail.ukl.yahoo.com>
	<200801111303.52827.tgoodair@ca.afilias.info>
	<3377521983-2024@e4ward.com>
	<78d5ab170801220511k46fb97edj9048ec3ff8478968@mail.gmail.com>
	<4795ECB8.9030508@iol.ie>
	<78d5ab170801220522w47d36163k5b3541150baa3a26@mail.gmail.com>
Message-ID: <6E3E2401-0B83-4C40-B051-A04BB378EF3E@khera.org>


On Jan 22, 2008, at 8:22 AM, Diego Algorta Casamayou wrote:

> OK. But what do you do to get rid of slony on that restored database?

when you do the pg_restore of the *schema* part, use the -L and -l  
flags to create, edit and read the list of objects to restore.  when  
editing the list, remove any references to any slony objects.  it is  
pretty trivial...

From praveen.k at renaissance-it.com  Wed Jan 23 20:45:39 2008
From: praveen.k at renaissance-it.com (Praveen Kumar (TUV))
Date: Wed Jan 23 20:44:28 2008
Subject: [Slony1-general] One slaves database slony process is taking so
	much time.
Message-ID: <84D57263D486374587DA0820E60A2CC601A33508@srit_mail.renaissance-it.com>

Hello,
I am facing problem regard slony. We have one master and three slaves
database.In one slave database slony process is taking so much time but
in 
Other slave databases ,it execute very quickly and not visible in sql
prompt when I execute query "
 select procpid,substr(current_query,1,50) as
current_query,usename,now()-query_start as query_running_from from
pg_stat_activity where current_query not like '<IDLE>%'";

but in other slave it show result like that. And load on this slave go
high.

procpid |                   current_query                    | usename |

---------+----------------------------------------------------+---------
+---
   24889 | select "_slon_rep".forwardConfirm(4, 2, '5417', '2 | tuvca
| 
   24891 | notify "_slon_rep_Event"; notify "_slon_rep_Confir | tuvca
| 
   24892 | notify "_slon_rep_Event"; notify "_slon_rep_Confir | tuvca
| 


My question is that why is this result  visible only one slave and
taking so much time while in other two slave databases it does not show
this kind of result ?
Replication is happening properly between master and slaves.
From varathasiva at gmail.com  Thu Jan 24 01:32:57 2008
From: varathasiva at gmail.com (Siva)
Date: Thu Jan 24 01:33:14 2008
Subject: [Slony1-general] Reg Cann't Instal Slony-I
Message-ID: <da7777050801240132s12c2bc99r70ab3b8d35249b55@mail.gmail.com>

Dear
    I can't instal Slony-I 1.2.12 on my windows XP laptop showing error
Module C:\Program Files\PostgreSQL\8.1\lib\slevent.dll failed to
register.HRESULT-2147023898.Contact your personal like this.How resolve this
error and after instal the Slony-I.How to make the settings for replication
can u send brief mail.Pls help me.Advance thanks.
Kindly Regards
Siva
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080124/=
a87a08cc/attachment.htm
From glynastill at yahoo.co.uk  Thu Jan 24 03:03:43 2008
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Thu Jan 24 03:04:03 2008
Subject: [Slony1-general] Reg Cann't Instal Slony-I
In-Reply-To: <da7777050801240132s12c2bc99r70ab3b8d35249b55@mail.gmail.com>
Message-ID: <136930.70471.qm@web25813.mail.ukl.yahoo.com>

C:\Program Files\PostgreSQL\8.1\lib\slevent.dll

--- Siva <varathasiva@gmail.com> wrote:
Do you have DEP enabled in XP?

How about registering it manually with regsvr32?

> Dear
>     I can't instal Slony-I 1.2.12 on my windows XP laptop showing
> error
> Module C:\Program Files\PostgreSQL\8.1\lib\slevent.dll failed to
> register.HRESULT-2147023898.Contact your personal like this.How
> resolve this
> error and after instal the Slony-I.How to make the settings for
> replication
> can u send brief mail.Pls help me.Advance thanks.
> Kindly Regards
> Siva
> > _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
> 



      __________________________________________________________
Sent from Yahoo! Mail - a smarter inbox http://uk.mail.yahoo.com


From z-saito at guitar.ocn.ne.jp  Thu Jan 24 03:08:19 2008
From: z-saito at guitar.ocn.ne.jp (Hiroshi Saito)
Date: Thu Jan 24 03:08:43 2008
Subject: [Slony1-general] Reg Cann't Instal Slony-I
References: <da7777050801240132s12c2bc99r70ab3b8d35249b55@mail.gmail.com>
Message-ID: <003a01c85e79$6db23b30$0d01a8c0@IBMC9A0F63B40D>

Hi.

Umm, I have got the problem report same otherwise. However, It does
not have still clear solution. but, It seems that it solves by VisualStudio.
Therefore, I want to try the offer again. Please wait for a while.

Regards,
Hiroshi Saito

----- Original Message ----- 
From: Siva
To: Slony1-general@lists.slony.info
Sent: Thursday, January 24, 2008 6:32 PM
Subject: [Slony1-general] Reg Cann't Instal Slony-I


Dear
    I can't instal Slony-I 1.2.12 on my windows XP laptop showing error Module C:\Program 
Files\PostgreSQL\8.1\lib\slevent.dll failed to register.HRESULT-2147023898.Contact your 
personal like this.How resolve this error and after instal the Slony-I.How to make the 
settings for replication can u send brief mail.Pls help me.Advance thanks.
Kindly Regards
Siva



_______________________________________________
Slony1-general mailing list
Slony1-general@lists.slony.info
http://lists.slony.info/mailman/listinfo/slony1-general 

From lists at serioustechnology.com  Fri Jan 25 07:13:52 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Fri Jan 25 07:13:58 2008
Subject: [Slony1-general] problem creating a 2nd set
Message-ID: <4799FCB0.2070706@serioustechnology.com>

I must be missing something here.  I'll summarize so as to reduce the 
size of the example.  I have two sets defined in a config file as follows:

$SLONY_SETS = {

	"avldsSet" => {
		"set_id"       => 1,
         	"table_id"     => 1,
         	"sequence_id"  => 1,
         	"pkeyedtables" => [....],
		"keyedtables"  => {},
         	"serialtables" => [],
         	"sequences"    => [....],
	}

	"nonavldsSet" => {
		"set_id"       => 2,
         	"table_id"     => 2,
         	"sequence_id"  => 2,
         	"pkeyedtables" => [....],
		"keyedtables"  => {},
         	"serialtables" => [],
         	"sequences"    => [....],
	}
};

So then my expectation is that I will need to run the following:

slonik_create_set --config $CONFIG 1 |slonik
slonik_create_set --config $CONFIG 2 |slonik

Because I've defined two sets.  Problem is, I received the following 
error when I run the second slonik_create_set:

slonik_create_set --config $CONFIG 2|slonik
<stdin>:16: Subscription set 2 created
<stdin>:17: Adding tables to the subscription set
<stdin>:18: PGRES_FATAL_ERROR select "_mwv_cluster".setAddTable(2, 2, 
'public.aaccess', 'aaccess_pkey', 'Table public.aaccess with primary 
key');  - ERROR:  Slony-I: setAddTable_int: table id 2 has already been 
assigned!
CONTEXT:  PL/pgSQL function "setaddtable" line 37 at perform

The table mentioned 'aaccess' only exists in the first set.  Do I 
misunderstand the concept of sets or the functionality of the 
slonik_create_set script?

Thanks for any assistance.

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From lists at serioustechnology.com  Fri Jan 25 07:20:23 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Fri Jan 25 07:20:29 2008
Subject: [Slony1-general] how does one 'un-init' a cluster?
Message-ID: <4799FE37.8060206@serioustechnology.com>

I don't know if that makes sense, but how do you undo what 
slonik_init_cluster does?

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From leon at solatis.com  Sat Jan 26 07:13:42 2008
From: leon at solatis.com (Leon Mergen)
Date: Sat Jan 26 07:13:46 2008
Subject: [Slony1-general] how does one 'un-init' a cluster?
In-Reply-To: <4799FE37.8060206@serioustechnology.com>
References: <4799FE37.8060206@serioustechnology.com>
Message-ID: <5eaaef180801260713k26d2430cnb1136744c18fa78e@mail.gmail.com>

On 1/25/08, Geoffrey <lists@serioustechnology.com> wrote:
>
> I don't know if that makes sense, but how do you undo what
> slonik_init_cluster does?


Hello,

I believe this can be achieved with the 'slonik_uninstall_nodes' command.

-- =

Leon Mergen
http://www.solatis.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080126/=
1d90ada1/attachment.htm
From z-saito at guitar.ocn.ne.jp  Sat Jan 26 18:06:45 2008
From: z-saito at guitar.ocn.ne.jp (Hiroshi Saito)
Date: Sat Jan 26 18:07:11 2008
Subject: [Slony1-general] Reg Cann't Instal Slony-I
Message-ID: <040301c86089$4a99f950$0c01a8c0@IBMC9A0F63B40D>

Hi.

In Windows-XP SP2, the report which fails in registration of slevent in some
country languages was received. Although it seems to be the DEP problem of 
Windows, it is not happened in pgAdmin or PostgreSQL which are other same 
methods. It seems that so, it solves by re-creation of MSG00001.bin, and RC
in English mode when how many persons try in that environment. 

Therefore,I place here for a while and entrust hope to a user's further report. 
http://developer.pgadmin.org/~hiroshi/Slony-I/slevent/

to Glyn-san.
Thanks!:-)

Regards,
Hiroshi Saito

----- Original Message ----- 
From: "Hiroshi Saito" <z-saito@guitar.ocn.ne.jp>


> Hi.
> 
> Umm, I have got the problem report same otherwise. However, It does
> not have still clear solution. but, It seems that it solves by VisualStudio.
> Therefore, I want to try the offer again. Please wait for a while.
> 
> Regards,
> Hiroshi Saito
> 
> ----- Original Message ----- 
> From: Siva
> To: Slony1-general@lists.slony.info
> Sent: Thursday, January 24, 2008 6:32 PM
> Subject: [Slony1-general] Reg Cann't Instal Slony-I
> 
> 
> Dear
>    I can't instal Slony-I 1.2.12 on my windows XP laptop showing error Module C:\Program 
> Files\PostgreSQL\8.1\lib\slevent.dll failed to register.HRESULT-2147023898.Contact your 
> personal like this.How resolve this error and after instal the Slony-I.How to make the 
> settings for replication can u send brief mail.Pls help me.Advance thanks.
> Kindly Regards
> Siva
> 
> 
> 
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general 
>
From david at fetter.org  Sun Jan 27 18:53:06 2008
From: david at fetter.org (David Fetter)
Date: Sun Jan 27 18:53:16 2008
Subject: [Slony1-general] Proposal: using COPY to pull sl_log_? data to
	subscribers
In-Reply-To: <20080108145549.GC23841@crankycanuck.ca>
References: <60bq7x350m.fsf@dba2.int.libertyrms.com>
	<20080108145549.GC23841@crankycanuck.ca>
Message-ID: <20080128025306.GA10493@fetter.org>

On Tue, Jan 08, 2008 at 09:55:49AM -0500, Andrew Sullivan wrote:
> On Mon, Jan 07, 2008 at 12:43:53PM -0500, Christopher Browne wrote:
> > I have been looking at this idea for a while, and I *think* it has
> > enough merit to consider implementing it.
> 
> [&c.] 
> 
> This proposal seems like a good idea to me, but I think particular
> community input is needed on a couple areas.
> 
> >   1.  Some processing load gets taken off the provider
> 
> [. . .]
> 
> >   2.  Processing load is moved from slon to subscriber DBMS
> 
> What this means, of course, is that load goes down on the origin and
> up on every subscriber.  This seems to me to be obviously desirable,
> but I wonder if there's anyone who has designed specifically around
> the load profile of Slony today, and who will have problems with
> this new load profile.  Anyone?

While absence of evidence isn't evidence of absence, I'd have figured
that anybody negatively affected by this would be yelling loudly by
now.

> >       An important question: Will that loop lead to grossly
> >       excessive backend memory usage in cases where Large Tuples
> >       are processed?  (e.g. - where the INSERT statement is
> >       inserting a tuple consisting of 40MB of data)
> 
> This is obviously an empirical matter, but I suggest people need to
> start thinking very carefully about possible test cases --
> particularly unusual and expensive ones -- now.  The worst effect of
> this change would be if we traded load on the origin for lighter
> load that only works 95% of the time.  Reliability is, I think, the
> cardinal value in this system, and everything else needs to be
> sacrificed to that.

Agreed.

> >       There is a downside: with this approach, we now have no
> >       option for a subscriber node to NOT be configured to be a
> >       provider; all nodes now load data into the sl_log_? tables.
> 
> Does anyone care about this?  It strikes me that the subscribe-only
> option is a frill that could be traded away, but if people are
> dedicated to it, now would be a good time to speak up.
> 
> I like the proposal, but it'd be nice to here widespread agreement
> on a change that is a fairly deep architectural one before we go
> ahead with this strategy.

Just anecdotally, the second biggest gripe I keep hearing about Slony
is its behavior on long-running transactions, especially initial
syncs.  See Ow Mun Heng's recent post on planetpostgresql.org for a
sample ("the dreaded fetch 100 from log").

The biggest gripe, by the way, is the amount of fiddling you need to
do for common operations like, "create a two-node cluster with a
replication set that includes every table and sequence" or "add this
table to this replication set."

Cheers,
David.
-- 
David Fetter <david@fetter.org> http://fetter.org/
Phone: +1 415 235 3778  AIM: dfetter666  Yahoo!: dfetter
Skype: davidfetter      XMPP: david.fetter@gmail.com

Remember to vote!
Consider donating to Postgres: http://www.postgresql.org/about/donate
From simon at 2ndquadrant.com  Mon Jan 28 04:32:45 2008
From: simon at 2ndquadrant.com (Simon Riggs)
Date: Mon Jan 28 04:32:22 2008
Subject: [Slony1-general] Proposal: using COPY to pull sl_log_? data to
	subscribers
In-Reply-To: <60bq7x350m.fsf@dba2.int.libertyrms.com>
References: <60bq7x350m.fsf@dba2.int.libertyrms.com>
Message-ID: <1201523565.4257.650.camel@ebony.site>

On Mon, 2008-01-07 at 12:43 -0500, Christopher Browne wrote:

>   1.  Some processing load gets taken off the provider
> 
>       The "LOG cursor" query becomes a "COPY [foo] to stdout" query,
>       and it's worth noting that we lose the need to have an ORDER BY
>       clause, which eliminates a sort.

If you define the cursors as NO SCROLL it will improve larger sorts.

>   3.  We use COPY to load data onto the subscriber
> 
>       There are two very large benefits to this, in that:
>        i) COPY should be *WAY* faster than the INSERT presently used;
>        ii) We can COPY in specific-sized-buffer chunks, which eliminates
>            the somewhat-overly baroque code that tries to limit slon
>            memory usage.

Why not allow a table-specific pair of log tables? These would be
dedicated just to that table, completely separate from the general
table. That way a large INSERT-heavy table could isolate its data from
other tables, allowing a COPY just on that table, though 

That way you aren't changing the underlying mechanisms, which work
nicely, but allow a different route for large INSERT-heavy tables, which
are likely the main cause of problems in this area.

-- 
  Simon Riggs
  2ndQuadrant  http://www.2ndQuadrant.com

From scetbon at echo.fr  Mon Jan 28 05:36:53 2008
From: scetbon at echo.fr (Cyril SCETBON)
Date: Mon Jan 28 05:36:56 2008
Subject: [Slony1-general] Version 1.2.12 released
In-Reply-To: <1200593204.4255.243.camel@ebony.site>
References: <601wavf4kp.fsf@dba2.int.libertyrms.com>	<47396E63.8080106@free.fr>
	<1195748137.4246.173.camel@ebony.site>	<478F6BA9.7090102@free.fr>
	<1200593204.4255.243.camel@ebony.site>
Message-ID: <479DDA75.5000100@echo.fr>



Simon Riggs wrote:
> On Thu, 2008-01-17 at 15:52 +0100, Cyril SCETBON wrote:
>
>   
>> Here are the plots of several metrics taken with the original slon 
>> binary (25 september 2007) and with the new slon binary (including 
>> modifications of static variables, 16 october 2007)
>>     
>
> Cool graphs.
>
> First graph the effect you highlighted is shown very clearly.
>
> Second one may need repeating because if the performance really does get
> a lot worse *sometimes* then we may want to go back.
>
> Does this include Chris's latest changes to avoid VACUUM altogether?
>   
no.

NB: sorry I think my email was in a moderated state.

Regards

-- 
Cyril SCETBON - Ing?nieur bases de donn?es
AUSY pour France T?l?com - OPF/PORTAILS/DOP/HEBEX

T?l : +33 (0)4 97 12 87 60
Jabber : cscetbon@jabber.org
France Telecom - Orange
790 Avenue du Docteur Maurice Donat 
B?timent Marco Polo C2 
06250 Mougins
France

***********************************
Ce message et toutes les pieces jointes (ci-apres le 'message') sont
confidentiels et etablis a l'intention exclusive de ses destinataires.
Toute utilisation ou diffusion non autorisee est interdite.
Tout message electronique est susceptible d'alteration. Le Groupe France
Telecom decline toute responsabilite au titre de ce message s'il a ete
altere, deforme ou falsifie.
Si vous n'etes pas destinataire de ce message, merci de le detruire
immediatement et d'avertir l'expediteur.
***********************************
This message and any attachments (the 'message') are confidential and
intended solely for the addressees.
Any unauthorised use or dissemination is prohibited.
Messages are susceptible to alteration. France Telecom Group shall not be
liable for the message if altered, changed or falsified.
If you are not recipient of this message, please cancel it immediately and
inform the sender.
************************************

From cbbrowne at ca.afilias.info  Mon Jan 28 07:17:09 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Mon Jan 28 07:17:24 2008
Subject: [Slony1-general] how does one 'un-init' a cluster?
In-Reply-To: <4799FE37.8060206@serioustechnology.com> (Geoffrey's message of
	"Fri, 25 Jan 2008 10:20:23 -0500")
References: <4799FE37.8060206@serioustechnology.com>
Message-ID: <608x2ahte2.fsf@dba2.int.libertyrms.com>

Geoffrey <lists@serioustechnology.com> writes:
> I don't know if that makes sense, but how do you undo what
> slonik_init_cluster does?

The slonik command "UNINSTALL NODE" handles this change.  I think
there's an "altperl" wrapper script for this.
-- 
output = ("cbbrowne" "@" "linuxdatabases.info")
http://cbbrowne.com/info/lisp.html
Rules of the  Evil Overlord #224. "I will  build machines which simply
fail when overloaded,  rather than wipe out all  nearby henchmen in an
explosion or  worse yet set  off a chain  reaction. I will do  this by
using devices known as "surge protectors"."
<http://www.eviloverlord.com/>
From cbbrowne at ca.afilias.info  Mon Jan 28 07:41:41 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Mon Jan 28 07:41:46 2008
Subject: [Slony1-general] Proposal: using COPY to pull sl_log_? data to
	subscribers
In-Reply-To: <1201523565.4257.650.camel@ebony.site> (Simon Riggs's message of
	"Mon, 28 Jan 2008 12:32:45 +0000")
References: <60bq7x350m.fsf@dba2.int.libertyrms.com>
	<1201523565.4257.650.camel@ebony.site>
Message-ID: <604pcyhs96.fsf@dba2.int.libertyrms.com>

Simon Riggs <simon@2ndquadrant.com> writes:
> On Mon, 2008-01-07 at 12:43 -0500, Christopher Browne wrote:
>
>>   1.  Some processing load gets taken off the provider
>> 
>>       The "LOG cursor" query becomes a "COPY [foo] to stdout" query,
>>       and it's worth noting that we lose the need to have an ORDER BY
>>       clause, which eliminates a sort.
>
> If you define the cursors as NO SCROLL it will improve larger sorts.

In Googling around a bit on this, it looks like this is significant
for PG >= 8.2, so it seems as though this would be a good change to
put in in HEAD, possibly to be replaced by COPY later...

It seems to be just a 3 line change, as there are 3 queries that
create the LOG cursor (with just sl_log_1, just sl_log_2, or combining
both).

>>   3.  We use COPY to load data onto the subscriber
>> 
>>       There are two very large benefits to this, in that:
>>        i) COPY should be *WAY* faster than the INSERT presently used;
>>        ii) We can COPY in specific-sized-buffer chunks, which eliminates
>>            the somewhat-overly baroque code that tries to limit slon
>>            memory usage.
>
> Why not allow a table-specific pair of log tables? These would be
> dedicated just to that table, completely separate from the general
> table. That way a large INSERT-heavy table could isolate its data from
> other tables, allowing a COPY just on that table, though 
>
> That way you aren't changing the underlying mechanisms, which work
> nicely, but allow a different route for large INSERT-heavy tables, which
> are likely the main cause of problems in this area.

The option of using a separate table is somewhat interesting, but, on
the one hand, orthogonal to the proposed change, and on the other, I
expect that the replace-DELETE-with-TRUNCATE approach has already
gleaned most of the possible improvements.

The effect of the "use COPY to load data" proposal shouldn't be
significant at all on how the log data is stored; it doesn't (at this
point, at least) change the structure of the log tables; it does two
major things:

  1.  Replaces the "LOG cursor" with a pair of COPY statements, one
      that pulls log data from the source, and one that drops that
      data, verbatim, onto the subscriber.

      If we decide that "heavily updated table T1" *supremely* needs
      this, due to heavy update patterns on it, I rather think that
      letting the other tables' data come along for the ride will come
      "nearly for free."

  2.  Replaces the logic where sl_log_* data is interpreted (e.g. - to
      determine if the request is an INSERT/DELETE/UPDATE, and on what
      table) inside the slon, with interpreting this on the subscriber.

      I don't see a benefit in dividing this process up; if it's a
      "win" to do it on the subscriber, for the heavily updated
      table(s), then should it not also be an improvement for the
      lightly-updated tables?

For both sides of the processing, I don't see a benefit falling out of
dividing replicated data into "low-update rates" versus "high update
rates."  If the "use COPY and evaluate on the subscriber" method is
dominantly better than the present method, then we should migrate to
it.

Indeed, splitting up the process has, to my view, a substantial
detriment, namely that it means that we would have *TWO* replication
processing mechanisms in the code base to test and maintain.  That
won't come for free :-(.
-- 
select 'cbbrowne' || '@' || 'linuxdatabases.info';
http://cbbrowne.com/info/wp.html
Rules  of  the Evil  Overlord  #97.  "My  dungeon  cells  will not  be
furnished with  objects that  contain reflective surfaces  or anything
that can be unravelled." <http://www.eviloverlord.com/>
From simon at 2ndquadrant.com  Mon Jan 28 07:44:30 2008
From: simon at 2ndquadrant.com (Simon Riggs)
Date: Mon Jan 28 07:44:59 2008
Subject: [Slony1-general] Version 1.2.12 released
In-Reply-To: <479DDA75.5000100@echo.fr>
References: <601wavf4kp.fsf@dba2.int.libertyrms.com>
	<47396E63.8080106@free.fr> <1195748137.4246.173.camel@ebony.site>
	<478F6BA9.7090102@free.fr> <1200593204.4255.243.camel@ebony.site>
	<479DDA75.5000100@echo.fr>
Message-ID: <1201535070.4257.677.camel@ebony.site>

On Mon, 2008-01-28 at 14:36 +0100, Cyril SCETBON wrote:
> 
> Simon Riggs wrote:
> > On Thu, 2008-01-17 at 15:52 +0100, Cyril SCETBON wrote:
> >
> >   
> >> Here are the plots of several metrics taken with the original slon 
> >> binary (25 september 2007) and with the new slon binary (including 
> >> modifications of static variables, 16 october 2007)
> >>     
> >
> > Cool graphs.
> >
> > First graph the effect you highlighted is shown very clearly.
> >
> > Second one may need repeating because if the performance really does get
> > a lot worse *sometimes* then we may want to go back.
> >
> > Does this include Chris's latest changes to avoid VACUUM altogether?
> >   
> no.
> 
> NB: sorry I think my email was in a moderated state.

Cyril,

Sorry, I don't understand that.

Your earlier graphs highlight the problem very well. Chris mentions that
the proposed solution has already been committed, based upon my
analysis. 

Re-running the tests with the latest version of the software would help
confirm that the problem has gone away. Would you be able to repeat the
tests to confirm that the response time no longer peaks periodically as
it did before?

-- 
  Simon Riggs
  2ndQuadrant  http://www.2ndQuadrant.com

From cbbrowne at ca.afilias.info  Mon Jan 28 07:55:13 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Mon Jan 28 07:55:22 2008
Subject: [Slony1-general] SLON_DATA_FETCH_SIZE experiments
In-Reply-To: <1201535070.4257.677.camel@ebony.site> (Simon Riggs's message of
	"Mon, 28 Jan 2008 15:44:30 +0000")
References: <601wavf4kp.fsf@dba2.int.libertyrms.com>
	<47396E63.8080106@free.fr> <1195748137.4246.173.camel@ebony.site>
	<478F6BA9.7090102@free.fr> <1200593204.4255.243.camel@ebony.site>
	<479DDA75.5000100@echo.fr> <1201535070.4257.677.camel@ebony.site>
Message-ID: <60y7aagd26.fsf_-_@dba2.int.libertyrms.com>

Simon Riggs <simon@2ndquadrant.com> writes:
> Your earlier graphs highlight the problem very well. Chris mentions that
> the proposed solution has already been committed, based upon my
> analysis. 
>
> Re-running the tests with the latest version of the software would help
> confirm that the problem has gone away. Would you be able to repeat the
> tests to confirm that the response time no longer peaks periodically as
> it did before?

I wouldn't be surprised if it still has some periodic peaks that would
be alleviated by increasing the number of elements processed at a
time.

It may be that increasing SLON_DATA_FETCH_SIZE somewhat would be of
value.  (Well, just like the NO SCROLL cursor proposal, the value of
it would vanish if/when we implement COPY on sl_log_? data...)
-- 
let name="cbbrowne" and tld="cbbrowne.com" in name ^ "@" ^ tld;;
http://linuxdatabases.info/info/oses.html
Donny: Are these the Nazis, Walter?
Walter: No, Donny, these men are nihilists. There's nothing to be
afraid of.  -- The Big Lebowski
From simon at 2ndquadrant.com  Mon Jan 28 08:36:07 2008
From: simon at 2ndquadrant.com (Simon Riggs)
Date: Mon Jan 28 08:35:32 2008
Subject: [Slony1-general] Proposal: using COPY to pull sl_log_? data to
	subscribers
In-Reply-To: <604pcyhs96.fsf@dba2.int.libertyrms.com>
References: <60bq7x350m.fsf@dba2.int.libertyrms.com>
	<1201523565.4257.650.camel@ebony.site>
	<604pcyhs96.fsf@dba2.int.libertyrms.com>
Message-ID: <1201538167.4257.707.camel@ebony.site>

On Mon, 2008-01-28 at 10:41 -0500, Christopher Browne wrote:
> I don't see a benefit in dividing this process up; if it's a
>       "win" to do it on the subscriber, for the heavily updated
>       table(s), then should it not also be an improvement for the
>       lightly-updated tables?

The logic for doing 1 table-in then 1 table-out is very simple and Slony
already does exactly that during copy_set(). The data is reused
immediately without needing to unbuffer/rebuffer before sending, as you
would need to do if everything was in one stream. 

So I was thinking about re-factoring the copy_set() logic slightly to
allow a 1-table in/1-table out function that could then be called by
both copy_set() and during a normal sync.

ISTM doing 1-table at a time would be simpler and faster, and would
probably address the main cause of wanting to use COPY in the first
place: a few INSERT-heavy tables.

Thinking slightly more off-the-wall, maybe Slony could read large tables
directly, rather than logging them first. That would avoid lots of
additional code to support the "per-table log tables" described above.
Avoiding the logging table completely would also be a great performance
boost for Slony.

The sl_log columns are
	log_origin			int4,
	log_xid				@NAMESPACE@.xxid,
	log_tableid			int4,
	log_actionseq		int8,
	log_cmdtype			char,
	log_cmddata			text
If we do this for a single table then tableid and origin are known and
rows already have xmin on them. We do this *only* for INSERTs so cmdtype
is known and the rest of the row is the cmddata. So all we would need to
do is add an actionseq column onto a table to allow it to be its own log
table. We can then COPY the table directly, minus the actionseq column.

That way we just need to tell Slony which tables are "self-logging",
possibly by adding a new status col to sl_table. You'd need to build an
index on the table columns (xmin, actionseq) but thats fine if you use
the right btree operator class, as we already do for sl_log. 

Deletes and Updates would go through the normal route. We would use a
normal logging table if the data is being relayed.

-- 
  Simon Riggs
  2ndQuadrant  http://www.2ndQuadrant.com

From simon at 2ndquadrant.com  Mon Jan 28 08:45:59 2008
From: simon at 2ndquadrant.com (Simon Riggs)
Date: Mon Jan 28 08:45:26 2008
Subject: [Slony1-general] Re: SLON_DATA_FETCH_SIZE experiments
In-Reply-To: <60y7aagd26.fsf_-_@dba2.int.libertyrms.com>
References: <601wavf4kp.fsf@dba2.int.libertyrms.com>
	<47396E63.8080106@free.fr> <1195748137.4246.173.camel@ebony.site>
	<478F6BA9.7090102@free.fr> <1200593204.4255.243.camel@ebony.site>
	<479DDA75.5000100@echo.fr> <1201535070.4257.677.camel@ebony.site>
	<60y7aagd26.fsf_-_@dba2.int.libertyrms.com>
Message-ID: <1201538759.4257.712.camel@ebony.site>

On Mon, 2008-01-28 at 10:55 -0500, Christopher Browne wrote:
> Simon Riggs <simon@2ndquadrant.com> writes:
> > Your earlier graphs highlight the problem very well. Chris mentions that
> > the proposed solution has already been committed, based upon my
> > analysis. 
> >
> > Re-running the tests with the latest version of the software would help
> > confirm that the problem has gone away. Would you be able to repeat the
> > tests to confirm that the response time no longer peaks periodically as
> > it did before?
> 
> I wouldn't be surprised if it still has some periodic peaks that would
> be alleviated by increasing the number of elements processed at a
> time.

In general, you're right and I'd be happy if we added that as a tuning
parameter.

IIRC Cyril's peaks were associated directly with VACUUMs being performed
on the log tables, so we've fixed the cause rather than the symptom by
avoiding the VACUUMs. There might be other reasons why a backlog could
build up though, hence being able to tune the fetch size might allow us
to smooth out other response time peaks that we find later.

-- 
  Simon Riggs
  2ndQuadrant  http://www.2ndQuadrant.com

From dba at richyen.com  Mon Jan 28 13:33:53 2008
From: dba at richyen.com (Richard Yen)
Date: Mon Jan 28 13:34:12 2008
Subject: [Slony1-general] syslog output?
Message-ID: <E0C08BB6-70F3-4B5C-94C3-A31F6E2215DF@richyen.com>

Hi All,

Wondering if maybe I'm doing something wrong here.  I've set my syslog  
param in slon.conf to 2, which should log to syslog.  The docs say  
"some messages will still go to the standard output," so I'm wondering  
if these "some messages" are redundant since everything already goes  
to syslog.  Can I simply pipe standard output to /dev/null?

Thanks!
--Richard
From ouray at viney.ca  Mon Jan 28 14:24:04 2008
From: ouray at viney.ca (Ouray Viney)
Date: Mon Jan 28 14:24:19 2008
Subject: [Slony1-general] Re: Issues troubleshooting failing replication -
	(Master - Slave)
In-Reply-To: <a6570cd90801281405ib0a0937vd35d72bf163e2f3d@mail.gmail.com>
References: <a6570cd90801281405ib0a0937vd35d72bf163e2f3d@mail.gmail.com>
Message-ID: <a6570cd90801281424t2d4dfb16nd30beee98dcea907@mail.gmail.com>

Hi again, I just added myself to the subscription list...

Thanks

On 1/28/08, Ouray Viney <ouray@viney.ca> wrote:
>
> Hi All:
>
> I have spent most of the day parsing through the documentation, but have
> been unsuccessful in solving the problem.
>
> Environment setup:
>
> 1 master (host=3Dpgmaster, db=3Dssm)
> 1 slave (host=3Dpgslave1, db=3Dssm_slave)
>
> Commands run on the master:
>
> Note:  I will not include the db/user/pgplsql commands
>
> 1. run the schema script
>
>  [root@caotta000381 scripts]# psql -U ssm -d ssm -f ~/sessionmanager-
> postgresql-create.sql
>
> 2. initialize the cluster (run on master node)
>
> [root@caotta000381 ~]# slonik_init_cluster
>
> # INIT CLUSTER
> cluster name =3D ssm_cluster;
>  node 1 admin conninfo=3D'host=3Dpgmaster dbname=3Dssm user=3Dpostgres po=
rt=3D5432';
>  node 2 admin conninfo=3D'host=3Dpgslave1 dbname=3Dssm_slave user=3Dpostg=
res
> port=3D5432';
>   init cluster (id =3D 1, comment =3D 'Node 1 - ssm@pgmaster');
>
> # STORE NODE
>   store node (id =3D 2, event node =3D 1, comment =3D 'Node 2 -
> ssm_slave@pgslave1');
>   echo 'Set up replication nodes';
>
> # STORE PATH
>   echo 'Next: configure paths for each node/origin';
>   store path (server =3D 1, client =3D 2, conninfo =3D 'host=3Dpgmaster d=
bname=3Dssm
> user=3Dpostgres port=3D5432');
>   store path (server =3D 2, client =3D 1, conninfo =3D 'host=3Dpgslave1
> dbname=3Dssm_slave user=3Dpostgres port=3D5432');
>   echo 'Replication nodes prepared';
>   echo 'Please start a slon replication daemon for each node';
> [root@caotta000381 ~]# slonik_init_cluster | slonik
> <stdin>:10: Set up replication nodes
> <stdin>:13: Next: configure paths for each node/origin
> <stdin>:16: Replication nodes prepared
> <stdin>:17: Please start a slon replication daemon for each node
>
> 3. Start slon process
>
> [root@caotta000381 ~]# slon_start 1
> Invoke slon for node 1 - /usr/bin/slon -s 1000 -d2 ssm_cluster
> 'host=3Dpgmaster dbname=3Dssm user=3Dpostgres port=3D5432' 2>&1 >
> /var/log/slony/slony1/node1/ssm-2008-01-28_13:47:29.log &
> Slon successfully started for cluster ssm_cluster, node node1
> PID [12806]
> Start the watchdog process as well...
> [root@caotta000381 ~]# slon_start 2
> Invoke slon for node 2 - /usr/bin/slon -s 1000 -d2 ssm_cluster
> 'host=3Dpgslave1 dbname=3Dssm_slave user=3Dpostgres port=3D5432' 2>&1 >
> /var/log/slony/slony1/node2/ssm_slave-2008-01-28_13:47:38.log &
> Slon successfully started for cluster ssm_cluster, node node2
> PID [12849]
> Start the watchdog process as well...
> [root@caotta000381 ~]#
>
> 4. build skeleton for slon_tools.conf
>
> build the skeleton script for slon_tools.conf
>
> slonik_build_env -node pgmaster:ssm:postgres -node
> pgslave1:ssm_slave:postgres
>
> [root@caotta000381 pgsql]# slonik_build_env -node pgmaster:ssm:postgres
> -node pgslave1:ssm_slave:postgres
> &add_node(host =3D> 'pgmaster', dbname =3D> 'ssm', port =3D>5432,
>         user=3D>'postgres', password=3D>'', node=3D>1 );
> &add_node(host =3D> 'pgslave1', dbname =3D> 'ssm_slave', port =3D>5432,
>         user=3D>'postgres', password=3D>'', node=3D>2 , parent=3D>1);
> @KEYEDTABLES=3D(
>         "public.managednumberrouteset",
>         "public.mediationstrategy",
>         "public.nonmanagednumbestfitrouteset",
>         "public.normalization",
>         "public.normalizationtype",
>         "public.numberforwarding",
>         "public.outboundrouteorder",
>         "public.outboundrouteset",
>         "public.route",
>         "public.routetype",
>         "public.routetype_normalization",
> );
> @SEQUENCES=3D(
>         "public.nonmanagednumbestfitrouteset_outboundroutelogicid_seq",
>         "public.normalization_normalizationid_seq",
> );
>
> 5.  Add that data to the slon_tools.conf
>
> 6. Create the replication sets
>
> [root@caotta000381 etc]# slonik_create_set 1
> cluster name =3D ssm_cluster;
>  node 1 admin conninfo=3D'host=3Dpgmaster dbname=3Dssm user=3Dpostgres po=
rt=3D5432';
>  node 2 admin conninfo=3D'host=3Dpgslave1 dbname=3Dssm_slave user=3Dpostg=
res
> port=3D5432';
>
> # TABLE ADD KEY
>
> # CREATE SET
>   try {
>     create set (id =3D 1, origin =3D 1, comment =3D 'Set 1 for ssm_cluste=
r');
>   } on error {
>     echo 'Could not create subscription set 1 for ssm_cluster!';
>     exit -1;
>   }
>
> # SET ADD TABLE
>   echo 'Subscription set 1 created';
>   echo 'Adding tables to the subscription set';
>   set add table (set id =3D 1, origin =3D 1, id =3D 1,
>                  full qualified name =3D '
> public.nonmanagednumbestfitrouteset', key=3D'public.normalization',
>                  comment =3D 'Table public.nonmanagednumbestfitrouteset w=
ith
> candidate primary key public.normalization');
>   echo 'Add candidate primary keyed table
> public.nonmanagednumbestfitrouteset';
>   set add table (set id =3D 1, origin =3D 1, id =3D 2,
>                  full qualified name =3D 'public.outboundrouteorder', key=
=3D'
> public.outboundrouteset',
>                  comment =3D 'Table public.outboundrouteorder with candid=
ate
> primary key public.outboundrouteset');
>   echo 'Add candidate primary keyed table public.outboundrouteorder';
>   set add table (set id =3D 1, origin =3D 1, id =3D 3,
>                  full qualified name =3D 'public.normalizationtype', key=
=3D'
> public.numberforwarding',
>                  comment =3D 'Table public.normalizationtype with candida=
te
> primary key public.numberforwarding');
>   echo 'Add candidate primary keyed table public.normalizationtype';
>   set add table (set id =3D 1, origin =3D 1, id =3D 4,
>                  full qualified name =3D 'public.route', key=3D'
> public.routetype',
>                  comment =3D 'Table public.route with candidate primary k=
ey
> public.routetype');
>   echo 'Add candidate primary keyed table public.route';
>   set add table (set id =3D 1, origin =3D 1, id =3D 5,
>                  full qualified name =3D 'public.managednumberrouteset',
> key=3D'public.mediationstrategy',
>                  comment =3D 'Table public.managednumberrouteset with
> candidate primary key public.mediationstrategy');
>   echo 'Add candidate primary keyed table public.managednumberrouteset';
>   set add table (set id =3D 1, origin =3D 1, id =3D 6,
>                  full qualified name =3D 'public.routetype_normalization',
> key=3D'',
>                  comment =3D 'Table public.routetype_normalization with
> candidate primary key ');
>   echo 'Add candidate primary keyed table public.routetype_normalization';
>
> # SET ADD SEQUENCE
>   echo 'Adding sequences to the subscription set';
>   set add sequence (set id =3D 1, origin =3D 1, id =3D 1,
>                     full qualified name =3D '
> public.nonmanagednumbestfitrouteset_outboundroutelogicid_seq',
>                     comment =3D 'Sequence
> public.nonmanagednumbestfitrouteset_outboundroutelogicid_seq');
>   echo 'Add sequence
> public.nonmanagednumbestfitrouteset_outboundroutelogicid_seq';
>   set add sequence (set id =3D 1, origin =3D 1, id =3D 2,
>                     full qualified name =3D '
> public.normalization_normalizationid_seq',
>                     comment =3D 'Sequence
> public.normalization_normalizationid_seq');
>   echo 'Add sequence public.normalization_normalizationid_seq';
>   echo 'All tables added';
>
>   [root@caotta000381 etc]# slonik_create_set 1 | slonik
> <stdin>:16: Subscription set 1 created
> <stdin>:17: Adding tables to the subscription set
> <stdin>:18: PGRES_FATAL_ERROR select
> "_ssm_cluster".determineIdxnameUnique('public.nonmanagednumbestfitroutese=
t',
> 'public.normalization');  - ERROR:  Slony-I: table
> "public"."nonmanagednumbestfitrouteset" has no unique index
> public.normalization
>
> Note:  I ignored the error and moved on.  Perhaps this was a bad thing?
>
> 7. Subscribed the nodes to set
>
> [root@caotta000381 etc]# slonik_subscribe_set 1 2
> cluster name =3D ssm_cluster;
>  node 1 admin conninfo=3D'host=3Dpgmaster dbname=3Dssm user=3Dpostgres po=
rt=3D5432';
>  node 2 admin conninfo=3D'host=3Dpgslave1 dbname=3Dssm_slave user=3Dpostg=
res
> port=3D5432';
>   try {
>     subscribe set (id =3D 1, provider =3D 1, receiver =3D 2, forward =3D =
yes);
>   }
>   on error {
>     exit 1;
>   }
>   echo 'Subscribed nodes to set 1';
>
>   [root@caotta000381 etc]# slonik_subscribe_set 1 2 | slonik
> <stdin>:10: Subscribed nodes to set 1
>
> 8. When using the altperl scripts to setup the cluster, it isn't clear
> what tasks need to be performed on the slave node.  From what I read, the
> only thing that needs to be done on the slave nodes it what I read here:
> http://linuxfinances.info/info/addthings.html section: (12.4. Adding A
> Node To Replication).
>
> 9. Since I was a little confused I ran the following on the slave node
> assuming that I was doing the right thing (in accordance with the above
> reference):
>
> I ran this on the slave node:
>
> cluster name =3D ssm_cluster;
>  node 1 admin conninfo=3D'host=3Dpgmaster dbname=3Dssm user=3Dpostgres po=
rt=3D5432';
>  node 2 admin conninfo=3D'host=3Dpgslave1 dbname=3Dssmslave user=3Dpostgr=
es
> port=3D5432';
>   try {
>     subscribe set (id =3D 1, provider =3D 1, receiver =3D 2, forward =3D =
yes);
>   }
>   on error {
>     exit 1;
>   }
>   echo 'Subscribed nodes to set 1';
>
> 10. I inserted some data into the master db.
>
> 11. Checked the slon logs and didn't see any inserts getting replicated,
> so I knew something was wrong.
>
> 12. I ran the check_slony_cluster.sh on both nodes:
>
> Slave:
> -bash-3.00$ ./check_slony_cluster.sh ssm_cluster ssm_slave pgslave1
> ERROR - 1 of 1 nodes not in sync
>
> Master:
> -bash-3.00$ ./check_slony_cluster.sh ssm_cluster ssm pgmaster
> OK - 1 nodes in sync
>
> Running yet another replication test script:
>
> -bash-3.00$ ./psql_replication_check.pl -h pgslave1 -d ssm_slave -p 5432
> -U postgres
> ERROR:  relation "replication_status" does not exist
> -bash-3.00$ ./psql_replication_check.pl -h pgmaster -d ssm -p 5432 -U ssm
> ERROR:  relation "replication_status" does not exist
>
> At this point I have no idea were the problem lies.  I can guess my way
> through based on the commands that I have run.  But at this point I am not
> seeing any replication nor any sign after manipulating the data that any
> events were triggering replication.
>
> Here is a snippet of the slon log for the slave node:
>
> <snippet>
> 2008-01-28 16:57:05 EST DEBUG2 remoteWorkerThread_2: forward confirm
> 1,1140 received by 2
> 2008-01-28 16:57:13 EST DEBUG2 syncThread: new sl_action_seq 1 - SYNC 1141
> 2008-01-28 16:57:13 EST DEBUG2 localListenThread: Received event 1,1141
> SYNC
> 2008-01-28 16:57:16 EST DEBUG2 remoteListenThread_2: queue event 2,457
> SYNC
> 2008-01-28 16:57:16 EST DEBUG2 remoteWorkerThread_2: Received event 2,457
> SYNC
> 2008-01-28 16:57:16 EST DEBUG2 remoteWorkerThread_2: SYNC 457 processing
> 2008-01-28 16:57:16 EST DEBUG2 remoteWorkerThread_2: no sets need syncing
> for this event
> 2008-01-28 16:57:16 EST DEBUG2 remoteWorkerThread_2: forward confirm
> 1,1141 received by 2
> 2008-01-28 16:57:23 EST DEBUG2 syncThread: new sl_action_seq 1 - SYNC 1142
> 2008-01-28 16:57:23 EST DEBUG2 localListenThread: Received event 1,1142
> SYNC
> 2008-01-28 16:57:27 EST DEBUG2 remoteListenThread_2: queue event 2,458
> SYNC
> 2008-01-28 16:57:27 EST DEBUG2 remoteWorkerThread_2: Received event 2,458
> SYNC
> 2008-01-28 16:57:27 EST DEBUG2 remoteWorkerThread_2: SYNC 458 processing
> 2008-01-28 16:57:27 EST DEBUG2 remoteWorkerThread_2: no sets need syncing
> for this event
> 2008-01-28 16:57:27 EST DEBUG2 remoteWorkerThread_2: forward confirm
> 1,1142 received by 2
> 2008-01-28 16:57:31 EST DEBUG2 remoteListenThread_2: queue event 2,459
> SYNC
> 2008-01-28 16:57:31 EST DEBUG2 remoteWorkerThread_2: Received event 2,459
> SYNC
> 2008-01-28 16:57:31 EST DEBUG2 remoteWorkerThread_2: SYNC 459 processing
> 2008-01-28 16:57:31 EST DEBUG2 remoteWorkerThread_2: no sets need syncing
> for this event
> </snippet>
>
> I also did a simple query on the table that I had added data to on both
> nodes:
>
> master:
> =3D=3D=3D=3D=3D=3D=3D=3D=3D
> ssm=3D# select * from outboundrouteset;
>    outboundroutesetid   |     comments
> ------------------------+------------------
>  ATP_CMA_ROUTESET_ID_1  | ATP_TEST_COMMENT
>  ATP_CMB_ROUTESET_ID_1  | ATP_TEST_COMMENT
>  ATP_PSTN_ROUTESET_ID_1 | ATP_TEST_COMMENT
> (3 rows)
>
> slave:
> =3D=3D=3D=3D=3D=3D=3D=3D=3D
> ssm_slave=3D# select * from outboundrouteset;
>  outboundroutesetid | comments
> --------------------+----------
> (0 rows)
>
> From what I can tell, no sign of any replication occurring, which I would
> expect to look something like this:
>
> <snippet>
> 2007-10-31 06:57:04 EDT DEBUG2 remoteHelperThread_1_1: inserts=3D530
> updates=3D530 deletes=3D0
> 2007-10-31 06:57:04 EDT DEBUG2 remoteHelperThread_1_1: inserts=3D211
> updates=3D211 deletes=3D0
> 2007-10-31 06:57:05 EDT DEBUG2 remoteHelperThread_1_1: inserts=3D197
> updates=3D197 deletes=3D0
> 2007-10-31 06:57:06 EDT DEBUG2 remoteHelperThread_1_1: inserts=3D255
> updates=3D255 deletes=3D0
> 2007-10-31 06:57:07 EDT DEBUG2 remoteHelperThread_1_1: inserts=3D116
> updates=3D116 deletes=3D0
> </snippet>
>
> Any help in diagnosing replication failures would be greatly appreciated.
>
> Kind Rgds,
>
> Ouray
>
>
> --
> Ouray Viney
> https://www.viney.ca




-- =

Ouray Viney
https://www.viney.ca
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080128/=
ba5ae59d/attachment-0001.htm
From scetbon at echo.fr  Tue Jan 29 01:50:15 2008
From: scetbon at echo.fr (Cyril SCETBON)
Date: Tue Jan 29 01:50:35 2008
Subject: [Slony1-general] Version 1.2.12 released
In-Reply-To: <1201535070.4257.677.camel@ebony.site>
References: <601wavf4kp.fsf@dba2.int.libertyrms.com>	
	<47396E63.8080106@free.fr> <1195748137.4246.173.camel@ebony.site>	
	<478F6BA9.7090102@free.fr> <1200593204.4255.243.camel@ebony.site>	
	<479DDA75.5000100@echo.fr> <1201535070.4257.677.camel@ebony.site>
Message-ID: <479EF6D7.3020703@echo.fr>



Simon Riggs wrote:
> On Mon, 2008-01-28 at 14:36 +0100, Cyril SCETBON wrote:
>   
>> Simon Riggs wrote:
>>     
>>> On Thu, 2008-01-17 at 15:52 +0100, Cyril SCETBON wrote:
>>>
>>>   
>>>       
>>>> Here are the plots of several metrics taken with the original slon 
>>>> binary (25 september 2007) and with the new slon binary (including 
>>>> modifications of static variables, 16 october 2007)
>>>>     
>>>>         
>>> Cool graphs.
>>>
>>> First graph the effect you highlighted is shown very clearly.
>>>
>>> Second one may need repeating because if the performance really does get
>>> a lot worse *sometimes* then we may want to go back.
>>>
>>> Does this include Chris's latest changes to avoid VACUUM altogether?
>>>   
>>>       
>> no.
>>
>> NB: sorry I think my email was in a moderated state.
>>     
>
> Cyril,
>
> Sorry, I don't understand that.
>   
I just said that the tests were not running with the new version.
> Your earlier graphs highlight the problem very well. Chris mentions that
> the proposed solution has already been committed, based upon my
> analysis. 
>   
ok
> Re-running the tests with the latest version of the software would help
> confirm that the problem has gone away. Would you be able to repeat the
> tests to confirm that the response time no longer peaks periodically as
> it did before?
>   
not now cause other tests are already running. I'll try it as soon as I 
can. Can I try just the new slon daemon with the current configuration 
or do I have to recreate the cluster configuration ?

-- 
Cyril SCETBON - Ing?nieur bases de donn?es
AUSY pour France T?l?com - OPF/PORTAILS/DOP/HEBEX

T?l : +33 (0)4 97 12 87 60
Jabber : cscetbon@jabber.org
France Telecom - Orange
790 Avenue du Docteur Maurice Donat 
B?timent Marco Polo C2 
06250 Mougins
France

***********************************
Ce message et toutes les pieces jointes (ci-apres le 'message') sont
confidentiels et etablis a l'intention exclusive de ses destinataires.
Toute utilisation ou diffusion non autorisee est interdite.
Tout message electronique est susceptible d'alteration. Le Groupe France
Telecom decline toute responsabilite au titre de ce message s'il a ete
altere, deforme ou falsifie.
Si vous n'etes pas destinataire de ce message, merci de le detruire
immediatement et d'avertir l'expediteur.
***********************************
This message and any attachments (the 'message') are confidential and
intended solely for the addressees.
Any unauthorised use or dissemination is prohibited.
Messages are susceptible to alteration. France Telecom Group shall not be
liable for the message if altered, changed or falsified.
If you are not recipient of this message, please cancel it immediately and
inform the sender.
************************************

From glynastill at yahoo.co.uk  Tue Jan 29 08:41:12 2008
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Tue Jan 29 08:41:40 2008
Subject: [Slony1-general] Slony Nagios plugins  - sl_status
Message-ID: <742904.90360.qm@web25808.mail.ukl.yahoo.com>

Hi chaps,

I've been looking at the available plugins for nagios to check the
state of Slony replication.

I see theres a couple of perl scripts, that try and track an update
across the nodes, then theres is a psql_replication_check.pl script
that checks the timestamp on a recent update.

Am I not mistaken in thinking that the best thing to monitor would be
the sl_status view on each node?  Then if st_lag_num_events goes
above a certain limit we know there may be a problem?

Of course this would not help us on a table by table basis, but it's
surely a good idea to be monitoring it is it not?

And if so are is anyone aware of plugins that already exist before I
attempt to create one?

Glyn


      ___________________________________________________________
Support the World Aids Awareness campaign this month with Yahoo! For Good http://uk.promotions.yahoo.com/forgood/

From jpfletch at ca.afilias.info  Tue Jan 29 09:03:15 2008
From: jpfletch at ca.afilias.info (JP Fletcher)
Date: Tue Jan 29 09:03:20 2008
Subject: [Slony1-general] Slony Nagios plugins  - sl_status
In-Reply-To: <742904.90360.qm@web25808.mail.ukl.yahoo.com>
References: <742904.90360.qm@web25808.mail.ukl.yahoo.com>
Message-ID: <479F5C53.3070808@ca.afilias.info>

Glyn Astill wrote:
> Hi chaps,
> 
> I've been looking at the available plugins for nagios to check the
> state of Slony replication.
> 
> I see theres a couple of perl scripts, that try and track an update
> across the nodes, then theres is a psql_replication_check.pl script
> that checks the timestamp on a recent update.
> 
> Am I not mistaken in thinking that the best thing to monitor would be
> the sl_status view on each node? 

I think you would want to monitor st_lag_num_events on the origin for
each set, not on the downstream nodes.


Then if st_lag_num_events goes
> above a certain limit we know there may be a problem?
> 
> Of course this would not help us on a table by table basis, but it's
> surely a good idea to be monitoring it is it not?
> 
> And if so are is anyone aware of plugins that already exist before I
> attempt to create one?
> 
> Glyn
> 
> 
>       ___________________________________________________________
> Support the World Aids Awareness campaign this month with Yahoo! For Good http://uk.promotions.yahoo.com/forgood/
> 
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


-- 
JP Fletcher
Database Administrator
Afilias Canada
voice: 416.646.3304 ext. 4123
fax: 416.646.3305
mobile: 416.561.4763
jpfletch@ca.afilias.info
From ajs at crankycanuck.ca  Tue Jan 29 09:38:12 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Tue Jan 29 09:38:27 2008
Subject: [Slony1-general] Proposal: using COPY to pull sl_log_? data to
	subscribers
In-Reply-To: <1201538167.4257.707.camel@ebony.site>
References: <60bq7x350m.fsf@dba2.int.libertyrms.com>
	<1201523565.4257.650.camel@ebony.site>
	<604pcyhs96.fsf@dba2.int.libertyrms.com>
	<1201538167.4257.707.camel@ebony.site>
Message-ID: <20080129173812.GA26594@crankycanuck.ca>

On Mon, Jan 28, 2008 at 04:36:07PM +0000, Simon Riggs wrote:
> 
> Deletes and Updates would go through the normal route. We would use a
> normal logging table if the data is being relayed.

But all the data is being relayed in just about every case, AFAICS.

A

From ouray at viney.ca  Tue Jan 29 11:13:59 2008
From: ouray at viney.ca (Ouray Viney)
Date: Tue Jan 29 11:14:08 2008
Subject: [Slony1-general] Slony-I not setting up replication triggers
	(though defined)
Message-ID: <a6570cd90801291113m402803adv4f4bfe42353d3d3f@mail.gmail.com>

Hi All:

I have recently been troubleshooting why slony only sets up replication
triggers for 6 of 11 tables (I verified this two ways; one: in the slave
slon logs:

 "2008-01-29 14:11:58 EST DEBUG2 remoteWorkerThread_1: syncing set 1 with 6
table(s) from provider 1"

two; by running \d against each of the tables to see what triggers existed);
even though I have the required "set add table" (see below for complete
example) for each of the tables that I want replicated.

set add table (set id =3D 1, origin =3D 1, id =3D 1,
                 full qualified name =3D 'public.nonmanagednumbestfitroutes=
et
',
                 comment =3D 'Table public.nonmanagednumbestfitrouteset with
candidate primary key public.normalization');

When I run the slonik script; slonik < createReplicationSet.ik; I don't have
any complaints.

After completing the rest of the setup; i.e. subscribing the slave to the
master's replication set.

I figure out that there were missing triggers by looking at each of the
tables:

Example:

I defined the table in the replication set definition slonik script:

set add table (set id =3D 1, origin =3D 1, id =3D 5,
                 full qualified name =3D 'public.managednumberrouteset',
                 comment =3D 'Table public.managednumberrouteset with
candidate primary key public.mediationstrategy');
  echo 'Add candidate primary keyed table public.managednumberrouteset';

You will notice that since our table 'public.managednumberrouteset' has a
primary key; I opt to not define it (since according to the docs, is OK and
will tell slony to use the one that it detects)

Here is the create statement for the table in question:

<snippet>
    create table public.mediationstrategy (
        strategyname varchar(255) not null unique,
        description varchar(2000),
        extbindingname varchar(255) not null,
        primary key (strategyname)
    );
</snippet>

I completed the cluster configuration; started the slon process for both
master and slave; and started inserting data into that particular tables;
but I noticed that there were 0 INSERTS reported by the slave slon daemon.
I inspected the database on both sides:

master:
ssm=3D# select * from mediationstrategy;
 strategyname | description | extbindingname
--------------+-------------+----------------
 cmstrategy   | cmstrategy  | cmstrategy
 pstn         | pstn        | pstn
(2 rows)

ssm=3D# \d mediationstrategy
           Table "public.mediationstrategy"
     Column     |          Type           | Modifiers
----------------+-------------------------+-----------
 strategyname   | character varying(255)  | not null
 description    | character varying(2000) |
 extbindingname | character varying(255)  | not null
Indexes:
    "mediationstrategy_pkey" PRIMARY KEY, btree (strategyname)

Note: That is how I figured that slony didn't obey the replication set
script (as outlined above)

Slave:

ssm_slave=3D# select * from mediationstrategy;
 strategyname | description | extbindingname
--------------+-------------+----------------
(0 rows)

ssm_slave=3D# \d mediationstrategy
           Table "public.mediationstrategy"
     Column     |          Type           | Modifiers
----------------+-------------------------+-----------
 strategyname   | character varying(255)  | not null
 description    | character varying(2000) |
 extbindingname | character varying(255)  | not null
Indexes:
    "mediationstrategy_pkey" PRIMARY KEY, btree (strategyname)


Question:  Could someone explain what I may have done incorrectly to define
the replication set.

Note:  I used the slonik_build_env script as outlined below to populate my
slon_tools.conf.

[root@caotta000381 ~]# slonik_build_env -node pgmaster:ssm:ssm -node
pgslave1:ssm_slave:ssm
&add_node(host =3D> 'pgmaster', dbname =3D> 'ssm', port =3D>5432,
        user=3D>'ssm', password=3D>'', node=3D>1 );
&add_node(host =3D> 'pgslave1', dbname =3D> 'ssm_slave', port =3D>5432,
        user=3D>'ssm', password=3D>'', node=3D>2 , parent=3D>1);
@KEYEDTABLES=3D(
        "public.managednumberrouteset",
        "public.mediationstrategy",
        "public.nonmanagednumbestfitrouteset",
        "public.normalization",
        "public.normalizationtype",
        "public.numberforwarding",
        "public.outboundrouteorder",
        "public.outboundrouteset",
        "public.route",
        "public.routetype",
        "public.routetype_normalization",
);
@SEQUENCES=3D(
        "public.nonmanagednumbestfitrouteset_outboundroutelogicid_seq",
        "public.normalization_normalizationid_seq",
);

According to the documenation; this is suitable to be added to the
slony_tools.conf; which is exactly what I did.

Thank you kindly for your help!


-- =

Ouray Viney
https://www.viney.ca
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080129/=
91f5af58/attachment.htm
From oviney at ubiquitysoftware.com  Tue Jan 29 12:20:21 2008
From: oviney at ubiquitysoftware.com (Ouray Viney)
Date: Tue Jan 29 12:22:20 2008
Subject: [Slony1-general] Slony-I not setting up replication triggers
	(though defined)
In-Reply-To: <a6570cd90801291113m402803adv4f4bfe42353d3d3f@mail.gmail.com>
References: <a6570cd90801291113m402803adv4f4bfe42353d3d3f@mail.gmail.com>
Message-ID: <479F8A85.4070201@ubiquitysoftware.com>

Hi All:

    Problem solved!  As I missed; the set add table commands was =

apparently missing 5 statements :(.

Thank you!

Ouray

Ouray Viney wrote:
> Hi All:
>
> I have recently been troubleshooting why slony only sets up =

> replication triggers for 6 of 11 tables (I verified this two ways; =

> one: in the slave slon logs:
>
>  "2008-01-29 14:11:58 EST DEBUG2 remoteWorkerThread_1: syncing set 1 =

> with 6 table(s) from provider 1"
>
> two; by running \d against each of the tables to see what triggers =

> existed); even though I have the required "set add table" (see below =

> for complete example) for each of the tables that I want replicated.
>
> set add table (set id =3D 1, origin =3D 1, id =3D 1,
>                  full qualified name =3D =

> 'public.nonmanagednumbestfitrouteset',
>                  comment =3D 'Table public.nonmanagednumbestfitrouteset =

> with candidate primary key public.normalization');
>
> When I run the slonik script; slonik < createReplicationSet.ik; I =

> don't have any complaints.
>
> After completing the rest of the setup; i.e. subscribing the slave to =

> the master's replication set.
>
> I figure out that there were missing triggers by looking at each of =

> the tables:
>
> Example:
>
> I defined the table in the replication set definition slonik script:
>
> set add table (set id =3D 1, origin =3D 1, id =3D 5,
>                  full qualified name =3D 'public.managednumberrouteset',
>                  comment =3D 'Table public.managednumberrouteset with =

> candidate primary key public.mediationstrategy');
>   echo 'Add candidate primary keyed table public.managednumberrouteset';
>
> You will notice that since our table 'public.managednumberrouteset' =

> has a primary key; I opt to not define it (since according to the =

> docs, is OK and will tell slony to use the one that it detects)
>
> Here is the create statement for the table in question:
>
> <snippet>
>     create table public.mediationstrategy (
>         strategyname varchar(255) not null unique,
>         description varchar(2000),
>         extbindingname varchar(255) not null,
>         primary key (strategyname)
>     );
> </snippet>
>
> I completed the cluster configuration; started the slon process for =

> both master and slave; and started inserting data into that particular =

> tables; but I noticed that there were 0 INSERTS reported by the slave =

> slon daemon.   I inspected the database on both sides:
>
> master:
> ssm=3D# select * from mediationstrategy;
>  strategyname | description | extbindingname
> --------------+-------------+----------------
>  cmstrategy   | cmstrategy  | cmstrategy
>  pstn         | pstn        | pstn
> (2 rows)
>
> ssm=3D# \d mediationstrategy
>            Table "public.mediationstrategy"
>      Column     |          Type           | Modifiers
> ----------------+-------------------------+-----------
>  strategyname   | character varying(255)  | not null
>  description    | character varying(2000) |
>  extbindingname | character varying(255)  | not null
> Indexes:
>     "mediationstrategy_pkey" PRIMARY KEY, btree (strategyname)
>
> Note: That is how I figured that slony didn't obey the replication set =

> script (as outlined above)
>
> Slave:
>
> ssm_slave=3D# select * from mediationstrategy;
>  strategyname | description | extbindingname
> --------------+-------------+----------------
> (0 rows)
>
> ssm_slave=3D# \d mediationstrategy
>            Table "public.mediationstrategy"
>      Column     |          Type           | Modifiers
> ----------------+-------------------------+-----------
>  strategyname   | character varying(255)  | not null
>  description    | character varying(2000) |
>  extbindingname | character varying(255)  | not null
> Indexes:
>     "mediationstrategy_pkey" PRIMARY KEY, btree (strategyname)
>
>
> Question:  Could someone explain what I may have done incorrectly to =

> define the replication set. =

>
> Note:  I used the slonik_build_env script as outlined below to =

> populate my slon_tools.conf.
>
> [root@caotta000381 ~]# slonik_build_env -node pgmaster:ssm:ssm -node =

> pgslave1:ssm_slave:ssm
> &add_node(host =3D> 'pgmaster', dbname =3D> 'ssm', port =3D>5432,
>         user=3D>'ssm', password=3D>'', node=3D>1 );
> &add_node(host =3D> 'pgslave1', dbname =3D> 'ssm_slave', port =3D>5432,
>         user=3D>'ssm', password=3D>'', node=3D>2 , parent=3D>1);
> @KEYEDTABLES=3D(
>         "public.managednumberrouteset",
>         "public.mediationstrategy",
>         "public.nonmanagednumbestfitrouteset",
>         "public.normalization",
>         "public.normalizationtype",
>         "public.numberforwarding",
>         "public.outboundrouteorder",
>         "public.outboundrouteset",
>         "public.route",
>         "public.routetype",
>         "public.routetype_normalization",
> );
> @SEQUENCES=3D(
>         "public.nonmanagednumbestfitrouteset_outboundroutelogicid_seq",
>         "public.normalization_normalizationid_seq",
> );
>
> According to the documenation; this is suitable to be added to the =

> slony_tools.conf; which is exactly what I did.
>
> Thank you kindly for your help!
>
>
> -- =

> Ouray Viney
> https://www.viney.ca
> ------------------------------------------------------------------------
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>   =



-- =




    Ouray Viney | Software Developer Engineer II | Avaya | 515 Legget
    Drive | Suite 400 | Ottawa, ON, K2G6Z6 |
    Voice: +1.613.271.5072 | Fax +1.613.271.8817 | oviney@avaya.com

    www.avaya.ca <http://www.avaya.ca>

-------------- next part --------------
A non-text attachment was scrubbed...
Name: oviney.vcf
Type: text/x-vcard
Size: 269 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20080129=
/8dfb704d/oviney.vcf
From satya461 at gmail.com  Wed Jan 30 02:51:19 2008
From: satya461 at gmail.com (Satya)
Date: Wed Jan 30 02:51:38 2008
Subject: [Slony1-general] Slony-1 1.12.13 tests failing with PostgreSQL 8.3
	RC2
Message-ID: <6ccff2720801300251xa10297eg284b7654a049b0a5@mail.gmail.com>

Hi,

I have checked out slony-1 source code from cvs and tried compiling with
PostgreSQL 8.3 RC2(checkout version). I was able to compile it but slony
tests are failing.
Has anyone faced this problem? Is there some issue with Slony code? Please
let me know if I need to attach any logs.
All the slony tests are failing but I am attaching the logs for only one
test(testmergeset).



SLONY TEST LOG:
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
bash-3.2$ PGBINDIR=3D/space/WORK/postgres/bin/  PGUSER=3Dsatya ./run_test.sh
testmergeset
test: testmergeset
----------------------------------------------------
$Id: README,v 1.2 2007-10-26 14:47:24 cbbrowne Exp $

testmergeset sets up a series of replication sets, progressively
merging them together.

This was written based on "testpartition", the difference being that
in this test, tables are added to replication via explicitly creating
a set (a temporary set #999), and then merging that set back into the
main set.

This test also takes a fairly aggressive tack on usage of WAIT FOR
EVENT; when it gets into the "merge phase," it submits a SYNC followed
by waiting for that SYNC to be confirmed on all relevant nodes before
submitting a MERGE SET request to eliminate the extra set.  It does
not use any SLEEP requests; concurrency control is expected to be
controlled by WAIT FOR EVENT.
----------------------------------------------------
Test by j.random.luser@example.net to be summarized in /tmp/Slony-
I-test-results.log
creating origin DB: satya -h localhost -U satya -p 5432 slonyregress1
add plpgsql to Origin
loading origin DB with testmergeset/init_schema.sql
setting up user satya to have weak access to data
done
creating subscriber 2 DB: satya -h localhost -U satya -p 5432 slonyregress2
add plpgsql to subscriber
loading subscriber 2 DB from slonyregress1
done
creating subscriber 3 DB: satya -h localhost -U satya -p 5432 slonyregress3
add plpgsql to subscriber
loading subscriber 3 DB from slonyregress1
done
creating subscriber 4 DB: satya -h localhost -U satya -p 5432 slonyregress4
add plpgsql to subscriber
loading subscriber 4 DB from slonyregress1
done
creating cluster
done
storing nodes
done
Granting weak access on Slony-I schema
done
storing paths
done
launching originnode : /space/WORK/postgres/bin//slon  -s500 -g10 -d2
slony_regress1 "dbname=3Dslonyregress1 host=3Dlocalhost user=3Dsatya port=
=3D5432"
Archive node:
Considering node 2
launching: /space/WORK/postgres/bin//slon -s500 -g10 -d2  slony_regress1
"dbname=3Dslonyregress2 host=3Dlocalhost user=3Dsatya port=3D5432"
Considering node 3
launching: /space/WORK/postgres/bin//slon -s500 -g10 -d2  slony_regress1
"dbname=3Dslonyregress3 host=3Dlocalhost user=3Dsatya port=3D5432"
Considering node 4
launching: /space/WORK/postgres/bin//slon -s500 -g10 -d2  slony_regress1
"dbname=3Dslonyregress4 host=3Dlocalhost user=3Dsatya port=3D5432"
subscribing

and HANGS at this stage..

Postgres Log
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
LOG:  database system was shut down at 2008-01-30 16:12:30 IST
LOG:  autovacuum launcher started
LOG:  database system is ready to accept connections
NOTICE:  CREATE TABLE / PRIMARY KEY will create implicit index
"regions_pkey" for table "regions"
NOTICE:  CREATE TABLE will create implicit sequence
"products_product_id_seq" for serial column "products.product_id"
NOTICE:  CREATE TABLE / PRIMARY KEY will create implicit index
"products_pkey" for table "products"
NOTICE:  CREATE TABLE / UNIQUE will create implicit index
"products_name_key" for table "products"
NOTICE:  CREATE TABLE will create implicit sequence "sales_txns_id_seq" for
serial column "sales_txns.id"
NOTICE:  CREATE TABLE / PRIMARY KEY will create implicit index
"sales_txns_pkey" for table "sales_txns"
ERROR:  relation "public.table1" does not exist
STATEMENT:  grant select on table public.table1 to satya;
ERROR:  relation "public.table1_id_seq" does not exist
STATEMENT:  grant select on table public.table1_id_seq to satya;
ERROR:  relation "public.table2" does not exist
STATEMENT:  grant select on table public.table2 to satya;
ERROR:  relation "public.table2_id_seq" does not exist
STATEMENT:  grant select on table public.table2_id_seq to satya;
ERROR:  relation "public.table1a" does not exist
STATEMENT:  grant select on table public.table1a to satya;
ERROR:  relation "public.table1a_id_seq" does not exist
STATEMENT:  grant select on table public.table1a_id_seq to satya;
ERROR:  relation "public.table2a" does not exist
STATEMENT:  grant select on table public.table2a to satya;
ERROR:  relation "public.table2a_id_seq" does not exist
STATEMENT:  grant select on table public.table2a_id_seq to satya;
ERROR:  Missing sales_txns partition for date 2006-01-15 00:00:00+05:30
CONTEXT:  SQL statement "INSERT INTO sales_txns (region_code, product_id,
quantity, amount, trans_on) values ( $1 ,  $2 ,  $3 ,  $4 ,  $5 )"
        PL/pgSQL function "purchase_product" line 11 at SQL statement
STATEMENT:  select purchase_product( region_code, product_id,
(random()*5+random()*8+random()*7)::integer, '2006-01-15') from regions,
products order by random() limit 3;
ERROR:  Missing sales_txns partition for date 2006-01-16 00:00:00+05:30
CONTEXT:  SQL statement "INSERT INTO sales_txns (region_code, product_id,
quantity, amount, trans_on) values ( $1 ,  $2 ,  $3 ,  $4 ,  $5 )"
        PL/pgSQL function "purchase_product" line 11 at SQL statement
STATEMENT:  select purchase_product( region_code, product_id,
(random()*5+random()*8+random()*7)::integer, '2006-01-16') from regions,
products order by random() limit 3;
ERROR:  Missing sales_txns partition for date 2006-01-17 00:00:00+05:30
CONTEXT:  SQL statement "INSERT INTO sales_txns (region_code, product_id,
quantity, amount, trans_on) values ( $1 ,  $2 ,  $3 ,  $4 ,  $5 )"
        PL/pgSQL function "purchase_product" line 11 at SQL statement
STATEMENT:  select purchase_product( region_code, product_id,
(random()*5+random()*8+random()*7)::integer, '2006-01-17') from regions,
products order by random() limit 3;
ERROR:  Missing sales_txns partition for date 2006-01-18 00:00:00+05:30
CONTEXT:  SQL statement "INSERT INTO sales_txns (region_code, product_id,
quantity, amount, trans_on) values ( $1 ,  $2 ,  $3 ,  $4 ,  $5 )"
        PL/pgSQL function "purchase_product" line 11 at SQL statement
STATEMENT:  select purchase_product( region_code, product_id,
(random()*5+random()*8+random()*7)::integer, '2006-01-18') from regions,
products order by random() limit 3;
ERROR:  Missing sales_txns partition for date 2006-01-19 00:00:00+05:30
CONTEXT:  SQL statement "INSERT INTO sales_txns (region_code, product_id,
quantity, amount, trans_on) values ( $1 ,  $2 ,  $3 ,  $4 ,  $5 )"
        PL/pgSQL function "purchase_product" line 11 at SQL statement
STATEMENT:  select purchase_product( region_code, product_id,
(random()*5+random()*8+random()*7)::integer, '2006-01-19') from regions,
products order by random() limit 3;
ERROR:  Missing sales_txns partition for date 2006-01-20 00:00:00+05:30
CONTEXT:  SQL statement "INSERT INTO sales_txns (region_code, product_id,
quantity, amount, trans_on) values ( $1 ,  $2 ,  $3 ,  $4 ,  $5 )"
        PL/pgSQL function "purchase_product" line 11 at SQL statement
STATEMENT:  select purchase_product( region_code, product_id,
(random()*5+random()*8+random()*7)::integer, '2006-01-20') from regions,
products order by random() limit 3;
ERROR:  language "plpgsql" already exists
STATEMENT:  CREATE PROCEDURAL LANGUAGE plpgsql;
NOTICE:  ALTER TABLE / ADD UNIQUE will create implicit index
"products_name_key" for table "products"
NOTICE:  ALTER TABLE / ADD PRIMARY KEY will create implicit index
"products_pkey" for table "products"
NOTICE:  ALTER TABLE / ADD PRIMARY KEY will create implicit index
"regions_pkey" for table "regions"
NOTICE:  ALTER TABLE / ADD PRIMARY KEY will create implicit index
"sales_txns_pkey" for table "sales_txns"
ERROR:  language "plpgsql" already exists
STATEMENT:  CREATE PROCEDURAL LANGUAGE plpgsql;
NOTICE:  ALTER TABLE / ADD UNIQUE will create implicit index
"products_name_key" for table "products"
NOTICE:  ALTER TABLE / ADD PRIMARY KEY will create implicit index
"products_pkey" for table "products"
NOTICE:  ALTER TABLE / ADD PRIMARY KEY will create implicit index
"regions_pkey" for table "regions"
NOTICE:  ALTER TABLE / ADD PRIMARY KEY will create implicit index
"sales_txns_pkey" for table "sales_txns"
ERROR:  language "plpgsql" already exists


Regards,
Satya
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080130/=
727c3804/attachment.htm
From linux4michelle at freenet.de  Sat Jan 26 04:31:19 2008
From: linux4michelle at freenet.de (Michelle Konzack)
Date: Wed Jan 30 05:26:01 2008
Subject: [Slony1-general] Slony-Newbie need help with table partitioning
Message-ID: <20080126123119.GX696@freenet.de>

Hello,

last night I have reinstalled three PostgreSQL 8.2 servers which replaced
a cluster of 30 old 7.4, had build a singel Database and went controlled
by a separated server which has done the search over the tables located
on the thirty Servers.

We have over 8000 tables (which build the database data and has each
between 50 and 2000 MByte = 5,4 TByte in summary) and I have imported it
in one of the new 8.2.

Now we want to create a "master" table (table partitioning) and at the
same time we use clustering since the new Server is cuted into Raid-1
with Hotfix (3 disks of 300 GByte each).

Since I am NEWBIE to Slony, please can you tell me how to replicate such
database?  I am reading the docs since hours but they drive me crazy...

Thanks, Greetings and nice Day
    Michelle Konzack
    Systemadministrator
    Tamay Dogan Network
    Debian GNU/Linux Consultant


-- 
Linux-User #280138 with the Linux Counter, http://counter.li.org/
##################### Debian GNU/Linux Consultant #####################
Michelle Konzack   Apt. 917                  ICQ #328449886
                   50, rue de Soultz         MSN LinuxMichi
0033/6/61925193    67100 Strasbourg/France   IRC #Debian (irc.icq.com)
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: Digital signature
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20080126/9a684938/attachment-0001.pgp
From lists at serioustechnology.com  Wed Jan 30 07:18:30 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Wed Jan 30 07:18:36 2008
Subject: [Slony1-general] list active nodes?
Message-ID: <47A09546.4040103@serioustechnology.com>

Is there a way to list the current active nodes?  That is, is it 
possible to see the results of 'slonik_init_cluster' ?

Thanks.

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From lists at serioustechnology.com  Wed Jan 30 08:59:23 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Wed Jan 30 08:59:32 2008
Subject: [Slony1-general] table_id error??
Message-ID: <47A0ACEB.20604@serioustechnology.com>

I posted about this once before, but didn't get any bites.  I'm hoping 
someone can enlighten me as to my error here.  I have the following 
configuration:

$SLONY_SETS = {

     "avldsSet" => {
         "set_id"       => 1,
             "table_id"     => 1,
             "sequence_id"  => 1,
             "pkeyedtables" => [....],
         "keyedtables"  => {},
             "serialtables" => [],
             "sequences"    => [....],
     }

     "nonavldsSet" => {
         "set_id"       => 2,
             "table_id"     => 2,
             "sequence_id"  => 2,
             "pkeyedtables" => [....],
         "keyedtables"  => {},
             "serialtables" => [],
             "sequences"    => [....],
     }
};

When I attempt to create the second set, I get an error as follows:

slonik_create_set --config $CONFIG 2|slonik
<stdin>:16: Subscription set 2 created
<stdin>:17: Adding tables to the subscription set
<stdin>:18: PGRES_FATAL_ERROR select "_mwv_cluster".setAddTable(2, 2, 
'public.aaccess', 'aaccess_pkey', 'Table public.aaccess with primary 
key');  - ERROR:  Slony-I: setAddTable_int: table id 2 has already been 
assigned!
CONTEXT:  PL/pgSQL function "setaddtable" line 37 at perform

Clearly, 'table id 2' has not been already defined.  What is it that I'm 
missing here?  Thanks for any assistance.

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From jeff at frostconsultingllc.com  Wed Jan 30 09:09:28 2008
From: jeff at frostconsultingllc.com (Jeff Frost)
Date: Wed Jan 30 09:09:35 2008
Subject: [Slony1-general] table_id error??
In-Reply-To: <47A0ACEB.20604@serioustechnology.com>
References: <47A0ACEB.20604@serioustechnology.com>
Message-ID: <Pine.LNX.4.64.0801300907260.3065@discord.home.frostconsultingllc.com>

On Wed, 30 Jan 2008, Geoffrey wrote:

> I posted about this once before, but didn't get any bites.  I'm hoping 
> someone can enlighten me as to my error here.  I have the following 
> configuration:
>
> When I attempt to create the second set, I get an error as follows:
>
> slonik_create_set --config $CONFIG 2|slonik
> <stdin>:16: Subscription set 2 created
> <stdin>:17: Adding tables to the subscription set
> <stdin>:18: PGRES_FATAL_ERROR select "_mwv_cluster".setAddTable(2, 2, 
> 'public.aaccess', 'aaccess_pkey', 'Table public.aaccess with primary key'); 
> - ERROR:  Slony-I: setAddTable_int: table id 2 has already been assigned!
> CONTEXT:  PL/pgSQL function "setaddtable" line 37 at perform
>
> Clearly, 'table id 2' has not been already defined.  What is it that I'm 
> missing here?  Thanks for any assistance.

Slony definitely thinks differently.  Have a look at sl_table to see what 
has id 2.  For example if your clustername is testcluster, then:

select * from _testcluster.sl_table where tab_id = 2;

-- 
Jeff Frost, Owner 	<jeff@frostconsultingllc.com>
Frost Consulting, LLC 	http://www.frostconsultingllc.com/
Phone: 650-780-7908	FAX: 650-649-1954
From lists at serioustechnology.com  Wed Jan 30 09:10:10 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Wed Jan 30 09:10:18 2008
Subject: [Slony1-general] table_id error??
In-Reply-To: <47A0ACEB.20604@serioustechnology.com>
References: <47A0ACEB.20604@serioustechnology.com>
Message-ID: <47A0AF72.5030301@serioustechnology.com>

RTFM, I figured it out.  The table id must be unique across sets, my 
bad.  The table id listed in the configuration file is the starting 
table id.

Geoffrey wrote:
> I posted about this once before, but didn't get any bites.  I'm hoping 
> someone can enlighten me as to my error here.  I have the following 
> configuration:
> 
> $SLONY_SETS = {
> 
>     "avldsSet" => {
>         "set_id"       => 1,
>             "table_id"     => 1,
>             "sequence_id"  => 1,
>             "pkeyedtables" => [....],
>         "keyedtables"  => {},
>             "serialtables" => [],
>             "sequences"    => [....],
>     }
> 
>     "nonavldsSet" => {
>         "set_id"       => 2,
>             "table_id"     => 2,
>             "sequence_id"  => 2,
>             "pkeyedtables" => [....],
>         "keyedtables"  => {},
>             "serialtables" => [],
>             "sequences"    => [....],
>     }
> };
> 
> When I attempt to create the second set, I get an error as follows:
> 
> slonik_create_set --config $CONFIG 2|slonik
> <stdin>:16: Subscription set 2 created
> <stdin>:17: Adding tables to the subscription set
> <stdin>:18: PGRES_FATAL_ERROR select "_mwv_cluster".setAddTable(2, 2, 
> 'public.aaccess', 'aaccess_pkey', 'Table public.aaccess with primary 
> key');  - ERROR:  Slony-I: setAddTable_int: table id 2 has already been 
> assigned!
> CONTEXT:  PL/pgSQL function "setaddtable" line 37 at perform
> 
> Clearly, 'table id 2' has not been already defined.  What is it that I'm 
> missing here?  Thanks for any assistance.
> 


-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From glynastill at yahoo.co.uk  Wed Jan 30 09:41:25 2008
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Wed Jan 30 09:48:14 2008
Subject: [Slony1-general] Slony Nagios plugins  - sl_status
In-Reply-To: <479F5C53.3070808@ca.afilias.info>
Message-ID: <663479.81171.qm@web25808.mail.ukl.yahoo.com>

Attached is my perl script to do this.

It's pretty basic so I doubt you lot would find it useful, but seeing
as it really is a "my first perl script" any criticism would be
welcome and appreciated.

Glyn

--- JP Fletcher <jpfletch@ca.afilias.info> wrote:

> Glyn Astill wrote:
> > Hi chaps,
> > 
> > I've been looking at the available plugins for nagios to check
> the
> > state of Slony replication.
> > 
> > I see theres a couple of perl scripts, that try and track an
> update
> > across the nodes, then theres is a psql_replication_check.pl
> script
> > that checks the timestamp on a recent update.
> > 
> > Am I not mistaken in thinking that the best thing to monitor
> would be
> > the sl_status view on each node? 
> 
> I think you would want to monitor st_lag_num_events on the origin
> for
> each set, not on the downstream nodes.
> 
> 
> Then if st_lag_num_events goes
> > above a certain limit we know there may be a problem?
> > 
> > Of course this would not help us on a table by table basis, but
> it's
> > surely a good idea to be monitoring it is it not?
> > 
> > And if so are is anyone aware of plugins that already exist
> before I
> > attempt to create one?
> > 
> > Glyn
> > 
> > 
> >       ___________________________________________________________
> > Support the World Aids Awareness campaign this month with Yahoo!
> For Good http://uk.promotions.yahoo.com/forgood/
> > 
> > _______________________________________________
> > Slony1-general mailing list
> > Slony1-general@lists.slony.info
> > http://lists.slony.info/mailman/listinfo/slony1-general
> 
> 
> -- 
> JP Fletcher
> Database Administrator
> Afilias Canada
> voice: 416.646.3304 ext. 4123
> fax: 416.646.3305
> mobile: 416.561.4763
> jpfletch@ca.afilias.info
> 



      ___________________________________________________________
Support the World Aids Awareness campaign this month with Yahoo! For Good http://uk.promotions.yahoo.com/forgood/
-------------- next part --------------
A non-text attachment was scrubbed...
Name: check_slony.pl
Type: application/octet-stream
Size: 3128 bytes
Desc: 2456555266-check_slony.pl
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20080130/0f8976a1/check_slony.obj
From lists at serioustechnology.com  Wed Jan 30 13:50:46 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Wed Jan 30 13:51:02 2008
Subject: [Slony1-general] Notice message, should I be concerned?
Message-ID: <47A0F136.8090806@serioustechnology.com>

I've seen the following message following successful replication of my 
database:

NOTICE:  Slony-I: cleanup stale sl_nodelock entry for pid=11623
CONTEXT:  PL/pgSQL function "cleanupevent" line 77 at perform
NOTICE:  Slony-I: cleanup stale sl_nodelock entry for pid=11763
CONTEXT:  PL/pgSQL function "cleanupevent" line 77 at perform

Is this something I should be concerned with?

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From cedric.villemain at dalibo.com  Wed Jan 30 17:06:37 2008
From: cedric.villemain at dalibo.com (=?ISO-8859-1?Q?C=E9dric_Villemain?=)
Date: Wed Jan 30 17:07:36 2008
Subject: [Slony1-general] Slony Nagios plugins  - sl_status
In-Reply-To: <663479.81171.qm@web25808.mail.ukl.yahoo.com>
References: <663479.81171.qm@web25808.mail.ukl.yahoo.com>
Message-ID: <47A11F1D.6040405@dalibo.com>

Glyn Astill a ?crit :
> Attached is my perl script to do this.
>
> It's pretty basic so I doubt you lot would find it useful, but seeing
> as it really is a "my first perl script" any criticism would be
> welcome and appreciated.
>   

I have just look at it a quick view ... you would use the common 
postgresql command line options ....


Else, I suggest you to add a table to your set, like 'last_update_set_X' 
then update it every 1 second for ex.
And check the last update on all nodes, you will have a real mesure of 
the effective lag.
I prefer (or also) check replication outside system provided by the 
replication engine itself ....

> Glyn
>
> --- JP Fletcher <jpfletch@ca.afilias.info> wrote:
>
>   
>> Glyn Astill wrote:
>>     
>>> Hi chaps,
>>>
>>> I've been looking at the available plugins for nagios to check
>>>       
>> the
>>     
>>> state of Slony replication.
>>>
>>> I see theres a couple of perl scripts, that try and track an
>>>       
>> update
>>     
>>> across the nodes, then theres is a psql_replication_check.pl
>>>       
>> script
>>     
>>> that checks the timestamp on a recent update.
>>>
>>> Am I not mistaken in thinking that the best thing to monitor
>>>       
>> would be
>>     
>>> the sl_status view on each node? 
>>>       
>> I think you would want to monitor st_lag_num_events on the origin
>> for
>> each set, not on the downstream nodes.
>>
>>
>> Then if st_lag_num_events goes
>>     
>>> above a certain limit we know there may be a problem?
>>>
>>> Of course this would not help us on a table by table basis, but
>>>       
>> it's
>>     
>>> surely a good idea to be monitoring it is it not?
>>>
>>> And if so are is anyone aware of plugins that already exist
>>>       
>> before I
>>     
>>> attempt to create one?
>>>
>>> Glyn
>>>
>>>
>>>       ___________________________________________________________
>>> Support the World Aids Awareness campaign this month with Yahoo!
>>>       
>> For Good http://uk.promotions.yahoo.com/forgood/
>>     
>>> _______________________________________________
>>> Slony1-general mailing list
>>> Slony1-general@lists.slony.info
>>> http://lists.slony.info/mailman/listinfo/slony1-general
>>>       
>> -- 
>> JP Fletcher
>> Database Administrator
>> Afilias Canada
>> voice: 416.646.3304 ext. 4123
>> fax: 416.646.3305
>> mobile: 416.561.4763
>> jpfletch@ca.afilias.info
>>
>>     
>
>
>
>       ___________________________________________________________
> Support the World Aids Awareness campaign this month with Yahoo! For Good http://uk.promotions.yahoo.com/forgood/
> ------------------------------------------------------------------------
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>   


-- 
C?dric Villemain
Administrateur de Base de Donn?es
Cel: +33 (0)6 74 15 56 53
http://dalibo.com - http://dalibo.org

From drees76 at gmail.com  Wed Jan 30 17:14:39 2008
From: drees76 at gmail.com (David Rees)
Date: Wed Jan 30 17:14:49 2008
Subject: [Slony1-general] Notice message, should I be concerned?
In-Reply-To: <47A0F136.8090806@serioustechnology.com>
References: <47A0F136.8090806@serioustechnology.com>
Message-ID: <72dbd3150801301714p488fd788mabc6900590b03ff9@mail.gmail.com>

On Jan 30, 2008 1:50 PM, Geoffrey <lists@serioustechnology.com> wrote:
> I've seen the following message following successful replication of my
> database:
>
> NOTICE:  Slony-I: cleanup stale sl_nodelock entry for pid=11623
> CONTEXT:  PL/pgSQL function "cleanupevent" line 77 at perform
> NOTICE:  Slony-I: cleanup stale sl_nodelock entry for pid=11763
> CONTEXT:  PL/pgSQL function "cleanupevent" line 77 at perform
>
> Is this something I should be concerned with?

No, those are perfectly normal after a slon daemon restart.

-Dave
From lists at serioustechnology.com  Thu Jan 31 05:33:59 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Thu Jan 31 05:34:05 2008
Subject: [Slony1-general] Notice message, should I be concerned?
In-Reply-To: <72dbd3150801301714p488fd788mabc6900590b03ff9@mail.gmail.com>
References: <47A0F136.8090806@serioustechnology.com>
	<72dbd3150801301714p488fd788mabc6900590b03ff9@mail.gmail.com>
Message-ID: <47A1CE47.6000303@serioustechnology.com>

David Rees wrote:
> On Jan 30, 2008 1:50 PM, Geoffrey <lists@serioustechnology.com> wrote:
>> I've seen the following message following successful replication of my
>> database:
>>
>> NOTICE:  Slony-I: cleanup stale sl_nodelock entry for pid=11623
>> CONTEXT:  PL/pgSQL function "cleanupevent" line 77 at perform
>> NOTICE:  Slony-I: cleanup stale sl_nodelock entry for pid=11763
>> CONTEXT:  PL/pgSQL function "cleanupevent" line 77 at perform
>>
>> Is this something I should be concerned with?
> 
> No, those are perfectly normal after a slon daemon restart.

Thanks.

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From lists at serioustechnology.com  Thu Jan 31 05:36:44 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Thu Jan 31 05:36:50 2008
Subject: [Slony1-general] a summary of our efforts
Message-ID: <47A1CEEC.8050401@serioustechnology.com>

I want to thank the folks who have assisted me in my endeavors to get 
Slony going.  We have successfully implemented replication on five of 
our test databases.

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From glynastill at yahoo.co.uk  Thu Jan 31 06:10:04 2008
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Thu Jan 31 06:10:12 2008
Subject: [Slony1-general] Slony Nagios plugins  - sl_status
In-Reply-To: <47A11F1D.6040405@dalibo.com>
Message-ID: <905236.39398.qm@web25801.mail.ukl.yahoo.com>

Hi C?dric,


--- C?dric Villemain <cedric.villemain@dalibo.com> wrote:

> I have just look at it a quick view ... you would use the common 
> postgresql command line options ....
> 

You mean I should use the postgresql command line options? ?? I'm not
sure what you mean here

> 
> Else, I suggest you to add a table to your set, like
> 'last_update_set_X' 
> then update it every 1 second for ex.
> And check the last update on all nodes, you will have a real mesure
> of 
> the effective lag.

Yes I agree with you, I will do this and I'll use the script that
comes with slony when I get around to it.

> I prefer (or also) check replication outside system provided by the
> 
> replication engine itself ....
> 

Not sure what you mean?


      __________________________________________________________
Sent from Yahoo! Mail - a smarter inbox http://uk.mail.yahoo.com


From elijah.zupancic at appliedwatch.com  Wed Jan  2 16:23:05 2008
From: elijah.zupancic at appliedwatch.com (Elijah24)
Date: Thu Sep 25 08:26:37 2008
Subject: [Slony1-general] error in docs?
In-Reply-To: <476089DC.2010506@serioustechnology.com>
References: <476089DC.2010506@serioustechnology.com>
Message-ID: <14589238.post@talk.nabble.com>


I am encountering the same issue. Is there someone more familiar with Slony
who can provide clarification?
-- 
View this message in context: http://www.nabble.com/error-in-docs--tp14307963p14589238.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.

From John.Fansler at ateb.com  Mon Jan  7 13:02:50 2008
From: John.Fansler at ateb.com (John Fansler)
Date: Thu Sep 25 08:26:40 2008
Subject: [Slony1-general] Windows logging
Message-ID: <7C0800F63CCF4149AC0FC5EE2A041226036D3DEA@sr002-2k3exc.ateb.com>

Hello,

 

I've installed Postgres 8.2.3 via binaries. It included Slony-I 1.2.9.

 

So far everything has worked very well. The only question I have is
whether there is a way to change where Slony performs its logging. I've
used the log level 2 as seemed to be recommended, but this causes the
Windows Application Event log to become basically useless. Slony fills
it up with the log entries created every few seconds.

 

Is there a way to configure Slony to log to it's own Windows Event Log?
Or is there a better way to handle logging on Windows?

 

Thanks in advance for any help,

 

-john

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080107/19e0f26d/attachment-0001.htm
From scetbon at echo.fr  Wed Jan 16 07:17:38 2008
From: scetbon at echo.fr (Cyril SCETBON)
Date: Thu Sep 25 08:26:41 2008
Subject: [Slony1-general] slony and utf8 databases
Message-ID: <478E2251.9080301@echo.fr>

Hi guys,


Are there known issues about that ?


Regards


-- 
Cyril SCETBON
From scetbon at echo.fr  Fri Jan 18 02:49:37 2008
From: scetbon at echo.fr (Cyril SCETBON)
Date: Thu Sep 25 08:26:42 2008
Subject: [Slony1-general] Version 1.2.12 released
In-Reply-To: <1200593204.4255.243.camel@ebony.site>
References: <601wavf4kp.fsf@dba2.int.libertyrms.com>	<47396E63.8080106@free.fr>
	<1195748137.4246.173.camel@ebony.site>	<478F6BA9.7090102@free.fr>
	<1200593204.4255.243.camel@ebony.site>
Message-ID: <4790842D.6020205@echo.fr>



Simon Riggs wrote:
> On Thu, 2008-01-17 at 15:52 +0100, Cyril SCETBON wrote:
>
>   
>> Here are the plots of several metrics taken with the original slon 
>> binary (25 september 2007) and with the new slon binary (including 
>> modifications of static variables, 16 october 2007)
>>     
>
> Cool graphs.
>
> First graph the effect you highlighted is shown very clearly.
>
> Second one may need repeating because if the performance really does get
> a lot worse *sometimes* then we may want to go back.
>   

> Does this include Chris's latest changes to avoid VACUUM altogether?
>   
no

-- 
Cyril SCETBON - Ing?nieur bases de donn?es
AUSY pour France T?l?com - OPF/PORTAILS/DOP/HEBEX

T?l : +33 (0)4 97 12 87 60
Jabber : cscetbon@jabber.org
France Telecom - Orange
790 Avenue du Docteur Maurice Donat 
B?timent Marco Polo C2 
06250 Mougins
France

***********************************
Ce message et toutes les pieces jointes (ci-apres le 'message') sont
confidentiels et etablis a l'intention exclusive de ses destinataires.
Toute utilisation ou diffusion non autorisee est interdite.
Tout message electronique est susceptible d'alteration. Le Groupe France
Telecom decline toute responsabilite au titre de ce message s'il a ete
altere, deforme ou falsifie.
Si vous n'etes pas destinataire de ce message, merci de le detruire
immediatement et d'avertir l'expediteur.
***********************************
This message and any attachments (the 'message') are confidential and
intended solely for the addressees.
Any unauthorised use or dissemination is prohibited.
Messages are susceptible to alteration. France Telecom Group shall not be
liable for the message if altered, changed or falsified.
If you are not recipient of this message, please cancel it immediately and
inform the sender.
************************************

From scetbon at echo.fr  Tue Jan 22 04:49:43 2008
From: scetbon at echo.fr (Cyril SCETBON)
Date: Thu Sep 25 08:26:42 2008
Subject: [Slony1-general] Version 1.2.12 released
In-Reply-To: <1200593204.4255.243.camel@ebony.site>
References: <601wavf4kp.fsf@dba2.int.libertyrms.com>	<47396E63.8080106@free.fr>
	<1195748137.4246.173.camel@ebony.site>	<478F6BA9.7090102@free.fr>
	<1200593204.4255.243.camel@ebony.site>
Message-ID: <4795E653.2080903@echo.fr>



Simon Riggs wrote:

> On Thu, 2008-01-17 at 15:52 +0100, Cyril SCETBON wrote:
>
>   
>> Here are the plots of several metrics taken with the original slon 
>> binary (25 september 2007) and with the new slon binary (including 
>> modifications of static variables, 16 october 2007)
>>     
>
> Cool graphs.
>
> First graph the effect you highlighted is shown very clearly.
>
> Second one may need repeating because if the performance really does get
> a lot worse *sometimes* then we may want to go back.
>   

> Does this include Chris's latest changes to avoid VACUUM altogether?
>   
No

-- 
Cyril SCETBON - Ing?nieur bases de donn?es
AUSY pour France T?l?com - OPF/PORTAILS/DOP/HEBEX

T?l : +33 (0)4 97 12 87 60
Jabber : cscetbon@jabber.org
France Telecom - Orange
790 Avenue du Docteur Maurice Donat 
B?timent Marco Polo C2 
06250 Mougins
France

***********************************
Ce message et toutes les pieces jointes (ci-apres le 'message') sont
confidentiels et etablis a l'intention exclusive de ses destinataires.
Toute utilisation ou diffusion non autorisee est interdite.
Tout message electronique est susceptible d'alteration. Le Groupe France
Telecom decline toute responsabilite au titre de ce message s'il a ete
altere, deforme ou falsifie.
Si vous n'etes pas destinataire de ce message, merci de le detruire
immediatement et d'avertir l'expediteur.
***********************************
This message and any attachments (the 'message') are confidential and
intended solely for the addressees.
Any unauthorised use or dissemination is prohibited.
Messages are susceptible to alteration. France Telecom Group shall not be
liable for the message if altered, changed or falsified.
If you are not recipient of this message, please cancel it immediately and
inform the sender.
************************************

From scetbon at echo.fr  Tue Jan 22 05:01:08 2008
From: scetbon at echo.fr (Cyril SCETBON)
Date: Thu Sep 25 08:26:43 2008
Subject: [Slony1-general] Modifying SLON_DATA_FETCH_SIZE
In-Reply-To: <60lk6oqwat.fsf_-_@dba2.int.libertyrms.com>
References: <601wavf4kp.fsf@dba2.int.libertyrms.com>	<47396E63.8080106@free.fr>
	<1195748137.4246.173.camel@ebony.site>	<478F6BA9.7090102@free.fr>
	<60lk6oqwat.fsf_-_@dba2.int.libertyrms.com>
Message-ID: <4795E901.8070001@echo.fr>



Christopher Browne wrote:

> Note I've changed the subject to make that seem more relevant...
>
> Cyril SCETBON <cyril.scetbon@free.fr> writes:
>   
>> Here are the plots of several metrics taken with the original slon
>> binary (25 september 2007) and with the new slon binary (including
>> modifications of static variables, 16 october 2007)
>>     
>
> The graphs aren't quite well enough marked to figure out what's
> what...
>
> Is the first one, where "delay" times seem to stay low, but where
> there are pretty regular spikes for everything else, the modified
> slon, and the second one, where there are fewer but generally rather
> higher spikes, represents the "stock" slon?
>   
yes
> If what I *think* I am seeing is correct, then there looks as though
> there may be some value in increasing the default value for
> SLON_DATA_FETCH_SIZE, but I think I need to understand this better.
>
> You might want to comment on some of the lines, and relative
> interpretations.  Also, it's not clear what you set
> SLON_DATA_FETCH_SIZE to.
>   
I told it in a previous mail :

/" I've modified the value of SLON_DATA_FETCH_SIZE in src/slon/slon.h 
and rebuilt it. I've changed it from 10 to 50 to make fetchs of 500 lines. "
/
> What would seem ideal to me would be to have 3 or 4 graphs, where
> there is an attempt to keep as many similarities as possible...  Thus,
> my "ideal" would involve the following sorts of properties:
>
>  - Preferably, each run would be at about the same time of day, or
>    whatever is relevant such that we can expect to see similar
>    performance characteristics;
>
>  - It would be nice to have some information on each graph indicating
>    amounts of replication traffic (e.g. - numbers of tuples getting
>    replicated) so that we can see how well they compare.
>
>  - Multiple runs, and hence multiple graphs, varying on SLON_DATA_FETCH_SIZE:
>    - One with the "baseline" of 100
>    - One with SLON_DATA_FETCH_SIZE = 400
>    - One with SLON_DATA_FETCH_SIZE = 1600
>    - One with SLON_DATA_FETCH_SIZE = 3200
>
>   Those numbers are scaling up by a factor of x4 each time, so that we
>   can see a pretty wide range of increase.
>
>  - If you can track the size of the slon processes, that may also be
>    useful; it might turn out that increasing SLON_DATA_FETCH_SIZE to
>    5000 has wonderful performance effects as long as you have 4GB of
>    memory available, but that the slon will start swapping if you have
>    more modest hardware :-(.
>
>  That may be a lot of work, which I obviously can't make you do :-).
>  It may be that further explanations of what is in the two existing
>  graphs will tell us enough to come up with a better value than
>  SLON_DATA_FETCH_SIZE = 100.
>
> My expectation is that we'll discover that most of the benefits,
> e.g. - most of the reshaping of performance, come from the early
> increases, and that this comes at only modest memory consumption
> costs, and that further improvements would be costlier.
>
> If that turns out to be the case, then the right answer may be to bump
> up the default value from 100 to 400, for everyone, and to turn it
> into a tunable parameter.  I'd like to have a way to draw that
> conclusion!
>   
The platform is not available anymore, but when it will be I'll try to 
make most of these tests.

-- 
Cyril SCETBON - Ing?nieur bases de donn?es
AUSY pour France T?l?com - OPF/PORTAILS/DOP/HEBEX

T?l : +33 (0)4 97 12 87 60
Jabber : cscetbon@jabber.org
France Telecom - Orange
790 Avenue du Docteur Maurice Donat 
B?timent Marco Polo C2 
06250 Mougins
France

***********************************
Ce message et toutes les pieces jointes (ci-apres le 'message') sont
confidentiels et etablis a l'intention exclusive de ses destinataires.
Toute utilisation ou diffusion non autorisee est interdite.
Tout message electronique est susceptible d'alteration. Le Groupe France
Telecom decline toute responsabilite au titre de ce message s'il a ete
altere, deforme ou falsifie.
Si vous n'etes pas destinataire de ce message, merci de le detruire
immediatement et d'avertir l'expediteur.
***********************************
This message and any attachments (the 'message') are confidential and
intended solely for the addressees.
Any unauthorised use or dissemination is prohibited.
Messages are susceptible to alteration. France Telecom Group shall not be
liable for the message if altered, changed or falsified.
If you are not recipient of this message, please cancel it immediately and
inform the sender.
************************************

From jacco.van.den.berg at logicacmg.com  Fri Jan 25 03:36:23 2008
From: jacco.van.den.berg at logicacmg.com (Berg, Jacco van den)
Date: Thu Sep 25 08:26:44 2008
Subject: [Slony1-general] Slony lagtime 
Message-ID: <A011E9D1C9D3B440BAB74B4A6EEF093A76802F@nl-ex007.groupinfra.com>

Hi,
 =

I'm new to Slony so indepth knowledge lacks a little. I have set up a Slony=
 cluster (master and one subscriber). The master has lots of work to do on =
a daily basis. Here some figures of the most heavy hit tables and what Slon=
y did in the period (12am to 12am). Figures are roughly the same on a daily=
 basis.
 =

              relname              | Insert  | Update | Delete  =

-----------------------------------+---------+--------+---------
 t01                               |  266471 | 267357 |       0
 t02                               |  316085 |  33352 |       0
 t03                               |     334 |      0 |       0
 t04                               |    3112 |      0 |       0
 t05                               |  128794 |    160 |       0
 t06                               |     897 | 130857 |       0
 t07                               | 2111989 |      0 | 2024579
 t08                               |   16163 |      0 |   15929
 t09                               |  148653 |      0 |  147486
 t10                               |    2507 |      0 |    1975
 t11                               |  701656 |      0 |  695135
 t12                               |  328510 |      0 |  322875
 t13                               |  397709 |      0 |  383299
 t14                               |   61364 |      0 |   59752
 sl_archive_counter                |       0 |      0 |       0
 sl_config_lock                    |       0 |      0 |       0
 sl_confirm                        |   38292 |      0 |   38002
 sl_event                          |   26625 |      0 |   17466
 sl_listen                         |       0 |      0 |       0
 sl_log_1                          | 8569209 |      0 | 8543943
 sl_log_2                          |       0 |      0 |       0
 sl_node                           |       0 |      0 |       0
 sl_nodelock                       |       9 |      0 |       9
 sl_path                           |       0 |      0 |       0
 sl_registry                       |       0 |    330 |       0
 sl_seqlog                         |  161004 |      0 |   52572
 sl_sequence                       |       0 |      0 |       0
 sl_set                            |       0 |      0 |       0
 sl_setsync                        |       0 |      0 |       0
 sl_subscribe                      |       0 |      0 |       0
 sl_table                          |       0 |      0 |       0
 sl_trigger                        |       0 |      0 |       0
 =

I started the slon deamon processes with default settings. Now lagtime is r=
unning up hill. I expirimented a little with group size, SYNC intervals but=
 that does not seem to help much. Slony now seems to hang in the st_last_re=
ceived_event_ts for long time. A select from sl_status:
 =

-[ RECORD 1 ]-------------+---------------------------
st_origin                 | 1
st_received               | 2
st_last_event             | 714823
st_last_event_ts          | 2008-01-25 12:31:07.917925
st_last_received          | 694710
st_last_received_ts       | 2008-01-25 11:06:19.889191
st_last_received_event_ts | 2008-01-24 02:08:35.640458
st_lag_num_events         | 20113
st_lag_time               | 1 day 10:22:33.398227
-[ RECORD 2 ]-------------+---------------------------
st_origin                 | 1
st_received               | 3
st_last_event             | 714823
st_last_event_ts          | 2008-01-25 12:31:07.917925
st_last_received          | 714822
st_last_received_ts       | 2008-01-25 12:31:07.874295
st_last_received_event_ts | 2008-01-25 12:31:02.911062
st_lag_num_events         | 1
st_lag_time               | 00:00:06.127623

Node 3 has no replication yet (but should have after this weekend)
 =

Current count of the slony tables in the master:
 =

      Tabelnaam      |  count   =

---------------------+----------
 sl_archive_counter  |        1
 sl_config_lock      |        0
 sl_confirm          |      636
 sl_event            |    20108
 sl_listen           |       11
 sl_log_1            | 18272903
 sl_log_2            |        0
 sl_node             |        3
 sl_nodelock         |        4
 sl_path             |        6
 sl_registry         |        4
 sl_seqlog           |   238392
 sl_sequence         |       11
 sl_set              |        4
 sl_setsync          |        0
 sl_subscribe        |        4
 sl_table            |       46
 sl_trigger          |        0
 sl_status           |        2

My question is if anyone can help me out with tips on how to improve replic=
ation speed. Or do I have to live with the current speed. When running the =
batch proces with no lag delay at start Slony got behind roughly 50 minutes=
 an hour.
 =

Jaco


This e-mail and any attachment is for authorised use by the intended recipi=
ent(s) only. It may contain proprietary material, confidential information =
and/or be subject to legal privilege. It should not be copied, disclosed to=
, retained or used by, any other party. If you are not an intended recipien=
t then please promptly delete this e-mail and any attachment and all copies=
 and inform the sender. Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080125/=
21210736/attachment-0001.htm
From HTomeh at facorelogic.com  Fri Jan 25 09:05:17 2008
From: HTomeh at facorelogic.com (Tomeh, Husam)
Date: Thu Sep 25 08:26:45 2008
Subject: [Slony1-general] how does one 'un-init' a cluster?
In-Reply-To: <4799FE37.8060206@serioustechnology.com>
References: <4799FE37.8060206@serioustechnology.com>
Message-ID: <F1B0F9305B343E43A1C3EECE48B853D501A840E4@CITGSNA01SXCH02.ana.firstamdata.com>

 
slonik_uninstall_nodes should do the trick.

Regards,
    Husam

-----Original Message-----
From: slony1-general-bounces@lists.slony.info
[mailto:slony1-general-bounces@lists.slony.info] On Behalf Of Geoffrey
Sent: Friday, January 25, 2008 7:20 AM
To: slony
Subject: [Slony1-general] how does one 'un-init' a cluster?

I don't know if that makes sense, but how do you undo what
slonik_init_cluster does?

--
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
_______________________________________________
Slony1-general mailing list
Slony1-general@lists.slony.info
http://lists.slony.info/mailman/listinfo/slony1-general
**********************************************************************
This message contains confidential information intended only for the use of the addressee(s) named above and may contain information that is legally privileged.  If you are not the addressee, or the person responsible for delivering it to the addressee, you are hereby notified that reading, disseminating, distributing or copying this message is strictly prohibited.  If you have received this message by mistake, please immediately notify us by replying to the message and delete the original message immediately thereafter.

Thank you.

                                   FADLD Tag
**********************************************************************
From jacco.van.den.berg at logicacmg.com  Mon Jan 28 04:33:32 2008
From: jacco.van.den.berg at logicacmg.com (Berg, Jacco van den)
Date: Thu Sep 25 08:26:45 2008
Subject: [Slony1-general] Drop a subscriber
References: <20080126200002.F38AA290CAD@main.slony.info>
Message-ID: <A011E9D1C9D3B440BAB74B4A6EEF093A76803F@nl-ex007.groupinfra.com>

Hi,
 =

To get rid of a node in a Slony cluster simply use the slonik_drop_node scr=
ipt.
 =

Jaco

________________________________

Van: slony1-general-bounces@lists.slony.info namens slony1-general-request@=
lists.slony.info
Verzonden: za 26-1-2008 21:00
Aan: slony1-general@lists.slony.info
Onderwerp: Slony1-general Digest, Vol 11, Issue 28



Send Slony1-general mailing list submissions to
        slony1-general@lists.slony.info

To subscribe or unsubscribe via the World Wide Web, visit
        http://lists.slony.info/mailman/listinfo/slony1-general
or, via email, send a message with subject or body 'help' to
        slony1-general-request@lists.slony.info

You can reach the person managing the list at
        slony1-general-owner@lists.slony.info

When replying, please edit your Subject line so it is more specific
than "Re: Contents of Slony1-general digest..."


Today's Topics:

   1. Re: how does one 'un-init' a cluster? (Leon Mergen)


----------------------------------------------------------------------

Message: 1
Date: Sat, 26 Jan 2008 16:13:42 +0100
From: "Leon Mergen" <leon@solatis.com>
Subject: Re: [Slony1-general] how does one 'un-init' a cluster?
To: Geoffrey <lists@serioustechnology.com>
Cc: slony <slony1-general@lists.slony.info>
Message-ID:
        <5eaaef180801260713k26d2430cnb1136744c18fa78e@mail.gmail.com>
Content-Type: text/plain; charset=3D"iso-8859-1"

On 1/25/08, Geoffrey <lists@serioustechnology.com> wrote:
>
> I don't know if that makes sense, but how do you undo what
> slonik_init_cluster does?


Hello,

I believe this can be achieved with the 'slonik_uninstall_nodes' command.

-- =3D

Leon Mergen
http://www.solatis.com <http://www.solatis.com/> =

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080126/=
=3D
1d90ada1/attachment.html

------------------------------

_______________________________________________
Slony1-general mailing list
Slony1-general@lists.slony.info
http://lists.slony.info/mailman/listinfo/slony1-general


End of Slony1-general Digest, Vol 11, Issue 28
**********************************************







This e-mail and any attachment is for authorised use by the intended recipi=
ent(s) only. It may contain proprietary material, confidential information =
and/or be subject to legal privilege. It should not be copied, disclosed to=
, retained or used by, any other party. If you are not an intended recipien=
t then please promptly delete this e-mail and any attachment and all copies=
 and inform the sender. Thank you.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/ms-tnef
Size: 5326 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20080128=
/13987c03/attachment-0001.bin
From jacco.van.den.berg at logicacmg.com  Mon Jan 28 04:34:58 2008
From: jacco.van.den.berg at logicacmg.com (Berg, Jacco van den)
Date: Thu Sep 25 08:26:46 2008
Subject: [Slony1-general] Table in 2 or more sets
References: <20080125200003.8CCF1290C2A@main.slony.info>
Message-ID: <A011E9D1C9D3B440BAB74B4A6EEF093A76803E@nl-ex007.groupinfra.com>

Hi,
 =

I ran into the same "problem". Its not possible to have the same table in m=
ore then one set due to a unique constraint.
 =

Jaco

________________________________

Van: slony1-general-bounces@lists.slony.info namens slony1-general-request@=
lists.slony.info
Verzonden: vr 25-1-2008 21:00
Aan: slony1-general@lists.slony.info
Onderwerp: Slony1-general Digest, Vol 11, Issue 27



Send Slony1-general mailing list submissions to
        slony1-general@lists.slony.info

To subscribe or unsubscribe via the World Wide Web, visit
        http://lists.slony.info/mailman/listinfo/slony1-general
or, via email, send a message with subject or body 'help' to
        slony1-general-request@lists.slony.info

You can reach the person managing the list at
        slony1-general-owner@lists.slony.info

When replying, please edit your Subject line so it is more specific
than "Re: Contents of Slony1-general digest..."


Today's Topics:

   1. problem creating a 2nd set (Geoffrey)
   2. how does one 'un-init' a cluster? (Geoffrey)


----------------------------------------------------------------------

Message: 1
Date: Fri, 25 Jan 2008 10:13:52 -0500
From: Geoffrey <lists@serioustechnology.com>
Subject: [Slony1-general] problem creating a 2nd set
To: Slony List <slony1-general@lists.slony.info>
Message-ID: <4799FCB0.2070706@serioustechnology.com>
Content-Type: text/plain; charset=3DISO-8859-1; format=3Dflowed

I must be missing something here.  I'll summarize so as to reduce the
size of the example.  I have two sets defined in a config file as follows:

$SLONY_SETS =3D {

        "avldsSet" =3D> {
                "set_id"       =3D> 1,
                "table_id"     =3D> 1,
                "sequence_id"  =3D> 1,
                "pkeyedtables" =3D> [....],
                "keyedtables"  =3D> {},
                "serialtables" =3D> [],
                "sequences"    =3D> [....],
        }

        "nonavldsSet" =3D> {
                "set_id"       =3D> 2,
                "table_id"     =3D> 2,
                "sequence_id"  =3D> 2,
                "pkeyedtables" =3D> [....],
                "keyedtables"  =3D> {},
                "serialtables" =3D> [],
                "sequences"    =3D> [....],
        }
};

So then my expectation is that I will need to run the following:

slonik_create_set --config $CONFIG 1 |slonik
slonik_create_set --config $CONFIG 2 |slonik

Because I've defined two sets.  Problem is, I received the following
error when I run the second slonik_create_set:

slonik_create_set --config $CONFIG 2|slonik
<stdin>:16: Subscription set 2 created
<stdin>:17: Adding tables to the subscription set
<stdin>:18: PGRES_FATAL_ERROR select "_mwv_cluster".setAddTable(2, 2,
'public.aaccess', 'aaccess_pkey', 'Table public.aaccess with primary
key');  - ERROR:  Slony-I: setAddTable_int: table id 2 has already been
assigned!
CONTEXT:  PL/pgSQL function "setaddtable" line 37 at perform

The table mentioned 'aaccess' only exists in the first set.  Do I
misunderstand the concept of sets or the functionality of the
slonik_create_set script?

Thanks for any assistance.

--
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin


------------------------------

Message: 2
Date: Fri, 25 Jan 2008 10:20:23 -0500
From: Geoffrey <lists@serioustechnology.com>
Subject: [Slony1-general] how does one 'un-init' a cluster?
To: slony <slony1-general@lists.slony.info>
Message-ID: <4799FE37.8060206@serioustechnology.com>
Content-Type: text/plain; charset=3DISO-8859-1; format=3Dflowed

I don't know if that makes sense, but how do you undo what
slonik_init_cluster does?

--
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin


------------------------------

_______________________________________________
Slony1-general mailing list
Slony1-general@lists.slony.info
http://lists.slony.info/mailman/listinfo/slony1-general


End of Slony1-general Digest, Vol 11, Issue 27
**********************************************




This e-mail and any attachment is for authorised use by the intended recipi=
ent(s) only. It may contain proprietary material, confidential information =
and/or be subject to legal privilege. It should not be copied, disclosed to=
, retained or used by, any other party. If you are not an intended recipien=
t then please promptly delete this e-mail and any attachment and all copies=
 and inform the sender. Thank you.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/ms-tnef
Size: 8316 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20080128=
/e4bacf53/attachment-0001.bin
From ouray at viney.ca  Mon Jan 28 14:05:31 2008
From: ouray at viney.ca (Ouray Viney)
Date: Thu Sep 25 08:26:47 2008
Subject: [Slony1-general] Issues troubleshooting failing replication -
	(Master - Slave)
Message-ID: <a6570cd90801281405ib0a0937vd35d72bf163e2f3d@mail.gmail.com>

Hi All:

I have spent most of the day parsing through the documentation, but have
been unsuccessful in solving the problem.

Environment setup:

1 master (host=3Dpgmaster, db=3Dssm)
1 slave (host=3Dpgslave1, db=3Dssm_slave)

Commands run on the master:

Note:  I will not include the db/user/pgplsql commands

1. run the schema script

 [root@caotta000381 scripts]# psql -U ssm -d ssm -f ~/sessionmanager-
postgresql-create.sql

2. initialize the cluster (run on master node)

[root@caotta000381 ~]# slonik_init_cluster

# INIT CLUSTER
cluster name =3D ssm_cluster;
 node 1 admin conninfo=3D'host=3Dpgmaster dbname=3Dssm user=3Dpostgres port=
=3D5432';
 node 2 admin conninfo=3D'host=3Dpgslave1 dbname=3Dssm_slave user=3Dpostgres
port=3D5432';
  init cluster (id =3D 1, comment =3D 'Node 1 - ssm@pgmaster');

# STORE NODE
  store node (id =3D 2, event node =3D 1, comment =3D 'Node 2 - ssm_slave@p=
gslave1
');
  echo 'Set up replication nodes';

# STORE PATH
  echo 'Next: configure paths for each node/origin';
  store path (server =3D 1, client =3D 2, conninfo =3D 'host=3Dpgmaster dbn=
ame=3Dssm
user=3Dpostgres port=3D5432');
  store path (server =3D 2, client =3D 1, conninfo =3D 'host=3Dpgslave1
dbname=3Dssm_slave user=3Dpostgres port=3D5432');
  echo 'Replication nodes prepared';
  echo 'Please start a slon replication daemon for each node';
[root@caotta000381 ~]# slonik_init_cluster | slonik
<stdin>:10: Set up replication nodes
<stdin>:13: Next: configure paths for each node/origin
<stdin>:16: Replication nodes prepared
<stdin>:17: Please start a slon replication daemon for each node

3. Start slon process

[root@caotta000381 ~]# slon_start 1
Invoke slon for node 1 - /usr/bin/slon -s 1000 -d2 ssm_cluster
'host=3Dpgmaster dbname=3Dssm user=3Dpostgres port=3D5432' 2>&1 >
/var/log/slony/slony1/node1/ssm-2008-01-28_13:47:29.log &
Slon successfully started for cluster ssm_cluster, node node1
PID [12806]
Start the watchdog process as well...
[root@caotta000381 ~]# slon_start 2
Invoke slon for node 2 - /usr/bin/slon -s 1000 -d2 ssm_cluster
'host=3Dpgslave1 dbname=3Dssm_slave user=3Dpostgres port=3D5432' 2>&1 >
/var/log/slony/slony1/node2/ssm_slave-2008-01-28_13:47:38.log &
Slon successfully started for cluster ssm_cluster, node node2
PID [12849]
Start the watchdog process as well...
[root@caotta000381 ~]#

4. build skeleton for slon_tools.conf

build the skeleton script for slon_tools.conf

slonik_build_env -node pgmaster:ssm:postgres -node
pgslave1:ssm_slave:postgres

[root@caotta000381 pgsql]# slonik_build_env -node pgmaster:ssm:postgres
-node pgslave1:ssm_slave:postgres
&add_node(host =3D> 'pgmaster', dbname =3D> 'ssm', port =3D>5432,
        user=3D>'postgres', password=3D>'', node=3D>1 );
&add_node(host =3D> 'pgslave1', dbname =3D> 'ssm_slave', port =3D>5432,
        user=3D>'postgres', password=3D>'', node=3D>2 , parent=3D>1);
@KEYEDTABLES=3D(
        "public.managednumberrouteset",
        "public.mediationstrategy",
        "public.nonmanagednumbestfitrouteset",
        "public.normalization",
        "public.normalizationtype",
        "public.numberforwarding",
        "public.outboundrouteorder",
        "public.outboundrouteset",
        "public.route",
        "public.routetype",
        "public.routetype_normalization",
);
@SEQUENCES=3D(
        "public.nonmanagednumbestfitrouteset_outboundroutelogicid_seq",
        "public.normalization_normalizationid_seq",
);

5.  Add that data to the slon_tools.conf

6. Create the replication sets

[root@caotta000381 etc]# slonik_create_set 1
cluster name =3D ssm_cluster;
 node 1 admin conninfo=3D'host=3Dpgmaster dbname=3Dssm user=3Dpostgres port=
=3D5432';
 node 2 admin conninfo=3D'host=3Dpgslave1 dbname=3Dssm_slave user=3Dpostgres
port=3D5432';

# TABLE ADD KEY

# CREATE SET
  try {
    create set (id =3D 1, origin =3D 1, comment =3D 'Set 1 for ssm_cluster'=
);
  } on error {
    echo 'Could not create subscription set 1 for ssm_cluster!';
    exit -1;
  }

# SET ADD TABLE
  echo 'Subscription set 1 created';
  echo 'Adding tables to the subscription set';
  set add table (set id =3D 1, origin =3D 1, id =3D 1,
                 full qualified name =3D 'public.nonmanagednumbestfitroutes=
et',
key=3D'public.normalization',
                 comment =3D 'Table public.nonmanagednumbestfitrouteset with
candidate primary key public.normalization');
  echo 'Add candidate primary keyed table
public.nonmanagednumbestfitrouteset';
  set add table (set id =3D 1, origin =3D 1, id =3D 2,
                 full qualified name =3D 'public.outboundrouteorder', key=
=3D'
public.outboundrouteset',
                 comment =3D 'Table public.outboundrouteorder with candidate
primary key public.outboundrouteset');
  echo 'Add candidate primary keyed table public.outboundrouteorder';
  set add table (set id =3D 1, origin =3D 1, id =3D 3,
                 full qualified name =3D 'public.normalizationtype', key=3D'
public.numberforwarding',
                 comment =3D 'Table public.normalizationtype with candidate
primary key public.numberforwarding');
  echo 'Add candidate primary keyed table public.normalizationtype';
  set add table (set id =3D 1, origin =3D 1, id =3D 4,
                 full qualified name =3D 'public.route', key=3D'public.rout=
etype
',
                 comment =3D 'Table public.route with candidate primary key
public.routetype');
  echo 'Add candidate primary keyed table public.route';
  set add table (set id =3D 1, origin =3D 1, id =3D 5,
                 full qualified name =3D 'public.managednumberrouteset', ke=
y=3D'
public.mediationstrategy',
                 comment =3D 'Table public.managednumberrouteset with
candidate primary key public.mediationstrategy');
  echo 'Add candidate primary keyed table public.managednumberrouteset';
  set add table (set id =3D 1, origin =3D 1, id =3D 6,
                 full qualified name =3D 'public.routetype_normalization',
key=3D'',
                 comment =3D 'Table public.routetype_normalization with
candidate primary key ');
  echo 'Add candidate primary keyed table public.routetype_normalization';

# SET ADD SEQUENCE
  echo 'Adding sequences to the subscription set';
  set add sequence (set id =3D 1, origin =3D 1, id =3D 1,
                    full qualified name =3D '
public.nonmanagednumbestfitrouteset_outboundroutelogicid_seq',
                    comment =3D 'Sequence
public.nonmanagednumbestfitrouteset_outboundroutelogicid_seq');
  echo 'Add sequence
public.nonmanagednumbestfitrouteset_outboundroutelogicid_seq';
  set add sequence (set id =3D 1, origin =3D 1, id =3D 2,
                    full qualified name =3D '
public.normalization_normalizationid_seq',
                    comment =3D 'Sequence
public.normalization_normalizationid_seq');
  echo 'Add sequence public.normalization_normalizationid_seq';
  echo 'All tables added';

  [root@caotta000381 etc]# slonik_create_set 1 | slonik
<stdin>:16: Subscription set 1 created
<stdin>:17: Adding tables to the subscription set
<stdin>:18: PGRES_FATAL_ERROR select "_ssm_cluster".determineIdxnameUnique('
public.nonmanagednumbestfitrouteset', 'public.normalization');  - ERROR:
Slony-I: table "public"."nonmanagednumbestfitrouteset" has no unique index
public.normalization

Note:  I ignored the error and moved on.  Perhaps this was a bad thing?

7. Subscribed the nodes to set

[root@caotta000381 etc]# slonik_subscribe_set 1 2
cluster name =3D ssm_cluster;
 node 1 admin conninfo=3D'host=3Dpgmaster dbname=3Dssm user=3Dpostgres port=
=3D5432';
 node 2 admin conninfo=3D'host=3Dpgslave1 dbname=3Dssm_slave user=3Dpostgres
port=3D5432';
  try {
    subscribe set (id =3D 1, provider =3D 1, receiver =3D 2, forward =3D ye=
s);
  }
  on error {
    exit 1;
  }
  echo 'Subscribed nodes to set 1';

  [root@caotta000381 etc]# slonik_subscribe_set 1 2 | slonik
<stdin>:10: Subscribed nodes to set 1

8. When using the altperl scripts to setup the cluster, it isn't clear what
tasks need to be performed on the slave node.  From what I read, the only
thing that needs to be done on the slave nodes it what I read here:
http://linuxfinances.info/info/addthings.html section: (12.4. Adding A Node
To Replication).

9. Since I was a little confused I ran the following on the slave node
assuming that I was doing the right thing (in accordance with the above
reference):

I ran this on the slave node:

cluster name =3D ssm_cluster;
 node 1 admin conninfo=3D'host=3Dpgmaster dbname=3Dssm user=3Dpostgres port=
=3D5432';
 node 2 admin conninfo=3D'host=3Dpgslave1 dbname=3Dssmslave user=3Dpostgres
port=3D5432';
  try {
    subscribe set (id =3D 1, provider =3D 1, receiver =3D 2, forward =3D ye=
s);
  }
  on error {
    exit 1;
  }
  echo 'Subscribed nodes to set 1';

10. I inserted some data into the master db.

11. Checked the slon logs and didn't see any inserts getting replicated, so
I knew something was wrong.

12. I ran the check_slony_cluster.sh on both nodes:

Slave:
-bash-3.00$ ./check_slony_cluster.sh ssm_cluster ssm_slave pgslave1
ERROR - 1 of 1 nodes not in sync

Master:
-bash-3.00$ ./check_slony_cluster.sh ssm_cluster ssm pgmaster
OK - 1 nodes in sync

Running yet another replication test script:

-bash-3.00$ ./psql_replication_check.pl -h pgslave1 -d ssm_slave -p 5432 -U
postgres
ERROR:  relation "replication_status" does not exist
-bash-3.00$ ./psql_replication_check.pl -h pgmaster -d ssm -p 5432 -U ssm
ERROR:  relation "replication_status" does not exist

At this point I have no idea were the problem lies.  I can guess my way
through based on the commands that I have run.  But at this point I am not
seeing any replication nor any sign after manipulating the data that any
events were triggering replication.

Here is a snippet of the slon log for the slave node:

<snippet>
2008-01-28 16:57:05 EST DEBUG2 remoteWorkerThread_2: forward confirm 1,1140
received by 2
2008-01-28 16:57:13 EST DEBUG2 syncThread: new sl_action_seq 1 - SYNC 1141
2008-01-28 16:57:13 EST DEBUG2 localListenThread: Received event 1,1141 SYNC
2008-01-28 16:57:16 EST DEBUG2 remoteListenThread_2: queue event 2,457 SYNC
2008-01-28 16:57:16 EST DEBUG2 remoteWorkerThread_2: Received event 2,457
SYNC
2008-01-28 16:57:16 EST DEBUG2 remoteWorkerThread_2: SYNC 457 processing
2008-01-28 16:57:16 EST DEBUG2 remoteWorkerThread_2: no sets need syncing
for this event
2008-01-28 16:57:16 EST DEBUG2 remoteWorkerThread_2: forward confirm 1,1141
received by 2
2008-01-28 16:57:23 EST DEBUG2 syncThread: new sl_action_seq 1 - SYNC 1142
2008-01-28 16:57:23 EST DEBUG2 localListenThread: Received event 1,1142 SYNC
2008-01-28 16:57:27 EST DEBUG2 remoteListenThread_2: queue event 2,458 SYNC
2008-01-28 16:57:27 EST DEBUG2 remoteWorkerThread_2: Received event 2,458
SYNC
2008-01-28 16:57:27 EST DEBUG2 remoteWorkerThread_2: SYNC 458 processing
2008-01-28 16:57:27 EST DEBUG2 remoteWorkerThread_2: no sets need syncing
for this event
2008-01-28 16:57:27 EST DEBUG2 remoteWorkerThread_2: forward confirm 1,1142
received by 2
2008-01-28 16:57:31 EST DEBUG2 remoteListenThread_2: queue event 2,459 SYNC
2008-01-28 16:57:31 EST DEBUG2 remoteWorkerThread_2: Received event 2,459
SYNC
2008-01-28 16:57:31 EST DEBUG2 remoteWorkerThread_2: SYNC 459 processing
2008-01-28 16:57:31 EST DEBUG2 remoteWorkerThread_2: no sets need syncing
for this event
</snippet>

I also did a simple query on the table that I had added data to on both
nodes:

master:
=3D=3D=3D=3D=3D=3D=3D=3D=3D
ssm=3D# select * from outboundrouteset;
   outboundroutesetid   |     comments
------------------------+------------------
 ATP_CMA_ROUTESET_ID_1  | ATP_TEST_COMMENT
 ATP_CMB_ROUTESET_ID_1  | ATP_TEST_COMMENT
 ATP_PSTN_ROUTESET_ID_1 | ATP_TEST_COMMENT
(3 rows)

slave:
=3D=3D=3D=3D=3D=3D=3D=3D=3D
ssm_slave=3D# select * from outboundrouteset;
 outboundroutesetid | comments
--------------------+----------
(0 rows)

>From what I can tell, no sign of any replication occurring, which I would
expect to look something like this:

<snippet>
2007-10-31 06:57:04 EDT DEBUG2 remoteHelperThread_1_1: inserts=3D530
updates=3D530 deletes=3D0
2007-10-31 06:57:04 EDT DEBUG2 remoteHelperThread_1_1: inserts=3D211
updates=3D211 deletes=3D0
2007-10-31 06:57:05 EDT DEBUG2 remoteHelperThread_1_1: inserts=3D197
updates=3D197 deletes=3D0
2007-10-31 06:57:06 EDT DEBUG2 remoteHelperThread_1_1: inserts=3D255
updates=3D255 deletes=3D0
2007-10-31 06:57:07 EDT DEBUG2 remoteHelperThread_1_1: inserts=3D116
updates=3D116 deletes=3D0
</snippet>

Any help in diagnosing replication failures would be greatly appreciated.

Kind Rgds,

Ouray


-- =

Ouray Viney
https://www.viney.ca
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080128/=
160aecba/attachment-0001.htm
From HTomeh at facorelogic.com  Wed Jan 30 08:08:58 2008
From: HTomeh at facorelogic.com (Tomeh, Husam)
Date: Thu Sep 25 08:26:48 2008
Subject: [Slony1-general] Slony-Newbie need help with table partitioning
In-Reply-To: <20080126123119.GX696@freenet.de>
References: <20080126123119.GX696@freenet.de>
Message-ID: <F1B0F9305B343E43A1C3EECE48B853D501A8412B@CITGSNA01SXCH02.ana.firstamdata.com>


In addition to the official docs, I found Christopher's pages to be
clear and very helpful. Check it out
http://linuxfinances.info/info/slonyintro.html
Elain's pages (general bits) have pretty good information about Slony
too. http://www.varlena.com/GeneralBits/63.php

Regards,
    Husam
    http://firstdba.googlepages.com

-----Original Message-----
From: slony1-general-bounces@lists.slony.info
[mailto:slony1-general-bounces@lists.slony.info] On Behalf Of Michelle
Konzack
Sent: Saturday, January 26, 2008 4:31 AM
To: slony1-general@lists.slony.info
Subject: [Slony1-general] Slony-Newbie need help with table partitioning

Hello,

last night I have reinstalled three PostgreSQL 8.2 servers which
replaced a cluster of 30 old 7.4, had build a singel Database and went
controlled by a separated server which has done the search over the
tables located on the thirty Servers.

We have over 8000 tables (which build the database data and has each
between 50 and 2000 MByte = 5,4 TByte in summary) and I have imported it
in one of the new 8.2.

Now we want to create a "master" table (table partitioning) and at the
same time we use clustering since the new Server is cuted into Raid-1
with Hotfix (3 disks of 300 GByte each).

Since I am NEWBIE to Slony, please can you tell me how to replicate such
database?  I am reading the docs since hours but they drive me crazy...

Thanks, Greetings and nice Day
    Michelle Konzack
    Systemadministrator
    Tamay Dogan Network
    Debian GNU/Linux Consultant


--
Linux-User #280138 with the Linux Counter, http://counter.li.org/
##################### Debian GNU/Linux Consultant #####################
Michelle Konzack   Apt. 917                  ICQ #328449886
                   50, rue de Soultz         MSN LinuxMichi
0033/6/61925193    67100 Strasbourg/France   IRC #Debian (irc.icq.com)
**********************************************************************
This message contains confidential information intended only for the use of the addressee(s) named above and may contain information that is legally privileged.  If you are not the addressee, or the person responsible for delivering it to the addressee, you are hereby notified that reading, disseminating, distributing or copying this message is strictly prohibited.  If you have received this message by mistake, please immediately notify us by replying to the message and delete the original message immediately thereafter.

Thank you.

                                   FADLD Tag
**********************************************************************
