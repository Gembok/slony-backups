From anjali_nashpro  Mon Jan  1 04:40:49 2007
From: anjali_nashpro (anjali vyas)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] help me to replicate my first database
Message-ID: <542758.96094.qm@web39605.mail.mud.yahoo.com>

Hello,

I am new to slony,
I am just trying to replicate my first database. Version of postgres is 8.0.9 and version of slony is 1.1.5 on my fedora core 6 server.I used same host but my ports are different for both  master and  slave  database.  I try to start slon process  using command- 

 /usr/local/pgsql/bin/slon cluster_c "dbname=company user=postgres host=localhost port=5434" &

output of this command --

 2007-01-01 18:04:45 IST CONFIG main: slon version 1.1.5 starting up
2007-01-01 18:04:45 IST CONFIG main: local node id = 1
2007-01-01 18:04:45 IST CONFIG main: launching sched_start_mainloop
2007-01-01 18:04:45 IST CONFIG main: loading current cluster configuration
2007-01-01 18:04:45 IST CONFIG storeNode: no_id=2 no_comment='Node 2'
2007-01-01 18:04:45 IST CONFIG storePath: pa_server=2 pa_client=1 pa_conninfo="dbname=company_slave host=localhost port=5436 user=postgres" pa_connretry=10
2007-01-01 18:04:45 IST CONFIG storeListen: li_origin=2 li_receiver=1 li_provider=2
2007-01-01 18:04:45 IST CONFIG storeSet: set_id=1 set_origin=1 set_comment='contact table'
2007-01-01 18:04:45 IST CONFIG main: configuration complete - starting threads
2007-01-01 18:04:45 IST DEBUG1 localListenThread: thread starts
NOTICE:  Slony-I: cleanup stale sl_nodelock entry for pid=11727
NOTICE:  Slony-I: cleanup stale sl_nodelock entry for pid=11727
2007-01-01 18:04:45 IST CONFIG enableNode: no_id=2
2007-01-01 18:04:45 IST DEBUG1 main: running scheduler mainloop
2007-01-01 18:04:45 IST DEBUG1 remoteWorkerThread_2: thread starts
2007-01-01 18:04:45 IST DEBUG1 cleanupThread: thread starts
2007-01-01 18:04:45 IST DEBUG1 syncThread: thread starts
2007-01-01 18:04:45 IST DEBUG1 remoteListenThread_2: thread starts
2007-01-01 18:04:45 IST DEBUG1 remoteListenThread_2: connected to 'dbname=company_slave host=localhost port=5436 user=postgres'
2007-01-01 18:04:47 IST FATAL  localListenThread: event 25: Unknown event type: 
2007-01-01 18:04:47 IST DEBUG1 slon: shutdown requested
2007-01-01 18:04:47 IST DEBUG1 syncThread: thread done
2007-01-01 18:04:47 IST INFO   remoteListenThread_2: disconnecting from 'dbname=company_slave host=localhost port=5436 user=postgres'
2007-01-01 18:04:47 IST DEBUG1 remoteListenThread_2: thread done
2007-01-01 18:04:47 IST DEBUG1 cleanupThread: thread done
2007-01-01 18:04:47 IST DEBUG1 main: scheduler mainloop returned
2007-01-01 18:04:47 IST DEBUG1 remoteWorkerThread_2: thread done
2007-01-01 18:04:47 IST DEBUG1 main: done
LOG:  unexpected EOF on client connection

so Please tell me what should I do now?
where I made mistake?


Thanks in advance.

                                                                                                              Ms. Anjali Vyas

 __________________________________________________
Do You Yahoo!?
Tired of spam?  Yahoo! Mail has the best spam protection around 
http://mail.yahoo.com 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://gborg.postgresql.org/pipermail/slony1-general/attachments/20070101/628a564c/attachment.html 

From mark  Wed Jan  3 08:54:16 2007
From: mark (Mark Stosberg)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] Uninstall Guide for Slony-I
In-Reply-To: <687781.72719.qm@web31602.mail.mud.yahoo.com>
References: <687781.72719.qm@web31602.mail.mud.yahoo.com>
Message-ID: <engn48$fcm$1@sea.gmane.org>

Ashish Karalkar wrote:
> Hello All,
> Can anybody please help me in how to uninstall Slony-I
> from PostgresSQL when Build from source code.
> I tried "Make uninstall","gmake uninstall" but it
> didn't worked.I am using Slony-I 1.2.stable
> Also I would like to sugeest that we should provide
> complete guidlines for uninstalling Slony in the
> official documentations.

Ashish,

Are your mostly concerned with removing Slony's effect on your DB
tables, or do you want remove the software from your system?

For the former, you can remove slony's effect on the database like this:

slonik_uninstall_nodes | slonik

That assumes you are using the "altperl" tools, which are very nice.

For the second issue, the easiest way would have been to install the
software from a vendor package. However, you did say "from source".

As a general tool on Linux, I use "checkinstall" which creates a package
that can be easily installed, by replacing the "make install" step of
the process.

I agree that in any case, it's a good thing to have documented.
(And I realize I didn't directly solve your problem-- sorry).

  Mark


From mark  Wed Jan  3 08:57:55 2007
From: mark (Mark Stosberg)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] help me to replicate my first database
In-Reply-To: <542758.96094.qm@web39605.mail.mud.yahoo.com>
References: <542758.96094.qm@web39605.mail.mud.yahoo.com>
Message-ID: <engnb3$fcm$2@sea.gmane.org>

anjali vyas wrote:
> Hello,
> 
> I am new to slony,
> I am just trying to replicate my first database. Version of postgres is
> 8.0.9 and version of slony is 1.1.5 on my fedora core 6 server.I used
> same host but my ports are different for both  master and  slave 
> database.  I try to start slon process  using command-
> 
>  /usr/local/pgsql/bin/slon cluster_c "dbname=company user=postgres
> host=localhost port=5434" &

Anjali,

I'm not sure exactly what your issue is, but I'll offer some less direct
advice that helped me.

First, use the "altperl" tools for interacting with Slony. Although they
are less documented, they are so easy to use little documentation is
needed.

You may need to use "./configure --with-altperl" for these tools to be
installed. This page documents them some:

http://linuxfinances.info/info/adminscripts.html

   Mark


From mark  Wed Jan  3 09:00:51 2007
From: mark (Mark Stosberg)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] docs: longtxnsareevil link not working
Message-ID: <engngj$fcm$3@sea.gmane.org>

The link to faq.html#longtxnsareevil link here doesn't work:

http://linuxfinances.info/info/definingsets.html

I looked into further and found that something with this ID was defined
in faq.sgml, but didn't get translated as expected in faq.html.

The intended target is here:
http://linuxfinances.info/info/faq.html#AEN46196

    Mark


From ajs  Wed Jan  3 15:21:41 2007
From: ajs (Andrew Sullivan)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] cheating with bulk loading?
Message-ID: <20070103232141.GA9327@phlogiston.dyndns.org>

Hi,

I know that we have not so far implemented a way to use COPY on
multiple nodes, and then add the table to replication, without
causing the associated tables to get blown away and re-copied.

I have a use-case I've been working on where what I was originally
planning to do was load >10M records in little hunks of INSERT
statements.  My colleague, however, just asked me, "Isn't there some
way we could cheat and bulk load it?"  I initially said no, but then
I thought of this, and I'm wondering whether anyone can think of a
reason it _can't_ work before I go away and start testing.

The idea is that I have an empty table that is already added to
replication.  This table is not being accessed by any application
(it's part of the support for the new application.)  I have no
indexes on it.  

Couldn't I just generate a set of files to hand to COPY on each node,
populate the table that way, then set the sequence numbers up
correctly, add the indexes, and be ready to go?  Or is there
something I am overlooking in my excitement to speed up my
application migration so much?

A

-- 
Andrew Sullivan  | ajs at crankycanuck.ca
If they don't do anything, we don't need their acronym.
		--Josh Hamilton, on the US FEMA

From devrim  Thu Jan  4 06:31:52 2007
From: devrim (Devrim GUNDUZ)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] Time for a bugfix release?
Message-ID: <1167921112.3134.30.camel@laptop.gunduz.org>

Hi,

Today at irc, Niels came up with the idea of a new bugfix release
(1.2.3). 

Recalling the bugs that crashes backends, and so, I'm for the new
release.

Chris, do you have time for that?

Regards,
-- 
The PostgreSQL Company - Command Prompt, Inc. 1.503.667.4564
PostgreSQL Replication, Consulting, Custom Development, 24x7 support
Managed Services, Shared and Dedicated Hosting
Co-Authors: plPHP, plPerlNG - http://www.commandprompt.com/




-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
Url : http://gborg.postgresql.org/pipermail/slony1-general/attachments/20070104/7e5fd116/attachment.bin 

From postgres  Thu Jan  4 07:13:24 2007
From: postgres (Niels Breet)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] Time for a bugfix release?
In-Reply-To: <1167921112.3134.30.camel@laptop.gunduz.org>
References: <1167921112.3134.30.camel@laptop.gunduz.org>
Message-ID: <4118.85.147.201.170.1167923604.squirrel@breet.com>

On Thu, January 4, 2007 15:31, Devrim GUNDUZ wrote:
> Hi,
>
>
> Today at irc, Niels came up with the idea of a new bugfix release
> (1.2.3).

Surely you mean 1.2.5 :)

> Recalling the bugs that crashes backends, and so, I'm for the new
> release.
>
I'm for it too. Many people are having problems due to this xxid bug,
it also prevents them from moving sets. This seems too serious to wait
very long with a release.

- Niels



From cbbrowne  Thu Jan  4 07:40:16 2007
From: cbbrowne (Christopher Browne)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] Time for a bugfix release?
In-Reply-To: <4118.85.147.201.170.1167923604.squirrel@breet.com> (Niels
	Breet's message of "Thu, 4 Jan 2007 16:13:24 +0100 (CET)")
References: <1167921112.3134.30.camel@laptop.gunduz.org>
	<4118.85.147.201.170.1167923604.squirrel@breet.com>
Message-ID: <60lkkiiyvz.fsf@dba2.int.libertyrms.com>

"Niels Breet" <postgres at breet.com> writes:
> On Thu, January 4, 2007 15:31, Devrim GUNDUZ wrote:
>> Hi,
>>
>>
>> Today at irc, Niels came up with the idea of a new bugfix release
>> (1.2.3).
>
> Surely you mean 1.2.5 :)

Right!  :-)

>> Recalling the bugs that crashes backends, and so, I'm for the new
>> release.
>>
> I'm for it too. Many people are having problems due to this xxid bug,
> it also prevents them from moving sets. This seems too serious to wait
> very long with a release.

Makes sense to me.

I haven't run thru any 'extended' tests of the 1.2 branch lately; I'll
see about running that later today, with a view to 1.2.5 tomorrow.
-- 
let name="cbbrowne" and tld="ca.afilias.info" in name ^ "@" ^ tld;;
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)

From devrim  Thu Jan  4 07:46:57 2007
From: devrim (Devrim GUNDUZ)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] Time for a bugfix release?
In-Reply-To: <60lkkiiyvz.fsf@dba2.int.libertyrms.com>
References: <1167921112.3134.30.camel@laptop.gunduz.org>
	<4118.85.147.201.170.1167923604.squirrel@breet.com>
	<60lkkiiyvz.fsf@dba2.int.libertyrms.com>
Message-ID: <1167925617.3134.55.camel@laptop.gunduz.org>

Hi,

On Thu, 2007-01-04 at 15:40 +0000, Christopher Browne wrote:
> I haven't run thru any 'extended' tests of the 1.2 branch lately; I'll
> see about running that later today, with a view to 1.2.5 tomorrow. 

I have some free time tonite and tomorrow, so please ping me if you need
another tester.

Cheers,
-- 
The PostgreSQL Company - Command Prompt, Inc. 1.503.667.4564
PostgreSQL Replication, Consulting, Custom Development, 24x7 support
Managed Services, Shared and Dedicated Hosting
Co-Authors: plPHP, plPerlNG - http://www.commandprompt.com/




-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
Url : http://gborg.postgresql.org/pipermail/slony1-general/attachments/20070104/b678bc9b/attachment.bin 

From mark  Thu Jan  4 12:51:49 2007
From: mark (Mark Stosberg)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] PATCH: In dropthings.sgml,
	mention the easier slonik_drop_table solution
Message-ID: <enjpdl$jpj$1@sea.gmane.org>

This patch improves the "drop things" documentation by mentioning the
easier to use slonik_drop_table script.

   Mark
-------------- next part --------------
A non-text attachment was scrubbed...
Name: dropthings.patch
Type: text/x-patch
Size: 1293 bytes
Desc: not available
Url : http://gborg.postgresql.org/pipermail/slony1-general/attachments/20070104/c8ebce66/attachment.bin 

From ajs  Thu Jan  4 13:19:18 2007
From: ajs (Andrew Sullivan)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] cheating with bulk loading?
In-Reply-To: <20070103232141.GA9327@phlogiston.dyndns.org>
References: <20070103232141.GA9327@phlogiston.dyndns.org>
Message-ID: <20070104211918.GF11171@phlogiston.dyndns.org>

For the archives:

On Wed, Jan 03, 2007 at 06:21:41PM -0500, Andrew Sullivan wrote:
> Couldn't I just generate a set of files to hand to COPY on each node,
> populate the table that way, then set the sequence numbers up
> correctly, add the indexes, and be ready to go?  Or is there
> something I am overlooking in my excitement to speed up my
> application migration so much?

Yes, of course, there is: COPY invokes triggers, contrary to what I
was thinking when I wrote that.  For some reason, I thought that COPY
did not invoke triggers.  I think I must have conflated rules and
triggers, because COPY can't invoke rules just because there's no SQL
to change the parse tree of.

This might still be possible by futzing with the stored procedures
enabling replication, but that seems less like the quick win I was
hoping for.

A

-- 
Andrew Sullivan  | ajs at crankycanuck.ca
When my information changes, I alter my conclusions.  What do you do sir?
		--attr. John Maynard Keynes

From ahodgson  Thu Jan  4 13:30:54 2007
From: ahodgson (Alan Hodgson)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] cheating with bulk loading?
In-Reply-To: <20070104211918.GF11171@phlogiston.dyndns.org>
References: <20070103232141.GA9327@phlogiston.dyndns.org>
	<20070104211918.GF11171@phlogiston.dyndns.org>
Message-ID: <200701041330.54433@hal.medialogik.com>

On Thursday 04 January 2007 13:19, Andrew Sullivan <ajs at crankycanuck.ca> 
wrote:
> This might still be possible by futzing with the stored procedures
> enabling replication, but that seems less like the quick win I was
> hoping for.

I think you could just drop the slony-generated triggers on both the parent 
and replica(s), and then do the copy, and then restore the triggers.  I'm 
not positive what Slony records about the OID's of those triggers, though, 
if anything.

-- 
"When a politician says he wants you to serve a cause greater than your
own self-interest, the cause he has is mind is his own reelection."


From ajs  Thu Jan  4 14:16:10 2007
From: ajs (Andrew Sullivan)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] cheating with bulk loading?
In-Reply-To: <200701041330.54433@hal.medialogik.com>
References: <20070103232141.GA9327@phlogiston.dyndns.org>
	<20070104211918.GF11171@phlogiston.dyndns.org>
	<200701041330.54433@hal.medialogik.com>
Message-ID: <20070104221610.GI11171@phlogiston.dyndns.org>

On Thu, Jan 04, 2007 at 01:30:54PM -0800, Alan Hodgson wrote:
> > This might still be possible by futzing with the stored procedures
> > enabling replication, but that seems less like the quick win I was
> > hoping for.
> 
> I think you could just drop the slony-generated triggers on both the parent 
> and replica(s), and then do the copy, and then restore the triggers.  I'm 
> not positive what Slony records about the OID's of those triggers, though, 
> if anything.

Not just dropping them, but the following appears to work:

First, get the tab_id for your candidate table:

SELECT tab_id FROM _slonyschema.sl_table WHERE 
	tab_relname = '[yourtablename]' AND
	tab_nspname = '[yourtableschema];

Call it _n_.  Then you do this:

1.	On the origin, do

	SELECT _slonyschema.altertablerestore(_n_);

2.	Wait.  Make sure the events propogate everywhere.

3.	On _each server_, load the bulk load file in question.
	
4.	Check your work.  They're all identical, right?

5.	On the origin, do

	SELECT _slonyschema.altertableforreplication(_n_);

I haven't figured out where it's best to add the indexes yet --
before or after.  I suspect it makes no difference.

A

-- 
Andrew Sullivan  | ajs at crankycanuck.ca
The whole tendency of modern prose is away from concreteness.
		--George Orwell

From ajs  Thu Jan  4 15:06:14 2007
From: ajs (Andrew Sullivan)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] cheating with bulk loading?
In-Reply-To: <20070104221610.GI11171@phlogiston.dyndns.org>
References: <20070103232141.GA9327@phlogiston.dyndns.org>
	<20070104211918.GF11171@phlogiston.dyndns.org>
	<200701041330.54433@hal.medialogik.com>
	<20070104221610.GI11171@phlogiston.dyndns.org>
Message-ID: <20070104230614.GA12589@phlogiston.dyndns.org>

On Thu, Jan 04, 2007 at 05:16:10PM -0500, Andrew Sullivan wrote:
> Not just dropping them, but the following appears to work:

Oops, not quite.

> Call it _n_.  Then you do this:
> 
> 1.	On the origin, do
> 
> 	SELECT _slonyschema.altertablerestore(_n_);
> 
> 2.	Wait.  Make sure the events propogate everywhere.
> 
> 5.	On the origin, do
> 
> 	SELECT _slonyschema.altertableforreplication(_n_);

You actually don't need step 2, but you _do_ need to do steps 1 and 5
on every node.  Now that I think about it, I knew that, but forgot. 
Anyway, I think I'll write up a little script that will do this
generically, on the presumption that others might need it.

A

-- 
Andrew Sullivan  | ajs at crankycanuck.ca
"The year's penultimate month" is not in truth a good way of saying
November.
		--H.W. Fowler

From ssinger_pg  Thu Jan  4 18:38:31 2007
From: ssinger_pg (Steve Singer)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] EXECUTE script, LOCK TABLES patch
In-Reply-To: <Pine.LNX.4.62.0612172321050.27085@mini.atlantida.localdomain>
References: <Pine.LNX.4.62.0612172321050.27085@mini.atlantida.localdomain>
Message-ID: <Pine.LNX.4.62.0701032044200.27085@mini.atlantida.localdomain>

On Sun, 17 Dec 2006, Steve Singer wrote:

I haven't received any feedback on this patch nor seen it applied.

Is it just that's everyones been too busy to look at it/apply or are there
some concerns with it.

>
> Attached is my first attempt at a patch to allow EXECUTE SCRIPT to take a 
> user specified list of tables to lock.
>
> The idea is that you can specify something like
>
> EXECUTE SCRIPT(set id=1, filename='new_column.sql',
> 	event node=1, lock tables = ('public.test1','public.address')
> 	);
>
> The ddl_updates_tbl_locks.sql should be added to tests/testddl
>
> The diff file should be applied against CVS HEAD.
>
> Let me know if there are any concerns.
>
>
> Steve Singer
>
>


From pgsql  Fri Jan  5 10:07:42 2007
From: pgsql (Jeff Davis)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] Slony listen path redundancies
In-Reply-To: <4D736CDE-E643-4E12-BD5C-595D37581F6C@richyen.com>
References: <4D736CDE-E643-4E12-BD5C-595D37581F6C@richyen.com>
Message-ID: <1168020462.5344.4.camel@dogma.v10.wvs>

On Thu, 2006-12-28 at 10:14 -0800, Richard Yen wrote:
> Hi,
> 
> My current setup involves one provider/master (node 4), and 3  
> subscriber/slaves (nodes 1, 2, and 5).  If I've read the Slony-I  
> Listen Paths documentations properly, the number of entries in  
> sl_listen should be x(x-1), which for my setup, should be 12 rows.
> 
> However, taking a quick look at my sl_listen tables, I find 30 rows:
> 
> db=# select * from _db.sl_listen ;

I think you're talking about two different tables. Paths are stored in
sl_path, but you're looking at sl_listen.

Regards,
	Jeff Davis


From cbbrowne  Fri Jan  5 11:10:34 2007
From: cbbrowne (Christopher Browne)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] PATCH: In dropthings.sgml,
 mention the easier slonik_drop_table solution
In-Reply-To: <enjpdl$jpj$1@sea.gmane.org>
References: <enjpdl$jpj$1@sea.gmane.org>
Message-ID: <459EA2AA.3040704@ca.afilias.info>

Mark Stosberg wrote:
> This patch improves the "drop things" documentation by mentioning the
> easier to use slonik_drop_table script.
>
>   
I have put this into HEAD and the 1.2 branch, with a little bit of
further editing.

From dpage  Sun Jan  7 10:30:34 2007
From: dpage (Dave Page)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] Version numbers broken in 1.2.5 :-(
Message-ID: <45A13C4A.30002@postgresql.org>

Hey Chris,

Spotted the following whilst packing the latest pgInstaller back branches:

Makefile.global has:

PORTNAME=       win32
PACKAGE_NAME=   postgresql-slony1-engine
VERSION=        1.2.5

whilst config.h has:

#define SLONY_I_VERSION_STRING    "1.2.2"
#define SLONY_I_VERSION_STRING_DEC 1,2,2

:-(. I fixed it for the PostgreSQL releases, but haven't touched the 
Slony CVS. Could you fix and add a step in the release process to 
prevent a reoccurance please?

Dunno if this is worthy of a 1.2.6 release!!

Thanks, Dave.

From cbbrowne  Mon Jan  8 09:26:40 2007
From: cbbrowne (Christopher Browne)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] Version numbers broken in 1.2.5 :-(
In-Reply-To: <45A13C4A.30002@postgresql.org>
References: <45A13C4A.30002@postgresql.org>
Message-ID: <45A27ED0.5000204@ca.afilias.info>

Dave Page wrote:
> Hey Chris,
>
> Spotted the following whilst packing the latest pgInstaller back branches:
>
> Makefile.global has:
>
> PORTNAME=       win32
> PACKAGE_NAME=   postgresql-slony1-engine
> VERSION=        1.2.5
>
> whilst config.h has:
>
> #define SLONY_I_VERSION_STRING    "1.2.2"
> #define SLONY_I_VERSION_STRING_DEC 1,2,2
>
> :-(. I fixed it for the PostgreSQL releases, but haven't touched the 
> Slony CVS. Could you fix and add a step in the release process to 
> prevent a reoccurance please?
>
> Dunno if this is worthy of a 1.2.6 release!!
>   

Grr...   Yes, that's going to mandate 1.2.6.

Grr...  I was looking at a version of the release checklist that omitted
running tools/release_checklist.sh, which would have found this issue :-(.



From cbbrowne  Mon Jan  8 10:16:45 2007
From: cbbrowne (Christopher Browne)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] Version 1.2.6 Released
Message-ID: <45A28A8D.60307@ca.afilias.info>

1.2.5 wasn't fully announced when Dave Page noticed a version number
inconsistency.  So I have repackaged, generating version 1.2.6.

Release 1.2.5 of Slony-I has the following bug fixes over 1.2.2:

- Fixed issue with xxid C functions - these functions need to be
  defined STRICT so that NULL values don't cause the functions to
  barf.  This has been causing users of PostgreSQL 8.2 to see
  postmasters falling over.

- Several improvements to internal documentation of altperl scripts

Release 1.2.6 actually bumps the version number throughout.

My apologies for the confusion; I was looking at an old copy of the
release checklist that failed to remind me of the version number issue.

From drees76  Mon Jan  8 11:42:50 2007
From: drees76 (David Rees)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] Version 1.2.6 Released
In-Reply-To: <45A28A8D.60307@ca.afilias.info>
References: <45A28A8D.60307@ca.afilias.info>
Message-ID: <72dbd3150701081142w4d5574b4re66f7cbeca7125ea@mail.gmail.com>

On 1/8/07, Christopher Browne <cbbrowne at ca.afilias.info> wrote:
> 1.2.5 wasn't fully announced when Dave Page noticed a version number
> inconsistency.  So I have repackaged, generating version 1.2.6.

Somehow the docs tarball got named slony1-1.2.6-docs-tar.bz2 instead
of slony1-1.2.6-docs.tar.bz2. 1.2.5 is correct.

Thanks!

-Dave

From cbbrowne  Mon Jan  8 12:44:57 2007
From: cbbrowne (Christopher Browne)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] Version 1.2.6 Released
In-Reply-To: <72dbd3150701081142w4d5574b4re66f7cbeca7125ea@mail.gmail.com>
	(David Rees's message of "Mon, 8 Jan 2007 11:42:50 -0800")
References: <45A28A8D.60307@ca.afilias.info>
	<72dbd3150701081142w4d5574b4re66f7cbeca7125ea@mail.gmail.com>
Message-ID: <60odp96yeu.fsf@dba2.int.libertyrms.com>

"David Rees" <drees76 at gmail.com> writes:
> On 1/8/07, Christopher Browne <cbbrowne at ca.afilias.info> wrote:
>> 1.2.5 wasn't fully announced when Dave Page noticed a version number
>> inconsistency.  So I have repackaged, generating version 1.2.6.
>
> Somehow the docs tarball got named slony1-1.2.6-docs-tar.bz2 instead
> of slony1-1.2.6-docs.tar.bz2. 1.2.5 is correct.

That'll be fixed momentarily.
-- 
output = reverse("ofni.sailifa.ac" "@" "enworbbc")
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)

From mark  Mon Jan  8 13:11:49 2007
From: mark (Mark Stosberg)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] PATCH: Improve "usage" message for slonik_build_env
Message-ID: <enuc37$qp4$1@sea.gmane.org>


Attached is a small page which improves the slonik_build_env "usage"
message a bit.

I wonder if the script is a bit of date, though. It references
@KEYEDTABLES, etc, which don't exist in slon_tools.conf.

A related tool which would be nice might be "slonik_check_env"-- it
would compare the DB against slon_tools.conf and report differences
between the two, perhaps even offering to repair them.

   Mark


-------------- next part --------------
A non-text attachment was scrubbed...
Name: slonik_build_env.patch
Type: text/x-patch
Size: 603 bytes
Desc: not available
Url : http://gborg.postgresql.org/pipermail/slony1-general/attachments/20070108/aeb496f7/attachment-0001.bin 

From samurai58  Tue Jan  9 07:46:11 2007
From: samurai58 (Largo Stemper)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] SLONY-I disadvantages
Message-ID: <1337623908@web.de>



Hi everybody
 
Can someone help me by giving me a briefing listing the disadvantages of SLONY-I.
 
 
Thank you in advance!
Largo.



_______________________________________________________________________
Viren-Scan f?r Ihren PC! Jetzt f?r jeden. Sofort, online und kostenlos.
Gleich testen! http://www.pc-sicherheit.web.de/freescan/?mc=022222


From samurai58  Tue Jan  9 07:47:12 2007
From: samurai58 (Largo Stemper)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] Replicating functions
Message-ID: <1337627438@web.de>



 Hi everybody and HAPPY NEW YEAR
 
 
 I wanna know why are some of my functions not replicated like the rest of my database.
 
 I used to replicate my DB from my Master to my slave using the slonik commands and SLON.
 
 I see that everything was replicated except "SOME" of my functions , not all. I did test lot of scenarios but nothing works.
 
 So please :
 
 - What are the conditions that prevents a funcitons from being replicated ?
 - The replication is running : Can I see my functions on my slave if I create them on the master with the psql-Client and (/i myFunction.sql) ?
 - Even EXECUTE SCRIPT on the slonik script did not help, it creates my function only on the master, what is if I have a Failover ??
 - Is it  the same for TRIGGERs
 
 
 
 Thank you in advance for the answers .
 Largo.
 
 


_____________________________________________________________________
Der WEB.DE SmartSurfer hilft bis zu 70% Ihrer Onlinekosten zu sparen!
http://smartsurfer.web.de/?mc=100071&distributionid=000000000066


From mark  Tue Jan  9 07:48:38 2007
From: mark (Mark Stosberg)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] altperl, slon_tool.conf-sample
In-Reply-To: <99d8d4dce70bf543279aa589fe2d12c0@oopsware.de>
References: <20061211164704.GD21488@phlogiston.dyndns.org>
	<99d8d4dce70bf543279aa589fe2d12c0@oopsware.de>
Message-ID: <eo0dh8$3pe$1@sea.gmane.org>

Bernd Helmle wrote:
> 
> 
> On Mon, 11 Dec 2006 11:47:04 -0500, Andrew Sullivan <ajs at crankycanuck.ca> wrote:
>> On Mon, Dec 11, 2006 at 03:05:00PM +0100, Stefan Kaltenbrunner wrote:
>>> well after the latest fixes in CVS they actually work(at least i use
>>> them regulary) - and I think it is Bernds intention to take over
>>> maintainance and actively fix them ...
> 
> Thats exactly my intention. I'm currently about to clean up the code and
> to make them to use at least strict/warning. What we need for this kind
> of tools is a reliable framework and regression tests, so that broken 
> functionality could be detected. I have some ideas already...

I'm also interested to help improve these tools, and expect to have some
for it as well. I agree with the approach of getting "use
strict/warnings" to work, as well as have some automated tests for the
tools.

Should I just keep sending patches to this list for nwo, or would direct
access to an SCM system be preferable?

   Mark
   (a.k.a markstos at cpan.org)


From ajs  Tue Jan  9 08:10:15 2007
From: ajs (Andrew Sullivan)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] SLONY-I disadvantages
In-Reply-To: <1337623908@web.de>
References: <1337623908@web.de>
Message-ID: <20070109161015.GA25139@phlogiston.dyndns.org>

On Tue, Jan 09, 2007 at 04:46:11PM +0100, Largo Stemper wrote:

> Can someone help me by giving me a briefing listing the
> disadvantages of SLONY-I.

As compared to what?  "Disadvantage" is a comparative word.

A

-- 
Andrew Sullivan  | ajs at crankycanuck.ca
A certain description of men are for getting out of debt, yet are
against all taxes for raising money to pay it off.
		--Alexander Hamilton

From cbbrowne  Tue Jan  9 08:10:59 2007
From: cbbrowne (Christopher Browne)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] SLONY-I disadvantages
In-Reply-To: <1337623908@web.de>
References: <1337623908@web.de>
Message-ID: <45A3BE93.1090605@ca.afilias.info>

Largo Stemper wrote:
> Can someone help me by giving me a briefing listing the disadvantages of SLONY-I.
>   
Disadvantages (and advantages) do not exist in a vacuum.

They have to be framed in some context; Slony-I can only have advantages
or disadvantages when compared to something else.

You can't conceivably have either sort of "vantage" without specifying
that "something else."

From ajs  Tue Jan  9 08:12:39 2007
From: ajs (Andrew Sullivan)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] Replicating functions
In-Reply-To: <1337627438@web.de>
References: <1337627438@web.de>
Message-ID: <20070109161239.GB25139@phlogiston.dyndns.org>

On Tue, Jan 09, 2007 at 04:47:12PM +0100, Largo Stemper wrote:

>  I wanna know why are some of my functions not replicated like the
>  rest of my database.

Slony doesn't replicate databases.  It replicates tables and
sequences.  Given that your functions are stored in system tables,
it's impossible for Slony to replicate them directly.  You could
cause them to be replicated by passing their creation through EXECUTE
SCRIPT.  My bet is that the ones that you are seeing on your replicas
are the ones that were there in your schema when you exported it.

A

-- 
Andrew Sullivan  | ajs at crankycanuck.ca
Information security isn't a technological problem.  It's an economics
problem.
		--Bruce Schneier

From bnichols  Tue Jan  9 08:18:36 2007
From: bnichols (Brad Nicholson)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] Replicating functions
In-Reply-To: <1337627438@web.de>
References: <1337627438@web.de>
Message-ID: <1168359516.11462.49.camel@dba5.int.libertyrms.com>

On Tue, 2007-01-09 at 16:47 +0100, Largo Stemper wrote:
> 
>  Hi everybody and HAPPY NEW YEAR
>  
> 
>  I wanna know why are some of my functions not replicated like the rest of my database.
>  
>  I used to replicate my DB from my Master to my slave using the slonik commands and SLON.
>  
>  I see that everything was replicated except "SOME" of my functions , not all. I did test lot of scenarios but nothing works.
>  
>  So please :
>  
>  - What are the conditions that prevents a funcitons from being replicated ?

Slony uses triggers to replicate data.  You can't define a trigger on a
function.

>  - The replication is running : Can I see my functions on my slave if I create them on the master with the psql-Client and (/i myFunction.sql) ?

What you want to do is create the functions via psql on all of the
databases that you are replicating.

>  - Even EXECUTE SCRIPT on the slonik script did not help, it creates my function only on the master, what is if I have a Failover ??

Did you execute the script only on the master?  Did you get any errors
in your slon log, or in the postgres logs on the subscriber?

>  - Is it  the same for TRIGGERs

Sort of.  Triggers won't be replicated.  When you add them, you need to
do it with a slonik EXECUTE script.

-- 
Brad Nicholson  416-673-4106
Database Administrator, Afilias Canada Corp.


From gdh  Tue Jan  9 08:02:08 2007
From: gdh (Gavin Hamill)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] 1.2.6 build failure on debian etch
Message-ID: <20070109160208.1152686f.gdh@laterooms.com>

hi - just thought I'd give 1.2.6 a blast. We'll be migrating to PG 8.2.1 when it appears, so it would seem wise to have half of the upgrade done already?

Anyway, this is a very basic Debian etch install with build-essential, postgresql-server-dev-8.1 etc. and I got this:

roffle1:~/slony1-1.2.6# make
make[1]: Entering directory `/root/slony1-1.2.6/src'
make[2]: Entering directory `/root/slony1-1.2.6/src/xxid'
gcc -g -O2 -Wall -Wmissing-prototypes -Wmissing-declarations -fpic -I../.. -I/usr/include/postgresql/ -I/usr/include/postgresql/8.1/server/  -c -o xxid.o xxid.c
In file included from xxid.c:18:
/usr/include/postgresql/8.1/server/access/xact.h:138:46: error: macro "GetTopTransactionId" passed 1 arguments, but takes just 0
make[2]: *** [xxid.o] Error 1
make[2]: Leaving directory `/root/slony1-1.2.6/src/xxid'
make[1]: *** [all] Error 2
make[1]: Leaving directory `/root/slony1-1.2.6/src'
make: *** [all] Error 2

Erk - and sure enough in xact.h, 

extern TransactionId GetTopTransactionId(void);

perhaps it started taking an argument in PG 8.2 ? We have 8.1.5...

Cheers,
Gavin.


From cbbrowne  Tue Jan  9 08:47:02 2007
From: cbbrowne (Christopher Browne)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] Replicating functions
In-Reply-To: <1337627438@web.de>
References: <1337627438@web.de>
Message-ID: <45A3C706.7030409@ca.afilias.info>

Largo Stemper wrote:
>  Hi everybody and HAPPY NEW YEAR
>  
>  
>  I wanna know why are some of my functions not replicated like the rest of my database.
>  
>   
This is a documented limitation.

<http://linuxfinances.info/info/slonyintro.html>

Read the section on "Current Limitations;" it indicates that the only
objects for which Slony-I manages replication are:

1.  Tables
2.  Sequences

Functions are neither tables nor sequences, so they aren't on the list
of things that can be replicated.
>   - What are the conditions that prevents a funcitons from being replicated ?
>   
That's backwards - there is no condition that *allows* functions to be
replicated.
>  - The replication is running : Can I see my functions on my slave if I create them on the master with the psql-Client and (/i myFunction.sql) ?
>   
Only if you initialized the subscriber using a dump from the master node
from some time after the functions had been loaded on the master node.
>  - Even EXECUTE SCRIPT on the slonik script did not help, it creates my function only on the master, what is if I have a Failover ??
>   
Now THAT seems wrong...

EXECUTE SCRIPT runs the SQL script on every node.  I'd certainly expect
that to create functions on all the subscribers.

If that doesn't work, that seems to warrant a bug report.
>  - Is it  the same for TRIGGERs
>   
There's an important difference with triggers; triggers generally get
hidden on replicated tables on the subscribers.

From jd  Tue Jan  9 08:52:48 2007
From: jd (Joshua D. Drake)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] SLONY-I disadvantages
In-Reply-To: <45A3BE93.1090605@ca.afilias.info>
References: <1337623908@web.de>  <45A3BE93.1090605@ca.afilias.info>
Message-ID: <1168361568.724.63.camel@localhost.localdomain>

On Tue, 2007-01-09 at 16:10 +0000, Christopher Browne wrote:
> Largo Stemper wrote:
> > Can someone help me by giving me a briefing listing the disadvantages of SLONY-I.
> >   
> Disadvantages (and advantages) do not exist in a vacuum.
> 
> They have to be framed in some context; Slony-I can only have advantages
> or disadvantages when compared to something else.
> 
> You can't conceivably have either sort of "vantage" without specifying
> that "something else."

O.k. could you guys have given the gentlemen any more useless of a
response?

In general here are some disadvantages of Slony-I:

* It can be difficult to manage/administrate

* The more slaves you add, the more load is placed on the Master
  * This can be alleviated by using cascaded slaves

* The sync model although fast can require quite of be load on the
origin/master

* It can not replicate large_objects

* It can not replicate ddl/user/groups/grant/revoke but does provide
external facilities to handle this issue

* As with many OSS projects it lacks a certain polish but please feel
free to contribute and help :)



Sincerely,

Joshua D. Drake



> _______________________________________________
> Slony1-general mailing list
> Slony1-general at gborg.postgresql.org
> http://gborg.postgresql.org/mailman/listinfo/slony1-general
> 
-- 

      === The PostgreSQL Company: Command Prompt, Inc. ===
Sales/Support: +1.503.667.4564 || 24x7/Emergency: +1.800.492.2240
Providing the most comprehensive  PostgreSQL solutions since 1997
             http://www.commandprompt.com/

Donate to the PostgreSQL Project: http://www.postgresql.org/about/donate




From cbbrowne  Tue Jan  9 08:58:06 2007
From: cbbrowne (Christopher Browne)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] altperl, slon_tool.conf-sample
In-Reply-To: <eo0dh8$3pe$1@sea.gmane.org>
References: <20061211164704.GD21488@phlogiston.dyndns.org>	<99d8d4dce70bf543279aa589fe2d12c0@oopsware.de>
	<eo0dh8$3pe$1@sea.gmane.org>
Message-ID: <45A3C99E.10007@ca.afilias.info>

Mark Stosberg wrote:
> Bernd Helmle wrote:
>   
>> On Mon, 11 Dec 2006 11:47:04 -0500, Andrew Sullivan <ajs at crankycanuck.ca> wrote:
>>     
>>> On Mon, Dec 11, 2006 at 03:05:00PM +0100, Stefan Kaltenbrunner wrote:
>>>       
>>>> well after the latest fixes in CVS they actually work(at least i use
>>>> them regulary) - and I think it is Bernds intention to take over
>>>> maintainance and actively fix them ...
>>>>         
>> Thats exactly my intention. I'm currently about to clean up the code and
>> to make them to use at least strict/warning. What we need for this kind
>> of tools is a reliable framework and regression tests, so that broken 
>> functionality could be detected. I have some ideas already...
>>     
>
> I'm also interested to help improve these tools, and expect to have some
> for it as well. I agree with the approach of getting "use
> strict/warnings" to work, as well as have some automated tests for the
> tools.
>
> Should I just keep sending patches to this list for nwo, or would direct
> access to an SCM system be preferable?
>
>   
If we weren't about to be migrating CVS to a new place, I'd be inclined
to add you to the committers list; you've had enough good changes to
warrant that, in my view.  (We'd have to have some discussion amongst
existing committers, but I don't imagine it would stir much controversy.)

For now, by all means, patch to the list; in a couple weeks, once the
world has changed, pester and we can look into direct access...

From darcy  Tue Jan  9 08:56:07 2007
From: darcy (Darcy Buskermolen)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] SLONY-I disadvantages
In-Reply-To: <1337623908@web.de>
References: <1337623908@web.de>
Message-ID: <200701090856.08054.darcy@dbitech.ca>

On Tuesday 09 January 2007 07:46, Largo Stemper wrote:
> Hi everybody
>
> Can someone help me by giving me a briefing listing the disadvantages of
> SLONY-I.

When you say disadvantages, I suppose you meant limitations.   Some of the 
limitations of Slony-I are, it does not automagicly replicate commands that 
are DDL such as ALTER TABLE,  CREATE USER,  CREATE INDEX etc.  However it 
does provide the functionality to do this by using the slonik command EXECUTE 
SCRIPT.  Also it does not replicate large objects.   Slony-I is not 
multimaster.  Being async, and with the way it works interally it may not be 
particulary well suited to database work that involves long running 
transactions.   Given slony uses triggers to capture DML 
(INSERT/UPDATE/DELETE) on replicated objects it does incur additional 
processing and disk overhead.



>
>
> Thank you in advance!
> Largo.
>
>
>
> _______________________________________________________________________
> Viren-Scan f?r Ihren PC! Jetzt f?r jeden. Sofort, online und kostenlos.
> Gleich testen! http://www.pc-sicherheit.web.de/freescan/?mc=022222
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at gborg.postgresql.org
> http://gborg.postgresql.org/mailman/listinfo/slony1-general

From ajs  Tue Jan  9 09:36:06 2007
From: ajs (Andrew Sullivan)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] SLONY-I disadvantages
In-Reply-To: <1168361568.724.63.camel@localhost.localdomain>
References: <1337623908@web.de> <45A3BE93.1090605@ca.afilias.info>
	<1168361568.724.63.camel@localhost.localdomain>
Message-ID: <20070109173606.GC25139@phlogiston.dyndns.org>

On Tue, Jan 09, 2007 at 08:52:48AM -0800, Joshua D. Drake wrote:
> O.k. could you guys have given the gentlemen any more useless of a
> response?

Uh, yes.  I wanted to know what the comparison class is.  That seems
a reasonable question.  For instance, in your answers:

> * It can be difficult to manage/administrate

Not compared to erserver, I can assure you.  And some of the "ease of
administration" that certain other tools provide comes at the cost og
being unable to do a whole whack of stuff.

There are plenty of limitations, I agree; but whether they're
disadvantages depends pretty much on what you want to do.

A

-- 
Andrew Sullivan  | ajs at crankycanuck.ca
The whole tendency of modern prose is away from concreteness.
		--George Orwell

From jd  Tue Jan  9 09:41:16 2007
From: jd (Joshua D. Drake)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] SLONY-I disadvantages
In-Reply-To: <20070109173606.GC25139@phlogiston.dyndns.org>
References: <1337623908@web.de> <45A3BE93.1090605@ca.afilias.info>
	<1168361568.724.63.camel@localhost.localdomain>
	<20070109173606.GC25139@phlogiston.dyndns.org>
Message-ID: <1168364476.724.68.camel@localhost.localdomain>

On Tue, 2007-01-09 at 12:36 -0500, Andrew Sullivan wrote:
> On Tue, Jan 09, 2007 at 08:52:48AM -0800, Joshua D. Drake wrote:
> > O.k. could you guys have given the gentlemen any more useless of a
> > response?
> 
> Uh, yes.  I wanted to know what the comparison class is.  That seems
> a reasonable question.  For instance, in your answers:
> 
> > * It can be difficult to manage/administrate
> 
> Not compared to erserver,

O.k. but besides you and maybe 5 other companies ;) who actually ran
ERserver? Or more to the point, who in the world is running ERserver
now. For that matter, unless in the know has even heard of ERserver?

>  I can assure you.  And some of the "ease of
> administration" that certain other tools provide comes at the cost og
> being unable to do a whole whack of stuff.

I believe it is a reasonable theory that the person was looking for
general disadvantages (which are indeed limitations) to the product as a
whole and not in comparison to any other product.

> 
> There are plenty of limitations, I agree; but whether they're
> disadvantages depends pretty much on what you want to do.

Agreed but a general splat of a faq would have probably provided a more
useful response, yes?

Sincerely,

Joshua D. Drake


> 
> A
> 
-- 

      === The PostgreSQL Company: Command Prompt, Inc. ===
Sales/Support: +1.503.667.4564 || 24x7/Emergency: +1.800.492.2240
Providing the most comprehensive  PostgreSQL solutions since 1997
             http://www.commandprompt.com/

Donate to the PostgreSQL Project: http://www.postgresql.org/about/donate




From cbbrowne  Tue Jan  9 12:22:43 2007
From: cbbrowne (Christopher Browne)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] SLONY-I disadvantages
In-Reply-To: <1168364476.724.68.camel@localhost.localdomain> (Joshua D.
	Drake's message of "Tue, 09 Jan 2007 09:41:16 -0800")
References: <1337623908@web.de> <45A3BE93.1090605@ca.afilias.info>
	<1168361568.724.63.camel@localhost.localdomain>
	<20070109173606.GC25139@phlogiston.dyndns.org>
	<1168364476.724.68.camel@localhost.localdomain>
Message-ID: <603b6kar1o.fsf@dba2.int.libertyrms.com>

"Joshua D. Drake" <jd at commandprompt.com> writes:
> On Tue, 2007-01-09 at 12:36 -0500, Andrew Sullivan wrote:
>> On Tue, Jan 09, 2007 at 08:52:48AM -0800, Joshua D. Drake wrote:
>> > O.k. could you guys have given the gentlemen any more useless of a
>> > response?
>> 
>> Uh, yes.  I wanted to know what the comparison class is.  That seems
>> a reasonable question.  For instance, in your answers:
>> 
>> > * It can be difficult to manage/administrate
>> 
>> Not compared to erserver,
>
> O.k. but besides you and maybe 5 other companies ;) who actually ran
> ERserver? Or more to the point, who in the world is running ERserver
> now. For that matter, unless in the know has even heard of ERserver?

I was talking to someone last week that apparently still is running
eRServer.  That puts them in a pretty singular sort of group...

>>  I can assure you.  And some of the "ease of
>> administration" that certain other tools provide comes at the cost og
>> being unable to do a whole whack of stuff.
>
> I believe it is a reasonable theory that the person was looking for
> general disadvantages (which are indeed limitations) to the product as a
> whole and not in comparison to any other product.

Disadvantages relative to itself are necessarily null/void.

The only other alternative that seems plausible would be to consider
disadvantages as compared to not using replication at all.

Neither of those comparisons seems particularly useful.

>> There are plenty of limitations, I agree; but whether they're
>> disadvantages depends pretty much on what you want to do.
>
> Agreed but a general splat of a faq would have probably provided a more
> useful response, yes?

Actually, no.  I regularly see this sort of thing, where people
randomly emit "request for comparison" where the thing to be compared
to isn't even alluded to.  There is no way of answering that without
them making themselves clear on the fact that you need to have a point
of comparison.

I did a technical book review a few years back on a book on "Web
services security" which turned out to be an total disaster because
the authors were trying to declare advantages and disadvantages
without having any coherent idea of what they were talking about let
alone comparing to.

We periodically see on pg-advocacy threads that start with the line
"what are the advantages and disadvantages of PostgreSQL?" and that,
again, is necessarily devoid of content without the point of reference
of having something else to compare it to.

Otherwise, it is NOT silly to consider the answers to be of the sort:

- How is PostgreSQL better/worse than writing things down on paper?

- In what ways is Slony-I better/worse than having a Gene Simmons doll
on one's desk that sings "I want to rock and roll all night" when you
press a button?

The latter is almost certainly a more frivolous form of response than
what was in mind, but that doesn't mean that the initial question
doesn't need to be improved upon...
-- 
"cbbrowne","@","ca.afilias.info"
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)

From vivek  Tue Jan  9 12:43:48 2007
From: vivek (Vivek Khera)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] SLONY-I disadvantages
In-Reply-To: <1168364476.724.68.camel@localhost.localdomain>
References: <1337623908@web.de> <45A3BE93.1090605@ca.afilias.info>
	<1168361568.724.63.camel@localhost.localdomain>
	<20070109173606.GC25139@phlogiston.dyndns.org>
	<1168364476.724.68.camel@localhost.localdomain>
Message-ID: <92902A80-A8E9-46BE-B94B-22A2177102D6@khera.org>


On Jan 9, 2007, at 12:41 PM, Joshua D. Drake wrote:

> O.k. but besides you and maybe 5 other companies ;) who actually ran
> ERserver? Or more to the point, who in the world is running ERserver
> now. For that matter, unless in the know has even heard of ERserver?

Boy, I feel "speshul" now since I was one of the (un)lucky few...

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 2530 bytes
Desc: not available
Url : http://gborg.postgresql.org/pipermail/slony1-general/attachments/20070109/b473196c/attachment.bin 

From z-saito  Tue Jan  9 22:20:16 2007
From: z-saito (Hiroshi Saito)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] Version 1.2.6 Released
References: <45A28A8D.60307@ca.afilias.info>
Message-ID: <05ea01c7347f$651849d0$3043040a@wiseknot.local>

Hi all.

Sorry for delayed....
Version 1.2.6 fo windows is available.
http://developer.pgadmin.org/~hiroshi/Slony-I/
It might be effective to PostgreSQL Version 8.1. 
Note: 
This built into a standard pginstaller PostgreSQL Version 8.2.

Thanks!

Regards,
Hiroshi Saito


From dpage  Wed Jan 10 00:31:50 2007
From: dpage (Dave Page)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] Version 1.2.6 Released
In-Reply-To: <05ea01c7347f$651849d0$3043040a@wiseknot.local>
References: <45A28A8D.60307@ca.afilias.info>
	<05ea01c7347f$651849d0$3043040a@wiseknot.local>
Message-ID: <45A4A476.3070104@postgresql.org>

Hiroshi Saito wrote:
> Hi all.
> 
> Sorry for delayed....
> Version 1.2.6 fo windows is available.
> http://developer.pgadmin.org/~hiroshi/Slony-I/
> It might be effective to PostgreSQL Version 8.1. 
> Note: 
> This built into a standard pginstaller PostgreSQL Version 8.2.

It's built into 8.1 as well.

Regards, Dave

From adam.cassar  Wed Jan 10 19:55:39 2007
From: adam.cassar (Adam Cassar)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] database upgrade
Message-ID: <1168487739.5574.24.camel@acshoes>

Hello,

We are currently running slony successfully in a mixed PG environment
(v8 and v8.1).

With the release of PG v8.2 we want to upgrade all servers in our
cluster to v8.2

I thought this would be quite simple - just dump and restore the db and
everything should work....

Restoring a slony enabled database to PG v8.2 crashes PG when restoring
the sl_log table. I can sucessfully restore 80GB of data without the
slony schema.

So my question is - can I upgrade a database that has slony installed?
Or do I have to install the new database and replicate the data over?

TIA


From JanWieck  Wed Jan 10 21:18:00 2007
From: JanWieck (Jan Wieck)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] database upgrade
In-Reply-To: <1168487739.5574.24.camel@acshoes>
References: <1168487739.5574.24.camel@acshoes>
Message-ID: <45A5C888.1090803@Yahoo.com>

On 1/10/2007 10:55 PM, Adam Cassar wrote:
> Hello,
> 
> We are currently running slony successfully in a mixed PG environment
> (v8 and v8.1).
> 
> With the release of PG v8.2 we want to upgrade all servers in our
> cluster to v8.2
> 
> I thought this would be quite simple - just dump and restore the db and
> everything should work....

That assumption was quite wrong. That is not the way how to upgrade a 
Slony cluster.

The database schema of your subscriber nodes (slaves) is in an 
inconsistent state from PostgreSQL's point of view. I am planning to get 
rid of this problem in the future, but it will be some time before it 
can be fixed. That means, that you cannot dump and restore a subscriber.

If you have the luxury to take an outage long enough to

     1.) uninstall slony completely
     2.) dump, upgrade PostgreSQL and restore the master
     3.) throw away and install new PostgreSQL version on all slaves
     4.) rebuild the entire slony cluster

do that.

Unfortunately not everyone has that luxury. If you are among those 
unfortunate people, here are the 12 pains of Christmas, Slony gave to you:

     1.) upgrade the cluster to the latest slony production release
     2.) Make your designated Backup node a leaf node
     3.) DROP that designated Backup node.
     4.) throw away and install new PostgreSQL version on that node.
     5.) STORE NODE for it and go through the full subscription process.
     6.) wait until it is completely in sync.
     7.) make it the only direct subscriber of the master, with all
         other nodes being cascaded from it (directly or sub-cascaded).
     8.) Switchover to the designated backup.
     9.) Drop the old master (which is now a subscriber).
    10.) Upgrade old master to an empty, new PostgreSQL version.
    11.) Subscribe it (again, wait until complete and cought up).
    12.) Switch back and reshape the cluster as needed.

The reason why this is so ugly and painfull is entirely that it is 
impossible to dump and restore a subscriber any way, that restores the 
system catalog into it's slony-corrupted state. That is why I am 
currently focused entirely on fixing that problem. Things would be a lot 
easier without that.


Jan

-- 
#======================================================================#
# It's easier to get forgiveness for being wrong than for being right. #
# Let's break this rule - forgive me.                                  #
#================================================== JanWieck at Yahoo.com #

From adam.cassar  Wed Jan 10 21:24:36 2007
From: adam.cassar (Adam Cassar)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] database upgrade
In-Reply-To: <45A5C888.1090803@Yahoo.com>
References: <1168487739.5574.24.camel@acshoes>  <45A5C888.1090803@Yahoo.com>
Message-ID: <1168493076.5574.39.camel@acshoes>


Thanks for your excellent reply.

On Thu, 2007-01-11 at 00:18 -0500, Jan Wieck wrote:
> On 1/10/2007 10:55 PM, Adam Cassar wrote:
> > Hello,
> > 
> > We are currently running slony successfully in a mixed PG environment
> > (v8 and v8.1).
> > 
> > With the release of PG v8.2 we want to upgrade all servers in our
> > cluster to v8.2
> > 
> > I thought this would be quite simple - just dump and restore the db and
> > everything should work....
> 
> That assumption was quite wrong. That is not the way how to upgrade a 
> Slony cluster.
> 
> The database schema of your subscriber nodes (slaves) is in an 
> inconsistent state from PostgreSQL's point of view. I am planning to get 
> rid of this problem in the future, but it will be some time before it 
> can be fixed. That means, that you cannot dump and restore a subscriber.
> 
> If you have the luxury to take an outage long enough to
> 
>      1.) uninstall slony completely
>      2.) dump, upgrade PostgreSQL and restore the master
>      3.) throw away and install new PostgreSQL version on all slaves
>      4.) rebuild the entire slony cluster
> 
> do that.
> 
> Unfortunately not everyone has that luxury. If you are among those 
> unfortunate people, here are the 12 pains of Christmas, Slony gave to you:
> 
>      1.) upgrade the cluster to the latest slony production release
>      2.) Make your designated Backup node a leaf node
>      3.) DROP that designated Backup node.
>      4.) throw away and install new PostgreSQL version on that node.
>      5.) STORE NODE for it and go through the full subscription process.
>      6.) wait until it is completely in sync.
>      7.) make it the only direct subscriber of the master, with all
>          other nodes being cascaded from it (directly or sub-cascaded).
>      8.) Switchover to the designated backup.
>      9.) Drop the old master (which is now a subscriber).
>     10.) Upgrade old master to an empty, new PostgreSQL version.
>     11.) Subscribe it (again, wait until complete and cought up).
>     12.) Switch back and reshape the cluster as needed.
> 
> The reason why this is so ugly and painfull is entirely that it is 
> impossible to dump and restore a subscriber any way, that restores the 
> system catalog into it's slony-corrupted state. That is why I am 
> currently focused entirely on fixing that problem. Things would be a lot 
> easier without that.
> 
> 
> Jan
> 
-- 
Adam Cassar
ICT Manager
NetRegistry Pty Ltd
______________________________________________
http://www.netregistry.com.au
Tel:  02 9699 6099          Fax:  02 9699 6088
PO Box 270    Broadway      NSW   2007

Domains |Business Email|Web Hosting|E-Commerce
Trusted  by  10,000s of  businesses since 1997
______________________________________________


From JanWieck  Wed Jan 10 22:34:24 2007
From: JanWieck (Jan Wieck)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] database upgrade
In-Reply-To: <1168493076.5574.39.camel@acshoes>
References: <1168487739.5574.24.camel@acshoes> <45A5C888.1090803@Yahoo.com>
	<1168493076.5574.39.camel@acshoes>
Message-ID: <45A5DA70.7030603@Yahoo.com>

On 1/11/2007 12:24 AM, Adam Cassar wrote:
> Thanks for your excellent reply.

Excellent?

You got quite a remarkable pain tolerance!

I consider the oversight, that the corruptions done to the system 
catalog on slaves make a smooth upgrade of PostgreSQL a real PITA, 
rather embarrassing. That got nothing to do with excellence. I should 
have seen this from the very beginning, but I didn't realize this until 
about a year ago or so.


Jan

> 
> On Thu, 2007-01-11 at 00:18 -0500, Jan Wieck wrote:
>> On 1/10/2007 10:55 PM, Adam Cassar wrote:
>> > Hello,
>> > 
>> > We are currently running slony successfully in a mixed PG environment
>> > (v8 and v8.1).
>> > 
>> > With the release of PG v8.2 we want to upgrade all servers in our
>> > cluster to v8.2
>> > 
>> > I thought this would be quite simple - just dump and restore the db and
>> > everything should work....
>> 
>> That assumption was quite wrong. That is not the way how to upgrade a 
>> Slony cluster.
>> 
>> The database schema of your subscriber nodes (slaves) is in an 
>> inconsistent state from PostgreSQL's point of view. I am planning to get 
>> rid of this problem in the future, but it will be some time before it 
>> can be fixed. That means, that you cannot dump and restore a subscriber.
>> 
>> If you have the luxury to take an outage long enough to
>> 
>>      1.) uninstall slony completely
>>      2.) dump, upgrade PostgreSQL and restore the master
>>      3.) throw away and install new PostgreSQL version on all slaves
>>      4.) rebuild the entire slony cluster
>> 
>> do that.
>> 
>> Unfortunately not everyone has that luxury. If you are among those 
>> unfortunate people, here are the 12 pains of Christmas, Slony gave to you:
>> 
>>      1.) upgrade the cluster to the latest slony production release
>>      2.) Make your designated Backup node a leaf node
>>      3.) DROP that designated Backup node.
>>      4.) throw away and install new PostgreSQL version on that node.
>>      5.) STORE NODE for it and go through the full subscription process.
>>      6.) wait until it is completely in sync.
>>      7.) make it the only direct subscriber of the master, with all
>>          other nodes being cascaded from it (directly or sub-cascaded).
>>      8.) Switchover to the designated backup.
>>      9.) Drop the old master (which is now a subscriber).
>>     10.) Upgrade old master to an empty, new PostgreSQL version.
>>     11.) Subscribe it (again, wait until complete and cought up).
>>     12.) Switch back and reshape the cluster as needed.
>> 
>> The reason why this is so ugly and painfull is entirely that it is 
>> impossible to dump and restore a subscriber any way, that restores the 
>> system catalog into it's slony-corrupted state. That is why I am 
>> currently focused entirely on fixing that problem. Things would be a lot 
>> easier without that.
>> 
>> 
>> Jan
>> 


-- 
#======================================================================#
# It's easier to get forgiveness for being wrong than for being right. #
# Let's break this rule - forgive me.                                  #
#================================================== JanWieck at Yahoo.com #

From samurai58  Wed Jan 10 00:37:23 2007
From: samurai58 (Largo Stemper)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] SLONY-I disadvantages
Message-ID: <1339064839@web.de>

Hi Everydoby

I started using SLONY-I for a simple large DB replication. As my team collegues started to change the scope of the project, if I can call it project, I realized sometimes constraints in the SLONY usage.

That s why I wanted to know generally , based on the experience of everyone ; where did U found CONSTRAINTs or PROBLEMs (generally) while using SLONY in a project and not in a simple DB replication. As example for what I am looking for is :
- SLONY-I is "good" by handling random() values because I will not have different random-Vals in Master or Slave , what is not the case of PGCluster.
- A disadvantage, as example, can be that SLONY-I can not handle a project that needs every week or day a new database because, we can not stop a replication , but we must add a new set.
- Another example is that one may use lot of sets by a large number of DBs to avoid deadlocks, thing that makes the administration more complicated...

I mean according to your projects and your expereince, where did one of you all see some problems.


Thanks again
-----------------------------------------------------------------------------------------------------------------------------------
Christopher Browne wrote:
> Largo Stemper wrote:
>> Can someone help me by giving me a briefing listing the disadvantages of SLONY-I.
>>   
> Disadvantages (and advantages) do not exist in a vacuum.
>
> They have to be framed in some context; Slony-I can only have advantages
> or disadvantages when compared to something else.
>
> You can't conceivably have either sort of "vantage" without specifying
> that "something else."


_______________________________________________________________________
Viren-Scan f?r Ihren PC! Jetzt f?r jeden. Sofort, online und kostenlos.
Gleich testen! http://www.pc-sicherheit.web.de/freescan/?mc=022222


From kinaole  Thu Jan 11 14:30:47 2007
From: kinaole (Dave Price)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] Initial copy fails - corrupt source table?
Message-ID: <8e57a2280701111430l63ad9e2djd038abc1e808f339@mail.gmail.com>

I am trying to replicate a large database with slony - the replication
starts, but eventually fails with:

2007-01-11 15:15:50 MST ERROR  remoteWorkerThread_1: copy from stdin
on local node - PGRES_FATAL_ERROR ERROR:  invalid byte sequence for
encoding "UTF8": 0x98
CONTEXT:  COPY ast_event_attributes, line 42953749


I believe that I have some corrupted data in the original master table -

- Is there a way to use the information in this error to locate and
remove the offending data?

- Is there a best way to restart the replication once I have corrcted
the problem in the source data.



-- 
aloha,
dave

From rod  Thu Jan 11 15:03:02 2007
From: rod (Raymond O'Donnell)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] Initial copy fails - corrupt source table?
In-Reply-To: <8e57a2280701111430l63ad9e2djd038abc1e808f339@mail.gmail.com>
References: <8e57a2280701111430l63ad9e2djd038abc1e808f339@mail.gmail.com>
Message-ID: <45A6C226.2050902@iol.ie>

Dave Price wrote:

> on local node - PGRES_FATAL_ERROR ERROR:  invalid byte sequence for
> encoding "UTF8": 0x98

At a guess, does the encoding in the slave DB differ from that of the 
master? I was warned about that recently on this list....

Ray.

---------------------------------------------------------------
Raymond O'Donnell, Director of Music, Galway Cathedral, Ireland
rod at iol.ie
---------------------------------------------------------------

From kinaole  Thu Jan 11 15:45:53 2007
From: kinaole (Dave Price)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] Initial copy fails - corrupt source table?
In-Reply-To: <45A6C226.2050902@iol.ie>
References: <8e57a2280701111430l63ad9e2djd038abc1e808f339@mail.gmail.com>
	<45A6C226.2050902@iol.ie>
Message-ID: <8e57a2280701111545q32b2c4a4o3d4bb46eeb9b11f2@mail.gmail.com>

I used the slony scrip / pg_dump to copy the structure - does that
mean that the encoding is the same, or is it possible that the two
databases have a different defaul, and I need to override it?

I am not a psql server configuration whiz, so I do not know how to
check this 'definitively'

aloha,
dave


On 1/11/07, Raymond O'Donnell <rod at iol.ie> wrote:
> Dave Price wrote:
>
> > on local node - PGRES_FATAL_ERROR ERROR:  invalid byte sequence for
> > encoding "UTF8": 0x98
>
> At a guess, does the encoding in the slave DB differ from that of the
> master? I was warned about that recently on this list....
>
> Ray.
>
> ---------------------------------------------------------------
> Raymond O'Donnell, Director of Music, Galway Cathedral, Ireland
> rod at iol.ie
> ---------------------------------------------------------------
>


-- 
aloha,
dave

From ssinger_pg  Thu Jan 11 16:08:42 2007
From: ssinger_pg (Steve Singer)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] SLONY-I disadvantages
Message-ID: <Pine.LNX.4.62.0701111908050.3241@mini.atlantida.localdomain>

On Wed, 10 Jan 2007, Largo Stemper wrote:

> Hi Everydoby
> 
> 
> That s why I wanted to know generally , based on the experience of everyone ; 
> where did U found CONSTRAINTs or PROBLEMs (generally) while using SLONY in a 
> project and not in a simple DB replication. As example for what I am looking 
> for is : - SLONY-I is "good" by handling random() values because I will not 
> have different random-Vals in Master or Slave , what is not the case of 
> PGCluster. - A disadvantage, as example, can be that SLONY-I can not handle a 
> project that needs every week or day a new database because, we can not stop 
> a replication , but we must add a new set. - Another example is that one may 
> use lot of sets by a large number
> of DBs to avoid deadlocks, thing that makes the administration more 
> complicated...

I'm a bit confused as to what your issues are with adding tables.
If you want to add a table to an existing setup without stopping replication 
you would do something like:
-Create a new set
-Add your new tables to the new set
-Subscribe your slaves to the new set
-Wait till everything replicates
-Merge your new set into your old set

That leaves you with 1 set at the end of the process so it should not be an 
administration pain.  I don't belive any of the above operations would require 
an outage window and should not be painful especially if you write a script to 
automate the above steps.

What we have found much more painful is adding columns (or any other ALTER 
table) command to tables that are already being replicated.  In the current 
version of slony this requires obtain an exclusive lock on all replicated 
tables in all sets.  This essentially requires an outage/maintaince window to 
avoid deadlock.

It is unclear to me what you mean by 'one may use lot of sets by a large number 
of DB's to avoid deadlock'


The admin guide is full of lots of things that can cause problems for you if 
you don't watch out for them and is well worth your time to read in detail.
Ignoring the issues raised in the locking chapter will give you some nasty 
surprises but if you gain a good understanding of how slony behaves you 
shouldn't be surprised.  Which behaviours of slony will be big issues depends a 
lot on your operational conditions.

> 
> I mean according to your projects and your expereince, where did one of you 
> all see some problems.
> 
> 
> Thanks again
> 
> -----------------------------------------------------------------------------------------------------------------------------------
> Christopher Browne wrote:
>> Largo Stemper wrote:
>>> Can someone help me by giving me a briefing listing the disadvantages of 
>>> SLONY-I.
>>> 
>> Disadvantages (and advantages) do not exist in a vacuum.
>> 
>> They have to be framed in some context; Slony-I can only have advantages
>> or disadvantages when compared to something else.
>> 
>> You can't conceivably have either sort of "vantage" without specifying
>> that "something else."
> 
> 
> _______________________________________________________________________
> Viren-Scan f?r Ihren PC! Jetzt f?r jeden. Sofort, online und kostenlos.
> Gleich testen! http://www.pc-sicherheit.web.de/freescan/?mc=022222
> 
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at gborg.postgresql.org
> http://gborg.postgresql.org/mailman/listinfo/slony1-general
>

From dun  Thu Jan 11 23:07:57 2007
From: dun (Dun)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] Initial copy fails - corrupt source table?
In-Reply-To: <8e57a2280701111545q32b2c4a4o3d4bb46eeb9b11f2@mail.gmail.com>
References: <8e57a2280701111430l63ad9e2djd038abc1e808f339@mail.gmail.com>	<45A6C226.2050902@iol.ie>
	<8e57a2280701111545q32b2c4a4o3d4bb46eeb9b11f2@mail.gmail.com>
Message-ID: <45A733CD.9080709@haisuli.net>

Dave Price wrote:
> I used the slony scrip / pg_dump to copy the structure - does that
> mean that the encoding is the same, or is it possible that the two
> databases have a different defaul, and I need to override it?
>
> I am not a psql server configuration whiz, so I do not know how to
> check this 'definitively'
>
> aloha,
> dave
>   

pg_dump has no effect on the encoding of the database, which is decided 
at the time of creation. psql -l will give you a list of databases and 
their encodings.

Regards,

MP

From dun  Thu Jan 11 22:58:12 2007
From: dun (Dun)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] SLONY-I disadvantages
In-Reply-To: <Pine.LNX.4.62.0701111908050.3241@mini.atlantida.localdomain>
References: <Pine.LNX.4.62.0701111908050.3241@mini.atlantida.localdomain>
Message-ID: <45A73184.2060604@haisuli.net>

Steve Singer wrote:
> What we have found much more painful is adding columns (or any other 
> ALTER table) command to tables that are already being replicated.  In 
> the current version of slony this requires obtain an exclusive lock on 
> all replicated tables in all sets.  This essentially requires an 
> outage/maintaince window to avoid deadlock.

I thought that for execute script slonik requires an exclusive lock on 
all replicated tables /in the same set/. 
(http://linuxfinances.info/info/ddlchanges.html)

Regards

MP


From gdh  Fri Jan 12 03:55:50 2007
From: gdh (Gavin Hamill)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] 1.2.6 build failure on debian etch
In-Reply-To: <20070109160208.1152686f.gdh@laterooms.com>
References: <20070109160208.1152686f.gdh@laterooms.com>
Message-ID: <20070112115550.22bf4e22.gdh@laterooms.com>

On Tue, 9 Jan 2007 16:02:08 +0000
Gavin Hamill <gdh at laterooms.com> wrote:

Sorry to have to bump - is there anyone who can spare a moment for this
little teaser?

http://gborg.postgresql.org/pipermail/slony1-general/2007-January/005619.html

Cheers,
Gavin.

From stephane.schildknecht  Fri Jan 12 04:14:17 2007
From: stephane.schildknecht (=?ISO-8859-1?Q?St=E9phane_Schildknecht?=)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] 1.2.6 build failure on debian etch
In-Reply-To: <20070109160208.1152686f.gdh@laterooms.com>
References: <20070109160208.1152686f.gdh@laterooms.com>
Message-ID: <45A77B99.2000301@postgresqlfr.org>

Gavin,

Gavin Hamill a ?crit :
> roffle1:~/slony1-1.2.6# make
> make[1]: Entering directory `/root/slony1-1.2.6/src'
> make[2]: Entering directory `/root/slony1-1.2.6/src/xxid'
> gcc -g -O2 -Wall -Wmissing-prototypes -Wmissing-declarations -fpic -I../.. -I/usr/include/postgresql/ -I/usr/include/postgresql/8.1/server/  -c -o xxid.o xxid.c
> In file included from xxid.c:18:
> /usr/include/postgresql/8.1/server/access/xact.h:138:46: error: macro "GetTopTransactionId" passed 1 arguments, but takes just 0
> make[2]: *** [xxid.o] Error 1
> make[2]: Leaving directory `/root/slony1-1.2.6/src/xxid'
> make[1]: *** [all] Error 2
> make[1]: Leaving directory `/root/slony1-1.2.6/src'
> make: *** [all] Error 2
>
> Erk - and sure enough in xact.h, 
>
> extern TransactionId GetTopTransactionId(void);
>
> perhaps it started taking an argument in PG 8.2 ? We have 8.1.5...
>   

I've looked through PG8.2 (source code) and 8.1 installed by Ubuntu, and
none of them define GetTopTransactionId with an argument.

$ rgrep GetTopTransactionId /usr/include/postgresql/
/usr/include/postgresql/8.1/server/access/xact.h:extern TransactionId
GetTopTransactionId(void);
In 8.2.1 sources :
src/include/access/xact.h:extern TransactionId GetTopTransactionId(void);


SAS


From ssinger_pg  Fri Jan 12 04:46:43 2007
From: ssinger_pg (Steve Singer)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] SLONY-I disadvantages
In-Reply-To: <45A73184.2060604@haisuli.net>
References: <Pine.LNX.4.62.0701111908050.3241@mini.atlantida.localdomain>
	<45A73184.2060604@haisuli.net>
Message-ID: <Pine.LNX.4.62.0701120743180.3241@mini.atlantida.localdomain>

On Fri, 12 Jan 2007, Dun wrote:

> Steve Singer wrote:
>> What we have found much more painful is adding columns (or any other ALTER 
>> table) command to tables that are already being replicated.  In the current 
>> version of slony this requires obtain an exclusive lock on all replicated 
>> tables in all sets.  This essentially requires an outage/maintaince window 
>> to avoid deadlock.
>
> I thought that for execute script slonik requires an exclusive lock on all 
> replicated tables /in the same set/. 
> (http://linuxfinances.info/info/ddlchanges.html)

That section of the manual could use some clarification.
Read a few paragraphs down to the note arrow:

    Actually, as of version 1.1.5 and later, this is NOT TRUE. The danger of
    someone making DDL changes that crosses replication sets seems
    sufficiently palpable that slon(1) has been changed to lock ALL
    replicated tables,whether they are in the specified replication set or
    not.

http://linuxfinances.info/info/stmtddlscript.html is a bit more clear on the 
subject.




>
> Regards
>
> MP
>


From kinaole  Fri Jan 12 07:24:02 2007
From: kinaole (Dave Price)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] Initial copy fails - corrupt source table?
In-Reply-To: <45A733CD.9080709@haisuli.net>
References: <8e57a2280701111430l63ad9e2djd038abc1e808f339@mail.gmail.com>
	<45A6C226.2050902@iol.ie>
	<8e57a2280701111545q32b2c4a4o3d4bb46eeb9b11f2@mail.gmail.com>
	<45A733CD.9080709@haisuli.net>
Message-ID: <8e57a2280701120724g3d101653s1f46933cdde6041a@mail.gmail.com>

Well, I see a problem ... db4 is my slave target,  db2 is the live
database, db3 is the master I am using to test with first - restored
backup from db2 ...

db3 appears to be defaulting to UTF8 not SQL_ASCII like the other two servers.

I realize this is not a slony issue, but can anyone point me towards
where this is set, and how it may be changed?

<snippy>

[davep at htpc:~/proj/slony/footest]$ psql -l  <- this is a.k.a db3 "test master"
           List of databases
     Name     |   Owner    | Encoding
--------------+------------+-----------
 archive      | postgres   | SQL_ASCII
 asterisk     | asterisk   | SQL_ASCII
 cdr          | davep      | SQL_ASCII
 davep        | davep      | SQL_ASCII
 foo          | davep      | SQL_ASCII
 foo_save     | davep      | SQL_ASCII
 pgbench      | postmaster | SQL_ASCII
 pgbenchslave | postmaster | SQL_ASCII
 postgres     | postgres   | SQL_ASCII
 showbill     | davep      | SQL_ASCII
 showbill_bak | davep      | SQL_ASCII
 template0    | postgres   | SQL_ASCII
 template1    | postgres   | SQL_ASCII
 trac         | postgres   | SQL_ASCII
 voip         | postgres   | SQL_ASCII
(15 rows)

[davep at htpc:~/proj/slony/footest]$ psql -h db2 -l   <-- db2 is the live data ...
          List of databases
     Name     |  Owner   | Encoding
--------------+----------+-----------
 asterisk     | postgres | SQL_ASCII
 davep        | root     | SQL_ASCII
 foo          | postgres | SQL_ASCII
 pgbench      | slony    | SQL_ASCII
 pgbenchslave | slony    | SQL_ASCII
 postgres     | postgres | SQL_ASCII
 root         | root     | SQL_ASCII
 template0    | postgres | SQL_ASCII
 template1    | postgres | SQL_ASCII
 trac         | postgres | SQL_ASCII
(10 rows)

[davep at htpc:~/proj/slony/footest]$ psql -h db4 -l  <-- db4 is the slave target
         List of databases
   Name    |   Owner    | Encoding
-----------+------------+----------
 archive   | davep      | UTF8
 cdr       | davep      | UTF8
 davep     | postmaster | UTF8
 foo       | davep      | UTF8
 pgsql     | davep      | UTF8
 postgres  | postmaster | UTF8
 root      | postmaster | UTF8
 template0 | postmaster | UTF8
 template1 | postmaster | UTF8
(9 rows)

[davep at htpc:~/proj/slony/footest]$

</snippy>


On 1/12/07, Dun <dun at haisuli.net> wrote:
> Dave Price wrote:
> > I used the slony scrip / pg_dump to copy the structure - does that
> > mean that the encoding is the same, or is it possible that the two
> > databases have a different defaul, and I need to override it?
> >
> > I am not a psql server configuration whiz, so I do not know how to
> > check this 'definitively'
> >
> > aloha,
> > dave
> >
>
> pg_dump has no effect on the encoding of the database, which is decided
> at the time of creation. psql -l will give you a list of databases and
> their encodings.
>
> Regards,
>
> MP
>


-- 
aloha,
dave

From costa.galanis  Fri Jan 12 07:04:17 2007
From: costa.galanis (Costa Galanis)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] Performance problems when adding sequences
Message-ID: <45A7A371.6090709@broadsign.com>

Hello,

We are currently running a Postgres 8.1.3 database on an Ubuntu 5.10 
server and recently implemented slony to replicate it.

We're encountering an issue when including the sequences in our db 
schema in the replication set. When replicating only our tables (about 
100 tables in total), performance and replication is smooth. However, 
when including the sequences in the replication process (about 14 
sequences), this system load on our database server skyrockets after a 
couple of hours and the DB becomes unresponsive to any communication 
from our application. Without the sequences included in the set, the 
load average hovers around the 0.2 up to the 2.0 range when being stress 
tested, but when including them, the load rises to 10 and more after a 
few hours of normal operation, at which point the server eventually 
becomes unresponsive.

While I realize it is warned that replicating sequences incurs a 
performance hit, I can't imagine such an extreme effect to be expected. 
Are there any configuration options you can suggest to us to explore and 
experiment with to deal with this before reporting anything on the Slony 
bug tracker?

Thanks,

Costa Galanis



From ajs  Fri Jan 12 09:12:04 2007
From: ajs (Andrew Sullivan)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] Initial copy fails - corrupt source table?
In-Reply-To: <8e57a2280701120724g3d101653s1f46933cdde6041a@mail.gmail.com>
References: <8e57a2280701111430l63ad9e2djd038abc1e808f339@mail.gmail.com>
	<45A6C226.2050902@iol.ie>
	<8e57a2280701111545q32b2c4a4o3d4bb46eeb9b11f2@mail.gmail.com>
	<45A733CD.9080709@haisuli.net>
	<8e57a2280701120724g3d101653s1f46933cdde6041a@mail.gmail.com>
Message-ID: <20070112171204.GA2297@phlogiston.dyndns.org>

On Fri, Jan 12, 2007 at 08:24:02AM -0700, Dave Price wrote:
> Well, I see a problem ... db4 is my slave target,  db2 is the live
> database, db3 is the master I am using to test with first - restored
> backup from db2 ...
> 
> db3 appears to be defaulting to UTF8 not SQL_ASCII like the other two servers.

Your output suggested that db4 was the one with UTF-8.

You have to specify this at database creation time.  So you should
drop the databases and recreate them with SQL_ASCII encoding.  One
thing to check is your locale on the machine; if that's UTF-8, UTF-8
is what you'll get in the database.

A

-- 
Andrew Sullivan  | ajs at crankycanuck.ca
Information security isn't a technological problem.  It's an economics
problem.
		--Bruce Schneier

From pgsql  Fri Jan 12 19:28:53 2007
From: pgsql (Jeff Davis)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] update functions on 1.2.6 fails
Message-ID: <1168658933.2411.19.camel@dogma.v10.wvs>

I ran into a strange problem that I began discussing with DB_Home on
IRC. 

I upgraded from 1.2.2 -> 1.2.6 and used the proper UPDATE FUNCTIONS
command.

However, shortly thereafter I was moving a set, but my move set was
failing because one of my servers is 8.2 and xxidin was crashing.

It looks like UPDATE FUNCTIONS changes the functions, but does not set
them to be STRICT, which 1.2.6/8.2 depend on.

Should we have a process that always sets those functions strict on
UPDATE FUNCTIONS, regardless of version? It doesn't look like there are
any modifications to the upgradeSchema function for 1.2.6.

Regards,
	Jeff Davis


From gdh  Sat Jan 13 07:27:36 2007
From: gdh (Gavin Hamill)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] 1.2.6 build failure on debian etch
In-Reply-To: <45A77B99.2000301@postgresqlfr.org>
References: <20070109160208.1152686f.gdh@laterooms.com>
	<45A77B99.2000301@postgresqlfr.org>
Message-ID: <200701131527.36841.gdh@laterooms.com>

On Friday 12 January 2007 12:14, St?phane Schildknecht wrote:
> Gavin,
>
> I've looked through PG8.2 (source code) and 8.1 installed by Ubuntu, and
> none of them define GetTopTransactionId with an argument.

Hurrah - i just deleted the slony1-1.2.6 dir, unpacked  again, ran ./configure 
and make, and it worked this time - I must have been missing a package when I 
ran configure the first time. <shrug> Whatever it was, I'm happy now :)

Cheers,
Gavin.

From jeff  Sun Jan 14 17:27:19 2007
From: jeff (Jeff Frost)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] sl_registry not created on upgrade
Message-ID: <Pine.LNX.4.64.0701141725430.4407@discord.home.frostconsultingllc.com>

I just upgraded a test server from 1.2.2 to 1.2.6 and noticed that sl_registry 
did not get created.  It looks like it should have been created by 1.2.2, but 
apparently it was not.

This server started out as 1.1.5, then was upgraded to 1.2.2 and today has 
been upgraded to 1.2.6.

To fix it, I just manually created sl_registry, but thought you folks might be 
interested in hearing about the experience.

-- 
Jeff Frost, Owner 	<jeff at frostconsultingllc.com>
Frost Consulting, LLC 	http://www.frostconsultingllc.com/
Phone: 650-780-7908	FAX: 650-649-1954

From ajs  Mon Jan 15 07:03:42 2007
From: ajs (Andrew Sullivan)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] SLONY-I disadvantages
In-Reply-To: <Pine.LNX.4.62.0701120743180.3241@mini.atlantida.localdomain>
References: <Pine.LNX.4.62.0701111908050.3241@mini.atlantida.localdomain>
	<45A73184.2060604@haisuli.net>
	<Pine.LNX.4.62.0701120743180.3241@mini.atlantida.localdomain>
Message-ID: <20070115150342.GD13011@phlogiston.dyndns.org>

On Fri, Jan 12, 2007 at 07:46:43AM -0500, Steve Singer wrote:
>     Actually, as of version 1.1.5 and later, this is NOT TRUE. The danger of
>     someone making DDL changes that crosses replication sets seems
>     sufficiently palpable that slon(1) has been changed to lock ALL
>     replicated tables,whether they are in the specified replication set or
>     not.

By the way, this has always struck me as a terrible hack.  What would
be better, I think, is for there to be some dependency information
about SETs, so that we had information on what can be properly called
logically-complete sets, and information on what can be called
partial sets (which are SETs for the purposes of Slony
administration).

It ought to be possible not to lock sets that are logically disjoint
from one another.  It isn't now, and the quick and dirty answer of
locking all sets is probably safer than what went before.  That
doesn't make it ideal.  I know you had a v1 proposal for how to make
this less painful.  I was thinking that what would be nice is an
additional way to give hints to the system so that an administrator
could group tables logically even if the database doesn't have
constraints that are already imposing such rules.

A

-- 
Andrew Sullivan  | ajs at crankycanuck.ca
A certain description of men are for getting out of debt, yet are
against all taxes for raising money to pay it off.
		--Alexander Hamilton

From mlists  Tue Jan 16 06:08:06 2007
From: mlists (Thomas Pundt)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] sl_log_1 not cleaning out
Message-ID: <200701161508.06270.mlists@rp-online.de>

Hi,

we seem to have a problem with our replication cluster - the sl_log_1
table doesn't get cleaned out. Can anybody give some advice on how to resolve
the issue?

Details:

Output from test-slony-state.pl:
DSN: dbi:Pg:dbname=RPONLINE;host=localhost;port=5481
===========================
Rummage for DSNs
=============================
Query:

   select p.pa_server, p.pa_conninfo
   from "_RPO".sl_path p
   where exists (select * from "_RPO".sl_subscribe s where
                          (s.sub_provider = p.pa_server or s.sub_receiver = 
p.pa_server) and
                          sub_active = 't')
   group by pa_server, pa_conninfo;


Tests for node 1 - DSN = dbname=RPONLINE host=10.1.16.1 port=5481 user=slony 
password=vs17gs
========================================
pg_listener info:
Pages: 513
Tuples: 38312

Size Tests
================================================
       sl_log_1    391410 13679500.000000
       sl_log_2         0  0.000000
      sl_seqlog     43234 5879820.000000

Listen Path Analysis
===================================================
No problems found with sl_listen

--------------------------------------------------------------------------------
Summary of event info
 Origin  Min SYNC  Max SYNC Min SYNC Age Max SYNC Age
================================================================================
      5    490546    637044     00:00:00 17 days 04:58:00    0
      1   1525251   2017755     00:00:00 17 days 04:58:00    0
      4    491105    637583     00:00:00 17 days 04:58:00    0
      3    736904    737115     00:00:00     00:35:00    0
      2    576284    721645     00:00:00 17 days 04:58:00    0


---------------------------------------------------------------------------------
Summary of sl_confirm aging
   Origin   Receiver   Min SYNC   Max SYNC  Age of latest SYNC  Age of eldest 
SYNC
=================================================================================
        1          2    2016597    2017756      00:00:00      00:33:00    0
        1          3    1525251    1525251  17 days 04:58:00  17 days 04:58:00    
1
        1          4    2016597    2017756      00:00:00      00:33:00    0
        1          5    2016535    2017756      00:00:00      00:35:00    0
        2          1     721456     721645      00:00:00      00:33:00    0
        2          3     576284     576284  17 days 04:58:00  17 days 04:58:00    
1
        2          4     721456     721645      00:00:00      00:33:00    0
        2          5     721447     721645      00:00:00      00:35:00    0
        3          1     736914     737115      00:00:00      00:33:00    0
        3          2     736913     737114      00:00:00      00:33:00    0
        3          4     736913     737114      00:00:00      00:33:00    0
        3          5     736904     737115      00:00:00      00:35:00    0
        4          1     637382     637583      00:00:00      00:33:00    0
        4          2     637382     637583      00:00:00      00:33:00    0
        4          3     491105     491105  17 days 04:59:00  17 days 04:59:00    
1
        4          5     637374     637583      00:00:00      00:35:00    0
        5          1     636844     637044      00:00:00      00:35:00    0
        5          2     636844     637044      00:00:00      00:35:00    0
        5          3     490546     490546  17 days 04:59:00  17 days 04:59:00    
1
        5          4     636844     637044      00:00:00      00:35:00    0


------------------------------------------------------------------------------

Listing of old open connections
       Database             PID            User    Query Age                
Query
================================================================================


Tests for node 4 - DSN = dbname=RPONLINE host=10.1.50.1 port=5481 user=slony
========================================
pg_listener info:
Pages: 513
Tuples: 38312

Size Tests
================================================
       sl_log_1    391410 13679500.000000
       sl_log_2         0  0.000000
      sl_seqlog     43234 5879820.000000

Listen Path Analysis
===================================================
No problems found with sl_listen

--------------------------------------------------------------------------------
Summary of event info
 Origin  Min SYNC  Max SYNC Min SYNC Age Max SYNC Age
================================================================================
      5    490546    637044     00:00:00 17 days 04:59:00    0
      1   1525251   2017756     00:00:00 17 days 04:58:00    0
      4    491105    637583     00:00:00 17 days 04:59:00    0
      3    736904    737115     00:00:00     00:35:00    0
      2    576284    721645     00:00:00 17 days 04:58:00    0


---------------------------------------------------------------------------------
Summary of sl_confirm aging
   Origin   Receiver   Min SYNC   Max SYNC  Age of latest SYNC  Age of eldest 
SYNC
=================================================================================
        1          2    2016597    2017758      00:00:00      00:33:00    0
        1          3    1525251    1525251  17 days 04:58:00  17 days 04:58:00    
1
        1          4    2016597    2017759      00:00:00      00:33:00    0
        1          5    2016535    2017759      00:00:00      00:35:00    0
        2          1     721456     721646      00:00:00      00:33:00    0
        2          3     576284     576284  17 days 04:58:00  17 days 04:58:00    
1
        2          4     721456     721646      00:00:00      00:33:00    0
        2          5     721447     721646      00:00:00      00:35:00    0
        3          1     736914     737116      00:00:00      00:33:00    0
        3          2     736913     737115      00:00:00      00:33:00    0
        3          4     736913     737115      00:00:00      00:33:00    0
        3          5     736904     737115      00:00:00      00:35:00    0
        4          1     637382     637584      00:00:00      00:33:00    0
        4          2     637382     637584      00:00:00      00:33:00    0
        4          3     491105     491105  17 days 04:59:00  17 days 04:59:00    
1
        4          5     637374     637584      00:00:00      00:35:00    0
        5          1     636844     637045      00:00:00      00:35:00    0
        5          2     636844     637045      00:00:00      00:35:00    0
        5          3     490546     490546  17 days 04:59:00  17 days 04:59:00    
1
        5          4     636844     637045      00:00:00      00:35:00    0


------------------------------------------------------------------------------

Listing of old open connections
       Database             PID            User    Query Age                
Query
================================================================================

[Output from other nodes omitted as they are identical]

Node: 1 sl_log_1 tuples = 1.36795e+07 > 200000
================================================
Number of tuples in Slony-I table sl_log_1 is 1.36795e+07 which
exceeds 200000.

You may wish to investigate whether or not a node is down, or perhaps
if sl_confirm entries have not been propagating properly.


Node: 1 sl_seqlog tuples = 5.87982e+06 > 200000
================================================
Number of tuples in Slony-I table sl_seqlog is 5.87982e+06 which
exceeds 200000.

You may wish to investigate whether or not a node is down, or perhaps
if sl_confirm entries have not been propagating properly.

[Output from other nodes omitted as they are identical]




More information (this is the replication master):
RPONLINE=# select count(1) from "_RPO".sl_confirm;
 count 
-------
  7059
(1 row)

RPONLINE=# select count(1) from "_RPO".sl_event;
 count  
--------
 931492
(1 row)

RPONLINE=# select * from "_RPO".sl_status;
-[ RECORD 1 ]-------------+---------------------------
st_origin                 | 1
st_received               | 2
st_last_event             | 2018097
st_last_event_ts          | 2007-01-16 14:54:44.99581
st_last_received          | 2018096
st_last_received_ts       | 2007-01-16 14:54:44.053113
st_last_received_event_ts | 2007-01-16 14:54:43.978249
st_lag_num_events         | 1
st_lag_time               | 00:00:01.245307
-[ RECORD 2 ]-------------+---------------------------
st_origin                 | 1
st_received               | 3
st_last_event             | 2018097
st_last_event_ts          | 2007-01-16 14:54:44.99581
st_last_received          | 1525251
st_last_received_ts       | 2006-12-30 09:46:15.781741
st_last_received_event_ts | 2006-12-30 09:46:15.774831
st_lag_num_events         | 492846
st_lag_time               | 17 days 05:08:29.448725
-[ RECORD 3 ]-------------+---------------------------
st_origin                 | 1
st_received               | 4
st_last_event             | 2018097
st_last_event_ts          | 2007-01-16 14:54:44.99581
st_last_received          | 2018095
st_last_received_ts       | 2007-01-16 14:54:41.435216
st_last_received_event_ts | 2007-01-16 14:54:40.964031
st_lag_num_events         | 2
st_lag_time               | 00:00:04.259525
-[ RECORD 4 ]-------------+---------------------------
st_origin                 | 1
st_received               | 5
st_last_event             | 2018097
st_last_event_ts          | 2007-01-16 14:54:44.99581
st_last_received          | 2018095
st_last_received_ts       | 2007-01-16 14:54:41.075192
st_last_received_event_ts | 2007-01-16 14:54:40.964031
st_lag_num_events         | 2
st_lag_time               | 00:00:04.259525


RPONLINE=# select * from  "_RPO".sl_event where ev_timestamp < '2007-01-01 
00:00:00' order by ev_timestamp limit 1;
-[ RECORD 1 ]+---------------------------
ev_origin    | 4
ev_seqno     | 491105
ev_timestamp | 2006-12-30 09:46:07.122286
ev_minxid    | 171751695
ev_maxxid    | 171751696
ev_xip       | 
ev_type      | SYNC
ev_data1     | 
ev_data2     | 
ev_data3     | 
ev_data4     | 
ev_data5     | 
ev_data6     | 
ev_data7     | 
ev_data8     | 


I've also checked that there are no old transactions hanging around. Any clue 

Ciao,
Thomas

-- 
Thomas Pundt <thomas.pundt at rp-online.de> ---- http://rp-online.de/ ----

From postgres  Tue Jan 16 06:59:20 2007
From: postgres (Niels Breet)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] sl_log_1 not cleaning out
In-Reply-To: <200701161508.06270.mlists@rp-online.de>
References: <200701161508.06270.mlists@rp-online.de>
Message-ID: <4917.85.147.201.170.1168959560.squirrel@breet.com>

On Tue, January 16, 2007 15:08, Thomas Pundt wrote:
> Hi,
>
>
> we seem to have a problem with our replication cluster - the sl_log_1
> table doesn't get cleaned out. Can anybody give some advice on how to
> resolve the issue?
>
[ SNIP ]
> RPONLINE=# select * from "_RPO".sl_status;
> ]-------------+---------------------------
> st_origin                 | 1
> st_received               | 3
> st_last_event | 2018097
> st_last_event_ts          | 2007-01-16 14:54:44.99581 st_last_received
> | 1525251
> st_last_received_ts       | 2006-12-30 09:46:15.781741
> st_last_received_event_ts | 2006-12-30 09:46:15.774831 st_lag_num_events
> | 492846
> st_lag_time               | 17 days 05:08:29.448725 -[ RECORD 3


A node with id = 3 lags 17 days behind the origin. While that node
is lagging, all events are kept in the log.

So you need to either let that node catch up or remove it from the
cluster. When that is completed, the log will be cleaned after about
20 minutes.

- Niels





From mlists  Tue Jan 16 07:16:47 2007
From: mlists (Thomas Pundt)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] sl_log_1 not cleaning out
In-Reply-To: <4917.85.147.201.170.1168959560.squirrel@breet.com>
References: <200701161508.06270.mlists@rp-online.de>
	<4917.85.147.201.170.1168959560.squirrel@breet.com>
Message-ID: <200701161616.47259.mlists@rp-online.de>

Hi Niels,

On Tuesday 16 January 2007 15:59, Niels Breet wrote:
| > RPONLINE=# select * from "_RPO".sl_status;
| > ]-------------+---------------------------
| > st_origin                 | 1
| > st_received               | 3
| > st_last_event | 2018097
| > st_last_event_ts          | 2007-01-16 14:54:44.99581 st_last_received
| >
| > | 1525251
| >
| > st_last_received_ts       | 2006-12-30 09:46:15.781741
| > st_last_received_event_ts | 2006-12-30 09:46:15.774831 st_lag_num_events
| >
| > | 492846
| >
| > st_lag_time               | 17 days 05:08:29.448725 -[ RECORD 3
|
| A node with id = 3 lags 17 days behind the origin. While that node
| is lagging, all events are kept in the log.
|
| So you need to either let that node catch up or remove it from the
| cluster. When that is completed, the log will be cleaned after about
| 20 minutes.

yes, that's clear; what I don't know is what I can do to let the node catch
up with the rest. I suspect that somehow maybe a confirmation event got lost.
Node 3 seems to be up to date itself:

This is the master (node 1):
[pg81 at pgmaster:~] echo 'select count(1) from "_RPO".sl_event;' | psql 
RPONLINE -p5481
 count  
--------
 935314
(1 row)

This is from node 3:
[pg81 at pgmaster:~] echo 'select count(1) from "_RPO".sl_event;' | psql 
RPONLINE -p5481 -hpgdb2
 count 
-------
  1050
(1 row)

What I'd like to know is: is there anything (except rebuilding node 3) I can
do to get rid of the old events?

Ciao,
Thomas

-- 
Thomas Pundt <thomas.pundt at rp-online.de> ---- http://rp-online.de/ ----

From cbbrowne  Tue Jan 16 07:41:14 2007
From: cbbrowne (Christopher Browne)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] sl_log_1 not cleaning out
In-Reply-To: <200701161616.47259.mlists@rp-online.de> (Thomas Pundt's message
	of "Tue, 16 Jan 2007 16:16:47 +0100")
References: <200701161508.06270.mlists@rp-online.de>
	<4917.85.147.201.170.1168959560.squirrel@breet.com>
	<200701161616.47259.mlists@rp-online.de>
Message-ID: <604pqrnfmt.fsf@dba2.int.libertyrms.com>

Thomas Pundt <mlists at rp-online.de> writes:
> | A node with id = 3 lags 17 days behind the origin. While that node
> | is lagging, all events are kept in the log.
> |
> | So you need to either let that node catch up or remove it from the
> | cluster. When that is completed, the log will be cleaned after about
> | 20 minutes.
>
> yes, that's clear; what I don't know is what I can do to let the node catch
> up with the rest. I suspect that somehow maybe a confirmation event got lost.
> Node 3 seems to be up to date itself:
>
> This is the master (node 1):
> [pg81 at pgmaster:~] echo 'select count(1) from "_RPO".sl_event;' | psql 
> RPONLINE -p5481
>  count  
> --------
>  935314
> (1 row)
>
> This is from node 3:
> [pg81 at pgmaster:~] echo 'select count(1) from "_RPO".sl_event;' | psql 
> RPONLINE -p5481 -hpgdb2
>  count 
> -------
>   1050
> (1 row)
>
> What I'd like to know is: is there anything (except rebuilding node 3) I can
> do to get rid of the old events?

It's not at all clear from this whether or not node 3 is behind or not.

On the origin node run the query:
   select * from "_RPO".sl_status;

If *that* reports node 3 as being way behind, then that's a pretty
good indication that node 3 is way behind.

One possibility come to mind:

We've got one environment where the network is a little bit flakey;
occasionally a node will cease to successfully pass back
confirmations.  It's replicating fine; it's just not reporting that it
is.

Restarting the slon processes cleared out old connections and brought
back sanity.

It's easy enough (and safe enough) to stop and restart slon processes;
you might try doing that and see if that clears some blockage of
confirmation events.

Otherwise, if node #3 is honest-to-goodness Way Behind, then the thing
to investigate is what's up with that.  That's causing sl_log_1 to
build up in size as a side-effect; don't worry about the size; that'll
fix itself after you fix what's broken about node #3.

Maybe you need to drop node 3 or unsubscribe its sets, and rebuild it;
that's not obvious at this point.  Check the logs for node 3 to see
what *is* up with it...
-- 
(reverse (concatenate 'string "ofni.sailifa.ac" "@" "enworbbc"))
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)

From mlists  Tue Jan 16 08:45:53 2007
From: mlists (Thomas Pundt)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] sl_log_1 not cleaning out
In-Reply-To: <604pqrnfmt.fsf@dba2.int.libertyrms.com>
References: <200701161508.06270.mlists@rp-online.de>
	<200701161616.47259.mlists@rp-online.de>
	<604pqrnfmt.fsf@dba2.int.libertyrms.com>
Message-ID: <200701161745.53309.mlists@rp-online.de>

Hi Christopher,

On Tuesday 16 January 2007 16:41, Christopher Browne wrote:
| Restarting the slon processes cleared out old connections and brought
| back sanity.

I've already done that on node #3 with no success; I've restarted the
slon processes on all nodes now, and that did indeed bring back node #3 on
level.

Thanks for pointing out.

Ciao,
Thomas

-- 
Thomas Pundt <thomas.pundt at rp-online.de> ---- http://rp-online.de/ ----

From ahodgson  Tue Jan 16 09:19:06 2007
From: ahodgson (Alan Hodgson)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] sl_log_1 not cleaning out
In-Reply-To: <604pqrnfmt.fsf@dba2.int.libertyrms.com>
References: <200701161508.06270.mlists@rp-online.de>
	<200701161616.47259.mlists@rp-online.de>
	<604pqrnfmt.fsf@dba2.int.libertyrms.com>
Message-ID: <200701160919.06229@hal.medialogik.com>

On Tuesday 16 January 2007 07:41, Christopher Browne 
<cbbrowne at ca.afilias.info> wrote:
> We've got one environment where the network is a little bit flakey;
> occasionally a node will cease to successfully pass back
> confirmations.  It's replicating fine; it's just not reporting that it
> is.
>
> Restarting the slon processes cleared out old connections and brought
> back sanity.

I've seen this, too.  Restarting all the slons always clears it up.


-- 
`"Gun-wielding recluse gunned down by local police" isn't the epitaph
I want. I am hoping for "Witnesses reported the sound up to two hundred
kilometers away" or "Last body part finally located".' --- James Nicoll


From ajs  Tue Jan 16 09:22:06 2007
From: ajs (Andrew Sullivan)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] sl_log_1 not cleaning out
In-Reply-To: <200701160919.06229@hal.medialogik.com>
References: <200701161508.06270.mlists@rp-online.de>
	<200701161616.47259.mlists@rp-online.de>
	<604pqrnfmt.fsf@dba2.int.libertyrms.com>
	<200701160919.06229@hal.medialogik.com>
Message-ID: <20070116172206.GA17186@phlogiston.dyndns.org>

On Tue, Jan 16, 2007 at 09:19:06AM -0800, Alan Hodgson wrote:
> > Restarting the slon processes cleared out old connections and brought
> > back sanity.
> 
> I've seen this, too.  Restarting all the slons always clears it up.

It'd be really nice if people could start gathering as much forensic
data on this issue as possible, since presumably it'd be nice not to
have to do that all the time.

A

-- 
Andrew Sullivan  | ajs at crankycanuck.ca
The whole tendency of modern prose is away from concreteness.
		--George Orwell

From ianburrell  Tue Jan 16 13:15:28 2007
From: ianburrell (Ian Burrell)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] SLONY-I disadvantages
In-Reply-To: <20070115150342.GD13011@phlogiston.dyndns.org>
References: <Pine.LNX.4.62.0701111908050.3241@mini.atlantida.localdomain>
	<45A73184.2060604@haisuli.net>
	<Pine.LNX.4.62.0701120743180.3241@mini.atlantida.localdomain>
	<20070115150342.GD13011@phlogiston.dyndns.org>
Message-ID: <d91f09cd0701161315v19098995od34d0d9de016292d@mail.gmail.com>

On 1/15/07, Andrew Sullivan <ajs at crankycanuck.ca> wrote:
> On Fri, Jan 12, 2007 at 07:46:43AM -0500, Steve Singer wrote:
> >     Actually, as of version 1.1.5 and later, this is NOT TRUE. The danger of
> >     someone making DDL changes that crosses replication sets seems
> >     sufficiently palpable that slon(1) has been changed to lock ALL
> >     replicated tables,whether they are in the specified replication set or
> >     not.
>
> By the way, this has always struck me as a terrible hack.  What would
> be better, I think, is for there to be some dependency information
> about SETs, so that we had information on what can be properly called
> logically-complete sets, and information on what can be called
> partial sets (which are SETs for the purposes of Slony
> administration).
>
> It ought to be possible not to lock sets that are logically disjoint
> from one another.  It isn't now, and the quick and dirty answer of
> locking all sets is probably safer than what went before.  That
> doesn't make it ideal.  I know you had a v1 proposal for how to make
> this less painful.  I was thinking that what would be nice is an
> additional way to give hints to the system so that an administrator
> could group tables logically even if the database doesn't have
> constraints that are already imposing such rules.
>

My impression is that the major problem is with foreign keys across
sets.  Lots of DDL does not like the re-parented triggers and need to
have them restored.  A half-working foreign key still causes problems
which requires locking all the tables in a connected group.

I wonder if this can be fixed in PostgreSQL 8.2.  That version allows
disabling and enabling triggers.  There may be problems with a foreign
key half-working with some triggers disabled and some enabled.  It
might be better to leave the triggers disabled on the subscribers.  I
also ran into some bugs with the trigger disabling not working in some
cases.

 - Ian

From mark  Wed Jan 17 07:58:09 2007
From: mark (Mark Stosberg)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] caching suggestions: pgmemcache or ??
Message-ID: <eolh34$hr7$1@sea.gmane.org>


I ran across 'pgmemcache' today:

http://people.freebsd.org/~seanc/pgmemcache/

It seems interesting and useful. I went looking for caching solutions
after I came across this article today on how MySpace has scaled:
http://www.baselinemag.com/print_article2/0,1217,a=198614,00.asp

They used a Slony-style replication early on, and then went through a
variety of other designs. The hindsight comment near the end caught my
attention:

"The addition of the cache servers [between the application and the
database] is something we should have done from the beginning".

Unfortunately, I found the pgmemcache docs lacking. I think I need
something like a flow chart with the application, the cache store and
the DB, showing how data gets in and out of the cache and is used by the
application.

Consider the 'memcache' instance gets a machine of its own, I'm also led
to wonder: Could it make sense to use pgmemcache on it's own for a
web-app, in place of slony+load-balancing, which seems more complex?

I like the idea that 'memcache' only caches what's "hot", and issues
with synchronization seem like they are less tenuous:  A broken cache
can always be fixed by deleting it and starting fresh. With slony, there
seems like a bigger penalty for that.

I don't meant to put down slony-- I'm using it now in testing and it's
working well enough for. I'm just curious about related options to
improve DB performance.

What caching solutions have worked well for you?

I'm using Perl's Cache::FileCache on the web-servers to save the results
of some frequent and complex queries.

   Mark


From ajs  Wed Jan 17 08:15:56 2007
From: ajs (Andrew Sullivan)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] caching suggestions: pgmemcache or ??
In-Reply-To: <eolh34$hr7$1@sea.gmane.org>
References: <eolh34$hr7$1@sea.gmane.org>
Message-ID: <20070117161555.GB20004@phlogiston.dyndns.org>

On Wed, Jan 17, 2007 at 10:58:09AM -0500, Mark Stosberg wrote:
> 
> Unfortunately, I found the pgmemcache docs lacking. I think I need
> something like a flow chart with the application, the cache store and
> the DB, showing how data gets in and out of the cache and is used by the
> application.

I think Elein (valena.com) has used this; perhaps you should talk to
her.  She might be able to help you out with this.

> Consider the 'memcache' instance gets a machine of its own, I'm also led
> to wonder: Could it make sense to use pgmemcache on it's own for a
> web-app, in place of slony+load-balancing, which seems more complex?

I think that they're solving different problems, really, since slony
is intended as much for insurance as for load reduction.  I have no
doubt that using memcache for some cases is going to be a better
answer than adding another database.

> with synchronization seem like they are less tenuous:  A broken cache
> can always be fixed by deleting it and starting fresh. With slony, there
> seems like a bigger penalty for that.

Yes, but slony also is designed for safety, so that breakage should
be harder to achieve.  (That is not historically true of all the
replications systems, BTW.)  Since its use cases are different than
pgmemcache, though, it's unlikely to be as fast as the single-purpose
tool.

A

-- 
Andrew Sullivan  | ajs at crankycanuck.ca
This work was visionary and imaginative, and goes to show that visionary
and imaginative work need not end up well. 
		--Dennis Ritchie

From storm  Wed Jan 17 12:27:28 2007
From: storm (Christian Storm)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] caching suggestions: pgmemcache or ??
In-Reply-To: <mailman.603.1169050564.6481.slony1-general@gborg.postgresql.org>
References: <mailman.603.1169050564.6481.slony1-general@gborg.postgresql.org>
Message-ID: <CA9ED7F4-387A-4806-B1FE-B1BC56392A9C@iparadigms.com>

Mark,

I would recommend reading the pgsql performance link I've included  
below.  You can see that I too was flirting with pgmemcache.  The two
issues that prevented me from using it were

1) The race condition that exists when the memcache and postgres data  
are out of sync and
2) The integrity of the data in the cache

The thought is that a new PG feature, an ON COMMIT trigger (there is  
some debate, at least in my mind, whether BEFORE and/or AFTER COMMIT  
would be useful), or ON PREPARED TRANSACTION, would solve both these  
problems given PG's MVCC model.  The race condition would be greatly  
diminished since PG and memcache would be updated nearly at the same  
time.  Also, if the transaction failed the cache wouldn't be updated.

Unfortunately, this doesn't exist, so to me pgmemcache has limited  
use unless you believe all your transactions will always succeed and  
you don't care about race conditions.

Hopefully that helps you in your decision.

http://groups-beta.google.com/group/pgsql.performance/browse_frm/ 
thread/f345107f382a7aee?tvc=1&q=pgmemcache&hl=en

Christian


From ajs  Wed Jan 17 13:06:26 2007
From: ajs (Andrew Sullivan)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] caching suggestions: pgmemcache or ??
In-Reply-To: <CA9ED7F4-387A-4806-B1FE-B1BC56392A9C@iparadigms.com>
References: <mailman.603.1169050564.6481.slony1-general@gborg.postgresql.org>
	<CA9ED7F4-387A-4806-B1FE-B1BC56392A9C@iparadigms.com>
Message-ID: <20070117210626.GA20682@phlogiston.dyndns.org>

On Wed, Jan 17, 2007 at 12:27:28PM -0800, Christian Storm wrote:
> Unfortunately, this doesn't exist, so to me pgmemcache has limited  
> use unless you believe all your transactions will always succeed and  
> you don't care about race conditions.

Or the race condition can be caught and acted on later.  One way that
you can solve these sorts of problems is to use cached data (subject
to race conditions &c.) for initial decision, but then your final
state still requires the write in some "real" database.  It's
trickier to do things that way, and you don't get nearly the
performance boost you might like, but it is a possible arrangement
for some applications.

The key thing is to do careful analysis of your business
requirements.  Sometimes the boost in performance is worth living
with cleanup from race conditions later, if you can do it.  This
partly depends on the cost of that cleanup.  This sort of analysis is
what's responsible for back-ordered shipments of the "one in stock"
item that you ordered on line, for example.  If it was in stock, how
come it's back ordered now?  Maybe a race condition, or else a
mistake in the inventory system, or something like that.  If the item
is of low enough importance and the back order solved fast enough,
maybe it doesn't matter enough to be work the 100% availability.  It
is often hard to convince business types of this analysis, so you
have to do a lot of homework.  But making the trade of race condition
for speed is in fact sometimes worth it anyway.

A

-- 
Andrew Sullivan  | ajs at crankycanuck.ca
In the future this spectacle of the middle classes shocking the avant-
garde will probably become the textbook definition of Postmodernism. 
                --Brad Holland

From zagato.gekko  Wed Jan 17 17:23:59 2007
From: zagato.gekko (Alan Acosta)
Date: Tue Feb 13 08:24:22 2007
Subject: [Slony1-general] SLONY-I disadvantages
In-Reply-To: <d91f09cd0701161315v19098995od34d0d9de016292d@mail.gmail.com>
References: <Pine.LNX.4.62.0701111908050.3241@mini.atlantida.localdomain>
	<45A73184.2060604@haisuli.net>
	<Pine.LNX.4.62.0701120743180.3241@mini.atlantida.localdomain>
	<20070115150342.GD13011@phlogiston.dyndns.org>
	<d91f09cd0701161315v19098995od34d0d9de016292d@mail.gmail.com>
Message-ID: <98028b00701171723n27802a3fj4ac593eed7cd59cb@mail.gmail.com>

Hello, I'm new in Slony, I'm now running the database for the web
application with one successful Slony Salve.
I'm trying to read and understand the messages that are coming from the
list, i want to say that you know a lot of :D :D :D.
I want to compare Slony against PGCluster because i don't found differences
between PGPoll+Slony Vs PGCluster, except may be the random values that i
don't understand fully (Can give me an example please :-P)....

If i have
Function Load Balancing Since PGCluster is the synchronous replication of a
multi-master, it can acquire the same value even if it refers to different
Cluster DB. It is very suitable for load balancing for reference system.  When
the load of an updating process is high, you may use partial replication
feature to decentralize the load.  Problem Handling Cluster server can be
set up three or more machines. When a problem occurs in Cluster DB, loader
balancer and a replication server will be separated from that machine, and
continues service using the other Cluster DBs.  Several replication server
can be set up. When an problem occurs at the replication server, Cluster DB
automatically changes connection to the standing-by replication server.  When
all replication servers stop, Cluster DB operates in stand-alone mode. There
are two modes for stand-alone mode: read only mode which only permits
references, and read write mode, which permits updating.  Several loader
balancer can be set up, however, they will not have the problem detection
and switching over functions that the loader balancer itself has.
Recovery When
the Cluster DBs were started with a recovery option, it will come back to a
replication system after taking the synchronization to master DB's data. If
there are three or more Cluster DBs, a query can be processed without
stopping service during recovery.  Replication Query-based The replication
is done in query-based method.  COPY Since data read from the COPY (FROM)
command are also replicated, the backup files which were created by pg_dump
can also be replicated.  NOW( ) When inserting the present time data with a
NOW function (ex. the NOW function is contained in the query, or the default
value of a table is being set to 'NOW'), that values will also be
replicated. The time will be the time of a replication server.  NEXTVAL( ),
SETVAL( ) The sequence operation function (nextval, setval) will be
replicated.  Serial type Since the order of INSERT processing is controlled
to become the same in each Cluster DB, serial type data is synchronized as
well.  Stored procedure The stored procedure accompanied by data update is
replicated.  Large Object The data of large object is replicated.  OID The
OID is replicated only the large object.in PGCluster 1.3 (
http://pgcluster.projects.postgresql.org/1_3/index.html).

So, why i need to use Slony,or better, when i want to use it ? and Are the
random values the most important issue ?, Nobody know why PGCluster doesn't
replicate correctly ?

Apologize for my ugly English :-p

Farewell.
Alan Acosta
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://gborg.postgresql.org/pipermail/slony1-general/attachments/20070117/90522bbc/attachment.html 

From mark  Thu Jan 18 10:19:42 2007
From: mark (Mark Stosberg)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] caching suggestions: pgmemcache or ??
In-Reply-To: <CA9ED7F4-387A-4806-B1FE-B1BC56392A9C@iparadigms.com>
References: <mailman.603.1169050564.6481.slony1-general@gborg.postgresql.org>
	<CA9ED7F4-387A-4806-B1FE-B1BC56392A9C@iparadigms.com>
Message-ID: <eoodoi$ceu$1@sea.gmane.org>

Christian Storm wrote:
> Mark,
> 
> I would recommend reading the pgsql performance link I've included  
> below.  You can see that I too was flirting with pgmemcache.  The two
> issues that prevented me from using it were
> 
> 1) The race condition that exists when the memcache and postgres data  
> are out of sync and
> 2) The integrity of the data in the cache
> 
> The thought is that a new PG feature, an ON COMMIT trigger (there is  
> some debate, at least in my mind, whether BEFORE and/or AFTER COMMIT  
> would be useful), or ON PREPARED TRANSACTION, would solve both these  
> problems given PG's MVCC model.  The race condition would be greatly  
> diminished since PG and memcache would be updated nearly at the same  
> time.  Also, if the transaction failed the cache wouldn't be updated.
> 
> Unfortunately, this doesn't exist, so to me pgmemcache has limited  
> use unless you believe all your transactions will always succeed and  
> you don't care about race conditions.
> 
> Hopefully that helps you in your decision.
> 
> http://groups-beta.google.com/group/pgsql.performance/browse_frm/ 
> thread/f345107f382a7aee?tvc=1&q=pgmemcache&hl=en

Thanks for the response Christian. The site in question is busy enough
that we have seen failures in the past related to race conditions, and
we do have rare transaction failures.

I think this enough to scare me away from pgmemcache for now.

In other news, I'm having initial luck testing Perl's DBD::Multi (for
load balancing) along with Slony.

I've created a second "read only" handle for load balancing, and I'm
starting to go through the application to change some SELECTs to use the
read-only handle, which may then hit just the slave, or the slave and
master, depending on the setup.

I still need to more benchmarks and real-world testing to verify the
approach works suitably.

    Mark


From mark  Thu Jan 18 10:44:56 2007
From: mark (Mark Stosberg)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] PATCH: document that slonik_execute_script is an
 easy way to make DLL changes
Message-ID: <eoof7s$j3a$1@sea.gmane.org>


The attach patch updates addthings.html to mention
slonik_execute_script, which I find significantly easier to use than raw
slonik commands.

The SGML may need to be cleaned up a bit-- I don't have a working SGML
toolchain here.

   Mark
-------------- next part --------------
A non-text attachment was scrubbed...
Name: addthings.patch
Type: text/x-patch
Size: 838 bytes
Desc: not available
Url : http://gborg.postgresql.org/pipermail/slony1-general/attachments/20070118/c353588e/attachment.bin 

From mark  Thu Jan 18 11:33:36 2007
From: mark (Mark Stosberg)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] PATCH: improved support for "slonik_execute_script
	-c"
Message-ID: <eooi35$u80$1@sea.gmane.org>

slonik_execute_script has a "-c" option to give a single command to run
on the command line, which is convenient.

I ran something like this:

slonik_execute_script -c 'ALTER TABLE a RENAME to b' set3 | slonik

This silently failed. Slonik accepted the command, but nothing happened.
The reason is there is no trailing semicolon, so slonik interpreted this
as "0 commands".

I addressed this in the script by adding a trailing semicolon if there
is not one given with the "-c" option.

However, I think "slonik" should also be updated to at least provide a
warning if it receives "0 commands" to process.

   Mark
-------------- next part --------------
A non-text attachment was scrubbed...
Name: execute_script.patch
Type: text/x-patch
Size: 388 bytes
Desc: not available
Url : http://gborg.postgresql.org/pipermail/slony1-general/attachments/20070118/14f52a2f/attachment-0001.bin 

From storm  Thu Jan 18 18:20:48 2007
From: storm (Christian Storm)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] slony replication lag and pgpool
Message-ID: <460A829A-98EC-4C2A-8C28-221799EB35AA@iparadigms.com>

I was wondering if anyone had submitted a patch to pgpool to make  
certain SELECT queries 'sticky' to the master when operating in load  
balancing mode, i.e., working
in concert with Slony?

In our current setup, our application keeps track of each user's  
session.  To overcome the data inconsistency issue, it will 'stick'  
SELECT queries generated by a user
to the master for a certain amount of time after an updating  
statement is made allowing Slony to do its thing.  We'd love to black  
box this by pushing this logic down further into a PG proxy
so that all our applications (PERL, C++, etc.) don't have to fool  
with it.

This way of dealing with replication lag is non-ideal for a number of  
reasons but it works > 99.999% of the time for our application and I  
would suspect for many others.  Problems can emerge from longer than  
expected replication lags, e.g., caused by large UPDATEs or DELETEs,  
or when data is being shared between users and can show up as  
inconsistent during the replication lag time, e.g., only the user  
making updates is stuck to the master while the other user is not.


I wanted to bounce this solution off the list....

Right now, if I understand it right, pgpool will 'stick' SELECT  
statements to the master if they are in a transaction block.   
Otherwise, they go
to the slave.  As I'm sure you know, this can cause problems when  
SELECT queries are run against the slave and the data hasn't arrived yet
due to the replication lag.

Could pgpool (I or II) be modified to except a token with each  
query.  In my case, this would be a session id or userid.  When  
pgpool gets an updating statement it would
store the token and timestamp in the cache.  If any SELECTs come in  
during the 'sticky' window (now - timestamp < sticky time window)  
that are sent to the master.  To deal
with unknown replication delays, this could possibly be improved by  
having pgpool be Slony aware.  In other words, pgpool would know  
which transactions have been
replicated and which ones haven't been.  So, for instance, if a  
particular transaction for user x was taking a long time any SELECTs  
tagged as coming from that same user
would be sent to the master.  Or, perhaps more simply, pgpool could  
be aware of Slony's current replication lag (sl_status or a direct  
connection to Slony perhaps?) and
factor that into the 'sticky' time window calculation.

Is there any reason anyone can think of why this wouldn't work or be  
a good idea?  Has anyone else faced and dealt with this issue in  
another way?

Christian


From bnichols  Fri Jan 19 05:55:46 2007
From: bnichols (Brad Nicholson)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] slony replication lag and pgpool
In-Reply-To: <460A829A-98EC-4C2A-8C28-221799EB35AA@iparadigms.com>
References: <460A829A-98EC-4C2A-8C28-221799EB35AA@iparadigms.com>
Message-ID: <1169214946.10175.68.camel@dba5.int.libertyrms.com>

You should raise your questions with the folks on the pgpool list.
Slony people probably aren't the right audience to discuss pgpool mods
with.  A couple quick points though - 


On Thu, 2007-01-18 at 18:20 -0800, Christian Storm wrote:
> Right now, if I understand it right, pgpool will 'stick' SELECT  
> statements to the master if they are in a transaction block.   

Correct.

> Otherwise, they go
> to the slave.  As I'm sure you know, this can cause problems when  
> SELECT queries are run against the slave and the data hasn't arrived yet
> due to the replication lag.

That problem doesn't exist if you put your queries inside a transaction.
They will never go to a subscriber.  

-- 
Brad Nicholson  416-673-4106
Database Administrator, Afilias Canada Corp.


From jamiel  Fri Jan 19 06:15:05 2007
From: jamiel (Jeff Amiel)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] subscriber box drive failure....recovery
Message-ID: <45B0D269.8070601@istreamimaging.com>

Yesterday the RAID failed in one of my subscriber nodes for my 
production database.  I am in the process of restoring a pg_dumpall to 
the box but am uncertain what to do about Slony.

The backup was made at 3:00am or so...but the raid failure didn't occur 
until about 8:30am.  I am assuming that once my restore is complete and 
I fire slony back up, that it won't have the trigger events to 
re-populate the missing items in the database (how could it?).  
Certainly its not possible that slony will  analyze the tables for 
differences and generate new events, correct? 

How should I get this subscriber back in sync?  Should I drop nuke all 
the data in the subscriber, drop the node and recreate and let it start 
from scratch?





From bnichols  Fri Jan 19 06:23:44 2007
From: bnichols (Brad Nicholson)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] subscriber box drive failure....recovery
In-Reply-To: <45B0D269.8070601@istreamimaging.com>
References: <45B0D269.8070601@istreamimaging.com>
Message-ID: <1169216624.29862.5.camel@dba5.int.libertyrms.com>

On Fri, 2007-01-19 at 08:15 -0600, Jeff Amiel wrote:
> Yesterday the RAID failed in one of my subscriber nodes for my 
> production database.  I am in the process of restoring a pg_dumpall to 
> the box but am uncertain what to do about Slony.
> 
> The backup was made at 3:00am or so...but the raid failure didn't occur 
> until about 8:30am.  I am assuming that once my restore is complete and 
> I fire slony back up, that it won't have the trigger events to 
> re-populate the missing items in the database (how could it?).  
> Certainly its not possible that slony will  analyze the tables for 
> differences and generate new events, correct? 
> 
> How should I get this subscriber back in sync?  Should I drop nuke all 
> the data in the subscriber, drop the node and recreate and let it start 
> from scratch?

You don't have much of a choice here.  When you add a node to
replication, slony deletes (or truncates) all the data in the target
tables and repopulates them from scratch.

What you want to do is:

-Forget about restoring the data on the subscriber (unless it contains
stuff that isn't replicated that you need).
-extract the schema only (no data) from the master database.
-restore that on the subscriber
-add the node back to replication and subscribe it.

-- 
Brad Nicholson  416-673-4106
Database Administrator, Afilias Canada Corp.


From Sascha.Spreitzer  Fri Jan 19 06:27:45 2007
From: Sascha.Spreitzer (Sascha.Spreitzer at izb.de)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] subscriber box drive failure....recovery
Message-ID: <914FC41646BED511A1E40002A587EA360AD586EB@M0000S0F>


Hello,

Drop the _<clustername> schema. (drop schema _<clustername>;)
If needed create the plpgsql language. (createlang plpgsql <masterdbname>)
Start the master node and initialize the slaves with the DB structure
(pg_dump -s masterdb|psqgl -h slavehost slavedb).
Start slon daemons.
Initialize slon daemons with slonik config via the masterhost.
Subscribe nodes for replication..

This should be the steps for a successfull rebuild.

With regards,
Sascha Spreitzer


-----Urspr?ngliche Nachricht-----
Von: slony1-general-bounces at gborg.postgresql.org
[mailto:slony1-general-bounces at gborg.postgresql.org] Im Auftrag von Jeff
Amiel
Gesendet: Freitag, 19. Januar 2007 15:15
An: slony1-general at gborg.postgresql.org
Betreff: [Slony1-general] subscriber box drive failure....recovery


Yesterday the RAID failed in one of my subscriber nodes for my 
production database.  I am in the process of restoring a pg_dumpall to 
the box but am uncertain what to do about Slony.

The backup was made at 3:00am or so...but the raid failure didn't occur 
until about 8:30am.  I am assuming that once my restore is complete and 
I fire slony back up, that it won't have the trigger events to 
re-populate the missing items in the database (how could it?).  
Certainly its not possible that slony will  analyze the tables for 
differences and generate new events, correct? 

How should I get this subscriber back in sync?  Should I drop nuke all 
the data in the subscriber, drop the node and recreate and let it start 
from scratch?




_______________________________________________
Slony1-general mailing list
Slony1-general at gborg.postgresql.org
http://gborg.postgresql.org/mailman/listinfo/slony1-general



Mit freundlichen Gr??en,
Sascha Spreitzer

Azubi - Fachinformatiker in Richtung Systemintegration
Tel:	089-94511-8123
Fax:	089-94511-1-8123
Mobil:	0172-4649076
sascha.spreitzer at izb.de


IZB Informatikzentrum
M?nchen - Frankfurt am Main GmbH & Co.KG
Einsteinring 17
85609 Aschheim
www.izb.net

Ein Unternehmen der Sparkassen Finanzgruppe.

---------------------------------------------------------------
Diese E-Mail enth?lt vertrauliche und/oder rechtlich gesch?tzte
Informationen. Wenn Sie nicht der richtige Adressat sind oder diese E-Mail
irrt?mlich erhalten haben, informieren Sie bitte sofort den Absender und
vernichten Sie diese Mail. Das unerlaubte Kopieren sowie die unbefugte
Weitergabe dieser Mail ist nicht gestattet.
---------------------------------------------------------------
This e-mail may contain confidential and/or privileged information. If you
are not the intended recipient (or have received this e-mail in error)
please notify the sender immediately and destroy this e-mail.
Any unauthorized copying, disclosure or distribution of the material in
this e-mail is strictly forbidden.
---------------------------------------------------------------
IZB Informatik-Zentrum M?nchen-Frankfurt



-------------- next part --------------
A non-text attachment was scrubbed...
Name: Spreitzer, Sascha.vcf
Type: application/octet-stream
Size: 366 bytes
Desc: not available
Url : http://gborg.postgresql.org/pipermail/slony1-general/attachments/20070119/45c11120/attachment.obj 

From bnichols  Fri Jan 19 06:39:31 2007
From: bnichols (Brad Nicholson)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] subscriber box drive failure....recovery
In-Reply-To: <914FC41646BED511A1E40002A587EA360AD586EB@M0000S0F>
References: <914FC41646BED511A1E40002A587EA360AD586EB@M0000S0F>
Message-ID: <1169217571.29862.7.camel@dba5.int.libertyrms.com>

On Fri, 2007-01-19 at 15:27 +0100, Sascha.Spreitzer at izb.de wrote:
> Hello,
> 
> Drop the _<clustername> schema. (drop schema _<clustername>;)

This is the incorrect way to do it.  This can leave your schema in an
inconsistent state.  There is a script to do this with (the name escapes
me right now)

-- 
Brad Nicholson  416-673-4106
Database Administrator, Afilias Canada Corp.


From bnichols  Fri Jan 19 07:37:35 2007
From: bnichols (Brad Nicholson)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] subscriber box drive failure....recovery
In-Reply-To: <914FC41646BED511A1E40002A587EA360AD586EC@M0000S0F>
References: <914FC41646BED511A1E40002A587EA360AD586EC@M0000S0F>
Message-ID: <1169221055.29862.16.camel@dba5.int.libertyrms.com>

On Fri, 2007-01-19 at 16:11 +0100, Sascha.Spreitzer at izb.de wrote:
> Can you explain why?
> How can a schema be left in an incorrect way if its being deleted?

Please reply to the list on all correspondence.

Slony does some ugly hacks to the subscribers (like re-points triggers
to indexes to disable them).  Dropping the schema like you've suggested
does not undo these changes.

Brad.


> -----Urspr?ngliche Nachricht-----
> Von: slony1-general-bounces at gborg.postgresql.org
> [mailto:slony1-general-bounces at gborg.postgresql.org] Im Auftrag von Brad
> Nicholson
> Gesendet: Freitag, 19. Januar 2007 15:40
> An: Sascha.Spreitzer at izb.de
> Cc: slony1-general at gborg.postgresql.org
> Betreff: Re: [Slony1-general] subscriber box drive failure....recovery
> 
> 
> On Fri, 2007-01-19 at 15:27 +0100, Sascha.Spreitzer at izb.de wrote:
> > Hello,
> > 
> > Drop the _<clustername> schema. (drop schema _<clustername>;)
> 
> This is the incorrect way to do it.  This can leave your schema in an
> inconsistent state.  There is a script to do this with (the name escapes
> me right now)
> 
-- 
Brad Nicholson  416-673-4106
Database Administrator, Afilias Canada Corp.


From jamiel  Fri Jan 19 09:22:05 2007
From: jamiel (Jeff Amiel)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] subscriber box drive failure....recovery
In-Reply-To: <1169216624.29862.5.camel@dba5.int.libertyrms.com>
References: <45B0D269.8070601@istreamimaging.com>
	<1169216624.29862.5.camel@dba5.int.libertyrms.com>
Message-ID: <45B0FE3D.4020700@istreamimaging.com>

Brad Nicholson wrote:
> What you want to do is:
>
> -Forget about restoring the data on the subscriber (unless it contains
> stuff that isn't replicated that you need).
> -extract the schema only (no data) from the master database.
> -restore that on the subscriber
> -add the node back to replication and subscribe it.
>
>   

ok...I did so...fairly painless so far.
now getting interesting warnings (no replication appears to be 
occurring) on the new node

WARN   remoteWorkerThread_1: transactions earlier than XID 2148952995 
are still in progress
WARN   remoteWorkerThread_1: data copy for set 1 failed - sleep 15 seconds
WARN   remoteWorkerThread_1: transactions earlier than XID 2148952995 
are still in progress
WARN   remoteWorkerThread_1: data copy for set 1 failed - sleep 30 seconds
WARN   remoteWorkerThread_1: transactions earlier than XID 2148952995 
are still in progress
WARN   remoteWorkerThread_1: data copy for set 1 failed - sleep 60 seconds

Any thoughts?

From jamiel  Fri Jan 19 09:27:23 2007
From: jamiel (Jeff Amiel)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] subscriber box drive failure....recovery
In-Reply-To: <45B0FE3D.4020700@istreamimaging.com>
References: <45B0D269.8070601@istreamimaging.com>	<1169216624.29862.5.camel@dba5.int.libertyrms.com>
	<45B0FE3D.4020700@istreamimaging.com>
Message-ID: <45B0FF7B.3060009@istreamimaging.com>



Jeff Amiel wrote:
> ok...I did so...fairly painless so far.
> now getting interesting warnings (no replication appears to be 
> occurring) on the new node
>
> WARN   remoteWorkerThread_1: transactions earlier than XID 2148952995 
> are still in progress
> WARN   remoteWorkerThread_1: data copy for set 1 failed - sleep 15 seconds
> WARN   remoteWorkerThread_1: transactions earlier than XID 2148952995 
> are still in progress
> WARN   remoteWorkerThread_1: data copy for set 1 failed - sleep 30 seconds
> WARN   remoteWorkerThread_1: transactions earlier than XID 2148952995 
> are still in progress
> WARN   remoteWorkerThread_1: data copy for set 1 failed - sleep 60 seconds
>
> Any thoughts?
>
>   
I did a query on pg_locks...no longstanding transactions at all (they 
are all turning over quickly)....ideas?


From ahodgson  Fri Jan 19 09:30:49 2007
From: ahodgson (Alan Hodgson)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] subscriber box drive failure....recovery
In-Reply-To: <45B0FE3D.4020700@istreamimaging.com>
References: <45B0D269.8070601@istreamimaging.com>
	<1169216624.29862.5.camel@dba5.int.libertyrms.com>
	<45B0FE3D.4020700@istreamimaging.com>
Message-ID: <200701190930.49683@hal.simkin.ca>

On Friday 19 January 2007 09:22, Jeff Amiel <jamiel at istreamimaging.com> 
wrote:
> ok...I did so...fairly painless so far.
> now getting interesting warnings (no replication appears to be
> occurring) on the new node
>
> WARN   remoteWorkerThread_1: transactions earlier than XID 2148952995
> are still in progress
> WARN   remoteWorkerThread_1: data copy for set 1 failed - sleep 15
> seconds WARN   remoteWorkerThread_1: transactions earlier than XID
> 2148952995 are still in progress
> WARN   remoteWorkerThread_1: data copy for set 1 failed - sleep 30
> seconds WARN   remoteWorkerThread_1: transactions earlier than XID
> 2148952995 are still in progress
> WARN   remoteWorkerThread_1: data copy for set 1 failed - sleep 60
> seconds
>
> Any thoughts?

This is normal.  There are open transactions on your master cluster that 
existed before the subscribe started.  Once they finish, the 
subscription process will get going.

-- 
Politicians fear only one thing: peasants with guns


From storm  Fri Jan 19 14:00:00 2007
From: storm (Christian Storm)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] slony replication lag and pgpool
In-Reply-To: <1169214946.10175.68.camel@dba5.int.libertyrms.com>
References: <460A829A-98EC-4C2A-8C28-221799EB35AA@iparadigms.com>
	<1169214946.10175.68.camel@dba5.int.libertyrms.com>
Message-ID: <BCF254E0-8F72-4201-9CA5-C48B2DD6BC58@iparadigms.com>


On Jan 19, 2007, at 5:55 AM, Brad Nicholson wrote:

> You should raise your questions with the folks on the pgpool list.
> Slony people probably aren't the right audience to discuss pgpool mods
> with.  A couple quick points though -

Agreed.  I threw it against this list just in case someone had some  
non-pgpool insite into
this issue.

My apologies for contributing a little bit of noise on the list.

>> Otherwise, they go
>> to the slave.  As I'm sure you know, this can cause problems when
>> SELECT queries are run against the slave and the data hasn't  
>> arrived yet
>> due to the replication lag.
>
> That problem doesn't exist if you put your queries inside a  
> transaction.
> They will never go to a subscriber.

This is true but once you commit they will instantly start going to  
the subscriber.  That is the problem.
Bundling the queries into one transaction isn't an option.  The  
typical scenario for web apps where this
is a problem is when form data is inserted into the database within a  
transaction and then a user is redirected
to another page which queries the database looking for that new  
data.  This is where the replication lag
will bite you.

From gdh  Mon Jan 22 04:01:18 2007
From: gdh (Gavin Hamill)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] Slony 1.1.5 on postgres 8.2.1
Message-ID: <20070122120118.1645c674.gdh@laterooms.com>

Is this possible with a trivial patch? I'm not yet ready to upgrade all
nodes to Slony 1.2...

The 1.1.5 compile fails at:

gcc -g -O2 -pthread -I../.. -I/usr/include/postgresql/ -o slon slon.o
runtime_config.o local_listen.o remote_listen.o remote_worker.o
sync_thread.o cleanup_thread.o scheduler.o dbutils.o conf-file.o
confoptions.o misc.o -pthread -L/usr/lib/
-L/usr/lib/postgresql/8.2/lib/ -lpq -Wl,-rpath,/usr/lib/  -L/usr/lib/
-lpq
confoptions.o: In function `build_conf_variables': 
/root/slony1-1.1.5/src/slon/confoptions.c:115:
undefined reference to `pg_qsort' 
collect2: ld returned 1 exit status

Cheers,
Gavin.

From mailings  Mon Jan 22 04:34:50 2007
From: mailings (Bernd Helmle)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] PATCH: improved support for
 "slonik_execute_script	-c"
In-Reply-To: <eooi35$u80$1@sea.gmane.org>
References: <eooi35$u80$1@sea.gmane.org>
Message-ID: <0E5B847CAC1DED6584950C48@imhotep.credativ.de>

--On Donnerstag, Januar 18, 2007 14:33:36 -0500 Mark Stosberg 
<mark at summersault.com> wrote:

> slonik_execute_script has a "-c" option to give a single command to run
> on the command line, which is convenient.
>
> I ran something like this:
>
> slonik_execute_script -c 'ALTER TABLE a RENAME to b' set3 | slonik
>
> This silently failed. Slonik accepted the command, but nothing happened.

Hmm, i see the following:

[bernd slony] (1) HEAD $ slonik_execute_script --config 
~/pgsql-dev/configs/slony/slon_tools.conf -c 'ALTER TABLE tapes DROP COLUMN 
idf2' set1 | slonik
DDL script consisting of 0 SQL statements
Submit DDL Event to subscribers...

So slonik tells you indeed that something went wrong...

> The reason is there is no trailing semicolon, so slonik interpreted this
> as "0 commands".
>
> I addressed this in the script by adding a trailing semicolon if there
> is not one given with the "-c" option.
>

I don't like this idea, because it mask's a fundamental problem in slonik, 
i think. A better option
would be at least to check if the last command in the given SQL string is 
terminated and if not, to error out. But as already said, i think this is 
the wrong place...

> However, I think "slonik" should also be updated to at least provide a
> warning if it receives "0 commands" to process.
>

The problem is scan_for_statements() in src/parsestatements/scanner.c, 
which scans for multiple query strings in a given command string. These 
needs to be terminated by ';', otherwise the last query string doesn't get 
counted and is going to be ignored.

What we can do here in slonik is to check wether we have any remaining 
bytes left in the current query string and to issue them as the final 
query.  I propose the attached fix to scanner.c, but i admit that it needs 
a deeper thinking maybe. Comments?

Bernd


-- 
  Thanks

                    Bernd
-------------- next part --------------
A non-text attachment was scrubbed...
Name: scanner.c.patch
Type: text/x-diff
Size: 705 bytes
Desc: not available
Url : http://gborg.postgresql.org/pipermail/slony1-general/attachments/20070122/371c1ea7/attachment.bin 

From zagato.gekko  Mon Jan 22 06:16:45 2007
From: zagato.gekko (Alan Acosta)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] Fwd:  SLONY-I disadvantages
In-Reply-To: <98028b00701171723n27802a3fj4ac593eed7cd59cb@mail.gmail.com>
References: <Pine.LNX.4.62.0701111908050.3241@mini.atlantida.localdomain>
	<45A73184.2060604@haisuli.net>
	<Pine.LNX.4.62.0701120743180.3241@mini.atlantida.localdomain>
	<20070115150342.GD13011@phlogiston.dyndns.org>
	<d91f09cd0701161315v19098995od34d0d9de016292d@mail.gmail.com>
	<98028b00701171723n27802a3fj4ac593eed7cd59cb@mail.gmail.com>
Message-ID: <98028b00701220616u59cce781hc936c5bdf5bdc409@mail.gmail.com>

Hello, I'm new in Slony, I'm now running the database for the web
application with one successful Slony Salve.
I'm trying to read and understand the messages that are coming from the
list, i want to say that you know a lot of :D :D :D.
I want to compare Slony against PGCluster because i don't found differences
between PGPoll+Slony Vs PGCluster, except may be the random values that i
don't understand fully (Can give me an example please :-P)....

If i have
Function Load Balancing Since PGCluster is the synchronous replication of a
multi-master, it can acquire the same value even if it refers to different
Cluster DB. It is very suitable for load balancing for reference system.  When
the load of an updating process is high, you may use partial replication
feature to decentralize the load.  Problem Handling Cluster server can be
set up three or more machines. When a problem occurs in Cluster DB, loader
balancer and a replication server will be separated from that machine, and
continues service using the other Cluster DBs.  Several replication server
can be set up. When an problem occurs at the replication server, Cluster DB
automatically changes connection to the standing-by replication server.  When
all replication servers stop, Cluster DB operates in stand-alone mode. There
are two modes for stand-alone mode: read only mode which only permits
references, and read write mode, which permits updating.  Several loader
balancer can be set up, however, they will not have the problem detection
and switching over functions that the loader balancer itself has.
Recovery When
the Cluster DBs were started with a recovery option, it will come back to a
replication system after taking the synchronization to master DB's data. If
there are three or more Cluster DBs, a query can be processed without
stopping service during recovery.  Replication Query-based The replication
is done in query-based method.  COPY Since data read from the COPY (FROM)
command are also replicated, the backup files which were created by pg_dump
can also be replicated.  NOW( ) When inserting the present time data with a
NOW function (ex. the NOW function is contained in the query, or the default
value of a table is being set to 'NOW'), that values will also be
replicated. The time will be the time of a replication server.  NEXTVAL( ),
SETVAL( ) The sequence operation function (nextval, setval) will be
replicated.  Serial type Since the order of INSERT processing is controlled
to become the same in each Cluster DB, serial type data is synchronized as
well.  Stored procedure The stored procedure accompanied by data update is
replicated.  Large Object The data of large object is replicated.  OID The
OID is replicated only the large object.in PGCluster 1.3
(http://pgcluster.projects.postgresql.org/1_3/index.html
).

So, why i need to use Slony,or better, when i want to use it ? and Are the
random values the most important issue ?, Nobody know why PGCluster doesn't
replicate correctly ?

Apologize for my ugly English :-p

Farewell.
Alan Acosta
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://gborg.postgresql.org/pipermail/slony1-general/attachments/20070122/bdf1128d/attachment-0001.html 

From cbbrowne  Mon Jan 22 07:40:38 2007
From: cbbrowne (Christopher Browne)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] Fwd:  SLONY-I disadvantages
In-Reply-To: <98028b00701220616u59cce781hc936c5bdf5bdc409@mail.gmail.com>
References: <Pine.LNX.4.62.0701111908050.3241@mini.atlantida.localdomain>	<45A73184.2060604@haisuli.net>	<Pine.LNX.4.62.0701120743180.3241@mini.atlantida.localdomain>	<20070115150342.GD13011@phlogiston.dyndns.org>	<d91f09cd0701161315v19098995od34d0d9de016292d@mail.gmail.com>	<98028b00701171723n27802a3fj4ac593eed7cd59cb@mail.gmail.com>
	<98028b00701220616u59cce781hc936c5bdf5bdc409@mail.gmail.com>
Message-ID: <45B4DAF6.6000300@ca.afilias.info>

Alan Acosta wrote:
> So, why i need to use Slony,or better, when i want to use it ? and Are
> the random values the most important issue ?, Nobody know why
> PGCluster doesn't replicate correctly ?
Random values merely represent the easiest example to describe.

Query-propagating systems are susceptible to data corruption for any
update that involves either a nondeterministic query, a time-sensitive
query, or host-sensitive results.

It is completely obvious that RANDOM() provides results that are only
replicable at the same time on the same host.

It is completely obvious that NOW() is sensitive to when it is run.

In addition, any query of the following form will corrupt the
consistency between nodes:

   insert into t1 (select * from t2 limit 10);

The only way that query *could* be replicable would be if it declared an
ordering on t2 that could guarantee that, on two hosts, you'd get the
same result set.  E.g. -

   insert into t1 (select * from t2 order by [columns representing
candidate primary key] limit 10);


From postgres  Mon Jan 22 07:48:05 2007
From: postgres (Niels Breet)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] Slony 1.1.5 on postgres 8.2.1
In-Reply-To: <20070122120118.1645c674.gdh@laterooms.com>
References: <20070122120118.1645c674.gdh@laterooms.com>
Message-ID: <4043.85.147.201.170.1169480885.squirrel@breet.com>

On Mon, January 22, 2007 13:01, Gavin Hamill wrote:
> Is this possible with a trivial patch? I'm not yet ready to upgrade all
> nodes to Slony 1.2...
>
> The 1.1.5 compile fails at:
>
[ snip ]
> /root/slony1-1.1.5/src/slon/confoptions.c:115:
> undefined reference to `pg_qsort' collect2: ld returned 1 exit status
>

Hi Gavin,

This was the fix for 1.2. I think it will apply without any problems
on 1.1.5 too.

http://gborg.postgresql.org/cgi-bin/cvsweb.cgi/slony1-engine/src/slon/confoptions.c.diff?r1=1.17.2.1;r2=1.17.2.2;cvsroot=slony1

- Niels



From gdh  Mon Jan 22 08:13:47 2007
From: gdh (Gavin Hamill)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] Slony 1.1.5 on postgres 8.2.1
In-Reply-To: <4043.85.147.201.170.1169480885.squirrel@breet.com>
References: <20070122120118.1645c674.gdh@laterooms.com>
	<4043.85.147.201.170.1169480885.squirrel@breet.com>
Message-ID: <20070122161347.3f098a70.gdh@laterooms.com>

On Mon, 22 Jan 2007 16:48:05 +0100 (CET)
"Niels Breet" <postgres at breet.com> wrote:


> Hi Gavin,
> 
> This was the fix for 1.2. I think it will apply without any problems
> on 1.1.5 too.
> 
> http://gborg.postgresql.org/cgi-bin/cvsweb.cgi/slony1-engine/src/slon/confoptions.c.diff?r1=1.17.2.1;r2=1.17.2.2;cvsroot=slony1

Thanks for the pointer - but I guess there are much greater changes
required :(

gcc -g -O2 -pthread -I../.. -I/usr/include/postgresql/ -I/usr/include/postgresql/ -I/usr/include/postgresql/8.2/server/  -c -o confoptions.o confoptions.c
In file included from confoptions.c:16:
slon.h:152: error: expected specifier-qualifier-list before ?PGconn?
slon.h:383: error: expected ?)? before ?*? token
slon.h:510: error: expected ?)? before ?*? token
slon.h:511: error: expected ?)? before ?*? token
confoptions.c: In function ?build_conf_variables?:
confoptions.c:46: error: ?ConfigureNamesBool? undeclared (first use in this function)
confoptions.c:46: error: (Each undeclared identifier is reported only once
confoptions.c:46: error: for each function it appears in.)
... (and so on)

Cheers,
Gavin.

From andreas  Mon Jan 22 13:45:04 2007
From: andreas (Andreas Kostyrka)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] Fwd:  SLONY-I disadvantages
In-Reply-To: <45B4DAF6.6000300@ca.afilias.info>
References: <Pine.LNX.4.62.0701111908050.3241@mini.atlantida.localdomain>
	<45A73184.2060604@haisuli.net>
	<Pine.LNX.4.62.0701120743180.3241@mini.atlantida.localdomain>
	<20070115150342.GD13011@phlogiston.dyndns.org>
	<d91f09cd0701161315v19098995od34d0d9de016292d@mail.gmail.com>
	<98028b00701171723n27802a3fj4ac593eed7cd59cb@mail.gmail.com>
	<98028b00701220616u59cce781hc936c5bdf5bdc409@mail.gmail.com>
	<45B4DAF6.6000300@ca.afilias.info>
Message-ID: <20070122214504.GC20537@andi-lap.la.revver.com>

* Christopher Browne <cbbrowne at ca.afilias.info> [070122 16:46]:
> Alan Acosta wrote:
> > So, why i need to use Slony,or better, when i want to use it ? and Are
> > the random values the most important issue ?, Nobody know why
> > PGCluster doesn't replicate correctly ?
> Random values merely represent the easiest example to describe.
> 
> Query-propagating systems are susceptible to data corruption for any
> update that involves either a nondeterministic query, a time-sensitive
> query, or host-sensitive results.
> 
> It is completely obvious that RANDOM() provides results that are only
> replicable at the same time on the same host.
> 
> It is completely obvious that NOW() is sensitive to when it is run.
> 
> In addition, any query of the following form will corrupt the
> consistency between nodes:
> 
>    insert into t1 (select * from t2 limit 10);
> 
> The only way that query *could* be replicable would be if it declared an
> ordering on t2 that could guarantee that, on two hosts, you'd get the
> same result set.  E.g. -
> 
>    insert into t1 (select * from t2 order by [columns representing
> candidate primary key] limit 10);

Even this will break with MVCC systems like PG, when you have more
than one transaction running in parallel.

Basically, MVCC gives the benefit of increasing concurrency, BUT, it
includes the exact timing into the set of data needed to replay it
reliably.

Considering the above insert into t1 with the primary key ordering,
add a second client that is inserting rows into t2 all the time. Mix
in transactions and isolation levels into the drink. Stir till it
turns ugly.

Now, to replay these statemens correctly on a second DB server, you
need to make sure that the second clients insers happen in absolutly
the same relative timings. Oh, did I mention, that you need to make
sure that the PG backends do have the same priorities and DO really
process these statements in the same sequence?

So basically, PGcluster (if it uses statement replication) is strongly
broken, and will support only the most trivial usage cases.

Andreas


From JanWieck  Tue Jan 23 08:32:54 2007
From: JanWieck (Jan Wieck)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] sl_log_1 not cleaning out
In-Reply-To: <20070116172206.GA17186@phlogiston.dyndns.org>
References: <200701161508.06270.mlists@rp-online.de>	<200701161616.47259.mlists@rp-online.de>	<604pqrnfmt.fsf@dba2.int.libertyrms.com>	<200701160919.06229@hal.medialogik.com>
	<20070116172206.GA17186@phlogiston.dyndns.org>
Message-ID: <45B638B6.7000008@Yahoo.com>

On 1/16/2007 12:22 PM, Andrew Sullivan wrote:
> On Tue, Jan 16, 2007 at 09:19:06AM -0800, Alan Hodgson wrote:
>> > Restarting the slon processes cleared out old connections and brought
>> > back sanity.
>> 
>> I've seen this, too.  Restarting all the slons always clears it up.
> 
> It'd be really nice if people could start gathering as much forensic
> data on this issue as possible, since presumably it'd be nice not to
> have to do that all the time.

This symptom can not only be caused by the remote node not catching up. 
It can be perfectly fine in sync, but the sl_confirm entries aren't 
received back on the master, so the master "thinks" the slave is behind. 
One can simulate the problem by messing up the sl_path information 
required for the master receiving events from the slave (the same path 
is used to receive confirmations). Look for error messages in the slon 
logs where a master or provider node cannot connect to a subscriber.


Jan

-- 
#======================================================================#
# It's easier to get forgiveness for being wrong than for being right. #
# Let's break this rule - forgive me.                                  #
#================================================== JanWieck at Yahoo.com #

From mark  Tue Jan 23 14:23:34 2007
From: mark (Mark Stosberg)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] recommend monitoring script to use with Nagios?
Message-ID: <ep61tt$nj0$1@sea.gmane.org>

Hello,

I'm wondering what people are using to monitor Slony with Nagios. The
docs reference:

psql_replication_check.pl

... but that uses the very ancient "Pg.pm" and not DBI/DBD::Pg.

I also see "test_slony_state-dbi.pl", which uses DBI, but is not
referenced as a Nagios plugin.

I'm also curious if anyone is using Nagios' event handling as part of
failover-- using it to notice that a slave is down, and then make a
pro-active change to handle failover.

I'm evaluating various options to handle failover. DBIx::HA seems like
area reasonable solution for Perl, but I'm still exploring other options
at this point.

  Mark


From ajs  Tue Jan 23 14:28:38 2007
From: ajs (Andrew Sullivan)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] recommend monitoring script to use with Nagios?
In-Reply-To: <ep61tt$nj0$1@sea.gmane.org>
References: <ep61tt$nj0$1@sea.gmane.org>
Message-ID: <20070123222838.GK10352@phlogiston.dyndns.org>

On Tue, Jan 23, 2007 at 05:23:34PM -0500, Mark Stosberg wrote:
> ... but that uses the very ancient "Pg.pm" and not DBI/DBD::Pg.

Pg.pm is in fact supported and maintained.  For postgres-only work, I
think it's much nicer than DBI, because you don't have the
abstraction layer the benefits of which you're going to throw away by
tying tightly to the database engine anyway.

> I'm also curious if anyone is using Nagios' event handling as part of
> failover-- using it to notice that a slave is down, and then make a
> pro-active change to handle failover.

I'd be leery of this, because Nagios's event handling is slightly
underdetermined in when any event will in fact run.  It's adaptive,
which means if you have a lot of other things happening, your job
might not run exactly on time.

A

-- 
Andrew Sullivan  | ajs at crankycanuck.ca
This work was visionary and imaginative, and goes to show that visionary
and imaginative work need not end up well. 
		--Dennis Ritchie

From ajs  Tue Jan 23 14:38:48 2007
From: ajs (Andrew Sullivan)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] Fwd:  SLONY-I disadvantages
In-Reply-To: <20070122214504.GC20537@andi-lap.la.revver.com>
References: <Pine.LNX.4.62.0701111908050.3241@mini.atlantida.localdomain>
	<45A73184.2060604@haisuli.net>
	<Pine.LNX.4.62.0701120743180.3241@mini.atlantida.localdomain>
	<20070115150342.GD13011@phlogiston.dyndns.org>
	<d91f09cd0701161315v19098995od34d0d9de016292d@mail.gmail.com>
	<98028b00701171723n27802a3fj4ac593eed7cd59cb@mail.gmail.com>
	<98028b00701220616u59cce781hc936c5bdf5bdc409@mail.gmail.com>
	<45B4DAF6.6000300@ca.afilias.info>
	<20070122214504.GC20537@andi-lap.la.revver.com>
Message-ID: <20070123223848.GL10352@phlogiston.dyndns.org>

On Mon, Jan 22, 2007 at 10:45:04PM +0100, Andreas Kostyrka wrote:
> Now, to replay these statemens correctly on a second DB server, you
> need to make sure that the second clients insers happen in absolutly
> the same relative timings. Oh, did I mention, that you need to make
> sure that the PG backends do have the same priorities and DO really
> process these statements in the same sequence?

The latter thing turns out to be important, note.  This is also why,
so far, nobody has a clue how you might get something like Postgres-R
running under READ COMMITTED mode; indeed, I've heard people say that
it's impossible.

A

-- 
Andrew Sullivan  | ajs at crankycanuck.ca
The plural of anecdote is not data.
		--Roger Brinner

From jeff  Tue Jan 23 14:59:03 2007
From: jeff (Jeff Frost)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] recommend monitoring script to use with Nagios?
In-Reply-To: <ep61tt$nj0$1@sea.gmane.org>
References: <ep61tt$nj0$1@sea.gmane.org>
Message-ID: <Pine.LNX.4.64.0701231456240.5622@discord.home.frostconsultingllc.com>

I just update a timestamp in a slony_test table every 5 minutes on the master 
and check that on the slaves to make sure it's not more than x minutes old. 
The scripts are simple shell that calls psql.

On Tue, 23 Jan 2007, Mark Stosberg wrote:

> Hello,
>
> I'm wondering what people are using to monitor Slony with Nagios. The
> docs reference:
>
> psql_replication_check.pl
>
> ... but that uses the very ancient "Pg.pm" and not DBI/DBD::Pg.
>
> I also see "test_slony_state-dbi.pl", which uses DBI, but is not
> referenced as a Nagios plugin.
>
> I'm also curious if anyone is using Nagios' event handling as part of
> failover-- using it to notice that a slave is down, and then make a
> pro-active change to handle failover.
>
> I'm evaluating various options to handle failover. DBIx::HA seems like
> area reasonable solution for Perl, but I'm still exploring other options
> at this point.
>
>  Mark
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at gborg.postgresql.org
> http://gborg.postgresql.org/mailman/listinfo/slony1-general
>
>

-- 
Jeff Frost, Owner 	<jeff at frostconsultingllc.com>
Frost Consulting, LLC 	http://www.frostconsultingllc.com/
Phone: 650-780-7908	FAX: 650-649-1954

From cbbrowne  Tue Jan 23 15:28:04 2007
From: cbbrowne (Christopher Browne)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] recommend monitoring script to use with Nagios?
In-Reply-To: <ep61tt$nj0$1@sea.gmane.org> (Mark Stosberg's message of "Tue,
	23 Jan 2007 17:23:34 -0500")
References: <ep61tt$nj0$1@sea.gmane.org>
Message-ID: <60hcuhjpbv.fsf@dba2.int.libertyrms.com>

Mark Stosberg <mark at summersault.com> writes:
> I'm wondering what people are using to monitor Slony with Nagios. The
> docs reference:
>
> psql_replication_check.pl
>
> ... but that uses the very ancient "Pg.pm" and not DBI/DBD::Pg.
>
> I also see "test_slony_state-dbi.pl", which uses DBI, but is not
> referenced as a Nagios plugin.
>
> I'm also curious if anyone is using Nagios' event handling as part of
> failover-- using it to notice that a slave is down, and then make a
> pro-active change to handle failover.
>
> I'm evaluating various options to handle failover. DBIx::HA seems like
> area reasonable solution for Perl, but I'm still exploring other options
> at this point.

What we're using actively, in practice, is twofold:

1.  We have a Nagios check that looks at a view that we call
"replication_status."

And that is indeed based on psql_replication_check.pl...

The view has three fields:

some-tld at state:5432=# select * from replication_status ;
 object_name |       created_on       |  age  
-------------+------------------------+-------
 mydomain.tld   | 2006-12-31 23:59:52+00 | 33075
(1 row)

[I ran it against a copy of a database as of 12/31, so the check found
that replication was behind by rather a lot!]

Behind the scenes, the view selects the most recently updated object
on a transaction table, which is a table we expect to see updated very
frequently.

Having the 3 pieces of information is kind of nice:
 - The age is a good basis for raising an alarm;
 - The "created_on" column may well identify when something broke;
 - The "object_name" gives the folks doing monitoring some information
   as to where things have stopped.  

  If people watching Nagios see that the object keeps changing, then
  they know replication hasn't actually ceased to work, which means
  they might not page me at 3am after getting hit by some load that is
  causing a node that's replicating across a somewhat slow WAN
  connection to fall behind a bit :-).

On your system, this would have to point to some sort of "object of
interest" that you expect to see frequently updated.

Yeah, it's using Pg.  It hasn't stopped working :-).

2.  We've got an MRTG data collector that looks at the sl_status view,
collecting data on how far each node is behind.

In the long run, that's likely to be more useful, particularly since
you can do trend analysis and such like...
-- 
(reverse (concatenate 'string "ofni.sailifa.ac" "@" "enworbbc"))
<http://cbbrowne.com/info/monitoring.html>
Christopher Browne
(416) 673-4124 (land)

From cbbrowne  Tue Jan 23 15:36:24 2007
From: cbbrowne (Christopher Browne)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] Fwd:  SLONY-I disadvantages
In-Reply-To: <20070123223848.GL10352@phlogiston.dyndns.org> (Andrew Sullivan's
	message of "Tue, 23 Jan 2007 17:38:48 -0500")
References: <Pine.LNX.4.62.0701111908050.3241@mini.atlantida.localdomain>
	<45A73184.2060604@haisuli.net>
	<Pine.LNX.4.62.0701120743180.3241@mini.atlantida.localdomain>
	<20070115150342.GD13011@phlogiston.dyndns.org>
	<d91f09cd0701161315v19098995od34d0d9de016292d@mail.gmail.com>
	<98028b00701171723n27802a3fj4ac593eed7cd59cb@mail.gmail.com>
	<98028b00701220616u59cce781hc936c5bdf5bdc409@mail.gmail.com>
	<45B4DAF6.6000300@ca.afilias.info>
	<20070122214504.GC20537@andi-lap.la.revver.com>
	<20070123223848.GL10352@phlogiston.dyndns.org>
Message-ID: <60d555joxz.fsf@dba2.int.libertyrms.com>

Andrew Sullivan <ajs at crankycanuck.ca> writes:
> On Mon, Jan 22, 2007 at 10:45:04PM +0100, Andreas Kostyrka wrote:
>> Now, to replay these statemens correctly on a second DB server, you
>> need to make sure that the second clients insers happen in absolutly
>> the same relative timings. Oh, did I mention, that you need to make
>> sure that the PG backends do have the same priorities and DO really
>> process these statements in the same sequence?
>
> The latter thing turns out to be important, note.  This is also why,
> so far, nobody has a clue how you might get something like Postgres-R
> running under READ COMMITTED mode; indeed, I've heard people say that
> it's impossible.

On the flip side of this, I'd love to see a decent example of this,
where someone, say, constructs a script that spawns several
connections that submit queries that can consistently exercise this
scenario.

It sort of looks as if people that imagine they're building
replication systems don't even imagine that this scenario could exist.

It would be really nice if we could say: "Here's a script that goes
off and spawns 6 psql sessions to perform a dozen or so SQL
statements.  If you do any sort of naive query copying, the data in
the table at the end will visibly differ between master and slave."

With a few sleep statements strategically placed, it surely shouldn't
be too difficult to get READ COMMITTED to break down.

And I think that would be a useful demonstration.  "See?  This little
script, which fits on a single sheet of paper, and which has no
baroque SQL constructions, breaks your replication system."
-- 
let name="cbbrowne" and tld="ca.afilias.info" in String.concat "@" [name;tld];;
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)

From a.mandieva  Wed Jan 24 02:09:25 2007
From: a.mandieva (Alex)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] (no subject)
Message-ID: <45B73055.5090103@gmail.com>



From mark  Wed Jan 24 08:19:21 2007
From: mark (Mark Stosberg)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] PATCH: monitoring docs typo fix.
In-Reply-To: <60hcuhjpbv.fsf@dba2.int.libertyrms.com>
References: <ep61tt$nj0$1@sea.gmane.org>
	<60hcuhjpbv.fsf@dba2.int.libertyrms.com>
Message-ID: <ep80uu$cup$1@sea.gmane.org>

Thanks for all the responses about Nagios. It's been very helpful.

Attached is a small doc patch for monitoring.sgml.

It referred to the script as "pgsql...", while the actual name is "psql..."

     Mark


-------------- next part --------------
A non-text attachment was scrubbed...
Name: monitoring.patch
Type: text/x-patch
Size: 1076 bytes
Desc: not available
Url : http://gborg.postgresql.org/pipermail/slony1-general/attachments/20070124/a91abff2/attachment.bin 

From lavalamp  Wed Jan 24 07:50:35 2007
From: lavalamp (Brian A. Seklecki)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] recommend monitoring script to use with Nagios?
In-Reply-To: <Pine.LNX.4.64.0701231456240.5622@discord.home.frostconsultingllc.com>
References: <ep61tt$nj0$1@sea.gmane.org>
	<Pine.LNX.4.64.0701231456240.5622@discord.home.frostconsultingllc.com>
Message-ID: <20070124100422.X18034@arbitor.digitalfreaks.org>




On Tue, 23 Jan 2007, Jeff Frost wrote:

> I just update a timestamp in a slony_test table every 5 minutes on the master
> and check that on the slaves to make sure it's not more than x minutes old.
> The scripts are simple shell that calls psql.
>
> On Tue, 23 Jan 2007, Mark Stosberg wrote:
>
>> Hello,
>>
>> I'm wondering what people are using to monitor Slony with Nagios. The
>> docs reference:


Start by asking what are the metrics for health:

1) Synchronous number of rows in a each table/view on Masters v.s. Slaves?

Unfortunately, this type check requires that you do more than select 
count(*) from $table_name; Snap/Dump from your Slave/Master.

2) Queue sizes on masters (w/ thresholds)

3) Date/Time of last heartbeat from other nodes

~BAS

From lavalamp  Wed Jan 24 13:43:11 2007
From: lavalamp (Brian A. Seklecki)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] Apache-Style Profiles for FreeBSD
	ports/databases/slony/*
Message-ID: <20070124163435.F18034@arbitor.digitalfreaks.org>


http://digitalfreaks.org/~lavalamp/slon.in

Since ShMem can't be split across different PgSQL instances on the same 
machine (even with Jails), hard PgSQL separation is required (thus domains 
in network auth mechanisms).

For Slony, there's a 1:1 set of processes per authentication credentials 
(db connect string), so on systems where a single PgSQL instance exists 
but credentials are split up to serve multiple clients with autonomous 
table/view/replication sets, multiple instances (PID files, configs, db 
connect strings, etc.) must run and coexist without overlapping.

Thus, unambiguously stolen from the Apache apache22.sh.in.  Uses all the 
rc.subr(8) hooks.

This will need %%PREFIX%% substitution to make its way back into the ports 
tree.

Also I do some more aggressive sanity checking on configs/variables than 
the Apache version.  May be slightly redundant, but we're talking about 
DBA work here. >:}

Love,
l8*
 	-lava (Brian A. Seklecki - Pittsburgh, PA, USA)
 	       http://www.spiritual-machines.org/

From drees76  Wed Jan 24 18:06:51 2007
From: drees76 (David Rees)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] Docs "Getting Slony-I Source" Link Incorrect
Message-ID: <72dbd3150701241806h55b3c5fbyc5bd9580fc0804d5@mail.gmail.com>

Looking at the 1.2.6 docs tarball, section 3.2. Getting Slony-I Source
refers to http://developer.postgresql.org/~wieck/slony1/download/ to
download Slony-I source, it should probably be updated to
http://pgfoundry.org/frs/?group_id=1000122 or perhaps point to
http://slony.info/

-Dave

From Samantha_Surendran  Wed Jan 24 21:47:33 2007
From: Samantha_Surendran (Samantha Surendran)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] Error while creating second set
Message-ID: <73AC4A2525F8164AB66D7C6E197D17BB02213FF7@BLRKECMSG02.ad.infosys.com>


Hi,

I am trying to create a second set and then do a merge onto the first
one.
The create set and set add table went through fine. But the subscribe
set failed.


this is my script, which contains only the subcribe set

#/bin/bash

slonik <<_EOF_ 2>> /usr/local/pgsql/slony_setup.log 1>>
/usr/local/pgsql/slony_setup.log
        cluster name = was1_;
    node 1 admin conninfo = 'dbname=wasdb3 host=xxxx port=5432
user=postgres password=xyz';
        node 2 admin conninfo = 'dbname=wasdb3 host=yyyy port=5432
user=postgres password=xyz';

        subscribe set ( id = 2, PROVIDER = 1, receiver = 2, forward = no
);
_EOF_

if [ $? -ne 0 ]
then
    echo Errors were detected.  Please review
/usr/local/pgsql/slony_setup.log and fix the errors.
    exit -1
fi

echo The script has succeeded.  At this time the slaves should be
receiving the data
echo from the master.


I still receive this error on running this script.
<stdin>:5: PGRES_FATAL_ERROR select "_was1_".subscribeSet(2, 1, 2, 'f');
- ERROR:  Slony-I: set 2 not found

Has anyone faced this error before. Can someone please help?


Regards,
Samantha



**************** CAUTION - Disclaimer *****************
This e-mail contains PRIVILEGED AND CONFIDENTIAL INFORMATION intended solely for the use of the addressee(s). If you are not the intended recipient, please notify the sender by e-mail and delete the original message. Further, you are not to copy, disclose, or distribute this e-mail or its contents to any other person and any such actions are unlawful. This e-mail may contain viruses. Infosys has taken every reasonable precaution to minimize this risk, but is not liable for any damage you may sustain as a result of any virus in this e-mail. You should carry out your own virus checks before opening the e-mail or attachment. Infosys reserves the right to monitor and review the content of all messages sent to or from this e-mail address. Messages sent to or from this e-mail address may be stored on the Infosys e-mail system.
***INFOSYS******** End of Disclaimer ********INFOSYS***
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://gborg.postgresql.org/pipermail/slony1-general/attachments/20070125/c9dc2620/attachment-0001.html 

From p.brinon  Wed Jan 24 23:59:54 2007
From: p.brinon (Brinon Philippe)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] How to minimize the CPU activity on a SLONY master
	node?
Message-ID: <7ECD91B2C1B9444F904480DD7768B36D8064F1@RES005.brgm.fr>

Hello everybody, 

 

We would like to know if there is a way to simplify the management of
SLONY in the case of a simple master-to-slave replication process.

 

Here is our structure: we have one master and 10 slaves, running
properly. We do not expect any of the slaves to become a master some
day. Everything is running well, except that there is a tremendous
activity on the master server due to the numerous SLONY processes. The
activity on each slave node is also far from being null even when there
is nothing to replicate.

 

Considering that the relationships between slave nodes were of no use in
our situation, we have decided, on a test configuration, to suppress all
the listen paths which seemed unuseful and to keep only the 20 obviously
useful listen paths. On the same way, we have kept only the 20 minimum
paths between the master and each slave. Under this new test
configuration, everything continued to run properly, the slave nodes had
there CPU activity being reduced. However, the master CPU activity
continued to be tremendous.

 

On a second step, we noticed first that the table sl_listen continued to
have 110 lines even if we had specified 20 listen paths. Consequently,
we cleaned each sl_listen table of each node of the SLONY cluster in
order to have a consistent situation. After a couple of hours, we have
noted that the CPU activity of the master node as well as the CPU
activity of the slave nodes have been considerably reduced, despite the
big number of SLONY processes remaining on each node (55 on the master
and 15 on each slave).

 

Our questions are: 

1- Is there a way to configure SLONY so that we can obtain the same good
results in terms of CPU use without cleaning manually the SL_LISTEN
tables?

2- Is there a way to minimize the number of SLONY processes on the
master and slave nodes?

3- Which parameters is it possible to change in order to minimize the
activity of the master and slaves?

4- Is it possible to configure the system so that the replication is
decided by the master node whenever necessary?

 

Thanks for your help.

 

Philippe Brinon & Philippe Daniels

 

**********************************************************************************************
Le contenu de cet e-mail et de ses pi?ces jointes est destin? ? l'usage exclusif du 
(des) destinataire(s) express?ment d?sign?(s) comme tel(s). En cas de r?ception de cet 
 e-mail par erreur, le signaler ? son exp?diteur et ne pas en divulguer le contenu. 
L'absence de virus a ?t? v?rifi? ? l'?mission du message. Il convient n?anmoins de 
v?rifier l'absence de corruption ? sa r?ception. The contents of this email and any attachments are 
confidential. They are intended for 
the named recipient(s) only. If you have received this email in error please notify the 
system manager or the sender immediately and do not disclose the contents to 
anyone or make copies. eSafe scanned this email for viruses, vandals and malicious 
content.
**********************************************************************************************
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://gborg.postgresql.org/pipermail/slony1-general/attachments/20070125/d75c6b53/attachment.html 

From Sascha.Spreitzer  Thu Jan 25 00:53:01 2007
From: Sascha.Spreitzer (Sascha.Spreitzer at izb.de)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] Error while creating second set
Message-ID: <914FC41646BED511A1E40002A587EA360AD586F4@M0000S0F>

Hello Samantha,
 
from the documentation:
[...]
ID = ival 

ID of the set to subscribe

[...]
 
Just try it this way:
 
        subscribe set ( id = 1, PROVIDER = 1, receiver = 2, forward = no );

Regards,
Sascha
 
IZB Informatikzentrum 
M?nchen - Frankfurt am Main GmbH & Co.KG 
Einsteinring 17 
85609 Aschheim 
 <http://www.izb.net/> www.izb.net 

Ein Unternehmen der Sparkassen Finanzgruppe. 

--------------------------------------------------------------- 
Diese E-Mail enth?lt vertrauliche und/oder rechtlich gesch?tzte 
Informationen. Wenn Sie nicht der richtige Adressat sind oder diese E-Mail 
irrt?mlich erhalten haben, informieren Sie bitte sofort den Absender und 
vernichten Sie diese Mail. Das unerlaubte Kopieren sowie die unbefugte 
Weitergabe dieser Mail ist nicht gestattet. 
--------------------------------------------------------------- 
This e-mail may contain confidential and/or privileged information. If you 
are not the intended recipient (or have received this e-mail in error) 
please notify the sender immediately and destroy this e-mail. 
Any unauthorized copying, disclosure or distribution of the material in 
this e-mail is strictly forbidden. 
--------------------------------------------------------------- 
IZB Informatik-Zentrum M?nchen-Frankfurt 

-----Urspr?ngliche Nachricht-----
Von: slony1-general-bounces at gborg.postgresql.org
[mailto:slony1-general-bounces at gborg.postgresql.org] Im Auftrag von Samantha
Surendran
Gesendet: Donnerstag, 25. Januar 2007 06:48
An: slony1-general at gborg.postgresql.org
Betreff: [Slony1-general] Error while creating second set


Hi,
 
I am trying to create a second set and then do a merge onto the first one.
The create set and set add table went through fine. But the subscribe set
failed. 
 
 
this is my script, which contains only the subcribe set
 
#/bin/bash
 
slonik <<_EOF_ 2>> /usr/local/pgsql/slony_setup.log 1>>
/usr/local/pgsql/slony_setup.log
        cluster name = was1_;
    node 1 admin conninfo = 'dbname=wasdb3 host=xxxx port=5432 user=postgres
password=xyz';
        node 2 admin conninfo = 'dbname=wasdb3 host=yyyy port=5432
user=postgres password=xyz';
 
        subscribe set ( id = 2, PROVIDER = 1, receiver = 2, forward = no );
_EOF_
 
if [ $? -ne 0 ]
then
    echo Errors were detected.  Please review
/usr/local/pgsql/slony_setup.log and fix the errors.
    exit -1
fi
 
echo The script has succeeded.  At this time the slaves should be receiving
the data
echo from the master.

 
I still receive this error on running this script.
<stdin>:5: PGRES_FATAL_ERROR select "_was1_".subscribeSet(2, 1, 2, 'f');  -
ERROR:  Slony-I: set 2 not found
 


Has anyone faced this error before. Can someone please help?

 
Regards,
Samantha
 
**************** CAUTION - Disclaimer *****************
This e-mail contains PRIVILEGED AND CONFIDENTIAL INFORMATION intended solely
for the use of the addressee(s). If you are not the intended recipient,
please notify the sender by e-mail and delete the original message. Further,
you are not to copy, disclose, or distribute this e-mail or its contents to
any other person and any such actions are unlawful. This e-mail may contain
viruses. Infosys has taken every reasonable precaution to minimize this
risk, but is not liable for any damage you may sustain as a result of any
virus in this e-mail. You should carry out your own virus checks before
opening the e-mail or attachment. Infosys reserves the right to monitor and
review the content of all messages sent to or from this e-mail address.
Messages sent to or from this e-mail address may be stored on the Infosys
e-mail system.
***INFOSYS******** End of Disclaimer ********INFOSYS***
	

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://gborg.postgresql.org/pipermail/slony1-general/attachments/20070125/f10a091f/attachment-0001.html 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Spreitzer, Sascha.vcf
Type: application/octet-stream
Size: 366 bytes
Desc: not available
Url : http://gborg.postgresql.org/pipermail/slony1-general/attachments/20070125/f10a091f/attachment-0001.obj 

From bnichols  Thu Jan 25 08:24:58 2007
From: bnichols (Brad Nicholson)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] How to minimize the CPU activity on a
	SLONY	master node?
In-Reply-To: <7ECD91B2C1B9444F904480DD7768B36D8064F1@RES005.brgm.fr>
References: <7ECD91B2C1B9444F904480DD7768B36D8064F1@RES005.brgm.fr>
Message-ID: <1169742298.7617.128.camel@dba5.int.libertyrms.com>

On Thu, 2007-01-25 at 08:59 +0100, Brinon Philippe wrote:
> Hello everybody, 
> 
>  
> 
> We would like to know if there is a way to simplify the management of
> SLONY in the case of a simple master-to-slave replication process.
> 
>  
> 
> Here is our structure: we have one master and 10 slaves, running
> properly. 

Can I ask what you need 10 subscribers for?

> We do not expect any of the slaves to become a master some day.
> Everything is running well, except that there is a tremendous activity
> on the master server due to the numerous SLONY processes. The activity
> on each slave node is also far from being null even when there is
> nothing to replicate.

What slony processes?  Do you mean the Postgres processes that slony is
using, or the slon processes?  If you mean the slon processes, run the
slons on a different server.
> 
> Considering that the relationships between slave nodes were of no use
> in our situation, we have decided, on a test configuration, to
> suppress all the listen paths which seemed unuseful and to keep only
> the 20 obviously useful listen paths. On the same way, we have kept
> only the 20 minimum paths between the master and each slave. Under
> this new test configuration, everything continued to run properly, the
> slave nodes had there CPU activity being reduced. However, the master
> CPU activity continued to be tremendous.
> 
>  
> 
> On a second step, we noticed first that the table sl_listen continued
> to have 110 lines even if we had specified 20 listen paths.
> Consequently, we cleaned each sl_listen table of each node of the
> SLONY cluster in order to have a consistent situation. After a couple
> of hours, we have noted that the CPU activity of the master node as
> well as the CPU activity of the slave nodes have been considerably
> reduced, despite the big number of SLONY processes remaining on each
> node (55 on the master and 15 on each slave).
> 
>  
> 
> Our questions are: 
> 
> 1- Is there a way to configure SLONY so that we can obtain the same
> good results in terms of CPU use without cleaning manually the
> SL_LISTEN tables?
> 
What version of slony are you running?  STORE LISTEN/DROP LISTEN were
no-ops for a while (most, if not all of the 1.5 branch, I believe).
This has been fixed in 1.2

> 2- Is there a way to minimize the number of SLONY processes on the
> master and slave nodes?

Sure, the easiest way is reduce the number of subscribers.
> 
Secondly, are you trying to optimize for the provider, or the
subscribers?  If the answer is for the provider - use cascaded replicas
(have the provider A to only one other node - B. Then chain the rest of
the nodes off B. 

> 3- Which parameters is it possible to change in order to minimize the
> activity of the master and slaves?

Hmm, I'm not sure about this one, but I wonder about setting forward='f'
on the subscribers that will never need to be promoted to master.  They
will stop collecting sl_log data - in theory that should reduce your
activity.
> 
> 4- Is it possible to configure the system so that the replication is
> decided by the master node whenever necessary?

I'm not sure what you mean here.

Brad Nicholson  416-673-4106
Database Administrator, Afilias Canada Corp.


From lavalamp  Thu Jan 25 08:38:30 2007
From: lavalamp (Brian A. Seklecki)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] Apache-Style Profiles for FreeBSD
 ports/databases/slony/*
In-Reply-To: <20070124163435.F18034@arbitor.digitalfreaks.org>
References: <20070124163435.F18034@arbitor.digitalfreaks.org>
Message-ID: <20070125113749.M18034@arbitor.digitalfreaks.org>


Cleaned up version:

http://people.collaborativefusion.com/~seklecki/slony_rc_profiles.html

~BAS

On Wed, 24 Jan 2007, Brian A. Seklecki wrote:

>
> http://digitalfreaks.org/~lavalamp/slon.in
>
> Since ShMem can't be split across different PgSQL instances on the same

From cbbrowne  Thu Jan 25 09:37:16 2007
From: cbbrowne (Christopher Browne)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] How to minimize the CPU activity on a	SLONY
 master node?
In-Reply-To: <1169742298.7617.128.camel@dba5.int.libertyrms.com>
References: <7ECD91B2C1B9444F904480DD7768B36D8064F1@RES005.brgm.fr>
	<1169742298.7617.128.camel@dba5.int.libertyrms.com>
Message-ID: <45B8EACC.6080400@ca.afilias.info>

Brad Nicholson wrote:
> On Thu, 2007-01-25 at 08:59 +0100, Brinon Philippe wrote:
>   
>> 3- Which parameters is it possible to change in order to minimize the
>> activity of the master and slaves?
>>     
>
> Hmm, I'm not sure about this one, but I wonder about setting forward='f'
> on the subscribers that will never need to be promoted to master.  They
> will stop collecting sl_log data - in theory that should reduce your
> activity.
>   
That would indeed be one effect that would diminish the needful amount
of DB work.  However, I have to point out that this does not explain why
CPU activity on the *master* node would be high; this particular change
should only affect behaviour on subscribers...

It looks to me like the situation/problem Brinon Philippe is observing
is that there is way more work being done processing events and event
confirmations than was expected. 

This steps us back to an old debate about the issue that every node has
to process confirmation of receipt of every event that goes to every
other node.

We always knew there was a quadratic (or possibly more) increase in
communications activity as the number of nodes increases (e.g. - number
of messages increases based on O(n^2), where n is the number of nodes),
so when you have 11 nodes, that is expected to have on the order of 121
times as much communications work as when you have 1.

It may be that when there are 11 nodes not doing much actual
replication, the communications work starts to very much outweigh the
amount of "actual replication effort."

There are two ways I can see of cutting down on that:

1.  In Slony-I 1.2, confirmations are processed somewhat less often, and
notifications are NOT sent out to handle this.

Thus, I expect that version 1.2 will "play better" than 1.1, in general
terms.

2.  If the nodes are richly interconnected, they'll all be processing
all of each others' events all the time.

On the other hand, if you cut down on the number of paths (e.g. - number
of connections in sl_path), then events will propagate a bit less
directly, slons will open fewer connections to listen to other nodes,
and I'd expect the flurry of DB activity to be somewhat less.


From cbbrowne  Thu Jan 25 09:52:43 2007
From: cbbrowne (Christopher Browne)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] Apache-Style Profiles for FreeBSD
	ports/databases/slony/*
In-Reply-To: <20070125113749.M18034@arbitor.digitalfreaks.org>
References: <20070124163435.F18034@arbitor.digitalfreaks.org>
	<20070125113749.M18034@arbitor.digitalfreaks.org>
Message-ID: <45B8EE6B.7080606@ca.afilias.info>

Brian A. Seklecki wrote:
> Cleaned up version:
>
> http://people.collaborativefusion.com/~seklecki/slony_rc_profiles.html
>   
Cool.

I will be taking a look at this soon with a view to getting it into CVS;
we're at the point of having the new server at CommandPrompt just about
working, so I've been putting off some CVS changes.

Once we've got all the 'legacy' users activated at cvs.slony.info, we'll
have to see about the requests that have been outstanding for a while to
get a couple new users given CVS update privileges.  Mark Stosberg has
asked about that; I think you haven't, but if you keep submitting useful
stuff we'll feel compelled ;-).

At any rate, things haven't happened instantly because there's activity
lurking in the background.

From mark  Thu Jan 25 12:06:39 2007
From: mark (Mark Stosberg)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] PATCH: more explicitly recommend primary keys
Message-ID: <epb2l5$kb9$1@sea.gmane.org>


Hello,

The attached patch updates the docs about defining keys. It more
explicitly recommends using a primary key, and provides an example
syntax to convert a unique/not null index to a primary key.

The essence of the patch has been text-ified below for easier
peer review of grammar and accuracy.

    Mark

....

If the table hasn't got a primary key, but has some
<em>candidate</em> primary key, that is, some index on a
combination of fields that is both UNIQUE and NOT NULL, then you can
specify the key, as in the example below.

 SET ADD TABLE (set id = 1, origin = 1, id = 42,
                full qualified name = 'public.this_table',
                key = 'this_by_that',
      comment='this_table has this_by_that as a candidate primary key');

HOWEVER, once you have gotten this far, there is little reason not to
just convert the index to be a primary key instead, which also implies
that the columns involved be NOT NULL, and will create a unique index.
Here's an example conversion:

 DROP INDEX my_table_name_col1_col2_uniq_idx;
 ALTER TABLE my_table_name ADD PRIMARY KEY (col1, col2);

If your application is not using the index by name,
the effective result should be the same, with the added value that
a primary key has been declared.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: definesets.patch
Type: text/x-patch
Size: 1461 bytes
Desc: not available
Url : http://gborg.postgresql.org/pipermail/slony1-general/attachments/20070125/f037d55b/attachment.bin 

From ajs  Thu Jan 25 15:20:35 2007
From: ajs (Andrew Sullivan)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] How to minimize the CPU activity on a SLONY
	master node?
In-Reply-To: <7ECD91B2C1B9444F904480DD7768B36D8064F1@RES005.brgm.fr>
References: <7ECD91B2C1B9444F904480DD7768B36D8064F1@RES005.brgm.fr>
Message-ID: <20070125232035.GA17386@phlogiston.dyndns.org>

On Thu, Jan 25, 2007 at 08:59:54AM +0100, Brinon Philippe wrote:
> 4- Is it possible to configure the system so that the replication is
> decided by the master node whenever necessary?

I'm assuming that the idea here is not to send any events unless
something has actually changed, because you have an origin that
doesn't change very much.  

As a bit of a hack, I _think_ you could do this using some log
shipping tricks, and a little daemon that checks for files that are
new and then pokes all the other nodes if they need to get something. 
You do need one node to be the, for want of a better term,
distribution master under these circumstances, but I think it could
be done.

A

-- 
Andrew Sullivan  | ajs at crankycanuck.ca
The plural of anecdote is not data.
		--Roger Brinner

From p.brinon  Fri Jan 26 06:37:19 2007
From: p.brinon (Brinon Philippe)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] How to minimize the CPU activity on a	SLONY
	master node?
Message-ID: <7ECD91B2C1B9444F904480DD7768B36D8321D8@RES005.brgm.fr>

To Brad Nicholson:

1.	"Can I ask what you need 10 subscribers for?" The purpose of
this structure is to provide a series of database servers to be accessed
through web sites.
2.	"What slony processes are having a tremendous activity?" There
are around 20 PostGres processes which consume about 30% of the CPU. The
slon processes are not taking much CPU.
3.	"Which version of Slony are you using?" Version 1.1.1.5
4.	"Are you trying to optimize for the provider or the
subscribers?" For the provider. I understand your suggestion to use
cascade replicas. However, I'd like to understand why all this activity
is used even when the master DB is calm? (actually Christopher Browne
has given an answer to this question)
5.	"Which parameters is it possible to change in order to minimize
the activity?" You suggested setting forward='f'. I suppose you mean
defining each node like this:
    add_node(node     => 11,
             host     => 'geocat10',
             dbname   => 'geocatalogue',
             port     => 1521,
             user     => 'slony',
             password => '...',
             noforward => 'yes',
             parent   => 1);
which I have already done.

To Christopher Browne:

You suggest me to upgrade to version 1.2, which I will try to do next
week. I'll make my test first with "richly interconnected nodes" as you
say. Then I'll try with a minimum number of paths. And I'll let you know
the result.

Many thanks, Philippe Brinon.
**********************************************************************************************
Le contenu de cet e-mail et de ses pi?ces jointes est destin? ? l'usage exclusif du 
(des) destinataire(s) express?ment d?sign?(s) comme tel(s). En cas de r?ception de cet 
 e-mail par erreur, le signaler ? son exp?diteur et ne pas en divulguer le contenu. 
L'absence de virus a ?t? v?rifi? ? l'?mission du message. Il convient n?anmoins de 
v?rifier l'absence de corruption ? sa r?ception. The contents of this email and any attachments are 
confidential. They are intended for 
the named recipient(s) only. If you have received this email in error please notify the 
system manager or the sender immediately and do not disclose the contents to 
anyone or make copies. eSafe scanned this email for viruses, vandals and malicious 
content.
**********************************************************************************************


From sven  Fri Jan 26 06:55:55 2007
From: sven (Sven Willenberger)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] EXECUTE SCRIPT operates on non set member tables
Message-ID: <1169823355.23491.20.camel@lanshark.dmv.com>

I came across an issue with 1.2.6 involving using execute script to make
a basic DDL change to a table, namely adding a column to an existing
replicated table. In a nutshell, a node not part of the set in question
was asked to make the DDL change to the [non-existent] table and then
subsequently the call to alterTableForReplication fails.

The setup: 3 servers A B and C are set up with differents SETs
containing different nodes. For example:
NODE 1 = server A
NODE 2 = server B
NODE 3 = server C

SET 1 does some replication between A and B
SET 2 does some replication between B and C
SET 3 does some replication between C and A B

Now there is a [tablename] on B and C to which I added a column and then
subsequently created a default value for.

then: 

EXECUTE SCRIPT (SET ID = 2, FILENAME = 'path/to/DDL_script', EVENT NODE
= 2);

What ended up happening was, tables were locked on B and C, the table
was updated with the new changes, then the tables were made ready for
relication again. 

Problem: Server A (node 1) ended up trying to make the change to the
same table (which doesn't exist) and ultimately the slon process died
when it cycled through enough pids to have a duplicate entry when
"cleaning stale entries". I added the table to A just so as to eliminate
that error at which point alterTableForReplication() errored out stating
that 'Table "public"."<first table in sl_tables>" is already in altered
state'. (I ended up getting past this by altering the function to bypass
the guts and just return the value expected which finally allowed
replication to continue).

Sven


From ajs  Fri Jan 26 07:13:38 2007
From: ajs (Andrew Sullivan)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] EXECUTE SCRIPT operates on non set member
	tables
In-Reply-To: <1169823355.23491.20.camel@lanshark.dmv.com>
References: <1169823355.23491.20.camel@lanshark.dmv.com>
Message-ID: <20070126151338.GA19194@phlogiston.dyndns.org>

On Fri, Jan 26, 2007 at 09:55:55AM -0500, Sven Willenberger wrote:
> 
> Now there is a [tablename] on B and C to which I added a column and then
> subsequently created a default value for.

How did you do this?

A

-- 
Andrew Sullivan  | ajs at crankycanuck.ca
"The year's penultimate month" is not in truth a good way of saying
November.
		--H.W. Fowler

From sven  Fri Jan 26 08:58:54 2007
From: sven (Sven Willenberger)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] EXECUTE SCRIPT operates on non set
	member	tables
In-Reply-To: <20070126151338.GA19194@phlogiston.dyndns.org>
References: <1169823355.23491.20.camel@lanshark.dmv.com>
	<20070126151338.GA19194@phlogiston.dyndns.org>
Message-ID: <1169830734.23491.28.camel@lanshark.dmv.com>

On Fri, 2007-01-26 at 10:13 -0500, Andrew Sullivan wrote:
> On Fri, Jan 26, 2007 at 09:55:55AM -0500, Sven Willenberger wrote:
> > 
> > Now there is a [tablename] on B and C to which I added a column and then
> > subsequently created a default value for.
> 
> How did you do this?
> 
> A
> 

If you are asking what the actual ddl script contained, it goes as
follows:
# cat ddlscript.sql
ALTER TABLE customer ADD billed BOOL;
ALTER TABLE customer ALTER billed SET DEFAULT false;

# cat slony_execute_script.sh
#!/usr/local/bin/bash

slonik <<_EOF_ 2>> /usr/local/etc/slony/slony_setup.log 1>> /usr/local/etc/slony/slony_setup.log
        cluster name = T2;
        node 1 admin conninfo = 'dbname=dbA host=ipA port=5432 user=slony password=****';
        node 2 admin conninfo = 'dbname=dbB host=ipB port=5432 user=slony password=****';
        node 3 admin conninfo = 'dbname=dbC host=ipC port=5432 user=slony password=****';

        try {
                EXECUTE SCRIPT ( SET ID = 2, FILENAME = 'ddlscript.sql', EVENT NODE = 2);
        }
        on error {
                echo 'Failed to execute script';
                exit -1;
        }
_EOF_

As I have stated the changes were properly executed by the script on the
target tables, but the changes were attempted on the node that was not
part of this set.

Sven



From ajs  Fri Jan 26 09:36:25 2007
From: ajs (Andrew Sullivan)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] EXECUTE SCRIPT operates on non set member
	tables
In-Reply-To: <1169830734.23491.28.camel@lanshark.dmv.com>
References: <1169823355.23491.20.camel@lanshark.dmv.com>
	<20070126151338.GA19194@phlogiston.dyndns.org>
	<1169830734.23491.28.camel@lanshark.dmv.com>
Message-ID: <20070126173625.GB19194@phlogiston.dyndns.org>

On Fri, Jan 26, 2007 at 11:58:54AM -0500, Sven Willenberger wrote:
> > How did you do this?

> If you are asking what the actual ddl script contained, it goes as
> follows:

No, I was trying to make sure you hadn't performed DDL on any node
without EXECUTE.  I was trying to eliminate the possibility of oid
conflict across nodes, which was the first thing that sprung to mind. 

Sounds like it's more subtle than that, though, and needs more
digging.

A

-- 
Andrew Sullivan  | ajs at crankycanuck.ca
If they don't do anything, we don't need their acronym.
		--Josh Hamilton, on the US FEMA

From mark  Fri Jan 26 10:24:50 2007
From: mark (Mark Stosberg)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] slonik_uninstall_nodes should report which node
 errors are coming from
Message-ID: <epdh28$6td$1@sea.gmane.org>


I just ran "slonik_uninstall_nodes" and got an error about a missing
table. After I thought I fixed it, I got this response when I ran it again:

root at sap# slonik_uninstall_nodes | slonik
<stdin>:4: PGRES_FATAL_ERROR select "_ff".uninstallNode();  - ERROR:
schema "_foo" does not exist

What happened was the table error was on node 1, which is uninstalled
/after/ node2. I think node 2 was successfully uninstalled on the first
try.

So when I re-ran the script, I think it's bombing out because node2 no
longer exists.

It would be more clearer and helpful if the feedback looked like this
instead:

 Node 2 appears to already be uninstalled. Skipping.
 Node 1:<stdin>:4: ... (node 1 errors, if any, here).

Now I've gotten myself into a pickle, because during the time I thought
node 1 was somehow half-uninstalled, I manually deleted the triggers
myself, and now the normal "uninstall" technique no longer works...so
I'll have figure how the rest of how to manually de-install slony on
this node, I suppose.

  Mark


From Samantha_Surendran  Sun Jan 28 14:30:18 2007
From: Samantha_Surendran (Samantha Surendran)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] Error while creating second set
	(Sascha.Spreitzer@izb.de)
References: <mailman.1071.1169715210.6481.slony1-general@gborg.postgresql.org>
Message-ID: <73AC4A2525F8164AB66D7C6E197D17BB022143AF@BLRKECMSG02.ad.infosys.com>

Hi Sascha,

I have created a set with set id as 2. And hence I have used the same
set ID in the subscribe set command. Before this I created a set with
set ID 1 and subcribed to it successfully.

I am creating a second set because I want to add a new table to the
replication set and I am facing problems with subcribing to the set.

Has anyone else faced this problem? Could you please help?

Thanks


Message: 2
Date: Thu, 25 Jan 2007 09:53:01 +0100
From: Sascha.Spreitzer at izb.de
Subject: Re: [Slony1-general] Error while creating second set
To: slony1-general at gborg.postgresql.org
Message-ID: <914FC41646BED511A1E40002A587EA360AD586F4 at M0000S0F>
Content-Type: text/plain; charset="iso-8859-1"

Hello Samantha,
 
from the documentation:
[...]
ID = ival 

ID of the set to subscribe

[...]
 
Just try it this way:
 
        subscribe set ( id = 1, PROVIDER = 1, receiver = 2, forward = no
);

Regards,
Sascha
 
IZB Informatikzentrum
M?nchen - Frankfurt am Main GmbH & Co.KG Einsteinring 17
85609 Aschheim
 <http://www.izb.net/> www.izb.net 

Ein Unternehmen der Sparkassen Finanzgruppe. 

---------------------------------------------------------------
Diese E-Mail enth?lt vertrauliche und/oder rechtlich gesch?tzte
Informationen. Wenn Sie nicht der richtige Adressat sind oder diese
E-Mail irrt?mlich erhalten haben, informieren Sie bitte sofort den
Absender und vernichten Sie diese Mail. Das unerlaubte Kopieren sowie
die unbefugte Weitergabe dieser Mail ist nicht gestattet. 
---------------------------------------------------------------
This e-mail may contain confidential and/or privileged information. If
you are not the intended recipient (or have received this e-mail in
error) please notify the sender immediately and destroy this e-mail. 
Any unauthorized copying, disclosure or distribution of the material in
this e-mail is strictly forbidden. 
---------------------------------------------------------------
IZB Informatik-Zentrum M?nchen-Frankfurt 

-----Urspr?ngliche Nachricht-----
Von: slony1-general-bounces at gborg.postgresql.org
[mailto:slony1-general-bounces at gborg.postgresql.org] Im Auftrag von
Samantha Surendran
Gesendet: Donnerstag, 25. Januar 2007 06:48
An: slony1-general at gborg.postgresql.org
Betreff: [Slony1-general] Error while creating second set


Hi,
 
I am trying to create a second set and then do a merge onto the first
one.
The create set and set add table went through fine. But the subscribe
set failed. 
 
 
this is my script, which contains only the subcribe set
 
#/bin/bash
 
slonik <<_EOF_ 2>> /usr/local/pgsql/slony_setup.log 1>>
/usr/local/pgsql/slony_setup.log
        cluster name = was1_;
    node 1 admin conninfo = 'dbname=wasdb3 host=xxxx port=5432
user=postgres password=xyz';
        node 2 admin conninfo = 'dbname=wasdb3 host=yyyy port=5432
user=postgres password=xyz';
 
        subscribe set ( id = 2, PROVIDER = 1, receiver = 2, forward = no
); _EOF_
 
if [ $? -ne 0 ]
then
    echo Errors were detected.  Please review
/usr/local/pgsql/slony_setup.log and fix the errors.
    exit -1
fi
 
echo The script has succeeded.  At this time the slaves should be
receiving the data echo from the master.

 
I still receive this error on running this script.
<stdin>:5: PGRES_FATAL_ERROR select "_was1_".subscribeSet(2, 1, 2, 'f');
-
ERROR:  Slony-I: set 2 not found
 


Has anyone faced this error before. Can someone please help?

 
Regards,
Samantha
 
**************** CAUTION - Disclaimer ***************** This e-mail
contains PRIVILEGED AND CONFIDENTIAL INFORMATION intended solely for the
use of the addressee(s). If you are not the intended recipient, please
notify the sender by e-mail and delete the original message. Further,
you are not to copy, disclose, or distribute this e-mail or its contents
to any other person and any such actions are unlawful. This e-mail may
contain viruses. Infosys has taken every reasonable precaution to
minimize this risk, but is not liable for any damage you may sustain as
a result of any virus in this e-mail. You should carry out your own
virus checks before opening the e-mail or attachment. Infosys reserves
the right to monitor and review the content of all messages sent to or
from this e-mail address.
Messages sent to or from this e-mail address may be stored on the
Infosys e-mail system.
***INFOSYS******** End of Disclaimer ********INFOSYS***
	

-------------- next part --------------
An HTML attachment was scrubbed...
URL:
http://gborg.postgresql.org/pipermail/slony1-general/attachments/2007012
5/f10a091f/attachment.html
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Spreitzer, Sascha.vcf
Type: application/octet-stream
Size: 366 bytes
Desc: not available
Url :
http://gborg.postgresql.org/pipermail/slony1-general/attachments/2007012
5/f10a091f/attachment.obj 

------------------------------

_______________________________________________
Slony1-general mailing list
Slony1-general at gborg.postgresql.org
http://gborg.postgresql.org/mailman/listinfo/slony1-general


End of Slony1-general Digest, Vol 36, Issue 15
**********************************************

From dba  Mon Jan 29 12:04:59 2007
From: dba (Richard Yen)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] Log-shipping?
Message-ID: <DC46F406-74F9-458C-8885-72F79C906C05@richyen.com>

Hi All,

I'm kind of confused as to how log shipping works.  I've set up a  
cluster with one provider and two subscribers, with one of the  
subscribers having the -a flag on.  *.sql files are being generated  
on this machine, but I have no clue as to what to do with these files.

My end goal is to ship logs to a remote location where I've got a  
second cluster set up (1 provider and 2 subscribers).  In the event  
of a disaster, I'd like to be able to just tip-over to this remote  
location and continue as if nothing happened.

In the past, I've attempted FAILOVER, but this proved buggy, and I'd  
like to try out log shipping as an alternative.

The slony1_dump.sh script doesn't seem to do anything but generate  
a .sql file that is supposed to read data from stdin.  But how am I  
supposed to use this?  What's going to pipe stuff into stdin?

Could someone point me in the right direction?

Thanks!
--Richard

From ajs  Mon Jan 29 12:12:06 2007
From: ajs (Andrew Sullivan)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] Log-shipping?
In-Reply-To: <DC46F406-74F9-458C-8885-72F79C906C05@richyen.com>
References: <DC46F406-74F9-458C-8885-72F79C906C05@richyen.com>
Message-ID: <20070129201205.GA29244@phlogiston.dyndns.org>

On Mon, Jan 29, 2007 at 12:04:59PM -0800, Richard Yen wrote:
> a .sql file that is supposed to read data from stdin.  But how am I  
> supposed to use this?  What's going to pipe stuff into stdin?

Psql.  You will need to write a script to use it, of course.

A

-- 
Andrew Sullivan  | ajs at crankycanuck.ca
A certain description of men are for getting out of debt, yet are
against all taxes for raising money to pay it off.
		--Alexander Hamilton

From lists_slony1-general  Mon Jan 29 15:39:51 2007
From: lists_slony1-general (Dan Falconer)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] slon_kill incorrectly choosing daemons to kill?
Message-ID: <200701291739.51682.lists_slony1-general@avsupport.com>

	PREFACE: I've got replication running on 5 databases.  On the largest, most 
active database ("pl"), I've setup the replication cluster's name to be 
"pl_replication".  On the other four, I've setup the cluster's name as 
"replication".  For each of the databases, I've got a configuration file, 
"conf/slon_tools-[dbname].conf" (thus, the config file for the aforementioned 
"pl" database is "conf/slon_tools-pl.conf").  The situation I'm about to 
explain happens on both servers (1 master, 1 slave), running on Slony 1.1.0 
and 1.2.6.  The servers, if it makes any difference (they're *identical*):
	* dual opteron 846 procs 
	* 8G ram
	* SLES 8.1 (yeah, it's old)

	On the "pl_replication" cluster, running:
	./bin/slon_kill \ --config=conf/slon_tools-pl.conf [eitherNode]" 
works just fine, killing only the slons on the current node for 
pl_replication.  However, when I attempt to do the same thing for *any* of 
the databases that are part of the "replication" cluster, it kills *ALL* of 
the slon daemons (on the given node), regardless if they're attached to the 
specified database or not. 

	At first, I'd thought that maybe our previous DBA had incorrectly 
broken-apart the replication sets, and that all of the four databases for the 
"replication" cluster were in fact supposed to have the same slon daemons.  
After some testing, however--I had plenty of time to do that, since the SAN 
attached to both of the DB's took a crap--I found that this does not *appear* 
to be the case.  The only way that slony will actually replicate data for 
each of these databases is if each one is init'ed, slonned, sets created, and 
everyone is subscribed.  

	So, I guess the question is: Am I missing something, or is slon_kill borken?
-- 
Best Regards,


Dan Falconer
"Head Geek",
AvSupport, Inc. (http://www.partslogistics.com)

From casey  Mon Jan 29 17:37:08 2007
From: casey (Casey Duncan)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] Quizzical merge set error
Message-ID: <83770F71-2F32-4FE5-B00E-79AB7A37FC3A@pandora.com>

I recently upgraded to slony 1.2.6. We were rehearsing a database  
schema upgrade for a two node slony cluster and came across an error  
at the end. We need to avoid having the execute script do its  
exclusive locks with the application talking to the database, so we  
do it using the following dance:

1. Turn off slon daemons
2. Switch application to use the secondary (read-only of course)
3. Run the upgrade script on the primary using execute script and add  
tables & sequences into a new set and merge waiting for subscriptions  
to be confirmed (which blocks).
4. Switch the application back to the primary db
5. Turn the slon daemons back on (which unblocks #3).

All was well until step #5 when we got this error:
<stdin>:12: PGRES_FATAL_ERROR select "_radio".mergeSet(1, 9999);  -  
ERROR:  Slony-I: set 9999 has subscriptions in progress - cannot merge

To provide more details, here's what we actually run in step 3 (minus  
the ddl):

CREATE SET (ID = 9999, ORIGIN = 1, COMMENT = 'Temporary set for add  
and merge');
...Execute DDL via EXECUTE SCRIPT...
SET ADD TABLE (SET ID = 9999, ORIGIN = 1, ID = 39, FULLY QUALIFIED  
NAME = 'public.new_table1');
SET ADD SEQUENCE (SET ID = 9999, ORIGIN = 1, ID = 18, FULLY QUALIFIED  
NAME = 'public.new_seq');
SET ADD TABLE (SET ID = 9999, ORIGIN = 1, ID = 40, FULLY QUALIFIED  
NAME = 'public.new_table2');
WAIT FOR EVENT (ORIGIN = ALL, CONFIRMED = ALL, TIMEOUT = 0);
SUBSCRIBE SET (ID = 9999, PROVIDER = 1, RECEIVER = 2, FORWARD = yes);
WAIT FOR EVENT (ORIGIN = ALL, CONFIRMED = ALL, TIMEOUT = 0);
MERGE SET (ID = 1, ADD ID = 9999, ORIGIN = 1);

The cluster we are upgrading has two nodes, id 1 (origin) and id 2.

So we explicitly wait for the ADDs to complete before SUBSCRIBE and  
we also wait for the SUBSCRIBE to complete before the MERGE (assuming  
I understand WAIT properly, which I may not). So we get this error  
which seems to indicate that the SUBSCRIBE was not in fact complete  
before the MERGE was executed, does that make sense to anyone? Note  
that step #3 above did indeed block as I would expect until we turned  
the slon daemons back on, so the WAITs were doing something.

The slon logs look relatively uninteresting and predictably have  
trouble subsequent to this because the new tables in the unmerged set  
cannot be found:

2007-01-29 16:41:56 PST ERROR  remoteWorkerThread_1: Could not find  
table "public"."new_table1" on subscriber

Any insights are appreciated. I'll be trying to reproduce this in a  
bit more isolated environment too.

-Casey

From bhirt  Mon Jan 29 18:34:36 2007
From: bhirt (Brian Hirt)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] getting postgresql server crashes with slony
Message-ID: <21EA85D5-ED4D-46AC-8BCF-17FF514DE6C7@mobygames.com>

Hi,

I'm having some serious problems ever since I installed slony  
(earlier today).   Let me give some background information first.

Today I installed slony (1.2.6) on a 8.1.4 server (node 1) and am  
replicating to a 8.2.1 (node 2) server.  It's a simple master (node  
1) -> slave (node 2) setup.  Nothing fancy.  I'm getting ready for  
migrating to 8.2 and I was planning on using slony to do it.  I've  
used slony with mixed success in the past, and I thought I'd give it  
another go.   Of course everything went fine in our test environment ;).

Postgresql has been happily running without a problem.  Never has  
crashed since I installed 8.1.   This server does about 20 million  
queries a day, so it's not sitting around idle.   Most of them are  
selects, but there is a constant trickle of updates, inserts and  
deletes. Within 2 hours of starting up slony, node 1 has crashed  
twice.  The postgres logs are like such:

LOG:  server process (PID 29842) was terminated by signal 11
LOG:  terminating any other active server processes
WARNING:  terminating connection because of crash of another server  
process
DETAIL:  The postmaster has commanded this server process to roll  
back the current transaction and exit, because another server process  
exited abnormally and possibly corrupted shared memory.
.
.
.
HINT:  In a moment you should be able to reconnect to the database  
and repeat your command.
LOG:  all server processes terminated; reinitializing
LOG:  database system was interrupted at 2007-01-29 19:45:03 CST
LOG:  checkpoint record is at 37C/C5F428E4
.
.
.

The node 1 slon log is as follows when the crash happened:

2007-01-29 19:42:25 CST DEBUG1 cleanupThread:    0.312 seconds for  
delete logs
2007-01-29 19:45:09 CST FATAL  syncThread: "start transaction;set  
transaction isolation level serializable;select last_value from  
"_mobycluster".sl_action_seq;" - server closed the connection  
unexpectedly
         This probably means the server terminated abnormally
         before or while processing the request.
2007-01-29 19:45:09 CST DEBUG1 slon: retry requested
2007-01-29 19:45:09 CST INFO   remoteListenThread_2: disconnecting  
from '***************'

The node 2 slon log is as follows when the crash happened:

2007-01-29 19:42:16 CST DEBUG1 cleanupThread:    0.196 seconds for  
delete logs
2007-01-29 19:45:09 CST ERROR  remoteListenThread_1: "select  
ev_origin, ev_seqno, ev_timestamp,        ev_minxid, ev_maxxid,  
ev_xip,        ev_type,        ev_data1, ev_data2,        ev_data3,  
ev_data4,        ev_data5, ev_data6,        ev_data7, ev_data8 from  
"_mobycluster".sl_event e where (e.ev_origin = '1' and e.ev_seqno >  
'8720') order by e.ev_origin, e.ev_seqno" - server closed the  
connection unexpectedly
         This probably means the server terminated abnormally
         before or while processing the request.
2007-01-29 19:45:19 CST DEBUG1 remoteListenThread_1: connected to  
'****************'
2007-01-29 19:45:26 CST ERROR  remoteWorkerThread_1: "start  
transaction; set enable_seqscan = off; set enable_indexscan = on; "  
PGRES_FATAL_ERROR server closed the connection unexpectedly
         This probably means the server terminated abnormally
         before or while processing the request.
2007-01-29 19:45:26 CST ERROR  remoteWorkerThread_1: "close LOG; "  
PGRES_FATAL_ERROR 2007-01-29 19:45:26 CST ERROR   
remoteWorkerThread_1: "rollback transaction; set enable_seqscan =  
default; set enable_indexscan = default; " PGRES_FATAL_ERROR  
2007-01-29 19:45:26 CST ERROR  remoteWorkerThread_1: helper 1  
finished with error


Is it possible that slony is causing these crashes?  I think that  
since $libdir/slony1_funcs.so is being included in the postgres  
processes, it's certainly possible.   I also think that a coincidence  
is a little to much of a reach.  However, I would love to hear what  
the experts think.   What's the best way to track this down?  Any  
advice on what I should do?   I'm very close to uninstalling slony,  
but if there is something I can do to help identify the problem so  
that it can be fixed, I'd like to help.

I realize that I'm not running 8.1.6, and I've checked the release  
notes for .5 and .6 and only see one reference to a crash fix:   
"Disallow aggregate functions in UPDATE commands, except within sub- 
SELECTs (Tom)"  I'm centainly not doing this kind up update, and I'm  
pretty sure slony isn't either.

On a much more benign note, I keep seeing a bunch of these in both  
slon logs for node 1 and node 2.

NOTICE:  Slony-I: cleanup stale sl_nodelock entry for pid=8572
CONTEXT:  SQL statement "SELECT  "_mobycluster".cleanupNodelock()"
         PL/pgSQL function "cleanupevent" line 77 at perform

Are they something to be worried about?


Thanks for any help in advance.




Brian Hirt



From jeff  Mon Jan 29 21:28:58 2007
From: jeff (Jeff Frost)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] Quizzical merge set error
In-Reply-To: <83770F71-2F32-4FE5-B00E-79AB7A37FC3A@pandora.com>
References: <83770F71-2F32-4FE5-B00E-79AB7A37FC3A@pandora.com>
Message-ID: <Pine.LNX.4.64.0701292127130.6795@discord.home.frostconsultingllc.com>

On Mon, 29 Jan 2007, Casey Duncan wrote:

> I recently upgraded to slony 1.2.6. We were rehearsing a database
> schema upgrade for a two node slony cluster and came across an error
> at the end. We need to avoid having the execute script do its
> exclusive locks with the application talking to the database, so we
> do it using the following dance:
>
> 1. Turn off slon daemons
> 2. Switch application to use the secondary (read-only of course)
> 3. Run the upgrade script on the primary using execute script and add
> tables & sequences into a new set and merge waiting for subscriptions
> to be confirmed (which blocks).
> 4. Switch the application back to the primary db
> 5. Turn the slon daemons back on (which unblocks #3).
>
> All was well until step #5 when we got this error:
> <stdin>:12: PGRES_FATAL_ERROR select "_radio".mergeSet(1, 9999);  -
> ERROR:  Slony-I: set 9999 has subscriptions in progress - cannot merge

Did the DDL changes complete on the slave?  I'm wondering if they got lost 
because the slon was not running at the time the DDL changes were submitted.


> 2007-01-29 16:41:56 PST ERROR  remoteWorkerThread_1: Could not find
> table "public"."new_table1" on subscriber

Does public.new_table1 actually exist on the slave?

>
> Any insights are appreciated. I'll be trying to reproduce this in a
> bit more isolated environment too.

-- 
Jeff Frost, Owner 	<jeff at frostconsultingllc.com>
Frost Consulting, LLC 	http://www.frostconsultingllc.com/
Phone: 650-780-7908	FAX: 650-649-1954

From ajs  Tue Jan 30 05:09:43 2007
From: ajs (Andrew Sullivan)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] getting postgresql server crashes with slony
In-Reply-To: <21EA85D5-ED4D-46AC-8BCF-17FF514DE6C7@mobygames.com>
References: <21EA85D5-ED4D-46AC-8BCF-17FF514DE6C7@mobygames.com>
Message-ID: <20070130130943.GC31676@phlogiston.dyndns.org>

On Mon, Jan 29, 2007 at 07:34:36PM -0700, Brian Hirt wrote:
> 
> Is it possible that slony is causing these crashes?  I think that  

It is.  With a sig11, though, your best bet is to look at the core
file that should be generated.  I assume you have compiled with
debugging symbols, and that you don't have core file generation
turned off.  If you can get a backtrace from that core file, it'd be
handy.

Are you sure, by the way, that Slony and Postgres were compiled by
the same compiler, and that Slony was compiled against the right
libraries?  It's possible to introduce a subtle incompatibility that
way.

> NOTICE:  Slony-I: cleanup stale sl_nodelock entry for pid=8572
> CONTEXT:  SQL statement "SELECT  "_mobycluster".cleanupNodelock()"
>          PL/pgSQL function "cleanupevent" line 77 at perform
> 
> Are they something to be worried about?

No.

A

-- 
Andrew Sullivan  | ajs at crankycanuck.ca
Unfortunately reformatting the Internet is a little more painful 
than reformatting your hard drive when it gets out of whack.
		--Scott Morris

From ajs  Tue Jan 30 06:35:50 2007
From: ajs (Andrew Sullivan)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] Quizzical merge set error
In-Reply-To: <83770F71-2F32-4FE5-B00E-79AB7A37FC3A@pandora.com>
References: <83770F71-2F32-4FE5-B00E-79AB7A37FC3A@pandora.com>
Message-ID: <20070130143550.GA31947@phlogiston.dyndns.org>

On Mon, Jan 29, 2007 at 05:37:08PM -0800, Casey Duncan wrote:
> 1. Turn off slon daemons
> 2. Switch application to use the secondary (read-only of course)
> 3. Run the upgrade script on the primary using execute script and add  
> tables & sequences into a new set and merge waiting for subscriptions  
> to be confirmed (which blocks).

This won't work.  You need to have the slon daemons running for a
WAIT FOR EVENT to work.  DDL _just requires_ an outage.  Sorry.

A

-- 
Andrew Sullivan  | ajs at crankycanuck.ca
This work was visionary and imaginative, and goes to show that visionary
and imaginative work need not end up well. 
		--Dennis Ritchie

From mark  Tue Jan 30 09:23:52 2007
From: mark (Mark Stosberg)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] PATCH: more altperl doc improvements
Message-ID: <epnuvu$tfe$1@sea.gmane.org>

The attach patches:
   - attempt to improve the section introducing altperl
   - integrate an altperl example into the section on configuring your
first DB for replication.

   Mark
-------------- next part --------------
A non-text attachment was scrubbed...
Name: altperl_for_setup.patch
Type: text/x-patch
Size: 2555 bytes
Desc: not available
Url : http://gborg.postgresql.org/pipermail/slony1-general/attachments/20070130/6edf439f/attachment-0002.bin 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: altperl_intro.patch
Type: text/x-patch
Size: 2569 bytes
Desc: not available
Url : http://gborg.postgresql.org/pipermail/slony1-general/attachments/20070130/6edf439f/attachment-0003.bin 

From cbbrowne  Tue Jan 30 09:38:12 2007
From: cbbrowne (Christopher Browne)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] slonik_uninstall_nodes should report which
	node errors are coming from
In-Reply-To: <epdh28$6td$1@sea.gmane.org> (Mark Stosberg's message of "Fri,
	26 Jan 2007 13:24:50 -0500")
References: <epdh28$6td$1@sea.gmane.org>
Message-ID: <603b5sifej.fsf@dba2.int.libertyrms.com>

Mark Stosberg <mark at summersault.com> writes:

> I just ran "slonik_uninstall_nodes" and got an error about a missing
> table. After I thought I fixed it, I got this response when I ran it again:
>
> root at sap# slonik_uninstall_nodes | slonik
> <stdin>:4: PGRES_FATAL_ERROR select "_ff".uninstallNode();  - ERROR:
> schema "_foo" does not exist
>
> What happened was the table error was on node 1, which is uninstalled
> /after/ node2. I think node 2 was successfully uninstalled on the first
> try.
>
> So when I re-ran the script, I think it's bombing out because node2 no
> longer exists.
>
> It would be more clearer and helpful if the feedback looked like this
> instead:
>
>  Node 2 appears to already be uninstalled. Skipping.
>  Node 1:<stdin>:4: ... (node 1 errors, if any, here).

OK, here's a patch for this...

cbbrowne at dba2:Slony-I/slony1-HEAD-pristine/src/slonik> cvs diff -u slonik.c
Index: slonik.c
===================================================================
RCS file: /usr/local/cvsroot/slony1/slony1-engine/src/slonik/slonik.c,v
retrieving revision 1.71
diff -c -u -r1.71 slonik.c
cvs diff: conflicting specifications of output style
--- slonik.c	12 Dec 2006 14:54:48 -0000	1.71
+++ slonik.c	30 Jan 2007 17:21:33 -0000
@@ -3034,6 +3034,7 @@
 				 stmt->hdr.script->clustername);
 	if (db_exec_command((SlonikStmt *) stmt, adminfo1, &query) < 0)
 	{
+    printf("Failed to run uninstallNode() for node %d\n", stmt->no_id);
 		dstring_free(&query);
 		return -1;
 	}

Output of this:
cbbrowne at dba2:Slony-I/slony1-HEAD-pristine/src/slonik> ./slonik slonik.script
slonik.script:4: PGRES_FATAL_ERROR select "_slony_regress1".uninstallNode();  - ERROR:  schema "_slony_regress1" does not exist
Failed to run uninstallNode() for node 2

This seems a reasonable change to commit, and isn't version specific.
I'll apply to 1.1, 1.2, and HEAD.
-- 
select 'cbbrowne' || '@' || 'ca.afilias.info';
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)

From mark  Tue Jan 30 10:44:43 2007
From: mark (Mark Stosberg)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] did the remove-indexes-during-initial-copy patch
	ever appear?
Message-ID: <epo3ni$iu3$1@sea.gmane.org>


This post suggested a performance improvement to the initial copy might
appear in 1.2, by removing indexes and re-applying them.

http://gborg.postgresql.org/pipermail/slony1-general/2005-June/002285.html

>From reading RELEASE-1.2.0, I didn't see a mention to that effect. Is an
optimization like this in place?

If not, is the recommended practice to drop all the non-primary-key
indexes, and then re-apply them later?

   Mark


From cbbrowne  Tue Jan 30 10:59:23 2007
From: cbbrowne (Christopher Browne)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] did the remove-indexes-during-initial-copy
 patch ever appear?
In-Reply-To: <epo3ni$iu3$1@sea.gmane.org>
References: <epo3ni$iu3$1@sea.gmane.org>
Message-ID: <45BF958B.4060000@ca.afilias.info>

Mark Stosberg wrote:
> This post suggested a performance improvement to the initial copy might
> appear in 1.2, by removing indexes and re-applying them.
>
> http://gborg.postgresql.org/pipermail/slony1-general/2005-June/002285.html
>
> >From reading RELEASE-1.2.0, I didn't see a mention to that effect. Is an
> optimization like this in place?
>
> If not, is the recommended practice to drop all the non-primary-key
> indexes, and then re-apply them later?
>   
That change is in place:

 prepareTableForCopy(tab_id) added the code:

    -- Setting pg_class.relhasindex to false will cause copy not to
    -- maintain any indexes. At the end of the copy we will reenable
    -- them and reindex the table. This bulk creating of indexes is
    -- faster.
    -- ----
    update pg_class set relhasindex = ''f'' where oid = v_tab_oid;

finishTableAfterCopy(tab_id) added:

    -- ----
    -- Reenable indexes and reindex the table.
    -- ----
    update pg_class set relhasindex = ''t'' where oid = v_tab_oid;
    execute ''reindex table '' ||
@NAMESPACE at .slon_quote_input(v_tab_fqname);

This was added in 1.1.5, before 1.2 was released...

As a result, "recommended practice" is to leave the indexes alone.

From mark  Tue Jan 30 10:58:51 2007
From: mark (Mark Stosberg)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] did the remove-indexes-during-initial-copy
	patch ever appear?
In-Reply-To: <epo3ni$iu3$1@sea.gmane.org>
References: <epo3ni$iu3$1@sea.gmane.org>
Message-ID: <epo4i2$m81$1@sea.gmane.org>

Mark Stosberg wrote:
> This post suggested a performance improvement to the initial copy might
> appear in 1.2, by removing indexes and re-applying them.
> 
> http://gborg.postgresql.org/pipermail/slony1-general/2005-June/002285.html
> 
>>From reading RELEASE-1.2.0, I didn't see a mention to that effect. Is an
> optimization like this in place?

Sorry. I think I found the answer in the FAQ:

http://slony1.projects.postgresql.org/slony1-1.2.6/doc/adminguide/faq.html#AEN5936

This appears to have been fixed in 1.1.5.

Thanks!

   Mark


From mark  Tue Jan 30 11:09:42 2007
From: mark (Mark Stosberg)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] COPY SET vs SUBSCRIBE SET is confusing
Message-ID: <epo56d$prp$1@sea.gmane.org>

Hello,

I suggest that these references that refer to "COPY SET" be updated to
refer to "SUBSCRIBE SET":

# grep -R 'COPY SET' faq.sgml slonik_ref.sgml startslons.sgml
faq.sgml:Further hurting performane, the <command>COPY SET</command> event

slonik_ref.sgml:     the <command>COPY SET</command> process winds up
doing more work than should be

startslons.sgml:initial <command>COPY SET</command>.  The problem that
came up in that

startslons.sgml:restarting slon, thereby restarting the <command>COPY
SET</command>

startslons.sgml:<command>COPY SET</command> in progress.</para>

####################

I was reading about the effects of COPY SET, and was trying to figure
out where the user interface to it was-- at what point in the process a
COPY SET happens.

As I understand, it happens only as part of issuing a "SUBSCRIBE SET".
If that's correct, the documentation would improved to consistently
refer to operation from the perspective of the user.

Referring to COPY SET without a connection to how it is triggered is
confusing.

  Mark


From cbbrowne  Tue Jan 30 11:49:12 2007
From: cbbrowne (Christopher Browne)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] PATCH: more explicitly recommend primary keys
In-Reply-To: <epb2l5$kb9$1@sea.gmane.org> (Mark Stosberg's message of "Thu,
	25 Jan 2007 15:06:39 -0500")
References: <epb2l5$kb9$1@sea.gmane.org>
Message-ID: <60r6tcgurr.fsf@dba2.int.libertyrms.com>

Mark Stosberg <mark at summersault.com> writes:
> The attached patch updates the docs about defining keys. It more
> explicitly recommends using a primary key, and provides an example
> syntax to convert a unique/not null index to a primary key.
>
> The essence of the patch has been text-ified below for easier
> peer review of grammar and accuracy.

Applied, with a few further wording changes.
http://lists.slony.info/pipermail/slony1-commit/2007-January/000041.html
-- 
output = ("cbbrowne" "@" "ca.afilias.info")
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)

From cbbrowne  Tue Jan 30 11:57:50 2007
From: cbbrowne (Christopher Browne)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] Apache-Style Profiles for FreeBSD
	ports/databases/slony/*
In-Reply-To: <20070125113749.M18034@arbitor.digitalfreaks.org> (Brian A.
	Seklecki's message of "Thu, 25 Jan 2007 11:38:30 -0500 (EST)")
References: <20070124163435.F18034@arbitor.digitalfreaks.org>
	<20070125113749.M18034@arbitor.digitalfreaks.org>
Message-ID: <60mz40gudd.fsf@dba2.int.libertyrms.com>

"Brian A. Seklecki" <lavalamp at spiritual-machines.org> writes:
> Cleaned up version:
>
> http://people.collaborativefusion.com/~seklecki/slony_rc_profiles.html

Committed, along with some [perhaps-too-brief] documentation to CVS
HEAD.

http://lists.slony.info/pipermail/slony1-commit/2007-January/000042.html
http://lists.slony.info/pipermail/slony1-commit/2007-January/000043.html
-- 
output = ("cbbrowne" "@" "ca.afilias.info")
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)

From bhirt  Tue Jan 30 13:00:05 2007
From: bhirt (Brian Hirt)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] getting postgresql server crashes with slony
In-Reply-To: <20070130130943.GC31676@phlogiston.dyndns.org>
References: <21EA85D5-ED4D-46AC-8BCF-17FF514DE6C7@mobygames.com>
	<20070130130943.GC31676@phlogiston.dyndns.org>
Message-ID: <C77056D0-6F0D-4F46-87F6-DF88FF42EA2B@mobygames.com>

Andrew,

Thanks for the response!

Unfortunately, we don't have a core from the crash.  I ended up  
uninstalling slony because the crashes happened again. I also have  
since upgraded to 8.2.1.

The next time I use slony, i'll make sure I have everything compiled  
with debugging symbols and core files enabled so that I can provide  
better feedback if things take a turn for the worse.  Until then, I  
guess there's not much either of us can do to help each other out :)

I'm sure the correct libraries were linked against and that the same  
compiler was used.

Best Regards,

Brian Hirt

On Jan 30, 2007, at 6:09 AM, Andrew Sullivan wrote:

> On Mon, Jan 29, 2007 at 07:34:36PM -0700, Brian Hirt wrote:
>>
>> Is it possible that slony is causing these crashes?  I think that
>
> It is.  With a sig11, though, your best bet is to look at the core
> file that should be generated.  I assume you have compiled with
> debugging symbols, and that you don't have core file generation
> turned off.  If you can get a backtrace from that core file, it'd be
> handy.
>
> Are you sure, by the way, that Slony and Postgres were compiled by
> the same compiler, and that Slony was compiled against the right
> libraries?  It's possible to introduce a subtle incompatibility that
> way.
>
>> NOTICE:  Slony-I: cleanup stale sl_nodelock entry for pid=8572
>> CONTEXT:  SQL statement "SELECT  "_mobycluster".cleanupNodelock()"
>>          PL/pgSQL function "cleanupevent" line 77 at perform
>>
>> Are they something to be worried about?
>
> No.
>
> A
>
> -- 
> Andrew Sullivan  | ajs at crankycanuck.ca
> Unfortunately reformatting the Internet is a little more painful
> than reformatting your hard drive when it gets out of whack.
> 		--Scott Morris
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at gborg.postgresql.org
> http://gborg.postgresql.org/mailman/listinfo/slony1-general


From mark  Tue Jan 30 13:31:19 2007
From: mark (Mark Stosberg)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] REPLICATIONUSER really needs to be super-user?
Message-ID: <epodfu$s0b$1@sea.gmane.org>


Hello,

The docs in firstdb.sgml say

"The <envar>REPLICATIONUSER</envar> needs to be a &postgres; superuser."

>From my own testing, that doesn't seem to be true. I connect as a user
that owns the database it's connecting to (and all objects in it), and
that seems to be sufficient.

I did use the PostgreSQL super-user for the dump/schema restore and
adding in the PL/pgSQL language, but it doesn't seem to be necessary
for the ongoing replication process.

(Or have I just not run into a hidden danger of not being a super-user?)

   Mark


From ajs  Tue Jan 30 13:35:55 2007
From: ajs (Andrew Sullivan)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] getting postgresql server crashes with slony
In-Reply-To: <C77056D0-6F0D-4F46-87F6-DF88FF42EA2B@mobygames.com>
References: <21EA85D5-ED4D-46AC-8BCF-17FF514DE6C7@mobygames.com>
	<20070130130943.GC31676@phlogiston.dyndns.org>
	<C77056D0-6F0D-4F46-87F6-DF88FF42EA2B@mobygames.com>
Message-ID: <20070130213555.GB561@phlogiston.dyndns.org>

On Tue, Jan 30, 2007 at 02:00:05PM -0700, Brian Hirt wrote:
> The next time I use slony, i'll make sure I have everything compiled  
> with debugging symbols and core files enabled so that I can provide  
> better feedback if things take a turn for the worse.  Until then, I  
> guess there's not much either of us can do to help each other out :)

Well, you could tell us as much as possible about the environment so
that we could try to reproduce it.  Anything that causes the back end
to crash I regard as a Very Serious Bug Indeed :-/

A

-- 
Andrew Sullivan  | ajs at crankycanuck.ca
Users never remark, "Wow, this software may be buggy and hard 
to use, but at least there is a lot of code underneath."
		--Damien Katz

From ajs  Tue Jan 30 13:40:34 2007
From: ajs (Andrew Sullivan)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] REPLICATIONUSER really needs to be super-user?
In-Reply-To: <epodfu$s0b$1@sea.gmane.org>
References: <epodfu$s0b$1@sea.gmane.org>
Message-ID: <20070130214034.GC561@phlogiston.dyndns.org>

On Tue, Jan 30, 2007 at 04:31:19PM -0500, Mark Stosberg wrote:
> >From my own testing, that doesn't seem to be true. I connect as a user
> that owns the database it's connecting to (and all objects in it), and
> that seems to be sufficient.

There are a number of pieces that work without being a superuser, as
you note.  It would be _nice_ if we worked out a system in which we
could isolate exactly those parts that actually need superuser
access, and differentiate them.  So far, there hasn't been enough
interest.

> adding in the PL/pgSQL language, but it doesn't seem to be necessary
> for the ongoing replication process.

Well, there are also postential cross-machine issues where different
permissions might come up, not to mention the DDL parts which mess
with the system tables in order to disable triggers and the like.  If
we had fully worked out when escalated permissions were needed, I
suppose we could create slony-priv and slony-nopriv interfaces, to
try to improve the security some.  It's not plain to me that this
would be a real improvement, though, since if the black hats get
access to your replication user, things have already gone well into
disaster-recovery land anyway.

A

> 
> (Or have I just not run into a hidden danger of not being a super-user?)
> 
>    Mark
> 
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at gborg.postgresql.org
> http://gborg.postgresql.org/mailman/listinfo/slony1-general

-- 
Andrew Sullivan  | ajs at crankycanuck.ca
Everything that happens in the world happens at some place.
		--Jane Jacobs 

From casey  Tue Jan 30 13:41:03 2007
From: casey (Casey Duncan)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] Quizzical merge set error
In-Reply-To: <Pine.LNX.4.64.0701292127130.6795@discord.home.frostconsultingllc.com>
References: <83770F71-2F32-4FE5-B00E-79AB7A37FC3A@pandora.com>
	<Pine.LNX.4.64.0701292127130.6795@discord.home.frostconsultingllc.com>
Message-ID: <D3D3BBFF-6C0B-4725-96E1-B3A2D2DD6883@pandora.com>


On Jan 29, 2007, at 9:28 PM, Jeff Frost wrote:

> On Mon, 29 Jan 2007, Casey Duncan wrote:
>
>> I recently upgraded to slony 1.2.6. We were rehearsing a database
>> schema upgrade for a two node slony cluster and came across an error
>> at the end. We need to avoid having the execute script do its
>> exclusive locks with the application talking to the database, so we
>> do it using the following dance:
>>
>> 1. Turn off slon daemons
>> 2. Switch application to use the secondary (read-only of course)
>> 3. Run the upgrade script on the primary using execute script and add
>> tables & sequences into a new set and merge waiting for subscriptions
>> to be confirmed (which blocks).
>> 4. Switch the application back to the primary db
>> 5. Turn the slon daemons back on (which unblocks #3).
>>
>> All was well until step #5 when we got this error:
>> <stdin>:12: PGRES_FATAL_ERROR select "_radio".mergeSet(1, 9999);  -
>> ERROR:  Slony-I: set 9999 has subscriptions in progress - cannot  
>> merge
>
> Did the DDL changes complete on the slave?  I'm wondering if they  
> got lost because the slon was not running at the time the DDL  
> changes were submitted.

Nope the slave did not get the DDL (or at least it was not  
successfully committed).

On my dev server, I was able to reproduce the same failure even with  
the slon daemons still running, so I think that pops a hole in theory  
that not having slon running is the culprit (which is fine w/me btw  
since that's a non-starter for us). Interestingly data changes made  
in the upgrade script *did* propagate to the secondary.

Any other ideas?

-Casey


From jeff  Tue Jan 30 13:42:58 2007
From: jeff (Jeff Frost)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] Quizzical merge set error
In-Reply-To: <D3D3BBFF-6C0B-4725-96E1-B3A2D2DD6883@pandora.com>
References: <83770F71-2F32-4FE5-B00E-79AB7A37FC3A@pandora.com>
	<Pine.LNX.4.64.0701292127130.6795@discord.home.frostconsultingllc.com>
	<D3D3BBFF-6C0B-4725-96E1-B3A2D2DD6883@pandora.com>
Message-ID: <Pine.LNX.4.64.0701301342120.6795@discord.home.frostconsultingllc.com>

On Tue, 30 Jan 2007, Casey Duncan wrote:

>
> Nope the slave did not get the DDL (or at least it was not successfully 
> committed).
>
> On my dev server, I was able to reproduce the same failure even with the slon 
> daemons still running, so I think that pops a hole in theory that not having 
> slon running is the culprit (which is fine w/me btw since that's a 
> non-starter for us). Interestingly data changes made in the upgrade script 
> *did* propagate to the secondary.
>

Did slonik report any errors when you submitted the DDL changes?  If so, what 
were they?  Can you find the errors regarding the DDL change in your slon 
and/or postgres logs?

-- 
Jeff Frost, Owner 	<jeff at frostconsultingllc.com>
Frost Consulting, LLC 	http://www.frostconsultingllc.com/
Phone: 650-780-7908	FAX: 650-649-1954

From andreas  Tue Jan 30 13:47:10 2007
From: andreas (Andreas Kostyrka)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] REPLICATIONUSER really needs to be super-user?
In-Reply-To: <epodfu$s0b$1@sea.gmane.org>
References: <epodfu$s0b$1@sea.gmane.org>
Message-ID: <20070130214710.GJ4703@andi-lap.la.revver.com>

* Mark Stosberg <mark at summersault.com> [070130 22:40]:
> 
> Hello,
> 
> The docs in firstdb.sgml say
> 
> "The <envar>REPLICATIONUSER</envar> needs to be a &postgres; superuser."
> 
> >From my own testing, that doesn't seem to be true. I connect as a user
> that owns the database it's connecting to (and all objects in it), and
> that seems to be sufficient.
> 
> I did use the PostgreSQL super-user for the dump/schema restore and
> adding in the PL/pgSQL language, but it doesn't seem to be necessary
> for the ongoing replication process.
> 
> (Or have I just not run into a hidden danger of not being a super-user?)

Well, sarcastically speaking, yes.

slony does catalog manipulations on the slaves (to disable triggers),
and I'm not sure if you can do that without being a superuser.

Andreas

From cbbrowne  Tue Jan 30 13:54:57 2007
From: cbbrowne (Christopher Browne)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] REPLICATIONUSER really needs to be super-user?
In-Reply-To: <epodfu$s0b$1@sea.gmane.org> (Mark Stosberg's message of "Tue,
	30 Jan 2007 16:31:19 -0500")
References: <epodfu$s0b$1@sea.gmane.org>
Message-ID: <60ireogoy6.fsf@dba2.int.libertyrms.com>

Mark Stosberg <mark at summersault.com> writes:
> The docs in firstdb.sgml say
>
> "The <envar>REPLICATIONUSER</envar> needs to be a &postgres; superuser."
>
>>From my own testing, that doesn't seem to be true. I connect as a user
> that owns the database it's connecting to (and all objects in it), and
> that seems to be sufficient.
>
> I did use the PostgreSQL super-user for the dump/schema restore and
> adding in the PL/pgSQL language, but it doesn't seem to be necessary
> for the ongoing replication process.
>
> (Or have I just not run into a hidden danger of not being a super-user?)

Most of the time, it does not need to have superuser access.

However, any time schema alterations need to be done, it most
certainly does.

We can point to those moments with some comprehensiveness:
- When installing Slony-I on a node (INIT CLUSTER/STORE NODE)
- When asking to replicate a table (SET ADD TABLE)
- When manipulating subscriptions (SUBSCRIBE SET, MOVE SET, DROP SET)
- DDL (EXECUTE SCRIPT)

It might very well be an interesting project to modify Slony-I to try
to minimize its use of privileges.  That is, to use two users, one
with fairly minimal permissions, and one that is an all-reaching
superuser.  Only those events requiring a superuser would be invoked
by that user.

This would introduce some new complexity in that connections would
need to get opened and closed somewhat more frequently, since certain
events would require superuser access much as others wouldn't.

The perceived increased safety might make this effort worthwhile to
some would-be developer or sponsor.

It seems to me that it would probably be reasonable to do the
partitioning on the basis of events, that is, which events require
superuser access, and which events do not.
-- 
"cbbrowne","@","ca.afilias.info"
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)

From casey  Tue Jan 30 14:56:05 2007
From: casey (Casey Duncan)
Date: Tue Feb 13 08:24:23 2007
Subject: [Slony1-general] Quizzical merge set error (solved)
In-Reply-To: <Pine.LNX.4.64.0701301342120.6795@discord.home.frostconsultingllc.com>
References: <83770F71-2F32-4FE5-B00E-79AB7A37FC3A@pandora.com>
	<Pine.LNX.4.64.0701292127130.6795@discord.home.frostconsultingllc.com>
	<D3D3BBFF-6C0B-4725-96E1-B3A2D2DD6883@pandora.com>
	<Pine.LNX.4.64.0701301342120.6795@discord.home.frostconsultingllc.com>
Message-ID: <F8A05E04-7844-4DD1-9120-B87463740CB2@pandora.com>

On Jan 30, 2007, at 1:42 PM, Jeff Frost wrote:

> On Tue, 30 Jan 2007, Casey Duncan wrote:
>
>>
>> Nope the slave did not get the DDL (or at least it was not  
>> successfully committed).
>>
>> On my dev server, I was able to reproduce the same failure even  
>> with the slon daemons still running, so I think that pops a hole  
>> in theory that not having slon running is the culprit (which is  
>> fine w/me btw since that's a non-starter for us). Interestingly  
>> data changes made in the upgrade script *did* propagate to the  
>> secondary.
>>
>
> Did slonik report any errors when you submitted the DDL changes?   
> If so, what were they?  Can you find the errors regarding the DDL  
> change in your slon and/or postgres logs?

It turned out to be a logic error in my upgrade script. Mistakes were  
made, the persons responsible have been disciplined.

Thanks for the help, sorry for the distraction.

-Casey


