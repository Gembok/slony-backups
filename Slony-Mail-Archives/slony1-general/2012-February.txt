From francescoboccacci at libero.it  Thu Feb  2 05:30:18 2012
From: francescoboccacci at libero.it (francescoboccacci at libero.it)
Date: Thu, 2 Feb 2012 14:30:18 +0100 (CET)
Subject: [Slony1-general] change password
Message-ID: <10925035.957191328189418573.JavaMail.defaultUser@defaultHost>

Hi,
I?m using a Postgresql database version: 8.4 and I have some tables in replica 
between two servers with slony 2.0.6.
I need, for security issues, to change the password of the master database. Is 
there a way to change the password stored in the cluster without stopping the 
replica and start again from the beginning? 

Thank you

Francesco

From rajjmalhotra25 at yahoo.com  Thu Feb  2 09:13:35 2012
From: rajjmalhotra25 at yahoo.com (Raj Malhotra)
Date: Thu, 2 Feb 2012 09:13:35 -0800 (PST)
Subject: [Slony1-general] What is the behavior of slony wait for event after
	lock set command.
Message-ID: <1328202815.77163.YahooMailNeo@web122511.mail.ne1.yahoo.com>

We are trying  to do a swith over and it is taking a lot of time. 


We are following the following steps to perform switchover:
	1. Lock Set
	2. Wait for Event (timout = 300)
	3. Move Set (timeout = 300)
	4. Wait for Event (timout = 300)
The alt perl script we have with slony source has the following sequence:
	1. Lock Set
	2. Sync
	3. Wait for Event
	4. Move Set
What should be the correct sequence of event and how can I make switchover faster.

Regards
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20120202/1bdeb137/attachment.htm 

From cbbrowne at afilias.info  Thu Feb  2 11:27:25 2012
From: cbbrowne at afilias.info (Christopher Browne)
Date: Thu, 2 Feb 2012 14:27:25 -0500
Subject: [Slony1-general] change password
In-Reply-To: <10925035.957191328189418573.JavaMail.defaultUser@defaultHost>
References: <10925035.957191328189418573.JavaMail.defaultUser@defaultHost>
Message-ID: <CANfbgbbuDw8RxHodYRr-7hV=fgGapQSDQFHLi48kr6Dbth-7iw@mail.gmail.com>

Sure, you can submit STORE PATH with the new password, and that will
propagate across the cluster.  (Likely several requests, one for each
communications path.)

It is considered better form to use a .pgpass file, so passwords are not
visible in slony configuration altogether.

You will also need to revise the configuration used to launch slon
processes.  Look for slon.conf in the documentation.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20120202/61d1bb1f/attachment.htm 

From ssinger at ca.afilias.info  Thu Feb  2 17:00:25 2012
From: ssinger at ca.afilias.info (Steve Singer)
Date: Thu, 02 Feb 2012 20:00:25 -0500
Subject: [Slony1-general] Slony-I 2.1.1 & 1.2.23 released
Message-ID: <4F2B31A9.2050602@ca.afilias.info>

The Slony-I team is pleased to announce the release of Slony-I 2.1.1
a bug fix release for the 2.1 stream. and Slony-I 1.2.23 a bug fix 
release in the 1.2 stream.


2.1.1
=============

- Bug #260 :: Fixed issue when with FAILOVER command when the failed 
node has multiple sets.

- Bug #246 :: Include path order changes
- Bug #161 :: fix memory overrun in EXECUTE SCRIPT parser
- Bug #247 :: slony_logshipper to handle TRUNCATE commands
- Bug #249 :: Add parentheses to txid_current() in function for
               TRUNCATE logging
- slonik_drop_table and slonik_drop_sequence no longer attempt to
   return -1 on an error (invalid as a slonik exit code in 2.1)
- Bug #244 :: The CREATE SET command now requires a set id to be specified.
- Bug #255 :: Fix serialization conflict issues when using PostgreSQL 9.1.
- Bug #256 :: set_conf_option() has an extra elevel parameter on PG 9.2
- Bug #259 :: Fix TRUNCATE logging so it works with mixed case slony 
clusters.

http://www.slony.info/downloads/2.1/source/slony1-2.1.1.tar.bz2
http://www.slony.info/downloads/2.1/source/slony1-2.1.1-docs.tar.bz2


1.2.23
===========
- Bug #195 - make slon_quote_* functions immutable
- Bug #209 - dollar quoting doesn't work on PG 7.4
- Bug #224 - PKEYEDTABLES misspelled in altperl script
- Bug #236 - fix misformatting of log string for timestamp
- Bug #239 - Fix FAILOVER on PG 9.0 by not querying pg_listener

http://www.slony.info/downloads/1.2/source/slony1-1.2.23.tar.bz2
http://www.slony.info/downloads/1.2/source/slony1-1.2.23-docs.tar.bz2

Unless additional maintainers from the community step up 1.2.23 is 
likely to be the last 1.2.x release.


From ssinger at ca.afilias.info  Thu Feb  2 17:16:02 2012
From: ssinger at ca.afilias.info (Steve Singer)
Date: Thu, 02 Feb 2012 20:16:02 -0500
Subject: [Slony1-general] Slony 2.0.x and PostgreSQL 9.1
Message-ID: <4F2B3552.9000007@ca.afilias.info>

Those of you paying attention noticed that I just released 1.2.23 and 
2.1.1 but not 2.0.8

We had applied the fix for bug #255 the 'serialization conflicts with 
PostgreSQL 9.1' on the 2.0 branch in addition to the 2.1 branch.

When testing 2.0.8 RC2 I noticed that once in a while the disorder - 
"MoveSet" test in the clustertest framework gave me failures where the 
nodes could end up with different data.   The MoveSet test does 11 move 
sets between nodes in the cluster.  If I run the MoveSet test in a loop 
10 times I would typicaly get one failed test run.

On the version before the bug #255 commit I was never able to reproduce 
that failure on many runs.

I have also not been able to reproduce that failure on the 2.1.1 with 
which includes a fix for #255. (which is why I released 2.1.1)

(All of the above is with PostgreSQL 9.1).

My inclination is to take out the fix for #255 from 2.0.8 and also put 
back in the warning about 9.1 "might be unsupported" that you would see 
with 2.0.7.

We can also leave the bug #255 fix in and put the warning back.

If someone can figure out why this is failing in 2.0 then we do talk 
about addressing that.  I can't rule out it being a problem in the test 
itself, but nothing pops out at me  (A version of the disorder tests 
back-ported to 2.0 can be found at 
https://github.com/ssinger/slony1-engine/tree/REL_2_0_STABLE-clustertest)


From francescoboccacci at libero.it  Fri Feb  3 01:31:40 2012
From: francescoboccacci at libero.it (francescoboccacci at libero.it)
Date: Fri, 3 Feb 2012 10:31:40 +0100 (CET)
Subject: [Slony1-general] R: Re:  change password
Message-ID: <32495585.22084061328261500476.JavaMail.defaultUser@defaultHost>

Thanks , i'll try and i let you know.



----Messaggio originale----

Da: cbbrowne at afilias.info

Data: 02/02/2012 20.27

A: "francescoboccacci at libero.it"<francescoboccacci at libero.it>

Cc: <slony1-general at lists.slony.info>

Ogg: Re: [Slony1-general] change password




Sure, you can submit STORE PATH with the new password, and that will propagate across the cluster.  (Likely several requests, one for each communications path.)

It is considered better form to use a .pgpass file, so passwords are not visible in slony configuration altogether.

You will also need to revise the configuration used to launch slon processes.  Look for slon.conf in the documentation. 




-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20120203/5f3460f5/attachment.htm 

From efraindector at motumweb.com  Wed Feb 15 11:28:59 2012
From: efraindector at motumweb.com (=?utf-8?Q?Efra=C3=ADn_D=C3=A9ctor?=)
Date: Wed, 15 Feb 2012 13:28:59 -0600
Subject: [Slony1-general] Cascading replication using altperl scripts.
Message-ID: <CF3E1A49FFAA4204A0F503E17D390913@CMOTUM25PC>

Hello list:

My name is Efrain and this week I?ve been using Slony-I, with the help of the documentation I?ve been able to setup replication between 2 nodes using slonik scripts and also with altperl scripts. For me, using altperl scritps is more comfortable but now I?m stucked trying to set cascading replication. I have this in mind:

    A1 ?> B1 ?> B2

Meaning that A1 would be the master to B1 but also B1 would be master of B2. My slon_tools.conf looks like this:

add_node(node     => 1,
         host     => '192.168.1.231',
         dbname   => 'prueba',
         port     => 5432,
         user     => 'postgres',
         password => '1');

add_node(node     => 2,
         host     => '192.168.1.232',
         dbname   => 'prueba',
         port     => 5432,
         noforward => allow,
         user     => 'pgsql',
         password => '2');

add_node(node     => 3,
         parent   => 2,
         host     => '192.168.1.233',
         dbname   => 'prueba',
         port     => 5432,
         user     => 'pgsql',
         password => '3');

I understand that B1 shall be configured to accept forward but I don?t now how to do this.

Any help would be really appreciated.

Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20120215/0e47fe48/attachment.htm 

From smccloud at geo-comm.com  Thu Feb 16 07:59:05 2012
From: smccloud at geo-comm.com (Shaun McCloud)
Date: Thu, 16 Feb 2012 15:59:05 +0000
Subject: [Slony1-general] Slony not replicating changes
Message-ID: <7742DD496427B743BC8B7BBF6D380BA0373B683F@EXCHANGE10.geo-comm.local>

Hello,

I'm working on a project where we are using pg_dump to get the data out of one database and then using psql to load it into another.  The second database is the master db in a Slony replication cluster.  However, no matter what options I specify in pg_dump the changes are not being replicated.  I've use a standard dump which uses COPY, a --inserts dump which uses insert into & a --insert-columns dump which adds column names to the insert into statements.  However, if I edit the data in pgAdmin III using the view option for the table, that change is replicated just fine.  What is the difference between editing the data that way in pgAdmin III and using psql to load a dump file?

Shaun McCloud - Associate Software Developer
Geo-Comm, Inc
601 W. Saint Germain St., Saint Cloud, MN 56301
Office: 320.240.0040 Fax: 320.240.2389 Toll Free: 888.436.2666
click here to visit www.geo-comm.com<http://www.geo-comm.com/>
[cid:image001.jpg at 01CCEC91.9D9BFAC0]<http://www.linkedin.com/companies/geocomm> [cid:image002.jpg at 01CCEC91.9D9BFAC0] <http://twitter.com/_geocomm>
P Think before you print!
Microsoft Certified Desktop Support Technician (MCDST)
Do or do not, there is no try.
    -Yoda

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20120216/63620cd7/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 1129 bytes
Desc: image001.jpg
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20120216/63620cd7/attachment.jpg 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.jpg
Type: image/jpeg
Size: 1068 bytes
Desc: image002.jpg
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20120216/63620cd7/attachment-0001.jpg 

From glynastill at yahoo.co.uk  Thu Feb 16 08:38:12 2012
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Thu, 16 Feb 2012 16:38:12 +0000 (GMT)
Subject: [Slony1-general] Slony not replicating changes
In-Reply-To: <7742DD496427B743BC8B7BBF6D380BA0373B683F@EXCHANGE10.geo-comm.local>
References: <7742DD496427B743BC8B7BBF6D380BA0373B683F@EXCHANGE10.geo-comm.local>
Message-ID: <1329410292.58988.YahooMailNeo@web171408.mail.ir2.yahoo.com>

Is there any possibility you made your dump with --disable-triggers ?




>________________________________
> From: Shaun McCloud <smccloud at geo-comm.com>
>To: "slony1-general at lists.slony.info" <slony1-general at lists.slony.info> 
>Sent: Thursday, 16 February 2012, 15:59
>Subject: [Slony1-general] Slony not replicating changes
> 
>
> 
>Hello,
>?
>I?m working on a project where we are using pg_dump to get the data out of one database and then using psql to load it into another.? The second database is the master db in a Slony replication cluster.? However, no matter what options I specify in pg_dump the changes are not being replicated.? I?ve use a standard dump which uses COPY, a --inserts dump which uses insert into & a --insert-columns dump which adds column names to the insert into statements.? However, if I edit the data in pgAdmin III using the view option for the table, that change is replicated just fine.? What is the difference between editing the data that way in pgAdmin III and using psql to load a dump file?
>?
>Shaun McCloud ? Associate Software Developer
>Geo-Comm, Inc
>601 W. Saint Germain St., Saint Cloud, MN 56301
>Office: 320.240.0040 Fax: 320.240.2389 Toll Free: 888.436.2666
>click here to visit www.geo-comm.com 
>PThink before you print!
>Microsoft Certified Desktop Support Technician (MCDST) 
>Do or do not, there is no try.
>??? -Yoda
>?
>_______________________________________________
>Slony1-general mailing list
>Slony1-general at lists.slony.info
>http://lists.slony.info/mailman/listinfo/slony1-general
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20120216/faf82257/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 1129 bytes
Desc: image001.jpg
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20120216/faf82257/attachment.jpg 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.jpg
Type: image/jpeg
Size: 1068 bytes
Desc: image002.jpg
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20120216/faf82257/attachment-0001.jpg 

From smccloud at geo-comm.com  Fri Feb 17 06:30:24 2012
From: smccloud at geo-comm.com (Shaun McCloud)
Date: Fri, 17 Feb 2012 14:30:24 +0000
Subject: [Slony1-general] Slony not replicating changes
Message-ID: <7742DD496427B743BC8B7BBF6D380BA0373D145F@EXCHANGE10.geo-comm.local>

Glyn,

My code is not creating the dump with --disable-triggers.  So far, I have only been able to get messages to replicate if I use the view option in pgAdmin III or ESRI's ArcCatalog to edit the data (it is GIS data stored with PostGIS types).

Shaun McCloud - Associate Software Developer
Geo-Comm, Inc
601 W. Saint Germain St., Saint Cloud, MN 56301
Office: 320.240.0040 Fax: 320.240.2389 Toll Free: 888.436.2666
click here to visit www.geo-comm.com<http://www.geo-comm.com/>
[cid:image001.jpg at 01CCED4E.64C7F600]<http://www.linkedin.com/companies/geocomm> [cid:image002.jpg at 01CCED4E.64C7F600] <http://twitter.com/_geocomm>
P Think before you print!
Microsoft Certified Desktop Support Technician (MCDST)
Do or do not, there is no try.
    -Yoda

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20120217/5a5dd9c7/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 1129 bytes
Desc: image001.jpg
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20120217/5a5dd9c7/attachment.jpg 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.jpg
Type: image/jpeg
Size: 1068 bytes
Desc: image002.jpg
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20120217/5a5dd9c7/attachment-0001.jpg 

From greg at endpoint.com  Fri Feb 17 08:44:41 2012
From: greg at endpoint.com (Greg Sabino Mullane)
Date: Fri, 17 Feb 2012 11:44:41 -0500
Subject: [Slony1-general] Slony not replicating changes
In-Reply-To: <7742DD496427B743BC8B7BBF6D380BA0373D145F@EXCHANGE10.geo-comm.local>
References: <7742DD496427B743BC8B7BBF6D380BA0373D145F@EXCHANGE10.geo-comm.local>
Message-ID: <20120217164441.GM2889@tinybird.home>

On Fri, Feb 17, 2012 at 02:30:24PM +0000, Shaun McCloud wrote:
> My code is not creating the dump with --disable-triggers.

There are very few things it could be then. If it works in other 
situations, that means the Slony triggers are enabled and working 
on the tables, which rules out one possibility. Open the pg_dump 
output in a text editor and make sure it is using INSERTs, and that 
there is nothing funny at the top of the script (e.g. changing 
the session_replication_role or disabling triggers). Also, I'm 
assuming this is a --data-only pg_dump? Finally, make sure your are 
loading the output into the correct database and that no 
search_path/schema tweaks could be affecting things.

If all else fails, see if you can create a simple test case (e.g. 
pg_dump a single small table) and post it here.

-- 
Greg Sabino Mullane greg at endpoint.com
End Point Corporation
PGP Key: 0x14964AC8
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 163 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20120217/48b3a139/attachment.pgp 

From smccloud at geo-comm.com  Fri Feb 17 08:52:06 2012
From: smccloud at geo-comm.com (Shaun McCloud)
Date: Fri, 17 Feb 2012 16:52:06 +0000
Subject: [Slony1-general] Slony not replicating changes
In-Reply-To: <20120217164441.GM2889@tinybird.home>
References: <7742DD496427B743BC8B7BBF6D380BA0373D145F@EXCHANGE10.geo-comm.local>
	<20120217164441.GM2889@tinybird.home>
Message-ID: <7742DD496427B743BC8B7BBF6D380BA0373D15E1@EXCHANGE10.geo-comm.local>

Greg,

Due to performance reasons we are using a COPY command now (INSERT INTO was just for testing).  With some of our tables having 5 milling + records we want it to go as fast as.  You are correct in assuming it is a --data-only dump.  Before the first COPY statement the dump contains the following.

SET client_encoding = 'UTF8';
SET standard_conforming_strings = off;
SET check_function_bodies = false;
SET client_min_messages = warning;
SET escape_string_warning = off;
SET search_path = sde, pg_catalog;

I have had the data replicate correctly once when loading the data for a single table using COPY, but not since then.  I get the following statistics for the slave node.

Last event - 465
Last event timestamp - 2/17/2012 10:49:46
Last acknowledged - 56
Last ack timestamp - 2/17/2012 09:20:05
Last response time - 0.016 s
Outstand acks - 409
No ack for - 01:29:41.127
Hanging event - 57
Command - SYNC

Also, I'm not sure if it matters; but we are using two engines for one Slony-I service.  One for mostly static data and one for data that can change quite often.  Each engine has its own DB and the data that can change quite often is always replicating fine, but it is always edited using ESRI's Arc Map at some point in the process.

Shaun McCloud ? Associate Software Developer
Geo-Comm, Inc
601 W. Saint Germain St., Saint Cloud, MN 56301
Office: 320.240.0040 Fax: 320.240.2389 Toll Free: 888.436.2666
click here to visit www.geo-comm.com
 
? Think before you print!
Microsoft Certified Desktop Support Technician (MCDST) 
Do or do not, there is no try.
    -Yoda

-----Original Message-----
From: Greg Sabino Mullane [mailto:greg at endpoint.com] 
Sent: Friday, February 17, 2012 10:45
To: Shaun McCloud
Cc: slony1-general at lists.slony.info
Subject: Re: [Slony1-general] Slony not replicating changes

On Fri, Feb 17, 2012 at 02:30:24PM +0000, Shaun McCloud wrote:
> My code is not creating the dump with --disable-triggers.

There are very few things it could be then. If it works in other situations, that means the Slony triggers are enabled and working on the tables, which rules out one possibility. Open the pg_dump output in a text editor and make sure it is using INSERTs, and that there is nothing funny at the top of the script (e.g. changing the session_replication_role or disabling triggers). Also, I'm assuming this is a --data-only pg_dump? Finally, make sure your are loading the output into the correct database and that no search_path/schema tweaks could be affecting things.

If all else fails, see if you can create a simple test case (e.g. 
pg_dump a single small table) and post it here.

--
Greg Sabino Mullane greg at endpoint.com
End Point Corporation
PGP Key: 0x14964AC8

From greg at endpoint.com  Sun Feb 19 04:40:37 2012
From: greg at endpoint.com (Greg Sabino Mullane)
Date: Sun, 19 Feb 2012 07:40:37 -0500
Subject: [Slony1-general] Slony not replicating changes
In-Reply-To: <7742DD496427B743BC8B7BBF6D380BA0373D15E1@EXCHANGE10.geo-comm.local>
References: <7742DD496427B743BC8B7BBF6D380BA0373D145F@EXCHANGE10.geo-comm.local>
	<20120217164441.GM2889@tinybird.home>
	<7742DD496427B743BC8B7BBF6D380BA0373D15E1@EXCHANGE10.geo-comm.local>
Message-ID: <20120219124036.GV2889@tinybird.home>

On Fri, Feb 17, 2012 at 04:52:06PM +0000, Shaun McCloud wrote:
> Before the first COPY statement the dump contains the following.
> 
> SET client_encoding = 'UTF8';
> SET standard_conforming_strings = off;
> SET check_function_bodies = false;
> SET client_min_messages = warning;
> SET escape_string_warning = off;
> SET search_path = sde, pg_catalog;

Nothing unusual there.

> I have had the data replicate correctly once when loading the data for 
> a single table using COPY, but not since then. 

Well I cannot see any other obvious problems, so I would suggest 
seeing if you can get that single table COPY pg_dump to work 
again, then expand the scope (if working) or narrow the scope (if not).

> Also, I'm not sure if it matters; but we are using two engines for one 
> Slony-I service.  One for mostly static data and one for data that can 
> change quite often.  Each engine has its own DB and the data that can 
> change quite often is always replicating fine, but it is always edited 
> using ESRI's Arc Map at some point in the process.

Ah, that could certainly be a factor - can you explain the layout a bit 
more to the list?

-- 
Greg Sabino Mullane greg at endpoint.com
End Point Corporation
PGP Key: 0x14964AC8
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 163 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20120219/07627f89/attachment.pgp 

From ngramsky at cs.umd.edu  Mon Feb 20 08:45:05 2012
From: ngramsky at cs.umd.edu (NewToSlony)
Date: Mon, 20 Feb 2012 08:45:05 -0800 (PST)
Subject: [Slony1-general]  Syntax error?
Message-ID: <33357837.post@talk.nabble.com>


Hi,

I'm trying to use the example in the 2.1.1 documentation but I keep getting
a syntax error.  I've noted that the doc shows 
cluster name = $CLUSTERNAME;
is a valid syntax but unless I change the $ to a @ I get a syntax error,
thus as I'm new and unsure I don't know if there are errors in the
documentation or something I am missing.  Never the less, my script as as
follows:


#!/bin/sh

CLUSTERNAME= slony_example;
/opt/local/lib/postgresql90/bin/slonik <<_EOL_
define CLUSTERNAME slony_example;
cluster name = @CLUSTERNAME;
node 1 admin conninfo = 'dbname=my_primary host=localhost user=user'; 
node 2 admin conninfo = 'dbname=my_rep host=localhost user=user';
#-- 
# init the first node. Its id MUST be 1. This creates the schema #
_$CLUSTERNAME containing all replication system specific database # objects.
#-- 
init cluster ( id=1, comment='Master Node');
#--
# Slony-I organizes tables into sets. The smallest unit a node can #
subscribe is a set. The following commands create one set containing # all 4
pgbench tables. The master or origin of the set is node 1. 
#-- 
create set (id=1, origin=1, comment='All pgbench tables'); 
set add table (set id=1, origin=1, id=1, fully qualified
name='public.pgbench_accounts', comment='accounts table'); 
set add table (set id=1, origin=1, id=2, fully qualified
name='public.pgbench_branches', comment='branches table'); 
set add table (set id=1, origin=1, id=3, fully qualified
name='public.pgbench_tellers', comment='tellers table'); 
set add table (set id=1, origin=1, id=4, fully qualified
name='public.pgbench_history', comment='history table');
#-- 
# Create the second node (the slave) tell the 2 nodes how to connect to
Slony-I 2.1.1 Documentation 10 / 163
# each other and how they should listen for events.
#--
store node (id=2, comment = 'Slave node', event node=1);
store path (server = 1, client = 2, conninfo='dbname=my_primary
host=localhost user=user');
store path (server = 2, client = 1, conninfo='dbname=my_rep host=localhost
user=user');
_EOF_


Yet I get the following syntax error:


/tmp/slonik_example.sh: line 3: slony_example: command not found
<stdin>:24: ERROR: syntax error at or near _EOF_

-- 
View this message in context: http://old.nabble.com/Syntax-error--tp33357837p33357837.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.


From efraindector at motumweb.com  Mon Feb 20 09:56:23 2012
From: efraindector at motumweb.com (=?iso-8859-1?Q?Efra=EDn_D=E9ctor?=)
Date: Mon, 20 Feb 2012 11:56:23 -0600
Subject: [Slony1-general] Syntax error?
In-Reply-To: <33357837.post@talk.nabble.com>
References: <33357837.post@talk.nabble.com>
Message-ID: <4E6FA67E54034BA294B3DB3660A34B8D@CMOTUM25PC>

Delete the _EOF_ at the end of the script.

-----Mensaje original----- 
From: NewToSlony
Sent: Monday, February 20, 2012 10:45 AM
To: slony1-general at lists.slony.info
Subject: [Slony1-general] Syntax error?


Hi,

I'm trying to use the example in the 2.1.1 documentation but I keep getting
a syntax error.  I've noted that the doc shows
cluster name = $CLUSTERNAME;
is a valid syntax but unless I change the $ to a @ I get a syntax error,
thus as I'm new and unsure I don't know if there are errors in the
documentation or something I am missing.  Never the less, my script as as
follows:


#!/bin/sh

CLUSTERNAME= slony_example;
/opt/local/lib/postgresql90/bin/slonik <<_EOL_
define CLUSTERNAME slony_example;
cluster name = @CLUSTERNAME;
node 1 admin conninfo = 'dbname=my_primary host=localhost user=user';
node 2 admin conninfo = 'dbname=my_rep host=localhost user=user';
#-- 
# init the first node. Its id MUST be 1. This creates the schema #
_$CLUSTERNAME containing all replication system specific database # objects.
#-- 
init cluster ( id=1, comment='Master Node');
#--
# Slony-I organizes tables into sets. The smallest unit a node can #
subscribe is a set. The following commands create one set containing # all 4
pgbench tables. The master or origin of the set is node 1.
#-- 
create set (id=1, origin=1, comment='All pgbench tables');
set add table (set id=1, origin=1, id=1, fully qualified
name='public.pgbench_accounts', comment='accounts table');
set add table (set id=1, origin=1, id=2, fully qualified
name='public.pgbench_branches', comment='branches table');
set add table (set id=1, origin=1, id=3, fully qualified
name='public.pgbench_tellers', comment='tellers table');
set add table (set id=1, origin=1, id=4, fully qualified
name='public.pgbench_history', comment='history table');
#-- 
# Create the second node (the slave) tell the 2 nodes how to connect to
Slony-I 2.1.1 Documentation 10 / 163
# each other and how they should listen for events.
#--
store node (id=2, comment = 'Slave node', event node=1);
store path (server = 1, client = 2, conninfo='dbname=my_primary
host=localhost user=user');
store path (server = 2, client = 1, conninfo='dbname=my_rep host=localhost
user=user');
_EOF_


Yet I get the following syntax error:


/tmp/slonik_example.sh: line 3: slony_example: command not found
<stdin>:24: ERROR: syntax error at or near _EOF_

-- 
View this message in context: 
http://old.nabble.com/Syntax-error--tp33357837p33357837.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.

_______________________________________________
Slony1-general mailing list
Slony1-general at lists.slony.info
http://lists.slony.info/mailman/listinfo/slony1-general 


From smccloud at geo-comm.com  Tue Feb 21 06:25:39 2012
From: smccloud at geo-comm.com (Shaun McCloud)
Date: Tue, 21 Feb 2012 14:25:39 +0000
Subject: [Slony1-general] Slony not replicating changes
In-Reply-To: <20120219124036.GV2889@tinybird.home>
References: <7742DD496427B743BC8B7BBF6D380BA0373D145F@EXCHANGE10.geo-comm.local>
	<20120217164441.GM2889@tinybird.home>
	<7742DD496427B743BC8B7BBF6D380BA0373D15E1@EXCHANGE10.geo-comm.local>
	<20120219124036.GV2889@tinybird.home>
Message-ID: <7742DD496427B743BC8B7BBF6D380BA0373D3A7C@EXCHANGE10.geo-comm.local>

Greg, I populated one table with 100000 bogus records and that worked fine.  If I add a second table it stops working.

The setup is as follows.  We use ESRI replication technology to get data from one ArcSDE instance into a PostgreSQL + PostGIS ArcSDE instance on our server.  We then do a data only pg_dump on that database and a psql load on our "live" database.  Slony is then supposed to replicate the data out to the "live" database on our other servers.  The problem is occurring on the last step :(

Shaun McCloud ? Associate Software Developer
Geo-Comm, Inc
601 W. Saint Germain St., Saint Cloud, MN 56301
Office: 320.240.0040 Fax: 320.240.2389 Toll Free: 888.436.2666
click here to visit www.geo-comm.com
 
? Think before you print!
Microsoft Certified Desktop Support Technician (MCDST) 
Do or do not, there is no try.
    -Yoda

-----Original Message-----
From: Greg Sabino Mullane [mailto:greg at endpoint.com] 
Sent: Sunday, February 19, 2012 06:41
To: Shaun McCloud
Cc: slony1-general at lists.slony.info
Subject: Re: [Slony1-general] Slony not replicating changes

On Fri, Feb 17, 2012 at 04:52:06PM +0000, Shaun McCloud wrote:
> Before the first COPY statement the dump contains the following.
> 
> SET client_encoding = 'UTF8';
> SET standard_conforming_strings = off; SET check_function_bodies = 
> false; SET client_min_messages = warning; SET escape_string_warning = 
> off; SET search_path = sde, pg_catalog;

Nothing unusual there.

> I have had the data replicate correctly once when loading the data for 
> a single table using COPY, but not since then.

Well I cannot see any other obvious problems, so I would suggest seeing if you can get that single table COPY pg_dump to work again, then expand the scope (if working) or narrow the scope (if not).

> Also, I'm not sure if it matters; but we are using two engines for one 
> Slony-I service.  One for mostly static data and one for data that can 
> change quite often.  Each engine has its own DB and the data that can 
> change quite often is always replicating fine, but it is always edited 
> using ESRI's Arc Map at some point in the process.

Ah, that could certainly be a factor - can you explain the layout a bit more to the list?

--
Greg Sabino Mullane greg at endpoint.com
End Point Corporation
PGP Key: 0x14964AC8

From ngramsky at cs.umd.edu  Tue Feb 21 08:41:15 2012
From: ngramsky at cs.umd.edu (NewToSlony)
Date: Tue, 21 Feb 2012 08:41:15 -0800 (PST)
Subject: [Slony1-general] Cannot find slony1_funcs on macos despite lib in
 place
Message-ID: <33365133.post@talk.nabble.com>


Trying to run the example slony config script in the documentation but
getting the following error:


postgres$ /tmp/slonik_example.sh
<stdin>:8: PGRES_FATAL_ERROR load '$libdir/slony1_funcs';  - ERROR:  could
not access file "$libdir/slony1_funcs": No such file or directory
<stdin>:8: Error: the extension for the Slony-I C functions cannot be loaded
in database 'dbname=my_primary host=localhost user=warfish
password=coalitions'

Yet the LIBDIR variable is set correctly:
postgres$ ./pg_config
BINDIR = /opt/local/lib/postgresql90/bin
DOCDIR = /opt/local/share/doc/postgresql
HTMLDIR = /opt/local/share/doc/postgresql
INCLUDEDIR = /opt/local/include/postgresql90
PKGINCLUDEDIR = /opt/local/include/postgresql90
INCLUDEDIR-SERVER = /opt/local/include/postgresql90/server
LIBDIR = /opt/local/lib/postgresql90

And the lib is present:

ls -l /opt/local/lib/postgresql90/slony1_funcs.so
-rwxr-xr-x  1 root  admin  34944 Feb 17 16:20
/opt/local/lib/postgresql90/slony1_funcs.so


Script is as follows:

cat /tmp/slonik_example.sh
#!/bin/sh

CLUSTERNAME=slony_example;
/opt/local/lib/postgresql90/bin/slonik <<_EOF_
define CLUSTERNAME slony_example;
cluster name = @CLUSTERNAME;
node 1 admin conninfo = 'dbname=my_primary host=localhost user=user1
password=pw'; 
node 2 admin conninfo = 'dbname=my_rep host=localhost user=user1
password=pw';
#-- 
# init the first node. Its id MUST be 1. This creates the schema #
_$CLUSTERNAME containing all replication system specific database # objects.
#-- 
init cluster ( id=1, comment='Master Node');
#--
# Slony-I organizes tables into sets. The smallest unit a node can #
subscribe is a set. The following commands create one set containing # all 4
pgbench tables. The master or origin of the set is node 1. 
#-- 
create set (id=1, origin=1, comment='All pgbench tables'); 
set add table (set id=1, origin=1, id=1, fully qualified
name='public.pgbench_accounts', comment='accounts table'); 
set add table (set id=1, origin=1, id=2, fully qualified
name='public.pgbench_branches', comment='branches table'); 
set add table (set id=1, origin=1, id=3, fully qualified
name='public.pgbench_tellers', comment='tellers table'); 
set add table (set id=1, origin=1, id=4, fully qualified
name='public.pgbench_history', comment='history table');
#-- 
# Create the second node (the slave) tell the 2 nodes how to connect to
Slony-I 2.1.1 Documentation 10 / 163
# each other and how they should listen for events.
#--
store node (id=2, comment = 'Slave node', event node=1);
store path (server = 1, client = 2, conninfo='dbname=my_primary
host=localhost user=user1 password=pw');
store path (server = 2, client = 1, conninfo='dbname=my_rep host=localhost
user=user1 password=pw');
_EOF_



Read in the doc that likely the lib is not in the correct place or $libdir
is not set correctly, but everything looks to be in place.  Am I missing
something else I am not aware of?


-- 
View this message in context: http://old.nabble.com/Cannot-find-slony1_funcs-on-macos-despite-lib-in-place-tp33365133p33365133.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.


From dbrb2002-sql at yahoo.com  Tue Feb 21 19:30:18 2012
From: dbrb2002-sql at yahoo.com (Brian Trudal)
Date: Tue, 21 Feb 2012 19:30:18 -0800 (PST)
Subject: [Slony1-general] Replication Lag - fetch 500 from LOG
Message-ID: <1329881418.14948.YahooMailNeo@web31807.mail.mud.yahoo.com>

All of a sudden since a day the lag is increasing and server is not getting caught; and all I can see if "fetch 500 from LOG" from pg_stat_activity.. restarted slony across and also killed all sessions in "in transaction"; and still no luck.

Anything that am missing ? 


I really appreciate some's answer...

Its on PG 8.4 + slony 2.0.4

Thanks
Brian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20120221/6a809324/attachment.htm 

From dbrb2002-sql at yahoo.com  Tue Feb 21 22:04:31 2012
From: dbrb2002-sql at yahoo.com (Brian Trudal)
Date: Tue, 21 Feb 2012 22:04:31 -0800 (PST)
Subject: [Slony1-general] Replication Lag - fetch 500 from LOG
In-Reply-To: <1329881418.14948.YahooMailNeo@web31807.mail.mud.yahoo.com>
References: <1329881418.14948.YahooMailNeo@web31807.mail.mud.yahoo.com>
Message-ID: <1329890671.982.YahooMailNeo@web31805.mail.mud.yahoo.com>

Some slony log info, anyone out there with slony experience ?

slony 10.1.1.2(35428) 2012-02-21 12:56:04 PST 0 LOG:? duration: 502.162 ms? statement: fetch 500 from LOG; 
slony 10.1.1.2(35428) 2012-02-21 12:56:44 PST 0 LOG:? duration: 547.304 ms? statement: fetch 500 from LOG; 
slony 10.1.1.2(35428) 2012-02-21 12:56:56 PST 0 LOG:? duration: 595.473 ms? statement: fetch 500 from LOG; 
slony
 10.1.1.3(52676) 2012-02-21 12:57:27 PST 0 LOG:? duration: 1249.432 ms? 
statement: select "_slony1".cleanupEvent('10 minutes'::interval, 
'false'::boolean);???????? 
slony 10.1.1.2(35428) 2012-02-21 12:57:39 PST 0 LOG:? duration: 521.751 ms? statement: fetch 500 from LOG; 
slony 10.1.1.2(35428) 2012-02-21 12:58:05 PST 0 LOG:? duration:
 663.164 ms? statement: fetch 500 from LOG; 
slony 10.1.1.2(35428) 2012-02-21 12:58:33 PST 0 LOG:? duration: 584.578 ms? statement: fetch 500 from LOG; 
slony 10.1.1.2(35428) 2012-02-21 12:58:53 PST 0 LOG:? duration: 524.076 ms? statement: fetch 500 from LOG; 
slony 10.1.1.2(35428) 2012-02-21 12:59:22 PST 0 LOG:? duration: 610.761 ms? statement: fetch 500 from LOG; 
slony 10.1.1.2(35428) 2012-02-21 12:59:42 PST 0 LOG:? duration: 629.949 ms? statement: fetch 500 from LOG; 
slony 10.1.1.2(35428) 2012-02-21 13:00:10 PST 0 LOG:? duration: 509.607 ms? statement: fetch 500 from LOG; 
slony 10.1.1.2(35428) 2012-02-21 13:00:48 PST 0 LOG:? duration: 519.203 ms? statement: fetch 500 from LOG; 
slony 10.1.1.2(35428) 2012-02-21 13:01:00 PST 0 LOG:? duration: 527.713 ms? statement: fetch 500 from LOG; 
slony 10.1.1.2(35428) 2012-02-21 13:01:09 PST 0 LOG:? duration:
 616.263 ms? statement: fetch 500 from LOG; 
slony 10.1.1.2(35428) 2012-02-21 13:01:17 PST 0 LOG:? duration: 520.641 ms? statement: fetch 500 from LOG; 
slony 10.1.1.2(35428) 2012-02-21 13:02:13 PST 0 LOG:? duration: 519.352 ms? statement: fetch 500 from LOG; 
slony 10.1.1.2(35428) 2012-02-21 13:02:49 PST 0 LOG:? duration: 505.472 ms? statement: fetch 500 from LOG; 
slony 10.1.1.2(35428) 2012-02-21 13:03:52 PST 0 LOG:? duration: 601.902 ms? statement: fetch 500 from LOG; 
slony 10.1.1.2(35428) 2012-02-21 13:04:50 PST 0 LOG:? duration: 643.636 ms? statement: fetch 500 from LOG; 
slony 10.1.1.2(35428) 2012-02-21 13:06:03 PST 0 LOG:? duration: 513.065 ms? statement: fetch 500 from LOG; 
slony 10.1.1.2(35428) 2012-02-21 13:06:29 PST 0 LOG:? duration: 648.466 ms? statement: fetch 500 from LOG; 
slony 10.1.1.2(35428) 2012-02-21 13:07:08 PST 0 LOG:? duration:
 645.737 ms? statement: fetch 500 from LOG; 
slony 10.1.1.2(35428) 2012-02-21 13:07:56 PST 0 LOG:? duration: 559.368 ms? statement: fetch 500 from LOG; 
slony 10.1.1.2(35428) 2012-02-21 13:08:08 PST 0 LOG:? duration: 524.154 ms? statement: fetch 500 from LOG; 
slony 10.1.1.2(35428) 2012-02-21 13:08:20 PST 0 LOG:? duration: 594.628 ms? statement: fetch 500 from LOG; 
slony 10.1.1.2(35428) 2012-02-21 13:08:34 PST 0 LOG:? duration: 515.906 ms? statement: fetch 500 from LOG; 
slony 10.1.1.2(35428) 2012-02-21 13:08:48 PST 0 LOG:? duration: 535.204 ms? statement: fetch 500 from LOG; 
slony
 10.1.1.3(52676) 2012-02-21 13:08:49 PST 0 LOG:? duration: 582.382 ms? 
statement: select "_slony1".cleanupEvent('10 minutes'::interval, 
'false'::boolean); 



________________________________
 From: Brian Trudal <dbrb2002-sql at yahoo.com>
To: "slony1-general at lists.slony.info" <slony1-general at lists.slony.info> 
Sent: Tuesday, February 21, 2012 7:30 PM
Subject: [Slony1-general] Replication Lag - fetch 500 from LOG
 

All of a sudden since a day the lag is increasing and server is not getting caught; and all I can see if "fetch 500 from LOG" from pg_stat_activity.. restarted slony across and also killed all sessions in "in transaction"; and still no luck.

Anything that am missing ? 


I really appreciate some's answer...

Its on PG 8.4 + slony 2.0.4

Thanks
Brian

_______________________________________________
Slony1-general mailing list
Slony1-general at lists.slony.info
http://lists.slony.info/mailman/listinfo/slony1-general
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20120221/5f392a97/attachment.htm 

