From cbbrowne at ca.afilias.info  Wed Apr  1 12:01:01 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed Apr  1 12:01:21 2009
Subject: [Slony1-general] altperl scripts
In-Reply-To: <49CA9291.9030908@gmail.com> (Matthew Hempel's message of "Wed,
	25 Mar 2009 16:22:41 -0400")
References: <49CA9291.9030908@gmail.com>
Message-ID: <87tz58gpw2.fsf@dba2.int.libertyrms.com>

Matthew Hempel <mhempel@twentybricks.com> writes:
> I assume that the slonik_subscribe_set command only needs to be run on
> db2, the subscriber.
>
> If my assumptions are wrong, I'd appreciate being corrected.

It doesn't very much matter where the slonik commands are run;
whereever they are run, slonik will connect to the appropriate
databases to perform the configuration change.

In our environments, we usually have databases residing on database
servers, and the slon processes run on an "administrative" server.

We'd run the slonik scripts on the admin server.

All of the requests that you indicate need only to be run once,
*somewhere*.

The one notable misconception is with CREATE SET...  You only need to
run that command once, and initially, it will only really take effect
on the node that is the origin for the set.

The "SUBSCRIBE SET" request that follows pulls information about that
set onto the subscriber node.
-- 
let name="cbbrowne" and tld="cbbrowne.com" in name ^ "@" ^ tld;;
http://linuxdatabases.info/info/linuxxian.html
"The only thing  better than TV with the  sound off is  Radio with the
sound off." -- Dave Moon
From c_venumadhav at yahoo.com  Wed Apr  1 21:32:31 2009
From: c_venumadhav at yahoo.com (VenuMadhav)
Date: Wed Apr  1 21:32:58 2009
Subject: [Slony1-general] Slony-I Replication
Message-ID: <916428.2024.qm@web94904.mail.in2.yahoo.com>

Dear Sir,


We are using PostgreSQL and Slony-I on RedHat linux from last 4 years.
Slony-I 1.1.5=A0is implemented with 1 master + 4=A0slaves on PostgreSQL 8.1=
databases.
It is working fine on WAN from last year.
Now we want to=A0increase Slaves from 4 to 13.
Is it possible with existing Slony-I 1.1.5 OR with below latest platform =

=A0=A0=A0 RHEL 4.0
=A0=A0=A0 PostgreSQL 8.3
=A0=A0=A0 Slony-I 1.2.15
=A0=A0=A0 PgAdmin3 1.4.3
Slaves must be 13. Is it possible to implement atleast without failover and=
 cascading.
Please guide us.
This is our requirement. We are ready to contribute some amount for this pu=
rpose.

Thanks & Regards
Venu Madhav


      Add more friends to your messenger and enjoy! Go to http://messenger.=
yahoo.com/invite/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090402/=
52b4b059/attachment.html
From cbbrowne at ca.afilias.info  Thu Apr  2 11:55:13 2009
From: cbbrowne at ca.afilias.info (cbbrowne)
Date: Thu Apr  2 11:55:25 2009
Subject: [Slony1-general] Slony is ACID relative to data changes, but
	not 	ACID relative to DDL changes
In-Reply-To: <d7df81620903271336j62cdcf41ka7fdd7903decb5b4@mail.gmail.com>
References: <d7df81620903210358p7c36bad9q5c70e574a447deab@mail.gmail.com>	
	<49C7AB51.2090707@ca.afilias.info>
	<d7df81620903271336j62cdcf41ka7fdd7903decb5b4@mail.gmail.com>
Message-ID: <49D50A11.6000607@ca.afilias.info>

Dmitry Koterov wrote:
> If I use
>
> TRY {
>   EXECUTE SCRIPT ( ... /* CREATE TABLE a(id INTEGER); */ );
>   EXECUTE SCRIPT ( ... /* CREATE TABLE b(id INTEGER); */ );
> }
>
> slonik generates 2 DDL_SCRIPT events which are processed in the above 
> cycle on a replica, and each event is committed in separated transactions.
This is a nice example; thanks!

Yes, if there are multiple events, they won't forcibly get grouped 
together on subsequent nodes even though a TRY{} block might cause them 
to be executed together as a single transaction on the initial node.

I don't see changing that behavior; we'd have to have some rather 
invasive effects on event processing.

I have committed documentation to CVS to indicate this limitation to TRY{}.

-- 
output = ("cbbrowne" "@" "ca.afilias.info")
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"

From lai at clustersolutions.net  Thu Apr  2 15:28:33 2009
From: lai at clustersolutions.net (lai@clustersolutions.net)
Date: Thu Apr  2 15:34:47 2009
Subject: [Slony1-general] replication stalled.
Message-ID: <4133.75.25.11.233.1238711313.squirrel@www.clustersolutions.net>

Hello:

We have implemented Slony since 7 months ago. Below are the configuration:

Server A:
Redhat 9, Postgres 8.3, Slony 1.2, Set 1 master, Set 2 Slave.

Server B:
Centos 5, Postgres 8.3, Slony 1.2, Set 1 Slave, Set 2 Master.

Things went very well for the beginning 6 months. Just about a month ago
we are starting to see data not being replicating for Set 2 (perhaps Set 1
as well just hadn't verified it yet). Investigation so far found Slon
daemons 1 and 2 to be running when replication hangs, and reviewing the
logfile had not yield any out of the ordinary messages. The fix so far is
to bounce both Slon daemons and the replication would pick up from where
it had left off.

So anyone has a suggestion on how we should troubleshoot this issue? To be
specify it is kinda important as Set 1 contains parts and on hand data for
real time inventory check, and Set 2 contains order information. I just
wanted to bounce this issue off this list before having to resolve to a
nightly bouncing of the Slon daemon.

Thanks ahead for your assistance!

Regards,

Tim

From bnichols at ca.afilias.info  Fri Apr  3 06:35:30 2009
From: bnichols at ca.afilias.info (Brad Nicholson)
Date: Fri Apr  3 06:35:36 2009
Subject: [Slony1-general] replication stalled.
In-Reply-To: <4133.75.25.11.233.1238711313.squirrel@www.clustersolutions.net>
References: <4133.75.25.11.233.1238711313.squirrel@www.clustersolutions.net>
Message-ID: <1238765730.10591.49.camel@bnicholson-desktop>


On Thu, 2009-04-02 at 15:28 -0700, lai@clustersolutions.net wrote:
> Hello:
> 
> We have implemented Slony since 7 months ago. Below are the configuration:
> 
> Server A:
> Redhat 9, Postgres 8.3, Slony 1.2, Set 1 master, Set 2 Slave.
> 
> Server B:
> Centos 5, Postgres 8.3, Slony 1.2, Set 1 Slave, Set 2 Master.

What minor version of Slony 1.2 is it?  This is highly relevant.  If you
are not on a recent version, upgrading to the latest minor version would
be a good place to start.

Also, is the network between Server A and Server B stable?

-- 
?Brad Nicholson  416-673-4106
Database Administrator, Afilias Canada Corp.

From mnagaraja at alcatel-lucent.com  Wed Apr  8 00:22:03 2009
From: mnagaraja at alcatel-lucent.com (Nagaraja, Madhukar (Madhukar))
Date: Wed Apr  8 00:24:46 2009
Subject: [Slony1-general] Slony querries.
Message-ID: <E9F099885B445541A55D830FC62E175A06632C2226@INBANSXCHMBSA3.in.alcatel-lucent.com>

Hello,

I have configure slony 2.0 to be working on master-slave 2 node system. The 2 nodes will be located geographically different. (maybe very basic querries, but appreciated the response to clear my thoughts)

1) for controlled switchover, I am assuming I will have to run the move set slonik command on the master system. Should it be run on the slave system too ? If I have done a switchover from node 1 to node 2, where should I run the second move set script, node 2 right ? Or assuming the case of the network breakdown then the system might be up, but we need to bring the slave as master. So where should we run the move set slonik script.

2) in case of failover, if for some reason the master system is down and I want to bring the slave system up as master. What should we do here ? Run the failover command on the slave system ?

Please let me know.

Thanks.
From glynastill at yahoo.co.uk  Wed Apr  8 01:47:59 2009
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Wed Apr  8 01:48:48 2009
Subject: [Slony1-general] Slony querries.
In-Reply-To: <E9F099885B445541A55D830FC62E175A06632C2226@INBANSXCHMBSA3.in.alcatel-lucent.com>
Message-ID: <206594.84033.qm@web23606.mail.ird.yahoo.com>





--- On Wed, 8/4/09, Nagaraja, Madhukar (Madhukar) <mnagaraja@alcatel-lucent.com> wrote:

> 1) for controlled switchover, I am assuming I will have to
> run the move set slonik command on the master system. Should
> it be run on the slave system too ? If I have done a
> switchover from node 1 to node 2, where should I run the
> second move set script, node 2 right ? Or assuming the case
> of the network breakdown then the system might be up, but we
> need to bring the slave as master. So where should we run
> the move set slonik script.

You only need to run the scripts once, and that run against all nodes. You should specify all your nodes in the adminconinfo section of the preamble. See

http://www.slony.info/documentation/admconninfo.html

> 
> 2) in case of failover, if for some reason the master
> system is down and I want to bring the slave system up as
> master. What should we do here ? Run the failover command on
> the slave system ?
> 

Yeah use failover if all hope for the origin is lost, be sure to read notes at

http://www.slony.info/documentation/stmtfailover.html


      
From shoaibmir at gmail.com  Wed Apr  8 02:22:38 2009
From: shoaibmir at gmail.com (Shoaib Mir)
Date: Wed Apr  8 02:23:26 2009
Subject: [Slony1-general] 'public' schema problem
Message-ID: <bf54be870904080222x6407c49cle8cb0c23fe780b44@mail.gmail.com>

Hi All,

While setting up Slony the other day I found this weird problem=85

I had like 8 schemas in my database and no schema named as =91public=92  and
while trying to setup Slony for that specific database, during the INIT
cluster step it started giving problems like=85

=93No schema available to setup objects=94

I had no idea that its just a case of not having =91public=92 schema in the=
re
and as soon as I added an empty public schema, everything seemed to work
fine and I was able to setup 8 sets for my 8 schemas and replication worked
nicely as well
Is this normal or I did something wrong there?

-- =

Shoaib Mir
http://shoaibmir.wordpress.com/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090408/=
a39d5021/attachment.htm
From cbbrowne at ca.afilias.info  Wed Apr  8 09:00:48 2009
From: cbbrowne at ca.afilias.info (cbbrowne)
Date: Wed Apr  8 09:01:00 2009
Subject: [Slony1-general] 'public' schema problem
In-Reply-To: <bf54be870904080222x6407c49cle8cb0c23fe780b44@mail.gmail.com>
References: <bf54be870904080222x6407c49cle8cb0c23fe780b44@mail.gmail.com>
Message-ID: <49DCCA30.8090006@ca.afilias.info>

Shoaib Mir wrote:
> Hi All,
>
> While setting up Slony the other day I found this weird problem?
>
> I had like 8 schemas in my database and no schema named as ?public?  
> and while trying to setup Slony for that specific database, during the 
> INIT cluster step it started giving problems like?
>
> ?No schema available to setup objects?
>
> I had no idea that its just a case of not having ?public? schema in 
> there and as soon as I added an empty public schema, everything seemed 
> to work fine and I was able to setup 8 sets for my 8 schemas and 
> replication worked nicely as well
>
> Is this normal or I did something wrong there?
This seems rather curious; there are no references to the "public" 
schema in Slony-I itself (although there are in test scripts).

There is also no such error message within Slony-I itself as "No schema 
available to setup objects".

That doesn't mean you didn't see it - just that it would have had to be 
induced somewhere else.  I also don't see it in PostgreSQL code (in 
HEAD, but I doubt that's material).

The only plausible thing that comes to mind would be that perhaps the 
user you connected as had some vestigal reference to "public" as being 
its default schema, so that when the user connected, something was left 
devoid of a place to create objects that weren't tied to a specific schema.

I just revised one of the regression tests to drop out the "public" 
schema, and put its tables elsewhere.  It didn't have any problems running.

So I'm suspicious that the problem you experienced may lie elsewhere.

-- 
output = ("cbbrowne" "@" "ca.afilias.info")
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"

From awadhesh.yona at tcs.com  Tue Apr  7 00:12:57 2009
From: awadhesh.yona at tcs.com (awadhesh yona)
Date: Wed Apr  8 09:20:58 2009
Subject: [Slony1-general] pg_config for slony1 install
In-Reply-To: <3a4237470901300440u36ac67b3q532eaca107cfc678@mail.gmail.com>
References: <3a4237470901300359x54e625bdsc6b2ce8253b5b9a4@mail.gmail.com>
	<3a4237470901300440u36ac67b3q532eaca107cfc678@mail.gmail.com>
Message-ID: <22922680.post@talk.nabble.com>




Madan Thapa wrote:
> 
>>
>>
>> I have installed postgresql using yum.
>>
>>
>> -bash-3.2# rpm -qa |  grep postgres
>> postgresql-libs-8.3.5-1PGDG.rhel5
>> postgresql-8.3.5-1PGDG.rhel5
>> postgresql-server-8.3.5-1PGDG.rhel5
>> compat-postgresql-libs-4-1PGDG.rhel5
>>
>>
>>
>> -bash-3.2# ps faux |  egrep 'pgsql|postgres'
>> postgres 23733  0.0  0.7  40716  4108 ?        S    Jan29   0:02
>> /usr/bin/postmaster -p 5432 -D /var/lib/pgsql/data
>> postgres 23758  0.0  0.1  12040   888 ?        Ss   Jan29   0:00  \_
>> postgres: logger process
>> postgres 23761  0.0  0.2  40716  1228 ?        Ss   Jan29   0:00  \_
>> postgres: writer process
>> postgres 23763  0.0  0.1  40716  1028 ?        Ss   Jan29   0:00  \_
>> postgres: wal writer process
>> postgres 23764  0.0  0.2  40848  1136 ?        Ss   Jan29   0:00  \_
>> postgres: autovacuum launcher process
>> postgres 23765  0.0  0.1  12036   920 ?        Ss   Jan29   0:00  \_
>> postgres: stats collector process
>> root     11393  0.0  0.1   2992   704 pts/0    S+   05:44   0:00      \_
>> egrep pgsql|postgres
>> -bash-3.2#
>>
>>
>>
>>
>> Now to install slony what would be pg_config path ?
>>
>> Docs sasy:
>> *Normally,* it ought to be sufficient to run configure
>> --with-pgconfigdir=/some/path/somewhere, where /some/path/somewhere is
>> the
>> place where the PostgreSQL program *pg_config* is located. From
>> *pg_config
>> *, the configure script can determine the various locations where
>> PostgreSQL components are found, which indicates where the essential
>> components of Slony-I must be installed.
>>
>>
>> -bash-3.2# locate pg_config
>> locate: can not open `/var/lib/mlocate/mlocate.db': No such file or
>> directory
>> -bash-3.2# updatedb
>> -bash-3.2# locate pg_config
>> -bash-3.2# ls /var/lib/pgsql/data/
>> base    pg_clog      pg_ident.conf  pg_multixact  pg_tblspc    PG_VERSION
>> postgresql.conf  postmaster.pid
>> global  pg_hba.conf  pg_log         pg_subtrans   pg_twophase  pg_xlog
>> postmaster.opts
>> -bash-3.2#
>>
>>
>>
>> -bash-3.2# find / -name pg_config
>> -bash-3.2#
>> -bash-3.2#
>>
>>
>>
>>
>>
>> Path of some important binaries on my system are
>> #################################################
>> /usr/bin/psql
>> /usr/bin/createdb
>> /usr/bin/createlang
>> /usr/bin/createuser
>> /usr/bin/pg_dump
>>
>>
>>
>>
>> Please advise.
>>
>>
>> Thanks
>>
>>
> ========================>
> 
> *yum install slony1   did it*
> 
> 
> -bash-3.2# yum install slony1
> pgdg83                    100% |=========================| 1.9 kB    00:00
> rpmforge                  100% |=========================| 1.1 kB    00:00
> base                      100% |=========================| 1.1 kB    00:00
> updates                   100% |=========================|  951 B    00:00
> addons                    100% |=========================|  951 B    00:00
> extras                    100% |=========================| 1.1 kB    00:00
> Setting up Install Process
> Parsing package install arguments
> Resolving Dependencies
> --> Running transaction check
> ---> Package slony1.i386 0:1.2.15-3.rhel5 set to be updated
> --> Processing Dependency: perl(DBI) for package: slony1
> --> Processing Dependency: perl-DBD-Pg for package: slony1
> --> Running transaction check
> ---> Package perl-DBD-Pg.i386 0:2.11.5-1.el5.rf set to be updated
> --> Processing Dependency: perl(version) for package: perl-DBD-Pg
> ---> Package perl-DBI.i386 0:1.607-1.el5.rf set to be updated
> --> Processing Dependency: perl(RPC::PlServer) >= 0.2001 for package:
> perl-DBI
> --> Processing Dependency: perl(RPC::PlClient) >= 0.2000 for package:
> perl-DBI
> --> Running transaction check
> ---> Package perl-version.i386 0:0.74-1.el5.rf set to be updated
> ---> Package perl-PlRPC.noarch 0:0.2020-1.el5.rf set to be updated
> --> Processing Dependency: perl(Net::Daemon) for package: perl-PlRPC
> --> Processing Dependency: perl(Net::Daemon::Log) for package: perl-PlRPC
> --> Processing Dependency: perl(Net::Daemon::Test) for package: perl-PlRPC
> --> Running transaction check
> ---> Package perl-Net-Daemon.noarch 0:0.43-1.el5.rf set to be updated
> --> Finished Dependency Resolution
> 
> Dependencies Resolved
> 
> =============================================================================
>  Package                 Arch       Version          Repository       
> Size
> =============================================================================
> Installing:
>  slony1                  i386       1.2.15-3.rhel5   pgdg83            267
> k
> Installing for dependencies:
>  perl-DBD-Pg             i386       2.11.5-1.el5.rf  rpmforge          301
> k
>  perl-DBI                i386       1.607-1.el5.rf   rpmforge          866
> k
>  perl-Net-Daemon         noarch     0.43-1.el5.rf    rpmforge           44
> k
>  perl-PlRPC              noarch     0.2020-1.el5.rf  rpmforge           33
> k
>  perl-version            i386       0.74-1.el5.rf    rpmforge           76
> k
> 
> Transaction Summary
> =============================================================================
> Install      6 Package(s)
> Update       0 Package(s)
> Remove       0 Package(s)
> 
> Total download size: 1.6 M
> Is this ok [y/N]: y
> Downloading Packages:
> (1/6): slony1-1.2.15-3.rh 100% |=========================| 267 kB    00:00
> (2/6): perl-PlRPC-0.2020- 100% |=========================|  33 kB    00:00
> (3/6): perl-version-0.74- 100% |=========================|  76 kB    00:00
> (4/6): perl-Net-Daemon-0. 100% |=========================|  44 kB    00:00
> (5/6): perl-DBD-Pg-2.11.5 100% |=========================| 301 kB    00:00
> (6/6): perl-DBI-1.607-1.e 100% |=========================| 866 kB    00:02
> Running rpm_check_debug
> Running Transaction Test
> Finished Transaction Test
> Transaction Test Succeeded
> Running Transaction
>   Installing: perl-version                 ######################### [1/6]
>   Installing: perl-Net-Daemon              ######################### [2/6]
>   Installing: perl-PlRPC                   ######################### [3/6]
>   Installing: perl-DBI                     ######################### [4/6]
>   Installing: perl-DBD-Pg                  ######################### [5/6]
>   Installing: slony1                       ######################### [6/6]
> 
> Installed: slony1.i386 0:1.2.15-3.rhel5
> Dependency Installed: perl-DBD-Pg.i386 0:2.11.5-1.el5.rf perl-DBI.i386
> 0:1.607-1.el5.rf perl-Net-Daemon.noarch 0:0.43-1.el5.rf perl-PlRPC.noarch
> 0:0.2020-1.el5.rf perl-version.i386 0:0.74-1.el5.rf
> Complete!
> 
> 
> 
> -bash-3.2# slo
> slogin                          slonik_drop_set
> slonik_subscribe_set
> slon                            slonik_drop_table
> slonik_uninstall_nodes
> slon_kill                       slonik_execute_script
> slonik_unsubscribe_set
> slon_start                      slonik_failover
> slonik_update_nodes
> slon_watchdog                   slonik_init_cluster
> slony-cluster-analysis-mass.sh
> slon_watchdog2                  slonik_merge_sets
> slony-cluster-analysis.sh
> slonik                          slonik_move_set
> slony1_dump.sh
> slonik_build_env                slonik_print_preamble
> slony1_extract_schema.sh
> slonik_create_set               slonik_restart_node
> slony_logshipper
> slonik_drop_node                slonik_store_node
> slony_show_configuration
> -bash-3.2# slo
> slogin                          slonik_drop_set
> slonik_subscribe_set
> slon                            slonik_drop_table
> slonik_uninstall_nodes
> slon_kill                       slonik_execute_script
> slonik_unsubscribe_set
> slon_start                      slonik_failover
> slonik_update_nodes
> slon_watchdog                   slonik_init_cluster
> slony-cluster-analysis-mass.sh
> slon_watchdog2                  slonik_merge_sets
> slony-cluster-analysis.sh
> slonik                          slonik_move_set
> slony1_dump.sh
> slonik_build_env                slonik_print_preamble
> slony1_extract_schema.sh
> slonik_create_set               slonik_restart_node
> slony_logshipper
> slonik_drop_node                slonik_store_node
> slony_show_configuration
> -bash-3.2#
> 
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
> 
> 


the path for pg_config directory is same as of your postgresql data
directory...
like /var/lib/pgsql/data
but this file is not on your system that is why slony is anable to find its
path by own at the time of your instaaltion of slony
you need to install postgresql-devel-8.3.5-1PGDG.rhel5.rpm   and this file
will be automatically generated in your data directory

-- 
View this message in context: http://www.nabble.com/pg_config-for-slony1-install-tp21745934p22922680.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.

From shoaibmir at gmail.com  Wed Apr  8 16:34:35 2009
From: shoaibmir at gmail.com (Shoaib Mir)
Date: Wed Apr  8 16:35:06 2009
Subject: [Slony1-general] 'public' schema problem
In-Reply-To: <49DCCA30.8090006@ca.afilias.info>
References: <bf54be870904080222x6407c49cle8cb0c23fe780b44@mail.gmail.com>
	<49DCCA30.8090006@ca.afilias.info>
Message-ID: <bf54be870904081634k520f9e78ld38f65951f3b5319@mail.gmail.com>

>
> This seems rather curious; there are no references to the "public" schema
> in Slony-I itself (although there are in test scripts).
>
> There is also no such error message within Slony-I itself as "No schema
> available to setup objects".


This was not exactly the error but it was something like this, I will try to
replicate the same again and will paste the exact one again when I get time.


>
>
> That doesn't mean you didn't see it - just that it would have had to be
> induced somewhere else.  I also don't see it in PostgreSQL code (in HEAD,
> but I doubt that's material).
>
> The only plausible thing that comes to mind would be that perhaps the user
> you connected as had some vestigal reference to "public" as being its
> default schema, so that when the user connected, something was left devoid
> of a place to create objects that weren't tied to a specific schema.


This is true as the user had the default schema set to public as it was the
default 'postgres' user I was using so I am pretty sure it can be linked to
this as it didnt have any schema to create objects.

-- =

Shoaib Mir
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090409/=
d42d352e/attachment.htm
From stephane.schildknecht at postgresqlfr.org  Fri Apr 10 00:45:52 2009
From: stephane.schildknecht at postgresqlfr.org (=?ISO-8859-15?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Fri Apr 10 00:46:35 2009
Subject: [Slony1-general] First public release of slony1-ctl
Message-ID: <49DEF930.2080903@postgresqlfr.org>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hello,

I'm pleased to announce the first public release of slony1-ctl.

Slony1-ctl is a set of shell scripts aiming at simplifying everyday
administration of a Slony1 replication.

http://slony1-ctl.projects.postgresql.org/

Licence:
  BSD

Principle:
  Once replication nodes and relations between nodes have been defined, one can
  easily administrate the replication by calling one of the scripts, without
  need to write slonik scripts anymore.

Download:
  http://pgfoundry.org/frs/download.php/2152/slony1-ctl-1.0.0.tar.gz

Features:
 * Initialising a replication
 * Adding/dropping nodes
 * Adding a set
 * Possibility to define cross-replication
 * adding objects
 * switchover/failover
 * Start/stop replication daemons
 * Executing DDL scripts

Best regards,
- --
St?phane Schildknecht
PostgreSQLFr - http://www.postgresql.fr
Dalibo - http://www.dalibo.com
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFJ3vkwA+REPKWGI0ERAlfkAJ450YpmE7awnMBvpCdcqKWqu5Q1VgCgkI8o
JQS6v8lO6QnbyJif3uvn5+s=
=uJuu
-----END PGP SIGNATURE-----
From lawrencew00 at hotmail.com  Mon Apr 13 07:25:19 2009
From: lawrencew00 at hotmail.com (Lawrence Wong)
Date: Mon Apr 13 07:25:27 2009
Subject: [Slony1-general] Installing Slony-I 1.2.12R and PostgreSQL 8.3
Message-ID: <SNT101-W431E2EFC7E3A1B9DDE42DABD7F0@phx.gbl>


Hi,

I am trying to use Slony-I 1.2 on a simple 1 Master/1 Slave setup between t=
wo Windows 2003 Servers.  The Windows bundles on the site are for PostgreSQ=
L 8.1 and 8.2.  I successfully got my setup to replicate using PostgreSQL 8=
.1 and the Slony-I 1.2 package for 8.1 but now am having trouble upgrading =
to 8.3.  Specifically, when I try to run the slonik application I am missin=
g some libraries in the PostgreSQL 8.3/lib folder and when I place them the=
re, they are incompatible.  I was wondering if someone could help me out an=
d tell me how to install and run Slony-I 1.2 successfully with PostgreSQL 8=
.3 on my aboved mentioned set up or point me to somewhere that explains how=
 to.  =


_________________________________________________________________
Experience all of the new features, and Reconnect with your life.
http://go.microsoft.com/?linkid=3D9650730
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090413/=
18148a19/attachment.htm
From lavalamp at spiritual-machines.org  Mon Apr 13 07:47:22 2009
From: lavalamp at spiritual-machines.org (Brian A. Seklecki)
Date: Mon Apr 13 07:47:30 2009
Subject: [Slony1-general] duplicate key sl_nodelock-pkey
In-Reply-To: <20090227085813.eade10e7.wmoran@potentialtech.com>
References: <20090227085813.eade10e7.wmoran@potentialtech.com>
Message-ID: <alpine.BSF.2.00.0904131036240.74158@vger.digitalfreaks.org>


Bug #81 Filed:

http://www.slony.info/bugzilla/show_bug.cgi?id=81

~BAS

On Fri, 27 Feb 2009, Bill Moran wrote:

>
> I'm seeing a problem similar to that described in this thread:
> http://lists.slony.info/pipermail/slony1-general/2008-August/008492.html
>
> However, I was unable to isolate the cause.  The solution was to restart
> the slons on all nodes, which unstuck things and all tests show that
> the cluster is replicating happily again.
>
> I'm trying to determine how/why the problem happened.  In this case it
> was triggered by moving an origin around (as part of a routine disaster
> drill).  The set moved to the backup without problem, but we didn't notice
> that the slon on node 2 had died until we went to move things back.  At
> that point, the move set hung, and eventually bailed with "timeout exceeded
> while waiting for event confirmation"
>
> If anyone has any insight into this, I'm all ears.  Otherwise, I can set
> up a test bed if there's anything I can do to provide more information.
>
> Some basic details:
> FreeBSD 6.3
> PostgreSQL 8.3.5
> Slony 1.2.15
>
> Cluster =
> node 1: masterdb in facil0
> node 2: localslavedb in facil0
> node 3: remoteslavedb in facil1
>
> 2009 Feb 27 06:31:43 -05:00 localslavedb [slon][55583] [local2] [err] slon[55583]: [8393-1] [55583] CONFIG moveSet: set_id=1 old_origin=1 new_origin=3
> 2009 Feb 27 06:31:43 -05:00 localslavedb [slon][55583] [local2] [debug] slon[55583]: [8394-1] [55583] DEBUG1 remoteWorkerThread_3: helper thread for provider 3 created
> 2009 Feb 27 06:31:43 -05:00 localslavedb [slon][55583] [local2] [err] slon[55583]: [8395-1] [55583] CONFIG storeListen: li_origin=1 li_receiver=2 li_provider=1
> 2009 Feb 27 06:31:43 -05:00 localslavedb [slon][55583] [local2] [err] slon[55583]: [8396-1] [55583] CONFIG storeListen: li_origin=1 li_receiver=2 li_provider=3
> 2009 Feb 27 06:31:43 -05:00 localslavedb [slon][55583] [local2] [err] slon[55583]: [8397-1] [55583] CONFIG storeListen: li_origin=3 li_receiver=2 li_provider=3
> 2009 Feb 27 06:31:43 -05:00 localslavedb [slon][55583] [local2] [debug] slon[55583]: [8398-1] [55583] DEBUG1 remoteWorkerThread_1: helper thread for provider 1 terminated
> 2009 Feb 27 06:31:43 -05:00 localslavedb [slon][55583] [local2] [debug] slon[55583]: [8399-1] [55583] DEBUG1 remoteWorkerThread_1: disconnecting from data provider 1
> 2009 Feb 27 06:31:52 -05:00 localslavedb [slon][55583] [local2] [debug] slon[55583]: [8400-1] [55583] DEBUG1 remoteWorkerThread_3: connected to data provider 3 on 'dbname=database_name_prod host=remoteslavedb-ifx.bdb.facil1
> 2009 Feb 27 06:31:52 -05:00 localslavedb [slon][55583] [local2] [debug] slon[55583]: [8400-2] user=database_name_slony password=[redacted]'
> 2009 Feb 27 06:32:01 -05:00 localslavedb [slon][55583] [local2] [info] slon[55583]: [8401-1] [55583] INFO localListenThread: got restart notification
> 2009 Feb 27 06:32:01 -05:00 localslavedb [slon][1058] [local2] [debug] slon[1058]: [2-1] [1058] DEBUG1 slon: retry requested
> 2009 Feb 27 06:32:01 -05:00 localslavedb [slon][55583] [local2] [debug] slon[55583]: [8402-1] [55583] DEBUG1 main: scheduler mainloop returned
> 2009 Feb 27 06:32:01 -05:00 localslavedb [slon][55583] [local2] [info] slon[55583]: [8403-1] [55583] INFO remoteListenThread_3: disconnecting from 'dbname=database_name_prod host=remoteslavedb-ifx.bdb.facil1
> 2009 Feb 27 06:32:01 -05:00 localslavedb [slon][55583] [local2] [info] slon[55583]: [8403-2] user=database_name_slony password=[redacted]'
> 2009 Feb 27 06:32:01 -05:00 localslavedb [slon][55583] [local2] [info] slon[55583]: [8404-1] [55583] INFO remoteListenThread_1: disconnecting from 'dbname=database_name_prod host=masterdb-db.cluster00.facil0
> 2009 Feb 27 06:32:01 -05:00 localslavedb [slon][55583] [local2] [info] slon[55583]: [8404-2] user=database_name_slony password=[redacted]'
> 2009 Feb 27 06:32:01 -05:00 localslavedb [slon][55583] [local2] [debug] slon[55583]: [8405-1] [55583] DEBUG1 syncThread: thread done
> 2009 Feb 27 06:32:01 -05:00 localslavedb [slon][55583] [local2] [debug] slon[55583]: [8406-1] [55583] DEBUG1 cleanupThread: thread done
> 2009 Feb 27 06:32:01 -05:00 localslavedb [slon][55583] [local2] [debug] slon[55583]: [8407-1] [55583] DEBUG1 remoteWorkerThread_1: thread done
> 2009 Feb 27 06:32:02 -05:00 localslavedb [slon][55583] [local2] [debug] slon[55583]: [8408-1] [55583] DEBUG1 remoteListenThread_3: thread done
> 2009 Feb 27 06:32:04 -05:00 localslavedb [slon][55583] [local2] [debug] slon[55583]: [8409-1] [55583] DEBUG1 remoteListenThread_1: thread done
> 2009 Feb 27 06:32:04 -05:00 localslavedb [slon][55583] [local2] [debug] slon[55583]: [8410-1] [55583] DEBUG1 main: done
> 2009 Feb 27 06:32:04 -05:00 localslavedb [slon][1058] [local2] [debug] slon[1058]: [3-1] [1058] DEBUG1 slon: restart of worker
> 2009 Feb 27 06:32:04 -05:00 localslavedb [slon][1058] [local2] [err] slon[1058]: [1-1] [1058] CONFIG main: slon version 1.2.15 starting up
> 2009 Feb 27 06:32:04 -05:00 localslavedb [slon][27776] [local2] [err] slon[27776]: [2-1] [27776] CONFIG main: local node id = 2
> 2009 Feb 27 06:32:04 -05:00 localslavedb [slon][27776] [local2] [err] slon[27776]: [3-1] [27776] CONFIG main: launching sched_start_mainloop
> 2009 Feb 27 06:32:04 -05:00 localslavedb [slon][27776] [local2] [err] slon[27776]: [4-1] [27776] CONFIG main: loading current cluster configuration
> 2009 Feb 27 06:32:04 -05:00 localslavedb [slon][27776] [local2] [err] slon[27776]: [5-1] [27776] CONFIG storeNode: no_id=1 no_comment='Master node'
> 2009 Feb 27 06:32:04 -05:00 localslavedb [slon][27776] [local2] [err] slon[27776]: [6-1] [27776] CONFIG storeNode: no_id=3 no_comment='remote slave node'
> 2009 Feb 27 06:32:04 -05:00 localslavedb [slon][27776] [local2] [err] slon[27776]: [7-1] [27776] CONFIG storePath: pa_server=1 pa_client=2 pa_conninfo="dbname=database_name_prod host=masterdb-db.cluster00.facil0
> 2009 Feb 27 06:32:04 -05:00 localslavedb [slon][27776] [local2] [err] slon[27776]: [7-2] user=database_name_slony password=[redacted]" pa_connretry=10
> 2009 Feb 27 06:32:04 -05:00 localslavedb [slon][27776] [local2] [err] slon[27776]: [8-1] [27776] CONFIG storePath: pa_server=3 pa_client=2 pa_conninfo="dbname=database_name_prod host=remoteslavedb-ifx.bdb.facil1
> 2009 Feb 27 06:32:04 -05:00 localslavedb [slon][27776] [local2] [err] slon[27776]: [8-2] user=database_name_slony password=[redacted]" pa_connretry=10
> 2009 Feb 27 06:32:04 -05:00 localslavedb [slon][27776] [local2] [err] slon[27776]: [9-1] [27776] CONFIG storeListen: li_origin=1 li_receiver=2 li_provider=1
> 2009 Feb 27 06:32:04 -05:00 localslavedb [slon][27776] [local2] [err] slon[27776]: [10-1] [27776] CONFIG storeListen: li_origin=1 li_receiver=2 li_provider=3
> 2009 Feb 27 06:32:04 -05:00 localslavedb [slon][27776] [local2] [err] slon[27776]: [11-1] [27776] CONFIG storeListen: li_origin=3 li_receiver=2 li_provider=3
> 2009 Feb 27 06:32:04 -05:00 localslavedb [slon][27776] [local2] [err] slon[27776]: [12-1] [27776] CONFIG storeSet: set_id=1 set_origin=3 set_comment='All tables'
> 2009 Feb 27 06:32:04 -05:00 localslavedb [slon][27776] [local2] [warning] slon[27776]: [13-1] [27776] WARN remoteWorker_wakeup: node 3 - no worker thread
> 2009 Feb 27 06:32:04 -05:00 localslavedb [slon][27776] [local2] [err] slon[27776]: [14-1] [27776] CONFIG storeSubscribe: sub_set=1 sub_provider=3 sub_forward='t'
> 2009 Feb 27 06:32:04 -05:00 localslavedb [slon][27776] [local2] [warning] slon[27776]: [15-1] [27776] WARN remoteWorker_wakeup: node 3 - no worker thread
> 2009 Feb 27 06:32:04 -05:00 localslavedb [slon][27776] [local2] [err] slon[27776]: [16-1] [27776] CONFIG enableSubscription: sub_set=1
> 2009 Feb 27 06:32:04 -05:00 localslavedb [slon][27776] [local2] [warning] slon[27776]: [17-1] [27776] WARN remoteWorker_wakeup: node 3 - no worker thread
> 2009 Feb 27 06:32:04 -05:00 localslavedb [slon][27776] [local2] [err] slon[27776]: [18-1] [27776] CONFIG main: configuration complete - starting threads
> 2009 Feb 27 06:32:04 -05:00 localslavedb [slon][27776] [local2] [debug] slon[27776]: [19-1] [27776] DEBUG1 localListenThread: thread starts
> 2009 Feb 27 06:32:04 -05:00 localslavedb [slon][27776] [local2] [err] slon[27776]: [20-1] [27776] FATAL localListenThread: "select "_database_name_prod".cleanupNodelock(); insert into
> 2009 Feb 27 06:32:04 -05:00 localslavedb [slon][27776] [local2] [err] slon[27776]: [20-2] "_database_name_prod".sl_nodelock values ( 2, 0, "pg_catalog".pg_backend_pid()); " - ERROR: duplicate key value violates
> 2009 Feb 27 06:32:04 -05:00 localslavedb [slon][27776] [local2] [err] slon[27776]: [20-3] unique constraint "sl_nodelock-pkey"
> 2009 Feb 27 06:32:04 -05:00 localslavedb [slon][1058] [local2] [debug] slon[1058]: [2-1] [1058] DEBUG1 slon: shutdown requested
> 2009 Feb 27 06:32:24 -05:00 localslavedb [slon][1058] [local2] [debug] slon[1058]: [3-1] [1058] DEBUG1 slon: child termination timeout - kill child
> 2009 Feb 27 06:32:24 -05:00 localslavedb [slon][1058] [local2] [debug] slon[1058]: [4-1] [1058] DEBUG1 slon: done
>
> --
> Bill Moran
> http://www.potentialtech.com
> http://people.collaborativefusion.com/~wmoran/
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>

l8*
	-lava (Brian A. Seklecki - Pittsburgh, PA, USA)
	       http://www.spiritual-machines.org/

    "Show me a young conservative and I'll show you someone with no heart.
    Show me an old liberal and I'll show you someone with no brains."
    ~ Winston Churchill
From jedge at visafirst.com  Mon Apr 13 10:10:00 2009
From: jedge at visafirst.com (Johnny Edge)
Date: Mon Apr 13 10:10:35 2009
Subject: [Slony1-general] add table to existing set/namespace
Message-ID: <E2C5D616019AD94BB5609D004451357C3CE565@bgva-s03-exch03.taxback.ess.ie>

SGVsbG8sDQogDQpDYW4geW91IHN1Z2dlc3QgaG93IGNhbiBJIGFkZCB0YWJsZXMgdG8gZXhpc3Rp
bmcgc2V0L25hbWVzcGFjZSB3aXRoIFNsb255Pw0KIA0KU28gZmFyIHRoaXMgd2FzIHN1Z2dlc3Rl
ZC4NCiANCjEuIENyZWF0ZSBhICJkdW1teSIgc2V0IChpZD05OTkpDQoyLiBBZGQgdGhlIG5ldyB0
YWJsZSB0byBzZXQgOTk5DQozLiBTdWJzY3JpYmUgdG8gdGhlIG5ldyBzZXQgOTk5DQo0LiBNZXJn
ZSBzZXQgOTk5IHdpdGggc2V0IDENCiANCkNhbiB5b3UgcHJvdmlkZSBhbiBleGFtcGxlPyBDYW4g
dGhlIHdob2xlIHByb2NlZHVyZSBiZSAnc2ltcGxpZmllZCcgdG8gYWx0ZXJpbmcgdGhlIGV4aXN0
aW5nIHNlcXVlbmNlIHdpdGggU1FMIHF1ZXJpZXMsIGkuZS4gYWRkIG5ldyByZWNvcmQgZm9yIHRo
ZSBuZXcgdGFibGU/DQogDQpEbyBJIGhhdmUgdG8gY3JlYXRlIGEgbmV3IGNsdXN0ZXIgdGhhdCBp
cyB0byBiZSBtZXJnZWQgd2l0aCB0aGUgZXhpc3Rpbmcgb25lPw0KIA0KQW55IGhlbHAgaXMgYXBw
cmVjaWF0ZWQuDQogDQpSZWdhcmRzLA0KIA0KSkUuDQogDQotLS0tLS0tLS0tLS0tLSBuZXh0IHBh
cnQgLS0tLS0tLS0tLS0tLS0KQW4gSFRNTCBhdHRhY2htZW50IHdhcyBzY3J1YmJlZC4uLgpVUkw6
IGh0dHA6Ly9saXN0cy5zbG9ueS5pbmZvL3BpcGVybWFpbC9zbG9ueTEtZ2VuZXJhbC9hdHRhY2ht
ZW50cy8yMDA5MDQxMy8wYjQxZDM3MC9hdHRhY2htZW50Lmh0bQo=
From cbbrowne at ca.afilias.info  Mon Apr 13 15:30:48 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Mon Apr 13 15:31:12 2009
Subject: [Slony1-general] add table to existing set/namespace
In-Reply-To: <E2C5D616019AD94BB5609D004451357C3CE565@bgva-s03-exch03.taxback.ess.ie>
	(Johnny Edge's message of "Mon, 13 Apr 2009 20:10:00 +0300")
References: <E2C5D616019AD94BB5609D004451357C3CE565@bgva-s03-exch03.taxback.ess.ie>
Message-ID: <87k55oi3tz.fsf@dba2.int.libertyrms.com>

"Johnny Edge" <jedge@visafirst.com> writes:
> So far this was suggested.
>
> 1. Create a "dummy" set (id=999)
> 2. Add the new table to set 999
> 3. Subscribe to the new set 999
> 4. Merge set 999 with set 1
>
> ?
>
> Can you?provide an example? 

There are examples of these sorts of things in the manual pages.

http://slony.info/documentation/stmtcreateset.html
http://slony.info/documentation/stmtsetaddtable.html
http://slony.info/documentation/stmtsubscribeset.html
http://slony.info/documentation/stmtmergeset.html

> Can the whole procedure be 'simplified' to altering the existing
> sequence with SQL queries, i.e. add new record for the new table?

Conceivably, but that's likely to be more fragile than using the
Slonik commands that are designed to do the job.

> Do I have to create a new cluster that is to be merged with the
> existing one?

No, if you created another cluster, it would be impossible to merge
that with the existing cluster.

http://slony.info/documentation/cluster.html
-- 
output = ("cbbrowne" "@" "ca.afilias.info")
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"
From jedge at visafirst.com  Tue Apr 14 04:36:53 2009
From: jedge at visafirst.com (Johnny Edge)
Date: Tue Apr 14 04:37:43 2009
Subject: [Slony1-general] add table to existing set/namespace
In-Reply-To: <87k55oi3tz.fsf@dba2.int.libertyrms.com>
References: <E2C5D616019AD94BB5609D004451357C3CE565@bgva-s03-exch03.taxback.ess.ie>
	<87k55oi3tz.fsf@dba2.int.libertyrms.com>
Message-ID: <E2C5D616019AD94BB5609D004451357C3CE56A@bgva-s03-exch03.taxback.ess.ie>

Thanks it worked well with the internal Slony commands. 

ATM I am replicating 140 PG tables, some of them exceed 8-9 million records, size in total is 35-36 GB of data.

Are there any performance issues with Slony-I replicating these sort of volumes? Writes occur quite often as there are at least 100 active users around the clock.

Slony processes on both systems do not seem to generate any significant load.

-----Original Message-----
From: Christopher Browne [mailto:cbbrowne@ca.afilias.info] 
Sent: 14 April 2009 01:31
To: Johnny Edge
Cc: slony1-general@lists.slony.info
Subject: Re: [Slony1-general] add table to existing set/namespace

"Johnny Edge" <jedge@visafirst.com> writes:
> So far this was suggested.
>
> 1. Create a "dummy" set (id=999)
> 2. Add the new table to set 999
> 3. Subscribe to the new set 999
> 4. Merge set 999 with set 1
>
> ?
>
> Can you?provide an example? 

There are examples of these sorts of things in the manual pages.

http://slony.info/documentation/stmtcreateset.html
http://slony.info/documentation/stmtsetaddtable.html
http://slony.info/documentation/stmtsubscribeset.html
http://slony.info/documentation/stmtmergeset.html

> Can the whole procedure be 'simplified' to altering the existing 
> sequence with SQL queries, i.e. add new record for the new table?

Conceivably, but that's likely to be more fragile than using the Slonik commands that are designed to do the job.

> Do I have to create a new cluster that is to be merged with the 
> existing one?

No, if you created another cluster, it would be impossible to merge that with the existing cluster.

http://slony.info/documentation/cluster.html
--
output = ("cbbrowne" "@" "ca.afilias.info") <http://dba2.int.libertyrms.com/> Christopher Browne
(416) 673-4124 (land)
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock phasers on the Heffalump, Piglet, meet me in transporter room three"
From ajs at crankycanuck.ca  Tue Apr 14 06:17:30 2009
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Tue Apr 14 06:17:38 2009
Subject: [Slony1-general] add table to existing set/namespace
In-Reply-To: <E2C5D616019AD94BB5609D004451357C3CE56A@bgva-s03-exch03.taxback.ess.ie>
References: <E2C5D616019AD94BB5609D004451357C3CE565@bgva-s03-exch03.taxback.ess.ie>
	<87k55oi3tz.fsf@dba2.int.libertyrms.com>
	<E2C5D616019AD94BB5609D004451357C3CE56A@bgva-s03-exch03.taxback.ess.ie>
Message-ID: <20090414131730.GA25151@shinkuro.com>

On Tue, Apr 14, 2009 at 02:36:53PM +0300, Johnny Edge wrote:

> Are there any performance issues with Slony-I replicating these sort
> of volumes? Writes occur quite often as there are at least 100
> active users around the clock.

Apart from the setup point, the real issues for Slony performance all
lie in the amount of data churn.  Inserts are slightly cheaper than
updates or deletes.  100 active users doesn't sound like a lot to me,
provided you give yourself an additional 20% or so I/O ceiling for the
Slony overhead (which is not usually that high, but you don't want
spikes to get in your way).

A

-- 
Andrew Sullivan
ajs@crankycanuck.ca
From rainer at ultra-secure.de  Tue Apr 14 07:45:48 2009
From: rainer at ultra-secure.de (Rainer Duffner)
Date: Tue Apr 14 07:45:58 2009
Subject: [Slony1-general] compiling slony 2.0.1 on Solaris10U6
Message-ID: <49E4A19C.2080000@ultra-secure.de>

Hi,

I'm trying to compile slony2.0.1 on Solaris 10U6, SUNW-postgres83 and
Sun Studio 12 compiler (I assume postgresql was also compiled with that
and thus I need to use it to compile slony).

I use:

configure --with-pgconfigdir=/usr/postgres/8.3/bin
--with-pgpkglibdir=/usr/postgres/8.3/lib
where
PATH=/usr/bin:/usr/ucb:/etc:/opt/SUNWspro/bin/:/usr/postgres/8.3/bin:/usr/sfw/bin:.
PGMAIN=/usr/postgres/8.3
CC=cc

I get:
...

cc -g -D_REENTRANT  -I../.. -I../../src/slon -o slon slon.o
runtime_config.o local_listen.o remote_listen.o remote_worker.o
sync_thread.o cleanup_thread.o scheduler.o dbutils.o conf-file.o
confoptions.o misc.o ../parsestatements/scanner.o -D_REENTRANT 
-L/usr/postgres/8.3/lib/ -L/usr/postgres/8.3/lib -lpq 
-R/usr/postgres/8.3/lib/ -lpthread
gmake[2]: Leaving directory `/export/home/rduffner/slony1-2.0.1/src/slon'
gmake[2]: Entering directory `/export/home/rduffner/slony1-2.0.1/src/slonik'
cc -g -I../.. -DPGSHARE="\"/usr/postgres/8.3/share/\"" 
-I/usr/postgres/8.3/include/ -I/usr/postgres/8.3/include/server/  -c -o
slonik.o slonik.c
"/usr/postgres/8.3/include/server/pg_config.h", line 712: warning: macro
redefined: _FILE_OFFSET_BITS
cc -g -I../.. -DPGSHARE="\"/usr/postgres/8.3/share/\"" 
-I/usr/postgres/8.3/include/ -I/usr/postgres/8.3/include/server/  -c -o
dbutil.o dbutil.c
"/usr/postgres/8.3/include/server/pg_config.h", line 712: warning: macro
redefined: _FILE_OFFSET_BITS
cc -g -I../.. -DPGSHARE="\"/usr/postgres/8.3/share/\"" 
-I/usr/postgres/8.3/include/ -I/usr/postgres/8.3/include/server/  -c -o
parser.o parser.c
"src/slonik/parser.y", line 16: cannot find include file: "slonik.h"
"src/slonik/parser.y", line 107: syntax error before or at: SlonikAdmInfo
"y.tab.c", line 402: syntax error before or at: typedef
"y.tab.c", line 410: syntax error before or at: typedef
"y.tab.c", line 416: syntax error before or at: typedef
"y.tab.c", line 549: syntax error before or at: yytype_int16
"y.tab.c", line 620: warning: no explicit type given
"y.tab.c", line 620: warning: syntax requires ";" after last
struct/union member

...

When I set:
 CPPFLAGS=-I../../src/slonik   && export CPPFLAGS

...
gmake[2]: Leaving directory `/export/home/rduffner/slony1-2.0.1/src/slon'
gmake[2]: Entering directory `/export/home/rduffner/slony1-2.0.1/src/slonik'
cc -g -I../.. -DPGSHARE="\"/usr/postgres/8.3/share/\"" 
-I/usr/postgres/8.3/include/ -I/usr/postgres/8.3/include/server/
-I/usr/postgres/8.3/include/ -I/usr/postgres/8.3/include/server/
-I/usr/postgres/8.3/include/ -I/usr/postgres/8.3/include/server/
-I../../src/slonik -c -o slonik.o slonik.c
"/usr/postgres/8.3/include/server/pg_config.h", line 712: warning: macro
redefined: _FILE_OFFSET_BITS
cc -g -I../.. -DPGSHARE="\"/usr/postgres/8.3/share/\"" 
-I/usr/postgres/8.3/include/ -I/usr/postgres/8.3/include/server/
-I/usr/postgres/8.3/include/ -I/usr/postgres/8.3/include/server/
-I/usr/postgres/8.3/include/ -I/usr/postgres/8.3/include/server/
-I../../src/slonik -c -o dbutil.o dbutil.c
"/usr/postgres/8.3/include/server/pg_config.h", line 712: warning: macro
redefined: _FILE_OFFSET_BITS
cc -g -I../.. -DPGSHARE="\"/usr/postgres/8.3/share/\"" 
-I/usr/postgres/8.3/include/ -I/usr/postgres/8.3/include/server/
-I/usr/postgres/8.3/include/ -I/usr/postgres/8.3/include/server/
-I/usr/postgres/8.3/include/ -I/usr/postgres/8.3/include/server/
-I../../src/slonik -c -o parser.o parser.c
cc -g -I../.. -DPGSHARE="\"/usr/postgres/8.3/share/\""  slonik.o
dbutil.o parser.o  ../parsestatements/scanner.o -L/usr/postgres/8.3/lib/
-L/usr/postgres/8.3/lib -lpq  -R/usr/postgres/8.3/lib/ -lpgport -o slonik
ld: fatal: library -lpgport: not found

Now, I don't know which package actually provides this "pgport"-library.
On FreeBSD, it seems to be part of the server-page, but I can't seem to
find it on Solaris...

Anybody got an idea?



Best Regards,
Rainer


From jameshtucker at gmail.com  Tue Apr 14 18:50:46 2009
From: jameshtucker at gmail.com (James Tucker)
Date: Tue Apr 14 18:51:13 2009
Subject: [Slony1-general] password being logged
Message-ID: <b10d372b0904141850w3095b9b5ucb6a64cdcdc2cd57@mail.gmail.com>

Hi Guys,

I've not been able to figure this out.  I'm not using syslog currently
(mainly because of this issue) for slony.

I'm using .pgpass files to store passwords so the slony users can
authenticate to the various postmasters.  When I start a slon process, it
logs the password it's picking up from the .pgpass file - I don't want this
to occur for obvious reasons.

Is there any way around this ?

Also the slon processes don't log a timestamp in the files which makes
things somewhat difficult to understand when reviewing logs.  I've tried
setting the options in the config file.  I'm calling slony from an init
script as follows

/usr/bin/slon -p /tmp/tmp.XZerF26184 -f /etc/sysconfig/slony/slony_config
clustername host=3Ddbhost dbname=3Ddbname user=3Dslonyuser port=3D7020

I have the following set in the config file.
syslog=3D0
log_timestamp=3Dtrue

Cheers
James.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090415/=
b0d720a7/attachment.htm
From mnagaraja at alcatel-lucent.com  Wed Apr 15 22:47:12 2009
From: mnagaraja at alcatel-lucent.com (Nagaraja, Madhukar (Madhukar))
Date: Wed Apr 15 22:49:20 2009
Subject: [Slony1-general] Switchover issue.
In-Reply-To: <206594.84033.qm@web23606.mail.ird.yahoo.com>
References: <E9F099885B445541A55D830FC62E175A06632C2226@INBANSXCHMBSA3.in.alcatel-lucent.com>
	<206594.84033.qm@web23606.mail.ird.yahoo.com>
Message-ID: <E9F099885B445541A55D830FC62E175A066330CECD@INBANSXCHMBSA3.in.alcatel-lucent.com>


Hello,

I am using slony presently on a 2 node system on a WAN.. One master and other slave.
If for somereason the master is not reachable(link down or node down).. Then if I issue a switchover in the slave it will fail bcos it cannot connect to the postgresql on the other side. If I don't want to wait till the other node comes up, then what are the options I have. I did the failover but the process of adding back  the failed node to the cluster will not be easy and right now I don't want to use this option. So is there any way I can handle this scenario.

Can someone please respond as we have demo coming up shortly ?

Thanks.
From stephane.schildknecht at postgresqlfr.org  Wed Apr 15 23:29:51 2009
From: stephane.schildknecht at postgresqlfr.org (=?ISO-8859-15?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Wed Apr 15 23:30:25 2009
Subject: [Slony1-general] Switchover issue.
In-Reply-To: <E9F099885B445541A55D830FC62E175A066330CECD@INBANSXCHMBSA3.in.alcatel-lucent.com>
References: <E9F099885B445541A55D830FC62E175A06632C2226@INBANSXCHMBSA3.in.alcatel-lucent.com>	<206594.84033.qm@web23606.mail.ird.yahoo.com>
	<E9F099885B445541A55D830FC62E175A066330CECD@INBANSXCHMBSA3.in.alcatel-lucent.com>
Message-ID: <49E6D05F.80008@postgresqlfr.org>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Nagaraja, Madhukar (Madhukar) a ?crit :
> Hello,
> 
> I am using slony presently on a 2 node system on a WAN.. One master and other slave.
> If for somereason the master is not reachable(link down or node down).. Then if I issue a switchover in the slave it will fail bcos it cannot connect to the postgresql on the other side. If I don't want to wait till the other node comes up, then what are the options I have. I did the failover but the process of adding back  the failed node to the cluster will not be easy and right now I don't want to use this option. So is there any way I can handle this scenario.
> 
> Can someone please respond as we have demo coming up shortly ?
> 

Hi,

If master node is unreachable, you can't switchover. You have to failover.
Which mean you have to recreate the node once link is up again.

If it's a temporary link breakage, you should wait until it comes back. It's
surely less work to do to switch than to fail.

Regards,
- --
St?phane Schildknecht
PostgreSQLFr - http://www.postgresql.fr
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFJ5tBeA+REPKWGI0ERAgv9AKCLINwtLBQr4hcDzPfMVdnWkNZ1nwCeKyjK
jbdeSdqceS8GfPPyfRto8fY=
=jUPf
-----END PGP SIGNATURE-----
From cbbrowne at ca.afilias.info  Thu Apr 16 08:40:03 2009
From: cbbrowne at ca.afilias.info (cbbrowne)
Date: Thu Apr 16 08:40:12 2009
Subject: [Slony1-general] Switchover issue.
In-Reply-To: <E9F099885B445541A55D830FC62E175A066330CECD@INBANSXCHMBSA3.in.alcatel-lucent.com>
References: <E9F099885B445541A55D830FC62E175A06632C2226@INBANSXCHMBSA3.in.alcatel-lucent.com>	<206594.84033.qm@web23606.mail.ird.yahoo.com>
	<E9F099885B445541A55D830FC62E175A066330CECD@INBANSXCHMBSA3.in.alcatel-lucent.com>
Message-ID: <49E75153.70602@ca.afilias.info>

Nagaraja, Madhukar (Madhukar) wrote:
> Hello,
>
> I am using slony presently on a 2 node system on a WAN.. One master and other slave.
> If for somereason the master is not reachable(link down or node down).. Then if I issue a switchover in the slave it will fail bcos it cannot connect to the postgresql on the other side. If I don't want to wait till the other node comes up, then what are the options I have. I did the failover but the process of adding back  the failed node to the cluster will not be easy and right now I don't want to use this option. So is there any way I can handle this scenario.
>
> Can someone please respond as we have demo coming up shortly ?
>
>   
You have two choices:

1.  If you have enough connectivity, you can submit MOVE SET.  That does 
require that the origin and subscriber are both available.

2.  If you don't have connectivity, you have to submit FAIL OVER.  That 
does have the serious side-effect of making the ex-origin node 
considered "destroyed."

There isn't a third choice that allows you to do an asynchronous "MOVE 
SET."  And it's not really possible to create such a thing.

-- 
output = ("cbbrowne" "@" "ca.afilias.info")
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"

From mark.hagger at mxdata.co.uk  Tue Apr 21 01:41:54 2009
From: mark.hagger at mxdata.co.uk (Mark Hagger)
Date: Tue Apr 21 01:42:27 2009
Subject: [Slony1-general] hyphen in slony cluster names
Message-ID: <1240303314.25704.33.camel@giga.cambridge.m-spatial.com>

U2tpcHBlZCBjb250ZW50IG9mIHR5cGUgbXVsdGlwYXJ0L2FsdGVybmF0aXZlLS0tLS0tLS0tLS0t
LS0gbmV4dCBwYXJ0IC0tLS0tLS0tLS0tLS0tCkEgbm9uLXRleHQgYXR0YWNobWVudCB3YXMgc2Ny
dWJiZWQuLi4KTmFtZTogbXhkYXRhLmpwZwpUeXBlOiBpbWFnZS9qcGVnClNpemU6IDUwNTUgYnl0
ZXMKRGVzYzogbm90IGF2YWlsYWJsZQpVcmwgOiBodHRwOi8vbGlzdHMuc2xvbnkuaW5mby9waXBl
cm1haWwvc2xvbnkxLWdlbmVyYWwvYXR0YWNobWVudHMvMjAwOTA0MjEvODdhN2UyMmYvbXhkYXRh
LmpwZwo=
From cbbrowne at ca.afilias.info  Tue Apr 21 08:01:38 2009
From: cbbrowne at ca.afilias.info (cbbrowne)
Date: Tue Apr 21 08:01:45 2009
Subject: [Slony1-general] hyphen in slony cluster names
In-Reply-To: <1240303314.25704.33.camel@giga.cambridge.m-spatial.com>
References: <1240303314.25704.33.camel@giga.cambridge.m-spatial.com>
Message-ID: <49EDDFD2.1070101@ca.afilias.info>

Mark Hagger wrote:
> Hi,
>
> We're running slony 1.2.15 and I've run into a bit of a problem.  I 
> was trying to do a "move set" on a replication cluster, but it seems 
> that since
> the cluster name has a hyphen in it I have a bit of a problem.  
> Basically I'm running this:
>
> slonik <<_EOF_
>         cluster name = GB-LDC;
>
>         node 1 admin conninfo = 'dbname=$DBNAME port=5433 
> host=$MASTERHOST user=$REPLICATIONUSER';
>         node 2 admin conninfo = 'dbname=$DBNAME port=5433 
> host=$WORKHOST user=$REPLICATIONUSER';
>
>         lock set (id = 1, origin = 1);
>         wait for event (origin = 1, confirmed = 2);
>         move set (id = 1, old origin = 1, new origin = 2);
>         wait for event (origin = 1, confirmed = 2);
>
> _EOF_
>
> But it fails on the "cluster name = " bit, with a:
>
> <stdin>:1: ERROR: syntax error at or near -
>
> The same sort of thing has worked fine on most of the other clusters, 
> but those have a simple alphanumeric name.
>
> I've tried various attempts at quoting the cluster name, but nothing 
> seems to be making any difference.  I fear that I've just made a 
> fundamental mistake in having a hyphen in the name and have no choice 
> but to try and drop the clusters and re-create them, but I'm hopeful 
> that someone has a cunning plan....
>
I'm surprised you got far enough to be able to consider a MOVE SET request.

The cluster name is handled by Slonik as an alphanumeric string, in much 
the same form as a SQL identifier, and it does not support quoting.

It's conceivable that you might try running, on each node:

  alter schema "_GB-LDC" rename to "_GB_LDC";

I'd suggest trying that out in a test environment first :-)

-- 
output = ("cbbrowne" "@" "ca.afilias.info")
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"

From mark.hagger at mxdata.co.uk  Tue Apr 21 08:18:47 2009
From: mark.hagger at mxdata.co.uk (Mark Hagger)
Date: Tue Apr 21 08:18:57 2009
Subject: [Slony1-general] hyphen in slony cluster names
In-Reply-To: <49EDDFD2.1070101@ca.afilias.info>
References: <1240303314.25704.33.camel@giga.cambridge.m-spatial.com>
	<49EDDFD2.1070101@ca.afilias.info>
Message-ID: <1240327127.15437.163.camel@giga.cambridge.m-spatial.com>

U2tpcHBlZCBjb250ZW50IG9mIHR5cGUgbXVsdGlwYXJ0L2FsdGVybmF0aXZlLS0tLS0tLS0tLS0t
LS0gbmV4dCBwYXJ0IC0tLS0tLS0tLS0tLS0tCkEgbm9uLXRleHQgYXR0YWNobWVudCB3YXMgc2Ny
dWJiZWQuLi4KTmFtZTogbXhkYXRhLmpwZwpUeXBlOiBpbWFnZS9qcGVnClNpemU6IDUwNTUgYnl0
ZXMKRGVzYzogbm90IGF2YWlsYWJsZQpVcmwgOiBodHRwOi8vbGlzdHMuc2xvbnkuaW5mby9waXBl
cm1haWwvc2xvbnkxLWdlbmVyYWwvYXR0YWNobWVudHMvMjAwOTA0MjEvZWE3OTVkYWIvbXhkYXRh
LTAwMDEuanBnCg==
From cbbrowne at ca.afilias.info  Tue Apr 21 10:05:52 2009
From: cbbrowne at ca.afilias.info (cbbrowne)
Date: Tue Apr 21 10:06:03 2009
Subject: [Slony1-general] hyphen in slony cluster names
In-Reply-To: <1240327127.15437.163.camel@giga.cambridge.m-spatial.com>
References: <1240303314.25704.33.camel@giga.cambridge.m-spatial.com>	
	<49EDDFD2.1070101@ca.afilias.info>
	<1240327127.15437.163.camel@giga.cambridge.m-spatial.com>
Message-ID: <49EDFCF0.1020907@ca.afilias.info>

Mark Hagger wrote:
> On Tue, 2009-04-21 at 11:01 -0400, cbbrowne wrote:
>> I'm surprised you got far enough to be able to consider a MOVE SET request.
>>     
>
> In these cases I'd used the pgadmin slony admin interface to create 
> and configure these clusters, I guess that whatever that does
> is able to handle the hyphens ok.  However, the pgadmin stuff doesn't 
> allow more useful things like moves and failovers to be
> controlled so I backed up to using slonik commands directly and then 
> it all fell apart.
Ah, that's useful to know!

Slonik's parsing is evidently enforcing this, but the underlying 
functions aren't.

Consistency would suggest either:
a) Changing slonik to make it support the "richer" set of names, or
b) Changing functions that manipulate cluster names to complain if the 
cluster name isn't supposed to be valid...
> Incidently the documention for cluster names, eg at 
> http://www.slony.info/documentation/clustername.html, 
> <http://www.slony.info/documentation/clustername.html> has no mention of
> any potential restrictions on characters, or did I miss something 
> somewhere?
This issue hadn't been noticed before now.
>> The cluster name is handled by Slonik as an alphanumeric string, in much 
>> the same form as a SQL identifier, and it does not support quoting.
>>
>> It's conceivable that you might try running, on each node:
>>
>>   alter schema "_GB-LDC" rename to "_GB_LDC";
>>
>> I'd suggest trying that out in a test environment first :-)
>>     
>
> Thanks, I ended up dropping the cluster's and recreating them in a 
> "controlled way", by luck none of the effected databases were high 
> traffic or
> had large volumes of data.
>
> Regards,
>
I'm glad that worked out!  I'll see about getting this documented and/or 
validated.

-- 
output = ("cbbrowne" "@" "ca.afilias.info")
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"

From kerdezixe at gmail.com  Wed Apr 22 03:48:17 2009
From: kerdezixe at gmail.com (Laurent Laborde)
Date: Wed Apr 22 03:48:49 2009
Subject: [Slony1-general] slon segmentation fault.
Message-ID: <8a1bfe660904220348y411b136agd03faebc5df66e17@mail.gmail.com>

Friendly greetings !

We've got a problem with slony segfaulting while replicating.
Because of a misplaced trigger (which wasn't supposed to be enabled)
on insert on a replicated table, that trigger was trying to create a
new entry every time slony was inserting a new row on this specific
table, and created a conflict :
postgres[3973]: [3-1] user=slony,db=ob2ERROR:duplicate key value
violates unique constraint "_article_counters_materialized_pkey"

In this case, according to the documentation, slony should PANIC, and it panic.
But instead of nicely exiting, it commit suicide with a segmentation fault.

kernel: slon[29305]: segfault at 0000000000000047 rip 00002b0e96f20580
rsp 00000000467f7858 error 4

Infortunaly, i don't have any good test case for you, as it happened
on production server.

Slony 1-2-15 (compiled from source)
Postgresql 8.3.6 (compiled from source)

Linux x64 Compiled from source, with custom patch. it's a Xen VM server.


-- 
F4FQM
Kerunix Flan
Laurent Laborde
From cbbrowne at ca.afilias.info  Wed Apr 22 12:32:03 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed Apr 22 12:32:17 2009
Subject: [Slony1-general] hyphen in slony cluster names
In-Reply-To: <49EDFCF0.1020907@ca.afilias.info> (cbbrowne@ca.afilias.info's
	message of "Tue, 21 Apr 2009 13:05:52 -0400")
References: <1240303314.25704.33.camel@giga.cambridge.m-spatial.com>
	<49EDDFD2.1070101@ca.afilias.info>
	<1240327127.15437.163.camel@giga.cambridge.m-spatial.com>
	<49EDFCF0.1020907@ca.afilias.info>
Message-ID: <87ljpsiix8.fsf@dba2.int.libertyrms.com>

cbbrowne <cbbrowne@ca.afilias.info> writes:
> Consistency would suggest either:
> a) Changing slonik to make it support the "richer" set of names, or
> b) Changing functions that manipulate cluster names to complain if the
> cluster name isn't supposed to be valid...

Grr.  Neither of these can work, as generating the cluster name
doesn't take place inside a function.

I could, in principle, add in a function that would be called by
several of the "front line" Slony-I config functions (I'd think that
those that stand behind STORE NODE would be pretty suitable) that
would complain bitterly if an invalid name was used.  

That feels mean-spirited, though ;-).
-- 
output = ("cbbrowne" "@" "linuxfinances.info")
http://www3.sympatico.ca/cbbrowne/linux.html
Rules of the Evil  Overlord #99. "Any data  file of crucial importance
will be padded to 1.45Mb in size." <http://www.eviloverlord.com/>
From mark.hagger at mxdata.co.uk  Thu Apr 23 01:58:10 2009
From: mark.hagger at mxdata.co.uk (Mark Hagger)
Date: Thu Apr 23 01:58:51 2009
Subject: [Slony1-general] hyphen in slony cluster names
In-Reply-To: <87ljpsiix8.fsf@dba2.int.libertyrms.com>
References: <1240303314.25704.33.camel@giga.cambridge.m-spatial.com>
	<49EDDFD2.1070101@ca.afilias.info>
	<1240327127.15437.163.camel@giga.cambridge.m-spatial.com>
	<49EDFCF0.1020907@ca.afilias.info>
	<87ljpsiix8.fsf@dba2.int.libertyrms.com>
Message-ID: <1240477090.15437.1264.camel@giga.cambridge.m-spatial.com>

U2tpcHBlZCBjb250ZW50IG9mIHR5cGUgbXVsdGlwYXJ0L2FsdGVybmF0aXZlLS0tLS0tLS0tLS0t
LS0gbmV4dCBwYXJ0IC0tLS0tLS0tLS0tLS0tCkEgbm9uLXRleHQgYXR0YWNobWVudCB3YXMgc2Ny
dWJiZWQuLi4KTmFtZTogbXhkYXRhLmpwZwpUeXBlOiBpbWFnZS9qcGVnClNpemU6IDUwNTUgYnl0
ZXMKRGVzYzogbm90IGF2YWlsYWJsZQpVcmwgOiBodHRwOi8vbGlzdHMuc2xvbnkuaW5mby9waXBl
cm1haWwvc2xvbnkxLWdlbmVyYWwvYXR0YWNobWVudHMvMjAwOTA0MjMvYmY3NGQ5YTQvbXhkYXRh
LmpwZwo=
From lists at serioustechnology.com  Thu Apr 23 05:03:20 2009
From: lists at serioustechnology.com (Geoffrey)
Date: Thu Apr 23 05:03:53 2009
Subject: [Slony1-general] time differential cause problems with slony?
Message-ID: <49F05908.7080204@serioustechnology.com>

Noticed yesterday that the same two tables on all our databases (12) are 
out of sync.  I've just noticed today that the date on the slave is 1 
hour behind the master.  Is it possible that this time difference could 
cause any problems with slony replication?

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From thawes at novadine.com  Thu Apr 23 05:37:20 2009
From: thawes at novadine.com (Tim Hawes)
Date: Thu Apr 23 05:37:27 2009
Subject: [Slony1-general] time differential cause problems with slony?
In-Reply-To: <49F05908.7080204@serioustechnology.com>
References: <49F05908.7080204@serioustechnology.com>
Message-ID: <49F06100.2000105@novadine.com>

Most definitely. We keep all our replicants on the same ntp service to 
avoid time issues. It would only effect the nodes that are an hour 
behind. If there are any nodes that were in date/time sync with the 
master that had out of date data, and the master was it's provider (and 
not another slave) then there is something else going on there as well.

Geoffrey wrote:
> Noticed yesterday that the same two tables on all our databases (12) 
> are out of sync.  I've just noticed today that the date on the slave 
> is 1 hour behind the master.  Is it possible that this time difference 
> could cause any problems with slony replication?
>

From lists at serioustechnology.com  Thu Apr 23 06:04:39 2009
From: lists at serioustechnology.com (Geoffrey)
Date: Thu Apr 23 06:04:43 2009
Subject: [Slony1-general] time differential cause problems with slony?
In-Reply-To: <49F06100.2000105@novadine.com>
References: <49F05908.7080204@serioustechnology.com>
	<49F06100.2000105@novadine.com>
Message-ID: <49F06767.20609@serioustechnology.com>

Tim Hawes wrote:
> Most definitely. We keep all our replicants on the same ntp service to 
> avoid time issues. It would only effect the nodes that are an hour 
> behind. If there are any nodes that were in date/time sync with the 
> master that had out of date data, and the master was it's provider (and 
> not another slave) then there is something else going on there as well.

So, the next question is, why would it only affect two tables out of the 
229?

> 
> Geoffrey wrote:
>> Noticed yesterday that the same two tables on all our databases (12) 
>> are out of sync.  I've just noticed today that the date on the slave 
>> is 1 hour behind the master.  Is it possible that this time difference 
>> could cause any problems with slony replication?
>>
> 
> 


-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From lists at serioustechnology.com  Thu Apr 23 06:32:57 2009
From: lists at serioustechnology.com (Geoffrey)
Date: Thu Apr 23 06:33:07 2009
Subject: [Slony1-general] will truncating a table on the master be properly
 handled by slony on the slave?
Message-ID: <49F06E09.4090505@serioustechnology.com>

Subject says it.  If I truncate a table on my master, will that be 
properly handled on the slave?

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From ajs at crankycanuck.ca  Thu Apr 23 06:54:15 2009
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Thu Apr 23 06:54:23 2009
Subject: [Slony1-general] will truncating a table on the master be
	properly handled by slony on the slave?
In-Reply-To: <49F06E09.4090505@serioustechnology.com>
References: <49F06E09.4090505@serioustechnology.com>
Message-ID: <20090423135414.GA68521@shinkuro.com>

On Thu, Apr 23, 2009 at 09:32:57AM -0400, Geoffrey wrote:
> Subject says it.  If I truncate a table on my master, will that be  
> properly handled on the slave?

The manual says

    TRUNCATE will not run any ON DELETE triggers that might exist for
    the tables.

So no, if you mean "will the truncate happen on the replica too?"

A


-- 
Andrew Sullivan
ajs@crankycanuck.ca
From lists at serioustechnology.com  Thu Apr 23 07:13:41 2009
From: lists at serioustechnology.com (Geoffrey)
Date: Thu Apr 23 07:13:46 2009
Subject: [Slony1-general] will truncating a table on the master be	properly
	handled by slony on the slave?
In-Reply-To: <20090423135414.GA68521@shinkuro.com>
References: <49F06E09.4090505@serioustechnology.com>
	<20090423135414.GA68521@shinkuro.com>
Message-ID: <49F07795.5070405@serioustechnology.com>

Andrew Sullivan wrote:
> On Thu, Apr 23, 2009 at 09:32:57AM -0400, Geoffrey wrote:
>> Subject says it.  If I truncate a table on my master, will that be  
>> properly handled on the slave?
> 
> The manual says
> 
>     TRUNCATE will not run any ON DELETE triggers that might exist for
>     the tables.
> 
> So no, if you mean "will the truncate happen on the replica too?"

Yeah, that's what I mean, so this is likely why these two tables are out 
of sync.  They were truncated earlier this year.

So, the solution to this is, I assume 'execute script?'

Also, what is the best way to get these tables back in sync without 
trashing slony and starting over?

Can we drop the tables from replication and re-add them?

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From ajs at crankycanuck.ca  Thu Apr 23 07:19:13 2009
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Thu Apr 23 07:19:20 2009
Subject: [Slony1-general] will truncating a table on the master be
	properly handled by slony on the slave?
In-Reply-To: <49F07795.5070405@serioustechnology.com>
References: <49F06E09.4090505@serioustechnology.com>
	<20090423135414.GA68521@shinkuro.com>
	<49F07795.5070405@serioustechnology.com>
Message-ID: <20090423141913.GD68521@shinkuro.com>

On Thu, Apr 23, 2009 at 10:13:41AM -0400, Geoffrey wrote:
> So, the solution to this is, I assume 'execute script?'

Well, maybe.  The point of truncating is usually to do something fast,
cheap, and easy.  EXECUTE SCRIPT entails a heavyweight lock.  Often,
there _is_ no real way to do this easily.

Since the table is guaranteed to be empty after a truncate, of course,
you can just take it out of replication, truncate it, and re-add it:
the latter should be very fast on an empty table.  It's still a
locking operation, though.

If you have a table you want to truncate a lot, the better bet is to
use inheritance and a couple different underlying tables, so that you
have a table that is guaranteed "out of service" on all nodes.  Then
you can truncate that table everywhere without fear.  This is a loaded
foot-gun, however, so be careful.

> Also, what is the best way to get these tables back in sync without  
> trashing slony and starting over?
>
> Can we drop the tables from replication and re-add them?

Yes.

A

-- 
Andrew Sullivan
ajs@crankycanuck.ca
From cbbrowne at ca.afilias.info  Thu Apr 23 07:49:14 2009
From: cbbrowne at ca.afilias.info (cbbrowne)
Date: Thu Apr 23 07:49:20 2009
Subject: [Slony1-general] hyphen in slony cluster names
In-Reply-To: <1240477090.15437.1264.camel@giga.cambridge.m-spatial.com>
References: <1240303314.25704.33.camel@giga.cambridge.m-spatial.com>	
	<49EDDFD2.1070101@ca.afilias.info>	
	<1240327127.15437.163.camel@giga.cambridge.m-spatial.com>	
	<49EDFCF0.1020907@ca.afilias.info>
	<87ljpsiix8.fsf@dba2.int.libertyrms.com>
	<1240477090.15437.1264.camel@giga.cambridge.m-spatial.com>
Message-ID: <49F07FEA.2030507@ca.afilias.info>

Mark Hagger wrote:
> Although preventing anyone getting into the state I got into must be a 
> good thing, even if it does feel quite evil.
>
I suppose I should :-).

-- 
(reverse (concatenate 'string "ofni.sailifa.ac" "@" "enworbbc"))
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"

From lists at serioustechnology.com  Thu Apr 23 07:50:56 2009
From: lists at serioustechnology.com (Geoffrey)
Date: Thu Apr 23 07:51:03 2009
Subject: [Slony1-general] will truncating a table on the master be	properly
	handled by slony on the slave?
In-Reply-To: <20090423141913.GD68521@shinkuro.com>
References: <49F06E09.4090505@serioustechnology.com>	<20090423135414.GA68521@shinkuro.com>	<49F07795.5070405@serioustechnology.com>
	<20090423141913.GD68521@shinkuro.com>
Message-ID: <49F08050.6010908@serioustechnology.com>

Andrew Sullivan wrote:
> On Thu, Apr 23, 2009 at 10:13:41AM -0400, Geoffrey wrote:
>> Also, what is the best way to get these tables back in sync without  
>> trashing slony and starting over?
>>
>> Can we drop the tables from replication and re-add them?
> 
> Yes.

Checking the documentation, I want to make sure I've got the right 
command.  is 'setdroptable()' the command I want to use?  I want to make 
sure this drops the table from replication and does not DROP TABLE from 
my database.

By the way, I think there's a typo in the docs:

http://slony.info/documentation/function.setdroptable-integer.html

-- ----
-- Drop the table from the set and generate the SET_ADD_TABLE event
-- ----

Shouldn't the above be SET_DROP_TABLE ??


-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From cbbrowne at ca.afilias.info  Thu Apr 23 07:53:03 2009
From: cbbrowne at ca.afilias.info (cbbrowne)
Date: Thu Apr 23 07:53:08 2009
Subject: [Slony1-general] time differential cause problems with slony?
In-Reply-To: <49F05908.7080204@serioustechnology.com>
References: <49F05908.7080204@serioustechnology.com>
Message-ID: <49F080CF.4020902@ca.afilias.info>

Geoffrey wrote:
> Noticed yesterday that the same two tables on all our databases (12) 
> are out of sync.  I've just noticed today that the date on the slave 
> is 1 hour behind the master.  Is it possible that this time difference 
> could cause any problems with slony replication?
>
In what sense are they "out of sync"?

Slony-I doesn't use timestamps to control its behaviour; it uses 
internal transaction IDs, so this seems rather surprising.

I'd appreciate it a lot if you could do some poking at it to see if you 
could determine where specifically the problem arose, as  it would be a 
LOT better to be able to give specific diagnosis of "make sure X doesn't 
happen to your system!" rather than merely saying "oh, you shouldn't let 
times get TOO out of sync otherwise there might be some problems..."

-- 
(format nil "~S@~S" "cbbrowne" "ca.afilias.info")
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"

From cbbrowne at ca.afilias.info  Thu Apr 23 07:59:44 2009
From: cbbrowne at ca.afilias.info (cbbrowne)
Date: Thu Apr 23 07:59:50 2009
Subject: [Slony1-general] will truncating a table on the master be properly
	handled by slony on the slave?
In-Reply-To: <49F06E09.4090505@serioustechnology.com>
References: <49F06E09.4090505@serioustechnology.com>
Message-ID: <49F08260.4010604@ca.afilias.info>

Geoffrey wrote:
> Subject says it.  If I truncate a table on my master, will that be 
> properly handled on the slave?
>
Not particularly, no...

No triggers fire ON TRUNCATE, at least not until PostgreSQL 8.4, which 
isn't really available yet ;-).

With 8.4, there are two possibiliities:

a) We could put a "denyaccess()" function in the ON TRUNCATE method; 
this would lead to consistency, if not complete happiness :-).

b) It is in-principle possible to have the ON TRUNCATE trigger capture 
the table ID, and propagate that event.  Unfortunately, things are 
considerably complicated if there are foreign keys with ON DELETE 
CASCADE, or a request for TRUNCATE foo CASCADE, or for TRUNCATE foo, 
bar, something_not_replicated.

Simon Riggs (who implemented the trigger hook for ON TRUNCATE) generated 
a patch for the simplistic form of b), where we assume we're only coping 
with one TRUNCATE at a time.  No ideas have yet occurred to me for 
coping with several.

But I presume you're not on 8.4, so no, TRUNCATE mayn't work out totally 
well...

-- 
(reverse (concatenate 'string "ofni.sailifa.ac" "@" "enworbbc"))
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"

From glynastill at yahoo.co.uk  Thu Apr 23 08:00:45 2009
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Thu Apr 23 08:00:53 2009
Subject: [Slony1-general] will truncating a table on the master be
	properly handled by slony on the slave?
In-Reply-To: <49F08050.6010908@serioustechnology.com>
Message-ID: <588301.34340.qm@web23605.mail.ird.yahoo.com>


> 
> Checking the documentation, I want to make sure I've
> got the right command.  is 'setdroptable()' the
> command I want to use?  I want to make sure this drops the
> table from replication and does not DROP TABLE from my
> database.
> 

I think you want the SET DROP TABLE slonik command thather than the baremetal function.

http://slony.info/documentation/stmtsetdroptable.html

> By the way, I think there's a typo in the docs:
> 
> http://slony.info/documentation/function.setdroptable-integer.html
> 
> -- ----
> -- Drop the table from the set and generate the
> SET_ADD_TABLE event
> -- ----
> 
> Shouldn't the above be SET_DROP_TABLE ??
> 

Yeah I think you've found a typo there.



      
From lists at serioustechnology.com  Thu Apr 23 08:02:30 2009
From: lists at serioustechnology.com (Geoffrey)
Date: Thu Apr 23 08:02:40 2009
Subject: [Slony1-general] time differential cause problems with slony?
In-Reply-To: <49F080CF.4020902@ca.afilias.info>
References: <49F05908.7080204@serioustechnology.com>
	<49F080CF.4020902@ca.afilias.info>
Message-ID: <49F08306.6020507@serioustechnology.com>

cbbrowne wrote:
> Geoffrey wrote:
>> Noticed yesterday that the same two tables on all our databases (12) 
>> are out of sync.  I've just noticed today that the date on the slave 
>> is 1 hour behind the master.  Is it possible that this time difference 
>> could cause any problems with slony replication?
>>
> In what sense are they "out of sync"?

The slave is way behind record count wise.  Lag is not an issue.  For 
example, one table the count of records on the master node is 1500, on 
the slave it is 762.

> Slony-I doesn't use timestamps to control its behaviour; it uses 
> internal transaction IDs, so this seems rather surprising.
> 
> I'd appreciate it a lot if you could do some poking at it to see if you 
> could determine where specifically the problem arose, as  it would be a 
> LOT better to be able to give specific diagnosis of "make sure X doesn't 
> happen to your system!" rather than merely saying "oh, you shouldn't let 
> times get TOO out of sync otherwise there might be some problems..."

I suspect that this was caused by the truncation of these tables on the 
master node.  See the other recent threads around this issue.

Looking in the logs, I don't really see anything that would tell me 
there was a problem.

Basically, there is a year end process that truncates two tables on all 
our databases.  I was unaware that slony would not replicate the 
truncation process.

The thing that confuses me about this is that I would have expected the 
slave node to have a higher record count then the master, since the 
master was truncated.

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From lists at serioustechnology.com  Thu Apr 23 08:04:19 2009
From: lists at serioustechnology.com (Geoffrey)
Date: Thu Apr 23 08:04:26 2009
Subject: [Slony1-general] will truncating a table on the master be properly
	handled by slony on the slave?
In-Reply-To: <588301.34340.qm@web23605.mail.ird.yahoo.com>
References: <588301.34340.qm@web23605.mail.ird.yahoo.com>
Message-ID: <49F08373.5000807@serioustechnology.com>

Glyn Astill wrote:
>> Checking the documentation, I want to make sure I've
>> got the right command.  is 'setdroptable()' the
>> command I want to use?  I want to make sure this drops the
>> table from replication and does not DROP TABLE from my
>> database.
>>
> 
> I think you want the SET DROP TABLE slonik command thather than the baremetal function.
> 
> http://slony.info/documentation/stmtsetdroptable.html

Yeah, that looks like the right toy, thanks.

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From stephane.schildknecht at postgresqlfr.org  Thu Apr 23 08:11:55 2009
From: stephane.schildknecht at postgresqlfr.org (=?ISO-8859-15?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Thu Apr 23 08:12:06 2009
Subject: [Slony1-general] time differential cause problems with slony?
In-Reply-To: <49F080CF.4020902@ca.afilias.info>
References: <49F05908.7080204@serioustechnology.com>
	<49F080CF.4020902@ca.afilias.info>
Message-ID: <49F0853B.3010804@postgresqlfr.org>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

cbbrowne a ?crit :
> Geoffrey wrote:
>> Noticed yesterday that the same two tables on all our databases (12)
>> are out of sync.  I've just noticed today that the date on the slave
>> is 1 hour behind the master.  Is it possible that this time difference
>> could cause any problems with slony replication?
>>
> In what sense are they "out of sync"?
> 
> Slony-I doesn't use timestamps to control its behaviour; it uses
> internal transaction IDs, so this seems rather surprising.
> 
> I'd appreciate it a lot if you could do some poking at it to see if you
> could determine where specifically the problem arose, as  it would be a
> LOT better to be able to give specific diagnosis of "make sure X doesn't
> happen to your system!" rather than merely saying "oh, you shouldn't let
> times get TOO out of sync otherwise there might be some problems..."
> 

Hi,

I jump in this thread, as I'd like to clarify that point.

In documentation (http://www.slony.info/documentation/requirements.html), it is
said that it's a good practice to have ntp ensuring time is OK on every node.

Is it just a good practice, or is there a risk replication could fall if nodes
 don't have the same time ?

What's more, I remember having seen a replication trying endlessly to sync a
slave without success. Every time the slave finished initial synchronisation,
synchronisation was beginning again, as slon thought the node was far away for
the master.

Did I made a false assumption, then? Or could it really be what would happen in
case times are really different between nodes?

Regards,
- --
St?phane Schildknecht
PostgreSQLFr - http://www.postgresql.fr
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFJ8IU6A+REPKWGI0ERAtBuAJ93PCWI6IdnfHqoDEIlm7qQSGc0SwCeJ8s1
9t8RoFNezC1XJQS/k0yBHbc=
=ZnMF
-----END PGP SIGNATURE-----
From rainer at ultra-secure.de  Thu Apr 23 08:19:12 2009
From: rainer at ultra-secure.de (Rainer Duffner)
Date: Thu Apr 23 08:19:31 2009
Subject: [Slony1-general] compiling slony 2.0.1 on Solaris10U6
In-Reply-To: <49E4A19C.2080000@ultra-secure.de>
References: <49E4A19C.2080000@ultra-secure.de>
Message-ID: <49F086F0.9000701@ultra-secure.de>

Rainer Duffner schrieb:
> Hi,
>
>
>   
...

> Now, I don't know which package actually provides this "pgport"-library.
> On FreeBSD, it seems to be part of the server-page, but I can't seem to
> find it on Solaris...
>
> Anybody got an idea?
>
>
>   



Hi,

I got, seems like the pgport library is part of the postgres
distribution but not part of the Solaris package.

After getting postgres compiled on Solaris (which is an endavour in
itself...), I'm now back to slony:

./configure --with-pgconfigdir=/usr/postgres/8.3/bin
--with-pgpkglibdir=/usr/postgres/8.3/lib

...
gmake:

/opt/SUNWspro/bin/cc -g -I../..
-DPGSHARE="\"/usr/postgres/8.3/share/\""  -I/usr/postgres/8.3/include/
-I/usr/postgres/8.3/include/server/ -I/usr/postgres/8.3/include/
-I/usr/postgres/8.3/include/server/ -I/usr/postgres/8.3/include/
-I/usr/postgres/8.3/include/server/ -I../../src/slonik -c -o
slony_logshipper.o slony_logshipper.c
"/usr/postgres/8.3/include/server/pg_config.h", line 712: warning: macro
redefined: _FILE_OFFSET_BITS
/opt/SUNWspro/bin/cc -g -I../..
-DPGSHARE="\"/usr/postgres/8.3/share/\""  -I/usr/postgres/8.3/include/
-I/usr/postgres/8.3/include/server/ -I/usr/postgres/8.3/include/
-I/usr/postgres/8.3/include/server/ -I/usr/postgres/8.3/include/
-I/usr/postgres/8.3/include/server/ -I../../src/slonik -c -o dbutil.o
dbutil.c
"/usr/postgres/8.3/include/server/pg_config.h", line 712: warning: macro
redefined: _FILE_OFFSET_BITS
/opt/SUNWspro/bin/cc -g -I../..
-DPGSHARE="\"/usr/postgres/8.3/share/\""  -I/usr/postgres/8.3/include/
-I/usr/postgres/8.3/include/server/ -I/usr/postgres/8.3/include/
-I/usr/postgres/8.3/include/server/ -I/usr/postgres/8.3/include/
-I/usr/postgres/8.3/include/server/ -I../../src/slonik -c -o ipcutil.o
ipcutil.c
"/usr/postgres/8.3/include/server/pg_config.h", line 712: warning: macro
redefined: _FILE_OFFSET_BITS
bison -y -d  parser.y
gmake[2]: *** [parser.c] Broken Pipe
gmake[2]: Leaving directory
`/export/home/rduffner/slony1-2.0.1/src/slony_logshipper'
gmake[1]: *** [all] Error 2
gmake[1]: Leaving directory `/export/home/rduffner/slony1-2.0.1/src'


How do you fix that?


Best Regards,
Rainer

From lists at serioustechnology.com  Thu Apr 23 09:25:34 2009
From: lists at serioustechnology.com (Geoffrey)
Date: Thu Apr 23 09:25:43 2009
Subject: [Slony1-general] will truncating a table on the master be properly
	handled by slony on the slave?
In-Reply-To: <588301.34340.qm@web23605.mail.ird.yahoo.com>
References: <588301.34340.qm@web23605.mail.ird.yahoo.com>
Message-ID: <49F0967E.2010402@serioustechnology.com>

Glyn Astill wrote:
>> Checking the documentation, I want to make sure I've
>> got the right command.  is 'setdroptable()' the
>> command I want to use?  I want to make sure this drops the
>> table from replication and does not DROP TABLE from my
>> database.
>>
> 
> I think you want the SET DROP TABLE slonik command thather than the baremetal function.
> 
> http://slony.info/documentation/stmtsetdroptable.html

And after reviewing the docs, I need to do a MERGE SET rather then a SET 
ADD TABLE as I'll be adding the table back into an existing set?

Should the any related sequences be dropped/merged as well?

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From ajs at crankycanuck.ca  Thu Apr 23 09:53:27 2009
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Thu Apr 23 09:53:37 2009
Subject: [Slony1-general] will truncating a table on the master be
	properly handled by slony on the slave?
In-Reply-To: <49F0967E.2010402@serioustechnology.com>
References: <588301.34340.qm@web23605.mail.ird.yahoo.com>
	<49F0967E.2010402@serioustechnology.com>
Message-ID: <20090423165326.GB68912@shinkuro.com>

On Thu, Apr 23, 2009 at 12:25:34PM -0400, Geoffrey wrote:
>
> And after reviewing the docs, I need to do a MERGE SET rather then a SET  
> ADD TABLE as I'll be adding the table back into an existing set?
>
> Should the any related sequences be dropped/merged as well?

You need to do both, separately.  Add the table to a new set, get it
all synced up, then merge the sets.

A

-- 
Andrew Sullivan
ajs@crankycanuck.ca
From cbbrowne at ca.afilias.info  Thu Apr 23 10:21:21 2009
From: cbbrowne at ca.afilias.info (cbbrowne)
Date: Thu Apr 23 10:21:32 2009
Subject: [Slony1-general] hyphen in slony cluster names
In-Reply-To: <1240477090.15437.1264.camel@giga.cambridge.m-spatial.com>
References: <1240303314.25704.33.camel@giga.cambridge.m-spatial.com>	
	<49EDDFD2.1070101@ca.afilias.info>	
	<1240327127.15437.163.camel@giga.cambridge.m-spatial.com>	
	<49EDFCF0.1020907@ca.afilias.info>
	<87ljpsiix8.fsf@dba2.int.libertyrms.com>
	<1240477090.15437.1264.camel@giga.cambridge.m-spatial.com>
Message-ID: <49F0A391.7050504@ca.afilias.info>

Mark Hagger wrote:
> Although preventing anyone getting into the state I got into must be a 
> good thing, even if it does feel quite evil.
>
>
Actually, there's a clean way...

I think something's buggy about this, because a test didn't complain, 
but the approach is clean enough...

There *is* a suitable "hook" - we just add in a function that runs when 
functions are being loaded into the new node.  The function can throw 
itself away afterwards, so we're not even leaving cruft in the database. :-)

Index: backend/slony1_funcs.sql
===================================================================
RCS file: /home/cvsd/slony1/slony1-engine/src/backend/slony1_funcs.sql,v
retrieving revision 1.145.2.8
diff -c -u -r1.145.2.8 slony1_funcs.sql
cvs diff: conflicting specifications of output style
--- backend/slony1_funcs.sql    6 Apr 2009 22:33:04 -0000    1.145.2.8
+++ backend/slony1_funcs.sql    23 Apr 2009 17:18:15 -0000
@@ -198,6 +198,32 @@
 
 select @NAMESPACE@.checkmoduleversion();
 
+-----------------------------------------------------------------------
+-- This function checks to see if the namespace name is valid. 
+--
+-- Apparently pgAdminIII does different validation than Slonik, and so
+-- users that set up cluster names using pgAdminIII can get in trouble in
+-- that they do not get around to needing Slonik until it is too
+-- late...
+-----------------------------------------------------------------------
+
+create or replace function @NAMESPACE@.check_namespace_validity () 
returns boolean as $$
+declare
+    c_cluster text;
+begin
+    c_cluster := '@CLUSTERNAME@';
+    if c_cluster ~ '^(0|1|2|3|4|5|6|7|8|9)' then
+        raise exception 'Cluster name % starts with 0-9 - not a valid 
SQL symbol!', c_cluster;
+    end if;
+    if c_cluster like '%-%' then
+        raise exception 'Cluster name % contains "-" - not a valid SQL 
symbol!', c_cluster;
+    end if;
+end
+$$ language plpgsql;
+
+select @NAMESPACE@.check_namespace_validity();
+drop function @NAMESPACE@.check_namespace_validity();
+
 -- ----------------------------------------------------------------------
 -- FUNCTION logTrigger ()
 --


-- 
(reverse (concatenate 'string "ofni.sailifa.ac" "@" "enworbbc"))
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"

From lists at serioustechnology.com  Thu Apr 23 12:43:14 2009
From: lists at serioustechnology.com (Geoffrey)
Date: Thu Apr 23 12:43:27 2009
Subject: [Slony1-general] will truncating a table on the master be	properly
	handled by slony on the slave?
In-Reply-To: <20090423165326.GB68912@shinkuro.com>
References: <588301.34340.qm@web23605.mail.ird.yahoo.com>	<49F0967E.2010402@serioustechnology.com>
	<20090423165326.GB68912@shinkuro.com>
Message-ID: <49F0C4D2.9010601@serioustechnology.com>

Andrew Sullivan wrote:
> On Thu, Apr 23, 2009 at 12:25:34PM -0400, Geoffrey wrote:
>> And after reviewing the docs, I need to do a MERGE SET rather then a SET  
>> ADD TABLE as I'll be adding the table back into an existing set?
>>
>> Should the any related sequences be dropped/merged as well?
> 
> You need to do both, separately.  Add the table to a new set, get it
> all synced up, then merge the sets.

So that means:

drop the table
add it to a new set
merge that set into the original set that table was in

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From ajs at crankycanuck.ca  Thu Apr 23 12:48:13 2009
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Thu Apr 23 12:48:27 2009
Subject: [Slony1-general] will truncating a table on the master be
	properly handled by slony on the slave?
In-Reply-To: <49F0C4D2.9010601@serioustechnology.com>
References: <588301.34340.qm@web23605.mail.ird.yahoo.com>
	<49F0967E.2010402@serioustechnology.com>
	<20090423165326.GB68912@shinkuro.com>
	<49F0C4D2.9010601@serioustechnology.com>
Message-ID: <20090423194812.GI68912@shinkuro.com>

On Thu, Apr 23, 2009 at 03:43:14PM -0400, Geoffrey wrote:
> drop the table

>From the set.
create a new set

> add it to a new set

let the set be caught up everywhere

> merge that set into the original set that table was in

Yes.  This step is optional.  If you're going to truncate this again,
just don't merge.

A

-- 
Andrew Sullivan
ajs@crankycanuck.ca
From lists at serioustechnology.com  Thu Apr 23 12:53:47 2009
From: lists at serioustechnology.com (Geoffrey)
Date: Thu Apr 23 12:54:00 2009
Subject: [Slony1-general] will truncating a table on the master be	properly
	handled by slony on the slave?
In-Reply-To: <20090423194812.GI68912@shinkuro.com>
References: <588301.34340.qm@web23605.mail.ird.yahoo.com>
	<49F0967E.2010402@serioustechnology.com>
	<20090423165326.GB68912@shinkuro.com>
	<49F0C4D2.9010601@serioustechnology.com>
	<20090423194812.GI68912@shinkuro.com>
Message-ID: <49F0C74B.6010001@serioustechnology.com>

Andrew Sullivan wrote:
> On Thu, Apr 23, 2009 at 03:43:14PM -0400, Geoffrey wrote:
>> drop the table
> 
>>From the set.
> create a new set
> 
>> add it to a new set
> 
> let the set be caught up everywhere
> 
>> merge that set into the original set that table was in
> 
> Yes.  This step is optional.  If you're going to truncate this again,
> just don't merge.

That is a good point, create a separate set for these tables moving forward.

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From post at bastian-voigt.de  Fri Apr 24 01:06:55 2009
From: post at bastian-voigt.de (Bastian Voigt)
Date: Fri Apr 24 01:07:25 2009
Subject: [Slony1-general] Bug in slony-ctl ?
Message-ID: <EE44DB1F-CC7C-4E0B-8F36-E4E0D553D963@bastian-voigt.de>

Dear community,

there seems to be a syntax error in the newly released slony-ctl  
scripts:

10:05:50 db02 outils # ./02_exec_init.sh
./02_exec_init.sh: line 81: syntax error near unexpected token `fi'
./02_exec_init.sh: line 81: `fi'


Cheers
Bastian
From stephane.schildknecht at postgresqlfr.org  Fri Apr 24 01:14:40 2009
From: stephane.schildknecht at postgresqlfr.org (=?ISO-8859-15?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Fri Apr 24 01:15:07 2009
Subject: [Slony1-general] Bug in slony-ctl ?
In-Reply-To: <EE44DB1F-CC7C-4E0B-8F36-E4E0D553D963@bastian-voigt.de>
References: <EE44DB1F-CC7C-4E0B-8F36-E4E0D553D963@bastian-voigt.de>
Message-ID: <49F174F0.9070905@postgresqlfr.org>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Bastian Voigt a ?crit :
> Dear community,
> 
> there seems to be a syntax error in the newly released slony-ctl scripts:
> 
> 10:05:50 db02 outils # ./02_exec_init.sh
> ./02_exec_init.sh: line 81: syntax error near unexpected token `fi'
> ./02_exec_init.sh: line 81: `fi'
> 
> 
> Cheers
> Bastian
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general

Yes, you're right.

Changed and commited.

Thanks for the report.

Index: 02_exec_init.sh
===================================================================
RCS file: /cvsroot/slony1-ctl/slony-ctl/outils/02_exec_init.sh,v
retrieving revision 1.6
diff -r1.6 02_exec_init.sh
71c71
< elif
- ---
> else
82a83
>

Regards,
- --
St?phane Schildknecht
PostgreSQLFr - http://www.postgresql.fr
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFJ8XTwA+REPKWGI0ERAsD6AJ4kUHEgXrro3G47XQ39YXshHfR7AACfTD4O
t2malnwtxxYPFLLGroFcTMA=
=h/2M
-----END PGP SIGNATURE-----
From post at bastian-voigt.de  Fri Apr 24 01:18:26 2009
From: post at bastian-voigt.de (Bastian Voigt)
Date: Fri Apr 24 01:18:55 2009
Subject: [Slony1-general] Bug in slony-ctl ?
In-Reply-To: <49F174F0.9070905@postgresqlfr.org>
References: <EE44DB1F-CC7C-4E0B-8F36-E4E0D553D963@bastian-voigt.de>
	<49F174F0.9070905@postgresqlfr.org>
Message-ID: <57AD3BEE-44AF-454B-9528-A913CCE10733@bastian-voigt.de>

Stephane,

that's what I call a fast response ;-)

Thanks!


> Yes, you're right.
>
> Changed and commited.

From glynastill at yahoo.co.uk  Fri Apr 24 02:10:38 2009
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Fri Apr 24 02:11:06 2009
Subject: [Slony1-general] compiling slony 2.0.1 on Solaris10U6
In-Reply-To: <49F086F0.9000701@ultra-secure.de>
Message-ID: <112865.99926.qm@web23604.mail.ird.yahoo.com>


> From: Rainer Duffner <rainer@ultra-secure.de>

> After getting postgres compiled on Solaris (which is an
> endavour in
> itself...), I'm now back to slony:



> "/usr/postgres/8.3/include/server/pg_config.h",
> line 712: warning: macro
> redefined: _FILE_OFFSET_BITS
> bison -y -d  parser.y
> gmake[2]: *** [parser.c] Broken Pipe
> gmake[2]: Leaving directory
> `/export/home/rduffner/slony1-2.0.1/src/slony_logshipper'
> gmake[1]: *** [all] Error 2
> gmake[1]: Leaving directory
> `/export/home/rduffner/slony1-2.0.1/src'
> 
> 
> How do you fix that?
> 
> 

Looks like it's failing when it gets to bison. Do you have bison and and yacc?


      
From rainer at ultra-secure.de  Fri Apr 24 02:58:32 2009
From: rainer at ultra-secure.de (Rainer Duffner)
Date: Fri Apr 24 02:59:07 2009
Subject: [Slony1-general] compiling slony 2.0.1 on Solaris10U6
In-Reply-To: <112865.99926.qm@web23604.mail.ird.yahoo.com>
References: <112865.99926.qm@web23604.mail.ird.yahoo.com>
Message-ID: <49F18D48.1000508@ultra-secure.de>

Glyn Astill schrieb:
>
> Looks like it's failing when it gets to bison. Do you have bison and and yacc?
>
>   

Actually, it turns out this error is caused by the fact that it silently
depends on gnu-m4 (instead of the SUN-m4).
The configure script should detect this, IMO.
I just found this out...

Now it compiles at least.

Rainer

From post at bastian-voigt.de  Fri Apr 24 04:08:08 2009
From: post at bastian-voigt.de (Bastian Voigt)
Date: Fri Apr 24 04:08:41 2009
Subject: [Slony1-general] Another problem with slony-ctl
Message-ID: <1A6395FA-0F33-4581-B57A-044015DD0664@bastian-voigt.de>

Hi *,

I tried to execute the following sql script using 42_exec_exec:

----------------------
ALTER TABLE aisclient ADD COLUMN date_sent_offlinemail timestamp  
without time zone;
ALTER TABLE aisclient ADD COLUMN emails character varying(128);
-----------------------

This is what I got:

13:07:16 db02 outils # ./42_exec_exec.sh -c vesseltracker -s 1 -f /opt/ 
slony1-ctl/slony-ctl/outils/aisclient.sql
Executing /opt/slony1-ctl/slony-ctl/outils/aisclient.sql on set 1  
(replication vesseltracker)...
An error occured.
See /opt/slony1-ctl/slony-ctl/logs/vesseltracker_1_exec.log for details.

13:05:50 db02 outils # less /opt/slony1-ctl/slony-ctl/logs/ 
vesseltracker_1_exec.log
/opt/slony1-ctl/slony-ctl/outils/slony_execute.sh: line 113:  
preamb_miss: command not found


Cheers
Bastian
From stephane.schildknecht at postgresqlfr.org  Fri Apr 24 05:01:26 2009
From: stephane.schildknecht at postgresqlfr.org (=?ISO-8859-15?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Fri Apr 24 05:01:57 2009
Subject: [Slony1-general] Another problem with slony-ctl
In-Reply-To: <1A6395FA-0F33-4581-B57A-044015DD0664@bastian-voigt.de>
References: <1A6395FA-0F33-4581-B57A-044015DD0664@bastian-voigt.de>
Message-ID: <49F1AA16.3050206@postgresqlfr.org>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Bastian Voigt a ?crit :
> Hi *,
> 
> I tried to execute the following sql script using 42_exec_exec:
> 
> ----------------------
> ALTER TABLE aisclient ADD COLUMN date_sent_offlinemail timestamp without
> time zone;
> ALTER TABLE aisclient ADD COLUMN emails character varying(128);
> -----------------------
> 
> This is what I got:
> 
> 13:07:16 db02 outils # ./42_exec_exec.sh -c vesseltracker -s 1 -f
> /opt/slony1-ctl/slony-ctl/outils/aisclient.sql
> Executing /opt/slony1-ctl/slony-ctl/outils/aisclient.sql on set 1
> (replication vesseltracker)...
> An error occured.
> See /opt/slony1-ctl/slony-ctl/logs/vesseltracker_1_exec.log for details.
> 
> 13:05:50 db02 outils # less
> /opt/slony1-ctl/slony-ctl/logs/vesseltracker_1_exec.log
> /opt/slony1-ctl/slony-ctl/outils/slony_execute.sh: line 113:
> preamb_miss: command not found
> 
> 
> Cheers
> Bastian

Once again, corrected and commited.

Thanks for your tests.

Index: outils/slony_execute.sh
===================================================================
RCS file: /cvsroot/slony1-ctl/slony-ctl/outils/slony_execute.sh,v
retrieving revision 1.2
diff -r1.2 slony_execute.sh
113c113
< preamb_miss
- ---
> preamble_miss $INSTANCE

Best regards,
- --
St?phane Schildknecht
PostgreSQLFr - http://www.postgresql.fr

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFJ8aoWA+REPKWGI0ERAk3BAJ915QG51yMYAkbWB+ENSaU0e8AmNgCaAyAF
DSaKZz6faG5Ttmx8rZsobxA=
=kNM9
-----END PGP SIGNATURE-----
From nyamada at millburncorp.com  Fri Apr 24 07:38:16 2009
From: nyamada at millburncorp.com (Norman Yamada)
Date: Fri Apr 24 07:38:22 2009
Subject: [Slony1-general] Renaming a database server/node in Slony 1.2.15
Message-ID: <82EECDAD-B392-407E-B4E0-034CA2291B06@millburncorp.com>

We're repurposing a database server here and want to change its DNS  
name. It's part of a Slony cluster of mixed postgres 8.2 and 8.3   
servers, running Slony 1.2.15.

Am I right in thinking that I can rename the server and not hurt slony  
replication if I :

1) stop all slony processes across all nodes;

2) fix the name of the server in the pa_connection field in the  
sl_path table;

3) fix the no_comment field in the sl_node table (just to be nice);

4) update the slon_tools.conf file (since we're using the  
slon_watchdog scripts...)

5) restart all slony processes.


If this isn't the way to do it, what's the way to change the DNS name  
of a slony node?

Thank for any help in advance --

Norman Yamada
From cbbrowne at ca.afilias.info  Fri Apr 24 07:59:16 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri Apr 24 07:59:26 2009
Subject: [Slony1-general] Renaming a database server/node in Slony 1.2.15
In-Reply-To: <82EECDAD-B392-407E-B4E0-034CA2291B06@millburncorp.com> (Norman
	Yamada's message of "Fri, 24 Apr 2009 10:38:16 -0400")
References: <82EECDAD-B392-407E-B4E0-034CA2291B06@millburncorp.com>
Message-ID: <877i1ahzcr.fsf@dba2.int.libertyrms.com>

Norman Yamada <nyamada@millburncorp.com> writes:
> We're repurposing a database server here and want to change its DNS
> name. It's part of a Slony cluster of mixed postgres 8.2 and 8.3
> servers, running Slony 1.2.15.
>
> Am I right in thinking that I can rename the server and not hurt slony
> replication if I :
>
> 1) stop all slony processes across all nodes;
>
> 2) fix the name of the server in the pa_connection field in the
> sl_path table;
>
> 3) fix the no_comment field in the sl_node table (just to be nice);
>
> 4) update the slon_tools.conf file (since we're using the
> slon_watchdog scripts...)
>
> 5) restart all slony processes.
>
>
> If this isn't the way to do it, what's the way to change the DNS name
> of a slony node?

I'd be inclined to use the slonik command "STORE PATH" to do the
fixing of server names, since that propagates automatically around the
cluster, but otherwise this seems fine.
-- 
select 'cbbrowne' || '@' || 'ca.afilias.info';
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"
From jean-paul at postgresqlfr.org  Fri Apr 24 05:53:20 2009
From: jean-paul at postgresqlfr.org (Jean-Paul Argudo)
Date: Fri Apr 24 07:59:40 2009
Subject: [Slony1-general] Compilation of Slony 1.2.15 with PostgreSQL 8.4
	beta 1 ?
Message-ID: <49F1B640.5060300@postgresqlfr.org>

Hi all,

After a
./configure --with-pgconfigdir=/usr/local/pgsql-beta/bin/

On slony 1.2.15 where pgsql-beta designs a fresh 8.4 beta1 installation,
I got, when I do make:

$ make
make[1]: Entering directory `/opt/appli/slony/sources/src'
make[2]: Entering directory `/opt/appli/slony/sources/src/xxid'
gcc -g -O2 -Wall -Wmissing-prototypes -Wmissing-declarations -fpic
-I../.. -I/usr/local/pgsql-beta/include/
-I/usr/local/pgsql-beta/include/server/  -c -o xxid.o xxid.c
xxid.c: In function '_Slony_I_getMinXid':
xxid.c:236: error: 'SerializableSnapshot' undeclared (first use in this
function)
xxid.c:236: error: (Each undeclared identifier is reported only once
xxid.c:236: error: for each function it appears in.)
xxid.c: In function '_Slony_I_getMaxXid':
xxid.c:249: error: 'SerializableSnapshot' undeclared (first use in this
function)
make[2]: *** [xxid.o] Error 1
make[2]: Leaving directory `/opt/appli/slony/sources/src/xxid'
make[1]: *** [all] Error 2
make[1]: Leaving directory `/opt/appli/slony/sources/src'
make: *** [all] Error 2


Is this a known issue? How could I install Slony 1.2.15 on a PostgreSQL
8.4 then?


Thanks for any info,

-- 
Jean-Paul Argudo
www.PostgreSQLFr.org
www.Dalibo.com
From post at bastian-voigt.de  Fri Apr 24 08:08:42 2009
From: post at bastian-voigt.de (Bastian Voigt)
Date: Fri Apr 24 08:08:50 2009
Subject: [Slony1-general] Thanks for the slonyctl tools!
Message-ID: <DB2B1F97-7FD3-4F05-825D-ED9700E93700@bastian-voigt.de>

Dear Stephane,

thanks to your great scripts and your unbelievably fast bug fixes I  
was now successful in setting up database replication for our website,  
inclusive testing the master/slave switching scenario! Now I can enjoy  
my weekend, hopy you will enjoy yours ;-)

Regards
Bastian
From nyamada at millburncorp.com  Fri Apr 24 08:16:42 2009
From: nyamada at millburncorp.com (Norman Yamada)
Date: Fri Apr 24 08:16:48 2009
Subject: [Slony1-general] Renaming a database server/node in Slony 1.2.15
In-Reply-To: <877i1ahzcr.fsf@dba2.int.libertyrms.com>
References: <82EECDAD-B392-407E-B4E0-034CA2291B06@millburncorp.com>
	<877i1ahzcr.fsf@dba2.int.libertyrms.com>
Message-ID: <E846C57B-B575-4C6B-9785-A6E2914645B5@millburncorp.com>

Hm...

Actually, I would do this, but the problem is that the cluster may not  
know where the node is for a moment, right?

e.g., if slony has a node 3 with a DNS name of "foo" and I change the  
name of the node to "bar" and then say:

STORE PATH (server=3, client=1, CONNINFO='dbname=mydb host=bar  
user=slony'), how will Slony know where server bar is? Is it  
sufficient to change the preamble for it to know that node3 = bar not  
foo?

That's why I thought it was safer to update the tables by hand on each  
node. But if you think it'll work, I'll do it via store path , because  
it's faster...

Thanks,

Norman


On Apr 24, 2009, at 10:59 AM, Christopher Browne wrote:

> I'd be inclined to use the slonik command "STORE PATH" to do the
> fixing of server names, since that propagates automatically around the
> cluster, but otherwise this seems fine.
> -- 

######################################################################
This email is confidential, does not constitute investment advice, is
only for the use of the intended recipient and should not be
redistributed, except with the sender's consent. If you received this
email in error, please notify us immediately by telephone; receipt by
anyone other than the intended recipient is not a waiver of any
work-product or attorney-client privilege. All email to and from
Millburn Ridgefield Corporation and its affiliates is monitored,
stored and made available to regulators if requested.
######################################################################
From kerdezixe at gmail.com  Fri Apr 24 11:30:01 2009
From: kerdezixe at gmail.com (Laurent Laborde)
Date: Fri Apr 24 11:30:14 2009
Subject: [Slony1-general] Compilation of Slony 1.2.15 with PostgreSQL 8.4 
	beta 1 ?
In-Reply-To: <49F1B640.5060300@postgresqlfr.org>
References: <49F1B640.5060300@postgresqlfr.org>
Message-ID: <8a1bfe660904241130h63700c77k8011cc885eb158ac@mail.gmail.com>

On Fri, Apr 24, 2009 at 2:53 PM, Jean-Paul Argudo
<jean-paul@postgresqlfr.org> wrote:
> gcc -g -O2 -Wall -Wmissing-prototypes -Wmissing-declarations -fpic
> -I../.. -I/usr/local/pgsql-beta/include/
> -I/usr/local/pgsql-beta/include/server/ ?-c -o xxid.o xxid.c
> xxid.c: In function '_Slony_I_getMinXid':
> xxid.c:236: error: 'SerializableSnapshot' undeclared (first use in this
> function)
> xxid.c:236: error: (Each undeclared identifier is reported only once
> xxid.c:236: error: for each function it appears in.)
> xxid.c: In function '_Slony_I_getMaxXid':
> xxid.c:249: error: 'SerializableSnapshot' undeclared (first use in this
> function)
> make[2]: *** [xxid.o] Error 1
> make[2]: Leaving directory `/opt/appli/slony/sources/src/xxid'
> make[1]: *** [all] Error 2
> make[1]: Leaving directory `/opt/appli/slony/sources/src'
> make: *** [all] Error 2

We tested together on IRC with Jean-Paul and we have exactly the same problem ;)

-- 
F4FQM
Kerunix Flan
Laurent Laborde
From admin at bitnoize.co.cc  Mon Apr 27 08:17:30 2009
From: admin at bitnoize.co.cc (Philipp Haselwarter)
Date: Mon Apr 27 08:34:39 2009
Subject: [Slony1-general] Compiling Slony 2.0.1 for Windows Server 2003 R2
	with PostgreSQL 8.3
Message-ID: <77cdc54b0904270817v6e5a1263q9ccf300e1f1d46ee@mail.gmail.com>

Hi,
I'm trying to get Slony 2.01 to work with Postgres 8.3 (which is up and
running quite flawlessly actually) and as I couldn't find any precompiled
binaries or installers for Windows (I'm on Server2003) I guess I'll have to
compile it by myself.
In order to do so downloaded and installed MinGW and MSYS as advised on the
slony website (although wouldn't bet that they're configured properly).

So I start MSYS and navigate to the folder I unpacked the Slony-1 2.0.1
engine into.
Then I run ./configure --with-pgconfigdir=3D/c/postgresql/8.3/bin and get

postgres@SRV-POSTGRE1 /c/slony1
$ ./configure
--with-pgconfigdir=3D/c/postgresql/8.3/bin
checking build system type... i686-pc-mingw32
checking host system type... i686-pc-mingw32
checking which template to use... win32
configure: using CFLAGS=3D
checking for gcc... gcc
checking for C compiler default output file name... a.exe
checking whether the C compiler works... yes
checking whether we are cross compiling... no
checking for suffix of executables... .exe
checking for suffix of object files... o
checking whether we are using the GNU C compiler... yes
checking whether gcc accepts -g... yes
checking for gcc option to accept ISO C89... none needed
checking for ld used by GCC... c:/mingw/mingw32/bin/ld.exe
checking if the linker (c:/mingw/mingw32/bin/ld.exe) is GNU ld... yes
checking for perl... no
checking for tar... /bin/tar
checking for flex... no
checking for ,... no
checking for lex... no
checking for bison... no
checking for ,... no
checking for yacc... no
checking for sed... sed
checking for the pthreads library -lpthreads... no
checking whether pthreads work without any flags... no
checking whether pthreads work with -Kthread... no
checking whether pthreads work with -kthread... no
checking for the pthreads library -llthread... no
checking whether pthreads work with -pthread... no
checking whether pthreads work with -pthreads... no
checking whether pthreads work with -mthreads... no
checking for the pthreads library -lpthread... no
checking whether pthreads work with --thread-safe... no
checking whether pthreads work with -mt... no
checking for pthread-config... no
checking for the pthreads library -lpthreadgc2... no
checking how to run the C preprocessor... gcc -E
checking for grep that handles long lines and -e... /bin/grep
checking for egrep... /bin/grep -E
checking for ANSI C header files... yes
checking for sys/types.h... yes
checking for sys/stat.h... yes
checking for stdlib.h... yes
checking for string.h... yes
checking for memory.h... yes
checking for strings.h... yes
checking for inttypes.h... yes
checking for stdint.h... yes
checking for unistd.h... yes
checking fcntl.h usability... yes
checking fcntl.h presence... yes
checking for fcntl.h... yes
checking limits.h usability... yes
checking limits.h presence... yes
checking for limits.h... yes
checking stddef.h usability... yes
checking stddef.h presence... yes
checking for stddef.h... yes
checking sys/socket.h usability... no
checking sys/socket.h presence... no
checking for sys/socket.h... no
checking sys/time.h usability... yes
checking sys/time.h presence... yes
checking for sys/time.h... yes
checking for inttypes.h... (cached) yes
checking for gettimeofday... yes
checking for dup2... yes
checking for alarm... no
checking for memset... yes
checking for select... no
checking for strdup... yes
checking for strerror... yes
checking for strtol... yes
checking for strtoul... yes
checking for int32_t... yes
checking for uint32_t... yes
checking for u_int32_t... no
checking for int64_t... yes
checking for uint64_t... yes
checking for u_int64_t... no
checking for ssize_t... yes
checking for POSIX signal interface... no
checking if you have requested slony1-engine building... yes
checking for pg_config... /c/postgresql/8.3/bin/pg_config
checking for correct version of PostgreSQL... 8.3
8.3
checking for PQunescapeBytea in -lpq... yes
checking libpq-fe.h usability... yes
checking libpq-fe.h presence... yes
checking for libpq-fe.h... yes
checking postgres.h usability... no
checking postgres.h presence... no
checking for postgres.h... no
checking for utils/typcache.h... no
configure: error: Headers for libpqserver are not found in the
includeserverdir.
    This is the path to postgres.h. Please specify the includeserverdir with
    --with-pgincludeserverdir=3D<dir>


Adding --with-pgincludeserverdir=3D/c/postgresql/8.3/include/server does not
make any difference, changing the order of the two parameters or putting
only the includeserverdir returns the same as above exept for a different
end:

overriding pgincludeserverdir with /c/postgresql/8.3/include/server
checking for pg_config... configure: error: Cannot find pg_config.
    Please specify correct installation path for pg_config


So what can I do now? Are PostgreSQL 8.3 and Slony 2.0.1 actually
compatible? Is there a different way for installing it? Or what's wrong with
the compiling?

Thanks a lot!!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090427/=
54c570d8/attachment.htm
From cscetbon.ext at orange-ftgroup.com  Mon Apr 27 09:16:57 2009
From: cscetbon.ext at orange-ftgroup.com (Cyril Scetbon)
Date: Mon Apr 27 09:17:05 2009
Subject: [Slony1-general] [Slony 2.0.1] Events and Confirmations not
	propagating
Message-ID: <49F5DA79.2030002@orange-ftgroup.com>

I use test_slony_state and see some informations like :

Check of event info
---------------------------------------------------
 Problem : Events not propagating to node 2
 Problem : Events not propagating to node 4
 Problem : Events not propagating to node 3

Check of sl_confirm aging
---------------------------------------------------
 Confirmations not propagating from 2 to 1
 Confirmations not propagating from 2 to 3
 Confirmations not propagating from 2 to 4
 Confirmations not propagating from 3 to 1
 Confirmations not propagating from 3 to 2
 Confirmations not propagating from 3 to 4
 Confirmations not propagating from 4 to 1
 Confirmations not propagating from 4 to 2
 Confirmations not propagating from 4 to 3

You can see the results on one of my databases :

- for Confirmations

select con_origin, con_received, min(con_seqno) as minseq, max(con_seqno) as maxseq, date_trunc('minutes', min(now()-con_timestamp)) as age1, date_trunc('minutes', max(now()-con_timestamp)) as age2, min(now() - con_timestamp) > '00:30:00' as tooold from _pns_slony_voila_archi_0.sl_confirm group by con_origin, con_received order by con_origin, con_received;
 con_origin | con_received | minseq  | maxseq  |   age1   |   age2   | tooold 
------------+--------------+---------+---------+----------+----------+--------
        101 |          102 | 4464029 | 4464792 | 00:00:00 | 00:16:00 | f
        101 |          103 | 4464027 | 4464792 | 00:00:00 | 00:16:00 | f
        101 |          104 | 4464024 | 4464792 | 00:00:00 | 00:16:00 | f
        102 |          101 |      29 |      29 | 03:39:00 | 03:39:00 | t
        102 |          103 |      29 |      29 | 03:39:00 | 03:39:00 | t
        102 |          104 |      29 |      29 | 03:39:00 | 03:39:00 | t
        103 |          101 |      62 |      62 | 03:39:00 | 03:39:00 | t
        103 |          102 |      62 |      62 | 03:39:00 | 03:39:00 | t
        103 |          104 |      62 |      62 | 03:39:00 | 03:39:00 | t
        104 |          101 |      57 |      57 | 03:39:00 | 03:39:00 | t
        104 |          102 |      57 |      57 | 03:39:00 | 03:39:00 | t
        104 |          103 |      57 |      57 | 03:39:00 | 03:39:00 | t


- for Events

select ev_origin, min(ev_seqno), max(ev_seqno),
         date_trunc('minutes', min(now() - ev_timestamp)),
         date_trunc('minutes', max(now() - ev_timestamp)),
         min(now() - ev_timestamp) > '00:30:00' as agehi
     from _pns_slony_voila_archi_0.sl_event group by ev_origin;
 ev_origin |   min   |   max   | date_trunc | date_trunc | agehi
-----------+---------+---------+------------+------------+-------
       103 |      62 |      62 | 03:49:00   | 03:49:00   | t
       104 |      57 |      57 | 03:49:00   | 03:49:00   | t
       102 |      29 |      29 | 03:49:00   | 03:49:00   | t
       101 | 4464493 | 4465346 | 00:00:00   | 00:14:00   | f


What can be the source of these errors and how to track them ? FYI, I 
have logs but in debug level 1.

I did not have issues in 1.2.15.

Regards.
-- 
Cyril SCETBON
From cbbrowne at ca.afilias.info  Mon Apr 27 14:53:31 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Mon Apr 27 14:53:49 2009
Subject: [Slony1-general] hyphen in slony cluster names
In-Reply-To: <49F603C4.9060909@whitepages.com> (Devin Ben-Hur's message of
	"Mon, 27 Apr 2009 12:13:08 -0700")
References: <1240303314.25704.33.camel@giga.cambridge.m-spatial.com>
	<49EDDFD2.1070101@ca.afilias.info>
	<1240327127.15437.163.camel@giga.cambridge.m-spatial.com>
	<49EDFCF0.1020907@ca.afilias.info>
	<87ljpsiix8.fsf@dba2.int.libertyrms.com>
	<1240477090.15437.1264.camel@giga.cambridge.m-spatial.com>
	<49F0A391.7050504@ca.afilias.info> <49F603C4.9060909@whitepages.com>
Message-ID: <873abthig4.fsf@dba2.int.libertyrms.com>

Devin Ben-Hur <dbenhur@whitepages.com> writes:
> Chris,
>
> If you're going to check for symbol validity, wouldn't be better to
> assert the name matches the same rules as the documentation, rather
> than just black-list a couple of exceptions (leading digits and
> hyphen)?

Perfect!  Your regex is way better than what I was considering.

I'll be committing almost exactly that to CVS shortly.

Thanks very much!
-- 
output = ("cbbrowne" "@" "ca.afilias.info")
Christopher Browne
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"
From jks at selectacast.net  Mon Apr 27 15:57:33 2009
From: jks at selectacast.net (Joseph S)
Date: Mon Apr 27 15:57:52 2009
Subject: [Slony1-general] Version 2.0.0 released
In-Reply-To: <87hc5wpijv.fsf@dba2.int.libertyrms.com>
References: <87hc5wpijv.fsf@dba2.int.libertyrms.com>
Message-ID: <49F6385D.70105@selectacast.net>

Christopher Browne wrote:
> We are pleased to make a new major release of Slony-I available,
> version 2.0.0.
>
> It incorporates numerous enhancements and bug fixes contributed over
> the last year or so.
>
> A *major* change is that it is only compatible with PostgreSQL 8.3 and
> newer versions. 
The documentation has not caught up.  It refers to pre 8.3 versions in 
places, in particular on the requirements page.

From glynastill at yahoo.co.uk  Tue Apr 28 01:49:59 2009
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Tue Apr 28 01:50:32 2009
Subject: [Slony1-general] Slony Version 2.0.1
In-Reply-To: <49F6385D.70105@selectacast.net>
Message-ID: <447900.25749.qm@web23607.mail.ird.yahoo.com>


I notice the news section for 2.0.1 says

"Bug #69 - vactables type was being referenced before UPGRADE FUNCTIONS could actually have created it, when upgrading from an earlier version.

This would cause UPGRADE FUNCTIONS to fail. "

Does this mean it's now possible to do an in place upgrade from 1.2.15 to 2.0.1?


      
From cscetbon.ext at orange-ftgroup.com  Tue Apr 28 03:20:34 2009
From: cscetbon.ext at orange-ftgroup.com (Cyril Scetbon)
Date: Tue Apr 28 03:21:11 2009
Subject: [Slony1-general] [Slony 2.0.1] Events and Confirmations
	not	propagating
In-Reply-To: <49F5DA79.2030002@orange-ftgroup.com>
References: <49F5DA79.2030002@orange-ftgroup.com>
Message-ID: <49F6D872.8030402@orange-ftgroup.com>

A simple restart of all slon processes seems to have resolved the issue. 
weird ....

Cyril Scetbon wrote:
> I use test_slony_state and see some informations like :
>
> Check of event info
> ---------------------------------------------------
> Problem : Events not propagating to node 2
> Problem : Events not propagating to node 4
> Problem : Events not propagating to node 3
>
> Check of sl_confirm aging
> ---------------------------------------------------
> Confirmations not propagating from 2 to 1
> Confirmations not propagating from 2 to 3
> Confirmations not propagating from 2 to 4
> Confirmations not propagating from 3 to 1
> Confirmations not propagating from 3 to 2
> Confirmations not propagating from 3 to 4
> Confirmations not propagating from 4 to 1
> Confirmations not propagating from 4 to 2
> Confirmations not propagating from 4 to 3
>
> You can see the results on one of my databases :
>
> - for Confirmations
>
> select con_origin, con_received, min(con_seqno) as minseq, 
> max(con_seqno) as maxseq, date_trunc('minutes', 
> min(now()-con_timestamp)) as age1, date_trunc('minutes', 
> max(now()-con_timestamp)) as age2, min(now() - con_timestamp) > 
> '00:30:00' as tooold from _pns_slony_voila_archi_0.sl_confirm group by 
> con_origin, con_received order by con_origin, con_received;
> con_origin | con_received | minseq  | maxseq  |   age1   |   age2   | 
> tooold 
> ------------+--------------+---------+---------+----------+----------+-------- 
>
>        101 |          102 | 4464029 | 4464792 | 00:00:00 | 00:16:00 | f
>        101 |          103 | 4464027 | 4464792 | 00:00:00 | 00:16:00 | f
>        101 |          104 | 4464024 | 4464792 | 00:00:00 | 00:16:00 | f
>        102 |          101 |      29 |      29 | 03:39:00 | 03:39:00 | t
>        102 |          103 |      29 |      29 | 03:39:00 | 03:39:00 | t
>        102 |          104 |      29 |      29 | 03:39:00 | 03:39:00 | t
>        103 |          101 |      62 |      62 | 03:39:00 | 03:39:00 | t
>        103 |          102 |      62 |      62 | 03:39:00 | 03:39:00 | t
>        103 |          104 |      62 |      62 | 03:39:00 | 03:39:00 | t
>        104 |          101 |      57 |      57 | 03:39:00 | 03:39:00 | t
>        104 |          102 |      57 |      57 | 03:39:00 | 03:39:00 | t
>        104 |          103 |      57 |      57 | 03:39:00 | 03:39:00 | t
>
>
> - for Events
>
> select ev_origin, min(ev_seqno), max(ev_seqno),
>         date_trunc('minutes', min(now() - ev_timestamp)),
>         date_trunc('minutes', max(now() - ev_timestamp)),
>         min(now() - ev_timestamp) > '00:30:00' as agehi
>     from _pns_slony_voila_archi_0.sl_event group by ev_origin;
> ev_origin |   min   |   max   | date_trunc | date_trunc | agehi
> -----------+---------+---------+------------+------------+-------
>       103 |      62 |      62 | 03:49:00   | 03:49:00   | t
>       104 |      57 |      57 | 03:49:00   | 03:49:00   | t
>       102 |      29 |      29 | 03:49:00   | 03:49:00   | t
>       101 | 4464493 | 4465346 | 00:00:00   | 00:14:00   | f
>
>
> What can be the source of these errors and how to track them ? FYI, I 
> have logs but in debug level 1.
>
> I did not have issues in 1.2.15.
>
> Regards.

-- 
Cyril SCETBON
From cscetbon.ext at orange-ftgroup.com  Tue Apr 28 05:44:13 2009
From: cscetbon.ext at orange-ftgroup.com (Cyril Scetbon)
Date: Tue Apr 28 05:44:19 2009
Subject: [Slony1-general] [Slony 2.0.1] Events and
	Confirmations	not	propagating
In-Reply-To: <49F6D872.8030402@orange-ftgroup.com>
References: <49F5DA79.2030002@orange-ftgroup.com>
	<49F6D872.8030402@orange-ftgroup.com>
Message-ID: <49F6FA1D.1080706@orange-ftgroup.com>

Hi,

I found in slony log files that the worker has restarted the process on 
each host in my configuration (1 provider, 3 receivers) at the same time :

2009-04-28 08:47:37 CEST INFO   remoteWorkerThread_101: SYNC 4516360 
sync_event timing:  pqexec (s/count)- provider 0.001/1 - subscriber 
0.035/1 - IUD 0.000/2
2009-04-28 08:47:38 CEST ERROR  remoteListenThread_102: "select 
ev_origin, ev_seqno, ev_timestamp,        ev_snapshot,        
"pg_catalog".txid_snapshot_xmin(ev_snapshot),        
"pg_catalog".txid_snapshot_xmax(ev_snapshot),        ev_type,        
ev_data1, ev_data2,        ev_data3, ev_data4,        ev_data5,
ev_data6,        ev_data7, ev_data8 from 
"_pns_slony_voila_archi_0".sl_event e where (e.ev_origin = '102' and 
e.ev_seqno > '29') or (e.ev_origin = '103' and e.ev_seqno > '62') order 
by e.ev_origin, e.ev_seqno limit 40" - FATAL:  terminating connection 
due to administrator command
2009-04-28 08:47:38 CEST ERROR  remoteListenThread_102: "select 
con_origin, con_received,     max(con_seqno) as con_seqno,     
max(con_timestamp) as con_timestamp from 
"_pns_slony_voila_archi_0".sl_confirm where con_received <> 104 group by 
con_origin, con_received" 2009-04-28 08:47:38 CEST CONFIG slon: child 
terminated status: 11; pid: 28152, current worker pid: 28152
2009-04-28 08:47:38 CEST CONFIG slon: restart of worker in 10 seconds

The origin of the first error is that postgresql has been restarted on 
one receiver without stopping slon before. Is it a known source of errors ?
The slon process has been terminated with status=0 on the receiver where 
postgresql has been restarted and has segfault (chid status=11) on the 
others (each watchdog has restart a new slon process). This fact seems 
to cause the error with events and confirmations.

Regards.

Cyril Scetbon wrote:
> A simple restart of all slon processes seems to have resolved the 
> issue. weird ....
>
> Cyril Scetbon wrote:
>> I use test_slony_state and see some informations like :
>>
>> Check of event info
>> ---------------------------------------------------
>> Problem : Events not propagating to node 2
>> Problem : Events not propagating to node 4
>> Problem : Events not propagating to node 3
>>
>> Check of sl_confirm aging
>> ---------------------------------------------------
>> Confirmations not propagating from 2 to 1
>> Confirmations not propagating from 2 to 3
>> Confirmations not propagating from 2 to 4
>> Confirmations not propagating from 3 to 1
>> Confirmations not propagating from 3 to 2
>> Confirmations not propagating from 3 to 4
>> Confirmations not propagating from 4 to 1
>> Confirmations not propagating from 4 to 2
>> Confirmations not propagating from 4 to 3
>>
>> You can see the results on one of my databases :
>>
>> - for Confirmations
>>
>> select con_origin, con_received, min(con_seqno) as minseq, 
>> max(con_seqno) as maxseq, date_trunc('minutes', 
>> min(now()-con_timestamp)) as age1, date_trunc('minutes', 
>> max(now()-con_timestamp)) as age2, min(now() - con_timestamp) > 
>> '00:30:00' as tooold from _pns_slony_voila_archi_0.sl_confirm group 
>> by con_origin, con_received order by con_origin, con_received;
>> con_origin | con_received | minseq  | maxseq  |   age1   |   age2   | 
>> tooold 
>> ------------+--------------+---------+---------+----------+----------+-------- 
>>
>>        101 |          102 | 4464029 | 4464792 | 00:00:00 | 00:16:00 | f
>>        101 |          103 | 4464027 | 4464792 | 00:00:00 | 00:16:00 | f
>>        101 |          104 | 4464024 | 4464792 | 00:00:00 | 00:16:00 | f
>>        102 |          101 |      29 |      29 | 03:39:00 | 03:39:00 | t
>>        102 |          103 |      29 |      29 | 03:39:00 | 03:39:00 | t
>>        102 |          104 |      29 |      29 | 03:39:00 | 03:39:00 | t
>>        103 |          101 |      62 |      62 | 03:39:00 | 03:39:00 | t
>>        103 |          102 |      62 |      62 | 03:39:00 | 03:39:00 | t
>>        103 |          104 |      62 |      62 | 03:39:00 | 03:39:00 | t
>>        104 |          101 |      57 |      57 | 03:39:00 | 03:39:00 | t
>>        104 |          102 |      57 |      57 | 03:39:00 | 03:39:00 | t
>>        104 |          103 |      57 |      57 | 03:39:00 | 03:39:00 | t
>>
>>
>> - for Events
>>
>> select ev_origin, min(ev_seqno), max(ev_seqno),
>>         date_trunc('minutes', min(now() - ev_timestamp)),
>>         date_trunc('minutes', max(now() - ev_timestamp)),
>>         min(now() - ev_timestamp) > '00:30:00' as agehi
>>     from _pns_slony_voila_archi_0.sl_event group by ev_origin;
>> ev_origin |   min   |   max   | date_trunc | date_trunc | agehi
>> -----------+---------+---------+------------+------------+-------
>>       103 |      62 |      62 | 03:49:00   | 03:49:00   | t
>>       104 |      57 |      57 | 03:49:00   | 03:49:00   | t
>>       102 |      29 |      29 | 03:49:00   | 03:49:00   | t
>>       101 | 4464493 | 4465346 | 00:00:00   | 00:14:00   | f
>>
>>
>> What can be the source of these errors and how to track them ? FYI, I 
>> have logs but in debug level 1.
>>
>> I did not have issues in 1.2.15.
>>
>> Regards.
>

-- 
Cyril SCETBON
From m.perugini at 4it.it  Tue Apr 28 05:53:19 2009
From: m.perugini at 4it.it (marco perugini)
Date: Tue Apr 28 05:53:27 2009
Subject: [Slony1-general] master and slave on the same host
Message-ID: <49F6FC3F.7050408@4it.it>

RGVhciBhbGwgSSBoYXZlIGEgbGl0dGxlIHF1ZXN0aW9uLCBhYm91dCBhIHJlYWwgc2NlbmFyaW8u
CkkgaGF2ZSB0aGlzIGluIG15IG5ldHdvcms6CiAgLSBBIGRhdGFiYXNlIGNsdXN0ZXIsIGNhbGwg
QSwgd2hlcmUgbGl2ZSBtYXN0ZXIgaW5zdGFuY2Ugb2YgU2xvbnk7CiAgLSBBIGRhdGFiYXNlIGNs
dXN0ZXIsIGNhbGwgQiwgd2hlcmUgbGl2ZSBzbGF2ZSBpbnN0YW5jZSBvZiBTbG9ueTsKICAtIEEg
c2ltcGxlIGRhdGFiYXNlLCBjYWxsIEMsIHdoZXJlIGknZCBsaWtlIHRvIGhhdmUgYSByZXBsaWNh
dGlvbi4KICAKU28sIGF0IG5vdyBBIGlzIG1hc3RlciBhbmQgcmVwbGljYXRlIGEgc2NoZW1hIChj
YWxsIFMxKSBvdmVyIHRoZSBkYXRhYmFzZSBCLCB0aGUgc2xhdmUuIApJIG5lZWQgdG8gY3JlYXRl
IGFub3RoZXIgc2NoZW1hIChjYWxsIFMyKSBpbiBCIHRoYXQgbXVzdCByZXBsaWNhdGUgb3ZlciB0
aGUgc2ltcGxlIGRhdGFiYXNlIEMoUzIgc2NoZW1hIHNsYXZlKS4KTXkgcXVlc3Rpb24gaXM6ICBj
YW4gSSBoYXZlIGEgTWFzdGVyIHByb2Nlc3Mgb2YgU2xvbnkgKGZvciBpbnN0YW5jZSBpbiBCKSB3
aGVyZSBpcyBsaXZlIGEgc2xhdmUgcHJvY2Vzcz8KSWYgeWVzLCBob3cgY2FuIGkgY29uZmlndXJl
IGl0LiBJZiBObywgaG93IGNhbiBJIGRvIHdpdGggdGhpcyBlbnZpcm9ubWVudD8KVGhhbmtzIGV2
ZXJ5Ym9keSBmb3IgaGVscC4KUmVnYXJkcywKbWFyY28KCi0tIAoKNGl0CgoJCgoqNElUICoqUy5y
LmwuCioqTWFyY28gUGVydWdpbmkqICp8IHN5c3RlbSBhZG1pbmlzdHJhdG9yKiogKgotLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KVmlhIFVk
aW5lIDMwLTM2LCAwMDE2MSBSb21hClBob25lICszOSAwNiA5NzYwMTY4MApNb2JpbGUgKzM5IDMz
OS4zOS44MS4yNDYKRmF4ICszOSAwNiA5NzYwMTY4MwptLnBlcnVnaW5pQDRpdC5pdCA8bWFpbHRv
Om0ucGVydWdpbmlANGl0Lml0Pgp3d3cuNGl0Lml0IDxodHRwOi8vd3d3LjRpdC5pdC8+CgrigJxJ
bCBwcmVzZW50ZSBtZXNzYWdnaW8gZSBnbGkgZXZlbnR1YWxpIGFsbGVnYXRpIHNvbm8gZGkgbmF0
dXJhCmNvbmZpZGVuemlhbGUuIFF1YWxvcmEgdmkgZm9zc2UgcGVydmVudXRvIHBlciBlcnJvcmUs
IHZpIHByZWdoaWFtbyBkaQpjYW5jZWxsYXJsbyBpbW1lZGlhdGFtZW50ZSBkYWwgdm9zdHJvIHNp
c3RlbWEgZSBkaSBhdnZpc2FyZSBpbCBtaXR0ZW50ZS4KR3JhemllLuKAnQoK4oCcVGhpcyBlbGVj
dHJvbmljIG1haWwgdHJhbnNtaXNzaW9uIGFuZCBhbnkgYWNjb21wYW55aW5nIGF0dGFjaG1lbnRz
CmNvbnRhaW4gY29uZmlkZW50aWFsIGluZm9ybWF0aW9uLiBJZiB5b3UgaGF2ZSByZWNlaXZlZCB0
aGlzCmNvbW11bmljYXRpb24gaW4gZXJyb3IsIHBsZWFzZSBpbW1lZGlhdGVseSBkZWxldGUgdGhl
IEUtbWFpbCBhbmQgZWl0aGVyCm5vdGlmeSB0aGUgc2VuZGVyLiBUaGFuayB5b3Uu4oCdCgoKLS0t
LS0tLS0tLS0tLS0gbmV4dCBwYXJ0IC0tLS0tLS0tLS0tLS0tClNraXBwZWQgY29udGVudCBvZiB0
eXBlIG11bHRpcGFydC9yZWxhdGVk
From bnichols at ca.afilias.info  Tue Apr 28 06:35:17 2009
From: bnichols at ca.afilias.info (Brad Nicholson)
Date: Tue Apr 28 06:35:22 2009
Subject: [Slony1-general] Slony Version 2.0.1
In-Reply-To: <447900.25749.qm@web23607.mail.ird.yahoo.com>
References: <447900.25749.qm@web23607.mail.ird.yahoo.com>
Message-ID: <1240925717.6640.4.camel@bnicholson-desktop>

On Tue, 2009-04-28 at 08:49 +0000, Glyn Astill wrote:
> I notice the news section for 2.0.1 says
> 
> "Bug #69 - vactables type was being referenced before UPGRADE FUNCTIONS could actually have created it, when upgrading from an earlier version.
> 
> This would cause UPGRADE FUNCTIONS to fail. "
> 
> Does this mean it's now possible to do an in place upgrade from 1.2.15 to 2.0.1?

No, it is not possible to do an upgrade from 1.x to 2.x yet.

UPGRADE FUNCTIONS are needed for updating the minor version as well.
-- 
?Brad Nicholson  416-673-4106
Database Administrator, Afilias Canada Corp.

From bnichols at ca.afilias.info  Tue Apr 28 06:44:06 2009
From: bnichols at ca.afilias.info (Brad Nicholson)
Date: Tue Apr 28 06:44:11 2009
Subject: [Slony1-general] master and slave on the same host
In-Reply-To: <49F6FC3F.7050408@4it.it>
References: <49F6FC3F.7050408@4it.it>
Message-ID: <1240926246.6640.13.camel@bnicholson-desktop>

On Tue, 2009-04-28 at 14:53 +0200, marco perugini wrote:
> Dear all I have a little question, about a real scenario.
> I have this in my network:
>   - A database cluster, call A, where live master instance of Slony;
>   - A database cluster, call B, where live slave instance of Slony;
>   - A simple database, call C, where i'd like to have a replication.
>   
> So, at now A is master and replicate a schema (call S1) over the database B, the slave. 
> I need to create another schema (call S2) in B that must replicate over the simple database C(S2 schema slave).
> My question is:  can I have a Master process of Slony (for instance in B) where is live a slave process?
> If yes, how can i configure it. If No, how can I do with this environment?
> Thanks everybody for help.
> Regards,
> marco

Yes, you can do this.  You would use one set for S1, making the node on
cluster A the provider, and Cluster C a replica.  You would create
another set for S2, making the node on Cluster B the provider and
cluster C the replica.  The same set of slons will service this cluster.

A couple words of warning with this configuration though 

-I'm not sure if you want to have Cluster B also be a replica of of the
set  S1.  If this the case, you will not be able to rely on pg_dump for
dumping cluster B if you are using a version of Slony prior to 2.0.x.
This will be a mixed cluster (a provider and a replica), the catalogs
are corrupted (by design) on a replica.

-We have found the multiple provider clusters to be highly error prone.
There is no problem when replicating data (we've never had a problem
with regular operation), but config changes often don't behave as
intended, and often result in lost nodes.

-- 
?Brad Nicholson  416-673-4106
Database Administrator, Afilias Canada Corp.

From cbbrowne at ca.afilias.info  Tue Apr 28 07:51:31 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Tue Apr 28 07:51:40 2009
Subject: [Slony1-general] Compiling Slony 2.0.1 for Windows Server 2003 R2
	with PostgreSQL 8.3
In-Reply-To: <77cdc54b0904270817v6e5a1263q9ccf300e1f1d46ee@mail.gmail.com>
	(Philipp Haselwarter's message of "Mon, 27 Apr 2009 17:17:30 +0200")
References: <77cdc54b0904270817v6e5a1263q9ccf300e1f1d46ee@mail.gmail.com>
Message-ID: <87y6tkg7bg.fsf@dba2.int.libertyrms.com>

Philipp Haselwarter <admin@bitnoize.co.cc> writes:
> checking for pg_config... /c/postgresql/8.3/bin/pg_config
> checking for correct version of PostgreSQL... 8.3
> 8.3
> checking for PQunescapeBytea in -lpq... yes
> checking libpq-fe.h usability... yes
> checking libpq-fe.h presence... yes
> checking for libpq-fe.h... yes
> checking postgres.h usability... no
> checking postgres.h presence... no
> checking for postgres.h... no
> checking for utils/typcache.h... no
> configure: error: Headers for libpqserver are not found in the includeserverdir.
> ??? This is the path to postgres.h. Please specify the includeserverdir with
> ??? --with-pgincludeserverdir=<dir>
> Adding --with-pgincludeserverdir=/c/postgresql/8.3/include/server does not make any difference, changing the order of the two parameters or
> putting only the includeserverdir returns the same as above exept for a different end:
> overriding pgincludeserverdir with /c/postgresql/8.3/include/server
> checking for pg_config... configure: error: Cannot find pg_config.
> ??? Please specify correct installation path for pg_config
> So what can I do now? Are PostgreSQL 8.3 and Slony 2.0.1 actually compatible? Is there a different way for installing it? Or what's wrong with
> the compiling?
> Thanks a lot!!

I'd suggest taking a look in the file config.log, which has more
details as to what's going on.

Specifically, search for "checking postgres.h usability".

You'll see exactly what commands configure was trying to run to check
this, and that is quite likely to improve the ability to diagnose
what's breaking.

It's almost certainly NOT related to an "includeserverdir" issue; that
*used* to be an issue back in the PostgreSQL 7.x days, when "server
includes" were separate from "client includes," and it took a special
option to request installing the "server bits."

I'm not sure what the specific issue is; I don't have access to any
Windows systems, and I expect that the issue has something to do with
that.
-- 
(reverse (concatenate 'string "gro.mca" "@" "enworbbc"))
http://linuxfinances.info/info/advocacy.html
Rules of the Evil Overlord #208.  "Members of my Legion of Terror will
attend seminars  on Sensitivity  Training. It's good  public relations
for them to  be kind and courteous to the  general population when not
actively engaged in sowing chaos and destruction."
<http://www.eviloverlord.com/>
From cbbrowne at ca.afilias.info  Tue Apr 28 07:58:11 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Tue Apr 28 07:58:18 2009
Subject: [Slony1-general] Renaming a database server/node in Slony 1.2.15
In-Reply-To: <E846C57B-B575-4C6B-9785-A6E2914645B5@millburncorp.com> (Norman
	Yamada's message of "Fri, 24 Apr 2009 11:16:42 -0400")
References: <82EECDAD-B392-407E-B4E0-034CA2291B06@millburncorp.com>
	<877i1ahzcr.fsf@dba2.int.libertyrms.com>
	<E846C57B-B575-4C6B-9785-A6E2914645B5@millburncorp.com>
Message-ID: <87tz48g70c.fsf@dba2.int.libertyrms.com>

Norman Yamada <nyamada@millburncorp.com> writes:
> That's why I thought it was safer to update the tables by hand on each
> node. But if you think it'll work, I'll do it via store path , because
> it's faster...

There will be a brief race condition where the servers are a bit
confused as to which server is which, however it shouldn't cause any
problems, because the slons drop connections whenever they realize
that the node number they're connected to doesn't match the node
number they expect.

You can see this in src/slon/remote_listen.c; it disconnects if
"db_getLocalNodeId() returned % - wrong database?"

I don't think "safe" has a unique meaning, here!

 - In my mind, it's somewhat unsafe to do the direct updates as 
   there's risk of divergence of configuration introduced.

   If you "update" then "select" to check the results, then that
   mitigates that risk.

 - Yes, there's something a bit unsafe about "just hoping the
   configuration stabilizes" :-).

On balance, given that you'll be checking your config afterwards to
make sure the paths are right, then it's fine to update them by hand.
-- 
output = reverse("ofni.sailifa.ac" "@" "enworbbc")
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"
From cscetbon.ext at orange-ftgroup.com  Tue Apr 28 08:25:43 2009
From: cscetbon.ext at orange-ftgroup.com (Cyril Scetbon)
Date: Tue Apr 28 08:25:54 2009
Subject: [Slony1-general] [Slony 2.0.1] Events
	and	Confirmations	not	propagating
In-Reply-To: <49F6FA1D.1080706@orange-ftgroup.com>
References: <49F5DA79.2030002@orange-ftgroup.com>	<49F6D872.8030402@orange-ftgroup.com>
	<49F6FA1D.1080706@orange-ftgroup.com>
Message-ID: <49F71FF7.8030706@orange-ftgroup.com>

I'm still investigating ....

The slon restart does not resolve the error. After the restart I have 
something like :

select ev_origin, min(ev_seqno), max(ev_seqno),
        date_trunc('minutes', min(now() - ev_timestamp)),
        date_trunc('minutes', max(now() - ev_timestamp)),
        min(now() - ev_timestamp) > '00:30:00' as agehi
    from _pns_slony_voila_archi_0.sl_event group by ev_origin;
 ev_origin |   min   |   max   | date_trunc | date_trunc | agehi
-----------+---------+---------+------------+------------+-------
       103 |      65 |      66 | 00:01:00   | 00:47:00   | f
       104 |      60 |      61 | 00:01:00   | 00:47:00   | f
       102 |      33 |      34 | 00:01:00   | 00:47:00   | f
       101 | 4541581 | 4542350 | 00:00:00   | 00:13:00   | f
(4 rows)

So, another event is generated (for example, 66 from node 103)

log extract :
2009-04-28 15:51:53 CEST DEBUG2 remoteWorkerThread_102: SYNC 33 processing
2009-04-28 15:51:53 CEST DEBUG1 remoteWorkerThread_102: no sets need 
syncing for this event
2009-04-28 15:51:53 CEST DEBUG2 remoteListenThread_104: queue event 
102,33 SYNC
2009-04-28 15:51:53 CEST DEBUG2 remoteWorker_event: event 102,33 ignored 
- duplicate
2009-04-28 15:51:53 CEST DEBUG2 remoteListenThread_104: queue event 
104,60 SYNC
2009-04-28 15:51:53 CEST DEBUG2 remoteWorker_event: event 104,60 ignored 
- duplicate
2009-04-28 15:51:53 CEST DEBUG2 remoteWorkerThread_104: SYNC 60 processing
2009-04-28 15:51:53 CEST DEBUG1 remoteWorkerThread_104: no sets need 
syncing for this event
2009-04-28 15:51:53 CEST DEBUG2 remoteWorkerThread_103: SYNC 65 processing
2009-04-28 15:51:53 CEST DEBUG1 remoteWorkerThread_103: no sets need 
syncing for this event

after a few minutes I have :

select ev_origin, min(ev_seqno), max(ev_seqno),
        date_trunc('minutes', min(now() - ev_timestamp)),
        date_trunc('minutes', max(now() - ev_timestamp)),
        min(now() - ev_timestamp) > '00:30:00' as agehi
    from _pns_slony_voila_archi_0.sl_event group by ev_origin;
 ev_origin |   min   |   max   | date_trunc | date_trunc | agehi
-----------+---------+---------+------------+------------+-------
       103 |      66 |      66 | 00:12:00   | 00:12:00   | f
       104 |      61 |      61 | 00:12:00   | 00:12:00   | f
       102 |      34 |      34 | 00:12:00   | 00:12:00   | f
       101 | 4542310 | 4543008 | 00:00:00   | 00:11:00   | f

log extract :
2009-04-28 16:37:49 CEST DEBUG2 remoteWorkerThread_103: SYNC 66 processing
2009-04-28 16:37:49 CEST DEBUG1 remoteWorkerThread_103: no sets need 
syncing for this event
2009-04-28 16:37:49 CEST DEBUG2 remoteWorkerThread_104: SYNC 61 processing
2009-04-28 16:37:49 CEST DEBUG1 remoteWorkerThread_104: no sets need 
syncing for this event
2009-04-28 16:37:53 CEST DEBUG2 remoteWorkerThread_102: SYNC 34 processing
2009-04-28 16:37:53 CEST DEBUG1 remoteWorkerThread_102: no sets need 
syncing for this event

Precedent events (65,60 and 33) have been cleared, and a new one per 
node has been generated. But, the error continues and after 30 minutes I 
have :

select ev_origin, min(ev_seqno), max(ev_seqno),
        date_trunc('minutes', min(now() - ev_timestamp)),
        date_trunc('minutes', max(now() - ev_timestamp)),
        min(now() - ev_timestamp) > '00:30:00' as agehi
    from _pns_slony_voila_archi_0.sl_event group by ev_origin;
 ev_origin |   min   |   max   | date_trunc | date_trunc | agehi
-----------+---------+---------+------------+------------+-------
       103 |      66 |      66 | 00:41:00   | 00:41:00   | t
       104 |      61 |      61 | 00:41:00   | 00:41:00   | t
       102 |      34 |      34 | 00:41:00   | 00:41:00   | t
       101 | 4543634 | 4544715 | 00:00:00   | 00:18:00   | f

In Summary :

Events are not correctly propagated from nodes 102, 103 and 104. If I 
restart every slons processes new events are generated on these nodes 
but still not correctly propagated. However the last event on each node 
seems to be propagated thanks to the restart stage.

Any idea ?

Cyril Scetbon wrote:
> Hi,
>
> I found in slony log files that the worker has restarted the process 
> on each host in my configuration (1 provider, 3 receivers) at the same 
> time :
>
> 2009-04-28 08:47:37 CEST INFO   remoteWorkerThread_101: SYNC 4516360 
> sync_event timing:  pqexec (s/count)- provider 0.001/1 - subscriber 
> 0.035/1 - IUD 0.000/2
> 2009-04-28 08:47:38 CEST ERROR  remoteListenThread_102: "select 
> ev_origin, ev_seqno, ev_timestamp,        ev_snapshot,        
> "pg_catalog".txid_snapshot_xmin(ev_snapshot),        
> "pg_catalog".txid_snapshot_xmax(ev_snapshot),        ev_type,        
> ev_data1, ev_data2,        ev_data3, ev_data4,        ev_data5,
> ev_data6,        ev_data7, ev_data8 from 
> "_pns_slony_voila_archi_0".sl_event e where (e.ev_origin = '102' and 
> e.ev_seqno > '29') or (e.ev_origin = '103' and e.ev_seqno > '62') 
> order by e.ev_origin, e.ev_seqno limit 40" - FATAL:  terminating 
> connection due to administrator command
> 2009-04-28 08:47:38 CEST ERROR  remoteListenThread_102: "select 
> con_origin, con_received,     max(con_seqno) as con_seqno,     
> max(con_timestamp) as con_timestamp from 
> "_pns_slony_voila_archi_0".sl_confirm where con_received <> 104 group 
> by con_origin, con_received" 2009-04-28 08:47:38 CEST CONFIG slon: 
> child terminated status: 11; pid: 28152, current worker pid: 28152
> 2009-04-28 08:47:38 CEST CONFIG slon: restart of worker in 10 seconds
>
> The origin of the first error is that postgresql has been restarted on 
> one receiver without stopping slon before. Is it a known source of 
> errors ?
> The slon process has been terminated with status=0 on the receiver 
> where postgresql has been restarted and has segfault (chid status=11) 
> on the others (each watchdog has restart a new slon process). This 
> fact seems to cause the error with events and confirmations.
>
> Regards.
>
> Cyril Scetbon wrote:
>> A simple restart of all slon processes seems to have resolved the 
>> issue. weird ....
>>
>> Cyril Scetbon wrote:
>>> I use test_slony_state and see some informations like :
>>>
>>> Check of event info
>>> ---------------------------------------------------
>>> Problem : Events not propagating to node 2
>>> Problem : Events not propagating to node 4
>>> Problem : Events not propagating to node 3
>>>
>>> Check of sl_confirm aging
>>> ---------------------------------------------------
>>> Confirmations not propagating from 2 to 1
>>> Confirmations not propagating from 2 to 3
>>> Confirmations not propagating from 2 to 4
>>> Confirmations not propagating from 3 to 1
>>> Confirmations not propagating from 3 to 2
>>> Confirmations not propagating from 3 to 4
>>> Confirmations not propagating from 4 to 1
>>> Confirmations not propagating from 4 to 2
>>> Confirmations not propagating from 4 to 3
>>>
>>> You can see the results on one of my databases :
>>>
>>> - for Confirmations
>>>
>>> select con_origin, con_received, min(con_seqno) as minseq, 
>>> max(con_seqno) as maxseq, date_trunc('minutes', 
>>> min(now()-con_timestamp)) as age1, date_trunc('minutes', 
>>> max(now()-con_timestamp)) as age2, min(now() - con_timestamp) > 
>>> '00:30:00' as tooold from _pns_slony_voila_archi_0.sl_confirm group 
>>> by con_origin, con_received order by con_origin, con_received;
>>> con_origin | con_received | minseq  | maxseq  |   age1   |   age2   
>>> | tooold 
>>> ------------+--------------+---------+---------+----------+----------+-------- 
>>>
>>>        101 |          102 | 4464029 | 4464792 | 00:00:00 | 00:16:00 | f
>>>        101 |          103 | 4464027 | 4464792 | 00:00:00 | 00:16:00 | f
>>>        101 |          104 | 4464024 | 4464792 | 00:00:00 | 00:16:00 | f
>>>        102 |          101 |      29 |      29 | 03:39:00 | 03:39:00 | t
>>>        102 |          103 |      29 |      29 | 03:39:00 | 03:39:00 | t
>>>        102 |          104 |      29 |      29 | 03:39:00 | 03:39:00 | t
>>>        103 |          101 |      62 |      62 | 03:39:00 | 03:39:00 | t
>>>        103 |          102 |      62 |      62 | 03:39:00 | 03:39:00 | t
>>>        103 |          104 |      62 |      62 | 03:39:00 | 03:39:00 | t
>>>        104 |          101 |      57 |      57 | 03:39:00 | 03:39:00 | t
>>>        104 |          102 |      57 |      57 | 03:39:00 | 03:39:00 | t
>>>        104 |          103 |      57 |      57 | 03:39:00 | 03:39:00 | t
>>>
>>>
>>> - for Events
>>>
>>> select ev_origin, min(ev_seqno), max(ev_seqno),
>>>         date_trunc('minutes', min(now() - ev_timestamp)),
>>>         date_trunc('minutes', max(now() - ev_timestamp)),
>>>         min(now() - ev_timestamp) > '00:30:00' as agehi
>>>     from _pns_slony_voila_archi_0.sl_event group by ev_origin;
>>> ev_origin |   min   |   max   | date_trunc | date_trunc | agehi
>>> -----------+---------+---------+------------+------------+-------
>>>       103 |      62 |      62 | 03:49:00   | 03:49:00   | t
>>>       104 |      57 |      57 | 03:49:00   | 03:49:00   | t
>>>       102 |      29 |      29 | 03:49:00   | 03:49:00   | t
>>>       101 | 4464493 | 4465346 | 00:00:00   | 00:14:00   | f
>>>
>>>
>>> What can be the source of these errors and how to track them ? FYI, 
>>> I have logs but in debug level 1.
>>>
>>> I did not have issues in 1.2.15.
>>>
>>> Regards.
>>
>

-- 
Cyril SCETBON
From dbenhur at whitepages.com  Tue Apr 28 09:29:14 2009
From: dbenhur at whitepages.com (Devin Ben-Hur)
Date: Tue Apr 28 09:28:49 2009
Subject: [Slony1-general] hyphen in slony cluster names
In-Reply-To: <873abthig4.fsf@dba2.int.libertyrms.com>
References: <1240303314.25704.33.camel@giga.cambridge.m-spatial.com>	<49EDDFD2.1070101@ca.afilias.info>	<1240327127.15437.163.camel@giga.cambridge.m-spatial.com>	<49EDFCF0.1020907@ca.afilias.info>	<87ljpsiix8.fsf@dba2.int.libertyrms.com>	<1240477090.15437.1264.camel@giga.cambridge.m-spatial.com>	<49F0A391.7050504@ca.afilias.info>
	<49F603C4.9060909@whitepages.com>
	<873abthig4.fsf@dba2.int.libertyrms.com>
Message-ID: <49F72EDA.1080006@whitepages.com>

Christopher Browne wrote:
> Devin Ben-Hur <dbenhur@whitepages.com> writes:
> Perfect!  Your regex is way better than what I was considering.
> 
> I'll be committing almost exactly that to CVS shortly.
> 
> Thanks very much!

Glad to help.  I took a second look and realized my regexp misinterprets 
where '$' is allowed. It's not permitted as the leading character, so:

-      if c_cluster !~ E'^[[:alpha:]_\$][[:alnum:]_\$]{0,62}$' then
+      if c_cluster !~ E'^[[:alpha:]_][[:alnum:]_\$]{0,62}$' then

-- 
-Devin
From cbbrowne at ca.afilias.info  Tue Apr 28 09:33:16 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Tue Apr 28 09:33:27 2009
Subject: [Slony1-general] Version 2.0.0 released
In-Reply-To: <49F6385D.70105@selectacast.net> (Joseph S.'s message of "Mon, 27
	Apr 2009 18:57:33 -0400")
References: <87hc5wpijv.fsf@dba2.int.libertyrms.com>
	<49F6385D.70105@selectacast.net>
Message-ID: <87ocugg2lv.fsf@dba2.int.libertyrms.com>

Joseph S <jks@selectacast.net> writes:
> Christopher Browne wrote:
>> We are pleased to make a new major release of Slony-I available,
>> version 2.0.0.
>>
>> It incorporates numerous enhancements and bug fixes contributed over
>> the last year or so.
>>
>> A *major* change is that it is only compatible with PostgreSQL 8.3 and
>> newer versions.
> The documentation has not caught up.  It refers to pre 8.3 versions in
> places, in particular on the requirements page.

I have done some modifications to the documentation; it waffles a bit,
intentionally, because I'm not particularly interested in maintaining
multiple "trees" of documentation.  It will continue to mention
pre-8.3 versions of PostgreSQL, but certainly does indicate that 2.0
requires 8.3+.
-- 
"cbbrowne","@","cbbrowne.com"
http://cbbrowne.com/info/unix.html
Rules of the Evil Overlord #119.  "I will not attempt to kill the hero
by  placing a  venomous creature  in his  room. It  will just  wind up
accidentally killing one of my clumsy henchmen instead."
<http://www.eviloverlord.com/>

From cbbrowne at ca.afilias.info  Tue Apr 28 09:35:41 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Tue Apr 28 09:35:51 2009
Subject: [Slony1-general] Slony Version 2.0.1
In-Reply-To: <1240925717.6640.4.camel@bnicholson-desktop> (Brad Nicholson's
	message of "Tue, 28 Apr 2009 09:35:17 -0400")
References: <447900.25749.qm@web23607.mail.ird.yahoo.com>
	<1240925717.6640.4.camel@bnicholson-desktop>
Message-ID: <87k554g2hu.fsf@dba2.int.libertyrms.com>

Brad Nicholson <bnichols@ca.afilias.info> writes:
> On Tue, 2009-04-28 at 08:49 +0000, Glyn Astill wrote:
>> I notice the news section for 2.0.1 says
>> 
>> "Bug #69 - vactables type was being referenced before UPGRADE FUNCTIONS could actually have created it, when upgrading from an earlier version.
>> 
>> This would cause UPGRADE FUNCTIONS to fail. "
>> 
>> Does this mean it's now possible to do an in place upgrade from 1.2.15 to 2.0.1?
>
> No, it is not possible to do an upgrade from 1.x to 2.x yet.
>
> UPGRADE FUNCTIONS are needed for updating the minor version as well.

I had a chat with a group including Brad to outline an upgrade process
which I described here:
   <http://lists.slony.info/pipermail/slony1-general/2009-February/009193.html>

I haven't had the "round tuits" yet to get into the implementation
:-(.
-- 
output = reverse("ofni.sailifa.ac" "@" "enworbbc")
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"
From m.perugini at 4it.it  Tue Apr 28 09:44:23 2009
From: m.perugini at 4it.it (marco perugini)
Date: Tue Apr 28 09:44:37 2009
Subject: [Slony1-general] master and slave on the same host
In-Reply-To: <1240926246.6640.13.camel@bnicholson-desktop>
References: <49F6FC3F.7050408@4it.it>
	<1240926246.6640.13.camel@bnicholson-desktop>
Message-ID: <49F73267.8040100@4it.it>

aGkgYnJhZCEgZmlyc3Qgb2YgYWxsIHRoYW5rcyBmb3IgeW91ciBmZWVkYmFjay4Kbm93IGkgd2Fu
dCB0byBiZSBzdXJlIGkgd2VsbCB1bmRlcnN0YW5kIHlvdXIgYW5zd2VyOgppJ20gcmVwbGljYXRp
bmcgZGIxIGZyb20gY2x1c3RlciBBIFtwcm92aWRlcl0gdG8gY2x1c3RlciBCIFtzdWJzY3JpYmVy
XTsKbm93IGkgd2FudCB0byByZXBsaWNhdGUgYW5vdGhlciBkYgpbaWUgZGIyXSBmcm9tIGNsdXN0
ZXIgQiBbd2hpY2ggc2hvdWxkIGJlY29tZSBhIHByb3ZpZGVyIHRvb10gdG8gYW5vdGhlcgpkYiBz
ZXJ2ZXIgW2NhbGxlZCBDIGluIG15IGZpcnN0IG1haWxdLgppbiB0aGlzIHNjZW5hcmlvIGkgZG9u
J3QgaGF2ZSBtdWx0aXBsZSBwcm92aWRlciBidXQgYSBzb3J0IG9mCnJlcGxpY2F0aW9uJ3MgY2hh
aW4gZm9yIDIgZGlmZmVyZW50IGRiczogZGIxIGZyb20KQSB0byBCIGFuZCBkYjIgZnJvbSBCIHRv
IEMuIHNvIGNhbiBCJ3Mgc2xvbiBwcm9jZXNzIGJlIHByb3ZpZGVyIGFuZApzdWJzY3JpYmVyIGF0
IHRoZSBzYW1lIHRpbWU/Cmhvd2V2ZXIgaSdtIHVzaW5nIHNsb255IDIuMC4wLgp0aGFua3MgaW4g
YWR2YW5jZSEKbWFyY28KCgpCcmFkIE5pY2hvbHNvbiBoYSBzY3JpdHRvOgo+IE9uIFR1ZSwgMjAw
OS0wNC0yOCBhdCAxNDo1MyArMDIwMCwgbWFyY28gcGVydWdpbmkgd3JvdGU6Cj4gICAKPj4gRGVh
ciBhbGwgSSBoYXZlIGEgbGl0dGxlIHF1ZXN0aW9uLCBhYm91dCBhIHJlYWwgc2NlbmFyaW8uCj4+
IEkgaGF2ZSB0aGlzIGluIG15IG5ldHdvcms6Cj4+ICAgLSBBIGRhdGFiYXNlIGNsdXN0ZXIsIGNh
bGwgQSwgd2hlcmUgbGl2ZSBtYXN0ZXIgaW5zdGFuY2Ugb2YgU2xvbnk7Cj4+ICAgLSBBIGRhdGFi
YXNlIGNsdXN0ZXIsIGNhbGwgQiwgd2hlcmUgbGl2ZSBzbGF2ZSBpbnN0YW5jZSBvZiBTbG9ueTsK
Pj4gICAtIEEgc2ltcGxlIGRhdGFiYXNlLCBjYWxsIEMsIHdoZXJlIGknZCBsaWtlIHRvIGhhdmUg
YSByZXBsaWNhdGlvbi4KPj4gICAKPj4gU28sIGF0IG5vdyBBIGlzIG1hc3RlciBhbmQgcmVwbGlj
YXRlIGEgc2NoZW1hIChjYWxsIFMxKSBvdmVyIHRoZSBkYXRhYmFzZSBCLCB0aGUgc2xhdmUuIAo+
PiBJIG5lZWQgdG8gY3JlYXRlIGFub3RoZXIgc2NoZW1hIChjYWxsIFMyKSBpbiBCIHRoYXQgbXVz
dCByZXBsaWNhdGUgb3ZlciB0aGUgc2ltcGxlIGRhdGFiYXNlIEMoUzIgc2NoZW1hIHNsYXZlKS4K
Pj4gTXkgcXVlc3Rpb24gaXM6ICBjYW4gSSBoYXZlIGEgTWFzdGVyIHByb2Nlc3Mgb2YgU2xvbnkg
KGZvciBpbnN0YW5jZSBpbiBCKSB3aGVyZSBpcyBsaXZlIGEgc2xhdmUgcHJvY2Vzcz8KPj4gSWYg
eWVzLCBob3cgY2FuIGkgY29uZmlndXJlIGl0LiBJZiBObywgaG93IGNhbiBJIGRvIHdpdGggdGhp
cyBlbnZpcm9ubWVudD8KPj4gVGhhbmtzIGV2ZXJ5Ym9keSBmb3IgaGVscC4KPj4gUmVnYXJkcywK
Pj4gbWFyY28KPj4gICAgIAo+Cj4gWWVzLCB5b3UgY2FuIGRvIHRoaXMuICBZb3Ugd291bGQgdXNl
IG9uZSBzZXQgZm9yIFMxLCBtYWtpbmcgdGhlIG5vZGUgb24KPiBjbHVzdGVyIEEgdGhlIHByb3Zp
ZGVyLCBhbmQgQ2x1c3RlciBDIGEgcmVwbGljYS4gIFlvdSB3b3VsZCBjcmVhdGUKPiBhbm90aGVy
IHNldCBmb3IgUzIsIG1ha2luZyB0aGUgbm9kZSBvbiBDbHVzdGVyIEIgdGhlIHByb3ZpZGVyIGFu
ZAo+IGNsdXN0ZXIgQyB0aGUgcmVwbGljYS4gIFRoZSBzYW1lIHNldCBvZiBzbG9ucyB3aWxsIHNl
cnZpY2UgdGhpcyBjbHVzdGVyLgo+Cj4gQSBjb3VwbGUgd29yZHMgb2Ygd2FybmluZyB3aXRoIHRo
aXMgY29uZmlndXJhdGlvbiB0aG91Z2ggCj4KPiAtSSdtIG5vdCBzdXJlIGlmIHlvdSB3YW50IHRv
IGhhdmUgQ2x1c3RlciBCIGFsc28gYmUgYSByZXBsaWNhIG9mIG9mIHRoZQo+IHNldCAgUzEuICBJ
ZiB0aGlzIHRoZSBjYXNlLCB5b3Ugd2lsbCBub3QgYmUgYWJsZSB0byByZWx5IG9uIHBnX2R1bXAg
Zm9yCj4gZHVtcGluZyBjbHVzdGVyIEIgaWYgeW91IGFyZSB1c2luZyBhIHZlcnNpb24gb2YgU2xv
bnkgcHJpb3IgdG8gMi4wLnguCj4gVGhpcyB3aWxsIGJlIGEgbWl4ZWQgY2x1c3RlciAoYSBwcm92
aWRlciBhbmQgYSByZXBsaWNhKSwgdGhlIGNhdGFsb2dzCj4gYXJlIGNvcnJ1cHRlZCAoYnkgZGVz
aWduKSBvbiBhIHJlcGxpY2EuCj4KPiAtV2UgaGF2ZSBmb3VuZCB0aGUgbXVsdGlwbGUgcHJvdmlk
ZXIgY2x1c3RlcnMgdG8gYmUgaGlnaGx5IGVycm9yIHByb25lLgo+IFRoZXJlIGlzIG5vIHByb2Js
ZW0gd2hlbiByZXBsaWNhdGluZyBkYXRhICh3ZSd2ZSBuZXZlciBoYWQgYSBwcm9ibGVtCj4gd2l0
aCByZWd1bGFyIG9wZXJhdGlvbiksIGJ1dCBjb25maWcgY2hhbmdlcyBvZnRlbiBkb24ndCBiZWhh
dmUgYXMKPiBpbnRlbmRlZCwgYW5kIG9mdGVuIHJlc3VsdCBpbiBsb3N0IG5vZGVzLgo+Cj4gICAK
Ci0tIAoKNGl0CgoJCgoqNElUICoqUy5yLmwuCioqTWFyY28gUGVydWdpbmkqICp8IHN5c3RlbSBh
ZG1pbmlzdHJhdG9yKiogKgotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0KVmlhIFVkaW5lIDMwLTM2LCAwMDE2MSBSb21hClBob25lICszOSAw
NiA5NzYwMTY4MApNb2JpbGUgKzM5IDMzOS4zOS44MS4yNDYKRmF4ICszOSAwNiA5NzYwMTY4Mwpt
LnBlcnVnaW5pQDRpdC5pdCA8bWFpbHRvOm0ucGVydWdpbmlANGl0Lml0Pgp3d3cuNGl0Lml0IDxo
dHRwOi8vd3d3LjRpdC5pdC8+CgrigJxJbCBwcmVzZW50ZSBtZXNzYWdnaW8gZSBnbGkgZXZlbnR1
YWxpIGFsbGVnYXRpIHNvbm8gZGkgbmF0dXJhCmNvbmZpZGVuemlhbGUuIFF1YWxvcmEgdmkgZm9z
c2UgcGVydmVudXRvIHBlciBlcnJvcmUsIHZpIHByZWdoaWFtbyBkaQpjYW5jZWxsYXJsbyBpbW1l
ZGlhdGFtZW50ZSBkYWwgdm9zdHJvIHNpc3RlbWEgZSBkaSBhdnZpc2FyZSBpbCBtaXR0ZW50ZS4K
R3JhemllLuKAnQoK4oCcVGhpcyBlbGVjdHJvbmljIG1haWwgdHJhbnNtaXNzaW9uIGFuZCBhbnkg
YWNjb21wYW55aW5nIGF0dGFjaG1lbnRzCmNvbnRhaW4gY29uZmlkZW50aWFsIGluZm9ybWF0aW9u
LiBJZiB5b3UgaGF2ZSByZWNlaXZlZCB0aGlzCmNvbW11bmljYXRpb24gaW4gZXJyb3IsIHBsZWFz
ZSBpbW1lZGlhdGVseSBkZWxldGUgdGhlIEUtbWFpbCBhbmQgZWl0aGVyCm5vdGlmeSB0aGUgc2Vu
ZGVyLiBUaGFuayB5b3Uu4oCdCgoKLS0tLS0tLS0tLS0tLS0gbmV4dCBwYXJ0IC0tLS0tLS0tLS0t
LS0tClNraXBwZWQgY29udGVudCBvZiB0eXBlIG11bHRpcGFydC9yZWxhdGVk
From cbbrowne at ca.afilias.info  Tue Apr 28 12:24:38 2009
From: cbbrowne at ca.afilias.info (cbbrowne)
Date: Tue Apr 28 12:24:54 2009
Subject: [Slony1-general] hyphen in slony cluster names
In-Reply-To: <49F72EDA.1080006@whitepages.com>
References: <1240303314.25704.33.camel@giga.cambridge.m-spatial.com>	<49EDDFD2.1070101@ca.afilias.info>	<1240327127.15437.163.camel@giga.cambridge.m-spatial.com>	<49EDFCF0.1020907@ca.afilias.info>	<87ljpsiix8.fsf@dba2.int.libertyrms.com>	<1240477090.15437.1264.camel@giga.cambridge.m-spatial.com>	<49F0A391.7050504@ca.afilias.info>
	<49F603C4.9060909@whitepages.com>
	<873abthig4.fsf@dba2.int.libertyrms.com>
	<49F72EDA.1080006@whitepages.com>
Message-ID: <49F757F6.1010103@ca.afilias.info>

Devin Ben-Hur wrote:
> Christopher Browne wrote:
>> Devin Ben-Hur <dbenhur@whitepages.com> writes:
>> Perfect!  Your regex is way better than what I was considering.
>>
>> I'll be committing almost exactly that to CVS shortly.
>>
>> Thanks very much!
>
> Glad to help.  I took a second look and realized my regexp 
> misinterprets where '$' is allowed. It's not permitted as the leading 
> character, so:
>
> -      if c_cluster !~ E'^[[:alpha:]_\$][[:alnum:]_\$]{0,62}$' then
> +      if c_cluster !~ E'^[[:alpha:]_][[:alnum:]_\$]{0,62}$' then
>
Ah, yes, good call.  I tried out some examples based on that, and that's 
looking good.  I'll update CVS shortly.

-- 
let name="cbbrowne" and tld="ca.afilias.info" in String.concat "@" [name;tld];;
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"

From lists at serioustechnology.com  Tue Apr 28 16:27:17 2009
From: lists at serioustechnology.com (Geoffrey)
Date: Tue Apr 28 16:27:40 2009
Subject: [Slony1-general] merging sets
Message-ID: <49F790D5.2010406@serioustechnology.com>

Quick question.  If I merge set 3 into set 1, I assume the tables in set 
3 that are merged into set 1 will receive the next table id available in 
set 1?

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From admin at bitnoize.co.cc  Wed Apr 29 01:07:20 2009
From: admin at bitnoize.co.cc (Philipp Haselwarter)
Date: Wed Apr 29 01:07:57 2009
Subject: [Slony1-general] Compiling Slony 2.0.1 for Windows Server 2003 R2
	with PostgreSQL 8.3
In-Reply-To: <87y6tkg7bg.fsf@dba2.int.libertyrms.com>
References: <77cdc54b0904270817v6e5a1263q9ccf300e1f1d46ee@mail.gmail.com>
	<87y6tkg7bg.fsf@dba2.int.libertyrms.com>
Message-ID: <77cdc54b0904290107w10eb699bhac6a36fde381aa61@mail.gmail.com>

Skipped content of type multipart/alternative-------------- next part -----=
---------
A non-text attachment was scrubbed...
Name: config.zip
Type: application/zip
Size: 7048 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20090429=
/9280cb2a/config.zip
From bnichols at ca.afilias.info  Wed Apr 29 05:43:42 2009
From: bnichols at ca.afilias.info (Brad Nicholson)
Date: Wed Apr 29 05:43:47 2009
Subject: [Slony1-general] merging sets
In-Reply-To: <49F790D5.2010406@serioustechnology.com>
References: <49F790D5.2010406@serioustechnology.com>
Message-ID: <1241009022.6640.48.camel@bnicholson-desktop>

On Tue, 2009-04-28 at 19:27 -0400, Geoffrey wrote:
> Quick question.  If I merge set 3 into set 1, I assume the tables in set 
> 3 that are merged into set 1 will receive the next table id available in 
> set 1?

Table ID will remain unchanged when you merge sets.

-- 
Brad Nicholson  416-673-4106
Database Administrator, Afilias Canada Corp.


From bnichols at ca.afilias.info  Wed Apr 29 05:49:39 2009
From: bnichols at ca.afilias.info (Brad Nicholson)
Date: Wed Apr 29 05:49:45 2009
Subject: [Slony1-general] master and slave on the same host
In-Reply-To: <49F73267.8040100@4it.it>
References: <49F6FC3F.7050408@4it.it>
	<1240926246.6640.13.camel@bnicholson-desktop> <49F73267.8040100@4it.it>
Message-ID: <1241009379.6640.53.camel@bnicholson-desktop>

On Tue, 2009-04-28 at 18:44 +0200, marco perugini wrote:
> hi brad! first of all thanks for your feedback.
> now i want to be sure i well understand your answer:
> i'm replicating db1 from cluster A [provider] to cluster B
> [subscriber]; now i want to replicate another db
> [ie db2] from cluster B [which should become a provider too] to
> another db server [called C in my first mail].
> in this scenario i don't have multiple provider but a sort of
> replication's chain for 2 different dbs: db1 from
> A to B and db2 from B to C. so can B's slon process be provider and
> subscriber at the same time?
> however i'm using slony 2.0.0.
> thanks in advance!
> marco

You can run this configuration - it is supported by Slony.

However, since they are in separate databases, you will need to run
different instances of the slons to replicate.

> 
> Brad Nicholson ha scritto: 
> > On Tue, 2009-04-28 at 14:53 +0200, marco perugini wrote:
> >   
> > > Dear all I have a little question, about a real scenario.
> > > I have this in my network:
> > >   - A database cluster, call A, where live master instance of Slony;
> > >   - A database cluster, call B, where live slave instance of Slony;
> > >   - A simple database, call C, where i'd like to have a replication.
> > >   
> > > So, at now A is master and replicate a schema (call S1) over the database B, the slave. 
> > > I need to create another schema (call S2) in B that must replicate over the simple database C(S2 schema slave).
> > > My question is:  can I have a Master process of Slony (for instance in B) where is live a slave process?
> > > If yes, how can i configure it. If No, how can I do with this environment?
> > > Thanks everybody for help.
> > > Regards,
> > > marco
> > >     
> > 
> > Yes, you can do this.  You would use one set for S1, making the node on
> > cluster A the provider, and Cluster C a replica.  You would create
> > another set for S2, making the node on Cluster B the provider and
> > cluster C the replica.  The same set of slons will service this cluster.
> > 
> > A couple words of warning with this configuration though 
> > 
> > -I'm not sure if you want to have Cluster B also be a replica of of the
> > set  S1.  If this the case, you will not be able to rely on pg_dump for
> > dumping cluster B if you are using a version of Slony prior to 2.0.x.
> > This will be a mixed cluster (a provider and a replica), the catalogs
> > are corrupted (by design) on a replica.
> > 
> > -We have found the multiple provider clusters to be highly error prone.
> > There is no problem when replicating data (we've never had a problem
> > with regular operation), but config changes often don't behave as
> > intended, and often result in lost nodes.
> > 
> >   
> 
> -- 
> 4it
> 
> 
> 4IT S.r.l.
> Marco Perugini | system
> administrator 
> ---------------------------------------------------------
> Via Udine 30-36, 00161 Roma 
> Phone +39 06 97601680
> Mobile +39 339.39.81.246
> Fax +39 06 97601683
> m.perugini@4it.it
> www.4it.it 
> 
> 
> 
> ?Il presente messaggio e gli eventuali allegati sono di natura
> confidenziale. Qualora vi fosse pervenuto per errore, vi preghiamo di
> cancellarlo immediatamente dal vostro sistema e di avvisare il
> mittente. Grazie.?
> 
> ?This electronic mail transmission and any accompanying attachments
> contain confidential information. If you have received this
> communication in error, please immediately delete the E-mail and
> either notify the sender. Thank you.?
> 
> 
-- 
Brad Nicholson  416-673-4106
Database Administrator, Afilias Canada Corp.


From lists at serioustechnology.com  Wed Apr 29 06:21:51 2009
From: lists at serioustechnology.com (Geoffrey)
Date: Wed Apr 29 06:21:57 2009
Subject: [Slony1-general] merging sets
In-Reply-To: <1241009022.6640.48.camel@bnicholson-desktop>
References: <49F790D5.2010406@serioustechnology.com>
	<1241009022.6640.48.camel@bnicholson-desktop>
Message-ID: <49F8546F.4020005@serioustechnology.com>

Brad Nicholson wrote:
> On Tue, 2009-04-28 at 19:27 -0400, Geoffrey wrote:
>> Quick question.  If I merge set 3 into set 1, I assume the tables in set 
>> 3 that are merged into set 1 will receive the next table id available in 
>> set 1?
> 
> Table ID will remain unchanged when you merge sets.

I guess I don't understand this.  If I add it to a new set, then I 
assume the id will be set to 1 for the first table.

If I merge it to an existing set where a table id of 1 already exists, 
then the table id of that table will have to be different.  For example:

set 1:

table foo has id 1
table bar has id 2
table foobar has id 3

drop table bar
create set 2
add table bar to set 1 (assuming it will get table id 1)

merge set 2 to set 1

What will table id for bar be in set 1 now?


-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From bnichols at ca.afilias.info  Wed Apr 29 06:56:28 2009
From: bnichols at ca.afilias.info (Brad Nicholson)
Date: Wed Apr 29 06:56:34 2009
Subject: [Slony1-general] merging sets
In-Reply-To: <49F8546F.4020005@serioustechnology.com>
References: <49F790D5.2010406@serioustechnology.com>
	<1241009022.6640.48.camel@bnicholson-desktop>
	<49F8546F.4020005@serioustechnology.com>
Message-ID: <1241013388.6640.66.camel@bnicholson-desktop>

On Wed, 2009-04-29 at 09:21 -0400, Geoffrey wrote:
> Brad Nicholson wrote:
> > On Tue, 2009-04-28 at 19:27 -0400, Geoffrey wrote:
> >> Quick question.  If I merge set 3 into set 1, I assume the tables in set 
> >> 3 that are merged into set 1 will receive the next table id available in 
> >> set 1?
> > 
> > Table ID will remain unchanged when you merge sets.
> I guess I don't understand this.  If I add it to a new set, then I 
> assume the id will be set to 1 for the first table.
> 
> If I merge it to an existing set where a table id of 1 already exists, 
> then the table id of that table will have to be different.  For example:
> 
> set 1:
> 
> table foo has id 1
> table bar has id 2
> table foobar has id 3
> 
> drop table bar
> create set 2
> add table bar to set 1 (assuming it will get table id 1)

sl_table.tab_id is the primary key on the table.  It is unique for the cluster, not for the set.

If you try to add table bar in this example with table id 1, it will
fail because foo already has table id 1

Slony does not automatically assign table ID's, you specify them
manually through slonik.

Are you using admin tooling generate this for you?  There may be a layer
between you and Slony that is handling assigning the table id for you -
but Slony itself does not.

> merge set 2 to set 1
> 
> What will table id for bar be in set 1 now?

Merge set does not change the table id, it will be the same as before
the merge.


-- 
Brad Nicholson  416-673-4106
Database Administrator, Afilias Canada Corp.


From melvin6925 at yahoo.com  Wed Apr 29 07:16:47 2009
From: melvin6925 at yahoo.com (Melvin Davidson)
Date: Wed Apr 29 07:16:56 2009
Subject: [Slony1-general] ERROR in analyze on slony schema in cleanup thread
Message-ID: <743391.2416.qm@web53008.mail.re2.yahoo.com>


I am using Slony version 2.0.1. I am getting an analyze error for 8 tables =
every 10 minutes during the cleanup cycle. An extract from the log is inclu=
ded below. =


2009-04-29 09:42:45 EDT INFO=A0=A0 cleanupThread:=A0=A0=A0 0.011 seconds fo=
r cleanupEvent()
2009-04-29 09:42:45 EDT DEBUG1 cleanupThread: minxid: 100675
2009-04-29 09:42:45 EDT DEBUG1 cleanupThread: number of tables to clean: 9
2009-04-29 09:42:45 EDT DEBUG1 cleanupThread:=A0 analyze "_mas_rep".sl_even=
t;
2009-04-29 09:42:45 EDT ERROR=A0 cleanupThread: " analyze "_mas_rep".sl_eve=
nt;" - 2009-04-29 09:42:45 EDT DEBUG1 cleanupThread:=A0 analyze "_mas_rep".=
sl_confirm;
2009-04-29 09:42:45 EDT ERROR=A0 cleanupThread: " analyze "_mas_rep".sl_con=
firm;" - 2009-04-29 09:42:45 EDT DEBUG1 cleanupThread:=A0 analyze "_mas_rep=
".sl_setsync;
2009-04-29 09:42:45 EDT ERROR=A0 cleanupThread: " analyze "_mas_rep".sl_set=
sync;" - 2009-04-29 09:42:45 EDT DEBUG1 cleanupThread:=A0 analyze "_mas_rep=
".sl_log_1;
2009-04-29 09:42:45 EDT ERROR=A0 cleanupThread: " analyze "_mas_rep".sl_log=
_1;" - 2009-04-29 09:42:45 EDT DEBUG1 cleanupThread:=A0 analyze "_mas_rep".=
sl_log_2;
2009-04-29 09:42:45 EDT ERROR=A0 cleanupThread: " analyze "_mas_rep".sl_log=
_2;" - 2009-04-29 09:42:45 EDT DEBUG1 cleanupThread:=A0 analyze "_mas_rep".=
sl_seqlog;
2009-04-29 09:42:45 EDT ERROR=A0 cleanupThread: " analyze "_mas_rep".sl_seq=
log;" - 2009-04-29 09:42:45 EDT DEBUG1 cleanupThread:=A0 analyze "_mas_rep"=
.sl_archive_counter;
2009-04-29 09:42:45 EDT ERROR=A0 cleanupThread: " analyze "_mas_rep".sl_arc=
hive_counter;" - 2009-04-29 09:42:45 EDT DEBUG1 cleanupThread:=A0 analyze "=
pg_catalog".pg_listener;
2009-04-29 09:42:45 EDT ERROR=A0 cleanupThread: " analyze "pg_catalog".pg_l=
istener;" - 2009-04-29 09:42:45 EDT DEBUG1 cleanupThread:=A0 analyze "pg_ca=
talog".pg_statistic;
2009-04-29 09:42:45 EDT ERROR=A0 cleanupThread: " analyze "pg_catalog".pg_s=
tatistic;" - 2009-04-29 09:42:45 EDT INFO=A0=A0 cleanupThread:=A0=A0=A0 0.0=
07 seconds for vacuuming

Since the process is run as slony and the tables are owned by slony, I am p=
uzzled as to why this would occur. Any input would be greatly appreciated. =


Melvin Davidson =






      =

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090429/=
975876cc/attachment.htm
From rush4ani at yahoo.com  Wed Apr 29 08:46:54 2009
From: rush4ani at yahoo.com (Anamika Saini)
Date: Wed Apr 29 08:47:03 2009
Subject: [Slony1-general] pgpass.conf for Windows Vista
Message-ID: <171811.76233.qm@web43141.mail.sp1.yahoo.com>

hello,

I have got the problem while using the the pg_restore in Vista. It absolute=
ly woking fine in windows XP. I placed the file pgpass.conf=A0 in %APPDATA%=
/postgresql having the password and it actaully restores the dump in XP and=
 its not working in Vista. It says the passowrd failure.
Does some one know what could be the problem.

Regards,
Anamika



      =

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090429/=
0938ab98/attachment.htm
From rod at iol.ie  Wed Apr 29 08:59:22 2009
From: rod at iol.ie (Raymond O'Donnell)
Date: Wed Apr 29 08:59:32 2009
Subject: [Slony1-general] pgpass.conf for Windows Vista
In-Reply-To: <171811.76233.qm@web43141.mail.sp1.yahoo.com>
References: <171811.76233.qm@web43141.mail.sp1.yahoo.com>
Message-ID: <49F8795A.9040700@iol.ie>

On 29/04/2009 16:46, Anamika Saini wrote:

> I have got the problem while using the the pg_restore in Vista. It absolutely woking fine in windows XP. I placed the file pgpass.conf  in %APPDATA%/postgresql having the password and it actaully restores the dump in XP and its not working in Vista. It says the passowrd failure.
> Does some one know what could be the problem.

Hi there,

This list is for Slony-I: I'm moving this thread to
pgsql-general@postgresql.org.

Could it be a permissions problem with the pgpass file?

Ray.

------------------------------------------------------------------
Raymond O'Donnell, Director of Music, Galway Cathedral, Ireland
rod@iol.ie
Galway Cathedral Recitals: http://www.galwaycathedral.org/recitals
------------------------------------------------------------------
From cbbrowne at ca.afilias.info  Wed Apr 29 10:19:26 2009
From: cbbrowne at ca.afilias.info (cbbrowne)
Date: Wed Apr 29 10:19:37 2009
Subject: [Slony1-general] pgpass.conf for Windows Vista
In-Reply-To: <171811.76233.qm@web43141.mail.sp1.yahoo.com>
References: <171811.76233.qm@web43141.mail.sp1.yahoo.com>
Message-ID: <49F88C1E.90106@ca.afilias.info>

Anamika Saini wrote:
> hello,
>
> I have got the problem while using the the pg_restore in Vista. It 
> absolutely woking fine in windows XP. I placed the file pgpass.conf  
> in %APPDATA%/postgresql having the password and it actaully restores 
> the dump in XP and its not working in Vista. It says the passowrd failure.
> Does some one know what could be the problem.
>
> Regards,
> Anamika
>
I'm not sure of the answer, as I don't have access to Windows systems, 
and have never actually used Vista.

I have seen some issues related to this come up on the 
pgsql-general/pgsql-admin lists, and would suggest that you take the 
issue there, as it's a generic sort of PostgreSQL (on a particular 
platform) issue, as opposed to being specific to Slony-I.

Here's one thread that discussed this on the -novice list; it may point 
you to relevant matters...
http://archives.postgresql.org/pgsql-novice/2008-11/msg00040.php

-- 
let name="cbbrowne" and tld="ca.afilias.info" in name ^ "@" ^ tld;;
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"

From cbbrowne at ca.afilias.info  Wed Apr 29 11:48:40 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed Apr 29 11:48:56 2009
Subject: [Slony1-general] Compiling Slony 2.0.1 for Windows Server 2003 R2
	with PostgreSQL 8.3
In-Reply-To: <77cdc54b0904290107w10eb699bhac6a36fde381aa61@mail.gmail.com>
	(Philipp Haselwarter's message of "Wed, 29 Apr 2009 10:07:20 +0200")
References: <77cdc54b0904270817v6e5a1263q9ccf300e1f1d46ee@mail.gmail.com>
	<87y6tkg7bg.fsf@dba2.int.libertyrms.com>
	<77cdc54b0904290107w10eb699bhac6a36fde381aa61@mail.gmail.com>
Message-ID: <878wljfg8n.fsf@dba2.int.libertyrms.com>

Philipp Haselwarter <admin@bitnoize.co.cc> writes:
> In file included from c:/progra~2/postgresql/8.3/include/server/postgres.h:48,
> ???????????????? from conftest.c:74:
> c:/progra~2/postgresql/8.3/include/server/c.h:96:21: libintl.h: No such file or directory

OK, this points a *little* bit differently; I was thinking you might
need to include an extra library for "libintl"; that misses that you
also need to point to the #include file.

I'd mentioned a need for LDFLAGS, earlier, I think?  This points at a
need to set CPPFLAGS when you run configure.  E.g. - as follows...

  CPPFLAGS    C/C++/Objective C preprocessor flags, e.g. -I<include dir> if
              you have headers in a nonstandard directory <include dir>

I'm not sure where libintl.h "lives"; you presumably need to set CPPFLAGS to indicate...

   CPPFLAGS="-Iwhereverlibintllives" ./configure

> configure:7165: $? = 1
> configure: failed program was:
> As far as I can see the ./configure actually does find the postgres.h as later in the log it refers to it at various points.
> For more clarity and in order to avoid bloating this conversation too much I attached the config.log compressed as config.zip (7zip CRC-Checksum: 164A510F, MD5 Hash 68254c6d4cd85aeef61055dec002d6cd) so that you can see it by yourself.

I think you provided enough, what with the above...

> Do I actually really have to use MinGW/MSYS?
> And where does pthreads-win32 step into the game? Is it neccessary to have it installed for the compiling already?
> Could a different compiler be used?
> Or can I maybe simplely compile it in a native UNIX environment but do it *for* Windows?

I'm afraid I can't answer any of that; perhaps one of those that use
Windows might be able to help with those questions.
-- 
(format nil "~S@~S" "cbbrowne" "ca.afilias.info")
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"
From cscetbon.ext at orange-ftgroup.com  Wed Apr 29 11:58:29 2009
From: cscetbon.ext at orange-ftgroup.com (Cyril Scetbon)
Date: Wed Apr 29 11:58:44 2009
Subject: [Slony1-general] [Slony 2.0.1]
	Events	and	Confirmations	not	propagating
In-Reply-To: <49F71FF7.8030706@orange-ftgroup.com>
References: <49F5DA79.2030002@orange-ftgroup.com>	<49F6D872.8030402@orange-ftgroup.com>	<49F6FA1D.1080706@orange-ftgroup.com>
	<49F71FF7.8030706@orange-ftgroup.com>
Message-ID: <49F8A355.2060902@orange-ftgroup.com>

Any help would be great ...

Cyril Scetbon wrote:
> I'm still investigating ....
>
> The slon restart does not resolve the error. After the restart I have 
> something like :
>
> select ev_origin, min(ev_seqno), max(ev_seqno),
>        date_trunc('minutes', min(now() - ev_timestamp)),
>        date_trunc('minutes', max(now() - ev_timestamp)),
>        min(now() - ev_timestamp) > '00:30:00' as agehi
>    from _pns_slony_voila_archi_0.sl_event group by ev_origin;
> ev_origin |   min   |   max   | date_trunc | date_trunc | agehi
> -----------+---------+---------+------------+------------+-------
>       103 |      65 |      66 | 00:01:00   | 00:47:00   | f
>       104 |      60 |      61 | 00:01:00   | 00:47:00   | f
>       102 |      33 |      34 | 00:01:00   | 00:47:00   | f
>       101 | 4541581 | 4542350 | 00:00:00   | 00:13:00   | f
> (4 rows)
>
> So, another event is generated (for example, 66 from node 103)
>
> log extract :
> 2009-04-28 15:51:53 CEST DEBUG2 remoteWorkerThread_102: SYNC 33 
> processing
> 2009-04-28 15:51:53 CEST DEBUG1 remoteWorkerThread_102: no sets need 
> syncing for this event
> 2009-04-28 15:51:53 CEST DEBUG2 remoteListenThread_104: queue event 
> 102,33 SYNC
> 2009-04-28 15:51:53 CEST DEBUG2 remoteWorker_event: event 102,33 
> ignored - duplicate
> 2009-04-28 15:51:53 CEST DEBUG2 remoteListenThread_104: queue event 
> 104,60 SYNC
> 2009-04-28 15:51:53 CEST DEBUG2 remoteWorker_event: event 104,60 
> ignored - duplicate
> 2009-04-28 15:51:53 CEST DEBUG2 remoteWorkerThread_104: SYNC 60 
> processing
> 2009-04-28 15:51:53 CEST DEBUG1 remoteWorkerThread_104: no sets need 
> syncing for this event
> 2009-04-28 15:51:53 CEST DEBUG2 remoteWorkerThread_103: SYNC 65 
> processing
> 2009-04-28 15:51:53 CEST DEBUG1 remoteWorkerThread_103: no sets need 
> syncing for this event
>
> after a few minutes I have :
>
> select ev_origin, min(ev_seqno), max(ev_seqno),
>        date_trunc('minutes', min(now() - ev_timestamp)),
>        date_trunc('minutes', max(now() - ev_timestamp)),
>        min(now() - ev_timestamp) > '00:30:00' as agehi
>    from _pns_slony_voila_archi_0.sl_event group by ev_origin;
> ev_origin |   min   |   max   | date_trunc | date_trunc | agehi
> -----------+---------+---------+------------+------------+-------
>       103 |      66 |      66 | 00:12:00   | 00:12:00   | f
>       104 |      61 |      61 | 00:12:00   | 00:12:00   | f
>       102 |      34 |      34 | 00:12:00   | 00:12:00   | f
>       101 | 4542310 | 4543008 | 00:00:00   | 00:11:00   | f
>
> log extract :
> 2009-04-28 16:37:49 CEST DEBUG2 remoteWorkerThread_103: SYNC 66 
> processing
> 2009-04-28 16:37:49 CEST DEBUG1 remoteWorkerThread_103: no sets need 
> syncing for this event
> 2009-04-28 16:37:49 CEST DEBUG2 remoteWorkerThread_104: SYNC 61 
> processing
> 2009-04-28 16:37:49 CEST DEBUG1 remoteWorkerThread_104: no sets need 
> syncing for this event
> 2009-04-28 16:37:53 CEST DEBUG2 remoteWorkerThread_102: SYNC 34 
> processing
> 2009-04-28 16:37:53 CEST DEBUG1 remoteWorkerThread_102: no sets need 
> syncing for this event
>
> Precedent events (65,60 and 33) have been cleared, and a new one per 
> node has been generated. But, the error continues and after 30 minutes 
> I have :
>
> select ev_origin, min(ev_seqno), max(ev_seqno),
>        date_trunc('minutes', min(now() - ev_timestamp)),
>        date_trunc('minutes', max(now() - ev_timestamp)),
>        min(now() - ev_timestamp) > '00:30:00' as agehi
>    from _pns_slony_voila_archi_0.sl_event group by ev_origin;
> ev_origin |   min   |   max   | date_trunc | date_trunc | agehi
> -----------+---------+---------+------------+------------+-------
>       103 |      66 |      66 | 00:41:00   | 00:41:00   | t
>       104 |      61 |      61 | 00:41:00   | 00:41:00   | t
>       102 |      34 |      34 | 00:41:00   | 00:41:00   | t
>       101 | 4543634 | 4544715 | 00:00:00   | 00:18:00   | f
>
> In Summary :
>
> Events are not correctly propagated from nodes 102, 103 and 104. If I 
> restart every slons processes new events are generated on these nodes 
> but still not correctly propagated. However the last event on each 
> node seems to be propagated thanks to the restart stage.
>
> Any idea ?
>
> Cyril Scetbon wrote:
>> Hi,
>>
>> I found in slony log files that the worker has restarted the process 
>> on each host in my configuration (1 provider, 3 receivers) at the 
>> same time :
>>
>> 2009-04-28 08:47:37 CEST INFO   remoteWorkerThread_101: SYNC 4516360 
>> sync_event timing:  pqexec (s/count)- provider 0.001/1 - subscriber 
>> 0.035/1 - IUD 0.000/2
>> 2009-04-28 08:47:38 CEST ERROR  remoteListenThread_102: "select 
>> ev_origin, ev_seqno, ev_timestamp,        ev_snapshot,        
>> "pg_catalog".txid_snapshot_xmin(ev_snapshot),        
>> "pg_catalog".txid_snapshot_xmax(ev_snapshot),        ev_type,        
>> ev_data1, ev_data2,        ev_data3, ev_data4,        ev_data5,
>> ev_data6,        ev_data7, ev_data8 from 
>> "_pns_slony_voila_archi_0".sl_event e where (e.ev_origin = '102' and 
>> e.ev_seqno > '29') or (e.ev_origin = '103' and e.ev_seqno > '62') 
>> order by e.ev_origin, e.ev_seqno limit 40" - FATAL:  terminating 
>> connection due to administrator command
>> 2009-04-28 08:47:38 CEST ERROR  remoteListenThread_102: "select 
>> con_origin, con_received,     max(con_seqno) as con_seqno,     
>> max(con_timestamp) as con_timestamp from 
>> "_pns_slony_voila_archi_0".sl_confirm where con_received <> 104 group 
>> by con_origin, con_received" 2009-04-28 08:47:38 CEST CONFIG slon: 
>> child terminated status: 11; pid: 28152, current worker pid: 28152
>> 2009-04-28 08:47:38 CEST CONFIG slon: restart of worker in 10 seconds
>>
>> The origin of the first error is that postgresql has been restarted 
>> on one receiver without stopping slon before. Is it a known source of 
>> errors ?
>> The slon process has been terminated with status=0 on the receiver 
>> where postgresql has been restarted and has segfault (chid status=11) 
>> on the others (each watchdog has restart a new slon process). This 
>> fact seems to cause the error with events and confirmations.
>>
>> Regards.
>>
>> Cyril Scetbon wrote:
>>> A simple restart of all slon processes seems to have resolved the 
>>> issue. weird ....
>>>
>>> Cyril Scetbon wrote:
>>>> I use test_slony_state and see some informations like :
>>>>
>>>> Check of event info
>>>> ---------------------------------------------------
>>>> Problem : Events not propagating to node 2
>>>> Problem : Events not propagating to node 4
>>>> Problem : Events not propagating to node 3
>>>>
>>>> Check of sl_confirm aging
>>>> ---------------------------------------------------
>>>> Confirmations not propagating from 2 to 1
>>>> Confirmations not propagating from 2 to 3
>>>> Confirmations not propagating from 2 to 4
>>>> Confirmations not propagating from 3 to 1
>>>> Confirmations not propagating from 3 to 2
>>>> Confirmations not propagating from 3 to 4
>>>> Confirmations not propagating from 4 to 1
>>>> Confirmations not propagating from 4 to 2
>>>> Confirmations not propagating from 4 to 3
>>>>
>>>> You can see the results on one of my databases :
>>>>
>>>> - for Confirmations
>>>>
>>>> select con_origin, con_received, min(con_seqno) as minseq, 
>>>> max(con_seqno) as maxseq, date_trunc('minutes', 
>>>> min(now()-con_timestamp)) as age1, date_trunc('minutes', 
>>>> max(now()-con_timestamp)) as age2, min(now() - con_timestamp) > 
>>>> '00:30:00' as tooold from _pns_slony_voila_archi_0.sl_confirm group 
>>>> by con_origin, con_received order by con_origin, con_received;
>>>> con_origin | con_received | minseq  | maxseq  |   age1   |   age2   
>>>> | tooold 
>>>> ------------+--------------+---------+---------+----------+----------+-------- 
>>>>
>>>>        101 |          102 | 4464029 | 4464792 | 00:00:00 | 00:16:00 
>>>> | f
>>>>        101 |          103 | 4464027 | 4464792 | 00:00:00 | 00:16:00 
>>>> | f
>>>>        101 |          104 | 4464024 | 4464792 | 00:00:00 | 00:16:00 
>>>> | f
>>>>        102 |          101 |      29 |      29 | 03:39:00 | 03:39:00 
>>>> | t
>>>>        102 |          103 |      29 |      29 | 03:39:00 | 03:39:00 
>>>> | t
>>>>        102 |          104 |      29 |      29 | 03:39:00 | 03:39:00 
>>>> | t
>>>>        103 |          101 |      62 |      62 | 03:39:00 | 03:39:00 
>>>> | t
>>>>        103 |          102 |      62 |      62 | 03:39:00 | 03:39:00 
>>>> | t
>>>>        103 |          104 |      62 |      62 | 03:39:00 | 03:39:00 
>>>> | t
>>>>        104 |          101 |      57 |      57 | 03:39:00 | 03:39:00 
>>>> | t
>>>>        104 |          102 |      57 |      57 | 03:39:00 | 03:39:00 
>>>> | t
>>>>        104 |          103 |      57 |      57 | 03:39:00 | 03:39:00 
>>>> | t
>>>>
>>>>
>>>> - for Events
>>>>
>>>> select ev_origin, min(ev_seqno), max(ev_seqno),
>>>>         date_trunc('minutes', min(now() - ev_timestamp)),
>>>>         date_trunc('minutes', max(now() - ev_timestamp)),
>>>>         min(now() - ev_timestamp) > '00:30:00' as agehi
>>>>     from _pns_slony_voila_archi_0.sl_event group by ev_origin;
>>>> ev_origin |   min   |   max   | date_trunc | date_trunc | agehi
>>>> -----------+---------+---------+------------+------------+-------
>>>>       103 |      62 |      62 | 03:49:00   | 03:49:00   | t
>>>>       104 |      57 |      57 | 03:49:00   | 03:49:00   | t
>>>>       102 |      29 |      29 | 03:49:00   | 03:49:00   | t
>>>>       101 | 4464493 | 4465346 | 00:00:00   | 00:14:00   | f
>>>>
>>>>
>>>> What can be the source of these errors and how to track them ? FYI, 
>>>> I have logs but in debug level 1.
>>>>
>>>> I did not have issues in 1.2.15.
>>>>
>>>> Regards.
>>>
>>
>

-- 
Cyril SCETBON

From JJANSSEN at nmtransfer.com  Wed Apr 29 14:16:23 2009
From: JJANSSEN at nmtransfer.com (JAY J JANSSEN)
Date: Wed Apr 29 14:16:39 2009
Subject: [Slony1-general] Revising Subscriptions
Message-ID: <6DDC1426EDFF314CB9777BC48B5104B708DB7B5E@nmt-ex01.nmtransfer.com>

We are using Slony1 1.2.15 installed on 3 nodes and all of the
replicating tables are defined in one set. Currently we are set up so
that Node 1 is the Master, Node 2 is the receiver from Node 1, and Node
3 is the receiver from Node 2. So the data flows like this:
   Node 1 --> Node 2 --> Node 3.  

We used the following to set it up:   
SUBSCRIBE SET (ID=1, PROVIDER=1, RECEIVER=2, FORWARD=yes);
SUBSCRIBE SET (ID=1, PROVIDER=2, RECEIVER=3, FORWARD=yes);

I want to change this so that Node 1 provides to both Nodes 2 and 3, and
I'd like to do 
it so that we don't have to reload Node 3 from scratch (there's about 80
GB of data in the tables).
The data should flow like this:  
    Node 3 <-- Node 1 --> Node2       

If I issue the slonik command:
SUBSCRIBE SET (ID=1, PROVIDER=1, RECEIVER=3, FORWARD=yes);
will this replace the subscription between Nodes 2 and 3 (which is what
I want) or will it replace the subscription between Nodes 1 and 2 (which
is what I don't want)? 

I couldn't find a reference to this in the archives, if it does exists
please point me to it.  Any help or insight into this would be
appreciated.  Thanks.
Jay Janssen 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090429/984fb7b1/attachment.htm
From vivek at khera.org  Wed Apr 29 14:24:27 2009
From: vivek at khera.org (Vick Khera)
Date: Wed Apr 29 14:24:45 2009
Subject: [Slony1-general] Revising Subscriptions
In-Reply-To: <6DDC1426EDFF314CB9777BC48B5104B708DB7B5E@nmt-ex01.nmtransfer.com>
References: <6DDC1426EDFF314CB9777BC48B5104B708DB7B5E@nmt-ex01.nmtransfer.com>
Message-ID: <2968dfd60904291424t44639ee1jc580257e2ef9aeae@mail.gmail.com>

On Wed, Apr 29, 2009 at 5:16 PM, JAY J JANSSEN <JJANSSEN@nmtransfer.com> wrote:
> If I issue the slonik command:
> SUBSCRIBE SET (ID=1, PROVIDER=1, RECEIVER=3, FORWARD=yes);
> will this replace the subscription between Nodes 2 and 3 (which is what I
> want) or will it replace the subscription between Nodes 1 and 2 (which is
> what I don't want)?

It will do what you want: replace the 2->3 replication with a 1->3
replication, leaving the 1->2 alone.

You probably want "FORWARD=no" to save some overhead.  You can do the
same for node2 by just re-running the subscribe set for it and setting
FORWARD=no there as well.
From cbbrowne at ca.afilias.info  Wed Apr 29 14:57:50 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed Apr 29 14:58:07 2009
Subject: [Slony1-general] ERROR in analyze on slony schema in cleanup
	thread
In-Reply-To: <743391.2416.qm@web53008.mail.re2.yahoo.com> (Melvin Davidson's
	message of "Wed, 29 Apr 2009 07:16:47 -0700 (PDT)")
References: <743391.2416.qm@web53008.mail.re2.yahoo.com>
Message-ID: <873abrf7hd.fsf@dba2.int.libertyrms.com>

Melvin Davidson <melvin6925@yahoo.com> writes:
>  2009-04-29 09:42:45 EDT ERROR? cleanupThread: " analyze "_mas_rep".sl_event;" - 2009-04-29 09:42:45 EDT DEBUG1 cleanupThread:? analyze "_mas_re 
>  2009-04-29 09:42:45 EDT ERROR? cleanupThread: " analyze "_mas_rep".sl_confirm;" - 2009-04-29 09:42:45 EDT DEBUG1 cleanupThread:? analyze "_mas_ 
>  2009-04-29 09:42:45 EDT ERROR? cleanupThread: " analyze "_mas_rep".sl_setsync;" - 2009-04-29 09:42:45 EDT DEBUG1 cleanupThread:? analyze "_mas_ 
>  2009-04-29 09:42:45 EDT ERROR? cleanupThread: " analyze "_mas_rep".sl_log_1;" - 2009-04-29 09:42:45 EDT DEBUG1 cleanupThread:? analyze "_mas_re 
>  2009-04-29 09:42:45 EDT ERROR? cleanupThread: " analyze "_mas_rep".sl_log_2;" - 2009-04-29 09:42:45 EDT DEBUG1 cleanupThread:? analyze "_mas_re 
>  2009-04-29 09:42:45 EDT ERROR? cleanupThread: " analyze "_mas_rep".sl_seqlog;" - 2009-04-29 09:42:45 EDT DEBUG1 cleanupThread:? analyze "_mas_r 
>  2009-04-29 09:42:45 EDT ERROR? cleanupThread: " analyze "_mas_rep".sl_archive_counter;" - 2009-04-29 09:42:45 EDT DEBUG1 cleanupThread:? analyz 
>  2009-04-29 09:42:45 EDT ERROR? cleanupThread: " analyze "pg_catalog".pg_listener;" - 2009-04-29 09:42:45 EDT DEBUG1 cleanupThread:? analyze "pg 
>  2009-04-29 09:42:45 EDT ERROR? cleanupThread: " analyze "pg_catalog".pg_statistic;" - 2009-04-29 09:42:45 EDT INFO?? cleanupThread:??? 0.007 se 
>  Since the process is run as slony and the tables are owned by slony, I am puzzled as to why this would occur. Any input would be greatly apprec 

I suggest checking the PostgreSQL logs to see what error message the
server is reporting.

I'd like to hear more about this, if there's more to hear!
-- 
output = ("cbbrowne" "@" "linuxfinances.info")
http://www3.sympatico.ca/cbbrowne/sgml.html
REALITY is a bug in your ontology.


From stuart at stuartbishop.net  Thu Apr 30 00:25:21 2009
From: stuart at stuartbishop.net (Stuart Bishop)
Date: Thu Apr 30 00:25:49 2009
Subject: [Slony1-general] Revising Subscriptions
In-Reply-To: <2968dfd60904291424t44639ee1jc580257e2ef9aeae@mail.gmail.com>
References: <6DDC1426EDFF314CB9777BC48B5104B708DB7B5E@nmt-ex01.nmtransfer.com>
	<2968dfd60904291424t44639ee1jc580257e2ef9aeae@mail.gmail.com>
Message-ID: <6bc73d4c0904300025w43949c9yf6575b3ddd482fef@mail.gmail.com>

On Thu, Apr 30, 2009 at 4:24 AM, Vick Khera <vivek@khera.org> wrote:
> On Wed, Apr 29, 2009 at 5:16 PM, JAY J JANSSEN <JJANSSEN@nmtransfer.com> wrote:
>> If I issue the slonik command:
>> SUBSCRIBE SET (ID=1, PROVIDER=1, RECEIVER=3, FORWARD=yes);
>> will this replace the subscription between Nodes 2 and 3 (which is what I
>> want) or will it replace the subscription between Nodes 1 and 2 (which is
>> what I don't want)?
>
> It will do what you want: replace the 2->3 replication with a 1->3
> replication, leaving the 1->2 alone.
>
> You probably want "FORWARD=no" to save some overhead. ?You can do the
> same for node2 by just re-running the subscribe set for it and setting
> FORWARD=no there as well.

This isn't recommended. From the SUBSCRIBE SET docs:

    """There is, however, a case where having forwarding turned off
opens up a perhaps-unexpected failure condition; a rule of thumb
should be that all nodes that connect directly to the origin should
have forwarding turned on. Supposing one such "direct subscriber" has
forwarding turned off, it is possible for that node to be forcibly
lost in a case of failover. The problem comes if that node gets ahead
of other nodes."""

And if none of your subscribers are forwarders, you can't failover for
disaster recovery.
-- 
Stuart Bishop <stuart@stuartbishop.net>
http://www.stuartbishop.net/
From JJANSSEN at nmtransfer.com  Thu Apr 30 06:32:04 2009
From: JJANSSEN at nmtransfer.com (JAY J JANSSEN)
Date: Thu Apr 30 06:32:09 2009
Subject: [Slony1-general] Revising Subscriptions
In-Reply-To: <2968dfd60904291424t44639ee1jc580257e2ef9aeae@mail.gmail.com>
References: <6DDC1426EDFF314CB9777BC48B5104B708DB7B5E@nmt-ex01.nmtransfer.com>
	<2968dfd60904291424t44639ee1jc580257e2ef9aeae@mail.gmail.com>
Message-ID: <6DDC1426EDFF314CB9777BC48B5104B708DB7B5F@nmt-ex01.nmtransfer.com>

It worked just like you said it would, exactly what I needed.

Thank you for the help.
Jay J. 

-----Original Message-----
From: Vick Khera [mailto:vivek@khera.org] 
Sent: Wednesday, April 29, 2009 4:24 PM
To: JAY J JANSSEN
Cc: slony1-general@lists.slony.info
Subject: Re: [Slony1-general] Revising Subscriptions

On Wed, Apr 29, 2009 at 5:16 PM, JAY J JANSSEN <JJANSSEN@nmtransfer.com>
wrote:
> If I issue the slonik command:
> SUBSCRIBE SET (ID=1, PROVIDER=1, RECEIVER=3, FORWARD=yes); will this 
> replace the subscription between Nodes 2 and 3 (which is what I
> want) or will it replace the subscription between Nodes 1 and 2 (which

> is what I don't want)?

It will do what you want: replace the 2->3 replication with a 1->3
replication, leaving the 1->2 alone.

You probably want "FORWARD=no" to save some overhead.  You can do the
same for node2 by just re-running the subscribe set for it and setting
FORWARD=no there as well.
From melvin6925 at yahoo.com  Thu Apr 30 11:11:31 2009
From: melvin6925 at yahoo.com (Melvin Davidson)
Date: Thu Apr 30 11:11:42 2009
Subject: [Slony1-general] ERROR in analyze on slony schema in cleanup thread
Message-ID: <501585.47560.qm@web53005.mail.re2.yahoo.com>

>I suggest checking the PostgreSQL logs to see what error message the
>server is reporting.

>I'd like to hear more about this, if there's more to hear!
I have checked the postgresql logs and there is nothing in there that indicates any sort of problem with slony. 

Melvin Davidson 

 Folk Alley - All Folk - 24 Hours a day 
www.folkalley.com




      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20090430/4e50a78b/attachment.htm
