From ssinger at ca.afilias.info  Thu Apr  1 06:57:11 2010
From: ssinger at ca.afilias.info (Steve Singer)
Date: Thu, 01 Apr 2010 09:57:11 -0400
Subject: [Slony1-general] -t and -s slon flags
In-Reply-To: <201003311259.11968.kevink@consistentstate.com>
References: <201003311259.11968.kevink@consistentstate.com>
Message-ID: <4BB4A637.5090504@ca.afilias.info>

Kevin Kempter wrote:
> I have a client using the following flags to start slon for the slave slon 
> daemon:
> slon -p <pidfile>  -a <archive_dir> -s 120000 -t 300000 ...
> 
> Our goal is to have slon archive files much less frequently. However the 
> behavior we see is bursts of many many files about every 30 seconds
> 
> Thoughts?
> 

The -s value must be in the range of 10 to 60000 otherwise the value you 
enter on the command line gets ignored and you get the default value of 
2000.  The -t value is ranged from 	10000 to 1200000.

Silently ignoring invalid values from the command line is probably a 
bug.  I also can't think of a reason why we are restricting large sync 
intervals (but that is what we are doing).

This is coming from command line parsing code in confoptions.c

> 
> Thanks in advance
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


-- 
Steve Singer
Afilias Canada
Data Services Developer
416-673-1142

From ssinger at ca.afilias.info  Thu Apr  1 07:30:56 2010
From: ssinger at ca.afilias.info (Steve Singer)
Date: Thu, 01 Apr 2010 10:30:56 -0400
Subject: [Slony1-general] Upcoming slony releases
Message-ID: <4BB4AE20.3030305@ca.afilias.info>

We are planning on tagging and packing some new slony releases in the 
next little while (early next week maybe?).  The plan is for a point 
release for both 1.2 and 2.0

If there are any outstanding patches that haven't been committed or let 
us know and we'll try to look at them (I applied a few this week).

I'd also encourage people to grab the code from CVS to do some 
pre-release testing, though we will tag release candidates before 
tagging the actual release.


-- 
Steve Singer
Afilias Canada
Data Services Developer
416-673-1142

From jcasanov at systemguards.com.ec  Fri Apr  2 17:28:58 2010
From: jcasanov at systemguards.com.ec (Jaime Casanova)
Date: Fri, 2 Apr 2010 20:28:58 -0400
Subject: [Slony1-general]  truncating a table that is in a set
Message-ID: <v2w3073cc9b1004021728mbc48e03y94886732c69569a7@mail.gmail.com>

Hi,

what happens if i truncate a replicated table? the triggers are only
on insert, delete and update so i guess we can create an inconsistency
between servers, right?
why slony (>= 1.2.17) is not creating (when possible) a TRUNCATE
trigger to manage that situation? or there is another technique you
are using?

-- 
Atentamente,
Jaime Casanova
Soporte y capacitaci?n de PostgreSQL
Asesor?a y desarrollo de sistemas
Guayaquil - Ecuador
Cel. +59387171157

From melvin6925 at yahoo.com  Fri Apr  2 18:50:20 2010
From: melvin6925 at yahoo.com (Melvin Davidson)
Date: Fri, 2 Apr 2010 18:50:20 -0700 (PDT)
Subject: [Slony1-general] truncating a table that is in a set
In-Reply-To: <v2w3073cc9b1004021728mbc48e03y94886732c69569a7@mail.gmail.com>
Message-ID: <358552.85877.qm@web53001.mail.re2.yahoo.com>

>why slony (>= 1.2.17) is not creating (when possible) a TRUNCATE
>trigger
 to manage that situation? or there is another technique you
>are 
using?


In section 1.5 Current Limitations of the slony documentation, it specifically states that slony cannot generate a truncate trigger. So for replicated tables, it is either best to use a DELETE statement (can take a long time) or manually truncate the specific table in the master and slave. One workaround would be to use a SLONIK EXECUTE SCRIPT to propagate the TRUNCATE to all slaves.

Melvin Davidson 
  




      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20100402/661a8a1e/attachment.htm 

From guillaume at lelarge.info  Fri Apr  2 19:48:35 2010
From: guillaume at lelarge.info (Guillaume Lelarge)
Date: Sat, 03 Apr 2010 04:48:35 +0200
Subject: [Slony1-general] truncating a table that is in a set
In-Reply-To: <358552.85877.qm@web53001.mail.re2.yahoo.com>
References: <358552.85877.qm@web53001.mail.re2.yahoo.com>
Message-ID: <4BB6AC83.4090403@lelarge.info>

Le 03/04/2010 03:50, Melvin Davidson a ?crit :
>> why slony (>= 1.2.17) is not creating (when possible) a TRUNCATE
>> trigger
>  to manage that situation? or there is another technique you
>> are 
> using?
> 
> 
> In section 1.5 Current Limitations of the slony documentation, it specifically states that slony cannot generate a truncate trigger. So for replicated tables, it is either best to use a DELETE statement (can take a long time) or manually truncate the specific table in the master and slave. One workaround would be to use a SLONIK EXECUTE SCRIPT to propagate the TRUNCATE to all slaves.
> 

Well, the limitation was understandable when PostgreSQL didn't have
TRUNCATE trigger. Now that it has (8.4 new capacity), it should probably
get added to Slony.


-- 
Guillaume.
 http://www.postgresqlfr.org
 http://dalibo.com

From guillaume at lelarge.info  Fri Apr  2 19:59:10 2010
From: guillaume at lelarge.info (Guillaume Lelarge)
Date: Sat, 03 Apr 2010 04:59:10 +0200
Subject: [Slony1-general] truncating a table that is in a set
In-Reply-To: <662998.17468.qm@web53001.mail.re2.yahoo.com>
References: <662998.17468.qm@web53001.mail.re2.yahoo.com>
Message-ID: <4BB6AEFE.8030301@lelarge.info>

Le 03/04/2010 04:56, Melvin Davidson a ?crit :
>> Well, the limitation was understandable when PostgreSQL didn't have
>> TRUNCATE
>  trigger. Now that it has (8.4 new capacity), it should probably
>> get 
> added to Slony.
> 
> Ah, but you are working with slony (>= 1.2.17). To be compatible with all PostgreSQL versions _below_ 8.4, it cannot be implemented. So perhaps you might request it be added  to Slony 2.0 which works with 8.4 and above.  
> 

Sure.


-- 
Guillaume.
 http://www.postgresqlfr.org
 http://dalibo.com

From jcasanov at systemguards.com.ec  Fri Apr  2 20:20:16 2010
From: jcasanov at systemguards.com.ec (Jaime Casanova)
Date: Fri, 2 Apr 2010 23:20:16 -0400
Subject: [Slony1-general] truncating a table that is in a set
In-Reply-To: <4BB6AEFE.8030301@lelarge.info>
References: <662998.17468.qm@web53001.mail.re2.yahoo.com>
	<4BB6AEFE.8030301@lelarge.info>
Message-ID: <j2h3073cc9b1004022020oa34d996esda80eb0684e85dbd@mail.gmail.com>

On Fri, Apr 2, 2010 at 10:59 PM, Guillaume Lelarge
<guillaume at lelarge.info> wrote:
> Le 03/04/2010 04:56, Melvin Davidson a ?crit :
>>> Well, the limitation was understandable when PostgreSQL didn't have
>>> TRUNCATE
>> ?trigger. Now that it has (8.4 new capacity), it should probably
>>> get
>> added to Slony.
>>
>> Ah, but you are working with slony (>= 1.2.17). To be compatible with all PostgreSQL versions _below_ 8.4, it cannot be implemented. So perhaps you might request it be added ?to Slony 2.0 which works with 8.4 and above.
>>
>
> Sure.
>

2.0.3 actualy, which is still in rc state

-- 
Atentamente,
Jaime Casanova
Soporte y capacitaci?n de PostgreSQL
Asesor?a y desarrollo de sistemas
Guayaquil - Ecuador
Cel. +59387171157

From ssinger_pg at sympatico.ca  Sun Apr  4 09:02:17 2010
From: ssinger_pg at sympatico.ca (Steve Singer)
Date: Sun, 4 Apr 2010 12:02:17 -0400 (EDT)
Subject: [Slony1-general] truncating a table that is in a set
In-Reply-To: <4BB6AC83.4090403@lelarge.info>
References: <358552.85877.qm@web53001.mail.re2.yahoo.com>
	<4BB6AC83.4090403@lelarge.info>
Message-ID: <BLU0-SMTP5479E7068D771364F8BE10AC1A0@phx.gbl>

On Sat, 3 Apr 2010, Guillaume Lelarge wrote:

>
> Well, the limitation was understandable when PostgreSQL didn't have
> TRUNCATE trigger. Now that it has (8.4 new capacity), it should probably
> get added to Slony.

Slony 2.0.x currently also supports 8.3.  Is the thinking that if you 
compile against 8.4 truncate commands would be replicated but if your 
against 8.3 they won't by virtue of the trigger not firing?  I see some 
appeal to this but supporting different feature sets against different pg 
versions does make maintenance/testing a bit more difficult going forward.

Steve


>
>
> -- 
> Guillaume.
> http://www.postgresqlfr.org
> http://dalibo.com
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>
>


From jcasanov at systemguards.com.ec  Sun Apr  4 17:59:17 2010
From: jcasanov at systemguards.com.ec (Jaime Casanova)
Date: Sun, 4 Apr 2010 20:59:17 -0400
Subject: [Slony1-general] truncating a table that is in a set
In-Reply-To: <BLU0-SMTP5479E7068D771364F8BE10AC1A0@phx.gbl>
References: <358552.85877.qm@web53001.mail.re2.yahoo.com>
	<4BB6AC83.4090403@lelarge.info> 
	<BLU0-SMTP5479E7068D771364F8BE10AC1A0@phx.gbl>
Message-ID: <j2o3073cc9b1004041759g277bc5f7p17b7f0b07020f1a9@mail.gmail.com>

On Sun, Apr 4, 2010 at 12:02 PM, Steve Singer <ssinger_pg at sympatico.ca> wrote:
> On Sat, 3 Apr 2010, Guillaume Lelarge wrote:
>
>>
>> Well, the limitation was understandable when PostgreSQL didn't have
>> TRUNCATE trigger. Now that it has (8.4 new capacity), it should probably
>> get added to Slony.
>
> Slony 2.0.x currently also supports 8.3.

what about a 2.1.x version? :)

-- 
Atentamente,
Jaime Casanova
Soporte y capacitaci?n de PostgreSQL
Asesor?a y desarrollo de sistemas
Guayaquil - Ecuador
Cel. +59387171157

From ssinger_pg at sympatico.ca  Mon Apr  5 03:42:19 2010
From: ssinger_pg at sympatico.ca (Steve Singer)
Date: Mon, 5 Apr 2010 06:42:19 -0400 (EDT)
Subject: [Slony1-general] truncating a table that is in a set
In-Reply-To: <j2o3073cc9b1004041759g277bc5f7p17b7f0b07020f1a9@mail.gmail.com>
References: <358552.85877.qm@web53001.mail.re2.yahoo.com>
	<4BB6AC83.4090403@lelarge.info>
	<BLU0-SMTP5479E7068D771364F8BE10AC1A0@phx.gbl>
	<j2o3073cc9b1004041759g277bc5f7p17b7f0b07020f1a9@mail.gmail.com>
Message-ID: <BLU0-SMTP61924B614FFD5A82BA4F0AC190@phx.gbl>

On Sun, 4 Apr 2010, Jaime Casanova wrote:

>> Slony 2.0.x currently also supports 8.3.
>
> what about a 2.1.x version? :)

Putting new features into 2.1.x over 2.0.x might make some sense.  Do we 
(the community of slony users) want to require 8.4+ for 2.1.x? I think that 
is open for discussion.  My initial thoughts are that we want to keep each 
version of slony compatible with as many versions of Pg as possible both 
to make upgrading Pg with slony easier and to make it easier for us to eol 
slony versions.

This also raises the question of what else people would like to see in 2.1.x

>
> -- 
> Atentamente,
> Jaime Casanova
> Soporte y capacitaci?n de PostgreSQL
> Asesor?a y desarrollo de sistemas
> Guayaquil - Ecuador
> Cel. +59387171157
>
>

From jcasanov at systemguards.com.ec  Mon Apr  5 06:49:37 2010
From: jcasanov at systemguards.com.ec (Jaime Casanova)
Date: Mon, 5 Apr 2010 09:49:37 -0400
Subject: [Slony1-general] truncating a table that is in a set
In-Reply-To: <BLU0-SMTP61924B614FFD5A82BA4F0AC190@phx.gbl>
References: <358552.85877.qm@web53001.mail.re2.yahoo.com>
	<4BB6AC83.4090403@lelarge.info> 
	<BLU0-SMTP5479E7068D771364F8BE10AC1A0@phx.gbl>
	<j2o3073cc9b1004041759g277bc5f7p17b7f0b07020f1a9@mail.gmail.com>
	<BLU0-SMTP61924B614FFD5A82BA4F0AC190@phx.gbl>
Message-ID: <m2l3073cc9b1004050649xe9a4a905g42551c9ad9bf7ede@mail.gmail.com>

On Mon, Apr 5, 2010 at 6:42 AM, Steve Singer <ssinger_pg at sympatico.ca> wrote:
> On Sun, 4 Apr 2010, Jaime Casanova wrote:
>
>>> Slony 2.0.x currently also supports 8.3.
>>
>> what about a 2.1.x version? :)
>
> Putting new features into 2.1.x over 2.0.x might make some sense. ?Do we
> (the community of slony users) want to require 8.4+ for 2.1.x? I think that
> is open for discussion. ?My initial thoughts are that we want to keep each
> version of slony compatible with as many versions of Pg as possible both to
> make upgrading Pg with slony easier and to make it easier for us to eol
> slony versions.
>

well my main preocupation is to avoid developers to execute truncate,
but maybe the answer is to revoke that privilege in 8.4

-- 
Atentamente,
Jaime Casanova
Soporte y capacitaci?n de PostgreSQL
Asesor?a y desarrollo de sistemas
Guayaquil - Ecuador
Cel. +59387171157

From devrim at gunduz.org  Tue Apr  6 05:56:02 2010
From: devrim at gunduz.org (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Tue, 06 Apr 2010 15:56:02 +0300
Subject: [Slony1-general] [Slony1-hackers] Upcoming slony releases
In-Reply-To: <4BB4AE20.3030305@ca.afilias.info>
References: <4BB4AE20.3030305@ca.afilias.info>
Message-ID: <1270558562.11550.8.camel@hp-laptop2.gunduz.org>

On Thu, 2010-04-01 at 10:30 -0400, Steve Singer wrote:
> We are planning on tagging and packing some new slony releases in the 
> next little while (early next week maybe?).  The plan is for a point 
> release for both 1.2 and 2.0 

When is this scheduled exactly? I am planning to perform a Slony-I
production installation soon -- that's why I'm asking :)

Regards,
-- 
Devrim G?ND?Z
PostgreSQL Dan??man?/Consultant, Red Hat Certified Engineer
PostgreSQL RPM Repository: http://yum.pgrpms.org
Community: devrim~PostgreSQL.org, devrim.gunduz~linux.org.tr
http://www.gunduz.org  Twitter: http://twitter.com/devrimgunduz
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20100406/7afcacc8/attachment.pgp 

From ssinger at ca.afilias.info  Tue Apr  6 08:24:46 2010
From: ssinger at ca.afilias.info (Steve Singer)
Date: Tue, 06 Apr 2010 11:24:46 -0400
Subject: [Slony1-general] [Slony1-hackers] Upcoming slony releases
In-Reply-To: <1270558562.11550.8.camel@hp-laptop2.gunduz.org>
References: <4BB4AE20.3030305@ca.afilias.info>
	<1270558562.11550.8.camel@hp-laptop2.gunduz.org>
Message-ID: <4BBB523E.4000001@ca.afilias.info>

Devrim G?ND?Z wrote:
> On Thu, 2010-04-01 at 10:30 -0400, Steve Singer wrote:
>> We are planning on tagging and packing some new slony releases in the 
>> next little while (early next week maybe?).  The plan is for a point 
>> release for both 1.2 and 2.0 
> 
> When is this scheduled exactly? I am planning to perform a Slony-I
> production installation soon -- that's why I'm asking :)
> 


The plan is to tag + package release candidates late this afternoon 
(eastern North American time).  If we get some successful reports from 
the release candidate we could package an actual release in a few days?




> Regards,


-- 
Steve Singer
Afilias Canada
Data Services Developer
416-673-1142

From peter.geoghegan86 at gmail.com  Tue Apr  6 08:31:02 2010
From: peter.geoghegan86 at gmail.com (Peter Geoghegan)
Date: Tue, 6 Apr 2010 16:31:02 +0100
Subject: [Slony1-general] [Slony1-hackers] Upcoming slony releases
In-Reply-To: <4BBB523E.4000001@ca.afilias.info>
References: <4BB4AE20.3030305@ca.afilias.info>
	<1270558562.11550.8.camel@hp-laptop2.gunduz.org>
	<4BBB523E.4000001@ca.afilias.info>
Message-ID: <y2xdb471ace1004060831j33413918xb4e0bc4c5246375e@mail.gmail.com>

> The plan is to tag + package release candidates late this afternoon
> (eastern North American time). ?If we get some successful reports from
> the release candidate we could package an actual release in a few days?

Are you talking about a further Slony 2.0.3RC, before the actual
release of 2.0.3?

Regards,
Peter Geoghegan

From ssinger at ca.afilias.info  Tue Apr  6 08:40:57 2010
From: ssinger at ca.afilias.info (Steve Singer)
Date: Tue, 06 Apr 2010 11:40:57 -0400
Subject: [Slony1-general] [Slony1-hackers] Upcoming slony releases
In-Reply-To: <y2xdb471ace1004060831j33413918xb4e0bc4c5246375e@mail.gmail.com>
References: <4BB4AE20.3030305@ca.afilias.info>	
	<1270558562.11550.8.camel@hp-laptop2.gunduz.org>	
	<4BBB523E.4000001@ca.afilias.info>
	<y2xdb471ace1004060831j33413918xb4e0bc4c5246375e@mail.gmail.com>
Message-ID: <4BBB5609.4060200@ca.afilias.info>

Peter Geoghegan wrote:
>> The plan is to tag + package release candidates late this afternoon
>> (eastern North American time).  If we get some successful reports from
>> the release candidate we could package an actual release in a few days?
> 
> Are you talking about a further Slony 2.0.3RC, before the actual
> release of 2.0.3?
> 
> Regards,
> Peter Geoghegan


Yes, I think we were planning on doing another 2.0.3RC (today) then a 
actual 2.0.3 release once we get some good vibes from it.  A number of 
issues with the last 2.0.3rc have been fixed and I think it needs 
another RC before an actual release.




-- 
Steve Singer
Afilias Canada
Data Services Developer
416-673-1142

From devrim at gunduz.org  Tue Apr  6 11:10:31 2010
From: devrim at gunduz.org (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Tue, 06 Apr 2010 21:10:31 +0300
Subject: [Slony1-general] [Slony1-hackers] Upcoming slony releases
In-Reply-To: <4BBB523E.4000001@ca.afilias.info>
References: <4BB4AE20.3030305@ca.afilias.info>
	<1270558562.11550.8.camel@hp-laptop2.gunduz.org>
	<4BBB523E.4000001@ca.afilias.info>
Message-ID: <1270577431.2453.1.camel@hp-laptop2.gunduz.org>

On Tue, 2010-04-06 at 11:24 -0400, Steve Singer wrote:
> 
> The plan is to tag + package release candidates late this afternoon 
> (eastern North American time).  If we get some successful reports from
> the release candidate we could package an actual release in a few
> days?

I can give them a shot in our testing environment.
-- 
Devrim G?ND?Z
PostgreSQL Dan??man?/Consultant, Red Hat Certified Engineer
PostgreSQL RPM Repository: http://yum.pgrpms.org
Community: devrim~PostgreSQL.org, devrim.gunduz~linux.org.tr
http://www.gunduz.org  Twitter: http://twitter.com/devrimgunduz
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20100406/d924ffdf/attachment.pgp 

From ssinger at ca.afilias.info  Tue Apr  6 14:49:04 2010
From: ssinger at ca.afilias.info (Steve Singer)
Date: Tue, 06 Apr 2010 17:49:04 -0400
Subject: [Slony1-general] Slony 1.2.21 rc1 + 2.0.3 rc4 released
Message-ID: <4BBBAC50.7020207@ca.afilias.info>


We have posted release candidates for

Slony1 1.2.21 rc1
Slony1 2.0.3 rc4

to http://www.slony.info.

See the website for changes in these releases.

Please try them out.




-- 
Steve Singer
Afilias Canada
Data Services Developer
416-673-1142

From ssinger_pg at sympatico.ca  Tue Apr  6 16:05:58 2010
From: ssinger_pg at sympatico.ca (Steve Singer)
Date: Tue, 6 Apr 2010 19:05:58 -0400 (EDT)
Subject: [Slony1-general] truncating a table that is in a set
In-Reply-To: <m2l3073cc9b1004050649xe9a4a905g42551c9ad9bf7ede@mail.gmail.com>
References: <358552.85877.qm@web53001.mail.re2.yahoo.com>
	<4BB6AC83.4090403@lelarge.info>
	<BLU0-SMTP5479E7068D771364F8BE10AC1A0@phx.gbl>
	<j2o3073cc9b1004041759g277bc5f7p17b7f0b07020f1a9@mail.gmail.com> 
	<BLU0-SMTP61924B614FFD5A82BA4F0AC190@phx.gbl>
	<m2l3073cc9b1004050649xe9a4a905g42551c9ad9bf7ede@mail.gmail.com>
Message-ID: <BLU0-SMTP100FCB4C6CC39389F479A49AC170@phx.gbl>

On Mon, 5 Apr 2010, Jaime Casanova wrote:

> well my main preocupation is to avoid developers to execute truncate,
> but maybe the answer is to revoke that privilege in 8.4

You could maybe also accomplish this by installing your own TRUNCATE trigger 
that prevents the truncate with an error.

At some point some thought/discussion should be put into the best way of 
adding truncate support to some future slony version.



>
> -- 
> Atentamente,
> Jaime Casanova
> Soporte y capacitaci?n de PostgreSQL
> Asesor?a y desarrollo de sistemas
> Guayaquil - Ecuador
> Cel. +59387171157
>
>

From bench at silentmedia.com  Tue Apr  6 17:03:48 2010
From: bench at silentmedia.com (Ben Chobot)
Date: Tue, 6 Apr 2010 17:03:48 -0700
Subject: [Slony1-general] Fixing a confused slony
Message-ID: <83FBBABE-49D0-4C6B-8166-ED7A1DD7E503@silentmedia.com>

In our maintenance today we managed to confuse slony 1.2.20 by adding and dropping nodes. Now, sl_status shows nodes we have deleted, while sl_node correctly shows those nodes as gone.

Any advice on how to clean up slony's config? The nodes in sl_node seem to be replicating correctly.... it's just a matter of removing all references to the deleted ones.

From bench at silentmedia.com  Tue Apr  6 18:42:03 2010
From: bench at silentmedia.com (Ben Chobot)
Date: Tue, 6 Apr 2010 18:42:03 -0700
Subject: [Slony1-general] Fixing a confused slony
In-Reply-To: <83FBBABE-49D0-4C6B-8166-ED7A1DD7E503@silentmedia.com>
References: <83FBBABE-49D0-4C6B-8166-ED7A1DD7E503@silentmedia.com>
Message-ID: <8DAE23FF-B8E0-41FD-90D5-89A3D5DF87F9@silentmedia.com>

On Apr 6, 2010, at 5:03 PM, Ben Chobot wrote:

> In our maintenance today we managed to confuse slony 1.2.20 by adding and dropping nodes. Now, sl_status shows nodes we have deleted, while sl_node correctly shows those nodes as gone.
> 
> Any advice on how to clean up slony's config? The nodes in sl_node seem to be replicating correctly.... it's just a matter of removing all references to the deleted ones.

Actually, it seems that after an hour or so slony is no longer confused, which leaves me confused. :(

Why might slony be in such an apparently (but not really?) inconsistent state?

From glynastill at yahoo.co.uk  Wed Apr  7 04:04:25 2010
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Wed, 7 Apr 2010 11:04:25 +0000 (GMT)
Subject: [Slony1-general] Bloated sl_seqlog_idx index
Message-ID: <651670.80448.qm@web23602.mail.ird.yahoo.com>

Hi Guys,

Slony 1.2.20 / Postgres 8.4.3

I'm seeing a fair bit of index bloat on the sl_seqlog_idx, bizzarely only on the one server in a 5 server setup.  The server involved is a subscriber to the origin and a provider to one downstream subscriber.

The server in question was recently moved from our local network (where I'd not seen this happen over 3 months) to a hosting centre on the other end of a vpn, which I've noticed drops occasionally causing slony connections to drop out and have to reconnect. Could this be a problem?

Does anyone have any idea why this might be or why only the one server is affected?

I've always disabled autovacuum against slony tables as I thought slony did it's own vacuuming, is this still the correct thing to be doing or should I enable autovacuum?

Glyn


      

From steph.as at gmail.com  Wed Apr  7 00:56:07 2010
From: steph.as at gmail.com (=?ISO-8859-15?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Wed, 07 Apr 2010 09:56:07 +0200
Subject: [Slony1-general] Fixing a confused slony
In-Reply-To: <8DAE23FF-B8E0-41FD-90D5-89A3D5DF87F9@silentmedia.com>
References: <83FBBABE-49D0-4C6B-8166-ED7A1DD7E503@silentmedia.com>
	<8DAE23FF-B8E0-41FD-90D5-89A3D5DF87F9@silentmedia.com>
Message-ID: <4BBC3A97.1000402@postgresql.fr>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Le 07/04/2010 03:42, Ben Chobot a ?crit :
> On Apr 6, 2010, at 5:03 PM, Ben Chobot wrote:
> 
>> In our maintenance today we managed to confuse slony 1.2.20 by adding and dropping nodes. Now, sl_status shows nodes we have deleted, while sl_node correctly shows those nodes as gone.
>>
>> Any advice on how to clean up slony's config? The nodes in sl_node seem to be replicating correctly.... it's just a matter of removing all references to the deleted ones.
> 
> Actually, it seems that after an hour or so slony is no longer confused, which leaves me confused. :(
> 
> Why might slony be in such an apparently (but not really?) inconsistent state?

Hi,

In fact, Slony did not get confused. sl_status is a view composed with
information from sl_event and sl_confirm.
Until every event referencing the deleted nodes disappear from these tables,
you will see these nodes in sl_status.

The fact that these nodes are not shown in sl_nodes is a good way to know they
don't exist in the cluster anymore.

Best regards,
- --
St?phane Schildknecht
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iEYEARECAAYFAku8OgoACgkQA+REPKWGI0GlpwCfUiqkZwN5XdpePfAhcUEADwMe
1swAoMuOoxZGp0G4KgtLsxt54rvXegQZ
=F7D6
-----END PGP SIGNATURE-----

From cbbrowne at ca.afilias.info  Wed Apr  7 09:37:41 2010
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed, 07 Apr 2010 12:37:41 -0400
Subject: [Slony1-general] truncating a table that is in a set
In-Reply-To: <BLU0-SMTP100FCB4C6CC39389F479A49AC170@phx.gbl> (Steve Singer's
	message of "Tue, 6 Apr 2010 19:05:58 -0400 (EDT)")
References: <358552.85877.qm@web53001.mail.re2.yahoo.com>
	<4BB6AC83.4090403@lelarge.info>
	<BLU0-SMTP5479E7068D771364F8BE10AC1A0@phx.gbl>
	<j2o3073cc9b1004041759g277bc5f7p17b7f0b07020f1a9@mail.gmail.com>
	<BLU0-SMTP61924B614FFD5A82BA4F0AC190@phx.gbl>
	<m2l3073cc9b1004050649xe9a4a905g42551c9ad9bf7ede@mail.gmail.com>
	<BLU0-SMTP100FCB4C6CC39389F479A49AC170@phx.gbl>
Message-ID: <87d3yb5icq.fsf@ca.afilias.info>

Steve Singer <ssinger_pg at sympatico.ca> writes:
> On Mon, 5 Apr 2010, Jaime Casanova wrote:
>> well my main preocupation is to avoid developers to execute truncate,
>> but maybe the answer is to revoke that privilege in 8.4
>
> You could maybe also accomplish this by installing your own TRUNCATE
> trigger that prevents the truncate with an error.
>
> At some point some thought/discussion should be put into the best way
> of adding truncate support to some future slony version.

Simon Riggs did up a sample of how this might be done, shortly after he
implemented TRUNCATE triggers.

http://lists.slony.info/pipermail/slony1-patches/2008-January/000034.html

He took the approach of capturing the event in sl_log_*, so that
  I=Insert
  U=Update
  D=Delete
gets augmented with
  T=Truncate

The dangerous thing, to my mind, is that there's a further ordering
issue that would be needed.

Supposing, for instance, there's a mutual foreign key dependancy, the
processing of these might require either:
  a) Specifying multiple tables in the truncate request, or
  b) CASCADE

There are several possible implementation choices, most of them fairly
dangerous.  If anything goes wrong, then either:

 a) You've deleted a big pile of data on the replica that shouldn't be
    gone, or

 b) The TRUNCATE on the replica fails, and replication ceases until
    someone does some "surgery" to rectify things (e.g. - removing
    troublesome entries from sl_log_[12], and doing the right truncate
    "by hand," though I could see it being worse still :-().

A "safe" answer, I suppose, is to put the "denyaccess" trigger on the
TRUNCATE action.

It would be a good thing to have a coherent writeup of a concrete
proposal of intent.  Implementation's not important, just to describe
the intended semantics in some detail.
-- 
(reverse (concatenate 'string "ofni.sailifa.ac" "@" "enworbbc"))
Christopher Browne
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"

From cbbrowne at ca.afilias.info  Wed Apr  7 09:40:07 2010
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed, 07 Apr 2010 12:40:07 -0400
Subject: [Slony1-general] Fixing a confused slony
In-Reply-To: <8DAE23FF-B8E0-41FD-90D5-89A3D5DF87F9@silentmedia.com> (Ben
	Chobot's message of "Tue, 6 Apr 2010 18:42:03 -0700")
References: <83FBBABE-49D0-4C6B-8166-ED7A1DD7E503@silentmedia.com>
	<8DAE23FF-B8E0-41FD-90D5-89A3D5DF87F9@silentmedia.com>
Message-ID: <878w8z5i8o.fsf@ca.afilias.info>

Ben Chobot <bench at silentmedia.com> writes:
> On Apr 6, 2010, at 5:03 PM, Ben Chobot wrote:
>
>> In our maintenance today we managed to confuse slony 1.2.20 by adding and dropping nodes. Now, sl_status shows nodes we have deleted, while sl_node correctly shows those nodes as gone.
>> 
>> Any advice on how to clean up slony's config? The nodes in sl_node seem to be replicating correctly.... it's just a matter of removing all references to the deleted ones.
>
> Actually, it seems that after an hour or so slony is no longer confused, which leaves me confused. :(
>
> Why might slony be in such an apparently (but not really?) inconsistent state?

The table "sl_event" still contained events referring to the old
configuration of the cluster, for a period of time.

Once a run of the cleanup thread completed, probably 10-20 minutes
later, those events got trimmed out "en masse," which unconfused the
view.

Slony-I wasn't confused - it's just the view that confused you :-).
-- 
"cbbrowne","@","ca.afilias.info"
Christopher Browne
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"

From bench at silentmedia.com  Wed Apr  7 09:52:17 2010
From: bench at silentmedia.com (Ben Chobot)
Date: Wed, 7 Apr 2010 09:52:17 -0700
Subject: [Slony1-general] Fixing a confused slony
In-Reply-To: <4BBC3A97.1000402@postgresql.fr>
References: <83FBBABE-49D0-4C6B-8166-ED7A1DD7E503@silentmedia.com>
	<8DAE23FF-B8E0-41FD-90D5-89A3D5DF87F9@silentmedia.com>
	<4BBC3A97.1000402@postgresql.fr>
Message-ID: <78446A3D-DF77-4AF5-AD8A-72427B0A68E6@silentmedia.com>

On Apr 7, 2010, at 12:56 AM, St?phane A. Schildknecht wrote:

> Hi,
> 
> In fact, Slony did not get confused. sl_status is a view composed with
> information from sl_event and sl_confirm.
> Until every event referencing the deleted nodes disappear from these tables,
> you will see these nodes in sl_status.
> 
> The fact that these nodes are not shown in sl_nodes is a good way to know they
> don't exist in the cluster anymore.

Right, I got that, but I'm unclear why some nodes might exist in sl_confirm "long" after they've been removed. I thought (incorrectly, it seems) that one of the fallouts of the DROP NODE command was that all references to that node would be culled.

From cbbrowne at ca.afilias.info  Wed Apr  7 10:07:10 2010
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed, 07 Apr 2010 13:07:10 -0400
Subject: [Slony1-general] Fixing a confused slony
In-Reply-To: <78446A3D-DF77-4AF5-AD8A-72427B0A68E6@silentmedia.com> (Ben
	Chobot's message of "Wed, 7 Apr 2010 09:52:17 -0700")
References: <83FBBABE-49D0-4C6B-8166-ED7A1DD7E503@silentmedia.com>
	<8DAE23FF-B8E0-41FD-90D5-89A3D5DF87F9@silentmedia.com>
	<4BBC3A97.1000402@postgresql.fr>
	<78446A3D-DF77-4AF5-AD8A-72427B0A68E6@silentmedia.com>
Message-ID: <87sk7742f5.fsf@ca.afilias.info>

Ben Chobot <bench at silentmedia.com> writes:
> On Apr 7, 2010, at 12:56 AM, St?phane A. Schildknecht wrote:
>
>> Hi,
>> 
>> In fact, Slony did not get confused. sl_status is a view composed with
>> information from sl_event and sl_confirm.
>> Until every event referencing the deleted nodes disappear from these tables,
>> you will see these nodes in sl_status.
>> 
>> The fact that these nodes are not shown in sl_nodes is a good way to know they
>> don't exist in the cluster anymore.
>
> Right, I got that, but I'm unclear why some nodes might exist in sl_confirm "long" after they've been removed. I thought (incorrectly, it seems) that one of the fallouts of the DROP NODE command was that all references to that node would be culled.

It shouldn't get purged instantly...  The event has to propagate to
other nodes first, otherwise there's a risk of data loss.

Notably, suppose...

- Node #4 is being deleted

- The first node that is told is node #1.

What happens is that node #1 records a DROP_NODE event for node 4, and
propagates that to the other nodes in the cluster.

Node #1 shouldn't purge that event out just yet, otherwise the other
nodes don't get a chance to know that they, too, need to drop node #4.

Ergo, it's not instantaneously culled from events/confirmations.
-- 
(reverse (concatenate 'string "ofni.sailifa.ac" "@" "enworbbc"))
Christopher Browne
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"

From bench at silentmedia.com  Wed Apr  7 11:06:20 2010
From: bench at silentmedia.com (Ben Chobot)
Date: Wed, 7 Apr 2010 11:06:20 -0700
Subject: [Slony1-general] Fixing a confused slony
In-Reply-To: <87sk7742f5.fsf@ca.afilias.info>
References: <83FBBABE-49D0-4C6B-8166-ED7A1DD7E503@silentmedia.com>
	<8DAE23FF-B8E0-41FD-90D5-89A3D5DF87F9@silentmedia.com>
	<4BBC3A97.1000402@postgresql.fr>
	<78446A3D-DF77-4AF5-AD8A-72427B0A68E6@silentmedia.com>
	<87sk7742f5.fsf@ca.afilias.info>
Message-ID: <0E5D7812-009D-4E87-B46D-0B1356F0AF5C@silentmedia.com>

On Apr 7, 2010, at 10:07 AM, Christopher Browne wrote:

>> Right, I got that, but I'm unclear why some nodes might exist in sl_confirm "long" after they've been removed. I thought (incorrectly, it seems) that one of the fallouts of the DROP NODE command was that all references to that node would be culled.
> 
> It shouldn't get purged instantly...  The event has to propagate to
> other nodes first, otherwise there's a risk of data loss.
> 
> Notably, suppose...
> 
> - Node #4 is being deleted
> 
> - The first node that is told is node #1.
> 
> What happens is that node #1 records a DROP_NODE event for node 4, and
> propagates that to the other nodes in the cluster.
> 
> Node #1 shouldn't purge that event out just yet, otherwise the other
> nodes don't get a chance to know that they, too, need to drop node #4.

Ah, thanks for the clear explanation. 

From devrim at gunduz.org  Thu Apr  8 05:27:41 2010
From: devrim at gunduz.org (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Thu, 08 Apr 2010 15:27:41 +0300
Subject: [Slony1-general] Slony 1.2.21 rc1 + 2.0.3 rc4 released
In-Reply-To: <4BBBAC50.7020207@ca.afilias.info>
References: <4BBBAC50.7020207@ca.afilias.info>
Message-ID: <1270729661.2264.11.camel@hp-laptop2.gunduz.org>

On Tue, 2010-04-06 at 17:49 -0400, Steve Singer wrote:
> We have posted release candidates for
> 
> Slony1 1.2.21 rc1

When I extract the tarball, it is extracted into

slony1-engine-1.2.21-rc1

1.2.20 is extracted into

slony-1.2.20

Can we please drop -engine in final release? It broke my packages.

Regards,
-- 
Devrim G?ND?Z
PostgreSQL Dan??man?/Consultant, Red Hat Certified Engineer
PostgreSQL RPM Repository: http://yum.pgrpms.org
Community: devrim~PostgreSQL.org, devrim.gunduz~linux.org.tr
http://www.gunduz.org  Twitter: http://twitter.com/devrimgunduz
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20100408/8d8b3661/attachment.pgp 

From devrim at gunduz.org  Thu Apr  8 05:29:07 2010
From: devrim at gunduz.org (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Thu, 08 Apr 2010 15:29:07 +0300
Subject: [Slony1-general] Slony 1.2.21 rc1 + 2.0.3 rc4 released
In-Reply-To: <4BBBAC50.7020207@ca.afilias.info>
References: <4BBBAC50.7020207@ca.afilias.info>
Message-ID: <1270729747.2264.12.camel@hp-laptop2.gunduz.org>

On Tue, 2010-04-06 at 17:49 -0400, Steve Singer wrote:
> Slony1 1.2.21 rc1

Another thing:

./configure : Permission denied

Could you please make it executable before preparing tarball? I know it
is not executable in CVS...
-- 
Devrim G?ND?Z
PostgreSQL Dan??man?/Consultant, Red Hat Certified Engineer
PostgreSQL RPM Repository: http://yum.pgrpms.org
Community: devrim~PostgreSQL.org, devrim.gunduz~linux.org.tr
http://www.gunduz.org  Twitter: http://twitter.com/devrimgunduz
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20100408/fdb526eb/attachment.pgp 

From glynastill at yahoo.co.uk  Thu Apr  8 06:13:13 2010
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Thu, 8 Apr 2010 13:13:13 +0000 (GMT)
Subject: [Slony1-general] Bloated sl_seqlog_idx index
In-Reply-To: <651670.80448.qm@web23602.mail.ird.yahoo.com>
Message-ID: <460570.56676.qm@web23608.mail.ird.yahoo.com>



--- On Wed, 7/4/10, Glyn Astill <glynastill at yahoo.co.uk> wrote:

> From: Glyn Astill <glynastill at yahoo.co.uk>
> Subject: [Slony1-general] Bloated sl_seqlog_idx index
> To: slony1-general at lists.slony.info
> Date: Wednesday, 7 April, 2010, 12:04
> Hi Guys,
> 
> Slony 1.2.20 / Postgres 8.4.3
> 
> I'm seeing a fair bit of index bloat on the sl_seqlog_idx,
> bizzarely only on the one server in a 5 server setup.?
> The server involved is a subscriber to the origin and a
> provider to one downstream subscriber.
> 
> The server in question was recently moved from our local
> network (where I'd not seen this happen over 3 months) to a
> hosting centre on the other end of a vpn, which I've noticed
> drops occasionally causing slony connections to drop out and
> have to reconnect. Could this be a problem?
> 
> Does anyone have any idea why this might be or why only the
> one server is affected?
> 
> I've always disabled autovacuum against slony tables as I
> thought slony did it's own vacuuming, is this still the
> correct thing to be doing or should I enable autovacuum?
> 
> Glyn
> 
> 

I figured it out.  It appears I was being a total plank, ignorant to the fact pg_autovacuum was switched for an autovacuum_enabled parameter on the table in 8.4.


      

From JanWieck at Yahoo.com  Thu Apr  8 06:26:57 2010
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Thu, 08 Apr 2010 09:26:57 -0400
Subject: [Slony1-general] truncating a table that is in a set
In-Reply-To: <BLU0-SMTP100FCB4C6CC39389F479A49AC170@phx.gbl>
References: <358552.85877.qm@web53001.mail.re2.yahoo.com>	<4BB6AC83.4090403@lelarge.info>	<BLU0-SMTP5479E7068D771364F8BE10AC1A0@phx.gbl>	<j2o3073cc9b1004041759g277bc5f7p17b7f0b07020f1a9@mail.gmail.com>
	<BLU0-SMTP61924B614FFD5A82BA4F0AC190@phx.gbl>	<m2l3073cc9b1004050649xe9a4a905g42551c9ad9bf7ede@mail.gmail.com>
	<BLU0-SMTP100FCB4C6CC39389F479A49AC170@phx.gbl>
Message-ID: <4BBDD9A1.30009@Yahoo.com>

On 4/6/2010 7:05 PM, Steve Singer wrote:
> On Mon, 5 Apr 2010, Jaime Casanova wrote:
> 
>> well my main preocupation is to avoid developers to execute truncate,
>> but maybe the answer is to revoke that privilege in 8.4
> 
> You could maybe also accomplish this by installing your own TRUNCATE trigger 
> that prevents the truncate with an error.
> 
> At some point some thought/discussion should be put into the best way of 
> adding truncate support to some future slony version.

It would require a special sl_log row so that the truncate is performed 
at the correct point within the sync. Just having T as the operation 
should do. Since it is a feature, I consider this a TODO for 2.1.


Jan

-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin

From ssinger at ca.afilias.info  Thu Apr  8 10:03:07 2010
From: ssinger at ca.afilias.info (Steve Singer)
Date: Thu, 08 Apr 2010 13:03:07 -0400
Subject: [Slony1-general] Slony 1.2.21 rc1 + 2.0.3 rc4 released
In-Reply-To: <1270729747.2264.12.camel@hp-laptop2.gunduz.org>
References: <4BBBAC50.7020207@ca.afilias.info>
	<1270729747.2264.12.camel@hp-laptop2.gunduz.org>
Message-ID: <4BBE0C4B.1020602@ca.afilias.info>

Devrim G?ND?Z wrote:
> On Tue, 2010-04-06 at 17:49 -0400, Steve Singer wrote:
>> Slony1 1.2.21 rc1
> 
> Another thing:
> 
> ./configure : Permission denied
> 
> Could you please make it executable before preparing tarball? I know it
> is not executable in CVS...

We'll try to remember to +x configure and rename the directories when we 
do the release tarball.

Thanks

-- 
Steve Singer
Afilias Canada
Data Services Developer
416-673-1142

From cbbrowne at ca.afilias.info  Thu Apr  8 15:03:29 2010
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Thu, 08 Apr 2010 18:03:29 -0400
Subject: [Slony1-general] Slony 1.2.21 rc1 + 2.0.3 rc4 released
In-Reply-To: <4BBE0C4B.1020602@ca.afilias.info> (Steve Singer's message of
	"Thu, 08 Apr 2010 13:03:07 -0400")
References: <4BBBAC50.7020207@ca.afilias.info>
	<1270729747.2264.12.camel@hp-laptop2.gunduz.org>
	<4BBE0C4B.1020602@ca.afilias.info>
Message-ID: <87zl1d38lq.fsf@ca.afilias.info>

Steve Singer <ssinger at ca.afilias.info> writes:
> Devrim G?ND?Z wrote:
>> On Tue, 2010-04-06 at 17:49 -0400, Steve Singer wrote:
>>> Slony1 1.2.21 rc1
>> 
>> Another thing:
>> 
>> ./configure : Permission denied
>> 
>> Could you please make it executable before preparing tarball? I know it
>> is not executable in CVS...
>
> We'll try to remember to +x configure and rename the directories when we 
> do the release tarball.

There should be a "chmod" that takes place somewhat automatically; I
don't want that to be an entry going onto some interminable checklist.
-- 
output = ("cbbrowne" "@" "ca.afilias.info")
Christopher Browne
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"

From ssinger at ca.afilias.info  Fri Apr  9 09:59:15 2010
From: ssinger at ca.afilias.info (Steve Singer)
Date: Fri, 09 Apr 2010 12:59:15 -0400
Subject: [Slony1-general] Slony 1.2.21 rc1 + 2.0.3 rc4 released
In-Reply-To: <87zl1d38lq.fsf@ca.afilias.info>
References: <4BBBAC50.7020207@ca.afilias.info>	<1270729747.2264.12.camel@hp-laptop2.gunduz.org>	<4BBE0C4B.1020602@ca.afilias.info>
	<87zl1d38lq.fsf@ca.afilias.info>
Message-ID: <4BBF5CE3.6070609@ca.afilias.info>

Christopher Browne wrote:

> 
> There should be a "chmod" that takes place somewhat automatically; I
> don't want that to be an entry going onto some interminable checklist.

Is there a reason why we don't want to just do a  'chmod +x' on the 
version file in the cvs repo on the server? That why future 
checkouts/exports will have configure with +x ?



-- 
Steve Singer
Afilias Canada
Data Services Developer
416-673-1142

From ssinger at ca.afilias.info  Fri Apr  9 14:45:21 2010
From: ssinger at ca.afilias.info (Steve Singer)
Date: Fri, 09 Apr 2010 17:45:21 -0400
Subject: [Slony1-general] Slony1 1.2.21 & 2.0.3 released
Message-ID: <4BBF9FF1.7010405@ca.afilias.info>

Source packages for Slony1 1.2.21 and 2.0.3 have been posted in the 
download section of the website.

Release notes can be found on the main slony page (http://www.slony.info)




-- 
Steve Singer
Afilias Canada
Data Services Developer
416-673-1142

From david at fetter.org  Sun Apr 11 13:18:25 2010
From: david at fetter.org (David Fetter)
Date: Sun, 11 Apr 2010 13:18:25 -0700
Subject: [Slony1-general] Slony 1.2.21 rc1 + 2.0.3 rc4 released
In-Reply-To: <4BBF5CE3.6070609@ca.afilias.info>
References: <4BBBAC50.7020207@ca.afilias.info>
	<1270729747.2264.12.camel@hp-laptop2.gunduz.org>
	<4BBE0C4B.1020602@ca.afilias.info> <87zl1d38lq.fsf@ca.afilias.info>
	<4BBF5CE3.6070609@ca.afilias.info>
Message-ID: <20100411201825.GB31742@fetter.org>

On Fri, Apr 09, 2010 at 12:59:15PM -0400, Steve Singer wrote:
> Christopher Browne wrote:
> 
> > There should be a "chmod" that takes place somewhat automatically;
> > I don't want that to be an entry going onto some interminable
> > checklist.
> 
> Is there a reason why we don't want to just do a  'chmod +x' on the
> version file in the cvs repo on the server?

I can't really think of a good one, or even an example of any other
project where this is not +x.

> That why future checkouts/exports will have configure with +x ?

Good idea :)

Cheers,
David.
-- 
David Fetter <david at fetter.org> http://fetter.org/
Phone: +1 415 235 3778  AIM: dfetter666  Yahoo!: dfetter
Skype: davidfetter      XMPP: david.fetter at gmail.com
iCal: webcal://www.tripit.com/feed/ical/people/david74/tripit.ics

Remember to vote!
Consider donating to Postgres: http://www.postgresql.org/about/donate

From david at fetter.org  Sun Apr 11 13:19:22 2010
From: david at fetter.org (David Fetter)
Date: Sun, 11 Apr 2010 13:19:22 -0700
Subject: [Slony1-general] Slony1 1.2.21 & 2.0.3 released
In-Reply-To: <4BBF9FF1.7010405@ca.afilias.info>
References: <4BBF9FF1.7010405@ca.afilias.info>
Message-ID: <20100411201922.GC31742@fetter.org>

On Fri, Apr 09, 2010 at 05:45:21PM -0400, Steve Singer wrote:
> Source packages for Slony1 1.2.21 and 2.0.3 have been posted in the
> download section of the website.
> 
> Release notes can be found on the main slony page
> (http://www.slony.info)

In future, please also send stuff like this to pgsql-announce and
possibly pgsql-general, as it's pertinent to the entire PostgreSQL
community :)

Cheers,
David.
-- 
David Fetter <david at fetter.org> http://fetter.org/
Phone: +1 415 235 3778  AIM: dfetter666  Yahoo!: dfetter
Skype: davidfetter      XMPP: david.fetter at gmail.com
iCal: webcal://www.tripit.com/feed/ical/people/david74/tripit.ics

Remember to vote!
Consider donating to Postgres: http://www.postgresql.org/about/donate

From kevink at consistentstate.com  Mon Apr 12 20:56:00 2010
From: kevink at consistentstate.com (Kevin Kempter)
Date: Mon, 12 Apr 2010 21:56:00 -0600
Subject: [Slony1-general] EXECUTE SCRIPT failure
Message-ID: <201004122156.00474.kevink@consistentstate.com>

Hi All;

I have a ddl file with a drop view and a create view statement in it. If I try 
to run it through the EXECUTE SCRIPT call then I get this:



DDL Statement failed - PGRES_FATAL_ERROR

Does EXECUTE SCRIPT not allow CREATE VIEW statements?


Thanks in advance...

From melvin6925 at yahoo.com  Mon Apr 12 21:04:20 2010
From: melvin6925 at yahoo.com (Melvin Davidson)
Date: Mon, 12 Apr 2010 21:04:20 -0700 (PDT)
Subject: [Slony1-general] EXECUTE SCRIPT failure
In-Reply-To: <201004122156.00474.kevink@consistentstate.com>
Message-ID: <23005.76266.qm@web53003.mail.re2.yahoo.com>

Kevin,

Yes, you can do a CREATE VIEW with EXECUTE SCRIPT. But that is probably not the cause of your problem.

Are you by any chance doing a SET ROLE at the beginning of the script? If so, then you must also do another SET ROLE back to the original Slony superuser before exiting. If that is not the case, then perhaps you can enlighten us by showing us the contents of the script, otherwise, it's hard to guess at the unknown.

Melvin Davidson 
  


--- On Mon, 4/12/10, Kevin Kempter <kevink at consistentstate.com> wrote:

From: Kevin Kempter <kevink at consistentstate.com>
Subject: [Slony1-general] EXECUTE SCRIPT failure
To: slony1-general at lists.slony.info
Date: Monday, April 12, 2010, 10:56 PM

Hi All;

I have a ddl file with a drop view and a create view statement in it. If I try 
to run it through the EXECUTE SCRIPT call then I get this:



DDL Statement failed - PGRES_FATAL_ERROR

Does EXECUTE SCRIPT not allow CREATE VIEW statements?


Thanks in advance...
_______________________________________________
Slony1-general mailing list
Slony1-general at lists.slony.info
http://lists.slony.info/mailman/listinfo/slony1-general



      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20100412/c27014e5/attachment.htm 

From kkempter at fusemail.com  Mon Apr 12 21:39:01 2010
From: kkempter at fusemail.com (Fusemail)
Date: Mon, 12 Apr 2010 22:39:01 -0600
Subject: [Slony1-general] EXECUTE SCRIPT failure
In-Reply-To: <23005.76266.qm@web53003.mail.re2.yahoo.com>
References: <23005.76266.qm@web53003.mail.re2.yahoo.com>
Message-ID: <86A2CA0F-4D68-4343-97DE-F3D95D199A71@fusemail.com>



Sent from my iPad

On Apr 12, 2010, at 10:04 PM, Melvin Davidson <melvin6925 at yahoo.com> wrote:

> Kevin,
> 
> Yes, you can do a CREATE VIEW with EXECUTE SCRIPT. But that is probably not the cause of your problem.
> 
> Are you by any chance doing a SET ROLE at the beginning of the script? If so, then you must also do another SET ROLE back to the original Slony superuser before exiting. If that is not the case, then perhaps you can enlighten us by showing us the contents of the script, otherwise, it's hard to guess at the unknown.
> 
> Melvin Davidson 
> 
> 
> 
> --- On Mon, 4/12/10, Kevin Kempter <kevink at consistentstate.com> wrote:
> 
> From: Kevin Kempter <kevink at consistentstate.com>
> Subject: [Slony1-general] EXECUTE SCRIPT failure
> To: slony1-general at lists.slony.info
> Date: Monday, April 12, 2010, 10:56 PM
> 
> Hi All;
> 
> I have a ddl file with a drop view and a create view statement in it. If I try 
> to run it through the EXECUTE SCRIPT call then I get this:
> 
> 
> 
> 
> DDL Statement failed - PGRES_FATAL_ERROR
> 
> Does EXECUTE SCRIPT not allow CREATE VIEW statements?
> 
> 
> Thanks in advance...
> 
> 
> 
> 

No set role - just a straight "create view"

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20100412/544c0e88/attachment.htm 

From jcasanov at systemguards.com.ec  Mon Apr 12 22:04:38 2010
From: jcasanov at systemguards.com.ec (Jaime Casanova)
Date: Tue, 13 Apr 2010 00:04:38 -0500
Subject: [Slony1-general] EXECUTE SCRIPT failure
In-Reply-To: <201004122156.00474.kevink@consistentstate.com>
References: <201004122156.00474.kevink@consistentstate.com>
Message-ID: <z2r3073cc9b1004122204qa332ec55oaf61b6eda13bf583@mail.gmail.com>

On Mon, Apr 12, 2010 at 10:56 PM, Kevin Kempter
<kevink at consistentstate.com> wrote:
> Hi All;
>
> I have a ddl file with a drop view and a create view statement in it. If I try
> to run it through the EXECUTE SCRIPT call then I get this:
>
>
>
> DDL Statement failed - PGRES_FATAL_ERROR
>
> Does EXECUTE SCRIPT not allow CREATE VIEW statements?
>
>

and what failed? the drop or the create view? you're not allowed to
drop a view if some object (like another view) depends on it

-- 
Atentamente,
Jaime Casanova
Soporte y capacitaci?n de PostgreSQL
Asesor?a y desarrollo de sistemas
Guayaquil - Ecuador
Cel. +59387171157

From bnichols at ca.afilias.info  Tue Apr 13 05:10:33 2010
From: bnichols at ca.afilias.info (Brad Nicholson)
Date: Tue, 13 Apr 2010 08:10:33 -0400
Subject: [Slony1-general] EXECUTE SCRIPT failure
In-Reply-To: <z2r3073cc9b1004122204qa332ec55oaf61b6eda13bf583@mail.gmail.com>
References: <201004122156.00474.kevink@consistentstate.com>
	<z2r3073cc9b1004122204qa332ec55oaf61b6eda13bf583@mail.gmail.com>
Message-ID: <1271160633.28339.2.camel@bnicholson-desktop>

On Tue, 2010-04-13 at 00:04 -0500, Jaime Casanova wrote:
> On Mon, Apr 12, 2010 at 10:56 PM, Kevin Kempter
> <kevink at consistentstate.com> wrote:
> > Hi All;
> >
> > I have a ddl file with a drop view and a create view statement in it. If I try
> > to run it through the EXECUTE SCRIPT call then I get this:
> >
> >
> >
> > DDL Statement failed - PGRES_FATAL_ERROR
> >
> > Does EXECUTE SCRIPT not allow CREATE VIEW statements?
> >
> >
> 
> and what failed? the drop or the create view? you're not allowed to
> drop a view if some object (like another view) depends on it

I would try running the exact SQL on all databases in the cluster
directly with BEGIN/ROLLBACK and make sure that runs everywhere.  

-- 
Brad Nicholson  416-673-4106
Database Administrator, Afilias Canada Corp.



From riyav at hotmail.com  Wed Apr 14 09:49:48 2010
From: riyav at hotmail.com (rsv)
Date: Wed, 14 Apr 2010 09:49:48 -0700 (PDT)
Subject: [Slony1-general]  Modifying the schema on the Master and Slave
Message-ID: <28245260.post@talk.nabble.com>


I need to add a new trigger and trigger function on the Master Node. I also
need that trigger on the Slave, should I need to switchover at any point.
However I don't want to dropnode on the slave or stop slony when I do it. Is
there a problem adding a trigger to the Slave while it is being replicated
to? Typically when you start slon on the slave it disables all the triggers
and re-enables them on switchover or when the node is dropped. However when
I create the trigger without dropping the node and while it is still a
slave, the trigger does not get disabled after creation. What are the
implications of this and what is the right way to go about doing it? If the
trigger is not disabled in the Slave then every time a record is updated on
the Slave I'm assuming the function is triggered.
-- 
View this message in context: http://old.nabble.com/Modifying-the-schema-on-the-Master-and-Slave-tp28245260p28245260.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.


From vivek at khera.org  Wed Apr 14 10:07:39 2010
From: vivek at khera.org (Vick Khera)
Date: Wed, 14 Apr 2010 13:07:39 -0400
Subject: [Slony1-general] Modifying the schema on the Master and Slave
In-Reply-To: <28245260.post@talk.nabble.com>
References: <28245260.post@talk.nabble.com>
Message-ID: <x2j2968dfd61004141007m90c8bca0ud8b6854e19db20ee@mail.gmail.com>

On Wed, Apr 14, 2010 at 12:49 PM, rsv <riyav at hotmail.com> wrote:
> I need to add a new trigger and trigger function on the Master Node. I also
> need that trigger on the Slave, should I need to switchover at any point.
> However I don't want to dropnode on the slave or stop slony when I do it. Is
> there a problem adding a trigger to the Slave while it is being replicated
> t

Use the slonik command EXECUTE SCRIPT to add your triggers.  Whenever
you make *any* schema changes that reference any existing table in any
way (such as foreign keys, triggers etc) you want to do this.

Do not do any schema changes that reference any existing tables on
origin or replicas in any other way.

From tmblue at gmail.com  Wed Apr 14 15:12:33 2010
From: tmblue at gmail.com (Tory M Blue)
Date: Wed, 14 Apr 2010 15:12:33 -0700
Subject: [Slony1-general] Slony-L: alterTableRestore() table with id not
	found
Message-ID: <h2x8a547c841004141512od34c8214ic0fdbea09eda6eea@mail.gmail.com>

So testing switchover after upgrading to 1.2 and 8.4.3 (well some are
still on 8.3.4).

And I'm getting this error when trying to switchover.  I get this
error when I tried to drop set 3 (thought about creating another set
to see what the issue is).

I have 9 tables, and 7 of the 9 seem to work, but slon seems to be
missing, not replicating and in fact citing that the table with the id
can't be found, yet I find it just fine.

Even if there is no clean way to "fix" this, is there a hack to drop
this set in order to try to recreate the set for testing? Odd that
it's only these 2 "ancient" tables are causing grief.

Ideas?

Thanks
Tory


-bash-3.1$ ./switchover_to_node2.sh
<stdin>:22: Moved Set 1
<stdin>:29: Moved Set 2
<stdin>:34: PGRES_FATAL_ERROR select "_cls".moveSet(3, 2);  - ERROR:
Slony-I: alterTableRestore(): Table with id 46 not found
CONTEXT:  SQL statement "SELECT  "_cls".alterTableRestore( $1 )"
PL/pgSQL function "moveset_int" line 33 at PERFORM
SQL statement "SELECT  "_cls".moveSet_int( $1 ,  $2 ,  $3 , 0)"
PL/pgSQL function "moveset" line 61 at PERFORM
Switchover complete

Tables are in there and slon schema knows about them.

   46 |   24509700 | profile_fields          | adm   |       3 |
profile_fields_pkey              | t           | profile_
fields table
     47 |   24509710 | profile_values          | adm  |       3 |
profile_values_pkey              | t           | profile_
values table

Yes the switchover failed and I just removed the lock on set 3, since
it didn't actually move.

From gordo169 at gmail.com  Wed Apr 14 15:58:24 2010
From: gordo169 at gmail.com (Gordon Shannon)
Date: Wed, 14 Apr 2010 16:58:24 -0600
Subject: [Slony1-general] Slony-L: alterTableRestore() table with id not
	found
In-Reply-To: <h2x8a547c841004141512od34c8214ic0fdbea09eda6eea@mail.gmail.com>
References: <h2x8a547c841004141512od34c8214ic0fdbea09eda6eea@mail.gmail.com>
Message-ID: <r2rb2dd93301004141558z5a85f9fbpbcc30ef6ace9054e@mail.gmail.com>

Did you by any chance drop and recreate the 2 tables during the upgrade?  If
so, they would now have different OIDs than before, causing
sl_table.tab_reloid not to match.  Just a thought.

/Gordon

On Wed, Apr 14, 2010 at 4:12 PM, Tory M Blue <tmblue at gmail.com> wrote:

> So testing switchover after upgrading to 1.2 and 8.4.3 (well some are
> still on 8.3.4).
>
> And I'm getting this error when trying to switchover.  I get this
> error when I tried to drop set 3 (thought about creating another set
> to see what the issue is).
>
> I have 9 tables, and 7 of the 9 seem to work, but slon seems to be
> missing, not replicating and in fact citing that the table with the id
> can't be found, yet I find it just fine.
>
> Even if there is no clean way to "fix" this, is there a hack to drop
> this set in order to try to recreate the set for testing? Odd that
> it's only these 2 "ancient" tables are causing grief.
>
> Ideas?
>
> Thanks
> Tory
>
>
> -bash-3.1$ ./switchover_to_node2.sh
> <stdin>:22: Moved Set 1
> <stdin>:29: Moved Set 2
> <stdin>:34: PGRES_FATAL_ERROR select "_cls".moveSet(3, 2);  - ERROR:
> Slony-I: alterTableRestore(): Table with id 46 not found
> CONTEXT:  SQL statement "SELECT  "_cls".alterTableRestore( $1 )"
> PL/pgSQL function "moveset_int" line 33 at PERFORM
> SQL statement "SELECT  "_cls".moveSet_int( $1 ,  $2 ,  $3 , 0)"
> PL/pgSQL function "moveset" line 61 at PERFORM
> Switchover complete
>
> Tables are in there and slon schema knows about them.
>
>   46 |   24509700 | profile_fields          | adm   |       3 |
> profile_fields_pkey              | t           | profile_
> fields table
>     47 |   24509710 | profile_values          | adm  |       3 |
> profile_values_pkey              | t           | profile_
> values table
>
> Yes the switchover failed and I just removed the lock on set 3, since
> it didn't actually move.
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>



-- 
If I had more time, I could have written you a shorter letter.  (Blaise
Pascal)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20100414/7f519275/attachment.htm 

From tmblue at gmail.com  Wed Apr 14 16:03:48 2010
From: tmblue at gmail.com (Tory M Blue)
Date: Wed, 14 Apr 2010 16:03:48 -0700
Subject: [Slony1-general] Slony-L: alterTableRestore() table with id not
	found
In-Reply-To: <r2rb2dd93301004141558z5a85f9fbpbcc30ef6ace9054e@mail.gmail.com>
References: <h2x8a547c841004141512od34c8214ic0fdbea09eda6eea@mail.gmail.com>
	<r2rb2dd93301004141558z5a85f9fbpbcc30ef6ace9054e@mail.gmail.com>
Message-ID: <q2r8a547c841004141603qde9de8d5i67f9e544c33515a1@mail.gmail.com>

On Wed, Apr 14, 2010 at 3:58 PM, Gordon Shannon <gordo169 at gmail.com> wrote:
> Did you by any chance drop and recreate the 2 tables during the upgrade?? If
> so, they would now have different OIDs than before, causing
> sl_table.tab_reloid not to match.? Just a thought.
>
> /Gordon

Hey Gordon

Nope, didn't recreate any tables and they actually don't change, so
very odd. Found this happen in 2 diff environments now. A complete
ground up cures this, but I was trying to get some idea of other ways
to fix this.

These seems similar, similar versions etc

http://www.mail-archive.com/slony1-general at lists.slony.info/msg04473.html

Tory

From skarbat at gmail.com  Fri Apr 16 09:00:26 2010
From: skarbat at gmail.com (albert)
Date: Fri, 16 Apr 2010 12:00:26 -0400
Subject: [Slony1-general] recreating a cluster when the master dies
Message-ID: <m2l8e7d55dd1004160900m9aa7dfabm5068cc57ac973880@mail.gmail.com>

Greetings all,

I have a master-slave setup and am trying to automate a recovery situation
where the master fails and it is recreated from scratch based on a dump from
the slave's database.

Here's the flow of events I am using to test the transition:

1. the cluster is registered, the master and slave are in sync, all good.
2. the master dies. the master database is recreated from scratch using a
dump from the slave's database
3. the master-slave replication cluster is deleted using the following code
snippet:

cluster name = my_cluster;
node 1 admin conninfo = 'dbname=replica_test_master host=localhost
user=postgres';
node 2 admin conninfo = 'dbname=replica_test_slave host=localhost
user=postgres';
uninstall node ( id = 1 );
uninstall node ( id = 2 );

4. the slony cluster is recreated from scratch using the exact same commands
used in step 1
5. data is inserted into the master database, but IT IS NOT populated into
the slave. The last lines found on the slony process running against the
slave are the following:

2010-04-16 11:39:42 AST CONFIG version for "dbname=replica_test_slave
user=postgres" is 80401
2010-04-16 11:39:42 AST CONFIG remoteWorkerThread_1: update provider
configuration
2010-04-16 11:39:42 AST CONFIG version for "dbname=replica_test_master
host=localhost user=postgres" is 80401
TODO: ********** remoteWorkerThread: node 1 - EVENT 1,27 STORE_NODE -
unknown event type
2010-04-16 11:39:42 AST CONFIG storeListen: li_origin=1 li_receiver=2
li_provider=1
TODO: ********** remoteWorkerThread: node 1 - EVENT 1,28 ENABLE_NODE -
unknown event type
2010-04-16 11:39:42 AST CONFIG storeListen: li_origin=1 li_receiver=2
li_provider=1
2010-04-16 11:39:42 AST CONFIG storeListen: li_origin=1 li_receiver=2
li_provider=1
2010-04-16 11:39:42 AST CONFIG remoteWorkerThread_1: update provider
configuration

These log events are the same when the cluster is working flawlessly
(although more events are logged after these, of course).
It looks as thought the replication silently stops working with no apparent
reason.
Could anyone please help me understand what might be going wrong?

Thanks
Albert
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20100416/fd56263b/attachment.htm 

From ssinger at ca.afilias.info  Fri Apr 16 11:01:53 2010
From: ssinger at ca.afilias.info (Steve Singer)
Date: Fri, 16 Apr 2010 14:01:53 -0400
Subject: [Slony1-general] recreating a cluster when the master dies
In-Reply-To: <m2l8e7d55dd1004160900m9aa7dfabm5068cc57ac973880@mail.gmail.com>
References: <m2l8e7d55dd1004160900m9aa7dfabm5068cc57ac973880@mail.gmail.com>
Message-ID: <4BC8A611.90502@ca.afilias.info>

albert wrote:
> Greetings all,
> 
> I have a master-slave setup and am trying to automate a recovery 
> situation where the master fails and it is recreated from scratch based 
> on a dump from the slave's database.

You don't tell us which version of slony your using (this can be useful 
to know)

> 
> Here's the flow of events I am using to test the transition:
> 
> 1. the cluster is registered, the master and slave are in sync, all good.
> 2. the master dies. the master database is recreated from scratch using 
> a dump from the slave's database

When you take the dump of the slave database it still has slony 
installed on it.  Once you've restored this on the master your master 
has the slaves slony configuration on it.  It is probably a good idea to 
not start any slons up until after your uninstall node is finished (or 
to not restore the _my_cluster schema) though I don't think this is your 
problem.


> 3. the master-slave replication cluster is deleted using the following 
> code snippet:
> 
> TODO: ********** remoteWorkerThread: node 1 - EVENT 1,27 STORE_NODE - 
> unknown event type

This is very strange,  the error is saying that the big if/else block in 
   remote_worker.c isn't matching the events even the event name as 
printed in the above message looks okay.

If you have the ability I'd be curious attach a debugger to the slon 
process when it gets to this state and see what event->ev_type looks 
like at line 715 (in 1.2.21 source or the equivlent line on whatever 
version your on).

The strcmp against "STORE_NODE" should be matching and it should be 
going into that if block instead of falling to the last else where it 
prints the above error message.




> 2010-04-16 11:39:42 AST CONFIG storeListen: li_origin=1 li_receiver=2 
> li_provider=1
> TODO: ********** remoteWorkerThread: node 1 - EVENT 1,28 ENABLE_NODE - 
> unknown event type
> 2010-04-16 11:39:42 AST CONFIG storeListen: li_origin=1 li_receiver=2 
> li_provider=1
> 2010-04-16 11:39:42 AST CONFIG storeListen: li_origin=1 li_receiver=2 
> li_provider=1
> 2010-04-16 11:39:42 AST CONFIG remoteWorkerThread_1: update provider 
> configuration
> 
> These log events are the same when the cluster is working flawlessly 
> (although more events are logged after these, of course).
> It looks as thought the replication silently stops working with no 
> apparent reason.

I would not expect to see those 'TODO: **************** ..... unknown 
event type ' lines when the cluster is working flawlessly, are you 
saying that you always get them?



> Could anyone please help me understand what might be going wrong?
> 
> Thanks
> Albert
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


-- 
Steve Singer
Afilias Canada
Data Services Developer
416-673-1142

From skarbat at gmail.com  Sat Apr 17 08:22:55 2010
From: skarbat at gmail.com (albert)
Date: Sat, 17 Apr 2010 11:22:55 -0400
Subject: [Slony1-general] recreating a cluster when the master dies
In-Reply-To: <4BC8A611.90502@ca.afilias.info>
References: <m2l8e7d55dd1004160900m9aa7dfabm5068cc57ac973880@mail.gmail.com>
	<4BC8A611.90502@ca.afilias.info>
Message-ID: <v2n8e7d55dd1004170822kc0a24a1do6151d586dfd9426d@mail.gmail.com>

Hi Steve,

2010/4/16 Steve Singer <ssinger at ca.afilias.info>

> albert wrote:
>
>> Greetings all,
>>
>> I have a master-slave setup and am trying to automate a recovery situation
>> where the master fails and it is recreated from scratch based on a dump from
>> the slave's database.
>>
>
> You don't tell us which version of slony your using (this can be useful to
> know)
>
>
I downloaded the slony source code version 2.0.2 and compiled it in-site.
Compilation and installation ran perfect. I am running the tests against
Postgres 8.4.1, though the final setup will be running against Postgres
8.4.2.


>
>> Here's the flow of events I am using to test the transition:
>>
>> 1. the cluster is registered, the master and slave are in sync, all good.
>> 2. the master dies. the master database is recreated from scratch using a
>> dump from the slave's database
>>
>
> When you take the dump of the slave database it still has slony installed
> on it.  Once you've restored this on the master your master has the slaves
> slony configuration on it.  It is probably a good idea to not start any
> slons up until after your uninstall node is finished (or to not restore the
> _my_cluster schema) though I don't think this is your problem.
>

That is precisely right. I make sure the slony processes are stopped before
jumping into step number 2. Also, after several failed attempts, I decided
to dump back the slave database including the _my_cluster schema, and remove
all slony definitions by runinng the code snippet (see below). I do that
approach because if I dumped the database back excluding the _my_cluster
schema, the cluster redefinition failed telling me the cluster was already
defined (I am guessing this was caused because of the slony triggers defined
on my public schema tables).

 3. the master-slave replication cluster is deleted using the following code
>> snippet:
>>
>> TODO: ********** remoteWorkerThread: node 1 - EVENT 1,27 STORE_NODE -
>> unknown event type
>>
>
> This is very strange,  the error is saying that the big if/else block in
> remote_worker.c isn't matching the events even the event name as printed in
> the above message looks okay.
>
>
Well, that sounds interesting...

Here's part of the log messages from the slony process running against the
slave database during step 1, that is... when replication is setup for the
first time and data is moved across correctly. Note that the above TODO:
messages are also printed and then replication messages are logged and data
is moved correctly (My test inserts some random data into the master
database, sleeps for a while, then dumps both the slave and master databases
and they get diffed)

2010-04-17 09:20:39 AST INFO   remoteListenThread_1: thread starts
2010-04-17 09:20:39 AST INFO   remoteWorkerThread_1: thread starts
2010-04-17 09:20:39 AST CONFIG version for "dbname=replica_test_slave
user=postgres" is 80401
2010-04-17 09:20:39 AST CONFIG version for "dbname=replica_test_slave
user=postgres" is 80401
2010-04-17 09:20:39 AST CONFIG remoteWorkerThread_1: update provider
configuration
2010-04-17 09:20:39 AST CONFIG version for "dbname=replica_test_master
host=localhost user=postgres" is 80401
TODO: ********** remoteWorkerThread: node 1 - EVENT 1,27 STORE_NODE -
unknown event type
2010-04-17 09:20:39 AST CONFIG storeListen: li_origin=1 li_receiver=2
li_provider=1
TODO: ********** remoteWorkerThread: node 1 - EVENT 1,28 ENABLE_NODE -
unknown event type
2010-04-17 09:20:39 AST CONFIG storeListen: li_origin=1 li_receiver=2
li_provider=1
2010-04-17 09:20:39 AST CONFIG storeListen: li_origin=1 li_receiver=2
li_provider=1
2010-04-17 09:20:39 AST CONFIG storeSubscribe: sub_set=1 sub_provider=1
sub_forward='t'
2010-04-17 09:20:39 AST CONFIG storeListen: li_origin=1 li_receiver=2
li_provider=1
2010-04-17 09:20:39 AST INFO   copy_set 1
2010-04-17 09:20:39 AST CONFIG version for "dbname=replica_test_master
host=localhost user=postgres" is 80401
2010-04-17 09:20:39 AST CONFIG remoteWorkerThread_1: connected to provider
DB
2010-04-17 09:20:39 AST CONFIG remoteWorkerThread_1: prepare to copy table
"public"."domain"

Additional messages are logged and data is replicated correctly.


> If you have the ability I'd be curious attach a debugger to the slon
> process when it gets to this state and see what event->ev_type looks like at
> line 715 (in 1.2.21 source or the equivlent line on whatever version your
> on).
>

I am more than happy to do that. I am lacking advanced skills for that
though... I can see and attach to both slony processes running against the
slave, but I can't find the way to switch to the proper thread's context to
inspect the event symbol (there's 8 threads running on 1 process, and 1
thread on the other). I can inspect some symbols and I can see the source
code from gdb, so it would appear symbolic information is present into the
binaries. Could you please give me a hint on how to extract that
event->ev_type info?


>

The strcmp against "STORE_NODE" should be matching and it should be going
> into that if block instead of falling to the last else where it prints the
> above error message.
>
>
>
>
>
>  2010-04-16 11:39:42 AST CONFIG storeListen: li_origin=1 li_receiver=2
>> li_provider=1
>> TODO: ********** remoteWorkerThread: node 1 - EVENT 1,28 ENABLE_NODE -
>> unknown event type
>> 2010-04-16 11:39:42 AST CONFIG storeListen: li_origin=1 li_receiver=2
>> li_provider=1
>> 2010-04-16 11:39:42 AST CONFIG storeListen: li_origin=1 li_receiver=2
>> li_provider=1
>> 2010-04-16 11:39:42 AST CONFIG remoteWorkerThread_1: update provider
>> configuration
>>
>> These log events are the same when the cluster is working flawlessly
>> (although more events are logged after these, of course).
>> It looks as thought the replication silently stops working with no
>> apparent reason.
>>
>
> I would not expect to see those 'TODO: **************** ..... unknown event
> type ' lines when the cluster is working flawlessly, are you saying that you
> always get them?
>
>
That is correct. I always see them (see comments above).


>


>  Could anyone please help me understand what might be going wrong?
>>
>> Thanks
>> Albert
>>
>>
>> ------------------------------------------------------------------------
>>
>> _______________________________________________
>> Slony1-general mailing list
>>
>> Slony1-general at lists.slony.info
>> http://lists.slony.info/mailman/listinfo/slony1-general
>>
>
>
> --
> Steve Singer
> Afilias Canada
> Data Services Developer
> 416-673-1142
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20100417/2bdb4646/attachment.htm 

From jcasanov at systemguards.com.ec  Sat Apr 17 18:00:06 2010
From: jcasanov at systemguards.com.ec (Jaime Casanova)
Date: Sat, 17 Apr 2010 20:00:06 -0500
Subject: [Slony1-general] [slony-general] alter a table that is in two sets
Message-ID: <h2v3073cc9b1004171800l4f35c21dg8bf10aae44962b99@mail.gmail.com>

Hi,

Suppose i added a table to a set (set1) in node1 with other tables,
and that i subscribe that set to node2.
Then i have a node3 that needs a different set of tables but of them
is on set1, i added that table to the second set and subscribe it to
node3.

Now, i need to alter that table (the one that is on the two sets) but
in the execute script command i have to indicate the set where the
table is, so what can i do? choose one of the two sets randomly?

-- 
Atentamente,
Jaime Casanova
Soporte y capacitaci?n de PostgreSQL
Asesor?a y desarrollo de sistemas
Guayaquil - Ecuador
Cel. +59387171157

From melvin6925 at yahoo.com  Sat Apr 17 18:34:56 2010
From: melvin6925 at yahoo.com (Melvin Davidson)
Date: Sat, 17 Apr 2010 18:34:56 -0700 (PDT)
Subject: [Slony1-general] [slony-general] alter a table that is in two
	sets
In-Reply-To: <h2v3073cc9b1004171800l4f35c21dg8bf10aae44962b99@mail.gmail.com>
Message-ID: <626669.19593.qm@web53002.mail.re2.yahoo.com>

>Then i have a node3 that needs a different set of tables but of them
>is
 on set1, i added that table to the second set and subscribe it to
>node3.

Jaime,

you should _not_ have a table that is in two different sets. What you should do is
A. Create 3 sets.
???? set 1 has the just the common table.
???? set 2 has all but the common table for node 2
???? set 3 has all but the common table for node 3
B. Subscribe node 2 to set 2
C. Subscribe node 3 to set 3
D. Subscribe both node 2 & node 3 to set 1.

Melvin Davidson 
  

--- On Sat, 4/17/10, Jaime Casanova <jcasanov at systemguards.com.ec> wrote:

From: Jaime Casanova <jcasanov at systemguards.com.ec>
Subject: [Slony1-general] [slony-general] alter a table that is in two sets
To: "slony" <slony1-general at lists.slony.info>
Date: Saturday, April 17, 2010, 8:00 PM

Hi,

Suppose i added a table to a set (set1) in node1 with other tables,
and that i subscribe that set to node2.
Then i have a node3 that needs a different set of tables but of them
is on set1, i added that table to the second set and subscribe it to
node3.

Now, i need to alter that table (the one that is on the two sets) but
in the execute script command i have to indicate the set where the
table is, so what can i do? choose one of the two sets randomly?

-- 
Atentamente,
Jaime Casanova
Soporte y capacitaci?n de PostgreSQL
Asesor?a y desarrollo de sistemas
Guayaquil - Ecuador
Cel. +59387171157
_______________________________________________
Slony1-general mailing list
Slony1-general at lists.slony.info
http://lists.slony.info/mailman/listinfo/slony1-general



      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20100417/520a1fd4/attachment.htm 

From scott.marlowe at gmail.com  Sat Apr 17 21:13:53 2010
From: scott.marlowe at gmail.com (Scott Marlowe)
Date: Sat, 17 Apr 2010 22:13:53 -0600
Subject: [Slony1-general] [slony-general] alter a table that is in two
	sets
In-Reply-To: <h2v3073cc9b1004171800l4f35c21dg8bf10aae44962b99@mail.gmail.com>
References: <h2v3073cc9b1004171800l4f35c21dg8bf10aae44962b99@mail.gmail.com>
Message-ID: <o2jdcc563d11004172113gde07c86ao32a79ae78ac08442@mail.gmail.com>

On Sat, Apr 17, 2010 at 7:00 PM, Jaime Casanova
<jcasanov at systemguards.com.ec> wrote:
> Hi,
>
> Suppose i added a table to a set (set1) in node1 with other tables,
> and that i subscribe that set to node2.
> Then i have a node3 that needs a different set of tables but of them
> is on set1, i added that table to the second set and subscribe it to
> node3.
>
> Now, i need to alter that table (the one that is on the two sets) but
> in the execute script command i have to indicate the set where the
> table is, so what can i do? choose one of the two sets randomly?

Create a third set and move it there and out of the first two sets.
Then run ddl.  Then merge that back into one set.  Create a new set
with that table in it and merge it into the other set.

From ssinger at ca.afilias.info  Sun Apr 18 09:55:30 2010
From: ssinger at ca.afilias.info (Steve Singer)
Date: Sun, 18 Apr 2010 12:55:30 -0400
Subject: [Slony1-general] recreating a cluster when the master dies
In-Reply-To: <v2n8e7d55dd1004170822kc0a24a1do6151d586dfd9426d@mail.gmail.com>
References: <m2l8e7d55dd1004160900m9aa7dfabm5068cc57ac973880@mail.gmail.com>	
	<4BC8A611.90502@ca.afilias.info>
	<v2n8e7d55dd1004170822kc0a24a1do6151d586dfd9426d@mail.gmail.com>
Message-ID: <4BCB3982.3040001@ca.afilias.info>

albert wrote:
> Hi Steve,

> 
>     This is very strange,  the error is saying that the big if/else
>     block in   remote_worker.c isn't matching the events even the event
>     name as printed in the above message looks okay.
> 
> 
> Well, that sounds interesting...
> 
> Here's part of the log messages from the slony process running against 
> the slave database during step 1, that is... when replication is setup 
> for the first time and data is moved across correctly. Note that the 
> above TODO: messages are also printed and then replication messages are 
> logged and data is moved correctly (My test inserts some random data 
> into the master database, sleeps for a while, then dumps both the slave 
> and master databases and they get diffed)

This TODO error isn't the cause of your issue, one of the 'if' 
statements should be an 'else if' but that is causing that log message 
but it isn't causing a problem other than that.

Which leads us back to why isn't your slave subscribing.

Are there any locks open in the database (at the point that you've 
resubscribed things and are waiting for stuff to replicate?)

select pg_locks.*, pg_class.relname FROM pg_locks, pg_class where 
pg_locks.relation=pg_class.oid;

or something similar can show you that.

Do you have any transactions that were started before you subscribed the 
set that haven't committed yet?





-- 
Steve Singer
Afilias Canada
Data Services Developer
416-673-1142

From brianf at consistentstate.com  Mon Apr 19 16:01:09 2010
From: brianf at consistentstate.com (Brian Fehrle)
Date: Mon, 19 Apr 2010 17:01:09 -0600
Subject: [Slony1-general] appending to slony slave log file gets overwritten
Message-ID: <4BCCE0B5.1090807@consistentstate.com>

Hi,
    I'm working a script that will monitor a slony log file (the daemon 
output log, not logs generated by the -a param), in this case the slave 
log, and search it for various things. In order to not find the same log 
line multiple times, I'm appending my own "checkpoint" line to the slon 
slave log. However, this line I added gets removed a few moments after I 
write it to the file.

Is there any way for me to change this behavior, or another way for me 
to get a custom log line into the slon slave daemon's log? Or would I be 
better off looking for an alternate method to this?

I am using slony version 1.2.20

thanks in advance,
              Brian Fehrle
            


From skarbat at gmail.com  Mon Apr 19 17:17:04 2010
From: skarbat at gmail.com (albert)
Date: Mon, 19 Apr 2010 20:17:04 -0400
Subject: [Slony1-general] recreating a cluster when the master dies
In-Reply-To: <4BCB3982.3040001@ca.afilias.info>
References: <m2l8e7d55dd1004160900m9aa7dfabm5068cc57ac973880@mail.gmail.com>
	<4BC8A611.90502@ca.afilias.info>
	<v2n8e7d55dd1004170822kc0a24a1do6151d586dfd9426d@mail.gmail.com>
	<4BCB3982.3040001@ca.afilias.info>
Message-ID: <v2l8e7d55dd1004191717vcf742f36hd6885561e01933b7@mail.gmail.com>

Thanks Steve,

Your suggestions were very helpful. I fixed the problem by running the
following code snippet directly against the slave right after registering
the cluster on the master database. I am guessing there was some mismatch
between the two. All fixed. Thanks.

#!/bin/bash
/usr/lib/postgresql/8.4/bin/slonik << _EOF_
cluster name = $CLUSTER;
node 1 admin conninfo = 'dbname=$DB1 host=$H1 user=$U';
node 2 admin conninfo = 'dbname=$DB2 host=$H2 user=$U';
subscribe set (id = 1, provider = 1, receiver = 2, forward = yes);"
_EOF_

2010/4/18 Steve Singer <ssinger at ca.afilias.info>

> albert wrote:
>
>> Hi Steve,
>>
>
>
>>    This is very strange,  the error is saying that the big if/else
>>    block in   remote_worker.c isn't matching the events even the event
>>    name as printed in the above message looks okay.
>>
>>
>> Well, that sounds interesting...
>>
>> Here's part of the log messages from the slony process running against the
>> slave database during step 1, that is... when replication is setup for the
>> first time and data is moved across correctly. Note that the above TODO:
>> messages are also printed and then replication messages are logged and data
>> is moved correctly (My test inserts some random data into the master
>> database, sleeps for a while, then dumps both the slave and master databases
>> and they get diffed)
>>
>
> This TODO error isn't the cause of your issue, one of the 'if' statements
> should be an 'else if' but that is causing that log message but it isn't
> causing a problem other than that.
>
> Which leads us back to why isn't your slave subscribing.
>
> Are there any locks open in the database (at the point that you've
> resubscribed things and are waiting for stuff to replicate?)
>
> select pg_locks.*, pg_class.relname FROM pg_locks, pg_class where
> pg_locks.relation=pg_class.oid;
>
> or something similar can show you that.
>
> Do you have any transactions that were started before you subscribed the
> set that haven't committed yet?
>
>
>
>
>
>
> --
> Steve Singer
> Afilias Canada
> Data Services Developer
> 416-673-1142
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20100419/770653aa/attachment.htm 

From JanWieck at Yahoo.com  Mon Apr 19 17:35:37 2010
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Mon, 19 Apr 2010 20:35:37 -0400
Subject: [Slony1-general] Slony-L: alterTableRestore() table with id not
 found
In-Reply-To: <h2x8a547c841004141512od34c8214ic0fdbea09eda6eea@mail.gmail.com>
References: <h2x8a547c841004141512od34c8214ic0fdbea09eda6eea@mail.gmail.com>
Message-ID: <4BCCF6D9.8000709@Yahoo.com>

On 4/14/2010 6:12 PM, Tory M Blue wrote:
> So testing switchover after upgrading to 1.2 and 8.4.3 (well some are
> still on 8.3.4).
> 
> And I'm getting this error when trying to switchover.  I get this
> error when I tried to drop set 3 (thought about creating another set
> to see what the issue is).
> 
> I have 9 tables, and 7 of the 9 seem to work, but slon seems to be
> missing, not replicating and in fact citing that the table with the id
> can't be found, yet I find it just fine.

Can you find the table by name, or can you find the table by its OID? In 
my experience, ancient tables tend to have Slony and the system catalog 
disagree about what a particular pg_class row's OID/relname combination are.


Jan

> 
> Even if there is no clean way to "fix" this, is there a hack to drop
> this set in order to try to recreate the set for testing? Odd that
> it's only these 2 "ancient" tables are causing grief.
> 
> Ideas?
> 
> Thanks
> Tory
> 
> 
> -bash-3.1$ ./switchover_to_node2.sh
> <stdin>:22: Moved Set 1
> <stdin>:29: Moved Set 2
> <stdin>:34: PGRES_FATAL_ERROR select "_cls".moveSet(3, 2);  - ERROR:
> Slony-I: alterTableRestore(): Table with id 46 not found
> CONTEXT:  SQL statement "SELECT  "_cls".alterTableRestore( $1 )"
> PL/pgSQL function "moveset_int" line 33 at PERFORM
> SQL statement "SELECT  "_cls".moveSet_int( $1 ,  $2 ,  $3 , 0)"
> PL/pgSQL function "moveset" line 61 at PERFORM
> Switchover complete
> 
> Tables are in there and slon schema knows about them.
> 
>    46 |   24509700 | profile_fields          | adm   |       3 |
> profile_fields_pkey              | t           | profile_
> fields table
>      47 |   24509710 | profile_values          | adm  |       3 |
> profile_values_pkey              | t           | profile_
> values table
> 
> Yes the switchover failed and I just removed the lock on set 3, since
> it didn't actually move.
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin


From ssinger at ca.afilias.info  Tue Apr 20 06:26:04 2010
From: ssinger at ca.afilias.info (Steve Singer)
Date: Tue, 20 Apr 2010 09:26:04 -0400
Subject: [Slony1-general] appending to slony slave log file gets
	overwritten
In-Reply-To: <4BCCE0B5.1090807@consistentstate.com>
References: <4BCCE0B5.1090807@consistentstate.com>
Message-ID: <4BCDAB6C.1020002@ca.afilias.info>

Brian Fehrle wrote:
> Hi,
>     I'm working a script that will monitor a slony log file (the daemon 
> output log, not logs generated by the -a param), in this case the slave 
> log, and search it for various things. In order to not find the same log 
> line multiple times, I'm appending my own "checkpoint" line to the slon 
> slave log. However, this line I added gets removed a few moments after I 
> write it to the file.
> 
> Is there any way for me to change this behavior, or another way for me 
> to get a custom log line into the slon slave daemon's log? Or would I be 
> better off looking for an alternate method to this?

Brian,

Have you considered writing a program/script that launches the slon and 
  then read slon's  stdout/stderr as a stream thus seeing each line of 
output as slon outputs it?

I have a java application that does type of thing and so far it seems to 
be working well (though I haven't yet gotten to writing the code to 
detecting interesting events from the slon output)

Launching a subprocess and reading from its output stream can be done in 
a few lines of perl or python.

Steve





> 
> I am using slony version 1.2.20
> 
> thanks in advance,
>               Brian Fehrle
>             
> 
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


-- 
Steve Singer
Afilias Canada
Data Services Developer
416-673-1142

From jcasanov at systemguards.com.ec  Tue Apr 20 23:35:05 2010
From: jcasanov at systemguards.com.ec (Jaime Casanova)
Date: Wed, 21 Apr 2010 01:35:05 -0500
Subject: [Slony1-general] [slony-general] error adding a table
Message-ID: <m2p3073cc9b1004202335hd339f0a3w2e81861bb59a381d@mail.gmail.com>

Hi,

A customer of mine has the tendency of not follow instructions :(
Recently i found that a table that is audited with table_log was
modified without considering the log table (so the log table wasn't
writing and neither the audited one), to fix that i drop the log table
from the replication, renamed it and create a new one with the missing
column...

then i tried to readd it to the replication i tried with the same id
number it had before but when i subscribe the set get an error on the
receiver that that tab_id exists so i tried it with a new number
"""
2010-04-21 00:28:59 ECT DEBUG3 remoteWorkerThread_1: table
"audit_log"."tcom_control_actividad_fecha" does not require Slony-I
serial key
2010-04-21 00:28:59 ECT ERROR  remoteWorkerThread_1: "select
"_sncp_incop_cluster".setAddTable_int(999, 259,
'"audit_log"."tcom_control_actividad_fecha"',
'tcom_control_actividad_fecha_pkey', ''); " PGRES_FATAL_ERROR ERROR:
Slony-I: setAddTable_int: table id 259 has already been assigned!
"""

so i unsubscribe the set, drop the table from the replica, and re add
it again with a new tab_id... but when i try  to subscribe it doesn't
get subscribed and the table doesn't copy and i get this error on the
receiver
"""
2010-04-21 01:01:55 ECT DEBUG2 remoteListenThread_1: queue event
1,819616 SUBSCRIBE_SET
2010-04-21 01:01:55 ECT DEBUG2 remoteListenThread_1: queue event
1,819617 ENABLE_SUBSCRIPTION
2010-04-21 01:01:59 ECT DEBUG1 copy_set 999
2010-04-21 01:01:59 ECT ERROR  remoteWorkerThread_1: node -1 not found
in runtime configuration
2010-04-21 01:01:59 ECT WARN   remoteWorkerThread_1: data copy for set
999 failed 539 times - sleep 60 seconds
"""

now, i'm getting this message every often... ideas?

-- 
Atentamente,
Jaime Casanova
Soporte y capacitaci?n de PostgreSQL
Asesor?a y desarrollo de sistemas
Guayaquil - Ecuador
Cel. +59387171157

From glynastill at yahoo.co.uk  Wed Apr 21 00:29:39 2010
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Wed, 21 Apr 2010 07:29:39 +0000 (GMT)
Subject: [Slony1-general] [slony-general] error adding a table
In-Reply-To: <m2p3073cc9b1004202335hd339f0a3w2e81861bb59a381d@mail.gmail.com>
Message-ID: <463227.47900.qm@web23602.mail.ird.yahoo.com>

--- On Wed, 21/4/10, Jaime Casanova <jcasanov at systemguards.com.ec> wrote:

> A customer of mine has the tendency of not follow
> instructions :(
> Recently i found that a table that is audited with
> table_log was
> modified without considering the log table (so the log
> table wasn't
> writing and neither the audited one), to fix that i drop
> the log table
> from the replication, renamed it and create a new one with
> the missing
> column...
> 
> then i tried to readd it to the replication i tried with
> the same id
> number it had before but when i subscribe the set get an
> error on the
> receiver that that tab_id exists so i tried it with a new
> number
> """
> 2010-04-21 00:28:59 ECT DEBUG3 remoteWorkerThread_1: table
> "audit_log"."tcom_control_actividad_fecha" does not require
> Slony-I
> serial key
> 2010-04-21 00:28:59 ECT ERROR? remoteWorkerThread_1:
> "select
> "_sncp_incop_cluster".setAddTable_int(999, 259,
> '"audit_log"."tcom_control_actividad_fecha"',
> 'tcom_control_actividad_fecha_pkey', ''); "
> PGRES_FATAL_ERROR ERROR:
> Slony-I: setAddTable_int: table id 259 has already been
> assigned!
> """
> 
> so i unsubscribe the set, drop the table from the replica,
> and re add
> it again with a new tab_id... but when i try? to
> subscribe it doesn't
> get subscribed and the table doesn't copy and i get this
> error on the
> receiver
> """
> 2010-04-21 01:01:55 ECT DEBUG2 remoteListenThread_1: queue
> event
> 1,819616 SUBSCRIBE_SET
> 2010-04-21 01:01:55 ECT DEBUG2 remoteListenThread_1: queue
> event
> 1,819617 ENABLE_SUBSCRIPTION
> 2010-04-21 01:01:59 ECT DEBUG1 copy_set 999
> 2010-04-21 01:01:59 ECT ERROR? remoteWorkerThread_1:
> node -1 not found
> in runtime configuration
> 2010-04-21 01:01:59 ECT
> WARN???remoteWorkerThread_1: data copy for
> set
> 999 failed 539 times - sleep 60 seconds
> """
> 
> now, i'm getting this message every often... ideas?
> 

I had that "node -1 not found" error a few years ago when I was testing and nobody seemed to be able to say what it means or could be. It would be really interesting if anyone can explain.

For me it happened after a similar sequence of events, where I'd messed up a table, or been dumb and just dropped it without telling first dropping it from slony.  Except that I'm sure dropping the set and re-adding it fixed the issue.

My memory is foggy, but at the time I came to the conclusion that I might also have done something stupid due to pgAdmin not being fully aware of what slony was doing in the background (in this case waiting between subscribe and merge set), and decided to stick with raw slonik.

Still really interested in the node -1 error.


      

From ssinger at ca.afilias.info  Wed Apr 21 06:22:18 2010
From: ssinger at ca.afilias.info (Steve Singer)
Date: Wed, 21 Apr 2010 09:22:18 -0400
Subject: [Slony1-general] [slony-general] error adding a table
In-Reply-To: <m2p3073cc9b1004202335hd339f0a3w2e81861bb59a381d@mail.gmail.com>
References: <m2p3073cc9b1004202335hd339f0a3w2e81861bb59a381d@mail.gmail.com>
Message-ID: <4BCEFC0A.3010303@ca.afilias.info>

Jaime Casanova wrote:
> Hi,
> 
> A customer of mine has the tendency of not follow instructions :(
> Recently i found that a table that is audited with table_log was
> modified without considering the log table (so the log table wasn't
> writing and neither the audited one), to fix that i drop the log table
> from the replication, renamed it and create a new one with the missing
> column...
> 
> then i tried to readd it to the replication i tried with the same id
> number it had before but when i subscribe the set get an error on the
> receiver that that tab_id exists so i tried it with a new number
> """
> 2010-04-21 00:28:59 ECT DEBUG3 remoteWorkerThread_1: table
> "audit_log"."tcom_control_actividad_fecha" does not require Slony-I
> serial key
> 2010-04-21 00:28:59 ECT ERROR  remoteWorkerThread_1: "select
> "_sncp_incop_cluster".setAddTable_int(999, 259,
> '"audit_log"."tcom_control_actividad_fecha"',
> 'tcom_control_actividad_fecha_pkey', ''); " PGRES_FATAL_ERROR ERROR:
> Slony-I: setAddTable_int: table id 259 has already been assigned!
> """
> 
> so i unsubscribe the set, drop the table from the replica, and re add
> it again with a new tab_id... but when i try  to subscribe it doesn't
> get subscribed and the table doesn't copy and i get this error on the
> receiver
> """
> 2010-04-21 01:01:55 ECT DEBUG2 remoteListenThread_1: queue event
> 1,819616 SUBSCRIBE_SET
> 2010-04-21 01:01:55 ECT DEBUG2 remoteListenThread_1: queue event
> 1,819617 ENABLE_SUBSCRIPTION
> 2010-04-21 01:01:59 ECT DEBUG1 copy_set 999
> 2010-04-21 01:01:59 ECT ERROR  remoteWorkerThread_1: node -1 not found
> in runtime configuration
> 2010-04-21 01:01:59 ECT WARN   remoteWorkerThread_1: data copy for set
> 999 failed 539 times - sleep 60 seconds
> """
> 
> now, i'm getting this message every often... ideas?

http://bugs.slony.info/bugzilla/show_bug.cgi?id=111 mentions this 'node 
-1' error, I tried to reproduce this with the 2.0 branch a while back 
but wasn't able to figure out exactly what steps I need to perform to 
reproduce this state.

If your in a position that you can make a pg_dump of your slony schema 
(from both the master and the replica, with the data in the sl_* tables) 
and somehow send it to us off-list we wouldn't mind taking a look at it.





-- 
Steve Singer
Afilias Canada
Data Services Developer
416-673-1142

From JanWieck at Yahoo.com  Tue Apr 20 20:50:15 2010
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Tue, 20 Apr 2010 23:50:15 -0400
Subject: [Slony1-general] [slony-general] error adding a table
In-Reply-To: <m2p3073cc9b1004202335hd339f0a3w2e81861bb59a381d@mail.gmail.com>
References: <m2p3073cc9b1004202335hd339f0a3w2e81861bb59a381d@mail.gmail.com>
Message-ID: <4BCE75F7.9070704@Yahoo.com>

On 4/21/2010 2:35 AM, Jaime Casanova wrote:
> Hi,
> 
> A customer of mine has the tendency of not follow instructions :(
> Recently i found that a table that is audited with table_log was
> modified without considering the log table (so the log table wasn't
> writing and neither the audited one), to fix that i drop the log table
> from the replication, renamed it and create a new one with the missing
> column...
> 
> then i tried to readd it to the replication i tried with the same id
> number it had before but when i subscribe the set get an error on the
> receiver that that tab_id exists so i tried it with a new number

This is suspicious. Is it possible that the original SET DROP TABLE 
failed on the subscriber and that the event was manually deleted from 
sl_event? This would be the only way I could envision how to force that 
existing tab_id on subscribe.


Jan

> """
> 2010-04-21 00:28:59 ECT DEBUG3 remoteWorkerThread_1: table
> "audit_log"."tcom_control_actividad_fecha" does not require Slony-I
> serial key
> 2010-04-21 00:28:59 ECT ERROR  remoteWorkerThread_1: "select
> "_sncp_incop_cluster".setAddTable_int(999, 259,
> '"audit_log"."tcom_control_actividad_fecha"',
> 'tcom_control_actividad_fecha_pkey', ''); " PGRES_FATAL_ERROR ERROR:
> Slony-I: setAddTable_int: table id 259 has already been assigned!
> """
> 
> so i unsubscribe the set, drop the table from the replica, and re add
> it again with a new tab_id... but when i try  to subscribe it doesn't
> get subscribed and the table doesn't copy and i get this error on the
> receiver
> """
> 2010-04-21 01:01:55 ECT DEBUG2 remoteListenThread_1: queue event
> 1,819616 SUBSCRIBE_SET
> 2010-04-21 01:01:55 ECT DEBUG2 remoteListenThread_1: queue event
> 1,819617 ENABLE_SUBSCRIPTION
> 2010-04-21 01:01:59 ECT DEBUG1 copy_set 999
> 2010-04-21 01:01:59 ECT ERROR  remoteWorkerThread_1: node -1 not found
> in runtime configuration
> 2010-04-21 01:01:59 ECT WARN   remoteWorkerThread_1: data copy for set
> 999 failed 539 times - sleep 60 seconds
> """
> 
> now, i'm getting this message every often... ideas?
> 


-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin

From scott.marlowe at gmail.com  Wed Apr 21 11:38:48 2010
From: scott.marlowe at gmail.com (Scott Marlowe)
Date: Wed, 21 Apr 2010 12:38:48 -0600
Subject: [Slony1-general] logswitch_finish( )
Message-ID: <v2xdcc563d11004211138l16b7d210v5b0268d238ddfd6@mail.gmail.com>

So, I had a query that blocked all updates going out of the sl_log_2
table, and it's 13Gig.  sl_log_1 is empty.

IS the logswitch_finish() command an acceptable method for forcing the
replication engine to switch from 2 to 1 so I can vacuum full 2?

From devrim at gunduz.org  Wed Apr 21 11:54:07 2010
From: devrim at gunduz.org (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Wed, 21 Apr 2010 21:54:07 +0300
Subject: [Slony1-general] Slony 2.0.3 RPMs for RHEL5 are released
Message-ID: <1271876047.2471.11.camel@hp-laptop2.gunduz.org>


I just released Slony 2.0.3 RPMs for RHEL5, which was requested for a
long time. It is available in PostgreSQL RPM repository:

http://yum.pgrpms.org

Thanks David Fetter for pre-release testing.

Regards,
-- 
Devrim G?ND?Z
PostgreSQL Dan??man?/Consultant, Red Hat Certified Engineer
PostgreSQL RPM Repository: http://yum.pgrpms.org
Community: devrim~PostgreSQL.org, devrim.gunduz~linux.org.tr
http://www.gunduz.org  Twitter: http://twitter.com/devrimgunduz
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20100421/4615faea/attachment.pgp 

From jcasanov at systemguards.com.ec  Wed Apr 21 12:45:23 2010
From: jcasanov at systemguards.com.ec (Jaime Casanova)
Date: Wed, 21 Apr 2010 14:45:23 -0500
Subject: [Slony1-general] logswitch_finish( )
In-Reply-To: <v2xdcc563d11004211138l16b7d210v5b0268d238ddfd6@mail.gmail.com>
References: <v2xdcc563d11004211138l16b7d210v5b0268d238ddfd6@mail.gmail.com>
Message-ID: <i2o3073cc9b1004211245q1fb34bb7q2a9fc0e301f4861d@mail.gmail.com>

On Wed, Apr 21, 2010 at 1:38 PM, Scott Marlowe <scott.marlowe at gmail.com> wrote:
>
> IS the logswitch_finish() command an acceptable method for forcing the
> replication engine to switch from 2 to 1 so I can vacuum full 2?
>

i think that is what slony execute internally to make the switch, so i
think is safe to execute it... and after that sl_log_1 will be
truncated for slony so no vacuuming needed

-- 
Atentamente,
Jaime Casanova
Soporte y capacitaci?n de PostgreSQL
Asesor?a y desarrollo de sistemas
Guayaquil - Ecuador
Cel. +59387171157

From jcasanov at systemguards.com.ec  Wed Apr 21 12:45:58 2010
From: jcasanov at systemguards.com.ec (Jaime Casanova)
Date: Wed, 21 Apr 2010 14:45:58 -0500
Subject: [Slony1-general] logswitch_finish( )
In-Reply-To: <i2o3073cc9b1004211245q1fb34bb7q2a9fc0e301f4861d@mail.gmail.com>
References: <v2xdcc563d11004211138l16b7d210v5b0268d238ddfd6@mail.gmail.com> 
	<i2o3073cc9b1004211245q1fb34bb7q2a9fc0e301f4861d@mail.gmail.com>
Message-ID: <z2t3073cc9b1004211245r84ff606cq36091e42357ec876@mail.gmail.com>

On Wed, Apr 21, 2010 at 2:45 PM, Jaime Casanova
<jcasanov at systemguards.com.ec> wrote:
> On Wed, Apr 21, 2010 at 1:38 PM, Scott Marlowe <scott.marlowe at gmail.com> wrote:
>>
>> IS the logswitch_finish() command an acceptable method for forcing the
>> replication engine to switch from 2 to 1 so I can vacuum full 2?
>>
>
> i think that is what slony execute internally to make the switch, so i
> think is safe to execute it... and after that sl_log_1 will be
> truncated for slony so no vacuuming needed
>

sorry, slony will truncate sl_log_2 obviously...

-- 
Atentamente,
Jaime Casanova
Soporte y capacitaci?n de PostgreSQL
Asesor?a y desarrollo de sistemas
Guayaquil - Ecuador
Cel. +59387171157

From JanWieck at Yahoo.com  Wed Apr 21 13:04:51 2010
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Wed, 21 Apr 2010 16:04:51 -0400
Subject: [Slony1-general] logswitch_finish( )
In-Reply-To: <v2xdcc563d11004211138l16b7d210v5b0268d238ddfd6@mail.gmail.com>
References: <v2xdcc563d11004211138l16b7d210v5b0268d238ddfd6@mail.gmail.com>
Message-ID: <4BCF5A63.80504@Yahoo.com>

On 4/21/2010 2:38 PM, Scott Marlowe wrote:
> So, I had a query that blocked all updates going out of the sl_log_2
> table, and it's 13Gig.  sl_log_1 is empty.
> 
> IS the logswitch_finish() command an acceptable method for forcing the
> replication engine to switch from 2 to 1 so I can vacuum full 2?

It is completely safe to call logswitch_finish() at any time. It may or 
may not actually do something.

In your case, I presume the value of sl_log_status is 2. This means it 
is waiting for sl_log_2 to become empty and once that happens, it will 
truncate it and set sl_log_status to 0.


Jan

-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin

From scott.marlowe at gmail.com  Wed Apr 21 13:13:23 2010
From: scott.marlowe at gmail.com (Scott Marlowe)
Date: Wed, 21 Apr 2010 14:13:23 -0600
Subject: [Slony1-general] logswitch_finish( )
In-Reply-To: <4BCF5A63.80504@Yahoo.com>
References: <v2xdcc563d11004211138l16b7d210v5b0268d238ddfd6@mail.gmail.com>
	<4BCF5A63.80504@Yahoo.com>
Message-ID: <h2gdcc563d11004211313l8018a873k886d6bc5a1c94e4b@mail.gmail.com>

On Wed, Apr 21, 2010 at 2:04 PM, Jan Wieck <JanWieck at yahoo.com> wrote:
> On 4/21/2010 2:38 PM, Scott Marlowe wrote:
>>
>> So, I had a query that blocked all updates going out of the sl_log_2
>> table, and it's 13Gig. ?sl_log_1 is empty.
>>
>> IS the logswitch_finish() command an acceptable method for forcing the
>> replication engine to switch from 2 to 1 so I can vacuum full 2?
>
> It is completely safe to call logswitch_finish() at any time. It may or may
> not actually do something.
>
> In your case, I presume the value of sl_log_status is 2. This means it is
> waiting for sl_log_2 to become empty and once that happens, it will truncate
> it and set sl_log_status to 0.

So, if I let the system just sit quiescent for a while, it should
straighten things out?

From JanWieck at Yahoo.com  Wed Apr 21 13:23:56 2010
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Wed, 21 Apr 2010 16:23:56 -0400
Subject: [Slony1-general] logswitch_finish( )
In-Reply-To: <h2gdcc563d11004211313l8018a873k886d6bc5a1c94e4b@mail.gmail.com>
References: <v2xdcc563d11004211138l16b7d210v5b0268d238ddfd6@mail.gmail.com>	
	<4BCF5A63.80504@Yahoo.com>
	<h2gdcc563d11004211313l8018a873k886d6bc5a1c94e4b@mail.gmail.com>
Message-ID: <4BCF5EDC.4020407@Yahoo.com>

On 4/21/2010 4:13 PM, Scott Marlowe wrote:
> On Wed, Apr 21, 2010 at 2:04 PM, Jan Wieck <JanWieck at yahoo.com> wrote:
>> On 4/21/2010 2:38 PM, Scott Marlowe wrote:
>>>
>>> So, I had a query that blocked all updates going out of the sl_log_2
>>> table, and it's 13Gig.  sl_log_1 is empty.
>>>
>>> IS the logswitch_finish() command an acceptable method for forcing the
>>> replication engine to switch from 2 to 1 so I can vacuum full 2?
>>
>> It is completely safe to call logswitch_finish() at any time. It may or may
>> not actually do something.
>>
>> In your case, I presume the value of sl_log_status is 2. This means it is
>> waiting for sl_log_2 to become empty and once that happens, it will truncate
>> it and set sl_log_status to 0.
> 
> So, if I let the system just sit quiescent for a while, it should
> straighten things out?

If everything is caught up and the slon's are running properly, that is 
what should happen.


Jan

-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin

From cbbrowne at ca.afilias.info  Wed Apr 21 13:28:02 2010
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed, 21 Apr 2010 16:28:02 -0400
Subject: [Slony1-general] logswitch_finish( )
In-Reply-To: <h2gdcc563d11004211313l8018a873k886d6bc5a1c94e4b@mail.gmail.com>
	(Scott Marlowe's message of "Wed, 21 Apr 2010 14:13:23 -0600")
References: <v2xdcc563d11004211138l16b7d210v5b0268d238ddfd6@mail.gmail.com>
	<4BCF5A63.80504@Yahoo.com>
	<h2gdcc563d11004211313l8018a873k886d6bc5a1c94e4b@mail.gmail.com>
Message-ID: <87sk6oy2i5.fsf@ca.afilias.info>

Scott Marlowe <scott.marlowe at gmail.com> writes:
> On Wed, Apr 21, 2010 at 2:04 PM, Jan Wieck <JanWieck at yahoo.com> wrote:
>> On 4/21/2010 2:38 PM, Scott Marlowe wrote:
>>>
>>> So, I had a query that blocked all updates going out of the sl_log_2
>>> table, and it's 13Gig. ?sl_log_1 is empty.
>>>
>>> IS the logswitch_finish() command an acceptable method for forcing the
>>> replication engine to switch from 2 to 1 so I can vacuum full 2?
>>
>> It is completely safe to call logswitch_finish() at any time. It may or may
>> not actually do something.
>>
>> In your case, I presume the value of sl_log_status is 2. This means it is
>> waiting for sl_log_2 to become empty and once that happens, it will truncate
>> it and set sl_log_status to 0.
>
> So, if I let the system just sit quiescent for a while, it should
> straighten things out?

The other thing that could be useful to run would be the stored function
cleanupevent().

That clears out old events that have been confirmed by all nodes in the
cluster, which is the pre-requisite for logswitch_finish() doing
anything useful.

It would probably be a useful idea for cleanupevent() to log a little
bit of information about how much work it does (e.g. - how many tuples
it trims out of sl_confirm, sl_event, sl_seqlog).
-- 
(format nil "~S@~S" "cbbrowne" "ca.afilias.info")
Christopher Browne
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"

From jcasanov at systemguards.com.ec  Wed Apr 21 16:06:24 2010
From: jcasanov at systemguards.com.ec (Jaime Casanova)
Date: Wed, 21 Apr 2010 18:06:24 -0500
Subject: [Slony1-general] [slony-general] error adding a table
In-Reply-To: <4BCEFC0A.3010303@ca.afilias.info>
References: <m2p3073cc9b1004202335hd339f0a3w2e81861bb59a381d@mail.gmail.com> 
	<4BCEFC0A.3010303@ca.afilias.info>
Message-ID: <w2o3073cc9b1004211606w5a84eb07mc2caf8b7bbccb0d3@mail.gmail.com>

On Wed, Apr 21, 2010 at 8:22 AM, Steve Singer <ssinger at ca.afilias.info> wrote:
>
> http://bugs.slony.info/bugzilla/show_bug.cgi?id=111 mentions this 'node -1'
> error, I tried to reproduce this with the 2.0 branch a while back but wasn't
> able to figure out exactly what steps I need to perform to reproduce this
> state.
>
> If your in a position that you can make a pg_dump of your slony schema (from
> both the master and the replica, with the data in the sl_* tables) and
> somehow send it to us off-list we wouldn't mind taking a look at it.
>

actually is too late for this, the schema has more than 800Mb now...
for some reason sl_log_2 has grown up to 3147101 rows, so i executed
logswitch_start() and logswitch_finish() and get this message:
"""
NOTICE:  Slony-I: log switch to sl_log_1 still in progress - sl_log_2
not truncated
 logswitch_finish
------------------
               -1
(1 row)
"""

and now sl_log_2 is not growing any more, but now it's sl_log_1 who is
grown... but i can't find any messages on postgres or slony logs
explaining why

maybe now that 2.0.3 is released i will uninstall 1.2.20 and install
the new one... but i prefer to find an answer to this...
i will try to make the same bug trigger on my home machine, hope i can :)

any ideas on what look for the sl_log_x problem?

-- 
Atentamente,
Jaime Casanova
Soporte y capacitaci?n de PostgreSQL
Asesor?a y desarrollo de sistemas
Guayaquil - Ecuador
Cel. +59387171157

From JanWieck at Yahoo.com  Wed Apr 21 16:24:28 2010
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Wed, 21 Apr 2010 19:24:28 -0400
Subject: [Slony1-general] [slony-general] error adding a table
In-Reply-To: <w2o3073cc9b1004211606w5a84eb07mc2caf8b7bbccb0d3@mail.gmail.com>
References: <m2p3073cc9b1004202335hd339f0a3w2e81861bb59a381d@mail.gmail.com>
	<4BCEFC0A.3010303@ca.afilias.info>
	<w2o3073cc9b1004211606w5a84eb07mc2caf8b7bbccb0d3@mail.gmail.com>
Message-ID: <4BCF892C.3070509@Yahoo.com>

On 4/21/2010 7:06 PM, Jaime Casanova wrote:
> On Wed, Apr 21, 2010 at 8:22 AM, Steve Singer <ssinger at ca.afilias.info> wrote:
>>
>> http://bugs.slony.info/bugzilla/show_bug.cgi?id=111 mentions this 'node -1'
>> error, I tried to reproduce this with the 2.0 branch a while back but wasn't
>> able to figure out exactly what steps I need to perform to reproduce this
>> state.
>>
>> If your in a position that you can make a pg_dump of your slony schema (from
>> both the master and the replica, with the data in the sl_* tables) and
>> somehow send it to us off-list we wouldn't mind taking a look at it.
>>
> 
> actually is too late for this, the schema has more than 800Mb now...
> for some reason sl_log_2 has grown up to 3147101 rows, so i executed
> logswitch_start() and logswitch_finish() and get this message:
> """
> NOTICE:  Slony-I: log switch to sl_log_1 still in progress - sl_log_2
> not truncated
>  logswitch_finish
> ------------------
>                -1
> (1 row)
> """
> 
> and now sl_log_2 is not growing any more, but now it's sl_log_1 who is
> grown... but i can't find any messages on postgres or slony logs
> explaining why

Once replication for a node has stalled and cannot get past a certain 
event, no log switch will ever succeed. Since you keep getting that node 
-1 error message, I presume you are in exactly that situation. 
logswitch_finish() cannot succeed because that node will never consume 
all the log rows, that are in that segment. This is not a bug, this is 
actually a well designed feature.

> maybe now that 2.0.3 is released i will uninstall 1.2.20 and install
> the new one... but i prefer to find an answer to this...
> i will try to make the same bug trigger on my home machine, hope i can :)
> 
> any ideas on what look for the sl_log_x problem?

What does sl_status look like on the origin?


Jan

-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin


From jcasanov at systemguards.com.ec  Wed Apr 21 16:44:06 2010
From: jcasanov at systemguards.com.ec (Jaime Casanova)
Date: Wed, 21 Apr 2010 18:44:06 -0500
Subject: [Slony1-general] [slony-general] error adding a table
In-Reply-To: <4BCF892C.3070509@Yahoo.com>
References: <m2p3073cc9b1004202335hd339f0a3w2e81861bb59a381d@mail.gmail.com> 
	<4BCEFC0A.3010303@ca.afilias.info>
	<w2o3073cc9b1004211606w5a84eb07mc2caf8b7bbccb0d3@mail.gmail.com>
	<4BCF892C.3070509@Yahoo.com>
Message-ID: <n2p3073cc9b1004211644j7a327504i19f93f02dfaeb893@mail.gmail.com>

On Wed, Apr 21, 2010 at 6:24 PM, Jan Wieck <JanWieck at yahoo.com> wrote:
> On 4/21/2010 7:06 PM, Jaime Casanova wrote:
>>
>>
>> any ideas on what look for the sl_log_x problem?
>
> What does sl_status look like on the origin?
>
>

mic=# select * from _sncp_incop_cluster.sl_status ;
-[ RECORD 1 ]---------------+---------------------------
st_origin                         | 1
st_received                     | 2
st_last_event                  | 843427
st_last_event_ts              | 2010-04-21 18:42:18.671167
st_last_received              | 786330
st_last_received_ts          | 2010-04-20 16:04:58.747498
st_last_received_event_ts | 2010-04-20 02:26:44.601898
st_lag_num_events          | 57097
st_lag_time                     | 1 day 16:15:35.203507

-- 
Atentamente,
Jaime Casanova
Soporte y capacitaci?n de PostgreSQL
Asesor?a y desarrollo de sistemas
Guayaquil - Ecuador
Cel. +59387171157

From JanWieck at Yahoo.com  Wed Apr 21 16:52:54 2010
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Wed, 21 Apr 2010 19:52:54 -0400
Subject: [Slony1-general] [slony-general] error adding a table
In-Reply-To: <n2p3073cc9b1004211644j7a327504i19f93f02dfaeb893@mail.gmail.com>
References: <m2p3073cc9b1004202335hd339f0a3w2e81861bb59a381d@mail.gmail.com>
	<4BCEFC0A.3010303@ca.afilias.info>
	<w2o3073cc9b1004211606w5a84eb07mc2caf8b7bbccb0d3@mail.gmail.com>
	<4BCF892C.3070509@Yahoo.com>
	<n2p3073cc9b1004211644j7a327504i19f93f02dfaeb893@mail.gmail.com>
Message-ID: <4BCF8FD6.4050203@Yahoo.com>

On 4/21/2010 7:44 PM, Jaime Casanova wrote:
> On Wed, Apr 21, 2010 at 6:24 PM, Jan Wieck <JanWieck at yahoo.com> wrote:
>> On 4/21/2010 7:06 PM, Jaime Casanova wrote:
>>>
>>>
>>> any ideas on what look for the sl_log_x problem?
>>
>> What does sl_status look like on the origin?
>>
>>
> 
> mic=# select * from _sncp_incop_cluster.sl_status ;
> -[ RECORD 1 ]---------------+---------------------------
> st_origin                         | 1
> st_received                     | 2
> st_last_event                  | 843427
> st_last_event_ts              | 2010-04-21 18:42:18.671167
> st_last_received              | 786330
> st_last_received_ts          | 2010-04-20 16:04:58.747498
> st_last_received_event_ts | 2010-04-20 02:26:44.601898
> st_lag_num_events          | 57097
> st_lag_time                     | 1 day 16:15:35.203507
> 

So who did the manual delete from sl_event on node 2?


Jan

-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin


From scott.marlowe at gmail.com  Wed Apr 21 19:23:45 2010
From: scott.marlowe at gmail.com (Scott Marlowe)
Date: Wed, 21 Apr 2010 20:23:45 -0600
Subject: [Slony1-general] logswitch_finish( )
In-Reply-To: <87sk6oy2i5.fsf@ca.afilias.info>
References: <v2xdcc563d11004211138l16b7d210v5b0268d238ddfd6@mail.gmail.com>
	<4BCF5A63.80504@Yahoo.com>
	<h2gdcc563d11004211313l8018a873k886d6bc5a1c94e4b@mail.gmail.com>
	<87sk6oy2i5.fsf@ca.afilias.info>
Message-ID: <x2jdcc563d11004211923i25ffb206t92017f59e685beef@mail.gmail.com>

On Wed, Apr 21, 2010 at 2:28 PM, Christopher Browne
<cbbrowne at ca.afilias.info> wrote:
> Scott Marlowe <scott.marlowe at gmail.com> writes:
>> On Wed, Apr 21, 2010 at 2:04 PM, Jan Wieck <JanWieck at yahoo.com> wrote:
>>> On 4/21/2010 2:38 PM, Scott Marlowe wrote:
>>>>
>>>> So, I had a query that blocked all updates going out of the sl_log_2
>>>> table, and it's 13Gig. ?sl_log_1 is empty.
>>>>
>>>> IS the logswitch_finish() command an acceptable method for forcing the
>>>> replication engine to switch from 2 to 1 so I can vacuum full 2?
>>>
>>> It is completely safe to call logswitch_finish() at any time. It may or may
>>> not actually do something.
>>>
>>> In your case, I presume the value of sl_log_status is 2. This means it is
>>> waiting for sl_log_2 to become empty and once that happens, it will truncate
>>> it and set sl_log_status to 0.
>>
>> So, if I let the system just sit quiescent for a while, it should
>> straighten things out?
>
> The other thing that could be useful to run would be the stored function
> cleanupevent().
>
> That clears out old events that have been confirmed by all nodes in the
> cluster, which is the pre-requisite for logswitch_finish() doing
> anything useful.
>
> It would probably be a useful idea for cleanupevent() to log a little
> bit of information about how much work it does (e.g. - how many tuples
> it trims out of sl_confirm, sl_event, sl_seqlog).

Thanks Chris, Jan, everybody else who posted.

From jcasanov at systemguards.com.ec  Wed Apr 21 21:14:44 2010
From: jcasanov at systemguards.com.ec (Jaime Casanova)
Date: Wed, 21 Apr 2010 23:14:44 -0500
Subject: [Slony1-general] [slony-general] error adding a table
In-Reply-To: <4BCF8FD6.4050203@Yahoo.com>
References: <m2p3073cc9b1004202335hd339f0a3w2e81861bb59a381d@mail.gmail.com> 
	<4BCEFC0A.3010303@ca.afilias.info>
	<w2o3073cc9b1004211606w5a84eb07mc2caf8b7bbccb0d3@mail.gmail.com>
	<4BCF892C.3070509@Yahoo.com>
	<n2p3073cc9b1004211644j7a327504i19f93f02dfaeb893@mail.gmail.com>
	<4BCF8FD6.4050203@Yahoo.com>
Message-ID: <i2w3073cc9b1004212114rd0752391l787a507654da219b@mail.gmail.com>

On Wed, Apr 21, 2010 at 6:52 PM, Jan Wieck <JanWieck at yahoo.com> wrote:
> On 4/21/2010 7:44 PM, Jaime Casanova wrote:
>>
>> On Wed, Apr 21, 2010 at 6:24 PM, Jan Wieck <JanWieck at yahoo.com> wrote:
>>>
>>> On 4/21/2010 7:06 PM, Jaime Casanova wrote:
>>>>
>>>>
>>>> any ideas on what look for the sl_log_x problem?
>>>
>>> What does sl_status look like on the origin?
>>>
>>>
>>
>> mic=# select * from _sncp_incop_cluster.sl_status ;
>> -[ RECORD 1 ]---------------+---------------------------
>> st_origin ? ? ? ? ? ? ? ? ? ? ? ? | 1
>> st_received ? ? ? ? ? ? ? ? ? ? | 2
>> st_last_event ? ? ? ? ? ? ? ? ?| 843427
>> st_last_event_ts ? ? ? ? ? ? ?| 2010-04-21 18:42:18.671167
>> st_last_received ? ? ? ? ? ? ?| 786330
>> st_last_received_ts ? ? ? ? ?| 2010-04-20 16:04:58.747498
>> st_last_received_event_ts | 2010-04-20 02:26:44.601898
>> st_lag_num_events ? ? ? ? ?| 57097
>> st_lag_time ? ? ? ? ? ? ? ? ? ? | 1 day 16:15:35.203507
>>
>
> So who did the manual delete from sl_event on node 2?
>

no one i'm aware of, i looked in .psql_history and doesn't find
anything about sl_event either.
what i remember i did (and sorry for no remember this before, don't
know if it's important) was that the first time the subscribe didn't
work it first says that the table didn't exist... and that was because
the oid of the table in tab_reloid in node 2 was wrong (the oid didn't
exist, i guess it was the oid of the table before i drop it and
recreated it with the missing field) so i... ehhh... updated
sl_table.tab_reloid to the right oid...

so the steps were something like:
- in node 1
   - slonik set drop table in node1
   - rename table, create a new one, migrate and drop old table

in node 2
   - drop table, recreate it using pg_dump -t -h ip_origin

in node 1
   - slonik create set
   - slonik set add table
   - slonik subscribe set

error

in node 1
   - slonik unsubscribe set

in node 2
   - update bad oid

when i try to subscribe again, there was the error about the table
already existing in sl_table (which i know isn't true)

-- 
Atentamente,
Jaime Casanova
Soporte y capacitaci?n de PostgreSQL
Asesor?a y desarrollo de sistemas
Guayaquil - Ecuador
Cel. +59387171157

From jcasanov at systemguards.com.ec  Wed Apr 21 21:35:43 2010
From: jcasanov at systemguards.com.ec (Jaime Casanova)
Date: Wed, 21 Apr 2010 23:35:43 -0500
Subject: [Slony1-general] [slony-general] error adding a table
In-Reply-To: <i2w3073cc9b1004212114rd0752391l787a507654da219b@mail.gmail.com>
References: <m2p3073cc9b1004202335hd339f0a3w2e81861bb59a381d@mail.gmail.com> 
	<4BCEFC0A.3010303@ca.afilias.info>
	<w2o3073cc9b1004211606w5a84eb07mc2caf8b7bbccb0d3@mail.gmail.com>
	<4BCF892C.3070509@Yahoo.com>
	<n2p3073cc9b1004211644j7a327504i19f93f02dfaeb893@mail.gmail.com>
	<4BCF8FD6.4050203@Yahoo.com>
	<i2w3073cc9b1004212114rd0752391l787a507654da219b@mail.gmail.com>
Message-ID: <n2v3073cc9b1004212135nbd342353y332fe8036f645dc4@mail.gmail.com>

On Wed, Apr 21, 2010 at 11:14 PM, Jaime Casanova
<jcasanov at systemguards.com.ec> wrote:
> On Wed, Apr 21, 2010 at 6:52 PM, Jan Wieck <JanWieck at yahoo.com> wrote:
>> On 4/21/2010 7:44 PM, Jaime Casanova wrote:
>>>
>>> On Wed, Apr 21, 2010 at 6:24 PM, Jan Wieck <JanWieck at yahoo.com> wrote:
>>>>
>>>> On 4/21/2010 7:06 PM, Jaime Casanova wrote:
>>>>>
>>>>>
>>>>> any ideas on what look for the sl_log_x problem?
>>>>
>>>> What does sl_status look like on the origin?
>>>>
>>>>
>>>
>>> mic=# select * from _sncp_incop_cluster.sl_status ;
>>> -[ RECORD 1 ]---------------+---------------------------
>>> st_origin ? ? ? ? ? ? ? ? ? ? ? ? | 1
>>> st_received ? ? ? ? ? ? ? ? ? ? | 2
>>> st_last_event ? ? ? ? ? ? ? ? ?| 843427
>>> st_last_event_ts ? ? ? ? ? ? ?| 2010-04-21 18:42:18.671167
>>> st_last_received ? ? ? ? ? ? ?| 786330
>>> st_last_received_ts ? ? ? ? ?| 2010-04-20 16:04:58.747498
>>> st_last_received_event_ts | 2010-04-20 02:26:44.601898
>>> st_lag_num_events ? ? ? ? ?| 57097
>>> st_lag_time ? ? ? ? ? ? ? ? ? ? | 1 day 16:15:35.203507
>>>
>>
>> So who did the manual delete from sl_event on node 2?
>>
>

ah! and this is the last received event (it is in both nodes)

mic=# select * from _sncp_incop_cluster.sl_event where ev_seqno = 786330;
-[ RECORD 1 ]+---------------------------
ev_origin    | 1
ev_seqno     | 786330
ev_timestamp | 2010-04-20 02:26:44.601898
ev_minxid    | 20748544
ev_maxxid    | 20748544
ev_xip       |
ev_type      | SUBSCRIBE_SET
ev_data1     | 999
ev_data2     | 1
ev_data3     | 2
ev_data4     | t
ev_data5     |
ev_data6     |
ev_data7     |
ev_data8     |


and this one the next (this is only on node 1)

mic=#  select * from _sncp_incop_cluster.sl_event where ev_seqno = 786331;
-[ RECORD 1 ]+---------------------------
ev_origin    | 1
ev_seqno     | 786331
ev_timestamp | 2010-04-20 02:26:44.601898
ev_minxid    | 20748544
ev_maxxid    | 20748544
ev_xip       |
ev_type      | ENABLE_SUBSCRIPTION
ev_data1     | 999
ev_data2     | 1
ev_data3     | 2
ev_data4     | t
ev_data5     |
ev_data6     |
ev_data7     |
ev_data8     |

-- 
Atentamente,
Jaime Casanova
Soporte y capacitaci?n de PostgreSQL
Asesor?a y desarrollo de sistemas
Guayaquil - Ecuador
Cel. +59387171157

From scott.marlowe at gmail.com  Wed Apr 21 22:42:55 2010
From: scott.marlowe at gmail.com (Scott Marlowe)
Date: Wed, 21 Apr 2010 23:42:55 -0600
Subject: [Slony1-general] logswitch_finish( )
In-Reply-To: <x2jdcc563d11004211923i25ffb206t92017f59e685beef@mail.gmail.com>
References: <v2xdcc563d11004211138l16b7d210v5b0268d238ddfd6@mail.gmail.com>
	<4BCF5A63.80504@Yahoo.com>
	<h2gdcc563d11004211313l8018a873k886d6bc5a1c94e4b@mail.gmail.com>
	<87sk6oy2i5.fsf@ca.afilias.info>
	<x2jdcc563d11004211923i25ffb206t92017f59e685beef@mail.gmail.com>
Message-ID: <x2xdcc563d11004212242u360bf62fp8bd13fc537013d6e@mail.gmail.com>

On Wed, Apr 21, 2010 at 8:23 PM, Scott Marlowe <scott.marlowe at gmail.com> wrote:
> On Wed, Apr 21, 2010 at 2:28 PM, Christopher Browne
> <cbbrowne at ca.afilias.info> wrote:
>> Scott Marlowe <scott.marlowe at gmail.com> writes:
>>> On Wed, Apr 21, 2010 at 2:04 PM, Jan Wieck <JanWieck at yahoo.com> wrote:
>>>> On 4/21/2010 2:38 PM, Scott Marlowe wrote:
>>>>>
>>>>> So, I had a query that blocked all updates going out of the sl_log_2
>>>>> table, and it's 13Gig. ?sl_log_1 is empty.
>>>>>
>>>>> IS the logswitch_finish() command an acceptable method for forcing the
>>>>> replication engine to switch from 2 to 1 so I can vacuum full 2?
>>>>
>>>> It is completely safe to call logswitch_finish() at any time. It may or may
>>>> not actually do something.
>>>>
>>>> In your case, I presume the value of sl_log_status is 2. This means it is
>>>> waiting for sl_log_2 to become empty and once that happens, it will truncate
>>>> it and set sl_log_status to 0.
>>>
>>> So, if I let the system just sit quiescent for a while, it should
>>> straighten things out?
>>
>> The other thing that could be useful to run would be the stored function
>> cleanupevent().
>>
>> That clears out old events that have been confirmed by all nodes in the
>> cluster, which is the pre-requisite for logswitch_finish() doing
>> anything useful.
>>
>> It would probably be a useful idea for cleanupevent() to log a little
>> bit of information about how much work it does (e.g. - how many tuples
>> it trims out of sl_confirm, sl_event, sl_seqlog).

So, after the load fell off this evening, slony caught up and both log
tables showed as being small, in the < 100 MB range all the time.

From JanWieck at Yahoo.com  Wed Apr 21 20:30:37 2010
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Wed, 21 Apr 2010 23:30:37 -0400
Subject: [Slony1-general] [slony-general] error adding a table
In-Reply-To: <n2v3073cc9b1004212135nbd342353y332fe8036f645dc4@mail.gmail.com>
References: <m2p3073cc9b1004202335hd339f0a3w2e81861bb59a381d@mail.gmail.com>
	<4BCEFC0A.3010303@ca.afilias.info>	<w2o3073cc9b1004211606w5a84eb07mc2caf8b7bbccb0d3@mail.gmail.com>	<4BCF892C.3070509@Yahoo.com>	<n2p3073cc9b1004211644j7a327504i19f93f02dfaeb893@mail.gmail.com>	<4BCF8FD6.4050203@Yahoo.com>	<i2w3073cc9b1004212114rd0752391l787a507654da219b@mail.gmail.com>
	<n2v3073cc9b1004212135nbd342353y332fe8036f645dc4@mail.gmail.com>
Message-ID: <4BCFC2DD.8010607@Yahoo.com>

On 4/22/2010 12:35 AM, Jaime Casanova wrote:
> On Wed, Apr 21, 2010 at 11:14 PM, Jaime Casanova
> <jcasanov at systemguards.com.ec> wrote:
>> On Wed, Apr 21, 2010 at 6:52 PM, Jan Wieck <JanWieck at yahoo.com> wrote:
>>> On 4/21/2010 7:44 PM, Jaime Casanova wrote:
>>>>
>>>> On Wed, Apr 21, 2010 at 6:24 PM, Jan Wieck <JanWieck at yahoo.com> wrote:
>>>>>
>>>>> On 4/21/2010 7:06 PM, Jaime Casanova wrote:
>>>>>>
>>>>>>
>>>>>> any ideas on what look for the sl_log_x problem?
>>>>>
>>>>> What does sl_status look like on the origin?
>>>>>
>>>>>
>>>>
>>>> mic=# select * from _sncp_incop_cluster.sl_status ;
>>>> -[ RECORD 1 ]---------------+---------------------------
>>>> st_origin                         | 1
>>>> st_received                     | 2
>>>> st_last_event                  | 843427
>>>> st_last_event_ts              | 2010-04-21 18:42:18.671167
>>>> st_last_received              | 786330
>>>> st_last_received_ts          | 2010-04-20 16:04:58.747498
>>>> st_last_received_event_ts | 2010-04-20 02:26:44.601898
>>>> st_lag_num_events          | 57097
>>>> st_lag_time                     | 1 day 16:15:35.203507
>>>>
>>>
>>> So who did the manual delete from sl_event on node 2?
>>>
>>
> 
> ah! and this is the last received event (it is in both nodes)
> 
> mic=# select * from _sncp_incop_cluster.sl_event where ev_seqno = 786330;
> -[ RECORD 1 ]+---------------------------
> ev_origin    | 1
> ev_seqno     | 786330
> ev_timestamp | 2010-04-20 02:26:44.601898
> ev_minxid    | 20748544
> ev_maxxid    | 20748544
> ev_xip       |
> ev_type      | SUBSCRIBE_SET
> ev_data1     | 999
> ev_data2     | 1
> ev_data3     | 2
> ev_data4     | t
> ev_data5     |
> ev_data6     |
> ev_data7     |
> ev_data8     |
> 
> 
> and this one the next (this is only on node 1)
> 
> mic=#  select * from _sncp_incop_cluster.sl_event where ev_seqno = 786331;
> -[ RECORD 1 ]+---------------------------
> ev_origin    | 1
> ev_seqno     | 786331
> ev_timestamp | 2010-04-20 02:26:44.601898
> ev_minxid    | 20748544
> ev_maxxid    | 20748544
> ev_xip       |
> ev_type      | ENABLE_SUBSCRIPTION
> ev_data1     | 999
> ev_data2     | 1
> ev_data3     | 2
> ev_data4     | t
> ev_data5     |
> ev_data6     |
> ev_data7     |
> ev_data8     |
> 

And this event cannot be processed on the subscriber?

Can I get a dump of the _sncp_incop_cluster schema on node 2?


Jan

-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin


From JanWieck at Yahoo.com  Thu Apr 22 17:26:28 2010
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Thu, 22 Apr 2010 20:26:28 -0400
Subject: [Slony1-general] [slony-general] error adding a table
In-Reply-To: <x2u3073cc9b1004221633k61d07d2at9dc9bc58002d5cc8@mail.gmail.com>
References: <m2p3073cc9b1004202335hd339f0a3w2e81861bb59a381d@mail.gmail.com>
	<w2o3073cc9b1004211606w5a84eb07mc2caf8b7bbccb0d3@mail.gmail.com>
	<4BCF892C.3070509@Yahoo.com>
	<n2p3073cc9b1004211644j7a327504i19f93f02dfaeb893@mail.gmail.com>
	<4BCF8FD6.4050203@Yahoo.com>
	<i2w3073cc9b1004212114rd0752391l787a507654da219b@mail.gmail.com>
	<n2v3073cc9b1004212135nbd342353y332fe8036f645dc4@mail.gmail.com>
	<4BCFC2DD.8010607@Yahoo.com>
	<h2r3073cc9b1004220706n6e0b62b8m62942d62a33f3ec5@mail.gmail.com>
	<4BCFE56D.4070002@Yahoo.com>
	<x2u3073cc9b1004221633k61d07d2at9dc9bc58002d5cc8@mail.gmail.com>
Message-ID: <4BD0E934.2020609@Yahoo.com>

On 4/22/2010 7:33 PM, Jaime Casanova wrote:
> On Thu, Apr 22, 2010 at 12:58 AM, Jan Wieck <JanWieck at yahoo.com> wrote:
 >
>> You may be able to fix things by reinserting that sl_subscribe row with
>> sub_active = false, then restart the slon for node 2 and see how far that
>> gets you.
>>
>
> yes, that makes receiver start accepting events again... it's trying
> to get upto date now...
> thanx for your help...

Jaime was so kind to provide me with a dump of the slony schema of node 
2 and we were able to completely figure out what happened.

The whole mess was started by using direct DDL against a subscriber 
under Slony 1.2.x. The attempted fix for this was to drop the table from 
the replication set via SET DROP TABLE, fix the table definitions and 
resubscribe it via a temp set. The subscription failed because of an 
inconsistency between the system catalog and the slony catalog on the 
subscriber.

The exact steps after that are not 100% clear to me yet, but I think I 
understand them good enough to be able to reproduce them later down the 
road. The SUBSCRIBE SET is actually a two step operation. In the first 
step, the SUBSCRIBE_SET event causes the new subscriber and everyone in 
the path to create the sl_subscribe row, which causes all data 
forwarders to keep replication data until the new subscriber has 
confirmed it. The second step is an internal event, ENABLE_SUBSCRIPTION, 
that is generated automatically by the origin of the set and that kicks 
off the actual copy_set() call.

That copy_set() failed due to the catalog inconsistency. What Jaime 
tried then was an UNSUBSCRIBE SET, which slonik issued against the half 
subscribed node 2, deleting the sl_subscribe row. The code in copy_set() 
doesn't use the parameters from the event, but expects the in memory 
runtime configuration data to know the data provider for the set. Since 
the sl_subscribe row is gone now, that information is missing and the -1 
is the default value for a set, the node isn't subscribed to.

I don't know exactly what the right fix for this bug is. My first gut 
feeling is to ignore the ENABLE_SUBSCRIPTION and generate another 
UNSUBSCRIBE_SET event just to clear out any sl_subscribe row existing in 
the cluster. Since I am in Toronto right now, I can discuss this with 
Steve Singer tomorrow morning.

Thank you Jaime. Your patience on this matter helped to track down a 
very nasty bug that apparently had been lingering in the system for a 
long time.


Jan

-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin


From ssinger at ca.afilias.info  Fri Apr 23 08:40:10 2010
From: ssinger at ca.afilias.info (Steve Singer)
Date: Fri, 23 Apr 2010 11:40:10 -0400
Subject: [Slony1-general] git ?
Message-ID: <4BD1BF5A.9060406@ca.afilias.info>

How do people feel about moving the slony source tree to git?


-- 
Steve Singer
Afilias Canada
Data Services Developer
416-673-1142

From david at fetter.org  Fri Apr 23 09:06:54 2010
From: david at fetter.org (David Fetter)
Date: Fri, 23 Apr 2010 09:06:54 -0700
Subject: [Slony1-general] [rangerrick@befunk.com: slony patch for osx]
Message-ID: <20100423160654.GA18954@fetter.org>

Folks,

Please find enclosed a patch to get Slony 2.0.3 to compile on OS/X :)

Cheers,
David.
-- 
David Fetter <david at fetter.org> http://fetter.org/
Phone: +1 415 235 3778  AIM: dfetter666  Yahoo!: dfetter
Skype: davidfetter      XMPP: david.fetter at gmail.com
iCal: webcal://www.tripit.com/feed/ical/people/david74/tripit.ics

Remember to vote!
Consider donating to Postgres: http://www.postgresql.org/about/donate
-------------- next part --------------
An embedded message was scrubbed...
From: Benjamin Reed <rangerrick at befunk.com>
Subject: slony patch for osx
Date: Fri, 23 Apr 2010 12:01:11 -0400
Size: 6059
Url: http://lists.slony.info/pipermail/slony1-general/attachments/20100423/1febb243/attachment.eml 

From cbbrowne at ca.afilias.info  Fri Apr 23 09:59:17 2010
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri, 23 Apr 2010 12:59:17 -0400
Subject: [Slony1-general] git ?
In-Reply-To: <4BD1BF5A.9060406@ca.afilias.info> (Steve Singer's message of
	"Fri, 23 Apr 2010 11:40:10 -0400")
References: <4BD1BF5A.9060406@ca.afilias.info>
Message-ID: <87ljcem7fe.fsf@ca.afilias.info>

Steve Singer <ssinger at ca.afilias.info> writes:
> How do people feel about moving the slony source tree to git?

For my part, I'd think it a fine idea.

-> There's a bit of "infrastructure fragility" right now in that it's a
   more manual process (for me) than I'm happy with to ensure there are
   distributed backups of CVS.  Git would enable just about anyone to
   readily create complete replicas in any number of locations.

-> Git would enable using local branches to do development even of
   relatively minor patches, then merging those that are successful into
   stable branches, which is certainly not something that is well
   supported by CVS.

I'd think a "short list" of plausible SCMs would consist of subversion,
git, mercurial, darcs.  Subversion *wouldn't* help with the "distributed
backups" aspect, which goes a long ways towards disqualifying it, to my
mind.

With git being under serious consideration for PostgreSQL itself, it
seems to me that there would need to be mighty compelling arguments in
favor of mercurial or darcs (which, it should be observed, haven't
emerged in the PostgreSQL context!) to do otherwise.

I'd not want to rush/railroad the matter, but it certainly gets a "+1
from me."
-- 
let name="cbbrowne" and tld="ca.afilias.info" in name ^ "@" ^ tld;;
Christopher Browne
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"

From david at fetter.org  Fri Apr 23 10:17:17 2010
From: david at fetter.org (David Fetter)
Date: Fri, 23 Apr 2010 10:17:17 -0700
Subject: [Slony1-general] git ?
In-Reply-To: <4BD1BF5A.9060406@ca.afilias.info>
References: <4BD1BF5A.9060406@ca.afilias.info>
Message-ID: <20100423171717.GB18954@fetter.org>

On Fri, Apr 23, 2010 at 11:40:10AM -0400, Steve Singer wrote:
> How do people feel about moving the slony source tree to git?

+1! :)

Cheers,
David.
-- 
David Fetter <david at fetter.org> http://fetter.org/
Phone: +1 415 235 3778  AIM: dfetter666  Yahoo!: dfetter
Skype: davidfetter      XMPP: david.fetter at gmail.com
iCal: webcal://www.tripit.com/feed/ical/people/david74/tripit.ics

Remember to vote!
Consider donating to Postgres: http://www.postgresql.org/about/donate

From msquires at whitepages.com  Fri Apr 23 10:18:51 2010
From: msquires at whitepages.com (Michael Squires)
Date: Fri, 23 Apr 2010 10:18:51 -0700
Subject: [Slony1-general] git ?
In-Reply-To: <87ljcem7fe.fsf@ca.afilias.info>
References: <4BD1BF5A.9060406@ca.afilias.info> <87ljcem7fe.fsf@ca.afilias.info>
Message-ID: <4BD1D67B.7080304@whitepages.com>

Another "yes" vote here.

Michael


From vivek at khera.org  Fri Apr 23 11:29:58 2010
From: vivek at khera.org (Vick Khera)
Date: Fri, 23 Apr 2010 14:29:58 -0400
Subject: [Slony1-general] git ?
In-Reply-To: <87ljcem7fe.fsf@ca.afilias.info>
References: <4BD1BF5A.9060406@ca.afilias.info> <87ljcem7fe.fsf@ca.afilias.info>
Message-ID: <g2t2968dfd61004231129sd5ce78d3i4c672506dc9592e5@mail.gmail.com>

On Fri, Apr 23, 2010 at 12:59 PM, Christopher Browne
<cbbrowne at ca.afilias.info> wrote:
> With git being under serious consideration for PostgreSQL itself, it
> seems to me that there would need to be mighty compelling arguments in
> favor of mercurial or darcs (which, it should be observed, haven't
> emerged in the PostgreSQL context!) to do otherwise.

The world seems to be converging on the pair of Hg and Git, so it
makes sense to be one of these, and if the Pg project chooses git, it
is just that much less work for developers to learn new SCMs.  So my
vote goes with whatever the main Pg project chooses, as long as it is
one of these two :-)  (Not that I've used either extensively -- most
of my experience is with svn).

From JanWieck at Yahoo.com  Fri Apr 23 10:20:08 2010
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Fri, 23 Apr 2010 13:20:08 -0400
Subject: [Slony1-general] git ?
In-Reply-To: <4BD1BF5A.9060406@ca.afilias.info>
References: <4BD1BF5A.9060406@ca.afilias.info>
Message-ID: <4BD1D6C8.4080005@Yahoo.com>

On 4/23/2010 11:40 AM, Steve Singer wrote:
> How do people feel about moving the slony source tree to git?

No objections.


Jan

-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin

From devrim at gunduz.org  Fri Apr 23 23:55:29 2010
From: devrim at gunduz.org (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Sat, 24 Apr 2010 09:55:29 +0300
Subject: [Slony1-general] git ?
In-Reply-To: <4BD1BF5A.9060406@ca.afilias.info>
References: <4BD1BF5A.9060406@ca.afilias.info>
Message-ID: <1272092129.21340.21.camel@hp-laptop2.gunduz.org>

On Fri, 2010-04-23 at 11:40 -0400, Steve Singer wrote:
> How do people feel about moving the slony source tree to git?

No objections. It will be a chance for me to learn git.
-- 
Devrim G?ND?Z
PostgreSQL Dan??man?/Consultant, Red Hat Certified Engineer
PostgreSQL RPM Repository: http://yum.pgrpms.org
Community: devrim~PostgreSQL.org, devrim.gunduz~linux.org.tr
http://www.gunduz.org  Twitter: http://twitter.com/devrimgunduz
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20100424/722cad17/attachment.pgp 

From stuart at stuartbishop.net  Sat Apr 24 17:23:00 2010
From: stuart at stuartbishop.net (Stuart Bishop)
Date: Sun, 25 Apr 2010 10:23:00 +1000
Subject: [Slony1-general] git ?
In-Reply-To: <87ljcem7fe.fsf@ca.afilias.info>
References: <4BD1BF5A.9060406@ca.afilias.info> <87ljcem7fe.fsf@ca.afilias.info>
Message-ID: <y2q6bc73d4c1004241723gcaf427dcvf73519cb96c48eeb@mail.gmail.com>

On Sat, Apr 24, 2010 at 2:59 AM, Christopher Browne
<cbbrowne at ca.afilias.info> wrote:

> I'd think a "short list" of plausible SCMs would consist of subversion,
> git, mercurial, darcs. ?Subversion *wouldn't* help with the "distributed
> backups" aspect, which goes a long ways towards disqualifying it, to my
> mind.

And GNU Bazaar of course. If anybody wants a play, there is already an
import available at
https://code.launchpad.net/~vcs-imports/slony-i/trunk. Just install a
modern version of Bazaar and 'bzr branch lp:slony-i' to get started. I
recommend 2.1. http://bazaar-vcs.org for more information, including
the excellent documentation at
http://doc.bazaar.canonical.com/bzr.2.1/en/.

I'm available for questions, but I'm not going to be a committer in
the foreseeable future and will leave the discussion to those who are
going to use the VCS.


-- 
Stuart Bishop <stuart at stuartbishop.net>
http://www.stuartbishop.net/

From jcasanov at systemguards.com.ec  Mon Apr 26 09:26:57 2010
From: jcasanov at systemguards.com.ec (Jaime Casanova)
Date: Mon, 26 Apr 2010 11:26:57 -0500
Subject: [Slony1-general] [slony-general] changing the PK of a replicated
	table
Message-ID: <p2o3073cc9b1004260926gae3580b4j4780f12bdc34a877@mail.gmail.com>

Hi,

Seems like a customer wants to change the PK of a replicated table...
and from what i understood in the docs we shouldn't be using EXECUTE
SCRIPT for that... i'm right?
so what are my options (besides to blame the customer for doing that)?
set drop table, change, readd it using a merge?

-- 
Atentamente,
Jaime Casanova
Soporte y capacitaci?n de PostgreSQL
Asesor?a y desarrollo de sistemas
Guayaquil - Ecuador
Cel. +59387171157

From melvin6925 at yahoo.com  Mon Apr 26 09:46:53 2010
From: melvin6925 at yahoo.com (Melvin Davidson)
Date: Mon, 26 Apr 2010 09:46:53 -0700 (PDT)
Subject: [Slony1-general] [slony-general] changing the PK of a
	replicated table
In-Reply-To: <p2o3073cc9b1004260926gae3580b4j4780f12bdc34a877@mail.gmail.com>
Message-ID: <314043.52289.qm@web53002.mail.re2.yahoo.com>

>Seems like a customer wants to change the PK of a replicated table...
>and
 from what i understood in the docs we shouldn't be using EXECUTE
>SCRIPT
 for that... i'm right?

Wrong! You do want to use EXECUTE SCRIPT. That insures the changed is propagated on all slaves at the same time. Just keep in mind that EXECUTE SCRIPT will lock all tables in a set. The big question is why is the primary key changing? If it's because the customer mistakenly wants to change the default sort order, or lookup, then it is best to just create another index on the tables.

Melvin Davidson 
From: Jaime Casanova <jcasanov at systemguards.com.ec>
Subject: [Slony1-general] [slony-general] changing the PK of a replicated table
To: "slony" <slony1-general at lists.slony.info>
Date: Monday, April 26, 2010, 11:26 AM

Hi,

Seems like a customer wants to change the PK of a replicated table...
and from what i understood in the docs we shouldn't be using EXECUTE
SCRIPT for that... i'm right?
so what are my options (besides to blame the customer for doing that)?
set drop table, change, readd it using a merge?

-- 
Atentamente,
Jaime Casanova
Soporte y capacitaci?n de PostgreSQL
Asesor?a y desarrollo de sistemas
Guayaquil - Ecuador
Cel. +59387171157
_______________________________________________
Slony1-general mailing list
Slony1-general at lists.slony.info
http://lists.slony.info/mailman/listinfo/slony1-general



      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20100426/dcd5e13b/attachment.htm 

From jcasanov at systemguards.com.ec  Mon Apr 26 10:29:40 2010
From: jcasanov at systemguards.com.ec (Jaime Casanova)
Date: Mon, 26 Apr 2010 12:29:40 -0500
Subject: [Slony1-general] [slony-general] changing the PK of a
	replicated table
In-Reply-To: <314043.52289.qm@web53002.mail.re2.yahoo.com>
References: <p2o3073cc9b1004260926gae3580b4j4780f12bdc34a877@mail.gmail.com> 
	<314043.52289.qm@web53002.mail.re2.yahoo.com>
Message-ID: <s2t3073cc9b1004261029t136affa1kc7653fb9ca89a4b0@mail.gmail.com>

On Mon, Apr 26, 2010 at 11:46 AM, Melvin Davidson <melvin6925 at yahoo.com> wrote:
>
> >Seems like a customer wants to change the PK of a replicated table...
> >and from what i understood in the docs we shouldn't be using EXECUTE
> >SCRIPT for that... i'm right?
>
> Wrong! You do want to use EXECUTE SCRIPT. That insures the changed is propagated on all slaves at the same time. Just
> keep in mind that EXECUTE SCRIPT will lock all tables in a set.

Ah! [re reading http://www.slony.info/documentation/ddlchanges.html]

in 17.1. Changes that you might not want to process using EXECUTE SCRIPT, says:
"""
Slony-I stores the "primary index" name in sl_table, and uses that
name to control what columns are considered the "key columns" when the
log trigger is attached. It would be plausible to drop that index and
replace it with another primary key candidate, but changing the name
of the primary key candidate would break things.
"""

which clearly states that i'm wrong, what i shouldn't be doing is
changing the name of the index i'm using for implementing the PK
constraint, so i should put the name of the old index to the new one
for this to work?


> The big question is why is the primary key changing? If it's because the customer mistakenly wants to change the default sort
> order, or lookup, then it is best to just create another index on the tables.
>

i'm still in the process of forcing them to tell me what they want to do...
but i suspect that what is happening is that they're getting an error
because they try to insert a null in the PK (they have a lot of those,
while the pk is a sequence of numbers they didn't use serial when
created it) what they want to do now, i guess, is to create a new pk
that is a serial and allow the old pk column to accept nulls so if
they send a value or a null it's meaningless (actually that is what i
see in the script they want to execute)...
if that is true then a better solution is 1) fix the application
(which probably they won't) or 2) create a new sequence for the pk and
a before trigger that force the value of the pk to nextval(of the
sequence)

i know 1) is the best and 2) a kluge but...

--
Atentamente,
Jaime Casanova
Soporte y capacitaci?n de PostgreSQL
Asesor?a y desarrollo de sistemas
Guayaquil - Ecuador
Cel. +59387171157

From melvin6925 at yahoo.com  Mon Apr 26 11:16:31 2010
From: melvin6925 at yahoo.com (Melvin Davidson)
Date: Mon, 26 Apr 2010 11:16:31 -0700 (PDT)
Subject: [Slony1-general] [slony-general] changing the PK of a
	replicated table
In-Reply-To: <s2t3073cc9b1004261029t136affa1kc7653fb9ca89a4b0@mail.gmail.com>
Message-ID: <160598.588.qm@web53008.mail.re2.yahoo.com>

>i suspect that what is happening is that they're getting an error

>because
 they try to insert a null in the PK (they have a lot of those,

>while
 the pk is a sequence of numbers they didn't use serial when

>created 
it) what they want to do now, i guess, is to create a new pk

>that is a
 serial and allow the old pk column to accept nulls so if

>they send a
 value or a null it's meaningless (actually that is what i

>see in the
 script they want to execute)...


Well, if the "name" of the primary key will not change, then EXECUTE 
SCRIPT would work. However, based on the latest information you 
provided. You might want to consider:

A. SET 
DROP
 TABLE on the table with the pkey change.

B. Do a manual DDL to change the pkey on all nodes. (Hopefully not too 
many)

C. Create a new set with the table and then a MERGE SET to add the table
 back into replication.



Of course, another factor would be the size of the table and how long it
 would take to re-subscribe.


Melvin Davidson 




      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20100426/1d7fdf91/attachment.htm 

From cbbrowne at ca.afilias.info  Mon Apr 26 12:00:39 2010
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Mon, 26 Apr 2010 15:00:39 -0400
Subject: [Slony1-general] git ?
In-Reply-To: <y2q6bc73d4c1004241723gcaf427dcvf73519cb96c48eeb@mail.gmail.com>
	(Stuart Bishop's message of "Sun, 25 Apr 2010 10:23:00 +1000")
References: <4BD1BF5A.9060406@ca.afilias.info> <87ljcem7fe.fsf@ca.afilias.info>
	<y2q6bc73d4c1004241723gcaf427dcvf73519cb96c48eeb@mail.gmail.com>
Message-ID: <8739yi11k8.fsf@ca.afilias.info>

Stuart Bishop <stuart at stuartbishop.net> writes:
> On Sat, Apr 24, 2010 at 2:59 AM, Christopher Browne
> <cbbrowne at ca.afilias.info> wrote:
>
>> I'd think a "short list" of plausible SCMs would consist of subversion,
>> git, mercurial, darcs. ?Subversion *wouldn't* help with the "distributed
>> backups" aspect, which goes a long ways towards disqualifying it, to my
>> mind.
>
> And GNU Bazaar of course. If anybody wants a play, there is already an
> import available at
> https://code.launchpad.net/~vcs-imports/slony-i/trunk. Just install a
> modern version of Bazaar and 'bzr branch lp:slony-i' to get started. I
> recommend 2.1. http://bazaar-vcs.org for more information, including
> the excellent documentation at
> http://doc.bazaar.canonical.com/bzr.2.1/en/.
>
> I'm available for questions, but I'm not going to be a committer in
> the foreseeable future and will leave the discussion to those who are
> going to use the VCS.

You're right, if we're considering a list that includes Mercurial and
Darcs, then Bazaar ought to be on that list.  (Slightly embarrassing
that I forgot about it!)

On the other hand, there's a reasonably strong reason to prefer Git, in
that the PostgreSQL project appears to be seriously contemplating using
Git, and there would be a fair bit of value in allowing peoples'
learning curves (in learning about Git for PostgreSQL work) to pay off
twice.

My own preference would be to wait until there's a bit more indication
of the certainty (or lack thereof!) of PostgreSQL migration, hence
waiting 'til, say, early June to decide for sure.  That's just my
preference :-).

Does that repo track all the branches?  [Possibly a lazy question!  :-)]
It would seem like a keen idea to have a repo or two up, and track them
for a while, before deciding to change anything.
-- 
output = reverse("ofni.sailifa.ac" "@" "enworbbc")
Christopher Browne
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"

From cbbrowne at ca.afilias.info  Mon Apr 26 12:18:39 2010
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Mon, 26 Apr 2010 15:18:39 -0400
Subject: [Slony1-general] [slony-general] changing the PK of a
	replicated table
In-Reply-To: <p2o3073cc9b1004260926gae3580b4j4780f12bdc34a877@mail.gmail.com>
	(Jaime Casanova's message of "Mon, 26 Apr 2010 11:26:57 -0500")
References: <p2o3073cc9b1004260926gae3580b4j4780f12bdc34a877@mail.gmail.com>
Message-ID: <87y6gayqcv.fsf@ca.afilias.info>

Jaime Casanova <jcasanov at systemguards.com.ec> writes:
> Seems like a customer wants to change the PK of a replicated table...
> and from what i understood in the docs we shouldn't be using EXECUTE
> SCRIPT for that... i'm right?
> so what are my options (besides to blame the customer for doing that)?
> set drop table, change, readd it using a merge?

Good question.

What's done sure ought to involve EXECUTE SCRIPT; the case where I'd
expect things to break down would be where you're changing from one
candidate-primary-key (e.g. - not *really* a primary key, just a
surrogate) to another.

For that scenario, I'd like to have a stored function to help enable
changing the PK.

I know we've had cases at Afilias where we weren't using the real PK; it
sure would be nice to be able to do an execute script consisting of
something like:

  select _slony1_cluster.fix_primary_key(t.tab_id) from
    _slony1_cluster.sl_table t, pg_catalog.pg_class ci, pg_catalog.pg_index i
    where
       i.indrelid = t.tab_reloid and i.indisprimary and 
       ci.oid = i.indexrelid and ci.relname <> tab_idxname;
 

fix_primary_key(tab_id) would be a function that updates sl_table to
change the index used to be the actual primary key, eliminating the use
of some other candidate primary key.

The idea here is to look at all replicated tables and change them to use
the new primary key.  Doing it inside an EXECUTE SCRIPT script makes
sure it hits all nodes consistently.

In the absence of the function, you could do it more directly by having
a bit of SQL that alters sl_table to point to the new index name, and
running that via EXECUTE SCRIPT.

Irrespective of the amount of hackery involved, it's still good to use
EXECUTE SCRIPT, as that ensures that the change takes place in between
SYNCs, so that old data can be using the old candidate PK and newer data
(after the EXECUTE SCRIPT) cleanly changes to reference the new PK.
-- 
output = ("cbbrowne" "@" "ca.afilias.info")
Christopher Browne
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"

From ssinger at ca.afilias.info  Mon Apr 26 13:46:07 2010
From: ssinger at ca.afilias.info (Steve Singer)
Date: Mon, 26 Apr 2010 16:46:07 -0400
Subject: [Slony1-general] [slony-general] error adding a table
In-Reply-To: <4BD0E934.2020609@Yahoo.com>
References: <m2p3073cc9b1004202335hd339f0a3w2e81861bb59a381d@mail.gmail.com>	<w2o3073cc9b1004211606w5a84eb07mc2caf8b7bbccb0d3@mail.gmail.com>	<4BCF892C.3070509@Yahoo.com>	<n2p3073cc9b1004211644j7a327504i19f93f02dfaeb893@mail.gmail.com>	<4BCF8FD6.4050203@Yahoo.com>	<i2w3073cc9b1004212114rd0752391l787a507654da219b@mail.gmail.com>	<n2v3073cc9b1004212135nbd342353y332fe8036f645dc4@mail.gmail.com>	<4BCFC2DD.8010607@Yahoo.com>	<h2r3073cc9b1004220706n6e0b62b8m62942d62a33f3ec5@mail.gmail.com>	<4BCFE56D.4070002@Yahoo.com>	<x2u3073cc9b1004221633k61d07d2at9dc9bc58002d5cc8@mail.gmail.com>
	<4BD0E934.2020609@Yahoo.com>
Message-ID: <4BD5FB8F.1010805@ca.afilias.info>

Jan Wieck wrote:

> 
> That copy_set() failed due to the catalog inconsistency. What Jaime 
> tried then was an UNSUBSCRIBE SET, which slonik issued against the half 
> subscribed node 2, deleting the sl_subscribe row. The code in copy_set() 
> doesn't use the parameters from the event, but expects the in memory 
> runtime configuration data to know the data provider for the set. Since 
> the sl_subscribe row is gone now, that information is missing and the -1 
> is the default value for a set, the node isn't subscribed to.
> 
> I don't know exactly what the right fix for this bug is. My first gut 
> feeling is to ignore the ENABLE_SUBSCRIPTION and generate another 
> UNSUBSCRIBE_SET event just to clear out any sl_subscribe row existing in 
> the cluster. Since I am in Toronto right now, I can discuss this with 
> Steve Singer tomorrow morning.

The approaches that come to mind are:

1) When slon processes an ENABLE_SUBSCRIPTION but is unable to find the 
sl_subscribe row log a warning and either continue on or do some cleanup 
if required to ensure the set really is unsubscribed. There might be 
other commands we want to do this for as well (move set? merge set?)

2) Modify things so that the UNSUBSCRIBE action won't get processed on 
the subscriber if there is an inactive subscription that has been stored 
but not yet enabled.

3) Modify the flow of unsubscribes so they get inserted into the event 
queue of the origin and are processed in order.  Problems with this 
include that if your set is already subscribed but your origin looses 
communication with the subscriber (or if your subscriber is really far 
behind say because every row in a large table was updated) your 
unsubscribe request won't be processed until the subscriber is caught up 
(which serves little point because you are unsubscribing).

I'm inclined to say that 2 is the correct solution.  However, if you do 
a subscribe and your copy set fails (as happened to Jamie) there is no 
easy way to not subscribe.  I think we also need a way of safely 
removing some commands from the slony command queue (a 2.1 feature maybe).





> 
> Thank you Jaime. Your patience on this matter helped to track down a 
> very nasty bug that apparently had been lingering in the system for a 
> long time.
> 
> 
> Jan
> 


-- 
Steve Singer
Afilias Canada
Data Services Developer
416-673-1142

From jcasanov at systemguards.com.ec  Mon Apr 26 13:55:21 2010
From: jcasanov at systemguards.com.ec (Jaime Casanova)
Date: Mon, 26 Apr 2010 15:55:21 -0500
Subject: [Slony1-general] [slony-general] error adding a table
In-Reply-To: <4BD5FB8F.1010805@ca.afilias.info>
References: <m2p3073cc9b1004202335hd339f0a3w2e81861bb59a381d@mail.gmail.com> 
	<4BCF8FD6.4050203@Yahoo.com>
	<i2w3073cc9b1004212114rd0752391l787a507654da219b@mail.gmail.com>
	<n2v3073cc9b1004212135nbd342353y332fe8036f645dc4@mail.gmail.com> 
	<4BCFC2DD.8010607@Yahoo.com>
	<h2r3073cc9b1004220706n6e0b62b8m62942d62a33f3ec5@mail.gmail.com>
	<4BCFE56D.4070002@Yahoo.com>
	<x2u3073cc9b1004221633k61d07d2at9dc9bc58002d5cc8@mail.gmail.com>
	<4BD0E934.2020609@Yahoo.com> <4BD5FB8F.1010805@ca.afilias.info>
Message-ID: <v2i3073cc9b1004261355xe72c2e42v3a8259ae6f45455b@mail.gmail.com>

On Mon, Apr 26, 2010 at 3:46 PM, Steve Singer <ssinger at ca.afilias.info> wrote:
> Jan Wieck wrote:
>
>>
>> That copy_set() failed due to the catalog inconsistency. What Jaime
>> tried then was an UNSUBSCRIBE SET, which slonik issued against the half
>> subscribed node 2, deleting the sl_subscribe row. The code in copy_set()
>> doesn't use the parameters from the event, but expects the in memory
>> runtime configuration data to know the data provider for the set. Since
>> the sl_subscribe row is gone now, that information is missing and the -1
>> is the default value for a set, the node isn't subscribed to.
>>
>> I don't know exactly what the right fix for this bug is. My first gut
>> feeling is to ignore the ENABLE_SUBSCRIPTION and generate another
>> UNSUBSCRIBE_SET event just to clear out any sl_subscribe row existing in
>> the cluster. Since I am in Toronto right now, I can discuss this with
>> Steve Singer tomorrow morning.
>
> The approaches that come to mind are:
>
> 1) When slon processes an ENABLE_SUBSCRIPTION but is unable to find the
> sl_subscribe row log a warning and either continue on or do some cleanup
> if required to ensure the set really is unsubscribed. There might be
> other commands we want to do this for as well (move set? merge set?)
>

the cleanup part seems safer than just continue... actually, that's
what i think will happen but instead i see it continually trying to
complete the subscription and failing again and again... maybe a max
for retries before give up and cleanup?

> 2) Modify things so that the UNSUBSCRIBE action won't get processed on
> the subscriber if there is an inactive subscription that has been stored
> but not yet enabled.
>

+1

> 3) Modify the flow of unsubscribes so they get inserted into the event
> queue of the origin and are processed in order. ?Problems with this
> include that if your set is already subscribed but your origin looses
> communication with the subscriber (or if your subscriber is really far
> behind say because every row in a large table was updated) your
> unsubscribe request won't be processed until the subscriber is caught up
> (which serves little point because you are unsubscribing).
>

agreed that doesn't seems very useful...

> I'm inclined to say that 2 is the correct solution. ?However, if you do
> a subscribe and your copy set fails (as happened to Jamie) there is no
> easy way to not subscribe.

why is that?

>?I think we also need a way of safely
> removing some commands from the slony command queue (a 2.1 feature maybe).
>

mmm... a safe way of shooting yourself in the foot? yeah i like it ;)

-- 
Atentamente,
Jaime Casanova
Soporte y capacitaci?n de PostgreSQL
Asesor?a y desarrollo de sistemas
Guayaquil - Ecuador
Cel. +59387171157

From ssinger at ca.afilias.info  Mon Apr 26 14:05:12 2010
From: ssinger at ca.afilias.info (Steve Singer)
Date: Mon, 26 Apr 2010 17:05:12 -0400
Subject: [Slony1-general] [slony-general] error adding a table
In-Reply-To: <v2i3073cc9b1004261355xe72c2e42v3a8259ae6f45455b@mail.gmail.com>
References: <m2p3073cc9b1004202335hd339f0a3w2e81861bb59a381d@mail.gmail.com>
	<4BCF8FD6.4050203@Yahoo.com>
	<i2w3073cc9b1004212114rd0752391l787a507654da219b@mail.gmail.com>
	<n2v3073cc9b1004212135nbd342353y332fe8036f645dc4@mail.gmail.com>
	<4BCFC2DD.8010607@Yahoo.com>
	<h2r3073cc9b1004220706n6e0b62b8m62942d62a33f3ec5@mail.gmail.com>
	<4BCFE56D.4070002@Yahoo.com>
	<x2u3073cc9b1004221633k61d07d2at9dc9bc58002d5cc8@mail.gmail.com>
	<4BD0E934.2020609@Yahoo.com> <4BD5FB8F.1010805@ca.afilias.info>
	<v2i3073cc9b1004261355xe72c2e42v3a8259ae6f45455b@mail.gmail.com>
Message-ID: <4BD60008.3060101@ca.afilias.info>

Jaime Casanova wrote:
> On Mon, Apr 26, 2010 at 3:46 PM, Steve Singer <ssinger at ca.afilias.info> wrote:

> 
>> I'm inclined to say that 2 is the correct solution.  However, if you do
>> a subscribe and your copy set fails (as happened to Jamie) there is no
>> easy way to not subscribe.
> 
> why is that?

Say you subscribe to a set and the copy set keeps failing due to some 
error (maybe you didn't mean to subscriber to that set).  What will you 
be able to do?  If you try issuing an unsubscribe command it will (if we 
make the above change) just fail with a message like 'The subscription 
is still in progress, you can't unsubscribe until it completes'.  The 
problem being it will never complete because it keeps failing.





> 
>>  I think we also need a way of safely
>> removing some commands from the slony command queue (a 2.1 feature maybe).
>>
> 
> mmm... a safe way of shooting yourself in the foot? yeah i like it ;)
> 


-- 
Steve Singer
Afilias Canada
Data Services Developer
416-673-1142

From stuart at stuartbishop.net  Mon Apr 26 20:12:47 2010
From: stuart at stuartbishop.net (Stuart Bishop)
Date: Tue, 27 Apr 2010 10:12:47 +0700
Subject: [Slony1-general] git ?
In-Reply-To: <8739yi11k8.fsf@ca.afilias.info>
References: <4BD1BF5A.9060406@ca.afilias.info> <87ljcem7fe.fsf@ca.afilias.info>
	<y2q6bc73d4c1004241723gcaf427dcvf73519cb96c48eeb@mail.gmail.com>
	<8739yi11k8.fsf@ca.afilias.info>
Message-ID: <y2o6bc73d4c1004262012raa65414dh50e69c6324cbb208@mail.gmail.com>

On Tue, Apr 27, 2010 at 2:00 AM, Christopher Browne
<cbbrowne at ca.afilias.info> wrote:

> Does that repo track all the branches? ?[Possibly a lazy question! ?:-)]
> It would seem like a keen idea to have a repo or two up, and track them
> for a while, before deciding to change anything.

No, it just tracks the trunk.

There is a PostgreSQL trunk import available too, but I doubt the
PostgreSQL team will be considering alternatives to git unless it
fails badly. There seem to be a number of git fans there and I'm not
in a position to evangelize.


-- 
Stuart Bishop <stuart at stuartbishop.net>
http://www.stuartbishop.net/

From tmblue at gmail.com  Mon Apr 26 21:38:10 2010
From: tmblue at gmail.com (Tory M Blue)
Date: Mon, 26 Apr 2010 21:38:10 -0700
Subject: [Slony1-general] Suppressed triggers on the slave nodes,
	how to determine that they 	are there?
Message-ID: <t2v8a547c841004262138x7e028a56l24d4f0856ea4ca7b@mail.gmail.com>

Hopefully this is not a brain dead question.

I would like to know how to verify that my slaves have their full triggers?


I have cause to want to know if my triggers are actually present on my
slave nodes. Obviously with Slony, my slaves have their triggers
suppressed, however without the triggers (on the insert node)  my
applications break. Now I've had issues in the past where manual drops
of the Slony schema have removed said triggers and I didn't catch it
before it was too late (I'm no longer manually just dropping the
schema!).

However as I said if I was to do a switchover/failover my Slave could
or possibly could not have the triggers. I need to verify without
dropping / importing etc.

I've looked into pg_trigger and can find some of my triggers but
wondered if there was a cleaner more straightforward way?

"Slony-I hides triggers (save for those "unhidden" via SLONIK STORE
TRIGGER) by repointing them to the primary key of the table. In the
case of foreign key triggers, or other triggers used to do data
validation, it should be quite unnecessary to run them on a
subscriber, as equivalent triggers should have been invoked on the
origin node."

So is there a "doh Tory", or even something a bit complicated that I
could deploy to be certain that my slave is ready to handle the master
role?



Thanks
tory

From jks at selectacast.net  Tue Apr 27 16:22:15 2010
From: jks at selectacast.net (jks at selectacast.net)
Date: Tue, 27 Apr 2010 19:22:15 -0400 (EDT)
Subject: [Slony1-general] encoding problems
Message-ID: <alpine.LRH.1.10.1004271915240.24242@corp1.xtenit.com>

Slony replication between my two servers is failing with this:

" ERROR:  invalid byte sequence for encoding "UTF8": 0xac
HINT:  This error can also happen if the byte sequence does not match the 
encoding expected by the server, which is controlled by "client_encoding".

Searching the archives has revealed that people have had this problem 
before, but the consensus was that the problem was caused by the two pg 
installations having different versions or different encodings.  Both my 
servers are pg 8.4.3, encodings are UTF8, and slony is 2.0.3.

So my questions are:

1) How can I fix this problem and make sure it never happens again?

2) In the short run how can I break slony out of its loop?  Can I find 
this entry in sl_log_X somewhere and delete it?

From ssinger at ca.afilias.info  Tue Apr 27 20:04:38 2010
From: ssinger at ca.afilias.info (Steve Singer)
Date: Tue, 27 Apr 2010 23:04:38 -0400
Subject: [Slony1-general] git ?
In-Reply-To: <8739yi11k8.fsf@ca.afilias.info>
References: <4BD1BF5A.9060406@ca.afilias.info>	<87ljcem7fe.fsf@ca.afilias.info>	<y2q6bc73d4c1004241723gcaf427dcvf73519cb96c48eeb@mail.gmail.com>
	<8739yi11k8.fsf@ca.afilias.info>
Message-ID: <4BD7A5C6.4050308@ca.afilias.info>

Christopher Browne wrote:
> Stuart Bishop <stuart at stuartbishop.net> writes:
>> On Sat, Apr 24, 2010 at 2:59 AM, Christopher Browne
>> <cbbrowne at ca.afilias.info> wrote:
>>
>>> I'd think a "short list" of plausible SCMs would consist of subversion,
>>> git, mercurial, darcs.  Subversion *wouldn't* help with the "distributed
>>> backups" aspect, which goes a long ways towards disqualifying it, to my
>>> mind.
>> And GNU Bazaar of course. If anybody wants a play, there is already an
>> import available at
>> https://code.launchpad.net/~vcs-imports/slony-i/trunk. Just install a
>> modern version of Bazaar and 'bzr branch lp:slony-i' to get started. I
>> recommend 2.1. http://bazaar-vcs.org for more information, including
>> the excellent documentation at
>> http://doc.bazaar.canonical.com/bzr.2.1/en/.
>>
>> I'm available for questions, but I'm not going to be a committer in
>> the foreseeable future and will leave the discussion to those who are
>> going to use the VCS.
> 
> You're right, if we're considering a list that includes Mercurial and
> Darcs, then Bazaar ought to be on that list.  (Slightly embarrassing
> that I forgot about it!)
> 
> On the other hand, there's a reasonably strong reason to prefer Git, in
> that the PostgreSQL project appears to be seriously contemplating using
> Git, and there would be a fair bit of value in allowing peoples'
> learning curves (in learning about Git for PostgreSQL work) to pay off
> twice.
> 
> My own preference would be to wait until there's a bit more indication
> of the certainty (or lack thereof!) of PostgreSQL migration, hence
> waiting 'til, say, early June to decide for sure.  That's just my
> preference :-).
> 

I agree that it makes senes to wait to see what PostgreSQL decides to do 
for 9.1 (if anything) before we make a decision.

In the meantime I've posted my clone of the slony repository (from git 
cvsimport) on github at http://github.com/ssinger/slony (The 1.2 and 2.0 
branches are included) but there are no automatic syncs between that and 
the slony cvs repo.








> Does that repo track all the branches?  [Possibly a lazy question!  :-)]
> It would seem like a keen idea to have a repo or two up, and track them
> for a while, before deciding to change anything.


-- 
Steve Singer
Afilias Canada
Data Services Developer
416-673-1142

From jcasanov at systemguards.com.ec  Tue Apr 27 21:19:34 2010
From: jcasanov at systemguards.com.ec (Jaime Casanova)
Date: Tue, 27 Apr 2010 23:19:34 -0500
Subject: [Slony1-general] git ?
In-Reply-To: <4BD7A5C6.4050308@ca.afilias.info>
References: <4BD1BF5A.9060406@ca.afilias.info>
	<87ljcem7fe.fsf@ca.afilias.info> 
	<y2q6bc73d4c1004241723gcaf427dcvf73519cb96c48eeb@mail.gmail.com> 
	<8739yi11k8.fsf@ca.afilias.info> <4BD7A5C6.4050308@ca.afilias.info>
Message-ID: <z2x3073cc9b1004272119td455b29m18c101015f995b37@mail.gmail.com>

On Tue, Apr 27, 2010 at 10:04 PM, Steve Singer <ssinger at ca.afilias.info> wrote:
>
> I agree that it makes senes to wait to see what PostgreSQL decides to do

that easily could means wait forever ;)

-- 
Atentamente,
Jaime Casanova
Soporte y capacitaci?n de PostgreSQL
Asesor?a y desarrollo de sistemas
Guayaquil - Ecuador
Cel. +59387171157

From ssinger at ca.afilias.info  Wed Apr 28 08:17:25 2010
From: ssinger at ca.afilias.info (Steve Singer)
Date: Wed, 28 Apr 2010 11:17:25 -0400
Subject: [Slony1-general] encoding problems
In-Reply-To: <alpine.LRH.1.10.1004271915240.24242@corp1.xtenit.com>
References: <alpine.LRH.1.10.1004271915240.24242@corp1.xtenit.com>
Message-ID: <4BD85185.1050107@ca.afilias.info>

jks at selectacast.net wrote:
> Slony replication between my two servers is failing with this:
> 
> " ERROR:  invalid byte sequence for encoding "UTF8": 0xac
> HINT:  This error can also happen if the byte sequence does not match the 
> encoding expected by the server, which is controlled by "client_encoding".

Can you determine where the value '0xac' comes from?

  CREATE TABLE a(a text);
  INSERT INTO a VALUES ('\xac');

on a UTF8 database fails.  Does the data on your master actually contain 
this in a text field or is the data being written into sl_log being 
corrupted?




> 
> Searching the archives has revealed that people have had this problem 
> before, but the consensus was that the problem was caused by the two pg 
> installations having different versions or different encodings.  Both my 
> servers are pg 8.4.3, encodings are UTF8, and slony is 2.0.3.
> 
> So my questions are:
> 
> 1) How can I fix this problem and make sure it never happens again?
> 
> 2) In the short run how can I break slony out of its loop?  Can I find 
> this entry in sl_log_X somewhere and delete it?


If you can identify which row in sl_log_X contains the offending line 
you could change the log_cmddata (with an UPDATE statement) to not have 
the offending character (keep in mind this is the SQL that will kept 
executed on your subscribers and you want the data on your subscribers 
and master to be the same)



> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


-- 
Steve Singer
Afilias Canada
Data Services Developer
416-673-1142

From jks at selectacast.net  Wed Apr 28 10:20:18 2010
From: jks at selectacast.net (Joseph S)
Date: Wed, 28 Apr 2010 13:20:18 -0400
Subject: [Slony1-general] encoding problems
In-Reply-To: <4BD85185.1050107@ca.afilias.info>
References: <alpine.LRH.1.10.1004271915240.24242@corp1.xtenit.com>
	<4BD85185.1050107@ca.afilias.info>
Message-ID: <4BD86E52.40800@selectacast.net>

Steve Singer wrote:
> jks at selectacast.net wrote:
>> Slony replication between my two servers is failing with this:
>>
>> " ERROR:  invalid byte sequence for encoding "UTF8": 0xac
>> HINT:  This error can also happen if the byte sequence does not match 
>> the encoding expected by the server, which is controlled by 
>> "client_encoding".
> 
> Can you determine where the value '0xac' comes from?
> 
>  CREATE TABLE a(a text);
>  INSERT INTO a VALUES ('\xac');
> 
> on a UTF8 database fails.  Does the data on your master actually contain 
> this in a text field or is the data being written into sl_log being 
> corrupted?

I don't think the data in sl_log is bad.  I did this (on both log 
tables) to find bad values and didn't find anything:

select * from _devel.sl_log_2 where log_cmddata::bytea::text like 
E'%\\012\\014%'
OR log_cmddata::bytea::text like E'%\\013\\000%'
OR log_cmddata::bytea::text like E'%\\011\\010%' ;

Interestingly enough when I tried the same thing on my data table I got 
"ERROR:  invalid input syntax for type bytea".  Checking row by row 6 
rows had this problem, but visually looking at them doesn't show 
anything obviously wrong.

> 
> 
> 
> 
>>
>> Searching the archives has revealed that people have had this problem 
>> before, but the consensus was that the problem was caused by the two 
>> pg installations having different versions or different encodings.  
>> Both my servers are pg 8.4.3, encodings are UTF8, and slony is 2.0.3.
>>
>> So my questions are:
>>
>> 1) How can I fix this problem and make sure it never happens again?
>>
>> 2) In the short run how can I break slony out of its loop?  Can I find 
>> this entry in sl_log_X somewhere and delete it?
> 
> 
> If you can identify which row in sl_log_X contains the offending line 
> you could change the log_cmddata (with an UPDATE statement) to not have 

I'm not sure how to do that. I think the multiple updates are done in 
one statement and I'm not sure how to figure out which one slony is 
trying when it gets the error.

From jcasanov at systemguards.com.ec  Wed Apr 28 11:04:34 2010
From: jcasanov at systemguards.com.ec (Jaime Casanova)
Date: Wed, 28 Apr 2010 13:04:34 -0500
Subject: [Slony1-general] [slony-general] autovacuum and slony tables
Message-ID: <x2s3073cc9b1004281104j87e3a87fl211bdce7944e17ff@mail.gmail.com>

Hi,

i was looking at this:
http://www.slony.info/documentation/maintenance.html and it seems
reasonable to me, specially because most the tables autovacuum is
processing is slony ones ;)

now in 8.4 this is an alter table command, should it run through slonik?

-- 
Atentamente,
Jaime Casanova
Soporte y capacitaci?n de PostgreSQL
Asesor?a y desarrollo de sistemas
Guayaquil - Ecuador
Cel. +59387171157

From cbbrowne at ca.afilias.info  Wed Apr 28 11:28:54 2010
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed, 28 Apr 2010 14:28:54 -0400
Subject: [Slony1-general] git ?
In-Reply-To: <z2x3073cc9b1004272119td455b29m18c101015f995b37@mail.gmail.com>
	(Jaime Casanova's message of "Tue, 27 Apr 2010 23:19:34 -0500")
References: <4BD1BF5A.9060406@ca.afilias.info> <87ljcem7fe.fsf@ca.afilias.info>
	<y2q6bc73d4c1004241723gcaf427dcvf73519cb96c48eeb@mail.gmail.com>
	<8739yi11k8.fsf@ca.afilias.info> <4BD7A5C6.4050308@ca.afilias.info>
	<z2x3073cc9b1004272119td455b29m18c101015f995b37@mail.gmail.com>
Message-ID: <87iq7bxwgp.fsf@ca.afilias.info>

Jaime Casanova <jcasanov at systemguards.com.ec> writes:
> On Tue, Apr 27, 2010 at 10:04 PM, Steve Singer <ssinger at ca.afilias.info> wrote:
>>
>> I agree that it makes senes to wait to see what PostgreSQL decides to do
>
> that easily could means wait forever ;)

No, we're pretty sure the matter will be discussed at the developer
summit at pgCon, and it seems likely that *some* information will be
disclosed after that.

After all, some of the folks that said "+1" in this thread have been
known to "+1" the same on pg-hackers :-).

At any rate, I fully expect there to be *some* public discussion about
what's going on with PostgreSQL during the course of pgCon, and, seeing
as how we've been going along fine with CVS for a long time now, it
makes sense for us to wait a month to come up with any hard conclusions.

It is entirely possible that they'll conclude that the "PostgreSQL on
Git" notion will be put off until 2011; if that is the case, then:

- It's worth considering whether the reasons put forth are relevant
  to us, or affect our decision;

- We could certainly conclude that the reasons *aren't* relevant, and,
  with that relatively brief pause, proceed with whatever we conclude
  we ought to do.

For instance (and I make this up!), the PG core team might discover that
there's some heinous code-losing bug in Git, and conclude that they'll
have to put off the matter pending investigation of alternatives.  

Were that to be the case (e.g. - "heinous code-losing bug"), it would
seem dangerous to proceed on a Git-wards trajectory, unless we had some
excellent reasons to expect that it would not be applicable to Slony.

In short (too late!), if, come June, it still seems like "wait forever,"
then we'll have to make decisions here.  Waiting until June isn't
forever :-).
-- 
"cbbrowne","@","ca.afilias.info"
Christopher Browne
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"

From ssinger at ca.afilias.info  Wed Apr 28 14:12:58 2010
From: ssinger at ca.afilias.info (Steve Singer)
Date: Wed, 28 Apr 2010 17:12:58 -0400
Subject: [Slony1-general] encoding problems
In-Reply-To: <4BD86E52.40800@selectacast.net>
References: <alpine.LRH.1.10.1004271915240.24242@corp1.xtenit.com>
	<4BD85185.1050107@ca.afilias.info> <4BD86E52.40800@selectacast.net>
Message-ID: <4BD8A4DA.5040902@ca.afilias.info>

Joseph S wrote:

> I'm not sure how to do that. I think the multiple updates are done in 
> one statement and I'm not sure how to figure out which one slony is 
> trying when it gets the error.

Can you find this out from the postgresql log on the replica?  You can 
get it to print the SQL statement that caused the error.



-- 
Steve Singer
Afilias Canada
Data Services Developer
416-673-1142

From jks at selectacast.net  Wed Apr 28 14:16:21 2010
From: jks at selectacast.net (Joseph S)
Date: Wed, 28 Apr 2010 17:16:21 -0400
Subject: [Slony1-general] encoding problems
In-Reply-To: <4BD8A4DA.5040902@ca.afilias.info>
References: <alpine.LRH.1.10.1004271915240.24242@corp1.xtenit.com>
	<4BD85185.1050107@ca.afilias.info> <4BD86E52.40800@selectacast.net>
	<4BD8A4DA.5040902@ca.afilias.info>
Message-ID: <4BD8A5A5.4040907@selectacast.net>

Steve Singer wrote:
> Joseph S wrote:
> 
>> I'm not sure how to do that. I think the multiple updates are done in 
>> one statement and I'm not sure how to figure out which one slony is 
>> trying when it gets the error.
> 
> Can you find this out from the postgresql log on the replica?  You can 
> get it to print the SQL statement that caused the error.

For other errors it puts the statement in the log right after the ERROR 
line, but not for encoding errors.

ERROR:  invalid byte sequence for encoding "UTF8": 0x98 
 
 

HINT:  This error can also happen if the byte sequence does not match 
the encoding expected by the server, which is controlled by 
"client_encoding". 

ERROR:  invalid byte sequence for encoding "UTF8": 0x98 
 
 

HINT:  This error can also happen if the byte sequence does not match 
the encoding expected by the server, which is controlled by 
"client_encoding". 

ERROR:  invalid byte sequence for encoding "UTF8": 0xb0 
 
 

HINT:  This error can also happen if the byte sequence does not match 
the encoding expected by the server, which is controlled by 
"client_encoding". 

ERROR:  invalid byte sequence for encoding "UTF8": 0xb0 
 
 

HINT:  This error can also happen if the byte sequence does not match 
the encoding expected by the server, which is controlled by 
"client_encoding".
> 
> 
> 


From jcasanov at systemguards.com.ec  Wed Apr 28 19:49:45 2010
From: jcasanov at systemguards.com.ec (Jaime Casanova)
Date: Wed, 28 Apr 2010 21:49:45 -0500
Subject: [Slony1-general] [slony-general] autovacuum and slony tables
In-Reply-To: <x2s3073cc9b1004281104j87e3a87fl211bdce7944e17ff@mail.gmail.com>
References: <x2s3073cc9b1004281104j87e3a87fl211bdce7944e17ff@mail.gmail.com>
Message-ID: <l2u3073cc9b1004281949y30260a0asb3ada62f16e0b606@mail.gmail.com>

On Wed, Apr 28, 2010 at 1:04 PM, Jaime Casanova
<jcasanov at systemguards.com.ec> wrote:
> Hi,
>
> i was looking at this:
> http://www.slony.info/documentation/maintenance.html and it seems
> reasonable to me, specially because most the tables autovacuum is
> processing is slony ones ;)
>
> now in 8.4 this is an alter table command, should it run through slonik?
>

answering myself, those are not replicated tables... so, no. i don't
need to run this through slonik


-- 
Atentamente,
Jaime Casanova
Soporte y capacitaci?n de PostgreSQL
Asesor?a y desarrollo de sistemas
Guayaquil - Ecuador
Cel. +59387171157

From peter.geoghegan86 at gmail.com  Thu Apr 29 04:33:47 2010
From: peter.geoghegan86 at gmail.com (Peter Geoghegan)
Date: Thu, 29 Apr 2010 12:33:47 +0100
Subject: [Slony1-general] git ?
In-Reply-To: <87iq7bxwgp.fsf@ca.afilias.info>
References: <4BD1BF5A.9060406@ca.afilias.info> <87ljcem7fe.fsf@ca.afilias.info>
	<y2q6bc73d4c1004241723gcaf427dcvf73519cb96c48eeb@mail.gmail.com>
	<8739yi11k8.fsf@ca.afilias.info> <4BD7A5C6.4050308@ca.afilias.info>
	<z2x3073cc9b1004272119td455b29m18c101015f995b37@mail.gmail.com>
	<87iq7bxwgp.fsf@ca.afilias.info>
Message-ID: <p2udb471ace1004290433z55a61373kf0452a83ebf80f63@mail.gmail.com>

I hate to be the one stating the very obvious, but git is already used
as the revision control system of the Linux kernel. The Linux kernel
is a major open source project, which has large commercial sponsors,
and a great many developers. In short, git is not a flash in the pan -
it is probably the pre-eminent open source RCS. What makes you think
that you're special?  :-)

I doubt that if you cornered *any* of the Postgres devs they'd be
willing to defend the use of CVS on any grounds other than
institutional inertia (that was certainly my experience!). This
institutional inertia is perhaps understandable - a major
infrastructure project like Postgres ought to be very conservative.
I'd speculate that Postgres devs are inclined to think "it may not
matter all *that* much what RCS is used if everyone already works
around CVS's considerable limitations, so why spend time and effort on
lobbying for git?". They would have a point. Besides, why should
Postgres be the vanguard? It makes more sense for its satellite
projects like Slony to lead the way, in my humble opinion. It's
extremely unlikely that by adopting git, the Slony devs will have made
the wrong call, and will fall out of lockstep with PG - I haven't
encountered any voices in the wider Postgres community that are
lobbying for anything other than git, so there probably aren't any, as
has been noted on this thread. Besides, even if that does happen, does
that actually matter all that much?

Regards,
Peter Geoghegan

From jcasanov at systemguards.com.ec  Thu Apr 29 05:16:07 2010
From: jcasanov at systemguards.com.ec (Jaime Casanova)
Date: Thu, 29 Apr 2010 07:16:07 -0500
Subject: [Slony1-general] git ?
In-Reply-To: <p2udb471ace1004290433z55a61373kf0452a83ebf80f63@mail.gmail.com>
References: <4BD1BF5A.9060406@ca.afilias.info>
	<87ljcem7fe.fsf@ca.afilias.info> 
	<y2q6bc73d4c1004241723gcaf427dcvf73519cb96c48eeb@mail.gmail.com> 
	<8739yi11k8.fsf@ca.afilias.info> <4BD7A5C6.4050308@ca.afilias.info> 
	<z2x3073cc9b1004272119td455b29m18c101015f995b37@mail.gmail.com> 
	<87iq7bxwgp.fsf@ca.afilias.info>
	<p2udb471ace1004290433z55a61373kf0452a83ebf80f63@mail.gmail.com>
Message-ID: <s2g3073cc9b1004290516x743e743fxa2e5c5af9ee92060@mail.gmail.com>

On Thu, Apr 29, 2010 at 6:33 AM, Peter Geoghegan
<peter.geoghegan86 at gmail.com> wrote:
>
> I doubt that if you cornered *any* of the Postgres devs they'd be
> willing to defend the use of CVS on any grounds other than
> institutional inertia (that was certainly my experience!).

not only inertia, there will be learning curve very narrow but it will
be there... but the major showstopper has been the idea of loosing
commit history... at least there were some history entries that had
problems...

but that was solved IIRC, actually we have a GIT repo and some devs
used it instead of the CVS for their projects (of course the final
commit is in cvs) and then the git is updated, so i think we know git
is safe, we know git is usable, but discussions on pgsql lists tend to
be endless ;)

> Besides, even if that does happen, does
> that actually matter all that much?
>

+1

-- 
Atentamente,
Jaime Casanova
Soporte y capacitaci?n de PostgreSQL
Asesor?a y desarrollo de sistemas
Guayaquil - Ecuador
Cel. +59387171157

From ssinger at ca.afilias.info  Thu Apr 29 05:37:23 2010
From: ssinger at ca.afilias.info (Steve Singer)
Date: Thu, 29 Apr 2010 08:37:23 -0400
Subject: [Slony1-general] encoding problems
In-Reply-To: <4BD8A5A5.4040907@selectacast.net>
References: <alpine.LRH.1.10.1004271915240.24242@corp1.xtenit.com>
	<4BD85185.1050107@ca.afilias.info> <4BD86E52.40800@selectacast.net>
	<4BD8A4DA.5040902@ca.afilias.info>
	<4BD8A5A5.4040907@selectacast.net>
Message-ID: <4BD97D83.9070902@ca.afilias.info>

Joseph S wrote:
> Steve Singer wrote:
>> Joseph S wrote:
>>
>>> I'm not sure how to do that. I think the multiple updates are done in 
>>> one statement and I'm not sure how to figure out which one slony is 
>>> trying when it gets the error.
>>
>> Can you find this out from the postgresql log on the replica?  You can 
>> get it to print the SQL statement that caused the error.
> 
> For other errors it puts the statement in the log right after the ERROR 
> line, but not for encoding errors.

Is turning in statement logging (so you log all queries, then see the 
last one that worked to determine what the  next row from sl_log_x  is) 
an option?



> 
> ERROR:  invalid byte sequence for encoding "UTF8": 0x98
> 
> 
> HINT:  This error can also happen if the byte sequence does not match 
> the encoding expected by the server, which is controlled by 
> "client_encoding".
> ERROR:  invalid byte sequence for encoding "UTF8": 0x98
> 
> 
> HINT:  This error can also happen if the byte sequence does not match 
> the encoding expected by the server, which is controlled by 
> "client_encoding".
> ERROR:  invalid byte sequence for encoding "UTF8": 0xb0
> 
> 
> HINT:  This error can also happen if the byte sequence does not match 
> the encoding expected by the server, which is controlled by 
> "client_encoding".
> ERROR:  invalid byte sequence for encoding "UTF8": 0xb0
> 
> 
> HINT:  This error can also happen if the byte sequence does not match 
> the encoding expected by the server, which is controlled by 
> "client_encoding".
>>
>>
>>
> 


-- 
Steve Singer
Afilias Canada
Data Services Developer
416-673-1142

From JanWieck at Yahoo.com  Thu Apr 29 09:37:03 2010
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Thu, 29 Apr 2010 12:37:03 -0400
Subject: [Slony1-general] git ?
In-Reply-To: <8739yi11k8.fsf@ca.afilias.info>
References: <4BD1BF5A.9060406@ca.afilias.info>
	<87ljcem7fe.fsf@ca.afilias.info>	<y2q6bc73d4c1004241723gcaf427dcvf73519cb96c48eeb@mail.gmail.com>
	<8739yi11k8.fsf@ca.afilias.info>
Message-ID: <4BD9B5AF.7010004@Yahoo.com>

On 4/26/2010 3:00 PM, Christopher Browne wrote:

> My own preference would be to wait until there's a bit more indication
> of the certainty (or lack thereof!) of PostgreSQL migration, hence
> waiting 'til, say, early June to decide for sure.  That's just my
> preference :-).

We are not in any particular hurry to switch anything, and using the 
same repository system as the PG project does has value.


Jan

-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin

From JanWieck at Yahoo.com  Thu Apr 29 09:53:30 2010
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Thu, 29 Apr 2010 12:53:30 -0400
Subject: [Slony1-general] [slony-general] changing the PK of
 a	replicated table
In-Reply-To: <s2t3073cc9b1004261029t136affa1kc7653fb9ca89a4b0@mail.gmail.com>
References: <p2o3073cc9b1004260926gae3580b4j4780f12bdc34a877@mail.gmail.com>
	<314043.52289.qm@web53002.mail.re2.yahoo.com>
	<s2t3073cc9b1004261029t136affa1kc7653fb9ca89a4b0@mail.gmail.com>
Message-ID: <4BD9B98A.2000500@Yahoo.com>

On 4/26/2010 1:29 PM, Jaime Casanova wrote:
> On Mon, Apr 26, 2010 at 11:46 AM, Melvin Davidson <melvin6925 at yahoo.com> wrote:
>>
>> >Seems like a customer wants to change the PK of a replicated table...
>> >and from what i understood in the docs we shouldn't be using EXECUTE
>> >SCRIPT for that... i'm right?
>>
>> Wrong! You do want to use EXECUTE SCRIPT. That insures the changed is propagated on all slaves at the same time. Just
>> keep in mind that EXECUTE SCRIPT will lock all tables in a set.
> 
> Ah! [re reading http://www.slony.info/documentation/ddlchanges.html]
> 
> in 17.1. Changes that you might not want to process using EXECUTE SCRIPT, says:
> """
> Slony-I stores the "primary index" name in sl_table, and uses that
> name to control what columns are considered the "key columns" when the
> log trigger is attached. It would be plausible to drop that index and
> replace it with another primary key candidate, but changing the name
> of the primary key candidate would break things.
> """
> 
> which clearly states that i'm wrong, what i shouldn't be doing is
> changing the name of the index i'm using for implementing the PK
> constraint, so i should put the name of the old index to the new one
> for this to work?

Right. Your DDL either creates a new index with that same name, but 
eventually using different column(s), or your DDL script must also 
correct sl_table.

Slony doesn't actually enforce that the index used is actually one that 
implements the PK constraint. It doesn't even check if the columns are 
defined NOT NULL. Note however that actual null values will screw up 
replication, so having them declared NOT NULL is a good idea.

There actually is a good reason not to have any primary key at all. 
REINDEX cannot rebuild the PK index without an exclusive lock on the 
table, which prevents online maintenance. Slony and every application 
will be happy with any UNIQUE NOT NULL column set.


Jan

> 
> 
>> The big question is why is the primary key changing? If it's because the customer mistakenly wants to change the default sort
>> order, or lookup, then it is best to just create another index on the tables.
>>
> 
> i'm still in the process of forcing them to tell me what they want to do...
> but i suspect that what is happening is that they're getting an error
> because they try to insert a null in the PK (they have a lot of those,
> while the pk is a sequence of numbers they didn't use serial when
> created it) what they want to do now, i guess, is to create a new pk
> that is a serial and allow the old pk column to accept nulls so if
> they send a value or a null it's meaningless (actually that is what i
> see in the script they want to execute)...
> if that is true then a better solution is 1) fix the application
> (which probably they won't) or 2) create a new sequence for the pk and
> a before trigger that force the value of the pk to nextval(of the
> sequence)
> 
> i know 1) is the best and 2) a kluge but...
> 
> --
> Atentamente,
> Jaime Casanova
> Soporte y capacitaci?n de PostgreSQL
> Asesor?a y desarrollo de sistemas
> Guayaquil - Ecuador
> Cel. +59387171157
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin

From ssinger at ca.afilias.info  Thu Apr 29 11:01:40 2010
From: ssinger at ca.afilias.info (Steve Singer)
Date: Thu, 29 Apr 2010 14:01:40 -0400
Subject: [Slony1-general] [slony1-general] initial copy incomplete when
 using 2.0.3rc2
In-Reply-To: <3073cc9b1003251031l2104937dtf87e7629d3994112@mail.gmail.com>
References: <3073cc9b0910130942l98cebcfkc0c98fa33daa4db8@mail.gmail.com>
	<3073cc9b1003202107gdc3373fqf9b8434e25f407cf@mail.gmail.com>
	<4BA824E7.8040706@ca.afilias.info>
	<3073cc9b1003242143s517f7675s75fa42cda338b483@mail.gmail.com>
	<3073cc9b1003251031l2104937dtf87e7629d3994112@mail.gmail.com>
Message-ID: <4BD9C984.1060704@ca.afilias.info>

Jaime Casanova wrote:
> On Thu, Mar 25, 2010 at 12:43 AM, Jaime Casanova

Recall this was an issue where some inherited tables don't seem to have 
any data in them after the initial set copy.


>>> I'm trying to get a sense of if this is a problem that is being triggered by
>>> some schemas with inheritance tables or if it is that some of your data is
>>> causing things to fail (which still shouldn't happen)
>>>
>> yeah! i'm trying to figure out what caused the rollback if any
>>
> 
> thinking a bit more on this, this should be as many rollbacks as
> children has tcom_invitacion (one per month since 200803), and the log
> shows that they were copied in 3 groups with other tables (that copied
> fine) between those groups.
> 
> so, the one million question is: why "only" those tables?
> i have another partitioned table but that was fine

I think you will find that the difference is that the inherited table 
has a lower slony table id (the id in the 'set add table') then the 
master table.  The 'testinherit' test case in the regression tests 
directory actually reproduces this (if one takes the time to look at the 
output, which I should have been doing).

However, this only seems to be a problem with 8.4, it works fine when I 
run it against 8.3



I have created bug 118 
(http://www.slony.info/bugzilla/show_bug.cgi?id=118) to track this






-- 
Steve Singer
Afilias Canada
Data Services Developer
416-673-1142

From JanWieck at Yahoo.com  Thu Apr 29 11:42:48 2010
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Thu, 29 Apr 2010 14:42:48 -0400
Subject: [Slony1-general] encoding problems
In-Reply-To: <alpine.LRH.1.10.1004271915240.24242@corp1.xtenit.com>
References: <alpine.LRH.1.10.1004271915240.24242@corp1.xtenit.com>
Message-ID: <4BD9D328.8090701@Yahoo.com>

On 4/27/2010 7:22 PM, jks at selectacast.net wrote:
> Slony replication between my two servers is failing with this:
> 
> " ERROR:  invalid byte sequence for encoding "UTF8": 0xac
> HINT:  This error can also happen if the byte sequence does not match the 
> encoding expected by the server, which is controlled by "client_encoding".
> 
> Searching the archives has revealed that people have had this problem 
> before, but the consensus was that the problem was caused by the two pg 
> installations having different versions or different encodings.  Both my 
> servers are pg 8.4.3, encodings are UTF8, and slony is 2.0.3.

You mean the DB encodings are both UTF8?

First thing to check then is if the client_encoding, used by the slon 
process on both databases the same? You can set that explicitly for the 
slon DB user with ALTER USER;


Jan

> 
> So my questions are:
> 
> 1) How can I fix this problem and make sure it never happens again?
> 
> 2) In the short run how can I break slony out of its loop?  Can I find 
> this entry in sl_log_X somewhere and delete it?
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin

From jks at selectacast.net  Thu Apr 29 11:59:17 2010
From: jks at selectacast.net (Joseph S)
Date: Thu, 29 Apr 2010 14:59:17 -0400
Subject: [Slony1-general] encoding problems
In-Reply-To: <4BD9D328.8090701@Yahoo.com>
References: <alpine.LRH.1.10.1004271915240.24242@corp1.xtenit.com>
	<4BD9D328.8090701@Yahoo.com>
Message-ID: <4BD9D705.2010203@selectacast.net>

Jan Wieck wrote:
> On 4/27/2010 7:22 PM, jks at selectacast.net wrote:
>> Slony replication between my two servers is failing with this:
>>
>> " ERROR:  invalid byte sequence for encoding "UTF8": 0xac
>> HINT:  This error can also happen if the byte sequence does not match 
>> the encoding expected by the server, which is controlled by 
>> "client_encoding".
>>
>> Searching the archives has revealed that people have had this problem 
>> before, but the consensus was that the problem was caused by the two 
>> pg installations having different versions or different encodings.  
>> Both my servers are pg 8.4.3, encodings are UTF8, and slony is 2.0.3.
> 
> You mean the DB encodings are both UTF8?

Yes
> 
> First thing to check then is if the client_encoding, used by the slon 
> process on both databases the same? You can set that explicitly for the 
> slon DB user with ALTER USER;
> 
pg_user shows nothing in useconfig, so that means the system default 
(utf8) should be used, right?  Anyway I set the client_encoding and it 
didn't help.  I wish that error message in postgres was a little more 
descriptive and said what the client_encoding was.

From JanWieck at Yahoo.com  Thu Apr 29 19:19:06 2010
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Thu, 29 Apr 2010 22:19:06 -0400
Subject: [Slony1-general] [slony-general] error adding a table
In-Reply-To: <4BD60008.3060101@ca.afilias.info>
References: <m2p3073cc9b1004202335hd339f0a3w2e81861bb59a381d@mail.gmail.com>
	<4BCF8FD6.4050203@Yahoo.com>
	<i2w3073cc9b1004212114rd0752391l787a507654da219b@mail.gmail.com>
	<n2v3073cc9b1004212135nbd342353y332fe8036f645dc4@mail.gmail.com>
	<4BCFC2DD.8010607@Yahoo.com>
	<h2r3073cc9b1004220706n6e0b62b8m62942d62a33f3ec5@mail.gmail.com>
	<4BCFE56D.4070002@Yahoo.com>
	<x2u3073cc9b1004221633k61d07d2at9dc9bc58002d5cc8@mail.gmail.com>
	<4BD0E934.2020609@Yahoo.com> <4BD5FB8F.1010805@ca.afilias.info>
	<v2i3073cc9b1004261355xe72c2e42v3a8259ae6f45455b@mail.gmail.com>
	<4BD60008.3060101@ca.afilias.info>
Message-ID: <4BDA3E1A.50502@Yahoo.com>

On 4/26/2010 5:05 PM, Steve Singer wrote:
> Jaime Casanova wrote:
>> On Mon, Apr 26, 2010 at 3:46 PM, Steve Singer <ssinger at ca.afilias.info> wrote:
> 
>> 
>>> I'm inclined to say that 2 is the correct solution.  However, if you do
>>> a subscribe and your copy set fails (as happened to Jamie) there is no
>>> easy way to not subscribe.
>> 
>> why is that?
> 
> Say you subscribe to a set and the copy set keeps failing due to some 
> error (maybe you didn't mean to subscriber to that set).  What will you 
> be able to do?  If you try issuing an unsubscribe command it will (if we 
> make the above change) just fail with a message like 'The subscription 
> is still in progress, you can't unsubscribe until it completes'.  The 
> problem being it will never complete because it keeps failing.

I am leaning towards allowing the UNSUBSCRIBE as it is now (issued 
against subscriber), then cleanup in case of the missing sl_subscribe 
row on ENABLE_SUBSCRIPTION in the form of generating an implicit 
UNSUBSCRIBE and moving on. This is effectively aborting the subscribe.

If we deny the UNSUBSCRIBE while the subscription is in progress, then 
there is no way left to abort a continuously failing subscription other 
than manually deleting stuff from sl_event (as it is now). We would have 
to add this feature.

On the other hand if we allow the UNSUBSCRIBE in the way above, then it 
most likely has been processed by the data provider while the copy_set 
was running and there is a good chance that said data provider throws 
away log data because according to its book keeping, everyone had 
confirmed it.


Jan

-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin

From devrim at gunduz.org  Fri Apr 30 04:24:38 2010
From: devrim at gunduz.org (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Fri, 30 Apr 2010 14:24:38 +0300
Subject: [Slony1-general] encoding problems
In-Reply-To: <alpine.LRH.1.10.1004271915240.24242@corp1.xtenit.com>
References: <alpine.LRH.1.10.1004271915240.24242@corp1.xtenit.com>
Message-ID: <1272626678.2247.132.camel@hp-laptop2.gunduz.org>

On Tue, 2010-04-27 at 19:22 -0400, jks at selectacast.net wrote:
> 
> Slony replication between my two servers is failing with this:
> 
> " ERROR:  invalid byte sequence for encoding "UTF8": 0xac
> HINT:  This error can also happen if the byte sequence does not match
> the 
> encoding expected by the server, which is controlled by
> "client_encoding". 

FWIW, I am hitting this issue, too. This does not happen in 1.2.X.

Both machines are very identical (using the same postgresql.conf), and
they are running 8.4.3 with RPM installations. FWIW I had this issue in
2.0.3RC3, too.

I had to use 1.2.21 yesterday night on a new installation.

Regards,
-- 
Devrim G?ND?Z
PostgreSQL Dan??man?/Consultant, Red Hat Certified Engineer
PostgreSQL RPM Repository: http://yum.pgrpms.org
Community: devrim~PostgreSQL.org, devrim.gunduz~linux.org.tr
http://www.gunduz.org  Twitter: http://twitter.com/devrimgunduz
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20100430/911f3bd4/attachment.pgp 

From JanWieck at Yahoo.com  Fri Apr 30 05:23:44 2010
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Fri, 30 Apr 2010 08:23:44 -0400
Subject: [Slony1-general] encoding problems
In-Reply-To: <1272626678.2247.132.camel@hp-laptop2.gunduz.org>
References: <alpine.LRH.1.10.1004271915240.24242@corp1.xtenit.com>
	<1272626678.2247.132.camel@hp-laptop2.gunduz.org>
Message-ID: <4BDACBD0.8040304@Yahoo.com>

On 4/30/2010 7:24 AM, Devrim G?ND?Z wrote:
> On Tue, 2010-04-27 at 19:22 -0400, jks at selectacast.net wrote:
>> 
>> Slony replication between my two servers is failing with this:
>> 
>> " ERROR:  invalid byte sequence for encoding "UTF8": 0xac
>> HINT:  This error can also happen if the byte sequence does not match
>> the 
>> encoding expected by the server, which is controlled by
>> "client_encoding". 
> 
> FWIW, I am hitting this issue, too. This does not happen in 1.2.X.
> 
> Both machines are very identical (using the same postgresql.conf), and
> they are running 8.4.3 with RPM installations. FWIW I had this issue in
> 2.0.3RC3, too.
> 
> I had to use 1.2.21 yesterday night on a new installation.

Is anyone able to give me one single text datum that will cause this?


Jan

-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin

From ajs at crankycanuck.ca  Fri Apr 30 06:49:20 2010
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Fri, 30 Apr 2010 09:49:20 -0400
Subject: [Slony1-general] encoding problems
In-Reply-To: <4BD9D328.8090701@Yahoo.com>
References: <alpine.LRH.1.10.1004271915240.24242@corp1.xtenit.com>
	<4BD9D328.8090701@Yahoo.com>
Message-ID: <20100430134920.GK9077@shinkuro.com>

On Thu, Apr 29, 2010 at 02:42:48PM -0400, Jan Wieck wrote:
> 
> You mean the DB encodings are both UTF8?
> 
> First thing to check then is if the client_encoding, used by the slon 
> process on both databases the same? You can set that explicitly for the 
> slon DB user with ALTER USER;

I'd look for this too, but note that 0xac is one byte of one of the
Unicode encodings of the Euro symbol.  Given there've been two reports
of this, I'd also start to have a look for different Unicode versions.
There might be a library problem here.

A

-- 
Andrew Sullivan
ajs at crankycanuck.ca

From ajs at crankycanuck.ca  Fri Apr 30 07:44:43 2010
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Fri, 30 Apr 2010 10:44:43 -0400
Subject: [Slony1-general] encoding problems
In-Reply-To: <20100430134920.GK9077@shinkuro.com>
References: <alpine.LRH.1.10.1004271915240.24242@corp1.xtenit.com>
	<4BD9D328.8090701@Yahoo.com> <20100430134920.GK9077@shinkuro.com>
Message-ID: <20100430144443.GN9077@shinkuro.com>

On Fri, Apr 30, 2010 at 09:49:20AM -0400, Andrew Sullivan wrote:
> I'd look for this too, but note that 0xac is one byte of one of the
> Unicode encodings of the Euro symbol.  Given there've been two reports
> of this, I'd also start to have a look for different Unicode versions.
> There might be a library problem here.

Digging a little more at the Unicode tables, I also note that this is
the ISO 8859-1 and Win CP 1257 encoding for NOT SIGN.  The Unicode
encoding for this is one of {0x000000AC || 0x00AC || 0xC2 0xAC}
depending on the encoding scheme.  Any chance one of the machines
involved in these reports is a Windows machine?  Could this be due to
the native UTF-16 vs. native UTF-8 issue?

A

-- 
Andrew Sullivan
ajs at shinkuro.com
Shinkuro, Inc.

From leon at solatis.com  Fri Apr 30 07:45:51 2010
From: leon at solatis.com (Leon Mergen)
Date: Fri, 30 Apr 2010 16:45:51 +0200
Subject: [Slony1-general] encoding problems
In-Reply-To: <4BDACBD0.8040304@Yahoo.com>
References: <alpine.LRH.1.10.1004271915240.24242@corp1.xtenit.com>
	<1272626678.2247.132.camel@hp-laptop2.gunduz.org>
	<4BDACBD0.8040304@Yahoo.com>
Message-ID: <w2x5eaaef181004300745hba1b660due55c419ed505c6f2@mail.gmail.com>

Hello,

2010/4/30 Jan Wieck <JanWieck at yahoo.com>
>
> > FWIW, I am hitting this issue, too. This does not happen in 1.2.X.
> >
> > Both machines are very identical (using the same postgresql.conf), and
> > they are running 8.4.3 with RPM installations. FWIW I had this issue in
> > 2.0.3RC3, too.
> >
> > I had to use 1.2.21 yesterday night on a new installation.
>
> Is anyone able to give me one single text datum that will cause this?
>

I am running Slony 2.0.3 against Postgres 8.4.3 ?on a CentOS 5.5
machine, and am running into the same issue. This is a development
machine, and the two slony / database instances are both on the same
machine, so library incompatibilities/etc are exluded.
The PostgreSQL logfile says something like this:
--
LOG:  statement: begin transaction; set transaction isolation level
serializable;
LOG:  statement: select SSY.ssy_setid, SSY.ssy_seqno,
"pg_catalog".txid_snapshot_xmax(SSY.ssy_snapshot),
SSY.ssy_snapshot,     SSY.ssy_action_list from "_tsukku".sl_setsync
SSY where SSY.ssy_seqno < '5000000742'     and SSY.ssy_setid in
(1,2,3);
LOG:  statement: select T.tab_id, T.tab_set,
"_tsukku".slon_quote_brute(PGN.nspname) || '.' ||
"_tsukku".slon_quote_brute (PGC.relname) as tab_fqname from
"_tsukku".sl_table T, "pg_catalog".pg_class PGC,
"pg_catalog".pg_namespace PGN where T.tab_set = 1     and PGC.oid =
T.tab_reloid     and PGC.relnamespace = PGN.oid;
LOG:  statement: select T.tab_id, T.tab_set,
"_tsukku".slon_quote_brute(PGN.nspname) || '.' ||
"_tsukku".slon_quote_brute (PGC.relname) as tab_fqname from
"_tsukku".sl_table T,     "pg_catalog".pg_class PGC,
"pg_catalog".pg_namespace PGN where T.tab_set = 2     and PGC.oid =
T.tab_reloid     and PGC.relnamespace = PGN.oid;
LOG:  statement: select T.tab_id, T.tab_set,
"_tsukku".slon_quote_brute(PGN.nspname) || '.' ||
"_tsukku".slon_quote_brute (PGC.relname) as tab_fqname from
"_tsukku".sl_table T,     "pg_catalog".pg_class PGC,
"pg_catalog".pg_namespace PGN where T.tab_set = 3     and PGC.oid =
T.tab_reloid     and PGC.relnamespace = PGN.oid;
LOG:  statement: select last_value from "_tsukku".sl_log_status
ERROR:  invalid byte sequence for encoding "UTF8": 0xb0
HINT:  This error can also happen if the byte sequence does not match
the encoding expected by the server, which is controlled by
"client_encoding".
ERROR:  invalid byte sequence for encoding "UTF8": 0xb0
HINT:  This error can also happen if the byte sequence does not match
the encoding expected by the server, which is controlled by
"client_encoding".
LOG:  statement: rollback transaction
--

I will try to find out what log entry is causing the trouble.

From cbbrowne at ca.afilias.info  Fri Apr 30 08:00:45 2010
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri, 30 Apr 2010 11:00:45 -0400
Subject: [Slony1-general] [slony1-general] initial copy incomplete when
	using 2.0.3rc2
In-Reply-To: <4BD9C984.1060704@ca.afilias.info> (Steve Singer's message of
	"Thu, 29 Apr 2010 14:01:40 -0400")
References: <3073cc9b0910130942l98cebcfkc0c98fa33daa4db8@mail.gmail.com>
	<3073cc9b1003202107gdc3373fqf9b8434e25f407cf@mail.gmail.com>
	<4BA824E7.8040706@ca.afilias.info>
	<3073cc9b1003242143s517f7675s75fa42cda338b483@mail.gmail.com>
	<3073cc9b1003251031l2104937dtf87e7629d3994112@mail.gmail.com>
	<4BD9C984.1060704@ca.afilias.info>
Message-ID: <87y6g5ugrm.fsf@ca.afilias.info>

Steve Singer <ssinger at ca.afilias.info> writes:
> Jaime Casanova wrote:
>> On Thu, Mar 25, 2010 at 12:43 AM, Jaime Casanova
>
> Recall this was an issue where some inherited tables don't seem to have 
> any data in them after the initial set copy.
>
>
>>>> I'm trying to get a sense of if this is a problem that is being triggered by
>>>> some schemas with inheritance tables or if it is that some of your data is
>>>> causing things to fail (which still shouldn't happen)
>>>>
>>> yeah! i'm trying to figure out what caused the rollback if any
>>>
>> 
>> thinking a bit more on this, this should be as many rollbacks as
>> children has tcom_invitacion (one per month since 200803), and the log
>> shows that they were copied in 3 groups with other tables (that copied
>> fine) between those groups.
>> 
>> so, the one million question is: why "only" those tables?
>> i have another partitioned table but that was fine
>
> I think you will find that the difference is that the inherited table 
> has a lower slony table id (the id in the 'set add table') then the 
> master table.  The 'testinherit' test case in the regression tests 
> directory actually reproduces this (if one takes the time to look at the 
> output, which I should have been doing).
>
> However, this only seems to be a problem with 8.4, it works fine when I 
> run it against 8.3
>
>
>
> I have created bug 118 
> (http://www.slony.info/bugzilla/show_bug.cgi?id=118) to track this

Wow, finally a way of exposing some significance in the choice of table
ID numbers!

Not sure I want it to be significant, but it's finally something visible
:-).
-- 
"cbbrowne","@","ca.afilias.info"
Christopher Browne
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"

From ssinger at ca.afilias.info  Fri Apr 30 08:39:58 2010
From: ssinger at ca.afilias.info (Steve Singer)
Date: Fri, 30 Apr 2010 11:39:58 -0400
Subject: [Slony1-general] encoding problems
In-Reply-To: <w2x5eaaef181004300745hba1b660due55c419ed505c6f2@mail.gmail.com>
References: <alpine.LRH.1.10.1004271915240.24242@corp1.xtenit.com>	<1272626678.2247.132.camel@hp-laptop2.gunduz.org>	<4BDACBD0.8040304@Yahoo.com>
	<w2x5eaaef181004300745hba1b660due55c419ed505c6f2@mail.gmail.com>
Message-ID: <4BDAF9CE.1080306@ca.afilias.info>

Leon Mergen wrote:
> Hello,
> 
> --
> 
> I will try to find out what log entry is causing the trouble.
> 

Do the tables that these errors come from typically get large 
insert/update statements or small ones?

(this is directed at anyone who's seen the issue)


_______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


-- 
Steve Singer
Afilias Canada
Data Services Developer
416-673-1142

From devrim at gunduz.org  Fri Apr 30 08:42:47 2010
From: devrim at gunduz.org (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Fri, 30 Apr 2010 18:42:47 +0300
Subject: [Slony1-general] encoding problems
In-Reply-To: <4BDAF9CE.1080306@ca.afilias.info>
References: <alpine.LRH.1.10.1004271915240.24242@corp1.xtenit.com>
	<1272626678.2247.132.camel@hp-laptop2.gunduz.org>
	<4BDACBD0.8040304@Yahoo.com>
	<w2x5eaaef181004300745hba1b660due55c419ed505c6f2@mail.gmail.com>
	<4BDAF9CE.1080306@ca.afilias.info>
Message-ID: <1272642167.2247.159.camel@hp-laptop2.gunduz.org>

On Fri, 2010-04-30 at 11:39 -0400, Steve Singer wrote:
> 
> Do the tables that these errors come from typically get large 
> insert/update statements or small ones? 

I'm getting this error during initial sync, so I can't say anything
about that.
-- 
Devrim G?ND?Z
PostgreSQL Dan??man?/Consultant, Red Hat Certified Engineer
PostgreSQL RPM Repository: http://yum.pgrpms.org
Community: devrim~PostgreSQL.org, devrim.gunduz~linux.org.tr
http://www.gunduz.org  Twitter: http://twitter.com/devrimgunduz


From leon at solatis.com  Fri Apr 30 08:43:50 2010
From: leon at solatis.com (Leon Mergen)
Date: Fri, 30 Apr 2010 17:43:50 +0200
Subject: [Slony1-general] encoding problems
In-Reply-To: <4BDAF9CE.1080306@ca.afilias.info>
References: <alpine.LRH.1.10.1004271915240.24242@corp1.xtenit.com>
	<1272626678.2247.132.camel@hp-laptop2.gunduz.org>
	<4BDACBD0.8040304@Yahoo.com>
	<w2x5eaaef181004300745hba1b660due55c419ed505c6f2@mail.gmail.com>
	<4BDAF9CE.1080306@ca.afilias.info>
Message-ID: <t2p5eaaef181004300843ma3e12949r941445fe323ea291@mail.gmail.com>

Hello Steve,

On Fri, Apr 30, 2010 at 5:39 PM, Steve Singer <ssinger at ca.afilias.info> wrote:
>> I will try to find out what log entry is causing the trouble.
>>
>
> Do the tables that these errors come from typically get large insert/update
> statements or small ones?
>
> (this is directed at anyone who's seen the issue)

I'm still trying to isolate the issue a bit, but at the moment it
looks like this issue is triggered by a very large INSERT statement
(as in, a statement with a very large value);

Regards,

Leon Mergen

From ssinger at ca.afilias.info  Fri Apr 30 09:11:31 2010
From: ssinger at ca.afilias.info (Steve Singer)
Date: Fri, 30 Apr 2010 12:11:31 -0400
Subject: [Slony1-general] encoding problems
In-Reply-To: <t2p5eaaef181004300843ma3e12949r941445fe323ea291@mail.gmail.com>
References: <alpine.LRH.1.10.1004271915240.24242@corp1.xtenit.com>	
	<1272626678.2247.132.camel@hp-laptop2.gunduz.org>	
	<4BDACBD0.8040304@Yahoo.com>	
	<w2x5eaaef181004300745hba1b660due55c419ed505c6f2@mail.gmail.com>	
	<4BDAF9CE.1080306@ca.afilias.info>
	<t2p5eaaef181004300843ma3e12949r941445fe323ea291@mail.gmail.com>
Message-ID: <4BDB0133.8040705@ca.afilias.info>

Leon Mergen wrote:
> Hello Steve,
> 
> On Fri, Apr 30, 2010 at 5:39 PM, Steve Singer <ssinger at ca.afilias.info> wrote:
>>> I will try to find out what log entry is causing the trouble.
>>>
>> Do the tables that these errors come from typically get large insert/update
>> statements or small ones?
>>
>> (this is directed at anyone who's seen the issue)
> 
> I'm still trying to isolate the issue a bit, but at the moment it
> looks like this issue is triggered by a very large INSERT statement
> (as in, a statement with a very large value);
> 
> Regards,
> 

Your issue with the larger values are being caused by an attempt at 
removing a memory leak checked into 2.0.3 that free's memory a bit too 
soon.  I will post a patch for this later today.   I think the INSERT 
statement is being corrupted causing invalid characters to be put in.


What Devrim's is seeing where the initial copy fails would be a 
different issue.

> Leon Mergen


-- 
Steve Singer
Afilias Canada
Data Services Developer
416-673-1142

From leon at solatis.com  Fri Apr 30 09:17:57 2010
From: leon at solatis.com (Leon Mergen)
Date: Fri, 30 Apr 2010 18:17:57 +0200
Subject: [Slony1-general] encoding problems
In-Reply-To: <4BDB0133.8040705@ca.afilias.info>
References: <alpine.LRH.1.10.1004271915240.24242@corp1.xtenit.com>
	<1272626678.2247.132.camel@hp-laptop2.gunduz.org>
	<4BDACBD0.8040304@Yahoo.com>
	<w2x5eaaef181004300745hba1b660due55c419ed505c6f2@mail.gmail.com>
	<4BDAF9CE.1080306@ca.afilias.info>
	<t2p5eaaef181004300843ma3e12949r941445fe323ea291@mail.gmail.com>
	<4BDB0133.8040705@ca.afilias.info>
Message-ID: <g2x5eaaef181004300917rd4aa39edzbe215f96c64a806d@mail.gmail.com>

Hello Steve,

On Fri, Apr 30, 2010 at 6:11 PM, Steve Singer <ssinger at ca.afilias.info> wrote:
>>>> I will try to find out what log entry is causing the trouble.
>>>>
>>> Do the tables that these errors come from typically get large
>>> insert/update
>>> statements or small ones?
>>>
>>> (this is directed at anyone who's seen the issue)
>>
>> I'm still trying to isolate the issue a bit, but at the moment it
>> looks like this issue is triggered by a very large INSERT statement
>> (as in, a statement with a very large value);
>>
>> Regards,
>>
>
> Your issue with the larger values are being caused by an attempt at removing
> a memory leak checked into 2.0.3 that free's memory a bit too soon. ?I will
> post a patch for this later today. ? I think the INSERT statement is being
> corrupted causing invalid characters to be put in.

Ok, thanks for the information. It looks like you are correct. I have
done some investigation, and am receiving different errors right now,
but it appears to be caused by the same issue:

The pg_log entry says this:

---

LOG:  statement: insert into "_tsukku".sl_log_2     (log_origin,
log_txid, log_tableid,      log_actionseq, log_cmdtype,
log_cmddata) values     ('1', '22643', '121', '58', 'I',
'("id","state","ping","perc","last_monitor_update","input","output","hadoop_task_id")
values (''15324'',NULL,''2010-04-30
16:07:02.482649'',NULL,''2010-04-30
16:07:02.482649'',''/solatis/tsukku/store/requests/2010/04/30/'',''/solatis/tsukku/mapreduce/check_uncommitted_log_transactions/69efacb6-5472-11df-8fee-0050562fea49'',NULL)');
insert into "_tsukku".sl_log_2     (log_origin, log_txid, log_tableid,
     log_actionseq, log_cmdtype,      log_cmddata) values     ('1',
'22643', '122', '59', 'I', '("map_reduce_task_id","key","value")
values (''15324'',''solatis.tsukku.task.type'',''4'')');
insert into "_tsukku".sl_log_2     (log_origin, log_txid, log_tableid,
     log_actionseq, log_cmdtype,      log_cmddata) values     ('1',
'22643', '122', '60', 'I', '("map_reduce_task_id","key","value")
values (''15324'',''hadoop.pipes.executable'',''/solatis/tsukku/bin/mapreduce'')');
insert into "_tsukku".sl_log_2     (log_origin, log_txid, log_tableid,
     log_actionseq, log_cmdtype,      log_cmddata) values     ('1',
'22643', '122', '61', 'I', '("map_reduce_task_id","key","value")
values (''15324'',''mapred.child.java.opts'',''-Xmx256m'')');
insert into "_tsukku".sl_log_2     (log_origin, log_txid, log_tableid,
     log_actionseq, log_cmdtype,      log_cmddata) values     ('1',
'22643', '122', '62', 'I', '`dn');
insert into "_tsukku".sl_log_2     (log_origin, log_txid, log_tableid,
     log_actionseq, log_cmdtype,      log_cmddata) values     ('1',
'22643', '122', '63', 'I', '("map_reduce_task_id","key","value")
values (''15324'',''solatis.tsukku.task.log.begin_date'',''20100324'')');
insert into "_tsukku".sl_log_2     (log_origin, log_txid, log_tableid,
     log_actionseq, log_cmdtype,      log_cmddata) values     ('1',
'22643', '122', '64', 'I', '("map_reduce_task_id","key","value")
values (''15324'',''solatis.tsukku.task.log.end_date'',''20100430'')');

ERROR:  syntax error at or near "`" at character 830

---

So, when searching for the "`" character, we see this line:

insert into "_tsukku".sl_log_2     (log_origin, log_txid, log_tableid,
     log_actionseq, log_cmdtype,      log_cmddata) values     ('1',
'22643', '122', '62', 'I', '`dn');

Looking up that entry in the master database indeed brings up the
large INSERT statement. For what it's worth:

---
tsukku=# select char_length (log_cmddata) from _tsukku.sl_log_2 where
log_txid = 22643 and log_actionseq = 62;
 char_length
-------------
       60533
(1 row)
---

Thanks for your help. In the meantime, is there anything I can do to
work around this issue?

Regards,

Leon Mergen

From JanWieck at Yahoo.com  Fri Apr 30 10:27:40 2010
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Fri, 30 Apr 2010 13:27:40 -0400
Subject: [Slony1-general] encoding problems
In-Reply-To: <4BDB0133.8040705@ca.afilias.info>
References: <alpine.LRH.1.10.1004271915240.24242@corp1.xtenit.com>		<1272626678.2247.132.camel@hp-laptop2.gunduz.org>		<4BDACBD0.8040304@Yahoo.com>		<w2x5eaaef181004300745hba1b660due55c419ed505c6f2@mail.gmail.com>		<4BDAF9CE.1080306@ca.afilias.info>	<t2p5eaaef181004300843ma3e12949r941445fe323ea291@mail.gmail.com>
	<4BDB0133.8040705@ca.afilias.info>
Message-ID: <4BDB130C.2060407@Yahoo.com>

On 4/30/2010 12:11 PM, Steve Singer wrote:
> Leon Mergen wrote:
>> Hello Steve,
>> 
>> On Fri, Apr 30, 2010 at 5:39 PM, Steve Singer <ssinger at ca.afilias.info> wrote:
>>>> I will try to find out what log entry is causing the trouble.
>>>>
>>> Do the tables that these errors come from typically get large insert/update
>>> statements or small ones?
>>>
>>> (this is directed at anyone who's seen the issue)
>> 
>> I'm still trying to isolate the issue a bit, but at the moment it
>> looks like this issue is triggered by a very large INSERT statement
>> (as in, a statement with a very large value);
>> 
>> Regards,
>> 
> 
> Your issue with the larger values are being caused by an attempt at 
> removing a memory leak checked into 2.0.3 that free's memory a bit too 
> soon.  I will post a patch for this later today.   I think the INSERT 
> statement is being corrupted causing invalid characters to be put in.
> 
> 
> What Devrim's is seeing where the initial copy fails would be a 
> different issue.

I understood Devrim as that it happens during the initial sync. That is 
not the copy_set.


Jan

-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin

From JanWieck at Yahoo.com  Fri Apr 30 10:29:42 2010
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Fri, 30 Apr 2010 13:29:42 -0400
Subject: [Slony1-general] encoding problems
In-Reply-To: <20100430144443.GN9077@shinkuro.com>
References: <alpine.LRH.1.10.1004271915240.24242@corp1.xtenit.com>	<4BD9D328.8090701@Yahoo.com>
	<20100430134920.GK9077@shinkuro.com>
	<20100430144443.GN9077@shinkuro.com>
Message-ID: <4BDB1386.30803@Yahoo.com>

On 4/30/2010 10:44 AM, Andrew Sullivan wrote:
> On Fri, Apr 30, 2010 at 09:49:20AM -0400, Andrew Sullivan wrote:
>> I'd look for this too, but note that 0xac is one byte of one of the
>> Unicode encodings of the Euro symbol.  Given there've been two reports
>> of this, I'd also start to have a look for different Unicode versions.
>> There might be a library problem here.
> 
> Digging a little more at the Unicode tables, I also note that this is
> the ISO 8859-1 and Win CP 1257 encoding for NOT SIGN.  The Unicode
> encoding for this is one of {0x000000AC || 0x00AC || 0xC2 0xAC}
> depending on the encoding scheme.  Any chance one of the machines
> involved in these reports is a Windows machine?  Could this be due to
> the native UTF-16 vs. native UTF-8 issue?

Right now it looks more like a dangling pointer issue, which behaves 
different depending on OS and libc version.


Jan

-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin

From peter.geoghegan86 at gmail.com  Fri Apr 30 10:48:39 2010
From: peter.geoghegan86 at gmail.com (Peter Geoghegan)
Date: Fri, 30 Apr 2010 17:48:39 -0000
Subject: [Slony1-general] [Slony1-hackers]   Upcoming slony releases
In-Reply-To: <4BBB523E.4000001@ca.afilias.info>
References: <4BB4AE20.3030305@ca.afilias.info>
	<1270558562.11550.8.camel@hp-laptop2.gunduz.org>
	<4BBB523E.4000001@ca.afilias.info>
Message-ID: <y2xdb471ace1004060831j33413918xb4e0bc4c5246375e@mail.gmail.com>

> The plan is to tag + package release candidates late this afternoon
> (eastern North American time). ?If we get some successful reports from
> the release candidate we could package an actual release in a few days?

Are you talking about a further Slony 2.0.3RC, before the actual
release of 2.0.3?

Regards,
Peter Geoghegan
_______________________________________________
Slony1-hackers mailing list
Slony1-hackers at lists.slony.info
http://lists.slony.info/mailman/listinfo/slony1-hackers

From peter.geoghegan86 at gmail.com  Fri Apr 30 10:49:03 2010
From: peter.geoghegan86 at gmail.com (Peter Geoghegan)
Date: Fri, 30 Apr 2010 17:49:03 -0000
Subject: [Slony1-general] [Slony1-hackers]   Upcoming slony releases
In-Reply-To: <4BBB523E.4000001@ca.afilias.info>
References: <4BB4AE20.3030305@ca.afilias.info>
	<1270558562.11550.8.camel@hp-laptop2.gunduz.org>
	<4BBB523E.4000001@ca.afilias.info>
Message-ID: <y2xdb471ace1004060831j33413918xb4e0bc4c5246375e@mail.gmail.com>

> The plan is to tag + package release candidates late this afternoon
> (eastern North American time). ?If we get some successful reports from
> the release candidate we could package an actual release in a few days?

Are you talking about a further Slony 2.0.3RC, before the actual
release of 2.0.3?

Regards,
Peter Geoghegan
_______________________________________________
Slony1-hackers mailing list
Slony1-hackers at lists.slony.info
http://lists.slony.info/mailman/listinfo/slony1-hackers

From ssinger at ca.afilias.info  Fri Apr 30 11:17:47 2010
From: ssinger at ca.afilias.info (Steve Singer)
Date: Fri, 30 Apr 2010 14:17:47 -0400
Subject: [Slony1-general] encoding problems
In-Reply-To: <g2x5eaaef181004300917rd4aa39edzbe215f96c64a806d@mail.gmail.com>
References: <alpine.LRH.1.10.1004271915240.24242@corp1.xtenit.com>	
	<1272626678.2247.132.camel@hp-laptop2.gunduz.org>	
	<4BDACBD0.8040304@Yahoo.com>	
	<w2x5eaaef181004300745hba1b660due55c419ed505c6f2@mail.gmail.com>	
	<4BDAF9CE.1080306@ca.afilias.info>	
	<t2p5eaaef181004300843ma3e12949r941445fe323ea291@mail.gmail.com>	
	<4BDB0133.8040705@ca.afilias.info>
	<g2x5eaaef181004300917rd4aa39edzbe215f96c64a806d@mail.gmail.com>
Message-ID: <4BDB1ECB.8020502@ca.afilias.info>

Leon Mergen wrote:
> Hello Steve,
> 
> Thanks for your help. In the meantime, is there anything I can do to
> work around this issue?
> 
> Regards,

Attached is a patch that should resolve the issue with large rows.  I 
would like to know if it fixes all of the utf8 issues discussed on this 
thread or if they are still outstanding.

When Jan reviews the patch and gives it an okay we can commit it to cvs.


I've also applied this patch against the REL_2_0_PROPOSED_ssinger branch 
of at github (http://github.com/ssinger/slony).  In theory a tarball 
version of the 2_0 source with this change applied can be obtained at 
http://github.com/ssinger/slony/tarball/REL2_0_PROPOSED_ssinger




> 
> Leon Mergen


-- 
Steve Singer
Afilias Canada
Data Services Developer
416-673-1142
-------------- next part --------------
A non-text attachment was scrubbed...
Name: slon_largetuples_fix.diff
Type: text/x-patch
Size: 1075 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20100430/7bb068e3/attachment.bin 

From JanWieck at Yahoo.com  Fri Apr 30 11:37:32 2010
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Fri, 30 Apr 2010 14:37:32 -0400
Subject: [Slony1-general] [Slony1-patches]  encoding problems
In-Reply-To: <4BDB1ECB.8020502@ca.afilias.info>
References: <alpine.LRH.1.10.1004271915240.24242@corp1.xtenit.com>		<1272626678.2247.132.camel@hp-laptop2.gunduz.org>		<4BDACBD0.8040304@Yahoo.com>		<w2x5eaaef181004300745hba1b660due55c419ed505c6f2@mail.gmail.com>		<4BDAF9CE.1080306@ca.afilias.info>		<t2p5eaaef181004300843ma3e12949r941445fe323ea291@mail.gmail.com>		<4BDB0133.8040705@ca.afilias.info>	<g2x5eaaef181004300917rd4aa39edzbe215f96c64a806d@mail.gmail.com>
	<4BDB1ECB.8020502@ca.afilias.info>
Message-ID: <4BDB236C.6050908@Yahoo.com>

On 4/30/2010 2:17 PM, Steve Singer wrote:
> Leon Mergen wrote:
>> Hello Steve,
>> 
>> Thanks for your help. In the meantime, is there anything I can do to
>> work around this issue?
>> 
>> Regards,
> 
> Attached is a patch that should resolve the issue with large rows.  I 
> would like to know if it fixes all of the utf8 issues discussed on this 
> thread or if they are still outstanding.
> 
> When Jan reviews the patch and gives it an okay we can commit it to cvs.

 From just reading the patch, this looks slightly wrong. There seems to 
be a code path that leaves a memory leak again. Let me create a slightly 
different patch.


Jan

> 
> 
> I've also applied this patch against the REL_2_0_PROPOSED_ssinger branch 
> of at github (http://github.com/ssinger/slony).  In theory a tarball 
> version of the 2_0 source with this change applied can be obtained at 
> http://github.com/ssinger/slony/tarball/REL2_0_PROPOSED_ssinger
> 
> 
> 
> 
>> 
>> Leon Mergen
> 
> 
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> Slony1-patches mailing list
> Slony1-patches at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-patches


-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin

From jks at selectacast.net  Fri Apr 30 12:09:57 2010
From: jks at selectacast.net (Joseph S)
Date: Fri, 30 Apr 2010 15:09:57 -0400 (EDT)
Subject: [Slony1-general] encoding problems
In-Reply-To: <t2p5eaaef181004300843ma3e12949r941445fe323ea291@mail.gmail.com>
References: <alpine.LRH.1.10.1004271915240.24242@corp1.xtenit.com>
	<1272626678.2247.132.camel@hp-laptop2.gunduz.org>
	<4BDACBD0.8040304@Yahoo.com>
	<w2x5eaaef181004300745hba1b660due55c419ed505c6f2@mail.gmail.com>
	<4BDAF9CE.1080306@ca.afilias.info>
	<t2p5eaaef181004300843ma3e12949r941445fe323ea291@mail.gmail.com>
Message-ID: <alpine.LRH.1.10.1004301509180.17087@corp1.xtenit.com>



On Fri, 30 Apr 2010, Leon Mergen wrote:

> Hello Steve,
>
> On Fri, Apr 30, 2010 at 5:39 PM, Steve Singer <ssinger at ca.afilias.info> wrote:
>>> I will try to find out what log entry is causing the trouble.
>>>
>>
>> Do the tables that these errors come from typically get large insert/update
>> statements or small ones?
>>
Yes, the table that I think is causing the problem has a large text field.

From JanWieck at Yahoo.com  Fri Apr 30 12:34:05 2010
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Fri, 30 Apr 2010 15:34:05 -0400
Subject: [Slony1-general] [Slony1-patches]  encoding problems
In-Reply-To: <4BDB236C.6050908@Yahoo.com>
References: <alpine.LRH.1.10.1004271915240.24242@corp1.xtenit.com>		<1272626678.2247.132.camel@hp-laptop2.gunduz.org>		<4BDACBD0.8040304@Yahoo.com>		<w2x5eaaef181004300745hba1b660due55c419ed505c6f2@mail.gmail.com>		<4BDAF9CE.1080306@ca.afilias.info>		<t2p5eaaef181004300843ma3e12949r941445fe323ea291@mail.gmail.com>		<4BDB0133.8040705@ca.afilias.info>	<g2x5eaaef181004300917rd4aa39edzbe215f96c64a806d@mail.gmail.com>
	<4BDB1ECB.8020502@ca.afilias.info> <4BDB236C.6050908@Yahoo.com>
Message-ID: <4BDB30AD.4020505@Yahoo.com>

On 4/30/2010 2:37 PM, Jan Wieck wrote:
> On 4/30/2010 2:17 PM, Steve Singer wrote:
>> Leon Mergen wrote:
>>> Hello Steve,
>>> 
>>> Thanks for your help. In the meantime, is there anything I can do to
>>> work around this issue?
>>> 
>>> Regards,
>> 
>> Attached is a patch that should resolve the issue with large rows.  I 
>> would like to know if it fixes all of the utf8 issues discussed on this 
>> thread or if they are still outstanding.
>> 
>> When Jan reviews the patch and gives it an okay we can commit it to cvs.
> 
>  From just reading the patch, this looks slightly wrong. There seems to 
> be a code path that leaves a memory leak again. Let me create a slightly 
> different patch.

Attached.


Jan

-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin
-------------- next part --------------
A non-text attachment was scrubbed...
Name: remote_worker.diff
Type: text/x-patch
Size: 1389 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20100430/6bcb5d4a/attachment.bin 

From JanWieck at Yahoo.com  Fri Apr 30 13:15:09 2010
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Fri, 30 Apr 2010 16:15:09 -0400
Subject: [Slony1-general] [Slony1-patches]  encoding problems
In-Reply-To: <4BDB30AD.4020505@Yahoo.com>
References: <alpine.LRH.1.10.1004271915240.24242@corp1.xtenit.com>		<1272626678.2247.132.camel@hp-laptop2.gunduz.org>		<4BDACBD0.8040304@Yahoo.com>		<w2x5eaaef181004300745hba1b660due55c419ed505c6f2@mail.gmail.com>		<4BDAF9CE.1080306@ca.afilias.info>		<t2p5eaaef181004300843ma3e12949r941445fe323ea291@mail.gmail.com>		<4BDB0133.8040705@ca.afilias.info>	<g2x5eaaef181004300917rd4aa39edzbe215f96c64a806d@mail.gmail.com>	<4BDB1ECB.8020502@ca.afilias.info>
	<4BDB236C.6050908@Yahoo.com> <4BDB30AD.4020505@Yahoo.com>
Message-ID: <4BDB3A4D.60706@Yahoo.com>

On 4/30/2010 3:34 PM, Jan Wieck wrote:
> On 4/30/2010 2:37 PM, Jan Wieck wrote:
>> On 4/30/2010 2:17 PM, Steve Singer wrote:
>>> Leon Mergen wrote:
>>>> Hello Steve,
>>>> 
>>>> Thanks for your help. In the meantime, is there anything I can do to
>>>> work around this issue?
>>>> 
>>>> Regards,
>>> 
>>> Attached is a patch that should resolve the issue with large rows.  I 
>>> would like to know if it fixes all of the utf8 issues discussed on this 
>>> thread or if they are still outstanding.
>>> 
>>> When Jan reviews the patch and gives it an okay we can commit it to cvs.
>> 
>>  From just reading the patch, this looks slightly wrong. There seems to 
>> be a code path that leaves a memory leak again. Let me create a slightly 
>> different patch.
> 
> Attached.

Attached again. This time without adding another bug.


Jan

-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin
-------------- next part --------------
A non-text attachment was scrubbed...
Name: remote_worker.diff
Type: text/x-patch
Size: 1671 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20100430/6ff6e496/attachment.bin 

From ssinger at ca.afilias.info  Fri Apr 30 15:00:59 2010
From: ssinger at ca.afilias.info (Steve Singer)
Date: Fri, 30 Apr 2010 18:00:59 -0400
Subject: [Slony1-general] [Slony1-patches]    encoding problems
In-Reply-To: <4BDB3A4D.60706@Yahoo.com>
References: <alpine.LRH.1.10.1004271915240.24242@corp1.xtenit.com>		<1272626678.2247.132.camel@hp-laptop2.gunduz.org>		<4BDACBD0.8040304@Yahoo.com>		<w2x5eaaef181004300745hba1b660due55c419ed505c6f2@mail.gmail.com>		<4BDAF9CE.1080306@ca.afilias.info>		<t2p5eaaef181004300843ma3e12949r941445fe323ea291@mail.gmail.com>		<4BDB0133.8040705@ca.afilias.info>	<g2x5eaaef181004300917rd4aa39edzbe215f96c64a806d@mail.gmail.com>	<4BDB1ECB.8020502@ca.afilias.info>	<4BDB236C.6050908@Yahoo.com>
	<4BDB30AD.4020505@Yahoo.com> <4BDB3A4D.60706@Yahoo.com>
Message-ID: <4BDB531B.6070901@ca.afilias.info>

Jan Wieck wrote:

> 
> Attached again. This time without adding another bug.
> 

This version looks fine to me.

I have committed it to REL_2_0_STABLE.





> 
> Jan
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> Slony1-patches mailing list
> Slony1-patches at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-patches


-- 
Steve Singer
Afilias Canada
Data Services Developer
416-673-1142

From JanWieck at Yahoo.com  Fri Apr 30 16:42:01 2010
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Fri, 30 Apr 2010 19:42:01 -0400
Subject: [Slony1-general] [Slony1-patches]    encoding problems
In-Reply-To: <4BDB531B.6070901@ca.afilias.info>
References: <alpine.LRH.1.10.1004271915240.24242@corp1.xtenit.com>		<1272626678.2247.132.camel@hp-laptop2.gunduz.org>		<4BDACBD0.8040304@Yahoo.com>		<w2x5eaaef181004300745hba1b660due55c419ed505c6f2@mail.gmail.com>		<4BDAF9CE.1080306@ca.afilias.info>		<t2p5eaaef181004300843ma3e12949r941445fe323ea291@mail.gmail.com>		<4BDB0133.8040705@ca.afilias.info>	<g2x5eaaef181004300917rd4aa39edzbe215f96c64a806d@mail.gmail.com>	<4BDB1ECB.8020502@ca.afilias.info>	<4BDB236C.6050908@Yahoo.com>	<4BDB30AD.4020505@Yahoo.com>
	<4BDB3A4D.60706@Yahoo.com> <4BDB531B.6070901@ca.afilias.info>
Message-ID: <4BDB6AC9.907@Yahoo.com>

On 4/30/2010 6:00 PM, Steve Singer wrote:
> Jan Wieck wrote:
> 
>> 
>> Attached again. This time without adding another bug.
>> 
> 
> This version looks fine to me.
> 
> I have committed it to REL_2_0_STABLE.

I committed the same to HEAD and backpatched REL_1_2_STABLE with the two 
memory leaks, the original 2.0 patch tried to fix by moving the 
PQclear() up.


Jan

-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin

