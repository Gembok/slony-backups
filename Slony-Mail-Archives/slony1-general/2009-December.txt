From vivek at khera.org  Tue Dec  1 11:04:37 2009
From: vivek at khera.org (Vick Khera)
Date: Tue Dec  1 11:04:41 2009
Subject: [Slony1-general] PGRES_FATAL_ERROR ERROR: cannot change return 
	type of existing function
In-Reply-To: <6CA951EC-BD82-4EB8-ADFC-F64103721155@torgo.978.org>
References: <714911.80539.qm@web23601.mail.ird.yahoo.com>
	<20091021085504.21101bhuhw2q3cmg@webmail.afilias.info>
	<6CA951EC-BD82-4EB8-ADFC-F64103721155@torgo.978.org>
Message-ID: <2968dfd60912011104y652a9fc8v474374daa9f57f87@mail.gmail.com>

any possibility of snapping a 1.2.18 with the fix for this problem?
people on freebsd lists keep asking to update the port from 1.2.16,
but I cannot do that since it will break existing 1.2.17 installations
on upgrade.

On Fri, Oct 23, 2009 at 9:10 AM, Jeff <threshar@torgo.978.org> wrote:
>
> On Oct 21, 2009, at 8:55 AM, Christopher Browne wrote:
>>
>> The following patch should rectify this...
  [ ... ]
>> That's working and committed to 2.0 + HEAD.
>>
>
> This works for me.
> My origin is 8.2, slave is 8.4 (preparing for an upgrade! wheeee!)
>
From cbbrowne at ca.afilias.info  Tue Dec  1 12:54:39 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Tue Dec  1 12:54:53 2009
Subject: [Slony1-general] PGRES_FATAL_ERROR ERROR: cannot change return
	type of existing function
In-Reply-To: <2968dfd60912011104y652a9fc8v474374daa9f57f87@mail.gmail.com>
References: <714911.80539.qm@web23601.mail.ird.yahoo.com>	<20091021085504.21101bhuhw2q3cmg@webmail.afilias.info>	<6CA951EC-BD82-4EB8-ADFC-F64103721155@torgo.978.org>
	<2968dfd60912011104y652a9fc8v474374daa9f57f87@mail.gmail.com>
Message-ID: <4B15828F.5030002@ca.afilias.info>

Vick Khera wrote:
> any possibility of snapping a 1.2.18 with the fix for this problem?
> people on freebsd lists keep asking to update the port from 1.2.16,
> but I cannot do that since it will break existing 1.2.17 installations
> on upgrade.
>
> On Fri, Oct 23, 2009 at 9:10 AM, Jeff <threshar@torgo.978.org> wrote:
>   
>> On Oct 21, 2009, at 8:55 AM, Christopher Browne wrote:
>>     
>>> The following patch should rectify this...
>>>       
>   [ ... ]
>   
>>> That's working and committed to 2.0 + HEAD.
>>>
>>>       
>> This works for me.
>> My origin is 8.2, slave is 8.4 (preparing for an upgrade! wheeee!)
>>
>>     
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>   
Done.

See <http://slony.info/> for 1.2.18...
From user2037 at live.com  Wed Dec  2 04:51:57 2009
From: user2037 at live.com (P)
Date: Wed Dec  2 08:42:40 2009
Subject: [Slony1-general] Data Changes Via Slonik
Message-ID: <BLU0-SMTP897638E30B7FC6E1859521B4950@phx.gbl>

Is it safe to send data changes via Slonik or is it wiser to make such 
changes via traditional API's to the master?
From vivek at khera.org  Wed Dec  2 08:56:47 2009
From: vivek at khera.org (Vick Khera)
Date: Wed Dec  2 08:56:51 2009
Subject: [Slony1-general] Data Changes Via Slonik
In-Reply-To: <BLU0-SMTP897638E30B7FC6E1859521B4950@phx.gbl>
References: <BLU0-SMTP897638E30B7FC6E1859521B4950@phx.gbl>
Message-ID: <2968dfd60912020856j5b69b1d5tca9f78a81b337dee@mail.gmail.com>

On Wed, Dec 2, 2009 at 7:51 AM, P <user2037@live.com> wrote:
> Is it safe to send data changes via Slonik or is it wiser to make such
> changes via traditional API's to the master?
>

Any insert/update/delete you just do like normal, and slony
automatically replicates it for you.  that is the whole reason it
exists.

If you are doing schema changes, then you almost always need to use
the EXECUTE SCRIPT function in slony to do it for you.
From vivek at khera.org  Wed Dec  2 08:57:52 2009
From: vivek at khera.org (Vick Khera)
Date: Wed Dec  2 08:57:56 2009
Subject: [Slony1-general] PGRES_FATAL_ERROR ERROR: cannot change return 
	type of existing function
In-Reply-To: <4B15828F.5030002@ca.afilias.info>
References: <714911.80539.qm@web23601.mail.ird.yahoo.com>
	<20091021085504.21101bhuhw2q3cmg@webmail.afilias.info>
	<6CA951EC-BD82-4EB8-ADFC-F64103721155@torgo.978.org>
	<2968dfd60912011104y652a9fc8v474374daa9f57f87@mail.gmail.com>
	<4B15828F.5030002@ca.afilias.info>
Message-ID: <2968dfd60912020857j335a96ccifc06078d1b609967@mail.gmail.com>

On Tue, Dec 1, 2009 at 3:54 PM, Christopher Browne
<cbbrowne@ca.afilias.info> wrote:
>
> See <http://slony.info/> for 1.2.18...


Thanks muchly.  And also thanks for making the docs tarball too :-)

I've submitted the update to freebsd ports collection.  I'll be
updating production boxes after lunch.
From vivek at khera.org  Wed Dec  2 11:32:00 2009
From: vivek at khera.org (Vick Khera)
Date: Wed Dec  2 11:32:05 2009
Subject: [Slony1-general] PGRES_FATAL_ERROR ERROR: cannot change return 
	type of existing function
In-Reply-To: <4B15828F.5030002@ca.afilias.info>
References: <714911.80539.qm@web23601.mail.ird.yahoo.com>
	<20091021085504.21101bhuhw2q3cmg@webmail.afilias.info>
	<6CA951EC-BD82-4EB8-ADFC-F64103721155@torgo.978.org>
	<2968dfd60912011104y652a9fc8v474374daa9f57f87@mail.gmail.com>
	<4B15828F.5030002@ca.afilias.info>
Message-ID: <2968dfd60912021132y66cad68coce36f1262d91e519@mail.gmail.com>

On Tue, Dec 1, 2009 at 3:54 PM, Christopher Browne
<cbbrowne@ca.afilias.info> wrote:
> See <http://slony.info/> for 1.2.18...


Hmmm.  Was the fix put into 1.2.x?  I'm seeing this upgrading from 1.2.16

[d03]% slonik < updateslon.slon
<stdin>:3: Possible unsupported PostgreSQL version 8.3, defaulting to
8.1 support
<stdin>:3: loading of file
/usr/local/share/postgresql/slony1_funcs.sql: PGRES_FATAL_ERROR ERROR:
 cannot change return type of existing function
HINT:  Use DROP FUNCTION first.
ERROR:  cannot change return type of existing function
HINT:  Use DROP FUNCTION first.
[d03]% slon -v
slon version 1.2.18
[d03]% slonik -v
slonik version 1.2.18
From michael at aers.ca  Wed Dec  2 14:52:29 2009
From: michael at aers.ca (michael@aers.ca)
Date: Wed Dec  2 14:52:37 2009
Subject: [Slony1-general] Subscription is processed but tables aren't
	replicated
Message-ID: <6B5AF6293A289F45826220B17ABE793701301924@BORON.aers.local>

I've had something very odd happen. I'm not sure what caused the issue
so I'll try giving some background.

 

We have a cluster of 4 servers - 2 local (nodes 1 & 2) and 2 remote (3 &
4). Awhile ago we wanted to try a pseudo-test of our failover strategies
and so cut our VPN connection to the co-location and had it begin to
operate in failover mode. This meant the 2 servers here were continuing
to replicate in their cluster and the 2 remote were now operating in
their own cluster. Generally things went as planned, we learned some
things, and plotted out some changes.

 

I then removed the slony cluster information from the remote servers.

 

Today we brought the VPN link back up and I went about adding the remote
servers back into the cluster. We have a few different DBs, each with
their own clusters, and one of them has a very large table that takes
several hours to copy. To be efficient, after getting everything
listening right, I subscribed to all the sets *except* the one with the
very large table. I then made sure all the other clusters were working
properly. Things all seemed good.

 

So I came back and subscribed node 3 to set 8 (the one with the big
table), with node 1 as the provider.

 

Things looked fine. Slonik script executed, no errors, but then things
seemed to happen too quick - a matter of seconds instead of hours - so I
took a closer look. Everything says node 3 is subscribed to node 8, but
when I look at sl_table and sl_sequence on node 3, there's no tables or
sequences listed for node 8. The only thing I see in the log is:

 

DEBUG2 remoteWorkerThread_1: syncing set 8 with 0 table(s) from provider
1

 

Now, this set is replicating properly between node 1 and node 2. I have
verified that. So, what could cause it to end up like this on node 3? 

 

I have tried unsubscribing the node and re-subscribing but that didn't
help.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20091202/156d6926/attachment.htm
From stuart.bishop at canonical.com  Wed Dec  2 19:38:49 2009
From: stuart.bishop at canonical.com (stuart.bishop@canonical.com)
Date: Wed Dec  2 19:39:02 2009
Subject: [Slony1-general] Data Changes Via Slonik
In-Reply-To: <BLU0-SMTP897638E30B7FC6E1859521B4950@phx.gbl>
Message-ID: <g2qz99iuy0gt3imutiUYAxe124vaj_firegpg@mail.gmail.com>

DQoNCk9uIFdlZCwgRGVjIDIsIDIwMDkgYXQgNzo1MSBQTSwgUCA8dXNlcjIwMzdAbGl2ZS5jb20+
IHdyb3RlOg0KPiBJcyBpdCBzYWZlIHRvIHNlbmQgZGF0YSBjaGFuZ2VzIHZpYSBTbG9uaWsgb3Ig
aXMgaXQgd2lzZXIgdG8gbWFrZSBzdWNoDQo+IGNoYW5nZXMgdmlhIHRyYWRpdGlvbmFsIEFQSSdz
IHRvIHRoZSBtYXN0ZXI/DQoNCkl0cyBzYWZlIHByb3ZpZGVkIHlvdXIgY2hhbmdlcyB3b3JrIGlk
ZW50aWNhbGx5IGV2ZXJ5IHJ1biAtIGllLiBkb24ndCB1c2UgcmFuZG9tKCksIENVUlJFTlRfVElN
RVNUQU1QIGV0Yy4gb3IgeW91IHdpbGwgZW5kIHVwIHdpdGggZGlmZmVyZW50IGRhdGEgb24gZGlm
ZmVyZW50IG5vZGVzIChhbHRob3VnaCB0aGF0IG1pZ2h0IGJlIGZpbmUgaW4geW91ciBhcHBsaWNh
dGlvbi4uLikuDQoNCg0KDQotLSANClN0dWFydCBCaXNob3AgPHN0dWFydEBzdHVhcnRiaXNob3Au
bmV0Pg0KaHR0cDovL3d3dy5zdHVhcnRiaXNob3AubmV0Lw0KDQotLS0tLS0tLS0tLS0tLSBuZXh0
IHBhcnQgLS0tLS0tLS0tLS0tLS0KQSBub24tdGV4dCBhdHRhY2htZW50IHdhcyBzY3J1YmJlZC4u
LgpOYW1lOiBzaWduYXR1cmUuYXNjClR5cGU6IGFwcGxpY2F0aW9uL3BncC1zaWduYXR1cmUKU2l6
ZTogMjYzIGJ5dGVzCkRlc2M6IE9wZW5QR1AgZGlnaXRhbCBzaWduYXR1cmUKVXJsIDogaHR0cDov
L2xpc3RzLnNsb255LmluZm8vcGlwZXJtYWlsL3Nsb255MS1nZW5lcmFsL2F0dGFjaG1lbnRzLzIw
MDkxMjAzL2FkMTJjMzY5L3NpZ25hdHVyZS5wZ3AK
From glynastill at yahoo.co.uk  Thu Dec  3 02:15:55 2009
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Thu Dec  3 02:55:46 2009
Subject: [Slony1-general] PGRES_FATAL_ERROR ERROR: cannot change return
	type of existing function
In-Reply-To: <2968dfd60912021132y66cad68coce36f1262d91e519@mail.gmail.com>
Message-ID: <581440.53503.qm@web23602.mail.ird.yahoo.com>

--- On Wed, 2/12/09, Vick Khera <vivek@khera.org> wrote:

> From: Vick Khera <vivek@khera.org>
> 
> 
> Hmmm.? Was the fix put into 1.2.x?? I'm seeing
> this upgrading from 1.2.16
> 

I took a quick peek in slony1_funcs.sql from the 1.2.18 release and the drop_if_exists functionality appears to be in there (although not in the slony1_funcs.vNN.sql scripts). I'm going to do a few more tests before upgrading our servers...

Chris?


      

From kerdezixe at gmail.com  Thu Dec  3 04:57:34 2009
From: kerdezixe at gmail.com (Laurent Laborde)
Date: Thu Dec  3 04:57:39 2009
Subject: [Slony1-general] bloated pg_listener
In-Reply-To: <87vdgv7k9n.fsf@dba2.int.libertyrms.com>
References: <8a1bfe660911210827q418ce2aci38edb4196b7f8316@mail.gmail.com>
	<87k4xh9pjr.fsf@dba2.int.libertyrms.com>
	<1258994264.9403.463.camel@bnicholson-desktop>
	<8a1bfe660911250033h60f08d05u462babf1d638e4bb@mail.gmail.com>
	<1259156037.9403.590.camel@bnicholson-desktop>
	<8a1bfe660911260126u1abf9003w4f46e3561cc9e5a7@mail.gmail.com>
	<1259266505.9403.815.camel@bnicholson-desktop>
	<87vdgv7k9n.fsf@dba2.int.libertyrms.com>
Message-ID: <8a1bfe660912030457q1f57e17cob7abd8b981bb5eb4@mail.gmail.com>

Sooo ...

i disabled autovacuum  using the following request :
INSERT INTO pg_catalog.pg_autovacuum (vacrelid, enabled,
vac_base_thresh, vac_scale_factor, anl_base_thresh, anl_scale_factor,
vac_cost_delay, vac_cost_limit, freeze_min_age, freeze_max_age) SELECT
oid, 'f', -1, -1, -1, -1, -1, -1, -1, -1 FROM pg_catalog.pg_class
WHERE relnamespace = (SELECT OID FROM pg_namespace WHERE nspname =
'_ob2replication' ) AND relhasindex;

I waited ~24h then ran a vacuum verbose analyze on some slony table.

INFO:  "sl_listen": found 0 removable, 1282 nonremovable row versions
in 30 pages
DETAIL:  0 dead row versions cannot be removed yet.
There were 6113 unused item pointers.
27 pages contain useful free space.
0 pages are entirely empty.

INFO:  "sl_event": found 0 removable, 2599 nonremovable row versions
in 7229 pages
DETAIL:  0 dead row versions cannot be removed yet.
There were 784524 unused item pointers.
7220 pages contain useful free space.
0 pages are entirely empty.

INFO:  "sl_confirm": found 0 removable, 27585 nonremovable row
versions in 321 pages
DETAIL:  0 dead row versions cannot be removed yet.
There were 65301 unused item pointers.
188 pages contain useful free space.
0 pages are entirely empty.

INFO:  "sl_log_1": found 32843 removable, 16694 nonremovable row
versions in 4464 pages
DETAIL:  0 dead row versions cannot be removed yet.
There were 151138 unused item pointers.
3648 pages contain useful free space.
0 pages are entirely empty.


Look so bad ?
However... i can't find anything in the log saying that slony is
manually vacuuming.
Should i restart slony ?

-- 
Laurent "ker2x" Laborde
Sysadmin & DBA at http://www.over-blog.com/
From kerdezixe at gmail.com  Thu Dec  3 04:58:08 2009
From: kerdezixe at gmail.com (Laurent Laborde)
Date: Thu Dec  3 04:58:12 2009
Subject: [Slony1-general] bloated pg_listener
In-Reply-To: <8a1bfe660912030457q1f57e17cob7abd8b981bb5eb4@mail.gmail.com>
References: <8a1bfe660911210827q418ce2aci38edb4196b7f8316@mail.gmail.com>
	<87k4xh9pjr.fsf@dba2.int.libertyrms.com>
	<1258994264.9403.463.camel@bnicholson-desktop>
	<8a1bfe660911250033h60f08d05u462babf1d638e4bb@mail.gmail.com>
	<1259156037.9403.590.camel@bnicholson-desktop>
	<8a1bfe660911260126u1abf9003w4f46e3561cc9e5a7@mail.gmail.com>
	<1259266505.9403.815.camel@bnicholson-desktop>
	<87vdgv7k9n.fsf@dba2.int.libertyrms.com>
	<8a1bfe660912030457q1f57e17cob7abd8b981bb5eb4@mail.gmail.com>
Message-ID: <8a1bfe660912030458s1206d1baxbb9959e117021400@mail.gmail.com>

> Look so bad ?

s/so bad/good/


-- 
Laurent "ker2x" Laborde
Sysadmin & DBA at http://www.over-blog.com/
From vivek at khera.org  Thu Dec  3 08:09:56 2009
From: vivek at khera.org (Vick Khera)
Date: Thu Dec  3 08:10:01 2009
Subject: [Slony1-general] PGRES_FATAL_ERROR ERROR: cannot change return 
	type of existing function
In-Reply-To: <581440.53503.qm@web23602.mail.ird.yahoo.com>
References: <2968dfd60912021132y66cad68coce36f1262d91e519@mail.gmail.com>
	<581440.53503.qm@web23602.mail.ird.yahoo.com>
Message-ID: <2968dfd60912030809o6f424f2fgda1ea654377698c7@mail.gmail.com>

On Thu, Dec 3, 2009 at 5:15 AM, Glyn Astill <glynastill@yahoo.co.uk> wrote:
> I took a quick peek in slony1_funcs.sql from the 1.2.18 release and the drop_if_exists functionality appears to be in there (although not in the slony1_funcs.vNN.sql scripts). I'm going to do a few more tests before upgrading our servers...
>

Once I added the lines

drop function if exists @NAMESPACE@.ddlScript_complete (int4, text, int4);
drop function if exists @NAMESPACE@.updateReloid (int4, int4);

to slony1_funcs.sql it as was installed, my update succeeded.
From glynastill at yahoo.co.uk  Thu Dec  3 08:23:21 2009
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Thu Dec  3 08:23:26 2009
Subject: [Slony1-general] PGRES_FATAL_ERROR ERROR: cannot change return
	type of existing function
In-Reply-To: <2968dfd60912030809o6f424f2fgda1ea654377698c7@mail.gmail.com>
Message-ID: <149904.89664.qm@web23607.mail.ird.yahoo.com>

--- On Thu, 3/12/09, Vick Khera <vivek@khera.org> wrote:
> Once I added the lines
> 
> drop function if exists @NAMESPACE@.ddlScript_complete
> (int4, text, int4);
> drop function if exists @NAMESPACE@.updateReloid (int4,
> int4);
> 
> to slony1_funcs.sql it as was installed, my update
> succeeded.

Perhaps that means the drop_if_exists function that was created to maintain compatibility isn't working ...


      
From threshar at torgo.978.org  Thu Dec  3 11:06:05 2009
From: threshar at torgo.978.org (Jeff)
Date: Thu Dec  3 11:06:23 2009
Subject: [Slony1-general] PGRES_FATAL_ERROR ERROR: cannot change return
	type of existing function
In-Reply-To: <149904.89664.qm@web23607.mail.ird.yahoo.com>
References: <149904.89664.qm@web23607.mail.ird.yahoo.com>
Message-ID: <0AAB82AF-4FB7-4141-BDEF-2606992B5F17@torgo.978.org>


On Dec 3, 2009, at 11:23 AM, Glyn Astill wrote:

> --- On Thu, 3/12/09, Vick Khera <vivek@khera.org> wrote:
>> Once I added the lines
>>
>> drop function if exists @NAMESPACE@.ddlScript_complete
>> (int4, text, int4);
>> drop function if exists @NAMESPACE@.updateReloid (int4,
>> int4);
>>
>> to slony1_funcs.sql it as was installed, my update
>> succeeded.
>
> Perhaps that means the drop_if_exists function that was created to  
> maintain compatibility isn't working ...
>

Also - did that fix I sent a patch out for a while ago with dealing  
with failed subscription retries make it?


>
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general

--
Jeff Trout <jeff@jefftrout.com>
http://www.stuarthamm.net/
http://www.dellsmartexitin.com/



From cbbrowne at ca.afilias.info  Thu Dec  3 11:35:24 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Thu Dec  3 11:35:28 2009
Subject: [Slony1-general] Data Changes Via Slonik
In-Reply-To: <BLU0-SMTP897638E30B7FC6E1859521B4950@phx.gbl> (P.'s message of
	"Wed, 02 Dec 2009 07:51:57 -0500")
References: <BLU0-SMTP897638E30B7FC6E1859521B4950@phx.gbl>
Message-ID: <87pr6v6ebn.fsf@dba2.int.libertyrms.com>

P <user2037@live.com> writes:
> Is it safe to send data changes via Slonik or is it wiser to make such
> changes via traditional API's to the master?

Yes.
No.
Maybe.

I'd think that it's *usually* preferable to do updates via doing I/U/D
requests against the "master" node.  That will automatically propagate,
and things work the same way whether you have Slony installed or not.

That is typically the natural answer.

More interesting is to ask in what cases it would be preferable or
definitely NOT DESIRABLE to use
EXECUTE SCRIPT.

- If you're making changes that wouldn't be processed identically on another
  database, then you mustn't use EXECUTE SCRIPT.

  Examples of this would include:
   - queries using locally-sensitive data, such as random(), NOW(), and
     such

   - queries that have the potential to have ambiguous results

     For instance:
          update my_table set attribute_a = 6 where my_id in
              (select my_id from my_table limit 500);

     This would become unambiguous if my_id is a unique key, and you
     specify an order:

          update my_table set attribute_a = 6 where my_id in
              (select my_id from my_table order by my_id limit 500);

     But if the selection criteria doesn't forcibly identify a unique
     set of tuples, it mightn't run the same on another node, even with
     an ORDER BY clause.

   In such cases, you *need* to submit changes directly to the master,
   and have them propagate via replicating the tuples.

- On versions of Slony-I prior to 2.0, EXECUTE SCRIPT establishes a big
  lock on all replicated tables (because it has to ALTER TABLE on every
  table to deactivate replication and then to turn it back on).

  If you need to cope with concurrent updates coming in, then using
  EXECUTE SCRIPT won't work out very happily!

  Even on 2.0, it'll still be pretty expensive to do such updates,
  albeit not with One Big Lock On Everything.

- If you're making DDL changes to a table, those are highly likely to
  need to go in via EXECUTE SCRIPT.

- Needing to construct (and likely test) an EXECUTE SCRIPT-based request
  requires quite a different structuring of the work (and thinking) than
  would be used for doing straight updates that are expected to be
  replicated.

  In particular, submitting a request via EXECUTE SCRIPT works a fair
  bit differently from just "attaching to the DB and doing the updates."

  I'd usually rather just "attach to the DB and do the updates."

Does that help, I hope?
-- 
let name="cbbrowne" and tld="ca.afilias.info" in String.concat "@" [name;tld];;
Christopher Browne
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"
From cbbrowne at ca.afilias.info  Thu Dec  3 11:52:57 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Thu Dec  3 11:53:10 2009
Subject: [Slony1-general] PGRES_FATAL_ERROR ERROR: cannot change return
	type of existing function
In-Reply-To: <2968dfd60912030809o6f424f2fgda1ea654377698c7@mail.gmail.com>
References: <2968dfd60912021132y66cad68coce36f1262d91e519@mail.gmail.com>	<581440.53503.qm@web23602.mail.ird.yahoo.com>
	<2968dfd60912030809o6f424f2fgda1ea654377698c7@mail.gmail.com>
Message-ID: <4B181719.7060802@ca.afilias.info>

Vick Khera wrote:
> On Thu, Dec 3, 2009 at 5:15 AM, Glyn Astill <glynastill@yahoo.co.uk> wrote:
>   
>> I took a quick peek in slony1_funcs.sql from the 1.2.18 release and the drop_if_exists functionality appears to be in there (although not in the slony1_funcs.vNN.sql scripts). I'm going to do a few more tests before upgrading our servers...
>>
>>     
>
> Once I added the lines
>
> drop function if exists @NAMESPACE@.ddlScript_complete (int4, text, int4);
> drop function if exists @NAMESPACE@.updateReloid (int4, int4);
>
> to slony1_funcs.sql it as was installed, my update succeeded.
>   

That is only OK in newer versions...  "drop function if exists" doesn't 
work on 7.4, for instance.

I took a look in the released code, and it seems like it has the 
function I added to emulate this:

chris@dba2:builds/slony1-1.2.18/src/backend> grep -n drop_if 
slony1_funcs.sql
3761:create or replace function @NAMESPACE@.drop_if_exists (text, text) 
returns integer as '
3775:comment on function @NAMESPACE@.drop_if_exists (text,text) is 
'Emulate DROP FUNCTION IF EXISTS, which does not exist in 7.4, 8.0, 8.1';
3777:select @NAMESPACE@.drop_if_exists ('ddlscript_complete', 'int4, 
text, int4');
5457:select @NAMESPACE@.drop_if_exists ('updatereloid', 'int4, int4');

From cbbrowne at ca.afilias.info  Thu Dec  3 11:58:11 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Thu Dec  3 11:58:15 2009
Subject: [Slony1-general] bloated pg_listener
In-Reply-To: <8a1bfe660912030457q1f57e17cob7abd8b981bb5eb4@mail.gmail.com>
References: <8a1bfe660911210827q418ce2aci38edb4196b7f8316@mail.gmail.com>	
	<87k4xh9pjr.fsf@dba2.int.libertyrms.com>	
	<1258994264.9403.463.camel@bnicholson-desktop>	
	<8a1bfe660911250033h60f08d05u462babf1d638e4bb@mail.gmail.com>	
	<1259156037.9403.590.camel@bnicholson-desktop>	
	<8a1bfe660911260126u1abf9003w4f46e3561cc9e5a7@mail.gmail.com>	
	<1259266505.9403.815.camel@bnicholson-desktop>	
	<87vdgv7k9n.fsf@dba2.int.libertyrms.com>
	<8a1bfe660912030457q1f57e17cob7abd8b981bb5eb4@mail.gmail.com>
Message-ID: <4B181853.30204@ca.afilias.info>

Laurent Laborde wrote:
> Sooo ...
>
> i disabled autovacuum  using the following request :
> INSERT INTO pg_catalog.pg_autovacuum (vacrelid, enabled,
> vac_base_thresh, vac_scale_factor, anl_base_thresh, anl_scale_factor,
> vac_cost_delay, vac_cost_limit, freeze_min_age, freeze_max_age) SELECT
> oid, 'f', -1, -1, -1, -1, -1, -1, -1, -1 FROM pg_catalog.pg_class
> WHERE relnamespace = (SELECT OID FROM pg_namespace WHERE nspname =
> '_ob2replication' ) AND relhasindex;
>
> I waited ~24h then ran a vacuum verbose analyze on some slony table.
>
> INFO:  "sl_listen": found 0 removable, 1282 nonremovable row versions
> in 30 pages
> DETAIL:  0 dead row versions cannot be removed yet.
> There were 6113 unused item pointers.
> 27 pages contain useful free space.
> 0 pages are entirely empty.
>
> INFO:  "sl_event": found 0 removable, 2599 nonremovable row versions
> in 7229 pages
> DETAIL:  0 dead row versions cannot be removed yet.
> There were 784524 unused item pointers.
> 7220 pages contain useful free space.
> 0 pages are entirely empty.
>
> INFO:  "sl_confirm": found 0 removable, 27585 nonremovable row
> versions in 321 pages
> DETAIL:  0 dead row versions cannot be removed yet.
> There were 65301 unused item pointers.
> 188 pages contain useful free space.
> 0 pages are entirely empty.
>
> INFO:  "sl_log_1": found 32843 removable, 16694 nonremovable row
> versions in 4464 pages
> DETAIL:  0 dead row versions cannot be removed yet.
> There were 151138 unused item pointers.
> 3648 pages contain useful free space.
> 0 pages are entirely empty.
>
>
> Look so bad ?
> However... i can't find anything in the log saying that slony is
> manually vacuuming.
> Should i restart slony ?
>
>   
Nothing looks notably wrong, here.

There's a fair bit of dead data in sl_log_1, but not *enormous*.  The 
log rotation approach used in the modern versions of Slony-I (1.2 and 
newer) means that even if you never vacuum sl_log_1 or sl_log_2, that 
data will eventually get truncated away.

Actually, in 2.0, all we ever do with sl_log_{1,2} is to truncate them.  
They should be pretty useless to vacuum!

You might want to run CLUSTER or VACUUM FULL+reindex on several of the 
other tables, as they have bloated to fairly considerable size, and an 
ordinary vacuum won't quickly do anything about that.  Once they've 
bloated, you need to do a bit of maintenance to fix that :-(.
From vivek at khera.org  Thu Dec  3 13:46:04 2009
From: vivek at khera.org (Vick Khera)
Date: Thu Dec  3 13:46:08 2009
Subject: [Slony1-general] PGRES_FATAL_ERROR ERROR: cannot change return 
	type of existing function
In-Reply-To: <4B181719.7060802@ca.afilias.info>
References: <2968dfd60912021132y66cad68coce36f1262d91e519@mail.gmail.com>
	<581440.53503.qm@web23602.mail.ird.yahoo.com>
	<2968dfd60912030809o6f424f2fgda1ea654377698c7@mail.gmail.com>
	<4B181719.7060802@ca.afilias.info>
Message-ID: <2968dfd60912031346r6e0890d7sd40eb9ef7c99c453@mail.gmail.com>

> I took a look in the released code, and it seems like it has the function I
> added to emulate this:
>
> chris@dba2:builds/slony1-1.2.18/src/backend> grep -n drop_if
> slony1_funcs.sql
> 3761:create or replace function @NAMESPACE@.drop_if_exists (text, text)
> returns integer as '
> 3775:comment on function @NAMESPACE@.drop_if_exists (text,text) is 'Emulate
> DROP FUNCTION IF EXISTS, which does not exist in 7.4, 8.0, 8.1';
> 3777:select @NAMESPACE@.drop_if_exists ('ddlscript_complete', 'int4, text,
> int4');
> 5457:select @NAMESPACE@.drop_if_exists ('updatereloid', 'int4, int4');
>
>

Yep, it is there... but the ddlScript_complete() function does not get
dropped by it, at least in 8.3, in each of the three replications I
have running.  I'll do some more testing with upgrading from 1.2.16 to
1.2.18.
From vivek at khera.org  Thu Dec  3 14:02:04 2009
From: vivek at khera.org (Vick Khera)
Date: Thu Dec  3 14:02:09 2009
Subject: [Slony1-general] PGRES_FATAL_ERROR ERROR: cannot change return 
	type of existing function
In-Reply-To: <4B181719.7060802@ca.afilias.info>
References: <2968dfd60912021132y66cad68coce36f1262d91e519@mail.gmail.com>
	<581440.53503.qm@web23602.mail.ird.yahoo.com>
	<2968dfd60912030809o6f424f2fgda1ea654377698c7@mail.gmail.com>
	<4B181719.7060802@ca.afilias.info>
Message-ID: <2968dfd60912031402s559afea6o8ef9d7bc9d18f312@mail.gmail.com>

I found an error.  the "drop" statement generated by the
drop_if_exists function does not qualify the function name's schema.

I restored my schema from a dump with slony 2.1.16, then added the
drop_if_exists() function to it from the 1.2.18 file (manually
replacing @NAMESPACE@ with _rt which is my namespace).


Specifically:

vktest=# select _rt.drop_if_exists ('ddlscript_complete', 'int4, text,
int4');ERROR:  function ddlscript_complete(integer, text, integer)
does not exist
CONTEXT:  SQL statement "drop function ddlscript_complete(int4, text, int4);"
PL/pgSQL function "drop_if_exists" line 7 at EXECUTE statement

changing the drop to be:

  ... v_drop := ''drop function @NAMESPACE@.'' || p_function ...

allows it to succeed:

vktest=# select _rt.drop_if_exists ('ddlscript_complete', 'int4, text, int4');
drop_if_exists
----------------
              1
From cbbrowne at ca.afilias.info  Thu Dec  3 14:56:47 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Thu Dec  3 14:56:50 2009
Subject: [Slony1-general] PGRES_FATAL_ERROR ERROR: cannot change return
	type of existing function
In-Reply-To: <2968dfd60912031402s559afea6o8ef9d7bc9d18f312@mail.gmail.com>
References: <2968dfd60912021132y66cad68coce36f1262d91e519@mail.gmail.com>	<581440.53503.qm@web23602.mail.ird.yahoo.com>	<2968dfd60912030809o6f424f2fgda1ea654377698c7@mail.gmail.com>	<4B181719.7060802@ca.afilias.info>
	<2968dfd60912031402s559afea6o8ef9d7bc9d18f312@mail.gmail.com>
Message-ID: <4B18422F.4050607@ca.afilias.info>

Vick Khera wrote:
> I found an error.  the "drop" statement generated by the
> drop_if_exists function does not qualify the function name's schema.
>
> I restored my schema from a dump with slony 2.1.16, then added the
> drop_if_exists() function to it from the 1.2.18 file (manually
> replacing @NAMESPACE@ with _rt which is my namespace).
>
>
> Specifically:
>
> vktest=# select _rt.drop_if_exists ('ddlscript_complete', 'int4, text,
> int4');ERROR:  function ddlscript_complete(integer, text, integer)
> does not exist
> CONTEXT:  SQL statement "drop function ddlscript_complete(int4, text, int4);"
> PL/pgSQL function "drop_if_exists" line 7 at EXECUTE statement
>
> changing the drop to be:
>
>   ... v_drop := ''drop function @NAMESPACE@.'' || p_function ...
>
> allows it to succeed:
>
> vktest=# select _rt.drop_if_exists ('ddlscript_complete', 'int4, text, int4');
> drop_if_exists
> ----------------
>   
I committed this to CVS, along with a bump to version number.  I'll not 
release 1.2.19 today, but would seriously consider doing so tomorrow...
From michelle at sorbs.net  Fri Dec  4 08:26:12 2009
From: michelle at sorbs.net (Michelle Sullivan)
Date: Fri Dec  4 08:26:25 2009
Subject: [Slony1-general] Possible bug? (or is the bug in front of the
	keyboard?)
Message-ID: <4B193824.7050202@sorbs.net>

Hey all,

Have no problem getting a master->slave replication working, however I 
have run into something I can't seem to resolve:

Here's the list of commands I used:

for a in 1 2 3 4 ; do slonik_store_node $a | slonik ; done
slonik_init_cluster  | slonik
sudo slon_start 1
sudo slon_start 2
sudo slon_start 3
sudo slon_start 4
slonik_create_set 1 | slonik
slonik_subscribe_set 1 2 | slonik
slonik_subscribe_set 1 3 | slonik
slonik_subscribe_set 1 4 | slonik

My configuration is as follows:

[user@zyklon /var/log/slony/slony1/node3]$ cat 
/usr/local/etc/slon_tools.conf
# $Id: slon_tools.conf-sample,v 1.7 2005-11-15 18:09:59 cbbrowne Exp $

if ($ENV{"SLONYNODES"}) {
     require $ENV{"SLONYNODES"};
} else {

     # The name of the replication cluster.  This will be used to
     # create a schema named _$CLUSTER_NAME in the database which will
     # contain Slony-related data.
     $CLUSTER_NAME = 'replication';

     $LOGDIR = '/var/log/slony';

     # $APACHE_ROTATOR = '/usr/local/apache/bin/rotatelogs';

     # $SYNC_CHECK_INTERVAL = 1000;

     $MASTERNODE = 1;

     add_node(node     => 1,
          host     => 'invertigo.domain',
          dbname   => 'db',
          port     => 5432,
          user     => 'pgsql',
              password => '****');

     add_node(node     => 2,
          host     => 'zyklon.domain',
          dbname   => 'db',
          port     => 5432,
          user     => 'pgsql',
              password => '****');

     add_node(node     => 3,
          host     => 'tornado.domain',
          dbname   => 'db',
          port     => 5432,
          user     => 'postgres',
              password => '****');

     add_node(node     => 4,
              host     => 'knightmare.domain',
              dbname   => 'db',
              port     => 5432,
              user     => 'pgsql',
              password => '****');

}

$SLONY_SETS = {
     "set1" => {
     "set_id" => 1,
     # "origin" => 1,
     # foldCase => 0,
     "table_id"    => 1,
     "sequence_id" => 1,

     "pkeyedtables" => [     'public.account2email',
                                 'public.actions',
                                 'public.audit',
                                 'public.authorisation',
                                 'public.captcha',
                                 'public.comments',
                                 'public.emails',
                                 'public.evid2comm',
                                 'public.evid2raw',
                                 'public.evid2rt',
                                 'public.evidence',
                                 'public.hosts',
                                 'public.hosts2evid',
                                 'public.matviews',
                                 'public.most_recent_hosts_cached',
                                 'public.most_recent_nets_cached',
                                 'public.netassignments',
                                 'public.netnames',
                                 'public.netowners',
                                 'public.nets2evid',
                                 'public.nets2hosts',
                                 'public.nets2nets',
                                 'public.networks',
                                 'public.notifications',
                                 'public.permission',
                                 'public.rawevidence',
                                 'public.rdnsqueue',
                                 'public.reportq',
                                 'public.roles',
                                 'public.sessions',
                                 'public.statistics',
                                 'public.useraccounts',
                                 'public.usernets',
                                 'public.userprefs',
                                 'public.users',
                                 'public.whois',
                                 'public.whois2name',
                                 'public.whoisnames',
                                 'public.whoisobjects',
                                 'public.wnetassignments'
     ],

         "keyedtables" => { },

     "serialtables" => ['public.dns',
                'public.mx_routes',
                'public.userpermissions'
               ],


     # Sequences that need to be replicated should be entered here.
     "sequences" => ['public.audit_pk_seq',
             'public.captcha_id_seq',
             'public.evidence_evidid_seq',
             'public.hosts_hostsid_seq',
             'public.netnames_nameid_seq',
             'public.networks_netid_seq',
             'public.notifications_pk_seq',
             'public.rawevidence_rawid_seq',
             'public.roles_id_seq',
             'public.useraccounts_sid_seq',
             'public.usernets_id_seq',
             'public.userpermissions_id_seq',
             'public.users_id_seq'
             ],
     },

};

if ($ENV{"SLONYSET"}) {
     require $ENV{"SLONYSET"};
}

# Please do not add or change anything below this point.
1;

Node 1 seems to replicate to node 2 with no issues, however in nodes 3 
and 4 I see this in the log:

2009-12-05 02:09:27 EST ERROR  remoteWorkerThread_1: "select 
"_replication".setAddSequence_int(1, 1, '"public"."audit_pk_seq"', 
'Sequence public.audit_pk_seq')" PGRES_FATAL_ERROR ERROR:  Slony-I: 
setAddSequence_int(): sequence ID 1 has already been assigned


The docs indicate it's something I have done, so I rechecked the config 
and re-initialised everything (except the data in the master node) .. 
used 'slonik_uninstall_nodes' etc...  re-did everything as above, and I 
still get the same error...!  Please give me a hint on what I screwed up 
or what's wrong...

Thanks.

Michelle

PS: one host is running all instances of slon atm, and I want 
(eventually) to have replication from 1 to 3 then from 3 to 2 and 4 
eventually (3 is a dedicated "hub" server on the same network as 1 and 
2.  1 is the write node and 2 is a highspeed access node as is the 
remote node 4.  When I have this working there will also be nodes 5 and 
6 which should be connected to 3 and will also be on remote networks, 
hence the desire for a hub.)
From glynastill at yahoo.co.uk  Mon Dec  7 03:07:35 2009
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Mon Dec  7 03:07:39 2009
Subject: [Slony1-general] PGRES_FATAL_ERROR ERROR: cannot change return
	type of existing function
In-Reply-To: <4B18422F.4050607@ca.afilias.info>
Message-ID: <525566.487.qm@web23605.mail.ird.yahoo.com>

--- On Thu, 3/12/09, Christopher Browne <cbbrowne@ca.afilias.info> wrote:
>
> I committed this to CVS, along with a bump to version
> number.? I'll not 
> release 1.2.19 today, but would seriously consider doing so
> tomorrow...

Any chance of 1.2.19 today?


      
From devrim at CommandPrompt.com  Mon Dec  7 13:40:12 2009
From: devrim at CommandPrompt.com (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Mon Dec  7 13:47:30 2009
Subject: [Slony1-general] Heads up: www.slony.info scheduled maintenance
Message-ID: <1260222012.24783.41.camel@hp-laptop2.gunduz.org>

SGksCgpKdXN0IGEgaGVhZHMgdXA6IFdlIChDb21tYW5kIFByb21wdCkgd2lsbCBiZSBwZXJmb3Jt
aW5nIGEgbWFqb3IKbWFpbnRlbmFuY2Ugb3BlcmF0aW9uIG9uIHRoZSBzbG9ueS5pbmZvIHNlcnZl
ci4gV2Ugd2lsbCBzdGFydCB1cGdyYWRpbmcKdGhlIHNlcnZlciBvbiBEZWMgMjJuZCAoVHVlc2Rh
eSkgbmlnaHQsIGF0IGFib3V0IDdwbSBQU1QuCgpFeHBlY3RlZCBkb3dudGltZSBpcyBsZXNzIHRo
YW4gMTIgaG91cnMsIGJhcnJpbmcgYW55IHVuZXhwZWN0ZWQgaXNzdWVzLiAKCkFsbCBzZXJ2aWNl
cyAoYnVnemlsbGEsIGN2cywgd2Vic2l0ZSkgd2lsbCBiZSBkb3duIGR1cmluZyB0aGlzCm1haW50
ZW5hbmNlIHdpbmRvdy4KCldlIHdpbGwgbm90aWZ5IHRoZSBsaXN0IHdoZW4gbWFpbnRlbmFuY2Ug
Y29tcGxldGVzLgoKUmVnYXJkcyxhaQotLSAKRGV2cmltIEfDnE5Ew5xaICwgUkhDRQpQcm9mZXNz
aW9uYWwgU2VydmljZXMsIFRyYWluaW5nLCAyNHg3IFN1cHBvcnQKQXV0aG9yczogUG9zdGdyZVNR
TCBSUE1zLCBQSVRSVG9vbHMsIFBvc3RncmVTUUwgUmVwbGljYXRvciwgCmh0dHA6Ly93d3cuY29t
bWFuZHByb21wdC5jb20vIFhNUFA6IGRndW5kdXpAamFiYmVyLmNvbW1hbmRwcm9tcHQuY29tClR3
aXR0ZXI6IGh0dHA6Ly90d2l0dGVyLmNvbS9kZXZyaW1ndW5kdXoKCi0tLS0tLS0tLS0tLS0tIG5l
eHQgcGFydCAtLS0tLS0tLS0tLS0tLQpBIG5vbi10ZXh0IGF0dGFjaG1lbnQgd2FzIHNjcnViYmVk
Li4uCk5hbWU6IG5vdCBhdmFpbGFibGUKVHlwZTogYXBwbGljYXRpb24vcGdwLXNpZ25hdHVyZQpT
aXplOiAxOTcgYnl0ZXMKRGVzYzogVGhpcyBpcyBhIGRpZ2l0YWxseSBzaWduZWQgbWVzc2FnZSBw
YXJ0ClVybCA6IGh0dHA6Ly9saXN0cy5zbG9ueS5pbmZvL3BpcGVybWFpbC9zbG9ueTEtZ2VuZXJh
bC9hdHRhY2htZW50cy8yMDA5MTIwNy84NGZlOWRjMy9hdHRhY2htZW50LnBncAo=
From maxim.boguk at gmail.com  Mon Dec  7 22:33:12 2009
From: maxim.boguk at gmail.com (Maxim Boguk)
Date: Mon Dec  7 22:33:15 2009
Subject: [Slony1-general] Problem with execute script / slony version 1.2.17
Message-ID: <ce8e675b0912072233q450c776m21cd622c73d7d978@mail.gmail.com>

I have a bit uncommon configuration now.
Master: postgresql 8.3
Slave:   postgresql 8.4
slony:   version 1.2.17

Any execute script surely break replication set. Even if i submit
something like 'select 1' via execte script replication will be broken
down unrepairable. Only way fix it is drop/create/subscribe slave node.
restarting slon doesn't help at all...

Here is slony log from slave database:

2009-12-08 09:11:43 MSK INFO   prepare for DDL script - set:1 onlyonnode:-1
2009-12-08 09:11:43 MSK ERROR  remoteWorkerThread_1: "select
"_slony".ddlScript_prepare_int(1, -1); " PGRES_FATAL_ERROR ERROR:
Slony-I: alterTableRestore(): Table "public"."access_type" is not in
altered state
CONTEXT:  SQL statement "SELECT  "_slony".alterTableRestore( $1 )"
PL/pgSQL function "ddlscript_prepare_int" line 46 at PERFORM
2009-12-08 09:11:43 MSK ERROR  remoteWorkerThread_1: DDL preparation
failed - set 1 - only on node -1
2009-12-08 09:11:43 MSK DEBUG1 slon: retry requested
2009-12-08 09:11:43 MSK INFO   remoteListenThread_1: disconnecting
from 'dbname=plus1 host=192.168.1.137 port=5432 user=slony'
2009-12-08 09:11:43 MSK DEBUG1 syncThread: thread done
2009-12-08 09:11:43 MSK DEBUG1 localListenThread: thread done
2009-12-08 09:11:43 MSK DEBUG1 remoteListenThread_1: thread done
2009-12-08 09:11:43 MSK DEBUG1 main: scheduler mainloop returned
2009-12-08 09:11:43 MSK DEBUG1 cleanupThread: thread done
2009-12-08 09:11:43 MSK DEBUG1 main: done
2009-12-08 09:11:43 MSK DEBUG1 slon: restart of worker
2009-12-08 09:11:43 MSK CONFIG main: slon version 1.2.17 starting up
2009-12-08 09:11:43 MSK CONFIG main: local node id = 2
2009-12-08 09:11:43 MSK CONFIG main: launching sched_start_mainloop
2009-12-08 09:11:43 MSK CONFIG main: loading current cluster configuration
2009-12-08 09:11:43 MSK CONFIG storeNode: no_id=1 no_comment='director'
2009-12-08 09:11:43 MSK CONFIG storePath: pa_server=1 pa_client=2
pa_conninfo="dbname=plus1 host=192.168.1.137 port=5432 user=slony"
pa_connretry=10
2009-12-08 09:11:43 MSK CONFIG storeListen: li_origin=1 li_receiver=2
li_provider=1
2009-12-08 09:11:43 MSK CONFIG storeSet: set_id=1 set_origin=1
set_comment='A replication set so boring no one thought to give it a
name'
2009-12-08 09:11:43 MSK WARN   remoteWorker_wakeup: node 1 - no worker thread
2009-12-08 09:11:43 MSK CONFIG storeSubscribe: sub_set=1
sub_provider=1 sub_forward='t'
2009-12-08 09:11:43 MSK WARN   remoteWorker_wakeup: node 1 - no worker thread
2009-12-08 09:11:43 MSK CONFIG enableSubscription: sub_set=1
2009-12-08 09:11:43 MSK WARN   remoteWorker_wakeup: node 1 - no worker thread
2009-12-08 09:11:43 MSK CONFIG main: configuration complete - starting threads
2009-12-08 09:11:43 MSK DEBUG1 localListenThread: thread starts
NOTICE:  Slony-I: cleanup stale sl_nodelock entry for pid=31722
2009-12-08 09:11:43 MSK CONFIG enableNode: no_id=1
2009-12-08 09:11:43 MSK DEBUG1 remoteListenThread_1: thread starts
2009-12-08 09:11:43 MSK DEBUG1 remoteWorkerThread_1: thread starts
2009-12-08 09:11:43 MSK DEBUG1 cleanupThread: thread starts
2009-12-08 09:11:43 MSK DEBUG1 syncThread: thread starts
2009-12-08 09:11:43 MSK DEBUG1 main: running scheduler mainloop
2009-12-08 09:11:43 MSK DEBUG1 remoteWorkerThread_1: helper thread for
provider 1 created
2009-12-08 09:11:43 MSK DEBUG1 remoteListenThread_1: connected to
'dbname=plus1 host=192.168.1.137 port=5432 user=slony'
2009-12-08 09:11:43 MSK INFO   Checking local node id
2009-12-08 09:11:43 MSK INFO   Found local node id
2009-12-08 09:11:43 MSK INFO   prepare for DDL script - set:1 onlyonnode:-1
2009-12-08 09:11:43 MSK ERROR  remoteWorkerThread_1: "select
"_slony".ddlScript_prepare_int(1, -1); " PGRES_FATAL_ERROR ERROR:
Slony-I: alterTableRestore(): Table "public"."access_type" is not in
altered state
CONTEXT:  SQL statement "SELECT  "_slony".alterTableRestore( $1 )"
PL/pgSQL function "ddlscript_prepare_int" line 46 at PERFORM
2009-12-08 09:11:43 MSK ERROR  remoteWorkerThread_1: DDL preparation
failed - set 1 - only on node -1
2009-12-08 09:11:43 MSK DEBUG1 slon: retry requested
2009-12-08 09:11:43 MSK INFO   remoteListenThread_1: disconnecting
from 'dbname=plus1 host=192.168.1.137 port=5432 user=slony'
2009-12-08 09:11:43 MSK DEBUG1 remoteListenThread_1: thread done
2009-12-08 09:11:43 MSK DEBUG1 localListenThread: thread done
2009-12-08 09:11:43 MSK DEBUG1 syncThread: thread done
2009-12-08 09:11:43 MSK DEBUG1 cleanupThread: thread done
2009-12-08 09:11:43 MSK DEBUG1 main: scheduler mainloop returned
2009-12-08 09:11:43 MSK DEBUG1 main: done
2009-12-08 09:11:43 MSK DEBUG1 slon: restart of worker
2009-12-08 09:11:43 MSK CONFIG main: slon version 1.2.17 starting up
2009-12-08 09:11:43 MSK CONFIG main: local node id = 2
2009-12-08 09:11:43 MSK CONFIG main: launching sched_start_mainloop
2009-12-08 09:11:43 MSK CONFIG main: loading current cluster configuration
2009-12-08 09:11:43 MSK CONFIG storeNode: no_id=1 no_comment='director'
2009-12-08 09:11:43 MSK CONFIG storePath: pa_server=1 pa_client=2
pa_conninfo="dbname=plus1 host=192.168.1.137 port=5432 user=slony"
pa_connretry=10
2009-12-08 09:11:43 MSK CONFIG storeListen: li_origin=1 li_receiver=2
li_provider=1
2009-12-08 09:11:43 MSK CONFIG storeSet: set_id=1 set_origin=1
set_comment='A replication set so boring no one thought to give it a
name'
2009-12-08 09:11:43 MSK WARN   remoteWorker_wakeup: node 1 - no worker thread
2009-12-08 09:11:43 MSK CONFIG storeSubscribe: sub_set=1
sub_provider=1 sub_forward='t'
2009-12-08 09:11:43 MSK WARN   remoteWorker_wakeup: node 1 - no worker thread
2009-12-08 09:11:43 MSK CONFIG enableSubscription: sub_set=1
2009-12-08 09:11:43 MSK WARN   remoteWorker_wakeup: node 1 - no worker thread
2009-12-08 09:11:43 MSK CONFIG main: configuration complete - starting threads
2009-12-08 09:11:43 MSK DEBUG1 localListenThread: thread starts
2009-12-08 09:11:43 MSK FATAL  localListenThread: "select
"_slony".cleanupNodelock(); insert into "_slony".sl_nodelock values (
  2, 0, "pg_catalog".pg_backend_pid()); " - ERROR:  duplicate key
value violates unique constraint "sl_nodelock-pkey"

2009-12-08 09:11:43 MSK DEBUG1 slon: shutdown requested
2009-12-08 09:12:03 MSK DEBUG1 slon: child termination timeout - kill child
2009-12-08 09:12:03 MSK DEBUG1 slon: done


-- 
=======================================================
? ? ????????: http://vkontakte.ru/id16323414
???? ?????? ?????, ?? ?? ??? ? ????? ????? - ??????, ?? ? ???? ?????? ?? ???.
From threshar at torgo.978.org  Tue Dec  8 09:56:26 2009
From: threshar at torgo.978.org (Jeff)
Date: Tue Dec  8 09:57:06 2009
Subject: [Slony1-general] Problem with execute script / slony version
	1.2.17
In-Reply-To: <ce8e675b0912072233q450c776m21cd622c73d7d978@mail.gmail.com>
References: <ce8e675b0912072233q450c776m21cd622c73d7d978@mail.gmail.com>
Message-ID: <924050C3-52B8-4801-8273-75D94E1E14F1@torgo.978.org>


On Dec 8, 2009, at 1:33 AM, Maxim Boguk wrote:

> I have a bit uncommon configuration now.
> Master: postgresql 8.3
> Slave:   postgresql 8.4
> slony:   version 1.2.17
>

You know what is funny - I *JUST* ran into this problem too!
It only seems to happen when not specifying "only on xxx"

Here's a **HACK** solution to get your replication going again:

create or replace function _replication.altertableforreplication(int)
returns int
as $$
declare
	p_tab_id			alias for $1;
	v_no_id				int4;
	v_tab_row			record;
	v_tab_fqname		text;
	v_tab_attkind		text;
	v_n					int4;
	v_trec	record;
	v_tgbad	boolean;
begin
	-- ----
	-- Grab the central configuration lock
	-- ----
	lock table "_replication".sl_config_lock;

	-- ----
	-- Get our local node ID
	-- ----
	v_no_id := "_replication".getLocalNodeId('_replication');

	-- ----
	-- Get the sl_table row and the current origin of the table.
	-- Verify that the table currently is NOT in altered state.
	-- ----
	select T.tab_reloid, T.tab_set, T.tab_idxname, T.tab_altered,
			S.set_origin, PGX.indexrelid,
			"_replication".slon_quote_brute(PGN.nspname) || '.' ||
			"_replication".slon_quote_brute(PGC.relname) as tab_fqname
			into v_tab_row
			from "_replication".sl_table T, "_replication".sl_set S,
				"pg_catalog".pg_class PGC, "pg_catalog".pg_namespace PGN,
				"pg_catalog".pg_index PGX, "pg_catalog".pg_class PGXC
			where T.tab_id = p_tab_id
				and T.tab_set = S.set_id
				and T.tab_reloid = PGC.oid
				and PGC.relnamespace = PGN.oid
				and PGX.indrelid = T.tab_reloid
				and PGX.indexrelid = PGXC.oid
				and PGXC.relname = T.tab_idxname
				for update;
	if not found then
		raise exception 'Slony-I: alterTableForReplication(): Table with id  
% not found', p_tab_id;
	end if;
	v_tab_fqname = v_tab_row.tab_fqname;
	if v_tab_row.tab_altered then
		raise notice 'Slony-I: alterTableForReplication(): Table % is  
already in altered state',
				v_tab_fqname;

		return p_tab_id;
	end if;

	v_tab_attkind :=  
"_replication".determineAttKindUnique(v_tab_row.tab_fqname,
						v_tab_row.tab_idxname);

	execute 'lock table ' || v_tab_fqname || ' in access exclusive mode';

	-- ----
	-- Procedures are different on origin and subscriber
	-- ----
	if v_no_id = v_tab_row.set_origin then
		-- ----
		-- On the Origin we add the log trigger to the table and done
		-- ----
		execute 'create trigger "_replication_logtrigger_' ||
				p_tab_id::text || '" after insert or update or delete on ' ||
				v_tab_fqname || ' for each row execute procedure
				"_replication".logTrigger (''_replication'', ''' ||
					p_tab_id::text || ''', ''' ||
					v_tab_attkind || ''');';
	else
		-- ----
		-- On the subscriber the thing is a bit more difficult. We want
		-- to disable all user- and foreign key triggers and rules.
		-- ----


		-- ----
		-- Check to see if there are any trigger conflicts...
		-- ----
		v_tgbad := 'false';
		for v_trec in
			select pc.relname, tg1.tgname from
			"pg_catalog".pg_trigger tg1,
			"pg_catalog".pg_trigger tg2,
			"pg_catalog".pg_class pc,
			"pg_catalog".pg_index pi,
			"_replication".sl_table tab
			where
			 tg1.tgname = tg2.tgname and        -- Trigger names match
			 tg1.tgrelid = tab.tab_reloid and   -- trigger 1 is on the table
			 pi.indexrelid = tg2.tgrelid and    -- trigger 2 is on the index
			 pi.indrelid = tab.tab_reloid and   -- indexes table is this table
			 pc.oid = tab.tab_reloid
                 loop
			raise notice 'Slony-I: alterTableForReplication(): multiple  
instances of trigger % on table %',
				v_trec.tgname, v_trec.relname;
			v_tgbad := 'true';
		end loop;
		if v_tgbad then
			raise exception 'Slony-I: Unable to disable triggers';
		end if;  		

		-- ----
		-- Disable all existing triggers
		-- ----
		update "pg_catalog".pg_trigger
				set tgrelid = v_tab_row.indexrelid
				where tgrelid = v_tab_row.tab_reloid
				and not exists (
						select true from "_replication".sl_table TAB,
								"_replication".sl_trigger TRIG
								where TAB.tab_reloid = tgrelid
								and TAB.tab_id = TRIG.trig_tabid
								and TRIG.trig_tgname = tgname
					);
		get diagnostics v_n = row_count;
		if (v_n > 0) and exists (select 1 from information_schema.columns  
where table_name = 'pg_class' and table_schema = 'pg_catalog' and  
column_name = 'reltriggers') then
			update "pg_catalog".pg_class
					set reltriggers = reltriggers - v_n
					where oid = v_tab_row.tab_reloid;
		end if;

		-- ----
		-- Disable all existing rules
		-- ----
		update "pg_catalog".pg_rewrite
				set ev_class = v_tab_row.indexrelid
				where ev_class = v_tab_row.tab_reloid;
		get diagnostics v_n = row_count;
		if v_n > 0 then
			update "pg_catalog".pg_class
					set relhasrules = false
					where oid = v_tab_row.tab_reloid;
		end if;

		-- ----
		-- Add the trigger that denies write access to replicated tables
		-- ----
		execute 'create trigger "_replication_denyaccess_' ||
				p_tab_id::text || '" before insert or update or delete on ' ||
				v_tab_fqname || ' for each row execute procedure
				"_replication".denyAccess (''_replication'');';
	end if;

	-- ----
	-- Mark the table altered in our configuration
	-- ----
	update "_replication".sl_table
			set tab_altered = true where tab_id = p_tab_id;

	return p_tab_id;
end;
$$
language 'plpgsql';

you'll need to change the _replication to _slony - in a nuthshell it  
makes the tab being altered not an error condition (changing tht  
EXCEPTION to a NOTICE).

This is a hack solution until a proper fix is done up - was about to  
fire up some test instances and trace what happens.


> Any execute script surely break replication set. Even if i submit
> something like 'select 1' via execte script replication will be broken
> down unrepairable. Only way fix it is drop/create/subscribe slave  
> node.
> restarting slon doesn't help at all...
>
> Here is slony log from slave database:
>
> 2009-12-08 09:11:43 MSK INFO   prepare for DDL script - set:1  
> onlyonnode:-1
> 2009-12-08 09:11:43 MSK ERROR  remoteWorkerThread_1: "select
> "_slony".ddlScript_prepare_int(1, -1); " PGRES_FATAL_ERROR ERROR:
> Slony-I: alterTableRestore(): Table "public"."access_type" is not in
> altered state
> CONTEXT:  SQL statement "SELECT  "_slony".alterTableRestore( $1 )"
> PL/pgSQL function "ddlscript_prepare_int" line 46 at PERFORM
> 2009-12-08 09:11:43 MSK ERROR  remoteWorkerThread_1: DDL preparation
> failed - set 1 - only on node -1
> 2009-12-08 09:11:43 MSK DEBUG1 slon: retry requested
> 2009-12-08 09:11:43 MSK INFO   remoteListenThread_1: disconnecting
> from 'dbname=plus1 host=192.168.1.137 port=5432 user=slony'
> 2009-12-08 09:11:43 MSK DEBUG1 syncThread: thread done
> 2009-12-08 09:11:43 MSK DEBUG1 localListenThread: thread done
> 2009-12-08 09:11:43 MSK DEBUG1 remoteListenThread_1: thread done
> 2009-12-08 09:11:43 MSK DEBUG1 main: scheduler mainloop returned
> 2009-12-08 09:11:43 MSK DEBUG1 cleanupThread: thread done
> 2009-12-08 09:11:43 MSK DEBUG1 main: done
> 2009-12-08 09:11:43 MSK DEBUG1 slon: restart of worker
> 2009-12-08 09:11:43 MSK CONFIG main: slon version 1.2.17 starting up
> 2009-12-08 09:11:43 MSK CONFIG main: local node id = 2
> 2009-12-08 09:11:43 MSK CONFIG main: launching sched_start_mainloop
> 2009-12-08 09:11:43 MSK CONFIG main: loading current cluster  
> configuration
> 2009-12-08 09:11:43 MSK CONFIG storeNode: no_id=1  
> no_comment='director'
> 2009-12-08 09:11:43 MSK CONFIG storePath: pa_server=1 pa_client=2
> pa_conninfo="dbname=plus1 host=192.168.1.137 port=5432 user=slony"
> pa_connretry=10
> 2009-12-08 09:11:43 MSK CONFIG storeListen: li_origin=1 li_receiver=2
> li_provider=1
> 2009-12-08 09:11:43 MSK CONFIG storeSet: set_id=1 set_origin=1
> set_comment='A replication set so boring no one thought to give it a
> name'
> 2009-12-08 09:11:43 MSK WARN   remoteWorker_wakeup: node 1 - no  
> worker thread
> 2009-12-08 09:11:43 MSK CONFIG storeSubscribe: sub_set=1
> sub_provider=1 sub_forward='t'
> 2009-12-08 09:11:43 MSK WARN   remoteWorker_wakeup: node 1 - no  
> worker thread
> 2009-12-08 09:11:43 MSK CONFIG enableSubscription: sub_set=1
> 2009-12-08 09:11:43 MSK WARN   remoteWorker_wakeup: node 1 - no  
> worker thread
> 2009-12-08 09:11:43 MSK CONFIG main: configuration complete -  
> starting threads
> 2009-12-08 09:11:43 MSK DEBUG1 localListenThread: thread starts
> NOTICE:  Slony-I: cleanup stale sl_nodelock entry for pid=31722
> 2009-12-08 09:11:43 MSK CONFIG enableNode: no_id=1
> 2009-12-08 09:11:43 MSK DEBUG1 remoteListenThread_1: thread starts
> 2009-12-08 09:11:43 MSK DEBUG1 remoteWorkerThread_1: thread starts
> 2009-12-08 09:11:43 MSK DEBUG1 cleanupThread: thread starts
> 2009-12-08 09:11:43 MSK DEBUG1 syncThread: thread starts
> 2009-12-08 09:11:43 MSK DEBUG1 main: running scheduler mainloop
> 2009-12-08 09:11:43 MSK DEBUG1 remoteWorkerThread_1: helper thread for
> provider 1 created
> 2009-12-08 09:11:43 MSK DEBUG1 remoteListenThread_1: connected to
> 'dbname=plus1 host=192.168.1.137 port=5432 user=slony'
> 2009-12-08 09:11:43 MSK INFO   Checking local node id
> 2009-12-08 09:11:43 MSK INFO   Found local node id
> 2009-12-08 09:11:43 MSK INFO   prepare for DDL script - set:1  
> onlyonnode:-1
> 2009-12-08 09:11:43 MSK ERROR  remoteWorkerThread_1: "select
> "_slony".ddlScript_prepare_int(1, -1); " PGRES_FATAL_ERROR ERROR:
> Slony-I: alterTableRestore(): Table "public"."access_type" is not in
> altered state
> CONTEXT:  SQL statement "SELECT  "_slony".alterTableRestore( $1 )"
> PL/pgSQL function "ddlscript_prepare_int" line 46 at PERFORM
> 2009-12-08 09:11:43 MSK ERROR  remoteWorkerThread_1: DDL preparation
> failed - set 1 - only on node -1
> 2009-12-08 09:11:43 MSK DEBUG1 slon: retry requested
> 2009-12-08 09:11:43 MSK INFO   remoteListenThread_1: disconnecting
> from 'dbname=plus1 host=192.168.1.137 port=5432 user=slony'
> 2009-12-08 09:11:43 MSK DEBUG1 remoteListenThread_1: thread done
> 2009-12-08 09:11:43 MSK DEBUG1 localListenThread: thread done
> 2009-12-08 09:11:43 MSK DEBUG1 syncThread: thread done
> 2009-12-08 09:11:43 MSK DEBUG1 cleanupThread: thread done
> 2009-12-08 09:11:43 MSK DEBUG1 main: scheduler mainloop returned
> 2009-12-08 09:11:43 MSK DEBUG1 main: done
> 2009-12-08 09:11:43 MSK DEBUG1 slon: restart of worker
> 2009-12-08 09:11:43 MSK CONFIG main: slon version 1.2.17 starting up
> 2009-12-08 09:11:43 MSK CONFIG main: local node id = 2
> 2009-12-08 09:11:43 MSK CONFIG main: launching sched_start_mainloop
> 2009-12-08 09:11:43 MSK CONFIG main: loading current cluster  
> configuration
> 2009-12-08 09:11:43 MSK CONFIG storeNode: no_id=1  
> no_comment='director'
> 2009-12-08 09:11:43 MSK CONFIG storePath: pa_server=1 pa_client=2
> pa_conninfo="dbname=plus1 host=192.168.1.137 port=5432 user=slony"
> pa_connretry=10
> 2009-12-08 09:11:43 MSK CONFIG storeListen: li_origin=1 li_receiver=2
> li_provider=1
> 2009-12-08 09:11:43 MSK CONFIG storeSet: set_id=1 set_origin=1
> set_comment='A replication set so boring no one thought to give it a
> name'
> 2009-12-08 09:11:43 MSK WARN   remoteWorker_wakeup: node 1 - no  
> worker thread
> 2009-12-08 09:11:43 MSK CONFIG storeSubscribe: sub_set=1
> sub_provider=1 sub_forward='t'
> 2009-12-08 09:11:43 MSK WARN   remoteWorker_wakeup: node 1 - no  
> worker thread
> 2009-12-08 09:11:43 MSK CONFIG enableSubscription: sub_set=1
> 2009-12-08 09:11:43 MSK WARN   remoteWorker_wakeup: node 1 - no  
> worker thread
> 2009-12-08 09:11:43 MSK CONFIG main: configuration complete -  
> starting threads
> 2009-12-08 09:11:43 MSK DEBUG1 localListenThread: thread starts
> 2009-12-08 09:11:43 MSK FATAL  localListenThread: "select
> "_slony".cleanupNodelock(); insert into "_slony".sl_nodelock values (
>  2, 0, "pg_catalog".pg_backend_pid()); " - ERROR:  duplicate key
> value violates unique constraint "sl_nodelock-pkey"
>
> 2009-12-08 09:11:43 MSK DEBUG1 slon: shutdown requested
> 2009-12-08 09:12:03 MSK DEBUG1 slon: child termination timeout -  
> kill child
> 2009-12-08 09:12:03 MSK DEBUG1 slon: done
>
>
> -- 
> =======================================================
> ? ? ????????: http://vkontakte.ru/id16323414
> ???? ?????? ?????, ?? ?? ??? ? ?????  
> ????? - ??????, ?? ? ???? ?????? ?? ???.
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general

--
Jeff Trout <jeff@jefftrout.com>
http://www.stuarthamm.net/
http://www.dellsmartexitin.com/



From jks at selectacast.net  Tue Dec  8 11:24:27 2009
From: jks at selectacast.net (Joseph S)
Date: Tue Dec  8 11:24:34 2009
Subject: [Slony1-general] PGRES_FATAL_ERROR ERROR: cannot change return
	type of existing function
In-Reply-To: <2968dfd60912030809o6f424f2fgda1ea654377698c7@mail.gmail.com>
References: <2968dfd60912021132y66cad68coce36f1262d91e519@mail.gmail.com>	<581440.53503.qm@web23602.mail.ird.yahoo.com>
	<2968dfd60912030809o6f424f2fgda1ea654377698c7@mail.gmail.com>
Message-ID: <4B1EA7EB.1040104@selectacast.net>

I used this and was able to upgrade from 1.2.15 to 1.2.18, but I did get 
this warning:

<stdin>:14: Possible unsupported PostgreSQL version 8.3, defaulting to 
8.1 support

I'm assuming for that I can ignore this.

Vick Khera wrote:
> On Thu, Dec 3, 2009 at 5:15 AM, Glyn Astill <glynastill@yahoo.co.uk> wrote:
>   
>> I took a quick peek in slony1_funcs.sql from the 1.2.18 release and the drop_if_exists functionality appears to be in there (although not in the slony1_funcs.vNN.sql scripts). I'm going to do a few more tests before upgrading our servers...
>>
>>     
>
> Once I added the lines
>
> drop function if exists @NAMESPACE@.ddlScript_complete (int4, text, int4);
> drop function if exists @NAMESPACE@.updateReloid (int4, int4);
>
> to slony1_funcs.sql it as was installed, my update succeeded.
>   
From jks at selectacast.net  Tue Dec  8 15:40:22 2009
From: jks at selectacast.net (Joseph S)
Date: Tue Dec  8 15:40:28 2009
Subject: [Slony1-general] performance problem: slony 1.2.18 locks table in
	finishTableAfterCopy()
Message-ID: <4B1EE3E6.4040207@selectacast.net>

I have a long running finishTableAfterCopy() that is holding up slony's =

own delete. It has an AccessExclusiveLock on sl_config_lock, which the =

delete is trying to get an AccessExclusiveLock. This is with pg 8.4.1 =

and slonly 1.2.18. This is holding up my initial replication.


datid 	procpid 	usesysid 	usename 	current_query 	waiting 	xact_start =

query_start 	running time 	backend_start 	client_port
26836 	27144 	10 	postgres 	<IDLE> 	false 	=

	2009-12-08 18:14:34.302872 	=

	2009-12-08 17:18:34.093328 	52813
26836 	27159 	10 	postgres 	<IDLE> 	false 	=

	2009-12-08 18:15:02.770757 	=

	2009-12-08 17:19:58.528877 	60146
26836 	27165 	10 	postgres 	select "_pd".finishTableAfterCopy(29); =

analyze "public"."elog"; 	false 	2009-12-08 17:35:22.121016 	2009-12-08 =

18:06:49.681582 	505 secs 	2009-12-08 17:19:58.544084 	60147
26836 	27166 	10 	postgres 	<IDLE> 	false 	=

	2009-12-08 18:15:12.772765 	=

	2009-12-08 17:19:58.544504 	60149
26836 	27167 	10 	postgres 	delete from "_pd".sl_log_1 where log_origin =

=3D '1' and log_xid < '1531403324'; delete from "_pd".sl_log_2 where =

log_origin =3D '1' and log_xid < '1531403324'; delete from "_pd".sl_seqlog =

where seql_origin =3D '1' and seql_ev_seqno < '313199'; select =

"_pd".logswitch_finish(); 	true 	2009-12-08 17:35:22.124154 	2009-12-08 =

17:35:22.124154 	2,392.557 secs 	2009-12-08 17:19:58.545379 	60150
26836 	27168 	10 	postgres 	<IDLE> 	false 	=

	2009-12-08 18:14:18.765095 	=

	2009-12-08 17:19:58.546374 	60151
26836 	27716 	10 	postgres 	FETCH 1000 FROM c_postgres_status_bean =

false 	2009-12-08 18:15:14.664707 	2009-12-08 18:15:14.67136 	0.01 =

secs 	2009-12-08 18:15:14.660396 	37599

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20091208/=
9f65386e/attachment.htm
From jks at selectacast.net  Tue Dec  8 22:08:08 2009
From: jks at selectacast.net (Joseph S)
Date: Tue Dec  8 22:08:12 2009
Subject: [Slony1-general] slon 1.2.18 crashing
Message-ID: <4B1F3EC8.4040103@selectacast.net>

This is slon 1.2.18 running on against pg 8.4.1 on a CentOS 5.4 system. 
During the initial data population of this new slave server slon got 
into a state where it keeps crashing, trying to start again, and 
crashing again.

I get a lot of this in my log:
2009-12-09 00:53:48 EST DEBUG2 remoteListenThread_1: queue event 
1,313687 SYNC
2009-12-09 00:53:48 EST DEBUG2 remoteListenThread_1: queue event 
1,313688 SYNC
2009-12-09 00:53:48 EST DEBUG2 remoteListenThread_1: queue event 
1,313689 SYNC
2009-12-09 00:53:48 EST DEBUG2 remoteListenThread_1: queue event 
1,313690 SYNC
2009-12-09 00:53:48 EST DEBUG2 remoteListenThread_1: queue event 
1,313691 SYNC
2009-12-09 00:53:48 EST DEBUG2 remoteListenThread_1: queue event 
1,313692 SYNC
2009-12-09 00:53:48 EST DEBUG2 remoteListenThread_1: queue event 
1,313693 SYNC
2009-12-09 00:53:48 EST DEBUG2 remoteListenThread_1: queue event 
1,313694 SYNC
2009-12-09 00:53:48 EST DEBUG2 remoteWorkerThread_1: syncing set 1 with 
5 table(s) from provider 1
2009-12-09 00:53:48 EST DEBUG2 slon: child terminated status: 139; pid: 
3972, current worker pid: 3972

... which repeats 10 seconds later.

The core file is no help. I built slony with debug symbols but gdb isn't 
telling me anything useful:


(gdb) bt
#0  0x000000367ae796d0 in ?? ()
#1  0x000000367ae46b69 in ?? ()
#2  0x0000000a00000000 in ?? ()
#3  0x00000000427cee60 in ?? ()
#4  0x0000000000000001 in ?? ()
#5  0x00000000427ce980 in ?? ()
#6  0x0000000000000000 in ?? ()


(gdb) thread apply all bt

Thread 9 (process 4051):
#0  0x000000367ba077e5 in ?? ()
#1  0x000000367ba076a0 in ?? ()
#2  0x00000000413e1d28 in ?? ()
#3  0x0000000000000000 in ?? ()

Thread 8 (process 4053):
#0  0x000000367aecced2 in ?? ()
#1  0x0000000000000000 in ?? ()

Thread 7 (process 4054):
#0  0x000000367ba0ab99 in ?? ()
#1  0x0000000000000000 in ?? ()

Thread 6 (process 4057):
#0  0x000000367ba0ab99 in ?? ()
#1  0x0000000000000000 in ?? ()

Thread 5 (process 4058):
#0  0x000000367ba0ab99 in ?? ()
#1  0x0000000000000000 in ?? ()

Thread 4 (process 4059):
#0  0x000000367ba0ab99 in ?? ()
---Type <return> to continue, or q <return> to quit---
#1  0x0000000000000000 in ?? ()

Thread 3 (process 4060):
#0  0x000000367ba0ab99 in ?? ()
#1  0x0000000000000000 in ?? ()

Thread 2 (process 4065):
#0  0x000000367ba0ab99 in ?? ()
#1  0x0000000000000000 in ?? ()

Thread 1 (process 4056):
#0  0x000000367ae796d0 in ?? ()
#1  0x000000367ae46b69 in ?? ()
#2  0x0000000a00000000 in ?? ()
#3  0x00000000427cee60 in ?? ()
#4  0x0000000000000001 in ?? ()
#5  0x00000000427ce980 in ?? ()
#6  0x0000000000000000 in ?? ()
(gdb)

]$ file core.4051
core.4051: ELF 64-bit LSB core file AMD x86-64, version 1 (SYSV), 
SVR4-style, from 'slon'
]$ file `which slon`
/usr/local/pgsql/bin/slon: ELF 64-bit LSB executable, AMD x86-64, 
version 1 (SYSV), for GNU/Linux 2.6.9, dynamically linked (uses shared 
libs), for GNU/Linux 2.6.9, not stripped


From jks at selectacast.net  Tue Dec  8 23:09:46 2009
From: jks at selectacast.net (Joseph S)
Date: Tue Dec  8 23:09:50 2009
Subject: [Slony1-general] slon 1.2.18 crashing
In-Reply-To: <4B1F3EC8.4040103@selectacast.net>
References: <4B1F3EC8.4040103@selectacast.net>
Message-ID: <4B1F4D3A.4020702@selectacast.net>

I was able to get a backtrace by running in gdb.

Program received signal SIGSEGV, Segmentation fault.
[Switching to Thread 0x43007940 (LWP 30215)]
0x000000367ae796d0 in strlen () from /lib64/libc.so.6
(gdb) bt
#0  0x000000367ae796d0 in strlen () from /lib64/libc.so.6
#1  0x000000367ae46b69 in vfprintf () from /lib64/libc.so.6
#2  0x000000367ae6988a in vsnprintf () from /lib64/libc.so.6
#3  0x0000000000417618 in slon_log (level=<value optimized out>, 
fmt=0x41edd8 " ssy_action_list value: %s\n") at misc.c:175
#4  0x00000000004093d0 in sync_event (node=0x1006d3b0, local_conn=<value 
optimized out>, wd=0x1006cbd0, event=0x1009bfa0) at remote_worker.c:4353
#5  0x000000000040ba42 in remoteWorkerThread_main (cdata=<value 
optimized out>) at remote_worker.c:630
#6  0x000000367ba064a7 in start_thread () from /lib64/libpthread.so.0
#7  0x000000367aed3c2d in clone () from /lib64/libc.so.6




I ran slon with -d 1 and now slon is working again.
From JanWieck at Yahoo.com  Wed Dec  9 09:58:57 2009
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Wed Dec  9 09:57:11 2009
Subject: [Slony1-general] PGRES_FATAL_ERROR ERROR: cannot change return
	type of existing function
In-Reply-To: <4B1EA7EB.1040104@selectacast.net>
References: <2968dfd60912021132y66cad68coce36f1262d91e519@mail.gmail.com>	<581440.53503.qm@web23602.mail.ird.yahoo.com>	<2968dfd60912030809o6f424f2fgda1ea654377698c7@mail.gmail.com>
	<4B1EA7EB.1040104@selectacast.net>
Message-ID: <4B1FE561.5060103@Yahoo.com>

On 12/8/2009 2:24 PM, Joseph S wrote:
> I used this and was able to upgrade from 1.2.15 to 1.2.18, but I did get 
> this warning:
> 
> <stdin>:14: Possible unsupported PostgreSQL version 8.3, defaulting to 
> 8.1 support
> 
> I'm assuming for that I can ignore this.

Yes, but unfortunately I just found and fixed a bug in that 
drop_if_exists function. Chris will be rolling a 1.2.19 today.


Jan


> 
> Vick Khera wrote:
>> On Thu, Dec 3, 2009 at 5:15 AM, Glyn Astill <glynastill@yahoo.co.uk> wrote:
>>   
>>> I took a quick peek in slony1_funcs.sql from the 1.2.18 release and the drop_if_exists functionality appears to be in there (although not in the slony1_funcs.vNN.sql scripts). I'm going to do a few more tests before upgrading our servers...
>>>
>>>     
>>
>> Once I added the lines
>>
>> drop function if exists @NAMESPACE@.ddlScript_complete (int4, text, int4);
>> drop function if exists @NAMESPACE@.updateReloid (int4, int4);
>>
>> to slony1_funcs.sql it as was installed, my update succeeded.
>>   
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin
From JanWieck at Yahoo.com  Wed Dec  9 11:21:45 2009
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Wed Dec  9 11:19:53 2009
Subject: [Slony1-general] slon 1.2.18 crashing 
In-Reply-To: <4B1F4D3A.4020702@selectacast.net>
References: <4B1F3EC8.4040103@selectacast.net>
	<4B1F4D3A.4020702@selectacast.net>
Message-ID: <4B1FF8C9.5030406@Yahoo.com>

On 12/9/2009 2:09 AM, Joseph S wrote:
> I was able to get a backtrace by running in gdb.
> 
> Program received signal SIGSEGV, Segmentation fault.
> [Switching to Thread 0x43007940 (LWP 30215)]
> 0x000000367ae796d0 in strlen () from /lib64/libc.so.6
> (gdb) bt
> #0  0x000000367ae796d0 in strlen () from /lib64/libc.so.6
> #1  0x000000367ae46b69 in vfprintf () from /lib64/libc.so.6
> #2  0x000000367ae6988a in vsnprintf () from /lib64/libc.so.6
> #3  0x0000000000417618 in slon_log (level=<value optimized out>, 
> fmt=0x41edd8 " ssy_action_list value: %s\n") at misc.c:175
> #4  0x00000000004093d0 in sync_event (node=0x1006d3b0, local_conn=<value 
> optimized out>, wd=0x1006cbd0, event=0x1009bfa0) at remote_worker.c:4353
> #5  0x000000000040ba42 in remoteWorkerThread_main (cdata=<value 
> optimized out>) at remote_worker.c:630
> #6  0x000000367ba064a7 in start_thread () from /lib64/libpthread.so.0
> #7  0x000000367aed3c2d in clone () from /lib64/libc.so.6

What puzzles me is that the code in remote_worker.c just one line before 
the slon_log() call did (apparently successful) do a strlen() on exactly 
that ssy_action_list. So why on earth does the same inside of vfprintf() 
fail?


Jan

-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin
From JanWieck at Yahoo.com  Wed Dec  9 11:51:30 2009
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Wed Dec  9 11:49:07 2009
Subject: [Slony1-general] slon 1.2.18 crashing
In-Reply-To: <4B1FF8C9.5030406@Yahoo.com>
References: <4B1F3EC8.4040103@selectacast.net>	<4B1F4D3A.4020702@selectacast.net>
	<4B1FF8C9.5030406@Yahoo.com>
Message-ID: <4B1FFFC2.3080505@Yahoo.com>

On 12/9/2009 2:21 PM, Jan Wieck wrote:
> On 12/9/2009 2:09 AM, Joseph S wrote:
>> I was able to get a backtrace by running in gdb.
>> 
>> Program received signal SIGSEGV, Segmentation fault.
>> [Switching to Thread 0x43007940 (LWP 30215)]
>> 0x000000367ae796d0 in strlen () from /lib64/libc.so.6
>> (gdb) bt
>> #0  0x000000367ae796d0 in strlen () from /lib64/libc.so.6
>> #1  0x000000367ae46b69 in vfprintf () from /lib64/libc.so.6
>> #2  0x000000367ae6988a in vsnprintf () from /lib64/libc.so.6
>> #3  0x0000000000417618 in slon_log (level=<value optimized out>, 
>> fmt=0x41edd8 " ssy_action_list value: %s\n") at misc.c:175
>> #4  0x00000000004093d0 in sync_event (node=0x1006d3b0, local_conn=<value 
>> optimized out>, wd=0x1006cbd0, event=0x1009bfa0) at remote_worker.c:4353
>> #5  0x000000000040ba42 in remoteWorkerThread_main (cdata=<value 
>> optimized out>) at remote_worker.c:630
>> #6  0x000000367ba064a7 in start_thread () from /lib64/libpthread.so.0
>> #7  0x000000367aed3c2d in clone () from /lib64/libc.so.6
> 
> What puzzles me is that the code in remote_worker.c just one line before 
> the slon_log() call did (apparently successful) do a strlen() on exactly 
> that ssy_action_list. So why on earth does the same inside of vfprintf() 
> fail?

Uh oh ... apparently the code in misc.c is broken. The call

vsnprintf(&outbuf[off], outsize - off, fmt, ap)

will cause vsnprintf() to clobber the byte immediately following the 
malloc()'d outbuf with the nul terminator if the string is larger that 
the space in outbuf.


Jan

-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin
From cbbrowne at ca.afilias.info  Wed Dec  9 13:39:43 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed Dec  9 13:39:46 2009
Subject: [Slony1-general] Release 1.2.20 available
Message-ID: <87ein34yjk.fsf@dba2.int.libertyrms.com>

Watching CVS logs would show that Jan and I have been pretty busy today
;-).  Alas, I was a bit too quick at letting 1.2.19 out the door, so
1.2.20 had to follow, shortly :-(.

See the URL below for details on what has changed lately; it should
address:
 a) The problems with UPGRADE FUNCTIONS that Vivek recently pointed out
 b) The crash (at subscribe time, if debugging's set WAY high) observed
    by "Joseph S"
 c) Breakage of configuration change requests with some of the stored
    functions when event numbers reach 2^31-1
-- 
<http://slony.info/>
Christopher Browne
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"
From jks at selectacast.net  Wed Dec  9 22:02:27 2009
From: jks at selectacast.net (Joseph S)
Date: Wed Dec  9 22:02:57 2009
Subject: [Slony1-general] Release 1.2.20 available
In-Reply-To: <87ein34yjk.fsf@dba2.int.libertyrms.com>
References: <87ein34yjk.fsf@dba2.int.libertyrms.com>
Message-ID: <4B208EF3.9020508@selectacast.net>



Christopher Browne wrote:
>  b) The crash (at subscribe time, if debugging's set WAY high) observed
>     by "Joseph S"

I didn't set the debug level, that's how it was out of the box. I turned 
it down to avoid the crash.
From devrim at gunduz.org  Thu Dec 10 06:01:58 2009
From: devrim at gunduz.org (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Thu Dec 10 06:04:12 2009
Subject: [Slony1-general] Wrong lag time report  with 2.0.3RC3
Message-ID: <1260453718.2714.87.camel@hp-laptop2.gunduz.org>

SGksCgpJIGhhdmUgYSBzbG9uIGluc3RhbmNlIHRoYXQgaXMgcnVubmluZyAyLjAuMyBSQzMgd2l0
aCBQb3N0Z3JlU1FMIDguMyBhbmQKOC40LiBUaGV5IGFsbCBydW4gb24gdGhlIHNhbWUgc2VydmVy
IChteSBwZXJzb25hbCBzZXJ2ZXIpLgoKVG9kYXkgSSByZXN0YXJ0ZWQgOC4zIGluc3RhbmNlIHRv
IHBlcmZvcm0gYW4gdXBncmFkZS4gU2luY2UgdGhlbiwKU2xvbnktSSByZXBvcnRzIGEgbGFnIHdo
ZW4gSSBxdWVyeSBpdCBmcm9tIHNsYXZlLiBPbiBtYXN0ZXIsIGV2ZXJ5dGhpbmcKbG9va3Mgb2su
IFRoZXJlIGlzIG5vdGhpbmcgc3VzcGljaW91cyBpbiB0aGUgbG9ncyAtLSBhbmQgbG9ncyBzYXkg
dGhhdApkYXRhIGlzIGZsb3dpbmcgZnJvbSA4LjMgdG8gOC40IC0tIGFuZCBJIGNvbmZpcm1lZCB0
aGF0IGRhdGEgb24gb3JpZ2luCmFuZCBzdWJzY3JpYmVyIGFyZSB0aGUgc2FtZS4KCkkgcmVzdGFy
dGVkIHNsb24gZGFlbW9ucywgYnV0IGl0IGRpZCBub3QgaGVscC4gSXQganVzdCByZXNldCB0aGUg
bGFnCnRpbWUsIGJ1dCBzaW5jZSB0aGVuIGxhZyBpcyBzdGlsbCBpbmNyZWFzaW5nLgoKSGVyZSBp
cyB3aGF0IEkgZXhhY3RseSBoYXZlOgoKT3JpZ2luOgoKIyBTRUxFQ1QgKiBmcm9tIF9yZXBsaWNh
dGlvbi5zbF9zdGF0dXM7Ci1bIFJFQ09SRCAxIF0tLS0tLS0tLS0tLS0tKy0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLQpzdF9vcmlnaW4gICAgICAgICAgICAgICAgIHwgMwpzdF9yZWNlaXZlZCAg
ICAgICAgICAgICAgIHwgNApzdF9sYXN0X2V2ZW50ICAgICAgICAgICAgIHwgOTAyODM5CnN0X2xh
c3RfZXZlbnRfdHMgICAgICAgICAgfCAyMDA5LTEyLTEwIDE2OjAyOjU2LjAxNjA2NwpzdF9sYXN0
X3JlY2VpdmVkICAgICAgICAgIHwgOTAyODM4CnN0X2xhc3RfcmVjZWl2ZWRfdHMgICAgICAgfCAy
MDA5LTEyLTEwIDE2OjAyOjUxLjE4NTI1NwpzdF9sYXN0X3JlY2VpdmVkX2V2ZW50X3RzIHwgMjAw
OS0xMi0xMCAxNjowMjo0Ni4wMTEzMTMKc3RfbGFnX251bV9ldmVudHMgICAgICAgICB8IDEKc3Rf
bGFnX3RpbWUgICAgICAgICAgICAgICB8IDAwOjAwOjEzLjU1NjQ2OQoKU3Vic2NyaWJlcjoKCiMg
U0VMRUNUICogZnJvbSBfcmVwbGljYXRpb24uc2xfc3RhdHVzOwotWyBSRUNPUkQgMSBdLS0tLS0t
LS0tLS0tLSstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0Kc3Rfb3JpZ2luICAgICAgICAgICAg
ICAgICB8IDQKc3RfcmVjZWl2ZWQgICAgICAgICAgICAgICB8IDMKc3RfbGFzdF9ldmVudCAgICAg
ICAgICAgICB8IDE5CnN0X2xhc3RfZXZlbnRfdHMgICAgICAgICAgfCAyMDA5LTEyLTEwIDE1OjU5
OjU4LjkxMTY3OQpzdF9sYXN0X3JlY2VpdmVkICAgICAgICAgIHwgMTkKc3RfbGFzdF9yZWNlaXZl
ZF90cyAgICAgICB8IDIwMDktMTItMTAgMTY6MDA6MDEuNzgxMTU4CnN0X2xhc3RfcmVjZWl2ZWRf
ZXZlbnRfdHMgfCAyMDA5LTEyLTEwIDE1OjU5OjU4LjkxMTY3OQpzdF9sYWdfbnVtX2V2ZW50cyAg
ICAgICAgIHwgMApzdF9sYWdfdGltZSAgICAgICAgICAgICAgIHwgMDA6MDM6MzguMTA3NTE3CgoK
SXMgdGhlcmUgYW55dGhpbmcgdGhhdCBJIGNhbiBoZWxwIHlvdSB0byBkZWJ1ZyB0aGlzIGlzc3Vl
PyAKClJlZ2FyZHMsCi0tIApEZXZyaW0gR8OcTkTDnFosIFJIQ0UKQ29tbWFuZCBQcm9tcHQgLSBo
dHRwOi8vd3d3LkNvbW1hbmRQcm9tcHQuY29tIApkZXZyaW1+Z3VuZHV6Lm9yZywgZGV2cmltflBv
c3RncmVTUUwub3JnLCBkZXZyaW0uZ3VuZHV6fmxpbnV4Lm9yZy50cgpodHRwOi8vd3d3Lmd1bmR1
ei5vcmcgIFR3aXR0ZXI6IGh0dHA6Ly90d2l0dGVyLmNvbS9kZXZyaW1ndW5kdXoKLS0tLS0tLS0t
LS0tLS0gbmV4dCBwYXJ0IC0tLS0tLS0tLS0tLS0tCkEgbm9uLXRleHQgYXR0YWNobWVudCB3YXMg
c2NydWJiZWQuLi4KTmFtZTogbm90IGF2YWlsYWJsZQpUeXBlOiBhcHBsaWNhdGlvbi9wZ3Atc2ln
bmF0dXJlClNpemU6IDE5NyBieXRlcwpEZXNjOiBUaGlzIGlzIGEgZGlnaXRhbGx5IHNpZ25lZCBt
ZXNzYWdlIHBhcnQKVXJsIDogaHR0cDovL2xpc3RzLnNsb255LmluZm8vcGlwZXJtYWlsL3Nsb255
MS1nZW5lcmFsL2F0dGFjaG1lbnRzLzIwMDkxMjEwLzI4YTE1OGQzL2F0dGFjaG1lbnQucGdwCg==
From JanWieck at Yahoo.com  Thu Dec 10 01:18:52 2009
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Thu Dec 10 06:06:48 2009
Subject: [Slony1-general] Release 1.2.20 available
In-Reply-To: <4B208EF3.9020508@selectacast.net>
References: <87ein34yjk.fsf@dba2.int.libertyrms.com>
	<4B208EF3.9020508@selectacast.net>
Message-ID: <4B20BCFC.3060007@Yahoo.com>

On 12/10/2009 1:02 AM, Joseph S wrote:
> 
> Christopher Browne wrote:
>>  b) The crash (at subscribe time, if debugging's set WAY high) observed
>>     by "Joseph S"
> 
> I didn't set the debug level, that's how it was out of the box. I turned 
> it down to avoid the crash.

Out of the box at level 4? That's certainly a box made by someone who 
loves excessive log generation.


Jan

-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin

From JanWieck at Yahoo.com  Thu Dec 10 01:44:06 2009
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Thu Dec 10 06:32:14 2009
Subject: [Slony1-general] Wrong lag time report  with 2.0.3RC3
In-Reply-To: <1260453718.2714.87.camel@hp-laptop2.gunduz.org>
References: <1260453718.2714.87.camel@hp-laptop2.gunduz.org>
Message-ID: <4B20C2E6.4010708@Yahoo.com>

On 12/10/2009 9:01 AM, Devrim G?ND?Z wrote:
> Hi,
> 
> I have a slon instance that is running 2.0.3 RC3 with PostgreSQL 8.3 and
> 8.4. They all run on the same server (my personal server).
> 
> Today I restarted 8.3 instance to perform an upgrade. Since then,
> Slony-I reports a lag when I query it from slave. On master, everything
> looks ok. There is nothing suspicious in the logs -- and logs say that
> data is flowing from 8.3 to 8.4 -- and I confirmed that data on origin
> and subscriber are the same.
> 
> I restarted slon daemons, but it did not help. It just reset the lag
> time, but since then lag is still increasing.
> 
> Here is what I exactly have:
> 
> Origin:
> 
> # SELECT * from _replication.sl_status;
> -[ RECORD 1 ]-------------+---------------------------
> st_origin                 | 3
> st_received               | 4
> st_last_event             | 902839
> st_last_event_ts          | 2009-12-10 16:02:56.016067
> st_last_received          | 902838
> st_last_received_ts       | 2009-12-10 16:02:51.185257
> st_last_received_event_ts | 2009-12-10 16:02:46.011313
> st_lag_num_events         | 1
> st_lag_time               | 00:00:13.556469
> 
> Subscriber:
> 
> # SELECT * from _replication.sl_status;
> -[ RECORD 1 ]-------------+---------------------------
> st_origin                 | 4
> st_received               | 3
> st_last_event             | 19
> st_last_event_ts          | 2009-12-10 15:59:58.911679
> st_last_received          | 19
> st_last_received_ts       | 2009-12-10 16:00:01.781158
> st_last_received_event_ts | 2009-12-10 15:59:58.911679
> st_lag_num_events         | 0
> st_lag_time               | 00:03:38.107517
> 
> 
> Is there anything that I can help you to debug this issue? 

What issue? The last event created by the node is 19, which is confirmed 
by the other node. That happened some time ago, but there is nothing 
fundamentally wrong here. Slony only generates SYNC events when there is 
replication data to transport, and every now and then one for good 
measure (I forgot what the default interval is for that). You can play 
with the -t option if you don't like to see that lag.


Jan

-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin
From jcasanov at systemguards.com.ec  Thu Dec 10 22:36:45 2009
From: jcasanov at systemguards.com.ec (Jaime Casanova)
Date: Thu Dec 10 22:37:04 2009
Subject: [slony1-general] slony I 2.0.3
Message-ID: <3073cc9b0912102236q3c1c3991k7808ac62516609cd@mail.gmail.com>

Hi,

There are plans to release this shortly or should i stick with 1.2.x series?

-- 
Atentamente,
Jaime Casanova
Soporte y capacitaci?n de PostgreSQL
Asesor?a y desarrollo de sistemas
Guayaquil - Ecuador
Cel. +59387171157
From scott.marlowe at gmail.com  Thu Dec 10 23:32:06 2009
From: scott.marlowe at gmail.com (Scott Marlowe)
Date: Thu Dec 10 23:32:09 2009
Subject: [slony1-general] slony I 2.0.3
In-Reply-To: <3073cc9b0912102236q3c1c3991k7808ac62516609cd@mail.gmail.com>
References: <3073cc9b0912102236q3c1c3991k7808ac62516609cd@mail.gmail.com>
Message-ID: <dcc563d10912102332ye6b8017n9908ec2adb949acf@mail.gmail.com>

On Thu, Dec 10, 2009 at 11:36 PM, Jaime Casanova
<jcasanov@systemguards.com.ec> wrote:
> Hi,
>
> There are plans to release this shortly or should i stick with 1.2.x series?

You should test it really hard.  I had problems with the 2.x series in
production a few months ago, with hung processes and a database that
wouldn't come back to normal operation without a restart of pgsql.  I
have had no such problems with the 1.2.x series.
From nimesh.satam at gmail.com  Fri Dec 11 03:27:28 2009
From: nimesh.satam at gmail.com (Nimesh Satam)
Date: Fri Dec 11 03:27:31 2009
Subject: [Slony1-general] How to confirm if a certain insert has completed
	on the slave db?
In-Reply-To: <F4BB44BC-F220-4B59-9D61-D37D730DAC91@torgo.978.org>
References: <65f3e23d0911042109w6f666a22raa2ea8331b8e2f31@mail.gmail.com>
	<B9C1AF04-C2CC-4E3A-B1B2-B5CF1E7E01E4@torgo.978.org>
	<65f3e23d0911120401ja371bbdt4d9deff1dab06354@mail.gmail.com>
	<F4BB44BC-F220-4B59-9D61-D37D730DAC91@torgo.978.org>
Message-ID: <65f3e23d0912110327w191b6e9bv5360d967e5a19046@mail.gmail.com>

Jeff,

Thanks Jeff for your reply. But I am not able to locate the "getCurrentXid"
in my slony functions. Can you tell me where I will be able to find this
function? Currently I am using slony-2.0.1

Also the function passed contains column ev_maxxid, ev_xip from sl_event.
But I am not able to locate the same columns in sl_event of the above slony
installation.

             Table "_cluster.sl_event"
    Column    |            Type             | Modifiers
--------------+-----------------------------+-----------
 ev_origin    | integer                     | not null
 ev_seqno     | bigint                      | not null
 ev_timestamp | timestamp without time zone |
 ev_snapshot  | txid_snapshot               |
 ev_type      | text                        |
 ev_data1     | text                        |
 ev_data2     | text                        |
 ev_data3     | text                        |
 ev_data4     | text                        |
 ev_data5     | text                        |
 ev_data6     | text                        |
 ev_data7     | text                        |
 ev_data8     | text                        |
Indexes:
    "sl_event-pkey" PRIMARY KEY, btree (ev_origin, ev_seqno)


Can you correct me if I am missing anything?

Regards,
Nimesh.





On 11/19/09, Jeff <threshar@torgo.978.org> wrote:
>
>
> On Nov 12, 2009, at 7:01 AM, Nimesh Satam wrote:
>
> Jeff,
>>
>> Thanks for the reply, can you let us know how we get the values for the
>> function inputs p_start , p_txid ?
>>
>> Regards,
>> Nimesh.
>>
>
> select now() as ctime, _replication.getCurrentXid() as txid")
>
> and then you can feed those into syncwait
>
> remember that you need to start a txn, do your insert, then call these.  =
If
> you do it outside the txn I don't know what txnid is related to the row
> inserted.
>
>
>
>> On Thu, Nov 5, 2009 at 7:49 PM, Jeff <threshar@torgo.978.org> wrote:
>>
>> On Nov 5, 2009, at 12:09 AM, Nimesh Satam wrote:
>>
>> All,
>>
>> Is there any way to confirm that a certain insert has been completed on
>> the slave database? Would the sl_confirm or sl_event table be useful for
>> this?
>>
>> For eg: If I have a batch of 100 Inserts, how do I make sure that all ha=
ve
>> been done on slave?
>>
>> Regards,
>> Nimesh.
>>
>>
>> I've got this code which seems to work well.  I added a function to my DB
>> access layer called "syncexec" that executes and waits for the slaves (u=
p to
>> a predefined interval).
>>
>> You'll need to do your work inside a transaction and get the txn's txnid
>> for this to work (you can obtain it via _cluster.getCurrentXid()
>>
>>
>>
>>
>> --
>> Jeff Trout <jeff@jefftrout.com>
>> http://www.stuarthamm.net/
>> http://www.dellsmartexitin.com/
>>
>>
>>
>>
>>
>>
> --
> Jeff Trout <jeff@jefftrout.com>
> http://www.stuarthamm.net/
> http://www.dellsmartexitin.com/
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20091211/=
ab839ae9/attachment.htm
From peter.geoghegan86 at gmail.com  Fri Dec 11 03:59:12 2009
From: peter.geoghegan86 at gmail.com (Peter Geoghegan)
Date: Fri Dec 11 03:59:15 2009
Subject: [slony1-general] slony I 2.0.3
In-Reply-To: <dcc563d10912102332ye6b8017n9908ec2adb949acf@mail.gmail.com>
References: <3073cc9b0912102236q3c1c3991k7808ac62516609cd@mail.gmail.com>
	<dcc563d10912102332ye6b8017n9908ec2adb949acf@mail.gmail.com>
Message-ID: <db471ace0912110359u5460226aheedfe6187a49a85a@mail.gmail.com>

I've had difficulties with the sl_status view on 2.0.2 (event lag
grows even as events actually replicate; see several previous posts to
the list by me). I hope this issue gets resolved soon if it hasn't
already been in the 2.3RCs, and would like to offer my assistance to
anyone in isolating and fixing the problem (I need windows binaries,
so I haven't tried 2.3RCs yet).

However, I've used 1.2.15  in the past and never had any problems. It
might be prudent to stick to 1.2.* if everything is fine already,

Regards,
Peter Geoghegan
From bnichols at ca.afilias.info  Fri Dec 11 05:32:19 2009
From: bnichols at ca.afilias.info (Brad Nicholson)
Date: Fri Dec 11 05:32:23 2009
Subject: [slony1-general] slony I 2.0.3
In-Reply-To: <db471ace0912110359u5460226aheedfe6187a49a85a@mail.gmail.com>
References: <3073cc9b0912102236q3c1c3991k7808ac62516609cd@mail.gmail.com>
	<dcc563d10912102332ye6b8017n9908ec2adb949acf@mail.gmail.com>
	<db471ace0912110359u5460226aheedfe6187a49a85a@mail.gmail.com>
Message-ID: <1260538339.9403.1072.camel@bnicholson-desktop>

On Fri, 2009-12-11 at 11:59 +0000, Peter Geoghegan wrote:

> However, I've used 1.2.15  in the past and never had any problems. It
> might be prudent to stick to 1.2.* if everything is fine already,


I'd recommend sticking with 1.2.x for now.

-- 
Brad Nicholson  416-673-4106
Database Administrator, Afilias Canada Corp.


From JanWieck at Yahoo.com  Fri Dec 11 05:41:12 2009
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Fri Dec 11 06:53:09 2009
Subject: [slony1-general] slony I 2.0.3
In-Reply-To: <1260538339.9403.1072.camel@bnicholson-desktop>
References: <3073cc9b0912102236q3c1c3991k7808ac62516609cd@mail.gmail.com>	<dcc563d10912102332ye6b8017n9908ec2adb949acf@mail.gmail.com>	<db471ace0912110359u5460226aheedfe6187a49a85a@mail.gmail.com>
	<1260538339.9403.1072.camel@bnicholson-desktop>
Message-ID: <4B224BF8.7010304@Yahoo.com>

On 12/11/2009 8:32 AM, Brad Nicholson wrote:
> On Fri, 2009-12-11 at 11:59 +0000, Peter Geoghegan wrote:
> 
>> However, I've used 1.2.15  in the past and never had any problems. It
>> might be prudent to stick to 1.2.* if everything is fine already,
> 
> 
> I'd recommend sticking with 1.2.x for now.
> 

I have plans for testing and doing a detailed code review. But it's 
going to take some time. At this point I'd second that 2.0 is not ready 
for production.


Jan

-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin

From michelle at sorbs.net  Fri Dec 11 07:00:54 2009
From: michelle at sorbs.net (Michelle Sullivan)
Date: Fri Dec 11 07:01:04 2009
Subject: [slony1-general] slony I 2.0.3
In-Reply-To: <4B224BF8.7010304@Yahoo.com>
References: <3073cc9b0912102236q3c1c3991k7808ac62516609cd@mail.gmail.com>
	<dcc563d10912102332ye6b8017n9908ec2adb949acf@mail.gmail.com>
	<db471ace0912110359u5460226aheedfe6187a49a85a@mail.gmail.com>
	<1260538339.9403.1072.camel@bnicholson-desktop>
	<4B224BF8.7010304@Yahoo.com>
Message-ID: <4B225EA6.7090204@sorbs.net>

Jan Wieck wrote:
> On 12/11/2009 8:32 AM, Brad Nicholson wrote:
>> On Fri, 2009-12-11 at 11:59 +0000, Peter Geoghegan wrote:
>>
>>> However, I've used 1.2.15 in the past and never had any problems. It
>>> might be prudent to stick to 1.2.* if everything is fine already,
>>
>>
>> I'd recommend sticking with 1.2.x for now.
>>
>
> I have plans for testing and doing a detailed code review. But it's
> going to take some time. At this point I'd second that 2.0 is not ready
> for production.


Any ideas on my issue before I scrap it and try 2.0+?


http://lists.slony.info/pipermail/slony1-general/2009-December/010217.html
From matthias at aic.at  Mon Dec 14 03:09:38 2009
From: matthias at aic.at (Matthias Leopold)
Date: Mon Dec 14 03:09:44 2009
Subject: [Slony1-general] messages from test_slony_state-dbi.pl
Message-ID: <4B261CF2.9070206@aic.at>

hi,

i'm using slony 1.2.15 (from backports) on debian etch. there a 4 slon
daemons (1 master, 3 slaves with ids 2,4,5) running on the host where
the master database resides. replication is working fine (in my opinion).

when i started using test_slony_state-dbi.pl i got the following messages:

Node: 4 Confirmations not propagating from 4 to 2
Node: 4 Confirmations not propagating from 4 to 5

since i couldn't find the reason for this error message (listen paths
were ok imo) and i couldn't see any real erroneous behaviour i dropped
the node using slonik_drop_node and recreated replication for this node
using a different node id. again replication is working fine, messages
about "confirmations not propagating" have stopped, but now i get this
message (node id 4 doesnt exist any more!!):

Node: 4 Events not propagating to node 4

what did i do wrong? how do i get rid of these messages? what i did
notice was that when i drop nodes the corresponding slon daemon doesn't
terminate itself (as it is mentioned in the docs). i usually remove
dropped nodes configuration from slon_tools.conf and do a
"/etc/init.d/slony1" restart.

any help appreciated

thx
matthias


-- 
Mit freundlichen Gr?ssen

Matthias Leopold
System & Network Administration

Streams Telecommunications GmbH
Universitaetsstrasse 10/7, 1090 Vienna, Austria

tel: +43 1 40159113
fax: +43 1 40159300
------------------------------------------------
From contest at jdcontest.com  Mon Dec 14 19:40:32 2009
From: contest at jdcontest.com (Siva)
Date: Mon Dec 14 19:40:39 2009
Subject: [Slony1-general] Dear Slony1-General,
	If you can't find it in google try JUSTDIAL.COM
Message-ID: <7a7cf61244da0e7b73d5358f7332ee2c@192.168.1.23>

Dear Slony1-General,I strongly recommend this website www.justdial.com. It'=
s a world class local search service & I've always found anything I've ever=
 wanted.You can find info on any company, product, or service in over 240 c=
ities in India.You can also call them up 24x7, on phone (69999999), a local=
 call in 240 Indian cities.Ask for anything, you'll get the info on the pho=
ne and/or by SMS within 30 secs, and this service is absolutely FREE!For a =
change, it's an original Indian idea and an Indian company with world class=
 service, and with a vision to spread all over the world.Be a proud Indian =
and forward this to every Indian you know.Best Wishes,SivaClick Here to uns=
ubscribe.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20091215/=
803375cc/attachment.htm
From andy.dale at gmail.com  Thu Dec 17 01:19:44 2009
From: andy.dale at gmail.com (Andy Dale)
Date: Thu Dec 17 01:19:48 2009
Subject: [Slony1-general] failover scenario
Message-ID: <faa313130912170119nd9a18dcp8f8bc0d5ee147a7f@mail.gmail.com>

Hi,

For a project I am working on we are using slony (1.2-16) to replicate data
from a master to 2 slaves.

The controlled failover (move set) works really well, however to do this all
nodes must be reachable.  There is a requirement to perform a failover when
the master site is no longer reachable, to do this I am currently using the
failover command followed by the drop node command.

The problem now is that it is very likely that the old master will be
started up in the same state as before the failover was performed (with all
the old replication settings) and this site should then become the master
again (with any new data that was added during it was offline).  What is the
best approach to this problem, the only solution I can think of is:

1) Stop any slon process on the previous master site.
2) Drop "replication schema" at the previous master.
3) Add the node and paths to the previous master to the current running
slony cluster.
4) Subscribe the previous master to the replication set(s).
5) Move set(s) back to the previous master.

Is this a better approach than the one above.

Thanks,

Andy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20091217/=
87361ed8/attachment.htm
From plk.zuber at gmail.com  Thu Dec 17 03:07:39 2009
From: plk.zuber at gmail.com (=?UTF-8?Q?Filip_Rembia=C5=82kowski?=)
Date: Thu Dec 17 03:07:42 2009
Subject: [Slony1-general] failover scenario
In-Reply-To: <faa313130912170119nd9a18dcp8f8bc0d5ee147a7f@mail.gmail.com>
References: <faa313130912170119nd9a18dcp8f8bc0d5ee147a7f@mail.gmail.com>
Message-ID: <92869e660912170307i1d55a10fw13033c0096bcec21@mail.gmail.com>

MjAwOS8xMi8xNyBBbmR5IERhbGUgPGFuZHkuZGFsZUBnbWFpbC5jb20+Cgo+IEhpLAo+Cj4gRm9y
IGEgcHJvamVjdCBJIGFtIHdvcmtpbmcgb24gd2UgYXJlIHVzaW5nIHNsb255ICgxLjItMTYpIHRv
IHJlcGxpY2F0ZSBkYXRhCj4gZnJvbSBhIG1hc3RlciB0byAyIHNsYXZlcy4KPgo+IFRoZSBjb250
cm9sbGVkIGZhaWxvdmVyIChtb3ZlIHNldCkgd29ya3MgcmVhbGx5IHdlbGwsIGhvd2V2ZXIgdG8g
ZG8gdGhpcwo+IGFsbCBub2RlcyBtdXN0IGJlIHJlYWNoYWJsZS4gIFRoZXJlIGlzIGEgcmVxdWly
ZW1lbnQgdG8gcGVyZm9ybSBhIGZhaWxvdmVyCj4gd2hlbiB0aGUgbWFzdGVyIHNpdGUgaXMgbm8g
bG9uZ2VyIHJlYWNoYWJsZSwgdG8gZG8gdGhpcyBJIGFtIGN1cnJlbnRseSB1c2luZwo+IHRoZSBm
YWlsb3ZlciBjb21tYW5kIGZvbGxvd2VkIGJ5IHRoZSBkcm9wIG5vZGUgY29tbWFuZC4KPgo+IFRo
ZSBwcm9ibGVtIG5vdyBpcyB0aGF0IGl0IGlzIHZlcnkgbGlrZWx5IHRoYXQgdGhlIG9sZCBtYXN0
ZXIgd2lsbCBiZQo+IHN0YXJ0ZWQgdXAgaW4gdGhlIHNhbWUgc3RhdGUgYXMgYmVmb3JlIHRoZSBm
YWlsb3ZlciB3YXMgcGVyZm9ybWVkICh3aXRoIGFsbAo+IHRoZSBvbGQgcmVwbGljYXRpb24gc2V0
dGluZ3MpIGFuZCB0aGlzIHNpdGUgc2hvdWxkIHRoZW4gYmVjb21lIHRoZSBtYXN0ZXIKPiBhZ2Fp
biAod2l0aCBhbnkgbmV3IGRhdGEgdGhhdCB3YXMgYWRkZWQgZHVyaW5nIGl0IHdhcyBvZmZsaW5l
KS4gIFdoYXQgaXMgdGhlCj4gYmVzdCBhcHByb2FjaCB0byB0aGlzIHByb2JsZW0sIHRoZSBvbmx5
IHNvbHV0aW9uIEkgY2FuIHRoaW5rIG9mIGlzOgo+Cj4gMSkgU3RvcCBhbnkgc2xvbiBwcm9jZXNz
IG9uIHRoZSBwcmV2aW91cyBtYXN0ZXIgc2l0ZS4KPiAyKSBEcm9wICJyZXBsaWNhdGlvbiBzY2hl
bWEiIGF0IHRoZSBwcmV2aW91cyBtYXN0ZXIuCj4gMykgQWRkIHRoZSBub2RlIGFuZCBwYXRocyB0
byB0aGUgcHJldmlvdXMgbWFzdGVyIHRvIHRoZSBjdXJyZW50IHJ1bm5pbmcKPiBzbG9ueSBjbHVz
dGVyLgo+IDQpIFN1YnNjcmliZSB0aGUgcHJldmlvdXMgbWFzdGVyIHRvIHRoZSByZXBsaWNhdGlv
biBzZXQocykuCj4gNSkgTW92ZSBzZXQocykgYmFjayB0byB0aGUgcHJldmlvdXMgbWFzdGVyLgo+
Cj4gSXMgdGhpcyBhIGJldHRlciBhcHByb2FjaCB0aGFuIHRoZSBvbmUgYWJvdmUuCj4KPgpTb3Vu
ZHMgdmVyeSBzZW5zaWJsZS4KCkNvbW1lbnRzOgoKLSB5b3Ugd2lsbCBuZWVkIHRvIGJyaW5nIHNs
b24gcHJvY2VzcyB1cCBhZ2FpbiAob3Igc2tpcCBwb2ludCAxLCBtYXliZSkKCi0geW91IGRlZmlu
aXRlbHkgbmVlZCBzb21lICJTVE9OSVRIIiBtZWNoYW5pc20uIC0gZW5hYmxlZCBzaW11bHRhbmVv
dXNseQp3aXRoIHRoZSBmYWlsb3Zlci4KClRoYXQgaXMsIG1ha2UgMTAwJSBzdXJlIHRoYXQgbm8g
YXBwbGljYXRpb24gY29ubmVjdHMgdG8gdGhlICJwcmV2aW91cwptYXN0ZXIiIC0gdGhpbmtpbmcg
aXQncyBzdGlsbCBtYXN0ZXIsIGFuZCBpc3N1aW5nIHNvbWUgZGF0YSBtYW5pcHVsYXRpb24KdGhl
cmUuCgpZb3UgdW5kZXJzdGFuZCBpdCB3b3VsZCBiZSBkZWZpbml0ZWx5IHVuY29vbCAtIHJhbmdp
bmcgZnJvbSAianVzdCBhIG1lc3MiIHRvCiJhcG9jYWx5cHNlIiAtIGRlcGVuZGluZyBob3cgc2Vu
c2l0aXZlIHlvdXIgdHJhbnNhY3Rpb25zIGFyZSBmcm9tIGJ1c2luZXNzCnBvaW50IG9mIHZpZXcu
CgoKCi0tIApGaWxpcCBSZW1iaWHFgmtvd3NraQpKSUQsbWFpbHRvOmZpbGlwLnJlbWJpYWxrb3dz
a2lAZ21haWwuY29tCmh0dHA6Ly9maWxpcC5yZW1iaWFsa293c2tpLm5ldC8KLS0tLS0tLS0tLS0t
LS0gbmV4dCBwYXJ0IC0tLS0tLS0tLS0tLS0tCkFuIEhUTUwgYXR0YWNobWVudCB3YXMgc2NydWJi
ZWQuLi4KVVJMOiBodHRwOi8vbGlzdHMuc2xvbnkuaW5mby9waXBlcm1haWwvc2xvbnkxLWdlbmVy
YWwvYXR0YWNobWVudHMvMjAwOTEyMTcvNDljOTJkZjAvYXR0YWNobWVudC5odG0K
From andy.dale at gmail.com  Thu Dec 17 03:48:46 2009
From: andy.dale at gmail.com (Andy Dale)
Date: Thu Dec 17 03:49:06 2009
Subject: [Slony1-general] failover scenario
In-Reply-To: <92869e660912170307i1d55a10fw13033c0096bcec21@mail.gmail.com>
References: <faa313130912170119nd9a18dcp8f8bc0d5ee147a7f@mail.gmail.com>
	<92869e660912170307i1d55a10fw13033c0096bcec21@mail.gmail.com>
Message-ID: <faa313130912170348u55ef05d3oe3ee8e2e840b6638@mail.gmail.com>

SGkgRmlsaXAsCgpUaGFua3MgZm9yIHRoZSBxdWljayByZXNwb25zZSBvbiB0aGlzLiAgVGhlIGdv
b2QgbmV3cyBpcyB0aGF0IG9ubHkKYXBwbGljYXRpb24gdGhhdCB3cml0ZXMgZGF0YSBiYWNrIHRo
ZSBwcmV2aW91cyBtYXN0ZXIgREIgd2lsbCBub3QgYmUgcnVubmluZwpkdXJpbmcgdGhlIGZhaWxv
dmVyIHByb2Nlc3MgKGhhbmRsZWQgdmlhIHJlc291cmNlIG9yZGVyaW5nICJubyBhcHBsaWNhdGlv
bgp3aXRoIERCIiBpbiBIZWFydGJlYXQpLgoKVGhlIHN0ZXBzIGZvciBhZGRpbmcgdGhlICJwcmV2
aW91cyBtYXN0ZXIiIG11c3QgYmUgcGVyZm9ybWVkIG9uIHRoZSBjdXJyZW50Cm1hc3RlciwgdGhp
cyBpcyBjb3JyZWN0ID8/CgpDaGVlcnMsCgpBbmR5CgoyMDA5LzEyLzE3IEZpbGlwIFJlbWJpYcWC
a293c2tpIDxwbGsuenViZXJAZ21haWwuY29tPgoKPgo+IDIwMDkvMTIvMTcgQW5keSBEYWxlIDxh
bmR5LmRhbGVAZ21haWwuY29tPgo+Cj4gSGksCj4+Cj4+IEZvciBhIHByb2plY3QgSSBhbSB3b3Jr
aW5nIG9uIHdlIGFyZSB1c2luZyBzbG9ueSAoMS4yLTE2KSB0byByZXBsaWNhdGUKPj4gZGF0YSBm
cm9tIGEgbWFzdGVyIHRvIDIgc2xhdmVzLgo+Pgo+PiBUaGUgY29udHJvbGxlZCBmYWlsb3ZlciAo
bW92ZSBzZXQpIHdvcmtzIHJlYWxseSB3ZWxsLCBob3dldmVyIHRvIGRvIHRoaXMKPj4gYWxsIG5v
ZGVzIG11c3QgYmUgcmVhY2hhYmxlLiAgVGhlcmUgaXMgYSByZXF1aXJlbWVudCB0byBwZXJmb3Jt
IGEgZmFpbG92ZXIKPj4gd2hlbiB0aGUgbWFzdGVyIHNpdGUgaXMgbm8gbG9uZ2VyIHJlYWNoYWJs
ZSwgdG8gZG8gdGhpcyBJIGFtIGN1cnJlbnRseSB1c2luZwo+PiB0aGUgZmFpbG92ZXIgY29tbWFu
ZCBmb2xsb3dlZCBieSB0aGUgZHJvcCBub2RlIGNvbW1hbmQuCj4+Cj4+IFRoZSBwcm9ibGVtIG5v
dyBpcyB0aGF0IGl0IGlzIHZlcnkgbGlrZWx5IHRoYXQgdGhlIG9sZCBtYXN0ZXIgd2lsbCBiZQo+
PiBzdGFydGVkIHVwIGluIHRoZSBzYW1lIHN0YXRlIGFzIGJlZm9yZSB0aGUgZmFpbG92ZXIgd2Fz
IHBlcmZvcm1lZCAod2l0aCBhbGwKPj4gdGhlIG9sZCByZXBsaWNhdGlvbiBzZXR0aW5ncykgYW5k
IHRoaXMgc2l0ZSBzaG91bGQgdGhlbiBiZWNvbWUgdGhlIG1hc3Rlcgo+PiBhZ2FpbiAod2l0aCBh
bnkgbmV3IGRhdGEgdGhhdCB3YXMgYWRkZWQgZHVyaW5nIGl0IHdhcyBvZmZsaW5lKS4gIFdoYXQg
aXMgdGhlCj4+IGJlc3QgYXBwcm9hY2ggdG8gdGhpcyBwcm9ibGVtLCB0aGUgb25seSBzb2x1dGlv
biBJIGNhbiB0aGluayBvZiBpczoKPj4KPj4gMSkgU3RvcCBhbnkgc2xvbiBwcm9jZXNzIG9uIHRo
ZSBwcmV2aW91cyBtYXN0ZXIgc2l0ZS4KPj4gMikgRHJvcCAicmVwbGljYXRpb24gc2NoZW1hIiBh
dCB0aGUgcHJldmlvdXMgbWFzdGVyLgo+PiAzKSBBZGQgdGhlIG5vZGUgYW5kIHBhdGhzIHRvIHRo
ZSBwcmV2aW91cyBtYXN0ZXIgdG8gdGhlIGN1cnJlbnQgcnVubmluZwo+PiBzbG9ueSBjbHVzdGVy
Lgo+PiA0KSBTdWJzY3JpYmUgdGhlIHByZXZpb3VzIG1hc3RlciB0byB0aGUgcmVwbGljYXRpb24g
c2V0KHMpLgo+PiA1KSBNb3ZlIHNldChzKSBiYWNrIHRvIHRoZSBwcmV2aW91cyBtYXN0ZXIuCj4+
Cj4+IElzIHRoaXMgYSBiZXR0ZXIgYXBwcm9hY2ggdGhhbiB0aGUgb25lIGFib3ZlLgo+Pgo+Pgo+
IFNvdW5kcyB2ZXJ5IHNlbnNpYmxlLgo+Cj4gQ29tbWVudHM6Cj4KPiAtIHlvdSB3aWxsIG5lZWQg
dG8gYnJpbmcgc2xvbiBwcm9jZXNzIHVwIGFnYWluIChvciBza2lwIHBvaW50IDEsIG1heWJlKQo+
Cj4gLSB5b3UgZGVmaW5pdGVseSBuZWVkIHNvbWUgIlNUT05JVEgiIG1lY2hhbmlzbS4gLSBlbmFi
bGVkIHNpbXVsdGFuZW91c2x5Cj4gd2l0aCB0aGUgZmFpbG92ZXIuCj4KPiBUaGF0IGlzLCBtYWtl
IDEwMCUgc3VyZSB0aGF0IG5vIGFwcGxpY2F0aW9uIGNvbm5lY3RzIHRvIHRoZSAicHJldmlvdXMK
PiBtYXN0ZXIiIC0gdGhpbmtpbmcgaXQncyBzdGlsbCBtYXN0ZXIsIGFuZCBpc3N1aW5nIHNvbWUg
ZGF0YSBtYW5pcHVsYXRpb24KPiB0aGVyZS4KPgo+IFlvdSB1bmRlcnN0YW5kIGl0IHdvdWxkIGJl
IGRlZmluaXRlbHkgdW5jb29sIC0gcmFuZ2luZyBmcm9tICJqdXN0IGEgbWVzcyIKPiB0byAiYXBv
Y2FseXBzZSIgLSBkZXBlbmRpbmcgaG93IHNlbnNpdGl2ZSB5b3VyIHRyYW5zYWN0aW9ucyBhcmUg
ZnJvbQo+IGJ1c2luZXNzIHBvaW50IG9mIHZpZXcuCj4KPgo+Cj4gLS0KPiBGaWxpcCBSZW1iaWHF
gmtvd3NraQo+IEpJRCxtYWlsdG86ZmlsaXAucmVtYmlhbGtvd3NraUBnbWFpbC5jb20KPiBodHRw
Oi8vZmlsaXAucmVtYmlhbGtvd3NraS5uZXQvCj4KLS0tLS0tLS0tLS0tLS0gbmV4dCBwYXJ0IC0t
LS0tLS0tLS0tLS0tCkFuIEhUTUwgYXR0YWNobWVudCB3YXMgc2NydWJiZWQuLi4KVVJMOiBodHRw
Oi8vbGlzdHMuc2xvbnkuaW5mby9waXBlcm1haWwvc2xvbnkxLWdlbmVyYWwvYXR0YWNobWVudHMv
MjAwOTEyMTcvNjM0MDU1YzMvYXR0YWNobWVudC5odG0K
From plk.zuber at gmail.com  Thu Dec 17 05:04:48 2009
From: plk.zuber at gmail.com (=?UTF-8?Q?Filip_Rembia=C5=82kowski?=)
Date: Thu Dec 17 05:04:53 2009
Subject: [Slony1-general] failover scenario
In-Reply-To: <faa313130912170348u55ef05d3oe3ee8e2e840b6638@mail.gmail.com>
References: <faa313130912170119nd9a18dcp8f8bc0d5ee147a7f@mail.gmail.com>
	<92869e660912170307i1d55a10fw13033c0096bcec21@mail.gmail.com>
	<faa313130912170348u55ef05d3oe3ee8e2e840b6638@mail.gmail.com>
Message-ID: <92869e660912170504w1f42b86ei880f2353a0efeac9@mail.gmail.com>

VyBkbml1IDE3IGdydWRuaWEgMjAwOSAxMjo0OCB1xbx5dGtvd25payBBbmR5IERhbGUgPGFuZHku
ZGFsZUBnbWFpbC5jb20+bmFwaXNhxYI6Cgo+IEhpIEZpbGlwLAo+Cj4gVGhhbmtzIGZvciB0aGUg
cXVpY2sgcmVzcG9uc2Ugb24gdGhpcy4gIFRoZSBnb29kIG5ld3MgaXMgdGhhdCBvbmx5Cj4gYXBw
bGljYXRpb24gdGhhdCB3cml0ZXMgZGF0YSBiYWNrIHRoZSBwcmV2aW91cyBtYXN0ZXIgREIgd2ls
bCBub3QgYmUgcnVubmluZwo+IGR1cmluZyB0aGUgZmFpbG92ZXIgcHJvY2VzcyAoaGFuZGxlZCB2
aWEgcmVzb3VyY2Ugb3JkZXJpbmcgIm5vIGFwcGxpY2F0aW9uCj4gd2l0aCBEQiIgaW4gSGVhcnRi
ZWF0KS4KPgoKdGhhdCdzIGx1Y2t5LiBnb29kIHRvIGhlYXIgdGhhdCBzb21lb25lIGhhcyBzdWNo
IGNsZWFuIHNldHVwIDotKQoKbW9zdCBvZiBteSBwcm9kdWN0aW9uIGVudmlyb25tZW50cyBjb25z
aXN0ZWQgb2Ygc2V2ZXJhbCBhcHBsaWNhdGlvbnMKY29ubmVjdGluZyB0byB0aGUgZGF0YWJhc2Ug
ZnJvbSBkaWZmZXJlbnQgaG9zdHMsIHNvbWV0aW1lcyB2aWEKbG9hZC1iYWxhbmNlciwgc29tZXRp
bWVzIGRpcmVjdGx5Li4uCgoKCj4KPiBUaGUgc3RlcHMgZm9yIGFkZGluZyB0aGUgInByZXZpb3Vz
IG1hc3RlciIgbXVzdCBiZSBwZXJmb3JtZWQgb24gdGhlIGN1cnJlbnQKPiBtYXN0ZXIsIHRoaXMg
aXMgY29ycmVjdCA/Pwo+Cj4KQWxsIHNsb25payB0YXNrcyBjYW4gYmUgZG9uZSBmcm9tIHRoZSBz
aGVsbCBvZiBhbnkgbm9kZSBwYXJ0aWNpcGF0aW5nIGluIHRoZQpjbHVzdGVyLgpCdXQgSSdkIHBl
cmZvcm0gdGhlIHByb2NlZHVyZSBvbiAicHJldmlvdXMgbWFzdGVyIiwgdGhlcmUgeW91IHdpbGwg
aGF2ZQpkaXJlY3QgYWNjZXNzIHRvIHNsb24gcHJvY2Vzc2VzIC8gbG9ncy4KCgoKPiBDaGVlcnMs
Cj4KPiBBbmR5Cj4KPiAyMDA5LzEyLzE3IEZpbGlwIFJlbWJpYcWCa293c2tpIDxwbGsuenViZXJA
Z21haWwuY29tPgo+Cj4KPj4gMjAwOS8xMi8xNyBBbmR5IERhbGUgPGFuZHkuZGFsZUBnbWFpbC5j
b20+Cj4+Cj4+IEhpLAo+Pj4KPj4+IEZvciBhIHByb2plY3QgSSBhbSB3b3JraW5nIG9uIHdlIGFy
ZSB1c2luZyBzbG9ueSAoMS4yLTE2KSB0byByZXBsaWNhdGUKPj4+IGRhdGEgZnJvbSBhIG1hc3Rl
ciB0byAyIHNsYXZlcy4KPj4+Cj4+PiBUaGUgY29udHJvbGxlZCBmYWlsb3ZlciAobW92ZSBzZXQp
IHdvcmtzIHJlYWxseSB3ZWxsLCBob3dldmVyIHRvIGRvIHRoaXMKPj4+IGFsbCBub2RlcyBtdXN0
IGJlIHJlYWNoYWJsZS4gIFRoZXJlIGlzIGEgcmVxdWlyZW1lbnQgdG8gcGVyZm9ybSBhIGZhaWxv
dmVyCj4+PiB3aGVuIHRoZSBtYXN0ZXIgc2l0ZSBpcyBubyBsb25nZXIgcmVhY2hhYmxlLCB0byBk
byB0aGlzIEkgYW0gY3VycmVudGx5IHVzaW5nCj4+PiB0aGUgZmFpbG92ZXIgY29tbWFuZCBmb2xs
b3dlZCBieSB0aGUgZHJvcCBub2RlIGNvbW1hbmQuCj4+Pgo+Pj4gVGhlIHByb2JsZW0gbm93IGlz
IHRoYXQgaXQgaXMgdmVyeSBsaWtlbHkgdGhhdCB0aGUgb2xkIG1hc3RlciB3aWxsIGJlCj4+PiBz
dGFydGVkIHVwIGluIHRoZSBzYW1lIHN0YXRlIGFzIGJlZm9yZSB0aGUgZmFpbG92ZXIgd2FzIHBl
cmZvcm1lZCAod2l0aCBhbGwKPj4+IHRoZSBvbGQgcmVwbGljYXRpb24gc2V0dGluZ3MpIGFuZCB0
aGlzIHNpdGUgc2hvdWxkIHRoZW4gYmVjb21lIHRoZSBtYXN0ZXIKPj4+IGFnYWluICh3aXRoIGFu
eSBuZXcgZGF0YSB0aGF0IHdhcyBhZGRlZCBkdXJpbmcgaXQgd2FzIG9mZmxpbmUpLiAgV2hhdCBp
cyB0aGUKPj4+IGJlc3QgYXBwcm9hY2ggdG8gdGhpcyBwcm9ibGVtLCB0aGUgb25seSBzb2x1dGlv
biBJIGNhbiB0aGluayBvZiBpczoKPj4+Cj4+PiAxKSBTdG9wIGFueSBzbG9uIHByb2Nlc3Mgb24g
dGhlIHByZXZpb3VzIG1hc3RlciBzaXRlLgo+Pj4gMikgRHJvcCAicmVwbGljYXRpb24gc2NoZW1h
IiBhdCB0aGUgcHJldmlvdXMgbWFzdGVyLgo+Pj4gMykgQWRkIHRoZSBub2RlIGFuZCBwYXRocyB0
byB0aGUgcHJldmlvdXMgbWFzdGVyIHRvIHRoZSBjdXJyZW50IHJ1bm5pbmcKPj4+IHNsb255IGNs
dXN0ZXIuCj4+PiA0KSBTdWJzY3JpYmUgdGhlIHByZXZpb3VzIG1hc3RlciB0byB0aGUgcmVwbGlj
YXRpb24gc2V0KHMpLgo+Pj4gNSkgTW92ZSBzZXQocykgYmFjayB0byB0aGUgcHJldmlvdXMgbWFz
dGVyLgo+Pj4KPj4+IElzIHRoaXMgYSBiZXR0ZXIgYXBwcm9hY2ggdGhhbiB0aGUgb25lIGFib3Zl
Lgo+Pj4KPj4+Cj4+IFNvdW5kcyB2ZXJ5IHNlbnNpYmxlLgo+Pgo+PiBDb21tZW50czoKPj4KPj4g
LSB5b3Ugd2lsbCBuZWVkIHRvIGJyaW5nIHNsb24gcHJvY2VzcyB1cCBhZ2FpbiAob3Igc2tpcCBw
b2ludCAxLCBtYXliZSkKPj4KPj4gLSB5b3UgZGVmaW5pdGVseSBuZWVkIHNvbWUgIlNUT05JVEgi
IG1lY2hhbmlzbS4gLSBlbmFibGVkIHNpbXVsdGFuZW91c2x5Cj4+IHdpdGggdGhlIGZhaWxvdmVy
Lgo+Pgo+PiBUaGF0IGlzLCBtYWtlIDEwMCUgc3VyZSB0aGF0IG5vIGFwcGxpY2F0aW9uIGNvbm5l
Y3RzIHRvIHRoZSAicHJldmlvdXMKPj4gbWFzdGVyIiAtIHRoaW5raW5nIGl0J3Mgc3RpbGwgbWFz
dGVyLCBhbmQgaXNzdWluZyBzb21lIGRhdGEgbWFuaXB1bGF0aW9uCj4+IHRoZXJlLgo+Pgo+PiBZ
b3UgdW5kZXJzdGFuZCBpdCB3b3VsZCBiZSBkZWZpbml0ZWx5IHVuY29vbCAtIHJhbmdpbmcgZnJv
bSAianVzdCBhIG1lc3MiCj4+IHRvICJhcG9jYWx5cHNlIiAtIGRlcGVuZGluZyBob3cgc2Vuc2l0
aXZlIHlvdXIgdHJhbnNhY3Rpb25zIGFyZSBmcm9tCj4+IGJ1c2luZXNzIHBvaW50IG9mIHZpZXcu
Cj4+Cj4+Cj4+Cj4+IC0tCj4+IEZpbGlwIFJlbWJpYcWCa293c2tpCj4+IEpJRCxtYWlsdG86Zmls
aXAucmVtYmlhbGtvd3NraUBnbWFpbC5jb20KPj4gaHR0cDovL2ZpbGlwLnJlbWJpYWxrb3dza2ku
bmV0Lwo+Pgo+Cj4KCgotLSAKRmlsaXAgUmVtYmlhxYJrb3dza2kKSklELG1haWx0bzpmaWxpcC5y
ZW1iaWFsa293c2tpQGdtYWlsLmNvbQpodHRwOi8vZmlsaXAucmVtYmlhbGtvd3NraS5uZXQvCi0t
LS0tLS0tLS0tLS0tIG5leHQgcGFydCAtLS0tLS0tLS0tLS0tLQpBbiBIVE1MIGF0dGFjaG1lbnQg
d2FzIHNjcnViYmVkLi4uClVSTDogaHR0cDovL2xpc3RzLnNsb255LmluZm8vcGlwZXJtYWlsL3Ns
b255MS1nZW5lcmFsL2F0dGFjaG1lbnRzLzIwMDkxMjE3Lzk0MTIwYTEzL2F0dGFjaG1lbnQtMDAw
MS5odG0K
From andy.dale at gmail.com  Thu Dec 17 06:00:22 2009
From: andy.dale at gmail.com (Andy Dale)
Date: Thu Dec 17 06:00:28 2009
Subject: [Slony1-general] failover scenario
In-Reply-To: <92869e660912170504w1f42b86ei880f2353a0efeac9@mail.gmail.com>
References: <faa313130912170119nd9a18dcp8f8bc0d5ee147a7f@mail.gmail.com>
	<92869e660912170307i1d55a10fw13033c0096bcec21@mail.gmail.com>
	<faa313130912170348u55ef05d3oe3ee8e2e840b6638@mail.gmail.com>
	<92869e660912170504w1f42b86ei880f2353a0efeac9@mail.gmail.com>
Message-ID: <faa313130912170600w5d783111oef3a1600bd9b5d7e@mail.gmail.com>

Hi Filip,

I managed to figure out that I was missing the event node section of the
store node command, this was causing me to think it was not possible to do
so from the old master.

Multiple applications and hosts sounds like it makes failover pretty
difficult.

Cheers,

Andy

2009/12/17 Filip Rembia=B3kowski <plk.zuber@gmail.com>

>
>
> W dniu 17 grudnia 2009 12:48 u=BFytkownik Andy Dale <andy.dale@gmail.com>=
napisa=B3:
>
> Hi Filip,
>>
>> Thanks for the quick response on this.  The good news is that only
>> application that writes data back the previous master DB will not be run=
ning
>> during the failover process (handled via resource ordering "no applicati=
on
>> with DB" in Heartbeat).
>>
>
> that's lucky. good to hear that someone has such clean setup :-)
>
> most of my production environments consisted of several applications
> connecting to the database from different hosts, sometimes via
> load-balancer, sometimes directly...
>
>
>
>>
>> The steps for adding the "previous master" must be performed on the
>> current master, this is correct ??
>>
>>
> All slonik tasks can be done from the shell of any node participating in
> the cluster.
> But I'd perform the procedure on "previous master", there you will have
> direct access to slon processes / logs.
>
>
>
>> Cheers,
>>
>> Andy
>>
>> 2009/12/17 Filip Rembia=B3kowski <plk.zuber@gmail.com>
>>
>>
>>> 2009/12/17 Andy Dale <andy.dale@gmail.com>
>>>
>>> Hi,
>>>>
>>>> For a project I am working on we are using slony (1.2-16) to replicate
>>>> data from a master to 2 slaves.
>>>>
>>>> The controlled failover (move set) works really well, however to do th=
is
>>>> all nodes must be reachable.  There is a requirement to perform a fail=
over
>>>> when the master site is no longer reachable, to do this I am currently=
 using
>>>> the failover command followed by the drop node command.
>>>>
>>>> The problem now is that it is very likely that the old master will be
>>>> started up in the same state as before the failover was performed (wit=
h all
>>>> the old replication settings) and this site should then become the mas=
ter
>>>> again (with any new data that was added during it was offline).  What =
is the
>>>> best approach to this problem, the only solution I can think of is:
>>>>
>>>> 1) Stop any slon process on the previous master site.
>>>> 2) Drop "replication schema" at the previous master.
>>>> 3) Add the node and paths to the previous master to the current running
>>>> slony cluster.
>>>> 4) Subscribe the previous master to the replication set(s).
>>>> 5) Move set(s) back to the previous master.
>>>>
>>>> Is this a better approach than the one above.
>>>>
>>>>
>>> Sounds very sensible.
>>>
>>> Comments:
>>>
>>> - you will need to bring slon process up again (or skip point 1, maybe)
>>>
>>> - you definitely need some "STONITH" mechanism. - enabled simultaneously
>>> with the failover.
>>>
>>> That is, make 100% sure that no application connects to the "previous
>>> master" - thinking it's still master, and issuing some data manipulation
>>> there.
>>>
>>> You understand it would be definitely uncool - ranging from "just a mes=
s"
>>> to "apocalypse" - depending how sensitive your transactions are from
>>> business point of view.
>>>
>>>
>>>
>>> --
>>> Filip Rembia=B3kowski
>>> JID,mailto:filip.rembialkowski@gmail.com
>>> http://filip.rembialkowski.net/
>>>
>>
>>
>
>
> --
> Filip Rembia=B3kowski
> JID,mailto:filip.rembialkowski@gmail.com
> http://filip.rembialkowski.net/
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20091217/=
da98a39c/attachment.htm
From jks at selectacast.net  Thu Dec 17 16:28:10 2009
From: jks at selectacast.net (Joseph S)
Date: Thu Dec 17 16:28:16 2009
Subject: [Slony1-general] Why am I getting "please upgrade Slony-I schema to
 version 1.2.20" ?
Message-ID: <4B2ACC9A.3090906@selectacast.net>

I've already run update functions () on this node, and replication seems 
to be working, so why am I getting these in my log?

2009-12-17 19:12:37 EST ERROR  Slony-I schema version is 
1.2.18                                                                                  
 
2009-12-17 19:12:37 EST ERROR  please upgrade Slony-I schema to version 
1.2.20                                                                    
2009-12-17 19:12:37 EST ERROR  Slony-I module version is 
1.2.18                                                                                  
 
2009-12-17 19:12:37 EST ERROR  please upgrade Slony-I shared module to 
version 1.2.20          

From wmoran at potentialtech.com  Thu Dec 17 17:05:54 2009
From: wmoran at potentialtech.com (Bill Moran)
Date: Thu Dec 17 17:05:40 2009
Subject: [Slony1-general] Why am I getting
	"please upgrade Slony-I schema to version 1.2.20" ?
In-Reply-To: <4B2ACC9A.3090906@selectacast.net>
References: <4B2ACC9A.3090906@selectacast.net>
Message-ID: <20091217200554.3dd6d647.wmoran@potentialtech.com>

Joseph S <jks@selectacast.net> wrote:
>
> I've already run update functions () on this node, and replication seems 
> to be working, so why am I getting these in my log?
> 
> 2009-12-17 19:12:37 EST ERROR  Slony-I schema version is 
> 1.2.18                                                                                  
>  
> 2009-12-17 19:12:37 EST ERROR  please upgrade Slony-I schema to version 
> 1.2.20                                                                    

Somewhere in your cluster you have a node that still has not be
upgraded.  Are you aware that you have to do each one independently?

-- 
Bill Moran
http://www.potentialtech.com
From tamanna.madan at globallogic.com  Fri Dec 18 11:02:01 2009
From: tamanna.madan at globallogic.com (tamanna madaan)
Date: Fri Dec 18 11:22:28 2009
Subject: [Slony1-general] logtrigger/denyaccess triggers removed from
	master/slave
Message-ID: <68666423656E1444A011106C4E085F4D96F091@ex3-del1.synapse.com>


Hi All

I am using postgres-8.1.2 and slony-1.1.5 for replication.
I have 1 master and 1 slave in my cluster.
Sometimes I see problem of missing logtriggers and denyaccess triggers
on master table and slave tables respectively. Replication don't take place=
 in that =

state though systems are properly shown as master and slave.
This problem is resolved by dropping the schema used by slony on both the s=
ystems an =

then recreating the schema. =


I want to know what could be the root cause of logtriggers/denyaccess
triggers getting removed from the tables.

Thanks in advance

Regards
Tamanna
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20091219/=
5053b8ec/attachment.htm
From vivek at khera.org  Fri Dec 18 11:32:25 2009
From: vivek at khera.org (Vick Khera)
Date: Fri Dec 18 11:32:29 2009
Subject: [Slony1-general] logtrigger/denyaccess triggers removed from 
	master/slave
In-Reply-To: <68666423656E1444A011106C4E085F4D96F091@ex3-del1.synapse.com>
References: <68666423656E1444A011106C4E085F4D96F091@ex3-del1.synapse.com>
Message-ID: <2968dfd60912181132m22859683u776c040a2b575299@mail.gmail.com>

On Fri, Dec 18, 2009 at 2:02 PM, tamanna madaan
<tamanna.madan@globallogic.com> wrote:
> I want to know what could be the root cause of logtriggers/denyaccess
> triggers getting removed from the tables.
>

Do you do any schema changes to your database?  If you do not tell
slony about them, it will break in strange ways like this.

General rule: always do your DDL changes via EXECUTE SCRIPT slonik command.
From melvin6925 at yahoo.com  Fri Dec 18 12:00:52 2009
From: melvin6925 at yahoo.com (Melvin Davidson)
Date: Fri Dec 18 12:00:54 2009
Subject: [Slony1-general] logtrigger/denyaccess triggers removed from
	master/slave
In-Reply-To: <68666423656E1444A011106C4E085F4D96F091@ex3-del1.synapse.com>
Message-ID: <213730.71679.qm@web53005.mail.re2.yahoo.com>

--- On Fri, 12/18/09, tamanna madaan <tamanna.madan@globallogic.com> wrote:

>From: tamanna madaan <tamanna.madan@globallogic.com>
>Subject: [Slony1-general] logtrigger/denyaccess triggers removed from master/slave
>To: slony1-general@lists.slony.info
>Cc: "Gaurav Katiyar" <gaurav.katiyar@globallogic.com>
>Date: Friday, December 18, 2009, 1:02 PM


>
>Hi All

>

>I am using postgres-8.1.2 and slony-1.1.5 for replication.

>I have 1 master and 1 slave in my cluster.

>Sometimes I see problem of missing logtriggers and denyaccess triggers

>on master table and slave tables respectively. Replication don't take place in that

>state though systems are properly shown as master and slave.

>This problem is resolved by dropping the schema used by slony on both the systems an

>then recreating the schema.


>I want to know what could be the root cause of logtriggers/denyaccess

>triggers getting removed from the tables.


>Thanks in advance



>Regards
>Tamanna




 



The version of slony you are using --> slony-1.1.5 is most probably the cause.
It is a very old version. I highly recommend you upgrade to the latest version of 1.2.

Melvin Davidson 




      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20091218/746d5c06/attachment.htm
From scott.marlowe at gmail.com  Sat Dec 19 22:48:20 2009
From: scott.marlowe at gmail.com (Scott Marlowe)
Date: Sat Dec 19 22:48:23 2009
Subject: [Slony1-general] slony is scanning every table...
Message-ID: <dcc563d10912192248y702d3b5rd2812a15791166d7@mail.gmail.com>

I'm trying to get some work done tonight, running slony 1.2.13 (will
gladly update if this issue has been addressed) and during an
operation:

select "_slony_www".storeSet(203, 'set to alter tables');

it is scanning every single attribute of every single table in my
database, whether it is under replication or not.  This command above
is generating sql like this:

SELECT a.attnum, a.attname, a.atttypmod, a.attstattarget,
a.attstorage, t.typstorage, a.attnotnull, a.atthasdef, a.attisdropped,
a.attislocal, pg_catalog.format_type(t.oid,a.atttypmod) as atttypname
from pg_catalog.pg_attribute a left join pg_catalog.pg_type t on
a.atttypid = t.oid where a.attrelid = '78818327'::pg_catalog.oid and
a.attnum > 0::pg_catalog.int2 order by a.attrelid, a.attnum

If I go look in pg_class for the relfilenode that matches, it's in a
whole other schema that's not involved in replication at all.  Each
query is only taking a few milliseconds.  But with 40k or more
relations in the db, and it seems like a handful of 1 to 5 millisecond
queries for each one, slony is simply taking hours to do something
simple, and there's NO REASON for it to be looking at these tables in
other schemas that are not related.
From scott.marlowe at gmail.com  Sun Dec 20 00:54:19 2009
From: scott.marlowe at gmail.com (Scott Marlowe)
Date: Sun Dec 20 00:54:23 2009
Subject: [Slony1-general] Re: slony is scanning every table...
In-Reply-To: <dcc563d10912192248y702d3b5rd2812a15791166d7@mail.gmail.com>
References: <dcc563d10912192248y702d3b5rd2812a15791166d7@mail.gmail.com>
Message-ID: <dcc563d10912200054t432a61a9na8727d2e003488c@mail.gmail.com>

Nevermind, I think a backup was getting in the way.  urg.

On Sat, Dec 19, 2009 at 11:48 PM, Scott Marlowe <scott.marlowe@gmail.com> wrote:
> I'm trying to get some work done tonight, running slony 1.2.13 (will
> gladly update if this issue has been addressed) and during an
> operation:
>
> select "_slony_www".storeSet(203, 'set to alter tables');
>
> it is scanning every single attribute of every single table in my
> database, whether it is under replication or not. ?This command above
> is generating sql like this:
>
> SELECT a.attnum, a.attname, a.atttypmod, a.attstattarget,
> a.attstorage, t.typstorage, a.attnotnull, a.atthasdef, a.attisdropped,
> a.attislocal, pg_catalog.format_type(t.oid,a.atttypmod) as atttypname
> from pg_catalog.pg_attribute a left join pg_catalog.pg_type t on
> a.atttypid = t.oid where a.attrelid = '78818327'::pg_catalog.oid and
> a.attnum > 0::pg_catalog.int2 order by a.attrelid, a.attnum
>
> If I go look in pg_class for the relfilenode that matches, it's in a
> whole other schema that's not involved in replication at all. ?Each
> query is only taking a few milliseconds. ?But with 40k or more
> relations in the db, and it seems like a handful of 1 to 5 millisecond
> queries for each one, slony is simply taking hours to do something
> simple, and there's NO REASON for it to be looking at these tables in
> other schemas that are not related.
>



-- 
When fascism comes to America, it will be intolerance sold as diversity.
From storm at iparadigms.com  Mon Dec 21 15:36:48 2009
From: storm at iparadigms.com (Christian Storm)
Date: Mon Dec 21 15:36:53 2009
Subject: [Slony1-general] Slony 2.03 release
Message-ID: <3c2d02c90912211536x427bc114o9d4e92b260cff543@mail.gmail.com>

We are wanting to upgrade to 8.4 during the holidays (our slow season) and
slony is blocking
us from upgrading unless we go with 2.03RC3.

Does anyone know how close 2.03 is to release?  In other words,
are there any outstanding bugs or issues blocking 2.03RC3 from being the
official release?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20091221/=
999d1324/attachment.htm
From msquires at whitepages.com  Mon Dec 21 17:16:21 2009
From: msquires at whitepages.com (Michael Squires)
Date: Mon Dec 21 17:16:23 2009
Subject: [Slony1-general] Slony 2.03 release
In-Reply-To: <3c2d02c90912211536x427bc114o9d4e92b260cff543@mail.gmail.com>
Message-ID: <C7555DE5.71FD%msquires@whitepages.com>

This doesn't answer  your question directly, but Whitepages has had postgre=
s 8.4.1 and slony1 2.0.3RC3 in production for a month now with no problems.=
 Prior to putting it into production we beat it up pretty hard in terms of =
changing the topology (e.g., failover, move master, drop slave, ...).

Michael


On 12/21/09 3:36 PM, "Christian Storm" <storm@iparadigms.com> wrote:

We are wanting to upgrade to 8.4 during the holidays (our slow season) and =
slony is blocking
us from upgrading unless we go with 2.03RC3.

Does anyone know how close 2.03 is to release?  In other words,
are there any outstanding bugs or issues blocking 2.03RC3 from being the
official release?





Michael Lee Squires

WhitePages
Software Developer
msquires@whitepages.com
whitepages.com
P 206 973 5143
C 206 388 7063

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20091221/=
f47cc278/attachment.htm
From cscetbon.ext at orange-ftgroup.com  Tue Dec 22 07:37:20 2009
From: cscetbon.ext at orange-ftgroup.com (Cyril Scetbon)
Date: Tue Dec 22 07:37:24 2009
Subject: [slony1-general] slony I 2.0.3
In-Reply-To: <4B224BF8.7010304@Yahoo.com>
References: <3073cc9b0912102236q3c1c3991k7808ac62516609cd@mail.gmail.com>	<dcc563d10912102332ye6b8017n9908ec2adb949acf@mail.gmail.com>	<db471ace0912110359u5460226aheedfe6187a49a85a@mail.gmail.com>	<1260538339.9403.1072.camel@bnicholson-desktop>
	<4B224BF8.7010304@Yahoo.com>
Message-ID: <4B30E7B0.6040106@orange-ftgroup.com>



Jan Wieck a ?crit :
> On 12/11/2009 8:32 AM, Brad Nicholson wrote:
>> On Fri, 2009-12-11 at 11:59 +0000, Peter Geoghegan wrote:
>>
>>> However, I've used 1.2.15  in the past and never had any problems. It
>>> might be prudent to stick to 1.2.* if everything is fine already,
>>
>>
>> I'd recommend sticking with 1.2.x for now.
>>
>
> I have plans for testing and doing a detailed code review. But it's 
> going to take some time. At this point I'd second that 2.0 is not 
> ready for production.
It's not a really great news to read that you advise us to avoid 2.0 
version in production :( -> ALREADY DONE for 6 month ago ( a few issues 
but not that much)
>
>
> Jan
>

-- 
Cyril SCETBON
From peter.geoghegan86 at gmail.com  Tue Dec 22 08:30:20 2009
From: peter.geoghegan86 at gmail.com (Peter Geoghegan)
Date: Tue Dec 22 08:30:26 2009
Subject: [slony1-general] slony I 2.0.3
In-Reply-To: <4B30E7B0.6040106@orange-ftgroup.com>
References: <3073cc9b0912102236q3c1c3991k7808ac62516609cd@mail.gmail.com>
	<dcc563d10912102332ye6b8017n9908ec2adb949acf@mail.gmail.com>
	<db471ace0912110359u5460226aheedfe6187a49a85a@mail.gmail.com>
	<1260538339.9403.1072.camel@bnicholson-desktop>
	<4B224BF8.7010304@Yahoo.com> <4B30E7B0.6040106@orange-ftgroup.com>
Message-ID: <db471ace0912220830s4624765dgff7f1137247e865@mail.gmail.com>

> It's not a really great news to read that you advise us to avoid 2.0 version
> in production :( -> ALREADY DONE for 6 month ago ( a few issues but not that
> much)

Yeah, me too - sort of begs the question of why all releases from the
2.0.* branch up until now haven't been release candidates or betas.
Had that been the case, I wouldn't have put them into production. That
said, I haven't experienced major issues, just minor ones - no
show-stoppers.

Regards,
Peter Geoghegan
From storm at iparadigms.com  Tue Dec 22 09:52:19 2009
From: storm at iparadigms.com (Christian Storm)
Date: Tue Dec 22 09:52:22 2009
Subject: [Slony1-general] Slony 2.03 release
In-Reply-To: <C7555DE5.71FD%msquires@whitepages.com>
References: <3c2d02c90912211536x427bc114o9d4e92b260cff543@mail.gmail.com>
	<C7555DE5.71FD%msquires@whitepages.com>
Message-ID: <3c2d02c90912220952y216a71e7s31c5115545b077cd@mail.gmail.com>

Thank you, that gives me the confidence I need to proceed.  Happy Holidays
Michael.

On Mon, Dec 21, 2009 at 5:16 PM, Michael Squires <msquires@whitepages.com>w=
rote:

>  This doesn=92t answer  your question directly, but Whitepages has had
> postgres 8.4.1 and slony1 2.0.3RC3 in production for a month now with no
> problems. Prior to putting it into production we beat it up pretty hard in
> terms of changing the topology (e.g., failover, move master, drop slave,
> ...).
>
> Michael
>
>
>
> On 12/21/09 3:36 PM, "Christian Storm" <storm@iparadigms.com> wrote:
>
> We are wanting to upgrade to 8.4 during the holidays (our slow season) and
> slony is blocking
> us from upgrading unless we go with 2.03RC3.
>
> Does anyone know how close 2.03 is to release?  In other words,
> are there any outstanding bugs or issues blocking 2.03RC3 from being the
> official release?
>
>
>
>
>
> Michael Lee Squires
>
> WhitePages
> Software Developer
> msquires@whitepages.com
> whitepages.com
> P 206 973 5143
> C 206 388 7063
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20091222/=
f8ac3655/attachment.htm
From scott.marlowe at gmail.com  Tue Dec 22 10:49:47 2009
From: scott.marlowe at gmail.com (Scott Marlowe)
Date: Tue Dec 22 10:49:51 2009
Subject: [Slony1-general] Slony 2.03 release
In-Reply-To: <3c2d02c90912211536x427bc114o9d4e92b260cff543@mail.gmail.com>
References: <3c2d02c90912211536x427bc114o9d4e92b260cff543@mail.gmail.com>
Message-ID: <dcc563d10912221049s70064627r95659349599ff794@mail.gmail.com>

On Mon, Dec 21, 2009 at 4:36 PM, Christian Storm <storm@iparadigms.com> wrote:
> We are wanting to upgrade to 8.4 during the holidays (our slow season) and
> slony is blocking
> us from upgrading unless we go with 2.03RC3.

This is not true.  Support for 8.4 was added in 1.2.17...
From devrim at gunduz.org  Tue Dec 22 15:06:03 2009
From: devrim at gunduz.org (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Tue Dec 22 15:06:38 2009
Subject: [Slony1-general] Re: Heads up: www.slony.info scheduled maintenance
In-Reply-To: <1260222012.24783.41.camel@hp-laptop2.gunduz.org>
References: <1260222012.24783.41.camel@hp-laptop2.gunduz.org>
Message-ID: <1261523163.2511.31.camel@hp-laptop2.gunduz.org>

SGksCgpUaGlzIGlzIGEgcmVtaW5kZXIgZm9yIHRoZSBlLW1haWwgYmVsb3cuCgpTaW5jZXJlbHks
CkRldnJpbSBHw7xuZMO8egoKT24gTW9uLCAyMDA5LTEyLTA3IGF0IDIzOjQwICswMjAwLCBEZXZy
aW0gR8OcTkTDnFogd3JvdGU6Cj4gSGksCj4gCj4gSnVzdCBhIGhlYWRzIHVwOiBXZSAoQ29tbWFu
ZCBQcm9tcHQpIHdpbGwgYmUgcGVyZm9ybWluZyBhIG1ham9yCj4gbWFpbnRlbmFuY2Ugb3BlcmF0
aW9uIG9uIHRoZSBzbG9ueS5pbmZvIHNlcnZlci4gV2Ugd2lsbCBzdGFydCB1cGdyYWRpbmcKPiB0
aGUgc2VydmVyIG9uIERlYyAyMm5kIChUdWVzZGF5KSBuaWdodCwgYXQgYWJvdXQgN3BtIFBTVC4K
PiAKPiBFeHBlY3RlZCBkb3dudGltZSBpcyBsZXNzIHRoYW4gMTIgaG91cnMsIGJhcnJpbmcgYW55
IHVuZXhwZWN0ZWQgaXNzdWVzLiAKPiAKPiBBbGwgc2VydmljZXMgKGJ1Z3ppbGxhLCBjdnMsIHdl
YnNpdGUpIHdpbGwgYmUgZG93biBkdXJpbmcgdGhpcwo+IG1haW50ZW5hbmNlIHdpbmRvdy4KPiAK
PiBXZSB3aWxsIG5vdGlmeSB0aGUgbGlzdCB3aGVuIG1haW50ZW5hbmNlIGNvbXBsZXRlcy4KPiAK
PiBSZWdhcmRzLGFpCgotLSAKRGV2cmltIEfDnE5Ew5xaLCBSSENFCkNvbW1hbmQgUHJvbXB0IC0g
aHR0cDovL3d3dy5Db21tYW5kUHJvbXB0LmNvbSAKZGV2cmltfmd1bmR1ei5vcmcsIGRldnJpbX5Q
b3N0Z3JlU1FMLm9yZywgZGV2cmltLmd1bmR1en5saW51eC5vcmcudHIKaHR0cDovL3d3dy5ndW5k
dXoub3JnICBUd2l0dGVyOiBodHRwOi8vdHdpdHRlci5jb20vZGV2cmltZ3VuZHV6Ci0tLS0tLS0t
LS0tLS0tIG5leHQgcGFydCAtLS0tLS0tLS0tLS0tLQpBIG5vbi10ZXh0IGF0dGFjaG1lbnQgd2Fz
IHNjcnViYmVkLi4uCk5hbWU6IG5vdCBhdmFpbGFibGUKVHlwZTogYXBwbGljYXRpb24vcGdwLXNp
Z25hdHVyZQpTaXplOiAxOTcgYnl0ZXMKRGVzYzogVGhpcyBpcyBhIGRpZ2l0YWxseSBzaWduZWQg
bWVzc2FnZSBwYXJ0ClVybCA6IGh0dHA6Ly9saXN0cy5zbG9ueS5pbmZvL3BpcGVybWFpbC9zbG9u
eTEtZ2VuZXJhbC9hdHRhY2htZW50cy8yMDA5MTIyMy9lMDUxMGFlNS9hdHRhY2htZW50LnBncAo=
From jks at selectacast.net  Tue Dec 22 17:15:37 2009
From: jks at selectacast.net (Joseph S)
Date: Tue Dec 22 17:15:46 2009
Subject: [Slony1-general] Why am I getting "please upgrade Slony-I schema
	to version 1.2.20" ?
In-Reply-To: <20091217200554.3dd6d647.wmoran@potentialtech.com>
References: <4B2ACC9A.3090906@selectacast.net>
	<20091217200554.3dd6d647.wmoran@potentialtech.com>
Message-ID: <4B316F39.3040500@selectacast.net>

Bill Moran wrote:
> Joseph S <jks@selectacast.net> wrote:
>> I've already run update functions () on this node, and replication seems 
>> to be working, so why am I getting these in my log?
>>
>> 2009-12-17 19:12:37 EST ERROR  Slony-I schema version is 
>> 1.2.18                                                                                  
>>  
>> 2009-12-17 19:12:37 EST ERROR  please upgrade Slony-I schema to version 
>> 1.2.20                                                                    
> 
> Somewhere in your cluster you have a node that still has not be
> upgraded.  Are you aware that you have to do each one independently?

That cluster was offline at the time, so I didn't connect it with this 
error message.
> 

From devrim at gunduz.org  Wed Dec 23 01:18:01 2009
From: devrim at gunduz.org (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Wed, 23 Dec 2009 11:18:01 +0200
Subject: [Slony1-general] Heads up: www.slony.info scheduled maintenance
In-Reply-To: <1260222012.24783.41.camel@hp-laptop2.gunduz.org>
References: <1260222012.24783.41.camel@hp-laptop2.gunduz.org>
Message-ID: <1261559881.2712.15.camel@hp-laptop2.gunduz.org>

On Mon, 2009-12-07 at 23:40 +0200, Devrim G?ND?Z wrote:
> Just a heads up: We (Command Prompt) will be performing a major
> maintenance operation on the slony.info server. We will start
> upgrading the server on Dec 22nd (Tuesday) night, at about 7pm PST.
> 
> Expected downtime is less than 12 hours, barring any unexpected
> issues. 

All services are up. Please let us know if you see any issues.

Regards,
-- 
Devrim G?ND?Z, RHCE
Command Prompt - http://www.CommandPrompt.com 
devrim~gunduz.org, devrim~PostgreSQL.org, devrim.gunduz~linux.org.tr
http://www.gunduz.org  Twitter: http://twitter.com/devrimgunduz
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: This is a digitally signed message part
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20091223/0db0166b/attachment.pgp 

From tam.mclaughlin at gmail.com  Wed Dec 23 05:52:13 2009
From: tam.mclaughlin at gmail.com (Tam McLaughlin)
Date: Wed, 23 Dec 2009 13:52:13 +0000
Subject: [Slony1-general] Problem with execute script
Message-ID: <fa4c18050912230552t1d943b4el463e6c0970c83c84@mail.gmail.com>

slony: 2.0.3 rc3
Postgresql: 8.3.3
Centos: 5.2

When I add a new table using "excute script" I get the following error:

Submit DDL Event to subscribers...
<stdin>:6: PGRES_FATAL_ERROR select "_mesrep".ddlScript_complete(1,
$1::text, -1);  - ERROR:  value "5000012320" is out of range for type
integer
CONTEXT:  PL/pgSQL function "ddlscript_complete" while casting return value
to function's return type


The scipts are:

test.sh
=================
echo "Creating new table"
slonik <<_EOF_
cluster name = mesrep;
node 1 admin conninfo = 'dbname=MES host=localhost user=*****
password=******* port=5432';
node 2 admin conninfo = 'dbname=MES host=uklnxdisp1 user=****
password=****** port=5432';
node 3 admin conninfo = 'dbname=MES host=uklnxdisp2 user=*****
password=******** port=5432';

execute script ( SET ID = 1, FILENAME = 'test.sql', EVENT NODE = 1);
_EOF_


test.sql
=========
SET client_encoding = 'LATIN1';
SET standard_conforming_strings = off;
SET check_function_bodies = false;
SET client_min_messages = warning;
SET escape_string_warning = off;
SET search_path = uk7501, pg_catalog;
SET default_tablespace = '';
SET default_with_oids = false;

CREATE TABLE "uk7501".tam_test1 (
operation integer NOT NULL,
spec_id   character varying(20)
);

ALTER TABLE uk7501.tam_test1 OWNER TO mes;
ALTER TABLE ONLY tam_test1 ADD CONSTRAINT tam_test1_pk PRIMARY KEY
(operation, spec_id);

REVOKE ALL ON TABLE tam_test1 FROM PUBLIC;
REVOKE ALL ON TABLE tam_test1 FROM mes;
GRANT ALL ON TABLE tam_test1 TO mes;


This is a copy of an sql script that previously worked - I just changed the
table name.
The execute script worked fine until I stopped slony, updated the
slony_tools.conf file adding more tables to my set
and reinitialized. Replication looked ok.

I was running slony 1.0.3 but upgraded today to 1.0.3rc3 with the same
error.

Any ideas?

Tam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20091223/9cb7b69f/attachment.htm 

From shimogaki.toru at oss.ntt.co.jp  Thu Dec 24 22:02:34 2009
From: shimogaki.toru at oss.ntt.co.jp (Toru SHIMOGAKI)
Date: Fri, 25 Dec 2009 15:02:34 +0900
Subject: [Slony1-general] rpm of version 2.0.x
Message-ID: <4B34557A.1000005@oss.ntt.co.jp>


Hi Slony-I developers,

I'd like to use Slony-I 2.0.x by rpm installation. Where can I download it? I
couldn't find it in yum repositories.

If it's not available now, can you package it?
I want to use it on RHEL5 Server x86_64. I'd appreciate you if both packages for
PostgreSQL 8.3 and 8.4 are available.

regards,

-- 
Toru SHIMOGAKI<shimogaki.toru at oss.ntt.co.jp>
NTT Open Source Software Center


From devrim at gunduz.org  Mon Dec 28 03:42:59 2009
From: devrim at gunduz.org (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Mon, 28 Dec 2009 13:42:59 +0200
Subject: [Slony1-general] rpm of version 2.0.x
In-Reply-To: <4B34557A.1000005@oss.ntt.co.jp>
References: <4B34557A.1000005@oss.ntt.co.jp>
Message-ID: <1262000579.6103.10.camel@hp-laptop2.gunduz.org>

Hi,

On Fri, 2009-12-25 at 15:02 +0900, Toru SHIMOGAKI wrote:

> I'd like to use Slony-I 2.0.x by rpm installation. Where can I
> download it? I couldn't find it in yum repositories.
> 
> If it's not available now, can you package it? I want to use it on
> RHEL5 Server x86_64. I'd appreciate you if both packages for
> PostgreSQL 8.3 and 8.4 are available. 

I updated Slony-I to 2.0.X for recent PG+Fedora releases. However, I'm
not inclined to push 2.0.X to RHEL5 yet, until PostgreSQL 8.5 will be
released.

Until then, you can build your own packages. It is quite easy:

https://projects.commandprompt.com/public/pgcore/repo/rpm/redhat/8.4/slony1/F-12/

Get these files (except Makefile) and build your 2.0.2 package. 

Regards,
-- 
Devrim G?ND?Z, RHCE
Command Prompt - http://www.CommandPrompt.com 
devrim~gunduz.org, devrim~PostgreSQL.org, devrim.gunduz~linux.org.tr
http://www.gunduz.org  Twitter: http://twitter.com/devrimgunduz
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: This is a digitally signed message part
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20091228/fae2ec1c/attachment.pgp 

From ajs at crankycanuck.ca  Mon Dec 28 07:36:32 2009
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Mon, 28 Dec 2009 10:36:32 -0500
Subject: [Slony1-general] [slony1-general] slony I 2.0.3
In-Reply-To: <db471ace0912220830s4624765dgff7f1137247e865@mail.gmail.com>
References: <3073cc9b0912102236q3c1c3991k7808ac62516609cd@mail.gmail.com>
	<dcc563d10912102332ye6b8017n9908ec2adb949acf@mail.gmail.com>
	<db471ace0912110359u5460226aheedfe6187a49a85a@mail.gmail.com>
	<1260538339.9403.1072.camel@bnicholson-desktop>
	<4B224BF8.7010304@Yahoo.com> <4B30E7B0.6040106@orange-ftgroup.com>
	<db471ace0912220830s4624765dgff7f1137247e865@mail.gmail.com>
Message-ID: <20091228153629.GA92053@shinkuro.com>

On Tue, Dec 22, 2009 at 04:30:20PM +0000, Peter Geoghegan wrote:
> Yeah, me too - sort of begs the question of why all releases from the
> 2.0.* branch up until now haven't been release candidates or betas.

Surely it's more likely to raise (not beg) the question of whether the
wider community, beyond the tiny developer community, is pulling its
weight in performing testing.  This is a free software project, after
all, and that means that the quality control you get is approximately
as good as that which you put in.  It would appear that significant
issues are showing up in the software, and that suggests to me that
maybe people aren't testing very thoroughly, or haven't worked out a
good exercise of all the features, especially under load, in order to
demonstrate that it really works as intended.

Slony is unfortunately very complicated software.  This may be a
design flaw, but it's the way it is now.  It would be better if we
could demonstrate that the code has obviously no bugs, but I suspect
the best we can get to is no obvious bugs.  The problem is that our
current tests for "obvious" are way too shallow.  If people would like
that to be better, I heartily suggest that they get to work on
improving the test cases rather than complaining that the developers
aren't labelling the software correctly.  AFAICT, each release goes
through long periods of being RCd, and the 2.0.0 release was coming
RSN for a long time.  But if nobody exercises the code in
realish-but-safe circumstances, we'll never find the big nasty bugs
until someone trips over them in production.

A


-- 
Andrew Sullivan
ajs at crankycanuck.ca

From ajs at crankycanuck.ca  Mon Dec 28 07:40:58 2009
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Mon, 28 Dec 2009 10:40:58 -0500
Subject: [Slony1-general] Problem with execute script
In-Reply-To: <fa4c18050912230552t1d943b4el463e6c0970c83c84@mail.gmail.com>
References: <fa4c18050912230552t1d943b4el463e6c0970c83c84@mail.gmail.com>
Message-ID: <20091228154057.GB92053@shinkuro.com>

On Wed, Dec 23, 2009 at 01:52:13PM +0000, Tam McLaughlin wrote:
> slony: 2.0.3 rc3
> Postgresql: 8.3.3
> Centos: 5.2
> 
> When I add a new table using "excute script" I get the following error:
> 
> Submit DDL Event to subscribers...
> <stdin>:6: PGRES_FATAL_ERROR select "_mesrep".ddlScript_complete(1,
> $1::text, -1);  - ERROR:  value "5000012320" is out of range for type
> integer

My guess is that you're trying to number a table with too high a
value.  Integers only hold 4 billion, and your proposed id there looks
like 5 billion unless I'm counting places wrong.

A



-- 
Andrew Sullivan
ajs at crankycanuck.ca

From tam.mclaughlin at gmail.com  Mon Dec 28 07:51:51 2009
From: tam.mclaughlin at gmail.com (Tam McLaughlin)
Date: Mon, 28 Dec 2009 15:51:51 +0000
Subject: [Slony1-general] Problem with execute script
In-Reply-To: <20091228154057.GB92053@shinkuro.com>
References: <fa4c18050912230552t1d943b4el463e6c0970c83c84@mail.gmail.com>
	<20091228154057.GB92053@shinkuro.com>
Message-ID: <fa4c18050912280751o78ce3857r83ef1d2d22b1f3bf@mail.gmail.com>

Thanks for the reply.

I agree that this number is very large, but it is not my number!
I don't know where it comes from?
It seems to be something slony has generated.

On Mon, Dec 28, 2009 at 3:40 PM, Andrew Sullivan <ajs at crankycanuck.ca>wrote:

> On Wed, Dec 23, 2009 at 01:52:13PM +0000, Tam McLaughlin wrote:
> > slony: 2.0.3 rc3
> > Postgresql: 8.3.3
> > Centos: 5.2
> >
> > When I add a new table using "excute script" I get the following error:
> >
> > Submit DDL Event to subscribers...
> > <stdin>:6: PGRES_FATAL_ERROR select "_mesrep".ddlScript_complete(1,
> > $1::text, -1);  - ERROR:  value "5000012320" is out of range for type
> > integer
>
> My guess is that you're trying to number a table with too high a
> value.  Integers only hold 4 billion, and your proposed id there looks
> like 5 billion unless I'm counting places wrong.
>
> A
>
>
>
> --
> Andrew Sullivan
> ajs at crankycanuck.ca
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20091228/eda31f10/attachment.htm 

From ajs at crankycanuck.ca  Mon Dec 28 08:26:39 2009
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Mon, 28 Dec 2009 11:26:39 -0500
Subject: [Slony1-general] Problem with execute script
In-Reply-To: <fa4c18050912280751o78ce3857r83ef1d2d22b1f3bf@mail.gmail.com>
References: <fa4c18050912230552t1d943b4el463e6c0970c83c84@mail.gmail.com>
	<20091228154057.GB92053@shinkuro.com>
	<fa4c18050912280751o78ce3857r83ef1d2d22b1f3bf@mail.gmail.com>
Message-ID: <20091228162639.GB92420@shinkuro.com>

On Mon, Dec 28, 2009 at 03:51:51PM +0000, Tam McLaughlin wrote:
> Thanks for the reply.
> 
> I agree that this number is very large, but it is not my number!
> I don't know where it comes from?
> It seems to be something slony has generated.

Is it being generated automatically by a tool?

A


-- 
Andrew Sullivan
ajs at crankycanuck.ca

From bnichols at ca.afilias.info  Tue Dec 29 05:27:51 2009
From: bnichols at ca.afilias.info (Brad Nicholson)
Date: Tue, 29 Dec 2009 08:27:51 -0500
Subject: [Slony1-general] Problem with execute script
In-Reply-To: <fa4c18050912280751o78ce3857r83ef1d2d22b1f3bf@mail.gmail.com>
References: <fa4c18050912230552t1d943b4el463e6c0970c83c84@mail.gmail.com>
	<20091228154057.GB92053@shinkuro.com>
	<fa4c18050912280751o78ce3857r83ef1d2d22b1f3bf@mail.gmail.com>
Message-ID: <1262093271.9403.1131.camel@bnicholson-desktop>

On Mon, 2009-12-28 at 15:51 +0000, Tam McLaughlin wrote:
> Thanks for the reply.
> 
> I agree that this number is very large, but it is not my number!
> I don't know where it comes from?
> It seems to be something slony has generated.


There was an issue fixed a few months ago in the 1.2 branch with a data
type mismatch between the slon (bigint) and the DB (int).  This looks to
be a similar issue.

> On Mon, Dec 28, 2009 at 3:40 PM, Andrew Sullivan <ajs at crankycanuck.ca>
> wrote:
>         On Wed, Dec 23, 2009 at 01:52:13PM +0000, Tam McLaughlin
>         wrote:
>         > slony: 2.0.3 rc3
>         > Postgresql: 8.3.3
>         > Centos: 5.2
>         >
>         > When I add a new table using "excute script" I get the
>         following error:
>         >
>         > Submit DDL Event to subscribers...
>         > <stdin>:6: PGRES_FATAL_ERROR select
>         "_mesrep".ddlScript_complete(1,
>         > $1::text, -1);  - ERROR:  value "5000012320" is out of range
>         for type
>         > integer
>         
>         
>         My guess is that you're trying to number a table with too high
>         a
>         value.  Integers only hold 4 billion, and your proposed id
>         there looks
>         like 5 billion unless I'm counting places wrong.
>         
>         A
>         
>         
>         
>         --
>         Andrew Sullivan
>         ajs at crankycanuck.ca
>         _______________________________________________
>         Slony1-general mailing list
>         Slony1-general at lists.slony.info
>         http://lists.slony.info/mailman/listinfo/slony1-general
> 
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
-- 
Brad Nicholson  416-673-4106
Database Administrator, Afilias Canada Corp.



From cbbrowne at ca.afilias.info  Thu Dec 31 09:15:49 2009
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Thu, 31 Dec 2009 12:15:49 -0500
Subject: [Slony1-general] Problem with execute script
In-Reply-To: <fa4c18050912230552t1d943b4el463e6c0970c83c84@mail.gmail.com>
References: <fa4c18050912230552t1d943b4el463e6c0970c83c84@mail.gmail.com>
Message-ID: <4B3CDC45.9050002@ca.afilias.info>

Tam McLaughlin wrote:
>
> slony: 2.0.3 rc3
> Postgresql: 8.3.3
> Centos: 5.2
>
> When I add a new table using "excute script" I get the following error:
>
> Submit DDL Event to subscribers...
> <stdin>:6: PGRES_FATAL_ERROR select "_mesrep".ddlScript_complete(1, 
> $1::text, -1);  - ERROR:  value "5000012320" is out of range for type 
> integer
> CONTEXT:  PL/pgSQL function "ddlscript_complete" while casting return 
> value to function's return type
This is almost certainly related to the following fix:

http://main.slony.info/viewcvs/viewvc.cgi/slony1-engine/src/backend/slony1_funcs.sql?r1=1.145.2.16&r2=1.145.2.17


The trouble here is that the event number has gone past 2^31, with 
consequence that ddlScript_complete() can't return the event number 
because it is out of range.

As shown, the change is very simple, just a matter of changing the 
return type for this function from integer to bigint.

That was in 2.0.3 rc2, so you should surely have the right code available.

Perhaps you initialized using some earlier version, and need to run 
UPDATE FUNCTIONS to get it to reload the functions?

From ajs at crankycanuck.ca  Thu Dec 31 14:47:38 2009
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Thu, 31 Dec 2009 17:47:38 -0500
Subject: [Slony1-general] Problem with execute script
In-Reply-To: <4B3CDC45.9050002@ca.afilias.info>
References: <fa4c18050912230552t1d943b4el463e6c0970c83c84@mail.gmail.com>
	<4B3CDC45.9050002@ca.afilias.info>
Message-ID: <20091231224737.GA13607@shinkuro.com>

On Thu, Dec 31, 2009 at 12:15:49PM -0500, Christopher Browne wrote:
> The trouble here is that the event number has gone past 2^31, with 
> consequence that ddlScript_complete() can't return the event number 
> because it is out of range.

Ow.  Thanks for the explanation.  I haven't been paying enough attention; that's nasty!


A


-- 
Andrew Sullivan
ajs at crankycanuck.ca

From tam.mclaughlin at gmail.com  Thu Dec 31 14:49:26 2009
From: tam.mclaughlin at gmail.com (Tam McLaughlin)
Date: Thu, 31 Dec 2009 22:49:26 +0000
Subject: [Slony1-general] Problem with execute script
In-Reply-To: <20091231224737.GA13607@shinkuro.com>
References: <fa4c18050912230552t1d943b4el463e6c0970c83c84@mail.gmail.com>
	<4B3CDC45.9050002@ca.afilias.info>
	<20091231224737.GA13607@shinkuro.com>
Message-ID: <fa4c18050912311449l7b15a6e5i64a1032e9bca7e89@mail.gmail.com>

Fantastic.  Hogmanay and I get a solution to my problem.    Thanks

On 31 Dec 2009 22:47, "Andrew Sullivan" <ajs at crankycanuck.ca> wrote:

On Thu, Dec 31, 2009 at 12:15:49PM -0500, Christopher Browne wrote: > The
trouble here is that the e...
Ow.  Thanks for the explanation.  I haven't been paying enough attention;
that's nasty!

A -- Andrew Sullivan
ajs at crankycanuck.ca_______________________________________________
Slony1...
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20091231/f485afee/attachment.htm 

From peter.geoghegan86 at gmail.com  Thu Dec 31 17:33:15 2009
From: peter.geoghegan86 at gmail.com (Peter Geoghegan)
Date: Fri, 1 Jan 2010 01:33:15 +0000
Subject: [Slony1-general] [slony1-general] slony I 2.0.3
In-Reply-To: <20091228153629.GA92053@shinkuro.com>
References: <3073cc9b0912102236q3c1c3991k7808ac62516609cd@mail.gmail.com>
	<dcc563d10912102332ye6b8017n9908ec2adb949acf@mail.gmail.com>
	<db471ace0912110359u5460226aheedfe6187a49a85a@mail.gmail.com>
	<1260538339.9403.1072.camel@bnicholson-desktop>
	<4B224BF8.7010304@Yahoo.com> <4B30E7B0.6040106@orange-ftgroup.com>
	<db471ace0912220830s4624765dgff7f1137247e865@mail.gmail.com>
	<20091228153629.GA92053@shinkuro.com>
Message-ID: <db471ace0912311733k17da46fbldb8df179bdaf5424@mail.gmail.com>

> Surely it's more likely to raise (not beg) the question of whether the
> wider community, beyond the tiny developer community, is pulling its
> weight in performing testing. ?This is a free software project, after
> all, and that means that the quality control you get is approximately
> as good as that which you put in. ?It would appear that significant
> issues are showing up in the software, and that suggests to me that
> maybe people aren't testing very thoroughly, or haven't worked out a
> good exercise of all the features, especially under load, in order to
> demonstrate that it really works as intended.

I made the mistake of misusing the term "begs the question". In my
defense, this particular misuse of the term is in common use.

I wish I could contribute more, and I certainly don't want to appear
ungrateful to the Slony developers, but owing to the complexity of
Slony, I don't know where to begin. Frankly, I can only afford to
spend a small amount of time on testing Slony or making *any* sort of
contribution to free software projects. To me, Slony is mostly a black
box. Coming up with a comprehensive test suite would, I'd speculate,
require being as knowledgeable about Slony as the developers
themselves. Unfortunately, attaining that level of understanding isn't
an option for most users, myself included.

Regards,
Peter Geoghegan

