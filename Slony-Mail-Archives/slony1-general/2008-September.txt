From postgre_ashish at yahoo.in  Mon Sep  1 06:17:42 2008
From: postgre_ashish at yahoo.in (Ashish Postgres)
Date: Mon Sep  1 06:17:48 2008
Subject: [Slony1-general] Stuck in Installing Slony-1.2.14
Message-ID: <355885.53240.qm@web95007.mail.in2.yahoo.com>

SGVsbG8gR3V5cywKSSBhbSB0cnlpbmcgdG8gaW5zdGFsbCBTbG9ueSBvbiBQb3N0Z3JlU1FMIDgu
My4zIFBsZWFzZSBoZWxwLgpEZXRhaWxzOgpQb3N0Z3JlU1FMOjguMy4zClNsb255MTotMToyMTQK
V2hlbiBpIGRvIGNvbmZpZ3VyZSBpdCBnb2VzIHNtb290aCBvbmx5IHdpdGggYSB3YXJuaW5nOgoK
Li9jb25maWd1cmUgIC0td2l0aC1wZ2NvbmZpZ2Rpcj0vb3B0L1Bvc3RncmVTUUwvOC4zL2Jpbgou
Ci4KKExhc3QgbGluZXMgb2YgY29uZmlndXJlKQpjb25maWd1cmU6IGNyZWF0aW5nIC4vY29uZmln
LnN0YXR1cwpjb25maWcuc3RhdHVzOiBjcmVhdGluZyBNYWtlZmlsZS5nbG9iYWwKY29uZmlnLnN0
YXR1czogV0FSTklORzogIE1ha2VmaWxlLmdsb2JhbC5pbiBzZWVtcyB0byBpZ25vcmUgdGhlIC0t
ZGF0YXJvb3RkaXIgc2V0dGluZwpjb25maWcuc3RhdHVzOiBjcmVhdGluZyBHTlVtYWtlZmlsZQpj
b25maWcuc3RhdHVzOiBjcmVhdGluZyBwb3N0Z3Jlc3FsLXNsb255MS5zcGVjCmNvbmZpZy5zdGF0
dXM6IGNyZWF0aW5nIE1ha2VmaWxlLnBvcnQKY29uZmlnLnN0YXR1czogY3JlYXRpbmcgY29uZmln
LmgKCldoZW4gaSBleGVjdXRlIE1ha2UgaSBnZXQgZm9sbG93aW5nIEVycm9yczoKCm1ha2VbMl06
IEVudGVyaW5nIGRpcmVjdG9yeSBgL3Vzci9zcmMvc2xvbnkxLTEuMi4xNC9zcmMvc2xvbnlfbG9n
c2hpcHBlcicKZ2NjIC1nIC1PMiAtV2FsbCAtV21pc3NpbmctcHJvdG90eXBlcyAtV21pc3Npbmct
ZGVjbGFyYXRpb25zIC1JLi4vLi4gLURQR1NIQVJFPSJcIi9vcHQvUG9zdGdyZVNRTC84LjMvc2hh
cmUvcG9zdGdyZXNxbC9cIiIgIC1JL29wdC9Qb3N0Z3JlU1FMLzguMy9pbmNsdWRlLyAtSS9vcHQv
UG9zdGdyZVNRTC84LjMvaW5jbHVkZS9wb3N0Z3Jlc3FsL3NlcnZlci8gIC1jIC1vIHNsb255X2xv
Z3NoaXBwZXIubyBzbG9ueV9sb2dzaGlwcGVyLmMKZ2NjIC1nIC1PMiAtV2FsbCAtV21pc3Npbmct
cHJvdG90eXBlcyAtV21pc3NpbmctZGVjbGFyYXRpb25zIC1JLi4vLi4gLURQR1NIQVJFPSJcIi9v
cHQvUG9zdGdyZVNRTC84LjMvc2hhcmUvcG9zdGdyZXNxbC9cIiIgIC1JL29wdC9Qb3N0Z3JlU1FM
LzguMy9pbmNsdWRlLyAtSS9vcHQvUG9zdGdyZVNRTC84LjMvaW5jbHVkZS9wb3N0Z3Jlc3FsL3Nl
cnZlci8gIC1jIC1vIGRidXRpbC5vIGRidXRpbC5jCmdjYyAtZyAtTzIgLVdhbGwgLVdtaXNzaW5n
LXByb3RvdHlwZXMgLVdtaXNzaW5nLWRlY2xhcmF0aW9ucyAtSS4uLy4uIC1EUEdTSEFSRT0iXCIv
b3B0L1Bvc3RncmVTUUwvOC4zL3NoYXJlL3Bvc3RncmVzcWwvXCIiICAtSS9vcHQvUG9zdGdyZVNR
TC84LjMvaW5jbHVkZS8gLUkvb3B0L1Bvc3RncmVTUUwvOC4zL2luY2x1ZGUvcG9zdGdyZXNxbC9z
ZXJ2ZXIvICAtYyAtbyBpcGN1dGlsLm8gaXBjdXRpbC5jCmJpc29uIC15IC1kICBwYXJzZXIueQpt
diAtZiB5LnRhYi5jIHBhcnNlci5jCk1pc3NpbmcgZmxleCBzY2FuLmwgc2Nhbi5jCmdjYyAtZyAt
TzIgLVdhbGwgLVdtaXNzaW5nLXByb3RvdHlwZXMgLVdtaXNzaW5nLWRlY2xhcmF0aW9ucyAtSS4u
Ly4uIC1EUEdTSEFSRT0iXCIvb3B0L1Bvc3RncmVTUUwvOC4zL3NoYXJlL3Bvc3RncmVzcWwvXCIi
ICAtSS9vcHQvUG9zdGdyZVNRTC84LjMvaW5jbHVkZS8gLUkvb3B0L1Bvc3RncmVTUUwvOC4zL2lu
Y2x1ZGUvcG9zdGdyZXNxbC9zZXJ2ZXIvICAtYyAtbyBwYXJzZXIubyBwYXJzZXIuYwpwYXJzZXIu
eToxMDkwOjE4OiBzY2FuLmM6IE5vIHN1Y2ggZmlsZSBvciBkaXJlY3RvcnkKbWFrZVsyXTogKioq
IFtwYXJzZXIub10gRXJyb3IgMQptYWtlWzJdOiBMZWF2aW5nIGRpcmVjdG9yeSBgL3Vzci9zcmMv
c2xvbnkxLTEuMi4xNC9zcmMvc2xvbnlfbG9nc2hpcHBlcicKbWFrZVsxXTogKioqIFthbGxdIEVy
cm9yIDIKbWFrZVsxXTogTGVhdmluZyBkaXJlY3RvcnkgYC91c3Ivc3JjL3Nsb255MS0xLjIuMTQv
c3JjJwptYWtlOiAqKiogW2FsbF0gRXJyb3IgMgoKQW55IGlkZWEgd2h5IHRoaXMgaXMgaGFwcGVu
aW5nPwoKVGhhbmtzIGluIEFkdmFuY2UuCgpXaXRoIFJlZ2FyZHMKQXNoaXNoCgoKICAgICAgRGlk
IHlvdSBrbm93PyBZb3UgY2FuIENIQVQgd2l0aG91dCBkb3dubG9hZGluZyBtZXNzZW5nZXIuIEdv
IHRvIGh0dHA6Ly9pbi53ZWJtZXNzZW5nZXIueWFob28uY29tLwotLS0tLS0tLS0tLS0tLSBuZXh0
IHBhcnQgLS0tLS0tLS0tLS0tLS0KQW4gSFRNTCBhdHRhY2htZW50IHdhcyBzY3J1YmJlZC4uLgpV
Ukw6IGh0dHA6Ly9saXN0cy5zbG9ueS5pbmZvL3BpcGVybWFpbC9zbG9ueTEtZ2VuZXJhbC9hdHRh
Y2htZW50cy8yMDA4MDkwMS85YzkwNzMyNS9hdHRhY2htZW50Lmh0bQo=
From remuscat at gmail.com  Tue Sep  2 02:59:42 2008
From: remuscat at gmail.com (=?ISO-8859-1?Q?Ren=E9-Etienne_Muscat?=)
Date: Tue Sep  2 03:00:13 2008
Subject: [Slony1-general] Dropped Master Cluster
In-Reply-To: <48B41AC6.3080107@Yahoo.com>
References: <46d2bc8f0808191024y3c759ef3m7a57dac7eb765c1a@mail.gmail.com>
	<48ABDB11.9040608@albourne.com>
	<46d2bc8f0808200243n40bc9b5aldc4a8d07a749e6a4@mail.gmail.com>
	<48ABE80F.5070805@albourne.com> <48B41AC6.3080107@Yahoo.com>
Message-ID: <46d2bc8f0809020259m3541e75ape39e469b91da5be3@mail.gmail.com>

Today I tried the *UNINSTALL NODE* on the server, but it was unsuccessful!
It returned:
PGRES_FATAL_ERROR select "_test_cluster".uninstallNode();  - ERROR:
Slony-I: alterTableRestore(): Table with id 300 not found

Should I go to the *drop schema <cluster name> cascade;* or is there another
slonik command I can use?

Regards,
Rene

On Tue, Aug 26, 2008 at 5:01 PM, Jan Wieck <JanWieck@yahoo.com> wrote:

> On 8/20/2008 5:46 AM, Martin Eriksson wrote:
>
>> Yes it will,
>>
>> the cascade will remove ALL slony triggers.
>>
>> I do it all the time..
>>
>
> Note that before Slony 2.0 this is a perfect recipe for disaster as this
> method does not restore the system catalog to a sane state in case Slony =
had
> disabled user triggers, foreign key constraints or rewrite rules.
>
> The recommended way to remove Slony from a subscriber is to use the slonik
> command UNINSTALL NODE.
>
>
> Jan
>
> --
> Anyone who trades liberty for security deserves neither
> liberty nor security. -- Benjamin Franklin
>
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080902/=
086dc6db/attachment.htm
From JanWieck at Yahoo.com  Tue Sep  2 08:25:16 2008
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Tue Sep  2 08:36:04 2008
Subject: [Slony1-general] Dropped Master Cluster
In-Reply-To: <46d2bc8f0809020259m3541e75ape39e469b91da5be3@mail.gmail.com>
References: <46d2bc8f0808191024y3c759ef3m7a57dac7eb765c1a@mail.gmail.com>	
	<48ABDB11.9040608@albourne.com>	
	<46d2bc8f0808200243n40bc9b5aldc4a8d07a749e6a4@mail.gmail.com>	
	<48ABE80F.5070805@albourne.com> <48B41AC6.3080107@Yahoo.com>
	<46d2bc8f0809020259m3541e75ape39e469b91da5be3@mail.gmail.com>
Message-ID: <48BD5ADC.4020006@Yahoo.com>

On 9/2/2008 5:59 AM, Ren?-Etienne Muscat wrote:
> Today I tried the *UNINSTALL NODE* on the server, but it was unsuccessful!
> It returned:
> PGRES_FATAL_ERROR select "_test_cluster".uninstallNode();  - ERROR:  
> Slony-I: alterTableRestore(): Table with id 300 not found
> 
> Should I go to the *drop schema <cluster name> cascade;* or is there 
> another slonik command I can use?

You apparently dropped that table without going through EXECUTE SCRIPT. 
Therefore, the information Slony has about what it did to the schema is 
not in sync with your current schema any more.

What you should do is remove the entry FOR THAT ONE TABLE from sl_table 
and then try the UNINSTALL NODE again.


Jan

-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin

From selena at endpoint.com  Tue Sep  2 09:54:49 2008
From: selena at endpoint.com (Selena Deckelmann)
Date: Tue Sep  2 09:55:05 2008
Subject: [Slony1-general] patch for firstdb.html
Message-ID: <3F0665FA-871C-46C4-805A-29DEC3FF354C@endpoint.com>

Skipped content of type multipart/alternative-------------- next part --------------
A non-text attachment was scrubbed...
Name: PGP.sig
Type: application/pgp-signature
Size: 194 bytes
Desc: This is a digitally signed message part
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20080902/d7ab27cf/PGP.pgp
From dbakarcic at mecon.gov.ar  Tue Sep  2 08:04:34 2008
From: dbakarcic at mecon.gov.ar (=?ISO-8859-1?Q?Dami=E1n_Bakarcic?=)
Date: Tue Sep  2 17:56:24 2008
Subject: [Slony1-general] How to configure a special case of cascaded
	subscriptions
Message-ID: <48BD5602.3070503@mecon.gov.ar>

Hi,
 I?m relatively new to slony and I needed help to configure it in order 
to satisfy the following conditions:
I have four nodes, 1-4, and two replication sets, A-B. B is a subset of 
A. Node 1 is the master and node 2 subscribes to 1 to replicate set A. 
Nodes 3 and 4 both subscribe to node 2 but i don?t need them to 
replicate all of the tables in set A, only the ones in the subset B.
Am I supposed to create set B with node 1 as origin and only subscribe 
nodes 3 and 4 to set B in node 2?. To do this, is it necessary to also 
subscribe node 2 to 1 to replicate set B when set A already includes the 
tables in set B?.
Thanks in advance.
Damian.

From dbakarcic at mecon.gov.ar  Tue Sep  2 12:14:14 2008
From: dbakarcic at mecon.gov.ar (=?ISO-8859-1?Q?Dami=E1n_Bakarcic?=)
Date: Tue Sep  2 17:57:32 2008
Subject: [Slony1-general] How to configure a special case of cascaded
	subscriptions
Message-ID: <48BD9086.7090807@mecon.gov.ar>


-------------- next part --------------
An embedded message was scrubbed...
From: =3D?ISO-8859-1?Q?Dami=3DE1n_Bakarcic?=3D <dbakarcic@mecon.gov.ar>
Subject: How to configure a special case of cascaded subscriptions
Date: Tue, 02 Sep 2008 12:04:34 -0300
Size: 1109
Url: http://lists.slony.info/pipermail/slony1-general/attachments/20080902/=
b5b041e0/Howtoconfigureaspecialcaseofcascadedsubscriptions.eml
From Ow.Mun.Heng at wdc.com  Tue Sep  2 22:34:46 2008
From: Ow.Mun.Heng at wdc.com (Ow Mun Heng)
Date: Tue Sep  2 22:35:23 2008
Subject: [Slony1-general] logswitch_start does not occurs
In-Reply-To: <48A19978.9040702@echo.fr>
References: <48A196BF.8040103@echo.fr>  <48A19978.9040702@echo.fr>
Message-ID: <1220420086.25502.23.camel@neuromancer.home.net>

On Tue, 2008-08-12 at 16:08 +0200, Cyril SCETBON wrote:
> 
> Cyril SCETBON wrote:
>  As we have a lot of 
> statement, I should use logswitch_start manually if I want it to happen 
> more often. But what means "every so often" in the documentation ? (see 
> above)
> 

I'm forcing the switch every 12 hours on mine to get the log file sizes
down. once it hits ~1-2Gm then I get the dreaded fetch 100 from log.

From postgre_ashish at yahoo.in  Wed Sep  3 05:59:09 2008
From: postgre_ashish at yahoo.in (Ashish Postgres)
Date: Wed Sep  3 05:59:18 2008
Subject: [Slony1-general] Stuck in Installing Slony-1.2.14
Message-ID: <677864.52368.qm@web95002.mail.in2.yahoo.com>

CgoKCi0tLS0tIE9yaWdpbmFsIE1lc3NhZ2UgLS0tLQpGcm9tOiByaWVzIHZhbiBUd2lzayA8c2xv
bnlAcnZ0LmRkcy5ubD4KVG86IEFzaGlzaCBQb3N0Z3JlcyA8cG9zdGdyZV9hc2hpc2hAeWFob28u
aW4+ClNlbnQ6IE1vbmRheSwgMSBTZXB0ZW1iZXIsIDIwMDggODowODo1NSBQTQpTdWJqZWN0OiBS
ZTogW1Nsb255MS1nZW5lcmFsXSBTdHVjayBpbiBJbnN0YWxsaW5nIFNsb255LTEuMi4xNAoKCgpP
biBTZXAgMSwgMjAwOCwgYXQgODoxNyBBTSwgQXNoaXNoIFBvc3RncmVzIHdyb3RlOgoKSGVsbG8g
R3V5cywKSSBhbSB0cnlpbmcgdG8gaW5zdGFsbCBTbG9ueSBvbiBQb3N0Z3JlU1FMIDguMy4zIFBs
ZWFzZSBoZWxwLgpEZXRhaWxzOgpQb3N0Z3JlU1FMOjguMy4zClNsb255MTotMToyMTQKV2hlbiBp
IGRvIGNvbmZpZ3VyZSBpdCBnb2VzIHNtb290aCBvbmx5IHdpdGggYSB3YXJuaW5nOgoKcGFyc2Vy
Lnk6MTA5MDoxODogc2Nhbi5jOiBObyBzdWNoIGZpbGUgb3IgZGlyZWN0b3J5Cm1ha2VbMl06ICoq
KiBbcGFyc2VyLm9dIEVycm9yIDEKbWFrZVsyXTogTGVhdmluZyBkaXJlY3RvcnkgYC91c3Ivc3Jj
L3Nsb255MS0xLjIuMTQvc3JjL3Nsb255X2xvZ3NoaXBwZXInCm1ha2VbMV06ICoqKiBbYWxsXSBF
cnJvciAyCm1ha2VbMV06IExlYXZpbmcgZGlyZWN0b3J5IGAvdXNyL3NyYy9zbG9ueTEtMS4yLjE0
L3NyYycKbWFrZTogKioqIFthbGxdIEVycm9yIDIKCkFueSBpZGVhIHdoeSB0aGlzIGlzIGhhcHBl
bmluZz8KClRoYW5rcyBpbiBBZHZhbmNlLi4KCldpdGggUmVnYXJkcwpBc2hpc2gKCgoKCkRvIHlv
dSBoYXZlIHNjYW4uYyBzb21ld2hlcmUgaW4gdGhlIHNvdXJjZSBkaXJlY3Rvcnkgb2Ygc2xvbnk/
CgpSaWVzCgpZZXMsSXRzIHRoZXJlIAoKL3Vzci9zcmMvc2xvbnkxLTEuMi4xNC9zcmMvc2xvbmlr
L3NjYW4uYwoKV2l0aCBSZWdhcmRzCkFzaGlzaCAKCgogICAgICBDb25uZWN0IHdpdGggZnJpZW5k
cyBhbGwgb3ZlciB0aGUgd29ybGQuIEdldCBZYWhvbyEgSW5kaWEgTWVzc2VuZ2VyIGF0IGh0dHA6
Ly9pbi5tZXNzZW5nZXIueWFob28uY29tLz93bT1uLwotLS0tLS0tLS0tLS0tLSBuZXh0IHBhcnQg
LS0tLS0tLS0tLS0tLS0KQW4gSFRNTCBhdHRhY2htZW50IHdhcyBzY3J1YmJlZC4uLgpVUkw6IGh0
dHA6Ly9saXN0cy5zbG9ueS5pbmZvL3BpcGVybWFpbC9zbG9ueTEtZ2VuZXJhbC9hdHRhY2htZW50
cy8yMDA4MDkwMy83NjM5NjVkNS9hdHRhY2htZW50Lmh0bQo=
From dbakarcic at mecon.gov.ar  Wed Sep  3 07:20:04 2008
From: dbakarcic at mecon.gov.ar (=?ISO-8859-1?Q?Dami=E1n_Bakarcic?=)
Date: Wed Sep  3 07:18:16 2008
Subject: [Slony1-general] How to configure a special case of cascaded
	subscriptions
In-Reply-To: <2968dfd60809030654l44f8c15agcd831a3969d10ec1@mail.gmail.com>
References: <48BD5602.3070503@mecon.gov.ar>
	<2968dfd60809030654l44f8c15agcd831a3969d10ec1@mail.gmail.com>
Message-ID: <48BE9D14.1080300@mecon.gov.ar>

Vivek Khera escribi?:
>
>
> On Tue, Sep 2, 2008 at 11:04 AM, Dami?n Bakarcic 
> <dbakarcic@mecon.gov.ar <mailto:dbakarcic@mecon.gov.ar>> wrote:
>
>     Hi,
>     I?m relatively new to slony and I needed help to configure it in
>     order to satisfy the following conditions:
>     I have four nodes, 1-4, and two replication sets, A-B. B is a
>     subset of A. Node 1 is the master and node 2 subscribes to 1 to
>     replicate set A. Nodes 3 and 4 both subscribe to node 2 but i
>     don?t need them to replicate all of the tables in set A, only the
>     ones in the subset B.
>     Am I supposed to create set B with node 1 as origin and only
>     subscribe nodes 3 and 4 to set B in node 2?. To do this, is it
>     necessary to also subscribe node 2 to 1 to replicate set B when
>     set A already includes the tables in set B?.
>     Thanks in advance.
>
>
> The tables can only be in one set.  Since B is a subset of A, your 
> node 2 should subscribe to both sets A and B, and your nodes 3 & 4 
> should subscribe to just set B.
>  
>
Thanks for the help, but, you tell me that the tables can only be in one 
set, so I understand that A and B cannot have the same origin node. Is 
this correct?. If they actually can have the same origin node, would it 
cause trouble to replicate both sets, whose intersection is not empty, 
between nodes 1 & 2?.
Is there another way to do this?, for instance, can I "only" replicate 
set A between nodes 1 & 2 and somehow replicate only part of that set 
(subset B exactly) between sets 2 & 3 and 2 & 4.
Thanks again.
Damian.

From cbbrowne at ca.afilias.info  Wed Sep  3 07:42:22 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed Sep  3 07:42:28 2008
Subject: [Slony1-general] Dropped node still in sl_status
In-Reply-To: <1220239268.6362.5.camel@Nokia-N810-23-14> (Vivek Khera's message
	of "Sun, 31 Aug 2008 23:21:08 -0400")
References: <1220239268.6362.5.camel@Nokia-N810-23-14>
Message-ID: <87hc8x70kx.fsf@dba2.int.libertyrms.com>

Vivek Khera <vivek@khera.org> writes:
> I had a replication going from node 4 to 2 to 1. I did a drop node for node 1. It is disappeared from everywhere except sl_status. The log for
> slon on node 1 showed it was dropped and the slon exited. How can I clear the status line? I already restarted the other slons, but that didn't
> clear it.
>
> How to proceed?

It's going to continue to exist as long as node #1 is still present in
sl_confirm and sl_event.

Now, the drop_node event purges out the relevant sl_confirm/sl_event
data, but just on each node locally.  If there are events/confirms on
other nodes, I expect they'd still get pulled over.

I have seen this condition happen before; the next time the cleanup
thread trimmed out old events & confirmations, that resolved the
matter.

In v2.0, you could do this expressly by running cleanupEvent by hand,
as it has been moved over into the stored functions, rather than being
embedded tightly into the C code.

If you take a look in sl_event/sl_confirm, you'll probably find some
old events and confirmations lingering around.  It's pretty safe to
trim out confirmations for nodes that are gone.
-- 
select 'cbbrowne' || '@' || 'linuxfinances.info';
http://linuxfinances.info/info/internet.html
"Show me... show me... show me... COMPUTERS!"
From cbbrowne at ca.afilias.info  Wed Sep  3 08:00:27 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed Sep  3 08:00:35 2008
Subject: [Slony1-general] logswitch_start does not occurs
In-Reply-To: <1220420086.25502.23.camel@neuromancer.home.net> (Ow Mun Heng's
	message of "Wed, 03 Sep 2008 13:34:46 +0800")
References: <48A196BF.8040103@echo.fr> <48A19978.9040702@echo.fr>
	<1220420086.25502.23.camel@neuromancer.home.net>
Message-ID: <87d4jl6zqs.fsf@dba2.int.libertyrms.com>

Ow Mun Heng <Ow.Mun.Heng@wdc.com> writes:
> On Tue, 2008-08-12 at 16:08 +0200, Cyril SCETBON wrote:
>> 
>> Cyril SCETBON wrote:
>>  As we have a lot of 
>> statement, I should use logswitch_start manually if I want it to happen 
>> more often. But what means "every so often" in the documentation ? (see 
>> above)
>> 
>
> I'm forcing the switch every 12 hours on mine to get the log file sizes
> down. once it hits ~1-2Gm then I get the dreaded fetch 100 from log.

In v1.2, the slon initiates running this on a weekly basis; take a
look in the table "sl_registry"; there should be a tuple with "reg_key
= 'logswitch_weekly.dow'"; that controls which day of the week it
runs, and there may also be a tuple with reg_key =
'logswitch_weekly.time'.

But basically, the initial design was to do so weekly.

If you want it to take place more often, then run logswitch_start()
more often, and twice a day doesn't seem outrageous.

In v2.0, this is revisited; we *never* DELETE data from the log
tables, exclusively using TRUNCATE, and use the slon parameter
"cleanup_interval" to indicate how much old data gets kept around.  If
that interval is 2 hours, then you can expect to see a TRUNCATE about
every 2 hours.
-- 
(format nil "~S@~S" "cbbrowne" "acm.org")
http://www3.sympatico.ca/cbbrowne/linux.html
"The only completely consistent people are the dead."
-- Aldous Huxley
From dlambert at bmtcarhaul.com  Wed Sep  3 08:19:22 2008
From: dlambert at bmtcarhaul.com (David Lee Lambert)
Date: Wed Sep  3 08:19:36 2008
Subject: [Slony1-general] Best way to switch to a fresh new master?
Message-ID: <200809031119.23070.dlambert@bmtcarhaul.com>

Let's say I have three servers,  X, Y and P.  X and Y are "test" instances, P 
is "production" (or closer to it).  X and Y have Slony installed, P has not 
been used for Slony before.  Can I install Slony on P and use the same set 
definition to start replicating to Y from P?  Or do I need to create a new 
set, even though the table-names would be the same?

What's a good sequence of commands to do this?


-- 

David L. Lambert
  Software Developer,  Precision Motor Transport Group, LLC
  Work phone 517-349-3011 x215
  Cell phone 586-873-8813
From vivek at khera.org  Wed Sep  3 08:29:10 2008
From: vivek at khera.org (Vivek Khera)
Date: Wed Sep  3 08:29:18 2008
Subject: [Slony1-general] Best way to switch to a fresh new master?
In-Reply-To: <200809031119.23070.dlambert@bmtcarhaul.com>
References: <200809031119.23070.dlambert@bmtcarhaul.com>
Message-ID: <2968dfd60809030829n4eea6fdi1f10df886d3ffdf4@mail.gmail.com>

On Wed, Sep 3, 2008 at 11:19 AM, David Lee Lambert
<dlambert@bmtcarhaul.com>wrote:

> Let's say I have three servers,  X, Y and P.  X and Y are "test" instance=
s,
> P
> is "production" (or closer to it).  X and Y have Slony installed, P has n=
ot
> been used for Slony before.  Can I install Slony on P and use the same set
> definition to start replicating to Y from P?  Or do I need to create a new
> set, even though the table-names would be the same?
>
> What's a good sequence of commands to do this?
>

Yes, you can do this.  Something along these lines:

First, create the DB and load an empty schema identical to the origin's
schema.

Next, add the node:

  store node (id =3D 3, event node =3D 4, comment =3D 'Node 3');
  store path (server =3D 4, client =3D 3, conninfo =3D 'host=3Dd04 dbname=
=3Dxyz
user=3Dslony port=3D5432');
  store path (server =3D 3, client =3D 4, conninfo =3D 'host=3Dd03 dbname=
=3Dxyz
user=3Dslony port=3D5432');

And then subscribe the set:

 subscribe set (id =3D 1, provider =3D 4, receiver =3D 3, forward =3D no);

sit back, relax, and watch the logs to see when it is done copying the set.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080903/=
aa4d5c99/attachment-0001.htm
From dlambert at bmtcarhaul.com  Wed Sep  3 09:11:44 2008
From: dlambert at bmtcarhaul.com (David Lee Lambert)
Date: Wed Sep  3 09:11:52 2008
Subject: [Slony1-general] Best way to switch to a fresh new master?
In-Reply-To: <2968dfd60809030829n4eea6fdi1f10df886d3ffdf4@mail.gmail.com>
References: <200809031119.23070.dlambert@bmtcarhaul.com>
	<2968dfd60809030829n4eea6fdi1f10df886d3ffdf4@mail.gmail.com>
Message-ID: <200809031211.44873.dlambert@bmtcarhaul.com>

On Wednesday 03 September 2008 11:29:10 am Vivek Khera wrote:
> On Wed, Sep 3, 2008 at 11:19 AM, David Lee Lambert
>
> <dlambert@bmtcarhaul.com>wrote:
> > Let's say I have three servers,  X, Y and P.  X and Y are "test"
> > instances, P
> > is "production" (or closer to it).  X and Y have Slony installed, P has
> > not been used for Slony before.  Can I install Slony on P and use the
> > same set definition to start replicating to Y from P?  Or do I need to
> > create a new set, even though the table-names would be the same?
> >
> > What's a good sequence of commands to do this?
>
> Yes, you can do this.  Something along these lines:
>
> First, create the DB and load an empty schema identical to the origin's
> schema.

Thanks,  but I'm not sure we're talking about the same problem.

X, Y and P have exactly the same schema already.

X has stale test data.  Y has an up-to-date exact replica of the stale test 
data.

P has production data.  I want Y to have an up-to-date exact replica of the 
production data.

In the language of slon_tools.conf,  my current configuration is

add_node(node => 5, host => 'x.example.com', dbname=> 'data' );
add_node(node => 6, host => 'y.example.com', dbname=> 'data' );
$MASTERNODE = 5;
$SLONY_SETS = { 'set1' => { "origin" => 5 ... } }

and I want

add_node(node => 1, host => 'p.example.com', dbname=>'data' );
add_node(node => 6, host => 'y.example.com', dbname=>'data' );
$MASTERNODE = 1;
$SLONY_SETS = { 'set1' => { "origin" => 1 ... } };

I know I can do

dropdb -h y.example.com data

and reinstall the schema and Slony; but is there a faster way?


-- 

David L. Lambert
  Software Developer,  Precision Motor Transport Group, LLC
  Work phone 517-349-3011 x215
  Cell phone 586-873-8813
From dbakarcic at mecon.gov.ar  Wed Sep  3 09:39:28 2008
From: dbakarcic at mecon.gov.ar (=?ISO-8859-1?Q?Dami=E1n_Bakarcic?=)
Date: Wed Sep  3 09:37:42 2008
Subject: [Slony1-general] Tables related via foreign key grouped in
	different sets
Message-ID: <48BEBDC0.8080200@mecon.gov.ar>

Hi,
 Does anybody know what kind of problems can I have should I group a set 
of tables related via foreign key constraints in different replication 
sets?.
Thanks in advance.
Damian.
From dlambert at bmtcarhaul.com  Wed Sep  3 10:36:37 2008
From: dlambert at bmtcarhaul.com (David Lee Lambert)
Date: Wed Sep  3 10:36:47 2008
Subject: [Slony1-general] Best way to switch to a fresh new master?
In-Reply-To: <200809031211.44873.dlambert@bmtcarhaul.com>
References: <200809031119.23070.dlambert@bmtcarhaul.com>
	<2968dfd60809030829n4eea6fdi1f10df886d3ffdf4@mail.gmail.com>
	<200809031211.44873.dlambert@bmtcarhaul.com>
Message-ID: <200809031336.37569.dlambert@bmtcarhaul.com>

On Wednesday 03 September 2008 12:11:44 pm David Lee Lambert wrote:
>
> X, Y and P have exactly the same schema already.
>
> X has stale test data.  Y has an up-to-date exact replica of the stale test
> data.
>
> P has production data.  I want Y to have an up-to-date exact replica of the
> production data.

I was thinking through this problem some more,  and it seems like the best 
solution is to have two different sets, one for each potential master;  that 
way I can switch the slave back and forth between "production" and "test" 
data with just a "slonik_unsubscribe_set" followed by 
a "slonik_subscribe_set".  However,  when I try creating the second set ofer 
the same set of tables but with a different origin,  I get an error:

<stdin>:19: PGRES_FATAL_ERROR select "_replication".setAddTable(7, 
101, 'public.addresses', 'addresses_pkey', 'Table public.addresses with 
primary key'); - ERROR:  duplicate key violates unique 
constraint "sl_table_tab_reloid_key"

Is that constraint really necessary for Slony-I to function correctly?  
Shouldn't it be possible for a table to be in more than one set,  as long as 
a client is never subscribed to two overlapping sets?



-- 

David L. Lambert
  Software Developer,  Precision Motor Transport Group, LLC
  Work phone 517-349-3011 x215
  Cell phone 586-873-8813
From jerome at jfg-networks.net  Fri Sep  5 05:52:31 2008
From: jerome at jfg-networks.net (=?ISO-8859-1?Q?J=E9r=F4me_Jouanin?=)
Date: Fri Sep  5 05:52:35 2008
Subject: [Slony1-general] "Unable to disable triggers" error in move set
Message-ID: <210e1e060809050552r99bbbf0qae494ef4e192c39b@mail.gmail.com>

Hi,
The environment is Linux Debian Etch, PG8.3.3 and SlonyI 1.2.13.
The problem I have actually is in execution of slonik_move_set :
*<stdin>:12: Locking down set 1 on node 24
<stdin>:14: Locked down - moving it
<stdin>:15: NOTICE:  Slony-I: alterTableForReplication(): multiple instances
of trigger $TRIGGER on table $TABLE
CONTEXT:  SQL statement "SELECT  "$SLONY_SCHEMA".alterTableForReplication(
$1 )"
PL/pgSQL function "moveset_int" line 181 at PERFORM
...
<stdin>:15: PGRES_FATAL_ERROR select "$SLONY_SCHEMA".moveSet(1, 22);  -
ERROR:  Slony-I: Unable to disable triggers
CONTEXT:  SQL statement "SELECT  "$SLONY_SCHEMA".alterTableForReplication(
$1 )"
PL/pgSQL function "moveset_int" line 181 at PERFORM
SQL statement "SELECT  "$SLONY_SCHEMA".moveSet_int( $1 ,  $2 ,  $3 , 0)"
PL/pgSQL function "moveset" line 61 at PERFORM*

In Slony documentation I've read this :

   -

   *NOTICE: Slony-I: alterTableForReplication(): multiple instances of
   trigger % on table %'',*

   * This normally happens if you have a table that had a trigger attached
   to it that replication hid due to this being a subscriber node, and then=
 you
   added a trigger by the same name back to replication. Now, when trying to
   "fix up" triggers, those two triggers conflict. *

   * The DDL script will keep running and rerunning, or the UNINSTALL NODE
   will keep failing, until you drop the "visible" trigger, by hand, much as
   you must have added it, by hand, earlier. *
   -

   *ERROR: Slony-I: Unable to disable triggers*

   * This is the error that follows the "multiple triggers" problem. *

An history mistake was a possibility, but executing the select of
altertableforreplication trigger ...

*select pc.relname, tg1.tgname from
"pg_catalog".pg_trigger tg1,

"pg_catalog".pg_trigger tg2,
"pg_catalog".pg_class pc,
"pg_catalog".pg_index pi,
_ob2replication.sl_table tab
where
tg1.tgname =3D tg2.tgname and        -- Trigger names match

tg1.tgrelid =3D tab.tab_reloid and   -- trigger 1 is on the table
pi.indexrelid =3D tg2.tgrelid and    -- trigger 2 is on the index
pi.indrelid =3D tab.tab_reloid and   -- indexes table is this table
pc.oid =3D tab.tab_reloid*

... returns no result on spare server to move set to.

Has anybody an idea about my problem ?

Thx
J=E9r=F4me Jouanin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080905/=
bd503c9c/attachment.htm
From jerome at jfg-networks.net  Fri Sep  5 06:05:26 2008
From: jerome at jfg-networks.net (=?ISO-8859-1?Q?J=E9r=F4me_Jouanin?=)
Date: Fri Sep  5 06:05:30 2008
Subject: [Slony1-general] How to manually add column on big tables ?
Message-ID: <210e1e060809050605y7f91c789ncba702ab846e01da@mail.gmail.com>

Hi,
I have also a classical (but beautiful) school case to submit to the
community.
We have a slony1 (1.2.13) replication between a master and 9 slaves (PG8.3).
For performance reasons, we have to add columns in our biggest
tables(approximatively 10 millions of rows).
On the finest hardware of these nodes, it takes a few hours.
Because of production constraints, the challenge is to minimize the time of
this operation, not to use slony's execute_script command, which first alter
the master and then replicates the schema change to the others nodes.
So we planned to alter the table manually on each nodes in parallel by :

   1. down write access
   2. down slony
   3. then in a same transaction on each nodes in parallel :
   1. save the sequence of a column (select nextval)
      2. altertablerestore(tab_id) to deactivate slony triggers, restore
      tables in initial state and permit the ddl change onto the replicated
      databases
      3. create the new table table_new by select into (+ alter table alter
      column set not null)
      4. drop original table
      5. alter table table_new rename to table
      6. alter table table inherit
      7. create column's sequence
      8. alter table add constraint & index
      9. create table's trigger
      10. reinject sequence (select setval)
      11. update manually sl_table and sl_sequence with the new oid of the
      recreated objects
      12. altertableforreplication(tab_id) to replicate the table
   4. VACUUM ANALYZE table

In a dev environnement, datas after schema change are replicated with no
error, so it appears to run successfully.
But I ask for your knowledge : if anyone experienced altertablerestore /
altertableforreplication manually in similar conditions, does this plan
appears to be correct ?

Many thanx for your interest

J=E9r=F4me Jouanin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080905/=
6f82ca7d/attachment.htm
From ajs at crankycanuck.ca  Fri Sep  5 07:18:04 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Fri Sep  5 07:18:11 2008
Subject: [Slony1-general] How to manually add column on big tables ?
In-Reply-To: <210e1e060809050605y7f91c789ncba702ab846e01da@mail.gmail.com>
References: <210e1e060809050605y7f91c789ncba702ab846e01da@mail.gmail.com>
Message-ID: <20080905141803.GB54783@crankycanuck.ca>

On Fri, Sep 05, 2008 at 03:05:26PM +0200, J?r?me Jouanin wrote:

> But I ask for your knowledge : if anyone experienced altertablerestore /
> altertableforreplication manually in similar conditions, does this plan
> appears to be correct ?

Since this is a school project, I'll give you a hint rather than the
answer: have a look at the code Slony actually uses to perform these
operations.  You might find that it calls some functions.

A

-- 
Andrew Sullivan
ajs@commandprompt.com
+1 503 667 4564 x104
http://www.commandprompt.com/
From andrew.george.hammond at gmail.com  Fri Sep  5 14:47:28 2008
From: andrew.george.hammond at gmail.com (Andrew Hammond)
Date: Fri Sep  5 14:47:43 2008
Subject: [Slony1-general] Best way to switch to a fresh new master?
In-Reply-To: <200809031211.44873.dlambert@bmtcarhaul.com>
References: <200809031119.23070.dlambert@bmtcarhaul.com>
	<2968dfd60809030829n4eea6fdi1f10df886d3ffdf4@mail.gmail.com>
	<200809031211.44873.dlambert@bmtcarhaul.com>
Message-ID: <5a0a9d6f0809051447k35ed2b34g574f1b8e6cee4c76@mail.gmail.com>

On Wed, Sep 3, 2008 at 9:11 AM, David Lee Lambert
<dlambert@bmtcarhaul.com>wrote:

> On Wednesday 03 September 2008 11:29:10 am Vivek Khera wrote:
> > On Wed, Sep 3, 2008 at 11:19 AM, David Lee Lambert
> >
> > <dlambert@bmtcarhaul.com>wrote:
> > > Let's say I have three servers,  X, Y and P.  X and Y are "test"
> > > instances, P
> > > is "production" (or closer to it).  X and Y have Slony installed, P h=
as
> > > not been used for Slony before.  Can I install Slony on P and use the
> > > same set definition to start replicating to Y from P?  Or do I need to
> > > create a new set, even though the table-names would be the same?
> > >
> > > What's a good sequence of commands to do this?
> >
> > Yes, you can do this.  Something along these lines:
> >
> > First, create the DB and load an empty schema identical to the origin's
> > schema.
>
> Thanks,  but I'm not sure we're talking about the same problem.
>
> X, Y and P have exactly the same schema already.
>
> X has stale test data.  Y has an up-to-date exact replica of the stale te=
st
> data.
>
> P has production data.  I want Y to have an up-to-date exact replica of t=
he
> production data.
>
> In the language of slon_tools.conf,  my current configuration is
>
> add_node(node =3D> 5, host =3D> 'x.example.com', dbname=3D> 'data' );
> add_node(node =3D> 6, host =3D> 'y.example.com', dbname=3D> 'data' );
> $MASTERNODE =3D 5;
> $SLONY_SETS =3D { 'set1' =3D> { "origin" =3D> 5 ... } }
>
> and I want
>
> add_node(node =3D> 1, host =3D> 'p.example.com', dbname=3D>'data' );
> add_node(node =3D> 6, host =3D> 'y.example.com', dbname=3D>'data' );
> $MASTERNODE =3D 1;
> $SLONY_SETS =3D { 'set1' =3D> { "origin" =3D> 1 ... } };
>
> I know I can do
>
> dropdb -h y.example.com data
>
> and reinstall the schema and Slony; but is there a faster way?


Not really. The brief version is that you have some snapshots that you want
to promote to being subscribers. Slony can't do that (yet). I don't know how
you'd do that in any way that was significantly more efficient than simply
loading the data afresh, but if you have some ideas and want to write some
code... :)

Andrew
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080905/=
38aef032/attachment.htm
From Ow.Mun.Heng at wdc.com  Sun Sep  7 21:04:42 2008
From: Ow.Mun.Heng at wdc.com (Ow Mun Heng)
Date: Sun Sep  7 21:05:13 2008
Subject: [Slony1-general] Partition Tables - How does slony replicate it
In-Reply-To: <874p559lfc.fsf@dba2.int.libertyrms.com>
References: <1219890108.6034.14.camel@neuromancer.home.net>
	<874p559lfc.fsf@dba2.int.libertyrms.com>
Message-ID: <1220846682.30796.8.camel@neuromancer.home.net>

On Thu, 2008-08-28 at 12:03 -0400, Christopher Browne wrote:
> Ow Mun Heng <Ow.Mun.Heng@wdc.com> writes:
> 
> > Considering doing partitioning/table inheritance on a master/slave Db
> > replicated by slony.
> >
> > I'm not sure how it handles the table inheritance. 
> > Do I need to manually add the tables to be inherited? what about
> > removing it from inheritance?
> > Is there an automated way? 
> >
> > Can anyone shed some light into how slony deals with this?
> 
> There is a test in the test suite that uses inheritance-based partitioning:
>   http://main.slony.info/viewcvs/viewvc.cgi/slony1-engine/tests/testpartition/?pathrev=REL_1_2_STABLE
> 
> It sets up 3 monthly partitions, and adds them to replication.
> 
> There are stored procedures in version 1.2 for this:
> 
>   add_empty_table_to_replication()
>     which adds an empty table to a replication set (this is a general "tool")
>   replicate_partition()
>     which uses the above function to replicate an inherited partition, validating
>     that it is a child of a replicated parent table
> 
> You can run replicate_partition() (passing in the appropriate
> parameters) in a Slonik script; this will add a fresh, empty partition
> to replication, in the same replication set as its parent.

Thanks for the information. I guess I need to do some testing to see
exactly how it works.
But, noting the above, is it as easy as running slonik and passing

replicate_partition('child_200901')


I"m planning to replicate a whole host of partitions (~20) and will add
one each week.

From Ow.Mun.Heng at wdc.com  Mon Sep  8 03:43:57 2008
From: Ow.Mun.Heng at wdc.com (Ow Mun Heng)
Date: Mon Sep  8 03:44:36 2008
Subject: [Slony1-general] Group Sets For Replication w/ Partition
Message-ID: <1220870637.30796.38.camel@neuromancer.home.net>

Hi,

I'm still researching my options regarding using slony to replicate
partitions.

I've gotten pointers in that slony doesn't really do the partitioning
per-se, but does support their replication via individual tables. (this
is OK for me)

then Christopher Brown pointed me to a link (no web-access at the
moment) and the usage of 

?add_empty_table_to_replication()
which I looked at the SQL and seems like based on my understanding, it
will

1) check if the set exists 
(i'm a bit confused here, Does this mean that it will check if the
parent table is already currently in a replication set? How does it know
which one is the origin set? How do I call it? It has 5 field variables)
2) locks the origin table
3) check to see if the new (child) table to be replicated is empty using
a "select 1 from x limit 1"

is the add_empty_table_to_replication means that I need to manually
trigger it using slonik? (weekly child table)

replicate_partition()
This one seems more understand-able (to me)
1) it looks in pg_class for the parent table of the set
2) it gets the parent table's replications
3) calls add_empty_table_to_replication()

all in all, I still don't have much idea how to call them.

my current table schema

parent
->child_2008week1
?->child_?2008week2
?->child_?2008week3
...
...
?->child_?2008week50
...

so, I create a new replication set called "parent" and then what do I
do?

Currently, on the master, I already have these tables all set-up and
defined and I've also created these table schemas on the slave server.
Right now, I'm unsure of how to proceed.

I'll take a look at the link 

?http://main.slony.info/viewcvs/viewvc.cgi/slony1-engine/tests/testpartition/?pathrev=REL_1_2_STABLE


which was provided by Christopher. In the meantime, I'm sure there are
lots of people using Slony for replication of partitions, I would love
to hear experiences/caveats and any methods for making it automated.

Thanks all
From cbbrowne at ca.afilias.info  Mon Sep  8 07:55:13 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Mon Sep  8 07:55:20 2008
Subject: [Slony1-general] Group Sets For Replication w/ Partition
In-Reply-To: <1220870637.30796.38.camel@neuromancer.home.net> (Ow Mun Heng's
	message of "Mon, 08 Sep 2008 18:43:57 +0800")
References: <1220870637.30796.38.camel@neuromancer.home.net>
Message-ID: <87bpyy4rhq.fsf@dba2.int.libertyrms.com>

Ow Mun Heng <Ow.Mun.Heng@wdc.com> writes:
> Hi,
>
> I'm still researching my options regarding using slony to replicate
> partitions.
>
> I've gotten pointers in that slony doesn't really do the partitioning
> per-se, but does support their replication via individual tables. (this
> is OK for me)
>
> then Christopher Brown pointed me to a link (no web-access at the
> moment) and the usage of 
>
> ???add_empty_table_to_replication()
> which I looked at the SQL and seems like based on my understanding, it
> will
>
> 1) check if the set exists 
> (i'm a bit confused here, Does this mean that it will check if the
> parent table is already currently in a replication set? How does it know
> which one is the origin set? How do I call it? It has 5 field variables)
> 2) locks the origin table
> 3) check to see if the new (child) table to be replicated is empty using
> a "select 1 from x limit 1"
>
> is the add_empty_table_to_replication means that I need to manually
> trigger it using slonik? (weekly child table)
>
> replicate_partition()
> This one seems more understand-able (to me)
> 1) it looks in pg_class for the parent table of the set
> 2) it gets the parent table's replications
> 3) calls add_empty_table_to_replication()
>
> all in all, I still don't have much idea how to call them.

I set up the two functions to address two "functional views" for this:
  a) add_empty_table_to_replication() is more generic, providing a way to add
     an empty table to a replication set.

     In response to your confusion about 1), this function does NOT
     check for parentage of the table; its purpose is to add ANY empty
     table to replication, irrespective of use of table inheritance.
     The point of having the set ID is that each replicated table MUST
     be tied to a replication set, so this function needs to have a
     way to specify that.

In contrast, replicate_partition() provides a "cooked" perspective on
this; it provides a "user interface" directed towards adding in
inherited tables.  Note that it has fewer arguments; it doesn't need
to have a replication set specified, because that may be inferred
based on the "parent" table's metadata.

Thus, replicate_function() is quite a bit simpler, and, since it's
mostly doing validation of the data it's passing to
add_empty_table_to_replication(), that should *improve* reliability of
it.

Basically, what you would need to do, weekly, is to run a slonik
"execute script" script where the SQL script consists of something
similar to what's in tests/testpartition/gen_ddl_sql.sh:

-> create the new table, with indication of inheritace from the parent;

-> create a rule to indicate when data gets inserted into the new
   table, assuming you're using rules to control this;

-> run replicate_partition() on this newly-created table.
-- 
let name="cbbrowne" and tld="linuxfinances.info" in name ^ "@" ^ tld;;
http://cbbrowne.com/info/oses.html
"We English-speaking peoples should   keep hold of the essential  fact
about foreign languages: They exist to make us laugh."
-- John Derbyshire
From cbbrowne at ca.afilias.info  Mon Sep  8 16:07:12 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Mon Sep  8 16:07:28 2008
Subject: [Slony1-general] execute scripts always fails on 2.0 RC1
In-Reply-To: <8317F339-B2EC-4628-8230-4B2F2ECC1D97@rvt.dds.nl> (ries van
	Twisk's message of "Sun, 31 Aug 2008 19:00:40 -0500")
References: <8317F339-B2EC-4628-8230-4B2F2ECC1D97@rvt.dds.nl>
Message-ID: <874p4q2q5b.fsf@dba2.int.libertyrms.com>

ries van Twisk <slony@rvt.dds.nl> writes:
> hey All,
>
> when I try to use execute script in slonik it always seems to fail
> with the following error :
>
> bash-3.2$ ./alter-table
> DDL script consisting of 3 SQL statements
> DDL Statement 0: (0,59) [ALTER TABLE mytesttable ADD COLUMN test text;]
> DDL Statement 1: (59,62) []
> DDL Statement 2: (62,64) []
> <stdin>:15: PGRES_FATAL_ERROR  - ERROR:  syntax error at or near ""
> LINE 1:
>         ^
> Press any key to continue...
>
>
>
> This is how my exec script command looks like :
>
>     execute script (
>         set id = 1,
>         filename = '/tmp/alter',
>         event node = 1
>     );
>
>
> Is this a bug do you think??
>
> Ries

There may be a bug in the SQL parser; if I can get a copy of
/tmp/alter (which I would tend to think contains "ALTER TABLE
mytesttable ADD COLUMN test text;", plus 2 blank lines), that would be
handy for verification purposes.
-- 
(format nil "~S@~S" "cbbrowne" "ca.afilias.info")
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
From scetbon at echo.fr  Tue Sep  9 06:34:28 2008
From: scetbon at echo.fr (Cyril SCETBON)
Date: Tue Sep  9 06:34:34 2008
Subject: [Slony1-general] logswitch_start does not occurs
In-Reply-To: <87d4jl6zqs.fsf@dba2.int.libertyrms.com>
References: <48A196BF.8040103@echo.fr>
	<48A19978.9040702@echo.fr>	<1220420086.25502.23.camel@neuromancer.home.net>
	<87d4jl6zqs.fsf@dba2.int.libertyrms.com>
Message-ID: <48C67B64.7010606@echo.fr>



Christopher Browne wrote:
> Ow Mun Heng <Ow.Mun.Heng@wdc.com> writes:
>   
>> On Tue, 2008-08-12 at 16:08 +0200, Cyril SCETBON wrote:
>>     
>>> Cyril SCETBON wrote:
>>>  As we have a lot of 
>>> statement, I should use logswitch_start manually if I want it to happen 
>>> more often. But what means "every so often" in the documentation ? (see 
>>> above)
>>>
>>>       
>> I'm forcing the switch every 12 hours on mine to get the log file sizes
>> down. once it hits ~1-2Gm then I get the dreaded fetch 100 from log.
>>     
>
> In v1.2, the slon initiates running this on a weekly basis; take a
> look in the table "sl_registry"; there should be a tuple with "reg_key
> = 'logswitch_weekly.dow'"; that controls which day of the week it
> runs, and there may also be a tuple with reg_key =
> 'logswitch_weekly.time'.
>
> But basically, the initial design was to do so weekly.
>
> If you want it to take place more often, then run logswitch_start()
> more often, and twice a day doesn't seem outrageous.
>
> In v2.0, this is revisited; we *never* DELETE data from the log
> tables, exclusively using TRUNCATE, and use the slon parameter
> "cleanup_interval" to indicate how much old data gets kept around.  If
> that interval is 2 hours, then you can expect to see a TRUNCATE about
> every 2 hours.
>   
thank you Chris.

-- 
Cyril SCETBON
From ichsan at gmail.com  Wed Sep 10 02:57:01 2008
From: ichsan at gmail.com (Muhammad Ichsan)
Date: Wed Sep 10 02:57:32 2008
Subject: [Slony1-general] Failed to compile on Hardy
Message-ID: <c96f12030809100257s441b7d16v1487d9f5baf2849d@mail.gmail.com>

RGVhciBBbGwsCgpJIGhhdmUgYSBzZXJpb3VzIHByb2JsZW0uIEkgZmFpbGVkIHRvIGluc3RhbGwg
c2xvbnkgaW4gVWJ1bnR1IEhhcmR5CmkzODYgZm9yIHBvc3RncmVzcWwgOC4yLgoKSSB1c2VkIHRo
ZSBmb2xsb3dpbmcgY29tbWFuZCB0byBjb25maWd1cmUgYW5kIHN1Y2NlZWRlZDoKCi4vY29uZmln
dXJlIC0tcHJlZml4PS9ldGMvcG9zdGdyZXNxbC84LjIKLS13aXRoLXBnY29uZmlnZGlyPS91c3Iv
bGliL3Bvc3RncmVzcWwvOC4yL2JpbgotLXdpdGgtcGdiaW5kaXI9L3Vzci9iaW4gLS13aXRoLXBn
aW5jbHVkZWRpcj0vdXNyL2luY2x1ZGUvcG9zdGdyZXNxbAotLXdpdGgtcGdpbmNsdWRlc2VydmVy
ZGlyPS91c3IvaW5jbHVkZS9wb3N0Z3Jlc3FsLzguMi9zZXJ2ZXIKLS13aXRoLXBnbGliZGlyPS91
c3IvbGliIC0td2l0aC1wZ3NoYXJlZGlyPS91c3Ivc2hhcmUvcG9zdGdyZXNxbC84LjIKLS13aXRo
LXBlcmx0b29scz0vdXNyL2xvY2FsL2JpbiAtLXdpdGgtZG9jcz15ZXMKLS13aXRoLW1hbmRpcj0v
dXNyL2xvY2FsL21hbgotLXdpdGgtZDJtZGlyPS91c3Ivc2hhcmUvcGVybDUvc2dtbHNwbC1zcGVj
cwoKQnV0IGFmdGVyIEkgcnVuICdtYWtlJywgSSBnb3QgZXJyb3IgYXMgaW4gbXkgYXR0YWNobWVu
dAoKRGlkIEkgZG8gc29tZXRoaW5nIHdyb25nPyBEaWQgSSBtaXNzIHNvbWV0aGluZz8KCgoKLS0g
Cn5BIHVzZWZ1bCBtYW4gdG8gb3RoZXJzIGlzIGEgbHVja3kgbWFuCmh0dHA6Ly9taWNoc2FuLmJs
b2dzcG90LmNvbQoKUnpxaWVzLCBPcmRlciBub3chIGh0dHA6Ly9yenFpZXMud29yZHByZXNzLmNv
bQotLS0tLS0tLS0tLS0tLSBuZXh0IHBhcnQgLS0tLS0tLS0tLS0tLS0KQSBub24tdGV4dCBhdHRh
Y2htZW50IHdhcyBzY3J1YmJlZC4uLgpOYW1lOiBub2h1cC5vdXQKVHlwZTogYXBwbGljYXRpb24v
b2N0ZXQtc3RyZWFtClNpemU6IDk5OTYgYnl0ZXMKRGVzYzogbm90IGF2YWlsYWJsZQpVcmwgOiBo
dHRwOi8vbGlzdHMuc2xvbnkuaW5mby9waXBlcm1haWwvc2xvbnkxLWdlbmVyYWwvYXR0YWNobWVu
dHMvMjAwODA5MTAvMTlhODJhNzcvbm9odXAub2JqCg==
From greg at endpoint.com  Wed Sep 10 04:36:10 2008
From: greg at endpoint.com (Greg Sabino Mullane)
Date: Wed Sep 10 04:36:43 2008
Subject: [Slony1-general] Failed to compile on Hardy
In-Reply-To: <c96f12030809100257s441b7d16v1487d9f5baf2849d@mail.gmail.com>
References: <c96f12030809100257s441b7d16v1487d9f5baf2849d@mail.gmail.com>
Message-ID: <20080910073610.3226b77b@greg-laptop>


> I have a serious problem. I failed to install slony in Ubuntu Hardy
> i386 for postgresql 8.2.

Try the workaround mentioned in the first comment of this bug:

https://bugs.launchpad.net/ubuntu/+source/slony1/+bug/236749

"
A build can be made by hacking Makefile.global after running configure.
Swapping the include order of /usr/include/postgresql
and /usr/include/postgresql/8.2/server and adding -DNAMEDATALEN=64 to the
CPPFLAGS.
"

-- 
Greg Sabino Mullane greg@endpoint.com
End Point Corporation
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 163 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20080910/fea85ca2/signature.pgp
From kevin at kevinkempterllc.com  Wed Sep 10 07:27:14 2008
From: kevin at kevinkempterllc.com (kevin kempter)
Date: Wed Sep 10 07:27:21 2008
Subject: [Slony1-general] BLOB (lo_* style) support?
Message-ID: <2A05CE8B-CD5A-4051-BED7-EF979B8C5D16@kevinkempterllc.com>

Hi List;

does the new 2.0 release support BLOB data (lo_* style functions) ?
From ajs at crankycanuck.ca  Wed Sep 10 07:38:23 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Wed Sep 10 07:38:29 2008
Subject: [Slony1-general] BLOB (lo_* style) support?
In-Reply-To: <2A05CE8B-CD5A-4051-BED7-EF979B8C5D16@kevinkempterllc.com>
References: <2A05CE8B-CD5A-4051-BED7-EF979B8C5D16@kevinkempterllc.com>
Message-ID: <20080910143822.GA61629@crankycanuck.ca>

On Wed, Sep 10, 2008 at 08:27:14AM -0600, kevin kempter wrote:
> Hi List;
>
> does the new 2.0 release support BLOB data (lo_* style functions) ?

I haven't checked, but I don't see how it can.  There's still no way
to fire a trigger on those tables.

A

-- 
Andrew Sullivan
ajs@commandprompt.com
+1 503 667 4564 x104
http://www.commandprompt.com/
From cheighlund at yahoo.com  Wed Sep 10 08:18:16 2008
From: cheighlund at yahoo.com (cheighlund)
Date: Wed Sep 10 08:18:23 2008
Subject: [Slony1-general] Questions regarding dumping/restoring a
	replicating database.
Message-ID: <19414810.post@talk.nabble.com>


We're using Slony replication and logshipping on our main database to handle
data transfers for multiple remote locations.  The main setup (where the
logshipping records are generated) is running SuSE 9.3, Postgres 8.1.3 (yes,
I know that's fairly old) and Slony 1.1.5.  All of these were set up by my
predecessor at this position.

Recently, I was attempting to repair a second, log-shipping replicated
database on the main server.  We have a perl script which pulls the
necessary schema (including the complete schema and data from the
log-shipping-based replicated table) and data, then packs them for quick
transmission.  By accident (I wasn't paying enough attention), I managed to
load the schema from the rebuild pack into our main DB, the one running as
the 'master' node, which apparently managed to seriously damage the schema.

We have a backup file from early in the morning of the mistake, but it was
dropped as the public schema and public data only, no replication
information.  Loading only it into the database and running slon_start with
the correct configuration path caused the program to die before acting,
stating that the schema '_cpc_replic' did not exist.

I had an older copy of a database dump sitting around (I have no clue why I
left it there originally), and thought I could attempt to load it, strip the
'_cpc_replic' information from it using pg_dump, then load that back into
the original database.  I tried two attempts, neither of which worked
properly.  The first attempt was to drop that dumped '_cpc_replic' schema
straight onto the newly-loaded db, the second was to load the original
public schema, then the '_cpc_replic' information, then the public data.  In
both cases, logshipping would start, only to die a few minutes later with a
fatal error saying there was no operator for '_cpc_replic.xxid' < "unknown"
when comparing log_xid values on a delete statement.

After dropping that copy of the database and rebuilding again, I started by
trying to load the '_cpc_replic' schema (again, with data) first, then the
public schema, then the public data.  Attempting to run slon_start with that
has appeared to work so far; it's been going for a little over nineteen
hours without running into the error that shut the previous runs down. 
However, it has not generated any log-shipping files.  

In the interest of full disclosure of my original stupidity, I did not
attempt to drop the 'slave'-end database, only the master.  I'm wondering if
this may be partially or completely responsible for why we are seeing no
log-shipping messages.

Alternately, if I've managed to mangle things even further and should stop,
delete what I've got, and start over fresh, I would appreciate knowing this
as well, along with the proper procedures to be used in such a case.

Thank you.
-- 
View this message in context: http://www.nabble.com/Questions-regarding-dumping-restoring-a-replicating-database.-tp19414810p19414810.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.

From cbbrowne at ca.afilias.info  Wed Sep 10 11:08:46 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed Sep 10 11:08:58 2008
Subject: [Slony1-general] BLOB (lo_* style) support?
In-Reply-To: <20080910143822.GA61629@crankycanuck.ca> (Andrew Sullivan's
	message of "Wed, 10 Sep 2008 10:38:23 -0400")
References: <2A05CE8B-CD5A-4051-BED7-EF979B8C5D16@kevinkempterllc.com>
	<20080910143822.GA61629@crankycanuck.ca>
Message-ID: <87ej3r27rl.fsf@dba2.int.libertyrms.com>

Andrew Sullivan <ajs@crankycanuck.ca> writes:
> On Wed, Sep 10, 2008 at 08:27:14AM -0600, kevin kempter wrote:
>> Hi List;
>>
>> does the new 2.0 release support BLOB data (lo_* style functions) ?
>
> I haven't checked, but I don't see how it can.  There's still no way
> to fire a trigger on those tables.

Just so.

No way to create triggers on lo_* style functions
   --> No way for Slony-I to capture such changes.

I'll observe that in PostgreSQL 8.4, it has become possible to create
"ON TRUNCATE" triggers, which would, in principle, allow capturing
TRUNCATEs, or, at least, blocking them.?

I would think it not _completely_ implausible to, in an analagous way,
establish the capability to create triggers to detect lo_* changes,
although I expect it might at most be on the level of being able to
identify the tuple involved, and you'd essentially have to capture and
copy over the entire contents of the BLOB.

That of course assumes that this could pass the "will Tom say yes?" 
test, and I'm not sure that I would hope that he would say yes.

Footnotes: 
?  Simon Riggs submitted a sample patch that could capture and
propagate TRUNCATE; it is incomplete in that it doesn't join
together multiple requests as in the case where you submit:
   TRUNCATE table1, table2, table3;
or
   TRUNCATE table1 CASCADE;

I have not thought out a way to join them together, and if you've got
foreign key constraints, subscribers will break if you *don't* order
them appropriately, and mere ordering isn't good enough if there are
recursive foreign key relationships between tables.  But that's not
about BLOBs, so I digress...
-- 
output = ("cbbrowne" "@" "linuxfinances.info")
http://linuxfinances.info/info/sgml.html
Would-be National Mottos:
Canada: "We're nicer than you, and we've got national health insurance."
(Message on billboards all over the US-Canada border, sponsored by the
National Council of Smug Canadians)
From jerome at jfg-networks.net  Thu Sep 11 00:48:53 2008
From: jerome at jfg-networks.net (=?ISO-8859-1?Q?J=E9r=F4me_Jouanin?=)
Date: Thu Sep 11 00:49:19 2008
Subject: [Slony1-general] Re: "Unable to disable triggers" error in move set
In-Reply-To: <210e1e060809050552r99bbbf0qae494ef4e192c39b@mail.gmail.com>
References: <210e1e060809050552r99bbbf0qae494ef4e192c39b@mail.gmail.com>
Message-ID: <210e1e060809110048q4520c686u51d3f08bfb1c8bde@mail.gmail.com>

FYI, the pb was on master node.
The error was in the process of master's triggers deactivation.
The solution consists to delete triggers manually on master before executing
slonik move set.
J=E9r=F4me Jouanin
2008/9/5 J=E9r=F4me Jouanin <jerome@jfg-networks.net>

> Hi,
> The environment is Linux Debian Etch, PG8.3.3 and SlonyI 1.2.13.
> The problem I have actually is in execution of slonik_move_set :
> *<stdin>:12: Locking down set 1 on node 24
> <stdin>:14: Locked down - moving it
> <stdin>:15: NOTICE:  Slony-I: alterTableForReplication(): multiple
> instances of trigger $TRIGGER on table $TABLE
> CONTEXT:  SQL statement "SELECT  "$SLONY_SCHEMA".alterTableForReplication(
> $1 )"
> PL/pgSQL function "moveset_int" line 181 at PERFORM
> ...
> <stdin>:15: PGRES_FATAL_ERROR select "$SLONY_SCHEMA".moveSet(1, 22);  -
> ERROR:  Slony-I: Unable to disable triggers
> CONTEXT:  SQL statement "SELECT  "$SLONY_SCHEMA".alterTableForReplication(
> $1 )"
> PL/pgSQL function "moveset_int" line 181 at PERFORM
> SQL statement "SELECT  "$SLONY_SCHEMA".moveSet_int( $1 ,  $2 ,  $3 , 0)"
> PL/pgSQL function "moveset" line 61 at PERFORM*
>
> In Slony documentation I've read this :
>
>    -
>
>    *NOTICE: Slony-I: alterTableForReplication(): multiple instances of
>    trigger % on table %'',*
>
>    * This normally happens if you have a table that had a trigger attached
>    to it that replication hid due to this being a subscriber node, and th=
en you
>    added a trigger by the same name back to replication. Now, when trying=
 to
>    "fix up" triggers, those two triggers conflict. *
>
>    * The DDL script will keep running and rerunning, or the UNINSTALL NODE
>    will keep failing, until you drop the "visible" trigger, by hand, much
>    as you must have added it, by hand, earlier. *
>    -
>
>    *ERROR: Slony-I: Unable to disable triggers*
>
>    * This is the error that follows the "multiple triggers" problem. *
>
> An history mistake was a possibility, but executing the select of
> altertableforreplication trigger ...
>
> *select pc.relname, tg1.tgname from
> "pg_catalog".pg_trigger tg1,
>
> "pg_catalog".pg_trigger tg2,
> "pg_catalog".pg_class pc,
> "pg_catalog".pg_index pi,
> _ob2replication.sl_table tab
> where
> tg1.tgname =3D tg2.tgname and        -- Trigger names match
>
> tg1.tgrelid =3D tab.tab_reloid and   -- trigger 1 is on the table
> pi.indexrelid =3D tg2.tgrelid and    -- trigger 2 is on the index
> pi.indrelid =3D tab.tab_reloid and   -- indexes table is this table
> pc.oid =3D tab.tab_reloid*
>
> ... returns no result on spare server to move set to.
>
> Has anybody an idea about my problem ?
>
> Thx
> J=E9r=F4me Jouanin
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080911/=
efd13d63/attachment.htm
From cheighlund at yahoo.com  Thu Sep 11 07:16:05 2008
From: cheighlund at yahoo.com (cheighlund)
Date: Thu Sep 11 07:16:10 2008
Subject: [Slony1-general] How to correct "Error: namespace x already exists
	in node 1" error when starting slon_init_cluster?
Message-ID: <19435796.post@talk.nabble.com>


I'm trying to rebuild a pair of replication/logshipping databases that I
accidentally managed to screw up a few days ago.  (Screwed up the provider
node, so I'm assuming from the instructions I found in my predecessor's
notes that I'm going to have to drop/recreate the subscriber as well.)  I
have a backup from the early on the day of the error (well before I managed
to screw up), so I've got the most recent data available.  However, I'm
running into a problem, which I -think- has something to do with some stuff
in that backup.

Wherever the problem came from, I can't follow the instructions I found
while it persists, because attempting to run slonik_init_cluster causes the
program to error out with a message of 'Error: namespace "_cpc_replic"
already exists in node 1', followed by a second error of "ERROR: no admin
conninfo for node 134586768".

The program that generated the backup I'm using grabbed the public schema
and public data, storing them in separate files that were then packaged
together.  In theory, this should not have been a problem, but in practice,
I've somehow got a fair number of operators and triggers designed for the
replication schema (I know that's what they are because they've got the
schema's name on them; it's how I found them in the public schema's file in
the first place).  They don't appear to actually be in the database, as
loading a fresh db with a copy of the schema generates error output for each
of them (operators get 'operator "x" already exists', followed by two
'schema "_cpc_replic" does not exist' messages; the triggers simply get a
single copy of the 'schema does not exist' message), and because when I go
in, even though they were generated as public.* operators and triggers, I
can't drop them, getting the same 'schema does not exist' message.

I may be barking up the completely wrong tree with where I'm going; I don't
know enough about Slony to say.  Given that the schema in question doesn't
actually exist in the database, I don't appear to be able to use the DROP
SCHEMA CASCADE recommendation, and I'm not sure that would have any effect
anyway, given that they appear to be part of the public schema, which I'd be
scared to drop.

Will I have to manually edit those lines involving the replication schema
out of the schema file I'm loading from, or is there some way to remove the
old namespace from my setup under these conditions?  And if there is a way
to do so, where would I go to look it up?

Thank you for your consideration.
-- 
View this message in context: http://www.nabble.com/How-to-correct-%22Error%3A-namespace-x-already-exists-in-node-1%22-error-when-starting-slon_init_cluster--tp19435796p19435796.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.

From cheighlund at yahoo.com  Thu Sep 11 09:59:23 2008
From: cheighlund at yahoo.com (cheighlund)
Date: Thu Sep 11 09:59:34 2008
Subject: [Slony1-general] How to correct "Error: namespace x already
	exists in node 1" error when starting slon_init_cluster?
In-Reply-To: <19435796.post@talk.nabble.com>
References: <19435796.post@talk.nabble.com>
Message-ID: <19439528.post@talk.nabble.com>


Please forgive me.  I was attempting to set up a second replication set on
another system so as to verify the instructions I was attempting to follow,
and made the mistake of not verifying the information in the configuration
file.  I had assumed, as all databases involved were on the same server,
that it was set to localhost.  It was not, and this is the reason for the
errors I got.  I apologize for bringing this to the list without checking on
that beforehand.


cheighlund wrote:
> 
> I'm trying to rebuild a pair of replication/logshipping databases that I
> accidentally managed to screw up a few days ago...
> 

-- 
View this message in context: http://www.nabble.com/How-to-correct-%22Error%3A-namespace-x-already-exists-in-node-1%22-error-when-starting-slon_init_cluster--tp19435796p19439528.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.

From scetbon at echo.fr  Fri Sep 12 06:31:34 2008
From: scetbon at echo.fr (Cyril SCETBON)
Date: Fri Sep 12 06:31:39 2008
Subject: [Slony1-general] Disabling slony trigger during a transaction
Message-ID: <48CA6F36.70304@echo.fr>

Hi guys,

Is it possible to do it ? I would like to update a field in a table 
replicated by slony manually on each node, that is to say without using 
slony, whereas replication continues for other updates.

Thanks
-- 
Cyril SCETBON
From wmoran at collaborativefusion.com  Fri Sep 12 06:47:01 2008
From: wmoran at collaborativefusion.com (Bill Moran)
Date: Fri Sep 12 06:47:06 2008
Subject: [Slony1-general] Disabling slony trigger during a transaction
In-Reply-To: <48CA6F36.70304@echo.fr>
References: <48CA6F36.70304@echo.fr>
Message-ID: <20080912094701.20484a21.wmoran@collaborativefusion.com>

In response to Cyril SCETBON <scetbon@echo.fr>:

> Hi guys,
> 
> Is it possible to do it ? I would like to update a field in a table 
> replicated by slony manually on each node, that is to say without using 
> slony, whereas replication continues for other updates.

You can do that with execute script().  Don't know how well that fits
your reqirements.

-- 
Bill Moran
Collaborative Fusion Inc.
http://people.collaborativefusion.com/~wmoran/

wmoran@collaborativefusion.com
Phone: 412-422-3463x4023
From ajs at crankycanuck.ca  Fri Sep 12 06:51:02 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Fri Sep 12 06:51:08 2008
Subject: [Slony1-general] Disabling slony trigger during a transaction
In-Reply-To: <48CA6F36.70304@echo.fr>
References: <48CA6F36.70304@echo.fr>
Message-ID: <20080912135102.GA1850@crankycanuck.ca>

On Fri, Sep 12, 2008 at 03:31:34PM +0200, Cyril SCETBON wrote:
> Hi guys,
>
> Is it possible to do it ? I would like to update a field in a table 
> replicated by slony manually on each node, that is to say without using 
> slony, whereas replication continues for other updates.

Sort of, but not safely.  Why do you want to do it this way?

A

-- 
Andrew Sullivan
ajs@commandprompt.com
+1 503 667 4564 x104
http://www.commandprompt.com/
From wmoran at collaborativefusion.com  Fri Sep 12 06:59:42 2008
From: wmoran at collaborativefusion.com (Bill Moran)
Date: Fri Sep 12 06:59:47 2008
Subject: [Slony1-general] Disabling slony trigger during a transaction
In-Reply-To: <20080912094701.20484a21.wmoran@collaborativefusion.com>
References: <48CA6F36.70304@echo.fr>
	<20080912094701.20484a21.wmoran@collaborativefusion.com>
Message-ID: <20080912095942.8f4e1408.wmoran@collaborativefusion.com>

In response to Bill Moran <wmoran@collaborativefusion.com>:

> In response to Cyril SCETBON <scetbon@echo.fr>:
> 
> > Hi guys,
> > 
> > Is it possible to do it ? I would like to update a field in a table 
> > replicated by slony manually on each node, that is to say without using 
> > slony, whereas replication continues for other updates.
> 
> You can do that with execute script().  Don't know how well that fits
> your reqirements.

Actually, scratch that.  Using execute script() to do DML is a Very
Bad Idea.  (I should engage brain before using keyboard ...)

I suggest you reconsider your reason for wanting this ...

-- 
Bill Moran
Collaborative Fusion Inc.
http://people.collaborativefusion.com/~wmoran/

wmoran@collaborativefusion.com
Phone: 412-422-3463x4023
From scetbon at echo.fr  Fri Sep 12 07:00:12 2008
From: scetbon at echo.fr (Cyril SCETBON)
Date: Fri Sep 12 07:00:18 2008
Subject: [Slony1-general] Disabling slony trigger during a transaction
In-Reply-To: <20080912135102.GA1850@crankycanuck.ca>
References: <48CA6F36.70304@echo.fr> <20080912135102.GA1850@crankycanuck.ca>
Message-ID: <48CA75EC.6030205@echo.fr>

Cause we have a lot of update (14 Millions) to do. It takes 12/14 hours 
if we want to keep a replication with a tolerated lag. If we load it 
directly on each host in parallel ot takes 2/3 hours. I've used the 
alterTableRestore and alterTableForReplication to load data but it stop 
replication and I don't want it.


Andrew Sullivan wrote:
> On Fri, Sep 12, 2008 at 03:31:34PM +0200, Cyril SCETBON wrote:
>   
>> Hi guys,
>>
>> Is it possible to do it ? I would like to update a field in a table 
>> replicated by slony manually on each node, that is to say without using 
>> slony, whereas replication continues for other updates.
>>     
>
> Sort of, but not safely.  Why do you want to do it this way?
>
> A
>
>   

-- 
Cyril SCETBON
From scetbon at echo.fr  Fri Sep 12 07:01:05 2008
From: scetbon at echo.fr (Cyril SCETBON)
Date: Fri Sep 12 07:01:09 2008
Subject: [Slony1-general] Disabling slony trigger during a transaction
In-Reply-To: <20080912095942.8f4e1408.wmoran@collaborativefusion.com>
References: <48CA6F36.70304@echo.fr>	<20080912094701.20484a21.wmoran@collaborativefusion.com>
	<20080912095942.8f4e1408.wmoran@collaborativefusion.com>
Message-ID: <48CA7621.6080502@echo.fr>

I know that it locks everything -> a really bad idea, but thanks

Bill Moran wrote:
> In response to Bill Moran <wmoran@collaborativefusion.com>:
>
>   
>> In response to Cyril SCETBON <scetbon@echo.fr>:
>>
>>     
>>> Hi guys,
>>>
>>> Is it possible to do it ? I would like to update a field in a table 
>>> replicated by slony manually on each node, that is to say without using 
>>> slony, whereas replication continues for other updates.
>>>       
>> You can do that with execute script().  Don't know how well that fits
>> your reqirements.
>>     
>
> Actually, scratch that.  Using execute script() to do DML is a Very
> Bad Idea.  (I should engage brain before using keyboard ...)
>
> I suggest you reconsider your reason for wanting this ...
>
>   

-- 
Cyril SCETBON
From ajs at crankycanuck.ca  Fri Sep 12 07:33:22 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Fri Sep 12 07:33:30 2008
Subject: [Slony1-general] Disabling slony trigger during a transaction
In-Reply-To: <48CA75EC.6030205@echo.fr>
References: <48CA6F36.70304@echo.fr> <20080912135102.GA1850@crankycanuck.ca>
	<48CA75EC.6030205@echo.fr>
Message-ID: <20080912143322.GB1850@crankycanuck.ca>

On Fri, Sep 12, 2008 at 04:00:12PM +0200, Cyril SCETBON wrote:
> Cause we have a lot of update (14 Millions) to do. It takes 12/14 hours if 
> we want to keep a replication with a tolerated lag. If we load it directly 
> on each host in parallel ot takes 2/3 hours. I've used the 
> alterTableRestore and alterTableForReplication to load data but it stop 
> replication and I don't want it.

Wait, you want to bulk load a given table and still be replicating
that table (because it is receiving data in other transactions)
_also_?  Forget it.  Can't be done.

A

-- 
Andrew Sullivan
ajs@commandprompt.com
+1 503 667 4564 x104
http://www.commandprompt.com/
From wmoran at collaborativefusion.com  Fri Sep 12 07:35:23 2008
From: wmoran at collaborativefusion.com (Bill Moran)
Date: Fri Sep 12 07:35:28 2008
Subject: [Slony1-general] Disabling slony trigger during a transaction
In-Reply-To: <48CA7621.6080502@echo.fr>
References: <48CA6F36.70304@echo.fr>
	<20080912094701.20484a21.wmoran@collaborativefusion.com>
	<20080912095942.8f4e1408.wmoran@collaborativefusion.com>
	<48CA7621.6080502@echo.fr>
Message-ID: <20080912103523.38d9102d.wmoran@collaborativefusion.com>

In response to Cyril SCETBON <scetbon@echo.fr>:

> I know that it locks everything -> a really bad idea, but thanks

It also fscks up timestamps (commands like now()) and basically doesn't
ensure that your data is consistent between replicas.

> Cause we have a lot of update (14 Millions) to do. It takes 12/14 hours 
> if we want to keep a replication with a tolerated lag. If we load it 
> directly on each host in parallel ot takes 2/3 hours. I've used the 
> alterTableRestore and alterTableForReplication to load data but it stop 
> replication and I don't want it.

I recommend that you investigate this further.  Using execute script() is
a recipe for trouble in all but a few corner cases -- your data probably
isn't one of them.

If it's a bulk load table, why not ditch slony on that particular table
altogether?

If it's not a bulk-load table, then you're risking concurrent updates of
your data (slon vs. your updates) and then you shouldn't be bypassing
slony.

> 
> Bill Moran wrote:
> > In response to Bill Moran <wmoran@collaborativefusion.com>:
> >
> >   
> >> In response to Cyril SCETBON <scetbon@echo.fr>:
> >>
> >>     
> >>> Hi guys,
> >>>
> >>> Is it possible to do it ? I would like to update a field in a table 
> >>> replicated by slony manually on each node, that is to say without using 
> >>> slony, whereas replication continues for other updates.
> >>>       
> >> You can do that with execute script().  Don't know how well that fits
> >> your reqirements.
> >>     
> >
> > Actually, scratch that.  Using execute script() to do DML is a Very
> > Bad Idea.  (I should engage brain before using keyboard ...)
> >
> > I suggest you reconsider your reason for wanting this ...
> >
> >   
> 
> -- 
> Cyril SCETBON


-- 
Bill Moran
Collaborative Fusion Inc.
http://people.collaborativefusion.com/~wmoran/

wmoran@collaborativefusion.com
Phone: 412-422-3463x4023
From scetbon at echo.fr  Fri Sep 12 08:09:13 2008
From: scetbon at echo.fr (Cyril SCETBON)
Date: Fri Sep 12 08:09:19 2008
Subject: [Slony1-general] Disabling slony trigger during a transaction
In-Reply-To: <20080912143322.GB1850@crankycanuck.ca>
References: <48CA6F36.70304@echo.fr>
	<20080912135102.GA1850@crankycanuck.ca>	<48CA75EC.6030205@echo.fr>
	<20080912143322.GB1850@crankycanuck.ca>
Message-ID: <48CA8619.3060202@echo.fr>



Andrew Sullivan wrote:
> On Fri, Sep 12, 2008 at 04:00:12PM +0200, Cyril SCETBON wrote:
>   
>> Cause we have a lot of update (14 Millions) to do. It takes 12/14 hours if 
>> we want to keep a replication with a tolerated lag. If we load it directly 
>> on each host in parallel ot takes 2/3 hours. I've used the 
>> alterTableRestore and alterTableForReplication to load data but it stop 
>> replication and I don't want it.
>>     
>
> Wait, you want to bulk load a given table and still be replicating
> that table (because it is receiving data in other transactions)
> _also_?  
yes !!! but the field bulk updated won't be updated by our application 
at the same time
> Forget it.  Can't be done.
>
> A
>
>   

-- 
Cyril SCETBON - Ing?nieur bases de donn?es
AUSY pour France T?l?com - OPF/PORTAILS/DOP/HEBEX

T?l : +33 (0)4 97 12 87 60
Jabber : cscetbon@jabber.org
France Telecom - Orange
790 Avenue du Docteur Maurice Donat 
B?timent Marco Polo C2 - Bureau 202
06250 Mougins
France

***********************************
Ce message et toutes les pieces jointes (ci-apres le 'message') sont
confidentiels et etablis a l'intention exclusive de ses destinataires.
Toute utilisation ou diffusion non autorisee est interdite.
Tout message electronique est susceptible d'alteration. Le Groupe France
Telecom decline toute responsabilite au titre de ce message s'il a ete
altere, deforme ou falsifie.
Si vous n'etes pas destinataire de ce message, merci de le detruire
immediatement et d'avertir l'expediteur.
***********************************
This message and any attachments (the 'message') are confidential and
intended solely for the addressees.
Any unauthorised use or dissemination is prohibited.
Messages are susceptible to alteration. France Telecom Group shall not be
liable for the message if altered, changed or falsified.
If you are not recipient of this message, please cancel it immediately and
inform the sender.
************************************

From ajs at crankycanuck.ca  Fri Sep 12 09:59:18 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Fri Sep 12 09:59:30 2008
Subject: [Slony1-general] Disabling slony trigger during a transaction
In-Reply-To: <48CA8619.3060202@echo.fr>
References: <48CA6F36.70304@echo.fr> <20080912135102.GA1850@crankycanuck.ca>
	<48CA75EC.6030205@echo.fr> <20080912143322.GB1850@crankycanuck.ca>
	<48CA8619.3060202@echo.fr>
Message-ID: <20080912165918.GA2169@crankycanuck.ca>

On Fri, Sep 12, 2008 at 05:09:13PM +0200, Cyril SCETBON wrote:
> yes !!! but the field bulk updated won't be updated by our application at 
> the same time

Nope, can't be done.

A

-- 
Andrew Sullivan
ajs@commandprompt.com
+1 503 667 4564 x104
http://www.commandprompt.com/
From cbbrowne at ca.afilias.info  Fri Sep 12 11:31:04 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri Sep 12 11:31:15 2008
Subject: [Slony1-general] Release of 1.2.15
Message-ID: <87iqt1xllj.fsf@dba2.int.libertyrms.com>

We saw a new bug, which made it make sense to release 1.2.15, with a
number of fixes since 1.2.14:

Release 1.2.15
- Fix to STORE TRIGGER - store trigger was running against all nodes
  upon subscription

  http://www.slony.info/bugzilla/show_bug.cgi?id=56

- Portability changes to some tools/ scripts, fixing some
  "bash-isms"

- Fix to switch statement in slonik.c; unknown how it broke

- Fix memory leak
  http://bugs.slony.info/bugzilla/show_bug.cgi?id=52

Note: I ran tests on 8.1 and 8.3; there wasn't much change since 1.2.14...
-- 
let name="cbbrowne" and tld="linuxdatabases.info" in String.concat "@" [name;tld];;
http://www3.sympatico.ca/cbbrowne/
Every program is a part of some other program and rarely fits.
-- Alan J. Perlis
From JanWieck at Yahoo.com  Fri Sep 12 11:42:12 2008
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Fri Sep 12 11:50:31 2008
Subject: [Slony1-general] Disabling slony trigger during a transaction
In-Reply-To: <20080912165918.GA2169@crankycanuck.ca>
References: <48CA6F36.70304@echo.fr>
	<20080912135102.GA1850@crankycanuck.ca>	<48CA75EC.6030205@echo.fr>
	<20080912143322.GB1850@crankycanuck.ca>	<48CA8619.3060202@echo.fr>
	<20080912165918.GA2169@crankycanuck.ca>
Message-ID: <48CAB804.40401@Yahoo.com>

On 9/12/2008 12:59 PM, Andrew Sullivan wrote:
> On Fri, Sep 12, 2008 at 05:09:13PM +0200, Cyril SCETBON wrote:
>> yes !!! but the field bulk updated won't be updated by our application at 
>> the same time
> 
> Nope, can't be done.

Andrew is right. There would be an elegant mechanism that allows you to 
suppress the deny access trigger from firing when you update the 
subscribers. But there is no such way short of dropping/recreating the 
log trigger for that particular table on the origin. To be consistent 
though, you'd have to do DROP,UPDARE,CREATE all in one transaction and 
make sure through some where clause that you will hit exactly the same 
rows on all nodes ... which also assumes that all subscribers have 
caught up to the point where the update was done on the origin.


Jan

-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin

From shahaf at redfin.com  Fri Sep 12 15:21:16 2008
From: shahaf at redfin.com (Shahaf Abileah)
Date: Fri Sep 12 15:21:37 2008
Subject: [Slony1-general] Slony replication across networks through an ssh
	tunnel
Message-ID: <082D8A131DF72A4D88C908A1AD3DEB2204FFBA1F@mail-1.rf.lan>

 

We are trying to set up a slony slave across two different networks over
a WAN connection.  Due to network reliability, we want to first do the
initial subscription for the slave on the same network as the master,
and then relocate that machine to the other network.  Then, we want to
tweak the slony paths so that we can use a tunnel through a bridgehead
server for the synchronization.  

 

We tried this out with a test database and it seemed to work, data was
replicating and no errors were reported by slon, but were wondering if
anyone can think of reasons why this might not work or if there is a
better way.  In particular, we're not sure if there is a better way than
manually editing slony paths, and if it is acceptable for them to not be
consistent between the master and slave(s).  Here are the details of
what we tried:

 

 

# Initial normal subscription/replication

Create database "DB_master" on network A, machine_1_A, and populate with
schema and data

Create database "DB_slave"on network A, machine_2_A, with schema only

Subscribe machine 2 "DB_slave" to machine 1 "DB_master"

Start slon processes on machine 1 to replicate initial data set

Add new data to "DB_master" and verify changes replicated to "DB_slave"

 

# Now, attempt to 'relocate' the initial subscription on the slave to
another machine

Stop slon  on machine_1_A

Stop postgres on machine_2_A

Rsync postgres data directory on machine_2_A to machine_3_B (on network
B)

Start postgres on machine_3_B, verify data exists in "DB_slave"

 

# Create a tunnel and Change the paths to use the tunnel

On machine_3_B, port 15432, Create an ssh tunnel to join network A and B
through machine_4_AB

# (Here, We are not able to drop path/store path since the machines
cannot see each other without the tunnel)

On "DB_master" on machine_1_A, change the sl_path row for machine_2_A to
instead read machine_3_B 

On "DB_slave" on machine_3_B, change the sl_path row for machine_1_A
(which it cannot reach) to point to localhost:15432 (the tunnel to
machine_1_A)

 

# Move slon scripts and change slave name

Move the slon scripts from machine_1_A to machine_3_B, and change the
slave host to machine_3_B

Restart slon processes on machine_3_B

 

 

Thanks for any feedback, it's a bit of a kludge, but is the only we've
been able to get it to work.

 

Jeff (sent by co-worker Shahaf)

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080912/6bc7a417/attachment.htm
From cbbrowne at ca.afilias.info  Fri Sep 12 15:37:28 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri Sep 12 15:37:44 2008
Subject: [Slony1-general] Slony replication across networks through an ssh
	tunnel
In-Reply-To: <082D8A131DF72A4D88C908A1AD3DEB2204FFBA1F@mail-1.rf.lan> (Shahaf
	Abileah's message of "Fri, 12 Sep 2008 15:21:16 -0700")
References: <082D8A131DF72A4D88C908A1AD3DEB2204FFBA1F@mail-1.rf.lan>
Message-ID: <8763p1xa6v.fsf@dba2.int.libertyrms.com>

Shahaf Abileah <shahaf@redfin.com> writes:
>  We are trying to set up a slony slave across two different networks
> over a WAN connection.? Due to network reliability, we want to first
> do the initial subscription for the slave on the same network as the
> master, and then relocate that machine to the other network.? Then,
> we want to tweak the slony paths so that we can use a tunnel through
> a bridgehead server for the synchronization.? :p>
>
> 								       :p>?
>
>   We tried this out with a test database and it seemed to work, data
> was replicating and no errors were reported by slon, but were
> wondering if anyone can think of reasons why this might not work or
> if there is a better way.? In particular, we're not sure if there is
> a better way than manually editing slony paths, and if it is
> acceptable for them to not be consistent between the master and
> slave(s).? Here are the details of what

I would suggest using the slonik "STORE PATH" command to revise the
paths, rather than going into the database and altering the sl_table
directly; that is safer and cleaner.

Aside from that, I'd expect SSH tunnelling to work fine.
-- 
output = reverse("moc.enworbbc" "@" "enworbbc")
http://cbbrowne.com/info/
Would-be National Mottos:
Poland: "We probably would have had a happier history if we were
between Canada and Mexico, not Germany and Russia."
From scetbon at echo.fr  Sat Sep 13 12:04:08 2008
From: scetbon at echo.fr (Cyril SCETBON)
Date: Sat Sep 13 12:04:21 2008
Subject: [Slony1-general] Disabling slony trigger during a transaction
In-Reply-To: <48CAB804.40401@Yahoo.com>
References: <48CA6F36.70304@echo.fr>
	<20080912135102.GA1850@crankycanuck.ca>	<48CA75EC.6030205@echo.fr>
	<20080912143322.GB1850@crankycanuck.ca>	<48CA8619.3060202@echo.fr>
	<20080912165918.GA2169@crankycanuck.ca> <48CAB804.40401@Yahoo.com>
Message-ID: <48CC0EA8.9070804@echo.fr>



Jan Wieck wrote:
> On 9/12/2008 12:59 PM, Andrew Sullivan wrote:
>> On Fri, Sep 12, 2008 at 05:09:13PM +0200, Cyril SCETBON wrote:
>>> yes !!! but the field bulk updated won't be updated by our 
>>> application at the same time
>>
>> Nope, can't be done.
>
> Andrew is right. There would be an elegant mechanism that allows you 
> to suppress the deny access trigger from firing when you update the 
> subscribers. But there is no such way short of dropping/recreating the 
> log trigger for that particular table on the origin. To be consistent 
> though, you'd have to do DROP,UPDARE,CREATE all in one transaction and 
> make sure through some where clause that you will hit exactly the same 
> rows on all nodes ... which also assumes that all subscribers have 
> caught up to the point where the update was done on the origin.
Bad news :-( It would really be great to have such an option. as DROP 
trigger is a DDL statement it can't be done in a transaction (afaik) 
without disturbing other transactions, so maybe another way could to 
start a transaction, updating a field (disable_trigger_work=1) in a 
table, doing all the DML, setting the field to the origin value 
((disable_trigger_work=0) and ending the transaction. But this way, it 
adds a select for every trigger call. It can be a starting point

>
>
> Jan
>

-- 
Cyril SCETBON
From info at xplicare.com  Mon Sep 15 01:24:54 2008
From: info at xplicare.com (xplicare)
Date: Mon Sep 15 01:25:20 2008
Subject: [Slony1-general] No replication on Windows Vista
Message-ID: <19488860.post@talk.nabble.com>


LS,

I'm currently using a windows Vista Ultimate edition in combination with
postgresql 8.3 and PgAdmin III 1.8.2

I followed several tutorials to set up 2 local databases (master and slave),
e.g. this tutorial:
http://www.pgadmin.org/docs/1.8/slony.html


Followed everything to the letter and several varitions of it to try and get
it working, however with no result. There are no errors in the pgAdmin log
and so far haven't found a specific log file for Slony-I.

Setting up the databases, replication sets, paths, etc all works fine.
Adding engines to Slony-I service with conf files also no problem... Then
starting Slony service..ok. 

After that I would suspect to see replication in my slave database, but
alas, nothing happens. I'm sure the solutions is something ridiculously
simple, but I can't see it and after 3 days of trying all kinds of
variations i'm on the verge of quiting Slony-I and looking for other
alternatives.

Any help / suggestions would be very much appreciated.

Regards,

Arjan

-- 
View this message in context: http://www.nabble.com/No-replication-on-Windows-Vista-tp19488860p19488860.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.

From glynastill at yahoo.co.uk  Mon Sep 15 03:39:06 2008
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Mon Sep 15 03:39:35 2008
Subject: [Slony1-general] Release of 1.2.15 (Was  Version 1.2.14 available)
In-Reply-To: <60k5hms91o.fsf@dba2.int.libertyrms.com>
Message-ID: <858853.80666.qm@web25808.mail.ukl.yahoo.com>

Upgrading to 1.2.15 I still get:

repl_update_functions.scr:12: Possible unsupported PostgreSQL version 8.3, defaulting to 8.1 support

Funny, I'm sure I didn't see it last time I upgraded, either that or I just ignored it.

I'm guessing still no biggy.

--- On Thu, 22/5/08, Christopher Browne <cbbrowne@ca.afilias.info> wrote:
> Right you are!  Happily, the message is, as you say,
> harmless and
> cosmetic.  The code is doing the right things anyways. 
> I'll see about
> patching this (not today; I'm at PGCon) so it appears
> to behave right,
> instead of merely doing so :-).
> 
> It is indeed irritating that this code occurs twice; it is
> essentially
> eliminated in v2.0, so I don't think it's worth
> going to much effort
> to do the "big fix."


      
From ajs at crankycanuck.ca  Mon Sep 15 08:27:57 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Mon Sep 15 08:28:06 2008
Subject: [Slony1-general] Disabling slony trigger during a transaction
In-Reply-To: <48CC0EA8.9070804@echo.fr>
References: <48CA6F36.70304@echo.fr> <20080912135102.GA1850@crankycanuck.ca>
	<48CA75EC.6030205@echo.fr> <20080912143322.GB1850@crankycanuck.ca>
	<48CA8619.3060202@echo.fr> <20080912165918.GA2169@crankycanuck.ca>
	<48CAB804.40401@Yahoo.com> <48CC0EA8.9070804@echo.fr>
Message-ID: <20080915152757.GB5753@crankycanuck.ca>

On Sat, Sep 13, 2008 at 09:04:08PM +0200, Cyril SCETBON wrote:

> Bad news :-( It would really be great to have such an option. as DROP 
> trigger is a DDL statement it can't be done in a transaction (afaik) 
> without disturbing other transactions, so maybe another way could to start 
> a transaction, updating a field (disable_trigger_work=1) in a table, doing 
> all the DML, setting the field to the origin value 
> ((disable_trigger_work=0) and ending the transaction. But this way, it adds 
> a select for every trigger call. It can be a starting point

No, none of this will work.  It's always going to block all other
transactions on the origin.  BTW, DDL _can_ be done in a transaction
on Postgres.  It's one of the coolest Postgres features.

A

-- 
Andrew Sullivan
ajs@commandprompt.com
+1 503 667 4564 x104
http://www.commandprompt.com/
From ajs at crankycanuck.ca  Mon Sep 15 08:34:44 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Mon Sep 15 08:34:52 2008
Subject: [Slony1-general] No replication on Windows Vista
In-Reply-To: <19488860.post@talk.nabble.com>
References: <19488860.post@talk.nabble.com>
Message-ID: <20080915153444.GC5753@crankycanuck.ca>

On Mon, Sep 15, 2008 at 01:24:54AM -0700, xplicare wrote:

> and so far haven't found a specific log file for Slony-I.

Without finding that log file (I know nothing about Windows), I don't
think you'll get much help.  

A

-- 
Andrew Sullivan
ajs@commandprompt.com
+1 503 667 4564 x104
http://www.commandprompt.com/
From dpage at pgadmin.org  Mon Sep 15 08:47:59 2008
From: dpage at pgadmin.org (Dave Page)
Date: Mon Sep 15 08:48:37 2008
Subject: [Slony1-general] No replication on Windows Vista
In-Reply-To: <20080915153444.GC5753@crankycanuck.ca>
References: <19488860.post@talk.nabble.com>
	<20080915153444.GC5753@crankycanuck.ca>
Message-ID: <937d27e10809150847v3c1c687ai55ca17520d7bdcc9@mail.gmail.com>

On Mon, Sep 15, 2008 at 4:34 PM, Andrew Sullivan <ajs@crankycanuck.ca> wrote:
> On Mon, Sep 15, 2008 at 01:24:54AM -0700, xplicare wrote:
>
>> and so far haven't found a specific log file for Slony-I.
>
> Without finding that log file (I know nothing about Windows), I don't
> think you'll get much help.

Check the windows event log.

-- 
Dave Page
EnterpriseDB UK: http://www.enterprisedb.com
From info at xplicare.com  Mon Sep 15 23:26:26 2008
From: info at xplicare.com (xplicare)
Date: Mon Sep 15 23:26:51 2008
Subject: [Slony1-general] No replication on Windows Vista
In-Reply-To: <937d27e10809150847v3c1c687ai55ca17520d7bdcc9@mail.gmail.com>
References: <19488860.post@talk.nabble.com>
	<20080915153444.GC5753@crankycanuck.ca>
	<937d27e10809150847v3c1c687ai55ca17520d7bdcc9@mail.gmail.com>
Message-ID: <19506087.post@talk.nabble.com>




Dave Page-7 wrote:
> 
> On Mon, Sep 15, 2008 at 4:34 PM, Andrew Sullivan <ajs@crankycanuck.ca>
> wrote:
>> On Mon, Sep 15, 2008 at 01:24:54AM -0700, xplicare wrote:
>>
>>> and so far haven't found a specific log file for Slony-I.
>>
>> Without finding that log file (I know nothing about Windows), I don't
>> think you'll get much help.
> Check the windows event log.
> 

Indeed the windows event log was filled with:

FATAL main: Cannot connect to local database - fe_sendauth: no password
supplied - sleep 10s

So logically I would have to add the DB password to the conf file and paths
in Slony-I.
However I was under the impression that Slony-I took the passwords
automatically?
Probably from some pgpass file, but I don't know exactly were that file was
located again or should I create that myself?

For now I'll try to add the password manually to the connection strings..
i'll try that later on..

Arjan


-- 
View this message in context: http://www.nabble.com/No-replication-on-Windows-Vista-tp19488860p19506087.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.

From dpage at pgadmin.org  Tue Sep 16 00:26:56 2008
From: dpage at pgadmin.org (Dave Page)
Date: Tue Sep 16 00:27:22 2008
Subject: [Slony1-general] No replication on Windows Vista
In-Reply-To: <19506087.post@talk.nabble.com>
References: <19488860.post@talk.nabble.com>
	<20080915153444.GC5753@crankycanuck.ca>
	<937d27e10809150847v3c1c687ai55ca17520d7bdcc9@mail.gmail.com>
	<19506087.post@talk.nabble.com>
Message-ID: <937d27e10809160026s4c213bf3n5953c41ce3e74517@mail.gmail.com>

On Tue, Sep 16, 2008 at 7:26 AM, xplicare <info@xplicare.com> wrote:
>
>
>
> Dave Page-7 wrote:
>>
>> On Mon, Sep 15, 2008 at 4:34 PM, Andrew Sullivan <ajs@crankycanuck.ca>
>> wrote:
>>> On Mon, Sep 15, 2008 at 01:24:54AM -0700, xplicare wrote:
>>>
>>>> and so far haven't found a specific log file for Slony-I.
>>>
>>> Without finding that log file (I know nothing about Windows), I don't
>>> think you'll get much help.
>> Check the windows event log.
>>
>
> Indeed the windows event log was filled with:
>
> FATAL main: Cannot connect to local database - fe_sendauth: no password
> supplied - sleep 10s
>
> So logically I would have to add the DB password to the conf file and paths
> in Slony-I.
> However I was under the impression that Slony-I took the passwords
> automatically?
> Probably from some pgpass file, but I don't know exactly were that file was
> located again or should I create that myself?

The documentation you were reading discusses that - see the first
section of http://www.pgadmin.org/docs/1.8/slony-path.html.


-- 
Dave Page
EnterpriseDB UK: http://www.enterprisedb.com
From thawes at novadine.com  Tue Sep 16 04:27:52 2008
From: thawes at novadine.com (Tim Hawes)
Date: Tue Sep 16 04:28:27 2008
Subject: [Slony1-general] db_getLocalNodeId
Message-ID: <48CF9838.805@novadine.com>

I have successfully got a slony cluster started with 3 nodes now. I 
tried adding 4 new nodes and have been getting this error.

ERROR  remoteListenThread_1: db_getLocalNodeId() returned 11 - wrong 
database?

Here is where I have got so far on this, I tested the credentials in the 
DEBUG line of the log for this error (not posted here for security 
reasons), and the host definition was not 'localhost'

I did find that the nodes had the host name assigned to 127.0.0.1, I 
changed that to their primary external IP's in the hosts tables and 
restarted slon on all 4 nodes, but I still get this error. Any ideas?

From info at xplicare.com  Tue Sep 16 05:14:38 2008
From: info at xplicare.com (xplicare)
Date: Tue Sep 16 05:14:42 2008
Subject: [Slony1-general] No replication on Windows Vista
In-Reply-To: <937d27e10809160026s4c213bf3n5953c41ce3e74517@mail.gmail.com>
References: <19488860.post@talk.nabble.com>
	<20080915153444.GC5753@crankycanuck.ca>
	<937d27e10809150847v3c1c687ai55ca17520d7bdcc9@mail.gmail.com>
	<19506087.post@talk.nabble.com>
	<937d27e10809160026s4c213bf3n5953c41ce3e74517@mail.gmail.com>
Message-ID: <19510518.post@talk.nabble.com>



Dave Page-7 wrote:
> 
> 
> The documentation you were reading discusses that - see the first
> section of http://www.pgadmin.org/docs/1.8/slony-path.html.
> -- 
> Dave Page
> EnterpriseDB UK: http://www.enterprisedb.com
> 

Thank you Dave!

I finally got it working :)
Synchronisation works like a charm now.

Only thing left is the pgpass.conf file. Since there was no pgpass file yet
in either my own %APPDATA%/postgresql dir nor in the same directory under my
user postgres I created a pgpass file as suggested in:
http://www.pgadmin.org/docs/1.8/slony-path.html

So I put 2 lines in pgpass.conf:
localhost:5432:master:postgres:<postgres password>
localhost:5432:slave:postgres:<postgres password>

After I made it a hidden file and put it in my own %APPDATA%/postgresql dir
I got the following messages when I started the Slony-I service again:
FATAL main: Cannot connect to local database - fe_sendauth: no password
supplied - sleep 10s

So I suspect he didn't found my password file. After this I tried to put the
file under the postgres user on my system, however this gave me the same
result.

For safety issues I think it better to use a pgpass file instead of sending
the password with the connection string, but until now I only get Slony-I
working if I provide the password in the connection string.

Any suggestions?

Arjan





-- 
View this message in context: http://www.nabble.com/No-replication-on-Windows-Vista-tp19488860p19510518.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.

From dpage at pgadmin.org  Tue Sep 16 06:09:38 2008
From: dpage at pgadmin.org (Dave Page)
Date: Tue Sep 16 06:09:42 2008
Subject: [Slony1-general] No replication on Windows Vista
In-Reply-To: <19510518.post@talk.nabble.com>
References: <19488860.post@talk.nabble.com>
	<20080915153444.GC5753@crankycanuck.ca>
	<937d27e10809150847v3c1c687ai55ca17520d7bdcc9@mail.gmail.com>
	<19506087.post@talk.nabble.com>
	<937d27e10809160026s4c213bf3n5953c41ce3e74517@mail.gmail.com>
	<19510518.post@talk.nabble.com>
Message-ID: <937d27e10809160609t701a46b8oef6caa573b57532d@mail.gmail.com>

On Tue, Sep 16, 2008 at 1:14 PM, xplicare <info@xplicare.com> wrote:
>
> Thank you Dave!
>
> I finally got it working :)
> Synchronisation works like a charm now.

:-)

> Only thing left is the pgpass.conf file. Since there was no pgpass file yet
> in either my own %APPDATA%/postgresql dir nor in the same directory under my
> user postgres I created a pgpass file as suggested in:
> http://www.pgadmin.org/docs/1.8/slony-path.html
>
> So I put 2 lines in pgpass.conf:
> localhost:5432:master:postgres:<postgres password>
> localhost:5432:slave:postgres:<postgres password>
>
> After I made it a hidden file and put it in my own %APPDATA%/postgresql dir
> I got the following messages when I started the Slony-I service again:
> FATAL main: Cannot connect to local database - fe_sendauth: no password
> supplied - sleep 10s

It needs to go in the %APPDATA% for the user that the Slony service
runs as. You can check that in the Services control panel applet, on
the Log On tab of the service properties.

> So I suspect he didn't found my password file. After this I tried to put the
> file under the postgres user on my system, however this gave me the same
> result.

Maybe you accidently installed as another user - eg. LocalSystem?

> For safety issues I think it better to use a pgpass file instead of sending
> the password with the connection string, but until now I only get Slony-I
> working if I provide the password in the connection string.

Yes, definitely more secure to use pgpass.


-- 
Dave Page
EnterpriseDB UK: http://www.enterprisedb.com
From info at xplicare.com  Tue Sep 16 07:34:58 2008
From: info at xplicare.com (xplicare)
Date: Tue Sep 16 07:35:05 2008
Subject: [Slony1-general] No replication on Windows Vista
In-Reply-To: <937d27e10809160609t701a46b8oef6caa573b57532d@mail.gmail.com>
References: <19488860.post@talk.nabble.com>
	<20080915153444.GC5753@crankycanuck.ca>
	<937d27e10809150847v3c1c687ai55ca17520d7bdcc9@mail.gmail.com>
	<19506087.post@talk.nabble.com>
	<937d27e10809160026s4c213bf3n5953c41ce3e74517@mail.gmail.com>
	<19510518.post@talk.nabble.com>
	<937d27e10809160609t701a46b8oef6caa573b57532d@mail.gmail.com>
Message-ID: <19513168.post@talk.nabble.com>



Dave Page-7 wrote:
> 
> On Tue, Sep 16, 2008 at 1:14 PM, xplicare <info@xplicare.com> wrote:
>>
>> Thank you Dave!
>>
>> I finally got it working :)
>> Synchronisation works like a charm now.
> 
> :-)
> 
>> Only thing left is the pgpass.conf file. Since there was no pgpass file
>> yet
>> in either my own %APPDATA%/postgresql dir nor in the same directory under
>> my
>> user postgres I created a pgpass file as suggested in:
>> http://www.pgadmin.org/docs/1.8/slony-path.html
>>
>> So I put 2 lines in pgpass.conf:
>> localhost:5432:master:postgres:<postgres password>
>> localhost:5432:slave:postgres:<postgres password>
>>
>> After I made it a hidden file and put it in my own %APPDATA%/postgresql
>> dir
>> I got the following messages when I started the Slony-I service again:
>> FATAL main: Cannot connect to local database - fe_sendauth: no password
>> supplied - sleep 10s
> 
> It needs to go in the %APPDATA% for the user that the Slony service
> runs as. You can check that in the Services control panel applet, on
> the Log On tab of the service properties.
> 
>> So I suspect he didn't found my password file. After this I tried to put
>> the
>> file under the postgres user on my system, however this gave me the same
>> result.
> 
> Maybe you accidently installed as another user - eg. LocalSystem?
> 
>> For safety issues I think it better to use a pgpass file instead of
>> sending
>> the password with the connection string, but until now I only get Slony-I
>> working if I provide the password in the connection string.
> 
> Yes, definitely more secure to use pgpass.
> 
> 
> -- 
> Dave Page
> 


EUREKA!

Got it all to work now. Few strange things though:
The service was running as a: 'Local Service'.
Since there is no 'Local Service User' on my system I tried adding the
pgpass file to all %APPDATA%/postgresql dirs on my system including
'Default' user, 'postgres' user and myself. This did not work. I still got
the password error:
FATAL main: Cannot connect to local database - fe_sendauth: no password
supplied - sleep 10s 

First I changed the owner of the service to 'Local System account'. I left
the pgpass file in every %APPDATA%/postgresql dir I could find and started
the service again... Still the same error.

I then decided to change the owner of the service Slony-I to the user
postgres, which made sense to me at least. The pgpass file was already in
the %APPDATA%/postgresql dir of the postgres user. This did not work either.

The only thing that does work is to change the owner of the service to the
user that is logged in (myself) and putting the pgpass file in my own
%APPDATA%/postgresql dir. That is the way I did it now and that seems to
work just fine.

Thanks for all your help Dave, I'm really glad I can start working on my
application now since the replication is all set up :)


regards,

Arjan



-- 
View this message in context: http://www.nabble.com/No-replication-on-Windows-Vista-tp19488860p19513168.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.

From JanWieck at Yahoo.com  Tue Sep 16 08:30:36 2008
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Tue Sep 16 08:29:05 2008
Subject: [Slony1-general] db_getLocalNodeId
In-Reply-To: <48CF9838.805@novadine.com>
References: <48CF9838.805@novadine.com>
Message-ID: <48CFD11C.4050401@Yahoo.com>

On 9/16/2008 7:27 AM, Tim Hawes wrote:
> I have successfully got a slony cluster started with 3 nodes now. I 
> tried adding 4 new nodes and have been getting this error.
> 
> ERROR  remoteListenThread_1: db_getLocalNodeId() returned 11 - wrong 
> database?

The path from that node TO node 1 is actually pointing at node 11. Check 
all sl_path entries with server=1 and run a corrected STORE PATH.


Jan

-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin

From deanliu at gmail.com  Tue Sep 16 11:05:29 2008
From: deanliu at gmail.com (Dean Liu)
Date: Tue Sep 16 11:05:40 2008
Subject: [Slony1-general] error subscribing to set
Message-ID: <273718db0809161105x17f1a543ya9b336a9afef672d@mail.gmail.com>

Hello all,

I am following this guide to set up a simple master - slave
relationship between two postgres databases:
http://www.onlamp.com/pub/a/onlamp/2004/12/16/slony_install.html

The only main differences is that I'm using two VMs instead of using
two different postgres instances listening on different ports.

Everything is working great except that it seems when I attempt to
issue the subscribe set command I get an error:  "insert or update on
table "sl_path" violates foreign key constraint "pa_client-no_id-ref".
DETAIL: Key (pa_client)=(2) is not present on table "s1_node".

Any ideas?  I apologize if this has been answered before - I attempted
to scour google for answers and apparently a few have come across the
same problem however have received no answers.

Please let me know if you need any more information.

Thanks!
Dean
From glynastill at yahoo.co.uk  Tue Sep 16 11:25:39 2008
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Tue Sep 16 11:25:50 2008
Subject: [Slony1-general] Restore a node after pg_dump
Message-ID: <175825.52308.qm@web25804.mail.ukl.yahoo.com>

Hi Chaps,

I've got a test setup with slony replicating two databases on the same postgres instance, e.g. I've a table "price" in database SEE and SEE_REP on the same host and I'm replicating it with slony from SEE to SEE_REP.

What I've tried to do is pg_dumpall then re-initdb the server, reload the dump back in and then run REPAIR CONFIG.

I was hoping I could restart slony and it'd work. No luck.

The slon that runs against the subscriber database "SEE_REP" starts up and appears to be running OK as far as I can tell, however the slon on the origin database "SEE" never connects and constantly logs:

2008-09-16_191105 BST DEBUG2 remoteListenThread_2: queue event 2,297599 SYNC
2008-09-16_191105 BST DEBUG2 remoteListenThread_2: queue event 2,297600 SYNC
2008-09-16_191105 BST DEBUG2 remoteListenThread_2: queue event 2,297601 SYNC
2008-09-16_191105 BST DEBUG2 remoteListenThread_2: queue event 2,297602 SYNC
2008-09-16_191105 BST DEBUG2 remoteListenThread_2: queue event 2,297603 SYNC
2008-09-16_191105 BST DEBUG2 remoteWorkerThread_2: Received event 2,297347 RESET_CONFIG
2008-09-16_191105 BST DEBUG2 slon: child terminated status: 11; pid: 1956, current worker pid: 1956
2008-09-16_191105 BST DEBUG1 slon: restart of worker in 10 seconds


I know we've seen this before and the error is not informative at all, but does anyone have any idea what could be going off here?

I've seen the "queue event", "RESET_CONFIG" and "child terminated status: 11" quite often when I mess something up and I can never find any documentation on the slony site about them (I looked here: http://www.slony.info/documentation/loganalysis.html)

The output of test_slony_state-dbi.pl is below, to my uneducated eye it doesn't show anything wrong?

To be honest I knew doing this would be asking for trouble, but does anyone have any pointers? If not could someone explain what the last four lines in the log mean? From what I can gather 11 is some sort of unknown error?

Ta
Glyn


DSN: dbi:Pg:dbname=SEE_REP;host=192.168.1.111;user=postgres;
===========================
Rummage for DSNs
=============================
Query:

   select p.pa_server, p.pa_conninfo
   from "_test_replication".sl_path p
--   where exists (select * from "_test_replication".sl_subscribe s where
--                          (s.sub_provider = p.pa_server or s.sub_receiver = p.pa_server) and
--                          sub_active = 't')
   group by pa_server, pa_conninfo;


Tests for node 1 - DSN = dbname=SEE host=192.168.1.111 user=slony
========================================
pg_listener info:
Pages: 0
Tuples: 0

Size Tests
================================================
       sl_log_1         0  0.000000
       sl_log_2         0  0.000000
      sl_seqlog         8 253.000000

Listen Path Analysis
===================================================
No problems found with sl_listen

--------------------------------------------------------------------------------
Summary of event info
 Origin  Min SYNC  Max SYNC Min SYNC Age Max SYNC Age
================================================================================
      2    297346    297603     00:25:00     02:48:00    0
      1    297421    297421     02:48:00     02:48:00    1


---------------------------------------------------------------------------------
Summary of sl_confirm aging
   Origin   Receiver   Min SYNC   Max SYNC  Age of latest SYNC  Age of eldest SYNC
=================================================================================
        1          2     297421     297421      02:48:00      02:48:00    1
        2          1     297346     297346      02:48:00      02:48:00    1


------------------------------------------------------------------------------

Listing of old open connections
       Database             PID            User    Query Age                Query
================================================================================


Tests for node 2 - DSN = dbname=SEE_REP host=192.168.1.111 user=slony
========================================
pg_listener info:
Pages: 0
Tuples: 0

Size Tests
================================================
       sl_log_1         0  0.000000
       sl_log_2         0  0.000000
      sl_seqlog         8 253.000000

Listen Path Analysis
===================================================
No problems found with sl_listen

--------------------------------------------------------------------------------
Summary of event info
 Origin  Min SYNC  Max SYNC Min SYNC Age Max SYNC Age
================================================================================
      2    297346    297603     00:25:00     02:48:00    0
      1    297421    297421     02:48:00     02:48:00    1


---------------------------------------------------------------------------------
Summary of sl_confirm aging
   Origin   Receiver   Min SYNC   Max SYNC  Age of latest SYNC  Age of eldest SYNC
=================================================================================
        1          2     297421     297421      02:48:00      02:48:00    1
        2          1     297346     297346      02:48:00      02:48:00    1


------------------------------------------------------------------------------

Listing of old open connections
       Database             PID            User    Query Age                Query
================================================================================



      
From jpfletch at ca.afilias.info  Tue Sep 16 12:21:14 2008
From: jpfletch at ca.afilias.info (JP Fletcher)
Date: Tue Sep 16 12:17:23 2008
Subject: [Slony1-general] testmultiplemoves testcase fails
Message-ID: <48D0072A.2020500@ca.afilias.info>

Hi,

I've just compiled v 1.2.15 with pg 8.1.13, and found that the testcase 
'testmultiplemoves' fails about 50% of the time.

The subscription of node2 to set 2 eventually times out when it doesn't 
get a confirmation from node 3.

./run_test.sh: ERROR: Slonik error see 
/tmp/slony-regress.xbeqaimyk/slonik.log for details
pgdba@ydb1.int.libertyrms.com:/opt/rg/data_dba/src/slony1-1.2.15/tests $ 
cat /tmp/slony-regress.xbeqaimyk/slonik.log
<stdin>:25: timeout exceeded while waiting for event confirmation

slonyregress3=# SELECT * from _slony_regress1.sl_event where ev_type <> 
'SYNC' order by ev_seqno desc limit 1;
 ev_origin | ev_seqno |       ev_timestamp        | ev_minxid | 
ev_maxxid | ev_xip |       ev_type       | ev_data1 | ev_data2 | 
ev_data3 | ev_data4 | ev_data5 | ev_data6 | ev_data7 | ev_data8
-----------+----------+---------------------------+-----------+-----------+--------+---------------------+----------+----------+----------+----------+----------+----------+----------+----------
         1 |       26 | 2008-09-16 19:02:24.31597 | 97730     | 
97731     |        | ENABLE_SUBSCRIPTION | 2        | 1        | 
2        | t        |          |          |          |
(1 row)


This is caused by the presence of an '<IDLE IN TRANSACTION>' connection 
on node 3 that is holding an AccessExclusiveLock on sl_config_lock:

slonyregress3=# SELECT * from pg_locks where not granted;
 locktype | database | relation | page | tuple | transactionid | classid 
| objid | objsubid | transaction |  pid   |        mode         | granted
----------+----------+----------+------+-------+---------------+---------+-------+----------+-------------+--------+---------------------+---------
 relation |    29184 |    30112 |      |       |               |         
|       |          |       98030 | 979420 | AccessExclusiveLock | f
(1 row)

slonyregress3=# SELECT relname from pg_class where oid = 30112;
    relname    
----------------
 sl_config_lock
(1 row)

slonyregress3=# SELECT * from pg_stat_activity where procpid = (SELECT 
pid from pg_locks where not granted);
 datid |    datname    | procpid | usesysid | usename 
|                                                 
current_query                                                  
|          query_start          |         backend_start         | 
client_addr | client_port
-------+---------------+---------+----------+---------+----------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------+-------------+-------------
 29184 | slonyregress3 |  979420 |       10 | pgdba   | begin 
transaction; set transaction isolation level serializable; lock table 
"_slony_regress1".sl_config_lock;  | 2008-09-16 19:02:37.567212+00 | 
2008-09-16 19:01:23.220162+00 | 127.0.0.1   |       57649
(1 row)

slonyregress3=# SELECT * from pg_locks where relation = 30112 and granted; 
locktype | database | relation | page | tuple | transactionid | classid 
| objid | objsubid | transaction |  pid   |        mode         | granted
----------+----------+----------+------+-------+---------------+---------+-------+----------+-------------+--------+---------------------+---------
 relation |    29184 |    30112 |      |       |               |         
|       |          |       98029 | 950632 | AccessExclusiveLock | t
(1 row)

slonyregress3=# SELECT * from pg_stat_activity where procpid = 950632;
 datid |    datname    | procpid | usesysid | usename |     
current_query     |          query_start          |         
backend_start         | client_addr | client_port
-------+---------------+---------+----------+---------+-----------------------+-------------------------------+-------------------------------+-------------+-------------
 29184 | slonyregress3 |  950632 |       10 | pgdba   | <IDLE> in 
transaction | 2008-09-16 19:02:37.568543+00 | 2008-09-16 
19:01:23.201131+00 | 127.0.0.1   |       57644
(1 row)

Killing the '<IDLE IN TRANSACTION>' connection makes the problem go 
away.  What's going on here?


-- 
JP Fletcher
Database Administrator
Afilias Canada
voice: 416.646.3304 ext. 4123
fax: 416.646.3305
mobile: 416.561.4763
jpfletch@ca.afilias.info


From peter.geoghegan86 at gmail.com  Tue Sep 16 13:16:46 2008
From: peter.geoghegan86 at gmail.com (Peter Geoghegan)
Date: Tue Sep 16 13:17:00 2008
Subject: [Slony1-general] Replication works for a short while on windows XP,
	then breaks on restart
Message-ID: <db471ace0809161316g1dc8dc51o50c9143a7bf4df8@mail.gmail.com>

Hello,

I'm attempting to produce a Slony-I cluster, with a windows XP master
and single Linux slave. Though it's probably not relevant, for this
test run I'm using virtual machines. I have methodically followed the
example in the PgAdminIII documentation, leaving all my slon engines
on the windows XP master as the Slony-I service. Everything works
fine, until I restart the master machine. Replication breaks.
Repeatedly restarting the Slony-I service has no discernible effect.
Because these are virtual machines, I have been able to revert them to
an earlier state and reproduce this repeatedly ? first it works, then
it breaks.

I'm using the distribution of Slony that comes with the postgreSQL
stack builder ? v1.2.14.

What should I do to fix the problem?

Thanks,
Peter
From JanWieck at Yahoo.com  Tue Sep 16 13:40:02 2008
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Tue Sep 16 13:36:38 2008
Subject: [Slony1-general] error subscribing to set
In-Reply-To: <273718db0809161105x17f1a543ya9b336a9afef672d@mail.gmail.com>
References: <273718db0809161105x17f1a543ya9b336a9afef672d@mail.gmail.com>
Message-ID: <48D019A2.2010808@Yahoo.com>

On 9/16/2008 2:05 PM, Dean Liu wrote:
> Hello all,
> 
> I am following this guide to set up a simple master - slave
> relationship between two postgres databases:
> http://www.onlamp.com/pub/a/onlamp/2004/12/16/slony_install.html
> 
> The only main differences is that I'm using two VMs instead of using
> two different postgres instances listening on different ports.
> 
> Everything is working great except that it seems when I attempt to
> issue the subscribe set command I get an error:  "insert or update on
> table "sl_path" violates foreign key constraint "pa_client-no_id-ref".
> DETAIL: Key (pa_client)=(2) is not present on table "s1_node".

This happens if you forget to start the two slon processes after doing 
the STORE PATH slonik commands. The two STORE_PATH events need to 
replicate before you can actually issue the SUBSCRIBE.


Jan

-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin

From JanWieck at Yahoo.com  Tue Sep 16 13:43:30 2008
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Tue Sep 16 13:43:36 2008
Subject: [Slony1-general] testmultiplemoves testcase fails
In-Reply-To: <48D0072A.2020500@ca.afilias.info>
References: <48D0072A.2020500@ca.afilias.info>
Message-ID: <48D01A72.1060507@Yahoo.com>

On 9/16/2008 3:21 PM, JP Fletcher wrote:
> Hi,
> 
> I've just compiled v 1.2.15 with pg 8.1.13, and found that the testcase 
> 'testmultiplemoves' fails about 50% of the time.

Such test should not have a timeout on wait for event. Unfortunately, 
the wait for event has a default timeout, so one has to explicitly 
specify timeout = 0.


Jan

> 
> The subscription of node2 to set 2 eventually times out when it doesn't 
> get a confirmation from node 3.
> 
> ./run_test.sh: ERROR: Slonik error see 
> /tmp/slony-regress.xbeqaimyk/slonik.log for details
> pgdba@ydb1.int.libertyrms.com:/opt/rg/data_dba/src/slony1-1.2.15/tests $ 
> cat /tmp/slony-regress.xbeqaimyk/slonik.log
> <stdin>:25: timeout exceeded while waiting for event confirmation
> 
> slonyregress3=# SELECT * from _slony_regress1.sl_event where ev_type <> 
> 'SYNC' order by ev_seqno desc limit 1;
>  ev_origin | ev_seqno |       ev_timestamp        | ev_minxid | 
> ev_maxxid | ev_xip |       ev_type       | ev_data1 | ev_data2 | 
> ev_data3 | ev_data4 | ev_data5 | ev_data6 | ev_data7 | ev_data8
> -----------+----------+---------------------------+-----------+-----------+--------+---------------------+----------+----------+----------+----------+----------+----------+----------+----------
>          1 |       26 | 2008-09-16 19:02:24.31597 | 97730     | 
> 97731     |        | ENABLE_SUBSCRIPTION | 2        | 1        | 
> 2        | t        |          |          |          |
> (1 row)
> 
> 
> This is caused by the presence of an '<IDLE IN TRANSACTION>' connection 
> on node 3 that is holding an AccessExclusiveLock on sl_config_lock:
> 
> slonyregress3=# SELECT * from pg_locks where not granted;
>  locktype | database | relation | page | tuple | transactionid | classid 
> | objid | objsubid | transaction |  pid   |        mode         | granted
> ----------+----------+----------+------+-------+---------------+---------+-------+----------+-------------+--------+---------------------+---------
>  relation |    29184 |    30112 |      |       |               |         
> |       |          |       98030 | 979420 | AccessExclusiveLock | f
> (1 row)
> 
> slonyregress3=# SELECT relname from pg_class where oid = 30112;
>     relname    
> ----------------
>  sl_config_lock
> (1 row)
> 
> slonyregress3=# SELECT * from pg_stat_activity where procpid = (SELECT 
> pid from pg_locks where not granted);
>  datid |    datname    | procpid | usesysid | usename 
> |                                                 
> current_query                                                  
> |          query_start          |         backend_start         | 
> client_addr | client_port
> -------+---------------+---------+----------+---------+----------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------+-------------+-------------
>  29184 | slonyregress3 |  979420 |       10 | pgdba   | begin 
> transaction; set transaction isolation level serializable; lock table 
> "_slony_regress1".sl_config_lock;  | 2008-09-16 19:02:37.567212+00 | 
> 2008-09-16 19:01:23.220162+00 | 127.0.0.1   |       57649
> (1 row)
> 
> slonyregress3=# SELECT * from pg_locks where relation = 30112 and granted; 
> locktype | database | relation | page | tuple | transactionid | classid 
> | objid | objsubid | transaction |  pid   |        mode         | granted
> ----------+----------+----------+------+-------+---------------+---------+-------+----------+-------------+--------+---------------------+---------
>  relation |    29184 |    30112 |      |       |               |         
> |       |          |       98029 | 950632 | AccessExclusiveLock | t
> (1 row)
> 
> slonyregress3=# SELECT * from pg_stat_activity where procpid = 950632;
>  datid |    datname    | procpid | usesysid | usename |     
> current_query     |          query_start          |         
> backend_start         | client_addr | client_port
> -------+---------------+---------+----------+---------+-----------------------+-------------------------------+-------------------------------+-------------+-------------
>  29184 | slonyregress3 |  950632 |       10 | pgdba   | <IDLE> in 
> transaction | 2008-09-16 19:02:37.568543+00 | 2008-09-16 
> 19:01:23.201131+00 | 127.0.0.1   |       57644
> (1 row)
> 
> Killing the '<IDLE IN TRANSACTION>' connection makes the problem go 
> away.  What's going on here?
> 
> 


-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin

From JanWieck at Yahoo.com  Tue Sep 16 13:45:44 2008
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Tue Sep 16 13:48:38 2008
Subject: [Slony1-general] Restore a node after pg_dump
In-Reply-To: <175825.52308.qm@web25804.mail.ukl.yahoo.com>
References: <175825.52308.qm@web25804.mail.ukl.yahoo.com>
Message-ID: <48D01AF8.5040000@Yahoo.com>

On 9/16/2008 2:25 PM, Glyn Astill wrote:
> Hi Chaps,
> 
> I've got a test setup with slony replicating two databases on the same postgres instance, e.g. I've a table "price" in database SEE and SEE_REP on the same host and I'm replicating it with slony from SEE to SEE_REP.
> 
> What I've tried to do is pg_dumpall then re-initdb the server, reload the dump back in and then run REPAIR CONFIG.

It is well documented that you cannot use pg_dump to retrieve the schema 
of a subscriber. pg_dumpall uses pg_dump underneath to create combined 
schema+data dumps of all databases. This only works with Slony 2.0.


Jan

-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin

From JanWieck at Yahoo.com  Tue Sep 16 14:07:11 2008
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Tue Sep 16 14:05:44 2008
Subject: [Slony1-general] Replication works for a short while on windows
	XP,	then breaks on restart
In-Reply-To: <db471ace0809161316g1dc8dc51o50c9143a7bf4df8@mail.gmail.com>
References: <db471ace0809161316g1dc8dc51o50c9143a7bf4df8@mail.gmail.com>
Message-ID: <48D01FFF.8010405@Yahoo.com>

On 9/16/2008 4:16 PM, Peter Geoghegan wrote:
> Hello,
> 
> I'm attempting to produce a Slony-I cluster, with a windows XP master
> and single Linux slave. Though it's probably not relevant, for this
> test run I'm using virtual machines. I have methodically followed the
> example in the PgAdminIII documentation, leaving all my slon engines
> on the windows XP master as the Slony-I service. Everything works
> fine, until I restart the master machine. Replication breaks.
> Repeatedly restarting the Slony-I service has no discernible effect.
> Because these are virtual machines, I have been able to revert them to
> an earlier state and reproduce this repeatedly ? first it works, then
> it breaks.
> 
> I'm using the distribution of Slony that comes with the postgreSQL
> stack builder ? v1.2.14.
> 
> What should I do to fix the problem?

Are there any error messages that could give us a clue as to what goes 
wrong?


Jan

-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin

From cbbrowne at ca.afilias.info  Tue Sep 16 15:14:59 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Tue Sep 16 15:15:17 2008
Subject: [Slony1-general] error subscribing to set
In-Reply-To: <273718db0809161105x17f1a543ya9b336a9afef672d@mail.gmail.com>
	(Dean Liu's message of "Tue, 16 Sep 2008 11:05:29 -0700")
References: <273718db0809161105x17f1a543ya9b336a9afef672d@mail.gmail.com>
Message-ID: <87iqsvwxek.fsf@dba2.int.libertyrms.com>

"Dean Liu" <deanliu@gmail.com> writes:
> Hello all,
>
> I am following this guide to set up a simple master - slave
> relationship between two postgres databases:
> http://www.onlamp.com/pub/a/onlamp/2004/12/16/slony_install.html
>
> The only main differences is that I'm using two VMs instead of using
> two different postgres instances listening on different ports.
>
> Everything is working great except that it seems when I attempt to
> issue the subscribe set command I get an error:  "insert or update on
> table "sl_path" violates foreign key constraint "pa_client-no_id-ref".
> DETAIL: Key (pa_client)=(2) is not present on table "s1_node".
>
> Any ideas?  I apologize if this has been answered before - I attempted
> to scour google for answers and apparently a few have come across the
> same problem however have received no answers.
>
> Please let me know if you need any more information.

That adds a new message to loganalysis.sgml...

The problem is that the node isn't aware of the would-be subscriber.

Chances are that a STORE PATH request has not made it through.  Why is
not quite clear...

Take a look at sl_node, on both nodes, and sl_path, on both nodes.  I
think you'll find a difference between them.

Strong suggestion #1: Run test_slony_state.pl (if you prefer to use
the Perl "Pg" module) or run_test_slony_state-dbi.pl (if you prefer
Perl DBI).

   http://www.slony.info/documentation/monitoring.html

When you point the test script at one of the nodes, it'll try to look
up all of the nodes, and looks for problems, and reports findings.
Those findings are quite likely to be useful in diagnosing what is
going on.

Suggestion #2: Take a look at the logs for both slon processes; any
errors that they are reporting should be helpful in figuring out
what's going wrong.
-- 
"cbbrowne","@","cbbrowne.com"
http://www3.sympatico.ca/cbbrowne/wp.html
To err is human, to moo bovine. 
From thawes at novadine.com  Tue Sep 16 21:20:49 2008
From: thawes at novadine.com (Tim Hawes)
Date: Tue Sep 16 21:21:11 2008
Subject: [Slony1-general] db_getLocalNodeId
In-Reply-To: <48CFD11C.4050401@Yahoo.com>
References: <48CF9838.805@novadine.com> <48CFD11C.4050401@Yahoo.com>
Message-ID: <48D085A1.6070604@novadine.com>

Jan Wieck wrote:
> On 9/16/2008 7:27 AM, Tim Hawes wrote:
>> I have successfully got a slony cluster started with 3 nodes now. I 
>> tried adding 4 new nodes and have been getting this error.
>>
>> ERROR  remoteListenThread_1: db_getLocalNodeId() returned 11 - wrong 
>> database?
>
> The path from that node TO node 1 is actually pointing at node 11. 
> Check all sl_path entries with server=1 and run a corrected STORE PATH.
>
>
> Jan
>
Thanks Jan. As it turned out the store path I had used all had the 
address for node 11 in it. I corrected the host data in conninfo 
appropriately in each store path command and reran my script. 
Replication started immediately on the new nodes.
From glynastill at yahoo.co.uk  Wed Sep 17 01:17:34 2008
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Wed Sep 17 01:18:01 2008
Subject: [Slony1-general] Restore a node after pg_dump
In-Reply-To: <48D01AF8.5040000@Yahoo.com>
Message-ID: <482213.26105.qm@web25802.mail.ukl.yahoo.com>

> 
> It is well documented that you cannot use pg_dump to
> retrieve the schema 
> of a subscriber. pg_dumpall uses pg_dump underneath to
> create combined 
> schema+data dumps of all databases. This only works with
> Slony 2.0.
> 
> 

Thanks for clearing that up Jan.

I was aware of that, however I discovered REPAIR CONFIG some time after I'd initially read that you couldn't restore pg_dump and that's obviously confused me to think that REPAIR CONFIG could work some sort of magic.



      
From moretto.andrea at gmail.com  Wed Sep 17 01:40:39 2008
From: moretto.andrea at gmail.com (Andrea Moretto)
Date: Wed Sep 17 01:41:11 2008
Subject: [Slony1-general] Pgpool-II and Slony-I : query lag,
	sequences and stored procedures need help
Message-ID: <0F2EFE7C-053D-4892-BB43-E6279451A107@gmail.com>

Hello there!

I am currently evaluating the best solution for a high-availability,  
load balanced cluster.
Currently I am testing this environment : postgres 8.3.1, pgpool-II  
2.1, Slony-I 1.2.14.
I've setup a master server to replicate all tables with Slony-I to a  
slave, and a frontend with pgpool
that load-balances the queries (load_balance=true,  
replication_mode=false, parallel_query=false,
enable_query_cache=false).

There is a problem : a stored procedure that returns a sequence value  
(a global unique ID, used as primary key in INSERTs)
returns the same values in successive calls, under certain conditions.  
This is clearly due to the replication lag led by Slony-I.
I would call it a race condition.

Now the question : is there a way to force pgpool to redirect all  
queries that involves a specific sequence or a stored procedure
to a specific backend? I tried to setup query partitioning, but only  
tables are supported so far.

I know that all queries belonging to a single transaction should be  
redirected to the same backend, but I would like to
find out a solution working on the backend, avoiding to check a huge  
amount of code that works. ;)
I also know that using the pgpool replication mode will solve the  
issue, but it can lead to downtime when adding new backends,
since a synch operation is required. Slony-I implement replication in  
a more suitable way from this point of view.

I do not use autoincrement or serial primary key because the  
application AS IS doesn't use it.

For the sake of clarity I write down the stored procedure and the  
sequence instantiation code:

-- begin code excerpt

CREATE SEQUENCE numgen
INCREMENT 1
MINVALUE 1
MAXVALUE 9223372036854775807
START 165024182
CACHE 1;
ALTER TABLE numgen OWNER TO root;

CREATE OR REPLACE FUNCTION pr_next_id(OUT next_number character varying)
RETURNS character varying AS
$BODY$
declare  myyear char(4);
declare  ii integer;
declare  tmp1 varchar(10);
declare  tmp2 char(10);
BEGIN
   MYYEAR = CAST(EXTRACT(YEAR FROM LOCALTIMESTAMP) AS CHAR(4));
   select CAST(nextval('NUMGEN') AS varchar(10)) into TMP1;
   TMP2 = '0000000000';
   II = length(TMP1);
   NEXT_NUMBER = SSUBSTR(MYYEAR,3,4) || SSUBSTR(TMP2,1,10 - II) || TMP1;
END;
$BODY$
LANGUAGE 'plpgsql' VOLATILE
COST 100;
ALTER FUNCTION pr_next_id() OWNER TO root;

-- end code excerpt
The pr_next_id returns the following values when called on the top of  
pgpool repeatedly (WRONG RESULT):

080165024184
080165024185
080165024184  [DUPLICATED VALUE]
080165024185  [DUPLICATED VALUE]
080165024186
080165024187
080165024188

If I call the pr_next_id repeatedly directly on the postgres engine, I  
get the following (CORRECT RESULT):

080165024112
080165024113
080165024114
080165024115
080165024116
080165024117
080165024118
080165024119
080165024120

Even this post could be off topic here, I think that some people could  
have same needs as mine. I already posted in the pgpool mailing
list, but so far no answer.

Thanks in advance!

Regards,

Andrea Moretto


Andrea Moretto
moretto.andrea@gmail.com
-------------------------------------------------------
CONFIDENTIALITY NOTICE
This message and its attachments are addressed solely to the persons
above and may contain confidential information. If you have received
the message in error, be informed that any use of the content hereof
is prohibited. Please return it immediately to the sender and delete
the message.
-------------------------------------------------------

From ahodgson at simkin.ca  Wed Sep 17 09:37:31 2008
From: ahodgson at simkin.ca (Alan Hodgson)
Date: Wed Sep 17 09:38:57 2008
Subject: [Slony1-general] Restore a node after pg_dump
In-Reply-To: <482213.26105.qm@web25802.mail.ukl.yahoo.com>
References: <482213.26105.qm@web25802.mail.ukl.yahoo.com>
Message-ID: <200809170937.31315@hal.medialogik.com>

On Wednesday 17 September 2008, Glyn Astill <glynastill@yahoo.co.uk> wrote:
> > It is well documented that you cannot use pg_dump to
> > retrieve the schema
> > of a subscriber. pg_dumpall uses pg_dump underneath to
> > create combined
> > schema+data dumps of all databases. This only works with
> > Slony 2.0.
>
> Thanks for clearing that up Jan.
>
> I was aware of that, however I discovered REPAIR CONFIG some time after
> I'd initially read that you couldn't restore pg_dump and that's obviously
> confused me to think that REPAIR CONFIG could work some sort of magic.

You can dump a subscriber node, but you have to take it offline and kludge 
the Slony stuff first (altertablerestore on all tables). And then repair 
the config after the restore (altertableforreplication and get the new 
table and sequence OIDs into the slony tables).

I've done it, and it's moderately faster than rebuilding replication on a 
new node, but it's a lot of stuff that has to be done right.

-- 
Alan
From jpfletch at ca.afilias.info  Wed Sep 17 09:44:26 2008
From: jpfletch at ca.afilias.info (JP Fletcher)
Date: Wed Sep 17 09:40:28 2008
Subject: [Slony1-general] testmultiplemoves testcase fails
In-Reply-To: <48D01A72.1060507@Yahoo.com>
References: <48D0072A.2020500@ca.afilias.info> <48D01A72.1060507@Yahoo.com>
Message-ID: <48D133EA.8040403@ca.afilias.info>

Jan Wieck wrote:
> On 9/16/2008 3:21 PM, JP Fletcher wrote:
>> Hi,
>>
>> I've just compiled v 1.2.15 with pg 8.1.13, and found that the 
>> testcase 'testmultiplemoves' fails about 50% of the time.
>
> Such test should not have a timeout on wait for event. Unfortunately, 
> the wait for event has a default timeout, so one has to explicitly 
> specify timeout = 0.
Probably there shouldn't be a timeout, but i'm a bit confused as to why 
an '<IDLE IN TRANSACTION>' connection appears on the third node.  I 
reproduced the case, and found that the offending connection did the 
following, prior to becoming '<IDLE IN TRANSACTION>':

2008-09-17 16:11:52.804 UTC [672172] [unknown] [unknown] LOG:  
connection received: host=127.0.0.1 port=60694
2008-09-17 16:11:52.805 UTC [672172] slonyregress3 pgdba 127.0.0.1LOG:  
connection authorized: user=pgdba database=slonyregress3
2008-09-17 16:11:52.815 UTC [672172] slonyregress3 pgdba 127.0.0.1LOG:  
statement: set datestyle to 'ISO'
2008-09-17 16:11:52.818 UTC [672172] slonyregress3 pgdba 127.0.0.1LOG:  
statement: SELECT version();
2008-09-17 16:11:52.819 UTC [672172] slonyregress3 pgdba 127.0.0.1LOG:  
statement: set escape_string_warning to 'off'
2008-09-17 16:11:52.820 UTC [672172] slonyregress3 pgdba 127.0.0.1LOG:  
statement: select "_slony_regress1".setSessionRole('_slony_regress1', 
'slon');
2008-09-17 16:11:52.831 UTC [672172] slonyregress3 pgdba 127.0.0.1LOG:  
statement: begin transaction; set transaction isolation level 
serializable; lock table "_slony_regress1".sl_config_lock;
2008-09-17 16:11:52.832 UTC [672172] slonyregress3 pgdba 127.0.0.1LOG:  
statement: update "_slony_regress1".sl_archive_counter     set ac_num = 
ac_num + 1,         ac_timestamp = CURRENT_TIMESTAMP; select ac_num, 
ac_timestamp from "_slony_regress1".sl_archive_counter;

I've seen the following messages in slon logs, seemingly related:

slon_log.3:2008-09-17 16:11:52 UTC WARN   serialization problem updating 
sl_archive_counter: restarting slon

>
>
> Jan
>
>>
>> The subscription of node2 to set 2 eventually times out when it 
>> doesn't get a confirmation from node 3.
>>
>> ./run_test.sh: ERROR: Slonik error see 
>> /tmp/slony-regress.xbeqaimyk/slonik.log for details
>> pgdba@ydb1.int.libertyrms.com:/opt/rg/data_dba/src/slony1-1.2.15/tests 
>> $ cat /tmp/slony-regress.xbeqaimyk/slonik.log
>> <stdin>:25: timeout exceeded while waiting for event confirmation
>>
>> slonyregress3=# SELECT * from _slony_regress1.sl_event where ev_type 
>> <> 'SYNC' order by ev_seqno desc limit 1;
>>  ev_origin | ev_seqno |       ev_timestamp        | ev_minxid | 
>> ev_maxxid | ev_xip |       ev_type       | ev_data1 | ev_data2 | 
>> ev_data3 | ev_data4 | ev_data5 | ev_data6 | ev_data7 | ev_data8
>> -----------+----------+---------------------------+-----------+-----------+--------+---------------------+----------+----------+----------+----------+----------+----------+----------+---------- 
>>
>>          1 |       26 | 2008-09-16 19:02:24.31597 | 97730     | 
>> 97731     |        | ENABLE_SUBSCRIPTION | 2        | 1        | 
>> 2        | t        |          |          |          |
>> (1 row)
>>
>>
>> This is caused by the presence of an '<IDLE IN TRANSACTION>' 
>> connection on node 3 that is holding an AccessExclusiveLock on 
>> sl_config_lock:
>>
>> slonyregress3=# SELECT * from pg_locks where not granted;
>>  locktype | database | relation | page | tuple | transactionid | 
>> classid | objid | objsubid | transaction |  pid   |        
>> mode         | granted
>> ----------+----------+----------+------+-------+---------------+---------+-------+----------+-------------+--------+---------------------+--------- 
>>
>>  relation |    29184 |    30112 |      |       |               
>> |         |       |          |       98030 | 979420 | 
>> AccessExclusiveLock | f
>> (1 row)
>>
>> slonyregress3=# SELECT relname from pg_class where oid = 30112;
>>     relname    ----------------
>>  sl_config_lock
>> (1 row)
>>
>> slonyregress3=# SELECT * from pg_stat_activity where procpid = 
>> (SELECT pid from pg_locks where not granted);
>>  datid |    datname    | procpid | usesysid | usename 
>> |                                                 
>> current_query                                                  
>> |          query_start          |         backend_start         | 
>> client_addr | client_port
>> -------+---------------+---------+----------+---------+----------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------+-------------+------------- 
>>
>>  29184 | slonyregress3 |  979420 |       10 | pgdba   | begin 
>> transaction; set transaction isolation level serializable; lock table 
>> "_slony_regress1".sl_config_lock;  | 2008-09-16 19:02:37.567212+00 | 
>> 2008-09-16 19:01:23.220162+00 | 127.0.0.1   |       57649
>> (1 row)
>>
>> slonyregress3=# SELECT * from pg_locks where relation = 30112 and 
>> granted; locktype | database | relation | page | tuple | 
>> transactionid | classid | objid | objsubid | transaction |  pid   
>> |        mode         | granted
>> ----------+----------+----------+------+-------+---------------+---------+-------+----------+-------------+--------+---------------------+--------- 
>>
>>  relation |    29184 |    30112 |      |       |               
>> |         |       |          |       98029 | 950632 | 
>> AccessExclusiveLock | t
>> (1 row)
>>
>> slonyregress3=# SELECT * from pg_stat_activity where procpid = 950632;
>>  datid |    datname    | procpid | usesysid | usename |     
>> current_query     |          query_start          |         
>> backend_start         | client_addr | client_port
>> -------+---------------+---------+----------+---------+-----------------------+-------------------------------+-------------------------------+-------------+------------- 
>>
>>  29184 | slonyregress3 |  950632 |       10 | pgdba   | <IDLE> in 
>> transaction | 2008-09-16 19:02:37.568543+00 | 2008-09-16 
>> 19:01:23.201131+00 | 127.0.0.1   |       57644
>> (1 row)
>>
>> Killing the '<IDLE IN TRANSACTION>' connection makes the problem go 
>> away.  What's going on here?
>>
>>
>
>


-- 
JP Fletcher
Database Administrator
Afilias Canada
voice: 416.646.3304 ext. 4123
fax: 416.646.3305
mobile: 416.561.4763
jpfletch@ca.afilias.info


From JanWieck at Yahoo.com  Wed Sep 17 11:36:07 2008
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Wed Sep 17 11:36:34 2008
Subject: [Slony1-general] Restore a node after pg_dump
In-Reply-To: <200809170937.31315@hal.medialogik.com>
References: <482213.26105.qm@web25802.mail.ukl.yahoo.com>
	<200809170937.31315@hal.medialogik.com>
Message-ID: <48D14E17.8040305@Yahoo.com>

On 9/17/2008 12:37 PM, Alan Hodgson wrote:
> On Wednesday 17 September 2008, Glyn Astill <glynastill@yahoo.co.uk> wrote:
>> > It is well documented that you cannot use pg_dump to
>> > retrieve the schema
>> > of a subscriber. pg_dumpall uses pg_dump underneath to
>> > create combined
>> > schema+data dumps of all databases. This only works with
>> > Slony 2.0.
>>
>> Thanks for clearing that up Jan.
>>
>> I was aware of that, however I discovered REPAIR CONFIG some time after
>> I'd initially read that you couldn't restore pg_dump and that's obviously
>> confused me to think that REPAIR CONFIG could work some sort of magic.
> 
> You can dump a subscriber node, but you have to take it offline and kludge 
> the Slony stuff first (altertablerestore on all tables). And then repair 
> the config after the restore (altertableforreplication and get the new 
> table and sequence OIDs into the slony tables).
> 
> I've done it, and it's moderately faster than rebuilding replication on a 
> new node, but it's a lot of stuff that has to be done right.

Not only that. If the node had replicated further after the dump was 
taken, it is possible that confirmed SYNC events caused the data 
provider to purge logs and then it would miss updates.


Jan

-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin
From ahodgson at simkin.ca  Wed Sep 17 13:07:14 2008
From: ahodgson at simkin.ca (Alan Hodgson)
Date: Wed Sep 17 13:07:38 2008
Subject: [Slony1-general] Restore a node after pg_dump
In-Reply-To: <48D14E17.8040305@Yahoo.com>
References: <482213.26105.qm@web25802.mail.ukl.yahoo.com>
	<200809170937.31315@hal.medialogik.com>
	<48D14E17.8040305@Yahoo.com>
Message-ID: <200809171307.14698@hal.medialogik.com>

On Wednesday 17 September 2008, Jan Wieck <JanWieck@yahoo.com> wrote:
> Not only that. If the node had replicated further after the dump was
> taken, it is possible that confirmed SYNC events caused the data
> provider to purge logs and then it would miss updates.

I did say take it offline first ...


-- 
Alan
From dknight at wsi.com  Thu Sep 18 11:55:17 2008
From: dknight at wsi.com (Knight, Doug)
Date: Thu Sep 18 11:55:32 2008
Subject: [Slony1-general] Recommenation against sequence only replication
	sets
In-Reply-To: <20080917190003.F2DAB290EEB@main.slony.info>
References: <20080917190003.F2DAB290EEB@main.slony.info>
Message-ID: <8536F69C1FCC294B859D07B179F069440F8FAD7A@EXCHANGE.ad.wsicorp.com>

All,
I am in the process of configuring Slony-I 1.2.14 on a CentOS 5.2
cluster, and ran across the mention in the documentation (Section 7.3,
The Pathology of Sequences) against having a replication set consisting
of just sequences. Clicking the link to Bug #1226 brings me to the home
page of the Slony-I site, with no further explanation. Looking at the
FAQ, section 5.5 the bug is mentioned again, with a note that it "should
be resolved some time after Slony-I 1.1.0". So first, what exactly is
the bug, and second does this bug still exist in 1.2.14?

Thanks,
Doug Knight
WSI Corp

From lukas at fmf.vtu.lt  Fri Sep 19 00:55:23 2008
From: lukas at fmf.vtu.lt (Lukas)
Date: Fri Sep 19 00:57:59 2008
Subject: [Slony1-general] Slony 2.0
Message-ID: <2060.78.60.0.163.1221810923.squirrel@fmf.vtu.lt>

Hello,

 I would like to ask is Slony 2.0 version stable and ready to put in
production, or it is better to use more tested and older version 1.2.x?

 Also, in Slony 2.0 something changed with slonik scripts:
Various instances where slonik would use a default node ID of 1 have been
changed to remove this.

Slonik scripts may need to be changed to indicate an EVENT NODE (or
similar) after migration to v2.0 as a result.

The slonik commands involved:

    * STORE NODE - EVENT NODE
    * DROP NODE - EVENT NODE
    * WAIT FOR EVENT - WAIT ON
    * FAILOVER - BACKUP NODE
    * EXECUTE SCRIPT - EVENT NODE

Can anybody comment how in Slony 2.0 use command store node? If I use it
as in 1.2.x I get error:
Error: require EVENT NODE
Error: No admin conninfo provided for node -1

thx
Lukas



-- 
This message has been scanned for viruses and
dangerous content by OpenProtect(http://www.openprotect.com), and is
believed to be clean.

From ajs at crankycanuck.ca  Fri Sep 19 06:26:00 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Fri Sep 19 06:26:06 2008
Subject: [Slony1-general] Slony 2.0
In-Reply-To: <2060.78.60.0.163.1221810923.squirrel@fmf.vtu.lt>
References: <2060.78.60.0.163.1221810923.squirrel@fmf.vtu.lt>
Message-ID: <20080919132600.GC2226@crankycanuck.ca>

On Fri, Sep 19, 2008 at 10:55:23AM +0300, Lukas wrote:
> Hello,
> 
>  I would like to ask is Slony 2.0 version stable and ready to put in
> production, or it is better to use more tested and older version 1.2.x?

Well, Slony 2.0 has a bunch of new features.  I don't think I will
personally be in a big hurry to put it to production -- the project's
history isn't great with .0 releases.
 
>  Also, in Slony 2.0 something changed with slonik scripts:
> Various instances where slonik would use a default node ID of 1 have been
> changed to remove this.

Yes.

> Can anybody comment how in Slony 2.0 use command store node? If I use it
> as in 1.2.x I get error:
> Error: require EVENT NODE
> Error: No admin conninfo provided for node -1

Add an explicit event node.

A

-- 
Andrew Sullivan
ajs@commandprompt.com
+1 503 667 4564 x104
http://www.commandprompt.com/
From glynastill at yahoo.co.uk  Fri Sep 19 06:48:36 2008
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Fri Sep 19 06:48:42 2008
Subject: [Slony1-general] Slony 2.0
In-Reply-To: <20080919132600.GC2226@crankycanuck.ca>
Message-ID: <906641.8380.qm@web25803.mail.ukl.yahoo.com>

> From: Andrew Sullivan <ajs@crankycanuck.ca>
> > 
> >  I would like to ask is Slony 2.0 version stable and
> ready to put in
> > production, or it is better to use more tested and
> older version 1.2.x?
> 
> Well, Slony 2.0 has a bunch of new features.  I don't
> think I will
> personally be in a big hurry to put it to production

Similar feelings. 1.2.1x is working well here and I'm aware of most of it's quirks (well I say that, but I always feel the more I learn about something the more I realize I don't know).

But it's been one of my intentions for a while to grab 2.0 and have a "play", it sounds like once any teeting problems are discovered and weeded out it'll be ace.


      
From z-saito at guitar.ocn.ne.jp  Fri Sep 19 07:23:43 2008
From: z-saito at guitar.ocn.ne.jp (Hiroshi Saito)
Date: Fri Sep 19 07:23:51 2008
Subject: [Slony1-general] Slony 2.0 on windows(MinGW)
Message-ID: <009b01c91a63$52374c50$0d01a8c0@IBMC9A0F63B40D>

Hi.

Referring to the SessionReplicationRole had a problem.:-(
It seems that a relation is unsavory at include of PostgreSQL.
Then, It is avoidable by ad hoc patch....
However, Either is expected better solution. 
What do you think? 

Regards,
Hiroshi Saito

-------------- next part --------------
A non-text attachment was scrubbed...
Name: Slony2.0_win32_patch
Type: application/octet-stream
Size: 1723 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20080919/de313b8a/Slony2.obj
-------------- next part --------------
gcc -g -O2 -Wall -Wmissing-prototypes -Wmissing-declarations -I../..  -I/usr/local/pgsql/include -I/usr/local/pgsql/include/server  -I/usr/local/pgsql/include/server/port/win32  -c -o slony1_funcs.o slony1_funcs.c
sed -e 's;FILEDESC;"Slony replication functions";' -e 's;VFT_APP;VFT_APP;' -e 's;SLVERSION;SLONY_I_VERSION_STRING_DEC ,'`date '+%y%j' | sed 's/^0*//'`';' ../../src/slon/port/win32ver.rc.in > win32ver.rc
windres -i win32ver.rc -o win32ver.o --include-dir=../..
rm -f win32ver.rc
dlltool --export-all --output-def slony1_funcs.def slony1_funcs.o win32ver.o
dllwrap -o slony1_funcs.dll --def slony1_funcs.def slony1_funcs.o win32ver.o -L/usr/local/pgsql/lib -lpostgres 
Info: resolving _SessionReplicationRole by linking to __imp__SessionReplicationRole (auto-import)
C:\MinGW\bin\..\lib\gcc\mingw32\3.4.5\..\..\..\..\mingw32\bin\ld.exe: warning: auto-importing has been activated without --enable-auto-import specified on the command line.
This should work unless it involves constant data structures referencing symbols from auto-imported DLLs.fu000001.o:(.idata$2+0xc): undefined reference to `_libpostgres_a_iname'
fu000002.o:(.idata$2+0xc): undefined reference to `_libpostgres_a_iname'
fu000003.o:(.idata$2+0xc): undefined reference to `_libpostgres_a_iname'
nmth000000.o:(.idata$4+0x0): undefined reference to `__nm__SessionReplicationRole'
collect2: ld returned 1 exit status

From z-saito at guitar.ocn.ne.jp  Fri Sep 19 07:32:08 2008
From: z-saito at guitar.ocn.ne.jp (Hiroshi Saito)
Date: Fri Sep 19 07:32:16 2008
Subject: [Slony1-general] Re: Slony 2.0 on windows(MinGW)
References: <009b01c91a63$52374c50$0d01a8c0@IBMC9A0F63B40D>
	<48D3B762.5080106@hagander.net>
Message-ID: <00b901c91a64$7f5f3ed0$0d01a8c0@IBMC9A0F63B40D>

Hi.

Yes!:-)
However, whether it is a good method does not have clear it.

> Seems like the proper fix would be to add PGDLLIMPORT to the define in
> the PostgreSQL sources, no?
> 
> If you do that directly in those, does it also work?
> 
> //Magnus
>
From z-saito at guitar.ocn.ne.jp  Fri Sep 19 07:38:51 2008
From: z-saito at guitar.ocn.ne.jp (Hiroshi Saito)
Date: Fri Sep 19 07:38:59 2008
Subject: [Slony1-general] Re: Slony 2.0 on windows(MinGW)
References: <009b01c91a63$52374c50$0d01a8c0@IBMC9A0F63B40D>
	<48D3B762.5080106@hagander.net>
	<00b901c91a64$7f5f3ed0$0d01a8c0@IBMC9A0F63B40D>
	<48D3B8AA.9020109@hagander.net>
Message-ID: <00db01c91a65$6f47b800$0d01a8c0@IBMC9A0F63B40D>

Ok, Solution was left to you.:-)
Then, is it good? 

> Well, it's certainly the right thing to do - things that are supposed to
> be accessed externally on win32 should always be marked as PGDLLIMPORT.

From z-saito at guitar.ocn.ne.jp  Fri Sep 19 07:48:38 2008
From: z-saito at guitar.ocn.ne.jp (Hiroshi Saito)
Date: Fri Sep 19 07:48:46 2008
Subject: [Slony1-general] Re: Slony 2.0 on windows(MinGW)
References: <009b01c91a63$52374c50$0d01a8c0@IBMC9A0F63B40D>
	<48D3B762.5080106@hagander.net>
	<00b901c91a64$7f5f3ed0$0d01a8c0@IBMC9A0F63B40D>
	<48D3B8AA.9020109@hagander.net>
	<00db01c91a65$6f47b800$0d01a8c0@IBMC9A0F63B40D>
	<48D3BAB6.9060701@hagander.net>
Message-ID: <010601c91a66$cd0df480$0d01a8c0@IBMC9A0F63B40D>

----- Original Message ----- 
From: "Magnus Hagander" <magnus@hagander.net>


> Committed to the backend ;-) Unfortunately, it just missed the new release..

Ahh... However, Slony 2.0 is still the release candidate 1. And discussion will be helpful 
here.!
Anyway thanks!! 

From lukas at fmf.vtu.lt  Fri Sep 19 09:43:01 2008
From: lukas at fmf.vtu.lt (Lukas)
Date: Fri Sep 19 09:47:41 2008
Subject: [Slony1-general] Slony 2.0
In-Reply-To: <20080919132600.GC2226@crankycanuck.ca>
References: <2060.78.60.0.163.1221810923.squirrel@fmf.vtu.lt>
	<20080919132600.GC2226@crankycanuck.ca>
Message-ID: <1693.78.60.0.163.1221842581.squirrel@fmf.vtu.lt>

Hello once again,



>> Can anybody comment how in Slony 2.0 use command store node? If I use it
>> as in 1.2.x I get error:
>> Error: require EVENT NODE
>> Error: No admin conninfo provided for node -1
>
> Add an explicit event node.

 Can you be more detailed?

In general my slonik script looks like this:

/DB/bin/slonik <<_EOF_

cluster name = $CLUSTERNAME;

node 1 admin conninfo = 'dbname=$MASTERDBNAME host=$MASTERHOST
user=$REPLICATIONUSER';
node 2 admin conninfo = 'dbname=$SLAVEDBNAME host=$SLAVEHOST
user=$REPLICATIONUSER';

store node (id=2, comment = 'aaaa');


 What I should add to it?


thx
Lukas


-- 
This message has been scanned for viruses and
dangerous content by OpenProtect(http://www.openprotect.com), and is
believed to be clean.

From lukas at fmf.vtu.lt  Fri Sep 19 09:51:10 2008
From: lukas at fmf.vtu.lt (Lukas)
Date: Fri Sep 19 09:52:40 2008
Subject: [Slony1-general] Slony on Linux + Slony on Win in one replica
In-Reply-To: <906641.8380.qm@web25803.mail.ukl.yahoo.com>
References: <906641.8380.qm@web25803.mail.ukl.yahoo.com>
Message-ID: <1783.78.60.0.163.1221843070.squirrel@fmf.vtu.lt>

Hello,

 please correct me if I am wrong, but if I want to make replica for ex.
from 10 different slave nodes and one of it is on Win, other on Linux OS.
So I can use only PostgreSQL 8.2.x and Slony 1.2.1 on all nodes, because
only this version is available for Win..? (as I understand version of
PGSQL and Slon has to be the same on all nodes).
 And it is not possible to make it on PostgreSQL 8.3.x..?

thx
Lukas


-- 
This message has been scanned for viruses and
dangerous content by OpenProtect(http://www.openprotect.com), and is
believed to be clean.

From ajs at crankycanuck.ca  Fri Sep 19 10:04:34 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Fri Sep 19 10:04:45 2008
Subject: [Slony1-general] Slony on Linux + Slony on Win in one replica
In-Reply-To: <1783.78.60.0.163.1221843070.squirrel@fmf.vtu.lt>
References: <906641.8380.qm@web25803.mail.ukl.yahoo.com>
	<1783.78.60.0.163.1221843070.squirrel@fmf.vtu.lt>
Message-ID: <20080919170434.GE2226@crankycanuck.ca>

On Fri, Sep 19, 2008 at 07:51:10PM +0300, Lukas wrote:
> So I can use only PostgreSQL 8.2.x and Slony 1.2.1 on all nodes, because
> only this version is available for Win..? (as I understand version of
> PGSQL and Slon has to be the same on all nodes).

No, you can use different versions of PG.  But not of Slony -- it has
to be the same version everywhere.


-- 
Andrew Sullivan
ajs@commandprompt.com
+1 503 667 4564 x104
http://www.commandprompt.com/
From z-saito at guitar.ocn.ne.jp  Fri Sep 19 10:09:46 2008
From: z-saito at guitar.ocn.ne.jp (Hiroshi Saito)
Date: Fri Sep 19 10:10:00 2008
Subject: [Slony1-general] Slony on Linux + Slony on Win in one replica
References: <906641.8380.qm@web25803.mail.ukl.yahoo.com><1783.78.60.0.163.1221843070.squirrel@fmf.vtu.lt>
	<20080919170434.GE2226@crankycanuck.ca>
Message-ID: <020c01c91a7a$8462a780$0d01a8c0@IBMC9A0F63B40D>

Hi Lukas-san.

As for windows environment.
What is offered by Stackbuilder of pginstaller can be used for PostgreSQL 8.3.
However, It is a new version. When you desire 1.2.1, it is necessary to make myself. 
MinGW+gcc is needed for it....

Regards,
Hiroshi Saito

----- Original Message ----- 
From: "Andrew Sullivan" <ajs@crankycanuck.ca>


> On Fri, Sep 19, 2008 at 07:51:10PM +0300, Lukas wrote:
>> So I can use only PostgreSQL 8.2.x and Slony 1.2.1 on all nodes, because
>> only this version is available for Win..? (as I understand version of
>> PGSQL and Slon has to be the same on all nodes).
> 
> No, you can use different versions of PG.  But not of Slony -- it has
> to be the same version everywhere.
> 
> 
> -- 
> Andrew Sullivan
> ajs@commandprompt.com
> +1 503 667 4564 x104
> http://www.commandprompt.com/
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
From bnichols at ca.afilias.info  Fri Sep 19 10:12:56 2008
From: bnichols at ca.afilias.info (Brad Nicholson)
Date: Fri Sep 19 10:13:07 2008
Subject: [Slony1-general] Slony 2.0
In-Reply-To: <1693.78.60.0.163.1221842581.squirrel@fmf.vtu.lt>
References: <2060.78.60.0.163.1221810923.squirrel@fmf.vtu.lt>
	<20080919132600.GC2226@crankycanuck.ca>
	<1693.78.60.0.163.1221842581.squirrel@fmf.vtu.lt>
Message-ID: <1221844376.6705.35.camel@bnicholson-desktop>

On Fri, 2008-09-19 at 19:43 +0300, Lukas wrote:
> Hello once again,
> 
> 
> 
> >> Can anybody comment how in Slony 2.0 use command store node? If I use it
> >> as in 1.2.x I get error:
> >> Error: require EVENT NODE
> >> Error: No admin conninfo provided for node -1
> >
> > Add an explicit event node.
> 
>  Can you be more detailed?

Several Slonik commands assume the there is a node 1 and and try to send
the event through that.  If you don't have a node 1, the command will
fail.  These commands give you the option to specify a different node to
send the event through (event node).  Specify a node that you do have in
the cluster and it should work.

This is in the docs for the STORE NODE command, btw:
http://www.slony.info/documentation/stmtstorenode.html
-- 
?Brad Nicholson  416-673-4106
Database Administrator, Afilias Canada Corp.

From kevin at kevinkempterllc.com  Fri Sep 19 12:51:34 2008
From: kevin at kevinkempterllc.com (kevin kempter)
Date: Fri Sep 19 12:51:53 2008
Subject: [Slony1-general] Add/remove nodes ?
Message-ID: <1771FB11-178C-4B5F-8272-6AAEC3E77266@kevinkempterllc.com>

Hi List;

I'm looking in the docs with little luck - could be that I'm just slow  
today.  I want to be able to do the following:


1) drop a node from a cluster. - I assume this is nothing more than  
executing a slonik 'drop node' ?

2) add a new node to an existing cluster - not sure how to do this

3) I have a failover script I'm testing. The failover script does a  
'failover' followed by a 'drop node'
depending on how the master comes down I end up with one of 2 states.

a) If I do a pg_ctl stop then the failover does the failover and the  
drop node, so when I restart the node the slony schema is removed.
      I assume in this case to re-add the node is the same process as  
adding a new node (#2 above), correct ?

b) If i do a pg_ctl -m immediate stop on the master then the failover  
does the failover but it seems that the drop node never executes  
because when I restart the cluster the slony schema is still there. Is  
there a different way to re-add this node to the cluster ?

Thanks in advance


From dknight at wsi.com  Fri Sep 19 12:56:49 2008
From: dknight at wsi.com (Knight, Doug)
Date: Fri Sep 19 12:57:02 2008
Subject: [Slony1-general] Instructions for setup of slony pair
Message-ID: <8536F69C1FCC294B859D07B179F069440F8FB708@EXCHANGE.ad.wsicorp.com>

List,

I've been looking at the sample instructions for setting up a
replication pair. Unfortunately the sample on the web site is for two
databases on the same host (the pgbench example). There are no details
on what runs where (i.e. do I run the setup script on both nodes? If so,
do I run the same script on both nodes, or are there differences?).
Also, I don't see any instructions for how to "undo", in case of an
error during the setup. I was seeing:

 

Error: name space already exists...

 

Any help would be greatly appreciated.

 

Doug Knight

WSI Corp

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080919/be7f825d/attachment.htm
From cbbrowne at ca.afilias.info  Fri Sep 19 17:02:52 2008
From: cbbrowne at ca.afilias.info (cbbrowne@ca.afilias.info)
Date: Fri Sep 19 17:03:15 2008
Subject: [Slony1-general] Slony 2.0
In-Reply-To: <1221844376.6705.35.camel@bnicholson-desktop>
References: <2060.78.60.0.163.1221810923.squirrel@fmf.vtu.lt>
	<20080919132600.GC2226@crankycanuck.ca>
	<1693.78.60.0.163.1221842581.squirrel@fmf.vtu.lt>
	<1221844376.6705.35.camel@bnicholson-desktop>
Message-ID: <f4a7ba2714d8b9be0b22dd5fbeabf4d3.squirrel@webmail.afilias.info>

> On Fri, 2008-09-19 at 19:43 +0300, Lukas wrote:
>> Hello once again,
>>
>>
>>
>> >> Can anybody comment how in Slony 2.0 use command store node? If I use
>> it
>> >> as in 1.2.x I get error:
>> >> Error: require EVENT NODE
>> >> Error: No admin conninfo provided for node -1
>> >
>> > Add an explicit event node.
>>
>>  Can you be more detailed?
>
> Several Slonik commands assume the there is a node 1 and and try to send
> the event through that.  If you don't have a node 1, the command will
> fail.  These commands give you the option to specify a different node to
> send the event through (event node).  Specify a node that you do have in
> the cluster and it should work.
>
> This is in the docs for the STORE NODE command, btw:
> http://www.slony.info/documentation/stmtstorenode.html

That's certainly the right place to go for documentation.

Brad's comments describe things for versions 1.0 thru 1.2; in 2.0, for
commands that need an event node, it is no longer optional to specify it. 
If you do not indicate an event node, the slonik command will complain as
shown above, and fail, as shown.

This should make things generally more predictable.  Specifying an event
node becomes a little more "in your face;" it won't sometimes magically
work, so you won't get used to that, and be surprised when you don't have
a node #1, and things fail.

From lukas at fmf.vtu.lt  Sat Sep 20 02:25:45 2008
From: lukas at fmf.vtu.lt (Lukas)
Date: Sat Sep 20 02:28:02 2008
Subject: [Slony1-general] Slony 2.0
In-Reply-To: <906641.8380.qm@web25803.mail.ukl.yahoo.com>
References: <906641.8380.qm@web25803.mail.ukl.yahoo.com>
Message-ID: <34098.217.117.29.29.1221902745.squirrel@fmf.vtu.lt>

Hello,

So in general we could say that Slony 2.0 still not for production.. ;[
And for production should be used 1.2.15, right?

Lukas

>> From: Andrew Sullivan <ajs@crankycanuck.ca>
>> >
>> >  I would like to ask is Slony 2.0 version stable and
>> ready to put in
>> > production, or it is better to use more tested and
>> older version 1.2.x?
>>
>> Well, Slony 2.0 has a bunch of new features.  I don't
>> think I will
>> personally be in a big hurry to put it to production
>
> Similar feelings. 1.2.1x is working well here and I'm aware of most of
> it's quirks (well I say that, but I always feel the more I learn about
> something the more I realize I don't know).
>
> But it's been one of my intentions for a while to grab 2.0 and have a
> "play", it sounds like once any teeting problems are discovered and weeded
> out it'll be ace.
>
>
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>
> --
> This message has been scanned for viruses and
> dangerous content by OpenProtect(http://www.openprotect.com), and is
> believed to be clean.
>
>



-- 
This message has been scanned for viruses and
dangerous content by OpenProtect(http://www.openprotect.com), and is
believed to be clean.

From jeff at frostconsultingllc.com  Sat Sep 20 14:27:30 2008
From: jeff at frostconsultingllc.com (Jeff Frost)
Date: Sat Sep 20 14:28:29 2008
Subject: [Slony1-general] Instructions for setup of slony pair
In-Reply-To: <8536F69C1FCC294B859D07B179F069440F8FB708@EXCHANGE.ad.wsicorp.com>
References: <8536F69C1FCC294B859D07B179F069440F8FB708@EXCHANGE.ad.wsicorp.com>
Message-ID: <48D56AC2.4010602@frostconsultingllc.com>

S25pZ2h0LCBEb3VnIHdyb3RlOgo+Cj4gTGlzdCwKPgo+IEnigJl2ZSBiZWVuIGxvb2tpbmcgYXQg
dGhlIHNhbXBsZSBpbnN0cnVjdGlvbnMgZm9yIHNldHRpbmcgdXAgYQo+IHJlcGxpY2F0aW9uIHBh
aXIuIFVuZm9ydHVuYXRlbHkgdGhlIHNhbXBsZSBvbiB0aGUgd2ViIHNpdGUgaXMgZm9yIHR3bwo+
IGRhdGFiYXNlcyBvbiB0aGUgc2FtZSBob3N0ICh0aGUgcGdiZW5jaCBleGFtcGxlKS4gVGhlcmUg
YXJlIG5vIGRldGFpbHMKPiBvbiB3aGF0IHJ1bnMgd2hlcmUgKGkuZS4gZG8gSSBydW4gdGhlIHNl
dHVwIHNjcmlwdCBvbiBib3RoIG5vZGVzPyBJZgo+IHNvLCBkbyBJIHJ1biB0aGUgc2FtZSBzY3Jp
cHQgb24gYm90aCBub2Rlcywgb3IgYXJlIHRoZXJlCj4gZGlmZmVyZW5jZXM/KS4gQWxzbywgSSBk
b27igJl0IHNlZSBhbnkgaW5zdHJ1Y3Rpb25zIGZvciBob3cgdG8g4oCcdW5kb+KAnSwKPiBpbiBj
YXNlIG9mIGFuIGVycm9yIGR1cmluZyB0aGUgc2V0dXAuIEkgd2FzIHNlZWluZzoKPgo+ICAKPgo+
IEVycm9yOiBuYW1lIHNwYWNlIGFscmVhZHkgZXhpc3Rz4oCmCj4KPiAgCj4KPiBBbnkgaGVscCB3
b3VsZCBiZSBncmVhdGx5IGFwcHJlY2lhdGVkLgo+CkRvdWcsCgpUaGUgc2V0dXAgc2NyaXB0IGlz
IHJ1biBmcm9tIGFueSBsb2NhdGlvbiB3aXRoIHNsb25payBpbnN0YWxsZWQgdGhhdCBjYW4KY29u
bmVjdCB0byBhbGwgdGhlIG5vZGVzLiAgU2xvbmlrIHRoZW4gY29ubmVjdHMgdG8gdGhlIGRhdGFi
YXNlIG9uIGVhY2gKbm9kZSBhbmQgZG9lcyB0aGUgd29yay4gIHRvIHVuaW5zdGFsbCwgc2VlIHRo
ZSB1bmluc3RhbGwgbm9kZSBjb21tYW5kCmhlcmU6IGh0dHA6Ly9zbG9ueS5pbmZvL2RvY3VtZW50
YXRpb24vc3RtdHVuaW5zdGFsbG5vZGUuaHRtbAoKWW91IGNhbiBhbHNvIGp1c3QgZHJvcCB0aGUg
c2xvbnkgY2x1c3RlciBzY2hlbWEuICBGb3IgaW5zdGFuY2UgaWYgeW91cgpjbHVzdGVyIGlzIGNh
bGxlZCBteWNsdXN0ZXIsIHRoZW4geW91IHdvdWxkOgoKRFJPUCBTQ0hFTUEgX215Y2x1c3RlciBD
QVNDQURFOwoKdG8gZHJvcCBpdC4gIFlvdSBoYXZlIHRvIGRvIHRoYXQgb24gYWxsIG5vZGVzIGJl
Zm9yZSBzdGFydGluZyBvdmVyIGFnYWluLgoKLS0gCkplZmYgRnJvc3QsIE93bmVyIAk8amVmZkBm
cm9zdGNvbnN1bHRpbmdsbGMuY29tPgpGcm9zdCBDb25zdWx0aW5nLCBMTEMgCWh0dHA6Ly93d3cu
ZnJvc3Rjb25zdWx0aW5nbGxjLmNvbS8KUGhvbmU6IDkxNi02NDctNjQxMQlGQVg6IDkxNi00MDUt
NDAzMgoKLS0tLS0tLS0tLS0tLS0gbmV4dCBwYXJ0IC0tLS0tLS0tLS0tLS0tCkFuIEhUTUwgYXR0
YWNobWVudCB3YXMgc2NydWJiZWQuLi4KVVJMOiBodHRwOi8vbGlzdHMuc2xvbnkuaW5mby9waXBl
cm1haWwvc2xvbnkxLWdlbmVyYWwvYXR0YWNobWVudHMvMjAwODA5MjAvNDNmODQxZTkvYXR0YWNo
bWVudC5odG0K
From dknight at wsi.com  Mon Sep 22 05:02:56 2008
From: dknight at wsi.com (Knight, Doug)
Date: Mon Sep 22 05:03:27 2008
Subject: [Slony1-general] Instructions for setup of slony pair
In-Reply-To: <48D56AC2.4010602@frostconsultingllc.com>
References: <8536F69C1FCC294B859D07B179F069440F8FB708@EXCHANGE.ad.wsicorp.com>
	<48D56AC2.4010602@frostconsultingllc.com>
Message-ID: <8536F69C1FCC294B859D07B179F069440F9748C3@EXCHANGE.ad.wsicorp.com>

See comments interspersed below:

 

________________________________

From: Jeff Frost [mailto:jeff@frostconsultingllc.com] 
Sent: Saturday, September 20, 2008 5:28 PM
To: Knight, Doug
Cc: slony1-general@lists.slony.info
Subject: Re: [Slony1-general] Instructions for setup of slony pair

 

Knight, Doug wrote: 

List,

I've been looking at the sample instructions for setting up a
replication pair. Unfortunately the sample on the web site is for two
databases on the same host (the pgbench example). There are no details
on what runs where (i.e. do I run the setup script on both nodes? If so,
do I run the same script on both nodes, or are there differences?).
Also, I don't see any instructions for how to "undo", in case of an
error during the setup. I was seeing:

 

Error: name space already exists...

 

Any help would be greatly appreciated.

Doug,

The setup script is run from any location with slonik installed that can
connect to all the nodes.  Slonik then connects to the database on each
node and does the work.  to uninstall, see the uninstall node command
here: http://slony.info/documentation/stmtuninstallnode.html
DK: So I only run the script on a single node, probably the origin, and
when I bring up slon on each node it will handle pushing the
configuration around? To run UNINSTALL NODE, does the slon process need
to be running on the origin? Does it need to be running on the target
too, and does uninstalling on the origin uninstall on the target?


You can also just drop the slony cluster schema.  For instance if your
cluster is called mycluster, then you would:

DROP SCHEMA _mycluster CASCADE;

to drop it.  You have to do that on all nodes before starting over
again.
DK: This is from psql, not slonik, right?

 

Thanks for your help,

Doug



-- 
Jeff Frost, Owner      <jeff@frostconsultingllc.com>
<mailto:jeff@frostconsultingllc.com> 
Frost Consulting, LLC  http://www.frostconsultingllc.com/
Phone: 916-647-6411    FAX: 916-405-4032
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080922/6381f142/attachment.htm
From ajs at crankycanuck.ca  Mon Sep 22 05:55:29 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Mon Sep 22 05:55:34 2008
Subject: [Slony1-general] Slony 2.0
In-Reply-To: <34098.217.117.29.29.1221902745.squirrel@fmf.vtu.lt>
References: <906641.8380.qm@web25803.mail.ukl.yahoo.com>
	<34098.217.117.29.29.1221902745.squirrel@fmf.vtu.lt>
Message-ID: <20080922125528.GA12592@crankycanuck.ca>

On Sat, Sep 20, 2008 at 12:25:45PM +0300, Lukas wrote:
> Hello,
> 
> So in general we could say that Slony 2.0 still not for production.. ;[

I don't think we could or could not say that.  I'm just being
cautious.  If I were going up with a new service, I might consider it.

A

-- 
Andrew Sullivan
ajs@commandprompt.com
+1 503 667 4564 x104
http://www.commandprompt.com/
From dknight at wsi.com  Mon Sep 22 06:43:29 2008
From: dknight at wsi.com (Knight, Doug)
Date: Mon Sep 22 06:43:34 2008
Subject: [Slony1-general] RE: Recommenation against sequence only
	replication sets
References: <20080917190003.F2DAB290EEB@main.slony.info> 
Message-ID: <8536F69C1FCC294B859D07B179F069440F974A11@EXCHANGE.ad.wsicorp.com>

All,
I haven't seen a response to this query, so I'm raising it again.

Thanks,
Doug


-----Original Message-----
From: Knight, Doug 
Sent: Thursday, September 18, 2008 2:55 PM
To: 'slony1-general@lists.slony.info'
Subject: Recommenation against sequence only replication sets

All,
I am in the process of configuring Slony-I 1.2.14 on a CentOS 5.2
cluster, and ran across the mention in the documentation (Section 7.3,
The Pathology of Sequences) against having a replication set consisting
of just sequences. Clicking the link to Bug #1226 brings me to the home
page of the Slony-I site, with no further explanation. Looking at the
FAQ, section 5.5 the bug is mentioned again, with a note that it "should
be resolved some time after Slony-I 1.1.0". So first, what exactly is
the bug, and second does this bug still exist in 1.2.14?

Thanks,
Doug Knight
WSI Corp

From ajs at crankycanuck.ca  Mon Sep 22 07:20:06 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Mon Sep 22 07:20:14 2008
Subject: [Slony1-general] Recommenation against sequence only
	replication sets
In-Reply-To: <8536F69C1FCC294B859D07B179F069440F8FAD7A@EXCHANGE.ad.wsicorp.com>
References: <20080917190003.F2DAB290EEB@main.slony.info>
	<8536F69C1FCC294B859D07B179F069440F8FAD7A@EXCHANGE.ad.wsicorp.com>
Message-ID: <20080922142006.GB12592@crankycanuck.ca>

On Thu, Sep 18, 2008 at 02:55:17PM -0400, Knight, Doug wrote:
> page of the Slony-I site, with no further explanation. Looking at the
> FAQ, section 5.5 the bug is mentioned again, with a note that it "should
> be resolved some time after Slony-I 1.1.0". So first, what exactly is
> the bug, and second does this bug still exist in 1.2.14?

I don't know if the bug was fixed (or if it was fixable without really
bad performance effects), but the problem was that sequence-only sets
wouldn't replicate at all.

A

-- 
Andrew Sullivan
ajs@commandprompt.com
+1 503 667 4564 x104
http://www.commandprompt.com/
From dknight at wsi.com  Mon Sep 22 07:29:13 2008
From: dknight at wsi.com (Knight, Doug)
Date: Mon Sep 22 07:29:20 2008
Subject: [Slony1-general] Recommenation against sequence onlyreplication
	sets
In-Reply-To: <20080922142006.GB12592@crankycanuck.ca>
References: <20080917190003.F2DAB290EEB@main.slony.info><8536F69C1FCC294B859D07B179F069440F8FAD7A@EXCHANGE.ad.wsicorp.com>
	<20080922142006.GB12592@crankycanuck.ca>
Message-ID: <8536F69C1FCC294B859D07B179F069440F974AA1@EXCHANGE.ad.wsicorp.com>

Andrew,
How would you handle a sequence that is accessed by more than one table?
We have an audit sequence that is accessed from most of our tables, so
combining the sequence into a single table set with all accessing tables
will make for a very large table set.

Doug

-----Original Message-----
From: slony1-general-bounces@lists.slony.info
[mailto:slony1-general-bounces@lists.slony.info] On Behalf Of Andrew
Sullivan
Sent: Monday, September 22, 2008 10:20 AM
To: slony1-general@lists.slony.info
Subject: Re: [Slony1-general] Recommenation against sequence
onlyreplication sets

On Thu, Sep 18, 2008 at 02:55:17PM -0400, Knight, Doug wrote:
> page of the Slony-I site, with no further explanation. Looking at the
> FAQ, section 5.5 the bug is mentioned again, with a note that it
"should
> be resolved some time after Slony-I 1.1.0". So first, what exactly is
> the bug, and second does this bug still exist in 1.2.14?

I don't know if the bug was fixed (or if it was fixable without really
bad performance effects), but the problem was that sequence-only sets
wouldn't replicate at all.

A

-- 
Andrew Sullivan
ajs@commandprompt.com
+1 503 667 4564 x104
http://www.commandprompt.com/
_______________________________________________
Slony1-general mailing list
Slony1-general@lists.slony.info
http://lists.slony.info/mailman/listinfo/slony1-general

From jeff at frostconsultingllc.com  Mon Sep 22 07:56:28 2008
From: jeff at frostconsultingllc.com (Jeff Frost)
Date: Mon Sep 22 07:58:28 2008
Subject: [Slony1-general] Instructions for setup of slony pair
In-Reply-To: <8536F69C1FCC294B859D07B179F069440F9748C3@EXCHANGE.ad.wsicorp.com>
References: <8536F69C1FCC294B859D07B179F069440F8FB708@EXCHANGE.ad.wsicorp.com>
	<48D56AC2.4010602@frostconsultingllc.com>
	<8536F69C1FCC294B859D07B179F069440F9748C3@EXCHANGE.ad.wsicorp.com>
Message-ID: <48D7B21C.3070707@frostconsultingllc.com>

Knight, Doug wrote:
>
> Any help would be greatly appreciated.
>
> Doug,
>
> The setup script is run from any location with slonik installed that
> can connect to all the nodes.  Slonik then connects to the database on
> each node and does the work.  to uninstall, see the uninstall node
> command here: http://slony.info/documentation/stmtuninstallnode.html
> DK: So I only run the script on a single node, probably the origin,
> and when I bring up slon on each node it will handle pushing the
> configuration around? To run UNINSTALL NODE, does the slon process
> need to be running on the origin? Does it need to be running on the
> target too, and does uninstalling on the origin uninstall on the target?
>
>
JF: The configuration will actually be pushed around when you run the
slonik setup script.  Uninstall node must be run for each node and it
must be run for the master last.  You could put all these in the same
script.  I don't think the slon daemon running is required for uninstall
node, but I'm not 100% positive of this.  Perhaps one of the core
developers could answer this one.

> You can also just drop the slony cluster schema.  For instance if your
> cluster is called mycluster, then you would:
>
> DROP SCHEMA _mycluster CASCADE;
>
> to drop it.  You have to do that on all nodes before starting over again.
> DK: This is from psql, not slonik, right?
>
>  =

>
JF: That's correct.

-- =

Jeff Frost, Owner 	<jeff@frostconsultingllc.com>
Frost Consulting, LLC 	http://www.frostconsultingllc.com/
Phone: 916-647-6411	FAX: 916-405-4032

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080922/=
a797578d/attachment-0001.htm
From ajs at crankycanuck.ca  Mon Sep 22 08:39:16 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Mon Sep 22 08:39:25 2008
Subject: [Slony1-general] Recommenation against sequence
	onlyreplication sets
In-Reply-To: <8536F69C1FCC294B859D07B179F069440F974AA1@EXCHANGE.ad.wsicorp.com>
References: <20080922142006.GB12592@crankycanuck.ca>
	<8536F69C1FCC294B859D07B179F069440F974AA1@EXCHANGE.ad.wsicorp.com>
Message-ID: <20080922153916.GC12592@crankycanuck.ca>

On Mon, Sep 22, 2008 at 10:29:13AM -0400, Knight, Doug wrote:
> Andrew,
> How would you handle a sequence that is accessed by more than one table?
> We have an audit sequence that is accessed from most of our tables, so
> combining the sequence into a single table set with all accessing tables
> will make for a very large table set.

Pick one.  It doesn't actually matter -- the sequences are not really
replicated perfectly anyway.  Instead, the sequence is advanced on the
replica to the current value of the sequence at replication time.
This means that the sequences can be logically further ahead on the
replica than on the origin.  This is ok by the semantics of the
sequence, which can be gappy but is not allowed to go backwards.

A

-- 
Andrew Sullivan
ajs@commandprompt.com
+1 503 667 4564 x104
http://www.commandprompt.com/
From jason at merchantcircle.com  Mon Sep 22 11:15:06 2008
From: jason at merchantcircle.com (Jason Culverhouse)
Date: Mon Sep 22 11:15:17 2008
Subject: [Slony1-general] Slony Upgrade from 1.1.5 to 1.2.15
Message-ID: <BF0590A5-A46F-4E84-8D43-AD1D2395BDA1@merchantcircle.com>

Hi,
I am about to perform an upgrade from 1.1.5 to 1.2.15 as part of a  
migration to postgres 8.3.
I have a question about the upgrade functions script.

If I have 3 nodes in my cluster 10,20,30 can Do I just run one slonik  
script on a node

{{{
cluster name = my_cluster;
node 10 admin conninfo='host=slony10 dbname=foo user=postgres  
port=5432';
node 20 admin conninfo='host=slony20 dbname=foo user=postgres  
port=5432';
node 30 admin conninfo='host=slony30 dbname=foo user=postgres  
port=5432';

update functions (id = 10);
update functions (id = 20);
update functions (id = 30);
}}}


Or do I run 3,one on each node with the update functions for that node  
only.
{{{

cluster name = my_cluster;
node 10 admin conninfo='host=slony10 dbname=foo user=postgres  
port=5432';
node 20 admin conninfo='host= slony20 dbname=foo user=postgres  
port=5432';
node 30 admin conninfo='host= slony30 dbname=foo user=postgres  
port=5432';

update functions (id = 10);
}}}

etc... for 20 and 30

Jason

From dknight at wsi.com  Mon Sep 22 12:40:39 2008
From: dknight at wsi.com (Knight, Doug)
Date: Mon Sep 22 12:40:52 2008
Subject: [Slony1-general] Recommenation against sequenceonlyreplication
	sets
In-Reply-To: <20080922153916.GC12592@crankycanuck.ca>
References: <20080922142006.GB12592@crankycanuck.ca><8536F69C1FCC294B859D07B179F069440F974AA1@EXCHANGE.ad.wsicorp.com>
	<20080922153916.GC12592@crankycanuck.ca>
Message-ID: <8536F69C1FCC294B859D07B179F069440F974EAB@EXCHANGE.ad.wsicorp.com>

Andrew,
After considering your answer, and some banging of heads together here,
I think we've resolved this one. Since our use of slony is limited to
database copies between to heartbeat-HA nodes, once the target node is
up to dat we will be switching from the origin to the target. At that
time we will stop any insert processes on the origin, manually copy
(pg_dump probably) the sequences from origin to target, then switch
everything over to the target. Our purpose is to test postgres upgrade
strategies, which this looks like it will work nicely. Thanks for your
help.

Doug

-----Original Message-----
From: slony1-general-bounces@lists.slony.info
[mailto:slony1-general-bounces@lists.slony.info] On Behalf Of Andrew
Sullivan
Sent: Monday, September 22, 2008 11:39 AM
To: slony1-general@lists.slony.info
Subject: Re: [Slony1-general] Recommenation against
sequenceonlyreplication sets

On Mon, Sep 22, 2008 at 10:29:13AM -0400, Knight, Doug wrote:
> Andrew,
> How would you handle a sequence that is accessed by more than one
table?
> We have an audit sequence that is accessed from most of our tables, so
> combining the sequence into a single table set with all accessing
tables
> will make for a very large table set.

Pick one.  It doesn't actually matter -- the sequences are not really
replicated perfectly anyway.  Instead, the sequence is advanced on the
replica to the current value of the sequence at replication time.
This means that the sequences can be logically further ahead on the
replica than on the origin.  This is ok by the semantics of the
sequence, which can be gappy but is not allowed to go backwards.

A

-- 
Andrew Sullivan
ajs@commandprompt.com
+1 503 667 4564 x104
http://www.commandprompt.com/
_______________________________________________
Slony1-general mailing list
Slony1-general@lists.slony.info
http://lists.slony.info/mailman/listinfo/slony1-general

From abrown at bzzagent.com  Mon Sep 22 12:43:56 2008
From: abrown at bzzagent.com (Aaron Brown)
Date: Mon Sep 22 12:45:09 2008
Subject: [Slony1-general] Table Replication and Log Shipping
Message-ID: <C4FD6DBC.856A%abrown@bzzagent.com>

List,

I have a large table (16 million rows), that I need to pull out of
replication, do some munging, and then rereplicate (in a new set) as part of
a release.  To explain better, the process will be to drop the table (which
is in set 2) from replication, run a large stored procedure that munges the
data, then rereplicate the table by adding it to a new set (set 12).  The
subscribers obviously truncate the table and rereplicate the entire table.
This process works fine.

The catch here is that we have a remote log shipped node off of one of the
subscribers.  I know the schema changes themselves do not propagate.  What
I=B9m unclear on is whether or not the log shipping archive files will cont=
ain
the TRUNCATE and COPY statements to recreate this table, or if I will have
to do something (like recreate the remote node from scratch) to make that
happen? =


Thanks =AD any help you can provide is appreciated.  If you need more
specifics or configs, please let me know.

Aaron
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080922/=
cf34d451/attachment.htm
From dknight at wsi.com  Mon Sep 22 12:45:23 2008
From: dknight at wsi.com (Knight, Doug)
Date: Mon Sep 22 12:45:37 2008
Subject: [Slony1-general] How to determine when the target has caught up to
	the origin
Message-ID: <8536F69C1FCC294B859D07B179F069440F974EBD@EXCHANGE.ad.wsicorp.com>

All,

I am running a pair of servers, origin copying to target, slony version
1.2.14 on CentOS 5.2. I've got my slony replication working, and now I
need to know an easy way to determine when the target is caught up. 

 

Thanks,

Doug Knight

WSI Corp

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080922/71163ddf/attachment.htm
From drees76 at gmail.com  Mon Sep 22 13:43:32 2008
From: drees76 at gmail.com (David Rees)
Date: Mon Sep 22 13:43:45 2008
Subject: [Slony1-general] Slony Upgrade from 1.1.5 to 1.2.15
In-Reply-To: <BF0590A5-A46F-4E84-8D43-AD1D2395BDA1@merchantcircle.com>
References: <BF0590A5-A46F-4E84-8D43-AD1D2395BDA1@merchantcircle.com>
Message-ID: <72dbd3150809221343h671e28fdnb9e1095e4125c083@mail.gmail.com>

On Mon, Sep 22, 2008 at 11:15 AM, Jason Culverhouse
<jason@merchantcircle.com> wrote:
> Hi,
> I am about to perform an upgrade from 1.1.5 to 1.2.15 as part of a migration
> to postgres 8.3.
> I have a question about the upgrade functions script.
>
> If I have 3 nodes in my cluster 10,20,30 can Do I just run one slonik script
> on a node
>
> {{{
> cluster name = my_cluster;
> node 10 admin conninfo='host=slony10 dbname=foo user=postgres port=5432';
> node 20 admin conninfo='host=slony20 dbname=foo user=postgres port=5432';
> node 30 admin conninfo='host=slony30 dbname=foo user=postgres port=5432';
>
> update functions (id = 10);
> update functions (id = 20);
> update functions (id = 30);
> }}}

FWIW, I always use the slonik_* scripts to manage my clusters, and
generates a script like the above and always works just fine. So I
would suggest using that. I believe that slonik will go and connect to
each node as appropriate to apply the updates.

-Dave
From drees76 at gmail.com  Mon Sep 22 13:46:46 2008
From: drees76 at gmail.com (David Rees)
Date: Mon Sep 22 13:46:59 2008
Subject: [Slony1-general] How to determine when the target has caught up
	to the origin
In-Reply-To: <8536F69C1FCC294B859D07B179F069440F974EBD@EXCHANGE.ad.wsicorp.com>
References: <8536F69C1FCC294B859D07B179F069440F974EBD@EXCHANGE.ad.wsicorp.com>
Message-ID: <72dbd3150809221346j51bfd907xf7a43d06dfc954c@mail.gmail.com>

On Mon, Sep 22, 2008 at 12:45 PM, Knight, Doug <dknight@wsi.com> wrote:
> I am running a pair of servers, origin copying to target, slony version
> 1.2.14 on CentOS 5.2. I've got my slony replication working, and now I need
> to know an easy way to determine when the target is caught up.

http://slony.info/documentation/monitoring.html#TESTSLONYSTATE

Also look at the sl_status view.

-Dave
From jennifer.spencer at stanford.edu  Mon Sep 22 14:45:55 2008
From: jennifer.spencer at stanford.edu (Jennifer Spencer)
Date: Mon Sep 22 14:46:11 2008
Subject: [Slony1-general] Table Replication and Log Shipping
In-Reply-To: <C4FD6DBC.856A%abrown@bzzagent.com>
References: <C4FD6DBC.856A%abrown@bzzagent.com>
Message-ID: <48D81213.7040003@stanford.edu>

Hi Aaron,

It would be pretty easy to check the truncate behavior by running another slon process, with a test 
cluster and table, and trying it out.  I myself don't know if "truncate" is something Slony explicitly 
supports (and I am guessing not).

I'd think about it this way: the log shipping process is only another "slon" process (with an archive 
flag -a to save out all the commands issued by the slon).  If your existing slon process to your 
regular subscribers won't do what you want (truncate), then your slon -a (log shipping) won't do it 
either.  If it will, then the slon -a should also.  See what I mean?

I assume from your mail that you are going to have your subscribers issue a "truncate" on their end, 
and do some sort of external-to-Slony process to re-replicate the table in question?  Treat your 
log-shipping subscriber the same as your regular subscribers.  Just before you truncate and munge your 
data, turn off your slon -a process.  You should note the log number in 
_yourclustername.sl_archive_tracking when you turn off your slon.  Make sure to send that number to 
your remote log subscriber.  He'll need to ingest the last CORRECT pre-munge log (that number you're 
going to send him), and then turn off his log-ingest process after that.  Then he would do the 
truncate on the data table, receive and ingest a new set of munged data from you (via your copy 
out/his copy in or another re-replication process you had in mind).  You then restart your log-ship 
slon -a process, and then he'll restart his log-ingest process.  Just make sure not to make other 
changes to other tables when your slon -a is inactive.

Hope this helps.
-Jennifer

Aaron Brown wrote:
> List,
> 
> I have a large table (16 million rows), that I need to pull out of
> replication, do some munging, and then rereplicate (in a new set) as part of
> a release.  To explain better, the process will be to drop the table (which
> is in set 2) from replication, run a large stored procedure that munges the
> data, then rereplicate the table by adding it to a new set (set 12).  The
> subscribers obviously truncate the table and rereplicate the entire table.
> This process works fine.
> 
> The catch here is that we have a remote log shipped node off of one of the
> subscribers.  I know the schema changes themselves do not propagate.  What
> I?m unclear on is whether or not the log shipping archive files will contain
> the TRUNCATE and COPY statements to recreate this table, or if I will have
> to do something (like recreate the remote node from scratch) to make that
> happen? 
> 
> Thanks ? any help you can provide is appreciated.  If you need more
> specifics or configs, please let me know.
> 
> Aaron
> 
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
From ajs at crankycanuck.ca  Mon Sep 22 14:49:35 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Mon Sep 22 14:49:50 2008
Subject: [Slony1-general] Table Replication and Log Shipping
In-Reply-To: <48D81213.7040003@stanford.edu>
References: <C4FD6DBC.856A%abrown@bzzagent.com> <48D81213.7040003@stanford.edu>
Message-ID: <20080922214934.GA17704@crankycanuck.ca>

On Mon, Sep 22, 2008 at 02:45:55PM -0700, Jennifer Spencer wrote:
> Hi Aaron,
>
> It would be pretty easy to check the truncate behavior by running another 
> slon process, with a test cluster and table, and trying it out.  I myself 
> don't know if "truncate" is something Slony explicitly supports (and I am 
> guessing not).

Nope, it doesn't.  In 8.4 there's a proposal for ON TRUNCATE triggers, though.


-- 
Andrew Sullivan
ajs@commandprompt.com
+1 503 667 4564 x104
http://www.commandprompt.com/
From lukas at fmf.vtu.lt  Mon Sep 22 14:50:37 2008
From: lukas at fmf.vtu.lt (Lukas)
Date: Mon Sep 22 14:52:48 2008
Subject: [Slony1-general] Slony 1.2.15 on Win
Message-ID: <1358.78.60.0.163.1222120237.squirrel@fmf.vtu.lt>

Hello,

 we have replication from 9 nodes, 8 of it is on Linux OS, and one more on
Windows.. we use Postgresql 8.3.3 and Slony 1.2.15 on all nodes. Also All
DB on all nodes are on SQL_ASCII encoding.
 when I started replication and made fist "subscribe" I got error on Win
system:

08-09-22 23:39:39 FLE Standard Time DEBUG2 remoteWorkerThread_1: Begin
COPY of table "public"."padalinys"
08-09-22 23:39:39 FLE Standard Time DEBUG2 remoteWorkerThread_1:  nodeon73
is 0
TICE:  truncate of "public"."padalinys" failed - doing delete
2008-09-22 23:39:39 FLE Standard Time ERROR  remoteWorkerThread_1: copy
from stdin on local node - PGRES_FATAL_ERROR ERROR: invalid byte sequence
for encoding "UTF8": 0xebfe79
HINT:  This error can also happen if the byte sequence does not match the
encoding expected by the server, which is controlled by "client_encoding".

 The most important thing that, when I started slon from other host on
Linux for the same DB which is on Win, it replicated without an errorr..
 May it is a bug?

thx
Lukas


-- 
This message has been scanned for viruses and
dangerous content by OpenProtect(http://www.openprotect.com), and is
believed to be clean.

From rafael.domiciano at gmail.com  Mon Sep 22 17:04:54 2008
From: rafael.domiciano at gmail.com (Rafael Domiciano)
Date: Mon Sep 22 17:05:13 2008
Subject: [Slony1-general] Slony 1.2.15 on Win
In-Reply-To: <1358.78.60.0.163.1222120237.squirrel@fmf.vtu.lt>
References: <1358.78.60.0.163.1222120237.squirrel@fmf.vtu.lt>
Message-ID: <3a0028490809221704k12b126c2u7d301f448cebc504@mail.gmail.com>

Hello there,
The problem is here:
2008-09-22 23:39:39 FLE Standard Time ERROR  remoteWorkerThread_1: copy
from stdin on local node - PGRES_FATAL_ERROR ERROR: invalid byte sequence
for encoding "UTF8": 0xebfe79

Maybe the Windows Server is not using the same encoding that the others
servers...!

2008/9/22 Lukas <lukas@fmf.vtu.lt>

> Hello,
>
>  we have replication from 9 nodes, 8 of it is on Linux OS, and one more on
> Windows.. we use Postgresql 8.3.3 and Slony 1.2.15 on all nodes. Also All
> DB on all nodes are on SQL_ASCII encoding.
>  when I started replication and made fist "subscribe" I got error on Win
> system:
>
> 08-09-22 23:39:39 FLE Standard Time DEBUG2 remoteWorkerThread_1: Begin
> COPY of table "public"."padalinys"
> 08-09-22 23:39:39 FLE Standard Time DEBUG2 remoteWorkerThread_1:  nodeon73
> is 0
> TICE:  truncate of "public"."padalinys" failed - doing delete
> 2008-09-22 23:39:39 FLE Standard Time ERROR  remoteWorkerThread_1: copy
> from stdin on local node - PGRES_FATAL_ERROR ERROR: invalid byte sequence
> for encoding "UTF8": 0xebfe79
> HINT:  This error can also happen if the byte sequence does not match the
> encoding expected by the server, which is controlled by "client_encoding".
>
>  The most important thing that, when I started slon from other host on
> Linux for the same DB which is on Win, it replicated without an errorr..
>  May it is a bug?
>
> thx
> Lukas
>
>
> --
> This message has been scanned for viruses and
> dangerous content by OpenProtect(http://www.openprotect.com), and is
> believed to be clean.
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080922/=
6c24a04a/attachment-0001.htm
From lukas at fmf.vtu.lt  Tue Sep 23 02:14:23 2008
From: lukas at fmf.vtu.lt (Lukas)
Date: Tue Sep 23 02:18:02 2008
Subject: [Slony1-general] Slony 1.2.15 on Win
In-Reply-To: <3a0028490809221704k12b126c2u7d301f448cebc504@mail.gmail.com>
References: <1358.78.60.0.163.1222120237.squirrel@fmf.vtu.lt>
	<3a0028490809221704k12b126c2u7d301f448cebc504@mail.gmail.com>
Message-ID: <13201.217.117.29.29.1222161263.squirrel@fmf.vtu.lt>

Hello,

 If you are talking about encoding of postgresql database, then it is not
- on all nodes (on windows as well) it is SQL_ASCII. I double checked
that..
 Also if it is because of encoding of database it should not work when I
start slon from Linux host..

Lukas

> Hello there,
> The problem is here:
> 2008-09-22 23:39:39 FLE Standard Time ERROR  remoteWorkerThread_1: copy
> from stdin on local node - PGRES_FATAL_ERROR ERROR: invalid byte sequence
> for encoding "UTF8": 0xebfe79
>
> Maybe the Windows Server is not using the same encoding that the others
> servers...!
>
> 2008/9/22 Lukas <lukas@fmf.vtu.lt>
>
>> Hello,
>>
>>  we have replication from 9 nodes, 8 of it is on Linux OS, and one more
>> on
>> Windows.. we use Postgresql 8.3.3 and Slony 1.2.15 on all nodes. Also
>> All
>> DB on all nodes are on SQL_ASCII encoding.
>>  when I started replication and made fist "subscribe" I got error on Win
>> system:
>>
>> 08-09-22 23:39:39 FLE Standard Time DEBUG2 remoteWorkerThread_1: Begin
>> COPY of table "public"."padalinys"
>> 08-09-22 23:39:39 FLE Standard Time DEBUG2 remoteWorkerThread_1:
>> nodeon73
>> is 0
>> TICE:  truncate of "public"."padalinys" failed - doing delete
>> 2008-09-22 23:39:39 FLE Standard Time ERROR  remoteWorkerThread_1: copy
>> from stdin on local node - PGRES_FATAL_ERROR ERROR: invalid byte
>> sequence
>> for encoding "UTF8": 0xebfe79
>> HINT:  This error can also happen if the byte sequence does not match
>> the
>> encoding expected by the server, which is controlled by
>> "client_encoding".
>>
>>  The most important thing that, when I started slon from other host on
>> Linux for the same DB which is on Win, it replicated without an errorr..
>>  May it is a bug?
>>
>> thx
>> Lukas
>>
>>
>> --
>> This message has been scanned for viruses and
>> dangerous content by OpenProtect(http://www.openprotect.com), and is
>> believed to be clean.
>>
>> _______________________________________________
>> Slony1-general mailing list
>> Slony1-general@lists.slony.info
>> http://lists.slony.info/mailman/listinfo/slony1-general
>>
>
> --
> This message has been scanned for viruses and
> dangerous content by OpenProtect(http://www.openprotect.com), and is
> believed to be clean.
>
>



-- 
This message has been scanned for viruses and
dangerous content by OpenProtect(http://www.openprotect.com), and is
believed to be clean.

From dknight at wsi.com  Tue Sep 23 06:02:34 2008
From: dknight at wsi.com (Knight, Doug)
Date: Tue Sep 23 06:02:39 2008
Subject: [Slony1-general] How to determine when the target has caught up
	to the origin
In-Reply-To: <72dbd3150809221346j51bfd907xf7a43d06dfc954c@mail.gmail.com>
References: <8536F69C1FCC294B859D07B179F069440F974EBD@EXCHANGE.ad.wsicorp.com>
	<72dbd3150809221346j51bfd907xf7a43d06dfc954c@mail.gmail.com>
Message-ID: <8536F69C1FCC294B859D07B179F069440F97518A@EXCHANGE.ad.wsicorp.com>

David,
I've tried running that script. The first time I tried, I got an error
trying to find Pg.pm. I had to modify the use statement to include
DBD::Pg. Now I'm getting errors at lines 46 and 56, something like the
following:

Bareword "PGRES_CONNECTION_OK" not allowed while "strict subs" in use
at...

I also get it on "PGRES_TUPLES_OK". The script then aborts due to
compilation errors. I'm not much of a perl programmer, so I'm not sure
what the problem is.

Doug

-----Original Message-----
From: David Rees [mailto:drees76@gmail.com] 
Sent: Monday, September 22, 2008 4:47 PM
To: Knight, Doug; slony1-general@lists.slony.info
Subject: Re: [Slony1-general] How to determine when the target has
caught up to the origin

On Mon, Sep 22, 2008 at 12:45 PM, Knight, Doug <dknight@wsi.com> wrote:
> I am running a pair of servers, origin copying to target, slony
version
> 1.2.14 on CentOS 5.2. I've got my slony replication working, and now I
need
> to know an easy way to determine when the target is caught up.

http://slony.info/documentation/monitoring.html#TESTSLONYSTATE

Also look at the sl_status view.

-Dave

From ajs at crankycanuck.ca  Tue Sep 23 06:55:41 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Tue Sep 23 06:55:48 2008
Subject: [Slony1-general] How to determine when the target has caught
	up to the origin
In-Reply-To: <8536F69C1FCC294B859D07B179F069440F97518A@EXCHANGE.ad.wsicorp.com>
References: <8536F69C1FCC294B859D07B179F069440F974EBD@EXCHANGE.ad.wsicorp.com>
	<72dbd3150809221346j51bfd907xf7a43d06dfc954c@mail.gmail.com>
	<8536F69C1FCC294B859D07B179F069440F97518A@EXCHANGE.ad.wsicorp.com>
Message-ID: <20080923135541.GC18302@crankycanuck.ca>

On Tue, Sep 23, 2008 at 09:02:34AM -0400, Knight, Doug wrote:
> David,
> I've tried running that script. The first time I tried, I got an error
> trying to find Pg.pm. I had to modify the use statement to include
> DBD::Pg. Now I'm getting errors at lines 46 and 56, something like the
> following:

It doesn't use DBD::Pg.  It uses Pg.pm, which is officially deprecated.  

A

-- 
Andrew Sullivan
ajs@commandprompt.com
+1 503 667 4564 x104
http://www.commandprompt.com/
From cbbrowne at ca.afilias.info  Tue Sep 23 07:51:57 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Tue Sep 23 07:52:06 2008
Subject: [Slony1-general] Recommenation against sequence only replication
	sets
In-Reply-To: <20080922142006.GB12592@crankycanuck.ca> (Andrew Sullivan's
	message of "Mon, 22 Sep 2008 10:20:06 -0400")
References: <20080917190003.F2DAB290EEB@main.slony.info>
	<8536F69C1FCC294B859D07B179F069440F8FAD7A@EXCHANGE.ad.wsicorp.com>
	<20080922142006.GB12592@crankycanuck.ca>
Message-ID: <87fxnqvrsi.fsf@dba2.int.libertyrms.com>

Andrew Sullivan <ajs@crankycanuck.ca> writes:
> On Thu, Sep 18, 2008 at 02:55:17PM -0400, Knight, Doug wrote:
>> page of the Slony-I site, with no further explanation. Looking at the
>> FAQ, section 5.5 the bug is mentioned again, with a note that it "should
>> be resolved some time after Slony-I 1.1.0". So first, what exactly is
>> the bug, and second does this bug still exist in 1.2.14?
>
> I don't know if the bug was fixed (or if it was fixable without really
> bad performance effects), but the problem was that sequence-only sets
> wouldn't replicate at all.

It was stranger than that.

The problem was that if you had a series of subscription sets coming
from a provider, but had NO tables in that series, then the query that
pulls the list of tables to replicate would find none, and fail.

If you had *any* tables being replicated, across a series of sets,
then all would work fine; the problem was *only* when you had no
tables at all.

Thus, if you have:

  set 1, consisting of tables t1, t2, t3, and sequences s1, s2, and s3, and
  set 2, consisting of sequences s4, s5, and s6,

then everything would work fine if:
  a) Node 22 is subscribing to node 11, and pulling *BOTH* set 1 and set 2, or
  b) Node 22 is subscribing to node 11, and pulling just set 1.

The case that fails is where
  c) Node 22 is subscribing to node 11, and pulling just set 2.

Going over CVS logs, the issue of bug #1226 was addressed in version
1.86.2.4 of src/slon/remote_worker.c, on 2005-10-07 18:08:39.  Should
be long, long, long, gone.
-- 
(format nil "~S@~S" "cbbrowne" "cbbrowne.com")
http://linuxdatabases.info/info/internet.html
Rules of the  Evil  Overlord #171.  "I  will not  locate  a base  in a
volcano, cave, or  any other location  where it would be  ridiculously
easy to bypass security by rappelling down from above."
<http://www.eviloverlord.com/>
From cbbrowne at ca.afilias.info  Tue Sep 23 07:57:50 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Tue Sep 23 07:57:56 2008
Subject: [Slony1-general] Table Replication and Log Shipping
In-Reply-To: <20080922214934.GA17704@crankycanuck.ca> (Andrew Sullivan's
	message of "Mon, 22 Sep 2008 17:49:35 -0400")
References: <C4FD6DBC.856A%abrown@bzzagent.com> <48D81213.7040003@stanford.edu>
	<20080922214934.GA17704@crankycanuck.ca>
Message-ID: <87bpyevrip.fsf@dba2.int.libertyrms.com>

Andrew Sullivan <ajs@crankycanuck.ca> writes:
> On Mon, Sep 22, 2008 at 02:45:55PM -0700, Jennifer Spencer wrote:
>> Hi Aaron,
>>
>> It would be pretty easy to check the truncate behavior by running another 
>> slon process, with a test cluster and table, and trying it out.  I myself 
>> don't know if "truncate" is something Slony explicitly supports (and I am 
>> guessing not).
>
> Nope, it doesn't.  In 8.4 there's a proposal for ON TRUNCATE triggers, though.

It's implemented in 8.4, and has been committed to HEAD.

Simon Riggs was kind enough to submit a sample patch for Slony-I to
implement these triggers, which does pass the "does that kinda work"
test.

The reason it hasn't gotten committed is that there's a bit of a
puzzle as to how to deal with cases like:

  TRUNCATE t1, t2, t3, t4;
   or
  TRUNCATE t1 CASCADE;

These would both (potentially!) lead to truncating several tables, and
firing the truncate triggers several times.  For those truncates to
*WORK*, on subscribers, we need to be able to merge them into a single
request, and nobody has proposed how we might do *that.*

As a "first draft," I could see either:

 a) Ruling out TRUNCATE by putting "deny access"-like functions onto
    ON CASCADE triggers on all replicated tables (on all nodes!)

 b) Taking the "primitive" approach of accepting TRUNCATE, capturing
    the table ID, and propagating that.

    This risks breaking if you submit one of the two sample queries I
    described earlier, though.
-- 
output = reverse("ofni.secnanifxunil" "@" "enworbbc")
http://linuxfinances.info/info/
Would-be National Mottos:
USA: "There oughta' be a law!"
From dknight at wsi.com  Tue Sep 23 08:29:57 2008
From: dknight at wsi.com (Knight, Doug)
Date: Tue Sep 23 08:30:04 2008
Subject: [Slony1-general] How to determine when the target has caughtup to
	the origin
In-Reply-To: <20080923135541.GC18302@crankycanuck.ca>
References: <8536F69C1FCC294B859D07B179F069440F974EBD@EXCHANGE.ad.wsicorp.com><72dbd3150809221346j51bfd907xf7a43d06dfc954c@mail.gmail.com><8536F69C1FCC294B859D07B179F069440F97518A@EXCHANGE.ad.wsicorp.com>
	<20080923135541.GC18302@crankycanuck.ca>
Message-ID: <8536F69C1FCC294B859D07B179F069440F9753DF@EXCHANGE.ad.wsicorp.com>

The only Pg.pm I could find on any of my systems was under DBD/Pg.pm.
Knowing only enough about perl to get me in trouble, where can I get the
Pg.pm you indicate so I can run this script?

Doug

-----Original Message-----
From: slony1-general-bounces@lists.slony.info
[mailto:slony1-general-bounces@lists.slony.info] On Behalf Of Andrew
Sullivan
Sent: Tuesday, September 23, 2008 9:56 AM
To: slony1-general@lists.slony.info
Subject: Re: [Slony1-general] How to determine when the target has
caughtup to the origin

On Tue, Sep 23, 2008 at 09:02:34AM -0400, Knight, Doug wrote:
> David,
> I've tried running that script. The first time I tried, I got an error
> trying to find Pg.pm. I had to modify the use statement to include
> DBD::Pg. Now I'm getting errors at lines 46 and 56, something like the
> following:

It doesn't use DBD::Pg.  It uses Pg.pm, which is officially deprecated.


A

-- 
Andrew Sullivan
ajs@commandprompt.com
+1 503 667 4564 x104
http://www.commandprompt.com/
_______________________________________________
Slony1-general mailing list
Slony1-general@lists.slony.info
http://lists.slony.info/mailman/listinfo/slony1-general

From kevin at kevinkempterllc.com  Tue Sep 23 08:59:26 2008
From: kevin at kevinkempterllc.com (kevin kempter)
Date: Tue Sep 23 08:59:34 2008
Subject: [Slony1-general] How to determine when the target has caughtup to
	the origin
In-Reply-To: <8536F69C1FCC294B859D07B179F069440F9753DF@EXCHANGE.ad.wsicorp.com>
References: <8536F69C1FCC294B859D07B179F069440F974EBD@EXCHANGE.ad.wsicorp.com><72dbd3150809221346j51bfd907xf7a43d06dfc954c@mail.gmail.com><8536F69C1FCC294B859D07B179F069440F97518A@EXCHANGE.ad.wsicorp.com>
	<20080923135541.GC18302@crankycanuck.ca>
	<8536F69C1FCC294B859D07B179F069440F9753DF@EXCHANGE.ad.wsicorp.com>
Message-ID: <883AB1DC-B9F9-445E-B3D9-3B56218C65CE@kevinkempterllc.com>

Just a thought:


Given that Pg.pm is depreciated, I would read through the  
testslonystate script and see for myself what queries it's running to  
determine current state. Then I would either tweak the script to use  
DBD::Pg or even pull out the bits that I care about and put it in a  
simple bash or sql script of my own...





On Sep 23, 2008, at 9:29 AM, Knight, Doug wrote:

> The only Pg.pm I could find on any of my systems was under DBD/Pg.pm.
> Knowing only enough about perl to get me in trouble, where can I get  
> the
> Pg.pm you indicate so I can run this script?
>
> Doug
>
> -----Original Message-----
> From: slony1-general-bounces@lists.slony.info
> [mailto:slony1-general-bounces@lists.slony.info] On Behalf Of Andrew
> Sullivan
> Sent: Tuesday, September 23, 2008 9:56 AM
> To: slony1-general@lists.slony.info
> Subject: Re: [Slony1-general] How to determine when the target has
> caughtup to the origin
>
> On Tue, Sep 23, 2008 at 09:02:34AM -0400, Knight, Doug wrote:
>> David,
>> I've tried running that script. The first time I tried, I got an  
>> error
>> trying to find Pg.pm. I had to modify the use statement to include
>> DBD::Pg. Now I'm getting errors at lines 46 and 56, something like  
>> the
>> following:
>
> It doesn't use DBD::Pg.  It uses Pg.pm, which is officially  
> deprecated.
>
>
> A
>
> -- 
> Andrew Sullivan
> ajs@commandprompt.com
> +1 503 667 4564 x104
> http://www.commandprompt.com/
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general

From ajs at crankycanuck.ca  Tue Sep 23 09:05:54 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Tue Sep 23 09:06:04 2008
Subject: [Slony1-general] How to determine when the target has caughtup
	to the origin
In-Reply-To: <8536F69C1FCC294B859D07B179F069440F9753DF@EXCHANGE.ad.wsicorp.com>
References: <20080923135541.GC18302@crankycanuck.ca>
	<8536F69C1FCC294B859D07B179F069440F9753DF@EXCHANGE.ad.wsicorp.com>
Message-ID: <20080923160554.GD18302@crankycanuck.ca>

On Tue, Sep 23, 2008 at 11:29:57AM -0400, Knight, Doug wrote:
> The only Pg.pm I could find on any of my systems was under DBD/Pg.pm.
> Knowing only enough about perl to get me in trouble, where can I get the
> Pg.pm you indicate so I can run this script?

I think it might still be up on pgfoundry.  It's got some clanger
problems in it, note, although I think it should be possible to make
it into a reasonably useful module.  But there's no interest in it,
apparently, because people prefer the DBI.

A

-- 
Andrew Sullivan
ajs@commandprompt.com
+1 503 667 4564 x104
http://www.commandprompt.com/
From lists at serioustechnology.com  Tue Sep 23 09:42:23 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Tue Sep 23 09:42:33 2008
Subject: [Slony1-general] How to determine when the target has caughtup
	to the origin
In-Reply-To: <20080923160554.GD18302@crankycanuck.ca>
References: <20080923135541.GC18302@crankycanuck.ca>	<8536F69C1FCC294B859D07B179F069440F9753DF@EXCHANGE.ad.wsicorp.com>
	<20080923160554.GD18302@crankycanuck.ca>
Message-ID: <48D91C6F.3090503@serioustechnology.com>

Andrew Sullivan wrote:
> On Tue, Sep 23, 2008 at 11:29:57AM -0400, Knight, Doug wrote:
>> The only Pg.pm I could find on any of my systems was under DBD/Pg.pm.
>> Knowing only enough about perl to get me in trouble, where can I get the
>> Pg.pm you indicate so I can run this script?
> 
> I think it might still be up on pgfoundry.  It's got some clanger
> problems in it, note, although I think it should be possible to make
> it into a reasonably useful module.  But there's no interest in it,
> apparently, because people prefer the DBI.

We actually use it extensively in our Postgresql application, primarily 
because it maps much nicer to the C pg interface.  We've not had any 
problems with it.

Can you tell me what you mean by 'clanger' problems???

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From ajs at crankycanuck.ca  Tue Sep 23 10:11:52 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Tue Sep 23 10:12:03 2008
Subject: [Slony1-general] How to determine when the target has caughtup
	to the origin
In-Reply-To: <48D91C6F.3090503@serioustechnology.com>
References: <20080923135541.GC18302@crankycanuck.ca>
	<8536F69C1FCC294B859D07B179F069440F9753DF@EXCHANGE.ad.wsicorp.com>
	<20080923160554.GD18302@crankycanuck.ca>
	<48D91C6F.3090503@serioustechnology.com>
Message-ID: <20080923171152.GE18302@crankycanuck.ca>

On Tue, Sep 23, 2008 at 12:42:23PM -0400, Geoffrey wrote:
>
> We actually use it extensively in our Postgresql application, primarily 
> because it maps much nicer to the C pg interface.  We've not had any 
> problems with it.

I like it too.

> Can you tell me what you mean by 'clanger' problems???

Query escaping has never been supported, which can be dangerous in
certain environments.  I don't actually think it _is_ dangerous in
this context, but others' opinions vary.  

A

-- 
Andrew Sullivan
ajs@commandprompt.com
+1 503 667 4564 x104
http://www.commandprompt.com/
From lists at serioustechnology.com  Tue Sep 23 10:43:01 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Tue Sep 23 10:43:11 2008
Subject: [Slony1-general] How to determine when the target has caughtup
	to the origin
In-Reply-To: <20080923171152.GE18302@crankycanuck.ca>
References: <20080923135541.GC18302@crankycanuck.ca>	<8536F69C1FCC294B859D07B179F069440F9753DF@EXCHANGE.ad.wsicorp.com>	<20080923160554.GD18302@crankycanuck.ca>	<48D91C6F.3090503@serioustechnology.com>
	<20080923171152.GE18302@crankycanuck.ca>
Message-ID: <48D92AA5.2080604@serioustechnology.com>

Andrew Sullivan wrote:
> On Tue, Sep 23, 2008 at 12:42:23PM -0400, Geoffrey wrote:
>> We actually use it extensively in our Postgresql application, primarily 
>> because it maps much nicer to the C pg interface.  We've not had any 
>> problems with it.
> 
> I like it too.
> 
>> Can you tell me what you mean by 'clanger' problems???
> 
> Query escaping has never been supported, which can be dangerous in
> certain environments.  I don't actually think it _is_ dangerous in
> this context, but others' opinions vary.

Thanks for the explanation.

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From cbbrowne at ca.afilias.info  Tue Sep 23 10:48:37 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Tue Sep 23 10:48:49 2008
Subject: [Slony1-general] How to determine when the target has caughtup to
	the origin
In-Reply-To: <883AB1DC-B9F9-445E-B3D9-3B56218C65CE@kevinkempterllc.com> (kevin
	kempter's message of "Tue, 23 Sep 2008 09:59:26 -0600")
References: <8536F69C1FCC294B859D07B179F069440F974EBD@EXCHANGE.ad.wsicorp.com>
	<72dbd3150809221346j51bfd907xf7a43d06dfc954c@mail.gmail.com>
	<8536F69C1FCC294B859D07B179F069440F97518A@EXCHANGE.ad.wsicorp.com>
	<20080923135541.GC18302@crankycanuck.ca>
	<8536F69C1FCC294B859D07B179F069440F9753DF@EXCHANGE.ad.wsicorp.com>
	<883AB1DC-B9F9-445E-B3D9-3B56218C65CE@kevinkempterllc.com>
Message-ID: <873ajqu51m.fsf@dba2.int.libertyrms.com>

kevin kempter <kevin@kevinkempterllc.com> writes:
> Given that Pg.pm is depreciated, I would read through the
> testslonystate script and see for myself what queries it's running to
> determine current state. Then I would either tweak the script to use
> DBD::Pg or even pull out the bits that I care about and put it in a
> simple bash or sql script of my own...

Let me note that there is a parallel script in the tools directory
which uses DBD::Pg instead of Pg.pm.  You don't need to rewrite the
Pg.pm version; that has *already been done*, and contributed to the
tools directory.
-- 
(format nil "~S@~S" "cbbrowne" "acm.org")
http://linuxfinances.info/info/sgml.html
"I  worry that  the person  who thought  up Muzak  may be  thinking up
something else." -- Lily Tomlin
From rafael.domiciano at gmail.com  Tue Sep 23 10:52:31 2008
From: rafael.domiciano at gmail.com (Rafael Domiciano)
Date: Tue Sep 23 10:52:41 2008
Subject: [Slony1-general] Slony 1.2.15 on Win
In-Reply-To: <13201.217.117.29.29.1222161263.squirrel@fmf.vtu.lt>
References: <1358.78.60.0.163.1222120237.squirrel@fmf.vtu.lt>
	<3a0028490809221704k12b126c2u7d301f448cebc504@mail.gmail.com>
	<13201.217.117.29.29.1222161263.squirrel@fmf.vtu.lt>
Message-ID: <3a0028490809231052h30e0f3abs5820d96381795ece@mail.gmail.com>

Hello Lukas,
Something is wrong in you replication. See that the log is acusing another
encoding: UTF-8. And you said that you are using SQL_ASCII
I had something like that some time ago, and I corrected adjusting the
encoding.

2008-09-22 23:39:39 FLE Standard Time ERROR  remoteWorkerThread_1: copy from
stdin on local node - PGRES_FATAL_ERROR ERROR: invalid byte sequence for
encoding "UTF8": 0xebfe79

2008/9/23 Lukas <lukas@fmf.vtu.lt>

> Hello,
>
>  If you are talking about encoding of postgresql database, then it is not
> - on all nodes (on windows as well) it is SQL_ASCII. I double checked
> that..
>  Also if it is because of encoding of database it should not work when I
> start slon from Linux host..
>
> Lukas
>
> > Hello there,
> > The problem is here:
> > 2008-09-22 23:39:39 FLE Standard Time ERROR  remoteWorkerThread_1: copy
> > from stdin on local node - PGRES_FATAL_ERROR ERROR: invalid byte sequen=
ce
> > for encoding "UTF8": 0xebfe79
> >
> > Maybe the Windows Server is not using the same encoding that the others
> > servers...!
> >
> > 2008/9/22 Lukas <lukas@fmf.vtu.lt>
> >
> >> Hello,
> >>
> >>  we have replication from 9 nodes, 8 of it is on Linux OS, and one more
> >> on
> >> Windows.. we use Postgresql 8.3.3 and Slony 1.2.15 on all nodes. Also
> >> All
> >> DB on all nodes are on SQL_ASCII encoding.
> >>  when I started replication and made fist "subscribe" I got error on W=
in
> >> system:
> >>
> >> 08-09-22 23:39:39 FLE Standard Time DEBUG2 remoteWorkerThread_1: Begin
> >> COPY of table "public"."padalinys"
> >> 08-09-22 23:39:39 FLE Standard Time DEBUG2 remoteWorkerThread_1:
> >> nodeon73
> >> is 0
> >> TICE:  truncate of "public"."padalinys" failed - doing delete
> >> 2008-09-22 23:39:39 FLE Standard Time ERROR  remoteWorkerThread_1: copy
> >> from stdin on local node - PGRES_FATAL_ERROR ERROR: invalid byte
> >> sequence
> >> for encoding "UTF8": 0xebfe79
> >> HINT:  This error can also happen if the byte sequence does not match
> >> the
> >> encoding expected by the server, which is controlled by
> >> "client_encoding".
> >>
> >>  The most important thing that, when I started slon from other host on
> >> Linux for the same DB which is on Win, it replicated without an errorr=
..
> >>  May it is a bug?
> >>
> >> thx
> >> Lukas
> >>
> >>
> >> --
> >> This message has been scanned for viruses and
> >> dangerous content by OpenProtect(http://www.openprotect.com), and is
> >> believed to be clean.
> >>
> >> _______________________________________________
> >> Slony1-general mailing list
> >> Slony1-general@lists.slony.info
> >> http://lists.slony.info/mailman/listinfo/slony1-general
> >>
> >
> > --
> > This message has been scanned for viruses and
> > dangerous content by OpenProtect(http://www.openprotect.com), and is
> > believed to be clean.
> >
> >
>
>
>
> --
> This message has been scanned for viruses and
> dangerous content by OpenProtect(http://www.openprotect.com), and is
> believed to be clean.
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080923/=
b8837584/attachment.htm
From dknight at wsi.com  Tue Sep 23 10:54:02 2008
From: dknight at wsi.com (Knight, Doug)
Date: Tue Sep 23 10:54:13 2008
Subject: [Slony1-general] How to determine when the target has caughtup to
	the origin
In-Reply-To: <873ajqu51m.fsf@dba2.int.libertyrms.com>
References: <8536F69C1FCC294B859D07B179F069440F974EBD@EXCHANGE.ad.wsicorp.com><72dbd3150809221346j51bfd907xf7a43d06dfc954c@mail.gmail.com><8536F69C1FCC294B859D07B179F069440F97518A@EXCHANGE.ad.wsicorp.com><20080923135541.GC18302@crankycanuck.ca><8536F69C1FCC294B859D07B179F069440F9753DF@EXCHANGE.ad.wsicorp.com><883AB1DC-B9F9-445E-B3D9-3B56218C65CE@kevinkempterllc.com>
	<873ajqu51m.fsf@dba2.int.libertyrms.com>
Message-ID: <8536F69C1FCC294B859D07B179F069440F9755A8@EXCHANGE.ad.wsicorp.com>

What's the name of the parallel script?

Doug

-----Original Message-----
From: Christopher Browne [mailto:cbbrowne@ca.afilias.info] 
Sent: Tuesday, September 23, 2008 1:49 PM
To: kevin kempter
Cc: Knight, Doug; slony1-general@lists.slony.info
Subject: Re: [Slony1-general] How to determine when the target has
caughtup to the origin

kevin kempter <kevin@kevinkempterllc.com> writes:
> Given that Pg.pm is depreciated, I would read through the
> testslonystate script and see for myself what queries it's running to
> determine current state. Then I would either tweak the script to use
> DBD::Pg or even pull out the bits that I care about and put it in a
> simple bash or sql script of my own...

Let me note that there is a parallel script in the tools directory
which uses DBD::Pg instead of Pg.pm.  You don't need to rewrite the
Pg.pm version; that has *already been done*, and contributed to the
tools directory.
-- 
(format nil "~S@~S" "cbbrowne" "acm.org")
http://linuxfinances.info/info/sgml.html
"I  worry that  the person  who thought  up Muzak  may be  thinking up
something else." -- Lily Tomlin

From lists at serioustechnology.com  Tue Sep 23 11:03:07 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Tue Sep 23 11:03:17 2008
Subject: [Slony1-general] How to determine when the target has caughtup
	to	the origin
In-Reply-To: <883AB1DC-B9F9-445E-B3D9-3B56218C65CE@kevinkempterllc.com>
References: <8536F69C1FCC294B859D07B179F069440F974EBD@EXCHANGE.ad.wsicorp.com><72dbd3150809221346j51bfd907xf7a43d06dfc954c@mail.gmail.com><8536F69C1FCC294B859D07B179F069440F97518A@EXCHANGE.ad.wsicorp.com>	<20080923135541.GC18302@crankycanuck.ca>	<8536F69C1FCC294B859D07B179F069440F9753DF@EXCHANGE.ad.wsicorp.com>
	<883AB1DC-B9F9-445E-B3D9-3B56218C65CE@kevinkempterllc.com>
Message-ID: <48D92F5B.9050303@serioustechnology.com>

kevin kempter wrote:
> Just a thought:
> 
> 
> Given that Pg.pm is depreciated, I would read through the testslonystate 
> script and see for myself what queries it's running to determine current 
> state. Then I would either tweak the script to use DBD::Pg or even pull 
> out the bits that I care about and put it in a simple bash or sql script 
> of my own...

Based on my personal experience with Pg.pm, I'd install Pg.pm and leave 
the testslonystate script as it is.  Although Pg.pm is deprecated, it 
works fine for us and as I've noted in a previous post, we use it quite 
extensively with no problems.

-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From cbbrowne at ca.afilias.info  Tue Sep 23 11:27:31 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Tue Sep 23 11:27:41 2008
Subject: [Slony1-general] How to determine when the target has caughtup to
	the origin
In-Reply-To: <8536F69C1FCC294B859D07B179F069440F9755A8@EXCHANGE.ad.wsicorp.com>
	(Doug Knight's message of "Tue, 23 Sep 2008 13:54:02 -0400")
References: <8536F69C1FCC294B859D07B179F069440F974EBD@EXCHANGE.ad.wsicorp.com>
	<72dbd3150809221346j51bfd907xf7a43d06dfc954c@mail.gmail.com>
	<8536F69C1FCC294B859D07B179F069440F97518A@EXCHANGE.ad.wsicorp.com>
	<20080923135541.GC18302@crankycanuck.ca>
	<8536F69C1FCC294B859D07B179F069440F9753DF@EXCHANGE.ad.wsicorp.com>
	<883AB1DC-B9F9-445E-B3D9-3B56218C65CE@kevinkempterllc.com>
	<873ajqu51m.fsf@dba2.int.libertyrms.com>
	<8536F69C1FCC294B859D07B179F069440F9755A8@EXCHANGE.ad.wsicorp.com>
Message-ID: <87skrqsooc.fsf@dba2.int.libertyrms.com>

"Knight, Doug" <dknight@wsi.com> writes:
> What's the name of the parallel script?

There are two scripts in the tools directory:
 test_slony_state-dbi.pl
 test_slony_state.pl

Guess which one uses Pg, and which one uses DBI?
-- 
let name="cbbrowne" and tld="ca.afilias.info" in name ^ "@" ^ tld;;
<http://dba2.int.libertyrms.com/>
Christopher Browne
(416) 673-4124 (land)
From lists at serioustechnology.com  Tue Sep 23 11:36:37 2008
From: lists at serioustechnology.com (Geoffrey)
Date: Tue Sep 23 11:36:50 2008
Subject: [Slony1-general] How to determine when the target has caughtup
	to	the origin
In-Reply-To: <87skrqsooc.fsf@dba2.int.libertyrms.com>
References: <8536F69C1FCC294B859D07B179F069440F974EBD@EXCHANGE.ad.wsicorp.com>	<72dbd3150809221346j51bfd907xf7a43d06dfc954c@mail.gmail.com>	<8536F69C1FCC294B859D07B179F069440F97518A@EXCHANGE.ad.wsicorp.com>	<20080923135541.GC18302@crankycanuck.ca>	<8536F69C1FCC294B859D07B179F069440F9753DF@EXCHANGE.ad.wsicorp.com>	<883AB1DC-B9F9-445E-B3D9-3B56218C65CE@kevinkempterllc.com>	<873ajqu51m.fsf@dba2.int.libertyrms.com>	<8536F69C1FCC294B859D07B179F069440F9755A8@EXCHANGE.ad.wsicorp.com>
	<87skrqsooc.fsf@dba2.int.libertyrms.com>
Message-ID: <48D93735.2070807@serioustechnology.com>

Christopher Browne wrote:
> "Knight, Doug" <dknight@wsi.com> writes:
>> What's the name of the parallel script?
> 
> There are two scripts in the tools directory:
>  test_slony_state-dbi.pl
>  test_slony_state.pl
> 
> Guess which one uses Pg, and which one uses DBI?

:)


-- 
Until later, Geoffrey

Those who would give up essential Liberty, to purchase a little
temporary Safety, deserve neither Liberty nor Safety.
  - Benjamin Franklin
From abrown at bzzagent.com  Tue Sep 23 12:00:47 2008
From: abrown at bzzagent.com (Aaron Brown)
Date: Tue Sep 23 12:01:01 2008
Subject: [Slony1-general] Table Replication and Log Shipping
In-Reply-To: <48D81213.7040003@stanford.edu>
Message-ID: <C4FEB51F.85A0%abrown@bzzagent.com>

Thanks for the input.

The truncate is what slony would send to a subscriber in order to clear out
the existing table before copying it.  I am not manually executing the
truncate.  This happens when you execute a subscribe set.  Basically, the
issue I need to understand is this: when I first replicate a table with data
in it, will the table truncate and copy as if it were a regular subscriber,
or do I need to do something special to the log shipped node.

Thinking back, I think you can ignore most of my original question and it
boils down to this: if I have a new table to replicate with data in it, will
the subscriber receive the initial truncate and copy, or do I need to "do
something?"

Thanks for your help!
Aaron


On 9/22/08 5:45 PM, "Jennifer Spencer" <jennifer.spencer@stanford.edu>
wrote:

> Hi Aaron,
> 
> It would be pretty easy to check the truncate behavior by running another slon
> process, with a test
> cluster and table, and trying it out.  I myself don't know if "truncate" is
> something Slony explicitly
> supports (and I am guessing not).
> 
> I'd think about it this way: the log shipping process is only another "slon"
> process (with an archive
> flag -a to save out all the commands issued by the slon).  If your existing
> slon process to your
> regular subscribers won't do what you want (truncate), then your slon -a (log
> shipping) won't do it
> either.  If it will, then the slon -a should also.  See what I mean?
> 
> I assume from your mail that you are going to have your subscribers issue a
> "truncate" on their end,
> and do some sort of external-to-Slony process to re-replicate the table in
> question?  Treat your
> log-shipping subscriber the same as your regular subscribers.  Just before you
> truncate and munge your
> data, turn off your slon -a process.  You should note the log number in
> _yourclustername.sl_archive_tracking when you turn off your slon.  Make sure
> to send that number to
> your remote log subscriber.  He'll need to ingest the last CORRECT pre-munge
> log (that number you're
> going to send him), and then turn off his log-ingest process after that.  Then
> he would do the 
> truncate on the data table, receive and ingest a new set of munged data from
> you (via your copy
> out/his copy in or another re-replication process you had in mind).  You then
> restart your log-ship
> slon -a process, and then he'll restart his log-ingest process.  Just make
> sure not to make other
> changes to other tables when your slon -a is inactive.
> 
> Hope this helps.
> -Jennifer
> 
> Aaron Brown wrote:
>> List,
>> 
>> I have a large table (16 million rows), that I need to pull out of
>> replication, do some munging, and then rereplicate (in a new set) as part of
>> a release.  To explain better, the process will be to drop the table (which
>> is in set 2) from replication, run a large stored procedure that munges the
>> data, then rereplicate the table by adding it to a new set (set 12).  The
>> subscribers obviously truncate the table and rereplicate the entire table.
>> This process works fine.
>> 
>> The catch here is that we have a remote log shipped node off of one of the
>> subscribers.  I know the schema changes themselves do not propagate.  What
>> I?m unclear on is whether or not the log shipping archive files will contain
>> the TRUNCATE and COPY statements to recreate this table, or if I will have
>> to do something (like recreate the remote node from scratch) to make that
>> happen? 
>> 
>> Thanks ? any help you can provide is appreciated.  If you need more
>> specifics or configs, please let me know.
>> 
>> Aaron
>> 
>> 
>> 
>> ------------------------------------------------------------------------
>> 
>> _______________________________________________
>> Slony1-general mailing list
>> Slony1-general@lists.slony.info
>> http://lists.slony.info/mailman/listinfo/slony1-general


-------------------------------------------------------
Aaron Brown, Systems Engineer
BzzAgent, Inc. | www.bzzagent.com
abrown@bzzagent.com | 617.451.2280
------------------------------------------------------- 

From dknight at wsi.com  Wed Sep 24 07:04:45 2008
From: dknight at wsi.com (Knight, Doug)
Date: Wed Sep 24 07:04:52 2008
Subject: [Slony1-general] Using EXECUTE SCRIPT for adding time partitioned
	tables
Message-ID: <8536F69C1FCC294B859D07B179F069440FA332D7@EXCHANGE.ad.wsicorp.com>

All,

We use time partitioned tables quite extensively (day boundaries). I've
looked at the documentation concerning support for partitioned tables,
and understand the process steps (EXECUTE SCRIPT, CREATE SET, SET ADD
TABLE, SUBSCRIBE SET, SYNC, WAIT FOR EVENT, MERGE SET). I have two
questions about this process: 1) What set ID do I use in the EXECUTE
SCRIPT command, the target set to which I'm merging or the new temporary
set I'm creating for the merge?; 2) Does the temporary set ID go away
(i.e. can be resued) after executing the MERGE SET?

 

Also, is there an easy way to determine what would be the next unique
table ID, assuming all of my table IDs are allocated sequentially
starting at 1? The goal of these questions is to support an automated
process to handle the daily addition of time partitioned tables.

 

Thanks,

Doug Knight

WSI Corp.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080924/fb4248a0/attachment.htm
From cbbrowne at ca.afilias.info  Wed Sep 24 07:28:58 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed Sep 24 07:29:04 2008
Subject: [Slony1-general] Using EXECUTE SCRIPT for adding time partitioned
	tables
In-Reply-To: <8536F69C1FCC294B859D07B179F069440FA332D7@EXCHANGE.ad.wsicorp.com>
	(Doug Knight's message of "Wed, 24 Sep 2008 10:04:45 -0400")
References: <8536F69C1FCC294B859D07B179F069440FA332D7@EXCHANGE.ad.wsicorp.com>
Message-ID: <87abdxsjmd.fsf@dba2.int.libertyrms.com>

"Knight, Doug" <dknight@wsi.com> writes:
>       :o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns="http://www.w3.org/TR/REC-html40">
>
> 								     All,:p>
>
> We use time partitioned tables quite extensively (day boundaries). I've looked at the documentation concerning support for partitioned tables, and
>   understand the process steps (EXECUTE SCRIPT, CREATE SET, SET ADD TABLE, SUBSCRIBE SET, SYNC, WAIT FOR EVENT, MERGE SET). I have two questions
>    about this process: 1) What set ID do I use in the EXECUTE SCRIPT command, the target set to which I'm merging or the new temporary set I'm
> 	       creating for the merge?; 2) Does the temporary set ID go away (i.e. can be resued) after executing the MERGE SET?:p>


1.  Which set you use for EXECUTE SCRIPT isn't very important; it used
to be used to indicate which set's tables would be "unlocked from
replication," but that proved error-prone, so *all* tables get taken
out of replication mode during EXECUTE SCRIPT.

2.  Yes, the temporary set ID does indeed go away after running MERGE
SET.

>  Also, is there an easy way to determine what would be the next
>  unique table ID, assuming all of my table IDs are allocated
>  sequentially starting > at 1? The goal of these questions is to
>  support an automated process to handle the daily addition of time
>  partitioned tables.:p>

The best I can think of is to run a query that finds max(tab_id) from
sl_table, and add 1 to that.  There is no sequence used for the table
ID, so there isn't anything built-in that would specifically help with
this.
-- 
output = ("cbbrowne" "@" "linuxdatabases.info")
http://cbbrowne.com/info/
"In order to make an apple pie from scratch, you must first create the
universe."  -- Carl Sagan, Cosmos
From jerome at jfg-networks.net  Wed Sep 24 07:35:18 2008
From: jerome at jfg-networks.net (=?ISO-8859-1?Q?J=E9r=F4me_Jouanin?=)
Date: Wed Sep 24 07:35:23 2008
Subject: [Slony1-general] Best way to send data between two remotes masters
	of slony cluster ?
Message-ID: <210e1e060809240735q5931cf3fob650d7ec522f4ce0@mail.gmail.com>

Hi,
We have a first site with a cluster of 1 master and 9 slaves replicated by
Slony.
We planned to build a remote backup site with the same configuration.
The network link between these two sites will be Gb.
By reading documentation, I'm going to activate slony's log shipping to send
data from local master to remote master.
Is it the best way to send data between a local master and a remote master
of slony independents clusters ?

Thanks
J=E9r=F4me Jouanin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080924/=
8b11dc74/attachment.htm
From ajs at crankycanuck.ca  Wed Sep 24 07:42:14 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Wed Sep 24 07:42:22 2008
Subject: [Slony1-general] Best way to send data between two remotes
	masters of slony cluster ?
In-Reply-To: <210e1e060809240735q5931cf3fob650d7ec522f4ce0@mail.gmail.com>
References: <210e1e060809240735q5931cf3fob650d7ec522f4ce0@mail.gmail.com>
Message-ID: <20080924144214.GA58352@crankycanuck.ca>

On Wed, Sep 24, 2008 at 04:35:18PM +0200, J?r?me Jouanin wrote:
> Hi,
> We have a first site with a cluster of 1 master and 9 slaves replicated by
> Slony.
> We planned to build a remote backup site with the same configuration.
> The network link between these two sites will be Gb.
> By reading documentation, I'm going to activate slony's log shipping to send
> data from local master to remote master.
> Is it the best way to send data between a local master and a remote master
> of slony independents clusters ?

Why not just replicate to the remote site from one (or, I'd suggest,
>1) of the replicas in the first site?  This way you don't have to
fool around with log shipping, which is a little less good with the
feedback.  

A

-- 
Andrew Sullivan
ajs@commandprompt.com
+1 503 667 4564 x104
http://www.commandprompt.com/
From jerome at jfg-networks.net  Wed Sep 24 08:16:24 2008
From: jerome at jfg-networks.net (=?ISO-8859-1?Q?J=E9r=F4me_Jouanin?=)
Date: Wed Sep 24 08:16:31 2008
Subject: [Slony1-general] Best way to send data between two remotes
	masters of slony cluster ?
In-Reply-To: <20080924144214.GA58352@crankycanuck.ca>
References: <210e1e060809240735q5931cf3fob650d7ec522f4ce0@mail.gmail.com>
	<20080924144214.GA58352@crankycanuck.ca>
Message-ID: <210e1e060809240816ocedc6f0mef779778db1fe1b0@mail.gmail.com>

Because Slony documentation warns : *"Reasonable,"** in this context, is on
the order of a dozen servers. If the number of servers grows beyond that,
the cost of communications increases prohibitively, and the incremental
benefits of having multiple servers will be falling off at that point.*
Moreover, I think a remote site could not have the same level of network
availability than a LAN, because of external constraints. And I think that
isolation is preferable in this case.
Isn't it ?
J
2008/9/24 Andrew Sullivan <ajs@crankycanuck.ca>

> On Wed, Sep 24, 2008 at 04:35:18PM +0200, J=E9r=F4me Jouanin wrote:
> > Hi,
> > We have a first site with a cluster of 1 master and 9 slaves replicated
> by
> > Slony.
> > We planned to build a remote backup site with the same configuration.
> > The network link between these two sites will be Gb.
> > By reading documentation, I'm going to activate slony's log shipping to
> send
> > data from local master to remote master.
> > Is it the best way to send data between a local master and a remote
> master
> > of slony independents clusters ?
>
> Why not just replicate to the remote site from one (or, I'd suggest,
> >1) of the replicas in the first site?  This way you don't have to
> fool around with log shipping, which is a little less good with the
> feedback.
>
> A
>
> --
> Andrew Sullivan
> ajs@commandprompt.com
> +1 503 667 4564 x104
> http://www.commandprompt.com/
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080924/=
c187b985/attachment.htm
From stephane.schildknecht at postgresqlfr.org  Wed Sep 24 08:23:24 2008
From: stephane.schildknecht at postgresqlfr.org (=?UTF-8?B?IlN0w6lwaGFuZSBBLiBTY2hpbGRrbmVjaHQi?=)
Date: Wed Sep 24 08:23:37 2008
Subject: [Slony1-general] Best way to send data between two remotes	masters
	of slony cluster ?
In-Reply-To: <210e1e060809240816ocedc6f0mef779778db1fe1b0@mail.gmail.com>
References: <210e1e060809240735q5931cf3fob650d7ec522f4ce0@mail.gmail.com>	<20080924144214.GA58352@crankycanuck.ca>
	<210e1e060809240816ocedc6f0mef779778db1fe1b0@mail.gmail.com>
Message-ID: <48DA5B6C.2060009@postgresqlfr.org>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

J?r?me Jouanin a ?crit :
> Because Slony documentation warns : /"Reasonable,"// in this context, is
> on the order of a dozen servers. If the number of servers grows beyond
> that, the cost of communications increases prohibitively, and the
> incremental benefits of having multiple servers will be falling off at
> that point./
> Moreover, I think a remote site could not have the same level of network
> availability than a LAN, because of external constraints. And I think
> that isolation is preferable in this case.
> Isn't it ?
> J

Maybe you could have a remote replication cluster whom master only knows and
communicate with your major replication master.

You could then have something like :

1
\- 11
   \- 113
   \- 114
   \- 115
\- 21
   \- 211
   \- 212

And just let 21 know about 1. 211 and 212 would only know about 21.

That could be a way to not let inter-node communication speed down your
replication.

Best regards,
- --
St?phane Schildknecht
PostgreSQLFr : http://www.postgresql.fr

Venez nous rencontrer le 4 octobre lors du plus important ?v?nement
PostgreSQL francophone : http://www.pgday.fr

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFI2ltsA+REPKWGI0ERAsqSAKC1meZkDKVirS+6h6+U+5RwwgiosACgvh5a
ySI2HAlLipQ7d+QpO9JsbYY=
=1rn1
-----END PGP SIGNATURE-----
From ajs at crankycanuck.ca  Wed Sep 24 09:04:07 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Wed Sep 24 09:04:18 2008
Subject: [Slony1-general] Best way to send data between two remotes
	masters of slony cluster ?
In-Reply-To: <210e1e060809240816ocedc6f0mef779778db1fe1b0@mail.gmail.com>
References: <210e1e060809240735q5931cf3fob650d7ec522f4ce0@mail.gmail.com>
	<20080924144214.GA58352@crankycanuck.ca>
	<210e1e060809240816ocedc6f0mef779778db1fe1b0@mail.gmail.com>
Message-ID: <20080924160407.GB58352@crankycanuck.ca>

On Wed, Sep 24, 2008 at 05:16:24PM +0200, J?r?me Jouanin wrote:
> Because Slony documentation warns : *"Reasonable,"** in this context, is on
> the order of a dozen servers. If the number of servers grows beyond that,
> the cost of communications increases prohibitively, and the incremental
> benefits of having multiple servers will be falling off at that point.*

I think you can be selective in who talks to whom, and keep the costs
under control.  But yes, if you add too many replicas, it'll be expensive.

> Moreover, I think a remote site could not have the same level of network
> availability than a LAN, because of external constraints. And I think that
> isolation is preferable in this case.
> Isn't it ?

The network issue, if your WAN is reasonably reliable, shouldn't be a
problem.  The isolation issue is your call, depending on your needs.

A

-- 
Andrew Sullivan
ajs@commandprompt.com
+1 503 667 4564 x104
http://www.commandprompt.com/
From cbbrowne at ca.afilias.info  Wed Sep 24 09:25:37 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed Sep 24 09:25:46 2008
Subject: [Slony1-general] Best way to send data between two remotes
	masters of slony cluster ?
In-Reply-To: <210e1e060809240816ocedc6f0mef779778db1fe1b0@mail.gmail.com>
	(=?iso-8859-1?Q?J=E9r=F4me?= Jouanin's message of "Wed, 24 Sep 2008
	17:16:24 +0200")
References: <210e1e060809240735q5931cf3fob650d7ec522f4ce0@mail.gmail.com>
	<20080924144214.GA58352@crankycanuck.ca>
	<210e1e060809240816ocedc6f0mef779778db1fe1b0@mail.gmail.com>
Message-ID: <87y71hqzni.fsf@dba2.int.libertyrms.com>

"J?r?me Jouanin" <jerome@jfg-networks.net> writes:
> Because Slony documentation warns : "Reasonable," in this context,
> is on the order of a dozen servers. If the number of servers grows
> beyond that, the cost of communications increases prohibitively, and
> the incremental benefits of having multiple servers will be falling
> off at that point.  Moreover, I think a remote site could not have
> the same level of network availability than a LAN, because of
> external constraints. And I think that isolation is preferable in
> this case.  Isn't it ?

If it's remote, then it's remote.

If you expect to have trouble getting data across the WAN to feed an
active Slony-I node, then I wouldn't expect log shipping to be
terribly much easier.  If either approach turns out to be problematic,
I'd expect the other to be, too.

Log shipping isn't particularly less fragile; it introduces additional
"moving parts" in that you need to move the log files across the WAN.

Actually, part of what I'd question is why it seems a good idea to
have 10 replicas in the first place, at the "main" site.
-- 
(format nil "~S@~S" "cbbrowne" "linuxfinances.info")
http://www3.sympatico.ca/cbbrowne/wp.html
"war is an inappropriate analogy; ``flame war'' is a misnomer.
 in any usenet exchange, the only casualty is time.
 there are better uses for regret."
    --thi <ttn@netcom.com>
From cbbrowne at ca.afilias.info  Wed Sep 24 12:01:38 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed Sep 24 12:01:49 2008
Subject: [Slony1-general] Re: [Slony1-bugs] [Bug 46] New 8.4 #include -
	utils/snapmgr.h
In-Reply-To: <20080924185701.9F932290F4D@main.slony.info>
	(slony1-bugs@lists.slony.info's message of "Wed, 24 Sep 2008 11:57:01
	-0700 (PDT)")
References: <20080924185701.9F932290F4D@main.slony.info>
Message-ID: <87k5d1qsfh.fsf@dba2.int.libertyrms.com>

slony1-bugs@lists.slony.info writes:
> http://www.slony.info/bugzilla/show_bug.cgi?id=46
> --- Comment #3 from Christopher Browne <cbbrowne@ca.afilias.info>  2008-09-24 11:57:00 ---
> Created an attachment (id=22)
>  --> (http://www.slony.info/bugzilla/attachment.cgi?id=22)
> Newer patch to Slony-I to run against 8.4 - uses new GetActiveSnapshot()
> function
>
> Attached is a newer patch.
>
> This needs to be modified somewhat to address the fact that 8.3 expects the
> former form, and 8.4 expects the new form.  I'll discuss that on-list.

We have the change in 8.4 that SerializableSnapshot has gone away,
with the effective replacement being the new function,
GetActiveSnapshot().

-       if (SerializableSnapshot == NULL)
-               elog(ERROR, "Slony-I: SerializableSnapshot is NULL in createEvent()");
+       if (GetActiveSnapshot() == NULL)
+               elog(ERROR, "Slony-I: ActiveSnapshot is NULL in createEvent()");

I ran some of the tests against CVS HEAD with this with success.

The open question is how best to detect that we should be using
GetActiveSnapshot() rather than SerializableSnapshot.  

Shall I detect that in configure?  That seems apropos.
-- 
output = ("cbbrowne" "@" "cbbrowne.com")
http://linuxfinances.info/info/linux.html
I'm sure  glad we're having this "How  many FTP transfers can dance on
the  head of a  chargeback   packet"  conversation now, because   when
chargebacks  happen, it  will surely  be too  expensive to  read these
amazing conversations.
From cbbrowne at ca.afilias.info  Wed Sep 24 15:12:56 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed Sep 24 15:13:11 2008
Subject: [Slony1-general] Release Candidate RC2 for 2.0.0
Message-ID: <87d4itqjkn.fsf@dba2.int.libertyrms.com>

See http://slony.info for details of the changes in RC2...
-- 
(reverse (concatenate 'string "moc.enworbbc" "@" "enworbbc"))
http://cbbrowne.com/info/multiplexor.html
"Absolutely nothing should be concluded from these figures except that
no  conclusion can be  drawn from  them."  
-- By Joseph L. Brothers, Linux/PowerPC Project
From jerome at jfg-networks.net  Fri Sep  5 05:36:05 2008
From: jerome at jfg-networks.net (=?ISO-8859-1?Q?J=E9r=F4me_Jouanin?=)
Date: Thu Sep 25 08:27:04 2008
Subject: [Slony1-general] Error Unable to disable triggers in move set
Message-ID: <210e1e060809050536q49d5c6f5w29f8ce994cd7bce@mail.gmail.com>

Hi,
The environment is Linux Debian Etch, PG8.3.3 and SlonyI 1.2.13.
The problem I have actually is in execution of slonik_move_set :
*<stdin>:12: Locking down set 1 on node 24
<stdin>:14: Locked down - moving it
<stdin>:15: NOTICE:  Slony-I: alterTableForReplication(): multiple instances
of trigger $TRIGGER on table $TABLE
CONTEXT:  SQL statement "SELECT  "$SLONY_SCHEMA".alterTableForReplication(
$1 )"
PL/pgSQL function "moveset_int" line 181 at PERFORM
...
<stdin>:15: PGRES_FATAL_ERROR select "$SLONY_SCHEMA".moveSet(1, 22);  -
ERROR:  Slony-I: Unable to disable triggers
CONTEXT:  SQL statement "SELECT  "$SLONY_SCHEMA".alterTableForReplication(
$1 )"
PL/pgSQL function "moveset_int" line 181 at PERFORM
SQL statement "SELECT  "$SLONY_SCHEMA".moveSet_int( $1 ,  $2 ,  $3 , 0)"
PL/pgSQL function "moveset" line 61 at PERFORM*

In Slony documentation I've read this :

   -

   *NOTICE: Slony-I: alterTableForReplication(): multiple instances of
   trigger % on table %'',*

   * This normally happens if you have a table that had a trigger attached
   to it that replication hid due to this being a subscriber node, and then=
 you
   added a trigger by the same name back to replication. Now, when trying to
   "fix up" triggers, those two triggers conflict. *

   * The DDL script will keep running and rerunning, or the UNINSTALL NODE
   will keep failing, until you drop the "visible" trigger, by hand, much as
   you must have added it, by hand, earlier. *
   -

   *ERROR: Slony-I: Unable to disable triggers*

   * This is the error that follows the "multiple triggers" problem. *

An history mistake was a possibility, but executing the select of
altertableforreplication trigger ...

*select pc.relname, tg1.tgname from
"pg_catalog".pg_trigger tg1,
"pg_catalog".pg_trigger tg2,
"pg_catalog".pg_class pc,
"pg_catalog".pg_index pi,
_ob2replication.sl_table tab
where
tg1.tgname =3D tg2.tgname and        -- Trigger names match
tg1.tgrelid =3D tab.tab_reloid and   -- trigger 1 is on the table
pi.indexrelid =3D tg2.tgrelid and    -- trigger 2 is on the index
pi.indrelid =3D tab.tab_reloid and   -- indexes table is this table
pc.oid =3D tab.tab_reloid*

... returns no result on spare server to move set to.

Has anybody an idea about my problem ?

Thx
J=E9r=F4me Jouanin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080905/=
07f8d1e0/attachment-0001.htm
From magnus at hagander.net  Fri Sep 19 07:29:54 2008
From: magnus at hagander.net (Magnus Hagander)
Date: Thu Sep 25 08:27:35 2008
Subject: [Slony1-general] Re: Slony 2.0 on windows(MinGW)
In-Reply-To: <009b01c91a63$52374c50$0d01a8c0@IBMC9A0F63B40D>
References: <009b01c91a63$52374c50$0d01a8c0@IBMC9A0F63B40D>
Message-ID: <48D3B762.5080106@hagander.net>

Hiroshi Saito wrote:
> Hi.
> 
> Referring to the SessionReplicationRole had a problem.:-(
> It seems that a relation is unsavory at include of PostgreSQL.
> Then, It is avoidable by ad hoc patch....
> However, Either is expected better solution. What do you think?
> Regards,
> Hiroshi Saito

Seems like the proper fix would be to add PGDLLIMPORT to the define in
the PostgreSQL sources, no?

If you do that directly in those, does it also work?

//Magnus

From magnus at hagander.net  Fri Sep 19 07:35:22 2008
From: magnus at hagander.net (Magnus Hagander)
Date: Thu Sep 25 08:27:35 2008
Subject: [Slony1-general] Re: Slony 2.0 on windows(MinGW)
In-Reply-To: <00b901c91a64$7f5f3ed0$0d01a8c0@IBMC9A0F63B40D>
References: <009b01c91a63$52374c50$0d01a8c0@IBMC9A0F63B40D>
	<48D3B762.5080106@hagander.net>
	<00b901c91a64$7f5f3ed0$0d01a8c0@IBMC9A0F63B40D>
Message-ID: <48D3B8AA.9020109@hagander.net>

Well, it's certainly the right thing to do - things that are supposed to
be accessed externally on win32 should always be marked as PGDLLIMPORT.

//Magnus

Hiroshi Saito wrote:
> Hi.
> 
> Yes!:-)
> However, whether it is a good method does not have clear it.
> 
>> Seems like the proper fix would be to add PGDLLIMPORT to the define in
>> the PostgreSQL sources, no?
>>
>> If you do that directly in those, does it also work?
>>
>> //Magnus
>>

From magnus at hagander.net  Fri Sep 19 07:44:06 2008
From: magnus at hagander.net (Magnus Hagander)
Date: Thu Sep 25 08:27:36 2008
Subject: [Slony1-general] Re: Slony 2.0 on windows(MinGW)
In-Reply-To: <00db01c91a65$6f47b800$0d01a8c0@IBMC9A0F63B40D>
References: <009b01c91a63$52374c50$0d01a8c0@IBMC9A0F63B40D>
	<48D3B762.5080106@hagander.net>
	<00b901c91a64$7f5f3ed0$0d01a8c0@IBMC9A0F63B40D>
	<48D3B8AA.9020109@hagander.net>
	<00db01c91a65$6f47b800$0d01a8c0@IBMC9A0F63B40D>
Message-ID: <48D3BAB6.9060701@hagander.net>

Committed to the backend ;-) Unfortunately, it just missed the new release..

//Magnus

Hiroshi Saito wrote:
> Ok, Solution was left to you.:-)
> Then, is it good?
>> Well, it's certainly the right thing to do - things that are supposed to
>> be accessed externally on win32 should always be marked as PGDLLIMPORT.

From magnus at hagander.net  Fri Sep 19 07:49:41 2008
From: magnus at hagander.net (Magnus Hagander)
Date: Thu Sep 25 08:27:36 2008
Subject: [Slony1-general] Re: Slony 2.0 on windows(MinGW)
In-Reply-To: <010601c91a66$cd0df480$0d01a8c0@IBMC9A0F63B40D>
References: <009b01c91a63$52374c50$0d01a8c0@IBMC9A0F63B40D>
	<48D3B762.5080106@hagander.net>
	<00b901c91a64$7f5f3ed0$0d01a8c0@IBMC9A0F63B40D>
	<48D3B8AA.9020109@hagander.net>
	<00db01c91a65$6f47b800$0d01a8c0@IBMC9A0F63B40D>
	<48D3BAB6.9060701@hagander.net>
	<010601c91a66$cd0df480$0d01a8c0@IBMC9A0F63B40D>
Message-ID: <48D3BC05.1030209@hagander.net>

Hiroshi Saito wrote:
> ----- Original Message ----- From: "Magnus Hagander" <magnus@hagander.net>
> 
> 
>> Committed to the backend ;-) Unfortunately, it just missed the new
>> release..
> 
> Ahh... However, Slony 2.0 is still the release candidate 1. And
> discussion will be helpful here.!

Yeah. It might be worthwhile sticking something temporary in Slony just
to make it possible to build and test the RC until the next pg is out...

//Magnus
From cbbrowne at ca.afilias.info  Thu Sep 25 08:36:53 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Thu Sep 25 08:37:00 2008
Subject: [Slony1-general] Sudden flow of some ancient messages???
Message-ID: <87wsh0p78q.fsf@dba2.int.libertyrms.com>

I'm seeing a "bounty" of pretty old messages (I'm seeing material from
as far back as November 2007); did someone reconfigure a mail server
somewhere that might have been holding onto old messages?
-- 
let name="cbbrowne" and tld="acm.org" in name ^ "@" ^ tld;;
http://www3.sympatico.ca/cbbrowne/linuxdistributions.html
No one ever says, "Hey, I can't read that ASCII attachment you sent
me."
From ajs at commandprompt.com  Thu Sep 25 08:27:34 2008
From: ajs at commandprompt.com (Andrew Sullivan)
Date: Thu Sep 25 08:37:40 2008
Subject: [Slony1-general] List admin
Message-ID: <20080925152733.GA284@commandprompt.com>

Dear colleagues,

It is with some embarassment that I have just discovered nobody was
performing the administration of this (or any other Slony) list for
some time.  I just approved a great whack of outstanding moderation
requests.  Sorry if any of these are duplicates.

A

-- 
Andrew Sullivan
ajs@commandprompt.com
+1 503 667 4564 x104
http://www.commandprompt.com/
From cbbrowne at ca.afilias.info  Thu Sep 25 08:40:48 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Thu Sep 25 08:40:56 2008
Subject: [Slony1-general] Applying schema changes in slony
In-Reply-To: <15627246.post@talk.nabble.com> (TroyWolf's message of "Thu, 21
	Feb 2008 19:58:28 -0800 (PST)")
References: <8d89ea1d0712191837s76f03d6bva36f61b3800c7afd@mail.gmail.com>
	<516869C8-1F93-4F13-82A9-D8305A95DFF6@pandora.com>
	<15627246.post@talk.nabble.com>
Message-ID: <87prmsp727.fsf@dba2.int.libertyrms.com>

TroyWolf <troy@troywolf.com> writes:

> Casey Duncan wrote:
>> 
>> - Use many small table sets instead of one big one. This means you  
>> may need multiple execute script statements, but each one will lock  
>> fewer tables at once.
>
> See this note from the middle of this page of the Slony Documentation:
> http://slony.info/documentation/ddlchanges.html
>
> Slony Documentation wrote:
>> 
>> You may be able to define replication sets that consist of smaller sets of
>> tables so that fewer locks need to be taken in order for the DDL script to
>> make it into place.
>> 
>> If a particular DDL script only affects one table, it should be
>> unnecessary to lock all application tables.
>> 
>>     Note: Actually, as of version 1.1.5 and later, this is NOT TRUE. The
>> danger of someone making DDL changes that crosses replication sets seems
>> sufficiently palpable that slon has been changed to lock ALL replicated
>> tables, whether they are in the specified replication set or not. 
>> 
> If I'm reading the docs correctly, breaking tables into multiple table sets
> no longer helps with locking issues. Correct?

Correct.
-- 
output = reverse("gro.mca" "@" "enworbbc")
http://cbbrowne.com/info/nonrdbms.html
"One often contradicts  an opinion when what is  uncongenial is really
the tone in which it was conveyed." -- Nietzsche
From ajs at commandprompt.com  Thu Sep 25 08:54:00 2008
From: ajs at commandprompt.com (Andrew Sullivan)
Date: Thu Sep 25 08:54:11 2008
Subject: [Slony1-general] Sudden flow of some ancient messages???
In-Reply-To: <87wsh0p78q.fsf@dba2.int.libertyrms.com>
References: <87wsh0p78q.fsf@dba2.int.libertyrms.com>
Message-ID: <20080925155400.GB284@commandprompt.com>

On Thu, Sep 25, 2008 at 11:36:53AM -0400, Christopher Browne wrote:
> I'm seeing a "bounty" of pretty old messages (I'm seeing material from
> as far back as November 2007); did someone reconfigure a mail server
> somewhere that might have been holding onto old messages?

No.  See my other note.  Turns out there's been no moderation.  We
could use more volunteers :)

A

-- 
Andrew Sullivan
ajs@commandprompt.com
+1 503 667 4564 x104
http://www.commandprompt.com/
From jerome at jfg-networks.net  Thu Sep 25 09:14:44 2008
From: jerome at jfg-networks.net (=?ISO-8859-1?Q?J=E9r=F4me_Jouanin?=)
Date: Thu Sep 25 09:14:52 2008
Subject: [Slony1-general] Best way to send data between two remotes
	masters of slony cluster ?
In-Reply-To: <87y71hqzni.fsf@dba2.int.libertyrms.com>
References: <210e1e060809240735q5931cf3fob650d7ec522f4ce0@mail.gmail.com>
	<20080924144214.GA58352@crankycanuck.ca>
	<210e1e060809240816ocedc6f0mef779778db1fe1b0@mail.gmail.com>
	<87y71hqzni.fsf@dba2.int.libertyrms.com>
Message-ID: <210e1e060809250914q7478c791l2fab0658568a60c8@mail.gmail.com>

Ok thanks for these feedbacks.
I've understand important elements :
1 - I can tune store path
2 - logshipping is not adapted for warm-standby-like replication.

Why it seems a good idea to have 10 replicas at the "main" site ? Because
our production consists of several octocore / 24Go to serve 1000 queries /
sec and we have lag time constraint to replicate data <10sec. And obviously
we have backup databases at our main site.

J
2008/9/24 Christopher Browne <cbbrowne@ca.afilias.info>

> "J=E9r=F4me Jouanin" <jerome@jfg-networks.net> writes:
> > Because Slony documentation warns : "Reasonable," in this context,
> > is on the order of a dozen servers. If the number of servers grows
> > beyond that, the cost of communications increases prohibitively, and
> > the incremental benefits of having multiple servers will be falling
> > off at that point.  Moreover, I think a remote site could not have
> > the same level of network availability than a LAN, because of
> > external constraints. And I think that isolation is preferable in
> > this case.  Isn't it ?
>
> If it's remote, then it's remote.
>
> If you expect to have trouble getting data across the WAN to feed an
> active Slony-I node, then I wouldn't expect log shipping to be
> terribly much easier.  If either approach turns out to be problematic,
> I'd expect the other to be, too.
>
> Log shipping isn't particularly less fragile; it introduces additional
> "moving parts" in that you need to move the log files across the WAN.
>
> Actually, part of what I'd question is why it seems a good idea to
> have 10 replicas in the first place, at the "main" site.
> --
> (format nil "~S@~S" "cbbrowne" "linuxfinances.info")
> http://www3.sympatico.ca/cbbrowne/wp.html
> "war is an inappropriate analogy; ``flame war'' is a misnomer.
>  in any usenet exchange, the only casualty is time.
>  there are better uses for regret."
>    --thi <ttn@netcom.com>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080925/=
db592ef9/attachment.htm
From ajs at crankycanuck.ca  Thu Sep 25 09:40:23 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Thu Sep 25 09:40:35 2008
Subject: [Slony1-general] Best way to send data between two remotes
	masters of slony cluster ?
In-Reply-To: <210e1e060809250914q7478c791l2fab0658568a60c8@mail.gmail.com>
References: <210e1e060809240735q5931cf3fob650d7ec522f4ce0@mail.gmail.com>
	<20080924144214.GA58352@crankycanuck.ca>
	<210e1e060809240816ocedc6f0mef779778db1fe1b0@mail.gmail.com>
	<87y71hqzni.fsf@dba2.int.libertyrms.com>
	<210e1e060809250914q7478c791l2fab0658568a60c8@mail.gmail.com>
Message-ID: <20080925164022.GA286@crankycanuck.ca>

On Thu, Sep 25, 2008 at 06:14:44PM +0200, J?r?me Jouanin wrote:
> Why it seems a good idea to have 10 replicas at the "main" site ? Because
> our production consists of several octocore / 24Go to serve 1000 queries /
> sec and we have lag time constraint to replicate data <10sec. And obviously
> we have backup databases at our main site.

I find it hard to believe that the overhead of 10 databases isn't
cancelling out some of the benefit you see.  Just a couple such
machines ought easily to stand up to the 1000 qps you mention, unless
the queries are much more complicated than I imagine.

A

-- 
Andrew Sullivan
ajs@commandprompt.com
+1 503 667 4564 x104
http://www.commandprompt.com/
From z-saito at guitar.ocn.ne.jp  Thu Sep 25 09:41:51 2008
From: z-saito at guitar.ocn.ne.jp (Hiroshi Saito)
Date: Thu Sep 25 09:42:02 2008
Subject: [Slony1-general] Problem with Japanese Characters
References: <14384536.post@talk.nabble.com>
Message-ID: <01ce01c91f2d$9c71e8b0$0b01a8c0@IBMC9A0F63B40D>

Hi.

Probably, It is made the option for consideration of CVE-2006-2314.
Although management is the following, please take danger into consideration.
---postgresql.conf-----
backslash_quote = on

Regards,
Hiroshi Saito

----- Original Message ----- 
From: "Miguel d Vinci" <michael.de.guzman@gmail.com>
To: <slony1-general@lists.slony.info>
Sent: Tuesday, December 18, 2007 5:27 PM
Subject: [Slony1-general] Problem with Japanese Characters



Hi!  I'm trying to implement Slony 1.2.9 in our system application.  Recently
I have encountered a problem with Japanese characters and I'm stuck.  Please
help.

Here is my platform:
* Postgres 8.1.8
* Slony 1.2.9
* Linux kernel 2.4.32

I have no problem creating slon shema and making the replication work.  I
have a Postgres script file to insert 60,000 records of Japanese characters
into one table.  The script works fine on the Primary Node and everything
(60,000 records) is saved.  However, only about 2,300+ records was
replicated on the Slave node.

Here is the error log:

2007-12-18 14:32:19 UTC DEBUG2 remoteWorkerThread_1_1: current remote
log_status = 0
 2007-12-18 14:32:19 UTC DEBUG2 remoteHelperThread_1_1: 0.058 seconds delay
for first row
 2007-12-18 14:32:19 UTC DEBUG2 remoteHelperThread_1_1: 0.128 seconds until
close cursor
 2007-12-18 14:32:19 UTC DEBUG2 remoteHelperThread_1_1: inserts=118
updates=236 deletes=0
 2007-12-18 14:32:19 UTC ERROR remoteWorkerThread_1: "insert into
"public"."icitem"
(ean,sourceean,instorecode,classcode,departmentcode,subdepartmentcode,itemname,standard,capname,capacity,unitname,unitcap,suppliercode,orderpoint,orderday,packqty,shelfcode,shelflevel,linelevel,stickertype,freedataa,freedatab,freedatac,freedata1,freedata2,freedata3,taxrate,deldate,unitprice,unitpricemem,salesprice,ordprice,promocode,promostartdate,promostarttime,promoenddate,promoendtime,lastprice,costprice,lastupdate,memprice,promotype,orddate,ordqty,delsched,stock,paperprintdate,isinitialized,initctr,promoqty,suppliername)
values ('4562176951037','','','0','5','0','????????????
???','','0','0.00','0','0.00','0','0','','0','','0','0','0','','','','0','0','0','0.00','','0.00','0.00','1757','0','0','','','','','0','0','2007-12-18','0','0','','0','','0','','f','0','0','');
 update only "public"."icdepartment" set ctr='544' where departmentcode='5'
and subdepartmentcode='0' and classcode='0';
 update only "public"."icstats" set allitems='3327' where cd='1';
 insert into "public"."icitem"
(ean,sourceean,instorecode,classcode,departmentcode,subdepartmentcode,itemname,standard,capname,capacity,unitname,unitcap,suppliercode,orderpoint,orderday,packqty,shelfcode,shelflevel,linelevel,stickertype,freedataa,freedatab,freedatac,freedata1,freedata2,freedata3,taxrate,deldate,unitprice,unitpricemem,salesprice,ordprice,promocode,promostartdate,promostarttime,promoenddate,promoendtime,lastprice,costprice,lastupdate,memprice,promotype,orddate,ordqty,delsched,stock,paperprintdate,isinitialized,initctr,promoqty,suppliername)
values ('4901925133025','','','0','4','0','????????
???','','0','0.00','0','0.00','0','0','','0','','0','0','0','','','','0','0','0','0.00','','0.00','0.00','982','0','0','','','','','0','0','2007-12-18','0','0','','0','','0','','f','0','0','');
 update only "public"."icdepartment" set ctr='425' where departmentcode='4'
and subdepartmentcode='0' and classcode='0';
 update only "public"."icstats" set allitems='3328' where cd='1';
 insert into "public"."icitem"
(ean,sourceean,instorecode,classcode,departmentcode,subdepartmentcode,itemname,standard,capname,capacity,unitname,unitcap,suppliercode,orderpoint,orderday,packqty,shelfcode,shelflevel,linelevel,stickertype,freedataa,freedatab,freedatac,freedata1,freedata2,freedata3,taxrate,deldate,unitprice,unitpricemem,salesprice,ordprice,promocode,promostartdate,promostarttime,promoenddate,promoendtime,lastprice,costprice,lastupdate,memprice,promotype,orddate,ordqty,delsched,stock,paperprintdate,isinitialized,initctr,promoqty,suppliername)
values ('4902881407144','','','0','4','0','????????????
???','','0','0.00','0','0.00','0','0','','0','','0','0','0','','','','0','0','0','0.00','','0.00','0.00','6261','0','0','','','','','0','0','2007-12-18','0','0','','0','','0','','f','0','0','');
 update only "public"."icdepartment" set ctr='426' where departmentcode='4'
and subdepartmentcode='0' and classcode='0';
 update only "public"."icstats" set allitems='3329' where cd='1';
 insert into "public"."icitem"
(ean,sourceean,instorecode,classcode,departmentcode,subdepartmentcode,itemname,standard,capname,capacity,unitname,unitcap,suppliercode,orderpoint,orderday,packqty,shelfcode,shelflevel,linelevel,stickertype,freedataa,freedatab,freedatac,freedata1,freedata2,freedata3,taxrate,deldate,unitprice,unitpricemem,salesprice,ordprice,promocode,promostartdate,promostarttime,promoenddate,promoendtime,lastprice,costprice,lastupdate,memprice,promotype,orddate,ordqty,delsched,stock,paperprintdate,isinitialized,initctr,promoqty,suppliername)
values
('4903333035762','','','0','5','0','????????????????????','','0','0.00','0','0.00','0','0','','0','','0','0','0','','','','0','0','0','0.00','','0.00','0.00','6417','0','0','','','','','0','0','2007-12-18','0','0','','0','','0','','f','0','0','');
 " ERROR: unsafe use of \' in a string literal at character 4778
 HINT: Use '' to write quotes in strings. \' is insecure in client-only
encodings.
  - qualification was:
 2007-12-18 14:32:19 UTC ERROR remoteWorkerThread_1: "insert into
"public"."icitem"
(ean,sourceean,instorecode,classcode,departmentcode,subdepartmentcode,itemname,standard,capname,capacity,unitname,unitcap,suppliercode,orderpoint,orderday,packqty,shelfcode,shelflevel,linelevel,stickertype,freedataa,freedatab,freedatac,freedata1,freedata2,freedata3,taxrate,deldate,unitprice,unitpricemem,salesprice,ordprice,promocode,promostartdate,promostarttime,promoenddate,promoendtime,lastprice,costprice,lastupdate,memprice,promotype,orddate,ordqty,delsched,stock,paperprintdate,isinitialized,initctr,promoqty,suppliername)
values ('4562176951037','','','0','5','0','????????????
???','','0','0.00','0','0.00','0','0','','0','','0','0','0','','','','0','0','0','0.00','','0.00','0.00','1757','0','0','','','','','0','0','2007-12-18','0','0','','0','','0','','f','0','0','');
 update only "public"."icdepartment" set ctr='544' where departmentcode='5'
and subdepartmentcode='0' and classcode='0';
 update only "public"."icstats" set allitems='3327' where cd='1';
 insert into "public"."icitem"
(ean,sourceean,instorecode,classcode,departmentcode,subdepartmentcode,itemname,standard,capname,capacity,unitname,unitcap,suppliercode,orderpoint,orderday,packqty,shelfcode,shelflevel,linelevel,stickertype,freedataa,freedatab,freedatac,freedata1,freedata2,freedata3,taxrate,deldate,unitprice,unitpricemem,salesprice,ordprice,promocode,promostartdate,promostarttime,promoenddate,promoendtime,lastprice,costprice,lastupdate,memprice,promotype,orddate,ordqty,delsched,stock,paperprintdate,isinitialized,initctr,promoqty,suppliername)
values ('4901925133025','','','0','4','0','????????
???','','0','0.00','0','0.00','0','0','','0','','0','0','0','','','','0','0','0','0.00','','0.00','0.00','982','0','0','','','','','0','0','2007-12-18','0','0','','0','','0','','f','0','0','');
 update only "public"."icdepartment" set ctr='425' where departmentcode='4'
and subdepartmentcode='0' and classcode='0';
 update only "public"."icstats" set allitems='3328' where cd='1';
 insert into "public"."icitem"
(ean,sourceean,instorecode,classcode,departmentcode,subdepartmentcode,itemname,standard,capname,capacity,unitname,unitcap,suppliercode,orderpoint,orderday,packqty,shelfcode,shelflevel,linelevel,stickertype,freedataa,freedatab,freedatac,freedata1,freedata2,freedata3,taxrate,deldate,unitprice,unitpricemem,salesprice,ordprice,promocode,promostartdate,promostarttime,promoenddate,promoendtime,lastprice,costprice,lastupdate,memprice,promotype,orddate,ordqty,delsched,stock,paperprintdate,isinitialized,initctr,promoqty,suppliername)
values ('4902881407144','','','0','4','0','????????????
???','','0','0.00','0','0.00','0','0','','0','','0','0','0','','','','0','0','0','0.00','','0.00','0.00','6261','0','0','','','','','0','0','2007-12-18','0','0','','0','','0','','f','0','0','');
 update only "public"."icdepartment" set ctr='426' where departmentcode='4'
and subdepartmentcode='0' and classcode='0';
 update only "public"."icstats" set allitems='3329' where cd='1';
 insert into "public"."icitem"
(ean,sourceean,instorecode,classcode,departmentcode,subdepartmentcode,itemname,standard,capname,capacity,unitname,unitcap,suppliercode,orderpoint,orderday,packqty,shelfcode,shelflevel,linelevel,stickertype,freedataa,freedatab,freedatac,freedata1,freedata2,freedata3,taxrate,deldate,unitprice,unitpricemem,salesprice,ordprice,promocode,promostartdate,promostarttime,promoenddate,promoendtime,lastprice,costprice,lastupdate,memprice,promotype,orddate,ordqty,delsched,stock,paperprintdate,isinitialized,initctr,promoqty,suppliername)
values
('4903333035762','','','0','5','0','????????????????????','','0','0.00','0','0.00','0','0','','0','','0','0','0','','','','0','0','0','0.00','','0.00','0.00','6417','0','0','','','','','0','0','2007-12-18','0','0','','0','','0','','f','0','0','');
 " ERROR: current transaction is aborted, commands ignored until end of
transaction block
  - qualification was:
 2007-12-18 14:32:19 UTC ERROR remoteWorkerThread_1: SYNC aborted
 2007-12-18 14:32:20 UTC DEBUG2 syncThread: new sl_action_seq 1 - SYNC 13
 2007-12-18 14:32:21 UTC DEBUG2 remoteListenThread_1: queue event 1,106 SYNC
 2007-12-18 14:32:23 UTC DEBUG2 remoteListenThread_1: queue event 1,107 SYNC
 2007-12-18 14:32:25 UTC DEBUG2 remoteListenThread_1: queue event 1,108 SYNC
 2007-12-18 14:32:26 UTC DEBUG2 localListenThread: Received event 2,13 SYNC

>From this log, the error "ERROR: unsafe use of \' in a string literal at
character 4778
 HINT: Use '' to write quotes in strings. \' is insecure in client-only
encodings." was reflected.  What confuses me is that the Secondary server
has the same database settings with the Primary Server.  Both servers have
database were created with UTF-8 encoding.  CLIENT-ENCODING (in
postgresql.conf) for both servers were set to SJIS.

Another weird part is this:  I dropped slony schema and recreated the
database on the Secondary Server.  I re-created slony and run slon.  After a
few moments, I checked the table in the Secondary Node and everything was
replicated.  So it means that the problem is triggered somewhere during the
actual INSERTing of records.

I'm really stuck with this problem and I would really appreciate it if
someone could tell me how to fix it.

Thanks in advance.

;) Miguel
-- 
View this message in context: 
http://www.nabble.com/Problem-with-Japanese-Characters-tp14384536p14384536.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.

_______________________________________________
Slony1-general mailing list
Slony1-general@lists.slony.info
http://lists.slony.info/mailman/listinfo/slony1-general 

From z-saito at guitar.ocn.ne.jp  Thu Sep 25 09:48:12 2008
From: z-saito at guitar.ocn.ne.jp (Hiroshi Saito)
Date: Thu Sep 25 09:48:22 2008
Subject: [Slony1-general] Windows logging
References: <7C0800F63CCF4149AC0FC5EE2A041226036D3DEA@sr002-2k3exc.ateb.com>
Message-ID: <01f001c91f2e$7f712d10$0b01a8c0@IBMC9A0F63B40D>

Hi.

Um, Now, I think selection best in adjusting by the ini file.
# Debug log level (higher value ==> more output).  Range: [0,4], default 4
log_level=0

Regards,
Hiroshi Saito

----- Original Message ----- 
From: John Fansler
To: slony1-general@lists.slony.info
Sent: Tuesday, January 08, 2008 6:04 AM
Subject: [Slony1-general] Windows logging


Hello,

I've installed Postgres 8.2.3 via binaries. It included Slony-I 1.2.9.

So far everything has worked very well. The only question I have is whether there is a way 
to change where Slony performs its logging. I've used the log level 2 as seemed to be 
recommended, but this causes the Windows Application Event log to become basically useless. 
Slony fills it up with the log entries created every few seconds.

Is there a way to configure Slony to log to it's own Windows Event Log? Or is there a better 
way to handle logging on Windows?

Thanks in advance for any help,

-john



_______________________________________________
Slony1-general mailing list
Slony1-general@lists.slony.info
http://lists.slony.info/mailman/listinfo/slony1-general 

From z-saito at guitar.ocn.ne.jp  Thu Sep 25 09:57:15 2008
From: z-saito at guitar.ocn.ne.jp (Hiroshi Saito)
Date: Thu Sep 25 09:57:26 2008
Subject: [Slony1-general] Loadbinary("slevent.dll") failed 
References: <1A339DDC70642E4CA41CDE91E565C4996463BA@inmum0442.atrapa.deloitte.com>
Message-ID: <023401c91f2f$c36f8740$0b01a8c0@IBMC9A0F63B40D>

Hi.

The problem was not reproduced in the environment which Dave has with me.
However, it becomes a problem in the Windows environment of some countries.:-(
It is investigated continuously. sorry...

Regards,
Hiroshi Saito

----- Original Message ----- 
From: Sharma, Vikas O (IN - Delhi)
To: slony1-general@lists.slony.info
Sent: Monday, June 09, 2008 7:51 PM
Subject: [Slony1-general] Loadbinary("slevent.dll") failed


Hi all
I followed the instructions:

On typing on the command prompt
regsvr32 slevent.dll

I got error message Loadbinary("slevent.dll") failed - invalid access to memory location.

And when I copy ur suggested slevent.dll from the sourse 
http://developer.pgadmin.org/~hiroshi/S . levent.dll
On registration time it gives error message         slevent.dll was loaded, but the 
dllregisterserver entry point was not found.
                                                                        This file can't be 
registered.


Please help..



Um, There was the before same report. However, The problem was not reproduced in the
environment of Dave with me. It was very strange. So, I wish to check one.
Here is a new version.
http://developer.pgadmin.org/~hiroshi/Slony-I/
And if a problem still reappears, please use this. (This is VC8 compile module)
http://developer.pgadmin.org/~hiroshi/S . levent.dll
MinGW (GCC) will be suspected if it operates well.

Regards,
Hiroshi Saito


This message (including any attachments) contains confidential information intended for a 
specific individual and purpose, and is protected by law. If you are not the intended 
recipient, you should delete this message and are hereby notified that any disclosure, 
copying, or distribution of this message, or the taking of any action based on it, is 
strictly prohibited.



_______________________________________________
Slony1-general mailing list
Slony1-general@lists.slony.info
http://lists.slony.info/mailman/listinfo/slony1-general 

From cbbrowne at ca.afilias.info  Thu Sep 25 10:01:35 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Thu Sep 25 10:01:45 2008
Subject: [Slony1-general] Log shipping, plain text only? If so,
	what numerical accuracy?
In-Reply-To: <Pine.LNX.4.64.0803131103210.10071@tucano.Stanford.EDU> (Jennifer
	Spencer's message of "Thu, 13 Mar 2008 11:08:48 -0700 (PDT)")
References: <Pine.LNX.4.64.0803131103210.10071@tucano.Stanford.EDU>
Message-ID: <87iqskp3bk.fsf@dba2.int.libertyrms.com>

Jennifer Spencer <jennifer@sun.Stanford.EDU> writes:
> Hi All -
> I am new to Slony-1.  I have searched the archives for the last six
> months and haven't seen anything about this topic, so I am going to
> ask.
>
> We are hoping to set up Slony-1 log shipping from our shop to a few
> others.  My shop is part of a science mission in the Physics Lab.  A
> lot of our data, essential for science, is stored as "double".  We
> need to be able to log ship that science data.
>
> But, from what I can tell so far, Slony-1 log shipping only uses the
> Plain Text format for its shipped logs.  True or false?  If false, how
> do I specify binary or any other format?

Log shipping uses the same format as regular replication, namely the
plain text form of the Insert/Update/Delete queries.  There is no
option of specifying another format.

> If we must use plain text to log ship, what kind of accuracy can we
> expect for data type 'double', or 64 bit floating point numbers
> contained in that log?

If it *isn't* faithfully replicating the values that are stored, then
you'll have much the same problem with any backups you might do, as
the typical pg_dump also uses Plain Text format for such data.

Thus, if you *are* in trouble (and it is by no means obvious to me
that you are), you were in trouble long before Slony-I got involved.
-- 
let name="cbbrowne" and tld="cbbrowne.com" in name ^ "@" ^ tld;;
http://www3.sympatico.ca/cbbrowne/wp.html
"Thank you for calling PIXAR! If  you have a touch tone phone, you can
get information or reach anybody here  easily!  If your VCR at home is
still blinking '12:00', press '0'  at any time during this message and
an operator will assist you."
-- PIXAR'S toll-free line (1-800-888-9856)
From cbbrowne at ca.afilias.info  Thu Sep 25 10:02:27 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Thu Sep 25 10:02:37 2008
Subject: [Slony1-general] Slony with Fedora & Unbuntu
In-Reply-To: <5CA4D07E8D52ED4AB5499CA4E089858110A0A0E991@star2.corp.trenstar.net>
	(Melvin Davidson's message of "Mon, 17 Mar 2008 14:27:14 -0600")
References: <5CA4D07E8D52ED4AB5499CA4E089858110A0A0E991@star2.corp.trenstar.net>
Message-ID: <87ej38p3a4.fsf@dba2.int.libertyrms.com>

Melvin Davidson <mdavidson@trenstar.com> writes:
>        :v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word"
> 		       xmlns:m="http://schemas.microsoft.com/office/2004/12/omml" xmlns="http://www.w3.org/TR/REC-html40">
>
> My organization is planning to replace our Fedora servers with Unbuntu. That means that for a short while, we may need to replicate with Slony :p>
>
>   from Fedora / PostgreSQL 8.2.5 to Unbuntu / PostgreSQL 8.2.5. I am hoping that as long as the PostgreSQL version is the same, it will work.:p>
>
> 							   Can anyone confirm this?:p>
>

Shouldn't be a problem; the thing that has GOT to match is the version
of Slony-I.
-- 
let name="cbbrowne" and tld="linuxdatabases.info" in name ^ "@" ^ tld;;
http://www3.sympatico.ca/cbbrowne/lsf.html
Rules of the Evil Overlord #1. "My Legions of Terror will have helmets
with   clear    plexiglass   visors,   not    face-concealing   ones."
<http://www.eviloverlord.com/>
From cbbrowne at ca.afilias.info  Thu Sep 25 10:05:24 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Thu Sep 25 10:05:35 2008
Subject: [Slony1-general] Re: [GENERAL] Stripping out slony after / before
	/ during pg_restore?
In-Reply-To: <48298ACA.1050002@archonet.com> (Richard Huxton's message of
	"Tue, 13 May 2008 13:34:18 +0100")
References: <349621.46525.qm@web25806.mail.ukl.yahoo.com>
	<48298ACA.1050002@archonet.com>
Message-ID: <87abdwp357.fsf@dba2.int.libertyrms.com>

Richard Huxton <dev@archonet.com> writes:
> Glyn Astill wrote:
>> Hi people,
>>
>> I'm setting us up a separate staging / test server and I want to read
>> in a pg_dump of our current origin stripping out all the slony stuff.
>>
>> I was thinking this could serve two purposes a) test out backups
>> restore properly and b) provide us with us with the staging / test
>> server
>>
>> What's the best way to remove all the slony bits?
>
> Well, you can always just drop the slony schema (with a cascade) -
> that should do it.

Not quite.  There are two things that *doesn't* hit:

 a) If there were any tables where a Slony-I key column got added,
    DROP SCHEMA CASCADE doesn't trim that column out, which can
    cause some minor heartburn.  If you don't use TABLE ADD KEY,
    then this isn't an issue.

 b) In versions of Slony-I before 2.0, stripping out the schema on a
    subscriber will leave triggers in a hidden state.

You want to look into UNINSTALL NODE, which does the full cleanup.
-- 
(format nil "~S@~S" "cbbrowne" "linuxfinances.info")
http://linuxfinances.info/info/languages.html
REALITY is a crutch for people who can't face ITS.
From cbbrowne at ca.afilias.info  Thu Sep 25 10:07:05 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Thu Sep 25 10:07:17 2008
Subject: [Slony1-general] Fwd: Help help!! I want help for replicating
	database using slony
In-Reply-To: <9954a75f0806060256q5e0fd085q4085a585b7581601@mail.gmail.com>
	(Technovice BD's message of "Fri, 6 Jun 2008 15:56:28 +0600")
References: <9954a75f0806060254t2b927777jaf162f340f4d207d@mail.gmail.com>
	<9954a75f0806060256q5e0fd085q4085a585b7581601@mail.gmail.com>
Message-ID: <8763okp32e.fsf@dba2.int.libertyrms.com>

"Technovice BD" <technovicebd@gmail.com> writes:
> 						     ---------- Forwarded message ----------
> 						   From: Technovice BD <technovicebd@gmail.com>
> 							Date: Fri, Jun 6, 2008 at 3:54 PM
> 				      Subject: Help help!! I want help for replicating database using slony
> 							   To: mailman@lists.slony.info
> 							      Cc: r_islam@erp-bd.com
> 								      Hello
> 		  I am using slony -I for replication of a database in (PgSql). I am facing an issue which needs to be resolved.
> 								      Issue:
>  ? For replication I created a master database & a slave database on different machine. If master machine is switched off or down for any reason,
>        is there any way to edit the slave database without deleting the cluster which is created to make relation with the master machine?

Look at the "failover" documentation.

http://slony.info/documentation/failover.html

This describes what can be done.
-- 
let name="cbbrowne" and tld="linuxfinances.info" in String.concat "@" [name;tld];;
http://linuxdatabases.info/info/sgml.html
"I think it  would be great if MS would make  VB the favoured language
for Palm PC's.  Then they'd have a shaky, bloated, slow OS running the
shaky, bloated, slow macro-apps."  -- <garyduke@nospam.idirect.com>
From z-saito at guitar.ocn.ne.jp  Thu Sep 25 10:09:22 2008
From: z-saito at guitar.ocn.ne.jp (Hiroshi Saito)
Date: Thu Sep 25 10:09:33 2008
Subject: [Slony1-general] Downgrading to a previous version of Slony
References: <1D90589BAB0AB947B2688E135A546498130A4495@r900ex03.conedison.net>
Message-ID: <024c01c91f31$74daba80$0b01a8c0@IBMC9A0F63B40D>

Downgrading to a previous version of SlonyHi.

Pease see,
http://developer.pgadmin.org/~hiroshi/Slony-I/
However,  The object for pg8.3 is supplied by StackBuilder.

Regards,
Hiroshi Saito

----- Original Message ----- 
From: Benezra, Eric
To: slony1-general@lists.slony.info
Sent: Thursday, May 22, 2008 12:57 AM
Subject: [Slony1-general] Downgrading to a previous version of Slony


Hello everyone,
We are looking to replicate from Linux to Windows. The current version of Slony that we have 
installed on the Linux machine is 1.2.13 and the Windows machine is running Slony 1.2.12. I 
am aware that the versions have to be the same.
Am I correct to assume that there is currently no version 1.2.13 for Windows? If so, where 
can I find it?
If not, we are looking to downgrade the Slony version on the Linux installation back to 
1.2.12, so that the two installations are compatible.
Is there a specific way to uninstall Slony (on Linux) in such a way that it eliminates all 
references to the previous installations?
Thanks to anyone who can help answer these questions!
Eric





_______________________________________________
Slony1-general mailing list
Slony1-general@lists.slony.info
http://lists.slony.info/mailman/listinfo/slony1-general 

From vostorga at gmail.com  Thu Sep 25 10:29:47 2008
From: vostorga at gmail.com (=?ISO-8859-1?Q?V=EDctor?=)
Date: Thu Sep 25 10:29:58 2008
Subject: [Slony1-general] slony and utf8 databases
In-Reply-To: <478E2251.9080301@echo.fr>
References: <478E2251.9080301@echo.fr>
Message-ID: <2b391080809251029j30a1db56gb3b78407581d1bde@mail.gmail.com>

None for me, I always use slony with utf8 encoded databases.

Regards

On Wed, Jan 16, 2008 at 9:27 AM, Cyril SCETBON <scetbon@echo.fr> wrote:

> Hi guys,
>
>
> Are there known issues about that ?
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080925/=
56f9444f/attachment.htm
From vostorga at gmail.com  Thu Sep 25 10:39:58 2008
From: vostorga at gmail.com (=?ISO-8859-1?Q?V=EDctor?=)
Date: Thu Sep 25 10:40:08 2008
Subject: [Slony1-general] Slony setup over a LAN but not replicating
In-Reply-To: <15308421.post@talk.nabble.com>
References: <15308421.post@talk.nabble.com>
Message-ID: <2b391080809251039g31cf6403h7b36c1b9dfc59e76@mail.gmail.com>

As stated in http://www.slony.info/documentation/firstdb.html be sure
*not*to use localhost for either of them, but the IP address will make
it, and
you must review/post the log output for a better understanding of your
problem.

Regards,

Victor

On Wed, Feb 6, 2008 at 11:38 AM, ajcity <victor.aluko@gmail.com> wrote:

>
> Hi all,
>  I setup Slony over a LAN following all the stated procedures i.e. Create
> similar schema,create service on both machines and add both engines, Crea=
te
> the cluster, create set, add tables, add path & listens and subscribe
> set......But with all these its not replicating even after I restarted the
> slon services on both machines. What am I supposed to do next?
>  And there was something I wasnt sure of when I setup the '.conf' files on
> both machines...Am I supposed to specify 'localhost' as the host on the
> first machine (say NY) and specify the IP address of the second machine
> (say
> TX) or should I specify their IP addresses?
>  Much love.
>
>                           Victor
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080925/=
015ff386/attachment-0001.htm
From vostorga at gmail.com  Thu Sep 25 10:49:17 2008
From: vostorga at gmail.com (=?ISO-8859-1?Q?V=EDctor?=)
Date: Thu Sep 25 10:49:27 2008
Subject: [Slony1-general] slony on two several hosts
In-Reply-To: <1205830415.16035.59.camel@alex>
References: <1205830415.16035.59.camel@alex>
Message-ID: <2b391080809251049u4b42206fr18cc44c580f17822@mail.gmail.com>

On Tue, Mar 18, 2008 at 2:53 AM, Alex Haugg <haugg@comdasys.com> wrote:

> hi, i have a question:
>
> in every examples you have the master and the slave on the same host
> (local host).
> but i would like to know the configuration from slony master and slony
> slave on two several hosts.


It's the  same, just be sure to set the variables  MASTERHOST and SLAVEHOST
according with your setup.


> were will defined the cluster and the tables( i think on the master )?
>
> were will initialized the connection of slony master and the slony
> slave?
>
> were will started the slon process ( i think on the master for the
> master and on the slave for the slave )?


You can do all the setup in one host, ie MASTERHOST, just be sure you have
pg_hba.conf configured to accept the connections.


>
>
Victor.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080925/=
0505c360/attachment.htm
From vostorga at gmail.com  Thu Sep 25 11:10:17 2008
From: vostorga at gmail.com (=?ISO-8859-1?Q?V=EDctor?=)
Date: Thu Sep 25 11:10:28 2008
Subject: [Slony1-general] Unable to run slony because of different master
	and slave versions
In-Reply-To: <18278087.post@talk.nabble.com>
References: <18278087.post@talk.nabble.com>
Message-ID: <2b391080809251110o109b6268qb906b7b697e98b32@mail.gmail.com>

I was able to compile slony 1.2.13 in a FreeBSD host a while ago, so it will
be helpful if you provide the compile output

Regards,


On Fri, Jul 4, 2008 at 5:57 AM, AndreyA <andrey.astakhov@gmail.com> wrote:

>
> My master host works on FreeBSD 6.2. Allowed slony version for this OS is
> 1.2.12.
> Slave host works on Redhat Linux Fedora 9. Slony version from rpm is
> 1.2.14.
>
> Running slony on master i get following error:
>
> <stdin>:57: loading of file /.../postgresql//slony1_funcs.sql:
> PGRES_FATAL_ERROR ERROR:  Slonik version: 1.2.12 !=3D Slony-I version in =
PG
> build 1.2.1                                                           4
> ERROR:  Slonik version: 1.2.12 !=3D Slony-I version in PG build 1.2.14
>
> The problem is: i can't upgrade slony on master neither from package nor
> manually because of compilation errors. Moreover i can't downgrade slony =
on
> slave - the same promlems (but another errors).
>
> Could you suggest me a way to solve this problem?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080925/=
ee81b7a8/attachment.htm
From drees76 at gmail.com  Thu Sep 25 12:45:26 2008
From: drees76 at gmail.com (David Rees)
Date: Thu Sep 25 12:45:39 2008
Subject: [Slony1-general] Sudden flow of some ancient messages???
In-Reply-To: <20080925155400.GB284@commandprompt.com>
References: <87wsh0p78q.fsf@dba2.int.libertyrms.com>
	<20080925155400.GB284@commandprompt.com>
Message-ID: <72dbd3150809251245y57d1058akfe2e529ab1d9363f@mail.gmail.com>

On Thu, Sep 25, 2008 at 8:54 AM, Andrew Sullivan <ajs@commandprompt.com> wrote:
> On Thu, Sep 25, 2008 at 11:36:53AM -0400, Christopher Browne wrote:
>> I'm seeing a "bounty" of pretty old messages (I'm seeing material from
>> as far back as November 2007); did someone reconfigure a mail server
>> somewhere that might have been holding onto old messages?
>
> No.  See my other note.  Turns out there's been no moderation.  We
> could use more volunteers :)

If you need/want help moderating posts from unsubscribed senders, feel
free to add me to the moderators list.

-Dave
From dknight at wsi.com  Thu Sep 25 12:59:12 2008
From: dknight at wsi.com (Knight, Doug)
Date: Thu Sep 25 12:59:26 2008
Subject: [Slony1-general] Initial db copy not procedding due to postgres
	error
Message-ID: <8536F69C1FCC294B859D07B179F069440FAEC48B@EXCHANGE.ad.wsicorp.com>

I have a slony pair that I just started the initial copy. It hit a table
set where it encountered a fatal postgres error due to an encoding
issue. After encountering the error, I unsubscribed the table set to see
if I could get slony to continue with the rest of the sets. slony now
says:

 

remoteWorkerThread_1: node -1 not found in runtime configuration

data copy for set 75 failed - sleep 30 seconds

 

I restarted the slon processes on both servers, and cannot seem to clear
this state. Its syncing all the table sets subscribed so far (1 - 74),
but I cannot get slony to move beyond 75, even though its been
unsubscribed. Does anyone know how to get out of this state? I don't
know why it would say there's a node -1 either, as my nodes are 1 and 2.

 

I'm looking into the encoding error separately, and will provide more
information if that turns out to be an issue.

 

Doug Knight

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080925/dfa4cc54/attachment.htm
From ajs at crankycanuck.ca  Fri Sep 26 06:11:17 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Fri Sep 26 06:11:28 2008
Subject: [Slony1-general] Initial db copy not procedding due to
	postgres error
In-Reply-To: <8536F69C1FCC294B859D07B179F069440FAEC48B@EXCHANGE.ad.wsicorp.com>
References: <8536F69C1FCC294B859D07B179F069440FAEC48B@EXCHANGE.ad.wsicorp.com>
Message-ID: <20080926131117.GA984@crankycanuck.ca>

On Thu, Sep 25, 2008 at 03:59:12PM -0400, Knight, Doug wrote:
> I have a slony pair that I just started the initial copy. It hit a table
> set where it encountered a fatal postgres error due to an encoding
> issue. After encountering the error, I unsubscribed the table set to see
> if I could get slony to continue with the rest of the sets. 

The problem is that the subscribe set event is in line before the
unsubscribe table event.  You could grovel through the Slony tables
and remove the relevant event, but it's sort of a PITA to do.  I'd be
more inclined to start over, making sure that you have compatible
encodings on both systems.

A

-- 
Andrew Sullivan
ajs@commandprompt.com
+1 503 667 4564 x104
http://www.commandprompt.com/
From vostorga at gmail.com  Fri Sep 26 09:56:50 2008
From: vostorga at gmail.com (=?ISO-8859-1?Q?V=EDctor?=)
Date: Fri Sep 26 09:57:00 2008
Subject: [Slony1-general] Sudden flow of some ancient messages???
In-Reply-To: <20080925155400.GB284@commandprompt.com>
References: <87wsh0p78q.fsf@dba2.int.libertyrms.com>
	<20080925155400.GB284@commandprompt.com>
Message-ID: <2b391080809260956x7a3f5debs131d1026fae087ae@mail.gmail.com>

If there is something I can help, feel free to contact me.

Regards,

Victor.

On Thu, Sep 25, 2008 at 9:54 AM, Andrew Sullivan <ajs@commandprompt.com>wro=
te:

>
> No.  See my other note.  Turns out there's been no moderation.  We
> could use more volunteers :)
>
> A
>
> --
> Andrew Sullivan
>  <ajs@commandprompt.com>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080926/=
ad6fe2b1/attachment.htm
From jennifer.spencer at stanford.edu  Fri Sep 26 12:38:53 2008
From: jennifer.spencer at stanford.edu (Jennifer Spencer)
Date: Fri Sep 26 12:39:07 2008
Subject: [Slony1-general] Log shipping, plain text only? If so,
	what numerical accuracy?
In-Reply-To: <87iqskp3bk.fsf@dba2.int.libertyrms.com>
References: <Pine.LNX.4.64.0803131103210.10071@tucano.Stanford.EDU>
	<87iqskp3bk.fsf@dba2.int.libertyrms.com>
Message-ID: <48DD3A4D.8020700@stanford.edu>

Hi, and thanks for the response.  I sent this months ago so it's nice to see it!

We don't use pg_dump to back up.  We use SELECT pg_start_backup('label'); to track the WAL files, and 
we tar up all our data files and put those onto tape (using a logical volume snapshot to keep the 
backup consistent).

If I needed an exact table output as a backup instead of files, I would use "copy out" in binary mode 
(which it has) for my tables.  I don't know that that is fundamentally better than text, when I really 
get to thinking about it, past a certain decimal place.  My grasp of binary versus text here is not 
what I'd like, but maybe you guys can shed more light on this?  How much accuracy are we really 
getting with text copying?

Thanks,
Jennifer


Christopher Browne wrote:
> Jennifer Spencer <jennifer@sun.Stanford.EDU> writes:
>> Hi All -
>> I am new to Slony-1.  I have searched the archives for the last six
>> months and haven't seen anything about this topic, so I am going to
>> ask.
>>
>> We are hoping to set up Slony-1 log shipping from our shop to a few
>> others.  My shop is part of a science mission in the Physics Lab.  A
>> lot of our data, essential for science, is stored as "double".  We
>> need to be able to log ship that science data.
>>
>> But, from what I can tell so far, Slony-1 log shipping only uses the
>> Plain Text format for its shipped logs.  True or false?  If false, how
>> do I specify binary or any other format?
> 
> Log shipping uses the same format as regular replication, namely the
> plain text form of the Insert/Update/Delete queries.  There is no
> option of specifying another format.
> 
>> If we must use plain text to log ship, what kind of accuracy can we
>> expect for data type 'double', or 64 bit floating point numbers
>> contained in that log?
> 
> If it *isn't* faithfully replicating the values that are stored, then
> you'll have much the same problem with any backups you might do, as
> the typical pg_dump also uses Plain Text format for such data.
> 
> Thus, if you *are* in trouble (and it is by no means obvious to me
> that you are), you were in trouble long before Slony-I got involved.
From cbbrowne at ca.afilias.info  Fri Sep 26 15:16:50 2008
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri Sep 26 15:17:08 2008
Subject: [Slony1-general] Log shipping, plain text only? If so,
	what numerical accuracy?
In-Reply-To: <48DD3A4D.8020700@stanford.edu> (Jennifer Spencer's message of
	"Fri, 26 Sep 2008 12:38:53 -0700")
References: <Pine.LNX.4.64.0803131103210.10071@tucano.Stanford.EDU>
	<87iqskp3bk.fsf@dba2.int.libertyrms.com>
	<48DD3A4D.8020700@stanford.edu>
Message-ID: <87vdwimu25.fsf@dba2.int.libertyrms.com>

Jennifer Spencer <jennifer.spencer@stanford.edu> writes:
> Hi, and thanks for the response.  I sent this months ago so it's nice to see it!
>
> We don't use pg_dump to back up.  We use SELECT
> pg_start_backup('label'); to track the WAL files, and we tar up all
> our data files and put those onto tape (using a logical volume
> snapshot to keep the backup consistent).
>
> If I needed an exact table output as a backup instead of files, I
> would use "copy out" in binary mode (which it has) for my tables.  I
> don't know that that is fundamentally better than text, when I really
> get to thinking about it, past a certain decimal place.  My grasp of
> binary versus text here is not what I'd like, but maybe you guys can
> shed more light on this?  How much accuracy are we really getting with
> text copying?

I hate to be evasive, but I'll have to evade this, as I don't know the
answer ;-).

My usual practices involve using NUMERIC, as I'm usually working with
financial figures, where I don't want any floating point rounding
errors, so I wouldn't see this scenario.

As I mentioned, the issue is really the same as would be the case with
pg_dump; I'll forward the question over to pgsql-general, where others
may hve the relevant involvement with FP math.
-- 
output = reverse("gro.mca" "@" "enworbbc")
http://www3.sympatico.ca/cbbrowne/x.html
"There are no threads in a.b.p.erotica, so there's no  gain in using a
threaded news reader."  -- (Unknown source)
From f.furlani at smsgroup.it  Sat Sep 27 00:47:50 2008
From: f.furlani at smsgroup.it (Francesco Furlani)
Date: Sat Sep 27 00:46:21 2008
Subject: [Slony1-general] I: Slony problem..
Message-ID: <FCF8B8A27C174BD8AF44906248F3AA02@ZEUS>

Hi, 
i have 1 master and one slave db. 


The problem is:

when in the master I run this sql : update wspet00 set datamf=20080925 where
numcar = 7123123123 
in the slave slon process i have an error with this log: 


update only "public"."wspet00" set datamf='20080925' where ; 
" ERROR:  syntax error at or near ";" 
LINE 1: update only "public"."wspet00" set datamf='20080925' where ; 


it's seem like the sql was truncated..any idea? 


Postgres version 8.2.5 and slony 1.2.13 on both windows 2003 server. 


Thanks, 
Francesco 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080927/0763ba0a/attachment.htm
From dknight at wsi.com  Mon Sep 29 08:54:38 2008
From: dknight at wsi.com (Knight, Doug)
Date: Mon Sep 29 08:54:47 2008
Subject: [Slony1-general] seq_id and tab_id unique across all sequences and
	tables?
Message-ID: <8536F69C1FCC294B859D07B179F069440FAED27C@EXCHANGE.ad.wsicorp.com>

All,

Does the id need to be unique even between tables and sequences? Or can
a sequence have the same id as a table?

 

Thanks,

Doug Knight

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080929/f6983b7b/attachment.htm
From ajs at crankycanuck.ca  Mon Sep 29 09:36:15 2008
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Mon Sep 29 09:36:26 2008
Subject: [Slony1-general] seq_id and tab_id unique across all sequences
	and tables?
In-Reply-To: <8536F69C1FCC294B859D07B179F069440FAED27C@EXCHANGE.ad.wsicorp.com>
References: <8536F69C1FCC294B859D07B179F069440FAED27C@EXCHANGE.ad.wsicorp.com>
Message-ID: <20080929163615.GA28230@crankycanuck.ca>

On Mon, Sep 29, 2008 at 11:54:38AM -0400, Knight, Doug wrote:
> All,
> 
> Does the id need to be unique even between tables and sequences? Or can
> a sequence have the same id as a table?

Sequence and table ids are tracked separately, so yes, the sets can
overlap.


-- 
Andrew Sullivan
ajs@commandprompt.com
+1 503 667 4564 x104
http://www.commandprompt.com/
From dknight at wsi.com  Mon Sep 29 11:14:04 2008
From: dknight at wsi.com (Knight, Doug)
Date: Mon Sep 29 11:14:16 2008
Subject: [Slony1-general] Time partitioned tables under slony
Message-ID: <8536F69C1FCC294B859D07B179F069440FBA1C9D@EXCHANGE.ad.wsicorp.com>

All,

We have an application that uses time partitioned tables (day-based).
We're in the early stages of implementing slony for database upgrades,
etc. I recently got the entire database up and synched, and it ran over
the weekend. We have a sliding window of time partitioned tables of 14
days. So, as of this morning the oldest three child tables were dropped
on the origin, and three new child tables have been created, also on the
origin. This morning I was going to manually unsubscribe the old child
tables, and run a slonik script to add/merge the new ones. However, I
noticed that on the receiver the parent table now has data in it, and
the dates range from Sep 9 - today. Normally it does not, the data is
only stored in the child tables which inherit from the parent. This
would make the range start 14 days from when I set up the replication,
last Friday. We replicate both the child tables and the parent. Can
anyone explain this behavior? Should I not be replicating the parent
table?

 

Doug Knight

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080929/56982077/attachment.htm
From dba at richyen.com  Mon Sep 29 11:35:22 2008
From: dba at richyen.com (Richard Yen)
Date: Mon Sep 29 11:35:36 2008
Subject: [Slony1-general] sl_confirm aging issue?
Message-ID: <2D39558D-DBD7-46A3-A52B-6C3AB3DCECB3@richyen.com>

Hi,

I'm noticing that there's a very old row in sl_confirm on one of my  
nodes.  Wondering what could be the problem...

test_slony_state says the following (I can paste more if needed):
> Listen Path Analysis
> ===================================================
> No problems found with sl_listen
>
> --------------------------------------------------------------------------------
> Summary of event info
>  Origin  Min SYNC  Max SYNC Min SYNC Age Max SYNC Age
> = 
> = 
> = 
> = 
> = 
> = 
> = 
> = 
> = 
> = 
> ======================================================================
>       1   5269981   5272295     00:00:00     00:20:00    0
>       4   1172599   1172992     00:00:00     00:20:00    0
>       2    846926    847325     00:00:00     00:20:00    0
>       3   1697518   1700013     00:00:00     00:21:00    0
>
>
> ---------------------------------------------------------------------------------
> Summary of sl_confirm aging
>    Origin   Receiver   Min SYNC   Max SYNC  Age of latest SYNC  Age  
> of eldest SYNC
> = 
> = 
> = 
> = 
> = 
> = 
> = 
> = 
> = 
> = 
> = 
> ======================================================================
>         1          2    5269992    5272295      00:00:00       
> 00:20:00    0
>         1          3    5269984    5272295      00:00:00       
> 00:20:00    0
>         1          4    5269981    5272293      00:00:00       
> 00:20:00    0
>         2          1     846926     847325      00:00:00       
> 00:20:00    0
>         2          3     846926     847325      00:00:00       
> 00:20:00    0
>         2          4     846926     847325      00:00:00       
> 00:20:00    0
>         3          1    3778920    3778920  44 days 14:13:00  44  
> days 14:13:00    1
>         3          2    1697665    1700013      00:00:00       
> 00:20:00    0
>         3          4    1697518    1699955      00:00:00       
> 00:21:00    0
>         4          1    1172599    1172992      00:00:00       
> 00:20:00    0
>         4          2    1172599    1172992      00:00:00       
> 00:20:00    0
>         4          3    1172599    1172992      00:00:00       
> 00:20:00    0
>
>
> ------------------------------------------------------------------------------
>
> Listing of old open connections
>        Database             PID            User    Query  
> Age                Query
> = 
> = 
> = 
> = 
> = 
> = 
> = 
> = 
> = 
> = 
> ======================================================================
>
> ISSUES FOUND:
>
>
> Node: 3 Confirmations not propagating from 3 to 1
> ================================================
> Confirmations not propagating quickly in sl_confirm -
>
> For origin node 3, receiver node 1, earliest propagated
> confirmation has age 44 days 14:13:00 > 00:30:00
>
> Are slons running for both nodes?
>
> Could listen paths be missing so that confirmations are not  
> propagating?

I've looked at sl_log1, sl_log2, and sl_event, but nothing corresponds  
to con_seqno in the sl_confirm table:
> tii=# select * from _tii.sl_confirm order by con_timestamp;
>  con_origin | con_received | con_seqno |       con_timestamp
> ------------+--------------+-----------+----------------------------
>           3 |            1 |   3778920 | 2008-08-15 21:12:43.108286
>
> tii=# select * from _tii.sl_event where ev_seqno = 3778920;
>  ev_origin | ev_seqno | ev_timestamp | ev_minxid | ev_maxxid |  
> ev_xip | ev_type | ev_data1 | ev_data2 | ev_data3 | ev_data4 |  
> ev_data5 | ev_data6 | ev_data7 | ev_data8
> -----------+----------+--------------+-----------+----------- 
> +--------+---------+----------+----------+----------+---------- 
> +----------+----------+----------+----------
> (0 rows)

I have also restarted the slon daemons on nodes 1 and 3, but that  
doesn't change anything.

Wondering if this may be the cause of erratic sync behavior?  My  
monitoring indicates that this node (node 3) is regularly having lag  
issues, but the other two nodes (nodes 2 and 4) haven't even a squeak.

Any ideas where else to look?  What else can I do?

--Richard
From dba at richyen.com  Mon Sep 29 11:57:57 2008
From: dba at richyen.com (Richard Yen)
Date: Mon Sep 29 11:58:11 2008
Subject: [Slony1-general] futex_wait normal?
Message-ID: <511B3204-DF1D-460F-B36E-F33ED11EA00A@richyen.com>

Hi All,

I have to slon processes (one is a parent of the other), and doing an  
strace on both shows that there's no activity.

Doing a ps to get the proc IDs:
> postgres@db3.oaktown ~ $ ps afux | grep slon | grep -v global | grep  
> conf
> postgres 22075  0.0  0.0  14284  1432 ?        S    11:16   0:00  
> slon -f /db/data/slon.conf tii
> postgres 22076  0.6  0.0 115716  5232 ?        Sl   11:16   0:13  \_  
> slon -f /db/data/slon.conf tii

Followed by strace -p:
> postgres@db3.oaktown ~ $ strace -p 22075
> Process 22075 attached - interrupt to quit
> wait4(-1, ^C <unfinished ...>
> Process 22075 detached
>
> postgres@tii-db3.oaktown ~ $ strace -p 22076
> Process 22076 attached - interrupt to quit
> futex(0x40c279e0, FUTEX_WAIT, 22078, NULL^C <unfinished ...>
> Process 22076 detached

I can understand why the parent would wait forever, but I don't seem  
to understand why the child proc stays in FUTEX_WAIT forever?  Can  
anyone explain this?  Seems like this happens on all nodes, so I'm  
guessing it's normal.  After all, replication *is* happening.

Just curious...
--Richard
From dknight at wsi.com  Tue Sep 30 06:40:14 2008
From: dknight at wsi.com (Knight, Doug)
Date: Tue Sep 30 06:40:22 2008
Subject: [Slony1-general] Binary COPY in slony?
Message-ID: <8536F69C1FCC294B859D07B179F069440FBA20FC@EXCHANGE.ad.wsicorp.com>

All,

Is there a way to have slony do its COPY statements using binary mode?
We have some very large binary tables that might benefit from the
performance of the binary COPY.

 

Thanks,

Doug Knight

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080930/f2b79607/attachment.htm
From mark.keisler at motorola.com  Tue Sep 30 12:27:08 2008
From: mark.keisler at motorola.com (Mark Keisler)
Date: Tue Sep 30 12:27:40 2008
Subject: [Slony1-general] sanity check for all tables in a set
Message-ID: <48E27D8C.1050600@motorola.com>

I'm running slony 1.2.12 with Pg 8.2.7 and I occasionally hit a problem
when I need to move a set to another server like so:

<stdin>:7: PGRES_FATAL_ERROR select "_mycluster".moveSet(1, 2);  -
ERROR:  Slony-I: alterTableRestore(): Table with id 84 not found
CONTEXT:  SQL statement "SELECT  "_mycluster".alterTableRestore( $1 )"
PL/pgSQL function "moveset_int" line 33 at perform
SQL statement "SELECT  "_mycluster".moveSet_int( $1 ,  $2 ,  $3 , 0)"
PL/pgSQL function "moveset" line 61 at perform

Someone deleted that table at some point and now I can't move the set
and I can't unsubscribe the set.  It didn't seem like I could do
anything at this point besides manually strip out the cluster schema and
start over.  So my first question is if there are any other options at
this point?

Secondly, is there some sort of check that I can run periodically to
make sure a set is still intact so something like this doesn't bite me
right when I need to move a set?

-- 
Mark Keisler


From glynastill at yahoo.co.uk  Tue Sep 30 13:17:33 2008
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Tue Sep 30 13:17:47 2008
Subject: [Slony1-general] sanity check for all tables in a set
In-Reply-To: <48E27D8C.1050600@motorola.com>
Message-ID: <706238.16312.qm@web25806.mail.ukl.yahoo.com>

> <stdin>:7: PGRES_FATAL_ERROR select
> "_mycluster".moveSet(1, 2);  -
> ERROR:  Slony-I: alterTableRestore(): Table with id 84 not
> found
> CONTEXT:  SQL statement "SELECT 
> "_mycluster".alterTableRestore( $1 )"
> PL/pgSQL function "moveset_int" line 33 at
> perform
> SQL statement "SELECT 
> "_mycluster".moveSet_int( $1 ,  $2 ,  $3 ,
> 0)"
> PL/pgSQL function "moveset" line 61 at perform
> 
> Someone deleted that table at some point and now I
> can't move the set
> and I can't unsubscribe the set.  It didn't seem
> like I could do
> anything at this point besides manually strip out the
> cluster schema and
> start over.  So my first question is if there are any other
> options at
> this point?
> 

You could give REPAIR CONFIG a try

http://slony.info/documentation/stmtrepairconfig.html


      
From rafael.domiciano at gmail.com  Tue Sep 30 18:10:33 2008
From: rafael.domiciano at gmail.com (Rafael Domiciano)
Date: Tue Sep 30 18:10:54 2008
Subject: [Slony1-general] I: Slony problem..
In-Reply-To: <FCF8B8A27C174BD8AF44906248F3AA02@ZEUS>
References: <FCF8B8A27C174BD8AF44906248F3AA02@ZEUS>
Message-ID: <3a0028490809301810l3194e6acg8fa8d8cd66456ec4@mail.gmail.com>

Hello there,
I think this a very rare bug...
Did you tryied to recompile Slony? May could work!

Maybe you could find the SLQ in the sl_event table and fix it. This is the
worse ideia ever, I haven't the need until today to do something like that,
but could work.

Best Regards,

Rafael Domiciano
Postgres DBA

2008/9/27 Francesco Furlani <f.furlani@smsgroup.it>

>  Hi,
> i have 1 master and one slave db.
>
> The problem is:
>
> when in the master I run this sql : update wspet00 set datamf=3D20080925
> where numcar =3D 7123123123
> in the slave slon process i have an error with this log:
>
> update only "public"."wspet00" set datamf=3D'20080925' where ;
> " ERROR:  syntax error at or near ";"
> LINE 1: update only "public"."wspet00" set datamf=3D'20080925' where ;
>
> it's seem like the sql was truncated..any idea?
>
> Postgres version 8.2.5 and slony 1.2.13 on both windows 2003 server.
>
> Thanks,
> Francesco
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general@lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20080930/=
2b6398fa/attachment.htm
From drees76 at gmail.com  Tue Sep 30 19:28:06 2008
From: drees76 at gmail.com (David Rees)
Date: Tue Sep 30 19:28:28 2008
Subject: [Slony1-general] Drop and Uninstall Node
Message-ID: <72dbd3150809301928pe21ff9ctd5e9c02f0a99460b@mail.gmail.com>

Is it just me, or is the description of drop node and uninstall node backwards?

http://slony.info/documentation/stmtdropnode.html
http://slony.info/documentation/stmtuninstallnode.html

Drop node says that one of the steps is uninstall node, so I ran drop
node today, but all it did was remove the node from the cluster. The
slony cluster was still there.

After running uninstall node, that dropped the slony cluster.

So it seems to me that the description is backwards. Am I crazy?

The slonik scripts seem to match the documentation, but not the actions.

-Dave
