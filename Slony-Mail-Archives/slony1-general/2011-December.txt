From zbbentley at gmail.com  Thu Dec  1 09:19:57 2011
From: zbbentley at gmail.com (Zac Bentley)
Date: Thu, 1 Dec 2011 12:19:57 -0500
Subject: [Slony1-general] Catch-up and sl_status, and yum repo
Message-ID: <CAAFQqzTxsFTEd679GCRnthPFgqnOAB_N=UF5QKHHDA+rNKud_w@mail.gmail.com>

We recently had an issue with a long Slony (2.0) catch-up after 10 days of
disconnect between a master and a slave. It's possible that it was caused
by either bug 167 or bug 222. To test this behavior we made a dummy cluster
on our local LAN, and did the following steps:

1. Initialize a two-node Slony cluster with two identical copies of the
database.
2. Allow initial subscription to catch up.
3. On the slave: drop the network connection to the master.
4. On the master: run ~4 million update operations.
5. On the slave: restore the connection to the master.

We did this, and I was able to watch sync events get submitted and received
in the logs. However, in sl_status, st_lag_num_events and st_lag_time kept
going up, and the backlogged changes were not propagated (after a couple of
hours, at least). The LAN link between the two nodes is fast, and neither
node is lagging due to server/IO/network load. Why is this occurring/what
did I do wrong?

Also, on what time period do you publish RPMs of Slony to public Yum
repositories? (i.e. when should we expect to see an RPM of Slony 2.1?)

Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20111201/975bada4/attachment.htm 

From ssinger at ca.afilias.info  Thu Dec  1 10:38:32 2011
From: ssinger at ca.afilias.info (Steve Singer)
Date: Thu, 01 Dec 2011 13:38:32 -0500
Subject: [Slony1-general] Catch-up and sl_status, and yum repo
In-Reply-To: <CAAFQqzTxsFTEd679GCRnthPFgqnOAB_N=UF5QKHHDA+rNKud_w@mail.gmail.com>
References: <CAAFQqzTxsFTEd679GCRnthPFgqnOAB_N=UF5QKHHDA+rNKud_w@mail.gmail.com>
Message-ID: <4ED7C9A8.20500@ca.afilias.info>

On 11-12-01 12:19 PM, Zac Bentley wrote:
> We recently had an issue with a long Slony (2.0) catch-up after 10 days
> of disconnect between a master and a slave. It's possible that it was
> caused by either bug 167 or bug 222. To test this behavior we made a
> dummy cluster on our local LAN, and did the following steps:
>
> 1. Initialize a two-node Slony cluster with two identical copies of the
> database.
> 2. Allow initial subscription to catch up.
> 3. On the slave: drop the network connection to the master.
> 4. On the master: run ~4 million update operations.
> 5. On the slave: restore the connection to the master.
>
> We did this, and I was able to watch sync events get submitted and
> received in the logs. However, in sl_status, st_lag_num_events and
> st_lag_time kept going up, and the backlogged changes were not
> propagated (after a couple of hours, at least). The LAN link between the
> two nodes is fast, and neither node is lagging due to server/IO/network
> load. Why is this occurring/what did I do wrong?


Your 4 million row update was done as a single transaction.  This means 
that Slony needs to replicate it to the slave as part of a single SYNC. 
If slony is busy replicating that sync the SYNC won't show up as being 
replicated until that SYNC is done.  sl_status will show the slave as 
falling behind while the processing of that SYNC is going on (because it 
is behind, none of your 4 million rows will be visible on the slave 
until the transaction commits).

If you run the slon for your slave at debug4 you should see lots of 
DEBUG messages from the remoteWorkerThread showing progress.  Slony will 
fetch the rows in groups of 500 at a time with a cursor.  Based on how 
frequently you see these you can probably estimate how long it will take 
to do 4 million.



>
> Also, on what time period do you publish RPMs of Slony to public Yum
> repositories? (i.e. when should we expect to see an RPM of Slony 2.1?)
>
> Thanks!
>
>
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


From devrim at gunduz.org  Fri Dec  2 06:54:24 2011
From: devrim at gunduz.org (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Fri, 02 Dec 2011 16:54:24 +0200
Subject: [Slony1-general] Catch-up and sl_status, and yum repo
In-Reply-To: <CAAFQqzTxsFTEd679GCRnthPFgqnOAB_N=UF5QKHHDA+rNKud_w@mail.gmail.com>
References: <CAAFQqzTxsFTEd679GCRnthPFgqnOAB_N=UF5QKHHDA+rNKud_w@mail.gmail.com>
Message-ID: <1322837660.2518.10.camel@lenovo01-laptop03.gunduz.org>

On Thu, 2011-12-01 at 12:19 -0500, Zac Bentley wrote:
> 
> Also, on what time period do you publish RPMs of Slony to public Yum
> repositories? (i.e. when should we expect to see an RPM of Slony
> 2.1?) 

Packages are ready, I'll push them on Monday, along with the PostgreSQL
update releases.

Regards,
-- 
Devrim G?ND?Z
Principal Systems Engineer @ EnterpriseDB: http://www.enterprisedb.com
PostgreSQL Dan??man?/Consultant, Red Hat Certified Engineer
Community: devrim~PostgreSQL.org, devrim.gunduz~linux.org.tr
http://www.gunduz.org  Twitter: http://twitter.com/devrimgunduz
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20111202/42bf5591/attachment.pgp 

From vitaliy.se at gmail.com  Sun Dec  4 13:03:02 2011
From: vitaliy.se at gmail.com (Vitaliy Semochkin)
Date: Mon, 5 Dec 2011 00:03:02 +0300
Subject: [Slony1-general] CentOS 5.7 slony1-91 "Possible unsupported
 PostgreSQL version (90101) 9.1, defaulting to 8.4 support"
Message-ID: <CAHyKpfMCjF-W2Ec2=Tt3UzD66tg55PVFOY-ki0PDbfmdQHJ=Mg@mail.gmail.com>

Hi

I'm trying to get slony1-91 running on CentOS 5.7
using official postgre sql yum repository
current packages are
slony1-91-2.0.7-1.rhel5
postgresql91-9.1.1-1PGDG.rhel5
postgresql91-libs-9.1.1-1PGDG.rhel5
postgresql91-server-9.1.1-1PGDG.rhel5

When I try to run slonik it prints "Possible unsupported PostgreSQL
version (90101) 9.1, defaulting to 8.4 support".

Is it problem with my setup or a bug?

Regards,
Vitaliy S

From ssinger_pg at sympatico.ca  Sun Dec  4 11:54:31 2011
From: ssinger_pg at sympatico.ca (Steve Singer)
Date: Sun, 4 Dec 2011 14:54:31 -0500
Subject: [Slony1-general] CentOS 5.7 slony1-91 "Possible unsupported
 PostgreSQL version (90101) 9.1, defaulting to 8.4 support"
In-Reply-To: <CAHyKpfMCjF-W2Ec2=Tt3UzD66tg55PVFOY-ki0PDbfmdQHJ=Mg@mail.gmail.com>
References: <CAHyKpfMCjF-W2Ec2=Tt3UzD66tg55PVFOY-ki0PDbfmdQHJ=Mg@mail.gmail.com>
Message-ID: <BLU0-SMTP976AED895AAF217AC1B2D0ACB40@phx.gbl>

On Mon, 5 Dec 2011, Vitaliy Semochkin wrote:

> Hi
>
> I'm trying to get slony1-91 running on CentOS 5.7
> using official postgre sql yum repository
> current packages are
> slony1-91-2.0.7-1.rhel5
> postgresql91-9.1.1-1PGDG.rhel5
> postgresql91-libs-9.1.1-1PGDG.rhel5
> postgresql91-server-9.1.1-1PGDG.rhel5
>
> When I try to run slonik it prints "Possible unsupported PostgreSQL
> version (90101) 9.1, defaulting to 8.4 support".
>
> Is it problem with my setup or a bug?

This is expected behaviour. Slony 2.0.7 was released before 9.1 was 
released.  The only issue with running against 9.1 that I am (so far) aware 
of is discussed in this thread 
http://lists.slony.info/pipermail/slony1-general/2011-November/011939.html



>
> Regards,
> Vitaliy S
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>


