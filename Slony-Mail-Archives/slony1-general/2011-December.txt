From zbbentley at gmail.com  Thu Dec  1 09:19:57 2011
From: zbbentley at gmail.com (Zac Bentley)
Date: Thu, 1 Dec 2011 12:19:57 -0500
Subject: [Slony1-general] Catch-up and sl_status, and yum repo
Message-ID: <CAAFQqzTxsFTEd679GCRnthPFgqnOAB_N=UF5QKHHDA+rNKud_w@mail.gmail.com>

We recently had an issue with a long Slony (2.0) catch-up after 10 days of
disconnect between a master and a slave. It's possible that it was caused
by either bug 167 or bug 222. To test this behavior we made a dummy cluster
on our local LAN, and did the following steps:

1. Initialize a two-node Slony cluster with two identical copies of the
database.
2. Allow initial subscription to catch up.
3. On the slave: drop the network connection to the master.
4. On the master: run ~4 million update operations.
5. On the slave: restore the connection to the master.

We did this, and I was able to watch sync events get submitted and received
in the logs. However, in sl_status, st_lag_num_events and st_lag_time kept
going up, and the backlogged changes were not propagated (after a couple of
hours, at least). The LAN link between the two nodes is fast, and neither
node is lagging due to server/IO/network load. Why is this occurring/what
did I do wrong?

Also, on what time period do you publish RPMs of Slony to public Yum
repositories? (i.e. when should we expect to see an RPM of Slony 2.1?)

Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20111201/975bada4/attachment.htm 

From ssinger at ca.afilias.info  Thu Dec  1 10:38:32 2011
From: ssinger at ca.afilias.info (Steve Singer)
Date: Thu, 01 Dec 2011 13:38:32 -0500
Subject: [Slony1-general] Catch-up and sl_status, and yum repo
In-Reply-To: <CAAFQqzTxsFTEd679GCRnthPFgqnOAB_N=UF5QKHHDA+rNKud_w@mail.gmail.com>
References: <CAAFQqzTxsFTEd679GCRnthPFgqnOAB_N=UF5QKHHDA+rNKud_w@mail.gmail.com>
Message-ID: <4ED7C9A8.20500@ca.afilias.info>

On 11-12-01 12:19 PM, Zac Bentley wrote:
> We recently had an issue with a long Slony (2.0) catch-up after 10 days
> of disconnect between a master and a slave. It's possible that it was
> caused by either bug 167 or bug 222. To test this behavior we made a
> dummy cluster on our local LAN, and did the following steps:
>
> 1. Initialize a two-node Slony cluster with two identical copies of the
> database.
> 2. Allow initial subscription to catch up.
> 3. On the slave: drop the network connection to the master.
> 4. On the master: run ~4 million update operations.
> 5. On the slave: restore the connection to the master.
>
> We did this, and I was able to watch sync events get submitted and
> received in the logs. However, in sl_status, st_lag_num_events and
> st_lag_time kept going up, and the backlogged changes were not
> propagated (after a couple of hours, at least). The LAN link between the
> two nodes is fast, and neither node is lagging due to server/IO/network
> load. Why is this occurring/what did I do wrong?


Your 4 million row update was done as a single transaction.  This means 
that Slony needs to replicate it to the slave as part of a single SYNC. 
If slony is busy replicating that sync the SYNC won't show up as being 
replicated until that SYNC is done.  sl_status will show the slave as 
falling behind while the processing of that SYNC is going on (because it 
is behind, none of your 4 million rows will be visible on the slave 
until the transaction commits).

If you run the slon for your slave at debug4 you should see lots of 
DEBUG messages from the remoteWorkerThread showing progress.  Slony will 
fetch the rows in groups of 500 at a time with a cursor.  Based on how 
frequently you see these you can probably estimate how long it will take 
to do 4 million.



>
> Also, on what time period do you publish RPMs of Slony to public Yum
> repositories? (i.e. when should we expect to see an RPM of Slony 2.1?)
>
> Thanks!
>
>
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


From devrim at gunduz.org  Fri Dec  2 06:54:24 2011
From: devrim at gunduz.org (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Fri, 02 Dec 2011 16:54:24 +0200
Subject: [Slony1-general] Catch-up and sl_status, and yum repo
In-Reply-To: <CAAFQqzTxsFTEd679GCRnthPFgqnOAB_N=UF5QKHHDA+rNKud_w@mail.gmail.com>
References: <CAAFQqzTxsFTEd679GCRnthPFgqnOAB_N=UF5QKHHDA+rNKud_w@mail.gmail.com>
Message-ID: <1322837660.2518.10.camel@lenovo01-laptop03.gunduz.org>

On Thu, 2011-12-01 at 12:19 -0500, Zac Bentley wrote:
> 
> Also, on what time period do you publish RPMs of Slony to public Yum
> repositories? (i.e. when should we expect to see an RPM of Slony
> 2.1?) 

Packages are ready, I'll push them on Monday, along with the PostgreSQL
update releases.

Regards,
-- 
Devrim G?ND?Z
Principal Systems Engineer @ EnterpriseDB: http://www.enterprisedb.com
PostgreSQL Dan??man?/Consultant, Red Hat Certified Engineer
Community: devrim~PostgreSQL.org, devrim.gunduz~linux.org.tr
http://www.gunduz.org  Twitter: http://twitter.com/devrimgunduz
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20111202/42bf5591/attachment.pgp 

From vitaliy.se at gmail.com  Sun Dec  4 13:03:02 2011
From: vitaliy.se at gmail.com (Vitaliy Semochkin)
Date: Mon, 5 Dec 2011 00:03:02 +0300
Subject: [Slony1-general] CentOS 5.7 slony1-91 "Possible unsupported
 PostgreSQL version (90101) 9.1, defaulting to 8.4 support"
Message-ID: <CAHyKpfMCjF-W2Ec2=Tt3UzD66tg55PVFOY-ki0PDbfmdQHJ=Mg@mail.gmail.com>

Hi

I'm trying to get slony1-91 running on CentOS 5.7
using official postgre sql yum repository
current packages are
slony1-91-2.0.7-1.rhel5
postgresql91-9.1.1-1PGDG.rhel5
postgresql91-libs-9.1.1-1PGDG.rhel5
postgresql91-server-9.1.1-1PGDG.rhel5

When I try to run slonik it prints "Possible unsupported PostgreSQL
version (90101) 9.1, defaulting to 8.4 support".

Is it problem with my setup or a bug?

Regards,
Vitaliy S

From ssinger_pg at sympatico.ca  Sun Dec  4 11:54:31 2011
From: ssinger_pg at sympatico.ca (Steve Singer)
Date: Sun, 4 Dec 2011 14:54:31 -0500
Subject: [Slony1-general] CentOS 5.7 slony1-91 "Possible unsupported
 PostgreSQL version (90101) 9.1, defaulting to 8.4 support"
In-Reply-To: <CAHyKpfMCjF-W2Ec2=Tt3UzD66tg55PVFOY-ki0PDbfmdQHJ=Mg@mail.gmail.com>
References: <CAHyKpfMCjF-W2Ec2=Tt3UzD66tg55PVFOY-ki0PDbfmdQHJ=Mg@mail.gmail.com>
Message-ID: <BLU0-SMTP976AED895AAF217AC1B2D0ACB40@phx.gbl>

On Mon, 5 Dec 2011, Vitaliy Semochkin wrote:

> Hi
>
> I'm trying to get slony1-91 running on CentOS 5.7
> using official postgre sql yum repository
> current packages are
> slony1-91-2.0.7-1.rhel5
> postgresql91-9.1.1-1PGDG.rhel5
> postgresql91-libs-9.1.1-1PGDG.rhel5
> postgresql91-server-9.1.1-1PGDG.rhel5
>
> When I try to run slonik it prints "Possible unsupported PostgreSQL
> version (90101) 9.1, defaulting to 8.4 support".
>
> Is it problem with my setup or a bug?

This is expected behaviour. Slony 2.0.7 was released before 9.1 was 
released.  The only issue with running against 9.1 that I am (so far) aware 
of is discussed in this thread 
http://lists.slony.info/pipermail/slony1-general/2011-November/011939.html



>
> Regards,
> Vitaliy S
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>


From passigni at navionics.it  Mon Dec  5 01:12:19 2011
From: passigni at navionics.it (Laura Passigni)
Date: Mon, 5 Dec 2011 10:12:19 +0100
Subject: [Slony1-general] Conditional replica
Message-ID: <2BAB4106A6ADED49AE82F980249A60B0025A372B@01-nav-mail.navionics.it>

Dear all,

I'm using slony to have a replica of my database (Postgresql 8.4).

Currently I replicate only some tables, not the entire database. I was
wondering if it is possible to replicate only some records of a table,
for example according to some field's value. In other words, perform a
sort of conditional replica. 

 

Please let me know.

Thank you,

 

Laura Passigni

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20111205/8ed559cd/attachment.htm 

From cedric.villemain.debian at gmail.com  Mon Dec  5 06:28:07 2011
From: cedric.villemain.debian at gmail.com (=?ISO-8859-1?Q?C=E9dric_Villemain?=)
Date: Mon, 5 Dec 2011 15:28:07 +0100
Subject: [Slony1-general] Conditional replica
In-Reply-To: <2BAB4106A6ADED49AE82F980249A60B0025A372B@01-nav-mail.navionics.it>
References: <2BAB4106A6ADED49AE82F980249A60B0025A372B@01-nav-mail.navionics.it>
Message-ID: <CAF6yO=2CRiHKEzTF2WuUYE+dKrkDtotyZNA8dO_c3XFdjH8ycA@mail.gmail.com>

Le 5 d?cembre 2011 10:12, Laura Passigni <passigni at navionics.it> a ?crit :
> Dear all,
>
> I?m using slony to have a replica of my database (Postgresql 8.4).
>
> Currently I replicate only some tables, not the entire database. I was
> wondering if it is possible to replicate only some records of a table, for
> example according to some field?s value. In other words, perform a sort of
> conditional replica.

It is not in the features list of slony.
I don't think it is possible without rewriting triggers. Maybe have a
look at logtrigger().

-- 
C?dric Villemain +33 (0)6 20 30 22 52
http://2ndQuadrant.fr/
PostgreSQL: Support 24x7 - D?veloppement, Expertise et Formation

From ajs at crankycanuck.ca  Mon Dec  5 06:31:54 2011
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Mon, 5 Dec 2011 09:31:54 -0500
Subject: [Slony1-general] Conditional replica
In-Reply-To: <2BAB4106A6ADED49AE82F980249A60B0025A372B@01-nav-mail.navionics.it>
References: <2BAB4106A6ADED49AE82F980249A60B0025A372B@01-nav-mail.navionics.it>
Message-ID: <20111205143153.GG84440@shinkuro.com>

On Mon, Dec 05, 2011 at 10:12:19AM +0100, Laura Passigni wrote:
> Dear all,
> 
> I'm using slony to have a replica of my database (Postgresql 8.4).
> 
> Currently I replicate only some tables, not the entire database. I was
> wondering if it is possible to replicate only some records of a table,
> for example according to some field's value. In other words, perform a
> sort of conditional replica. 

No, although you could do this with views and some fancy underlying
tables, and then only replicate the particular tables you wanted the
records from.

A

-- 
Andrew Sullivan
ajs at anvilwalrusden.com

From cbbrowne at afilias.info  Mon Dec  5 08:30:49 2011
From: cbbrowne at afilias.info (Christopher Browne)
Date: Mon, 5 Dec 2011 11:30:49 -0500
Subject: [Slony1-general] Conditional replica
In-Reply-To: <CAF6yO=2CRiHKEzTF2WuUYE+dKrkDtotyZNA8dO_c3XFdjH8ycA@mail.gmail.com>
References: <2BAB4106A6ADED49AE82F980249A60B0025A372B@01-nav-mail.navionics.it>
	<CAF6yO=2CRiHKEzTF2WuUYE+dKrkDtotyZNA8dO_c3XFdjH8ycA@mail.gmail.com>
Message-ID: <CANfbgbaxQOxtpju=zVs_nuwTLq1cSHcKYAaoQHAQxtN0gpzMLw@mail.gmail.com>

On Mon, Dec 5, 2011 at 9:28 AM, C?dric Villemain
<cedric.villemain.debian at gmail.com> wrote:
> Le 5 d?cembre 2011 10:12, Laura Passigni <passigni at navionics.it> a ?crit :
>> Dear all,
>>
>> I?m using slony to have a replica of my database (Postgresql 8.4).
>>
>> Currently I replicate only some tables, not the entire database. I was
>> wondering if it is possible to replicate only some records of a table, for
>> example according to some field?s value. In other words, perform a sort of
>> conditional replica.
>
> It is not in the features list of slony.
> I don't think it is possible without rewriting triggers. Maybe have a
> look at logtrigger().

It ought to become plausible after 2.2 is released.

We have the change (still being integrated in; I think Jan is planning
to get this into master this week; you can take a peek at the repos
for Jan/Steve/Myself at GitHub to see what things are looking like)
that the log data is being split apart rather differently, notably so
that the log data is no longer "cooked" into text, but is, instead,
kept as a series of arrays.

That should make it possible to inject a "hook" function into the log
application function to reinterpret what is to be done with the log
data.

The first aspect that we expect to be pretty easy is to replay data
into a different table/schema; that's extremely useful for the case
where people want to replicate several instances of an application
into a "consolidation database."  This just involves renaming the
target table, and I wouldn't expect this to be terribly difficult to
deal with.  It should be able to be handled pretty cleanly.
(Hopefully.)

But as a broader matter, it would be interesting to add in "hooks" to
do more sophisticated things such as:

- Renaming columns.  Describing the configuration well is likely to be
the hard part.

- Selective replication, based on interpreting the data that is
provided.  Given a "hook" function to override the built-in behaviour,
it should surely be possible to do "just about anything."  Though the
higher the flights of fancy, the wiser this likely isn't...

Rewriting the triggers, as they exist now, seems horribly unattractive
to me.  They're SPI C functions, and there's enough intricacy there
that I'd think it pretty dangerous to hack on them without a pretty
deep understanding of them.  But this changes in 2.2...

From cedric.villemain.debian at gmail.com  Mon Dec  5 08:39:28 2011
From: cedric.villemain.debian at gmail.com (=?ISO-8859-1?Q?C=E9dric_Villemain?=)
Date: Mon, 5 Dec 2011 17:39:28 +0100
Subject: [Slony1-general] Conditional replica
In-Reply-To: <CANfbgbaxQOxtpju=zVs_nuwTLq1cSHcKYAaoQHAQxtN0gpzMLw@mail.gmail.com>
References: <2BAB4106A6ADED49AE82F980249A60B0025A372B@01-nav-mail.navionics.it>
	<CAF6yO=2CRiHKEzTF2WuUYE+dKrkDtotyZNA8dO_c3XFdjH8ycA@mail.gmail.com>
	<CANfbgbaxQOxtpju=zVs_nuwTLq1cSHcKYAaoQHAQxtN0gpzMLw@mail.gmail.com>
Message-ID: <CAF6yO=2rk-A4S+F64u9URuqO2250cWfTSTAuqEHDerg-sq8bSw@mail.gmail.com>

Le 5 d?cembre 2011 17:30, Christopher Browne <cbbrowne at afilias.info> a ?crit :
> On Mon, Dec 5, 2011 at 9:28 AM, C?dric Villemain
> <cedric.villemain.debian at gmail.com> wrote:
>> Le 5 d?cembre 2011 10:12, Laura Passigni <passigni at navionics.it> a ?crit :
>>> Dear all,
>>>
>>> I?m using slony to have a replica of my database (Postgresql 8.4).
>>>
>>> Currently I replicate only some tables, not the entire database. I was
>>> wondering if it is possible to replicate only some records of a table, for
>>> example according to some field?s value. In other words, perform a sort of
>>> conditional replica.
>>
>> It is not in the features list of slony.
>> I don't think it is possible without rewriting triggers. Maybe have a
>> look at logtrigger().
>
> It ought to become plausible after 2.2 is released.
>
> We have the change (still being integrated in; I think Jan is planning
> to get this into master this week; you can take a peek at the repos
> for Jan/Steve/Myself at GitHub to see what things are looking like)
> that the log data is being split apart rather differently, notably so
> that the log data is no longer "cooked" into text, but is, instead,
> kept as a series of arrays.
>
> That should make it possible to inject a "hook" function into the log
> application function to reinterpret what is to be done with the log
> data.
>
> The first aspect that we expect to be pretty easy is to replay data
> into a different table/schema; that's extremely useful for the case
> where people want to replicate several instances of an application
> into a "consolidation database." ?This just involves renaming the
> target table, and I wouldn't expect this to be terribly difficult to
> deal with. ?It should be able to be handled pretty cleanly.
> (Hopefully.)
>
> But as a broader matter, it would be interesting to add in "hooks" to
> do more sophisticated things such as:
>
> - Renaming columns. ?Describing the configuration well is likely to be
> the hard part.
>
> - Selective replication, based on interpreting the data that is
> provided. ?Given a "hook" function to override the built-in behaviour,
> it should surely be possible to do "just about anything." ?Though the
> higher the flights of fancy, the wiser this likely isn't...
>
> Rewriting the triggers, as they exist now, seems horribly unattractive
> to me. ?They're SPI C functions, and there's enough intricacy there
> that I'd think it pretty dangerous to hack on them without a pretty
> deep understanding of them. ?But this changes in 2.2...

Sure! Andrew' solution is way better at the moment.
Very nice features are planned, good to hear.
-- 
C?dric Villemain +33 (0)6 20 30 22 52
http://2ndQuadrant.fr/
PostgreSQL: Support 24x7 - D?veloppement, Expertise et Formation

From devrim at gunduz.org  Mon Dec  5 15:09:17 2011
From: devrim at gunduz.org (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Tue, 06 Dec 2011 01:09:17 +0200
Subject: [Slony1-general] Catch-up and sl_status, and yum repo
In-Reply-To: <1322837660.2518.10.camel@lenovo01-laptop03.gunduz.org>
References: <CAAFQqzTxsFTEd679GCRnthPFgqnOAB_N=UF5QKHHDA+rNKud_w@mail.gmail.com>
	<1322837660.2518.10.camel@lenovo01-laptop03.gunduz.org>
Message-ID: <1323126557.1929.50.camel@lenovo01-laptop03.gunduz.org>

On Fri, 2011-12-02 at 16:54 +0200, Devrim G?ND?Z wrote:
> > Also, on what time period do you publish RPMs of Slony to public Yum
> > repositories? (i.e. when should we expect to see an RPM of Slony
> > 2.1?) 
> 
> Packages are ready, I'll push them on Monday, along with the
> PostgreSQL update releases. 

Done for PostgreSQL 9.1.

Regards,
-- 
Devrim G?ND?Z
Principal Systems Engineer @ EnterpriseDB: http://www.enterprisedb.com
PostgreSQL Dan??man?/Consultant, Red Hat Certified Engineer
Community: devrim~PostgreSQL.org, devrim.gunduz~linux.org.tr
http://www.gunduz.org  Twitter: http://twitter.com/devrimgunduz
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20111206/a9eda58d/attachment.pgp 

From jon at investmentscience.com.au  Wed Dec  7 22:16:26 2011
From: jon at investmentscience.com.au (Jonathon Soong)
Date: Thu, 8 Dec 2011 16:46:26 +1030
Subject: [Slony1-general] slow slony initial load + monitoring
Message-ID: <4264E6801A11844992616B6359BA478D689B9A@invsci-svr1.invsci.local>

Hi guys,

I'm new to the list and have setup Slony from Australia to Hong Kong
over a VPN - it is not a super fast link.

I have done this on one database with around 5 million rows and it was
fine - took about 30 minutes to sync up.

However with another database that has 90 million+ rows, i'm running
into trouble (I did remove indices first)

The initial sync seems to be taking too long (15 hours+ when I stopped
it).

I was wondering how I monitor if anything is actually happening???:


1. I can see on the origin node, that a COPY seems to be occurring - can
anyone tell me if this is correct?
        16083 postgres  20   0  212m 7876 5480 S  1.7  0.0   0:10.12
postgres: postgres mydatabase::1(39599) COPY

2. I can see on the slave node when I query sl_status that:
    - st_last_event is NOT CHANGING
    - st_last_event_ts  is NOT CHANGING
    - st_last_received is NOT CHANGING
    - st_last_received_ts is NOT CHANGING
    - st_last_received_event_ts is NOT CHANGING
    - st_lag_num_events is NOT CHANGING
    - st_lag_time is increasing (around 18 hours)

 

   Are these values expected or should some of them be increasing?

3. The logs on the slave showed this when I started slony, I presume
this is correct:
    NOTICE:  truncate of "public"."my_table" succeeded

4. The logs on the slave now show this repeatedly:
    2011-12-08 05:48:47 UTCDEBUG2 remoteListenThread_1: queue event
1,5000001502 SYNC
    2011-12-08 05:48:47 UTCDEBUG2 remoteListenThread_1: queue event
1,5000001503 SYNC
    2011-12-08 05:48:47 UTCDEBUG2 remoteListenThread_1: queue event
1,5000001504 SYNC

 

5. sl_log_1 and sl_log_2 are empty on both the master and slave - am I
right in presuming these are only used when things change on an origin
node and that they are not used for initial syncs?

What I would LOVE, is the ability to see what is happening. e.g. "10,000
rows copied, 89 million to go", type logs. 
I can't do a select on the slave node as that seems to just hang
forever. 

Any help on what to do would be most appreciated.

 

Note: slony 2.0.7

Thanks

Jon

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20111208/f99e2af6/attachment.htm 

From ssinger at ca.afilias.info  Thu Dec  8 12:16:30 2011
From: ssinger at ca.afilias.info (Steve Singer)
Date: Thu, 08 Dec 2011 15:16:30 -0500
Subject: [Slony1-general] slow slony initial load + monitoring
In-Reply-To: <4264E6801A11844992616B6359BA478D689B9A@invsci-svr1.invsci.local>
References: <4264E6801A11844992616B6359BA478D689B9A@invsci-svr1.invsci.local>
Message-ID: <4EE11B1E.7010708@ca.afilias.info>

On 11-12-08 01:16 AM, Jonathon Soong wrote:
> Hi guys,
>
> I'm new to the list and have setup Slony from Australia to Hong Kong
> over a VPN - it is not a super fast link.
>
> I have done this on one database with around 5 million rows and it was
> fine - took about 30 minutes to sync up.
>
> However with another database that has 90 million+ rows, i'm running
> into trouble (I did remove indices first)
>
> The initial sync seems to be taking too long (15 hours+ when I stopped it).
>
> I was wondering how I monitor if anything is actually happening???:
>
>
> 1. I can see on the origin node, that a COPY seems to be occurring -
> */can anyone tell me if this is correct?/*
> 16083 postgres 20 0 212m 7876 5480 S 1.7 0.0 0:10.12 postgres: postgres
> mydatabase::1(39599) COPY
>
> 2. I can see on the slave node when I query sl_status that:
> - st_last_event is *NOT CHANGING*
> - st_last_event_ts is *NOT CHANGING*
> - st_last_received is *NOT CHANGING*
> - st_last_received_ts is *NOT CHANGING
> *- st_last_received_event_ts is *NOT CHANGING
> * - st_lag_num_events is *NOT CHANGING*
> - st_lag_time is increasing (around 18 hours)
>
> Are these values expected or should some of them be increasing?

While Slony is in the middle of a COPY operation it does so in a single 
transaction so you should not expect to see the event confirmation 
times/events change until the copy operation is complete.



>
> 3. The logs on the slave showed this when I started slony, I presume
> this is correct:
> NOTICE: truncate of "public"."my_table" succeeded

This is normal.  Each time a new table is started you should see that.

>
> 4. The logs on the slave now show this repeatedly:
> 2011-12-08 05:48:47 UTCDEBUG2 remoteListenThread_1: queue event
> 1,5000001502 SYNC
> 2011-12-08 05:48:47 UTCDEBUG2 remoteListenThread_1: queue event
> 1,5000001503 SYNC
> 2011-12-08 05:48:47 UTCDEBUG2 remoteListenThread_1: queue event
> 1,5000001504 SYNC
>

These are unrelated to your copy but are normal.

> 5. sl_log_1 and sl_log_2 are empty on both the master and slave ? am I
> right in presuming these are only used when things change on an origin
> node and that they are not used for initial syncs?
>

a copy/initial subscription will not insert any rows into sl_log_1 or 
sl_log_2 on the slave.

> What I would *LOVE*, is the ability to see what is happening. e.g.
> "10,000 rows copied, 89 million to go", type logs.
> I can't do a select on the slave node as that seems to just hang forever.
>
> Any help on what to do would be most appreciated.
>
> Note: slony 2.0.7
>

Slony does not log any progress information as it loops through tuples 
during a COPY for an initial subscribe set.  You should see disk usage 
on your slave go up, and maybe relpages in pg_class for your table or 
the counts in pg_stat_activity.

you should be able to verify that progress is being made though it isn't 
clear to me how you can use that to get a % complete for your table

> Thanks
>
> Jon
>
>
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


From jon at investmentscience.com.au  Thu Dec  8 15:14:23 2011
From: jon at investmentscience.com.au (Jonathon Soong)
Date: Fri, 9 Dec 2011 09:44:23 +1030
Subject: [Slony1-general] slow slony initial load + monitoring
In-Reply-To: <4EE11B1E.7010708@ca.afilias.info>
References: <4264E6801A11844992616B6359BA478D689B9A@invsci-svr1.invsci.local>
	<4EE11B1E.7010708@ca.afilias.info>
Message-ID: <4264E6801A11844992616B6359BA478D689BA9@invsci-svr1.invsci.local>

Thank you very much Steve, very helpful :)

- Jon 

> -----Original Message-----
> From: Steve Singer [mailto:ssinger at ca.afilias.info]
> Sent: Friday, December 09, 2011 6:47 AM
> To: Jonathon Soong
> Cc: slony1-general at lists.slony.info
> Subject: Re: [Slony1-general] slow slony initial load + monitoring
> 
> On 11-12-08 01:16 AM, Jonathon Soong wrote:
> > Hi guys,
> >
> > I'm new to the list and have setup Slony from Australia to Hong Kong
> > over a VPN - it is not a super fast link.
> >
> > I have done this on one database with around 5 million rows and it
was
> > fine - took about 30 minutes to sync up.
> >
> > However with another database that has 90 million+ rows, i'm running
> > into trouble (I did remove indices first)
> >
> > The initial sync seems to be taking too long (15 hours+ when I
stopped it).
> >
> > I was wondering how I monitor if anything is actually happening???:
> >
> >
> > 1. I can see on the origin node, that a COPY seems to be occurring -
> > */can anyone tell me if this is correct?/*
> > 16083 postgres 20 0 212m 7876 5480 S 1.7 0.0 0:10.12 postgres:
> > postgres
> > mydatabase::1(39599) COPY
> >
> > 2. I can see on the slave node when I query sl_status that:
> > - st_last_event is *NOT CHANGING*
> > - st_last_event_ts is *NOT CHANGING*
> > - st_last_received is *NOT CHANGING*
> > - st_last_received_ts is *NOT CHANGING
> > *- st_last_received_event_ts is *NOT CHANGING
> > * - st_lag_num_events is *NOT CHANGING*
> > - st_lag_time is increasing (around 18 hours)
> >
> > Are these values expected or should some of them be increasing?
> 
> While Slony is in the middle of a COPY operation it does so in a
single
> transaction so you should not expect to see the event confirmation
> times/events change until the copy operation is complete.
> 
> 
> 
> >
> > 3. The logs on the slave showed this when I started slony, I presume
> > this is correct:
> > NOTICE: truncate of "public"."my_table" succeeded
> 
> This is normal.  Each time a new table is started you should see that.
> 
> >
> > 4. The logs on the slave now show this repeatedly:
> > 2011-12-08 05:48:47 UTCDEBUG2 remoteListenThread_1: queue event
> > 1,5000001502 SYNC
> > 2011-12-08 05:48:47 UTCDEBUG2 remoteListenThread_1: queue event
> > 1,5000001503 SYNC
> > 2011-12-08 05:48:47 UTCDEBUG2 remoteListenThread_1: queue event
> > 1,5000001504 SYNC
> >
> 
> These are unrelated to your copy but are normal.
> 
> > 5. sl_log_1 and sl_log_2 are empty on both the master and slave - am
I
> > right in presuming these are only used when things change on an
origin
> > node and that they are not used for initial syncs?
> >
> 
> a copy/initial subscription will not insert any rows into sl_log_1 or
> sl_log_2 on the slave.
> 
> > What I would *LOVE*, is the ability to see what is happening. e.g.
> > "10,000 rows copied, 89 million to go", type logs.
> > I can't do a select on the slave node as that seems to just hang
forever.
> >
> > Any help on what to do would be most appreciated.
> >
> > Note: slony 2.0.7
> >
> 
> Slony does not log any progress information as it loops through tuples
during
> a COPY for an initial subscribe set.  You should see disk usage on
your slave go
> up, and maybe relpages in pg_class for your table or the counts in
> pg_stat_activity.
> 
> you should be able to verify that progress is being made though it
isn't clear
> to me how you can use that to get a % complete for your table
> 
> > Thanks
> >
> > Jon
> >
> >
> >
> > _______________________________________________
> > Slony1-general mailing list
> > Slony1-general at lists.slony.info
> > http://lists.slony.info/mailman/listinfo/slony1-general


