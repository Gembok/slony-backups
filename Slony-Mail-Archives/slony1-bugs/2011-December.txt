From bugzilla-daemon at main.slony.info  Tue Dec  6 07:34:41 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue,  6 Dec 2011 07:34:41 -0800 (PST)
Subject: [Slony1-bugs] [Bug 254] New: Can't upgrade or remove an older
 version with a try block
Message-ID: <bug-254-4@http.www.slony.info/bugzilla/>

http://www.slony.info/bugzilla/show_bug.cgi?id=254

           Summary: Can't upgrade or remove an older version with a try
                    block
           Product: Slony-I
           Version: devel
          Platform: PC
        OS/Version: Linux
            Status: NEW
          Severity: enhancement
          Priority: low
         Component: slonik
        AssignedTo: slony1-bugs at lists.slony.info
        ReportedBy: ssinger at ca.afilias.info
                CC: slony1-bugs at lists.slony.info
   Estimated Hours: 0.0


A slonik script like

try {
uninstall node(id=1);
}

or 
try {
update  functions(id=1);
}

won't work if you are upgrading from a version of slony earlier than 2.1
because the sl_event_lock table does not exist.  The try block will try to
obtain an event lock but the table won't exist until after the update functions
runs.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Dec  6 07:47:04 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue,  6 Dec 2011 07:47:04 -0800 (PST)
Subject: [Slony1-bugs] [Bug 252] cloneNodePrepare() stores invalid conninfo
	in sl_path
In-Reply-To: <bug-252-4@http.www.slony.info/bugzilla/>
References: <bug-252-4@http.www.slony.info/bugzilla/>
Message-ID: <20111206154704.51A42290E7B@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=252

Jan Wieck <janwieck at yahoo.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |ssinger at ca.afilias.info
                   |o                           |
           Severity|normal                      |trivial
             Status|NEW                         |ASSIGNED
         OS/Version|Linux                       |All
           Platform|PC                          |All

--- Comment #1 from Jan Wieck <janwieck at yahoo.com> 2011-12-06 07:47:04 PST ---
I don't view this as a bug at all.

Although it is possible that the paths to/from the new node use the same
conninfo string as the ones for the node that is cloned, we do NOT make that
assumption. The cloning process requires explicit STORE PATH commands to
provide this information.

I have created a patch to make the temporary conninfo string '<event pending>'
so that it is consistent with the rest of the code.

https://github.com/wieck/slony1-engine/commit/a8273c700dfdeefa1c82944746384df6caa25236

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Dec  6 07:50:14 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue,  6 Dec 2011 07:50:14 -0800 (PST)
Subject: [Slony1-bugs] [Bug 242] Unable to install slony 2.1 RC1
In-Reply-To: <bug-242-4@http.www.slony.info/bugzilla/>
References: <bug-242-4@http.www.slony.info/bugzilla/>
Message-ID: <20111206155014.6D853290E7B@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=242

Jan Wieck <janwieck at yahoo.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|NEW                         |RESOLVED

--- Comment #5 from Jan Wieck <janwieck at yahoo.com> 2011-12-06 07:50:14 PST ---
Please use the mailing list for those additional questions.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Dec  6 09:01:13 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue,  6 Dec 2011 09:01:13 -0800 (PST)
Subject: [Slony1-bugs] [Bug 252] cloneNodePrepare() stores invalid conninfo
	in sl_path
In-Reply-To: <bug-252-4@http.www.slony.info/bugzilla/>
References: <bug-252-4@http.www.slony.info/bugzilla/>
Message-ID: <20111206170113.67964290E7D@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=252

--- Comment #2 from Mark Summers <womagrid at gmail.com> 2011-12-06 09:01:13 PST ---
(In reply to comment #1)
> I don't view this as a bug at all.
> 
> Although it is possible that the paths to/from the new node use the same
> conninfo string as the ones for the node that is cloned, we do NOT make that
> assumption. The cloning process requires explicit STORE PATH commands to
> provide this information.
> 
> I have created a patch to make the temporary conninfo string '<event pending>'
> so that it is consistent with the rest of the code.
> 
> https://github.com/wieck/slony1-engine/commit/a8273c700dfdeefa1c82944746384df6caa25236

Thank you for looking at this.

The current behavior causes ERROR log entries, which are potentially confusing.
 Your proposed change should address this.

I don't expect the cloning process to figure out or assume the value of
conninfo and I always use STORE PATH.  The issue is probably that I updated the
minimum paths required for replication and did not update the other paths that
were created historically by meta scripts, thereby leaving some 'Event pending'
sl_path entries behind.

So, this issue can be considered resolved.

As an aside, it seems to me that the cloning process, while extremely useful,
is rendered quite inaccessible by the absence of a worked example, including
important points such as when it is necessary to suspend writes to the database
and acknowledging the requirement for explicit STORE PATH.

These things might sound obvious but I was only able to infer the correct
sequence of events by considering the stored procedure implementation of the
prepare and finish functions, and Bernd Helmle's blog posting remains the most
complete documentation I have found.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Dec  7 06:54:14 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  7 Dec 2011 06:54:14 -0800 (PST)
Subject: [Slony1-bugs] [Bug 252] cloneNodePrepare() stores invalid conninfo
	in sl_path
In-Reply-To: <bug-252-4@http.www.slony.info/bugzilla/>
References: <bug-252-4@http.www.slony.info/bugzilla/>
Message-ID: <20111207145414.0E248290E8B@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=252

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|ssinger at ca.afilias.info     |janwieck at yahoo.com

--- Comment #3 from Steve Singer <ssinger at ca.afilias.info> 2011-12-07 06:54:13 PST ---
The change
https://github.com/wieck/slony1-engine/commit/a8273c700dfdeefa1c82944746384df6caa25236
looks fine to commit

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Dec  7 06:58:35 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  7 Dec 2011 06:58:35 -0800 (PST)
Subject: [Slony1-bugs] [Bug 252] cloneNodePrepare() stores invalid conninfo
	in sl_path
In-Reply-To: <bug-252-4@http.www.slony.info/bugzilla/>
References: <bug-252-4@http.www.slony.info/bugzilla/>
Message-ID: <20111207145835.3A948290E6D@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=252

--- Comment #4 from Mark Summers <womagrid at gmail.com> 2011-12-07 06:58:35 PST ---
(In reply to comment #3)
> The change
> https://github.com/wieck/slony1-engine/commit/a8273c700dfdeefa1c82944746384df6caa25236
> looks fine to commit

The new value is missing a 't'.

Sorry to be pedantic but I don't know if Slony looks for angle brackets or the
exact string when deciding whether to attempt to parse conninfo into pairs.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Dec  7 07:58:48 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  7 Dec 2011 07:58:48 -0800 (PST)
Subject: [Slony1-bugs] [Bug 252] cloneNodePrepare() stores invalid conninfo
	in sl_path
In-Reply-To: <bug-252-4@http.www.slony.info/bugzilla/>
References: <bug-252-4@http.www.slony.info/bugzilla/>
Message-ID: <20111207155848.1E6882903B0@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=252

Jan Wieck <janwieck at yahoo.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|janwieck at yahoo.com          |ssinger at ca.afilias.info

--- Comment #5 from Jan Wieck <janwieck at yahoo.com> 2011-12-07 07:58:48 PST ---
Good catch.

https://github.com/wieck/slony1-engine/commit/8279e78471be2811a7518a79c97a55b6d8715f01

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Dec  7 08:42:02 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  7 Dec 2011 08:42:02 -0800 (PST)
Subject: [Slony1-bugs] [Bug 252] cloneNodePrepare() stores invalid conninfo
	in sl_path
In-Reply-To: <bug-252-4@http.www.slony.info/bugzilla/>
References: <bug-252-4@http.www.slony.info/bugzilla/>
Message-ID: <20111207164202.9A3D6290E6A@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=252

--- Comment #6 from Mark Summers <womagrid at gmail.com> 2011-12-07 08:42:02 PST ---
That looks better.

Thanks.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

