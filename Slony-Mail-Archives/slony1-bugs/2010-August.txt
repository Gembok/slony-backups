From bugzilla-daemon at main.slony.info  Tue Aug  3 10:51:05 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue,  3 Aug 2010 10:51:05 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 132] ERROR: duplicate key value violates unique
 constraint "sl_nodelock-pkey"
In-Reply-To: <bug-132-4@http.www.slony.info/bugzilla/>
References: <bug-132-4@http.www.slony.info/bugzilla/>
Message-ID: <20100803175105.61B9A290CE0@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=132

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
           Priority|low                         |medium

--- Comment #1 from Steve Singer <ssinger at ca.afilias.info> 2010-08-03 10:51:05 PDT ---
I've seen this happen some more often.

I think the following is happening.

-a slon_retry() method is called following the move set
-slon_retry signals the parent slon process which in turn sends a kill to the
child
-The child exits, I can find no 'cleanup' process that the child runs on a kill
to ensure the postgresql connections are closed or to remove entries from
sl_nodelock
-The child is restarted by the parent.
-The child calls cleanupNodelock() which checks to see if the pid for the
backend registered with sl_nodelock is still around.  I think sometimes the old
backend process is still around (hasn't yet exited) maybe because it is in the
middle of a query and hasn't yet noticed that the slon it is talking to has
gone away
-Since the backend process is still around the row isn't deleted from
sl_nodelock causing the insert into sl_nodelock to fail.

Since I've seen thsi happen more than an isolated incident and it causes the
watchdog to exit as well I am bumping the priority.

Options to fix this include
1) Having a the slon worker properly exit and remove itself from the
sl_nodelock table before exiting
2) Increase the 'sleep' time before restarting the child.  This doesn't really
fix the problem it just makes it less likely

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug  4 07:19:09 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  4 Aug 2010 07:19:09 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 145] Document Mistake
In-Reply-To: <bug-145-4@http.www.slony.info/bugzilla/>
References: <bug-145-4@http.www.slony.info/bugzilla/>
Message-ID: <20100804141910.11270290CE6@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=145

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|NEW                         |RESOLVED

--- Comment #1 from Steve Singer <ssinger at ca.afilias.info> 2010-08-04 07:19:09 PDT ---
I have tried to address this issues.
My changes have been commited onto REL_2_0_STABLE and master
commit: 46187912fbc6ef36f0a3e85d52e44cd6c96e27a0

Thank you for the report

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug  4 07:37:01 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  4 Aug 2010 07:37:01 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 143] definition of sl_status.st_lag_time
	suspicious
In-Reply-To: <bug-143-4@http.www.slony.info/bugzilla/>
References: <bug-143-4@http.www.slony.info/bugzilla/>
Message-ID: <20100804143701.70559290CE7@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=143

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
           See Also|                            |http://bugs.slony.info/bugz
                   |                            |illa/show_bug.cgi?id=127
         Resolution|                            |INVALID
             Status|NEW                         |RESOLVED

--- Comment #3 from Steve Singer <ssinger at ca.afilias.info> 2010-08-04 07:37:01 PDT ---
Resolving since this isn't a bug.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug  4 10:58:17 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  4 Aug 2010 10:58:17 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 144] replicate_partition stored procedure
 doesn't start replicating changes to the new table
In-Reply-To: <bug-144-4@http.www.slony.info/bugzilla/>
References: <bug-144-4@http.www.slony.info/bugzilla/>
Message-ID: <20100804175817.7C9FE290CE7@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=144

--- Comment #1 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-04 10:58:17 PDT ---
I'm responsible for that one...

The missing piece is that that particular function expects to be run via
EXECUTE SCRIPT.

If it is run thus, then it gets run on each node (so there's no need for a
further event).

There may need to be some remediation relating to alterTableRestore().

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug  4 11:08:58 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  4 Aug 2010 11:08:58 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 122] bad error message: subscribe a set with no
 paths to a dropped node
In-Reply-To: <bug-122-4@http.www.slony.info/bugzilla/>
References: <bug-122-4@http.www.slony.info/bugzilla/>
Message-ID: <20100804180858.B9E76290CE7@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=122

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |ssinger at ca.afilias.info
                   |o                           |
             Status|NEW                         |ASSIGNED

--- Comment #3 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-04 11:08:58 PDT ---
I suggest that the exception's output include the node number, thus:

 raise exception 'Slony-I: subscribeSet() - receiver node % does not exist',
p_sub_receiver;

The slonik script probably indicates the line number at which the failure
occurs, but this doesn't seem over-redundant :-).

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug  4 12:12:13 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  4 Aug 2010 12:12:13 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 146] New: Remove logic for using DELETE on
	sl_log_1/sl_log_2
Message-ID: <bug-146-4@http.www.slony.info/bugzilla/>

http://www.slony.info/bugzilla/show_bug.cgi?id=146

           Summary: Remove logic for using DELETE on sl_log_1/sl_log_2
           Product: Slony-I
           Version: devel
          Platform: PC
        OS/Version: Linux
            Status: NEW
          Severity: enhancement
          Priority: low
         Component: slon
        AssignedTo: slony1-bugs at lists.slony.info
        ReportedBy: cbbrowne at ca.afilias.info
                CC: slony1-bugs at lists.slony.info
   Estimated Hours: 0.0


In 2.0 branch, there is the option to use DELETE, but we default to use
TRUNCATE.

Goal: Remove this.

- Config parameter to remove: cleanup_deletelogs

- cleanupEvent(interval, boolean) can lose the boolean parameter

- cleanupEvent(interval) can remove all logic relating to DELETE

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug  4 12:18:37 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  4 Aug 2010 12:18:37 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 92] Events and Confirmations are not propagating
In-Reply-To: <bug-92-4@http.www.slony.info/bugzilla/>
References: <bug-92-4@http.www.slony.info/bugzilla/>
Message-ID: <20100804191837.1C7142903DB@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=92

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Depends on|                            |127

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug  4 12:18:37 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  4 Aug 2010 12:18:37 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 127] sync events are not generated on nodes that
 are not a set origin
In-Reply-To: <bug-127-4@http.www.slony.info/bugzilla/>
References: <bug-127-4@http.www.slony.info/bugzilla/>
Message-ID: <20100804191837.71E94290CEE@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=127

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
             Blocks|                            |92

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug  4 13:22:40 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  4 Aug 2010 13:22:40 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 146] Remove logic for using DELETE on
	sl_log_1/sl_log_2
In-Reply-To: <bug-146-4@http.www.slony.info/bugzilla/>
References: <bug-146-4@http.www.slony.info/bugzilla/>
Message-ID: <20100804202240.9C898290CD6@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=146

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
             Status|NEW                         |ASSIGNED

--- Comment #1 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-04 13:22:40 PDT ---
I have set up a branch at GitHub, bug-146-HEAD, to implement this change:

http://github.com/cbbrowne/slony1-engine/commit/1d5b00b5ed3bc32477e581f72845c5c9b5f3ed8e

Steve/Jan, please review and commit.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug  4 15:35:22 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  4 Aug 2010 15:35:22 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 142] Minimize security profile
In-Reply-To: <bug-142-4@http.www.slony.info/bugzilla/>
References: <bug-142-4@http.www.slony.info/bugzilla/>
Message-ID: <20100804223522.6E31E290CD6@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=142

--- Comment #3 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-04 15:35:22 PDT ---
(In reply to comment #2)
> I have opened up a branch for this:
> http://github.com/cbbrowne/slony1-engine/tree/bug-142-HEAD

Here are documentation updates:

http://github.com/cbbrowne/slony1-engine/commit/b75d18ce7f41f05a213758374ec52ec4b1ab3b5b

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug  4 15:36:01 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  4 Aug 2010 15:36:01 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 142] Minimize security profile
In-Reply-To: <bug-142-4@http.www.slony.info/bugzilla/>
References: <bug-142-4@http.www.slony.info/bugzilla/>
Message-ID: <20100804223601.96397290CE6@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=142

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|cbbrowne at ca.afilias.info    |ssinger at ca.afilias.info

--- Comment #4 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-04 15:36:01 PDT ---
Steve, could you review this?

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug  4 15:38:26 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  4 Aug 2010 15:38:26 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 141] altertablerestore() is obsolete in 2.0+
In-Reply-To: <bug-141-4@http.www.slony.info/bugzilla/>
References: <bug-141-4@http.www.slony.info/bugzilla/>
Message-ID: <20100804223826.5AB2A290CE6@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=141

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |ssinger at ca.afilias.info
                   |o                           |

--- Comment #3 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-04 15:38:26 PDT ---
This is mostly ready to merge into 2.0

The one challenge in the merge is that it includes, in single patch, change to
Slony-I version number.  That will conflict at merge time.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug  4 15:47:46 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  4 Aug 2010 15:47:46 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 147] New: TABLE ADD KEY is no longer supported
 in 2.x and yet slonik creates scripts using it.
Message-ID: <bug-147-4@http.www.slony.info/bugzilla/>

http://www.slony.info/bugzilla/show_bug.cgi?id=147

           Summary: TABLE ADD KEY is no longer supported in 2.x and yet
                    slonik creates scripts using it.
           Product: Slony-I
           Version: 2.0
          Platform: All
        OS/Version: All
            Status: NEW
          Severity: major
          Priority: low
         Component: slonik
        AssignedTo: slony1-bugs at lists.slony.info
        ReportedBy: githogori at siliconbazaar.com
                CC: slony1-bugs at lists.slony.info
   Estimated Hours: 0.0


TABLE ADD KEY is no longer supported in 2.x and yet slonik creates scripts
using it. This results in an obscure bug that is hard to nail down until one
realizes what the problem is. TABLE ADD KEY should probably also be expunged
from the 2.x docs when it is removed from slonik generated scripts.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Thu Aug  5 06:40:13 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu,  5 Aug 2010 06:40:13 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 142] Minimize security profile
In-Reply-To: <bug-142-4@http.www.slony.info/bugzilla/>
References: <bug-142-4@http.www.slony.info/bugzilla/>
Message-ID: <20100805134013.8B957290CFF@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=142

--- Comment #5 from Steve Singer <ssinger at ca.afilias.info> 2010-08-05 06:40:13 PDT ---
enable_indexes_on_table  and disable_indexes_on_table are declared with
SECURITY DEFINER.   This means that they run with the permissions of the user
that creates the function (a database owner or superuser if you want things to
work).

The problem is that we are not restricting who can call these functions. This
means that ANY user can enable the indexes on ANY table at will.  This can't be
a good idea.

If we are going to do this I think we need to introduce the concept of a slony
replication role/user,

The 'admin conninfo' for slonik commands that involve installing, uninstalling,
or upgrading a node probably need to be done as superuser/database owner.  
As part of the installation process we would need to create a slony replication
role/user. (note people might have multiple slony replicated database as part
of the same postgresql cluster, actually slony even allows multiple 'slony
clusters' as part of the same pg database). 

The slon daemons would then need to use this replication user when they connect
to their local nodes.   The conninfo data for remote databases (store path) can
be even less priviledged.

I don't think we can put this patch into head/master until we can lock down
those functions.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Aug  5 07:42:34 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu,  5 Aug 2010 07:42:34 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 141] altertablerestore() is obsolete in 2.0+
In-Reply-To: <bug-141-4@http.www.slony.info/bugzilla/>
References: <bug-141-4@http.www.slony.info/bugzilla/>
Message-ID: <20100805144234.D73DD290CE6@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=141

--- Comment #4 from Steve Singer <ssinger at ca.afilias.info> 2010-08-05 07:42:34 PDT ---
The changes in your branch related to the bug, removing the altertablerestore
look fine (and the documentation changes)

The diffs on the branch also appear to change the permissions of some of the
shell scripts, don't include that in the commit the gets merged into 2.0

(If you want to change the permissions on the scripts then do it as a seperate
unrelated commit).  Similarly don't actually change the slony release version
to 2.0.3.   Let me know if you need help in doing the merge this way.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Aug  5 09:04:22 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu,  5 Aug 2010 09:04:22 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 141] altertablerestore() is obsolete in 2.0+
In-Reply-To: <bug-141-4@http.www.slony.info/bugzilla/>
References: <bug-141-4@http.www.slony.info/bugzilla/>
Message-ID: <20100805160423.02CBD290CFF@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=141

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #5 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-05 09:04:22 PDT ---
Applied to 2.0-stable

http://git.postgresql.org/gitweb?p=slony1-engine.git;a=commit;h=a555f4dd74f8ff32fe21483ad7fe48491b86f28b

Applied to HEAD:

http://git.postgresql.org/gitweb?p=slony1-engine.git;a=commit;h=b3cf96ee53084ff4b80dd0068d98bc72656c4a2a

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Aug  5 09:04:23 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu,  5 Aug 2010 09:04:23 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 142] Minimize security profile
In-Reply-To: <bug-142-4@http.www.slony.info/bugzilla/>
References: <bug-142-4@http.www.slony.info/bugzilla/>
Message-ID: <20100805160423.63869290D0B@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=142

Bug 142 depends on bug 141, which changed state.

Bug 141 Summary: altertablerestore() is obsolete in 2.0+
http://www.slony.info/bugzilla/show_bug.cgi?id=141

           What    |Old Value                   |New Value
----------------------------------------------------------------------------
             Status|ASSIGNED                    |RESOLVED
         Resolution|                            |FIXED

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Aug  5 09:08:27 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu,  5 Aug 2010 09:08:27 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 142] Minimize security profile
In-Reply-To: <bug-142-4@http.www.slony.info/bugzilla/>
References: <bug-142-4@http.www.slony.info/bugzilla/>
Message-ID: <20100805160827.0A287290CE0@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=142

--- Comment #6 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-05 09:08:27 PDT ---
(In reply to comment #5)
> The problem is that we are not restricting who can call these functions. This
> means that ANY user can enable the indexes on ANY table at will.  This can't be
> a good idea.
> 
> If we are going to do this I think we need to introduce the concept of a slony
> replication role/user,

And that seems like rather a lot of "apparatus" to add in, when *most* people
have been content enough to run slon as superuser.

I'll take out the SECURITY DEFINER definition from the functions, and add, to
the documentation, that this is something that one who wishes to lower the
security profile would need to apply, along with restrictions on who can run
the two functions.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Aug  5 09:11:06 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu,  5 Aug 2010 09:11:06 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 142] Minimize security profile
In-Reply-To: <bug-142-4@http.www.slony.info/bugzilla/>
References: <bug-142-4@http.www.slony.info/bugzilla/>
Message-ID: <20100805161107.00686290CF9@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=142

--- Comment #7 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-05 09:11:07 PDT ---
As per our conversation, some notes need to be added in to indicate another
"variant profile"...

- The user that is managing the slon for a given node needs to have write
access to, essentially, "all Slony-I's stuff."

- But the user that a slon uses to access events on remote nodes need only have
read access against data on those nodes.  It has NO need for write access.

That distinction isn't well-documented.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug  6 11:15:34 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri,  6 Aug 2010 11:15:34 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 122] bad error message: subscribe a set with no
 paths to a dropped node
In-Reply-To: <bug-122-4@http.www.slony.info/bugzilla/>
References: <bug-122-4@http.www.slony.info/bugzilla/>
Message-ID: <20100806181534.CD888290CFB@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=122

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #4 from Steve Singer <ssinger at ca.afilias.info> 2010-08-06 11:15:34 PDT ---
c89fb0bbc7c0588758f670fead02469f98660ac1
03db9e0b2c1625aafdaedbf6bf3730c8889cbb2f

This (including the changes Chris asked for) has been committed to master and
REL_2_0_STABLE

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug  6 13:10:28 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri,  6 Aug 2010 13:10:28 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 142] Minimize security profile
In-Reply-To: <bug-142-4@http.www.slony.info/bugzilla/>
References: <bug-142-4@http.www.slony.info/bugzilla/>
Message-ID: <20100806201028.78042290CE0@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=142

--- Comment #8 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-06 13:10:28 PDT ---
I have:

- Removed SECURITY DEFINER
http://github.com/cbbrowne/slony1-engine/commit/82e16473ecbe800956976730f91caa8594fd4796

- Added notes that hopefully clarify the layers of "reduction of access
privileges" that are possible

http://github.com/cbbrowne/slony1-engine/commit/73a27105db086c01ad7b023b833f70adb513ddb1

There are some other fixes to the docs (in separate commits) to get docs to
build cleanly again.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug  6 13:43:49 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri,  6 Aug 2010 13:43:49 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 147] TABLE ADD KEY is no longer supported in 2.x
 and yet slonik creates scripts using it.
In-Reply-To: <bug-147-4@http.www.slony.info/bugzilla/>
References: <bug-147-4@http.www.slony.info/bugzilla/>
Message-ID: <20100806204349.75B24290D4E@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=147

--- Comment #1 from Steve Singer <ssinger at ca.afilias.info> 2010-08-06 13:43:49 PDT ---
Created an attachment (id=54)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=54)
patch to altperl tools to not support TABLE ADD KEY

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug  6 13:44:09 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri,  6 Aug 2010 13:44:09 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 147] TABLE ADD KEY is no longer supported in 2.x
 and yet slonik creates scripts using it.
In-Reply-To: <bug-147-4@http.www.slony.info/bugzilla/>
References: <bug-147-4@http.www.slony.info/bugzilla/>
Message-ID: <20100806204409.325D4290D2C@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=147

--- Comment #2 from Steve Singer <ssinger at ca.afilias.info> 2010-08-06 13:44:09 PDT ---
Created an attachment (id=55)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=55)
remove TABLE ADD KEY from documentation

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug  6 13:45:56 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri,  6 Aug 2010 13:45:56 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 147] TABLE ADD KEY is no longer supported in 2.x
 and yet slonik creates scripts using it.
In-Reply-To: <bug-147-4@http.www.slony.info/bugzilla/>
References: <bug-147-4@http.www.slony.info/bugzilla/>
Message-ID: <20100806204556.A1796290D4E@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=147

--- Comment #3 from Steve Singer <ssinger at ca.afilias.info> 2010-08-06 13:45:56 PDT ---
Patch attached + included at
http://github.com/ssinger/slony1-engine/commits/bug147

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug  6 14:52:17 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri,  6 Aug 2010 14:52:17 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 147] TABLE ADD KEY is no longer supported in 2.x
 and yet slonik creates scripts using it.
In-Reply-To: <bug-147-4@http.www.slony.info/bugzilla/>
References: <bug-147-4@http.www.slony.info/bugzilla/>
Message-ID: <20100806215217.62076290D5D@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=147

--- Comment #4 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-06 14:52:17 PDT ---
I particularly like the change to the .pm file to make it die if tables are
configured to require TABLE ADD KEY.

So long as this is being applied to 2.0+, I'm fine with de-documenting the
command, too.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug  6 14:53:27 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri,  6 Aug 2010 14:53:27 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 147] TABLE ADD KEY is no longer supported in 2.x
 and yet slonik creates scripts using it.
In-Reply-To: <bug-147-4@http.www.slony.info/bugzilla/>
References: <bug-147-4@http.www.slony.info/bugzilla/>
Message-ID: <20100806215327.94106290D5D@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=147

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |ssinger at ca.afilias.info
                   |o                           |
             Status|NEW                         |ASSIGNED

--- Comment #5 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-06 14:53:27 PDT ---
(In reply to comment #4)
> I particularly like the change to the .pm file to make it die if tables are
> configured to require TABLE ADD KEY.
> 
> So long as this is being applied to 2.0+, I'm fine with de-documenting the
> command, too.

I'd be happy to see the change go in.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Aug  9 07:56:49 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  9 Aug 2010 07:56:49 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 136] listen paths not being rebuilt correctly
In-Reply-To: <bug-136-4@http.www.slony.info/bugzilla/>
References: <bug-136-4@http.www.slony.info/bugzilla/>
Message-ID: <20100809145649.3EAB8290D4E@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=136

--- Comment #5 from Steve Singer <ssinger at ca.afilias.info> 2010-08-09 07:56:49 PDT ---
Patches posted at 
http://lists.slony.info/pipermail/slony1-patches/2010-August/000110.html

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Aug  9 13:04:13 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  9 Aug 2010 13:04:13 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 142] Minimize security profile
In-Reply-To: <bug-142-4@http.www.slony.info/bugzilla/>
References: <bug-142-4@http.www.slony.info/bugzilla/>
Message-ID: <20100809200413.558EC290D4E@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=142

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #9 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-09 13:04:13 PDT ---
Committed to HEAD/Master

http://git.postgresql.org/gitweb?p=slony1-engine.git;a=commit;h=180a92b40af97de89a4ed4ca012b81214cc4a49e

The two places where superuser access is *truly required* have been
shifted to functions where they could readily be:
 a) Turned into security definers, and
 b) Locked down so only the slony management user(s) can run them

Also added documentation on this to "best practices."

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Mon Aug  9 14:09:17 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  9 Aug 2010 14:09:17 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 134] TRUNCATE support
In-Reply-To: <bug-134-4@http.www.slony.info/bugzilla/>
References: <bug-134-4@http.www.slony.info/bugzilla/>
Message-ID: <20100809210917.B0238290D59@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=134

--- Comment #4 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-09 14:09:17 PDT ---
Thinking about implementation...

We could:

a) Try to capture the trigger using the existing C/SPI function.  That seems
like overkill, as we don't need to collect data.

b) Create a trigger function that captures the table ID as its argument, and
uses that to determine which table to truncate.

Consistent with the preceding discussion, I propose using "policy #4" to handle
this, that is, on replicated nodes, we'll run, for each table:
   truncate ONLY my_table CASCADE;

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Aug 10 09:00:08 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 10 Aug 2010 09:00:08 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 148] New: TablesToVacuum tries to vacuum
 pg_listener which no longer exists in 9.0
Message-ID: <bug-148-4@http.www.slony.info/bugzilla/>

http://www.slony.info/bugzilla/show_bug.cgi?id=148

           Summary: TablesToVacuum tries to vacuum pg_listener which no
                    longer exists in 9.0
           Product: Slony-I
           Version: 2.0
          Platform: All
        OS/Version: All
            Status: NEW
          Severity: normal
          Priority: low
         Component: stored procedures
        AssignedTo: slony1-bugs at lists.slony.info
        ReportedBy: ssinger at ca.afilias.info
                CC: slony1-bugs at lists.slony.info
   Estimated Hours: 0.0


info.slony.clustertest.testcoordinator.slony.SlonLauncher db3 - WARNING: 
Slony-I: table pg_listener does not exist in namespace 11/pg_catalog
     [java] 2010-08-10 15:50:43,059 [db3stderr] ERROR
info.slony.clustertest.testcoordinator.slony.SlonLauncher db3 - CONTEXT: 
PL/pgSQL function "tablestovacuum" line 41 at IF


Shows up while testing slony against 9.0.

In 9.0 the pg_listener table has been removed since LISTEN/NOTIFY has been
re-worked.   In 9.0 and above we should not try to vacuum this table.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Aug 10 09:16:45 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 10 Aug 2010 09:16:45 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 118] initial copy of an inherited table can
 leave the table empty
In-Reply-To: <bug-118-4@http.www.slony.info/bugzilla/>
References: <bug-118-4@http.www.slony.info/bugzilla/>
Message-ID: <20100810161645.33A78290CFE@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=118

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #4 from Steve Singer <ssinger at ca.afilias.info> 2010-08-10 09:16:44 PDT ---
This has been commited to 1.2 as well

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Aug 10 09:33:39 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 10 Aug 2010 09:33:39 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 134] TRUNCATE support
In-Reply-To: <bug-134-4@http.www.slony.info/bugzilla/>
References: <bug-134-4@http.www.slony.info/bugzilla/>
Message-ID: <20100810163339.73196290D72@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=134

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
                URL|                            |http://github.com/cbbrowne/
                   |                            |slony1-engine/commits/local
                   |                            |-master/bug-134

--- Comment #5 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-10 09:33:39 PDT ---
I have a branch out on GitHub that has a preliminary implementation.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Aug 10 09:57:55 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 10 Aug 2010 09:57:55 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 148] TablesToVacuum tries to vacuum pg_listener
 which no longer exists in 9.0
In-Reply-To: <bug-148-4@http.www.slony.info/bugzilla/>
References: <bug-148-4@http.www.slony.info/bugzilla/>
Message-ID: <20100810165755.55CEA290D72@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=148

--- Comment #1 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-10 09:57:55 PDT ---
Should be a simple change to ShouldSlonyVacuumTable(), adding an initial test
to the function (note there's an 8.3 and an 8.4 version) which checks to see if
the table exists in pg_class, and returns false if it doesn't exist.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Aug 10 13:19:58 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 10 Aug 2010 13:19:58 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 148] TablesToVacuum tries to vacuum pg_listener
 which no longer exists in 9.0
In-Reply-To: <bug-148-4@http.www.slony.info/bugzilla/>
References: <bug-148-4@http.www.slony.info/bugzilla/>
Message-ID: <20100810201959.02EC4290D44@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=148

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |cbbrowne at ca.afilias.info
                   |o                           |
             Status|NEW                         |ASSIGNED

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Aug 10 13:47:32 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 10 Aug 2010 13:47:32 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 148] TablesToVacuum tries to vacuum pg_listener
 which no longer exists in 9.0
In-Reply-To: <bug-148-4@http.www.slony.info/bugzilla/>
References: <bug-148-4@http.www.slony.info/bugzilla/>
Message-ID: <20100810204732.535E9290D48@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=148

--- Comment #2 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-10 13:47:32 PDT ---
This branch implements the fix...

http://github.com/cbbrowne/slony1-engine/tree/local-master/bug148-head

I'll note that the "problem" here isn't terribly severe.

I took a look at the 1.2 branch - it's more troublesome to fix this there, as
the logic lives mostly on the C side.

I'm not sure if we're concerned about 1.2 being compatible with 9.0?

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 11 09:01:39 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 11 Aug 2010 09:01:39 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 127] sync events are not generated on nodes that
 are not a set origin
In-Reply-To: <bug-127-4@http.www.slony.info/bugzilla/>
References: <bug-127-4@http.www.slony.info/bugzilla/>
Message-ID: <20100811160139.7A2D3290CCA@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=127

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |ssinger at ca.afilias.info
                   |o                           |
             Status|NEW                         |ASSIGNED

--- Comment #3 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-11 09:01:39 PDT ---
(In reply to comment #2)
> Created an attachment (id=49)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=49) [details]
> patch against 2.0 to restore sync generating on all nodes
> 
> This patch reverts the checkin (updated to the 2.0 stream) the original commit
> that disabled generating sync messages on leaf nodes.

The code is a bit more complex than I'd have expected, but this looks
reasonable to me.  (I guess it was more complex to suppress the events than I'd
expected!)

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 11 09:27:43 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 11 Aug 2010 09:27:43 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 78] Vacuum of sl_log_2 with 42M rows is blocking
	replication
In-Reply-To: <bug-78-4@http.www.slony.info/bugzilla/>
References: <bug-78-4@http.www.slony.info/bugzilla/>
Message-ID: <20100811162743.7B851290CCA@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=78

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |cbbrowne at ca.afilias.info
                   |o                           |
             Status|NEW                         |ASSIGNED

--- Comment #5 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-11 09:27:43 PDT ---
(In reply to comment #4)
> We should deprecate the "cleanup_deletelogs" parameter in 2.0.5 or so.

Here is code to implement this against HEAD.

http://github.com/cbbrowne/slony1-engine/tree/bug78

Let me know if I should apply this to 2_0_STABLE as well.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 11 09:30:16 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 11 Aug 2010 09:30:16 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 78] Vacuum of sl_log_2 with 42M rows is blocking
	replication
In-Reply-To: <bug-78-4@http.www.slony.info/bugzilla/>
References: <bug-78-4@http.www.slony.info/bugzilla/>
Message-ID: <20100811163016.3C32A290CD3@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=78

--- Comment #6 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-11 09:30:16 PDT ---
(In reply to comment #3)
> We will remove sl_log_1 and sl_log_2 from the vacuum candidate tables inside of
> cleanupEvent().

This patch in my "bug78" branch does so.

http://github.com/cbbrowne/slony1-engine/commit/fbaf4cdcc33e7d6aae4974a69365da0987b6f72e

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 11 09:32:48 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 11 Aug 2010 09:32:48 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 75] Bugs: (1) Initialize forgotten
 cs->plan_active_log. (2) Session_replication_role and "SET datestyle TO
 'ISO'" in slonik at connection start.
In-Reply-To: <bug-75-4@http.www.slony.info/bugzilla/>
References: <bug-75-4@http.www.slony.info/bugzilla/>
Message-ID: <20100811163248.5E50F290158@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=75

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |ssinger at ca.afilias.info
                   |o                           |
             Status|NEW                         |ASSIGNED

--- Comment #6 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-11 09:32:48 PDT ---
(In reply to comment #5)
> Created an attachment (id=50)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=50) [details]
> patch to commit session changes right away

Looks good to me.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 11 12:20:09 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 11 Aug 2010 12:20:09 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 78] Vacuum of sl_log_2 with 42M rows is blocking
	replication
In-Reply-To: <bug-78-4@http.www.slony.info/bugzilla/>
References: <bug-78-4@http.www.slony.info/bugzilla/>
Message-ID: <20100811192009.9486E290429@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=78

--- Comment #7 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-11 12:20:09 PDT ---
(In reply to comment #5)
> Let me know if I should apply this to 2_0_STABLE as well.

Per discussion 2010-08-11 - don't put this on 2.0 branch.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 11 12:20:28 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 11 Aug 2010 12:20:28 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 78] Vacuum of sl_log_2 with 42M rows is blocking
	replication
In-Reply-To: <bug-78-4@http.www.slony.info/bugzilla/>
References: <bug-78-4@http.www.slony.info/bugzilla/>
Message-ID: <20100811192028.C4D27290CCA@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=78

--- Comment #8 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-11 12:20:28 PDT ---
(In reply to comment #6)
> (In reply to comment #3)
> > We will remove sl_log_1 and sl_log_2 from the vacuum candidate tables inside of
> > cleanupEvent().
> 
> This patch in my "bug78" branch does so.
> 
> http://github.com/cbbrowne/slony1-engine/commit/fbaf4cdcc33e7d6aae4974a69365da0987b6f72e

But this patch should go onto 2.0.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 11 12:26:51 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 11 Aug 2010 12:26:51 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 139] sighandler is calling non async safe
	functions
In-Reply-To: <bug-139-4@http.www.slony.info/bugzilla/>
References: <bug-139-4@http.www.slony.info/bugzilla/>
Message-ID: <20100811192651.84270290CC8@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=139

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |ssinger at ca.afilias.info
                   |o                           |
             Status|NEW                         |ASSIGNED
                URL|                            |http://github.com/ssinger/s
                   |                            |lony1-engine/commit/443a191
                   |                            |c677332a79cdd6f67a1df7db16f
                   |                            |8848b0

--- Comment #1 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-11 12:26:51 PDT ---
Attached link to the relevant Git commit.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 11 12:28:53 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 11 Aug 2010 12:28:53 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 120] store path - after slon has started does
	not take effect
In-Reply-To: <bug-120-4@http.www.slony.info/bugzilla/>
References: <bug-120-4@http.www.slony.info/bugzilla/>
Message-ID: <20100811192853.116BD290CC8@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=120

--- Comment #4 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-11 12:28:53 PDT ---
Seems apropos to me.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 11 12:38:26 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 11 Aug 2010 12:38:26 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 134] TRUNCATE support
In-Reply-To: <bug-134-4@http.www.slony.info/bugzilla/>
References: <bug-134-4@http.www.slony.info/bugzilla/>
Message-ID: <20100811193826.22905290CCA@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=134

--- Comment #6 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-11 12:38:26 PDT ---
Add in some more tests, notably involving foreign key relationships.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 11 13:08:03 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 11 Aug 2010 13:08:03 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 137] excute script does not get applied in the
	correct order
In-Reply-To: <bug-137-4@http.www.slony.info/bugzilla/>
References: <bug-137-4@http.www.slony.info/bugzilla/>
Message-ID: <20100811200803.ADB2D290CD6@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=137

--- Comment #1 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-11 13:08:03 PDT ---
This can only really be rectified in 2.1.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 11 13:36:45 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 11 Aug 2010 13:36:45 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 137] excute script does not get applied in the
	correct order
In-Reply-To: <bug-137-4@http.www.slony.info/bugzilla/>
References: <bug-137-4@http.www.slony.info/bugzilla/>
Message-ID: <20100811203645.A6E7B290CCA@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=137

--- Comment #2 from Jan Wieck <janwieck at yahoo.com> 2010-08-11 13:36:45 PDT ---
This is an MVCC problem. Consider the following time line with xact2 being the
EXECUTE SCRIPT done by slonik:

xact1: begin;
xact1: insert ...

xact2: begin;
xact2: select ddlScript_prepare_int(); -- Creates SYNC event

xact1: commit;

xact2: delete ...

This is running in read committed mode, so the delete of xact2 will see the
row, inserted by xact1 and delete it. However, the SYNC was created before
xact1 committed, so it is considered IN PROGRESS. This causes the insert not to
be part of the SYNC and it will get replicated after the ddl script delete.

To fix this, slonik needs to issue LOCK TABLE statements right after "begin;".
That way, it will wait until all conflicting transactions have committed before
generating its own snapshot. 

We need new syntax to add this information to the EXECUTE SCRIPT command and it
will be the responsibility of the user to provide the list of tables to lock.


Jan

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 11 13:36:59 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 11 Aug 2010 13:36:59 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 137] excute script does not get applied in the
	correct order
In-Reply-To: <bug-137-4@http.www.slony.info/bugzilla/>
References: <bug-137-4@http.www.slony.info/bugzilla/>
Message-ID: <20100811203659.7E1A0290CD7@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=137

Jan Wieck <janwieck at yahoo.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
            Version|2.0                         |devel

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 11 14:03:25 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 11 Aug 2010 14:03:25 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 127] sync events are not generated on nodes that
 are not a set origin
In-Reply-To: <bug-127-4@http.www.slony.info/bugzilla/>
References: <bug-127-4@http.www.slony.info/bugzilla/>
Message-ID: <20100811210325.29E69290CC8@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=127

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #4 from Steve Singer <ssinger at ca.afilias.info> 2010-08-11 14:03:25 PDT ---
Committed to master and REL_2_0_STABLE
fe2c2040fcc454fef9c4da85a518c08840b49c2f
572581c4d80fd95206aed1910fb22d7119aa4be4

Note this has been left as is on the 1.2 branch

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 11 14:03:25 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 11 Aug 2010 14:03:25 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 92] Events and Confirmations are not propagating
In-Reply-To: <bug-92-4@http.www.slony.info/bugzilla/>
References: <bug-92-4@http.www.slony.info/bugzilla/>
Message-ID: <20100811210325.9B57B290CC8@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=92

Bug 92 depends on bug 127, which changed state.

Bug 127 Summary: sync events are not generated on nodes that are not a set origin
http://www.slony.info/bugzilla/show_bug.cgi?id=127

           What    |Old Value                   |New Value
----------------------------------------------------------------------------
             Status|NEW                         |ASSIGNED
             Status|ASSIGNED                    |RESOLVED
         Resolution|                            |FIXED

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 11 14:04:19 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 11 Aug 2010 14:04:19 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 120] store path - after slon has started does
	not take effect
In-Reply-To: <bug-120-4@http.www.slony.info/bugzilla/>
References: <bug-120-4@http.www.slony.info/bugzilla/>
Message-ID: <20100811210419.28AB1290CD7@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=120

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #5 from Steve Singer <ssinger at ca.afilias.info> 2010-08-11 14:04:19 PDT ---
This has been committed to master + REL_2_0_STABLE
66635a8138d6010024834a2416ee63337d366f69
0d1a293927805e5728c39f8000031bd698ab49c4

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 11 14:05:46 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 11 Aug 2010 14:05:46 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 148] TablesToVacuum tries to vacuum pg_listener
 which no longer exists in 9.0
In-Reply-To: <bug-148-4@http.www.slony.info/bugzilla/>
References: <bug-148-4@http.www.slony.info/bugzilla/>
Message-ID: <20100811210546.1084E290CCA@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=148

--- Comment #3 from Steve Singer <ssinger at ca.afilias.info> 2010-08-11 14:05:46 PDT ---
This looks fine to commit.
(note your patch is based on master no 2.0 as the label implies) but it seems
to cherry-pick over to 2.0 with no issues.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 11 14:07:31 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 11 Aug 2010 14:07:31 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 92] Events and Confirmations are not propagating
In-Reply-To: <bug-92-4@http.www.slony.info/bugzilla/>
References: <bug-92-4@http.www.slony.info/bugzilla/>
Message-ID: <20100811210731.98E98290CCA@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=92

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|NEW                         |RESOLVED

--- Comment #3 from Steve Singer <ssinger at ca.afilias.info> 2010-08-11 14:07:31 PDT ---
I am marking this as fixed since bug 127 is now fixed.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 11 14:15:11 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 11 Aug 2010 14:15:11 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 147] TABLE ADD KEY is no longer supported in 2.x
 and yet slonik creates scripts using it.
In-Reply-To: <bug-147-4@http.www.slony.info/bugzilla/>
References: <bug-147-4@http.www.slony.info/bugzilla/>
Message-ID: <20100811211511.47254290429@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=147

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #6 from Steve Singer <ssinger at ca.afilias.info> 2010-08-11 14:15:11 PDT ---
Committed to 2.0 and master
e94dcfeb805d1d4ab5e1d17b2fddf71db4a032c7
 9d827a40bf3a1fdaee599628c439870c7d410848
0e5fef69f824d56b50173abcceb87decdaa4bf43
a2c1cd68c242bc8833b599bb7edb8aef730ed27f

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 11 14:18:31 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 11 Aug 2010 14:18:31 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 130] failover does not seem to update sl_set
In-Reply-To: <bug-130-4@http.www.slony.info/bugzilla/>
References: <bug-130-4@http.www.slony.info/bugzilla/>
Message-ID: <20100811211831.89140290CC8@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=130

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
           See Also|                            |http://bugs.slony.info/bugz
                   |                            |illa/show_bug.cgi?id=136

--- Comment #3 from Steve Singer <ssinger at ca.afilias.info> 2010-08-11 14:18:31 PDT ---
I think this is covered by the proposed patch in bug136?

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 11 14:23:02 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 11 Aug 2010 14:23:02 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 81] duplicate key sl_nodelock-pkey and duplicate
 slon(8) processes not detected
In-Reply-To: <bug-81-4@http.www.slony.info/bugzilla/>
References: <bug-81-4@http.www.slony.info/bugzilla/>
Message-ID: <20100811212302.BC4E8290CCA@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=81

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
           See Also|                            |http://bugs.slony.info/bugz
                   |                            |illa/show_bug.cgi?id=132

--- Comment #6 from Steve Singer <ssinger at ca.afilias.info> 2010-08-11 14:23:02 PDT ---
The proposed patch to bug 132 might address this

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 11 14:46:37 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 11 Aug 2010 14:46:37 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 42] schemadoc formatting bug
In-Reply-To: <bug-42-4@http.www.slony.info/bugzilla/>
References: <bug-42-4@http.www.slony.info/bugzilla/>
Message-ID: <20100811214637.472F8290451@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=42

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|NEW                         |RESOLVED

--- Comment #2 from Steve Singer <ssinger at ca.afilias.info> 2010-08-11 14:46:37 PDT ---
I have committed this patch to 2.0 and master
58569b19545da141aa60b1d98ec680e77c530391
62f476681d6d7cc524433ea01ca24c41b8270e32

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 11 14:54:37 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 11 Aug 2010 14:54:37 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 78] Vacuum of sl_log_2 with 42M rows is blocking
	replication
In-Reply-To: <bug-78-4@http.www.slony.info/bugzilla/>
References: <bug-78-4@http.www.slony.info/bugzilla/>
Message-ID: <20100811215437.E26B6290CC8@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=78

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #9 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-11 14:54:37 PDT ---
Commits to 2.0:

http://git.postgresql.org/gitweb?p=slony1-engine.git;a=commit;h=1253e5771d127289f424e86bf488505c4cb5b98b

http://git.postgresql.org/gitweb?p=slony1-engine.git;a=commit;h=0d172ad1ebbf39b0fbe12e153cccc7427990cc7c

Commits to HEAD:

http://git.postgresql.org/gitweb?p=slony1-engine.git;a=commit;h=1253e5771d127289f424e86bf488505c4cb5b98b

http://git.postgresql.org/gitweb?p=slony1-engine.git;a=log;h=22c32946923cfc8b0de16cd62f507c8842b6af4d

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Aug 12 06:14:37 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 12 Aug 2010 06:14:37 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 149] New: localListener thread failures on
 startup can deadlock slon
Message-ID: <bug-149-4@http.www.slony.info/bugzilla/>

http://www.slony.info/bugzilla/show_bug.cgi?id=149

           Summary: localListener thread failures on startup can deadlock
                    slon
           Product: Slony-I
           Version: 2.0
          Platform: All
        OS/Version: All
            Status: NEW
          Severity: normal
          Priority: low
         Component: slon
        AssignedTo: slony1-bugs at lists.slony.info
        ReportedBy: ssinger at ca.afilias.info
                CC: slony1-bugs at lists.slony.info
   Estimated Hours: 0.0


Created an attachment (id=56)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=56)
patch 

If the localListenThread terminates before it signals the main slon thread that
the localListener has started then the main slon thread will block forever on
this condition waiting for a signal that will never come. 

A patch for this was posted on July 13'th.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Thu Aug 12 06:20:05 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 12 Aug 2010 06:20:05 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 149] localListener thread failures on startup
	can deadlock slon
In-Reply-To: <bug-149-4@http.www.slony.info/bugzilla/>
References: <bug-149-4@http.www.slony.info/bugzilla/>
Message-ID: <20100812132005.EDBBD290333@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=149

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |ssinger at ca.afilias.info
                   |o                           |
             Status|NEW                         |ASSIGNED

--- Comment #1 from Steve Singer <ssinger at ca.afilias.info> 2010-08-12 06:20:06 PDT ---
http://github.com/ssinger/slony1-engine/commit/96e4b596864865326dbe98a06085fdb262e3f950

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Thu Aug 12 10:12:13 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 12 Aug 2010 10:12:13 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 148] TablesToVacuum tries to vacuum pg_listener
 which no longer exists in 9.0
In-Reply-To: <bug-148-4@http.www.slony.info/bugzilla/>
References: <bug-148-4@http.www.slony.info/bugzilla/>
Message-ID: <20100812171213.44DC9290CDB@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=148

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #4 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-12 10:12:13 PDT ---
Cherry-picked patch into 2.0

http://git.postgresql.org/gitweb?p=slony1-engine.git;a=commit;h=ad169009106cebfd83890311e9afac609908dab6

Release notes:

http://git.postgresql.org/gitweb?p=slony1-engine.git;a=commit;h=bffea28fe09ef18e115536e3f4d49b64dd0c534a

Merged into HEAD

http://git.postgresql.org/gitweb?p=slony1-engine.git;a=commit;h=07f6982490fa9b4beb65613d3fa4f32d849b5d33

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Aug 12 10:38:05 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 12 Aug 2010 10:38:05 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 146] Remove logic for using DELETE on
	sl_log_1/sl_log_2
In-Reply-To: <bug-146-4@http.www.slony.info/bugzilla/>
References: <bug-146-4@http.www.slony.info/bugzilla/>
Message-ID: <20100812173805.5D382290384@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=146

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #2 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-12 10:38:05 PDT ---
Committed into HEAD.

Effectively this:

http://git.postgresql.org/gitweb?p=slony1-engine.git;a=commit;h=1d5b00b5ed3bc32477e581f72845c5c9b5f3ed8e

Not doing for 2.0 at this point; if y'all want me to, let me know.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Thu Aug 12 14:55:52 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 12 Aug 2010 14:55:52 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 134] TRUNCATE support
In-Reply-To: <bug-134-4@http.www.slony.info/bugzilla/>
References: <bug-134-4@http.www.slony.info/bugzilla/>
Message-ID: <20100812215553.07A68290429@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=134

--- Comment #7 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-12 14:55:53 PDT ---
I've got a basically working implementation, here.

http://github.com/cbbrowne/slony1-engine/commits/local-master/bug-134

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug 13 05:17:47 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 13 Aug 2010 05:17:47 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 115] Slonik should detect + error out on scripts
 that have a WAIT FOR EVENT in a try block
In-Reply-To: <bug-115-4@http.www.slony.info/bugzilla/>
References: <bug-115-4@http.www.slony.info/bugzilla/>
Message-ID: <20100813121748.053C8290CE0@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=115

Jan Wieck <janwieck at yahoo.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |janwieck at yahoo.com
                   |o                           |

--- Comment #1 from Jan Wieck <janwieck at yahoo.com> 2010-08-13 05:17:47 PDT ---
Created an attachment (id=57)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=57)
Proposed patch for bug 115

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug 13 05:19:30 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 13 Aug 2010 05:19:30 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 115] Slonik should detect + error out on scripts
 that have a WAIT FOR EVENT in a try block
In-Reply-To: <bug-115-4@http.www.slony.info/bugzilla/>
References: <bug-115-4@http.www.slony.info/bugzilla/>
Message-ID: <20100813121931.0532D290CDF@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=115

--- Comment #2 from Jan Wieck <janwieck at yahoo.com> 2010-08-13 05:19:31 PDT ---
Unfortunately it would be very difficult to error out during the parsing
already (which would be far better).

Repository is here: http://github.com/wieck/slony1-engine/tree/bug115

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug 13 05:27:13 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 13 Aug 2010 05:27:13 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 17] slony doesn't build with a 'virtual'
 postgresql installation done with DESTDIR
In-Reply-To: <bug-17-4@http.www.slony.info/bugzilla/>
References: <bug-17-4@http.www.slony.info/bugzilla/>
Message-ID: <20100813122713.90527290CDF@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=17

--- Comment #2 from Jan Wieck <janwieck at yahoo.com> 2010-08-13 05:27:13 PDT ---
How incomplete is the installation of package B? Is pg_config at least
available so that one can use 

./configure --with-pgconfigdir=<path>


Jan

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug 13 06:01:52 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 13 Aug 2010 06:01:52 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 121] 'provider node -1 for set' when subscribing
 from a forwarding node
In-Reply-To: <bug-121-4@http.www.slony.info/bugzilla/>
References: <bug-121-4@http.www.slony.info/bugzilla/>
Message-ID: <20100813130153.00583290CE0@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=121

--- Comment #1 from Steve Singer <ssinger at ca.afilias.info> 2010-08-13 06:01:53 PDT ---
I've also observed this node -1 error on the cascaded nodes (ie node 4)
where I had log shipping running on the slon for node 3.

This was processing a ENABLE_SET message for set 1.

The remoteWorkerThread_1 logged
2010-08-12 20:19:28,859 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-08-12
20:19:28 UTCDEBUG2 re
moteWorkerThread_1: Received event #1 from 5000000043 type:ENABLE_SUBSCRIPTION
2010-08-12 20:19:28,859 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-08-12
20:19:28 UTCDEBUG2 re
moteWorkerThread_1: Received event #1 from 5000000043 type:ENABLE_SUBSCRIPTION

but around this time slon is also restarting with 

2010-08-12 20:18:58,536 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-08-12
20:18:58 UTCWARN   se
rialization problem updating sl_archive_counter: restarting slon

I don't know if the sl_archive_counter is related or not to the node -1 issues.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug 13 06:26:00 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 13 Aug 2010 06:26:00 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 77] Missing confirm records for events in
	sl_confirm table
In-Reply-To: <bug-77-4@http.www.slony.info/bugzilla/>
References: <bug-77-4@http.www.slony.info/bugzilla/>
Message-ID: <20100813132600.CD61A290CE0@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=77

Jan Wieck <janwieck at yahoo.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |INVALID
             Status|NEW                         |RESOLVED

--- Comment #1 from Jan Wieck <janwieck at yahoo.com> 2010-08-13 06:26:00 PDT ---
Not every event confirmations are propagated. Since events are processed
strictly in ascending order, this is not necessary. Having a confirmation for
event N implicitly means that all events <=N are confirmed.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug 13 06:28:17 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 13 Aug 2010 06:28:17 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 99] unable to set datestyle
In-Reply-To: <bug-99-4@http.www.slony.info/bugzilla/>
References: <bug-99-4@http.www.slony.info/bugzilla/>
Message-ID: <20100813132817.A7825290CE2@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=99

--- Comment #2 from Jan Wieck <janwieck at yahoo.com> 2010-08-13 06:28:17 PDT ---
Where exactly is the command 

Set data style to 'ISO';

coming from? I cannot find the string "data style" anywhere in the entire
source tree.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug 13 08:21:36 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 13 Aug 2010 08:21:36 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 99] unable to set datestyle
In-Reply-To: <bug-99-4@http.www.slony.info/bugzilla/>
References: <bug-99-4@http.www.slony.info/bugzilla/>
Message-ID: <20100813152136.6D1DE290CDB@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=99

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Depends on|                            |106

--- Comment #3 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-13 08:21:36 PDT ---
I don't imagine this is actually captured from output.


postgres at cbbrowne:~/slony1-engine.master/src> git checkout REL_2_0_3
HEAD is now at 65fde5f... Changing label to match 2_0_3 instead of the generic
'stable'
postgres at cbbrowne:~/slony1-engine.master/src> ack-grep datestyle
slonik/dbutil.c
142:    slon_mkquery(&query,"SET datestyle TO 'ISO'; "

slon/dbutils.c
101:    /* set the datestyle to ISO */
102:    slon_mkquery(&query, "set datestyle to 'ISO'");
106:            slon_log(SLON_ERROR, "Unable to set the datestyle to ISO\n");

Consider also:

slonik/dbutil.c
143:                                            "SET session_replication_role
TO local; ");

slony_logshipper/parser.c
1925:                                                   "set
session_replication_role to replica;") < 0)

backend/slony1_funcs.sql
3630:                   execute 'set session_replication_role to local;';

slon/remote_worker.c
377:                                            "set session_replication_role =
replica; ",
1376:                                                                    "set
session_replication_role to local; "
1442:                                                            "set
session_replication_role to replica; ",
1465:                                                   if
(archive_append_str(node, "set session_replication_role to local;\n") < 0)
1469:                                                   if
(archive_append_str(node, "set session_replication_role to replica;\n") < 0)
5314:                            "set session_replication_role to replica;\n"

I'm pretty sure that the issue centres around line 142 of slonik/dbutil.c

There has been a nearby change, which was resolved in bug #106.

http://git.postgresql.org/gitweb?p=slony1-engine.git;a=commit;h=dcf7b07ef1a4a7ce7045239577c5dae360d860fc

I don't see anything on the mailing list at about this time, nor in my own
mailboxes.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug 13 08:21:36 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 13 Aug 2010 08:21:36 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 106] Misleading error message "Unable to set
	datestyle"
In-Reply-To: <bug-106-4@http.www.slony.info/bugzilla/>
References: <bug-106-4@http.www.slony.info/bugzilla/>
Message-ID: <20100813152136.BFEB8290CED@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=106

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
             Blocks|                            |99

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug 13 09:55:14 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 13 Aug 2010 09:55:14 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 124] EXECUTE SCRIPT,
	ONLY ON != EVENT NODE is wrong
In-Reply-To: <bug-124-4@http.www.slony.info/bugzilla/>
References: <bug-124-4@http.www.slony.info/bugzilla/>
Message-ID: <20100813165514.8C106290CD6@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=124

--- Comment #1 from Jan Wieck <janwieck at yahoo.com> 2010-08-13 09:55:14 PDT ---
Or change the event node value after parsing with the execute only node (if
given), emitting a warning.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug 13 11:58:14 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 13 Aug 2010 11:58:14 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 115] Slonik should detect + error out on scripts
 that have a WAIT FOR EVENT in a try block
In-Reply-To: <bug-115-4@http.www.slony.info/bugzilla/>
References: <bug-115-4@http.www.slony.info/bugzilla/>
Message-ID: <20100813185814.E3A9F290425@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=115

--- Comment #3 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-13 11:58:14 PDT ---
Created an attachment (id=58)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=58)
Parser change so you can't WAIT FOR inside TRY block

This doesn't exactly provide an intuitive error report if you put WAIT FOR
inside a try block, but this does handle this at parse time...

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug 13 12:57:38 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 13 Aug 2010 12:57:38 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 14] Pull lexer from psql
In-Reply-To: <bug-14-4@http.www.slony.info/bugzilla/>
References: <bug-14-4@http.www.slony.info/bugzilla/>
Message-ID: <20100813195738.42518290158@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=14

Jan Wieck <janwieck at yahoo.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |WONTFIX
             Status|NEW                         |RESOLVED

--- Comment #1 from Jan Wieck <janwieck at yahoo.com> 2010-08-13 12:57:38 PDT ---
There isn't much we would really gain from this. All we really care about is
finding a semicolon that isn't inside of a literal value or qualifier. We just
scan for the various 'quote', "quote" and $$ constructs. The rest of the
content isn't of interest to Slony.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug 13 13:55:48 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 13 Aug 2010 13:55:48 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 150] New: Documenting Bugzilla Usage for Slony-I
Message-ID: <bug-150-4@http.www.slony.info/bugzilla/>

http://www.slony.info/bugzilla/show_bug.cgi?id=150

           Summary: Documenting Bugzilla Usage for Slony-I
           Product: Slony-I
           Version: devel
          Platform: All
        OS/Version: All
            Status: NEW
          Severity: enhancement
          Priority: low
         Component: docs
        AssignedTo: slony1-bugs at lists.slony.info
        ReportedBy: cbbrowne at ca.afilias.info
                CC: slony1-bugs at lists.slony.info
   Estimated Hours: 0.0


We don't really have anything written down as to how it is intended that we use
Bugzilla.  And that's a bit *too* free-form.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug 13 13:56:06 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 13 Aug 2010 13:56:06 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 150] Documenting Bugzilla Usage for Slony-I
In-Reply-To: <bug-150-4@http.www.slony.info/bugzilla/>
References: <bug-150-4@http.www.slony.info/bugzilla/>
Message-ID: <20100813205606.19F68290429@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=150

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |cbbrowne at ca.afilias.info
                   |o                           |

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug 13 14:04:45 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 13 Aug 2010 14:04:45 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 10] Create a CANCEL SUBSCRIPTION command
In-Reply-To: <bug-10-4@http.www.slony.info/bugzilla/>
References: <bug-10-4@http.www.slony.info/bugzilla/>
Message-ID: <20100813210445.13D57290429@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=10

--- Comment #3 from Jan Wieck <janwieck at yahoo.com> 2010-08-13 14:04:45 PDT ---
This should be obsolete if we get bug 111 right. UNSUBSCRIBE SET would have the
functionality of CANCEL SUBSCRIPTION.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug 13 14:08:39 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 13 Aug 2010 14:08:39 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 11] duplicate_node.sh
In-Reply-To: <bug-11-4@http.www.slony.info/bugzilla/>
References: <bug-11-4@http.www.slony.info/bugzilla/>
Message-ID: <20100813210839.5D14329026D@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=11

Jan Wieck <janwieck at yahoo.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |WONTFIX
             Status|NEW                         |RESOLVED

--- Comment #1 from Jan Wieck <janwieck at yahoo.com> 2010-08-13 14:08:39 PDT ---
This enhancement has been superseded by the implementation of CLONE NODE.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug 13 14:24:41 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 13 Aug 2010 14:24:41 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 150] Documenting Bugzilla Usage for Slony-I
In-Reply-To: <bug-150-4@http.www.slony.info/bugzilla/>
References: <bug-150-4@http.www.slony.info/bugzilla/>
Message-ID: <20100813212441.C13DA290429@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=150

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
           Priority|low                         |medium
             Status|NEW                         |ASSIGNED
                URL|                            |http://www.slony.info/bugzi
                   |                            |lla/docs/en/html/lifecycle.
                   |                            |html

--- Comment #1 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-13 14:24:41 PDT ---
Process is suggested here:
http://www.slony.info/bugzilla/docs/en/html/lifecycle.html

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug 13 14:47:40 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 13 Aug 2010 14:47:40 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 18] Patch to shorten "attkind" on logtrigger
	functions
In-Reply-To: <bug-18-4@http.www.slony.info/bugzilla/>
References: <bug-18-4@http.www.slony.info/bugzilla/>
Message-ID: <20100813214740.693DC29026D@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=18

Jan Wieck <janwieck at yahoo.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED
            Version|devel                       |2.0

--- Comment #4 from Jan Wieck <janwieck at yahoo.com> 2010-08-13 14:47:40 PDT ---
This is the current behavior in REL_2_0_STABLE as well as HEAD. Closing this
bug as fixed.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug 13 15:39:28 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 13 Aug 2010 15:39:28 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 150] Documenting Bugzilla Usage for Slony-I
In-Reply-To: <bug-150-4@http.www.slony.info/bugzilla/>
References: <bug-150-4@http.www.slony.info/bugzilla/>
Message-ID: <20100813223928.13EA7290CD6@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=150

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|cbbrowne at ca.afilias.info    |slony1-bugs at lists.slony.inf
                   |                            |o
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED
                URL|http://www.slony.info/bugzi |http://main.slony.info/bug-
                   |lla/docs/en/html/lifecycle. |processing.html
                   |html                        |

--- Comment #2 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-13 15:39:28 PDT ---
I've written up a page as an initial proposal.

The statuses provided by default by bugzilla seem pretty reasonable, and it
comes with quite a nice diagram indicating the relationships between them.

The result may be found in the <tt>slony1-www</tt> CVS repository; look for the
file <tt> bug-processing.html</tt>

Passing the bug back over to slony1-bugs; others may examine and request
revision as needed.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug 13 19:28:54 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 13 Aug 2010 19:28:54 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 53] High memory usage when using high table id
In-Reply-To: <bug-53-4@http.www.slony.info/bugzilla/>
References: <bug-53-4@http.www.slony.info/bugzilla/>
Message-ID: <20100814022854.E3A18290CD7@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=53

Jan Wieck <janwieck at yahoo.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
            Version|1.2                         |2.0

--- Comment #2 from Jan Wieck <janwieck at yahoo.com> 2010-08-13 19:28:54 PDT ---
I've moved this one to 2.0, since it isn't critical but should be fixed.
Instead of a hash table, this could also be implemented as a btree without
causing any dependencies, which would be a requirement to consider it for
2.0.x.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug 13 19:35:04 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 13 Aug 2010 19:35:04 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 57] Missing data and syncs ignored
In-Reply-To: <bug-57-4@http.www.slony.info/bugzilla/>
References: <bug-57-4@http.www.slony.info/bugzilla/>
Message-ID: <20100814023504.D4E0D290CD7@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=57

Jan Wieck <janwieck at yahoo.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |WONTFIX
             Status|NEW                         |RESOLVED

--- Comment #1 from Jan Wieck <janwieck at yahoo.com> 2010-08-13 19:35:04 PDT ---
This has apparently never been observed again. At Afilias, we have been running
1.2 now for many years and never had anything like it.

It seems to me that both, the initially missing replication information, and
then the failing SYNC that magically turns into an empty one (0 rows inserted
etc.) can be explained by something like a corrupted index, hiding the rows.

I am closing this bug.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug 13 19:41:55 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 13 Aug 2010 19:41:55 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 59] slony doesn't escape varchar fields properly,
 making it impossible to replicate varchar or bytea columns in some cases
In-Reply-To: <bug-59-4@http.www.slony.info/bugzilla/>
References: <bug-59-4@http.www.slony.info/bugzilla/>
Message-ID: <20100814024155.A3F8C290CEC@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=59

Jan Wieck <janwieck at yahoo.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
           Severity|critical                    |normal

--- Comment #4 from Jan Wieck <janwieck at yahoo.com> 2010-08-13 19:41:55 PDT ---
Changing importance to "normal". This can be avoided by using

alter user slony set client_encoding to <common-encoding>;

on all servers in the Slony cluster and NOT having any of the databases use
server_encoding SQL_ASCII (which is discouraged anyway).

We still want to fix it, but since this is a completely new feature, we won't
implement it before 2.1.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug 13 19:50:22 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 13 Aug 2010 19:50:22 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 62] Initial subscription blocks with "sequence
 ID <xxx> has already been assigned"
In-Reply-To: <bug-62-4@http.www.slony.info/bugzilla/>
References: <bug-62-4@http.www.slony.info/bugzilla/>
Message-ID: <20100814025022.2D62A290CED@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=62

--- Comment #6 from Jan Wieck <janwieck at yahoo.com> 2010-08-13 19:50:22 PDT ---
Merging sets does not invoke setAddTable() or setAddSequence(). Is it possible
that these are results of issuing MERGE SET while a subscription is under way?

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug 13 20:00:34 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 13 Aug 2010 20:00:34 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 75] Bugs: (1) Initialize forgotten
 cs->plan_active_log. (2) Session_replication_role and "SET datestyle TO
 'ISO'" in slonik at connection start.
In-Reply-To: <bug-75-4@http.www.slony.info/bugzilla/>
References: <bug-75-4@http.www.slony.info/bugzilla/>
Message-ID: <20100814030034.B8AAB290158@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=75

--- Comment #7 from Jan Wieck <janwieck at yahoo.com> 2010-08-13 20:00:34 PDT ---
This is wrong. The problem is actually in src/slonik/dbutils.c (I know, it's
always a mistake to have identically named files in multiple directories).

There, db_connect() doesn't use PQexec() to set the datestyle, but it uses
db_exec_command(), which automatically starts a transaction if none is open
yet. That transaction needs to be committed by db_connect() via
db_xact_commit().

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug 13 20:01:42 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 13 Aug 2010 20:01:42 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 75] Bugs: (1) Initialize forgotten
 cs->plan_active_log. (2) Session_replication_role and "SET datestyle TO
 'ISO'" in slonik at connection start.
In-Reply-To: <bug-75-4@http.www.slony.info/bugzilla/>
References: <bug-75-4@http.www.slony.info/bugzilla/>
Message-ID: <20100814030142.2D73B290CEC@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=75

Jan Wieck <janwieck at yahoo.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
            Version|devel                       |2.0

--- Comment #8 from Jan Wieck <janwieck at yahoo.com> 2010-08-13 20:01:42 PDT ---
Making this a 2.0 issue since it is an actual bug that needs to be fixed for
2.0.5.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug 13 20:34:34 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 13 Aug 2010 20:34:34 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 75] Bugs: (1) Initialize forgotten
 cs->plan_active_log. (2) Session_replication_role and "SET datestyle TO
 'ISO'" in slonik at connection start.
In-Reply-To: <bug-75-4@http.www.slony.info/bugzilla/>
References: <bug-75-4@http.www.slony.info/bugzilla/>
Message-ID: <20100814033434.633FE290429@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=75

Jan Wieck <janwieck at yahoo.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
  Attachment #50 is|0                           |1
           obsolete|                            |

--- Comment #9 from Jan Wieck <janwieck at yahoo.com> 2010-08-13 20:34:34 PDT ---
Created an attachment (id=59)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=59)
Proposed patch for bug 75

Patch to commit session settings. Available also at github as a branch off
REL_2_0_STABLE here: http://github.com/wieck/slony1-engine/tree/bug75

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug 13 21:13:26 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 13 Aug 2010 21:13:26 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 79] --prefix and --exec-prefix options don't
 function as expected
In-Reply-To: <bug-79-4@http.www.slony.info/bugzilla/>
References: <bug-79-4@http.www.slony.info/bugzilla/>
Message-ID: <20100814041327.02C6E290CD7@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=79

--- Comment #2 from Jan Wieck <janwieck at yahoo.com> 2010-08-13 21:13:27 PDT ---
The currently correct way IMHO is to use neither of those options at all, but
instead invoke configure as

./configure --with-pgconfigdir=<path-to-desired-pg-bin-dir> ...

The only other options given here should be things like --with-docs and the
like, that only affect what is built.

Slony-I highly depends on having its stuff installed in what the backend thinks
$libdir is. Using pg_config is your best bet to get that right.

This is probably a documentation issue.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Aug 16 07:51:00 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 16 Aug 2010 07:51:00 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 10] Create a CANCEL SUBSCRIPTION command
In-Reply-To: <bug-10-4@http.www.slony.info/bugzilla/>
References: <bug-10-4@http.www.slony.info/bugzilla/>
Message-ID: <20100816145100.DC22C290CE0@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=10

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |WONTFIX
             Status|ASSIGNED                    |RESOLVED
         Depends on|                            |111

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Aug 16 07:51:01 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 16 Aug 2010 07:51:01 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 111] node -1 not found in runtime configuration
In-Reply-To: <bug-111-4@http.www.slony.info/bugzilla/>
References: <bug-111-4@http.www.slony.info/bugzilla/>
Message-ID: <20100816145101.1CC61290D0B@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=111

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
             Blocks|                            |10

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Aug 16 08:54:05 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 16 Aug 2010 08:54:05 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 138] groff detection in configure broken
In-Reply-To: <bug-138-4@http.www.slony.info/bugzilla/>
References: <bug-138-4@http.www.slony.info/bugzilla/>
Message-ID: <20100816155405.7B854290CD8@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=138

--- Comment #2 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-16 08:54:05 PDT ---
Looks good to me.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Aug 16 08:54:21 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 16 Aug 2010 08:54:21 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 138] groff detection in configure broken
In-Reply-To: <bug-138-4@http.www.slony.info/bugzilla/>
References: <bug-138-4@http.www.slony.info/bugzilla/>
Message-ID: <20100816155421.D89F429041E@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=138

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |ssinger at ca.afilias.info
                   |o                           |
             Status|NEW                         |ASSIGNED

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Aug 16 08:54:35 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 16 Aug 2010 08:54:35 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 138] groff detection in configure broken
In-Reply-To: <bug-138-4@http.www.slony.info/bugzilla/>
References: <bug-138-4@http.www.slony.info/bugzilla/>
Message-ID: <20100816155435.77D8729041E@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=138

--- Comment #3 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-16 08:54:35 PDT ---
FYI, that seems also to apply to HEAD.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Mon Aug 16 11:42:12 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 16 Aug 2010 11:42:12 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 90] Error while running "make" for Slony 2.0 on
	Solaris 2.11
In-Reply-To: <bug-90-4@http.www.slony.info/bugzilla/>
References: <bug-90-4@http.www.slony.info/bugzilla/>
Message-ID: <20100816184212.55D0F290C33@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=90

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |WORKSFORME
             Status|NEW                         |RESOLVED

--- Comment #2 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-16 11:42:12 PDT ---
Given that there have been no further reports on this, I speculate that this
was a configuration problem with a particular user's environment, as opposed to
a bug in Slony-I code itself.

Feel free to reopen this should the problem re-present itself.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Aug 16 11:57:15 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 16 Aug 2010 11:57:15 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 104] slon core in sched_add_fdset
In-Reply-To: <bug-104-4@http.www.slony.info/bugzilla/>
References: <bug-104-4@http.www.slony.info/bugzilla/>
Message-ID: <20100816185715.CD63F290C86@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=104

--- Comment #6 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-16 11:57:15 PDT ---
(In reply to comment #5)
> Created an attachment (id=48)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=48) [details]
> new attempt at fixing bug 104

Looks good to me.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Mon Aug 16 14:08:16 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 16 Aug 2010 14:08:16 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 79] --prefix and --exec-prefix options don't
 function as expected
In-Reply-To: <bug-79-4@http.www.slony.info/bugzilla/>
References: <bug-79-4@http.www.slony.info/bugzilla/>
Message-ID: <20100816210816.843FF290CEC@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=79

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |cbbrowne at ca.afilias.info
                   |o                           |

--- Comment #3 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-16 14:08:16 PDT ---
I'll see about adding this to the documentation.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Aug 16 14:26:59 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 16 Aug 2010 14:26:59 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 79] --prefix and --exec-prefix options don't
 function as expected
In-Reply-To: <bug-79-4@http.www.slony.info/bugzilla/>
References: <bug-79-4@http.www.slony.info/bugzilla/>
Message-ID: <20100816212659.61FED290CF6@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=79

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #4 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-16 14:26:59 PDT ---
Added better documentation to HEAD:

http://git.postgresql.org/gitweb?p=slony1-engine.git;a=commitdiff;h=7a6791501014799adc8a0bb7c2c9692777cc24a5

Also, cherry-picked into 2.0 branch:

http://git.postgresql.org/gitweb?p=slony1-engine.git;a=commit;h=4ed4d80546db1c5d9fd9c82caaa546ef2eeee0e0

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 18 09:29:26 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 18 Aug 2010 09:29:26 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 136] listen paths not being rebuilt correctly
In-Reply-To: <bug-136-4@http.www.slony.info/bugzilla/>
References: <bug-136-4@http.www.slony.info/bugzilla/>
Message-ID: <20100818162926.D25C9290CE0@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=136

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |ssinger at ca.afilias.info
                   |o                           |
             Status|NEW                         |ASSIGNED

--- Comment #6 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-18 09:29:26 PDT ---
I have posted a suggested patch to Steve's patch.

http://github.com/cbbrowne/slony1-engine/commit/18d9a819a031269e336697e1fff291e1cbcd3667

Looking OK to me.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 18 10:04:25 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 18 Aug 2010 10:04:25 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 115] Slonik should detect + error out on scripts
 that have a WAIT FOR EVENT in a try block
In-Reply-To: <bug-115-4@http.www.slony.info/bugzilla/>
References: <bug-115-4@http.www.slony.info/bugzilla/>
Message-ID: <20100818170425.D7431290CDB@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=115

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
             Status|NEW                         |ASSIGNED

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 18 10:13:16 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 18 Aug 2010 10:13:16 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 13] Change Slony-I to use PGXS
In-Reply-To: <bug-13-4@http.www.slony.info/bugzilla/>
References: <bug-13-4@http.www.slony.info/bugzilla/>
Message-ID: <20100818171316.4E72E290CFF@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=13

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |WONTFIX
             Status|NEW                         |RESOLVED

--- Comment #1 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-18 10:13:16 PDT ---
We still need to do dependency determination for things like:

- What functions are available for use (which differ somewhat between PG
versions)

- Where's Jade and other non-PG-related build tools

- Integration with packaging tools like RPM/dpkg

Doesn't seem worthwhile to change this any time soon.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 18 10:17:22 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 18 Aug 2010 10:17:22 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 134] TRUNCATE support
In-Reply-To: <bug-134-4@http.www.slony.info/bugzilla/>
References: <bug-134-4@http.www.slony.info/bugzilla/>
Message-ID: <20100818171722.844B5290CF9@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=134

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |cbbrowne at ca.afilias.info
                   |o                           |

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 18 10:22:09 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 18 Aug 2010 10:22:09 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 137] execute script does not get applied in the
	correct order
In-Reply-To: <bug-137-4@http.www.slony.info/bugzilla/>
References: <bug-137-4@http.www.slony.info/bugzilla/>
Message-ID: <20100818172209.2DEFD290CDB@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=137

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
            Summary|excute script does not get  |execute script does not get
                   |applied in the correct      |applied in the correct
                   |order                       |order
         Depends on|                            |134

--- Comment #3 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-18 10:22:09 PDT ---
Concurrent with resolution of the other issues, we might wish to shift the DDL
data from sl_event to sl_log_1/2.

In that case, we'd parse the statements just once, inside Slonik, and introduce
one sl_log_* tuple for each statement.

This eliminates the need to parse things later, and eliminates the need to link
the C code in src/parsestatements to both slon and slonik - it's only needed by
slon.

We had speculated that this split might allow avoiding the ordering problems,
but that is regrettably not the case, even in the ambitious scenario where we'd
have commit timestamps available to us, because the time at which the DDL is
executed and the time at which the DDL statement is recorded in sl_log_* isn't
identical.

But we'd get the other benefits mentioned earlier from the split/shift, e.g. -
parse once, and eliminate component from slon.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 18 10:22:09 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 18 Aug 2010 10:22:09 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 134] TRUNCATE support
In-Reply-To: <bug-134-4@http.www.slony.info/bugzilla/>
References: <bug-134-4@http.www.slony.info/bugzilla/>
Message-ID: <20100818172209.7BEF1290CF9@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=134

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
             Blocks|                            |137

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 18 10:23:27 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 18 Aug 2010 10:23:27 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 137] execute script does not get applied in the
	correct order
In-Reply-To: <bug-137-4@http.www.slony.info/bugzilla/>
References: <bug-137-4@http.www.slony.info/bugzilla/>
Message-ID: <20100818172327.DFC94290CF9@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=137

--- Comment #4 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-18 10:23:28 PDT ---
BTW, the dependancy on #134 is there because, if we shift DDL into sl_log_*,
then the processing of it on subscribers shifts around into the same logic that
bug #134 (implementing TRUNCATE-handling triggers) uses.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 18 12:06:38 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 18 Aug 2010 12:06:38 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 67] Array overrun in logtrigger()
In-Reply-To: <bug-67-4@http.www.slony.info/bugzilla/>
References: <bug-67-4@http.www.slony.info/bugzilla/>
Message-ID: <20100818190638.D8529290C1E@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=67

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #8 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-18 12:06:38 PDT ---
The change is in 2.0 and HEAD, so I'm inclined to mark this as resolved.

Regrettably, the test didn't seem to successfully exercise the bug in an
un-patched version of Slony-I.  Not sure what to do about that.

If this re-emerges, it's certainly fair to reopen it, but we quite badly need
an example of the problem that can be duplicated to further validate things.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 18 12:32:52 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 18 Aug 2010 12:32:52 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 41] Links to stored procedures prefixed with
 'schemadoc' everywhere
In-Reply-To: <bug-41-4@http.www.slony.info/bugzilla/>
References: <bug-41-4@http.www.slony.info/bugzilla/>
Message-ID: <20100818193252.E84B4290C1E@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=41

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|NEW                         |RESOLVED

--- Comment #1 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-18 12:32:52 PDT ---
This is actually a bug in PostgreSQL Autodoc.

If I apply the fix to autodoc described in the following commit, the labels are
more appropriate.

http://github.com/cbbrowne/PostgreSQL-Autodoc/commit/90b089685c3dd6fa1f863e0cfcfc51936b464bdb

There may still be a problem there, but in any case, it's an upstream bug in
Autodoc, which I'll (exceedingly belatedly!) bounce over to Rod Taylor.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 18 13:02:05 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 18 Aug 2010 13:02:05 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 124] EXECUTE SCRIPT,
	ONLY ON != EVENT NODE is wrong
In-Reply-To: <bug-124-4@http.www.slony.info/bugzilla/>
References: <bug-124-4@http.www.slony.info/bugzilla/>
Message-ID: <20100818200205.B03F2290CB7@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=124

--- Comment #2 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-18 13:02:05 PDT ---
(In reply to comment #0)
> 3) Generate an error if event node != ONLY ON and let the user fix their
> script.

I favour this option, generally.

There's also the nuance that when you do "EXECUTE ONLY ON," there isn't an
event generated, so I'd think it a fine idea to require that EVENT NODE be left
blank, in this case.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 18 13:03:33 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 18 Aug 2010 13:03:33 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 124] EXECUTE SCRIPT,
	ONLY ON != EVENT NODE is wrong
In-Reply-To: <bug-124-4@http.www.slony.info/bugzilla/>
References: <bug-124-4@http.www.slony.info/bugzilla/>
Message-ID: <20100818200333.74457290CB7@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=124

--- Comment #3 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-18 13:03:33 PDT ---
Created an attachment (id=60)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=60)
Have DDL validate that not both EVENT NODE and ONLY ON NODE are set

Here's a patch that validates that EVENT NODE and ONLY ON NODE are not both
present.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 18 13:15:54 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 18 Aug 2010 13:15:54 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 17] slony doesn't build with a 'virtual'
 postgresql installation done with DESTDIR
In-Reply-To: <bug-17-4@http.www.slony.info/bugzilla/>
References: <bug-17-4@http.www.slony.info/bugzilla/>
Message-ID: <20100818201554.8428A290CD8@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=17

--- Comment #3 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-18 13:15:54 PDT ---
In view that there's some disagreement on this, I'm inclined to close this out
as a "do not fix" item.

Useful scenario or not, the package builders for Debian, Fedora, and
Windows(tm) haven't been clamoring for this, and there are packages out there
getting built.  So while "nice to have," this is the only mention that there
has been of this.

I'd be more inclined to get PGXS support working, as in bug #13, but dropped
that as not of enough interest.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Aug 19 10:19:14 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 19 Aug 2010 10:19:14 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 40] libpq thread test insufficient
In-Reply-To: <bug-40-4@http.www.slony.info/bugzilla/>
References: <bug-40-4@http.www.slony.info/bugzilla/>
Message-ID: <20100819171915.07D14290CDC@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=40

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|janwieck at yahoo.com          |cbbrowne at ca.afilias.info

--- Comment #3 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-19 10:19:14 PDT ---
I have set up a branch (of REL_2_0_STABLE) for this:

http://github.com/cbbrowne/slony1-engine/commits/bug40

As per Peter's comments, I'm treating Linux as the only platform where we
assume that libpq is compiled thread-safely.  If there are other platforms
where that should be deemed to be the case, please let me know.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Aug 19 12:37:55 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 19 Aug 2010 12:37:55 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 99] unable to set datestyle
In-Reply-To: <bug-99-4@http.www.slony.info/bugzilla/>
References: <bug-99-4@http.www.slony.info/bugzilla/>
Message-ID: <20100819193755.E2223290CF1@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=99

--- Comment #4 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-19 12:37:55 PDT ---
The report isn't consistent with the code (in any state/branch/version), and
hasn't been reported on in about a year.

We have made changes to the relevant logic (bug #106).

I think if we don't hear anything more on the bug fairly soon, say, by the end
of August 2010, it should be reasonable to close it out.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Thu Aug 19 12:46:41 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 19 Aug 2010 12:46:41 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 126] slon sometimes does not recover from a
	network outage
In-Reply-To: <bug-126-4@http.www.slony.info/bugzilla/>
References: <bug-126-4@http.www.slony.info/bugzilla/>
Message-ID: <20100819194641.E8419290CE0@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=126

--- Comment #1 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-19 12:46:42 PDT ---
Does this involve:

a) Setting GUC defaults for:

tcp_keepalives_count
tcp_keepalives_idle
tcp_keepalives_interval

b) Something else???

If it's a matter of setting GUC's, then a Gentle User might use the
sql_on_connection parameter to set these GUCs.

<http://slony.info/documentation/slon-config-connection.html>

If there are values to be suggested, then let's put this into the
documentation, probably in the "best practices" section.

http://git.postgresql.org/gitweb?p=slony1-engine.git;a=blob;f=doc/adminguide/bestpractices.sgml

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Thu Aug 19 12:47:45 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 19 Aug 2010 12:47:45 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 126] slon sometimes does not recover from a
	network outage
In-Reply-To: <bug-126-4@http.www.slony.info/bugzilla/>
References: <bug-126-4@http.www.slony.info/bugzilla/>
Message-ID: <20100819194745.792AA290CE0@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=126

--- Comment #2 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-19 12:47:45 PDT ---
I'll note that the default GUC values on 8.4 are thus:

org=# show tcp_keepalives_count;
 tcp_keepalives_count
----------------------
 9
(1 row)

org=# show tcp_keepalives_idle ;
 tcp_keepalives_idle
---------------------
 7200
(1 row)

org=# show tcp_keepalives_interval ;
 tcp_keepalives_interval
-------------------------
 75
(1 row)

org=# select version();
                                             version
--------------------------------------------------------------------------------------------------
 PostgreSQL 8.4.4 on x86_64-unknown-linux-gnu, compiled by GCC gcc (Debian
4.4.4-6) 4.4.4, 64-bit
(1 row)

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Thu Aug 19 12:55:15 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 19 Aug 2010 12:55:15 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 128] DROP TABLE replicatedTable leaves the
 cluster in a bad state
In-Reply-To: <bug-128-4@http.www.slony.info/bugzilla/>
References: <bug-128-4@http.www.slony.info/bugzilla/>
Message-ID: <20100819195515.DC1A8290CEC@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=128

--- Comment #1 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-19 12:55:15 PDT ---
That seems pretty apropos to me.

There's still a problem can take place on a remote node...

Suppose the sequence of events is thus:

1.  Table gets dropped on several nodes, possibly not the origin.

2.  MOVE SET is submitted, and, as the table was there on the origin, works
fine, and starts propagating.

3.  SET DROP TABLE is submitted.

The MOVE SET can keep on failing on the subscriber due to the table being gone.
 It'll never get around to the SET DROP TABLE request.

A resolution to this scenario would be for MOVE SET to have an exception block
that catches the "table not found" problem, and then peeks into the future
event stream to see if a suitable SET DROP TABLE is waiting.

It could, still, of course, be a terrible idea to do this.  

Note that a similar problem can happen with plain SYNCs, with some sl_log_[1|2]
entries getting "orphaned" because the table got dropped a subscriber before
relevant sl_log_* data got drained out.

The two problems likely need similarly shaped resolutions.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Thu Aug 19 12:56:45 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 19 Aug 2010 12:56:45 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 17] slony doesn't build with a 'virtual'
 postgresql installation done with DESTDIR
In-Reply-To: <bug-17-4@http.www.slony.info/bugzilla/>
References: <bug-17-4@http.www.slony.info/bugzilla/>
Message-ID: <20100819195645.4AC49290CE0@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=17

--- Comment #4 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-19 12:56:45 PDT ---
If there's no further discussion in favour of this, I propose closing this as
"WILLNOTFIX" in September.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Aug 19 12:57:19 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 19 Aug 2010 12:57:19 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 117] syslog=2,
 messages go both to syslog and the standard output.
In-Reply-To: <bug-117-4@http.www.slony.info/bugzilla/>
References: <bug-117-4@http.www.slony.info/bugzilla/>
Message-ID: <20100819195719.DFED8290CEC@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=117

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |cbbrowne at ca.afilias.info
                   |o                           |
             Status|NEW                         |ASSIGNED

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Thu Aug 19 12:59:05 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 19 Aug 2010 12:59:05 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 137] execute script does not get applied in the
	correct order
In-Reply-To: <bug-137-4@http.www.slony.info/bugzilla/>
References: <bug-137-4@http.www.slony.info/bugzilla/>
Message-ID: <20100819195905.6E238290CE0@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=137

--- Comment #5 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-19 12:59:05 PDT ---
(In reply to comment #4)
> BTW, the dependancy on #134 is there because, if we shift DDL into sl_log_*,
> then the processing of it on subscribers shifts around into the same logic that
> bug #134 (implementing TRUNCATE-handling triggers) uses.

Note that some further discussion is taking place on the mailing list; see the
following thread:

http://lists.slony.info/pipermail/slony1-general/2010-August/011051.html

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Thu Aug 19 13:39:16 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 19 Aug 2010 13:39:16 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 75] Bugs: (1) Initialize forgotten
 cs->plan_active_log. (2) Session_replication_role and "SET datestyle TO
 'ISO'" in slonik at connection start.
In-Reply-To: <bug-75-4@http.www.slony.info/bugzilla/>
References: <bug-75-4@http.www.slony.info/bugzilla/>
Message-ID: <20100819203916.1521D290CCA@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=75

--- Comment #10 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-19 13:39:16 PDT ---
(In reply to comment #9)
> Created an attachment (id=59)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=59) [details]
> Proposed patch for bug 75
> 
> Patch to commit session settings. Available also at github as a branch off
> REL_2_0_STABLE here: http://github.com/wieck/slony1-engine/tree/bug75

This compiles and runs fine for me, against the "testddl" test
(http://github.com/wieck/slony1-engine/tree/master/tests/testddl/).

Unfortunately, according to the bug, we're masking the problem.

Is there a straightforward way to induce the bug to express itself, so that we
can expressly see that it's fixed?  I'd think there should be some update we
could do to "testddl" that would exercise the bug, even if all it involves is
spelunking in the Postgres logs to verify that raised notices indicate the
right values.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Aug 19 13:44:26 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 19 Aug 2010 13:44:26 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 139] sighandler is calling non async safe
	functions
In-Reply-To: <bug-139-4@http.www.slony.info/bugzilla/>
References: <bug-139-4@http.www.slony.info/bugzilla/>
Message-ID: <20100819204426.47238290CEC@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=139

--- Comment #2 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-19 13:44:26 PDT ---
I've run some tests against this, and not found any regressions.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Aug 19 14:11:04 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 19 Aug 2010 14:11:04 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 125] New init script
In-Reply-To: <bug-125-4@http.www.slony.info/bugzilla/>
References: <bug-125-4@http.www.slony.info/bugzilla/>
Message-ID: <20100819211104.276F3290CE0@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=125

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |devrim at gunduz.org
                   |o                           |

--- Comment #8 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-19 14:11:04 PDT ---
I have applied this to a "bug125" branch on GitHub.  It looks plausible, but
not having much Red Hat around, I can't really validate the legitimacy.

See:

http://github.com/cbbrowne/slony1-engine/commit/c030014cf25aa5be83da987ab8bfc5e71d36a6be

I'll be happy to apply this to 2.0 and HEAD, if Devrim gives his OK.

Or if Devrim wants to apply it, that's good too.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Aug 23 06:16:25 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 23 Aug 2010 06:16:25 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 90] Error while running "make" for Slony 2.0 on
	Solaris 2.11
In-Reply-To: <bug-90-4@http.www.slony.info/bugzilla/>
References: <bug-90-4@http.www.slony.info/bugzilla/>
Message-ID: <20100823131625.DE6B5290439@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=90

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|WORKSFORME                  |
             Status|RESOLVED                    |REOPENED

--- Comment #3 from Steve Singer <ssinger at ca.afilias.info> 2010-08-23 06:16:25 PDT ---
No this bug (or something really similar still exists).  We can not build on
Solaris with the Sun compiler.

The problem is that slonik and log_shipper are client side programs that are
including postgres.h.   postgres.h should really only be included by programs
that link in with the postgresql server (ie triggers).  There are some inline
functions that get included by postgres.h that call other backend functions. 
Since this inline functions don't actually get called gcc seems to not care
about the undefined symbols.  The Sun compiler on Solaris isn't as forgiving.

Ideally we wouldn't include postgres.h from slonik, we are currently using it
for type definitions (int64 uint32 etc...) and a few other things.  I suspect
replacing the postgres typedefs with C99 stye int32_t ones would go a long way
towards helping but this will cause grief for win32 with many versions of
visual C because they didn't have the C99 types until recently.  Since I don't
have access to a Win32/Visual studio development environment I'm somewhat
afraid to make these changes without fixing them (I do have access to a Solaris
environment)

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Aug 23 09:51:56 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 23 Aug 2010 09:51:56 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 75] Bugs: (1) Initialize forgotten
 cs->plan_active_log. (2) Session_replication_role and "SET datestyle TO
 'ISO'" in slonik at connection start.
In-Reply-To: <bug-75-4@http.www.slony.info/bugzilla/>
References: <bug-75-4@http.www.slony.info/bugzilla/>
Message-ID: <20100823165157.03B58290C82@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=75

--- Comment #11 from Steve Singer <ssinger at ca.afilias.info> 2010-08-23 09:51:56 PDT ---
The patch looks okay to me but I'm not able to come up with a test that
replicates this issue.

I tried executing a script via execute script that does a 'ROLLBACK' and as one
DDL then as a second one does a INSERT's the output of SELECT
current_config('datestyle') into a table on a database with a non-ISO default
datestyle and I'm not able to replicate this issue (without the patch)

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Mon Aug 23 09:58:06 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 23 Aug 2010 09:58:06 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 104] slon core in sched_add_fdset
In-Reply-To: <bug-104-4@http.www.slony.info/bugzilla/>
References: <bug-104-4@http.www.slony.info/bugzilla/>
Message-ID: <20100823165806.22543290C82@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=104

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|REOPENED                    |RESOLVED

--- Comment #7 from Steve Singer <ssinger at ca.afilias.info> 2010-08-23 09:58:06 PDT ---
Second fix committed.
9c3e3e0d5a606231c992c4cba29822c3602914e0

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Mon Aug 23 10:03:20 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 23 Aug 2010 10:03:20 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 138] groff detection in configure broken
In-Reply-To: <bug-138-4@http.www.slony.info/bugzilla/>
References: <bug-138-4@http.www.slony.info/bugzilla/>
Message-ID: <20100823170320.3F7D8290C82@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=138

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #4 from Steve Singer <ssinger at ca.afilias.info> 2010-08-23 10:03:20 PDT ---
Added to REL_2_0_STABLE and master
b4f202e3f67e66a311a4a32c6392bb2be3bc05a2
9dbcd68c88c0add15e242a4f091d2b585bdbae58

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Mon Aug 23 10:14:17 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 23 Aug 2010 10:14:17 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 138] groff detection in configure broken
In-Reply-To: <bug-138-4@http.www.slony.info/bugzilla/>
References: <bug-138-4@http.www.slony.info/bugzilla/>
Message-ID: <20100823171417.81661290C82@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=138

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
             Status|RESOLVED                    |CLOSED

--- Comment #5 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-23 10:14:17 PDT ---
I see that in the 2.0 release notes.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Mon Aug 23 10:23:38 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 23 Aug 2010 10:23:38 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 75] Bugs: (1) Initialize forgotten
 cs->plan_active_log. (2) Session_replication_role and "SET datestyle TO
 'ISO'" in slonik at connection start.
In-Reply-To: <bug-75-4@http.www.slony.info/bugzilla/>
References: <bug-75-4@http.www.slony.info/bugzilla/>
Message-ID: <20100823172338.3BD23290C33@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=75

--- Comment #12 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-23 10:23:38 PDT ---
(In reply to comment #11)
> The patch looks okay to me but I'm not able to come up with a test that
> replicates this issue.

I don't have a big problem if Jan concludes that it's a good change to commit,
even absent a visible test case.  It would be nice to have one, though.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Mon Aug 23 10:25:45 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 23 Aug 2010 10:25:45 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 104] slon core in sched_add_fdset
In-Reply-To: <bug-104-4@http.www.slony.info/bugzilla/>
References: <bug-104-4@http.www.slony.info/bugzilla/>
Message-ID: <20100823172545.38336290C82@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=104

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
             Status|RESOLVED                    |CLOSED

--- Comment #8 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-23 10:25:45 PDT ---
I see it noted in the 2.0 release notes, so closing it out.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Mon Aug 23 10:39:42 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 23 Aug 2010 10:39:42 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 126] slon sometimes does not recover from a
	network outage
In-Reply-To: <bug-126-4@http.www.slony.info/bugzilla/>
References: <bug-126-4@http.www.slony.info/bugzilla/>
Message-ID: <20100823173943.04FDA290C82@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=126

--- Comment #3 from Steve Singer <ssinger at ca.afilias.info> 2010-08-23 10:39:43 PDT ---
No that controls server side keep alives, we want client side keep alives.

This was actually introduced in 9.0, see
http://www.postgresql.org/docs/9.0/static/libpq-connect.html#LIBPQ-KEEPALIVES

Prior to 9.0 applications like slony could call PQSocket and get then manually
adjust values on the socket which is what we will have to do if we want the
feature when running against older versions of PG.

In either case we need to setup a system that replicates a slon detected socket
failure to make sure we don't have some other horrible issue waiting in the
code path that gets hit once the keep socket times out.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Aug 23 12:48:02 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 23 Aug 2010 12:48:02 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 117] syslog=2,
 messages go both to syslog and the standard output.
In-Reply-To: <bug-117-4@http.www.slony.info/bugzilla/>
References: <bug-117-4@http.www.slony.info/bugzilla/>
Message-ID: <20100823194802.2D2B8290CDA@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=117

--- Comment #1 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-23 12:48:02 PDT ---
This patch (against HEAD) addresses this:

http://github.com/cbbrowne/slony1-engine/commit/9eb5bce628d7feafb422c6f4b7e65518c8f1bc22

I'd think it likely that this will apply to 2.0, too, and I'd agree with
applying it there.

Other devs, please validate that this looks good to y'all!

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Aug 24 06:35:54 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 24 Aug 2010 06:35:54 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 139] sighandler is calling non async safe
	functions
In-Reply-To: <bug-139-4@http.www.slony.info/bugzilla/>
References: <bug-139-4@http.www.slony.info/bugzilla/>
Message-ID: <20100824133554.E316B290369@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=139

--- Comment #3 from Jan Wieck <janwieck at yahoo.com> 2010-08-24 06:35:55 PDT ---
Patches look good to me. With one more little thing to add. 

There needs to be a global variable through which the watchdog tells the
(forked) worker process if it is in fresh start up or in restart mode. The
worker process should only retry to obtain the node lock if it is in restart
mode and terminate otherwise. 

With that, the patches for 139, 132 and 136 are ready to commit to HEAD and
2.0.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Aug 24 07:23:56 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 24 Aug 2010 07:23:56 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 80] slon daemon restarts itself in a loop after
	failover()
In-Reply-To: <bug-80-4@http.www.slony.info/bugzilla/>
References: <bug-80-4@http.www.slony.info/bugzilla/>
Message-ID: <20100824142356.E7F65290C4E@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=80

Jan Wieck <janwieck at yahoo.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |janwieck at yahoo.com
                   |o                           |

--- Comment #3 from Jan Wieck <janwieck at yahoo.com> 2010-08-24 07:23:57 PDT ---
The issue is actually the async processing of events coming from different
nodes.

The FAILOVER_NODE is faked by slonik to be coming from the failed node. This
guarantees that every subscriber will drain out all outstanding SYNC events
from the failed node before starting to consume changes from the next origin
(either backup node or temporary origin). 

The next origin will issue ACCEPT_SET. The purpose of the ACCEPT_SET event,
which is also seen in MOVE_SET, is that a subscriber suspends processing events
from the accepting node, until it has seen the corresponding FAILOVER_SET or
MOVE_SET, so that it doesn't throw away data from the accepting node. The
accepting node can modify the tables and create sl_log data long before
everybody else is caught up.

What we want to do is to reproduce the ACCEPT_SET logic in slon for DROP_NODE
and suspend processing events from the DROP_NODE origin until there are no more
sets from that origin in slon's runtime config.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Aug 24 07:40:10 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 24 Aug 2010 07:40:10 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 81] duplicate key sl_nodelock-pkey and duplicate
 slon(8) processes not detected
In-Reply-To: <bug-81-4@http.www.slony.info/bugzilla/>
References: <bug-81-4@http.www.slony.info/bugzilla/>
Message-ID: <20100824144010.7A038290429@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=81

Jan Wieck <janwieck at yahoo.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
            Version|2.0                         |devel

--- Comment #7 from Jan Wieck <janwieck at yahoo.com> 2010-08-24 07:40:10 PDT ---
I agree with Steve that this is covered by 132.

I am moving this to devel since there is still an issue. It is possible that
the OS's PID "almost" wrapped around when the slon worker process dies and that
another process gets its PID reassigned before the cleanup of sl_node_lock
happens. 

The solution to that however is too much change for 2.0, so we will do this in
2.1. The idea for this is to replace sl_node_lock as it is now with a temp
table. Temp tables are visible in pg_class, so an existing sl_node_lock temp
table indicates an existing worker backend connection. If after creating the
temp table there are more than one entry in pg_class, we had a race condition
and need to retry the whole thing.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Aug 24 10:20:14 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 24 Aug 2010 10:20:14 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 90] Error while running "make" for Slony 2.0 on
	Solaris 2.11
In-Reply-To: <bug-90-4@http.www.slony.info/bugzilla/>
References: <bug-90-4@http.www.slony.info/bugzilla/>
Message-ID: <20100824172014.5A1F4290BEE@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=90

--- Comment #4 from Jan Wieck <janwieck at yahoo.com> 2010-08-24 10:20:14 PDT ---
Pull the autoconf methods of detecting the definitions, we need postgres.h for,
and create our own header.

This is not critical at this point, so we will do this for 2.0.6.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Aug 24 11:34:55 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 24 Aug 2010 11:34:55 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 121] 'provider node -1 for set' when subscribing
 from a forwarding node
In-Reply-To: <bug-121-4@http.www.slony.info/bugzilla/>
References: <bug-121-4@http.www.slony.info/bugzilla/>
Message-ID: <20100824183455.0762B290429@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=121

Jan Wieck <janwieck at yahoo.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |ssinger at ca.afilias.info
                   |o                           |
             Status|NEW                         |ASSIGNED

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Aug 24 11:44:53 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 24 Aug 2010 11:44:53 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 40] libpq thread test insufficient
In-Reply-To: <bug-40-4@http.www.slony.info/bugzilla/>
References: <bug-40-4@http.www.slony.info/bugzilla/>
Message-ID: <20100824184453.46DF9290429@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=40

--- Comment #4 from Steve Singer <ssinger at ca.afilias.info> 2010-08-24 11:44:53 PDT ---
This seems  okay to me.
I'm taking it at someones word that Linux doesn't need --enable-thread-safety

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Aug 24 11:59:20 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 24 Aug 2010 11:59:20 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 40] libpq thread test insufficient
In-Reply-To: <bug-40-4@http.www.slony.info/bugzilla/>
References: <bug-40-4@http.www.slony.info/bugzilla/>
Message-ID: <20100824185920.35CA8290BEE@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=40

--- Comment #5 from Peter Eisentraut <peter_e at gmx.net> 2010-08-24 11:59:20 PDT ---
There is possibly some confusion here.  --enable-thread-safety always creates a
functionally different libpq on any platform.  And a libpq compiled without
that flag is not suitable for multithreaded applications on any platform.  At
least a glance at the source code indicates as much.  It might be that you
don't actually need the parts in question, but I'm not sure.

What you might be thinking of is that on some platforms (including Linux,
excluding BSD, I think), most/all libc functions are reentrant by default,
without the need for special compiler flags.  But that just means that the
--enable-thread-safety flag has to do less work, it doesn't make the entire
library thread-safe automatically.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Aug 24 12:48:11 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 24 Aug 2010 12:48:11 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 40] libpq thread test insufficient
In-Reply-To: <bug-40-4@http.www.slony.info/bugzilla/>
References: <bug-40-4@http.www.slony.info/bugzilla/>
Message-ID: <20100824194811.334B4290C55@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=40

--- Comment #6 from Jan Wieck <janwieck at yahoo.com> 2010-08-24 12:48:11 PDT ---
Correct, Peter.

Slony is multi threaded, but never do two threads use the same database
connection or any object derived there of. Maybe that is why it does work on
some platforms that don't actually produce a 100% thread safe libpq without
--enable-thread-safety.

What I would suggest is that we collect a slightly longer list of OS's, where
this is irrelevant for Slony and then make this a test with 3 possible
outcomes. Error out if --enable-thread-safety wasn't used where we know it
needs to be (aix, solaris), Don't care if it was (Linux, FreeBSD) and give a
WARNING for everything else.

This has IMHO time until 2.0.6

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Aug 24 13:01:03 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 24 Aug 2010 13:01:03 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 40] libpq thread test insufficient
In-Reply-To: <bug-40-4@http.www.slony.info/bugzilla/>
References: <bug-40-4@http.www.slony.info/bugzilla/>
Message-ID: <20100824200103.E336B290CDF@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=40

--- Comment #7 from Steve Singer <ssinger at ca.afilias.info> 2010-08-24 13:01:04 PDT ---
While slony does not have multiple threads using the same libpq connection it
does have multiple threads accessing libpq on different connections at the same
time.

Does this mean that we do need to be running with --enable-thread-saftey ?

I haven't looked very closely at the parts of libpq that change based on
ENABLE_THREAD_SAFETY and it looks like we do provide callbacks to openssl for
locking.   I suspect slony needs this on ALL platforms to be safe.

There have been reports I've seen of slony replication breaking over ssl
connections maybe this could have been related.

I think we should modify the patch to require slony to be built with a
threadsafe libpq on all platforms.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Aug 24 13:04:12 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 24 Aug 2010 13:04:12 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 40] libpq thread test insufficient
In-Reply-To: <bug-40-4@http.www.slony.info/bugzilla/>
References: <bug-40-4@http.www.slony.info/bugzilla/>
Message-ID: <20100824200412.B10AD290CE0@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=40

--- Comment #8 from Jan Wieck <janwieck at yahoo.com> 2010-08-24 13:04:12 PDT ---
After looking at some of the libpq code I have to agree with that.

This is a heavy handed change inside of a stable branch, but it looks safer.


Jan

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Aug 24 13:21:39 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 24 Aug 2010 13:21:39 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 40] libpq thread test insufficient
In-Reply-To: <bug-40-4@http.www.slony.info/bugzilla/>
References: <bug-40-4@http.www.slony.info/bugzilla/>
Message-ID: <20100824202139.668F9290CE0@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=40

--- Comment #9 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-24 13:21:39 PDT ---
(In reply to comment #8)
> After looking at some of the libpq code I have to agree with that.
> 
> This is a heavy handed change inside of a stable branch, but it looks safer.

I have updated the patch to be "more heavy handed."

http://github.com/cbbrowne/slony1-engine/commit/f9a90879df8ce4764cbdcc380c1dd8e7a5623dae

I'd be concerned that this may adversely affect folks on Linux, in the scenario
where we're requiring "ETS" which then requires people to rebuild packages.

- I took a peek at Debian, and the pg_config there does indicate
--enable-thread-safety, so it should be safe-ish.

- Ubuntu derives from Debian, and the Ubuntu instance I have handy does "ETS"
too.

I don't have Fedora, RHAS/RHES, SuSE handy to me.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Aug 24 14:34:47 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 24 Aug 2010 14:34:47 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 115] Slonik should detect + error out on scripts
 that have a WAIT FOR EVENT in a try block
In-Reply-To: <bug-115-4@http.www.slony.info/bugzilla/>
References: <bug-115-4@http.www.slony.info/bugzilla/>
Message-ID: <20100824213447.9F3BA290CE0@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=115

--- Comment #4 from Jan Wieck <janwieck at yahoo.com> 2010-08-24 14:34:47 PDT ---
A patch for the parser that generates a proper error message is here:

http://github.com/wieck/slony1-engine/commit/aee48b3ae7aa3d09bdac8c309430ab3cb2650d35
\

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Aug 24 15:28:25 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 24 Aug 2010 15:28:25 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 40] libpq thread test insufficient
In-Reply-To: <bug-40-4@http.www.slony.info/bugzilla/>
References: <bug-40-4@http.www.slony.info/bugzilla/>
Message-ID: <20100824222825.24A8229035D@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=40

--- Comment #10 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-24 15:28:25 PDT ---
(In reply to comment #9)
> - I took a peek at Debian, and the pg_config there does indicate
> --enable-thread-safety, so it should be safe-ish.
> 
> - Ubuntu derives from Debian, and the Ubuntu instance I have handy does "ETS"
> too.

Note: Jan took a look at FreeBSD, and found that Ports indicates ETS, so
FreeBSD shouldn't be adversely affected.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Aug 24 15:32:02 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 24 Aug 2010 15:32:02 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 75] Bugs: (1) Initialize forgotten
 cs->plan_active_log. (2) Session_replication_role and "SET datestyle TO
 'ISO'" in slonik at connection start.
In-Reply-To: <bug-75-4@http.www.slony.info/bugzilla/>
References: <bug-75-4@http.www.slony.info/bugzilla/>
Message-ID: <20100824223202.EDEEF290CEC@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=75

Jan Wieck <janwieck at yahoo.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #13 from Jan Wieck <janwieck at yahoo.com> 2010-08-24 15:32:02 PDT ---
Patch applied.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 25 07:23:52 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 25 Aug 2010 07:23:52 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 80] slon daemon restarts itself in a loop after
	failover()
In-Reply-To: <bug-80-4@http.www.slony.info/bugzilla/>
References: <bug-80-4@http.www.slony.info/bugzilla/>
Message-ID: <20100825142352.77CDB290C33@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=80

Jan Wieck <janwieck at yahoo.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
           See Also|                            |http://www.slony.info/bugzi
                   |                            |lla/show_bug.cgi?id=130

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 25 07:24:40 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 25 Aug 2010 07:24:40 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 130] failover does not seem to update sl_set
In-Reply-To: <bug-130-4@http.www.slony.info/bugzilla/>
References: <bug-130-4@http.www.slony.info/bugzilla/>
Message-ID: <20100825142440.BD4F729046B@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=130

Jan Wieck <janwieck at yahoo.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
           See Also|                            |http://www.slony.info/bugzi
                   |                            |lla/show_bug.cgi?id=80
         Resolution|                            |DUPLICATE
             Status|NEW                         |RESOLVED

--- Comment #4 from Jan Wieck <janwieck at yahoo.com> 2010-08-25 07:24:40 PDT ---
Will be covered by fixing Bug 80

*** This bug has been marked as a duplicate of bug 80 ***

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 25 07:24:41 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 25 Aug 2010 07:24:41 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 80] slon daemon restarts itself in a loop after
	failover()
In-Reply-To: <bug-80-4@http.www.slony.info/bugzilla/>
References: <bug-80-4@http.www.slony.info/bugzilla/>
Message-ID: <20100825142441.19D96290CDB@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=80

Jan Wieck <janwieck at yahoo.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
                 CC|                            |ssinger at ca.afilias.info

--- Comment #4 from Jan Wieck <janwieck at yahoo.com> 2010-08-25 07:24:40 PDT ---
*** Bug 130 has been marked as a duplicate of this bug. ***

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 25 11:19:10 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 25 Aug 2010 11:19:10 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 40] libpq thread test insufficient
In-Reply-To: <bug-40-4@http.www.slony.info/bugzilla/>
References: <bug-40-4@http.www.slony.info/bugzilla/>
Message-ID: <20100825181910.A6043290C33@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=40

--- Comment #11 from Steve Singer <ssinger at ca.afilias.info> 2010-08-25 11:19:10 PDT ---
Conclusion: Go!

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 25 11:21:59 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 25 Aug 2010 11:21:59 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 62] Initial subscription blocks with "sequence
 ID <xxx> has already been assigned"
In-Reply-To: <bug-62-4@http.www.slony.info/bugzilla/>
References: <bug-62-4@http.www.slony.info/bugzilla/>
Message-ID: <20100825182159.DCFA3290CDC@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=62

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |WORKSFORME
             Status|NEW                         |RESOLVED

--- Comment #7 from Steve Singer <ssinger at ca.afilias.info> 2010-08-25 11:21:59 PDT ---
Inclination is to drop this.

If we discover this via test framework work, then we'll reopen this.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 25 11:22:57 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 25 Aug 2010 11:22:57 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 80] slon daemon restarts itself in a loop after
	failover()
In-Reply-To: <bug-80-4@http.www.slony.info/bugzilla/>
References: <bug-80-4@http.www.slony.info/bugzilla/>
Message-ID: <20100825182257.7675629046B@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=80

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
            Version|devel                       |2.0

--- Comment #5 from Steve Singer <ssinger at ca.afilias.info> 2010-08-25 11:22:57 PDT ---
This should also be in 2.0.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 25 11:25:14 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 25 Aug 2010 11:25:14 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 99] unable to set datestyle
In-Reply-To: <bug-99-4@http.www.slony.info/bugzilla/>
References: <bug-99-4@http.www.slony.info/bugzilla/>
Message-ID: <20100825182514.BD331290412@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=99

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |cbbrowne at ca.afilias.info
                   |o                           |
             Status|NEW                         |ASSIGNED

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 25 11:27:58 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 25 Aug 2010 11:27:58 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 115] Slonik should detect + error out on scripts
 that have a WAIT FOR EVENT in a try block
In-Reply-To: <bug-115-4@http.www.slony.info/bugzilla/>
References: <bug-115-4@http.www.slony.info/bugzilla/>
Message-ID: <20100825182758.BBF7729046B@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=115

--- Comment #5 from Steve Singer <ssinger at ca.afilias.info> 2010-08-25 11:27:58 PDT ---
Chris to review.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 25 11:28:56 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 25 Aug 2010 11:28:56 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 117] syslog=2,
 messages go both to syslog and the standard output.
In-Reply-To: <bug-117-4@http.www.slony.info/bugzilla/>
References: <bug-117-4@http.www.slony.info/bugzilla/>
Message-ID: <20100825182856.2D1A0290C55@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=117

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|cbbrowne at ca.afilias.info    |janwieck at yahoo.com

--- Comment #2 from Steve Singer <ssinger at ca.afilias.info> 2010-08-25 11:28:56 PDT ---
Jan to review.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 25 11:30:00 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 25 Aug 2010 11:30:00 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 121] 'provider node -1 for set' when subscribing
 from a forwarding node
In-Reply-To: <bug-121-4@http.www.slony.info/bugzilla/>
References: <bug-121-4@http.www.slony.info/bugzilla/>
Message-ID: <20100825183000.78D37290C33@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=121

--- Comment #2 from Steve Singer <ssinger at ca.afilias.info> 2010-08-25 11:30:00 PDT ---
Steve to rerun tests after various other patches go in for 2.0.5.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 25 11:31:33 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 25 Aug 2010 11:31:33 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 124] EXECUTE SCRIPT,
	ONLY ON != EVENT NODE is wrong
In-Reply-To: <bug-124-4@http.www.slony.info/bugzilla/>
References: <bug-124-4@http.www.slony.info/bugzilla/>
Message-ID: <20100825183133.EE128290C33@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=124

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |janwieck at yahoo.com
                   |o                           |
             Status|NEW                         |ASSIGNED

--- Comment #4 from Steve Singer <ssinger at ca.afilias.info> 2010-08-25 11:31:34 PDT ---
Jan to review code.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 25 11:33:12 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 25 Aug 2010 11:33:12 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 126] slon sometimes does not recover from a
	network outage
In-Reply-To: <bug-126-4@http.www.slony.info/bugzilla/>
References: <bug-126-4@http.www.slony.info/bugzilla/>
Message-ID: <20100825183312.DF62C29046B@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=126

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
            Version|1.2                         |devel

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 25 11:34:03 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 25 Aug 2010 11:34:03 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 128] DROP TABLE replicatedTable leaves the
 cluster in a bad state
In-Reply-To: <bug-128-4@http.www.slony.info/bugzilla/>
References: <bug-128-4@http.www.slony.info/bugzilla/>
Message-ID: <20100825183403.962A129046B@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=128

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |janwieck at yahoo.com
                   |o                           |
             Status|NEW                         |ASSIGNED

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 25 11:36:37 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 25 Aug 2010 11:36:37 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 132] ERROR: duplicate key value violates unique
 constraint "sl_nodelock-pkey"
In-Reply-To: <bug-132-4@http.www.slony.info/bugzilla/>
References: <bug-132-4@http.www.slony.info/bugzilla/>
Message-ID: <20100825183637.09BC0290C55@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=132

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |ssinger at ca.afilias.info
                   |o                           |
             Status|NEW                         |ASSIGNED

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 25 11:38:33 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 25 Aug 2010 11:38:33 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 136] listen paths not being rebuilt correctly
In-Reply-To: <bug-136-4@http.www.slony.info/bugzilla/>
References: <bug-136-4@http.www.slony.info/bugzilla/>
Message-ID: <20100825183834.0010129046B@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=136

--- Comment #7 from Steve Singer <ssinger at ca.afilias.info> 2010-08-25 11:38:34 PDT ---
Go!  (Commit)

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 25 11:48:03 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 25 Aug 2010 11:48:03 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 144] replicate_partition stored procedure
 doesn't start replicating changes to the new table
In-Reply-To: <bug-144-4@http.www.slony.info/bugzilla/>
References: <bug-144-4@http.www.slony.info/bugzilla/>
Message-ID: <20100825184804.008E9290C33@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=144

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
            Version|1.2                         |2.0

--- Comment #2 from Steve Singer <ssinger at ca.afilias.info> 2010-08-25 11:48:03 PDT ---
Defer to 2.0.6.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 25 11:49:04 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 25 Aug 2010 11:49:04 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 149] localListener thread failures on startup
	can deadlock slon
In-Reply-To: <bug-149-4@http.www.slony.info/bugzilla/>
References: <bug-149-4@http.www.slony.info/bugzilla/>
Message-ID: <20100825184904.E92B329046B@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=149

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|ssinger at ca.afilias.info     |janwieck at yahoo.com

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 25 12:48:19 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 25 Aug 2010 12:48:19 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 40] libpq thread test insufficient
In-Reply-To: <bug-40-4@http.www.slony.info/bugzilla/>
References: <bug-40-4@http.www.slony.info/bugzilla/>
Message-ID: <20100825194819.975642903C4@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=40

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|cbbrowne at ca.afilias.info    |janwieck at yahoo.com

--- Comment #12 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-25 12:48:19 PDT ---
Here is the patch that I propose to put into 2.0/HEAD:

http://github.com/cbbrowne/slony1-engine/commit/7e74997c0f8427c08c2885de2a3218ca333da632

Please verify, and pass back to me.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 25 12:49:21 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 25 Aug 2010 12:49:21 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 115] Slonik should detect + error out on scripts
 that have a WAIT FOR EVENT in a try block
In-Reply-To: <bug-115-4@http.www.slony.info/bugzilla/>
References: <bug-115-4@http.www.slony.info/bugzilla/>
Message-ID: <20100825194921.AE8B5290412@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=115

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|janwieck at yahoo.com          |cbbrowne at ca.afilias.info

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 25 13:11:41 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 25 Aug 2010 13:11:41 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 115] Slonik should detect + error out on scripts
 that have a WAIT FOR EVENT in a try block
In-Reply-To: <bug-115-4@http.www.slony.info/bugzilla/>
References: <bug-115-4@http.www.slony.info/bugzilla/>
Message-ID: <20100825201141.07840290412@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=115

--- Comment #6 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-25 13:11:40 PDT ---
Created an attachment (id=61)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=61)
Test case that may go in "tests" directory

I added, in a private branch, a test case for this.

postgres at cbbrowne [04:05:53] [~/slony1-engine.github/tests] [bug115 *]
-> % ./run_test.sh testbadtry
test: testbadtry
----------------------------------------------------
This test involves validating that WAIT FOR EVENT inside a TRY block
is rejected.
----------------------------------------------------
Test by j.random.luser at example.net to be summarized in
/tmp/Slony-I-test-results.log
creating origin DB: postgres -h localhost -U postgres -p 7099 slonyregress1
add plpgsql to Origin
createlang: language "plpgsql" is already installed in database "slonyregress1"
loading origin DB with testbadtry/init_schema.sql
setting up user postgres to have weak access to data
done
creating subscriber 2 DB: postgres -h localhost -U postgres -p 7099
slonyregress2
add plpgsql to subscriber
createlang: language "plpgsql" is already installed in database "slonyregress2"
loading subscriber 2 DB from slonyregress1
done
creating cluster
done
storing nodes
done
Granting weak access on Slony-I schema
done
storing paths
done
launching originnode - PGBINDIR=/var/lib/postgresql/dbs/postgresql-HEAD/bin
[: 27: x/tmp/slony-regress.TyNj0y/slon-pid.1: unexpected operator
Starting slon: /var/lib/postgresql/dbs/postgresql-HEAD/bin/slon -f
/tmp/slony-regress.TyNj0y/slon-conf.1 1>> /tmp/slony-regress.TyNj0y/slon_log.1
2>&1 &
[: 27: x/tmp/slony-regress.TyNj0y/slon-pid.1: unexpected operator
Archive node:
Considering node 2
launching slon
[: 27: x/tmp/slony-regress.TyNj0y/slon-pid.2: unexpected operator
Starting slon: /var/lib/postgresql/dbs/postgresql-HEAD/bin/slon -f
/tmp/slony-regress.TyNj0y/slon-conf.2 1>> /tmp/slony-regress.TyNj0y/slon_log.2
2>&1 &
[: 27: x/tmp/slony-regress.TyNj0y/slon-pid.2: unexpected operator
subscribing
done
./run_test.sh: ERROR: Slonik error see /tmp/slony-regress.TyNj0y/slonik.log for
details
[: 1: xSlonik: unexpected operator

postgres at cbbrowne [04:06:32] [~/slony1-engine.github/tests] [bug115 *]
-> % cat /tmp/slony-regress.TyNj0y/slonik.log
<stdin>:2: ERROR: WAIT FOR EVENT command used inside of TRY block

Whether or not we really want to add a regression test for this is an open
question.

At any rate, this nicely verifies that it works.  I'm fine with committing it.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 25 13:11:51 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 25 Aug 2010 13:11:51 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 115] Slonik should detect + error out on scripts
 that have a WAIT FOR EVENT in a try block
In-Reply-To: <bug-115-4@http.www.slony.info/bugzilla/>
References: <bug-115-4@http.www.slony.info/bugzilla/>
Message-ID: <20100825201151.0AFFF290412@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=115

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|cbbrowne at ca.afilias.info    |janwieck at yahoo.com

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 25 13:45:12 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 25 Aug 2010 13:45:12 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 117] syslog=2,
 messages go both to syslog and the standard output.
In-Reply-To: <bug-117-4@http.www.slony.info/bugzilla/>
References: <bug-117-4@http.www.slony.info/bugzilla/>
Message-ID: <20100825204512.6F062290479@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=117

Jan Wieck <janwieck at yahoo.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #3 from Jan Wieck <janwieck at yahoo.com> 2010-08-25 13:45:12 PDT ---
Patch applied to master and REL_2_0_STABLE.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 25 20:05:14 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 25 Aug 2010 20:05:14 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 151] New: Let DDL for EXECUTE SCRIPT to be
	specified inline
Message-ID: <bug-151-4@http.www.slony.info/bugzilla/>

http://www.slony.info/bugzilla/show_bug.cgi?id=151

           Summary: Let DDL for EXECUTE SCRIPT to be specified inline
           Product: Slony-I
           Version: devel
          Platform: PC
        OS/Version: Linux
            Status: NEW
          Severity: enhancement
          Priority: low
         Component: slonik
        AssignedTo: slony1-bugs at lists.slony.info
        ReportedBy: stuart at stuartbishop.net
                CC: slony1-bugs at lists.slony.info
   Estimated Hours: 0.0


Currently SQL scripts need to be stored separately from a slonik script in
individual files. It would be great if there was some mechanism to store these
scripts inline in the main slonik script. This would allow generation of
complex slonik scripts easier and moving complex slonik scripts around less
error prone.


One possible approach would be a multi line quoting mechanism and a 'file' meta
command that would store the string content in a temporary file and define a
token.


file foo <<EOM
ALTER TABLE Bar ADD COLUMN baz text;
EOM

EXECUTE SCRIPT(set id=1, filename=@foo, event node=1);


multi line quoting mechanism could just as easily be """ or ''' for Python
similarity, or $$ & $x$ style for PostgreSQL similarity.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 25 20:12:45 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 25 Aug 2010 20:12:45 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 152] New: Command line argument to only echo DDL
	on failure
Message-ID: <bug-152-4@http.www.slony.info/bugzilla/>

http://www.slony.info/bugzilla/show_bug.cgi?id=152

           Summary: Command line argument to only echo DDL on failure
           Product: Slony-I
           Version: devel
          Platform: PC
        OS/Version: Linux
            Status: NEW
          Severity: enhancement
          Priority: low
         Component: slonik
        AssignedTo: slony1-bugs at lists.slony.info
        ReportedBy: stuart at stuartbishop.net
                CC: slony1-bugs at lists.slony.info
   Estimated Hours: 0.0


Currently, slonik echos DDL being run via EXECUTE SCRIPT. This makes scripts
very noisy and thus more difficult to identify success/fail status of a process
from logs.

It would be great if slonik had a quiet mode, where its output was just your
echo statements if things are working fine.

On failure, I'd like to see the slonik script output.

On failure I'd like to see failed DDL output.

This is useful if the scripts are being generated on the fly.

I'm not sure if this is better expressed by a single option or by a combination
of options.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 25 20:16:58 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 25 Aug 2010 20:16:58 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 153] New: Include output from an executable.
Message-ID: <bug-153-4@http.www.slony.info/bugzilla/>

http://www.slony.info/bugzilla/show_bug.cgi?id=153

           Summary: Include output from an executable.
           Product: Slony-I
           Version: devel
          Platform: PC
        OS/Version: Linux
            Status: NEW
          Severity: enhancement
          Priority: low
         Component: slonik
        AssignedTo: slony1-bugs at lists.slony.info
        ReportedBy: stuart at stuartbishop.net
                CC: slony1-bugs at lists.slony.info
   Estimated Hours: 0.0


I find it very useful to be able to use the shell to include chunks of slonik
script generated by scripts:

$ slonik <<EOM
`./preamble.py`
echo 'Do stuff';
EOM

Hello from preamble
Do stuff


It would be great if I did not have to use the shell to do the inclusion, and
instead if slonik supported the back tick syntax internally.

$ cat foo.sk
`./preamble.py`
echo 'Do stuff';
EOM
$ slonik foo.sk
Hello from preamble
Do stuff

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Thu Aug 26 08:36:17 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 26 Aug 2010 08:36:17 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 151] Let DDL for EXECUTE SCRIPT to be specified
	inline
In-Reply-To: <bug-151-4@http.www.slony.info/bugzilla/>
References: <bug-151-4@http.www.slony.info/bugzilla/>
Message-ID: <20100826153617.5F6B3290158@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=151

--- Comment #1 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-26 08:36:17 PDT ---
The challenge of this is that it introduces an extra layer of quoting to the
Slonik language which we have heretofore avoided.

We had to write a parser that understands PostgreSQL quoting and commenting
that is used by slon+slonik:

http://git.postgresql.org/gitweb?p=slony1-engine.git;a=blob;f=src/parsestatements/scanner.c

Your idea of adding the "meta command," file *possibly* evades that; I'm not
sure.

It would certainly be possible to take this the other way, and layer the slonik
inside a shell script, as in the example below.

-----------------------------------------------------------------
#!/bin/sh

PREAMBLEFILE=/tmp/slonik.preamble
SLONIKFILE=/tmp/myslonikfile.slonik
DDLFILE=/tmp/myddlfile.sql

cat > ${PREAMBLEFILE} <<EOP 
cluster name = myfavecluster;
node 1 admin conninfo='db=foo host=host1 port=5432';
node 2 admin conninfo='db=foo host=host2 port=5432';
node 3 admin conninfo='db=foo host=host3 port=5432';
EOP

cat > ${SLONIKFILE}  <<EOS
include <${PREAMBLEFILE}>;

execute script (set id=1, filename='${DDLFILE}', event node = 1);
EOS

cat > ${DDLFILE} <<DDL
alter table foo add column bar integer;
DDL

slonik ${SLONIKFILE}

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Thu Aug 26 08:50:13 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 26 Aug 2010 08:50:13 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 152] Command line argument to only echo DDL on
	failure
In-Reply-To: <bug-152-4@http.www.slony.info/bugzilla/>
References: <bug-152-4@http.www.slony.info/bugzilla/>
Message-ID: <20100826155013.5325C290412@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=152

--- Comment #1 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-26 08:50:13 PDT ---
I wonder if this suggests having a 'status' that can be set.

-----------------------
cluster name = foo;
node 1 admin conninfo='something';
node 2 admin conninfo='something else';

output ddl;

execute script (stuff...);

output nothing;

execute script (more stuff...)

output all;

execute script (still more stuff...)

-----------------------

Adding a keyword or three like this is not terribly difficult; the question is
of what they should control.  If we have an answer that's relatively simple and
which seems elegant, then it's likely a good answer.  The above isn't quite
that.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Thu Aug 26 09:07:22 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 26 Aug 2010 09:07:22 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 153] Include output from an executable.
In-Reply-To: <bug-153-4@http.www.slony.info/bugzilla/>
References: <bug-153-4@http.www.slony.info/bugzilla/>
Message-ID: <20100826160722.A122F290C55@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=153

--- Comment #1 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-26 09:07:22 PDT ---
You'd like slonik to take ``, expand it via system() (or similar), and then
execute it?

This seems like a rather large expansion of scope for what's intended to be a
"Little Language."

There's some thinking out there that slonik is already a bit too big, and that
we should be considering eliminating it in favour of just running the
underlying stored functions.

There's a bit of a problem with that for some operations that have a lot more
functionality than "just stored functions" (notably: store node, lock set,
execute script, wait for event, set add table), but, in any case, there's
certainly thinking towards "simplify slonik."

One of the failures, as it were, of the project is that we were expecting that
a management GUI would emerge, so that the need for slonik might wither away. 
Obviously not the case ;-).  I'm not particularly keen on trying to turn slonik
into a more full-fledged programming language, though.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Thu Aug 26 20:42:03 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 26 Aug 2010 20:42:03 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 153] Include output from an executable.
In-Reply-To: <bug-153-4@http.www.slony.info/bugzilla/>
References: <bug-153-4@http.www.slony.info/bugzilla/>
Message-ID: <20100827034203.E0A1429035D@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=153

--- Comment #2 from Stuart Bishop <stuart at stuartbishop.net> 2010-08-26 20:42:03 PDT ---
> You'd like slonik to take ``, expand it via system() (or similar), and then
> execute it?

Yes. This allows me to embed commands that can only be determined at
run time in a slonik script. The preamble is the most common example
of this - I can run identical scripts on our staging and production
environments. I first picked up the idea of using shell expansion from
examples on the web, so I'm not the only one doing things this way.

> This seems like a rather large expansion of scope for what's intended to be a
> "Little Language."
>
> There's some thinking out there that slonik is already a bit too big, and that
> we should be considering eliminating it in favour of just running the
> underlying stored functions.
>
> There's a bit of a problem with that for some operations that have a lot more
> functionality than "just stored functions" (notably: store node, lock set,
> execute script, wait for event, set add table), but, in any case, there's
> certainly thinking towards "simplify slonik."

So I have developers running non-replicated systems, buildbots running
non-replicated on ec2, replicated staging systems, replicated
production systems. Our database schema is highly agile, with database
patches being added by developers and a tool that applies these
patches. It has to be automated so a management GUI is useless to me.
I have the choice of generating slonik scripts, or generating SQL that
invokes the stored functions. Using the raw stored functions seemed
very problematic - slonik handles the surprising details such as
connecting to the right node to run a function, when to commit, when
to wait for propagation,  how to recover from failure etc. slonik
seems the less surprising, less error prone and more readable
approach.


> One of the failures, as it were, of the project is that we were expecting that
> a management GUI would emerge, so that the need for slonik might wither away.
> Obviously not the case ;-).  I'm not particularly keen on trying to turn slonik
> into a more full-fledged programming language, though.

My systems have to be automated and are running on the other side of
the planet, so a management GUI is pretty much useless to me. I agree
slonik should not become a full-fledged programming language - better
to embed the high level commands into an existing scripting language.
libslonik?

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug 27 11:11:03 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 27 Aug 2010 11:11:03 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 124] EXECUTE SCRIPT,
	ONLY ON != EVENT NODE is wrong
In-Reply-To: <bug-124-4@http.www.slony.info/bugzilla/>
References: <bug-124-4@http.www.slony.info/bugzilla/>
Message-ID: <20100827181103.D21B2290CDF@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=124

Jan Wieck <janwieck at yahoo.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug 27 11:35:54 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 27 Aug 2010 11:35:54 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 128] DROP TABLE replicatedTable leaves the
 cluster in a bad state
In-Reply-To: <bug-128-4@http.www.slony.info/bugzilla/>
References: <bug-128-4@http.www.slony.info/bugzilla/>
Message-ID: <20100827183554.D204F290D2D@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=128

Jan Wieck <janwieck at yahoo.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
                URL|                            |http://github.com/wieck/slo
                   |                            |ny1-engine/commit/1045aa586
                   |                            |fc1772d2ec68712cd434f9173c4
                   |                            |9fba

--- Comment #2 from Jan Wieck <janwieck at yahoo.com> 2010-08-27 11:35:54 PDT ---
Posted fix on github. 

http://github.com/wieck/slony1-engine/commit/1045aa586fc1772d2ec68712cd434f9173c49fba

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug 27 12:00:11 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 27 Aug 2010 12:00:11 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 149] localListener thread failures on startup
	can deadlock slon
In-Reply-To: <bug-149-4@http.www.slony.info/bugzilla/>
References: <bug-149-4@http.www.slony.info/bugzilla/>
Message-ID: <20100827190011.0D6DF290CD6@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=149

Jan Wieck <janwieck at yahoo.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #2 from Jan Wieck <janwieck at yahoo.com> 2010-08-27 12:00:10 PDT ---
Patch committed to HEAD and REL_2_0_STABLE

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug 27 12:17:24 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 27 Aug 2010 12:17:24 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 115] Slonik should detect + error out on scripts
 that have a WAIT FOR EVENT in a try block
In-Reply-To: <bug-115-4@http.www.slony.info/bugzilla/>
References: <bug-115-4@http.www.slony.info/bugzilla/>
Message-ID: <20100827191724.83DBA290CEC@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=115

Jan Wieck <janwieck at yahoo.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #7 from Jan Wieck <janwieck at yahoo.com> 2010-08-27 12:17:24 PDT ---
Patch applied to HEAD and REL_2_0_STABLE

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug 27 12:23:48 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 27 Aug 2010 12:23:48 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 132] ERROR: duplicate key value violates unique
 constraint "sl_nodelock-pkey"
In-Reply-To: <bug-132-4@http.www.slony.info/bugzilla/>
References: <bug-132-4@http.www.slony.info/bugzilla/>
Message-ID: <20100827192348.138B6290CEC@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=132

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #2 from Steve Singer <ssinger at ca.afilias.info> 2010-08-27 12:23:48 PDT ---
This has been committed to REL_2_0_STABLE and master

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug 27 12:24:14 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 27 Aug 2010 12:24:14 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 139] sighandler is calling non async safe
	functions
In-Reply-To: <bug-139-4@http.www.slony.info/bugzilla/>
References: <bug-139-4@http.www.slony.info/bugzilla/>
Message-ID: <20100827192414.962F1290CEF@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=139

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #4 from Steve Singer <ssinger at ca.afilias.info> 2010-08-27 12:24:14 PDT ---
This has been committed to REL_2_0_STABLE and master

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug 27 12:24:42 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 27 Aug 2010 12:24:42 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 136] listen paths not being rebuilt correctly
In-Reply-To: <bug-136-4@http.www.slony.info/bugzilla/>
References: <bug-136-4@http.www.slony.info/bugzilla/>
Message-ID: <20100827192442.199E3290CEF@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=136

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #8 from Steve Singer <ssinger at ca.afilias.info> 2010-08-27 12:24:42 PDT ---
This has been committed to REL_2_0_STABLE and master

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug 27 13:25:02 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 27 Aug 2010 13:25:02 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 40] libpq thread test insufficient
In-Reply-To: <bug-40-4@http.www.slony.info/bugzilla/>
References: <bug-40-4@http.www.slony.info/bugzilla/>
Message-ID: <20100827202502.7F6FC290CD8@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=40

--- Comment #13 from Peter Eisentraut <peter_e at gmx.net> 2010-08-27 13:25:02 PDT ---
--enable-thread-safety is the default in PG 9.0, so it might be enabled even
though you don't see the option in `pg_config --configure`.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug 27 15:22:53 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 27 Aug 2010 15:22:53 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 128] DROP TABLE replicatedTable leaves the
 cluster in a bad state
In-Reply-To: <bug-128-4@http.www.slony.info/bugzilla/>
References: <bug-128-4@http.www.slony.info/bugzilla/>
Message-ID: <20100827222253.1D4BA290CEF@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=128

--- Comment #3 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-27 15:22:53 PDT ---
(In reply to comment #2)
> Posted fix on github. 
> 
> http://github.com/wieck/slony1-engine/commit/1045aa586fc1772d2ec68712cd434f9173c49fba

I have added a regression test to that branch, which breaks, on earlier
versions, and which works fine once your fix is applied.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Fri Aug 27 15:44:06 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 27 Aug 2010 15:44:06 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 40] libpq thread test insufficient
In-Reply-To: <bug-40-4@http.www.slony.info/bugzilla/>
References: <bug-40-4@http.www.slony.info/bugzilla/>
Message-ID: <20100827224406.DBC32290CE4@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=40

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|janwieck at yahoo.com          |cbbrowne at ca.afilias.info

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Mon Aug 30 07:35:49 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 30 Aug 2010 07:35:49 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 40] libpq thread test insufficient
In-Reply-To: <bug-40-4@http.www.slony.info/bugzilla/>
References: <bug-40-4@http.www.slony.info/bugzilla/>
Message-ID: <20100830143549.D46FB290CD3@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=40

--- Comment #14 from Steve Singer <ssinger at ca.afilias.info> 2010-08-30 07:35:49 PDT ---
Chris,

Per Peter's comment, the patch fails when we try to build against a 9.0 with
default(ish) options to ./configure (for postgres) even though PG is built with
threading.

What I think we need to do is have configure compile up a program that links
against libpq and calls 
int PQisthreadsafe();
and make sure the return code is 1.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Mon Aug 30 09:36:10 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 30 Aug 2010 09:36:10 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 40] libpq thread test insufficient
In-Reply-To: <bug-40-4@http.www.slony.info/bugzilla/>
References: <bug-40-4@http.www.slony.info/bugzilla/>
Message-ID: <20100830163610.C5DA5290CA2@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=40

--- Comment #15 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-30 09:36:10 PDT ---
(In reply to comment #14)
> Chris,
> 
> Per Peter's comment, the patch fails when we try to build against a 9.0 with
> default(ish) options to ./configure (for postgres) even though PG is built with
> threading.
> 
> What I think we need to do is have configure compile up a program that links
> against libpq and calls 
> int PQisthreadsafe();
> and make sure the return code is 1.

OK, I have added a test that seems to work.

http://github.com/cbbrowne/slony1-engine/commit/99507a92d54063d038ef572bcfe78916f589886d

I do a bit of trickery with LIBS, which I don't particularly like.

The test is certainly open to improvement.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Mon Aug 30 10:30:21 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 30 Aug 2010 10:30:21 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 40] libpq thread test insufficient
In-Reply-To: <bug-40-4@http.www.slony.info/bugzilla/>
References: <bug-40-4@http.www.slony.info/bugzilla/>
Message-ID: <20100830173021.F1B28290CA2@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=40

--- Comment #16 from Jan Wieck <janwieck at yahoo.com> 2010-08-30 10:30:22 PDT ---
We need to make sure that this test is building the test program against the
libpq-fe that is pointed out by pg_config. Other than that, asking the library
itself is IMHO the right thing.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Mon Aug 30 11:52:38 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 30 Aug 2010 11:52:38 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 40] libpq thread test insufficient
In-Reply-To: <bug-40-4@http.www.slony.info/bugzilla/>
References: <bug-40-4@http.www.slony.info/bugzilla/>
Message-ID: <20100830185238.B727D290CA2@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=40

--- Comment #17 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-30 11:52:38 PDT ---
(In reply to comment #16)
> We need to make sure that this test is building the test program against the
> libpq-fe that is pointed out by pg_config. Other than that, asking the library
> itself is IMHO the right thing.

Yes, we surely are.  The values of LIBS and such are used; extracting from
config.log, for my install:

configure:5523: checking PostgreSQL for thread-safety
configure:5545: gcc -o conftest -g -O2 
-I/var/lib/postgresql/dbs/postgresql-8.4/include/
-I/var/lib/postgresql/dbs/postgresql-8.4/include/server/ 
-L/var/lib/postgresql/dbs/postgresql-8.4/lib/ conftest.c  -lpq >&5

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Mon Aug 30 12:17:36 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 30 Aug 2010 12:17:36 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 40] libpq thread test insufficient
In-Reply-To: <bug-40-4@http.www.slony.info/bugzilla/>
References: <bug-40-4@http.www.slony.info/bugzilla/>
Message-ID: <20100830191736.BE879290C4E@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=40

--- Comment #18 from Steve Singer <ssinger at ca.afilias.info> 2010-08-30 12:17:36 PDT ---
I've tested this on AIX and the patch seems to behave as expected.

On linux when i compile with --disable-thread-safety it still 'seems' to give
me a libpq that has thread safety enabled.  Maybe this is where the 'ignore on
linux' behaviour we previously in the check came from?

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Mon Aug 30 12:32:57 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 30 Aug 2010 12:32:57 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 40] libpq thread test insufficient
In-Reply-To: <bug-40-4@http.www.slony.info/bugzilla/>
References: <bug-40-4@http.www.slony.info/bugzilla/>
Message-ID: <20100830193257.A5EED290467@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=40

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #19 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-30 12:32:57 PDT ---
Applied to HEAD and 2.0

Version 2.0_STABLE:

http://git.postgresql.org/gitweb?p=slony1-engine.git;a=commit;h=d747d9c97beeace62a1798e9b81807ca5727de3c

HEAD:

http://git.postgresql.org/gitweb?p=slony1-engine.git;a=commit;h=ce8854ccb0c21ff50cc957000f0775d2afdc051d

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Aug 31 08:56:06 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 31 Aug 2010 08:56:06 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 128] DROP TABLE replicatedTable leaves the
 cluster in a bad state
In-Reply-To: <bug-128-4@http.www.slony.info/bugzilla/>
References: <bug-128-4@http.www.slony.info/bugzilla/>
Message-ID: <20100831155606.DBCA1290439@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=128

--- Comment #4 from Steve Singer <ssinger at ca.afilias.info> 2010-08-31 08:56:06 PDT ---
I'm not sure this fixes the bug described here.

Recall the sequence of events described here is

1. User does a "DROP TABLE someReplicatedTable"  (Say he does this on all
nodes)
2. The user does a MOVE SET via slonik

The move set will fail on the subscriber in alterTableConfigureTriggers

the subscriber will be stuck on the move set and won't be able to get to a 'set
drop table' command that your patch changes.

I think alterTableConfigureTriggers() also needs the check against pg_class and
to log a warning if it isn't found.  Right not it throws a fatal exception.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Aug 31 11:49:26 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 31 Aug 2010 11:49:26 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 128] DROP TABLE replicatedTable leaves the
 cluster in a bad state
In-Reply-To: <bug-128-4@http.www.slony.info/bugzilla/>
References: <bug-128-4@http.www.slony.info/bugzilla/>
Message-ID: <20100831184926.57E90290CA2@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=128

--- Comment #5 from Jan Wieck <janwieck at yahoo.com> 2010-08-31 11:49:26 PDT ---
Well, that would mean that we want to do the check, if the table still exists,
inside of alterTableXYZTriggers() (there are multiple of those).

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Aug 31 12:55:36 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 31 Aug 2010 12:55:36 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 99] unable to set datestyle
In-Reply-To: <bug-99-4@http.www.slony.info/bugzilla/>
References: <bug-99-4@http.www.slony.info/bugzilla/>
Message-ID: <20100831195536.9641C2903BE@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=99

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |WORKSFORME
             Status|ASSIGNED                    |RESOLVED

--- Comment #5 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-08-31 12:55:36 PDT ---
It's the end of August, and there has been no more explanation...  Closing...

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

