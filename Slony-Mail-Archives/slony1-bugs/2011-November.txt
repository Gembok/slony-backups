From bugzilla-daemon at main.slony.info  Fri Nov  4 13:02:08 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri,  4 Nov 2011 13:02:08 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 247] New: Slony log shipper doesn't parse
	TRUNCATE
Message-ID: <bug-247-4@http.www.slony.info/bugzilla/>

http://www.slony.info/bugzilla/show_bug.cgi?id=247

           Summary: Slony log shipper doesn't parse TRUNCATE
           Product: Slony-I
           Version: devel
          Platform: PC
        OS/Version: Linux
            Status: NEW
          Severity: enhancement
          Priority: low
         Component: slony_logshipper
        AssignedTo: slony1-bugs at lists.slony.info
        ReportedBy: ssinger at ca.afilias.info
                CC: slony1-bugs at lists.slony.info
   Estimated Hours: 0.0


This bug applies to 2.1 and master (2.2)

Slony 2.1 added support for replicating TRUNCATE commands.

The slony_logshipper daemon has a parser.y that it uses to parse the log ship
files generated by slon.  The grammer in this file (and associated handling
code) can not deal with TRUNCATE commands.

You get the following error
ERROR 2011-11-04 15:55:28 >
/tmp/logreformat/slony1_log_4_00000000000000000139.sql:12: ERROR syntax error
at or near TRUNCATE

from a line in the log file like:
TRUNCATE ONLY "disorder"."do_item_review" CASCADE;

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Nov  4 13:21:10 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri,  4 Nov 2011 13:21:10 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 248] New: Log shipper targets can't add
 sequences after initial setup
Message-ID: <bug-248-4@http.www.slony.info/bugzilla/>

http://www.slony.info/bugzilla/show_bug.cgi?id=248

           Summary: Log shipper targets can't add sequences after initial
                    setup
           Product: Slony-I
           Version: 2.0
          Platform: PC
        OS/Version: Linux
            Status: NEW
          Severity: enhancement
          Priority: low
         Component: slon
        AssignedTo: slony1-bugs at lists.slony.info
        ReportedBy: ssinger at ca.afilias.info
                CC: slony1-bugs at lists.slony.info
   Estimated Hours: 0.0


The slony1_dump.sh creates a sl_sequence_offline table for tracking sequences
on a log shipping target.

If you add+subscribe a new sequence to a new set after the log shipping slave
has been setup then the slon generating the log ship files will not generate
any SQL to update sl_sequence_offline to reflect the new sequence.  Updates to
the sequence then fail on the log shipping target.

I have changes to the LogShipping.js disorder test to replicate this issue that
I will include with the fix.

I think 2.0 2.1 and 2.2 all have this bug (I haven't looked at the log shipping
code in 1.2)

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Nov  7 07:36:56 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  7 Nov 2011 07:36:56 -0800 (PST)
Subject: [Slony1-bugs] [Bug 248] Log shipper targets can't add sequences
 after initial setup
In-Reply-To: <bug-248-4@http.www.slony.info/bugzilla/>
References: <bug-248-4@http.www.slony.info/bugzilla/>
Message-ID: <20111107153656.63FE0290E6C@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=248

--- Comment #1 from Steve Singer <ssinger at ca.afilias.info> 2011-11-07 07:36:56 PST ---
Created an attachment (id=129)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=129)
Unit test changes to trigger this bug

Adding unit tests to trigger this bug.
This test can also trigger bug 247.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Nov  7 07:38:03 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  7 Nov 2011 07:38:03 -0800 (PST)
Subject: [Slony1-bugs] [Bug 248] Log shipper targets can't add sequences
 after initial setup
In-Reply-To: <bug-248-4@http.www.slony.info/bugzilla/>
References: <bug-248-4@http.www.slony.info/bugzilla/>
Message-ID: <20111107153803.B34C7290E3E@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=248

--- Comment #2 from Steve Singer <ssinger at ca.afilias.info> 2011-11-07 07:38:03 PST ---
Created an attachment (id=130)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=130)
Fix for bug 248

This is a fix for bug248.
It was developed against REL_2_1_STABLE but should apply against 2.0 (excluding
the unit test change)

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Nov  7 09:48:53 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  7 Nov 2011 09:48:53 -0800 (PST)
Subject: [Slony1-bugs] [Bug 247] Slony log shipper doesn't parse TRUNCATE
In-Reply-To: <bug-247-4@http.www.slony.info/bugzilla/>
References: <bug-247-4@http.www.slony.info/bugzilla/>
Message-ID: <20111107174853.0ECAE290E60@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=247

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |ssinger at ca.afilias.info
                   |o                           |
             Status|NEW                         |ASSIGNED

--- Comment #1 from Steve Singer <ssinger at ca.afilias.info> 2011-11-07 09:48:52 PST ---
Created an attachment (id=131)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=131)
Fix for bug 247

Fix for bug 247.

A unit test to check for this condition is attached to bug248.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Nov  7 09:59:12 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  7 Nov 2011 09:59:12 -0800 (PST)
Subject: [Slony1-bugs] [Bug 248] Log shipper targets can't add sequences
 after initial setup
In-Reply-To: <bug-248-4@http.www.slony.info/bugzilla/>
References: <bug-248-4@http.www.slony.info/bugzilla/>
Message-ID: <20111107175912.97424290E5A@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=248

--- Comment #3 from Steve Singer <ssinger at ca.afilias.info> 2011-11-07 09:59:12 PST ---
We also have no code to drop sequences from the _offline tracking table in
response to a DROP_SET or DROP_SEQUENCE.  This sounds like it could cause
problems if later you add the set/sequence back again.

Also if someone changes the name of the sequence via EXECUTE SCRIPT things will
again break.

Why are we tracking the relationship between the sequence id and the sequence
name?  Would we be better off not passing the name instead of the id to
sequenceSetValue_offline?  Does anyone remember the reason why the tracking
table was added in the first place?

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov  8 10:16:21 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue,  8 Nov 2011 10:16:21 -0800 (PST)
Subject: [Slony1-bugs] [Bug 248] Log shipper targets can't add sequences
 after initial setup
In-Reply-To: <bug-248-4@http.www.slony.info/bugzilla/>
References: <bug-248-4@http.www.slony.info/bugzilla/>
Message-ID: <20111108181621.7C29D290E6C@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=248

--- Comment #4 from Steve Singer <ssinger at ca.afilias.info> 2011-11-08 10:16:21 PST ---
Created an attachment (id=132)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=132)
Alternate fix, stop using the sequence table

An alternate fix for bug248. This stops tracking sequences in a table and
instead includes the sequence name (from the node running the slon that
generates the log ship files) in the .SQL files.

I do not feel this patch is suitable for 2.1.x or 2.0.x because it changes the
arguments of functions + eliminates a table.  I think it is the preferred
approach for 2.2

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov  8 10:58:45 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue,  8 Nov 2011 10:58:45 -0800 (PST)
Subject: [Slony1-bugs] [Bug 237] drop set does not remove truncate triggers
In-Reply-To: <bug-237-4@http.www.slony.info/bugzilla/>
References: <bug-237-4@http.www.slony.info/bugzilla/>
Message-ID: <20111108185845.E0A5D290E5E@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=237

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #6 from Steve Singer <ssinger at ca.afilias.info> 2011-11-08 10:58:45 PST ---
This was merged into 2.1.0 
6838c614d10368500abce2c12490935bdea0da3d

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov  8 11:00:14 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue,  8 Nov 2011 11:00:14 -0800 (PST)
Subject: [Slony1-bugs] [Bug 229] creating a set then adding a table to a
 different set can deadlock
In-Reply-To: <bug-229-4@http.www.slony.info/bugzilla/>
References: <bug-229-4@http.www.slony.info/bugzilla/>
Message-ID: <20111108190015.05E98290E6D@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=229

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #12 from Steve Singer <ssinger at ca.afilias.info> 2011-11-08 11:00:15 PST ---
This was fixed in 2.1.0 with commit 95d82dc387deaaa6d47bf97087dac32176abf648

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov  8 12:02:46 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue,  8 Nov 2011 12:02:46 -0800 (PST)
Subject: [Slony1-bugs] [Bug 248] Log shipper targets can't add sequences
 after initial setup
In-Reply-To: <bug-248-4@http.www.slony.info/bugzilla/>
References: <bug-248-4@http.www.slony.info/bugzilla/>
Message-ID: <20111108200246.C82D1290E5B@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=248

--- Comment #5 from Steve Singer <ssinger at ca.afilias.info> 2011-11-08 12:02:46 PST ---
Another related question is how do we tell users of log shipping what SQL they
need to execute against the log shipping target node to apply these changes.

I can attach a SQL command list to the bug but does that go in the manual? In a
shell script like slony1_dump.sh?

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov  8 13:16:51 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue,  8 Nov 2011 13:16:51 -0800 (PST)
Subject: [Slony1-bugs] [Bug 248] Log shipper targets can't add sequences
 after initial setup
In-Reply-To: <bug-248-4@http.www.slony.info/bugzilla/>
References: <bug-248-4@http.www.slony.info/bugzilla/>
Message-ID: <20111108211651.D44E2290E5A@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=248

--- Comment #6 from Steve Singer <ssinger at ca.afilias.info> 2011-11-08 13:16:51 PST ---
Created an attachment (id=133)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=133)
Add OMIT_COPY option to slony1_dump.sh to support upgrades

To address the upgrade problem I have modified slony1_dump.sh to do a dump
without the data.  The upgrade instructions would be
1. stop the slon
2. drop schema $clustername cascade; from the log ship target
3. slony1_dump.sh -omit_copy
4. restart the slons.

Log shipping should resume from where it left off but with the new slony
version.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Nov  9 06:09:14 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  9 Nov 2011 06:09:14 -0800 (PST)
Subject: [Slony1-bugs] [Bug 244] create set is not well parsed
In-Reply-To: <bug-244-4@http.www.slony.info/bugzilla/>
References: <bug-244-4@http.www.slony.info/bugzilla/>
Message-ID: <20111109140914.D939A290E6D@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=244

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
             Status|NEW                         |ASSIGNED

--- Comment #1 from Steve Singer <ssinger at ca.afilias.info> 2011-11-09 06:09:14 PST ---
The bug here is that create set does not require a set id.
It defaults to set id=-1;

The create set actually creates a set with -1.

The 'set add table' is correct to fail with the message 'can't find origin for
set 1' because set 1 does not exist.

As the bug title implies we should make create set require a set id.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Nov  9 06:15:53 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  9 Nov 2011 06:15:53 -0800 (PST)
Subject: [Slony1-bugs] [Bug 244] create set is not well parsed
In-Reply-To: <bug-244-4@http.www.slony.info/bugzilla/>
References: <bug-244-4@http.www.slony.info/bugzilla/>
Message-ID: <20111109141553.A1061290E6D@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=244

--- Comment #2 from Steve Singer <ssinger at ca.afilias.info> 2011-11-09 06:15:53 PST ---
Created an attachment (id=134)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=134)
Patch to require  a set id

This patch makes create set require a set id.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Nov  9 06:18:18 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  9 Nov 2011 06:18:18 -0800 (PST)
Subject: [Slony1-bugs] [Bug 244] create set is not well parsed
In-Reply-To: <bug-244-4@http.www.slony.info/bugzilla/>
References: <bug-244-4@http.www.slony.info/bugzilla/>
Message-ID: <20111109141818.AFAE2290E6D@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=244

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |janwieck at yahoo.com
                   |o                           |

--- Comment #3 from Steve Singer <ssinger at ca.afilias.info> 2011-11-09 06:18:18 PST ---
Please arrange for a code review.
https://github.com/ssinger/slony1-engine/commit/0573d0d049c596bc837840160f16d49e48947123

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Nov  9 08:44:01 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  9 Nov 2011 08:44:01 -0800 (PST)
Subject: [Slony1-bugs] [Bug 161] EXECUTE SCRIPT fails to execute multi-line
	commands
In-Reply-To: <bug-161-4@http.www.slony.info/bugzilla/>
References: <bug-161-4@http.www.slony.info/bugzilla/>
Message-ID: <20111109164401.815A7290E3E@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=161

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|NEW                         |RESOLVED

--- Comment #3 from Steve Singer <ssinger at ca.afilias.info> 2011-11-09 08:44:01 PST ---
Applied to REL_2_1_STABLE and master.  I am not sure why this wasn't committed
when a year ago when Chris gave the okay.

http://git.postgresql.org/gitweb/?p=slony1-engine.git;a=commit;h=96a7cad9f90758677273aa9a4e95c9a30062e62e
http://git.postgresql.org/gitweb/?p=slony1-engine.git;a=commit;h=0b6ee7ebcde56ff2f9819341547b9e147f8e1ff1

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Nov  9 09:00:36 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  9 Nov 2011 09:00:36 -0800 (PST)
Subject: [Slony1-bugs] [Bug 197] Documentation Images Don't Work
In-Reply-To: <bug-197-4@http.www.slony.info/bugzilla/>
References: <bug-197-4@http.www.slony.info/bugzilla/>
Message-ID: <20111109170036.45359290E5E@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=197

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|NEW                         |RESOLVED

--- Comment #1 from Steve Singer <ssinger at ca.afilias.info> 2011-11-09 09:00:36 PST ---
This should be fixed with CVS version 1.19 of index.php in the website
repository.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Nov  9 14:56:58 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  9 Nov 2011 14:56:58 -0800 (PST)
Subject: [Slony1-bugs] [Bug 137] execute script does not get applied in the
	correct order
In-Reply-To: <bug-137-4@http.www.slony.info/bugzilla/>
References: <bug-137-4@http.www.slony.info/bugzilla/>
Message-ID: <20111109225658.94D83290E3B@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=137

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|cbbrowne at ca.afilias.info    |janwieck at yahoo.com

--- Comment #8 from Christopher Browne <cbbrowne at ca.afilias.info> 2011-11-09 14:56:58 PST ---
A version of this that functions against version 2.2 may be found here:
https://github.com/cbbrowne/slony1-engine/tree/bug137-squashed

Note that this branch was arrived at by merging Jan's 2.2 branch and Steve's
remote worker changes atop "master":

https://github.com/wieck/slony1-engine/tree/copy-protocol-22
https://github.com/ssinger/slony1-engine/tree/copy-protocol_22_remoteworker

In practice, I think my changes are all expressed by one patch thus:
https://github.com/cbbrowne/slony1-engine/commit/5187d5343145c3c145e328ad05912d35334cd601

I'll be poking further at the documentation, as some of the old docs are
invalidated by this change.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

