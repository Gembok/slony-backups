From JanWieck at Yahoo.com  Tue Jun  1 05:58:38 2010
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Tue, 01 Jun 2010 08:58:38 -0400
Subject: [Slony1-bugs] [Bug 130] New: failover does not seem to update
 sl_set
In-Reply-To: <bug-130-4@http.www.slony.info/bugzilla/>
References: <bug-130-4@http.www.slony.info/bugzilla/>
Message-ID: <4C0503FE.90105@Yahoo.com>

On 5/26/2010 5:26 PM, bugzilla-daemon at main.slony.info wrote:
> http://www.slony.info/bugzilla/show_bug.cgi?id=130
> 
>            Summary: failover does not seem to update sl_set
>            Product: Slony-I
>            Version: 2.0
>           Platform: PC
>         OS/Version: Linux
>             Status: NEW
>           Severity: enhancement
>           Priority: low
>          Component: stored procedures
>         AssignedTo: slony1-bugs at lists.slony.info
>         ReportedBy: ssinger at ca.afilias.info
>                 CC: slony1-bugs at lists.slony.info
>    Estimated Hours: 0.0
> 
> 
> Observed with 2.0.3
>  
> In a cluster as follows
> 
> 1
> \\
>  \\
>   3===4
>   \\
>    \\
>      5
> 
> 
>  A failover of set 1=>3 seems to work.
> 
> However DROP NODE (id=1) fails with 
> 
> <stdin>:12: PGRES_FATAL_ERROR select "_disorder_replica".dropNode(1);  - ERROR:
>  Slony-I: Node 1 is still origin of one or more sets
> 
> When I query sl_set it shows that node 1 is still the origin of the set even
> though the failover command seemed to work okay.
> 

Failover assumes that the failed node, in this case 1, is no longer 
reachable. There is no point in informing it about anything, so looking 
at status information of sets, tables or anything on node 1 does not 
make much sense.

The drop node should have an event node other than 1 specified and the 
code should check that event node and to be dropped node are different.


Jan

-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin

From bugzilla-daemon at main.slony.info  Tue Jun  1 08:03:52 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue,  1 Jun 2010 08:03:52 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 132] New: ERROR: duplicate key value violates
 unique constraint "sl_nodelock-pkey"
Message-ID: <bug-132-4@http.www.slony.info/bugzilla/>

http://www.slony.info/bugzilla/show_bug.cgi?id=132

           Summary: ERROR:  duplicate key value violates unique constraint
                    "sl_nodelock-pkey"
           Product: Slony-I
           Version: 2.0
          Platform: PC
        OS/Version: Linux
            Status: NEW
          Severity: normal
          Priority: low
         Component: slon
        AssignedTo: slony1-bugs at lists.slony.info
        ReportedBy: ssinger at ca.afilias.info
                CC: slony1-bugs at lists.slony.info
   Estimated Hours: 0.0


A slon exitted with 

"_disorder_replica".cleanupNodelock(); insert into
"_disorder_replica".sl_nodelock values (    4, 0,
"pg_catalog".pg_backend_pid()); " - ERROR:  duplicate key value violates unique
constraint "sl_nodelock-pkey"


What appears to have happened is that following a move set the slon called
slon_retry() and exitted and was restarted  The restarted slon did some
processing and eventually encountered the above error.

At this stage I can't say if the bug is:

1) The first slon instance exitted without cleaning up
2) The second slon instance should have cleaned up after the first (check if
the backend is still alive and if not delete the row)
3) something else




2010-06-01 10:34:17,433 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:17 EDTCONFIG enableSubscription: sub_set=2
2010-06-01 10:34:17,433 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - subscription is
complete:2010-06-01 10:34:17 EDTCONFIG enableSubscription: sub_set=2
2010-06-01 10:34:17,433 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:17 EDTWARN   remoteWorker_wakeup: node 3 - no worker thread
2010-06-01 10:34:17,433 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:17 EDTDEBUG2 sched_wakeup_node(): no_id=3 (0 threads + worker signaled)
2010-06-01 10:34:17,433 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:17 EDTCONFIG main: last local event sequence = 5000000002
2010-06-01 10:34:17,433 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:17 EDTCONFIG main: configuration complete - starting threads
2010-06-01 10:34:17,433 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:17 EDTINFO   localListenThread: thread starts
2010-06-01 10:34:17,433 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:17 EDTCONFIG version for "dbname=test4 host=localhost user=slony
password=slony" is 80309
2010-06-01 10:34:17,433 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:17 EDTDEBUG1 local_listen "dbname=test4 host=localhost user=slony
password=slony": backend pid = 4464
2010-06-01 10:34:17,433 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:17 EDTCONFIG slon: worker process created - pid = 4460
2010-06-01 10:34:17,447 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:17 EDTFATAL  localListenThread: "select
"_disorder_replica".cleanupNodelock(); insert into
"_disorder_replica".sl_nodelock values (    4, 0,
"pg_catalog".pg_backend_pid()); " - ERROR:  duplicate key value violates unique
constraint "sl_nodelock-pkey"
2010-06-01 10:34:17,447 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 
2010-06-01 10:34:17,447 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:17 EDTDEBUG2 slon_abort() from pid=4460
2010-06-01 10:34:17,447 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:17 EDTINFO   slon: shutdown requested
2010-06-01 10:34:17,447 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:17 EDTINFO   slon: notify worker process to shutdown
2010-06-01 10:34:17,448 [db4stderr] ERROR
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - NOTICE: 
Slony-I: cleanup stale sl_nodelock entry for pid=4072
2010-06-01 10:34:37,450 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:37 EDTINFO   slon: child termination timeout - kill child
2010-06-01 10:34:37,450 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:37 EDTCONFIG slon: child terminated status: 9; pid: 4460, current worker
pid: 4460
2010-06-01 10:34:37,450 [db4 stdout] INFO 
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - abnormal
termination of slon2010-06-01 10:34:37 EDTCONFIG slon: child terminated status:
9; pid: 4460, current worker pid: 4460
2010-06-01 10:34:37,450 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:37 EDTINFO   slon: done



2010-06-01 10:34:17,412 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:17 EDTCONFIG remoteWorkerThread_5: update provider configuration
2010-06-01 10:34:17,412 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:17 EDTINFO   remoteWorkerThread_5: thread done
2010-06-01 10:34:17,412 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:17 EDTDEBUG1 cleanupThread: thread done
2010-06-01 10:34:17,412 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:17 EDTCONFIG main: done
2010-06-01 10:34:17,412 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:17 EDTCONFIG slon: child terminated status: 0; pid: 3974, current worker
pid: 3974
2010-06-01 10:34:17,413 [db4 stdout] INFO 
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - abnormal
termination of slon2010-06-01 10:34:17 EDTCONFIG slon: child terminated status:
0; pid: 3974, current worker pid: 3974
2010-06-01 10:34:17,413 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:17 EDTCONFIG slon: restart of worker
2010-06-01 10:34:17,413 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:17 EDTCONFIG main: slon version 2.0.3 starting up
2010-06-01 10:34:17,413 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:17 EDTINFO   slon: watchdog process started



2010-06-01 10:34:17,433 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:17 EDTCONFIG enableSubscription: sub_set=2
2010-06-01 10:34:17,433 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - subscription is
complete:2010-06-01 10:34:17 EDTCONFIG enableSubscription: sub_set=2
2010-06-01 10:34:17,433 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:17 EDTWARN   remoteWorker_wakeup: node 3 - no worker thread
2010-06-01 10:34:17,433 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:17 EDTDEBUG2 sched_wakeup_node(): no_id=3 (0 threads + worker signaled)
2010-06-01 10:34:17,433 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:17 EDTCONFIG main: last local event sequence = 5000000002
2010-06-01 10:34:17,433 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:17 EDTCONFIG main: configuration complete - starting threads
2010-06-01 10:34:17,433 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:17 EDTINFO   localListenThread: thread starts
2010-06-01 10:34:17,433 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:17 EDTCONFIG version for "dbname=test4 host=localhost user=slony
password=slony" is 80309
2010-06-01 10:34:17,433 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:17 EDTDEBUG1 local_listen "dbname=test4 host=localhost user=slony
password=slony": backend pid = 4464
2010-06-01 10:34:17,433 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:17 EDTCONFIG slon: worker process created - pid = 4460
2010-06-01 10:34:17,447 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:17 EDTFATAL  localListenThread: "select
"_disorder_replica".cleanupNodelock(); insert into
"_disorder_replica".sl_nodelock values (    4, 0,
"pg_catalog".pg_backend_pid()); " - ERROR:  duplicate key value violates unique
constraint "sl_nodelock-pkey"
2010-06-01 10:34:17,447 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 
2010-06-01 10:34:17,447 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:17 EDTDEBUG2 slon_abort() from pid=4460
2010-06-01 10:34:17,447 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:17 EDTINFO   slon: shutdown requested
2010-06-01 10:34:17,447 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:17 EDTINFO   slon: notify worker process to shutdown
2010-06-01 10:34:17,448 [db4stderr] ERROR
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - NOTICE: 
Slony-I: cleanup stale sl_nodelock entry for pid=4072
2010-06-01 10:34:37,450 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:37 EDTINFO   slon: child termination timeout - kill child
2010-06-01 10:34:37,450 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:37 EDTCONFIG slon: child terminated status: 9; pid: 4460, current worker
pid: 4460
2010-06-01 10:34:37,450 [db4 stdout] INFO 
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - abnormal
termination of slon2010-06-01 10:34:37 EDTCONFIG slon: child terminated status:
9; pid: 4460, current worker pid: 4460
2010-06-01 10:34:37,450 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-01
10:34:37 EDTINFO   slon: done

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Jun  1 08:06:30 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue,  1 Jun 2010 08:06:30 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 132] ERROR: duplicate key value violates unique
 constraint "sl_nodelock-pkey"
In-Reply-To: <bug-132-4@http.www.slony.info/bugzilla/>
References: <bug-132-4@http.www.slony.info/bugzilla/>
Message-ID: <20100601150630.18F22290412@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=132

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
           See Also|                            |http://bugs.slony.info/bugz
                   |                            |illa/show_bug.cgi?id=81

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Jun  1 12:01:13 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue,  1 Jun 2010 12:01:13 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 133] New: DROP set in the middle of a subscribe
 to the same set confuses slon
Message-ID: <bug-133-4@http.www.slony.info/bugzilla/>

http://www.slony.info/bugzilla/show_bug.cgi?id=133

           Summary: DROP set in the middle of a subscribe to the same set
                    confuses slon
           Product: Slony-I
           Version: 2.0
          Platform: PC
        OS/Version: Linux
            Status: NEW
          Severity: normal
          Priority: low
         Component: slon
        AssignedTo: slony1-bugs at lists.slony.info
        ReportedBy: ssinger at ca.afilias.info
                CC: slony1-bugs at lists.slony.info
   Estimated Hours: 0.0


Consider a setup such as

1==>3===>4

Node 1 is the origin for a replication set (set 2).

This set is subscribed to on node 2.

We then concurrently issue (with different slonik instances)

1:  subscribe set(set id=2, provider=3, receiver=4)
2:  drop set (id=2, origin=1);

It is possible for the slons at various nodes to get confused and start logging
things like

db5 - 2010-06-01 14:51:02 EDTERROR  remoteWorkerThread_3: "select
"_disorder_replica".subscribeSet_int(2, 3, 4, 't', 'f'); insert into
"_disorder_replica".sl_event     (ev_origin, ev_seqno, ev_timestamp,     
ev_snapshot, ev_type , ev_data1, ev_data2, ev_data3, ev_data4, ev_data5    )
values ('3', '5000000005', '2010-06-01 14:50:36.965441', '690742:690742:',
'SUBSCRIBE_SET', '2', '3', '4', 't', 'f'); insert into
"_disorder_replica".sl_confirm     (con_origin, con_received, con_seqno,
con_timestamp)    values (3, 5, '5000000005', now()); commit transaction;"
PGRES_FATAL_ERROR ERROR:  Slony-I: subscribeSet_int(): set 2 not found



Note that the slon complaining is for node 5, and is not directly involved in
the actions on set 2 (but other slons log similar errors).


I realize that I am trying to shoot myself in the foot with this example but I
can see how this can happen in real life (two admins that don't talk or
misbehaving scripts) and it shouldn't be that easy to corrupt my replication
cluster.  I would think that the subscribeSet_int should log an error but mark
the event as processed?

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Jun  1 12:50:58 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue,  1 Jun 2010 12:50:58 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 105] too much columns in INSERT
In-Reply-To: <bug-105-4@http.www.slony.info/bugzilla/>
References: <bug-105-4@http.www.slony.info/bugzilla/>
Message-ID: <20100601195058.34DB5290CEC@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=105

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|NEW                         |RESOLVED

--- Comment #1 from Steve Singer <ssinger at ca.afilias.info> 2010-06-01 12:50:58 PDT ---
This path must have been applied, I don't see hte issue in 2.0.3.
Please reopen if this is not the case.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Jun  1 12:57:15 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue,  1 Jun 2010 12:57:15 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 104] slon core in sched_add_fdset
In-Reply-To: <bug-104-4@http.www.slony.info/bugzilla/>
References: <bug-104-4@http.www.slony.info/bugzilla/>
Message-ID: <20100601195715.C6653290249@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=104

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |ssinger at ca.afilias.info
                   |o                           |
             Status|NEW                         |ASSIGNED

--- Comment #1 from Steve Singer <ssinger at ca.afilias.info> 2010-06-01 12:57:15 PDT ---
Created an attachment (id=44)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=44)
Fix for  bug 104

The attach fix should address the stack trace in this bug

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Jun  1 13:18:35 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue,  1 Jun 2010 13:18:35 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 104] slon core in sched_add_fdset
In-Reply-To: <bug-104-4@http.www.slony.info/bugzilla/>
References: <bug-104-4@http.www.slony.info/bugzilla/>
Message-ID: <20100601201835.424D7290C42@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=104

--- Comment #2 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-06-01 13:18:35 PDT ---
(In reply to comment #1)
> Created an attachment (id=44)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=44) [details]
> Fix for  bug 104
> 
> The attach fix should address the stack trace in this bug

The fix seems reasonable.

The function is called in 4 places in src/slon/scheduler.c

src/slon/scheduler.c
60:static void sched_add_fdset(int fd, fd_set * fds);
211:            sched_add_fdset(PQsocket(conn->dbconn), &sched_fdset_read);
213:            sched_add_fdset(PQsocket(conn->dbconn), &sched_fdset_write);
408:    sched_add_fdset(sched_wakeuppipe[0], &sched_fdset_read);
672: * sched_add_fdset
679:sched_add_fdset(int fd, fd_set * fds)
688: * sched_add_fdset

Is it possible that the evaluation of the socket could instead be processed
inside the function?  That would mean that the same validity test would be
applied for the other 2 cases as well, and it might very well simplify the
code.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Jun  2 12:09:57 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  2 Jun 2010 12:09:57 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 69] Upgrade from 1.2 to 2.0 didn't work...
In-Reply-To: <bug-69-4@http.www.slony.info/bugzilla/>
References: <bug-69-4@http.www.slony.info/bugzilla/>
Message-ID: <20100602190957.AF372290CC5@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=69

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |WONTFIX
             Status|NEW                         |RESOLVED

--- Comment #7 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-06-02 12:09:57 PDT ---
The upgrade path suggested by this bug is one we will no proceed with.

The approach being recommended instead is to...

- Uninstall old version of Slony-I
- Install new version fresh.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Jun  2 12:16:54 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  2 Jun 2010 12:16:54 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 32] Once every two to three months Slony fails
 to commit confirms
In-Reply-To: <bug-32-4@http.www.slony.info/bugzilla/>
References: <bug-32-4@http.www.slony.info/bugzilla/>
Message-ID: <20100602191654.118E9290C16@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=32

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |WONTFIX
             Status|ASSIGNED                    |RESOLVED

--- Comment #5 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-06-02 12:16:54 PDT ---
After two years without further comment, with somewhat different behaviour in
v2.0, there seems to be nothing more to do here.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Jun  2 12:22:08 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  2 Jun 2010 12:22:08 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 40] libpq thread test insufficient
In-Reply-To: <bug-40-4@http.www.slony.info/bugzilla/>
References: <bug-40-4@http.www.slony.info/bugzilla/>
Message-ID: <20100602192208.5BE49290292@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=40

Jan Wieck <janwieck at yahoo.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |janwieck at yahoo.com
                   |o                           |

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Jun  2 12:23:17 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  2 Jun 2010 12:23:17 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 40] libpq thread test insufficient
In-Reply-To: <bug-40-4@http.www.slony.info/bugzilla/>
References: <bug-40-4@http.www.slony.info/bugzilla/>
Message-ID: <20100602192317.EBF26290292@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=40

Jan Wieck <janwieck at yahoo.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
           Severity|critical                    |normal
            Version|1.2                         |2.0

--- Comment #2 from Jan Wieck <janwieck at yahoo.com> 2010-06-02 12:23:18 PDT ---
We will enable this for 2.0 as soon as the 2.0.4 release is out.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Jun  2 12:26:34 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  2 Jun 2010 12:26:34 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 59] slony doesn't escape varchar fields properly,
 making it impossible to replicate varchar or bytea columns in some cases
In-Reply-To: <bug-59-4@http.www.slony.info/bugzilla/>
References: <bug-59-4@http.www.slony.info/bugzilla/>
Message-ID: <20100602192635.0A445290292@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=59

--- Comment #2 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-06-02 12:26:35 PDT ---
Question to consider:

Should the slon verify that it uses a single common encoding on all DB
connections?

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Jun  2 12:30:00 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  2 Jun 2010 12:30:00 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 59] slony doesn't escape varchar fields properly,
 making it impossible to replicate varchar or bytea columns in some cases
In-Reply-To: <bug-59-4@http.www.slony.info/bugzilla/>
References: <bug-59-4@http.www.slony.info/bugzilla/>
Message-ID: <20100602193000.7323F290412@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=59

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
             Status|NEW                         |ASSIGNED
            Version|1.2                         |devel

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Jun  2 12:34:00 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  2 Jun 2010 12:34:00 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 59] slony doesn't escape varchar fields properly,
 making it impossible to replicate varchar or bytea columns in some cases
In-Reply-To: <bug-59-4@http.www.slony.info/bugzilla/>
References: <bug-59-4@http.www.slony.info/bugzilla/>
Message-ID: <20100602193400.18BCF290292@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=59

--- Comment #3 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-06-02 12:34:00 PDT ---
We intend to address this in a different way, by ensuring that slon processes
are using the same client encoding on all databases.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Jun  2 13:19:47 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  2 Jun 2010 13:19:47 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 78] Vacuum of sl_log_2 with 42M rows is blocking
	replication
In-Reply-To: <bug-78-4@http.www.slony.info/bugzilla/>
References: <bug-78-4@http.www.slony.info/bugzilla/>
Message-ID: <20100602201948.018AE290412@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=78

--- Comment #3 from Jan Wieck <janwieck at yahoo.com> 2010-06-02 13:19:48 PDT ---
We will remove sl_log_1 and sl_log_2 from the vacuum candidate tables inside of
cleanupEvent().

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Jun  2 13:20:53 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  2 Jun 2010 13:20:53 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 78] Vacuum of sl_log_2 with 42M rows is blocking
	replication
In-Reply-To: <bug-78-4@http.www.slony.info/bugzilla/>
References: <bug-78-4@http.www.slony.info/bugzilla/>
Message-ID: <20100602202053.CE9FC290CC8@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=78

--- Comment #4 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-06-02 13:20:53 PDT ---
We should deprecate the "cleanup_deletelogs" parameter in 2.0.5 or so.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From JanWieck at Yahoo.com  Thu Jun  3 05:46:52 2010
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Thu, 03 Jun 2010 08:46:52 -0400
Subject: [Slony1-bugs] [Bug 104] slon core in sched_add_fdset
In-Reply-To: <20100601195715.C6653290249@main.slony.info>
References: <bug-104-4@http.www.slony.info/bugzilla/>
	<20100601195715.C6653290249@main.slony.info>
Message-ID: <4C07A43C.8010407@Yahoo.com>

On 6/1/2010 3:57 PM, bugzilla-daemon at main.slony.info wrote:
> http://www.slony.info/bugzilla/show_bug.cgi?id=104
> 
> Steve Singer <ssinger at ca.afilias.info> changed:
> 
>            What    |Removed                     |Added
> ----------------------------------------------------------------------------
>          AssignedTo|slony1-bugs at lists.slony.inf |ssinger at ca.afilias.info
>                    |o                           |
>              Status|NEW                         |ASSIGNED
> 
> --- Comment #1 from Steve Singer <ssinger at ca.afilias.info> 2010-06-01 12:57:15 PDT ---
> Created an attachment (id=44)
>  --> (http://www.slony.info/bugzilla/attachment.cgi?id=44)
> Fix for  bug 104
> 
> The attach fix should address the stack trace in this bug
> 

Patch looks good to me.


Jan

-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin

From bugzilla-daemon at main.slony.info  Thu Jun  3 05:59:12 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu,  3 Jun 2010 05:59:12 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 69] Upgrade from 1.2 to 2.0 didn't work...
In-Reply-To: <bug-69-4@http.www.slony.info/bugzilla/>
References: <bug-69-4@http.www.slony.info/bugzilla/>
Message-ID: <20100603125912.B655C290CD3@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=69

--- Comment #8 from Jan Wieck <janwieck at yahoo.com> 2010-06-03 05:59:12 PDT ---
Please note that the OMIT COPY option for SUBSCRIBE SET (new in 2.0) allows to
do this in minimal time during a planned outage.


Jan

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Jun  3 14:55:52 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu,  3 Jun 2010 14:55:52 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 129] FAILOVER command does not update
	sl_subscriber
In-Reply-To: <bug-129-4@http.www.slony.info/bugzilla/>
References: <bug-129-4@http.www.slony.info/bugzilla/>
Message-ID: <20100603215552.2508A290CD1@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=129

--- Comment #1 from Steve Singer <ssinger at ca.afilias.info> 2010-06-03 14:55:52 PDT ---
What I think is happening is as follows

If more than one node is a direct subscriber of the node being failed over then
slonik will find the node with the most recent sync and call failedNode2() on
it.

failedNode2() will post an ACCEPT SET event which will have to propogate for
the failover to finish.

If you do a 

failover(.....)

slonik will finish before the ACCEPT SET event is processed.

but if you do a 

failover(....)
wait for event (......)

and there isn't more than one direct subscriber then failedNode2() doesn't get
called an no ACCEPT SET event is posted.  further more the wait for event()
will fail because there is no event to wait for.

I think the solution from a slonik scripting point of view is to do
failover(....)
sync(id=new_origin)
wait for event(....)

the sync will ensure there is always an event to wait for.   This seems a bit
convoluted though and isn't documented clearly.   

I wonder if we can make this simpler somehow

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Thu Jun  3 18:32:16 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu,  3 Jun 2010 18:32:16 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 129] FAILOVER command does not update
	sl_subscriber
In-Reply-To: <bug-129-4@http.www.slony.info/bugzilla/>
References: <bug-129-4@http.www.slony.info/bugzilla/>
Message-ID: <20100604013216.3FEFA2902C0@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=129

--- Comment #2 from Steve Singer <ssinger at ca.afilias.info> 2010-06-03 18:32:16 PDT ---
The approach that I described in my last note won't work.

The slonik script doesn't know which node slonik posted the event into, thta
node is determined by slonik at runtime.  Issuing a sync against the new origin
and waiting for it to be confirmed doesn't seem to ensure that the accept set
posted against some other node gets confirmed on all nodes. 

Also doing a wait for event(confirmed=all) can be problametic here since the
failed node has not yet been dropped (we can't drop it until the failover
properly completes) but if that node really failed it won't be able to confirm
any events.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Jun  4 09:47:54 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri,  4 Jun 2010 09:47:54 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 129] FAILOVER command does not update
	sl_subscriber
In-Reply-To: <bug-129-4@http.www.slony.info/bugzilla/>
References: <bug-129-4@http.www.slony.info/bugzilla/>
Message-ID: <20100604164754.716C7290CDF@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=129

--- Comment #3 from Steve Singer <ssinger at ca.afilias.info> 2010-06-04 09:47:53 PDT ---
There is a second problem in the scenario described above.

Node 3 has two subscribers (4 and 5) for the set.
Since it has more than one direct subscriber failedNode() doesn't switch the
subscriptions but expects slonik to do it.

Slonik in slonik_failed_node() determines num_sets by this query
 select S.set_id, count(S.set)id)
    from sl_set S,  sl_subscribe SUB 
   where S.set_id = SUB.sub_set "
                 "    and S.set_origin = %d "
                 "    and SUB.sub_provider = %d "
                 "    and SUB.sub_active "
                 "    group by set_id ",

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Jun  4 09:52:07 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri,  4 Jun 2010 09:52:07 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 129] FAILOVER command does not update
	sl_subscriber
In-Reply-To: <bug-129-4@http.www.slony.info/bugzilla/>
References: <bug-129-4@http.www.slony.info/bugzilla/>
Message-ID: <20100604165207.66E5D290CDF@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=129

--- Comment #4 from Steve Singer <ssinger at ca.afilias.info> 2010-06-04 09:52:07 PDT ---
The previous comment should have read:



There is a second problem in the scenario described above.

Node 3 has two subscribers (4 and 5) for the set.
Since it has more than one direct subscriber failedNode() doesn't switch the
subscriptions but expects slonik to do it.

Slonik in slonik_failed_node() determines num_sets by this query
 select S.set_id, count(S.set)id)
    from sl_set S,  sl_subscribe SUB 
   where S.set_id = SUB.sub_set "
                     and S.set_origin = 3
                     and SUB.sub_provider =3
                     and SUB.sub_active "
                     group by set_id

The problem is that node 3 is NOT the origin for set 1 it is just a forwarding
provider so the query comes back with nothing.   This means that later on in
the function we don't loop over any replication sets (so we never call
subscribeSet(...) or failedNode2(...)

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Jun  7 01:43:39 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  7 Jun 2010 01:43:39 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 134] New: TRUNCATE support
Message-ID: <bug-134-4@http.www.slony.info/bugzilla/>

http://www.slony.info/bugzilla/show_bug.cgi?id=134

           Summary: TRUNCATE support
           Product: Slony-I
           Version: devel
          Platform: PC
        OS/Version: Linux
            Status: NEW
          Severity: enhancement
          Priority: low
         Component: stored procedures
        AssignedTo: slony1-bugs at lists.slony.info
        ReportedBy: peter_e at gmx.net
                CC: slony1-bugs at lists.slony.info
   Estimated Hours: 0.0


Wishlist: Add support for TRUNCATE.  Either add a trigger that prevents
TRUNCATE on the master, or propagate the TRUNCATE event to the slaves.

Right now, TRUNCATE is a loose foot-gun on a Slony setup.  See
http://shoaibmir.wordpress.com/2010/06/03/truncate-problems-with-slony/ for
example.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Jun  7 08:35:43 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  7 Jun 2010 08:35:43 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 134] TRUNCATE support
In-Reply-To: <bug-134-4@http.www.slony.info/bugzilla/>
References: <bug-134-4@http.www.slony.info/bugzilla/>
Message-ID: <20100607153543.7783629014A@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=134

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
             Status|NEW                         |ASSIGNED

--- Comment #1 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-06-07 08:35:43 PDT ---
Yep, I had a chat with various people about this at PGCon, and had some
resolutions of outstanding questions.

The trouble with TRUNCATE comes when there are foreign key relationships.  In
the case of circularity, one might find it necessary to submit:

  TRUNCATE a, b, c;

in order to get all three tables emptied.

Supposing that request is submitted, we'd find, logged, 3 TRUNCATE requests
that were captured by ON TRUNCATE triggers.  (I'm assuming here that all 3
tables were replicated.)

I see 4 strategies for implementing the handling of TRUNCATE:

1.  Deny

Basically, we put the same stored function used for "deny_access" onto the ON
TRUNCATE action.

This isn't ideal, but is better than what we have now.

2.  Log truncate, action on subscriber is "TRUNCATE ONLY"

This won't work out in the "TRUNCATE a,b,c;" scenario described earlier, as the
FK is liable to cause each of these truncate requests to fail.

3.  Log truncate...  Try to form sets of successive TRUNCATEs into one request.

This adds substantially to complexity, and there's the question of when to do
the set of truncates:

  a) At the earliest point in the stream, or
  b) At the latest point in the stream.

More thought necessary to see which order is expected to be "compatible."

[Thinking a bit more...  This might well work...  The transaction claims an
exclusive lock on all the tables, so it ought to be possible to, upon seeing a
TRUNCATE, look for all the adjacent TRUNCATE requests in that same transaction.
 The only trouble is how to not bother reprocessing the subsequent TRUNCATE
requests.]

There is still some risk of failure on the subscriber; supposing there are
differences in FK relations there, there is the possibility of everything
rolling back, and replication becoming blocked at this point.

4.  Log the truncates, and, for each one, submit
   TRUNCATE foo CASCADE;

This has merits over all the others:

- It performs TRUNCATE (unlike 1!)
- Guaranteed to work (unlike 2)
- Much simpler than #3
- No risk of getting stuck because of a FK relationship

There's a big scary demerit:

- It'll blindly truncate everything tied to the table being truncated.

I had a chat about this with Rod Taylor and Greg Sabino Mullane at the EDB
dinner; Rod suggested that #4 was the way to go, and I made sure Greg was aware
of the challenge here.

Peter, your thoughts would definitely be valued.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Jun  7 11:41:14 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  7 Jun 2010 11:41:14 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 134] TRUNCATE support
In-Reply-To: <bug-134-4@http.www.slony.info/bugzilla/>
References: <bug-134-4@http.www.slony.info/bugzilla/>
Message-ID: <20100607184114.C3C89290CCA@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=134

--- Comment #2 from Peter Eisentraut <peter_e at gmx.net> 2010-06-07 11:41:14 PDT ---
My immediate interest in this comes more from the point of closing possible
breakage vectors, so prohibiting TRUNCATE on the master would be good for me.

I don't have a qualified opinion at the moment on how to implement replicating
the TRUNCATE event.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Jun  7 11:48:05 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  7 Jun 2010 11:48:05 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 134] TRUNCATE support
In-Reply-To: <bug-134-4@http.www.slony.info/bugzilla/>
References: <bug-134-4@http.www.slony.info/bugzilla/>
Message-ID: <20100607184805.BC5E12903FD@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=134

--- Comment #3 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-06-07 11:48:05 PDT ---
(In reply to comment #2)
> My immediate interest in this comes more from the point of closing possible
> breakage vectors, so prohibiting TRUNCATE on the master would be good for me.

Actually, we'd want to prohibit TRUNCATE on all nodes, in that case.

It's not so much of an improvement if you can still easily blow up subscribers! 
:-(

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Jun  9 12:53:34 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  9 Jun 2010 12:53:34 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 129] FAILOVER command does not update
	sl_subscriber
In-Reply-To: <bug-129-4@http.www.slony.info/bugzilla/>
References: <bug-129-4@http.www.slony.info/bugzilla/>
Message-ID: <20100609195334.90775290C84@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=129

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
            Version|2.0                         |devel

--- Comment #5 from Steve Singer <ssinger at ca.afilias.info> 2010-06-09 12:53:34 PDT ---
The issues addressed here needs the following:

1) If the failover target id is NOT a set origin (but just a provider) then the
failover command should be rejected on an error

2) As part of a failover we want to mark the failed node as being inactive in
sl_node and make it so that WAIT FOR  confirmed=all don't wait on this failed
nodes to confirm things.

3) slonik needs to remember the sequence number returned by failedNode2 so that
it is possible to WAIT FOR that event on the backup node to ensure it is
confirmed by all.    Exactly how a slonik script can wait still needs to be
figured out.   This won't be done until 2.1

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Jun  9 13:39:39 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  9 Jun 2010 13:39:39 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 111] node -1 not found in runtime configuration
In-Reply-To: <bug-111-4@http.www.slony.info/bugzilla/>
References: <bug-111-4@http.www.slony.info/bugzilla/>
Message-ID: <20100609203939.50FA2290CD3@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=111

Jan Wieck <janwieck at yahoo.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
            Version|1.2                         |devel

--- Comment #2 from Jan Wieck <janwieck at yahoo.com> 2010-06-09 13:39:39 PDT ---
Changed version to devel because actually fixing this requires features.

UNSUBSCRIBE SET should continue to be issued against the subscriber. If the
event would originate from the set origin, the subscriber must crawl through
all the backlog to finally unsubscribe. That is a waste.

The processing of ENABLE_EVENT should on node -1 error simply confirm the
event, assuming that the subscription was canceled via UNSUBSCRIBE.

Upon receiving an UNSUBSCRIBE_SET event, the origin of that set will issue yet
another UNSUBSCRIBE_SET in order to guard against a possible race condition
where a third node, that is a forwarder for the set, receives the initial
UNSUBSCRIBE_SET before processing the initial SUBSCRIBE_SET. This would cause
it to wrongfully think that the node is actually subscribed to the set.


Jan

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Jun  9 13:40:01 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  9 Jun 2010 13:40:01 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 111] node -1 not found in runtime configuration
In-Reply-To: <bug-111-4@http.www.slony.info/bugzilla/>
References: <bug-111-4@http.www.slony.info/bugzilla/>
Message-ID: <20100609204001.37486290CD6@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=111

Jan Wieck <janwieck at yahoo.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
           Priority|urgent                      |medium
           Severity|critical                    |normal

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Thu Jun 10 09:09:32 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 10 Jun 2010 09:09:32 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 52] Slon periodically leaks memory
In-Reply-To: <bug-52-4@http.www.slony.info/bugzilla/>
References: <bug-52-4@http.www.slony.info/bugzilla/>
Message-ID: <20100610160932.5E42D290CD8@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=52

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|REOPENED                    |RESOLVED

--- Comment #8 from Steve Singer <ssinger at ca.afilias.info> 2010-06-10 09:09:32 PDT ---
Some more memory leak fixes have been committed to 2.0.4 and 1.2 after .21
(1.2.22 has not yet been tagged/released).  

Please retest with the memory leak fixes Ulrich Weber sent in.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Thu Jun 10 09:59:36 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 10 Jun 2010 09:59:36 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 58] launch_clusters.sh in 1.2.15 reports an
	error in bash
In-Reply-To: <bug-58-4@http.www.slony.info/bugzilla/>
References: <bug-58-4@http.www.slony.info/bugzilla/>
Message-ID: <20100610165936.D4C6B290CD8@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=58

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|NEW                         |RESOLVED

--- Comment #1 from Steve Singer <ssinger at ca.afilias.info> 2010-06-10 09:59:36 PDT ---
I think this fix was checked in on Jul 7 2008 by Chris.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Thu Jun 10 10:21:25 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 10 Jun 2010 10:21:25 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 12] Add tests to test_slony_state scripts
In-Reply-To: <bug-12-4@http.www.slony.info/bugzilla/>
References: <bug-12-4@http.www.slony.info/bugzilla/>
Message-ID: <20100610172126.00688290CE2@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=12

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |INVALID
             Status|NEW                         |RESOLVED

--- Comment #1 from Steve Singer <ssinger at ca.afilias.info> 2010-06-10 10:21:26 PDT ---
I am closing this since in 2.0 TABLE ADD KEY has gone so adding this type of
check becomes irrelevent.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Thu Jun 10 10:26:10 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 10 Jun 2010 10:26:10 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 92] Events and Confirmations are not propagating
In-Reply-To: <bug-92-4@http.www.slony.info/bugzilla/>
References: <bug-92-4@http.www.slony.info/bugzilla/>
Message-ID: <20100610172610.4ABA5290CE2@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=92

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
           See Also|                            |http://bugs.slony.info/bugz
                   |                            |illa/show_bug.cgi?id=127

--- Comment #2 from Steve Singer <ssinger at ca.afilias.info> 2010-06-10 10:26:10 PDT ---
I think this is the same issue as discussed in bug 127

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Thu Jun 10 12:12:45 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 10 Jun 2010 12:12:45 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 129] FAILOVER command does not update
	sl_subscriber
In-Reply-To: <bug-129-4@http.www.slony.info/bugzilla/>
References: <bug-129-4@http.www.slony.info/bugzilla/>
Message-ID: <20100610191245.2B108290C84@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=129

--- Comment #6 from Steve Singer <ssinger at ca.afilias.info> 2010-06-10 12:12:45 PDT ---
It is also worth noting that if you do the failover to node 3,

then do a DROP NODE (id=1, event_node=3) the DROP NODE will delete the
'FAILOVER_SET' event from the sl_event on node 3 since it has node 1 as the
simulated origin.   This might mean that node 4 will get the subsequenet
ACCEPT_SET but not the FAILOVER_SET.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Jun 15 15:25:07 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 15 Jun 2010 15:25:07 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 130] failover does not seem to update sl_set
In-Reply-To: <bug-130-4@http.www.slony.info/bugzilla/>
References: <bug-130-4@http.www.slony.info/bugzilla/>
Message-ID: <20100615222507.B5C99290D17@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=130

--- Comment #1 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-06-15 15:25:07 PDT ---
(In reply to comment #0)
> Observed with 2.0.3
> 
> In a cluster as follows
> 
> 1
> \\
>  \\
>   3===4
>   \\
>    \\
>      5
> 
> 
>  A failover of set 1=>3 seems to work.
> 
> However DROP NODE (id=1) fails with 
> 
> <stdin>:12: PGRES_FATAL_ERROR select "_disorder_replica".dropNode(1);  - ERROR:
>  Slony-I: Node 1 is still origin of one or more sets
> 
> When I query sl_set it shows that node 1 is still the origin of the set even
> though the failover command seemed to work okay.

Where did you run these commands?

If you did so against node 1, then I'd fully expect this behaviour.  Node #1
doesn't really know that it's "shunned."  It certainly doesn't if the disks
were ground into a powder (in which case your queries would fail because
there's no database there anymore!).

But if node 1 failed due to a network partition, it can't expect to ever be
aware that it's shunned.

If the requests were hitting ex-node #1, then I don't think these results are
necessarily wrong.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Jun 15 15:27:04 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 15 Jun 2010 15:27:04 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 133] DROP set in the middle of a subscribe to
 the same set confuses slon
In-Reply-To: <bug-133-4@http.www.slony.info/bugzilla/>
References: <bug-133-4@http.www.slony.info/bugzilla/>
Message-ID: <20100615222704.A3E1E290CF9@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=133

--- Comment #1 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-06-15 15:27:04 PDT ---
(In reply to comment #0)
Yep, there should be something here to behave less badly.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Jun 18 09:26:13 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 18 Jun 2010 09:26:13 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 14] Pull lexer from psql
In-Reply-To: <bug-14-4@http.www.slony.info/bugzilla/>
References: <bug-14-4@http.www.slony.info/bugzilla/>
Message-ID: <20100618162613.E5EA8290D16@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=14

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
           Priority|medium                      |low

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Jun 18 09:26:31 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 18 Jun 2010 09:26:31 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 17] slony doesn't build with a 'virtual'
 postgresql installation done with DESTDIR
In-Reply-To: <bug-17-4@http.www.slony.info/bugzilla/>
References: <bug-17-4@http.www.slony.info/bugzilla/>
Message-ID: <20100618162631.8084E290D1C@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=17

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
           Priority|medium                      |low

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Fri Jun 18 09:27:18 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 18 Jun 2010 09:27:18 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 18] Patch to shorten "attkind" on logtrigger
	functions
In-Reply-To: <bug-18-4@http.www.slony.info/bugzilla/>
References: <bug-18-4@http.www.slony.info/bugzilla/>
Message-ID: <20100618162718.544D5290D18@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=18

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
           Priority|low                         |high

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Fri Jun 18 09:27:46 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 18 Jun 2010 09:27:46 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 40] libpq thread test insufficient
In-Reply-To: <bug-40-4@http.www.slony.info/bugzilla/>
References: <bug-40-4@http.www.slony.info/bugzilla/>
Message-ID: <20100618162746.DFB51290D18@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=40

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
           Priority|medium                      |high

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Fri Jun 18 09:28:26 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 18 Jun 2010 09:28:26 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 41] Links to stored procedures prefixed with
 'schemadoc' everywhere
In-Reply-To: <bug-41-4@http.www.slony.info/bugzilla/>
References: <bug-41-4@http.www.slony.info/bugzilla/>
Message-ID: <20100618162826.326B7290D18@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=41

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
           Priority|medium                      |low

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Jun 18 09:29:28 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 18 Jun 2010 09:29:28 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 43] get_set() is used inconsistently in altperl
	tools
In-Reply-To: <bug-43-4@http.www.slony.info/bugzilla/>
References: <bug-43-4@http.www.slony.info/bugzilla/>
Message-ID: <20100618162928.E20C4290D1C@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=43

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
           Priority|medium                      |high

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Jun 18 09:31:53 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 18 Jun 2010 09:31:53 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 47] EXECUTE SCRIPT runs on ALL nodes
In-Reply-To: <bug-47-4@http.www.slony.info/bugzilla/>
References: <bug-47-4@http.www.slony.info/bugzilla/>
Message-ID: <20100618163153.73190290D18@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=47

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |WORKSFORME
             Status|NEW                         |RESOLVED

--- Comment #5 from Steve Singer <ssinger at ca.afilias.info> 2010-06-18 09:31:53 PDT ---
We can't replicate this and the original reporter hasn't provided additional
details in years.
Closing

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Jun 18 09:34:53 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 18 Jun 2010 09:34:53 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 62] Initial subscription blocks with "sequence
 ID <xxx> has already been assigned"
In-Reply-To: <bug-62-4@http.www.slony.info/bugzilla/>
References: <bug-62-4@http.www.slony.info/bugzilla/>
Message-ID: <20100618163453.68230290D24@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=62

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
           Priority|medium                      |high

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Jun 18 09:35:47 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 18 Jun 2010 09:35:47 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 67] Array overrun in logtrigger()
In-Reply-To: <bug-67-4@http.www.slony.info/bugzilla/>
References: <bug-67-4@http.www.slony.info/bugzilla/>
Message-ID: <20100618163547.C2528290D24@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=67

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
           Priority|medium                      |high

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Jun 18 09:44:42 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 18 Jun 2010 09:44:42 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 75] Bugs: (1) Initialize forgotten
 cs->plan_active_log. (2) Session_replication_role and "SET datestyle TO
 'ISO'" in slonik at connection start.
In-Reply-To: <bug-75-4@http.www.slony.info/bugzilla/>
References: <bug-75-4@http.www.slony.info/bugzilla/>
Message-ID: <20100618164442.9B4CF290D15@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=75

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
           Priority|medium                      |high

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Jun 18 09:45:12 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 18 Jun 2010 09:45:12 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 75] Bugs: (1) Initialize forgotten
 cs->plan_active_log. (2) Session_replication_role and "SET datestyle TO
 'ISO'" in slonik at connection start.
In-Reply-To: <bug-75-4@http.www.slony.info/bugzilla/>
References: <bug-75-4@http.www.slony.info/bugzilla/>
Message-ID: <20100618164512.4DAB2290D24@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=75

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
           Severity|critical                    |normal

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Jun 18 09:46:06 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 18 Jun 2010 09:46:06 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 79] --prefix and --exec-prefix options don't
 function as expected
In-Reply-To: <bug-79-4@http.www.slony.info/bugzilla/>
References: <bug-79-4@http.www.slony.info/bugzilla/>
Message-ID: <20100618164606.F34B7290D1C@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=79

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
           Priority|medium                      |low
           Severity|normal                      |minor

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Jun 18 09:52:59 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 18 Jun 2010 09:52:59 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 80] slon daemon restarts itself in a loop after
	failover()
In-Reply-To: <bug-80-4@http.www.slony.info/bugzilla/>
References: <bug-80-4@http.www.slony.info/bugzilla/>
Message-ID: <20100618165259.9F15A290D15@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=80

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
           Priority|medium                      |high
            Version|1.2                         |devel

--- Comment #2 from Steve Singer <ssinger at ca.afilias.info> 2010-06-18 09:52:59 PDT ---
This issue is also referenced in bug 129.
There has been some discussion about making FAILOVER mark nodes as disabled so
they don't get included in the set of nodes wait for ... confimred=all uses. 
(that on its own won't fix the issue)

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Jun 18 10:22:23 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 18 Jun 2010 10:22:23 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 81] duplicate key sl_nodelock-pkey and duplicate
 slon(8) processes not detected
In-Reply-To: <bug-81-4@http.www.slony.info/bugzilla/>
References: <bug-81-4@http.www.slony.info/bugzilla/>
Message-ID: <20100618172223.D7355290D2C@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=81

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
           Priority|high                        |medium

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Jun 18 10:31:22 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 18 Jun 2010 10:31:22 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 99] unable to set datestyle
In-Reply-To: <bug-99-4@http.www.slony.info/bugzilla/>
References: <bug-99-4@http.www.slony.info/bugzilla/>
Message-ID: <20100618173122.E96BE290D0E@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=99

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
           Priority|urgent                      |low

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Jun 18 10:31:54 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 18 Jun 2010 10:31:54 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 104] slon core in sched_add_fdset
In-Reply-To: <bug-104-4@http.www.slony.info/bugzilla/>
References: <bug-104-4@http.www.slony.info/bugzilla/>
Message-ID: <20100618173154.7B999290D2C@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=104

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
           Priority|medium                      |high

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Fri Jun 18 10:33:18 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 18 Jun 2010 10:33:18 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 118] initial copy of an inherited table can
 leave the table empty
In-Reply-To: <bug-118-4@http.www.slony.info/bugzilla/>
References: <bug-118-4@http.www.slony.info/bugzilla/>
Message-ID: <20100618173318.87F73290D1C@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=118

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
           Priority|low                         |high

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Jun 18 10:34:19 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 18 Jun 2010 10:34:19 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 120] store path - after slon has started does
	not take effect
In-Reply-To: <bug-120-4@http.www.slony.info/bugzilla/>
References: <bug-120-4@http.www.slony.info/bugzilla/>
Message-ID: <20100618173419.A79D4290D2C@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=120

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
           Priority|low                         |high

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Jun 18 10:35:05 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 18 Jun 2010 10:35:05 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 123] Adding a node shortly after deleting it
 causes 'node -1 not found'
In-Reply-To: <bug-123-4@http.www.slony.info/bugzilla/>
References: <bug-123-4@http.www.slony.info/bugzilla/>
Message-ID: <20100618173505.59B92290D2C@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=123

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
           Priority|low                         |medium

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Jun 18 10:36:24 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 18 Jun 2010 10:36:24 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 124] EXECUTE SCRIPT,
	ONLY ON != EVENT NODE is wrong
In-Reply-To: <bug-124-4@http.www.slony.info/bugzilla/>
References: <bug-124-4@http.www.slony.info/bugzilla/>
Message-ID: <20100618173624.103AE290D2C@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=124

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
           Priority|low                         |medium

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Jun 18 10:37:42 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 18 Jun 2010 10:37:42 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 126] slon sometimes does not recover from a
	network outage
In-Reply-To: <bug-126-4@http.www.slony.info/bugzilla/>
References: <bug-126-4@http.www.slony.info/bugzilla/>
Message-ID: <20100618173742.D8618290D2C@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=126

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
           Priority|low                         |medium

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Jun 18 10:38:37 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 18 Jun 2010 10:38:37 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 127] sync events are not generated on nodes that
 are not a set origin
In-Reply-To: <bug-127-4@http.www.slony.info/bugzilla/>
References: <bug-127-4@http.www.slony.info/bugzilla/>
Message-ID: <20100618173837.74491290D2C@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=127

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
           Priority|low                         |high

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Jun 18 10:39:18 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 18 Jun 2010 10:39:18 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 128] DROP TABLE replicatedTable leaves the
 cluster in a bad state
In-Reply-To: <bug-128-4@http.www.slony.info/bugzilla/>
References: <bug-128-4@http.www.slony.info/bugzilla/>
Message-ID: <20100618173918.CC303290D1C@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=128

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
           Priority|low                         |medium

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Jun 21 10:14:40 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 21 Jun 2010 10:14:40 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 135] New: slon can get stuck waiting for a
 sl_config_lock it already has
Message-ID: <bug-135-4@http.www.slony.info/bugzilla/>

http://www.slony.info/bugzilla/show_bug.cgi?id=135

           Summary: slon can get stuck waiting for a sl_config_lock it
                    already has
           Product: Slony-I
           Version: 2.0
          Platform: All
        OS/Version: All
            Status: NEW
          Severity: major
          Priority: low
         Component: slon
        AssignedTo: slony1-bugs at lists.slony.info
        ReportedBy: ssinger at ca.afilias.info
                CC: slony1-bugs at lists.slony.info
   Estimated Hours: 0.0


I am not exactly sure what is going on here but this is what I have observed.

As part of a test (FailNodeTest.js) a subscription process seemed to have hung.

select pid,relname, mode, granted from pg_locks l, pg_class c where
l.relation=c.oid;
  pid  |          relname           |        mode         | granted 
-------+----------------------------+---------------------+---------
 13197 | sl_config_lock             | AccessExclusiveLock | t
 13378 | pg_class                   | AccessShareLock     | t
 13206 | sl_config_lock             | AccessExclusiveLock | f
 13378 | pg_class_relname_nsp_index | AccessShareLock     | t
 13378 | pg_locks                   | AccessShareLock     | t
 13378 | pg_class_oid_index         | AccessShareLock     | t


Note pid 13197 has the lock.  pid 13206 is waiting for the lock

ps aux |grep 13197
9994     13197  0.0  0.3  62020 10232 ?        Ss   12:45   0:00 postgres:
slony test4 ::1(50428) idle in transaction
9994     13384  0.0  0.0   7336   880 pts/0    R+   12:55   0:00 grep 13197


ssinger.local at ssinger:~/src/clustertest/clustertest$ lsof |grep 50428
slon      13137 ssinger.local    6u     IPv6            4391222      0t0       
TCP localhost:50428->localhost:postgresql (ESTABLISHED)
postgres  13197 ssinger.local    7u     IPv6            4391254      0t0       
TCP localhost:postgresql->localhost:50428 (ESTABLISHED)


So process 13137 which is the slon has the lock


but,

ps aux |grep 13206
9994     13206  0.0  0.2  60740  8192 ?        Ss   12:45   0:00 postgres:
slony test4 ::1(50432) LOCK TABLE waiting
9994     13399  0.0  0.0   7340   900 pts/0    S+   12:56   0:00 grep 13206
ssinger.local at ssinger:~/src/clustertest/clustertest$ lsof |grep 50432
slon      13137 ssinger.local   10u     IPv6            4391239      0t0       
TCP localhost:50432->localhost:postgresql (ESTABLISHED)
postgres  13206 ssinger.local    7u     IPv6            4391278      0t0       
TCP localhost:postgresql->localhost:50432 (ESTABLISHED)
ssinger.local at ssinger:~/src/clustertest/clustertest$ ps aux |grep 13137
9994     13137  0.0  0.0 160664  1448 pts/0    Sl   12:45   0:00
/usr/local/pgsql_cvs/bin/slon disorder_replica -d4 dbname=test4 host=localhost
user=slony password=slony

This shows process process 13137 is also connected to a second backend that is
waiting for the sl_config_lock.

In the logs I observe 

2010-06-21 12:46:16,425 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-21
12:46:16 EDTDEBUG2 remoteWorkerThread_3: Received event #3 from 5000000007
type:SUBSCRIBE_SET
2010-06-21 12:46:16,425 [db4 stdout] DEBUG
info.slony.clustertest.testcoordinator.slony.SlonLauncher db4 - 2010-06-21
12:46:16 EDTWARN   remoteWorkerThread_1: copy set: data provider 3 only on sync
5000000036 - sleep 5 seconds



that log message on remoteWorkerThread_1 keeps repeating.


I wonder if we are 'sleeping' while holding a lock that prevents the sync from
getting processed.


The cluster configuration is

1===>3====>4

where a path ALSO exists between nodes 1 and 4.  (There is also a node 5
receiving from 3, and 2 receiving from 1).

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Jun 22 17:03:27 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 22 Jun 2010 17:03:27 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 136] New: listen paths not being rebuilt
	correctly
Message-ID: <bug-136-4@http.www.slony.info/bugzilla/>

http://www.slony.info/bugzilla/show_bug.cgi?id=136

           Summary: listen paths not being rebuilt correctly
           Product: Slony-I
           Version: 2.0
          Platform: PC
        OS/Version: Linux
            Status: NEW
          Severity: enhancement
          Priority: low
         Component: slon
        AssignedTo: slony1-bugs at lists.slony.info
        ReportedBy: ssinger at ca.afilias.info
                CC: slony1-bugs at lists.slony.info
   Estimated Hours: 0.0


I have a database (node 4) in my cluster that contains the following in
sl_listen, sl_set and sl_subscribe



test4=# select * FROM _disorder_replica.sl_set;
 set_id | set_origin | set_locked |                         set_comment         
--------+------------+------------+--------------------------------------------------------------
      1 |          1 |            | A replication set so boring no one thought
to give it a name
(1 row)

test4=# select * FROM _disorder_replica.sl_subscribe ;
 sub_set | sub_provider | sub_receiver | sub_forward | sub_active 
---------+--------------+--------------+-------------+------------
       1 |            1 |            2 | t           | t
       1 |            2 |            5 | t           | t
       1 |            2 |            4 | t           | t
(3 rows)

 select * FROM _disorder_replica.sl_listen where li_origin=1;
 li_origin | li_provider | li_receiver 
-----------+-------------+-------------
         1 |           1 |           2
         1 |           2 |           5
         1 |           2 |           4
(3 rows)

The remote listener_1 on node 4 are: 
 remoteListenThread_1: select ev_origin, ev_seqno, ev_timestamp,       
ev_snapshot,        "pg_catalog".txid_snapshot_xmin(ev_snapshot),       
"pg_catalog".txid_snapshot_xmax(ev_snapshot),        ev_type,        ev_data1,
ev_data2,        ev_data3, ev_data4,        ev_data5, ev_data6,       
ev_data7, ev_data8 from "_disorder_replica".sl_event e where (e.ev_origin = '5'
and e.ev_seqno > '5000000012') or (e.ev_origin = '2' and e.ev_seqno >
'5000000020') order by e.ev_origin, e.ev_seqno limit 40


The slon for node 4 is not receiving events from node 1 that have originated at
one 1.   To get in this situation my cluster is in the state:

1===>2====>4
     \\
      5
I then issue a subscribe set so node 4 and 5 will receive data directly from
node 1.

The slon for node 4 receives the 'subscribe' event via node 2 and then stops
listening on events from node 1.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Jun 22 17:04:22 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 22 Jun 2010 17:04:22 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 136] listen paths not being rebuilt correctly
In-Reply-To: <bug-136-4@http.www.slony.info/bugzilla/>
References: <bug-136-4@http.www.slony.info/bugzilla/>
Message-ID: <20100623000422.60C96290CF3@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=136

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
           Priority|low                         |high
           Severity|enhancement                 |normal

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Jun 23 06:34:50 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 23 Jun 2010 06:34:50 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 136] listen paths not being rebuilt correctly
In-Reply-To: <bug-136-4@http.www.slony.info/bugzilla/>
References: <bug-136-4@http.www.slony.info/bugzilla/>
Message-ID: <20100623133450.E5E78290CEF@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=136

--- Comment #1 from Steve Singer <ssinger at ca.afilias.info> 2010-06-23 06:34:50 PDT ---

-- 2nd choice:
-- If we are subscribed to any set originating on this
-- event origin, we want to listen on all data providers
-- we use for this origin. We are a cascaded subscriber
-- for sets from this node.

Seems to indicate that the intention was to not listen on events from node 1
but always get them from node 2.  The issue is that if node 2 goes away (ie
dies)

If node 2 is no longer accessible then the events originating from node 1 need
to come from somewhere.

We could have node 4 add the sl_listen entry for node 1.  The problem then
becomes that node 4 might receive a SYNC event directly from node 1 before it
receives that sync event via node 2 (in normal circumstances), processing those
SYNC events mean that we'd be receiving the data direct from the origin and not
through node 2, this defeats the purpose of it being cascaded.

If we continue to ignore those syncs with the message "data provider 2 only
confirmed up to ev_seqno 5000000150 for ev_origin 1" then node 4 will never get
caught up enough to process the SUBSCRIBE message.

What I think we need to do is continue to NOT listen on the origin.   If node 2
goes away we need to issue a FAILOVER type of command that will tell node 4
that it's provider is no longer node 2 but it is now node 1.  The normal
SUBSCRIBE command doesn't work because the SUBSCRIBE command travels from the
origin (node 1) to node 4 via node 2 in queue order but it won't get processed. 

At first glance we can 

1) Have a command that gets slonik tell node 4 directly to reconfigure its
provider for set 1.   
2) Have an event originate on the new provider that is faked to look like the
next event so it will get processed.  I think this is a bad idea because even
though we are 'failing' node 2 it is possible that node 4 is still processing
events from node 2 so I don't see how your going to safely find the next event
id and also ensure that the 'real' event with that id doesn't get processed in
the meantime.

I am thinking that slonik should have logic where:   If this is a subscribe
set, and the receiver is already subscribed to the set via a different provider
then it contacts the receiver directly and reconfigures it

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Jun 23 06:47:11 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 23 Jun 2010 06:47:11 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 130] failover does not seem to update sl_set
In-Reply-To: <bug-130-4@http.www.slony.info/bugzilla/>
References: <bug-130-4@http.www.slony.info/bugzilla/>
Message-ID: <20100623134711.B6555290D0F@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=130

--- Comment #2 from Steve Singer <ssinger at ca.afilias.info> 2010-06-23 06:47:11 PDT ---
According to the documentation DROP NODE shouldn't work with an EVENT_NODE=1
(the node being dropped) so I don't think that was the case.

I think what was happening is that FAILOVER returns right away but the failover
processing doesn't complete until later (the other subscribers have to process
an ACCEPT_SET).  No WAIT FOR commands where being issued after the FAILOVER.

See the comments on bug #129. relevant portion duplicated below

----------------
2) As part of a failover we want to mark the failed node as being inactive in
sl_node and make it so that WAIT FOR  confirmed=all don't wait on this failed
nodes to confirm things.

3) slonik needs to remember the sequence number returned by failedNode2 so that
it is possible to WAIT FOR that event on the backup node to ensure it is
confirmed by all.    Exactly how a slonik script can wait still needs to be
figured out.   This won't be done until 2.1
------------------------

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Jun 23 06:47:20 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 23 Jun 2010 06:47:20 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 130] failover does not seem to update sl_set
In-Reply-To: <bug-130-4@http.www.slony.info/bugzilla/>
References: <bug-130-4@http.www.slony.info/bugzilla/>
Message-ID: <20100623134720.91CA8290353@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=130

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
           Priority|low                         |medium

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Jun 23 06:47:38 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 23 Jun 2010 06:47:38 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 130] failover does not seem to update sl_set
In-Reply-To: <bug-130-4@http.www.slony.info/bugzilla/>
References: <bug-130-4@http.www.slony.info/bugzilla/>
Message-ID: <20100623134738.43776290353@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=130

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
           See Also|                            |http://bugs.slony.info/bugz
                   |                            |illa/show_bug.cgi?id=129

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Jun 23 06:51:57 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 23 Jun 2010 06:51:57 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 129] FAILOVER command does not update
	sl_subscriber
In-Reply-To: <bug-129-4@http.www.slony.info/bugzilla/>
References: <bug-129-4@http.www.slony.info/bugzilla/>
Message-ID: <20100623135157.3359B290353@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=129

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
           See Also|                            |http://bugs.slony.info/bugz
                   |                            |illa/show_bug.cgi?id=130
         Resolution|                            |DUPLICATE
             Status|NEW                         |RESOLVED

--- Comment #7 from Steve Singer <ssinger at ca.afilias.info> 2010-06-23 06:51:57 PDT ---
I am marking this bug as a duplicate.  The two issues raised below are better
described by bugs 130 and 136.

130: should address the case of sl_subscriber not showing the new information
when the FAILOVER finishes failing node 1==>3, we need waits

136: Deals with the case of  3===>1 where 3 is just a provider/forwarder, we
don't want to use the FAILOVER command in this case, we just want the SUBSCRIBE
to always work.

*** This bug has been marked as a duplicate of bug 136 ***

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Jun 23 06:51:57 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 23 Jun 2010 06:51:57 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 136] listen paths not being rebuilt correctly
In-Reply-To: <bug-136-4@http.www.slony.info/bugzilla/>
References: <bug-136-4@http.www.slony.info/bugzilla/>
Message-ID: <20100623135157.6CEE8290D0F@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=136

--- Comment #2 from Steve Singer <ssinger at ca.afilias.info> 2010-06-23 06:51:57 PDT ---
*** Bug 129 has been marked as a duplicate of this bug. ***

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Jun 23 12:23:36 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 23 Jun 2010 12:23:36 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 56] store trigger runs against all nodes upon
	subscription
In-Reply-To: <bug-56-4@http.www.slony.info/bugzilla/>
References: <bug-56-4@http.www.slony.info/bugzilla/>
Message-ID: <20100623192336.AB3B7290CEC@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=56

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #3 from Steve Singer <ssinger at ca.afilias.info> 2010-06-23 12:23:36 PDT ---
This patch seems to have already been applied

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From harukat at sraoss.co.jp  Wed Jun 23 22:26:34 2010
From: harukat at sraoss.co.jp (TAKATSUKA Haruka)
Date: Thu, 24 Jun 2010 14:26:34 +0900
Subject: [Slony1-bugs] delete "logswitch_weekly()" from Slony-I 2.0.x
	document
Message-ID: <20100624142634.75a57fd8.harukat@sraoss.co.jp>

Hi.

I report a document-bug.

We should delete "logswitch_weekly()" and relational descriptions
from the Slony-I 2.0.x document. (or add "1.2.x only")
There is not implementation.

slony1-engine/src/slon/README:42
slony1-engine/doc/adminguide/schemadoc.xml:6470

______________________________________________________________________
 TAKATSUKA Haruka  harukat at sraoss.co.jp


From bugzilla-daemon at main.slony.info  Thu Jun 24 10:48:39 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 24 Jun 2010 10:48:39 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 137] New: excute script does not get applied in
 the correct order
Message-ID: <bug-137-4@http.www.slony.info/bugzilla/>

http://www.slony.info/bugzilla/show_bug.cgi?id=137

           Summary: excute script does not get applied in the correct
                    order
           Product: Slony-I
           Version: 2.0
          Platform: All
        OS/Version: All
            Status: NEW
          Severity: major
          Priority: low
         Component: stored procedures
        AssignedTo: slony1-bugs at lists.slony.info
        ReportedBy: ssinger at ca.afilias.info
                CC: slony1-bugs at lists.slony.info
   Estimated Hours: 0.0


This issue was found while running the javascript version of the
testdeadlockddl test.

We have a table table4 with columns id1,id2.

We insert into the table as follows

INSERT INTO table4 VALUES ('......')

Some DDL via EXECUTE SCRIPT is executed to rename id1=>col1 and id2=>col2.

The test as run when the problem occured did the following
1. Launch a large file of INSERTS via psql. Don't wait for it to finish, the
individual inserts appear to be running in autocommit mode
2. execute the DDL via EXECUTE SCRIPT. Wait for slonik to finish
3. Launch more transactions

After the DDL_SCRIPT event is processed on the slave we start to get
replication failures slon is trying to apply INSERTS with id1,id2 but the
columns on the slave have already been switched.

The relevant part of sl_event is

    1 | 5000000022 | SYNC                |
144375:144525:144375,144383,144393,144407,144412,144423,144476,144485
    1 | 5000000023 | DDL_SCRIPT          | 144522:144538:144529
    1 | 5000000024 | SYNC                |
144375:144529:144375,144383,144393,144407,144412,144423,144476,144485,144522


in sl_log_1 the inserts on table4 switch from referencing id1,id2 to col1,col2
at log_txid=144526(references id1,id2)  log_txid=144583 (references col1,col2)

Notice that sync 24 includes logtx_id numbers below 144538

What I THINK is happening is


T1: transaction starts - via slonik EXECUTE SCRIPT
T1: ddlScriptPrepare  creates a SYNC event in sl_event event #10
T2: transaction starts - some sql session
T2: INSERT into a table 'foo'
T2: COMMITS  - this works so far T1 has had no reason to obtain any locks on
T1.
T1:  executes the DDL script, this script ALTERS the table 'foo' and renames a
column.  This obtains the requisite locks on 'foo'.  T2 has long since
committed and released its locks
T1: Inserts the DDL_SCRIPT event into sl_event event #11
T3:  A worker thread generates the next normal sync event on the database this
is event #12

The INSERT that T2 did will be picked up by sync #12 since it hadn't yet
committed when sync #10 happened.

On the replica  the DDL script (event number #11) will happen before event #12.
 When it gets to sync #12 the data in sl_log for the insert will reference the
old columns of 'foo' which no longer exist.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Jun 28 08:37:52 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 28 Jun 2010 08:37:52 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 104] slon core in sched_add_fdset
In-Reply-To: <bug-104-4@http.www.slony.info/bugzilla/>
References: <bug-104-4@http.www.slony.info/bugzilla/>
Message-ID: <20100628153752.7945D290D17@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=104

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #3 from Steve Singer <ssinger at ca.afilias.info> 2010-06-28 08:37:52 PDT ---
This fix reworked per Chris's recommendation has been applied.
It is expected to be included with version 2.0.5

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Mon Jun 28 09:18:56 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 28 Jun 2010 09:18:56 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 138] New: groff detection in configure broken
Message-ID: <bug-138-4@http.www.slony.info/bugzilla/>

http://www.slony.info/bugzilla/show_bug.cgi?id=138

           Summary: groff detection in configure broken
           Product: Slony-I
           Version: 2.0
          Platform: PC
        OS/Version: Linux
            Status: NEW
          Severity: major
          Priority: low
         Component: docs
        AssignedTo: slony1-bugs at lists.slony.info
        ReportedBy: peter_e at gmx.net
                CC: slony1-bugs at lists.slony.info
   Estimated Hours: 0.0


In 2.0.4, @GROFF@ in Makefile.global.in is not substituted, because nothing in
configure defines it.  As a consequence, the build of the documentation fails. 
configure contains an unexpanded macro call SLON_AC_PROG_GROFF, which looks
like a botched attempt to do groff detection.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Jun 28 12:09:35 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 28 Jun 2010 12:09:35 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 127] sync events are not generated on nodes that
 are not a set origin
In-Reply-To: <bug-127-4@http.www.slony.info/bugzilla/>
References: <bug-127-4@http.www.slony.info/bugzilla/>
Message-ID: <20100628190935.D752D2902C8@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=127

Devin Ben-Hur <dbenhur at whitepages.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
                 CC|                            |dbenhur at whitepages.com

--- Comment #1 from Devin Ben-Hur <dbenhur at whitepages.com> 2010-06-28 12:09:35 PDT ---
We noticed this behavior change when moving from 1.2x to 2.0x as it made some
health monitors conducting sl_status lag-time polling uninformative on
non-origin nodes.

In the archives, I notice at least one other person encountering the problem
too http://permalink.gmane.org/gmane.comp.db.postgresql.slony1.general/9029

This bug is marked as applying to v1.2, but the behavior effects v2.0 as well
and gives non-origin nodes the appearance of accumulating tremendous
replication lag.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Jun 28 13:49:59 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 28 Jun 2010 13:49:59 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 120] store path - after slon has started does
	not take effect
In-Reply-To: <bug-120-4@http.www.slony.info/bugzilla/>
References: <bug-120-4@http.www.slony.info/bugzilla/>
Message-ID: <20100628204959.33A852903DB@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=120

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |ssinger at ca.afilias.info
                   |o                           |
             Status|NEW                         |ASSIGNED

--- Comment #1 from Steve Singer <ssinger at ca.afilias.info> 2010-06-28 13:49:59 PDT ---
This problem has been observed following a CLONE PREPARE/CLONE FINISH.

If you add paths between the new node and providers nothing happens.
The issue seems to be that in slon the no_active attribute of the node
structure is initialized to false in rtcfg_storeNode.

The only places this is attribute is set to true are
1) On startup in SlonMain based on the value in sl_node
2) In response to an ENABLE_NODE event.

I think the STORE_NODE event processing code should check the current status of
sl_node to determine if the node is enabled or not.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Jun 29 06:02:32 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 29 Jun 2010 06:02:32 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 120] store path - after slon has started does
	not take effect
In-Reply-To: <bug-120-4@http.www.slony.info/bugzilla/>
References: <bug-120-4@http.www.slony.info/bugzilla/>
Message-ID: <20100629130232.955A5290CFB@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=120

--- Comment #2 from Steve Singer <ssinger at ca.afilias.info> 2010-06-29 06:02:32 PDT ---
Created an attachment (id=45)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=45)
patch for bug 120

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Jun 30 06:52:39 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 30 Jun 2010 06:52:39 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 118] initial copy of an inherited table can
 leave the table empty
In-Reply-To: <bug-118-4@http.www.slony.info/bugzilla/>
References: <bug-118-4@http.www.slony.info/bugzilla/>
Message-ID: <20100630135239.2026E290D05@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=118

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |ssinger at ca.afilias.info
                   |o                           |
             Status|NEW                         |ASSIGNED

--- Comment #2 from Steve Singer <ssinger at ca.afilias.info> 2010-06-30 06:52:39 PDT ---
Created an attachment (id=46)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=46)
patch to do TRUNCATE ONLY in 8.4

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Jun 30 07:05:33 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 30 Jun 2010 07:05:33 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 43] get_set() is used inconsistently in altperl
	tools
In-Reply-To: <bug-43-4@http.www.slony.info/bugzilla/>
References: <bug-43-4@http.www.slony.info/bugzilla/>
Message-ID: <20100630140533.23DE3290D34@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=43

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #2 from Steve Singer <ssinger at ca.afilias.info> 2010-06-30 07:05:33 PDT ---
This patch has been applied to the 2.0 and HEAD branches.
It should be included with 2.0.5

Thanks

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

