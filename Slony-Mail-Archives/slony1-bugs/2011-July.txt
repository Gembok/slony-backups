From bugzilla-daemon at main.slony.info  Fri Jul  1 08:04:07 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri,  1 Jul 2011 08:04:07 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 224] New: slonik_build_env generates incorrect
 variable name @KEYEDTABLES
Message-ID: <bug-224-4@http.www.slony.info/bugzilla/>

http://www.slony.info/bugzilla/show_bug.cgi?id=224

           Summary: slonik_build_env generates incorrect variable name
                    @KEYEDTABLES
           Product: Slony-I
           Version: 2.0
          Platform: PC
        OS/Version: Linux
            Status: NEW
          Severity: major
          Priority: low
         Component: altperl
        AssignedTo: slony1-bugs at lists.slony.info
        ReportedBy: mark at mitsein.net
                CC: slony1-bugs at lists.slony.info
   Estimated Hours: 0.0


Created an attachment (id=111)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=111)
patch to fix slonik_build_env

slonik_build_env puts tables that have explicit primary keys into a
@KEYEDTABLES variable.  It should be @PKEYEDTABLES - there is no @KEYEDTABLES
variable used in any of the altperl scripts.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Jul  4 07:50:44 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  4 Jul 2011 07:50:44 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 218] slon often has to retry transactions due to
 concurrent update in 2.1.0.b2
In-Reply-To: <bug-218-4@http.www.slony.info/bugzilla/>
References: <bug-218-4@http.www.slony.info/bugzilla/>
Message-ID: <20110704145044.98085290DED@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=218

--- Comment #16 from Steve Singer <ssinger at ca.afilias.info> 2011-07-04 07:50:44 PDT ---
(In reply to comment #15)
> (In reply to comment #14)
> > Also remember to remove the 'LOCK @NAMESPACE at .sl_config_lock' lines from
> > slony_funcs.sql - since a) the locking is now being done elsewhere, no point in
> > paying a penalty twice.  b) Leaving it in there is a bit confusing since
> > someone else might come along and think that it is okay to obtain
> > sl_config_lock in the stored functions
> 
> Good point, though the price isn't too terribly high.
> 
> Have done so, and had a successful run of all the regression tests against
> this.
> 
> https://github.com/cbbrowne/slony1-engine/commit/35fbb13b44e2136b808a5cd7e8457f616fcc5ccb

in cleanupThread.c  there is no explicit transaction (that I can see)

This means that the LOCK TABLE  a and the 'select ..cleanupEvent(...) are done
in separate transactions, so the lock is already released before the call to
cleanupEvent.

in remote_worker.c you seem to lock config_lock before event_lock while in
slonik.c you lock event_lock before config_lock.  We should try to always get
these locks in the same order (I am not sure which order is better or if it
matters)

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Mon Jul  4 07:51:39 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  4 Jul 2011 07:51:39 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 218] slon often has to retry transactions due to
 concurrent update in 2.1.0.b2
In-Reply-To: <bug-218-4@http.www.slony.info/bugzilla/>
References: <bug-218-4@http.www.slony.info/bugzilla/>
Message-ID: <20110704145139.CE17E290DF2@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=218

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|ssinger at ca.afilias.info     |cbbrowne at ca.afilias.info

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Mon Jul  4 10:27:19 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  4 Jul 2011 10:27:19 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 223] slonik can wait for a node it just
	uninstalled
In-Reply-To: <bug-223-4@http.www.slony.info/bugzilla/>
References: <bug-223-4@http.www.slony.info/bugzilla/>
Message-ID: <20110704172719.9A418290DEB@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=223

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |ssinger at ca.afilias.info
                   |o                           |
             Status|NEW                         |ASSIGNED

--- Comment #1 from Steve Singer <ssinger at ca.afilias.info> 2011-07-04 10:27:19 PDT ---
Created an attachment (id=112)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=112)
fix for bug 223

Fix for bug #223

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Jul  4 10:29:06 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  4 Jul 2011 10:29:06 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 223] slonik can wait for a node it just
	uninstalled
In-Reply-To: <bug-223-4@http.www.slony.info/bugzilla/>
References: <bug-223-4@http.www.slony.info/bugzilla/>
Message-ID: <20110704172906.61923290DE7@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=223

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|ssinger at ca.afilias.info     |janwieck at yahoo.com

--- Comment #2 from Steve Singer <ssinger at ca.afilias.info> 2011-07-04 10:29:06 PDT ---
Please arrange a review for this patch.
Attached or available at https://github.com/ssinger/slony1-engine/tree/bug223

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Jul  5 13:45:19 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue,  5 Jul 2011 13:45:19 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 218] slon often has to retry transactions due to
 concurrent update in 2.1.0.b2
In-Reply-To: <bug-218-4@http.www.slony.info/bugzilla/>
References: <bug-218-4@http.www.slony.info/bugzilla/>
Message-ID: <20110705204519.296B6290D33@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=218

--- Comment #17 from Steve Singer <ssinger at ca.afilias.info> 2011-07-05 13:45:19 PDT ---
I am starting to suspect that commit 9f0ff6c21eb9f7493de01a4bda16f178e97c80aa
is causing the disorder tests (Move Set, when run as part of a larger set) to
fail.

It *seems* that prior to this commit it passes while after I get failures.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Jul  6 08:41:48 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  6 Jul 2011 08:41:48 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 218] slon often has to retry transactions due to
 concurrent update in 2.1.0.b2
In-Reply-To: <bug-218-4@http.www.slony.info/bugzilla/>
References: <bug-218-4@http.www.slony.info/bugzilla/>
Message-ID: <20110706154149.0736C290D77@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=218

--- Comment #18 from Christopher Browne <cbbrowne at ca.afilias.info> 2011-07-06 08:41:48 PDT ---
(In reply to comment #16)
> in cleanupThread.c  there is no explicit transaction (that I can see)
> 
> This means that the LOCK TABLE  a and the 'select ..cleanupEvent(...) are done
> in separate transactions, so the lock is already released before the call to
> cleanupEvent.

Eek, yes, that's doubtless so.

There wasn't an explicit transaction because the cleanup thread used to have,
as a major component, running VACUUM against Slony's tables, and that can't
take place inside a transaction.

We clearly have activity that needs a transaction, so this needs to complicate
a little bit.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Jul  6 09:32:55 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  6 Jul 2011 09:32:55 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 224] slonik_build_env generates incorrect
 variable name @KEYEDTABLES
In-Reply-To: <bug-224-4@http.www.slony.info/bugzilla/>
References: <bug-224-4@http.www.slony.info/bugzilla/>
Message-ID: <20110706163255.A983A290DE4@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=224

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|NEW                         |RESOLVED

--- Comment #1 from Christopher Browne <cbbrowne at ca.afilias.info> 2011-07-06 09:32:55 PDT ---
Applied to 3 branches:

a) master

http://git.postgresql.org/gitweb?p=slony1-engine.git;a=commit;h=9bf3e9a47cc198d40250fc01f4276ee9e0cca2a2

b) 2.0

http://git.postgresql.org/gitweb?p=slony1-engine.git;a=commit;h=573778393e0a084e67c2ff4b5e4c59c08f7a7c48

c) 1.2

http://git.postgresql.org/gitweb?p=slony1-engine.git;a=commit;h=26e9c679cc90d8e6587d7ef1893f2e0bb055baff

Thanks!

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Thu Jul  7 07:19:08 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu,  7 Jul 2011 07:19:08 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 223] slonik can wait for a node it just
	uninstalled
In-Reply-To: <bug-223-4@http.www.slony.info/bugzilla/>
References: <bug-223-4@http.www.slony.info/bugzilla/>
Message-ID: <20110707141908.77A9A290DA4@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=223

Jan Wieck <janwieck at yahoo.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|janwieck at yahoo.com          |ssinger at ca.afilias.info

--- Comment #3 from Jan Wieck <janwieck at yahoo.com> 2011-07-07 07:19:08 PDT ---
Looks like the right solution to me.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Jul  7 07:26:27 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu,  7 Jul 2011 07:26:27 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 222] cleanup thread can lock out new application
	connections
In-Reply-To: <bug-222-4@http.www.slony.info/bugzilla/>
References: <bug-222-4@http.www.slony.info/bugzilla/>
Message-ID: <20110707142627.AD2B5290DE9@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=222

Jan Wieck <janwieck at yahoo.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|janwieck at yahoo.com          |ssinger at ca.afilias.info

--- Comment #5 from Jan Wieck <janwieck at yahoo.com> 2011-07-07 07:26:27 PDT ---
The patch looks good to me.

I wonder if the passing of the LOCK TABLE ... NO WAIT is a bug that needs to be
fixed in PostgreSQL though.


Jan

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Jul  7 07:59:29 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu,  7 Jul 2011 07:59:29 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 216] monitor threads don't work on Win32
In-Reply-To: <bug-216-4@http.www.slony.info/bugzilla/>
References: <bug-216-4@http.www.slony.info/bugzilla/>
Message-ID: <20110707145929.E2E41290DE9@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=216

Jan Wieck <janwieck at yahoo.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|janwieck at yahoo.com          |ssinger at ca.afilias.info

--- Comment #5 from Jan Wieck <janwieck at yahoo.com> 2011-07-07 07:59:30 PDT ---
This patch definitely gets us into the list of systems affected by the UNIX
time stamp problem, that will happen on January 19, 2038. Other than that it
looks OK to me.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Jul  7 14:33:44 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu,  7 Jul 2011 14:33:44 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 222] cleanup thread can lock out new application
	connections
In-Reply-To: <bug-222-4@http.www.slony.info/bugzilla/>
References: <bug-222-4@http.www.slony.info/bugzilla/>
Message-ID: <20110707213344.8FF61290DE0@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=222

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #6 from Steve Singer <ssinger at ca.afilias.info> 2011-07-07 14:33:44 PDT ---
Fixed in master for the next 2.1.0 beta

http://git.postgresql.org/gitweb/?p=slony1-engine.git;a=commit;h=b9ef590e56fab3fa6f3d06192a3ea73650036284

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Jul  7 14:34:17 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu,  7 Jul 2011 14:34:17 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 223] slonik can wait for a node it just
	uninstalled
In-Reply-To: <bug-223-4@http.www.slony.info/bugzilla/>
References: <bug-223-4@http.www.slony.info/bugzilla/>
Message-ID: <20110707213417.6EE0D290DE7@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=223

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #4 from Steve Singer <ssinger at ca.afilias.info> 2011-07-07 14:34:17 PDT ---
http://git.postgresql.org/gitweb/?p=slony1-engine.git;a=commit;h=dc61270672c3fbb2c49e8b0b1894b7bf72b02d6d

Fixed in 2.1.0 for the next beta

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Jul  7 14:34:50 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu,  7 Jul 2011 14:34:50 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 216] monitor threads don't work on Win32
In-Reply-To: <bug-216-4@http.www.slony.info/bugzilla/>
References: <bug-216-4@http.www.slony.info/bugzilla/>
Message-ID: <20110707213450.123CA290DE5@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=216

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #6 from Steve Singer <ssinger at ca.afilias.info> 2011-07-07 14:34:50 PDT ---
http://git.postgresql.org/gitweb/?p=slony1-engine.git;a=commit;h=aab898de15ac5f135b2f6ece105d82a0bcfed023

Fixed for the next beta of 2.1.0

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Jul  7 14:58:51 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu,  7 Jul 2011 14:58:51 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 218] slon often has to retry transactions due to
 concurrent update in 2.1.0.b2
In-Reply-To: <bug-218-4@http.www.slony.info/bugzilla/>
References: <bug-218-4@http.www.slony.info/bugzilla/>
Message-ID: <20110707215851.13972290DE2@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=218

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|cbbrowne at ca.afilias.info    |ssinger at ca.afilias.info

--- Comment #19 from Christopher Browne <cbbrowne at ca.afilias.info> 2011-07-07 14:58:51 PDT ---
I have committed the BEGIN/COMMIT addition...  Over to you, Steve...

https://github.com/cbbrowne/slony1-engine/commit/f3e0776f33c345227df64f06275679ed15bf1a83

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

