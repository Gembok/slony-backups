From bugzilla-daemon at main.slony.info  Mon Nov  1 13:44:51 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  1 Nov 2010 13:44:51 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 156] Slon on startup should have "health check"
In-Reply-To: <bug-156-4@http.www.slony.info/bugzilla/>
References: <bug-156-4@http.www.slony.info/bugzilla/>
Message-ID: <20101101204451.EA7DD2902C4@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=156

--- Comment #4 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-11-01 13:44:51 PDT ---
Per discussion on list, add in check that the timezone is GMT/UTC (or, I
suppose, one of the timezones which is stable, that is, does not have Daylight
Savings Time), and raise a WARNING if not.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Mon Nov  1 14:19:31 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  1 Nov 2010 14:19:31 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 163] New: Resolve Timezone ambiguity
Message-ID: <bug-163-4@http.www.slony.info/bugzilla/>

http://www.slony.info/bugzilla/show_bug.cgi?id=163

           Summary: Resolve Timezone ambiguity
           Product: Slony-I
           Version: devel
          Platform: All
        OS/Version: All
            Status: NEW
          Severity: normal
          Priority: low
         Component: slon
        AssignedTo: slony1-bugs at lists.slony.info
        ReportedBy: cbbrowne at ca.afilias.info
                CC: slony1-bugs at lists.slony.info
   Estimated Hours: 0.0


There is a concern out there as to what happens if Slony-I is operating in a
timezone that has the Daylight Savings Time discontinuity.

Some ways of addressing this include:

a) Changing Slony-I tables that have TIMESTAMP values to, instead, have
TIMESTAMP WITH TIMEZONE.

Downsides include that this involves a number of alterations to existing
tables, with a conversion ambiguity.  (e.g. - what should be done with existing
data?  This seems notably risky if the existing timestamps surround the
discontinuity.)

b) Have the slon "health check" (see bug #156) look at the timezone in
TimeZone, and warn if it has a discontinuity.

Open question:  UTC and GMT would be acceptable timezones; what others are
potentially acceptable?

c) Have slon process expressly use UTC as its timezone.

This might change logging output, and be unpopular to users accustomed to
operating Slony in some other timezone.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov  2 08:36:15 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue,  2 Nov 2010 08:36:15 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 164] New: Unable to build slony1-2.0.5 oh RHEL
	machine
Message-ID: <bug-164-4@http.www.slony.info/bugzilla/>

http://www.slony.info/bugzilla/show_bug.cgi?id=164

           Summary: Unable to build slony1-2.0.5 oh RHEL machine
           Product: Slony-I
           Version: 2.0
          Platform: PC
        OS/Version: Linux
            Status: NEW
          Severity: blocker
          Priority: high
         Component: core scripts
        AssignedTo: slony1-bugs at lists.slony.info
        ReportedBy: salmanb at quietcaresystems.com
                CC: slony1-bugs at lists.slony.info
   Estimated Hours: 0.0


I'm unable to build slony on an RHEL 5.3 machine. 

Running configure complains that my version of flex/lex is 'too old'. Checking
the configure script, I see that it's trying match my flex version string
(2.5.4) against this: 

if echo "$pgac_flex_version" | sed 's/[.a-z]/ /g' | awk '{ if ($1 = 2 && $2 = 5
&& $3 >= 31) exit 0; else exit 1;}'

Configuration runs to completion despite the warning message. 

Then, during make/make all, I get the following errors: 

--------------------------------
Missing flex scan.l scan.c
gcc -g -O2 -Wall -Wmissing-prototypes -Wmissing-declarations -I../..
-DPGSHARE="\"/usr/local/postgresql/9.0.1/share/\"" 
-I/usr/local/postgresql/9.0.1/include/
-I/usr/local/postgresql/9.0.1/include/server/  -c -o parser.o parser.c
gcc -g -O2 -Wall -Wmissing-prototypes -Wmissing-declarations -I../..
-DPGSHARE="\"/usr/local/postgresql/9.0.1/share/\"" 
-I/usr/local/postgresql/9.0.1/include/
-I/usr/local/postgresql/9.0.1/include/server/  -c -o scan.o scan.c
gcc: scan.c: No such file or directory
gcc: no input files
make[2]: *** [scan.o] Error 1
make[2]: Leaving directory `/usr/src/slony1-2.0.5/src/slony_logshipper'
make[1]: *** [all] Error 2
make[1]: Leaving directory `/usr/src/slony1-2.0.5/src'
make: *** [all] Error 2
--------------------------------

[root at dbdev slony1-2.0.5]# cat /etc/redhat-release 
Red Hat Enterprise Linux Server release 5.3 (Tikanga)

Please let me know if you need any other info from me.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov  2 08:36:35 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue,  2 Nov 2010 08:36:35 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 164] Unable to build slony1-2.0.5 on RHEL machine
In-Reply-To: <bug-164-4@http.www.slony.info/bugzilla/>
References: <bug-164-4@http.www.slony.info/bugzilla/>
Message-ID: <20101102153635.9FE1E290CB7@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=164

salman <salmanb at quietcaresystems.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
            Summary|Unable to build             |Unable to build
                   |slony1-2.0.5 oh RHEL        |slony1-2.0.5 on RHEL
                   |machine                     |machine

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov  2 08:37:28 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue,  2 Nov 2010 08:37:28 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 164] Unable to build slony1-2.0.5 on RHEL machine
In-Reply-To: <bug-164-4@http.www.slony.info/bugzilla/>
References: <bug-164-4@http.www.slony.info/bugzilla/>
Message-ID: <20101102153728.199F6290CB7@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=164

--- Comment #1 from salman <salmanb at quietcaresystems.com> 2010-11-02 08:37:28 PDT ---
Forgot to include flex version:

[root at dbdev slony1-2.0.5]# flex --version
flex version 2.5.4
[root at dbdev slony1-2.0.5]# lex --version
lex version 2.5.4

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov  2 10:37:31 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue,  2 Nov 2010 10:37:31 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 164] Unable to build slony1-2.0.5 on RHEL machine
In-Reply-To: <bug-164-4@http.www.slony.info/bugzilla/>
References: <bug-164-4@http.www.slony.info/bugzilla/>
Message-ID: <20101102173731.718FC290CFE@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=164

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |DUPLICATE
             Status|NEW                         |RESOLVED

--- Comment #2 from Steve Singer <ssinger at ca.afilias.info> 2010-11-02 10:37:31 PDT ---
This is a duplicate of bug159.

For the 2.0.5 tar files you should install flex+bison to get slony to build.

*** This bug has been marked as a duplicate of bug 159 ***

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov  2 10:37:31 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue,  2 Nov 2010 10:37:31 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 159] compile error
In-Reply-To: <bug-159-4@http.www.slony.info/bugzilla/>
References: <bug-159-4@http.www.slony.info/bugzilla/>
Message-ID: <20101102173731.D0697290D08@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=159

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
                 CC|                            |salmanb at quietcaresystems.co
                   |                            |m

--- Comment #5 from Steve Singer <ssinger at ca.afilias.info> 2010-11-02 10:37:31 PDT ---
*** Bug 164 has been marked as a duplicate of this bug. ***

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov  2 12:22:10 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue,  2 Nov 2010 12:22:10 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 159] compile error
In-Reply-To: <bug-159-4@http.www.slony.info/bugzilla/>
References: <bug-159-4@http.www.slony.info/bugzilla/>
Message-ID: <20101102192210.3B598290035@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=159

salman <salmanb at quietcaresystems.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|FIXED                       |
             Status|RESOLVED                    |REOPENED

--- Comment #6 from salman <salmanb at quietcaresystems.com> 2010-11-02 12:22:10 PDT ---
Sorry for re-opening this. I applied the patch attached to this bug, verified
bison was installed, but make still seems to be breaking.

--------------------

[root at dbdev src]# rm -rf slony1-2.0.5
[root at dbdev src]# tar xjf slony1-2.0.5.tar.bz2 
[root at dbdev src]# mv 0001-Fix-for-bug-159.patch slony1-2.0.5
[root at dbdev src]# patch -p1 < 0001-Fix-for-bug-159.patch 
bash: 0001-Fix-for-bug-159.patch: No such file or directory
[root at dbdev src]# cd slony1-2.0.5
[root at dbdev slony1-2.0.5]# patch -p1 < 0001-Fix-for-bug-159.patch 
patching file GNUmakefile.in
patching file src/parsestatements/Makefile
patching file src/slony_logshipper/Makefile
--------------------

Run configure: ./configure --prefix=/usr --sysconfdir=/etc/slony
--with-perltools --with-pgconfigdir=/usr/local/postgresql/9.0.1/bin/

--snip--
[root at dbdev slony1-2.0.5]# echo $?
0
--snip--

bison, flex installed and in path. Respective versions:
--------------------
[root at dbdev slony1-2.0.5]# bison --version && flex --version && lex --version
bison (GNU Bison) 2.3
Written by Robert Corbett and Richard Stallman.

Copyright (C) 2006 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
flex version 2.5.4
lex version 2.5.4
--------------------

Run make:

--snip--

gcc -g -O2 -Wall -Wmissing-prototypes -Wmissing-declarations -I../.. -fpic
-I/usr/local/postgresql/9.0.1/include/
-I/usr/local/postgresql/9.0.1/include/server/  -c -o slony1_funcs.o
slony1_funcs.c
slony1_funcs.c: In function ?slon_quote_literal?:
slony1_funcs.c:1030: warning: pointer targets in passing argument 1 of
?pg_mblen? differ in signedness
gcc -shared -o slony1_funcs.so slony1_funcs.o
make[2]: Leaving directory `/usr/src/slony1-2.0.5/src/backend'
make[2]: Entering directory `/usr/src/slony1-2.0.5/src/ducttape'
make[2]: Leaving directory `/usr/src/slony1-2.0.5/src/ducttape'
make[2]: Entering directory `/usr/src/slony1-2.0.5/src/slony_logshipper'
gcc -g -O2 -Wall -Wmissing-prototypes -Wmissing-declarations -I../..
-DPGSHARE="\"/usr/local/postgresql/9.0.1/share/\"" 
-I/usr/local/postgresql/9.0.1/include/
-I/usr/local/postgresql/9.0.1/include/server/  -c -o slony_logshipper.o
slony_logshipper.c
slony_logshipper.c: In function ?main?:
slony_logshipper.c:477: warning: ?destfname.data? may be used uninitialized in
this function
gcc -g -O2 -Wall -Wmissing-prototypes -Wmissing-declarations -I../..
-DPGSHARE="\"/usr/local/postgresql/9.0.1/share/\"" 
-I/usr/local/postgresql/9.0.1/include/
-I/usr/local/postgresql/9.0.1/include/server/  -c -o dbutil.o dbutil.c
gcc -g -O2 -Wall -Wmissing-prototypes -Wmissing-declarations -I../..
-DPGSHARE="\"/usr/local/postgresql/9.0.1/share/\"" 
-I/usr/local/postgresql/9.0.1/include/
-I/usr/local/postgresql/9.0.1/include/server/  -c -o ipcutil.o ipcutil.c
bison -y -d  parser.y
mv -f y.tab.c parser.c
Missing flex scan.l scan.c
gcc -g -O2 -Wall -Wmissing-prototypes -Wmissing-declarations -I../..
-DPGSHARE="\"/usr/local/postgresql/9.0.1/share/\"" 
-I/usr/local/postgresql/9.0.1/include/
-I/usr/local/postgresql/9.0.1/include/server/  -c -o parser.o parser.c
gcc -g -O2 -Wall -Wmissing-prototypes -Wmissing-declarations -I../..
-DPGSHARE="\"/usr/local/postgresql/9.0.1/share/\"" 
-I/usr/local/postgresql/9.0.1/include/
-I/usr/local/postgresql/9.0.1/include/server/  -c -o scan.o scan.c
gcc: scan.c: No such file or directory
gcc: no input files
make[2]: *** [scan.o] Error 1
make[2]: Leaving directory `/usr/src/slony1-2.0.5/src/slony_logshipper'
make[1]: *** [all] Error 2
make[1]: Leaving directory `/usr/src/slony1-2.0.5/src'
make: *** [all] Error 2

[root at dbdev slony1-2.0.5]# find . |grep -i scan
./src/slony_logshipper/scan.l
./src/slony_logshipper/scan.h
./src/slonik/scan.o
./src/slonik/scan.l
./src/slonik/scan.h
./src/slonik/scan.c
./src/parsestatements/scanner.o
./src/parsestatements/scanner.c
./src/parsestatements/test-scanner
./src/parsestatements/test-scanner.c
./src/parsestatements/test-scanner.o
./src/parsestatements/scanner.h
--snip--

Make is not looking in/descending into the correct dir?

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov  2 12:27:28 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue,  2 Nov 2010 12:27:28 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 159] compile error
In-Reply-To: <bug-159-4@http.www.slony.info/bugzilla/>
References: <bug-159-4@http.www.slony.info/bugzilla/>
Message-ID: <20101102192728.A9AB029026A@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=159

--- Comment #7 from Steve Singer <ssinger at ca.afilias.info> 2010-11-02 12:27:28 PDT ---
Once bison + flex are installed you should then re-run configure then make.  It
should then build.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov  2 12:54:14 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue,  2 Nov 2010 12:54:14 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 159] compile error
In-Reply-To: <bug-159-4@http.www.slony.info/bugzilla/>
References: <bug-159-4@http.www.slony.info/bugzilla/>
Message-ID: <20101102195414.8658629007F@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=159

--- Comment #8 from salman <salmanb at quietcaresystems.com> 2010-11-02 12:54:14 PDT ---
Steve,

After installing bison, I rm'd the old src dir and extracted a fresh one. Ran
configure, then make. The end result was still the same.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Nov  3 06:25:15 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  3 Nov 2010 06:25:15 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 159] compile error
In-Reply-To: <bug-159-4@http.www.slony.info/bugzilla/>
References: <bug-159-4@http.www.slony.info/bugzilla/>
Message-ID: <20101103132515.DF5C02902C4@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=159

--- Comment #9 from Steve Singer <ssinger at ca.afilias.info> 2010-11-03 06:25:15 PDT ---
after you've run configure;  inside the file Makefile.global
what is the line

FLEX= 

set to?
or is it empty?

If it is empty, then configure isn't finding  flex.  What is does the
config.log say (can you send this to me)

If FLEX is set to a non-empty value then the question is why isn't it building
stuff.

If you manually switch to the src/slony_logshipper  directory and run make or
"make clean;make" will it call flex to build scan.c ?

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Nov  3 07:22:29 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  3 Nov 2010 07:22:29 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 156] Slon on startup should have "health check"
In-Reply-To: <bug-156-4@http.www.slony.info/bugzilla/>
References: <bug-156-4@http.www.slony.info/bugzilla/>
Message-ID: <20101103142229.119CD290425@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=156

--- Comment #5 from Steve Singer <ssinger at ca.afilias.info> 2010-11-03 07:22:28 PDT ---

The latest version of the patch seems to introduce the following compiler
warning

slon.c: In function ?SlonMain?:
slon.c:460: warning: comparison between pointer and integer

from the line 
if (PQgetvalue(res, 0, 0) == 'f') {
                slon_log(SLON_FATAL, 
                 "slon_node_health_check

I am surprised that your testing was able to get this warning to show up.

PQgetvalue(..) will return  a char * to a null terminated string not a char.
strncmp is probably what we want to be using.

2.  If I modify the code to work around that issue this is all I see when I see
in the slon output.

2010-11-03 10:19:30 EDTCONFIG main: local node id = 1
2010-11-03 10:19:30 EDTFATAL  could not call slon_node_health_check() -
2010-11-03 10:19:30 EDTCONFIG slon: child terminated status: 9; pid: 31474,
current worker pid: 31474
2010-11-03 10:19:30 EDTINFO   slon: done
2010-11-03 10:19:30 EDTINFO   slon: exit(0)


I'm not seeing the details. (ie the specific table that is the issue)

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Nov  3 08:46:52 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  3 Nov 2010 08:46:52 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 159] compile error
In-Reply-To: <bug-159-4@http.www.slony.info/bugzilla/>
References: <bug-159-4@http.www.slony.info/bugzilla/>
Message-ID: <20101103154652.2D03729026D@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=159

--- Comment #10 from salman <salmanb at quietcaresystems.com> 2010-11-03 08:46:51 PDT ---
Created an attachment (id=72)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=72)
config.log

config.log from slony1-2.0.5

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Nov  3 08:48:44 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  3 Nov 2010 08:48:44 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 159] compile error
In-Reply-To: <bug-159-4@http.www.slony.info/bugzilla/>
References: <bug-159-4@http.www.slony.info/bugzilla/>
Message-ID: <20101103154844.5CDB7290C4E@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=159

--- Comment #11 from salman <salmanb at quietcaresystems.com> 2010-11-03 08:48:44 PDT ---

From bugzilla-daemon at main.slony.info  Wed Nov  3 08:53:15 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  3 Nov 2010 08:53:15 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 159] compile error
In-Reply-To: <bug-159-4@http.www.slony.info/bugzilla/>
References: <bug-159-4@http.www.slony.info/bugzilla/>
Message-ID: <20101103155315.A4F792900A5@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=159

--- Comment #12 from Steve Singer <ssinger at ca.afilias.info> 2010-11-03 08:53:15 PDT ---

From bugzilla-daemon at main.slony.info  Wed Nov  3 08:57:04 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  3 Nov 2010 08:57:04 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 159] compile error
In-Reply-To: <bug-159-4@http.www.slony.info/bugzilla/>
References: <bug-159-4@http.www.slony.info/bugzilla/>
Message-ID: <20101103155704.CB15B29026D@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=159

--- Comment #13 from salman <salmanb at quietcaresystems.com> 2010-11-03 08:57:04 PDT ---
configure script did generate those warnings -- does building slony require
exactly 2.5.31? I've been working under the (erroneous?) assumption that
'2.5.31 or later' should allow the build to complete successfully as this
server is using flex 2.5.4.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Nov  3 09:01:16 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  3 Nov 2010 09:01:16 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 159] compile error
In-Reply-To: <bug-159-4@http.www.slony.info/bugzilla/>
References: <bug-159-4@http.www.slony.info/bugzilla/>
Message-ID: <20101103160116.BB0EE290C86@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=159

--- Comment #14 from Steve Singer <ssinger at ca.afilias.info> 2010-11-03 09:01:16 PDT ---
2.5.31 or later is fine (as far as I know).

The problem is that 2.5.4 is earlier than 2.5.31

4 < 31 isn't it?

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Nov  3 09:09:08 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  3 Nov 2010 09:09:08 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 159] compile error
In-Reply-To: <bug-159-4@http.www.slony.info/bugzilla/>
References: <bug-159-4@http.www.slony.info/bugzilla/>
Message-ID: <20101103160908.CD2D9290C4E@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=159

--- Comment #15 from salman <salmanb at quietcaresystems.com> 2010-11-03 09:09:08 PDT ---
Apparently I can't read version numbers correctly. Sorry to waste your time!
Thanks for all the help!

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Nov  3 09:55:47 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  3 Nov 2010 09:55:47 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 159] compile error
In-Reply-To: <bug-159-4@http.www.slony.info/bugzilla/>
References: <bug-159-4@http.www.slony.info/bugzilla/>
Message-ID: <20101103165547.2629B2902C4@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=159

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|REOPENED                    |RESOLVED

--- Comment #16 from Steve Singer <ssinger at ca.afilias.info> 2010-11-03 09:55:46 PDT ---
I am moving this bug back to RESOLVED.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Nov  3 11:55:54 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  3 Nov 2010 11:55:54 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 17] slony doesn't build with a 'virtual'
 postgresql installation done with DESTDIR
In-Reply-To: <bug-17-4@http.www.slony.info/bugzilla/>
References: <bug-17-4@http.www.slony.info/bugzilla/>
Message-ID: <20101103185554.C377E290C4E@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=17

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |WONTFIX
             Status|NEW                         |RESOLVED

--- Comment #5 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-11-03 11:55:54 PDT ---
There being no comment on this for nearly three years, I am closing this out as
previously warned.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Nov  4 09:13:34 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu,  4 Nov 2010 09:13:34 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 156] Slon on startup should have "health check"
In-Reply-To: <bug-156-4@http.www.slony.info/bugzilla/>
References: <bug-156-4@http.www.slony.info/bugzilla/>
Message-ID: <20101104161334.E88F1290D04@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=156

--- Comment #6 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-11-04 09:13:34 PDT ---
(In reply to comment #5)
> The latest version of the patch seems to introduce the following compiler
> warning
> 
> slon.c: In function ?SlonMain?:
> slon.c:460: warning: comparison between pointer and integer
> 
> from the line 
> if (PQgetvalue(res, 0, 0) == 'f') {
>                 slon_log(SLON_FATAL, 
>                  "slon_node_health_check
> 
> I am surprised that your testing was able to get this warning to show up.
> 
> PQgetvalue(..) will return  a char * to a null terminated string not a char.
> strncmp is probably what we want to be using.
> 
> 2.  If I modify the code to work around that issue this is all I see when I see
> in the slon output.
> 
> 2010-11-03 10:19:30 EDTCONFIG main: local node id = 1
> 2010-11-03 10:19:30 EDTFATAL  could not call slon_node_health_check() -
> 2010-11-03 10:19:30 EDTCONFIG slon: child terminated status: 9; pid: 31474,
> current worker pid: 31474
> 2010-11-03 10:19:30 EDTINFO   slon: done
> 2010-11-03 10:19:30 EDTINFO   slon: exit(0)
> 
> 
> I'm not seeing the details. (ie the specific table that is the issue)

Right you are...

I have changed it to 
    if (*(PQgetvalue(res, 0, 0)) == 'f') {

which is consistent with what is done elsewhere:

postgres at cbbrowne [12:08:05] [~/slony1-engine.github/src/slon] [bug156 *]
-> % grep -n PQgetvalue *.c | grep "*" | grep "'"
remote_worker.c:2661:           if (*(PQgetvalue(res1, 0, 0)) == 't')
slon.c:460:                             if (*(PQgetvalue(res, 0, 0)) == 'f') {
slon.c:550:             int                     no_active = (*PQgetvalue(res,
i, 1) == 't') ? 1 : 0;


(Of course, the second instance is for this patch! :-))

Here is a self-contained test of this, run against a node that was initialized
and had tables added in.  I mess with it by breaking sl_table.tab_reloid
values.

postgres at cbbrowne [12:10:00] [~/slony1-engine.github/src/slon] [bug156 *]
-> % psql -d slonyregress1 -c "update _slony_regress1.sl_table set
tab_reloid=tab_id;"
UPDATE 4
postgres at cbbrowne [12:10:47] [~/slony1-engine.github/src/slon] [bug156 *]
-> % slon slony_regress1 'dbname=slonyregress1' > /tmp/stdout.txt 2>
/tmp/stderr.txt
postgres at cbbrowne [12:10:55] [~/slony1-engine.github/src/slon] [bug156 *]
-> % cat /tmp/stdout.txt
2010-11-04 12:10:55 EDTCONFIG main: slon version 2.0.5 starting up
2010-11-04 12:10:55 EDTINFO   slon: watchdog process started
2010-11-04 12:10:55 EDTCONFIG slon: watchdog ready - pid = 29512
2010-11-04 12:10:55 EDTCONFIG slon: worker process created - pid = 29513
2010-11-04 12:10:55 EDTCONFIG main: Integer option vac_frequency = 3
2010-11-04 12:10:55 EDTCONFIG main: Integer option log_level = 0
2010-11-04 12:10:55 EDTCONFIG main: Integer option sync_interval = 2000
2010-11-04 12:10:55 EDTCONFIG main: Integer option sync_interval_timeout =
10000
2010-11-04 12:10:55 EDTCONFIG main: Integer option sync_group_maxsize = 20
2010-11-04 12:10:55 EDTCONFIG main: Integer option desired_sync_time = 60000
2010-11-04 12:10:55 EDTCONFIG main: Integer option syslog = 0
2010-11-04 12:10:55 EDTCONFIG main: Integer option quit_sync_provider = 0
2010-11-04 12:10:55 EDTCONFIG main: Integer option quit_sync_finalsync = 0
2010-11-04 12:10:55 EDTCONFIG main: Integer option sync_max_rowsize = 8192
2010-11-04 12:10:55 EDTCONFIG main: Integer option sync_max_largemem = 5242880
2010-11-04 12:10:55 EDTCONFIG main: Integer option remote_listen_timeout = 300
2010-11-04 12:10:55 EDTCONFIG main: Boolean option log_pid = 0
2010-11-04 12:10:55 EDTCONFIG main: Boolean option log_timestamp = 1
2010-11-04 12:10:55 EDTCONFIG main: Boolean option cleanup_deletelogs = 0
2010-11-04 12:10:55 EDTCONFIG main: Real option real_placeholder = 0.000000
2010-11-04 12:10:55 EDTCONFIG main: String option cluster_name = slony_regress1
2010-11-04 12:10:55 EDTCONFIG main: String option conn_info =
dbname=slonyregress1
2010-11-04 12:10:55 EDTCONFIG main: String option pid_file = [NULL]
2010-11-04 12:10:55 EDTCONFIG main: String option log_timestamp_format =
%Y-%m-%d %H:%M:%S %Z
2010-11-04 12:10:55 EDTCONFIG main: String option archive_dir = [NULL]
2010-11-04 12:10:55 EDTCONFIG main: String option sql_on_connection = [NULL]
2010-11-04 12:10:55 EDTCONFIG main: String option lag_interval = [NULL]
2010-11-04 12:10:55 EDTCONFIG main: String option command_on_logarchive =
[NULL]
2010-11-04 12:10:55 EDTCONFIG main: String option syslog_facility = LOCAL0
2010-11-04 12:10:55 EDTCONFIG main: String option syslog_ident = slon
2010-11-04 12:10:55 EDTCONFIG main: String option cleanup_interval = 10 minutes
2010-11-04 12:10:55 EDTCONFIG main: local node id = 1
2010-11-04 12:10:55 EDTFATAL  slon_node_health_check() returned false - fatal
health problem!

REPAIR CONFIG may be helpful to rectify this problem2010-11-04 12:10:55
EDTCONFIG slon: child terminated status: 9; pid: 29513, current worker pid:
29513
2010-11-04 12:10:55 EDTINFO   slon: done
2010-11-04 12:10:55 EDTINFO   slon: exit(0)
postgres at cbbrowne [12:11:03] [~/slony1-engine.github/src/slon] [bug156 *]
-> % cat /tmp/stderr.txt
WARNING:  table [id,nsp,name]=[1,table1,public] - sl_table does not match
pg_class/pg_namespace
WARNING:  table [id,nsp,name]=[2,table2,public] - sl_table does not match
pg_class/pg_namespace
WARNING:  table [id,nsp,name]=[4,table4,public] - sl_table does not match
pg_class/pg_namespace
WARNING:  table [id,nsp,name]=[5,table5,public] - sl_table does not match
pg_class/pg_namespace
WARNING:  Mismatch found between sl_table and pg_class.  Slonik command REPAIR
CONFIG may be useful to rectify this.
postgres at cbbrowne [12:11:07] [~/slony1-engine.github/src/slon] [bug156 *]
-> %

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Nov  4 13:50:06 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu,  4 Nov 2010 13:50:06 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 144] replicate_partition stored procedure
 doesn't start replicating changes to the new table
In-Reply-To: <bug-144-4@http.www.slony.info/bugzilla/>
References: <bug-144-4@http.www.slony.info/bugzilla/>
Message-ID: <20101104205006.3350C290C4E@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=144

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |WORKSFORME
             Status|NEW                         |RESOLVED
                URL|                            |http://slony.info/documenta
                   |                            |tion/2.0/partitioning.html

--- Comment #3 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-11-04 13:50:06 PDT ---
The documentation on partitioning is reasonably clear that this is to be run as
part of an EXECUTE SCRIPT request, so it runs against all nodes.

I'll augment the functions' documentation to indicate the same.

Head:
http://git.postgresql.org/gitweb?p=slony1-engine.git;a=commit;h=5bd032e4942c71ee5ae23d7b6c263c8b8a598fb8

2.0:
http://git.postgresql.org/gitweb?p=slony1-engine.git;a=commit;h=56e603a5bfe876186afe4ef0b5f443f0c95c3411

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Nov  5 09:02:14 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri,  5 Nov 2010 09:02:14 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 162] typenameTypeId() changes signatures
In-Reply-To: <bug-162-4@http.www.slony.info/bugzilla/>
References: <bug-162-4@http.www.slony.info/bugzilla/>
Message-ID: <20101105160214.38D07290D11@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=162

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |cbbrowne at ca.afilias.info
                   |o                           |
             Status|NEW                         |ASSIGNED

--- Comment #1 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-11-05 09:02:14 PDT ---
Actually, "presumably" turns out to be incorrect.

config/acx_libpq.m4 already handled this:

if test -z "$ac_cv_typenameTypeId_args"; then
  AC_MSG_RESULT(no)
else
  if test "$ac_cv_typenameTypeId_args" = 3; then
    AC_DEFINE(HAVE_TYPENAMETYPEID_3)
  elif test "$ac_cv_typenameTypeId_args" = 2; then
    AC_DEFINE(HAVE_TYPENAMETYPEID_2)
  elif test "$ac_cv_typenameTypeId_args" = 1; then
    AC_DEFINE(HAVE_TYPENAMETYPEID_1)
  fi
  AC_MSG_RESULT([yes, and it takes $ac_cv_typenameTypeId_args arguments])
fi

We thus already have #ifdef-suitable symbols defined, that need to be
referenced in slony1_funcs.c

Done, in a branch based on 2.0:

https://github.com/cbbrowne/slony1-engine/commit/c1834e9dba05ca8f73551dbc59cc978f6fce8c26

It is also applicable to HEAD, directly, and I expect it may be cherry-picked
into 1.2.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Nov  8 13:31:02 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  8 Nov 2010 13:31:02 -0800 (PST)
Subject: [Slony1-bugs] [Bug 165] New: Hiding Password in logs
Message-ID: <bug-165-4@http.www.slony.info/bugzilla/>

http://www.slony.info/bugzilla/show_bug.cgi?id=165

           Summary: Hiding Password in logs
           Product: Slony-I
           Version: devel
          Platform: All
        OS/Version: All
            Status: NEW
          Severity: enhancement
          Priority: low
         Component: slon
        AssignedTo: slony1-bugs at lists.slony.info
        ReportedBy: cbbrowne at ca.afilias.info
                CC: slony1-bugs at lists.slony.info
   Estimated Hours: 0.0


If passwords are presented as part of conninfo, they will be reported as part
of log output.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Nov  8 13:36:50 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  8 Nov 2010 13:36:50 -0800 (PST)
Subject: [Slony1-bugs] [Bug 165] Hiding Password in logs
In-Reply-To: <bug-165-4@http.www.slony.info/bugzilla/>
References: <bug-165-4@http.www.slony.info/bugzilla/>
Message-ID: <20101108213650.5FB85290D2D@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=165

--- Comment #1 from Steve Singer <ssinger at ca.afilias.info> 2010-11-08 13:36:50 PST ---
This came up on the mailing list a while back.

Jose submitted a patch

http://lists.slony.info/pipermail/slony1-patches/2010-June/000068.html

but the patch wasn't compatible with 8.3

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Nov  8 13:45:20 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  8 Nov 2010 13:45:20 -0800 (PST)
Subject: [Slony1-bugs] [Bug 165] Hiding Password in logs
In-Reply-To: <bug-165-4@http.www.slony.info/bugzilla/>
References: <bug-165-4@http.www.slony.info/bugzilla/>
Message-ID: <20101108214520.7A819290D31@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=165

--- Comment #2 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-11-08 13:45:20 PST ---
Created an attachment (id=73)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=73)
Proposed patch

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Nov  8 13:47:41 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  8 Nov 2010 13:47:41 -0800 (PST)
Subject: [Slony1-bugs] [Bug 165] Hiding Password in logs
In-Reply-To: <bug-165-4@http.www.slony.info/bugzilla/>
References: <bug-165-4@http.www.slony.info/bugzilla/>
Message-ID: <20101108214741.1FF7F290D31@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=165

--- Comment #3 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-11-08 13:47:40 PST ---
(In reply to comment #1)
> This came up on the mailing list a while back.
> 
> Jose submitted a patch
> 
> http://lists.slony.info/pipermail/slony1-patches/2010-June/000068.html
> 
> but the patch wasn't compatible with 8.3

Yep, that's the one.  I was looking for that email; hadn't yet found it.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Nov  8 13:52:25 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  8 Nov 2010 13:52:25 -0800 (PST)
Subject: [Slony1-bugs] [Bug 165] Hiding Password in logs
In-Reply-To: <bug-165-4@http.www.slony.info/bugzilla/>
References: <bug-165-4@http.www.slony.info/bugzilla/>
Message-ID: <20101108215225.69621290D33@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=165

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |WONTFIX
             Status|NEW                         |RESOLVED

--- Comment #4 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-11-08 13:52:25 PST ---
The recommendation, instead, is that one of the "best practices" is to use
.pgpass to store passwords so that they will are not included as part of
conninfo.

Pgpass usage is nicely documented here:

http://www.postgresql.org/docs/9.0/interactive/libpq-pgpass.html

It appears that when the "best practices" section was removed from the
documentation, we lost documentation that this was recommended practice. 
(That's more or less the sort of thing that's useful about a "best practices"
section.)

At any rate, if the mechanism isn't portable to many PG versions, and there is
a "best practice" that keeps passwords out of the log files, I'll close this
out as a Will Not Fix.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Nov  8 14:12:44 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  8 Nov 2010 14:12:44 -0800 (PST)
Subject: [Slony1-bugs] [Bug 165] Hiding Password in logs
In-Reply-To: <bug-165-4@http.www.slony.info/bugzilla/>
References: <bug-165-4@http.www.slony.info/bugzilla/>
Message-ID: <20101108221244.1FC94290D33@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=165

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|WONTFIX                     |
             Status|RESOLVED                    |REOPENED

--- Comment #5 from Steve Singer <ssinger at ca.afilias.info> 2010-11-08 14:12:44 PST ---
The talk of .pgpass SHOULD have been moved from best practices to the "Security
Considerations" section but was missed. I will move that.

One feature of slony that people might be be taking advantage of is that you
can deploy slon to a new machine and and tell it to connect to one node (the
local node) from that it will get the paths+credentials for connecting to all
the remote nodes. I can see situations where this would be desirable, but I can
also see why in other situations .pgpass would be better than storing the
passwords in the conninfo in sl_path

I think this issue is still worth fixing.  The 8.3 incompatibility is more
incidental to Jose's patch and it could be reworked.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Nov 10 07:01:37 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 10 Nov 2010 07:01:37 -0800 (PST)
Subject: [Slony1-bugs] [Bug 156] Slon on startup should have "health check"
In-Reply-To: <bug-156-4@http.www.slony.info/bugzilla/>
References: <bug-156-4@http.www.slony.info/bugzilla/>
Message-ID: <20101110150137.9C2E4290D04@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=156

--- Comment #7 from Steve Singer <ssinger at ca.afilias.info> 2010-11-10 07:01:37 PST ---
I have reviewed version 726a3f0ee1775519696b1e1ebfca804c059da6e5 from your
github repository and am now happy with this being applied against master/HEAD.


Since this is a behavior change I'm inclined to not apply it against 2.0

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Nov 10 11:44:06 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 10 Nov 2010 11:44:06 -0800 (PST)
Subject: [Slony1-bugs] [Bug 156] Slon on startup should have "health check"
In-Reply-To: <bug-156-4@http.www.slony.info/bugzilla/>
References: <bug-156-4@http.www.slony.info/bugzilla/>
Message-ID: <20101110194406.E3F0A290D17@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=156

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED
            Version|2.0                         |devel

--- Comment #8 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-11-10 11:44:06 PST ---
Committed to master...

http://git.postgresql.org/gitweb?p=slony1-engine.git;a=commit;h=48bd40e006448b00d7ab413016562e13277102e5

I cherry picked the relevant patches into master, then squashed them into a
single patch.  

The following was rather interesting in describing how to do such:

http://stackoverflow.com/questions/598672/git-how-to-squash-the-first-two-commits

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Nov 10 14:00:52 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 10 Nov 2010 14:00:52 -0800 (PST)
Subject: [Slony1-bugs] [Bug 160] slon can get into a state where it spins
 with "child terminated status"
In-Reply-To: <bug-160-4@http.www.slony.info/bugzilla/>
References: <bug-160-4@http.www.slony.info/bugzilla/>
Message-ID: <20101110220052.C3F3B29026A@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=160

--- Comment #3 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-11-10 14:00:52 PST ---
The patch seems good to me.

I haven't tested it: it's troublesome to artificially induce errors on wait()
:-).

Analytically it seems apropos.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Nov 10 14:10:42 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 10 Nov 2010 14:10:42 -0800 (PST)
Subject: [Slony1-bugs] [Bug 155] slon can segfault when the postgres backend
 abnormally terminates
In-Reply-To: <bug-155-4@http.www.slony.info/bugzilla/>
References: <bug-155-4@http.www.slony.info/bugzilla/>
Message-ID: <20101110221042.8DC2A290BD7@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=155

--- Comment #2 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-11-10 14:10:42 PST ---
This has the expected effect, of explicitly restarting the threads, rather than
entrusting it all to signal side-effects.

Looks OK to me.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Nov 10 14:27:10 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 10 Nov 2010 14:27:10 -0800 (PST)
Subject: [Slony1-bugs] [Bug 162] typenameTypeId() changes signatures
In-Reply-To: <bug-162-4@http.www.slony.info/bugzilla/>
References: <bug-162-4@http.www.slony.info/bugzilla/>
Message-ID: <20101110222710.29BDD290BD7@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=162

--- Comment #2 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-11-10 14:27:10 PST ---
In reviewing Peter Eisentraut's patch for PG 9.1, what we definitely want to
use is the typenameTypeId() function, not typenameTypeIdAndMod(), which
provides a bit more validation of validity of my patch.

Please review...

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Mon Nov 15 08:02:55 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 15 Nov 2010 08:02:55 -0800 (PST)
Subject: [Slony1-bugs] [Bug 155] slon can segfault when the postgres backend
 abnormally terminates
In-Reply-To: <bug-155-4@http.www.slony.info/bugzilla/>
References: <bug-155-4@http.www.slony.info/bugzilla/>
Message-ID: <20101115160255.CE5FD290D1B@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=155

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #3 from Steve Singer <ssinger at ca.afilias.info> 2010-11-15 08:02:55 PST ---
Committed fix on REL_2_0_STABLE and master

8cd3d07e6af3752234e781ba6f7716840b8e6eb9
06953165d7b716cbcc1c74bb944394645988fa12

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Mon Nov 15 10:35:23 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 15 Nov 2010 10:35:23 -0800 (PST)
Subject: [Slony1-bugs] [Bug 165] Hiding Password in logs
In-Reply-To: <bug-165-4@http.www.slony.info/bugzilla/>
References: <bug-165-4@http.www.slony.info/bugzilla/>
Message-ID: <20101115183523.495B0290D2A@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=165

--- Comment #6 from Steve Singer <ssinger at ca.afilias.info> 2010-11-15 10:35:23 PST ---
Digging around a bit I see the following options


1) We can commit Jose's patch such that if it compiles against a 8.4 or above
libpq then we use his patch + the PQconninfo parse function.  Otherwise we 
don't strip the password from the log messages

2) We can copy the conn info parsing code from fe-connect.c in the
libpq/postgresql source tree so we have a version available to slony when it
compiles against 8.3.   The conninfo parsing code lives in previous versions of
fe-connect.c but the functions are all static so we can't call them.


3) We can try to come up with our own method of parsing conninfo strings.
I no longer think this is a viable idea looking at the code in fe-connect.c
This isn't a short snippet of code. 

4) Do nothing/punt on this until slony requires a minimum of 8.4 for other
reasons

Does anyone have a good argument for one of the above (if not 4 wins by default
since it is the 'do nothing' option

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Nov 15 11:25:10 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 15 Nov 2010 11:25:10 -0800 (PST)
Subject: [Slony1-bugs] [Bug 162] typenameTypeId() changes signatures
In-Reply-To: <bug-162-4@http.www.slony.info/bugzilla/>
References: <bug-162-4@http.www.slony.info/bugzilla/>
Message-ID: <20101115192510.1D64C290D1E@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=162

--- Comment #3 from Steve Singer <ssinger at ca.afilias.info> 2010-11-15 11:25:10 PST ---
This looks fine.
I assume the plan is to commit this to 1.2, 2.0 and master

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Mon Nov 15 12:09:39 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 15 Nov 2010 12:09:39 -0800 (PST)
Subject: [Slony1-bugs] [Bug 165] Hiding Password in logs
In-Reply-To: <bug-165-4@http.www.slony.info/bugzilla/>
References: <bug-165-4@http.www.slony.info/bugzilla/>
Message-ID: <20101115200939.BC110290CD1@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=165

--- Comment #7 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-11-15 12:09:39 PST ---
(In reply to comment #6)
> Does anyone have a good argument for one of the above (if not 4 wins by default
> since it is the 'do nothing' option

As long as we recommend .pgpass, which is an alternative mechanism for keeping
passwords hidden, I'd be comfortable with "do nothing."

-> % ack-grep pgpass *sgml [against HEAD]

adminscripts.sgml
755:that <filename>.pgpass</filename> will be used for storage of

faq.sgml
428:stored in <filename> $HOME/.pgpass</filename>, partially filling in
903:put them into <filename>$(HOME)/.pgpass.</filename></para>

maintenance.sgml
348:<envar>PASSFILE</envar> location of the <filename>.pgpass</filename> file
to be used. (default <filename>~sysusr/.pgpass</filename>)</para></listitem>

security.sgml
156:<listitem><para>You can setup a .pgpass file on each node you are running
157:slon on.  slon will then retreive the passwords from the .pgpass file.

slonik_ref.sgml
319:     passwords from <filename> .pgpass </filename>.

That seems like that's enough coverage!

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Nov 15 12:19:43 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 15 Nov 2010 12:19:43 -0800 (PST)
Subject: [Slony1-bugs] [Bug 162] typenameTypeId() changes signatures
In-Reply-To: <bug-162-4@http.www.slony.info/bugzilla/>
References: <bug-162-4@http.www.slony.info/bugzilla/>
Message-ID: <20101115201943.3B29A290CF0@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=162

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #4 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-11-15 12:19:42 PST ---
(In reply to comment #3)
> This looks fine.
> I assume the plan is to commit this to 1.2, 2.0 and master

Committed to 2.0 and master...

Not needed for 1.2, as 1.2 had different logic, and was already recognizing the
extra type signatures.

See commits...

HEAD:

http://git.postgresql.org/gitweb?p=slony1-engine.git;a=commit;h=861766f5f48cb6dc9a122f1d81abc22c4ddfbea7

2.0:

http://git.postgresql.org/gitweb?p=slony1-engine.git;a=commit;h=c2e41e106bce20652f1ad5aa5893a87764f103db

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Mon Nov 15 13:45:47 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 15 Nov 2010 13:45:47 -0800 (PST)
Subject: [Slony1-bugs] [Bug 134] TRUNCATE support
In-Reply-To: <bug-134-4@http.www.slony.info/bugzilla/>
References: <bug-134-4@http.www.slony.info/bugzilla/>
Message-ID: <20101115214547.1D8E6290CF0@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=134

--- Comment #8 from Steve Singer <ssinger at ca.afilias.info> 2010-11-15 13:45:47 PST ---
I reviewed a3a2e4839f5cf21bfd076e30e916cd23112daf97 rebased to our current
master (3cbbaba072b38527fa2ac7949ba680e7bd410a9a) with conflicts resolved.

A few comments

1.  Upgrade script support.  As it stands today an upgrade from 2.0
to 2.1 doesn't require re-installing the cluster.  This patch doesn't
warrent (in my opinion) requiring that.  Something else in the future
might but I would like to see an upgrade script add the truncate triggers
to all replicated tables.

2. I manually tested the functionality and it looked okay.  However run I tried
the regression test you added I got the same 'result' against 8.3 and
9.1master.
Since 8.3 doesn't support truncate triggers this confused me, it might just be
my unfamiliarity with the regression tests.  I was expecting a it to say it
failed with 8.3 (is that what we want?)

3. This probably should also have a documentation update, limitations.sgml at a
minimum to say we now support truncate in 8.4 and above.  We also might want to
say somewhere that the truncate on the slave is a CASCADE.   This would be
important to note for setups who have a different schema on their slave vs
master. 

Other than that I'm happy with this for master.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Mon Nov 15 14:44:30 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 15 Nov 2010 14:44:30 -0800 (PST)
Subject: [Slony1-bugs] [Bug 134] TRUNCATE support
In-Reply-To: <bug-134-4@http.www.slony.info/bugzilla/>
References: <bug-134-4@http.www.slony.info/bugzilla/>
Message-ID: <20101115224430.90182290D06@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=134

--- Comment #9 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-11-15 14:44:30 PST ---
(In reply to comment #8)
> I reviewed a3a2e4839f5cf21bfd076e30e916cd23112daf97 rebased to our current
> master (3cbbaba072b38527fa2ac7949ba680e7bd410a9a) with conflicts resolved.
> 
> A few comments
> 
> 1.  Upgrade script support.  As it stands today an upgrade from 2.0
> to 2.1 doesn't require re-installing the cluster.  This patch doesn't
> warrent (in my opinion) requiring that.  Something else in the future
> might but I would like to see an upgrade script add the truncate triggers
> to all replicated tables.

Good idea; I will rework it so that it tries to add the triggers, if possible.

> 2. I manually tested the functionality and it looked okay.  However run I tried
> the regression test you added I got the same 'result' against 8.3 and
> 9.1master.
> Since 8.3 doesn't support truncate triggers this confused me, it might just be
> my unfamiliarity with the regression tests.  I was expecting a it to say it
> failed with 8.3 (is that what we want?)

Hmm.  I'd expect the test to fail on 8.3, because tables would be empty there,
but not on the subscribers.

I don't think I tried running it on 8.3, because I expected it not to work
properly there.

> 3. This probably should also have a documentation update, limitations.sgml at a
> minimum to say we now support truncate in 8.4 and above.  We also might want to
> say somewhere that the truncate on the slave is a CASCADE.   This would be
> important to note for setups who have a different schema on their slave vs
> master. 

Yep, something needs to be put in there.  I think I'll either need to:
a) Merge docs from HEAD into this branch, or
b) Document as part of the merge into HEAD, as
c) Try and muddle docs in as-is won't work out very happily due to the lots of
upstream changes to the docs.

Probably b) is simplest.

> Other than that I'm happy with this for master.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov 16 09:35:23 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 16 Nov 2010 09:35:23 -0800 (PST)
Subject: [Slony1-bugs] [Bug 134] TRUNCATE support
In-Reply-To: <bug-134-4@http.www.slony.info/bugzilla/>
References: <bug-134-4@http.www.slony.info/bugzilla/>
Message-ID: <20101116173523.D3256290D1C@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=134

--- Comment #10 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-11-16 09:35:23 PST ---
(In reply to comment #9)
> (In reply to comment #8)
> > I reviewed a3a2e4839f5cf21bfd076e30e916cd23112daf97 rebased to our current
> > master (3cbbaba072b38527fa2ac7949ba680e7bd410a9a) with conflicts resolved.
> > 
> > A few comments
> > 
> > 1.  Upgrade script support.  As it stands today an upgrade from 2.0
> > to 2.1 doesn't require re-installing the cluster.  This patch doesn't
> > warrent (in my opinion) requiring that.  Something else in the future
> > might but I would like to see an upgrade script add the truncate triggers
> > to all replicated tables.
> 
> Good idea; I will rework it so that it tries to add the triggers, if possible.

Done.

https://github.com/cbbrowne/slony1-engine/commit/f1fb66ceec3d32039f83f293a362668d9d820746

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov 16 13:16:01 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 16 Nov 2010 13:16:01 -0800 (PST)
Subject: [Slony1-bugs] [Bug 134] TRUNCATE support
In-Reply-To: <bug-134-4@http.www.slony.info/bugzilla/>
References: <bug-134-4@http.www.slony.info/bugzilla/>
Message-ID: <20101116211601.11B132901B8@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=134

--- Comment #11 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-11-16 13:16:00 PST ---
Created an attachment (id=74)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=74)
Differences from test run

getting data from origin DB for diffing
done
getting data from node 2 for diffing against origin
comparing
./run_test.sh: WARNING: /tmp/slony-regress.abhpMa/db_1.dmp
/tmp/slony-regress.abhpMa/db_2.dmp differ, see
/tmp/slony-regress.abhpMa/db_diff.2 for details
done


Looking good...

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov 16 14:50:21 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 16 Nov 2010 14:50:21 -0800 (PST)
Subject: [Slony1-bugs] [Bug 134] TRUNCATE support
In-Reply-To: <bug-134-4@http.www.slony.info/bugzilla/>
References: <bug-134-4@http.www.slony.info/bugzilla/>
Message-ID: <20101116225021.ED27E290D1C@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=134

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #12 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-11-16 14:50:21 PST ---
Committed code changes to master:

http://git.postgresql.org/gitweb?p=slony1-engine.git;a=commit;h=587f926d5b2ab1ed332d8e966eede6c7e4574da0

Also, documentation changes:

http://git.postgresql.org/gitweb?p=slony1-engine.git;a=commit;h=4e0eede18828b2a0dcecd159cbaa3456eb40118e

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov 16 14:50:22 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 16 Nov 2010 14:50:22 -0800 (PST)
Subject: [Slony1-bugs] [Bug 137] execute script does not get applied in the
	correct order
In-Reply-To: <bug-137-4@http.www.slony.info/bugzilla/>
References: <bug-137-4@http.www.slony.info/bugzilla/>
Message-ID: <20101116225022.67D46290D2D@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=137

Bug 137 depends on bug 134, which changed state.

Bug 134 Summary: TRUNCATE support
http://www.slony.info/bugzilla/show_bug.cgi?id=134

           What    |Old Value                   |New Value
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Nov 17 05:34:08 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 17 Nov 2010 05:34:08 -0800 (PST)
Subject: [Slony1-bugs] [Bug 165] Hiding Password in logs
In-Reply-To: <bug-165-4@http.www.slony.info/bugzilla/>
References: <bug-165-4@http.www.slony.info/bugzilla/>
Message-ID: <20101117133408.0EC6D290D1B@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=165

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |WONTFIX
             Status|REOPENED                    |RESOLVED

--- Comment #8 from Steve Singer <ssinger at ca.afilias.info> 2010-11-17 05:34:08 PST ---
I'm closing this bug again.

Per the discussion you can use .pgpass to accomplish what password free logs
and implementing this feature in 8.3 is going to be too complicated.  If we
ever require 8.4 as a minimum version then we can revist.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Nov 17 05:38:55 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 17 Nov 2010 05:38:55 -0800 (PST)
Subject: [Slony1-bugs] [Bug 166] New: Provide a way of counting the number
 of outstanding operations in a sync
Message-ID: <bug-166-4@http.www.slony.info/bugzilla/>

http://www.slony.info/bugzilla/show_bug.cgi?id=166

           Summary: Provide a way of counting the number of outstanding
                    operations in a sync
           Product: Slony-I
           Version: devel
          Platform: All
        OS/Version: All
            Status: NEW
          Severity: enhancement
          Priority: low
         Component: core scripts
        AssignedTo: slony1-bugs at lists.slony.info
        ReportedBy: ssinger at ca.afilias.info
                CC: slony1-bugs at lists.slony.info
   Estimated Hours: 0.0


This is a feature request.

It would be very useful from a 'what the heck is my system doing' point of view
to know how many operations make up each outstanding SYNC request.

A system that is behind by 1000 SYNC's with no row edits in any of them is in a
very different state than a system that is 1000 SYNC's behind each with 10,000
UPDATE statements.

Similarly if the next/current SYNC to be processed consists of a million rows
that might explain why replication 'seems' to have stopped from an sl_status
point of view.

The test_slony_state.pl script seems like the most logical place to add this
though other ideas are welcome.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Nov 17 09:51:41 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 17 Nov 2010 09:51:41 -0800 (PST)
Subject: [Slony1-bugs] [Bug 166] Provide a way of counting the number of
 outstanding operations in a sync
In-Reply-To: <bug-166-4@http.www.slony.info/bugzilla/>
References: <bug-166-4@http.www.slony.info/bugzilla/>
Message-ID: <20101117175141.1D7BA290D06@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=166

--- Comment #1 from Christopher Browne <cbbrowne at ca.afilias.info> 2010-11-17 09:51:40 PST ---
The logic for this is liable to need a stored function (or similar) which
duplicates the logic in remote_worker.c which associates XIDs with SYNCs.

If we implement this (which could be quite a good idea!), this might provide a
way to shift the SYNC contents evaluation out of sync_event() (in
src/slon/remote_worker.c) into (a) stored function(s).

It's definitely nontrivial, but, if done, would pull a pretty complicated piece
out of the C code.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Thu Nov 18 06:01:17 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 18 Nov 2010 06:01:17 -0800 (PST)
Subject: [Slony1-bugs] [Bug 164] Unable to build slony1-2.0.5 on RHEL machine
In-Reply-To: <bug-164-4@http.www.slony.info/bugzilla/>
References: <bug-164-4@http.www.slony.info/bugzilla/>
Message-ID: <20101118140117.62E8A290D1B@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=164

--- Comment #3 from Steve Singer <ssinger at ca.afilias.info> 2010-11-18 06:01:17 PST ---
Created an attachment (id=75)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=75)
files missing from 2.0.5 tar

These are the files that I think are missing from the 2.0.5 tar

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Nov 19 06:59:22 2010
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 19 Nov 2010 06:59:22 -0800 (PST)
Subject: [Slony1-bugs] [Bug 160] slon can get into a state where it spins
 with "child terminated status"
In-Reply-To: <bug-160-4@http.www.slony.info/bugzilla/>
References: <bug-160-4@http.www.slony.info/bugzilla/>
Message-ID: <20101119145922.421F1290D1E@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=160

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #4 from Steve Singer <ssinger at ca.afilias.info> 2010-11-19 06:59:21 PST ---
Committed.
6f60815289ce598cdb67b1de92ba2362b0c1c149
1ce965cf3ae06fc03a2017f87eedefa6f95ddde4

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

