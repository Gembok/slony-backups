From bugzilla-daemon at main.slony.info  Wed Aug  3 12:07:43 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  3 Aug 2011 12:07:43 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 173] Slonik ABORT command
In-Reply-To: <bug-173-4@http.www.slony.info/bugzilla/>
References: <bug-173-4@http.www.slony.info/bugzilla/>
Message-ID: <20110803190743.4FBB7290E33@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=173

--- Comment #3 from Christopher Browne <cbbrowne at ca.afilias.info> 2011-08-03 12:07:43 PDT ---
Perhaps this should be extended to a fuller "conditional" to mostly replace the
present TRY block concept.  Have to think about that some more...

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Aug  4 13:28:26 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu,  4 Aug 2011 13:28:26 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 228] New: 'drop node' in a try block
Message-ID: <bug-228-4@http.www.slony.info/bugzilla/>

http://www.slony.info/bugzilla/show_bug.cgi?id=228

           Summary: 'drop node' in a try block
           Product: Slony-I
           Version: devel
          Platform: PC
        OS/Version: Linux
            Status: NEW
          Severity: enhancement
          Priority: low
         Component: slonik
        AssignedTo: slony1-bugs at lists.slony.info
        ReportedBy: ssinger at ca.afilias.info
                CC: slony1-bugs at lists.slony.info
   Estimated Hours: 0.0


In doing some testing against the 2.1.0 beta I tried executing some 
slonik code like

try {
   drop node(id=3, event node=1);
}
on error {
   echo "node already gone";
}
store node(id=3, event node=1);

A script like this will fail in the current 2.1.0 betas and this 
shouldn't surprise anyone who has read about the new features in 2.1.0

A drop node requires that the cluster be somewhat caught up (at least to 
the extent that any events from the drop'd node that have been confirmed 
elsewhere are confirmed everywhere).  This means that drop node has an 
implicit 'wait for event' before it.   However you can't have 'wait for 
events' inside a try block.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Thu Aug  4 13:41:21 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu,  4 Aug 2011 13:41:21 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 228] 'drop node' in a try block
In-Reply-To: <bug-228-4@http.www.slony.info/bugzilla/>
References: <bug-228-4@http.www.slony.info/bugzilla/>
Message-ID: <20110804204121.DE465290DF6@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=228

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |ssinger at ca.afilias.info
                   |o                           |
             Status|NEW                         |ASSIGNED

--- Comment #1 from Steve Singer <ssinger at ca.afilias.info> 2011-08-04 13:41:21 PDT ---
Created an attachment (id=117)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=117)
patch for a possible fix

This patch allows the first useful command in a try block to be a waiting
operation.  It will rollback the transaction and create a new one after the
wait.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Aug  8 06:31:35 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  8 Aug 2011 06:31:35 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 229] New: creating a set then adding a table to
 a different set can deadlock
Message-ID: <bug-229-4@http.www.slony.info/bugzilla/>

http://www.slony.info/bugzilla/show_bug.cgi?id=229

           Summary: creating a set then adding a table to a different set
                    can deadlock
           Product: Slony-I
           Version: devel
          Platform: PC
        OS/Version: Linux
            Status: NEW
          Severity: enhancement
          Priority: low
         Component: slonik
        AssignedTo: slony1-bugs at lists.slony.info
        ReportedBy: ssinger at ca.afilias.info
                CC: slony1-bugs at lists.slony.info
   Estimated Hours: 0.0


A tester has reported in In 2.1.0 beta3:

A slonik script such as 

create set(id=2, origin=2 ,comment='second set');
create set(id=3, origin=3 ,comment='second set');
set add table(set id=2,origin=2,  tables='disorder.do_item_*');

----

can hang slonik where slonik keeps waiting for an event confirmation that it
never sees.

The issue seems to be that the add table code will:

1. Open a transaction and obtain a lock on sl_config_lock on the origin node
(node 2)
2. perform an implicit 'wait for event' to ensure that the last event submitted
to node 3 (the previous origin) has propagated.

However because slonik has a lock on sl_config_lock on node 2, the slon for
node 2 (the remote worker) might not be able to replicate events to node 2 (the
store node) because applying a many events to node 2 requires obtaining the
sl_config_lock (and sometimes the sl_event_lock).

slonik should not be invoking the implicit 'wait for' behaviour when it is
holding an open transaction.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Aug  8 11:16:52 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  8 Aug 2011 11:16:52 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 229] creating a set then adding a table to a
 different set can deadlock
In-Reply-To: <bug-229-4@http.www.slony.info/bugzilla/>
References: <bug-229-4@http.www.slony.info/bugzilla/>
Message-ID: <20110808181652.DE91D290E37@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=229

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |ssinger at ca.afilias.info
                   |o                           |
             Status|NEW                         |ASSIGNED

--- Comment #1 from Steve Singer <ssinger at ca.afilias.info> 2011-08-08 11:16:52 PDT ---
Created an attachment (id=118)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=118)
test case

Test case bug

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Aug  8 11:17:08 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  8 Aug 2011 11:17:08 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 229] creating a set then adding a table to a
 different set can deadlock
In-Reply-To: <bug-229-4@http.www.slony.info/bugzilla/>
References: <bug-229-4@http.www.slony.info/bugzilla/>
Message-ID: <20110808181708.5DD0E290E24@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=229

--- Comment #2 from Steve Singer <ssinger at ca.afilias.info> 2011-08-08 11:17:08 PDT ---
Created an attachment (id=119)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=119)
fix for bug

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Mon Aug  8 11:18:50 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  8 Aug 2011 11:18:50 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 229] creating a set then adding a table to a
 different set can deadlock
In-Reply-To: <bug-229-4@http.www.slony.info/bugzilla/>
References: <bug-229-4@http.www.slony.info/bugzilla/>
Message-ID: <20110808181850.B2362290E36@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=229

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|ssinger at ca.afilias.info     |janwieck at yahoo.com

--- Comment #3 from Steve Singer <ssinger at ca.afilias.info> 2011-08-08 11:18:50 PDT ---
Please arrange for a review to this fix

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Mon Aug  8 12:39:36 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  8 Aug 2011 12:39:36 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 228] 'drop node' in a try block
In-Reply-To: <bug-228-4@http.www.slony.info/bugzilla/>
References: <bug-228-4@http.www.slony.info/bugzilla/>
Message-ID: <20110808193936.CF819290E20@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=228

--- Comment #2 from Christopher Browne <cbbrowne at ca.afilias.info> 2011-08-08 12:39:36 PDT ---
Another alternative would be for conditionals to be handled in an "abort if
{conditions} fashion", as described in bug #173.

I think you've observed that this isn't necessarily a reason to "abort," so
perhaps that should change to "conditional execution."

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Mon Aug  8 12:40:39 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  8 Aug 2011 12:40:39 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 173] Slonik ABORT command
In-Reply-To: <bug-173-4@http.www.slony.info/bugzilla/>
References: <bug-173-4@http.www.slony.info/bugzilla/>
Message-ID: <20110808194039.DCC0F290E24@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=173

--- Comment #4 from Christopher Browne <cbbrowne at ca.afilias.info> 2011-08-08 12:40:40 PDT ---
As observed in bug #228, there would be some use in having conditionals used to
pick between blocks of Slonik code.  We're not necessarily going to want to
abort.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Mon Aug  8 13:20:28 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  8 Aug 2011 13:20:28 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 229] creating a set then adding a table to a
 different set can deadlock
In-Reply-To: <bug-229-4@http.www.slony.info/bugzilla/>
References: <bug-229-4@http.www.slony.info/bugzilla/>
Message-ID: <20110808202028.8627E290E20@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=229

--- Comment #4 from Steve Singer <ssinger at ca.afilias.info> 2011-08-08 13:20:28 PDT ---
I don't know if this is related to this change, another recent change but

I am occasionally (as in 1 or two tests will hit this through a full disorder
run ) getting something like

@5ef4b65d - 2011-08-08 14:37:58 EDTDEBUG2 remoteWorkerThread_4: Received event
#4 from 5000000002 type:STORE_PATH
2011-08-08 14:37:58,028 [slonik add pathsstderr] ERROR
info.slony.clustertest.testcoordinator.slony.SlonikScript slonik add pa
ths:java.lang.UNIXProcess at 5d79a22d - <stdin>:19: PGRES_FATAL_ERROR lock table
"_disorder_replica".sl_event_lock, "_disorder_re
plica".sl_config_lock;select "_disorder_replica".storePath(5, 2, 'dbname=test5
host=localhost port=5432 user=slon password=slo
n', 10);  - ERROR:  duplicate key value violates unique constraint
"sl_node-pkey"
2011-08-08 14:37:58,028 [slonik add pathsstderr] ERROR
info.slony.clustertest.testcoordinator.slony.SlonikScript slonik add pa
ths:java.lang.UNIXProcess at 5d79a22d - CONTEXT:  SQL statement "insert into
"_disorder_replica".sl_node (no_id, no_active, no_co
mment) values ( $1 , 'f',  $2 )"
2011-08-08 14:37:58,028 [slonik add pathsstderr] ERROR
info.slony.clustertest.testcoordinator.slony.SlonikScript slonik add pa
ths:java.lang.UNIXProcess at 5d79a22d - PL/pgSQL function "storenode_int" line 22
at SQL statement


as I test this change.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Mon Aug  8 13:39:12 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  8 Aug 2011 13:39:12 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 218] slon often has to retry transactions due to
 concurrent update in 2.1.0.b2
In-Reply-To: <bug-218-4@http.www.slony.info/bugzilla/>
References: <bug-218-4@http.www.slony.info/bugzilla/>
Message-ID: <20110808203912.A1019290E36@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=218

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|FIXED                       |
             Status|RESOLVED                    |REOPENED

--- Comment #22 from Steve Singer <ssinger at ca.afilias.info> 2011-08-08 13:39:12 PDT ---
It looks like the merge issues on this ended up merging in the version of this
fix that has remote_worker obtain sl_config_lock then sl_event_lock  compared
to slonik that obtains sl_event_lock then sl_config_lock.

See my review up thread dated "2011-06-08 08:46:13 PDT" on this bug.

I see the occasional deadlock with the disorder tests due to this.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Aug  9 07:37:02 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue,  9 Aug 2011 07:37:02 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 218] slon often has to retry transactions due to
 concurrent update in 2.1.0.b2
In-Reply-To: <bug-218-4@http.www.slony.info/bugzilla/>
References: <bug-218-4@http.www.slony.info/bugzilla/>
Message-ID: <20110809143702.2EA07290D0F@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=218

--- Comment #23 from Steve Singer <ssinger at ca.afilias.info> 2011-08-09 07:37:02 PDT ---
Created an attachment (id=120)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=120)
Patch to fix order of locking

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 10 12:51:37 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 10 Aug 2011 12:51:37 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 228] 'drop node' in a try block
In-Reply-To: <bug-228-4@http.www.slony.info/bugzilla/>
References: <bug-228-4@http.www.slony.info/bugzilla/>
Message-ID: <20110810195137.6B7D2290E37@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=228

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|ssinger at ca.afilias.info     |janwieck at yahoo.com

--- Comment #3 from Steve Singer <ssinger at ca.afilias.info> 2011-08-10 12:51:37 PDT ---
Please review

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 10 13:18:31 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 10 Aug 2011 13:18:31 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 230] New: Timestamps stopped showing up in the
 slon_log on some platforms
Message-ID: <bug-230-4@http.www.slony.info/bugzilla/>

http://www.slony.info/bugzilla/show_bug.cgi?id=230

           Summary: Timestamps stopped showing up in the slon_log on some
                    platforms
           Product: Slony-I
           Version: devel
          Platform: PC
        OS/Version: Linux
            Status: NEW
          Severity: enhancement
          Priority: low
         Component: slon
        AssignedTo: slony1-bugs at lists.slony.info
        ReportedBy: ssinger at ca.afilias.info
                CC: slony1-bugs at lists.slony.info
   Estimated Hours: 0.0


Created an attachment (id=121)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=121)
patch attached

Timestamps on some platforms stopped showing up in the slog log with 2.1.0

AIX/PowerPC is one example this was observed one.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 10 13:19:53 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 10 Aug 2011 13:19:53 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 230] Timestamps stopped showing up in the
 slon_log on some platforms
In-Reply-To: <bug-230-4@http.www.slony.info/bugzilla/>
References: <bug-230-4@http.www.slony.info/bugzilla/>
Message-ID: <20110810201953.E6865290E36@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=230

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |cbbrowne at ca.afilias.info
                   |o                           |
             Status|NEW                         |ASSIGNED

--- Comment #1 from Steve Singer <ssinger at ca.afilias.info> 2011-08-10 13:19:54 PDT ---
Please review

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 10 13:58:56 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 10 Aug 2011 13:58:56 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 230] Timestamps stopped showing up in the
 slon_log on some platforms
In-Reply-To: <bug-230-4@http.www.slony.info/bugzilla/>
References: <bug-230-4@http.www.slony.info/bugzilla/>
Message-ID: <20110810205856.10F06290E28@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=230

--- Comment #2 from Steve Singer <ssinger at ca.afilias.info> 2011-08-10 13:58:56 PDT ---
This patch will need to be applied to REL_2_0_STABLE.  This worked in 2.0.6 but
was broken with 2.0.7

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 10 14:20:16 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 10 Aug 2011 14:20:16 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 218] slon often has to retry transactions due to
 concurrent update in 2.1.0.b2
In-Reply-To: <bug-218-4@http.www.slony.info/bugzilla/>
References: <bug-218-4@http.www.slony.info/bugzilla/>
Message-ID: <20110810212016.A3648290DB2@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=218

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|ssinger at ca.afilias.info     |cbbrowne at ca.afilias.info

--- Comment #24 from Steve Singer <ssinger at ca.afilias.info> 2011-08-10 14:20:16 PDT ---
Chris please my patch to fix the locking ordering. You can also see that commit
https://github.com/ssinger/slony1-engine/commit/6cf2ba44eccdd10de07d64e8526ed5bcb1cd80c0

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 10 14:24:51 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 10 Aug 2011 14:24:51 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 230] Timestamps stopped showing up in the
 slon_log on some platforms
In-Reply-To: <bug-230-4@http.www.slony.info/bugzilla/>
References: <bug-230-4@http.www.slony.info/bugzilla/>
Message-ID: <20110810212451.2E415290E28@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=230

--- Comment #3 from Christopher Browne <cbbrowne at ca.afilias.info> 2011-08-10 14:24:51 PDT ---
The definition seems generally reasonable.

One caveat is that ~ isn't portable when applied to signed operands, so if we
have any platforms where bool has, underlying it, a signed type, then there
could be some unhappiness.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 10 14:58:17 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 10 Aug 2011 14:58:17 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 230] Timestamps stopped showing up in the
 slon_log on some platforms
In-Reply-To: <bug-230-4@http.www.slony.info/bugzilla/>
References: <bug-230-4@http.www.slony.info/bugzilla/>
Message-ID: <20110810215817.184A3290E28@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=230

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|cbbrowne at ca.afilias.info    |ssinger at ca.afilias.info

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 10 15:01:18 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 10 Aug 2011 15:01:18 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 231] New: Bad regex in start_slon.sh
Message-ID: <bug-231-4@http.www.slony.info/bugzilla/>

http://www.slony.info/bugzilla/show_bug.cgi?id=231

           Summary: Bad regex in start_slon.sh
           Product: Slony-I
           Version: 2.0
          Platform: PC
        OS/Version: Linux
            Status: ASSIGNED
          Severity: enhancement
          Priority: low
         Component: core scripts
        AssignedTo: cbbrowne at ca.afilias.info
        ReportedBy: cbbrowne at ca.afilias.info
                CC: slony1-bugs at lists.slony.info
   Estimated Hours: 0.0


-PID_LINE=`grep pid_file $SLON_CONF | cut -d "#" -f 1 | grep
"^[:space:]*pid_file='.*'"`
+PID_LINE=`grep pid_file $SLON_CONF | cut -d "#" -f 1 | grep
"^[[:space:]]*pid_file='.*'"`

Needs an extra "[]" nesting

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 10 15:13:03 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 10 Aug 2011 15:13:03 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 218] slon often has to retry transactions due to
 concurrent update in 2.1.0.b2
In-Reply-To: <bug-218-4@http.www.slony.info/bugzilla/>
References: <bug-218-4@http.www.slony.info/bugzilla/>
Message-ID: <20110810221303.640F9290E28@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=218

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|cbbrowne at ca.afilias.info    |ssinger at ca.afilias.info

--- Comment #25 from Christopher Browne <cbbrowne at ca.afilias.info> 2011-08-10 15:13:03 PDT ---
(In reply to comment #24)
> Chris please my patch to fix the locking ordering. You can also see that commit
> https://github.com/ssinger/slony1-engine/commit/6cf2ba44eccdd10de07d64e8526ed5bcb1cd80c0

Ah, quite right.

It's easy to see all the cases, and with the patch, they are now all consistent
in locking sl_event_lock before sl_config_lock.

slonik/slonpostgres at cbbrowne [06:11:41] [~/slony1-engine.github/src] [master *]
-> % grep sl_config */*.c | grep sl_event
slon/remote_worker.c:                                                          
                 "lock table %s.sl_event_lock,%s.sl_config_lock;",
slon/remote_worker.c:                                                          
 "lock table %s.sl_event_lock,%s.sl_config_lock;"
slon/remote_worker.c:                                                          
 "lock table %s.sl_event_lock, %s.sl_config_lock;"
slon/remote_worker.c:                                                          
 "lock table %s.sl_event_lock,%s.sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonpostgres at cbbrowne [06:11:41] [~/slony1-engine.github/src] [master *]
-> % grep sl_config */*.c | grep sl_event
zsh: correct 'sl_event' to 'slevent' [nyae]? n
slon/remote_worker.c:                                                          
                 "lock table %s.sl_event_lock,%s.sl_config_lock;",
slon/remote_worker.c:                                                          
 "lock table %s.sl_event_lock,%s.sl_config_lock;"
slon/remote_worker.c:                                                          
 "lock table %s.sl_event_lock, %s.sl_config_lock;"
slon/remote_worker.c:                                                          
 "lock table %s.sl_event_lock,%s.sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;",
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;",
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
ik.c:                                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;",
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;",
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
ik.c:                                 "lock table \"_%s\".sl_event_lock,
\"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;",
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;",
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"
slonik/slonik.c:                                 "lock table
\"_%s\".sl_event_lock, \"_%s\".sl_config_lock;"

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Aug 10 15:17:16 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 10 Aug 2011 15:17:16 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 231] Bad regex in start_slon.sh
In-Reply-To: <bug-231-4@http.www.slony.info/bugzilla/>
References: <bug-231-4@http.www.slony.info/bugzilla/>
Message-ID: <20110810221716.4DFCA290E36@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=231

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|cbbrowne at ca.afilias.info    |ssinger at ca.afilias.info

--- Comment #1 from Christopher Browne <cbbrowne at ca.afilias.info> 2011-08-10 15:17:16 PDT ---
Patch at github...

https://github.com/cbbrowne/slony1-engine/tree/bug231

https://github.com/cbbrowne/slony1-engine/commit/4cf47fbb3ffa0bf8b2cfbb6c08aab6f850795ebd

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Aug 11 04:46:12 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 11 Aug 2011 04:46:12 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 230] Timestamps stopped showing up in the
 slon_log on some platforms
In-Reply-To: <bug-230-4@http.www.slony.info/bugzilla/>
References: <bug-230-4@http.www.slony.info/bugzilla/>
Message-ID: <20110811114612.72B24290E20@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=230

--- Comment #4 from Steve Singer <ssinger at ca.afilias.info> 2011-08-11 04:46:12 PDT ---
(In reply to comment #3)
> The definition seems generally reasonable.
> 
> One caveat is that ~ isn't portable when applied to signed operands, so if we
> have any platforms where bool has, underlying it, a signed type, then there
> could be some unhappiness.

I suspect this is the root cause of the unhappiness to begin with, I think this
patch makes the casting happen on both sides of the operator.

Should we just do

#define true (bool) 1
#define false (bool) 0

?

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Aug 11 05:02:49 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 11 Aug 2011 05:02:49 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 218] slon often has to retry transactions due to
 concurrent update in 2.1.0.b2
In-Reply-To: <bug-218-4@http.www.slony.info/bugzilla/>
References: <bug-218-4@http.www.slony.info/bugzilla/>
Message-ID: <20110811120249.A99BC290E06@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=218

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|REOPENED                    |RESOLVED

--- Comment #26 from Steve Singer <ssinger at ca.afilias.info> 2011-08-11 05:02:49 PDT ---
This patch has been committed
http://git.postgresql.org/gitweb/?p=slony1-engine.git;a=commit;h=3019664f5a44cb1dd12dad644c17a89d13452242

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Aug 11 05:15:31 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 11 Aug 2011 05:15:31 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 231] Bad regex in start_slon.sh
In-Reply-To: <bug-231-4@http.www.slony.info/bugzilla/>
References: <bug-231-4@http.www.slony.info/bugzilla/>
Message-ID: <20110811121531.C0D54290D1B@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=231

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|ssinger at ca.afilias.info     |cbbrowne at ca.afilias.info

--- Comment #2 from Steve Singer <ssinger at ca.afilias.info> 2011-08-11 05:15:31 PDT ---
This looks fine.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

